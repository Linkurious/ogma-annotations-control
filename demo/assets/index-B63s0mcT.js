var Xb=Object.defineProperty;var Yb=(t,e,s)=>e in t?Xb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var $b=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Mt=(t,e,s)=>(Yb(t,typeof e!="symbol"?e+"":e,s),s);var AD=$b((LD,Yr)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();var qb=Object.create,Tl=Object.defineProperty,Zb=Object.defineProperties,Jb=Object.getOwnPropertyDescriptor,Kb=Object.getOwnPropertyDescriptors,pf=Object.getOwnPropertyNames,Fc=Object.getOwnPropertySymbols,Qb=Object.getPrototypeOf,yf=Object.prototype.hasOwnProperty,tv=Object.prototype.propertyIsEnumerable,td=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),ev=t=>{throw TypeError(t)},kc=(t,e,s)=>e in t?Tl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ct=(t,e)=>{for(var s in e||(e={}))yf.call(e,s)&&kc(t,s,e[s]);if(Fc)for(var s of Fc(e))tv.call(e,s)&&kc(t,s,e[s]);return t},$t=(t,e)=>Zb(t,Kb(e)),xf=(t,e)=>function(){return e||(0,t[pf(t)[0]])((e={exports:{}}).exports,e),e.exports},Ao=(t,e)=>{for(var s in e)Tl(t,s,{get:e[s],enumerable:!0})},sv=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of pf(e))yf.call(t,n)||n===s||Tl(t,n,{get:()=>e[n],enumerable:!(i=Jb(e,n))||i.enumerable});return t},xu=(t,e,s)=>(s=t!=null?qb(Qb(t)):{},sv(t&&t.__esModule?s:Tl(s,"default",{value:t,enumerable:!0}),t)),xn=(t,e,s)=>new Promise((i,n)=>{var r=l=>{try{a(s.next(l))}catch(d){n(d)}},o=l=>{try{a(s.throw(l))}catch(d){n(d)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(r,o);a((s=s.apply(t,e)).next())}),iv=function(t,e){this[0]=t,this[1]=e},nv=t=>{var e,s=t[td("asyncIterator")],i=!1,n={};return s==null?(s=t[td("iterator")](),e=r=>n[r]=o=>s[r](o)):(s=s.call(t),e=r=>n[r]=o=>{if(i){if(i=!1,r==="throw")throw o;return o}return i=!0,{done:!1,value:new iv(new Promise(a=>{var l=s[r](o);l instanceof Object||ev("Object expected"),a(l)}),1)}}),n[td("iterator")]=()=>n,e("next"),"throw"in s?e("throw"):n.throw=r=>{throw r},"return"in s&&e("return"),n},bf=xf({"node_modules/@linkurious/ogma-parsers/dist/ogma-parsers.umd.js"(t,e){var s,i;s=t,i=function(n){/**
* Ogma Parsers
* @description Parsers for Ogma
* @version 0.0.20 (built on Fri Jan 12 2024 15:00:46 GMT+0000 (Coordinated Universal Time))
* @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
* @license (c) Linkurious 2024. All rights reserved.
* @preserve
*/function r($,et,ht){ht=ht||et,et in $&&($.attributes[ht]=$[et])}function o($,et,ht){if($&&typeof $=="object"){if(Array.isArray($))return $.forEach(lt=>o(lt,et,ht));if(function(rt){return rt.type==="vertex"||rt._type==="vertex"||rt.inE||rt.outE||rt._inE||rt._outE}($)){const lt={};$.properties&&Object.keys($.properties).forEach(nt=>{lt[nt]=$.properties[nt][0].value});const rt=l($);et.push({id:rt,data:{id:$.id+"",categories:[$.label],properties:lt}});for(const nt in $)nt!=="properties"&&o($[nt],et,ht);return}if(function(rt){return rt.type==="edge"||rt._type==="edge"||rt.inV||rt.outV||rt._outV||rt._inV}($)){const lt=l($);ht.push({id:lt,source:a($,["inV","_inV"]),target:a($,["outV","_outV"]),data:{id:lt,type:$.label,properties:$.properties||{}}});for(const rt in $)rt!=="properties"&&o($[rt],et,ht);return}Object.keys($).forEach(lt=>o($[lt],et,ht))}}function a($,et){for(const ht of et)if($[ht])return l($[ht])}function l($){if(typeof $=="string"||isFinite($))return String($);const et=$;return String(et.id||et._id)}const d=$=>$.charCodeAt(0),h=d(" "),u=d("<"),c=d(">"),g=d('"'),m=d(`
`),_=d("\r"),f=d("/"),p=d("\\"),x=d("a"),y=d("z"),b=d("A"),v=d("Z"),E=d("0"),A=d("9"),S=d(":"),T=-1,L=-2,I=-3,R=-4;function z($,et,ht,lt){const rt=lt.length;if(ht-et!==rt)return!1;for(let nt=0;nt<rt;++nt)if($[et+nt]!==lt[nt])return!1;return!0}function j($,et,ht,lt){return C($.tags,et,ht,lt)}function C($,et,ht,lt){const rt=$.length;for(let nt=0;nt<rt;++nt)if(z(et,ht,lt,$[nt]))return nt;return $.push(et.slice(ht,lt)),rt}function w($,et,ht){let lt=K(et,ht),rt=et[lt];if(rt===c||rt===f)return lt;let nt=lt;lt=xt(et,lt);const Lt=function(wt,Wt,Ut,ye){return C(wt.attributes,Wt,Ut,ye)}($,et,nt,lt);for(;et[lt]!==g;)++lt;for(++lt,nt=lt;(rt=et[lt])!==g;)rt===p&&++lt,++lt;return $.tokens.push(I,Lt,nt,lt),lt+1}function H($){return $===h||$===m||$===_}function K($,et){for(;H($[et]);)++et;return et}function it($){return $>=x&&$<=y||$>=b&&$<=v||$===S||$>=E&&$<=A}function xt($,et){for(;it($[et]);)++et;return et}function at($,et){const ht=["return {","  id: undefined,","  attributes: {","    text: undefined,","    color: undefined,",`    ${$?"radius":"width"}: undefined`,$?"  ,x: undefined":"",$?"  ,y: undefined":"","  },"];$||ht.push("  source: undefined,","  target: undefined,");const lt=Object.keys(et);lt.length&&ht.push("  data: {");for(let rt=0;rt<lt.length;++rt){const nt=et[lt[rt]],Lt=nt.title;ht.push(`  "${Lt}": ${nt.default!==void 0?JSON.stringify(nt.default):void 0}${rt===lt.length-1?"":","}`)}return lt.length&&ht.push("}"),ht.push("};"),new Function(ht.join(`
`))}function Tt($){return $.indexOf("\\")===-1||($=$.replace(/\\"/g,'"')),$}function It($,et){let ht=0;for(let lt=0;lt<20;++lt){const rt=ht+$[lt]+et[lt];ht=+(rt>=10),$[lt]=rt%10}}const dt=new class{constructor(){this._decimalPowerOfTwo=new Uint8Array(20),this._binaryNumber=new Uint8Array(64),this._decimalNumber=new Uint8Array(20)}int64ToString({low:et,high:ht}){if(et===0&&ht===0)return"0";(function(St,wt,Wt){for(let Ut=0;Ut<32;++Ut)Wt[Ut]=+!!(St&1<<Ut);for(let Ut=0;Ut<32;++Ut)Wt[Ut+32]=+!!(wt&1<<Ut);return Wt})(et,ht,this._binaryNumber),this._decimalNumber.fill(0),this._decimalPowerOfTwo.fill(0),this._decimalPowerOfTwo[0]=1;const lt=this._binaryNumber[63]===1;lt&&function(St){for(let wt=0;wt<64;++wt)St[wt]^=1;for(let wt=0;wt<64&&!(St[wt]^=1);++wt);}(this._binaryNumber);for(let Lt=0;Lt<64;++Lt)this._binaryNumber[Lt]&&It(this._decimalNumber,this._decimalPowerOfTwo),It(this._decimalPowerOfTwo,this._decimalPowerOfTwo);const rt=[];let nt=this._decimalNumber.length-1;for(lt&&rt.push("-");!this._decimalNumber[nt];)nt-=1;for(let Lt=nt;Lt>=0;--Lt)rt.push(String(this._decimalNumber[Lt]));return rt.join("")}};function bt($){return dt.int64ToString($)}function Ht($){return typeof $=="object"&&"high"in $&&"low"in $}const Qt=$=>"start"in $&&"end"in $&&"type"in $,Xt=$=>"segments"in $;function mt($,et,ht,lt){if(et)if(Array.isArray(et))et.forEach(rt=>mt($,rt,ht,lt));else if(Xt(et))(function(nt,Lt,St,wt){Lt.segments.forEach(Wt=>{mt(nt,Wt.start,St,wt),mt(nt,Wt.end,St,wt),mt(nt,Wt.relationship,St,wt)})})($,et,ht,lt);else if(function(nt){if(typeof nt!="object"||nt===null)throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. Please make sure that your Cypher query returns nodes and edges, not values.");const Lt=Object.keys(nt.properties);for(const St of Lt){const wt=nt.properties[St];Ht(wt)&&(nt.properties[St]=bt(wt))}if(nt.identity!==void 0){if(Ht(nt.identity)&&(nt.identity=bt(nt.identity)),function(wt){return"start"in wt&&"end"in wt}(nt)){const St=nt.start.identity||nt.start,wt=nt.end.identity||nt.end;Ht(St)&&(nt.start=bt(St)),Ht(wt)&&(nt.end=bt(wt))}}else nt.id&&(nt.identity=nt.id)}(et),Qt(et))lt.has(et.identity)||(lt.add(et.identity),$.edges.push({id:et.identity,source:et.start,target:et.end,data:{neo4jType:et.type,neo4jProperties:et.properties}}));else{const rt=et;ht.has(rt.identity)||(ht.add(rt.identity),$.nodes.push({id:rt.identity,attributes:{},data:{neo4jLabels:rt.labels,neo4jProperties:rt.properties}}))}}const ft={boolean:$=>$.toLowerCase()==="true",int:parseFloat,long:parseFloat,float:parseFloat,double:parseFloat,string:$=>$};function te($,et,ht){const lt=$.getElementsByTagName("data"),rt={};for(let nt=0;nt<lt.length;nt++){const Lt=lt[nt],St=Lt.getAttribute("key");if(St===null)continue;const wt=et[St];typeof wt>"u"?rt[St]=Lt.textContent:Lt.textContent&&Lt.textContent.length!==0&&(rt[wt.name]=wt.parse(Lt.textContent))}for(const nt in ht)nt in rt||(rt[nt]=ht[nt]);return rt}function qt($){return $.color?$.color:$.r&&$.g&&$.b?`rgb(${$.r}, ${$.g}, ${$.b})`:void 0}const se=new Set(["x","y","size","color","r","g","b","label"]);function ee($){const et={};for(const ht in $)se.has(ht)||$[ht]===void 0||(et[ht]=$[ht]);return et}n.gexf=function(et){if(et.indexOf("<gexf")===-1)throw new Error("not a GEXF file");const ht=function(B){const V=new Int32Array(B.length);for(let Z=0,tt=B.length;Z<tt;++Z)V[Z]=B.charCodeAt(Z);return V}(et),lt=function(B,V){let Z,tt;const ot={tags:[],attributes:[],tokens:[]},J=ot.tokens;let st=K(B,V);for(;st<B.length;){let _t=B[st];if(_t===u){if(st=K(B,++st),B[st]===f)for(J.push(L);B[++st]!==c;);else{Z=st,st=xt(B,Z);const Et=j(ot,B,Z,st);for(J.push(T,Et),_t=B[st];_t!==c&&_t!==f;)st=w(ot,B,st),_t=B[st];if(_t===f)for(J.push(L);B[++st]!==c;);}st+=1}else{for(Z=st;B[++st]!==u;);for(tt=st-1;H(B[tt]);)--tt;J.push(R,Z,tt+1)}st=K(B,st)}return ot}(ht,et.indexOf("<gexf ")),rt={},nt={};lt.tags.forEach((Y,B)=>{const V=String.fromCharCode.apply(null,Y);rt[V]=B}),lt.attributes.forEach((Y,B)=>{const V=String.fromCharCode.apply(null,Y);nt[V]=B});const Lt=rt.attributes,St=rt.attribute,wt=rt.node,Wt=rt.edge,Ut=rt.default,ye=rt["viz:position"],me=rt["viz:size"],_e=rt["viz:color"],Ee=rt.attvalue,Fe=nt.class,Zt=nt.id,de=nt.type,Ae=nt.title,pe=nt.label,ie=nt.source,Le=nt.target,xe=nt.x,ke=nt.y,bs=nt.r,ne=nt.g,re=nt.b,oe=nt.a,De=nt.value,Re=nt.for,Ke=nt.weight,cs={float:1,double:1,integer:2,boolean:3,string:4,"list-string":5};let Oe=0;const qe=lt.tokens,vs=qe.length,qs=new Array(16);let fe=0,Ge=0,We=0,P=!0;const D={},W={};let O,Q,vt="",Pt="",Ct="",Nt={attributes:{}},Ot=0,jt=0,Yt=0,Gt=1,Vt="",M=!1,k=!0,N=null,F=null;const U=[],X=[];let G=0,q={};for(;Oe<vs;){const Y=qe[Oe];if(Y===T)Ge=fe,fe=qe[Oe+1],qs[We]=fe,We+=1,fe===wt?(N||(N=at(!0,D)),Nt=N(),k=!0,q=D):fe===Wt&&(F||(F=at(!1,W)),Nt=F(),k=!1,q=W),Oe+=2;else if(Y===L){if(vt&&fe===St){q=P?D:W;const B=cs[Pt];let V=O;V&&(B===1?V=+V:B===2?V=0|+V:B===3?V=V==="true":B===5&&(V=V.split(" ").filter(Z=>Z))),q[vt]={title:Ct||vt,default:V,type:B},vt="",Ct="",Pt="",O=void 0}else if(fe===wt&&We===4)M&&Nt.attributes&&(Nt.attributes.color=`rgba(${Ot}, ${jt}, ${Yt}, ${Gt})`,Ot=0,jt=0,Yt=0,Gt=1,M=!1),Nt.id||(Nt.id=++G),U.push(Nt);else if(fe===Wt&&We===4)Nt.id||(Nt.id=++G),X.push(Nt);else if(fe===Ee&&We===6&&Vt){const B=(k?D:W)[Vt];if(B){if(Q===void 0)Q=B.default;else{const V=B.type;V&&(V===1?Q=+Q:V===2?Q=0|+Q:V===3?Q=Q==="true":V===5?Q=Q.split(" ").filter(Z=>Z).map(Z=>Tt(Z)):typeof ht=="string"&&(Q=Tt(Q)))}Nt.data[q[Vt].title]=Q}Vt="",Q=null}We-=1,fe=Ge,Ge=qs[We-2],Oe+=1}else if(Y===I){const B=qe[Oe+1],V=et.substring(qe[Oe+2],qe[Oe+3]);if(fe===Lt)B===Fe&&(P=V!=="edge"&&V!=="edges");else if(fe===St)B===Zt?vt=V:B===de?Pt=V:B===Ae&&(Ct=V);else if(fe!==wt&&fe!==Wt||We!==4)if(fe===ye&&We===5){if(B===xe)Nt.attributes.x=parseFloat(V);else if(B===ke){const Z=parseFloat(V);Nt.attributes.y=Z===0?Z:-Z}}else fe===_e&&We===5?(M=!0,B===bs?Ot=parseInt(V):B===ne?jt=parseInt(V):B===re?Yt=parseInt(V):B===oe&&(Gt=parseFloat(V))):fe===me&&We===5?B===De&&(k?Nt.attributes.radius=+V:Nt.attributes.width=+V):fe===Ee&&We===6&&(B===Re||B===Zt?Vt=V:B===De&&(Q=V));else B===Zt?Nt.id=V:B===pe?Nt.attributes.text=V:B===ie?Nt.source=V:B===Le?Nt.target=V:B===Ke&&(Nt.attributes.width=+V);Oe+=4}else{if(Y!==R)throw new Error(`at index ${Oe}: token ${Y}`);{const B=et.substring(qe[Oe+1],qe[Oe+2]);fe===Ut&&(O=B),Oe+=3}}}return{nodes:U,edges:X}},n.graphml=function(et,ht){if(!ht){if(typeof DOMParser>"u")throw new Error("DOMParser is not available. You need to provide a DOMParser instance as second argument, if you are not in the browser environment");ht=new DOMParser}const lt=ht.parseFromString(et,"application/xml"),rt=lt.getElementsByTagName("key"),nt=lt.getElementsByTagName("node"),Lt=lt.getElementsByTagName("edge"),{definitions:St,defaults:wt}=function(_e){const Ee={graph:{},node:{},edge:{}},Fe={graph:{},node:{},edge:{}};for(let Zt=0;Zt<_e.length;Zt++){const de=_e[Zt],Ae=de.getAttribute("for")||"node",pe=de.getAttribute("id"),ie=de.getAttribute("attr.name"),Le=de.getAttribute("attr.type")||"string",xe=de.getElementsByTagName("default"),ke=xe.length!==0?xe[0].textContent:void 0;Ee[Ae][pe]={name:ie,parse:ft[Le]},typeof ke<"u"&&(Fe[Ae][ie]=ke)}return{definitions:Ee,defaults:Fe}}(rt),Wt=[],Ut=new Set;for(let me=0;me<nt.length;me++){const _e=nt[me],Ee=_e.getAttribute("id"),Fe=_e.getAttribute("href")||void 0,Zt=te(_e,St.node,wt.node);Ut.add(Ee);const de={id:Ee,attributes:{x:Zt.x,y:Zt.y,radius:Zt.size,color:qt(Zt),text:Zt.label},data:ee(Zt)};Zt.x!==void 0&&(de.attributes.x=Zt.x),Zt.y!==void 0&&(de.attributes.y=Zt.y),Zt.size!==void 0&&(de.attributes.radius=Zt.size),Zt.label!==void 0&&(de.attributes.text=Zt.label);const Ae=qt(Zt);Ae!==void 0&&(de.attributes.color=Ae),Fe!==void 0&&(de.data.href=Fe),Wt.push(de)}const ye=[];for(let me=0;me<Lt.length;me++){const _e=Lt[me],Ee=_e.getAttribute("id")||me,Fe=_e.getAttribute("source"),Zt=_e.getAttribute("target"),de=_e.getAttribute("xlink:href")||void 0;if(!Ut.has(Fe)||!Ut.has(Zt))throw new Error(`Invalid edge: ${Fe} -> ${Zt}`);const Ae=te(_e,St.edge,wt.edge),pe={id:Ee,source:Fe,target:Zt,attributes:{},data:ee(Ae)},ie=qt(Ae);ie!==void 0&&(pe.attributes.color=ie),de!==void 0&&(pe.data.href=de),ye.push(pe)}return{nodes:Wt,edges:ye}},n.janus=function(et){const ht=[],lt=[];return o(typeof et=="string"?JSON.parse(et):et,ht,lt),{nodes:ht,edges:lt}},n.json=function(et,ht=lt=>lt){const lt=ht(JSON.parse(et)),rt=lt.nodes||[],nt=lt.edges||[];for(let Lt=0;Lt<rt.length;Lt++){const St=rt[Lt];St.attributes||(St.attributes={}),typeof St.size=="string"&&(St.size=+St.size),typeof St.x=="string"&&(St.x=+St.x),typeof St.y=="string"&&(St.y=+St.y),r(St,"x"),r(St,"y"),r(St,"size","radius"),r(St,"color"),r(St,"text")}for(let Lt=0;Lt<nt.length;Lt++){const St=nt[Lt];St.attributes||(St.attributes={}),typeof St.size=="string"&&(St.size=+St.size),r(St,"size","width"),r(St,"color"),r(St,"text")}return{nodes:rt,edges:nt}},n.mtx=$=>{const et=$.split(`
`).filter(rt=>!rt.startsWith("%")),[ht]=et[0].split(" ").map(Number),lt=et.slice(1).map(rt=>rt.split(" ").slice(0,2).map(Number)).filter(rt=>rt.length===2);return{nodes:Array.from({length:Number(ht)},(rt,nt)=>({id:nt})),edges:lt.map(([rt,nt])=>({source:rt%ht,target:nt%ht}))}},n.neo4j=function(et){let ht=typeof et=="string"?JSON.parse(et):et;const lt={nodes:[],edges:[]},rt=new Set,nt=new Set;return(Lt=>"queryKeys"in Lt&&"values"in Lt)(ht)&&(ht=function(St){const wt=[];return St.values.forEach(Wt=>{const{nodes:Ut=[],relationships:ye=[],segments:me=[]}=Wt.adapted,_e=[{segments:me,properties:{}}];wt.push({_fields:[...Ut,...ye,..._e]})}),{records:wt}}(ht)),ht.records.forEach(({_fields:Lt})=>Lt.forEach(St=>mt(lt,St,rt,nt))),lt},Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})},typeof t=="object"&&typeof e<"u"?i(t):typeof define=="function"&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaParsers={})}}),rv=xf({"node_modules/@linkurious/ogma-generators/dist/ogma-generators.umd.js"(t,e){var s,i;s=t,i=function(n){/**
* Ogma Generators
* @description Graphs Generators for Ogma
* @version 0.0.13 (built on Tue Nov 14 2023 10:49:46 GMT+0000 (Coordinated Universal Time))
* @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
* @license (c) Linkurious 2023. All rights reserved.
* @preserve
*/const r=Object.freeze(Object.defineProperty({__proto__:null,configure:({nodes:E=10,edges:A=10,texts:S=!1,scale:T=100}={})=>({nodes:E,edges:A,texts:S,scale:T}),generate:function({nodes:A,scale:S,texts:T,edges:L}){const I=[],R=[];for(let z=0;z<A;z++)I.push({id:z,attributes:{x:Math.random()*S,y:Math.random()*S,text:T?`Node ${z}`:void 0}});for(let z=0;z<L;z++)R.push({id:z,source:Math.random()*A|0,target:Math.random()*A|0,attributes:{text:T?`Edge ${z}`:void 0}});return{nodes:I,edges:R}}},Symbol.toStringTag,{value:"Module"})),o=Object.freeze(Object.defineProperty({__proto__:null,configure:({rows:E=4,columns:A=4,columnDistance:S=20,rowDistance:T=20,xmin:L=0,ymin:I=0}={})=>({rows:E,columns:A,columnDistance:S,rowDistance:T,xmin:L,ymin:I}),generate:function({rows:A,columns:S,columnDistance:T,rowDistance:L,xmin:I,ymin:R}){const z={nodes:[],edges:[]};let j=0;for(let C=0;C<A;++C)for(let w=0;w<S;++w){const H=C*S+w;z.nodes.push({id:H,attributes:{x:I+w*T,y:R+C*L}}),w!==S-1&&(z.edges.push({id:j,source:H,target:C*S+w+1}),j++),C!==A-1&&(z.edges.push({id:j,source:H,target:(C+1)*S+w}),j++)}return z}},Symbol.toStringTag,{value:"Module"})),a=Object.freeze(Object.defineProperty({__proto__:null,configure:({length:E=5,scale:A=100}={})=>({length:E,scale:A}),generate:function({length:A,scale:S}){const T={nodes:[],edges:[]};if(A<=0)return T;T.nodes.push({id:0,attributes:{x:Math.random()*S,y:Math.random()*S}});for(let L=1;L<A;++L)T.nodes.push({id:L,attributes:{x:Math.random()*S,y:Math.random()*S}}),T.edges.push({id:L-1,source:L-1,target:L});return T}},Symbol.toStringTag,{value:"Module"}));function l(E){return typeof E=="number"&&isFinite(E)?E:void 0}const d=Object.freeze(Object.defineProperty({__proto__:null,configure:function({children:A=2,height:S=3}={}){if(!function(L){return typeof L=="number"&&isFinite(L)&&L>0?L:void 0}(A))throw new TypeError('Invalid argument: "children" is not a positive number, was '+A);if(!function(L){return typeof L=="number"&&isFinite(L)&&L>=0?L:void 0}(S))throw new TypeError('Invalid argument: "height" is not a positive number, was '+S);return{children:A,height:S}},generate:function({children:A,height:S}){S+=1;const T=Math.pow(A,S),L=[],I=[];let R=1,z=0,j=0;for(let C=0;C<S;++C){const w=T/(R+1)/1.5;for(let H=0;H<R;++H){const K=z++;if(L.push({id:K,attributes:{x:(H+1)*w*10,y:20*C}}),C!==S-1)for(let it=0;it<A;++it)I.push({id:j,source:K,target:K*A+it+1}),j+=1}R*=A}return{nodes:L,edges:I}}},Symbol.toStringTag,{value:"Module"})),h=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:A=20,edges:S,p:T,scale:L=100}={}){if(!l(A)||A<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+A);if(S!==void 0&&T!==void 0)throw new TypeError("Invalid argument: choose between options.edges and options.p");return S===void 0&&T===void 0&&(T=.1),T===void 0&&(T=-1),S===void 0&&(S=-1),{nodes:A,p:T,edges:S,scale:L}},generate:function(A){const S={nodes:[],edges:[]},T=A.nodes,L=A.p,I=A.scale;if(L>=0){let R=0;for(let z=0;z<T;z++){S.nodes.push({id:z,attributes:{x:Math.random()*I,y:Math.random()*I}});for(let j=0;j<z;j++)Math.random()<L&&S.edges.push({id:R++,source:z,target:j})}}else{const R=[],z=A.edges;for(let C=0;C<T;C++){S.nodes.push({id:C,attributes:{x:100*Math.random(),y:100*Math.random()}});for(let w=C+1;w<T;w++)R.push({source:C,target:w})}let j=R.length-1;for(let C=0;C<z;C++){const w=R.splice(Math.floor(Math.random()*j),1)[0];w.id=C,S.edges.push(w),j--}}return S}},Symbol.toStringTag,{value:"Module"})),u=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:A=40,m0:S=5,m:T=1,scale:L=100}={}){if(!l(A)||A<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+A);if(!l(S)||S>=A)throw new TypeError(`Invalid argument: options.m0 is not a number < ${A}, was ${S}`);if(!l(S)||T>=S)throw new TypeError(`Invalid argument: options.m is not a number <= ${S}, was ${T}`);if(!l(L)||L<0)throw new TypeError("Invalid argument: options.scale is not a number or is less than 0");return{nodes:A,m0:S,m:T,scale:L}},generate:function({scale:A,nodes:S,m0:T,m:L}){const I={nodes:[],edges:[]},R={},z=[],j=A/10;let C=0;for(let w=0;w<T;w++)I.nodes.push({id:w,attributes:{x:Math.random()*j,y:Math.random()*j}}),z[w]=0;for(let w=0;w<T;w++)for(let H=w+1;H<T;H++){const K={id:C++,source:w,target:H};R[K.source+"-"+K.target]=K,I.edges.push(K),z[w]++,z[H]++}for(let w=T;w<S;w++){I.nodes.push({id:w,attributes:{x:Math.random()*A,y:Math.random()*A}}),z[w]=0;let H=0;for(let it=0;it<w;it++)H+=z[it];let K=0;for(let it=0;it<L;it++){const xt=Math.random();let at=0;for(let Tt=0;Tt<w;Tt++)if(!R[`${w}-${Tt}`]&&!R[`${Tt}-${w}`]&&(at=w===1?1:at+z[Tt]/H+K/(w-it),xt<=at)){K+=z[Tt]/H;const It={id:C++,source:w,target:Tt};R[`${It.source}-${It.target}`]=It,I.edges.push(It),z[w]++,z[Tt]++;break}}}return I}},Symbol.toStringTag,{value:"Module"})),c=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:A=50,width:S=100,height:T=100,x:L=0,y:I=0}={}){if(!isFinite(A)||A<1)throw new RangeError("Tree generator: number of nodes must be a positive integer");return{nodes:A,width:S,height:T,x:L,y:I}},generate:function({nodes:A,x:S,y:T,width:L,height:I}){const R=S-L/2,z=T-I/2;return{nodes:new Array(A).fill(0).map((j,C)=>({id:C,attributes:{x:R+Math.random()*L,y:z+Math.random()*I}})),edges:new Array(A-1).fill(0).map((j,C)=>({id:C,source:Math.floor(Math.sqrt(C)),target:C+1}))}}},Symbol.toStringTag,{value:"Module"})),g=5,m=10,_=10,f=2.7,p=.2;function x(E){return Math.pow(f,E)*m}function y(E){return g+x(E)/_}function b(E,A,S,T,L){if(S===0)return L;const I=x(S),R=y(S),z=R*p;let j=-Math.PI;const C=2*Math.PI/A,w=T.attributes.x||0,H=T.attributes.y||0;for(let K=0;K<A;++K){const it={id:L,attributes:{x:w+I*Math.cos(j),y:H+I*Math.sin(j),radius:R}},xt={id:L,source:T.id,target:L,attributes:{width:z}};E.nodes.push(it),E.edges.push(xt),L=b(E,A,S-1,it,L+1),j+=C}return L}const v=Object.freeze(Object.defineProperty({__proto__:null,configure:function({depth:A=3,breadth:S=3,nodes:T}){return T!==void 0?(S=5,A=Math.ceil(Math.log(T)/Math.log(5))):T=-1,{depth:A,breadth:S,nodes:T}},generate:function({depth:A,breadth:S,nodes:T}){const L={id:0,attributes:{x:0,y:0,radius:y(A+1)}},I={nodes:[L],edges:[]};return b(I,S,A,L,1),T!==void 0&&T>=0&&(I.nodes=I.nodes.slice(0,T),I.edges=I.edges.slice(0,Math.max(T-1,0))),I}},Symbol.toStringTag,{value:"Module"}));n.balancedTree=d,n.barabasiAlbert=u,n.erdosRenyi=h,n.flower=v,n.grid=o,n.path=a,n.random=r,n.randomTree=c,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})},typeof t=="object"&&typeof e<"u"?i(t):typeof define=="function"&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaGenerators={})}}),ve=class{constructor(t){this._ogma=t}},bu={};function vf(t,e,s,i,n,r){let o=0;for(let a=0;a<i;a++)for(let l=0;l<i;l++){const d=r[a],h=r[l];if(d!==h){const u=t[d][h]*n,c=1/(u*u);if(c){const g=e[d]-e[h],m=s[d]-s[h];o+=c*Math.pow(u-Math.sqrt(g*g+m*m),2)}}}return o}function Ef(t,e,s,i,n,r,o){let a=0;if(n===-1)return 0;for(let l=0;l<i;l++)for(let d=0;d<i;d++){const h=o[l],u=o[d];if(h!==u&&(h===n||u===n)){const c=t[h][u]*r,g=1/(c*c);if(g){const m=e[h]-e[u],_=s[h]-s[u];a+=g*Math.pow(c-Math.sqrt(m*m+_*_),2)}}}return a}function $d(t,e,s,i,n,r,o,a){o=o||0;let l=0,d=0;for(let h=0;h<i;h++)for(let u=0;u<i;u++){const c=a[h],g=a[u];if(c!==g){const m=t[c][g]*r,_=1/(m*m);if(_){const f=e[c]-e[g],p=s[c]-s[g],x=_*Math.pow(m-Math.sqrt(f*f+p*p),2);l+=x,c!==n&&g!==n||(d+=x)}}}return(1-o)*l+o*d}function qd(t,e,s,i,n,r,o,a,l){o=o||0;const d=e,h=s;(n=n===void 0?-1:n)===-1&&(o=0);const u=e[n],c=s[n];for(let g=0;g<i;g++){const m=a[g],_=l(t[n][g]),f=o/(_*_);if(_===0)continue;let p=0,x=0,y=0;const b=e[m],v=s[m];for(let A=0;A<i;A++){const S=a[A];if(S!==m){const T=t[m][S]*r,L=1/(T*T),I=e[S],R=s[S];if(L!==0){const z=b-I,j=v-R,C=z*z+j*j,w=C<1e-12?0:1/Math.sqrt(C);x+=(1-o)*L*(I+T*(b-I)*w),y+=(1-o)*L*(R+T*(v-R)*w)}p+=L}}const E=(1-o)*p+f;if(E!==0){const A=b-u,S=v-c;let T=A*A+S*S;T=T<1e-12?0:1/Math.sqrt(T);const L=_===0?0:f*(_*T);d[m]=(x+L*e[m])/E,h[m]=(y+L*s[m])/E}}return{x:d,y:h}}function ov(t,e,s,i,n,r,o,a){o=o||0;const l=e,d=s;let h;(n=n===void 0?-1:n)===-1&&(o=0);for(let u=0;u<i;u++){const c=a[u];let g=0,m=0,_=0;const f=e[c],p=s[c];for(let x=0;x<i;x++){const y=a[x];let b=0;if(y!==c){let v=0;const E=t[c][y]*r,A=1/(E*E);c!==n&&y!==n||(v=A);const S=(1-o)*A+o*v;if(g+=S,A!==0){const T=e[y],L=s[y],I=f-T,R=p-L,z=I*I+R*R;z>1e-6&&(b=1/Math.sqrt(z)),m+=S*(T+E*(f-T)*b),_+=S*(L+E*(p-L)*b)}}}h=g,h!==0&&(l[c]=m/h,d[c]=_/h)}return{x:l,y:d}}function vu(t=(n,r)=>n-r,e=[],s={},i=n=>n){let n=e.length;function r(a){for(;;){const l=2*a+1,d=l+1;let h=a;if(l<n&&t(e[l],e[h])<0&&(h=l),d<n&&t(e[d],e[h])<0&&(h=d),h===a)return a;const u=e[h];e[h]=e[a],e[a]=u,s[i(e[h])]=h,s[i(u)]=a,a=h}}return{get keys(){return s},get size(){return n},heapify:r,pop(){if(n<=0)return;if(n===1)return n--,e[0];const a=e[0];return e[0]=e[n-1],n--,r(0),a},decreaseKey(a,l){for(l!==void 0&&(e[a]=l,s[i(l)]=a);a>0;){const d=a-1>>1;if(!(t(e[d],e[a])>0))break;{const h=e[a];e[a]=e[d],e[d]=h,s[i(e[a])]=a,s[i(h)]=d,a=d}}return a},min:()=>e[0],remove(a){return this.decreaseKey(a,Number.NEGATIVE_INFINITY),this.pop()},push(a){n++;let l=n-1;for(e[l]=a;l>0;){const d=l-1>>1;if(!(t(e[d],e[l])>0))break;{const h=e[l];e[l]=e[d],e[d]=h,s[i(e[l])]=l,s[i(h)]=d,l=d}}return l},empty:()=>n<=0,toArray:()=>e.slice(0,n)}}function Eu({sources:t,targets:e,weights:s,source:i,target:n,undirected:r=!1,indexes:o,N:a}){if(!(a=o?o.length:a)||!isFinite(a)||a===0)throw new Error("Invalid number of nodes "+a);const l=new Float32Array(a),d=new Int32Array(a),h={},u=Number.POSITIVE_INFINITY;if(!s){s=[];for(let _=0;_<a;_++)s[_]=1}if(!o){o=new Uint32Array(a);for(let _=0;_<a;_++)o[_]=_+1}for(let _=0;_<a;_++)l[_]=u,d[_]=-1,h[o[_]]=_;l[h[i]]=0;let c=!1;for(let _=1;_<=a;_++){for(let f=0;f<s.length;f++){const p=t[f],x=e[f],y=h[p],b=h[x];if(y!==void 0&&b!==void 0){const v=s[f];let E=l[y]+v;l[y]!==u&&E<l[b]&&(l[b]=E,d[b]=p,c=!0),r&&(E=l[b]+v,l[b]!==u&&E<l[y]&&(l[y]=E,d[y]=x,c=!0))}}if(!c)break}if(c)for(let _=0;_<s.length;_++){const f=t[_],p=e[_],x=h[f],y=h[p];if(x!==void 0&&y!==void 0){const b=s[_];if(l[x]+b<l[y])return null}}let g=null,m=null;if(n!==void 0){const _=h[n];if(_!==void 0&&l[_]!==u){g=[];for(let f=n;f!==-1;f=d[h[f]])g.push(f);g=g.reverse(),m=l[_]}}return{distances:l,path:g,pathLength:m}}function Au(t,e,s,i,n,r,o){i=i||t.map((f,p)=>p+1);const a=i.length,l=new Float32Array(a),d=new Int32Array(a),h=new Uint32Array(a),u=Number.POSITIVE_INFINITY,c={};if(a===0)return{distances:l,path:null,pathLength:null};if(!n){n={};for(let f=0;f<a;f++)n[i[f]]=f}for(let f=0;f<a;f++)l[f]=u,d[f]=-1,h[f]=c[f]=f;const g=vu((f,p)=>l[f]-l[p],h,c);for(l[n[e]]=0,g.decreaseKey(c[n[e]]);g.size!==0;){const f=g.pop(),p=l[f],x=t[f];if(p===u)break;for(let y=0,b=x.nodes.length;y<b;y++){const v=x.nodes[y],E=r?1:o?o(i[f],v):x.weights?x.weights[y]:1,A=n[v];if(A===void 0)continue;const S=p+E;S<l[A]&&(l[A]=S,d[A]=f,g.decreaseKey(c[A]))}}let m=null,_=null;if(s!==void 0){const f=n[s];if(l[f]!==u){m=[];for(let p=f;p!==-1;p=d[p])m.push(i[p]);m.reverse(),_=l[s]}}return{distances:l,path:m,pathLength:_}}function Zd({sources:t,targets:e,weights:s,indexes:i,adjacency:n,undirected:r,ignoreWeights:o}){const a=Number.POSITIVE_INFINITY,l=i?i.length:n.length;if(!i){i=new Uint32Array(l);for(let _=0;_<l;_++)i[_]=_+1}const d=new Array(l),h={};for(let _=0;_<l;_++){d[_]=new Float32Array(l);for(let f=0;f<l;f++)d[_][f]=_===f?0:a;h[i[_]]=_}const u=l,c=s.length;t=t.slice(),e=e.slice(),s=s.slice();for(let _=0;_<l;_++)t[c+_]=u,e[c+_]=i[_],s[c+_]=0,o&&(s[_]=1);const g=Eu({sources:t,targets:e,weights:s,undirected:r,N:l+1,source:u});if(g===null)throw new Error("Graph has negative weight loops");const m=g.distances;for(let _=0;_<s.length;_++){const f=h[t[_]],p=h[e[_]];f!==void 0&&p!==void 0&&(s[_]=s[_]+m[f]-m[p])}t=t.slice(0,c),e=e.slice(0,c),s=s.slice(0,c);for(let _=0;_<l;_++){const f=i[_],{distances:p}=Au(n,f,void 0,i,h,!!o);for(let x=0;x<l;x++)d[_][x]=_===x?0:p[x]}return d}function Pr(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])>e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function av(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])<e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function es(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Jd(t){return Array.isArray(t)?t:[t]}function Af(t){const e=[];for(let s=0;s<t.length;++s){const i=t[s];if(Array.isArray(i))for(let n=0;n<i.length;++n)e.push(i[n]);else e.push(i)}return e}function lv(...t){if(t.length===0)return[];const e=t[0].constructor;let s=0;for(const r of t)s+=r.length;const i=new e(s);let n=0;for(const r of t){for(let o=0;o<r.length;o++)i[n+o]=r[o];n+=r.length}return i}function dv(t,e){const s=t.indexOf(e);return s!==-1&&(t.splice(s,1),!0)}function Sf(t,e){let s,i,n=0,r=t.length-1;for(;n<=r;)if(s=(n+r)/2|0,i=t[s],i<e)n=s+1;else{if(!(i>e))return s;r=s-1}return-1}Ao(bu,{CyclesFinder:()=>Hf,Quadtree:()=>zf,bellmanFord:()=>Eu,betweenness:()=>Xf,circlePack:()=>Pf,circleSpread:()=>Pv,constrainedStress:()=>$d,convexhull:()=>Mv,detectCyclesDirected:()=>Vf,detectCyclesUndirected:()=>pE,detectCyclesUndirectedDFS:()=>yE,dijkstra:()=>Au,distanceStress:()=>Ef,johnson:()=>Zd,kruskal:()=>Wf,largestEmptyCircle:()=>If,minDisk:()=>wu,minHeap:()=>vu,removeRadialOverlap:()=>Qd,stressMinimizationStep:()=>qd,stressMinimizationStepGeneral:()=>ov,weightedStress:()=>vf});var oo=(t,e)=>{const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=e[t[i]];return s},pi=11102230246251565e-32,ns=134217729,hv=(3+8*pi)*pi;function ed(t,e,s,i,n){let r,o,a,l,d=e[0],h=i[0],u=0,c=0;h>d==h>-d?(r=d,d=e[++u]):(r=h,h=i[++c]);let g=0;if(u<t&&c<s)for(h>d==h>-d?(o=d+r,a=r-(o-d),d=e[++u]):(o=h+r,a=r-(o-h),h=i[++c]),r=o,a!==0&&(n[g++]=a);u<t&&c<s;)h>d==h>-d?(o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u]):(o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c]),r=o,a!==0&&(n[g++]=a);for(;u<t;)o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u],r=o,a!==0&&(n[g++]=a);for(;c<s;)o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c],r=o,a!==0&&(n[g++]=a);return r===0&&g!==0||(n[g++]=r),g}function uv(t,e){let s=e[0];for(let i=1;i<t;i++)s+=e[i];return s}function So(t){return new Float64Array(t)}var cv=(3+16*pi)*pi,gv=(2+12*pi)*pi,mv=(9+64*pi)*pi*pi,Pn=So(4),Dc=So(8),Rc=So(12),Oc=So(16),gs=So(4);function _v(t,e,s,i,n,r,o){let a,l,d,h,u,c,g,m,_,f,p,x,y,b,v,E,A,S;const T=t-n,L=s-n,I=e-r,R=i-r;b=T*R,c=ns*T,g=c-(c-T),m=T-g,c=ns*R,_=c-(c-R),f=R-_,v=m*f-(b-g*_-m*_-g*f),E=I*L,c=ns*I,g=c-(c-I),m=I-g,c=ns*L,_=c-(c-L),f=L-_,A=m*f-(E-g*_-m*_-g*f),p=v-A,u=v-p,Pn[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,Pn[1]=y-(p+u)+(u-E),S=x+p,u=S-x,Pn[2]=x-(S-u)+(p-u),Pn[3]=S;let z=uv(4,Pn),j=gv*o;if(z>=j||-z>=j||(u=t-T,a=t-(T+u)+(u-n),u=s-L,d=s-(L+u)+(u-n),u=e-I,l=e-(I+u)+(u-r),u=i-R,h=i-(R+u)+(u-r),a===0&&l===0&&d===0&&h===0)||(j=mv*o+hv*Math.abs(z),z+=T*h+R*a-(I*d+L*l),z>=j||-z>=j))return z;b=a*R,c=ns*a,g=c-(c-a),m=a-g,c=ns*R,_=c-(c-R),f=R-_,v=m*f-(b-g*_-m*_-g*f),E=l*L,c=ns*l,g=c-(c-l),m=l-g,c=ns*L,_=c-(c-L),f=L-_,A=m*f-(E-g*_-m*_-g*f),p=v-A,u=v-p,gs[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,gs[1]=y-(p+u)+(u-E),S=x+p,u=S-x,gs[2]=x-(S-u)+(p-u),gs[3]=S;const C=ed(4,Pn,4,gs,Dc);b=T*h,c=ns*T,g=c-(c-T),m=T-g,c=ns*h,_=c-(c-h),f=h-_,v=m*f-(b-g*_-m*_-g*f),E=I*d,c=ns*I,g=c-(c-I),m=I-g,c=ns*d,_=c-(c-d),f=d-_,A=m*f-(E-g*_-m*_-g*f),p=v-A,u=v-p,gs[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,gs[1]=y-(p+u)+(u-E),S=x+p,u=S-x,gs[2]=x-(S-u)+(p-u),gs[3]=S;const w=ed(C,Dc,4,gs,Rc);b=a*h,c=ns*a,g=c-(c-a),m=a-g,c=ns*h,_=c-(c-h),f=h-_,v=m*f-(b-g*_-m*_-g*f),E=l*d,c=ns*l,g=c-(c-l),m=l-g,c=ns*d,_=c-(c-d),f=d-_,A=m*f-(E-g*_-m*_-g*f),p=v-A,u=v-p,gs[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,gs[1]=y-(p+u)+(u-E),S=x+p,u=S-x,gs[2]=x-(S-u)+(p-u),gs[3]=S;const H=ed(w,Rc,4,gs,Oc);return Oc[H-1]}function Ro(t,e,s,i,n,r){const o=(e-r)*(s-n),a=(t-n)*(i-r),l=o-a,d=Math.abs(o+a);return Math.abs(l)>=cv*d?l:-_v(t,e,s,i,n,r,d)}var zc=Math.pow(2,-52),Oo=new Uint32Array(512),wf=class Tf{static from(e,s=bv,i=vv){const n=e.length,r=new Float64Array(2*n);for(let o=0;o<n;o++){const a=e[o];r[2*o]=s(a),r[2*o+1]=i(a)}return new Tf(r)}constructor(e){const s=e.length>>1;if(s>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*s-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(s)),this._hullPrev=new Uint32Array(s),this._hullNext=new Uint32Array(s),this._hullTri=new Uint32Array(s),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(s),this._dists=new Float64Array(s),this.update()}update(){const{coords:e,_hullPrev:s,_hullNext:i,_hullTri:n,_hullHash:r}=this,o=e.length>>1;let a=1/0,l=1/0,d=-1/0,h=-1/0;for(let T=0;T<o;T++){const L=e[2*T],I=e[2*T+1];L<a&&(a=L),I<l&&(l=I),L>d&&(d=L),I>h&&(h=I),this._ids[T]=T}const u=(a+d)/2,c=(l+h)/2;let g,m,_;for(let T=0,L=1/0;T<o;T++){const I=sd(u,c,e[2*T],e[2*T+1]);I<L&&(g=T,L=I)}const f=e[2*g],p=e[2*g+1];for(let T=0,L=1/0;T<o;T++){if(T===g)continue;const I=sd(f,p,e[2*T],e[2*T+1]);I<L&&I>0&&(m=T,L=I)}let x=e[2*m],y=e[2*m+1],b=1/0;for(let T=0;T<o;T++){if(T===g||T===m)continue;const L=yv(f,p,x,y,e[2*T],e[2*T+1]);L<b&&(_=T,b=L)}let v=e[2*_],E=e[2*_+1];if(b===1/0){for(let I=0;I<o;I++)this._dists[I]=e[2*I]-e[0]||e[2*I+1]-e[1];Vn(this._ids,this._dists,0,o-1);const T=new Uint32Array(o);let L=0;for(let I=0,R=-1/0;I<o;I++){const z=this._ids[I],j=this._dists[z];j>R&&(T[L++]=z,R=j)}return this.hull=T.subarray(0,L),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Ro(f,p,x,y,v,E)<0){const T=m,L=x,I=y;m=_,x=v,y=E,_=T,v=L,E=I}const A=xv(f,p,x,y,v,E);this._cx=A.x,this._cy=A.y;for(let T=0;T<o;T++)this._dists[T]=sd(e[2*T],e[2*T+1],A.x,A.y);Vn(this._ids,this._dists,0,o-1),this._hullStart=g;let S=3;i[g]=s[_]=m,i[m]=s[g]=_,i[_]=s[m]=g,n[g]=0,n[m]=1,n[_]=2,r.fill(-1),r[this._hashKey(f,p)]=g,r[this._hashKey(x,y)]=m,r[this._hashKey(v,E)]=_,this.trianglesLen=0,this._addTriangle(g,m,_,-1,-1,-1);for(let T,L,I=0;I<this._ids.length;I++){const R=this._ids[I],z=e[2*R],j=e[2*R+1];if(I>0&&Math.abs(z-T)<=zc&&Math.abs(j-L)<=zc||(T=z,L=j,R===g||R===m||R===_))continue;let C=0;for(let xt=0,at=this._hashKey(z,j);xt<this._hashSize&&(C=r[(at+xt)%this._hashSize],C===-1||C===i[C]);xt++);C=s[C];let w,H=C;for(;w=i[H],Ro(z,j,e[2*H],e[2*H+1],e[2*w],e[2*w+1])>=0;)if(H=w,H===C){H=-1;break}if(H===-1)continue;let K=this._addTriangle(H,R,i[H],-1,-1,n[H]);n[R]=this._legalize(K+2),n[H]=K,S++;let it=i[H];for(;w=i[it],Ro(z,j,e[2*it],e[2*it+1],e[2*w],e[2*w+1])<0;)K=this._addTriangle(it,R,w,n[R],-1,n[it]),n[R]=this._legalize(K+2),i[it]=it,S--,it=w;if(H===C)for(;w=s[H],Ro(z,j,e[2*w],e[2*w+1],e[2*H],e[2*H+1])<0;)K=this._addTriangle(w,R,H,-1,n[H],n[w]),this._legalize(K+2),n[w]=K,i[H]=H,S--,H=w;this._hullStart=s[R]=H,i[H]=s[it]=R,i[R]=it,r[this._hashKey(z,j)]=R,r[this._hashKey(e[2*H],e[2*H+1])]=H}this.hull=new Uint32Array(S);for(let T=0,L=this._hullStart;T<S;T++)this.hull[T]=L,L=i[L];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,s){return Math.floor(fv(e-this._cx,s-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:s,_halfedges:i,coords:n}=this;let r=0,o=0;for(;;){const a=i[e],l=e-e%3;if(o=l+(e+2)%3,a===-1){if(r===0)break;e=Oo[--r];continue}const d=a-a%3,h=l+(e+1)%3,u=d+(a+2)%3,c=s[o],g=s[e],m=s[h],_=s[u];if(pv(n[2*c],n[2*c+1],n[2*g],n[2*g+1],n[2*m],n[2*m+1],n[2*_],n[2*_+1])){s[e]=_,s[a]=c;const f=i[u];if(f===-1){let x=this._hullStart;do{if(this._hullTri[x]===u){this._hullTri[x]=e;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(e,f),this._link(a,i[o]),this._link(o,u);const p=d+(a+1)%3;r<Oo.length&&(Oo[r++]=p)}else{if(r===0)break;e=Oo[--r]}}return o}_link(e,s){this._halfedges[e]=s,s!==-1&&(this._halfedges[s]=e)}_addTriangle(e,s,i,n,r,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=s,this._triangles[a+2]=i,this._link(a,n),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}};function fv(t,e){const s=t/(Math.abs(t)+Math.abs(e));return(e>0?3-s:1+s)/4}function sd(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function pv(t,e,s,i,n,r,o,a){const l=t-o,d=e-a,h=s-o,u=i-a,c=n-o,g=r-a,m=h*h+u*u,_=c*c+g*g;return l*(u*_-m*g)-d*(h*_-m*c)+(l*l+d*d)*(h*g-u*c)<0}function yv(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l),g=(d*h-a*u)*c,m=(o*u-l*h)*c;return g*g+m*m}function xv(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l);return{x:t+(d*h-a*u)*c,y:e+(o*u-l*h)*c}}function Vn(t,e,s,i){if(i-s<=20)for(let n=s+1;n<=i;n++){const r=t[n],o=e[r];let a=n-1;for(;a>=s&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let n=s+1,r=i;yr(t,s+i>>1,n),e[t[s]]>e[t[i]]&&yr(t,s,i),e[t[n]]>e[t[i]]&&yr(t,n,i),e[t[s]]>e[t[n]]&&yr(t,s,n);const o=t[n],a=e[o];for(;;){do n++;while(e[t[n]]<a);do r--;while(e[t[r]]>a);if(r<n)break;yr(t,n,r)}t[s+1]=t[r],t[r]=o,i-n+1>=r-s?(Vn(t,e,n,i),Vn(t,e,s,r-1)):(Vn(t,e,s,r-1),Vn(t,e,n,i))}}function yr(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function bv(t){return t[0]}function vv(t){return t[1]}function If(t,e=1,s=0,i,n){if(!i||!n){const u=t.map(g=>[g.x,g.y]),c=wf.from(u,g=>g[0],g=>g[1]);i=oo(c.triangles,u),n=oo(c.hull,u)}if(!n)return[];const r=s*s,o=[],a={};for(let u=0;u<i.length;u+=3)if(Ev(n,Su(i[u],i[u+1],i[u+2]))){const c=Sv(i[u],i[u+1],i[u+2]);c>r&&(o.push(u),a[u]=c)}if(o.length===0)return[];o.sort((u,c)=>a[u]-a[c]);let l=o[0],d=a[l];const h=[];for(let u=0;u<o.length;u++){const c=o[u],g=a[c];g>d&&g>r&&(l=c,d=g,h.push(l),h.length>e&&h.shift())}return h.map(u=>Av(i[u],i[u+1],i[u+2]))}function Ev(t,e){const s=t.length,i=t[s-1],[n,r]=e;let[o,a]=i,l=!1;for(let d=0;d<s;d++){const h=t[d],[u,c]=h;c>r!=a>r&&n<(o-u)*(r-c)/(a-c)+u&&(l=!l),o=u,a=c}return l}function Av(t,e,s){const i=Su(t,e,s);let n=0;for(let r=0;r<3;r++){const o=arguments[r],a=o[0]-i[0],l=o[1]-i[1],d=Math.sqrt(a*a+l*l);d>n&&(n=d)}return[i[0],i[1],n]}function Sv(t,e,s){const[i,n]=Su(t,e,s),[r,o]=t,a=i-r,l=n-o;return a*a+l*l}function Su(t,e,s){const i=[(t[0]+e[0])/2,(t[1]+e[1])/2],n=[(e[0]+s[0])/2,(e[1]+s[1])/2],r=-1/((e[1]-t[1])/(e[0]-t[0])),o=-1/((s[1]-e[1])/(s[0]-e[0])),a=i[1]-r*i[0],l=(a-(n[1]-o*n[0]))/(o-r);return[l,r*l+a]}function wu(t,e,s,i){let n;if(i)n=i;else{n=new Uint32Array(t.length);for(let y=0,b=t.length;y<b;y++)n[y]=y}let r=t[n[0]],o=r,a=e[n[0]],l=a;for(let y=1;y<n.length;y++){const b=n[y],v=t[b],E=e[b];v<r&&(r=v),v>o&&(o=v),E<a&&(a=E),E>l&&(l=E)}const d=(r+o)/2,h=(a+l)/2;for(let y=0;y<n.length;y++){const b=n[y];t[b]-=d,e[b]-=h}function u(y,b,v,E,A,S){const T=v-S+1e-9*Math.max(v,S,1),L=E-y,I=A-b;return T>0&&T*T>L*L+I*I}function c(y,b,v,E,A,S,T){for(let L=0;L<E.length;++L){const I=E[L];if(!u(y,b,v,A[I],S[I],T[I]))return!1}return!0}function g(y,b,v,E,A,S){const T=E-y,L=A-b,I=S-v,R=Math.sqrt(T*T+L*L);return[(y+E+T/R*I)/2,(b+A+L/R*I)/2,(R+v+S)/2]}function m(y,b,v,E,A,S,T,L,I){const R=(y+E+T)/3,z=(b+A+L)/3,j=y-R,C=b-z,w=E-R,H=A-z,K=T-R,it=L-z,xt=j-w,at=j-K,Tt=C-H,It=C-it,dt=S-v,bt=I-v,Ht=j*j+C*C-v*v,Qt=Ht-w*w-H*H+S*S,Xt=Ht-K*K-it*it+I*I,mt=at*Tt-xt*It,ft=(Tt*Xt-It*Qt)/(2*mt)-j,te=(It*dt-Tt*bt)/mt,qt=(at*Qt-xt*Xt)/(2*mt)-C,se=(xt*bt-at*dt)/mt,ee=te*te+se*se-1,$=2*(v+ft*te+qt*se),et=ft*ft+qt*qt-v*v,ht=-(Math.abs(ee)>1e-6?($+Math.sqrt($*$-4*ee*et))/(2*ee):et/$);return[R+j+ft+te*ht,z+C+qt+se*ht,ht]}function _(y,b,v,E){switch(y.length){case 1:const A=y[0];return function(j,C,w){return[j,C,w]}(b[A],v[A],E[A]);case 2:const[S,T]=y;return g(b[S],v[S],E[S],b[T],v[T],E[T]);case 3:const[L,I,R]=y;return m(b[L],v[L],E[L],b[I],v[I],E[I],b[R],v[R],E[R]);default:return null}}function f(y,b,v,E,A,S){const T=v-S,L=E-y,I=A-b;return T<0||T*T<L*L+I*I}function p(y,b,v,E,A){const S=v[b],T=E[b],L=A[b];if(c(S,T,L,y,v,E,A))return[b];for(let I=0;I<y.length;++I){const R=y[I],z=v[R],j=E[R],C=A[R];if(f(S,T,L,z,j,C)){const[w,H,K]=g(z,j,C,S,T,L);if(c(w,H,K,y,v,E,A))return[y[I],b]}}for(let I=0;I<y.length-1;++I)for(let R=I+1;R<y.length;++R){const z=y[I],j=y[R],C=v[z],w=E[z],H=A[z],K=v[j],it=E[j],xt=A[j],at=g(C,w,H,K,it,xt);if(f(at[0],at[1],at[2],S,T,L)){const Tt=g(C,w,H,S,T,L);if(f(Tt[0],Tt[1],Tt[2],K,it,xt)){const It=g(K,it,xt,S,T,L);if(f(It[0],It[1],It[2],C,w,H)){const dt=m(C,w,H,K,it,xt,S,T,L);if(c(dt[0],dt[1],dt[2],y,v,E,A))return[z,j,b]}}}}throw new Error}n=function(b){for(let v=b.length-1;v>=0;v--){let E=Math.floor(Math.random()*(v+1));E=Math.max(Math.min(E,v),0);const A=b[v];b[v]=b[E],b[E]=A}return b}(n),s=s||new Array(t.length).fill(0);const x=function(b,v,E,A,S){let T=null,L=[],I=0;for(;I<v;){const R=b[I];T&&u(T[0],T[1],T[2],E[R],A[R],S[R])?I++:(L=p(L,R,E,A,S),T=_(L,E,A,S),I=0)}return T}(n,n.length,t,e,s);x[0]+=d,x[1]+=h;for(let y=0;y<n.length;y++){const b=n[y];t[b]+=d,e[b]+=h}return x}var Lf=[1/0,1/0,-1/0,-1/0];function Xa(t,e,s,i,n,r={x:0,y:0}){const o=Math.cos(n),a=Math.sin(n),l=t-s,d=e-i;return r.x=o*l-a*d+s,r.y=a*l+o*d+i,r}function wv(t,e,s=0,i={x:0,y:0}){return i.x=t.x+s*Math.sin(e),i.y=t.y+s*Math.cos(e),i}var je=(t,e,s,i)=>Math.hypot(t-s,e-i);function Da(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function Cf(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=e,t.y/=e,t}function Kd(t){return 180*t/Math.PI}function Tv(t){return t*Math.PI/180}function Mf(t,e){return t.minX-=e,t.minY-=e,t.maxX+=e,t.maxY+=e,t.width===void 0&&(t.width=t.maxX-t.minX),t.height===void 0&&(t.height=t.maxY-t.minY),t.width+=2*e,t.height+=2*e,t}function Tu(t,e,s,i,n,r){const o=i-t,a=n-e,l=Math.sqrt(o*o+a*a);if(l>s+r||l<Math.abs(s-r))return null;const d=(s*s-r*r+l*l)/(2*l),h=t+o*d/l,u=e+a*d/l,c=Math.sqrt(s*s-d*d),g=c/l*-a,m=o*(c/l);return[[h+g,u+m],[h-g,u-m]]}function Iu(t,e,s,i,n,r){if(t-n>=0&&s-n<0)return 1;if(t-n<0&&s-n>=0)return-1;if(t-n==0&&s-n==0)return e-i>=0||i-r>=0?e-i:i-e;const o=(t-n)*(i-r)-(s-n)*(e-r);return o<0?1:o>0?-1:(t-n)*(t-n)+(e-r)*(e-r)-((s-n)*(s-n)+(i-r)*(i-r))}function Iv([t,e,s],i,n){const r=Math.abs(t-i),o=Math.abs(e-n);return r+o<=s||!(r>s||o>s)&&Math.sqrt(r*r+o*o)<s+1e-12}function Lv(t,e,s,i){const n=t[0]-e,r=t[1]-s,o=t[2]-i;return n*n+r*r<o*o+1e-6}function Lu(t,e,s,i,n,r,o){const a=t-Math.max(i,Math.min(r,t)),l=e-Math.max(n,Math.min(o,e));return a*a+l*l<s*s}function Nf(t,e,s,i,n,r,o,a={x:0,y:0}){const l=a||{x:0,y:0};let d,h,u,c;if(s===t){const p=t-n,x=o*o-p*p;if(x<0)return null;const y=Math.sqrt(x);d=t,u=t,h=r+y,c=r-y}else{const p=(i-e)/(s-t),x=e-p*t,y=x-r,b=p*p+1,v=2*(p*y-n),E=v*v-4*b*(n*n+y*y-o*o);if(E<0)return null;const A=-v,S=Math.sqrt(E),T=2*b;d=(A+S)/T,u=(A-S)/T,h=p*d+x,c=p*u+x}const g=t-d,m=e-h,_=t-u,f=e-c;return g*g+m*m<_*_+f*f?(l.x=d,l.y=h):(l.x=u,l.y=c),l}function Qd({X:t,Y:e,sizes:s,indexes:i,R:n,center:r,gap:o=0,epsilon:a=.001,maxLoops:l=5,inPlace:d=!0}){const h=i.length,u=r[0],c=r[1];let g=h;d||(t=t.slice(),e=e.slice());const m=Tu,_=Iu,f=i.slice().sort((L,I)=>_(t[L],e[L],t[I],e[I],u,c)),p=f[h-1],x=t[p],y=e[p];let b=!1;for(let L=0;L<g-1;L++){let I=L%h,R=(L+1)%h;L===-1&&(I=h-1,R=0),I=f[I],R=f[R];const z=t[I],j=e[I];let C=t[R],w=e[R];const H=s[I]+s[R]+o;let K=_(z,j,C,w,u,c);if(K===-1&&b&&(K=1),!(H>n)){if(K===1||H-je(z,j,C,w)>a){const it=m(u,c,n,z,j,H);if(it){const xt=it[0];b=C>u&&xt[0]<u,C=t[R]=xt[0],w=e[R]=xt[1]}}else b=!1;if(L%h==h-2){const it=f[h-1],xt=f[0];if(e[it]>c&&e[xt]>c&&t[it]-s[it]<t[xt]+s[it]){let at=0;for(g=Math.min(h*l,g+h);e[f[it]]>c&&e[f[0]]>c&&t[f[it]]<t[f[0]]&&++at<h;){const Tt=f.pop();Tt&&f.unshift(Tt)}}}}}const v=x-u,E=y-c,A=t[p]-u,S=e[p]-c,T=v===A?0:Math.abs(Math.acos((v*A+E*S)/(Math.sqrt(v*v+E*E)*Math.sqrt(A*A+S*S))));if(T!==0){const L=Math.sin(-T),I=Math.cos(-T);let R;for(let z=0;z<h;z++){R=f[z];const j=t[R]-u,C=e[R]-c;t[R]=j*I-C*L+u,e[R]=j*L+C*I+c}}return{X:t,Y:e}}function Bc(t,e,s,i,n,r){const o={},a=s[t];let l=a,d=0;const h=a*n;for(const u in e){const c=e[u];let g=0,m=0;for(let x=0,y=c.length;x<y;x++){const b=s[c[x]];m=Math.max(m,b),g+=2*b+i}const _=g/(2*Math.PI),f=m+l,p=r?d+Math.max(r,f):d*n;d=Math.max(f,d,_,h,p),o[u]=d,l=m}return o[0]=0,o[Number.POSITIVE_INFINITY]=d,o}function Cv(t,e,s){return(e[0]-t[0])*(s[1]-t[1])-(e[1]-t[1])*(s[0]-t[0])}function Uc(t){const e=t.length,s=[0,1];let i=2;for(let n=2;n<e;n++){for(;i>1&&Cv(t[s[i-2]],t[s[i-1]],t[n])<=0;)--i;s[i++]=n}return s.slice(0,i)}function Mv(t){const e=t.length;if(e<3)return null;const s=new Array(e),i=new Array(e);for(let u=0;u<e;u++)s[u]=[+t[u][0],+t[u][1],u];s.sort((u,c)=>u[0]-c[0]||u[1]-c[1]);for(let u=0;u<e;u++)i[u]=[s[u][0],-s[u][1]];const n=Uc(s),r=Uc(i),o=r[r.length-1],a=n[n.length-1],l=r[0]===n[0],d=o===a?1:0,h=[];for(let u=n.length-1;u>=0;--u)h.push(t[s[n[u]][2]]);for(let u=+l;u<r.length-d;u++)h.push(t[s[r[u]][2]]);return h}var Gc=t=>--t*t*t+1,Vc=(t,e,s)=>{const i=t-s[0],n=e-s[1];return i*i+n*n},Nv=(t,e)=>{let s=1/0,i=-1/0;for(let n=0;n<t.length;n++){const r=t[n],o=e?e[r]:r;s=Math.min(o,s),i=Math.max(o,i)}return{min:s,max:i}};function Pv({X:t,Y:e,R:s,center:i,maxSteps:n=1e3,padding:r=5,epsilon:o=1e-9,damping:a=2,pinned:l=-1,indexes:d,onUpdate:h,pushSmallerOut:u=!0}){const c=d?d.length:t.length;let g=d;if(g===void 0){g=new Uint32Array(c);for(let b=0;b<c;b++)g[b]=b}else g=d;if(l!==-1)i=[t[l],e[l]];else if(!i){let b=0,v=0;for(let E=0;E<c;E++)b+=t[g[E]],v+=e[g[E]];i=[b/c,v/c]}const{min:m,max:_}=Nv(g,s);function f(b,v){let E=0;for(let L=0;L<c-1;L++)for(let I=L+1;I<c;I++){if(L===I)continue;const R=g[L],z=g[I],j=t[R],C=e[R],w=s[R],H=t[z],K=e[z],it=s[z],xt=H-j,at=K-C,Tt=w+it+r,It=xt*xt+at*at;if(It<Tt*Tt-b){const dt=(Tt-Math.sqrt(It))*v,bt=1/It,Ht=xt*bt*dt,Qt=at*bt*dt,Xt=Ht*Ht+Qt*Qt;if(z!==l){const mt=w/m;E+=Xt*mt,t[z]+=Ht*mt,e[z]+=Qt*mt}if(R!==l){const mt=it/m;E+=Xt*mt,t[R]-=Ht*mt,e[R]-=Qt*mt}}}const A=b*a*(1-v),S=i[0],T=i[1];for(let L=0;L<c;L++){const I=g[L];if(I!==l){const R=t[I],z=e[I],j=s[I],C=u?A*(j/_):A,w=(R-S)*C,H=(z-T)*C;E+=w*w+H*H,t[I]-=w,e[I]-=H}}return E}g.sort((b,v)=>s[v]*Vc(t[v],e[v],i)-s[b]*Vc(t[b],e[b],i));let p=0,x=0;const y=Gc(1/c);for(let b=0;b<n&&(p=f(y,Gc((b+1)/n)),h&&setTimeout(()=>h(t,e)),!(Math.abs(p-x)<o));b++)x=p;return{X:t,Y:e}}var zo=t=>({data:t,next:null,prev:null});function Pf(t,e=0,s=0){const i=t.length;if(i===0)return t;const n=t[0];if(n.x=e,n.y=s,i===1)return t;const r=t[1];if(n.x=e-r.radius,r.x=e+n.radius,r.y=s,i===2)return t;const o=t[2];jc(r,n,o);let a=zo(n),l=zo(r),d=zo(o);a.next=d.prev=l,l.next=a.prev=d,d.next=l.prev=a;t:for(let h=3;h<i;h++){d=zo(t[h]),jc(a.data,l.data,t[h]);let u=l.next,c=a.prev,g=l.data.radius,m=a.data.radius;do if(g<=m){if(Hc(u.data,d.data)){l=u,a.next=l,l.prev=a,--h;continue t}g+=u.data.radius,u=u.next}else{if(Hc(c.data,d.data)){a=c,a.next=l,l.prev=a,--h;continue t}m+=c.data.radius,c=c.prev}while(u!==c.next);d.prev=a,d.next=l,a.next=l.prev=l=d;let _=Wc(a);for(;(d=d.next)!==l;){const f=Wc(d);f<_&&(a=d,_=f)}l=a.next}return t}function jc(t,e,s){const i=t.x-e.x;let n,r;const o=t.y-e.y,a=i*i+o*o;let l,d;a?(r=e.radius+s.radius,r*=r,d=t.radius+s.radius,d*=d,r>d?(n=(a+d-r)/(2*a),l=Math.sqrt(Math.max(0,d/a-n*n)),s.x=t.x-n*i-l*o,s.y=t.y-n*o+l*i):(n=(a+r-d)/(2*a),l=Math.sqrt(Math.max(0,r/a-n*n)),s.x=e.x+n*i-l*o,s.y=e.y+n*o+l*i)):(s.x=e.x+s.radius,s.y=e.y)}var Fv=1e-6;function Hc(t,e){const s=t.radius+e.radius-Fv,i=e.x-t.x,n=e.y-t.y;return s>0&&s*s>i*i+n*n}function Wc(t){const e=t.data,s=t.next.data,i=e.radius+s.radius,n=(e.x*s.radius+s.x*e.radius)/i,r=(e.y*s.radius+s.y*e.radius)/i;return n*n+r*r}var kv=16,Dv=class{constructor(t=Int32Array,e=kv,s=8){this._BIG_LIST=new Uint8Array([-1])[0],this._ArrayType=t,this._capacity=e,this._MAX_LIST_SIZE=s,this._freeIndex=-1,this.clear()}clear(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._idToIndex={},this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){let e;return this._freeIndex===-1?e=this._nextIndex++:(e=this._freeIndex,this._freeIndex=-1),this._idToIndex[t]=e,e>=this._capacity&&this._expand(e+1),this._sizes[e]=0,e}getItems(t){const e=this._idToIndex[t];if(e===void 0)return;const s=this._sizes[e],i=this._MAX_LIST_SIZE*e;if(s<=this._MAX_LIST_SIZE){this._constList.length=s;for(let n=0,r=s;n<r;++n)this._constList[n]=this._buffer[i+n];return this._constList}if(s===this._BIG_LIST){let n=this._buffer[i];return this._bigLists[n]}}removeEntry(t){const e=this._idToIndex[t];if(this._sizes[e]===this._BIG_LIST){const s=this._MAX_LIST_SIZE*e,i=this._buffer[s];this._bigLists[i].length=0}this._sizes[e]=0,this._freeIndex=e}size(t){const e=this._idToIndex[t];let s=this._sizes[e];return s<=this._MAX_LIST_SIZE?s:this._bigLists[this._buffer[e*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=this._idToIndex[t[a]],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._idToIndex[t],i=this._sizes[s],n=s*this._MAX_LIST_SIZE;if(i<this._MAX_LIST_SIZE)this._buffer[n+i]=e,this._sizes[s]=i+1;else if(i===this._BIG_LIST){let r=this._buffer[n];this._bigLists[r].push(e)}else{let r=new Array(this._MAX_LIST_SIZE);for(let o=0;o<this._MAX_LIST_SIZE;++o)r[o]=this._buffer[n+o];r.push(e),this._bigLists.push(r),this._sizes[s]=this._BIG_LIST,this._buffer[n]=this._bigLists.length-1}}removeFrom(t,e){this.removeFromAndGetSize(t,e)}removeFromAndGetSize(t,e){const s=this._idToIndex[t];let i=this._sizes[s],n=this._MAX_LIST_SIZE*s;if(i<=this._MAX_LIST_SIZE){for(let r=n,o=n+i;r<o;++r)if(this._buffer[r]===e)return i-=1,this._buffer[r]=this._buffer[o-1],this._sizes[s]=i,i}else if(i===this._BIG_LIST){let r=this._buffer[n],o=this._bigLists[r],a=o.indexOf(e);if(a!==-1)return o.splice(a,1),o.length}}reserve(t){this._capacity<t&&this._expand(t)}_expand(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=Xc(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=Xc(this._sizes,this._capacity)}has(t){const e=this._idToIndex[t];return!(e===void 0||e>=this._capacity)&&this._sizes[e]!==0}get averageSize(){let t=0;for(let e=0;e<this._capacity;e++)t+=this._sizes[e];return t/this._capacity}};function Xc(t,e){let s=new t.constructor(e);return s.set(t),s}var xr,Yc,br,Fn,vr,on=[0,1],Ra=[0,2];for(br=4;br<65535;br<<=2)for(xr=0,Yc=on.length;xr<Yc;xr++)on.push(on[xr]|br),Ra.push((on[xr]|br)<<1);function Hs(t,e){return(Ra[255&e]|on[255&t])+65536*(Ra[e>>8&255]|on[t>>8&255])+4294967296*(Ra[e>>16&255]|on[t>>16&255])}function $c(t,e=[0,0]){if(t>0xffffffffffff)throw"Only morton codes up to 48 bits are supported.";if(!Fn){Fn={},vr={};for(var s=0;s<256;s++)Fn[Hs(s,0)]=s,vr[Hs(0,s)]=s}var i=Fn[21845&t],n=vr[43690&t];return t>65535&&(i|=Fn[21845&(t/=65536)]<<8,n|=vr[43690&t]<<8,t>65535&&(i|=Fn[21845&(t/=65536)]<<16,n|=vr[43690&t]<<16)),e[0]=i,e[1]=n,e}Hs.code=function(e,s,i){if(e>24)throw"Morton codes are only supported up to Z=24";var n=1<<24-e;return Hs(s*n,i*n)},Hs.range=function(e,s,i){if(e>24)throw"Morton ranges are only supported up to Z=24";var n=1<<24-e,r=Hs(s*n,i*n);return[r,r+n*n-1]},Hs.reverse=$c,Hs.decode=function(e,s){var i=$c(s),n=1<<24-e;return[i[0]/n,i[1]/n]},Hs.min=function(e,s){var i=1431655765&e,n=1431655765&s,r=2863311530&e,o=2863311530&s;return Math.min(i,n)+Math.min(r,o)};var Rv=1e-6,Ov=1e-12;function Ff(){for(var t=arguments,e=t.length-1,s=e,i=[],n=0;n<=e&&Math.abs(t[n])<=Ov;n++)e--;switch(e){case 1:zv(t[s],t[s-1],i);break;case 2:Bv(t[s],t[s-1],t[s-2],i);break;case 3:Uv(t[s],t[s-1],t[s-2],t[s-3],i)}return i}function zv(t,e,s=[]){return e!==0&&s.push(-t/e),s}function Bv(t,e,s,i=[]){var n=e/s,r=n*n-4*(t/s);if(r>0){var o=Math.sqrt(r);i.push(.5*(-n+o)),i.push(.5*(-n-o))}else r===0&&i.push(.5*-n);return i}function Uv(t,e,s,i,n=[]){var r,o,a=s/i,l=e/i,d=(3*l-a*a)/3,h=(2*a*a*a-9*l*a+27*(t/i))/27,u=a/3,c=h*h/4+d*d*d/27,g=h/2;if(Math.abs(c)<=Rv&&(c=0),c>0){var m=Math.sqrt(c);o=(r=-g+m)>=0?Math.pow(r,1/3):-Math.pow(-r,1/3),(r=-g-m)>=0?o+=Math.pow(r,1/3):o-=Math.pow(-r,1/3),n.push(o-u)}else if(c<0){var _=Math.sqrt(-d/3),f=Math.atan2(Math.sqrt(-c),-g)/3,p=Math.cos(f),x=Math.sin(f),y=Math.sqrt(3);n.push(2*_*p-u),n.push(-_*(p+y*x)-u),n.push(-_*(p-y*x)-u)}else r=g>=0?-Math.pow(g,1/3):Math.pow(-g,1/3),n.push(2*r-u),n.push(-r-u);return n}function Li(t,e,s,i,n,r,o,a,l,d,h){for(var u,c,g=Math.min(o,l),m=Math.min(a,d),_=Math.max(o,l),f=Math.max(a,d),p=Ff((u=a-d)*(t+-2*s+n)+(c=l-o)*(e+-2*i+r),u*(-2*t+2*s)+c*(-2*e+2*i),u*t+c*e+(o*d-l*a)),x=0;x<p.length;x++){var y=p[x];if(0<=y&&y<=1){var b=t+(s-t)*y,v=e+(i-e)*y,E=b+(s+(n-s)*y-b)*y,A=v+(i+(r-i)*y-v)*y;if(o===l){if(m<=A&&A<=f){if(!h)return 1;h.push(E,A)}}else if(a===d){if(g<=E&&E<=_){if(!h)return 1;h.push(E,A)}}else if(E>=g&&A>=m&&E<=_&&A<=f){if(!h)return 1;h.push(E,A)}}}return h?h.length/2:0}function kf(t,e,s,i,n,r,o,a,l,d,h){return h?(Li(t,e,s,i,n,r,o,a,l,a,h),Li(t,e,s,i,n,r,l,a,l,d,h),Li(t,e,s,i,n,r,o,d,l,d,h),Li(t,e,s,i,n,r,o,a,o,d,h),h.length/2):o<=t&&l>=t&&a<=e&&d>=e||o<=n&&l>=n&&a<=r&&d>=r||Li(t,e,s,i,n,r,o,a,l,a)||Li(t,e,s,i,n,r,l,a,l,d)||Li(t,e,s,i,n,r,o,d,l,d)||Li(t,e,s,i,n,r,o,a,o,d)?1:0}function Ci(t,e,s,i,n,r,o,a,l,d,h,u,c){for(var g,m,_=Math.min(l,h),f=Math.min(d,u),p=Math.max(l,h),x=Math.max(d,u),y=Ff((g=d-u)*(-1*t+3*s+-3*n+o)+(m=h-l)*(-1*e+3*i+-3*r+a),g*(3*t+-6*s+3*n)+m*(3*e+-6*i+3*r),g*(-3*t+3*s)+m*(-3*e+3*i),g*t+m*e+(l*u-h*d)),b=0;b<y.length;b++){var v=y[b];if(0<=v&&v<=1){var E=t+(s-t)*v,A=e+(i-e)*v,S=s+(n-s)*v,T=i+(r-i)*v,L=E+(S-E)*v,I=A+(T-A)*v,R=L+(S+(n+(o-n)*v-S)*v-L)*v,z=I+(T+(r+(a-r)*v-T)*v-I)*v;if(l===h){if(f<=z&&z<=x){if(!c)return 1;c.push(R,z)}}else if(d===u){if(_<=R&&R<=p){if(!c)return 1;c.push(R,z)}}else if(R>=_&&z>=f&&R<=p&&z<=x){if(!c)return 1;c.push(R,z)}}}return c?c.length/2:0}function Df(t,e,s,i,n,r,o,a,l,d,h,u,c){return c?(Ci(t,e,s,i,n,r,o,a,l,d,h,d,c),Ci(t,e,s,i,n,r,o,a,h,d,h,u,c),Ci(t,e,s,i,n,r,o,a,l,u,h,u,c),Ci(t,e,s,i,n,r,o,a,l,d,l,u,c),c.length/2):l<=t&&h>=t&&d<=e&&u>=e||l<=o&&h>=o&&d<=a&&u>=a||Ci(t,e,s,i,n,r,o,a,l,d,h,d)||Ci(t,e,s,i,n,r,o,a,h,d,h,u)||Ci(t,e,s,i,n,r,o,a,l,u,h,u)||Ci(t,e,s,i,n,r,o,a,l,d,l,u)?1:0}var qc=typeof Map>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}set(e,s){e in this._values||this._size++,this._values[e]=s}get(e){return this._values[e]}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Map,Gv=typeof Set>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}add(e){e in this._values||this._size++,this._values[e]=!0}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Set,Rf=class{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(t){return this._getBounds=t,this}setIntersector(t){return this._intersects=t,this}},Vv=65536,jv=16,Hv=16,Wv=class extends Rf{constructor(t,e,s=Hv,i=Vv,n=Int32Array,r=jv){super(),this._occupied=0,this._idToCode=new qc,this._codeCache=[0,0,0],this.code=(o,a,l)=>l|Hs(o,a)<<this._bitsForZoom,this.decode=(o,a)=>(Hs.reverse(o>>this._bitsForZoom,a),a[2]=o&this._zoomMask,a),this._intersects=t,this._getBounds=e,this._cells=new Dv(n),this._offset=i,this._maxLevels=r,this._mortonMax=(1<<this._maxLevels)-1,this._bitsForZoom=Math.log2(this._maxLevels),this._zoomMask=(1<<this._bitsForZoom)-1,this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._min=-i,this._max=i,this._resolution=this._mortonMax/(this._max-this._min),this._minCellSize=s*this._resolution,this._bounds=new Array(4*this._maxLevels);for(let o=0;o<this._maxLevels;o++)this._bounds[4*o]=1/0,this._bounds[4*o+1]=1/0,this._bounds[4*o+2]=-1/0,this._bounds[4*o+3]=-1/0}setMinCellSize(t){return this._minCellSize=t,this}setOffset(t){return this._offset=t,this._min=-t,this._max=t,this._resolution=this._mortonMax/(this._max-this._min),this}insert(t,e,s,i,n){e===void 0&&([e,s,i,n]=this._getBounds(t));const r=Math.max(i-e,n-s);let o,a=this._minCellSize;for(o=0;a<r&&o<this._maxLevels-1;o++)a*=2;const l=this._resolution,d=this._min,h=l*(.5*(i+e)-d)/a|0,u=l*(.5*(n+s)-d)/a|0,c=this.code(h,u,o);this._cells.has(c)||this._cells.addEntry(c),this._cells.addTo(c,t),this._objectsAtLevel[o]++,this._occupied|=1<<o;const g=4*o,m=this._bounds;return h<m[g]&&(m[g]=h),u<m[g+1]&&(m[g+1]=u),h>m[g+2]&&(m[g+2]=h),u>m[g+3]&&(m[g+3]=u),this._idToCode.set(t,c),c}has(t){return this._idToCode.has(t)}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n)}remove(t){const e=this._idToCode.get(t);this.decode(e,this._codeCache);const s=this._codeCache[2];return--this._objectsAtLevel[s]==0&&(this._occupied&=~(1<<s),this._bounds[4*s]=1/0,this._bounds[4*s+1]=1/0,this._bounds[4*s+2]=-1/0,this._bounds[4*s+3]=-1/0),this._cells.removeFrom(e,t),this._idToCode.delete(t),this}query(t,e,s,i){const n=this._cells,r=this._bounds,o=this._intersects,a=this._min,l=this._resolution;let d=this._minCellSize,h=this._occupied;const u=[];for(let c=0;c<this._maxLevels&&h!==0;d*=2,h>>=1,c++){if(!(1&h))continue;const g=1/d,m=4*c,_=Math.max(r[m],l*(t-a)*g-1|0),f=Math.max(r[m+1],l*(e-a)*g-1|0),p=Math.min(r[m+2],l*(s-a)*g+1|0),x=Math.min(r[m+3],l*(i-a)*g+1|0);for(let y=_;y<=p;y++)for(let b=f;b<=x;b++){const v=this.code(y,b,c),E=n.getItems(v);if(E!==void 0)for(let A=0;A<E.length;A++){const S=E[A];o(S,t,e,s,i)&&u.push(S)}}}return u}traverse(t,e,s,i,n){const r=this._cells,o=this._bounds,a=this._intersects,l=this._min,d=this._resolution;let h=this._minCellSize,u=this._occupied;const c=[];for(let g=0;g<this._maxLevels&&u!==0;h*=2,u>>=1,g++){if(!(1&u))continue;const m=1/h,_=4*g,f=Math.max(o[_],d*(t-l)*m-1|0),p=Math.max(o[_+1],d*(e-l)*m-1|0),x=Math.min(o[_+2],d*(s-l)*m+1|0),y=Math.min(o[_+3],d*(i-l)*m+1|0);for(let b=f;b<=x;b++)for(let v=p;v<=y;v++){const E=this.code(b,v,g),A=r.getItems(E);if(A!==void 0)for(let S=0;S<A.length;S++){const T=A[S];if(a(T,t,e,s,i)&&(c.push(T),n(T)))return c}}}return c}collisions(t,e=this._getBounds){if(typeof e!="function")throw new Error("getBounds function is required to get the object bounds");const s=Array.from(this._idToCode.keys()),i=this._min,n=this._resolution,r=this._cells,o=new qc,a=[];for(let l=0;l<s.length;l++){let d=0,h=this._minCellSize,u=this._occupied;const c=s[l];let[g,m,_,f]=e(c);const p=Math.max(_-g,f-m);for(d=0;h<p;d++)h*=2,u>>=1;g=n*(g-i),m=n*(m-i),_=n*(_-i),f=n*(f-i);for(let x=d;x<this._maxLevels&&u!==0;h*=2,u>>=1,x++){if(!(1&u))continue;const y=1/h,b=m*y-1|0,v=_*y+1|0,E=f*y+1|0;for(let A=g*y-1|0;A<=v;A++)for(let S=b;S<=E;S++){const T=this.code(A,S,x);if(o.get(T)===l)continue;o.set(T,l);const L=r.getItems(T);if(L!==void 0)for(let I=0;I<L.length;I++){const R=L[I],[z,j,C,w]=this._getBounds(R);R!==c&&t(c,z,j,C,w)&&a.push(c,R)}}}}return Xv(a)}clear(){this._occupied=0,this._cells.clear(),this._idToCode.clear(),this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._bounds=new Array(4*this._maxLevels);for(let t=0;t<this._maxLevels;t++)this._bounds[4*t]=1/0,this._bounds[4*t+1]=1/0,this._bounds[4*t+2]=-1/0,this._bounds[4*t+3]=-1/0;return this}keyToBBox(t){const[e,s,i]=this.decode(t,[0,0,0]),n=this._minCellSize*(1<<i),r=this._min,o=this._resolution;return[e*n/o+r,s*n/o+r,(e+1)*n/o+r,(s+1)*n/o+r]}keys(){return Object.keys(this._cells._idToIndex)}get averageCellOccupancy(){return this._cells.averageSize}get size(){return this._idToCode.size}getBoxes(){return Array.from(this._idToCode.keys()).map(t=>this._getBounds(t))}};function Xv(t){const e=new Gv,s=[];for(let i=0;i<t.length;i+=2){const n=t[i],r=t[i+1],o=n<r?n*r+(r-n-1)*(r-n-1)/4:n*r+(n-r-1)*(n-r-1)/4;e.has(o)||(e.add(o),s.push(n,r))}return s}function Yv(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function ui(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}var li=(t,e,s,i,n,r)=>({minX:t,minY:e,maxX:s,maxY:i,leaf:!0,level:r,parent:n,objects:[],final:!1,children:null});function Of(t){const{minX:e,minY:s,maxX:i,maxY:n}=t;return[e,s,i,n]}function Fr(t,e,s,i,n,r,o,a){return t>=n&&s<=o&&e>=r&&i<=a}var $v=0,qv=1,Zv=2,Jv=3;function Bo(t,e,s,i,n,r,o,a){const l=(r+a)/2,d=(e+i)/2;return(t+s)/2<=(n+o)/2?d<=l?$v:qv:d<=l?Jv:Zv}var Kv=t=>t,Bn=class extends Rf{constructor(t=Kv,e=10,s,i=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=e,this._root=null,this._getBounds=t,this._rootLevel=i,this._maxLevel=i+30,this._idToCell={},s&&(this._root=li(s[0],s[1],s[2],s[3],null,i))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(t,e,s,i,n,r=this._root){if(e||([e,s,i,n]=this._getBounds(t)),this._objects[t])return;if(this._objects[t]=!0,this._size++,!this._root){const g=Math.max(Math.abs(i-e),Math.abs(n-s));return this._root=li(e,s,e+g,s+g,null,this._rootLevel),this._idToCell[t]=[this._root],this._root.objects=[t],t}let o,a=[r],l=!1;const d=this._nodeCapacity,h=this._idToCell,u=this._maxLevel;let c;for(;c=a.pop();){o=c;const{minX:g,minY:m,maxX:_,maxY:f}=o;ui(e,s,i,n,g,m,_,f)&&(o.leaf?o.objects&&(o.objects.length<d||o.final)?(o.objects.push(t),h[t]?h[t].push(o):h[t]=[o],l=!0,(o.level>=u||Math.abs(_-g)<=Math.abs(i-e)||Math.abs(f-m)<=Math.abs(n-s))&&(o.final=!0)):(this.splitNode(o),a.push(o)):a.push.apply(a,o.children))}if(!Fr(e,s,i,n,(r=this._root).minX,r.minY,r.maxX,r.maxY)){let g=this._rootLevel;for(;!Fr(e,s,i,n,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){r=this._root;const{minX:m,minY:_,maxX:f,maxY:p}=r;let x=m,y=_,b=f,v=p;const E=Math.abs(f-m),A=Math.abs(p-_);if(A===0&&E===0)break;const S=Math.max(E,A);e<m?(x-=S,s<_?y-=S:v+=S):(b+=S,s<_?y-=S:v+=S);const T=li(x,y,b,v,null,--g);this.splitNode(T),T.children[Bo(m,_,f,p,x,y,b,v)]=r,this._root=r.parent=T}for(a=[this._root],this._root.level=this._rootLevel;c=a.shift();)if(o=c,!o.leaf)for(let m=0;m<4;m++){const _=o.children[m];_.level=o.level+1,a.push(_)}r=this._root;for(let m=0;m<4;m++){const _=r.children[m];_&&_.leaf&&_.objects&&(_.objects.push(t),h[t]?h[t].push(_):h[t]=[_])}}return l?t:void 0}removeById(t){if(!this._objects[t])return t;this._size--;const e=this._idToCell[t];for(let s=0;s<e.length;s++){const i=e[s].objects||[];for(let n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}}return delete this._objects[t],delete this._idToCell[t],t}remove(t){const[e,s,i,n]=this._getBounds(t),r=[this._root];let o,a;const l=[];for(;o=r.pop();)if(ui(e,s,i,n,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const d=o.objects||[];for(let h=0,u=d.length;h<u;h++)if(d[h]===t){d.splice(h,1),u===1&&l.push(o);break}}else r.push.apply(r,o.children);if(delete this._idToCell[t],delete this._objects[t],this._size--,l.length)for(;a=l.pop();){let d=a.parent,h=!0;for(;d&&h;){if(!d.leaf){for(let u=0;u<4;u++)if(o=d.children[u],!o.leaf||o.objects&&o.objects.length!==0){h=!1;break}h&&(d.leaf=!0,d.children=[],d.objects=[])}d=d.parent}}return t}splitNode(t){const{minX:e,minY:s,maxX:i,maxY:n}=t,r=(e+i)/2,o=(s+n)/2,a=t.level+1,l=this._idToCell,d=this._maxLevel,h=[li(e,s,r,o,t,a),li(e,o,r,n,t,a),li(r,o,i,n,t,a),li(r,s,i,o,t,a)];if(t.objects!==null){const u=t.objects,c=this._getBounds;for(let g=0,m=u.length;g<m;g++){const _=u[g],f=c(_);let p=l[_];for(let x=0;x<4;x++){const y=h[x],{minX:b,minY:v,maxX:E,maxY:A}=y;ui(f[0],f[1],f[2],f[3],b,v,E,A)&&(y.objects&&y.objects.push(_),(y.level>=d||Math.abs(E-b)<=Math.abs(f[2]-f[0])||Math.abs(A-v)<=Math.abs(f[3]-f[1]))&&(y.final=!0),p?p.push(y):p=[y])}p&&p.splice(p.indexOf(t),1)}}t.children=h,t.objects=null,t.leaf=!1}point(t,e,s){let i=[];const n=[this._root];let r,o,a;const l=this._getBounds;for(;r=n.pop();)if(t>=r.minX&&t<=r.maxX&&e>=r.minY&&e<=r.maxY){if(r.leaf){s&&r.objects&&(i=r.objects);const d=r.objects||[];for(let h=0,u=d.length;h<u;h++)a=d[h],o=l(a),t>=o[0]&&t<=o[2]&&e>=o[1]&&e<=o[3]&&i.push(a);break}n.push.apply(n,r.children)}return i.length?i:null}neigbours(t,e){let s,i=[];const n=[this._root];for(;s=n.pop();)if(t>=s.minX&&t<=s.maxX&&e>=s.minY&&e<=s.maxY){if(s.leaf){i=s.objects;break}n.push.apply(n,s.children)}return i}query(t,e,s,i){const n=[],r=[this._root];let o,a,l;const d=this._getBounds,h={},u=this._intersects;let c;for(;o=r.pop();)if(ui(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const g=o.objects||[];for(let m=0,_=g.length;m<_;m++)l=g[m],h[l]||(a=d(l),ui(t,e,s,i,a[0],a[1],a[2],a[3])&&(u&&!u(l,t,e,s,i)||n.push(l)),h[l]=!0)}else c=Bo(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY),r.push(o.children[(c+3)%4],o.children[(c+2)%4],o.children[(c+1)%4],o.children[c]);return n}traverse(t,e,s,i,n){const r=[],o=[this._root];let a,l,d;const h=this._getBounds,u={},c=this._intersects;let g;for(;a=o.pop();)if(ui(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY))if(a.leaf){const m=a.objects||[];for(let _=0,f=m.length;_<f;_++)if(d=m[_],!u[d]){if(l=h(d),ui(t,e,s,i,l[0],l[1],l[2],l[3])&&(!c||c(d,t,e,s,i))&&(r.push(d),n(d)))return r;u[d]=!0}}else g=Bo(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY),o.push(a.children[(g+3)%4],a.children[(g+2)%4],a.children[(g+1)%4],a.children[g]);return r}getOverlaps(){const t=[this._root];let e,s,i;const n=[],r=this._getBounds,o={};for(;e=t.pop();)if(e.leaf){const a=e.objects||[],l=a.length;for(let d=0;d<l;d++)for(let h=0;h<l;h++)if(s=a[d],i=a[h],d!==h&&!o[s+":"+i]&&!o[i+":"+s]){o[s+":"+i]=!0;const u=r(s),c=r(i);ui(u[0],u[1],u[2],u[3],c[0],c[1],c[2],c[3])&&n.push(s,i)}}else t.push.apply(t,e.children);return n}cover(t,e,s,i){if(this._root===null)return this._root=li(t,e,s,i,null,0),this;let n=this._root;if(!Fr(t,e,s,i,n.minX,n.minY,n.maxX,n.maxY)){let r=this._rootLevel;for(;!Fr(t,e,s,i,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){n=this._root;const{minX:d,minY:h,maxX:u,maxY:c}=n;let g=d,m=h,_=u,f=c;const p=Math.abs(u-d),x=Math.abs(c-h);if(x===0&&p===0)break;const y=Math.max(p,x);t<d?(g-=y,e<h?m-=y:f+=y):(_+=y,e<h?m-=y:f+=y);const b=li(g,m,_,f,null,--r);this.splitNode(b),b.children[Bo(d,h,u,c,g,m,_,f)]=n,this._root=n.parent=b}const o=[this._root];let a,l;for(this._root.level=this._rootLevel;a=o.shift();)if(l=a,!l.leaf)for(let d=0;d<4;d++){const h=l.children[d];h.level=l.level+1,o.push(h)}}return this}getAll(){return Object.keys(this._objects).map(t=>Number(t))}forEach(t,e){const s=[this._root];let i;for(;i=s.pop();)if(i.leaf&&i.objects)for(let n=0,r=i.objects.length;n<r;n++)t.call(e,i.objects[n]);else s.push.apply(s,i.children);return this}getLeafs(){const t=[this._root],e=[];let s;for(;s=t.pop();)s.leaf?e.push(s):t.push.apply(t,s.children);return e}traverseFromRoot(t,e){const s=[this._root];let i;for(;i=s.pop();)t.call(e,i,i.objects)||i.leaf||s.push.apply(s,i.children);return this}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n),this}getNodeBounds(t){return Of(t)}};Bn.flatAccessor=(t,e)=>s=>{const i=e*s;return t.slice(i,i+e)},Bn.inside=Fr,Bn.intersects=Yv,Bn.overlaps=ui,Bn.getNodeBBox=Of;var zf=Bn;function Qv(t){const e=+this._x.call(null,t),s=+this._y.call(null,t);return Bf(this.cover(e,s),e,s,t)}function Bf(t,e,s,i){if(isNaN(e)||isNaN(s))return t;var n,r,o,a,l,d,h,u,c,g=t._root,m={data:i},_=t._x0,f=t._y0,p=t._x1,x=t._y1;if(!g)return t._root=m,t;for(;g.length;)if((d=e>=(r=(_+p)/2))?_=r:p=r,(h=s>=(o=(f+x)/2))?f=o:x=o,n=g,!(g=g[u=h<<1|d]))return n[u]=m,t;if(a=+t._x.call(null,g.data),l=+t._y.call(null,g.data),e===a&&s===l)return m.next=g,n?n[u]=m:t._root=m,t;do n=n?n[u]=new Array(4):t._root=new Array(4),(d=e>=(r=(_+p)/2))?_=r:p=r,(h=s>=(o=(f+x)/2))?f=o:x=o;while((u=h<<1|d)==(c=(l>=o)<<1|a>=r));return n[c]=g,n[u]=m,t}function tE(t){var e,s,i,n,r=t.length,o=new Array(r),a=new Array(r),l=1/0,d=1/0,h=-1/0,u=-1/0;for(s=0;s<r;++s)isNaN(i=+this._x.call(null,e=t[s]))||isNaN(n=+this._y.call(null,e))||(o[s]=i,a[s]=n,i<l&&(l=i),i>h&&(h=i),n<d&&(d=n),n>u&&(u=n));if(l>h||d>u)return this;for(this.cover(l,d).cover(h,u),s=0;s<r;++s)Bf(this,o[s],a[s],t[s]);return this}function eE(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var s=this._x0,i=this._y0,n=this._x1,r=this._y1;if(isNaN(s))n=(s=Math.floor(t))+1,r=(i=Math.floor(e))+1;else{for(var o,a,l=n-s||1,d=this._root;s>t||t>=n||i>e||e>=r;)switch(a=(e<i)<<1|t<s,(o=new Array(4))[a]=d,d=o,l*=2,a){case 0:n=s+l,r=i+l;break;case 1:s=n-l,r=i+l;break;case 2:n=s+l,i=r-l;break;case 3:s=n-l,i=r-l}this._root&&this._root.length&&(this._root=d)}return this._x0=s,this._y0=i,this._x1=n,this._y1=r,this}function sE(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function iE(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function ys(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n}function nE(t,e,s){var i,n,r,o,a,l,d,h=this._x0,u=this._y0,c=this._x1,g=this._y1,m=[],_=this._root;for(_&&m.push(new ys(_,h,u,c,g)),s==null?s=1/0:(h=t-s,u=e-s,c=t+s,g=e+s,s*=s);l=m.pop();)if(!(!(_=l.node)||(n=l.x0)>c||(r=l.y0)>g||(o=l.x1)<h||(a=l.y1)<u))if(_.length){var f=(n+o)/2,p=(r+a)/2;m.push(new ys(_[3],f,p,o,a),new ys(_[2],n,p,f,a),new ys(_[1],f,r,o,p),new ys(_[0],n,r,f,p)),(d=(e>=p)<<1|t>=f)&&(l=m[m.length-1],m[m.length-1]=m[m.length-1-d],m[m.length-1-d]=l)}else{var x=t-+this._x.call(null,_.data),y=e-+this._y.call(null,_.data),b=x*x+y*y;if(b<s){var v=Math.sqrt(s=b);h=t-v,u=e-v,c=t+v,g=e+v,i=_.data}}return i}function rE(t){if(isNaN(r=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,s,i,n,r,o,a,l,d,h,u,c,g=this._root,m=this._x0,_=this._y0,f=this._x1,p=this._y1;if(!g)return this;if(g.length)for(;;){if((d=r>=(a=(m+f)/2))?m=a:f=a,(h=o>=(l=(_+p)/2))?_=l:p=l,e=g,!(g=g[u=h<<1|d]))return this;if(!g.length)break;(e[u+1&3]||e[u+2&3]||e[u+3&3])&&(s=e,c=u)}for(;g.data!==t;)if(i=g,!(g=g.next))return this;return(n=g.next)&&delete g.next,i?(n?i.next=n:delete i.next,this):e?(n?e[u]=n:delete e[u],(g=e[0]||e[1]||e[2]||e[3])&&g===(e[3]||e[2]||e[1]||e[0])&&!g.length&&(s?s[c]=g:this._root=g),this):(this._root=n,this)}function oE(t){for(var e=0,s=t.length;e<s;++e)this.remove(t[e]);return this}function aE(){return this._root}function lE(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function dE(t){var e,s,i,n,r,o,a=[],l=this._root;for(l&&a.push(new ys(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,i=e.x0,n=e.y0,r=e.x1,o=e.y1)&&l.length){var d=(i+r)/2,h=(n+o)/2;(s=l[3])&&a.push(new ys(s,d,h,r,o)),(s=l[2])&&a.push(new ys(s,i,h,d,o)),(s=l[1])&&a.push(new ys(s,d,n,r,h)),(s=l[0])&&a.push(new ys(s,i,n,d,h))}return this}function hE(t){var e,s=[],i=[];for(this._root&&s.push(new ys(this._root,this._x0,this._y0,this._x1,this._y1));e=s.pop();){var n=e.node;if(n.length){var r,o=e.x0,a=e.y0,l=e.x1,d=e.y1,h=(o+l)/2,u=(a+d)/2;(r=n[0])&&s.push(new ys(r,o,a,h,u)),(r=n[1])&&s.push(new ys(r,h,a,l,u)),(r=n[2])&&s.push(new ys(r,o,u,h,d)),(r=n[3])&&s.push(new ys(r,h,u,l,d))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function uE(t){return t[0]}function cE(t){return arguments.length?(this._x=t,this):this._x}function gE(t){return t[1]}function mE(t){return arguments.length?(this._y=t,this):this._y}function Uf(t,e,s){var i=new Cu(e??uE,s??gE,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function Cu(t,e,s,i,n,r){this._x=t,this._y=e,this._x0=s,this._y0=i,this._x1=n,this._y1=r,this._root=void 0}function Zc(t){for(var e={data:t.data},s=e;t=t.next;)s=s.next={data:t.data};return e}var ms=Uf.prototype=Cu.prototype;ms.copy=function(){var t,e,s=new Cu(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return s;if(!i.length)return s._root=Zc(i),s;for(t=[{source:i,target:s._root=new Array(4)}];i=t.pop();)for(var n=0;n<4;++n)(e=i.source[n])&&(e.length?t.push({source:e,target:i.target[n]=new Array(4)}):i.target[n]=Zc(e));return s},ms.add=Qv,ms.addAll=tE,ms.cover=eE,ms.data=sE,ms.extent=iE,ms.find=nE,ms.remove=rE,ms.removeAll=oE,ms.root=aE,ms.size=lE,ms.visit=dE,ms.visitAfter=hE,ms.x=cE,ms.y=mE;var Er=function(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n},_E=function(t){const e=[];let s,i,n,r,o,a,l,d=this._root;for(d&&e.push(new Er(d,this._x0,this._y0,this._x1,this._y1));(s=e.pop())&&(l=t(d=s.node,n=s.x0,r=s.y0,o=s.x1,a=s.y1),l!=="break");)if(!l&&d.length){const h=(n+o)/2,u=(r+a)/2;(i=d[3])&&e.push(new Er(i,h,u,o,a)),(i=d[2])&&e.push(new Er(i,n,u,h,a)),(i=d[1])&&e.push(new Er(i,h,r,o,u)),(i=d[0])&&e.push(new Er(i,n,r,h,u))}return this};function Mu(t,e,s,i,n){const r=new Array(t.length);for(let o=0;o<e.length;o++){const a=i[e[o]],l=i[s[o]];r[a]=r[a]||[],r[a].push(l),n&&(r[l]=r[l]||[],r[l].push(a))}return r}function ao(t,e){return t[e]===-1?e:ao(t,t[e])}function fE(t,e,s){const i=ao(t,e),n=ao(t,s);t[i]=n}function pE(t,e,s,i=!1){const n=new Int32Array(t.length),r={};for(let o=0;o<t.length;o++)n[o]=-1,r[t[o]]=o;for(let o=0;o<e.length;o++){const a=r[e[o]],l=r[s[o]];if(i&&a===l)return!0;const d=ao(n,a),h=ao(n,l);if(d===h)return!0;fE(n,d,h)}return!1}function Gf(t,e,s,i,n,r,o,a){if(i[t]=n,s[t])return!0;if(e[t])return!1;e[t]=1,s[t]=1;const l=r[t];if(l){for(const d of l)if(Gf(d,e,s,i,t,r,o,a))return o.push(a[d]),!0}return s[t]=0,!1}function Vf(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Uint8Array(i),o=new Int32Array(i),a={};for(let d=0;d<i;d++)a[t[d]]=d;const l=Mu(t,e,s,a,!1);for(let d=0;d<i;d++){const h=[];if(Gf(d,n,r,o,-1,l,h,t)&&h.length>1){const u=h[0];for(let c=1;c<h.length;c++)if(h[c]===u){h.length=c;break}return h.push(u),h.reverse()}}return!1}function jf(t,e,s,i,n,r,o){e[t]=1,i[t]=s;const a=n[t];if(a){for(const l of a)if(e[l]){if(l!==s)return i[l]=t,r.push(o[l]),!0}else if(jf(l,e,t,i,n,r,o))return r.push(o[l]),!0}return!1}function yE(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Int32Array(i),o={};for(let l=0;l<i;l++)o[t[l]]=l,r[l]=-1;const a=Mu(t,e,s,o,!0);for(let l=0;l<e.length;l++){const d=o[e[l]],h=o[s[l]];a[d]=a[d]||[],a[d].push(h)}for(let l=0;l<i;l++){const d=l,h=[];if(!n[d]&&jf(d,n,-1,r,a,h,t))return!0}return!1}Uf.prototype.visit2=_E;var Hf=class{constructor(t,e,s){this.cycles=[],this.visitedLength=0,this.visitedStack=[],this.stack=[],this.idToIndex={},this.removed={},this.nodes=t,this.visited=new Uint8Array(this.nodes.length);for(let i=0;i<t.length;i++)this.idToIndex[t[i]]=i;this.adjacency=Mu(t,e,s,this.idToIndex)}getCycles(){this.visited=new Uint8Array(this.nodes.length),this.visitedStack=[];for(let t=0;t<this.nodes.length;t++)for(this.backtrack(t,t);this.visitedLength!==0;){const e=this.visitedStack.pop();e!==void 0&&this.visited[e]&&(this.visited[e]=0,this.visitedLength--)}return this.cycles}backtrack(t,e){let s=!1;this.stack.push(e),this.visited[e]||(this.visited[e]=1,this.visitedLength++),this.visitedStack.push(e);const i=this.adjacency[e]||[];for(const n of i)if(this.removed[e]=this.removed[e]||{},!this.removed[e][n]){if(n<t)this.removed[e][n]=!0;else if(n===t){s=!0;const r=[];for(let o=0,a=!1;o<this.stack.length;o++){const l=this.stack[o];t===l&&(a=!0),a&&r.push(this.nodes[l])}this.cycles.push(r)}else if(!this.visited[n]){const r=this.backtrack(t,n);s=s||r}}if(s){let n;do n=this.visitedStack.pop(),this.visited[n]&&(this.visited[n]=0,this.visitedLength--);while(n!==e)}return this.stack.pop(),s}};function xE(){return{index:{},parent:[],count:0}}function bE(t,e){t.index[e]===void 0&&(t.count+=1,t.index[e]=t.parent.push(-t.count))}function Jc(t,e){let s=t.index[e];if(s===void 0)return-1;for(;s>=0;)e=s,s=t.parent[s];return e}function vE(t,e,s){t.parent[s]=e,t.count-=1}function EE(t){return t.count<=1}function Wf(t,e,s,i,n){n&&e.sort((a,l)=>n(a)-n(l));const r=[],o=xE();t.forEach(a=>bE(o,a));for(let a=0;a<e.length&&!EE(o);a++){const l=Jc(o,s(e[a])),d=Jc(o,i(e[a]));l!==d&&l>0&&d>0&&(vE(o,l,d),r.push(e[a]))}return r}function Xf({adjacency:t,directed:e=!1,normalized:s=!0}){const i=[],n=[],r={},o={},a={},l={};let d;const h=new Array(t.length),u={},c={},g={};for(let x=0;x<t.length;x++){const y=t[x];g[y.id]=y.adj,u[y.id]=!0,c[y.id]=x,e||y.adj.forEach(b=>{u[b]=!0})}const m=Object.keys(u).map(x=>+x);for(let x=0;x<m.length;x++)h[x]=0;for(let x=0;x<m.length;x++)d=m[x],p(d),f();const _=s?m.length>2?1/((m.length-1)*(m.length-2)):0:e?0:.5;if(_)for(let x=0;x<h.length;x++)h[x]*=_;return h;function f(){for(let x=0;x<m.length;x++)l[m[x]]=0;for(;n.length;){const x=n.pop(),y=(1+l[x])/a[x],b=r[x];for(let v=0;v<b.length;++v){const E=b[v];l[E]+=a[E]*y}x!==d&&(h[c[x]]+=l[x])}}function p(x){for(let y=0;y<m.length;y++){const b=m[y];r[b]=[],o[b]=-1,a[b]=0}for(o[x]=0,a[x]=1,i.push(x);i.length;){const y=i.shift();n.push(y),g[y].forEach(b=>{o[b]===-1&&(o[b]=o[y]+1,i.push(b)),o[b]===o[y]+1&&(a[b]+=a[y],r[b].push(y))})}}}var Yf=class{constructor(t){this._heap=[],this._size=0,this._keyToValue=t,this._keyToIndex=new Int32Array(t.length),this._keyToIndex.fill(-1)}add(t){let e=this._keyToIndex[t];e===-1&&(e=this._size++,this._heap[e]=t),this._keyToIndex[t]=this._bubble(e)}removeMin(){if(this._size===0)return NaN;const t=this._heap[0];return this._heap[0]=this._heap[--this._size],this._bubble(0),t}isEmpty(){return this._size===0}has(t){return this._keyToIndex[t]!==-1}_bubble(t){const e=this._indexToValue(t),s=this._getParentIndex(t),i=this._indexToValue(s);let n=t;if(t!==0&&i>e)n=this._swap(t,s);else{const r=this._getLeftChildIndex(t),o=this._getRightChildIndex(t),a=this._indexToValue(r),l=this._indexToValue(o),d=Math.min(e,a,l);d===e||(n=d===a?this._swap(t,r):this._swap(t,o))}return n===t?t:this._bubble(n)}_indexToValue(t){return t>=this._size?1/0:this._keyToValue[this._heap[t]]}_getParentIndex(t){return(t-1)/2|0}_getLeftChildIndex(t){return 2*t+1}_getRightChildIndex(t){return 2*t+2}_swap(t,e){const s=this._heap[t],i=this._heap[e];return this._heap[t]=i,this._heap[e]=s,this._keyToIndex[s]=e,this._keyToIndex[i]=t,e}},AE=(()=>{let t=0;return typeof requestAnimationFrame<"u"?requestAnimationFrame:function(e){const s=Date.now(),i=Math.min(16,Math.max(0,16-(s-t))),n=t=s+i;return setTimeout(()=>e(n),i)}})(),$f=50,SE=typeof cancelAnimationFrame<"u"?cancelAnimationFrame:function(t){return clearTimeout(t)};function Nu(t,e){return AE(s=>{t.call(e,s)})}function qf(t){t&&SE(t)}var wE=typeof global=="object"&&global!==null&&global.it!==void 0,Ei=typeof document<"u",ji=typeof window<"u",Il=ji&&!window.__OGMA_HEADLESS,Ll=Il&&Ei,TE=typeof navigator<"u"&&navigator.userAgent!==void 0?navigator.userAgent.toLowerCase():"",IE=ji&&/mac/.test(TE);function LE(t){return typeof t=="number"&&t%1==0}function th(t){return Array.isArray(t)?t.join("."):t}function bn(t){if(!t)return[];if(typeof t=="string")return t.split(".");if(Array.isArray(t)){for(let e=0;e<t.length;++e)if(typeof t[e]!="string")throw new TypeError(`${t[e]} is not a string`);return t.slice()}throw new TypeError(`invalid property path "${t}": expected string or array of strings`)}function Cl(t,e,s){let i,n,r;if(e===0)return function(){t.apply(s,arguments)};const o=function(){i=!1,n&&(r.apply(s,n),n=null)};return r=function(){let a;return i?n=arguments:(a=t.apply(s,arguments),setTimeout(o,e),i=!0),a},r}function CE(t,e,s){let i,n,r,o,a;const l=e===0||e===void 0?100:e;function d(){const u=Date.now()-o;u<l&&u>=0?i=setTimeout(d,l-u):(i=null,s||(a=t.apply(r,n),r=n=null))}const h=function(){r=this,n=arguments,o=Date.now();const u=s&&!i;return i||(i=setTimeout(d,e)),u&&(a=t.apply(r,n),r=n=null),a};return h.clear=function(){i&&(clearTimeout(i),i=null)},h.flush=function(){i&&(a=t.apply(r,n),r=n=null,clearTimeout(i),i=null)},h}function Zf(t,e,s,i,n){s(t[e],e,t,i,n).then(r=>{e===t.length-1?i(r):Zf(t,e+1,s,i,n)}).catch(n)}function ME(t,e){return new Promise((s,i)=>Zf(t,0,e,s,i))}function Ml(){return new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120}function Jf(t){return t.reduce((e,s)=>e.then(s),Promise.resolve())}function eh(t,e,s,i,n,r,o,a){return t+n+256*(e+r)+65536*(s+o)+16777216*(i+a)}function NE(t,e){return t<e?t*e+Math.pow(e-t-1,2)/4:t*e+Math.pow(t-e-1,2)/4}function vn(t){return!(t===null||typeof t!="object"||es(t)||t instanceof RegExp||typeof HTMLElement<"u"&&t instanceof HTMLElement)}function $r(t){const e=Object.keys(t),s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=t[e[i]];return s}function ii(t,e,s){if(Array.isArray(t))return t.forEach(e,s);if(!vn(t))throw new Error("forEach: invalid argument "+JSON.stringify(t));const i=Object.keys(t);if(s!==void 0)for(let n=0;n<i.length;++n){const r=i[n];e.call(s,t[r],r)}else for(let n=0;n<i.length;++n){const r=i[n];e(t[r],r)}}function Pe(t){if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;++n)i[n]=Pe(t[n]);return i}if(!He(t))return t;const e={},s=Object.keys(t);for(const i of s)e[i]=Pe(t[i]);return e}function PE(t,e){e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)})}function yi(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function Me(t,e){const s=bn(e);if(!s.length)return t;if(t){for(let i=0;i<s.length-1;++i){const n=t[s[i]];if(!n)return;t=n}return t[s[s.length-1]]}}function lo(t,e,s="."){e||(e=r=>!vn(r));const i={},n=Object.keys(t);for(let r=0;r<n.length;++r){const o=n[r],a=t[o];if(e(a))i[o]=a;else{const l=lo(a,e),d=Object.keys(l);for(let h=0;h<d.length;h++){const u=d[h];i[`${o}${s}${u}`]=l[u]}}}return i}function sh(t){const e={},s=Object.keys(t);for(let i=0;i<s.length;++i){const n=s[i];yi(e,n,t[n])}return e}function En(t,e,s=[]){const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=t[r],a=e?e+r:r;He(o)?En(o,a+".",s):s.push(a)}return s}var Kf=Object.prototype.hasOwnProperty;function Qf(t,e){const s=[t];let i;for(;s.length>0;)if(i=s.pop(),i)if(He(i))for(const n in i)Kf.call(i,n)&&s.push(i[n]);else e(i)}function FE(t){const e={};return Qf(t,s=>e[s.getName()]=s),e}function Nl(t,e=[]){if(He(t)){const s=Object.keys(t);for(const i of s)Nl(t[i],e)}else e.push(t);return e}function Pl(t){for(const e in t)typeof t[e]=="function"&&delete t[e];return t}function Is(t,e){if(t===void 0)return Pe(e);if(!vn(t))return t;const s={},i=Object.keys(e);for(const n of i){const r=e[n],o=t[n];vn(r)?s[n]=Is(o,r):s[n]=o===void 0?Pe(r):o}return s}function He(t){return t&&(t.constructor===Object||!t.constructor)}function Ya(t,e){if(!He(e)||!He(t))return e;const s=Object.assign({},t),i=Object.keys(e);for(const n of i)s[n]=Ya(s[n],e[n]);return s}function ih(t,e){return e==null?t:e.reduce((s,i)=>(s[i]=t[i],s),{})}var jn=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)Kf.call(i,n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):He(e[n])&&He(i[n])?e[n]=jn(e[n],i[n]):e[n]=i[n])}return e},kE={},tp=kE,Oa={},ep={},nh=t=>null;if(typeof global=="object"&&(Oa=global),typeof window=="object"&&(ep=window),typeof Yr=="object"&&typeof Yr.require=="function"){const t=Yr.require.bind(Yr);nh=e=>{try{return t(e)}catch{return null}}}else typeof Oa.require=="function"&&(nh=t=>{const e=Oa.require;try{return e(t)}catch{return null}});function Os(t,{throwOnError:e}={}){let s=null;if(!s&&t&&(s=tp[t]),!s&&t&&(s=nh(t)),!s&&t&&(s=ep[t]),!s&&t&&(s=Oa[t]),!s&&e){const i=[`unable to find module "${t}"; make sure one of these statements is true:`,`- Ogma.libraries['${t}'] is set to the right library`,`- require('${t}') returns the right library`,`- window['${t}'] is set to the right library`].join(`
`);throw new Error(i)}return s}var sp=typeof performance<"u"&&performance.now?()=>0|performance.now():()=>Date.now(),DE=sp();function ls(){return sp()-DE}function ip(){const t=new Date,e=t.getDate(),s=t.getMonth()+1;return`${t.getFullYear()}-${s<10?"0"+s:s}-${e<10?"0"+e:e}`}function np(){const t=new Date;return`[${Uo((t.getUTCHours()-(t.getTimezoneOffset()/60|0))%24)}:${Uo(t.getUTCMinutes())}:${Uo(t.getUTCSeconds())}:${Uo(t.getUTCMilliseconds(),3)}]`}function Uo(t,e=2){let s=Math.pow(10,e-1),i=String(t);for(;s>1;)t<s&&(i="0"+i),s/=10;return i}function Gi(t){!wE&&console.warn(np()+" "+t)}function RE(t,e){e.forEach(s=>{Object.getOwnPropertyNames(s.prototype).forEach(i=>{Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(s.prototype,i)||Object.create(null))})})}var id,An,Pu,rp,Kt=()=>{},$a=()=>!1,Fu=()=>!0,qa=()=>null,Xs=t=>t,rh=class kr{constructor(){this.method=null,this.url=null,this.status=0,this.readyState=0,this.headers={},this.responseText=null,this.response=null,kr.onCreate&&kr.onCreate(this)}open(e,s){this.method=e,this.url=s,kr.onSend&&kr.onSend(this)}respond(e,s,i){this.readyState=4,this.status=e,this.headers=s,this.responseText=i,this.response=i,this.onreadystatechange()}send(){this.readyState=4}};rh.onCreate=Kt,rh.onSend=Kt;var op=rh,oh=class Dr{constructor(){this.onload=Kt,Dr.onCreate&&Dr.onCreate(this)}readAsDataURL(e){this._blob=e,Dr.onRead&&Dr.onRead(this)}load(e){this.result=typeof e=="function"?e(this._blob):e,this.onload&&this.onload()}};oh.onCreate=Kt,oh.onRead=Kt;var ap=oh;function Ai(){return An||{createElementNS:()=>null,createElement:()=>null,implementation:{createDocument(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}id=Os("xmldom"),An=Ei?document:id?new id.DOMImplementation().createDocument():null,Pu=typeof XMLHttpRequest<"u"?XMLHttpRequest:op,rp=typeof FileReader<"u"?FileReader:ap;var OE=class{observe(){}unobserve(){}disconnect(){}},zE=typeof ResizeObserver>"u"?OE:ResizeObserver,lp=t=>new zE(t);function dp(t,e){if(document&&document.defaultView){let s=t.style[e];if((!s||s==="auto")&&Ai().defaultView){const i=document.defaultView.getComputedStyle(t,null);s=i?i[e]:null}return s==="auto"?null:s?s.toString():null}return null}var hp=class{constructor(){this.onmousewheel=Kt,this.__dummy=!0,this.style={},this.clientWidth=0,this.clientHeight=0,this.childNodes=[],this.style={width:"0px",height:"0px",top:void 0,left:void 0,position:"",backgroundColor:void 0}}get offsetWidth(){return parseFloat(this.style.width||"0")}get offsetHeight(){return parseFloat(this.style.height||"0")}get firstChild(){return null}get parentNode(){return null}get classList(){return{length:0,value:"",add(){},remove(){},contains:t=>!1,item:null}}get innerHTML(){return""}set innerHTML(t){}appendChild(t){return this.childNodes.push(t),t}removeChild(){}addEventListener(){}removeEventListener(){}insertBefore(){}contains(t){return!1}};function Za(){return new hp}var Ss=ji?()=>window.devicePixelRatio:()=>1;function up(t){const e=";base64,";let s,i,n;if(t.indexOf(e)===-1)return s=t.split(","),i=s[0].split(":")[1],n=decodeURIComponent(s[1]),ho(n,i);s=t.split(e),i=s[0].split(":")[1],n=window.atob(s[1]);const r=n.length,o=new Uint8Array(r);for(let a=0;a<r;++a)o[a]=n.charCodeAt(a);return ho([o],i)}var cp=class{constructor(t,e){this.data=t,this.type=e}};function ho(t,e){return typeof Blob<"u"?new Blob(t,{type:e}):new cp(t,e)}function BE(t){return typeof Blob<"u"&&t instanceof Blob||t instanceof cp}function UE(t,e){return e==="blob"?t:e==="dataURL"?up(t):ho([t],"text/xml")}function Ji(t,e,s){if(!Il)return t;let i=null,n=null,r=null;window.Blob?(i=UE(t,s),n=window.URL.createObjectURL(i)):r="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(t);const o=document.createElement("a");return o.setAttribute("href",n||r),o.setAttribute("download",e),document.body.appendChild(o),o.click(),document.body.removeChild(o),n&&setTimeout(()=>window.URL.revokeObjectURL(n),0),t}function Ja(t,e,s,i=Ss()){if(Sn(t,e+"px",s+"px"),t.tagName==="IMG"||t.tagName==="CANVAS"){const n=t;n.width=e*i,n.height=s*i}}function ku(t,e){ii(e,(s,i)=>{s!==void 0&&t.setAttribute(i,s)})}var Du="http://www.w3.org/2000/svg",ah="http://www.w3.org/2000/xmlns/",gp="http://www.w3.org/1999/xlink",GE=1;function ce(t,e){const s=An.createElementNS(Du,t);return s.style||(s.style={}),e&&ku(s,e),s}function lh(t){const e=An.createElement("div"),s=t.trim().replace(/\s+/g," ");if(e.innerHTML=s,!e.firstChild||e.firstChild.nodeType!==GE)throw new Error(`Failed to create element from: "${t}". Expected an HTML string`);return e.firstChild}function Ru(t){if(An)return An.createTextNode(t)}function mp(t){return typeof Image>"u"?Promise.resolve(null):new Promise(e=>{const s=new Image;s.src=t,s.onload=()=>e(s),s.onerror=()=>e(null)})}function _p(t){if(t.indexOf("http://")===0||t.indexOf("https://")===0)return t;const e=window.location.origin,s=window.location.pathname,i=s.lastIndexOf("/");return i===-1?e+"/"+t:e+s.substr(0,i)+"/"+t}function pr(t){return new Promise((e,s)=>{const i=new Pu;i.open("GET",_p(t),!0),i.onreadystatechange=function(){if(i.readyState===4){const n=i.status;n===200?e(i.responseText):s(n!==0?new Error(`cannot retrieve file at url "${t}"; the server responded with status code ${n}.`):new Error(`cannot send XMLHttpRequest to url "${t}"; if you're using the local file protocol this is most likely the cause.`))}},i.onerror=function(){s(new Error(`cannot retrieve file at url "${t}"; the XMLHttpRequest failed.`))},i.send()})}function fp(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function Ka(t,e){t.style.cursor=e,t.style.cursor!==e&&(t.style.cursor=`-webkit-${e}`)}function pp(t){return new Promise((e,s)=>{const i=new Pu;i.responseType="blob",i.open("GET",_p(t),!0),i.onreadystatechange=()=>{if(i.readyState===4){if(i.status===200)return e(i.response);s(i.status)}},i.onerror=n=>s(n),i.send()})}function yp(t){return pp(t).then(e=>new Promise((s,i)=>{const n=new rp;n.onerror=i,n.onload=()=>s(n.result),n.readAsDataURL(e)}))}function Hn(t,e=!0){const s=e?"&#13;":`
`;return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,s).replace(/[\r\n]/g,s)}var Ou={0:"left",1:"middle",2:"right"};function xp(t){if(t.baseURI)return t.baseURI;const e=t.getElementsByTagName("base");return e.length>0?e[0].href:t.URL||(t.location?t.location.href:"")}function bp(t,e,s,i){return new Promise(n=>{let r=e;const o=Date.now(),a=(s-e)*Math.min(1,1/(i/16));(function l(){Date.now()-o<i?(r=Math.min(1,Math.max(0,r+a)),t.style.opacity=r.toString(),Nu(l)):n()})()})}function Sn(t,e,s){t.style.width=e,t.style.height=s}var vp=ji&&!!window.PointerEvent,Fl="pointerdown",kl="pointermove",Dl="pointerup",wo="pointercancel",nr={},Qa=0,Ep=t=>t.pointerType==="mouse",Ap=t=>t.pointerType!=="mouse";function VE(){if(Ei&&Qa===0&&vp){const t=document.documentElement;t.addEventListener(Fl,Sp,!0),t.addEventListener(kl,wp,!0),t.addEventListener(Dl,tl,!0),t.addEventListener(wo,tl,!0)}Qa++}function jE(){if(Qa--,Ei&&Qa===0){const t=document.documentElement;t.removeEventListener(Fl,Sp,!0),t.removeEventListener(kl,wp,!0),t.removeEventListener(Dl,tl,!0),t.removeEventListener(wo,tl,!0)}}function Sp(t){nr[t.pointerId]=t}function wp(t){nr[t.pointerId]&&(nr[t.pointerId]=t)}function tl(t){delete nr[t.pointerId]}function Rl(t,e){t.touches=[];for(const s in nr)t.touches.push(nr[s]);t.changedTouches=[t],e(t)}function HE(t,e,s){const i=n=>{Ep(n)||(Ap(n)&&n.preventDefault(),Rl(n,s))};return t(e,Fl,i,!1),i}function WE(t,e,s){const i=n=>{Ap(n)&&n.preventDefault(),Rl(n,s)};return t(e,wo,i,!1),i}function XE(t,e,s){const i=n=>{Ep(n)&&n.buttons===0||Rl(n,s)};return t(e,kl,i,!1),i}function YE(t,e,s){const i=n=>Rl(n,s);return t(e,Dl,i,!1),t(e,wo,i,!1),i}function Kc(t,e,s,i){return s==="touchstart"?t(e,Fl,i,!1):s==="touchmove"?t(e,kl,i,!1):s==="touchend"?(t(e,Dl,i,!1),t(e,wo,i,!1)):void 0}var Bt=class{constructor(t){this._ogma=t}_setModules(t){this._modules=t}onMounted(){}onReady(t){}destroy(t){}},$E=["graphics","legend","brand"],nd=300,rd=300,qE=200,ZE=class extends Bt{constructor(){super(...arguments),this._width=nd,this._height=rd,this._resizeObserver=lp(()=>this._resize()),this._layers={},this._focus=!1,this._container=null,this._isFullScreen=!1,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],this._refreshUntil=0,this._currentTime=ls(),this._timeouts=[],this._isDestroyed=!1,this._onDetachDom=[],this._isRealBrowser=Il,this._isDocumentReady=Ll,this._inFrame=!1,this._mustRefresh=!1,this._nextFrame=null,this._onWindowFocus=()=>this.refresh(),this._onFullscreenChange=()=>{this._isFullScreen=qr()},this._resize=t=>{if(!this._container&&!t)return;const e=this._width,s=this._height;let i,n;if(this._container){const r=this._modules.settings.get("minimumWidth"),o=this._modules.settings.get("minimumHeight"),a=this._container.clientWidth||1,l=this._container.clientHeight||1;i=Math.max(r,t?t.width:a),n=Math.max(o,t?t.height:l)}else t!=null&&(i=t.width,n=t.height);i===e&&n===s||(this._width=i,this._height=n,ii(this._layers,({element:r,automaticResize:o})=>{o&&Ja(r,i,n)}),this._modules.events.fire("resize",{prevWidth:e,prevHeight:s,width:i,height:n,difWidth:i-e,difHeight:n-s}))}}onMounted(){this._modules.settings.register("minimumWidth",nd,()=>this._resize(),!1),this._modules.settings.register("minimumHeight",rd,()=>this._resize(),!1),this._modules.events.register(["beforeNewFrame","frame","afterNewFrame","setContainer","resize"]),this._onDetachDom=[],VE(),this.addWindowEventListener("focus",this._onWindowFocus)}onReady(t){var e,s;t.container&&this.setContainer(t.container),(e=t.options)!=null&&e.width||(s=t.options)!=null&&s.height?this._resize({width:t.options.width||nd,height:t.options.height||rd}):this._resize()}addWindowEventListener(t,e,s){return this._isRealBrowser&&this.addElementEventListener(window,t,e,s),this}addDirectWindowEventListener(t,e,s){this._isRealBrowser&&window.addEventListener(t,e,s)}removeDirectWindowEventListener(t,e){this._isRealBrowser&&window.removeEventListener(t,e)}addDocumentEventListener(t,e,s){return this._isDocumentReady&&this.addElementEventListener(document.documentElement,t,e,s),e}removeDocumentEventListener(t,e){this._isDocumentReady&&document.documentElement.removeEventListener(t,e)}addMediaListener(t,e){if(this._isDocumentReady&&typeof window.matchMedia=="function"){const s=window.matchMedia(t);s.addListener(e),this._onDetachDom.push(()=>s.removeListener(e))}}addElementEventListener(t,e,s,i){return this._isDestroyed||(t.addEventListener(e,s,i),this._onDetachDom.push(()=>t.removeEventListener(e,s,i))),s}detachFromDom(){this._onDetachDom.forEach(t=>t()),this._onDetachDom=[],this._emptyContainer()}setTimeout(t,e=0){const s=setTimeout(()=>{this._timeouts.splice(this._timeouts.indexOf(s),1),t()},e);return this._timeouts.push(s),s}clearTimeout(t){return t&&(clearTimeout(t),this._timeouts.splice(this._timeouts.indexOf(t),1)),null}clearAllTimeouts(){this._timeouts.forEach(clearTimeout),this._timeouts=[]}stopFrames(){this._isDestroyed=!0,this._nextFrame&&(qf(this._nextFrame),this._nextFrame=null)}isDestroyed(){return this._isDestroyed}getDimensions(){return{width:this._width,height:this._height}}setDimensions(t){this._resize(t)}setLayer(t,e,{automaticResize:s=!1}={}){e&&(e._ogmaLayer=t,s&&(e.style.position="absolute",e.style.top="0px",e.style.left="0px",Ja(e,this._width,this._height,Ss()))),this._layers[t]={element:e,automaticResize:s},this._updateContainerContent()}setContainer(t){let e;if(typeof t=="string"){if(e=document.getElementById(t),!e)throw new Error(`unable to find DOM element with id "${t}"`)}else e=t;if(e===this._container)return;e===null&&this._emptyContainer();const s=this._container;this._isFullScreen=!1,this._container&&this._resizeObserver.unobserve(this._container),this._container=e,this._container&&(["fullscreenchange","webkitfullscreenchange"].forEach(i=>{this.addElementEventListener(this._container,i,this._onFullscreenChange)}),this._resizeObserver.observe(this._container)),this._resize(),this._updateContainerContent(),this._modules.events.fire("setContainer",{element:e,prevElement:s})}getContainer(){return this._container}appendElement(t){this._container!==null&&this._container.appendChild(t)}focus(){this._focus=!0}blur(){this._focus=!1}hasFocus(){return this._focus}forceResize(){this._resize()}_beforeOrAfterNextFrame(t){const e=t?this._afterNextFramePromises:this._beforeNextFramePromises,s=new Promise(i=>{e.push(()=>(i(void 0),s))});return this._refresh(),s}beforeNextFrame(){return this._beforeOrAfterNextFrame(!1)}afterNextFrame(){return this._beforeOrAfterNextFrame(!0)}refresh(t){t&&(this._refreshUntil=Math.max(this._refreshUntil,t)),this._refresh()}_emptyContainer(){if(this._container){const t=[];for(let e=0;e<this._container.childNodes.length;++e){const s=this._container.childNodes[e];s._ogmaLayer&&t.push(s)}for(let e=0;e<t.length;++e)this._container.removeChild(t[e])}}_fillContainer(){if(this._container){const t=dp(this._container,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(this._container.style.position="relative");const e=this._container.firstChild;$E.forEach(s=>{const i=this._layers[s];i&&i.element&&this._container&&this._container.insertBefore(i.element,e)})}}_updateContainerContent(){this._emptyContainer(),this._fillContainer()}_refresh(){this._inFrame?this._mustRefresh=!0:this._nextFrame||this._isDestroyed||(this._nextFrame=Nu(()=>this._playFrame()))}_playFrame(){const t=ls(),e=t-this._currentTime,s=Af([this._beforeNextFramePromises,()=>this._modules.events.fire("beforeNewFrame",{elapsed:e}),()=>this._modules.events.fire("frame",{elapsed:e}),()=>this._modules.events.fire("afterNewFrame",{elapsed:e}),this._afterNextFramePromises,()=>{this._inFrame=!1,(this._mustRefresh||t<this._refreshUntil+17)&&(this._mustRefresh=!1,this._refresh())}]);this._inFrame=!0,this._nextFrame=null,this._mustRefresh=!1,this._currentTime=t,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],s.reduce((i,n)=>i.then(()=>{if(!this._isDestroyed)return n()}),Promise.resolve())}isPlayingFrame(){return this._inFrame||!!this._nextFrame}setFullScreen(t){let e=Promise.resolve();return t!==this._isFullScreen?(this._container&&(e=t?JE(this._container):KE()),e.then(()=>new Promise(s=>{this.setTimeout(()=>{this._isFullScreen=qr(),s(void 0)},qE)}))):e}isFullScreen(){return qr()}debounceBeforeFrame(t){let e=!1,s=[];const i=()=>{const n=s;e=!1,s=[],t(),n.forEach(r=>r())};return()=>new Promise(n=>{s.push(n),e||(e=!0,this.beforeNextFrame().then(i))})}destroy(){this._resizeObserver.disconnect(),jE(),this.detachFromDom(),this.clearAllTimeouts(),this.stopFrames()}};function qr(){return typeof document<"u"&&!!(document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}function JE(t){return qr()?Promise.resolve():t.requestFullscreen?t.requestFullscreen():t.requestFullScreen?t.requestFullScreen():t.webkitRequestFullScreen?Promise.resolve(t.webkitRequestFullScreen()):t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():Promise.resolve()}function KE(){return qr()?typeof document>"u"?Promise.resolve():document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?Promise.resolve(document.webkitCancelFullScreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve():Promise.resolve()}var QE=class extends Bt{constructor(){super(...arguments),this._nodeChanges=[],this._edgeChanges=[],this._shouldTriggerEvents=!1}onMounted(){this._nodeDataList=this._modules.graph.createAttribute(!0,{name:"data",storage:"any"},!1),this._edgeDataList=this._modules.graph.createAttribute(!1,{name:"data",storage:"any"},!1),this._nodeList=this._modules.graph.getNodeAttribute("object"),this._edgeList=this._modules.graph.getEdgeAttribute("object"),this._modules.events.register(["setData","updateNodeData","updateEdgeData"]),this._modules.events.on("addNodes",({nodes:t,objects:e})=>this._onAddElements(t,e)).on("addEdges",({edges:t,objects:e})=>this._onAddElements(t,e)).on("beforeNewFrame",()=>{this._shouldTriggerEvents&&(this._shouldTriggerEvents=!1,this._triggerEvents())})}_onAddElements(t,e){const{isNode:s,size:i,_indexes:n}=t,r=this[s?"_nodeDataList":"_edgeDataList"];for(let o=0;o<i;++o)r.set(n[o],e[o].data)}setProperty(t,e,s,{dispatch:i=!1,virtual:n=!1}={}){this._setDataProperty(t.isNode,t._indexes,e,s,i,n),this._modules.events.fire("setData",{elements:t,virtual:n})}getProperty(t,e){return this._getDataProperty(t.isNode,t._indexes,e)}_setDataProperty(t,e,s,i,n,r){n&&typeof i=="function"&&(n=!1);const o=Qc(s),a=typeof i=="function",l=t?this._nodeList:this._edgeList,d=t?this._nodeDataList:this._edgeDataList,h=tA(t?this._nodeChanges:this._edgeChanges,o);for(let u=0;u<e.length;++u){const c=e[u];let g=d.get(c);const m=l.get(c),_=n?i[u]:i;let f,p;if(o===null)f=g,p=a?_(m):_,d.set(c,p);else{g==null&&(g={},d.set(c,g));const x=o.length;for(let y=0;y<x;y++){const b=o[y];let v=g[b];y<x-1?(v==null&&(v={},g[b]=v),g=v):(f=v,p=a?_(m):_,g[b]=p)}}h.indexes.push(c),h.previousValues.push(f),h.newValues.push(p),h.virtual=r}this._scheduleEvents()}_getDataProperty(t,e,s,i){const n=Qc(s);i||(i=new Array(e.length));const r=t?this._nodeDataList:this._edgeDataList;for(let o=0;o<e.length;++o){const a=e[o];let l,d=r.get(a);if(n!==null&&n.length)if(d==null)l=void 0;else{const h=n.length;for(let u=0;u<h&&d;++u)l=d=d[n[u]]}else l=d;i[o]=l}return i}_scheduleEvents(){this._shouldTriggerEvents=!0,this._modules.dom.refresh()}_triggerEvents(){const t=this._prepareEvtPayload(!0),e=this._prepareEvtPayload(!1);this._modules.events.fire("updateNodeData",t),this._modules.events.fire("updateEdgeData",e)}_prepareEvtPayload(t){const e=t?this._modules.graph.nodeList:this._modules.graph.edgeList,s=t?"_nodeChanges":"_edgeChanges";let i=[];const n=this[s];this[s]=[];const r=[];for(let o=0;o<n.length;++o){const{indexes:a,property:l,newValues:d,previousValues:h,virtual:u}=n[o];i=i.concat(a||[]),t?r.push({property:l,newValues:d,previousValues:h,virtual:u,nodes:e(a)}):r.push({property:l,newValues:d,previousValues:h,virtual:u,edges:e(a)})}return t?{nodes:e(i).dedupe(),isNode:t,changes:r}:{edges:e(i).dedupe(),isNode:t,changes:r}}};function tA(t,e){for(let i=0;i<t.length;++i){const n=t[i],r=n.property;if(e===null&&r===null)return n;if(e&&r&&r.length===e.length){let o=!0;for(let a=0;a<r.length;++a)if(r[a]!==e[a]){o=!1;break}if(o)return n}}const s={property:e&&e.slice(),indexes:[],previousValues:[],newValues:[],nodes:null,virtual:!1,edges:null};return t.push(s),s}function Qc(t){return typeof t=="string"?t.split("."):es(t)?t:null}function Tp(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];s(i.get(r),n)}}function Ip(t,e,s){const i=new Array(e.size),n=t.getObjectList(e.isNode);for(let r=0;r<e._indexes.length;++r){const o=e._indexes[r],a=n.get(o);i[r]=s(a,r)}return i}function Lp(t,e,s){s=s||Fu;const i=e.isNode,n=t.acquireIndexList(i),r=t.getObjectList(i),o=t.getListFactory(i);for(let a=0;a<e._indexes.length;++a){const l=e._indexes[a],d=r.get(l);d&&s(d,a)&&n.push(l)}return o(n.sliceAndReset())}function Cp(t,e,s,i){const n=t.getListFactory(e.isNode);if(!s)return{valid:e,invalid:n()};const r=t.acquireIndexList(e.isNode),o=t.acquireIndexList(e.isNode),a=t.getObjectList(e.isNode);for(let l=0;l<e._indexes.length;l++){const d=e._indexes[l],h=a.get(d);h!==void 0&&(s(h,i)?r:o).pushUnchecked(d)}return{valid:n(r.sliceAndReset()),invalid:n(o.sliceAndReset())}}function Mp(t,e,s,i){const n=t.getObjectList(e.isNode);let r=i;for(let o=0;o<e._indexes.length;++o){const a=e._indexes[o];r=s(r,n.get(a),o)}return r}function Np(t,e){const s=e.isNode,i=t.topology.getDeduper(s),n=t.acquireIndexList(s),r=t.getListFactory(s);for(let o=0;o<e._indexes.length;o++){const a=e._indexes[o];i.get(a)===0&&(i.set(a,1),n.push(a))}return r(n.sliceAndReset())}function Pp(t,e,s){const i=e.isNode,n=s.topology.getDeduper(i),r=s.acquireIndexList(i),o=s.getListFactory(i);for(let a=0;a<e._indexes.length;a++){const l=e._indexes[a];n.set(l,1)}for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];n.get(l)===0&&r.push(l)}return o(r.sliceAndReset())}function Fp(t,e){const s=e.isNode,i=t.storage.fetch(s),n=i.getFlexArray("excluded"),r=i.getMaxIndex(),o=t.topology.getDeduper(s),a=t.acquireIndexList(s),l=t.getListFactory(s);for(let d=0;d<e._indexes.length;d++)o.set(e._indexes[d],1);for(let d=1;d<=r;++d)o.get(d)===0&&n.get(d)===0&&a.push(d);return l(a.sliceAndReset())}function kp(t,e,s){const i=t.getListFactory(e.isNode),n=new Uint32Array(e._indexes.length+s._indexes.length);return n.set(e._indexes),n.set(s._indexes,e._indexes.length),i(n)}function Dp(t,e){return t.getObjectList(e.isNode).getMultiple(e._indexes)}function Ol(t,e){const s=t.getStorage(e.isNode);if(e.isList){const i=new Array(e.size);for(let n=0;n<e._indexes.length;++n)i[n]=s.getId(e._indexes[n]);return i}return s.getId(e._index)}function Rp(t,e){return t.topology.getExtremity(!0,e)}function Op(t,e){return t.topology.getExtremity(!1,e)}function zp(t,e,s){return t.getObjectList(e.isNode).get(e._indexes[s])}function Bp(t,e,s){const i=t.getListFactory(e.isNode),n=t.getObjectList(e.isNode),r=e._indexes.slice();return r.sort((o,a)=>{const l=n.get(o),d=n.get(a);return s(l,d)}),i(r)}var eA=[];function Up(t){typeof t=="object"&&t!==null||(t={});const e=typeof t.data=="function"?t.data:Xs;return{attributes:Array.isArray(t.attributes)?t.attributes:t.attributes||eA,data:e}}function zl(t,e){for(const s of t){const i=e;Object.keys(i).forEach(n=>{const r=i[n];s.prototype[n]=function(o,a){return Gi(`Deprecated method "${n}"; please use "${r}" instead.`),this[r](o,a)}})}}function tg(t){const e=t.getFlexArray("removed"),s=t.getFlexArray("excluded"),i=t.getFlexArray("virtual");return{all:n=>e.get(n)===0,visible:n=>s.get(n)===0,excluded:n=>s.get(n)===1,raw:n=>i.get(n)===0&&e.get(n)===0,_all:n=>!0}}function eg(t,e,s){return{all:Go(s.all,t,e),visible:Go(s.visible,t,e),raw:Go(s.raw,t,e),_all:Go(s._all,t,e)}}function Go(t,e,s){let i=null;return{getList(){if(!i){const n=e(),r=s();r.reset();for(let o=1;o<=n;++o)t(o)&&r.push(o);i=r.sliceAndReset()}return i},invalidList(){i=null}}}function sA(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`${t} is not a valid id, expected string or number`);return t}var sg=new Uint32Array(1),Hi=class{constructor(t,e){this.size=1,this.isNode=!1,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return sg[0]=this._index,sg}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}hasParallelEdges(){return this._ogma.modules.graph.hasParallelEdges(this)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.filter(s=>s!==this).dedupe()}}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.modules.graph.edgeList(new Uint32Array([this._index]))}getId(){return Ol(this._ogma.modules.graph,this)}getSource(){return Rp(this._ogma.modules.graph,this)}getTarget(){return Op(this._ogma.modules.graph,this)}getExtremities(){return this._ogma.modules.graph.nodeList(new Uint32Array([this.getSource()._index,this.getTarget()._index]))}setSource(t){this._ogma.modules.graph.setSource(this,t)}setTarget(t){this._ogma.modules.graph.setTarget(this,t)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Up(t);return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(e),data:s(Pe(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdge(this)}getSubEdges(){return this._ogma.modules.transformations.getSubEdges(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};zl([Hi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var Tn=class{constructor(t,e){this.isList=!0,this.isNode=!1,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.subtract(this).dedupe()}}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map(t=>this._ogma.modules.transformations.isElementVirtual(t))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Dp(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.edgeList(this._indexes.slice())}getId(){return Ol(this._ogma.modules.graph,this)}getSource(){return Rp(this._ogma.modules.graph,this)}getTarget(){return Op(this._ogma.modules.graph,this)}getExtremities(){return this.getSource().concat(this.getTarget())}get(t){return zp(this._ogma.modules.graph,this,t)}forEach(t){Tp(this._ogma.modules.graph,this,t)}map(t){return Ip(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return Lp(this._ogma.modules.graph,this,t)}reduce(t,e){return Mp(this._ogma.modules.graph,this,t,e)}concat(t){return kp(this._ogma.modules.graph,this,t)}dedupe(){return Np(this._ogma.modules.graph,this)}subtract(t){return Pp(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.edgeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof Hi?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}sort(t){return Bp(this._ogma.modules.graph,this,t)}inverse(){return Fp(this._ogma.modules.graph,this)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!es(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdges(this)}getSubEdges(){return this.map(this._ogma.modules.transformations.getSubEdges)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};zl([Tn],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var ti="geo.latitude",ei="geo.longitude",ig="geo.prevLat",od="geo.prevLng",dh=85.0511287798,iA=6378137,el=1,nA='Map data &copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap contributors</a>',an={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:22,minZoomLevel:0,wrapCoordinates:!0,tileUrlTemplate:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:void 0,backgroundColor:"silver",opacity:1,duration:0,disableNodeDragging:!0,tileBuffer:1,sizeRatio:1,tiles:{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",subdomains:"abc",tms:!1,wms:!1},crs:void 0},rA={maxBoundsViscosity:1,worldCopyJump:!0,zoomControl:!1,attributionControl:!1};function Oi(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function zs(t,e,s){return Math.max(e,Math.min(s,t))}function hh(t,e,s){return t+(e-t)*s}function ue(t,e,s){return t*(1-s)+e*s}function Wn(t){if(!t.length)return-1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n>e&&(e=n)}return e}function mi(t){if(!t.length)return 1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n<e&&(e=n)}return e}var Gp=(t,e)=>Math.log(t)/Math.log(e),sl=t=>t<-Math.PI?t+2*Math.PI:t>Math.PI?t-2*Math.PI:t,oA=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let s=0;for(let i=0;i<this._n&&i<32;i++){const n=e[i],r=t+n,o=Math.abs(t)<Math.abs(n)?t-(r-n):n-(r-t);o&&(e[s++]=o),t=r}return e[s]=t,this._n=s+1,this}valueOf(){const t=this._partials;let e,s,i,n=this._n,r=0;if(n>0){for(r=t[--n];n>0&&(e=r,s=t[--n],r=e+s,i=s-(r-e),!i););n>0&&(i<0&&t[n-1]<0||i>0&&t[n-1]>0)&&(s=2*i,e=r+s,s==e-r&&(r=e))}return r}};function*aA(t){for(const e of t)yield*nv(e)}function Vp(t){return Array.from(aA(t))}var be=1e-6,lA=1e-12,le=Math.PI,ks=le/2,ng=le/4,Ys=2*le,di=180/le,Ts=le/180,Ue=Math.abs,dA=Math.atan,rr=Math.atan2,Ne=Math.cos,Ie=Math.sin,hA=Math.sign||function(t){return t>0?1:t<0?-1:0},To=Math.sqrt;function jp(t){return t>1?0:t<-1?le:Math.acos(t)}function or(t){return t>1?ks:t<-1?-ks:Math.asin(t)}function Rr(){}function il(t,e){t&&og.hasOwnProperty(t.type)&&og[t.type](t,e)}var rg={Feature:function(t,e){il(t.geometry,e)},FeatureCollection:function(t,e){for(var s=t.features,i=-1,n=s.length;++i<n;)il(s[i].geometry,e)}},og={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)t=s[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){uh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)uh(s[i],e,0)},Polygon:function(t,e){ag(t.coordinates,e)},MultiPolygon:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)ag(s[i],e)},GeometryCollection:function(t,e){for(var s=t.geometries,i=-1,n=s.length;++i<n;)il(s[i],e)}};function uh(t,e,s){var i,n=-1,r=t.length-s;for(e.lineStart();++n<r;)i=t[n],e.point(i[0],i[1],i[2]);e.lineEnd()}function ag(t,e){var s=-1,i=t.length;for(e.polygonStart();++s<i;)uh(t[s],e,1);e.polygonEnd()}function uA(t,e){t&&rg.hasOwnProperty(t.type)?rg[t.type](t,e):il(t,e)}function ch(t){return[rr(t[1],t[0]),or(t[2])]}function ar(t){var e=t[0],s=t[1],i=Ne(s);return[i*Ne(e),i*Ie(e),Ie(s)]}function Vo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nl(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ad(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function jo(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function gh(t){var e=To(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function mh(t,e){function s(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(s.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),s}function _h(t,e){return Ue(t)>le&&(t-=Math.round(t/Ys)*Ys),[t,e]}function cA(t,e,s){return(t%=Ys)?e||s?mh(dg(t),hg(e,s)):dg(t):e||s?hg(e,s):_h}function lg(t){return function(e,s){return Ue(e+=t)>le&&(e-=Math.round(e/Ys)*Ys),[e,s]}}function dg(t){var e=lg(t);return e.invert=lg(-t),e}function hg(t,e){var s=Ne(t),i=Ie(t),n=Ne(e),r=Ie(e);function o(a,l){var d=Ne(l),h=Ne(a)*d,u=Ie(a)*d,c=Ie(l),g=c*s+h*i;return[rr(u*n-g*r,h*s-c*i),or(g*n+u*r)]}return o.invert=function(a,l){var d=Ne(l),h=Ne(a)*d,u=Ie(a)*d,c=Ie(l),g=c*n-u*r;return[rr(u*n+c*r,h*s+g*i),or(g*s-h*i)]},o}function gA(t,e,s,i,n,r){if(s){var o=Ne(e),a=Ie(e),l=i*s;n==null?(n=e+i*Ys,r=e-l/2):(n=ug(o,n),r=ug(o,r),(i>0?n<r:n>r)&&(n+=i*Ys));for(var d,h=n;i>0?h>r:h<r;h-=l)d=ch([o,-a*Ne(h),-a*Ie(h)]),t.point(d[0],d[1])}}function ug(t,e){(e=ar(e))[0]-=t,gh(e);var s=jp(-e[1]);return((-e[2]<0?-s:s)+Ys-be)%Ys}function Hp(){var t,e=[];return{point:function(s,i,n){t.push([s,i,n])},lineStart:function(){e.push(t=[])},lineEnd:Rr,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var s=e;return e=[],t=null,s}}}function za(t,e){return Ue(t[0]-e[0])<be&&Ue(t[1]-e[1])<be}function Ho(t,e,s,i){this.x=t,this.z=e,this.o=s,this.e=i,this.v=!1,this.n=this.p=null}function Wp(t,e,s,i,n){var r,o,a=[],l=[];if(t.forEach(function(m){if(!((_=m.length-1)<=0)){var _,f,p=m[0],x=m[_];if(za(p,x)){if(!p[2]&&!x[2]){for(n.lineStart(),r=0;r<_;++r)n.point((p=m[r])[0],p[1]);return void n.lineEnd()}x[0]+=2*be}a.push(f=new Ho(p,m,null,!0)),l.push(f.o=new Ho(p,null,f,!1)),a.push(f=new Ho(x,m,null,!1)),l.push(f.o=new Ho(x,null,f,!0))}}),a.length){for(l.sort(e),cg(a),cg(l),r=0,o=l.length;r<o;++r)l[r].e=s=!s;for(var d,h,u=a[0];;){for(var c=u,g=!0;c.v;)if((c=c.n)===u)return;d=c.z,n.lineStart();do{if(c.v=c.o.v=!0,c.e){if(g)for(r=0,o=d.length;r<o;++r)n.point((h=d[r])[0],h[1]);else i(c.x,c.n.x,1,n);c=c.n}else{if(g)for(d=c.p.z,r=d.length-1;r>=0;--r)n.point((h=d[r])[0],h[1]);else i(c.x,c.p.x,-1,n);c=c.p}d=(c=c.o).z,g=!g}while(!c.v);n.lineEnd()}}}function cg(t){if(e=t.length){for(var e,s,i=0,n=t[0];++i<e;)n.n=s=t[i],s.p=n,n=s;n.n=s=t[0],s.p=n}}function ld(t){return Ue(t[0])<=le?t[0]:hA(t[0])*((Ue(t[0])+le)%Ys-le)}function mA(t,e){var s=ld(e),i=e[1],n=Ie(i),r=[Ie(s),-Ne(s),0],o=0,a=0,l=new oA;n===1?i=ks+be:n===-1&&(i=-ks-be);for(var d=0,h=t.length;d<h;++d)if(c=(u=t[d]).length)for(var u,c,g=u[c-1],m=ld(g),_=g[1]/2+ng,f=Ie(_),p=Ne(_),x=0;x<c;++x,m=b,f=E,p=A,g=y){var y=u[x],b=ld(y),v=y[1]/2+ng,E=Ie(v),A=Ne(v),S=b-m,T=S>=0?1:-1,L=T*S,I=L>le,R=f*E;if(l.add(rr(R*T*Ie(L),p*A+R*Ne(L))),o+=I?S+T*Ys:S,I^m>=s^b>=s){var z=nl(ar(g),ar(y));gh(z);var j=nl(r,z);gh(j);var C=(I^S>=0?-1:1)*or(j[2]);(i>C||i===C&&(z[0]||z[1]))&&(a+=I^S>=0?1:-1)}}return(o<-be||o<be&&l<-lA)^1&a}function Xp(t,e,s,i){return function(n){var r,o,a,l=e(n),d=Hp(),h=e(d),u=!1,c={point:g,lineStart:_,lineEnd:f,polygonStart:function(){c.point=p,c.lineStart=x,c.lineEnd=y,o=[],r=[]},polygonEnd:function(){c.point=g,c.lineStart=_,c.lineEnd=f,o=Vp(o);var b=mA(r,i);o.length?(u||(n.polygonStart(),u=!0),Wp(o,fA,b,s,n)):b&&(u||(n.polygonStart(),u=!0),n.lineStart(),s(null,null,1,n),n.lineEnd()),u&&(n.polygonEnd(),u=!1),o=r=null},sphere:function(){n.polygonStart(),n.lineStart(),s(null,null,1,n),n.lineEnd(),n.polygonEnd()}};function g(b,v){t(b,v)&&n.point(b,v)}function m(b,v){l.point(b,v)}function _(){c.point=m,l.lineStart()}function f(){c.point=g,l.lineEnd()}function p(b,v){a.push([b,v]),h.point(b,v)}function x(){h.lineStart(),a=[]}function y(){p(a[0][0],a[0][1]),h.lineEnd();var b,v,E,A,S=h.clean(),T=d.result(),L=T.length;if(a.pop(),r.push(a),a=null,L)if(1&S){if((v=(E=T[0]).length-1)>0){for(u||(n.polygonStart(),u=!0),n.lineStart(),b=0;b<v;++b)n.point((A=E[b])[0],A[1]);n.lineEnd()}}else L>1&&2&S&&T.push(T.pop().concat(T.shift())),o.push(T.filter(_A))}return c}}function _A(t){return t.length>1}function fA(t,e){return((t=t.x)[0]<0?t[1]-ks-be:ks-t[1])-((e=e.x)[0]<0?e[1]-ks-be:ks-e[1])}_h.invert=_h;var gg=Xp(function(){return!0},pA,xA,[-le,-ks]);function pA(t){var e,s=NaN,i=NaN,n=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(r,o){var a=r>0?le:-le,l=Ue(r-s);Ue(l-le)<be?(t.point(s,i=(i+o)/2>0?ks:-ks),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(r,i),e=0):n!==a&&l>=le&&(Ue(s-n)<be&&(s-=n*be),Ue(r-a)<be&&(r-=a*be),i=yA(s,i,r,o),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),e=0),t.point(s=r,i=o),n=a},lineEnd:function(){t.lineEnd(),s=i=NaN},clean:function(){return 2-e}}}function yA(t,e,s,i){var n,r,o=Ie(t-s);return Ue(o)>be?dA((Ie(e)*(r=Ne(i))*Ie(s)-Ie(i)*(n=Ne(e))*Ie(t))/(n*r*o)):(e+i)/2}function xA(t,e,s,i){var n;if(t==null)n=s*ks,i.point(-le,n),i.point(0,n),i.point(le,n),i.point(le,0),i.point(le,-n),i.point(0,-n),i.point(-le,-n),i.point(-le,0),i.point(-le,n);else if(Ue(t[0]-e[0])>be){var r=t[0]<e[0]?le:-le;n=s*r/2,i.point(-r,n),i.point(0,n),i.point(r,n)}else i.point(e[0],e[1])}function bA(t){var e=Ne(t),s=2*Ts,i=e>0,n=Ue(e)>be;function r(l,d){return Ne(l)*Ne(d)>e}function o(l,d,h){var u=[1,0,0],c=nl(ar(l),ar(d)),g=Vo(c,c),m=c[0],_=g-m*m;if(!_)return!h&&l;var f=e*g/_,p=-e*m/_,x=nl(u,c),y=jo(u,f);ad(y,jo(c,p));var b=x,v=Vo(y,b),E=Vo(b,b),A=v*v-E*(Vo(y,y)-1);if(!(A<0)){var S=To(A),T=jo(b,(-v-S)/E);if(ad(T,y),T=ch(T),!h)return T;var L,I=l[0],R=d[0],z=l[1],j=d[1];R<I&&(L=I,I=R,R=L);var C=R-I,w=Ue(C-le)<be;if(!w&&j<z&&(L=z,z=j,j=L),w||C<be?w?z+j>0^T[1]<(Ue(T[0]-I)<be?z:j):z<=T[1]&&T[1]<=j:C>le^(I<=T[0]&&T[0]<=R)){var H=jo(b,(-v+S)/E);return ad(H,y),[T,ch(H)]}}}function a(l,d){var h=i?t:le-t,u=0;return l<-h?u|=1:l>h&&(u|=2),d<-h?u|=4:d>h&&(u|=8),u}return Xp(r,function(d){var h,u,c,g,m;return{lineStart:function(){g=c=!1,m=1},point:function(_,f){var p,x=[_,f],y=r(_,f),b=i?y?0:a(_,f):y?a(_+(_<0?le:-le),f):0;if(!h&&(g=c=y)&&d.lineStart(),y!==c&&(!(p=o(h,x))||za(h,p)||za(x,p))&&(x[2]=1),y!==c)m=0,y?(d.lineStart(),p=o(x,h),d.point(p[0],p[1])):(p=o(h,x),d.point(p[0],p[1],2),d.lineEnd()),h=p;else if(n&&h&&i^y){var v;b&u||!(v=o(x,h,!0))||(m=0,i?(d.lineStart(),d.point(v[0][0],v[0][1]),d.point(v[1][0],v[1][1]),d.lineEnd()):(d.point(v[1][0],v[1][1]),d.lineEnd(),d.lineStart(),d.point(v[0][0],v[0][1],3)))}!y||h&&za(h,x)||d.point(x[0],x[1]),h=x,c=y,u=b},lineEnd:function(){c&&d.lineEnd(),h=null},clean:function(){return m|(g&&c)<<1}}},function(d,h,u,c){gA(c,t,s,u,d,h)},i?[0,-t]:[-le,t-le])}function vA(t,e,s,i,n,r){var o,a=t[0],l=t[1],d=0,h=1,u=e[0]-a,c=e[1]-l;if(o=s-a,u||!(o>0)){if(o/=u,u<0){if(o<d)return;o<h&&(h=o)}else if(u>0){if(o>h)return;o>d&&(d=o)}if(o=n-a,u||!(o<0)){if(o/=u,u<0){if(o>h)return;o>d&&(d=o)}else if(u>0){if(o<d)return;o<h&&(h=o)}if(o=i-l,c||!(o>0)){if(o/=c,c<0){if(o<d)return;o<h&&(h=o)}else if(c>0){if(o>h)return;o>d&&(d=o)}if(o=r-l,c||!(o<0)){if(o/=c,c<0){if(o>h)return;o>d&&(d=o)}else if(c>0){if(o<d)return;o<h&&(h=o)}return d>0&&(t[0]=a+d*u,t[1]=l+d*c),h<1&&(e[0]=a+h*u,e[1]=l+h*c),!0}}}}}var Or=1e9,Wo=-Or;function EA(t,e,s,i){function n(d,h){return t<=d&&d<=s&&e<=h&&h<=i}function r(d,h,u,c){var g=0,m=0;if(d==null||(g=o(d,u))!==(m=o(h,u))||l(d,h)<0^u>0)do c.point(g===0||g===3?t:s,g>1?i:e);while((g=(g+u+4)%4)!==m);else c.point(h[0],h[1])}function o(d,h){return Ue(d[0]-t)<be?h>0?0:3:Ue(d[0]-s)<be?h>0?2:1:Ue(d[1]-e)<be?h>0?1:0:h>0?3:2}function a(d,h){return l(d.x,h.x)}function l(d,h){var u=o(d,1),c=o(h,1);return u!==c?u-c:u===0?h[1]-d[1]:u===1?d[0]-h[0]:u===2?d[1]-h[1]:h[0]-d[0]}return function(d){var h,u,c,g,m,_,f,p,x,y,b,v=d,E=Hp(),A={point:S,lineStart:function(){A.point=T,u&&u.push(c=[]),y=!0,x=!1,f=p=NaN},lineEnd:function(){h&&(T(g,m),_&&x&&E.rejoin(),h.push(E.result())),A.point=S,x&&v.lineEnd()},polygonStart:function(){v=E,h=[],u=[],b=!0},polygonEnd:function(){var I=function(){for(var C=0,w=0,H=u.length;w<H;++w)for(var K,it,xt=u[w],at=1,Tt=xt.length,It=xt[0],dt=It[0],bt=It[1];at<Tt;++at)K=dt,it=bt,dt=(It=xt[at])[0],bt=It[1],it<=i?bt>i&&(dt-K)*(i-it)>(bt-it)*(t-K)&&++C:bt<=i&&(dt-K)*(i-it)<(bt-it)*(t-K)&&--C;return C}(),R=b&&I,z=(h=Vp(h)).length;(R||z)&&(d.polygonStart(),R&&(d.lineStart(),r(null,null,1,d),d.lineEnd()),z&&Wp(h,a,I,r,d),d.polygonEnd()),v=d,h=u=c=null}};function S(L,I){n(L,I)&&v.point(L,I)}function T(L,I){var R=n(L,I);if(u&&c.push([L,I]),y)g=L,m=I,_=R,y=!1,R&&(v.lineStart(),v.point(L,I));else if(R&&x)v.point(L,I);else{var z=[f=Math.max(Wo,Math.min(Or,f)),p=Math.max(Wo,Math.min(Or,p))],j=[L=Math.max(Wo,Math.min(Or,L)),I=Math.max(Wo,Math.min(Or,I))];vA(z,j,t,e,s,i)?(x||(v.lineStart(),v.point(z[0],z[1])),v.point(j[0],j[1]),R||v.lineEnd(),b=!1):R&&(v.lineStart(),v.point(L,I),b=!1)}f=L,p=I,x=R}return A}}var mg=t=>t,lr=1/0,rl=lr,uo=-lr,ol=uo,AA={point:SA,lineStart:Rr,lineEnd:Rr,polygonStart:Rr,polygonEnd:Rr,result:function(){var t=[[lr,rl],[uo,ol]];return uo=ol=-(rl=lr=1/0),t}};function SA(t,e){t<lr&&(lr=t),t>uo&&(uo=t),e<rl&&(rl=e),e>ol&&(ol=e)}var _g=AA;function zu(t){return function(e){var s=new fh;for(var i in t)s[i]=t[i];return s.stream=e,s}}function fh(){}function Bu(t,e,s){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),uA(s,t.stream(_g)),e(_g.result()),i!=null&&t.clipExtent(i),t}function Yp(t,e,s){return Bu(t,function(i){var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(n/(i[1][0]-i[0][0]),r/(i[1][1]-i[0][1])),a=+e[0][0]+(n-o*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(r-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([a,l])},s)}function wA(t,e,s){return Yp(t,[[0,0],e],s)}function TA(t,e,s){return Bu(t,function(i){var n=+e,r=n/(i[1][0]-i[0][0]),o=(n-r*(i[1][0]+i[0][0]))/2,a=-r*i[0][1];t.scale(150*r).translate([o,a])},s)}function IA(t,e,s){return Bu(t,function(i){var n=+e,r=n/(i[1][1]-i[0][1]),o=-r*i[0][0],a=(n-r*(i[1][1]+i[0][1]))/2;t.scale(150*r).translate([o,a])},s)}fh.prototype={constructor:fh,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var fg=16,LA=Ne(30*Ts);function pg(t,e){return+e?MA(t,e):CA(t)}function CA(t){return zu({point:function(e,s){e=t(e,s),this.stream.point(e[0],e[1])}})}function MA(t,e){function s(i,n,r,o,a,l,d,h,u,c,g,m,_,f){var p=d-i,x=h-n,y=p*p+x*x;if(y>4*e&&_--){var b=o+c,v=a+g,E=l+m,A=To(b*b+v*v+E*E),S=or(E/=A),T=Ue(Ue(E)-1)<be||Ue(r-u)<be?(r+u)/2:rr(v,b),L=t(T,S),I=L[0],R=L[1],z=I-i,j=R-n,C=x*z-p*j;(C*C/y>e||Ue((p*z+x*j)/y-.5)>.3||o*c+a*g+l*m<LA)&&(s(i,n,r,o,a,l,I,R,T,b/=A,v/=A,E,_,f),f.point(I,R),s(I,R,T,b,v,E,d,h,u,c,g,m,_,f))}}return function(i){var n,r,o,a,l,d,h,u,c,g,m,_,f={point:p,lineStart:x,lineEnd:b,polygonStart:function(){i.polygonStart(),f.lineStart=v},polygonEnd:function(){i.polygonEnd(),f.lineStart=x}};function p(S,T){S=t(S,T),i.point(S[0],S[1])}function x(){u=NaN,f.point=y,i.lineStart()}function y(S,T){var L=ar([S,T]),I=t(S,T);s(u,c,h,g,m,_,u=I[0],c=I[1],h=S,g=L[0],m=L[1],_=L[2],fg,i),i.point(u,c)}function b(){f.point=p,i.lineEnd()}function v(){x(),f.point=E,f.lineEnd=A}function E(S,T){y(n=S,T),r=u,o=c,a=g,l=m,d=_,f.point=y}function A(){s(u,c,h,g,m,_,r,o,n,a,l,d,fg,i),f.lineEnd=b,b()}return f}}var NA=zu({point:function(t,e){this.stream.point(t*Ts,e*Ts)}});function PA(t){return zu({point:function(e,s){var i=t(e,s);return this.stream.point(i[0],i[1])}})}function FA(t,e,s,i,n){function r(o,a){return[e+t*(o*=i),s-t*(a*=n)]}return r.invert=function(o,a){return[(o-e)/t*i,(s-a)/t*n]},r}function yg(t,e,s,i,n,r){if(!r)return FA(t,e,s,i,n);var o=Ne(r),a=Ie(r),l=o*t,d=a*t,h=o/t,u=a/t,c=(a*s-o*e)/t,g=(a*e+o*s)/t;function m(_,f){return[l*(_*=i)-d*(f*=n)+e,s-d*_-l*f]}return m.invert=function(_,f){return[i*(h*_-u*f+c),n*(g-u*_-h*f)]},m}function kA(t){return DA(function(){return t})()}function DA(t){var e,s,i,n,r,o,a,l,d,h,u=150,c=480,g=250,m=0,_=0,f=0,p=0,x=0,y=0,b=1,v=1,E=null,A=gg,S=null,T=mg,L=.5;function I(C){return l(C[0]*Ts,C[1]*Ts)}function R(C){return(C=l.invert(C[0],C[1]))&&[C[0]*di,C[1]*di]}function z(){var C=yg(u,0,0,b,v,y).apply(null,e(m,_)),w=yg(u,c-C[0],g-C[1],b,v,y);return s=cA(f,p,x),a=mh(e,w),l=mh(s,a),o=pg(a,L),j()}function j(){return d=h=null,I}return I.stream=function(C){return d&&h===C?d:d=NA(PA(s)(A(o(T(h=C)))))},I.preclip=function(C){return arguments.length?(A=C,E=void 0,j()):A},I.postclip=function(C){return arguments.length?(T=C,S=i=n=r=null,j()):T},I.clipAngle=function(C){return arguments.length?(A=+C?bA(E=C*Ts):(E=null,gg),j()):E*di},I.clipExtent=function(C){return arguments.length?(T=C==null?(S=i=n=r=null,mg):EA(S=+C[0][0],i=+C[0][1],n=+C[1][0],r=+C[1][1]),j()):S==null?null:[[S,i],[n,r]]},I.scale=function(C){return arguments.length?(u=+C,z()):u},I.translate=function(C){return arguments.length?(c=+C[0],g=+C[1],z()):[c,g]},I.center=function(C){return arguments.length?(m=C[0]%360*Ts,_=C[1]%360*Ts,z()):[m*di,_*di]},I.rotate=function(C){return arguments.length?(f=C[0]%360*Ts,p=C[1]%360*Ts,x=C.length>2?C[2]%360*Ts:0,z()):[f*di,p*di,x*di]},I.angle=function(C){return arguments.length?(y=C%360*Ts,z()):y*di},I.reflectX=function(C){return arguments.length?(b=C?-1:1,z()):b<0},I.reflectY=function(C){return arguments.length?(v=C?-1:1,z()):v<0},I.precision=function(C){return arguments.length?(o=pg(a,L=C*C),j()):To(L)},I.fitExtent=function(C,w){return Yp(I,C,w)},I.fitSize=function(C,w){return wA(I,C,w)},I.fitWidth=function(C,w){return TA(I,C,w)},I.fitHeight=function(C,w){return IA(I,C,w)},function(){return e=t.apply(this,arguments),I.invert=e.invert&&R,z()}}function RA(t){return function(e,s){var i=Ne(e),n=Ne(s),r=t(i*n);return r===1/0?[2,0]:[r*n*Ie(e),r*Ie(s)]}}function OA(t){return function(e,s){var i=To(e*e+s*s),n=t(i),r=Ie(n),o=Ne(n);return[rr(e*r,i*o),or(i&&s*r/i)]}}var $p=RA(function(t){return(t=jp(t))&&t/Ie(t)});function zA(){return kA($p).scale(79.4188).clipAngle(179.999)}function xg(t,e){t&&e!==void 0&&isFinite(e)&&t.setOpacity&&t.setOpacity(e)}function bg(){return ji||typeof global<"u"&&!global.process}function dd(t){return Math.log2(t)+el}function BA(t){return 2**(t-el)}function vg(t){return t!=null&&!isNaN(t)}function qp(t,e){return Jp(t,e,"longitude")}function Zp(t,e){return Jp(t,e,"latitude")}function Jp(t,e,s){if(isNaN(e))throw new TypeError(`node ${t}: ${e} is not a valid ${s}`)}$p.invert=OA(function(t){return t});var UA=t=>Math.pow(2,Math.ceil(Math.log2(t)));function GA(t,e){return e==null&&t.url===an.tiles.url?nA:null}function VA(t={},e){const{tileUrlSubdomains:s,tileUrlTemplate:i,attribution:n,attributionOptions:r,latitudePath:o,longitudePath:a,sizeRatio:l,tiles:d}=t;if(i!=null&&typeof i!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a URL string");if(s!=null&&typeof s!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a string");if(d!=null){if(!(He(d)||d instanceof e.Layer))throw new TypeError("Geo mode: tiles must be a object or L.Layer instance");const h=d;if(h.url!=null&&typeof h.url!="string")throw new TypeError("Geo mode: tiles.url must be a string");if(h.subdomains!=null&&typeof h.subdomains!="string")throw new TypeError("Geo mode: tiles.subdomains must be a string");if(h.tms&&typeof h.tms!="boolean")throw new TypeError("Geo mode: tiles.tms must be a boolean");if(h.wms&&typeof h.wms!="boolean")throw new TypeError("Geo mode: tiles.wms must be a boolean")}if(n!=null&&typeof n!="string")throw new TypeError("Geo mode: Map attribution must be a string");if(r!=null&&!He(r))throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object");if(o!=null&&typeof o!="string"&&!Array.isArray(o))throw new TypeError("Geo mode: Latitude path must be a valid property path: a string or an array of strings.");if(a!=null&&typeof a!="string"&&!Array.isArray(a))throw new TypeError("Geo mode: Longitude path must be a valid property path: a string or an array of strings.");if(l!=null&&(!isFinite(l)||l<=0))throw new TypeError("Geo mode: sizeRatio must be a positive number.")}function jA(t,e={}){if(e.tiles===void 0||e.tileUrlTemplate||e.tileUrlSubdomains){const s=an.tiles;return ct(ct(ct({},e.tiles||{}),an.tiles),{url:e.tileUrlTemplate||s.url,subdomains:e.tileUrlSubdomains||s.subdomains})}return He(e.tiles)?ct(ct({},t.tiles),e.tiles):e.tiles}function HA(t,e){return t.attribution!==e.attribution||t.tiles!==e.tiles}var WA=Ai().createElement("div");function XA(t){const e=Ai().createElement("div");e.className="ogma-geo-container",Sn(e,"100%","100%");const s=t||WA;return s.insertBefore(e,s.firstChild),e}function YA(t){const e=[[1/0,1/0],[-1/0,-1/0]];return t.getGeoCoordinates().reduce((s,{latitude:i,longitude:n})=>{const[r,o]=s;return r[0]=Math.min(r[0],i),r[1]=Math.min(r[1],n),o[0]=Math.max(o[0],i),o[1]=Math.max(o[1],n),s},e)}function $A(t,e,s,i){const n=e._indexes;t.getNodeAttribute(ti).setMultiple(n,s),t.getNodeAttribute(ei).setMultiple(n,i)}function qA(t,e,s){const{longitudePath:i,latitudePath:n,wrapCoordinates:r}=s,[o,a]=t.getAttributes(!0,[ti,ei]),l=e._indexes,d=e.getId(),h=l.length,u=e.getData(n),c=e.getData(i);for(let g=0;g<h;g++){let m=c[g],_=u[g];const f=l[g],p=d[g];_!=null&&m!=null&&(qp(p,m),Zp(p,_),r&&(m%=180,_=zs(+_,-dh,dh)),a.set(f,m),o.set(f,_))}}function ZA(t,{longitudePath:e,latitudePath:s,wrapCoordinates:i},n){const r=t.getData(e),o=t.getData(s);return r!=null&&o!=null&&(!(!i&&!n)||Math.abs(o)<=dh&&Math.abs(r)<=180)}function Xo(t,e,s,i){JA(t,!0,e,s,i)}function JA(t,e,s,i,n){const r=t.getAttribute(e,i),o=t.getAttribute(e,n),a=s._indexes;o.setMultiple(a,r.getMultiple(a))}function KA(t){return t.reduce((e,{nodes:s,newValues:i})=>{if(!s)return e;const n=s.filter((r,o)=>i[o]!=null);return e?e.concat(n):n},null)}function QA(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","radius"]).forEach(({text:s,radius:i},n)=>{e[t.get(n).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:s.minVisibleSize,size:Math.max(1,Number(i))}}),e}function Eg(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","minVisibleSize","width"]).forEach(({text:s,minVisibleSize:i,width:n},r)=>{e[t.get(r).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:i,size:Math.max(1,Number(n))}}),e}function t1(t,e,s){if(!e||!Object.keys(e).length)return Promise.resolve();const i=t.getId().filter(n=>e[n]).map(n=>{if(!e[n])return 0;const r=Number(e[n]["text.minVisibleSize"]),o=Number(e[n].minVisibleSize),a=Number(e[n]["text.size"]),l=Number(e[n]["text.scale"]),d=Number(e[n].size)*l*s;return d<=o||d<=r?0:a});return t.setAttribute("text.size",i)}function e1(t,e){const s=t.getId().map(i=>{const n=e[i]||{};return Number(n["text.size"])});return t.setAttribute("text.size",s)}var s1=t=>zA().rotate([-t.longitude,-t.latitude]).scale(iA),Ag=new Uint32Array(1),ni=class{constructor(t,e){this.size=1,this.isNode=!0,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return Ag[0]=this._index,Ag}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this._ogma.modules.camera.graphToScreenCoordinates(this.getPosition())}isInScreen(){const t=this.getPositionOnScreen(),e=this._ogma.modules.camera;return t.x>=0&&t.x<=e.width&&t.y>=0&&t.y<=e.height}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)[0]}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}getConnectedComponent(t){return this._ogma.modules.graph.getConnectedComponentByNode(this,t)[0]}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.nodeList(new Uint32Array([+this._index]))}getId(){return Ol(this._ogma.modules.graph,this)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Up(t),i=this.getAttributes(e);return{id:this.getId(),attributes:i,data:s(Pe(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getGeoCoordinates(){const t=this._ogma.modules.graph,e=t.getNodeAttribute(ti).get(this._index),s=t.getNodeAttribute(ei).get(this._index);return{latitude:vg(e)?e:void 0,longitude:vg(s)?s:void 0}}setGeoCoordinates(t){return this.toList().setGeoCoordinates([t]).then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNode(this)}getSubNodes(){return this._ogma.modules.transformations.getSubNodes(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};zl([ni],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var Si=class{constructor(t,e){this.isList=!0,this.isNode=!0,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this.getPosition().map(t=>this._ogma.modules.camera.graphToScreenCoordinates(t))}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)}getConnectedComponents(t){return this._ogma.modules.graph.getConnectedComponents(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map(t=>this._ogma.modules.transformations.isElementVirtual(t))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Dp(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.nodeList(this._indexes.slice())}getId(){return Ol(this._ogma.modules.graph,this)}get(t){return zp(this._ogma.modules.graph,this,t)}forEach(t){Tp(this._ogma.modules.graph,this,t)}map(t){return Ip(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return Lp(this._ogma.modules.graph,this,t)}reduce(t,e){return Mp(this._ogma.modules.graph,this,t,e)}concat(t){return kp(this._ogma.modules.graph,this,t)}dedupe(){return Np(this._ogma.modules.graph,this)}subtract(t){return Pp(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.nodeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof ni?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}inverse(){return Fp(this._ogma.modules.graph,this)}sort(t){return Bp(this._ogma.modules.graph,this,t)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!es(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getGeoCoordinates(){const t=this._ogma.modules.graph,e=new Array(this._indexes.length),s=t.getNodeAttribute(ti).getMultiple(this._indexes),i=t.getNodeAttribute(ei).getMultiple(this._indexes);for(let n=0,r=this._indexes.length;n<r;n++)e[n]={latitude:s[n],longitude:i[n]};return e}setGeoCoordinates(t){const e=this._ogma.modules.geo,s=this.getId(),i=this._indexes,n=new Array(i.length),r=new Array(i.length);if(t===null&&(t=new Array(i.length).fill(null)),t.length!==i.length)throw new RangeError("You must provide coordinates for each node in the NodeList");for(let l=0,d=i.length;l<d;l++){let{latitude:h,longitude:u}=t[l]||{latitude:void 0,longitude:void 0};const c=s[l];h==null&&u==null?h=u=void 0:(Zp(c,h),qp(c,u)),n[l]=h,r[l]=u}this.setData(e.latitudePath,n),this.setData(e.longitudePath,r);const{dom:o,graph:a}=this._ogma.modules;return $A(a,this,n,r),this._ogma.modules.geo.isEnabled()?o.afterNextFrame().then(()=>o.afterNextFrame()).then(()=>this):o.afterNextFrame().then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNodes(this)}getSubNodes(){return this.map(this._ogma.modules.transformations.getSubNodes)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};function al(t,e,s={},i={}){return co(t,e,[s],i).get(0)}function i1(t,{nodes:e=[],edges:s=[]},i={}){if(t.fireEvent("preAddGraph",{name:"preAddGraph"}),!i.batchSize)return Promise.all([co(t,!0,e,i),co(t,!1,s,i)]).then(([r,o])=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{nodes:r,edges:o}),{nodes:r,edges:o}));let n;return dr(t,!0,e,i).then(r=>(n=r,dr(t,!1,s,i))).then(r=>({nodes:n,edges:r})).then(r=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{name:"addGraph"}),r))}function dr(t,e,s,i={}){if(i.batchSize){const n=[];for(let a=0;a<s.length;a+=i.batchSize)n.push(s.slice(a,a+i.batchSize));const r=(a,l)=>{let d;return a.then(h=>(d=h,t.getDom().afterNextFrame())).then(()=>co(t,e,l,i)).then(h=>d.concat(h))},o=e?t.nodeList():t.edgeList();return n.reduce(r,Promise.resolve(o))}return Promise.resolve(co(t,e,s,i))}function co(t,e,s,i){const{virtual:n=!1}=i;t.fireEvent("preAddElements",{name:"preAddElements",objects:s,virtual:n,isNode:e});const r=!!i.ignoreInvalid,o=t.storage.fetch(e),a=[],l=[],d=[],h=[],u=new Set;for(const v of s){if(typeof v!="object"||v===null||Array.isArray(v)){if(r)continue;throw new Error(`${v} is not a valid ${e?"node":"edge"}`)}const E=sA(v.id);if(!o.getIndex(E,!1)&&!u.has(E)){if(!e){const A=v,S=t.getExtremityIndex(E,A.source,0,r),T=t.getExtremityIndex(E,A.target,1,r);if(r&&(!S||!T))continue;d.push(S),h.push(T)}l.push(E),a.push(v),u.add(E)}}const c=o.addElements(l);e?t.topology.allocateNodes(c):t.topology.allocateEdges(c,d,h);const g=o.getFlexArray("object"),m=o.getFlexArray("excluded"),_=o.getFlexArray("removed"),f=o.getFlexArray("virtual"),p=e?t.node:t.edge,x=e?t.nodeList:t.edgeList,y=t.getCacheLists(e),b=x(c);for(let v=0;v<c.length;v++){const E=c[v];g.set(E,p(E))}return m.setMultiple(c,0),_.setMultiple(c,0),f.setMultiple(c,n?1:0),y.visible.invalidList(),y.all.invalidList(),y._all.invalidList(),n||y.raw.invalidList(),b.size!==0&&(e?t.fireEvent("addNodes",{virtual:n,objects:a,nodes:b}):t.fireEvent("addEdges",{virtual:n,objects:a,edges:b})),b}function n1(t,e,s){return Io(t,!0,[e],s)}function r1(t,e,s){return Io(t,!1,[e],s)}function o1(t,e,s){return Io(t,!0,e,s)}function a1(t,e,s){return Io(t,!1,e,s)}function Io(t,e,s,i={}){Array.isArray(s)||s instanceof(e?Si:Tn)||(s=[s]);const{virtual:n=!1}=i,r={elementsToRemove:t.getElements(e,s)};t.fireEvent("requestElementsToDelete",r);let{elementsToRemove:o}=r;if(!o.size)return Promise.resolve();o=o.dedupe();const a=t.storage.fetch(e),l=a.getFlexArray("removed");o=o.filter(c=>l.get(c._index)===0),e&&Io(t,!1,o.getAdjacentEdges({filter:"all"}),i);const d=o._indexes,h=t.getCacheLists(e),u={virtual:n,[e?"nodes":"edges"]:o};if(t.fireEvent(e?"beforeRemoveNodes":"beforeRemoveEdges",u),h.visible.invalidList(),h.all.invalidList(),h.raw.invalidList(),t.setExcluded(o,!0),l.setMultiple(d,1),!e)for(let c=0;c<d.length;++c)t.topology.removeFromAdjacencyList(d[c]);return a.removeElements(d),t.fireEvent(e?"removeNodes":"removeEdges",u),t.fireEvent(e?"afterRemoveNodes":"afterRemoveEdges",u),Promise.resolve()}zl([Si],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var l1=class{addNodes(t,e){return dr(this.modules.graph,!0,t,e)}addEdges(t,e){return dr(this.modules.graph,!1,t,e)}addNode(t,e){return al(this.modules.graph,!0,t,e)}addEdge(t,e){return al(this.modules.graph,!1,t,e)}removeNodes(t,e){return o1(this.modules.graph,t,e)}removeEdges(t,e){return a1(this.modules.graph,t,e)}removeNode(t,e){return n1(this.modules.graph,t,e)}removeEdge(t,e){return r1(this.modules.graph,t,e)}getNodes(t){return this.modules.graph.getNodes(t)}getEdges(t){return this.modules.graph.getEdges(t)}getNode(t){return this.modules.graph.getNode(t)}getEdge(t){return this.modules.graph.getEdge(t)}clearGraph(){this.modules.graph.clear()}setGraph(t,e){return this.modules.graph.clear(),this.addGraph(t,e)}addGraph(t,e){const s=this.modules.graph.getNodes().size===0,i=i1(this.modules.graph,t,e);return s?this.modules.locate.locateGraph({padding:30,ignoreZoomLimits:!0,duration:0}).then(()=>i):i}createNodeList(){return this.getNodes([])}createEdgeList(){return this.getEdges([])}getConnectedComponents(t={}){return this.modules.graph.getConnectedComponents(this.getNodes(t.filter),t)}getConnectedComponentByNode(t,e){const s=this.modules.graph.getNode(t);if(s===void 0)throw new Error(`getComponentByNode: cannot find node ${t}`);return this.modules.graph.getConnectedComponentByNode(s,e)[0]}},Mi=()=>(t,e)=>t[e],Ni=()=>(t,e,s)=>{t[e]=s},Sg={1:hd(1),2:hd(2),4:hd(4),8:Mi(),16:Mi(),32:Mi(),int8:Mi(),int16:Mi(),int32:Mi(),float:Mi(),any:Mi()},wg={1:ud(1),2:ud(2),4:ud(4),8:Ni(),16:Ni(),32:Ni(),int8:Ni(),int16:Ni(),int32:Ni(),float:Ni(),any:Ni()};function hd(t){const e=8/t,s=(1<<t)-1;return(i,n)=>i[n/e|0]>>n%e*t&s}function ud(t){const e=8/t,s=Math.pow(2,t)-1;return(i,n,r)=>{const o=n%e*t,a=n/e|0,l=r<<o,d=255-(s-r<<o);i[a]=i[a]&d|l}}function d1(t,e){return t===void 0&&e!=="any"&&e!=="resource"?0:t}var h1={get(t){return this._getArrayElt(this._buffer,t)},set(t,e){this._setArrayElt(this._buffer,t,e)}},u1={get(t){return this._byIndex[this._getArrayElt(this._buffer,t)]},set(t,e){let s=this._byName[e];s===void 0&&(s=this._nextIndex++,this._byIndex.push(e),this._getElementBitSize()>this._elementSize&&this.increaseElementSize(),this._byName[e]=s),this._setArrayElt(this._buffer,t,s)}},c1=0,ll=class{constructor(t){this._id=c1++,this._initialized=!1;const e=t.name,s=t.storage,i=t.size||0,n=d1(t.default,s),r=Math.max(8,Tg(i+1)),o=s==="resource"?1:s;this._name=e,this._storage=s,this._getArrayElt=Sg[o],this._setArrayElt=wg[o],this._elementSize=o,this._nbElements=r,this._fallback=null,this._byName=void 0,this._byIndex=void 0,this._nextIndex=void 0,this._defaultValue=n,this._BASE_VALUE=s==="any"?void 0:0,this._methods=h1,this._initialized=!1,this._buffer=null,s==="resource"&&(this._methods=u1,this._byName=Object.create(null),this._byIndex=[],this._nextIndex=1,this._byName[n]=0,this._byIndex.push(n))}getValues(){return Object.keys(this._byName||{})}getName(){return this._name||""}setDefaultValue(t){this._defaultValue=t,this._storage==="resource"&&(this._byName[t]=0,this._byIndex[0]=t)}get(t){return this._get(t)}set(t,e){this._set(t,e)}_get(t){return this._defaultValue}_set(t,e){e!==this._defaultValue&&(this._initialize(),this._set(t,e))}setFallback(t){this._fallback=t,this.get=this._getWithFallback}_getWithFallback(t){const e=this._get(t);return e===void 0&&this._fallback?this._fallback.get(t):e}_initialize(){this._initialized=!0,this._buffer=cd(this._nbElements,this._elementSize),this._get=this._methods.get,this._set=this._methods.set,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(0)}grow(t){const e=Tg(t+1);if(!(e<=this._nbElements)){if(this._initialized)if(this._elementSize==="any")for(let s=this._nbElements;s<e;++s)this._buffer.push(this._defaultValue);else{const s=cd(e,this._elementSize);s.set(this._buffer),this._buffer=s,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(this._nbElements)}this._nbElements=e}}increaseElementSize(){const t=this._elementSize;if(typeof t!="number"||t===32)throw new Error("FlexArray: cannot increase element size");const e=2*t,s=Sg[e],i=wg[e];if(this._initialized){const n=this._nbElements,r=this._getArrayElt,o=this._buffer,a=cd(n,e);if(t>=8)a.set(o);else for(let l=0;l<n;++l)i(a,l,r(o,l));this._buffer=a}this._elementSize=e,this._getArrayElt=s,this._setArrayElt=i}buffer(){if(!this._buffer)throw new Error("FlexArray: buffer not instantiated");return this._buffer}elementBitSize(){return this._elementSize}capacity(){return this._nbElements}byteSize(){return this._nbElements*this._elementSize/8}isInitialized(){return this._initialized||this._fallback&&this._fallback.isInitialized()}getMultiple(t,e){const s=t.length;e===void 0&&(e=new Array(s));for(let i=0,n=s;i<n;++i)e[i]=this.get(t[i]);return e}fill(t,e){for(let s=0,i=t.length;s<i;++s)this.set(t[s],e)}setMultiple(t,e,s){if(s||!Array.isArray(e)&&!ArrayBuffer.isView(e))for(let i=0,n=t.length;i<n;++i)this.set(t[i],e);else for(let i=0,n=t.length;i<n;++i)this.set(t[i],e[i])}reset(){return this._initialized&&this._reset(0),this}_reset(t){const e=this._storage==="resource"?0:this._defaultValue;if(this._buffer)if(typeof this._elementSize!="number"||this._elementSize>=8)this._buffer.fill(e,t);else{const s=8/this._elementSize;let i=0;for(let n=0;n<s;++n)i<<=this._elementSize,i+=e;if(t===void 0)this._buffer.fill(i);else{const n=t+(8-t%8);for(let r=t;r<n;++r)this._setArrayElt(this._buffer,r,e);this._buffer.fill(i,n/8)}}}_getElementBitSize(){if(this._nextIndex)return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))}};function Tg(t){let e=2;for(;e<t;)e*=2;return e}function cd(t,e){return e==="any"?new Array(t):e==="float"?new Float32Array(t):e==="int8"?new Int8Array(t):e==="int16"?new Int16Array(t):e==="int32"?new Int32Array(t):e===32?new Uint32Array(t):e===16?new Uint16Array(t):new Uint8Array(Math.ceil(t/8*e))}var Ig=4,Kp=class{constructor(){this._buffer=new Uint32Array(Ig),this._capacity=Ig,this._size=0,this._busy=!1}isBusy(){return this._busy}markBusy(){return this._busy=!0,this}sliceAndReset(){this._busy=!1;const t=this.slice(0,this._size);return this.reset(),t}reset(){return this._size=0,this}reserve(t){return t>this._capacity&&this._setCapacity(Oi(t)),this}_setCapacity(t){const e=new Uint32Array(t);e.set(this._buffer),this._buffer=e,this._capacity=t}push(t){return this._size===this._capacity&&this._setCapacity(2*this._capacity),this._buffer[this._size++]=t,this}pushUnchecked(t){return this._buffer[this._size++]=t,this}slice(t=0,e=this._size){return this._buffer.slice(t,e)}getBuffer(){return this._buffer}getLength(){return this._size}getCapacity(){return this._capacity}setLength(t){return this._size=t,this}isEmpty(){return this._size===0}},Lg=class{constructor(t){this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._flexArrays=[],this._defaultValues=[],this._flexArraysByName={},this._indexLists=[],this._name=t?"node":"edge",this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._idFlexArray=new ll({storage:"int32"}),this._idFlexArray.get=e=>this._indexToId[e],this._idFlexArray.getMultiple=e=>{const s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=this._indexToId[e[i]];return s},this._flexArraysByName.id=this._idFlexArray}addElements(t){const e=[];for(let s=0,i=t.length;s<i;++s){const n=t[s];let r=this._idToIndex[n];r===void 0&&(r=this._getNextIndex(),this._idToIndex[n]=r,this._indexToId[r]=n),e.push(r)}for(const s of this._flexArrays)s.grow(this._nextIndex);for(const s of this._indexLists)s.reserve(this._nextIndex);return new Uint32Array(e)}removeElements(t){for(let e=0,s=t.length;e<s;++e){const i=t[e],n=this._indexToId[i];n!==void 0&&(delete this._idToIndex[n],this._removeIndex(i))}}clear(){this._idToIndex=Object.create(null),this._indexToId=[void 0],this._nextIndex=1,this._freeIndexes=[];for(const t of this._flexArrays)t.reset();for(const t of this._indexLists)t.reset()}has(t){return this._indexToId[t]!==void 0}getIndex(t,e=!1){const s=this._idToIndex[t];if(s===void 0&&e)throw new Error(`${this._name} id "${t}" not found`);return s}createFlexArray(t,e){const{name:s}=t;if(s&&e&&this._flexArraysByName[s])throw new Error(`${this._name} flexArray "${s}" already exists`);let i=t.default;i===void 0&&t.storage!=="any"&&t.storage!=="resource"&&(i=0);const n=this._nextIndex,r={storage:t.storage,size:n,name:s,default:i};let o;return o=(i===void 0&&t.storage!=="any"&&t.storage,new ll(r)),this._flexArrays.push(o),this._defaultValues.push(t.default),s&&e&&(this._flexArraysByName[s]=o),o}getFlexArray(t){return this._flexArraysByName[t]}getAllFlexArrays(){return this._flexArraysByName}createIndexList(){const t=new Kp;return t.reserve(this._nextIndex),this._indexLists.push(t),t}getId(t){return this._indexToId[t]}getMaxIndex(){return this._nextIndex-1}_removeIndex(t){this._indexesToBeFreed.push(t)}_getNextIndex(){let t=this._freeIndexes.pop();return t===void 0&&(t=this._nextIndex++),t}freeIndexes(){for(const t of this._indexesToBeFreed)this._indexToId[t]=void 0,this._freeIndexes.push(t);for(let t=0;t<this._flexArrays.length;++t){const e=this._flexArrays[t],s=this._defaultValues[t];for(const i of this._indexesToBeFreed)e.set(i,s)}this._indexesToBeFreed=[]}},Cg=(t,e)=>(t+e)*(t+e+1)/2+e;function Ar(t,e){const s=t<e?t:e;return 67108864*s+(t+e-s)}var g1=8,ph=class{constructor(){this._BIG_LIST=255,this._MAX_LIST_SIZE=8,this._capacity=g1,this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){return t===void 0&&(t=this._nextIndex++),t>=this._capacity&&this._reserve(t+1),this._sizes[t]=0,t}get(t){const e=this._sizes[t],s=this._MAX_LIST_SIZE*t;if(e<=this._MAX_LIST_SIZE){this._constList.length=e;for(let i=0,n=e;i<n;++i)this._constList[i]=this._buffer[s+i];return this._constList}if(e===this._BIG_LIST){const i=this._buffer[s];return this._bigLists[i]}throw new Error(`Table: ${t} out of bounds (${e})`)}size(t){const e=this._sizes[t];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=t[a],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._sizes[t],i=t*this._MAX_LIST_SIZE;if(s<this._MAX_LIST_SIZE)this._buffer[i+s]=e,this._sizes[t]=s+1;else if(s===this._BIG_LIST){const n=this._buffer[i];this._bigLists[n].push(e)}else{const n=new Array(this._MAX_LIST_SIZE);for(let r=0;r<this._MAX_LIST_SIZE;++r)n[r]=this._buffer[i+r];n.push(e),this._bigLists.push(n),this._sizes[t]=this._BIG_LIST,this._buffer[i]=this._bigLists.length-1}return this}removeFrom(t,e){return this.removeFromAndGetSize(t,e),this}removeFromAndGetSize(t,e){const s=this._MAX_LIST_SIZE*t;let i=this._sizes[t];if(i<=this._MAX_LIST_SIZE){for(let n=s,r=s+i;n<r;++n)if(this._buffer[n]===e)return i-=1,this._buffer[n]=this._buffer[r-1],this._sizes[t]=i,i}else if(i===this._BIG_LIST){const n=this._buffer[s],r=this._bigLists[n],o=r.indexOf(e);if(o!==-1)return r.splice(o,1),r.length}throw new Error('topology: Table: "removeFrom" failed, should not happen')}reserve(t){return this._capacity<t&&this._reserve(t),this}_reserve(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=Mg(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=Mg(this._sizes,this._capacity)}};function Mg(t,e){const s=new t.constructor(e);return s.set(t),s}var m1=1,_1=2,f1=3,p1=4,y1=5,x1=6,yh="_visible",xh="_data",Zr="_hovered",bh="_hoverExtremityHighlighted",we="_selected",vh="_selectionExtremityHighlighted",Ba="_dragged",Qp="_rewirable",ln="_export",ty="_faded",ey="_transparent",b1="_visual_groups",Lo=-1,Yo="in",$o="out",gd="both",Ng=[we,Ba,vh,Zr,bh,Qp,ln,ty,ey,b1],sy=2,iy=3,v1=3,E1=4,ny=-1,A1=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"],kn=void 0,S1=class{constructor(t){this._neighborTable=new ph,this._parallelTable=new ph,this._parallelEdgesIndex=[],this._hasParallelEdges=new Set,this._fakeDeduper={get:()=>0,set:Kt,reset(){return this}},this._fakeInvertedDeduper={get:()=>1,set:Kt,reset(){return this}},this._graph=t,this.nodeDeduper=t.createNodeAttribute({storage:1},!1),this.edgeDeduper=t.createEdgeAttribute({storage:1},!1),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target")}getAdjacentDirections(t){return this._neighborTable.get(t)}getEdgeIndexesInDirection(t){return this._parallelTable.get(t)}allocateNodes(t){this._neighborTable.reserve(t.length);for(let e=0;e<t.length;++e)this._neighborTable.addEntry(t[e])}allocateEdges(t,e,s){this._parallelTable.reserve(Math.floor(t.length/2));for(let i=0;i<t.length;i++){const n=t[i],r=e[i],o=s[i];this._sourceList.set(n,r),this._targetList.set(n,o),this.addToAdjacencyList(n)}}getExtremity(t,e){const s=t?this._sourceList:this._targetList;if(e.isList){const i=this._graph.acquireIndexList(!0);for(let n=0;n<e._indexes.length;n++)i.push(s.get(e._indexes[n]));return this._graph.nodeList(i.sliceAndReset())}return this._graph.getObjectList(!0).get(s.get(e._index))}setExtremities(t,e,s){for(let i=0;i<t.length;++i)this.removeFromAdjacencyList(t[i]);e!==null&&this._sourceList.setMultiple(t,e),s!==null&&this._targetList.setMultiple(t,s);for(let i=0;i<t.length;++i)this.addToAdjacencyList(t[i])}addToAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Ar(e,s);let n=this._parallelEdgesIndex[i];if(n===kn)n=this._parallelTable.addEntry(),this._parallelEdgesIndex[i]=n,this._neighborTable.addTo(e,n),e!==s&&this._neighborTable.addTo(s,n);else{this._hasParallelEdges.add(t);const r=this._parallelTable.get(+n);if(r)for(const o of r)this._hasParallelEdges.add(o)}this._parallelTable.addTo(n,t)}hasParallelEdges(t){return this._hasParallelEdges.has(t)}removeFromAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Ar(e,s),n=this._parallelEdgesIndex[i];n!==kn&&this._parallelTable.removeFromAndGetSize(n,t)===0&&(this._neighborTable.removeFrom(e,n),e!==s&&this._neighborTable.removeFrom(s,n),this._parallelEdgesIndex[i]=kn,this._hasParallelEdges.delete(t))}getParallelEdges(t,e={}){const s=e.filter||"visible",i=this._graph.acquireIndexList(!1),n=this._graph.getFilter(!1,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r],a=Ar(this._sourceList.get(o),this._targetList.get(o)),l=this._parallelEdgesIndex[a];if(l!==kn){const d=this._parallelTable.get(+l);if(d)for(const h of d)n(h)&&i.push(h)}}return this._graph.edgeList(i.sliceAndReset())}fastGetNodesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=this._neighborTable.get(o);for(const l of a){const d=this._parallelTable.get(l),h=d[0],u=i.get(h),c=n.get(h);if(u!==0&&c!==0){e.push(u+c-o);for(const g of d)s.push(g)}}}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}fastGetEdgesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=i.get(o),l=n.get(o),d=Ar(a,l),h=this._parallelEdgesIndex[d];if(h!==kn){const u=this._parallelTable.get(+h);if(u)for(const c of u)s.push(c)}e.push(a),e.push(l)}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}getDeduper(t){return(t?this.nodeDeduper:this.edgeDeduper).reset()}collectAdjacentEdges(t,e,s,i=!1,n=!1){const r=e===Yo,o=!(e===$o||r||n),a=this._graph.acquireIndexList(!1),l=this._graph.getFilter(!1,s),d=i?this.getDeduper(!1):this._fakeDeduper;let h=this._fakeInvertedDeduper;const u=this._sourceList,c=this._targetList;if(n){h=this.getDeduper(!0);for(let g=0;g<t.length;g++)h.set(t[g],1)}for(let g=0;g<t.length;g++){const m=t[g],_=this._neighborTable.get(m);for(const f of _){const p=this._parallelTable.get(f);if(o)for(const x of p)l(x)&&d.get(x)===0&&(a.push(x),d.set(x,1));else for(const x of p){const y=u.get(x),b=c.get(x),v=y+b-m;r!==(b===m)&&y!==b||!l(x)||d.get(x)!==0||h.get(v)!==1||(a.push(x),d.set(x,1))}}}return a.sliceAndReset()}collectAdjacentNodes(t,e,s,i=!1,n,r){const o=e!==Yo,a=e!==$o,l=this._graph.acquireIndexList(!0),d=this._graph.getFilter(!1,s),h=i?this.getDeduper(!0):this._fakeDeduper,u=this._sourceList,c=this._targetList;if(n)for(let g=0;g<n.length;g++){const m=n[g];l.push(m),h.set(m,1)}if(r)for(let g=0;g<r.length;g++){const m=r[g];h.set(m,1)}for(let g=0;g<t.length;g++){const m=t[g],_=this._neighborTable.get(m);for(const f of _){const p=this._parallelTable.get(f);for(const x of p)if(d(x)){const y=u.get(x),b=c.get(x),v=y+b-m;if((a&&m===b||o&&m===y)&&h.get(v)===0){l.push(v),h.set(v,1);break}}}}return l.sliceAndReset()}getAdjacentElements(t,e,s={}){const i=s.direction||gd,n=s.filter||"visible",r=s.policy||"union",o=!!s.bothExtremities;if(t){const a=r==="include-sources"?e:null,l=r==="exclude-sources"?e:null;return this.collectAdjacentNodes(e,i,n,!0,a,l)}return this.collectAdjacentEdges(e,i,n,!0,o)}getEdgesBetweenTwoNodes(t,e){const s=Ar(t,e),i=this._parallelEdgesIndex[s];if(i===kn)return new Uint32Array;const n=this._parallelTable.get(+i);return new Uint32Array(n)}getConnectedComponents(t,{filter:e="visible",returnIds:s=!1,internalIndexes:i=!1}={}){const n=this._graph,r=[],o={},a=n.acquireIndexList(!0);let l;typeof e=="string"?l=n.getFilter(!0,e):(l=e,e="visible");for(let u=0;u<t.length;u++){const c=t[u];l(c)&&a.push(c)}const d=a.sliceAndReset(),h={filter:e};for(let u=0;u<d.length;u++){const c=d[u];if(!o[c]){const g=[c],m=[];for(;g.length!==0;){const _=g.pop();!o[_]&&l(_)&&(g.push.apply(g,this.getAdjacentElements(!0,new Uint32Array([_]),h)),o[_]=!0,m.push(_))}m.length>0&&r.push(m)}}if(s){const u=n.getNodeAttribute("id");for(let c=0;c<r.length;c++)r[c]=u.getMultiple(r[c])}else if(!i)for(let u=0;u<r.length;u++)r[u]=n.nodeList(new Uint32Array(r[u]));return r}getAdjacencyList({directed:t,ids:e,weight:s,nodes:i}){const n=t?$o:gd,r=new Array(i.length),o=this._graph;for(let m=0;m<i.length;++m)r[m]=this.collectAdjacentEdges(new Uint32Array([i[m]]),n,"all");const a=o.getEdgeAttribute("source"),l=o.getEdgeAttribute("target"),d=o.getEdgeAttribute("width"),h=o.getNodeAttribute("id"),u=[],c=typeof s=="number",g=typeof s!="function"&&!c&&!!s;for(let m=0;m<r.length;m++){const _=r[m],f=i[m],p=_.length,x=e?new Array(p):new Uint32Array(p),y=new Array(p);for(let v=0;v<p;v++){const E=_[v],A=a.get(E),S=l.get(E);let T=t||f===A?S:A;if(e&&(T=h.get(T)),x[v]=T,s){if(c&&(y[v]=s),typeof s=="function"){const L=o.getNode(A),I=o.getNode(S);y[v]=s(L,I)}g&&(y[v]=d.get(E)||1)}}const b=ct({nodes:x,id:e?h.get(f):f},s&&{weights:y});u.push(b)}return u}degrees(t,e){if(e!==Yo&&e!==$o)return this._neighborTable.sizes(t);const s=new Array(t.length),i=e===Yo;for(let n=0,r=t.length;n<r;n++)s[n]=this._degree(t[n],i);return s}_degree(t,e){const s=this._neighborTable.get(t),i=this._sourceList,n=this._targetList;let r=0;for(let o=0;o<s.length;++o){const a=this._parallelTable.get(s[o]);for(let l=0;l<a.length;++l){const d=a[l],h=i.get(d),u=n.get(d);if(e&&u===t||!e&&h===t){r+=1;break}}}return r}getDegree(t,e){const{direction:s,filter:i}=this._getDegreeOptions(e),n=new Array(t.length),r=new Uint32Array(1);for(let o=0;o<t.length;++o)r[0]=t[o],n[o]=this.collectAdjacentNodes(r,s,i).length;return n}_getDegreeOptions(t){const e={direction:gd,filter:"visible"};return typeof t=="string"?e.direction=t:t&&(typeof t.direction=="string"&&(e.direction=t.direction),typeof t.filter=="string"&&(e.filter=t.filter)),e}},w1=class extends Bt{constructor(){super(...arguments),this.storage={nodes:new Lg(!0),edges:new Lg(!1),fetch(t){return t?this.nodes:this.edges}},this._promisesToResolve=[],this._nodeIndexLists=[],this._edgeIndexLists=[],this._onNewFrame=()=>{this.storage.nodes.freeIndexes(),this.storage.edges.freeIndexes()}}onMounted(){this._modules.events.register(["preAddElements","addNodes","addEdges","preAddGraph","postAddGraph","addGraph","excludedStateChange","clearGraph","afterRemoveNodes","beforeRemoveNodes","requestElementsToDelete","removeNodes","beforeRemoveEdges","afterRemoveEdges","removeEdges"]),[{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}].forEach(t=>{this.createNodeAttribute(t,!0),this.createEdgeAttribute(t,!0)}),this.node=this._ogma.node,this.edge=this._ogma.edge,this.nodeList=this._ogma.nodeList,this.edgeList=this._ogma.edgeList,this._nodes=this.createAttribute(!0,{name:"object",storage:"any"},!0),this._edges=this.createAttribute(!1,{name:"object",storage:"any"},!0),this.createAttribute(!1,{name:"source",storage:32},!0),this.createAttribute(!1,{name:"target",storage:32},!0),this._nodeFilters=tg(this.storage.nodes),this._edgeFilters=tg(this.storage.edges),this._initialize(),this._modules.events.on("frame",this._onNewFrame)}onReady(t){if(t.graph){const{nodes:e,edges:s}=t.graph;e&&this.addNodes(e),s&&this.addEdges(s)}}createIndexList(t){return this.storage.fetch(t).createIndexList()}getDom(){return this._modules.dom}acquireIndexList(t){const e=t?this._nodeIndexLists:this._edgeIndexLists;let s=e.find(i=>!i.isBusy());return s||(s=this.createIndexList(t),e.push(s)),s.markBusy(),s}getObjectList(t){return t?this._nodes:this._edges}getListFactory(t){return t?this.nodeList:this.edgeList}getStorage(t){return t?this.storage.nodes:this.storage.edges}getFilter(t,e){const s=t?this._nodeFilters:this._edgeFilters;return s[e]||s.visible}fireEvent(t,e){this._modules.events.fire(t,e)}getCacheLists(t){return t?this._nodeCacheLists:this._edgeCacheLists}_resolvePromises(){const t=this._promisesToResolve;this._promisesToResolve=[],t.forEach(e=>e())}_initialize(){this._nodeCacheLists=eg(()=>this.getNodeMaxIndex(),()=>this.acquireIndexList(!0),this._nodeFilters),this._edgeCacheLists=eg(()=>this.getEdgeMaxIndex(),()=>this.acquireIndexList(!1),this._edgeFilters),this.topology=new S1(this),this._resolvePromises()}getNodeMaxIndex(){return this.storage.nodes.getMaxIndex()}getEdgeMaxIndex(){return this.storage.edges.getMaxIndex()}isExcluded(t){return this.storage.fetch(t.isNode).getFlexArray("excluded").getMultiple(t._indexes)}setExcluded(t,e){const s=e?1:0,i=t.isNode,n=this.storage.fetch(i),r=n.getFlexArray("excluded"),o=n.getFlexArray("removed"),a=this.acquireIndexList(i),l=this.getListFactory(i);for(let h=0;h<t._indexes.length;h++){const u=t._indexes[h],c=r.get(u),g=o.get(u);s!==c&&g===0&&a.push(u)}const d=a.sliceAndReset();if(d.length){this.getCacheLists(t.isNode).visible.invalidList();const h=l(d);r.setMultiple(d,s),this._modules.events.fire("excludedStateChange",{elements:h,value:e})}}addNode(t,e){return al(this,!0,t,e)}addEdge(t,e){return al(this,!1,t,e)}addNodes(t,e){return dr(this,!0,t,e)}addEdges(t,e){return dr(this,!1,t,e)}getExtremityIndex(t,e,s,i){if(e instanceof ni)return e._index;{const n=this.storage.nodes.getIndex(e);if(!n&&!i)throw new Error(`addEdge(s): invalid ${s===0?"source":"target"} for edge "${t}"; node "${e}" does not exist`);return n}}getNodes(t){return this.getElements(!0,t)}getEdges(t){return this.getElements(!1,t)}getElements(t,e){const s=t?this.nodeList:this.edgeList,i=t?Si:Tn,n=t?ni:Hi;if(e&&typeof e!="string"){const r=this.acquireIndexList(t),o=this.storage.fetch(t);if(e instanceof n)r.push(e._index);else if(es(e)){const a=e;for(const l of a)if(l instanceof n)r.push(l._index);else{const d=o.getIndex(l);d&&r.push(d)}}else if(e instanceof i){const a=this.getFilter(t,"all"),l=e;for(let d=0;d<l._indexes.length;d++){const h=l._indexes[d];a(h)&&r.push(h)}}return s(r.sliceAndReset())}{const r=e||"visible",o=this.getCacheLists(t)[r];if(!o)throw new Error(`getNodes/getEdges: unexpected argument "${r}"`);return s(o.getList())}}getNode(t){return this._getElement(!0,t)}getEdge(t){return this._getElement(!1,t)}_getElement(t,e){if(e instanceof(t?ni:Hi))return e;const s=this.getStorage(t),i=this.getObjectList(t),n=s.getIndex(e);return n?i.get(n):void 0}clear(){this._modules.events.fire("clearGraph",{nodes:this.getNodes("all"),edges:this.getEdges("all")}),this.storage.nodes.clear(),this.storage.edges.clear(),this._initialize()}createAttribute(t,e,s=!1){return this.storage.fetch(t).createFlexArray(e,s)}createNodeAttribute(t,e){return this.createAttribute(!0,t,e)}createEdgeAttribute(t,e){return this.createAttribute(!1,t,e)}getAttribute(t,e){return this.storage.fetch(t).getFlexArray(e)}getAttributes(t,e){return e.map(s=>this.getAttribute(t,s))}getNodeAttribute(t){return this.storage.nodes.getFlexArray(t)}getNodeAttributes(t){return this.getAttributes(!0,t)}getEdgeAttribute(t){return this.storage.edges.getFlexArray(t)}getEdgeAttributes(t){return this.getAttributes(!1,t)}getAllNodeAttributes(){return this.storage.nodes.getAllFlexArrays()}getAllEdgeAttributes(){return this.storage.edges.getAllFlexArrays()}setSource(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,s._indexes,null)}setTarget(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,null,s._indexes)}getParallelEdges(t,e={}){return this.topology.getParallelEdges(t,e)}hasParallelEdges(t){return this.topology.hasParallelEdges(t._index)}getEdgesBetweenTwoNodes(t,e){return this.edgeList(this.topology.getEdgesBetweenTwoNodes(t._index,e._index))}getAdjacentDirections(t){return this.topology.getAdjacentDirections(t)}getEdgeIndexesInDirection(t){return this.topology.getEdgeIndexesInDirection(t)}fastGetNodesAdjacentElements(t){const e=this._ogma.getNodes();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:e,edges:this._ogma.getEdges()}:this.topology.fastGetNodesAdjacentElements(t._indexes)}fastGetEdgesAdjacentElements(t){const e=this._ogma.getEdges();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:this._ogma.getNodes(),edges:e}:this.topology.fastGetEdgesAdjacentElements(t._indexes)}getAdjacentNodes(t,e){return this.nodeList(this.topology.getAdjacentElements(!0,t._indexes,e))}getAdjacentEdges(t,e){return this.edgeList(this.topology.getAdjacentElements(!1,t._indexes,e))}getDegree(t,e){return this.topology.getDegree(t._indexes,e)}degrees(t,e){return this.topology.degrees(t,e)}getAdjacencyList({directed:t=!1,internalIndexes:e=!1,weight:s=1,nodes:i,indexes:n}={}){return this.topology.getAdjacencyList({directed:t,weight:s,ids:!e,nodes:n||this.getNodes(i)._indexes})}getConnectedComponents(t,e){return this.topology.getConnectedComponents(t._indexes,e)}getConnectedComponentByNode(t,e){return this.topology.getConnectedComponents(t._indexes,e)}},Uu=512,Gu=128,ry=Math.round(Math.log2(Uu)),Vu=Math.round(Math.log2(Gu)),T1=ry+Vu,Xn=255,I1=32767,oy=65535,Eh=15,Yn=3,dl=15,Ua=32,Di=128,Ah=8,Sh=1/16,wh=Math.round(Math.sqrt(dl+1)),Th=Di*wh,as=16,Wi=1,Gs=256,L1=128,C1=128,hl=1.5,ay=1,hr=56,M1=16,N1=2*hr+M1,Ga=6,ly=3,dy=3,_s=41,Bl=5,ul=5,hy=.9721,go=24,P1=1.4142,F1=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function ju(t,e=[0,0,0,0]){const s=F1.exec(t);return s?(e[0]=parseInt(s[1])/255,e[1]=parseInt(s[2])/255,e[2]=parseInt(s[3])/255,e[3]=s[4]===void 0?1:parseFloat(s[4]),e):null}function Va(t){return t<16?"0"+t.toString(16):t.toString(16)}function uy([t,e,s,i=1]){return`rgba(${256*t|0},${256*e|0},${256*s|0},${i})`}function Hu(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(s,i,n,r)=>i+i+n+n+r+r);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255,1]:null}var md=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"],Sr=[0,0,0,0],mo=new Map;mo.set(null,[0,0,0,0]),mo.set("transparent",[0,0,0,0]);for(let t=0;t<md.length;t+=2){const e=md[t].toLowerCase(),s=md[t+1];mo.set(e,Hu(s))}var ds=t=>{let e=mo.get(t);if(e===void 0){const s=t+"",i=s.charAt(0)==="#"?Hu(s):ju(s);mo.set(t,i),e=i}return e},Ih=t=>{const e=ds(t);if(!e)return null;const[s,i,n]=e;return`#${Va(255*s)}${Va(255*i)}${Va(255*n)}`},Un=t=>{let e=1,s=t;return s&&ju(t,Sr)&&(s=`rgb(${255*+Sr[0]},${255*+Sr[1]},${255*+Sr[2]})`,e=parseFloat(Sr[3].toString())),{color:s,opacity:e}},Co=class{on(t,e){if(typeof t!="string")throw new TypeError("Event name must be string");if(typeof e!="function")throw new TypeError("Event handler must be function");const s=this._events=this._events||{};return(s[t]=s[t]||[]).push(e),this}off(t,e){if(typeof t!="string")throw new TypeError("Event name must be string");const s=this._events=this._events||{},i=s[t];if(es(i))if(typeof e!="function")s[t]=null;else{const n=i.indexOf(e);n!==-1&&i.splice(n,1),i.length===0&&(s[t]=null)}return this}fire(t,...e){if(typeof t!="string")throw new TypeError("Event name must be string");const s=(this._events=this._events||{})[t];if(es(s)){const i=e;for(let n=0;n<s.length;n++){const r=s[n];r&&r.apply(this,i)}}return this}once(t,e){const s=this,i=function(...n){e.apply(s,n),s.off(t,i)};return i.handler=e,this.on(t,i)}hasListener(t,e){if(!t||!e)return!1;const s=(this._events=this._events||{})[t];if(es(s))for(let i=0,n=s.length;i<n;i++){const r=s[i];if(r===e||r.handler===e)return!0}return!1}clearEvents(){this._events={}}getListeners(t){return(this._events=this._events||{})[t]}};function cy(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach((s,i)=>e.push(i)),e}function gy(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach(s=>e.push(s)),e}var my=class{constructor(){this._map=new Map}reset(){this._map.clear()}set(t,e,s){this._map.set(Cg(t,e),s)}get(t,e){return this._map.get(Cg(t,e))}},k1=class{constructor({elementSize:t,sideElementSize:e,nbSideElementsPerMainElement:s,id:i,depth:n,elementType:r,animated:o,stencilUsage:a}){this._nbCellsAllocated=0,this._nbCellsFreed=0,this._isFullyAllocated=!1,this._isFullyFreed=!1,this._mustUpdate=!0,this._capacity=Uu,this.version=0,this._id=i,this.depth=n,this.type=r,this.animated=o,this.stencilUsage=a,this.elementSize=t,this._nbSideElementsPerMainElement=s,this._totalSideElementsSize=s*e,this._byteCapacity=this._capacity*this.elementSize,this._byteArray=new Uint8Array(this._byteCapacity),this._dataView=new DataView(this._byteArray.buffer),this._sideByteCapacity=this._capacity*this._totalSideElementsSize,this._sideByteArray=new Uint8Array(this._sideByteCapacity),this._sideDataView=new DataView(this._sideByteArray.buffer)}update(){this._mustUpdate&&(this.version+=1,this._mustUpdate=!1,this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated&&(this._isFullyFreed=!0))}allocate(t){let e=-1;return!this._isFullyAllocated&&this._nbCellsAllocated+t<=this._capacity?(e=this._nbCellsAllocated,this._nbCellsAllocated+=t,this._mustUpdate=!0):this._isFullyAllocated=!0,e}free(t,e){for(let s=0;s<e;s++){const i=(t+s)*this.elementSize;this._dataView.setUint16(i,0)}this._mustUpdate=!0,this._nbCellsFreed+=e}triggerUpdate(){this._mustUpdate=!0}isEmpty(){return this._nbCellsFreed===this._nbCellsAllocated}isFullyFreed(){return this._isFullyFreed}getId(){return this._id}getDataView(){return this._dataView}getByteArray(){return this._byteArray}getSize(){return this._nbCellsAllocated}getNbSideElementsPerMainElement(){return this._nbSideElementsPerMainElement}hasSideData(){return this._nbSideElementsPerMainElement>0}getSideDataView(){return this._sideDataView}getSideByteArray(){return this._sideByteArray}getTotalSideElementsSize(){return this._totalSideElementsSize}},Pg=8,D1=class{constructor(){this.version=0,this.version=0,this._blockInfo={buffer:null,offset:0,size:0,address:0},this._init_()}reset(){this._init_()}_init_(){this._buffersByDepth=new Array(100),this._buffersById=[],this._buffersByAscendingDepth=[],this._buffersByDescendingDepth=[],this._mustUpdate=!0}_fillBlockInfo(t,e,s,i){return this._blockInfo.buffer=t,this._blockInfo.offset=e,this._blockInfo.size=s,this._blockInfo.address=i,this._blockInfo}_createBuffer(t,e,s,i,n){const r=e?N1:hr,o=this._buffersById.length,a=new k1({elementSize:r,sideElementSize:Ga,nbSideElementsPerMainElement:i,id:o,depth:s,elementType:t,animated:e,stencilUsage:n});return this._buffersById.push(a),a}getBlockInfo(t){return this._fillBlockInfo(this._buffersById[t>>T1],(t>>Vu)%Uu,t%Gu,t)}allocateBlock(t,e,s,i,n,r,o){const a=O1(r,Pg);this._mustUpdate=!0;let l=null,d=-1;if(t){const u=this.getBlockInfo(t),c=u.buffer,g=u.offset,m=u.size,_=u.size===n,f=c.depth===i,p=c.type===e,x=c.animated===s,y=c.getNbSideElementsPerMainElement()===a,b=c.stencilUsage===o;_&&f&&p&&x&&y&&b?(c.triggerUpdate(),l=c,d=g):c.free(g,m)}if(d===-1){const u=+s,c=a/Pg,g=this._buffersByDepth[i]||Array(2);this._buffersByDepth[i]=g;const m=g[u]||[];g[u]=m;const _=m[e]||Array(16);m[e]=_;const f=_[c]||Array(4);_[c]=f;const p=f[o]||[];f[o]=p;const x=p[p.length-1];x&&(l=x,d=x.allocate(n)),d===-1&&(l=this._createBuffer(e,s,i,a,o),d=l.allocate(n),p.push(l))}const h=R1(l.getId(),d,n);return this._fillBlockInfo(l,d,n,h)}freeBlock(t){if(t){this._mustUpdate=!0;const e=this.getBlockInfo(t);e.buffer.free(e.offset,e.size)}return 0}_sortBuffersByDepth(){const t=[];for(let e=0;e<this._buffersByDepth.length;e++){const s=this._buffersByDepth[e];if(s)for(let i=0;i<s.length;i++){const n=s[i];if(n)for(let r=0;r<n.length;r++){const o=n[r];if(o)for(let a=0;a<o.length;a++){const l=o[a];if(l)for(let d=0;d<l.length;d++){const h=l[d];if(h)for(let u=0;u<h.length;u++){const c=h[u];c.update(),c.isFullyFreed()?(this._buffersById[c.getId()]=void 0,h.splice(u,1),u-=1):t.push(c)}}}}}}this._buffersByAscendingDepth=t,this._buffersByDescendingDepth=t.slice().reverse()}update(){this._mustUpdate&&(this._sortBuffersByDepth(),this.version+=1,this._mustUpdate=!1)}getBuffers(){return this._buffersById}getBuffersByAscendingDepth(){return this._buffersByAscendingDepth}getBuffersByDescendingDepth(){return this._buffersByDescendingDepth}};function R1(t,e,s){return((t<<ry)+e<<Vu)+s}function O1(t,e){let s=0;for(;s<t;)s+=e;return s}var Ws=1,mn=2,cl=3,hs=1,Vi=2,dn=3,Mo=4,_n=5,fn=6,Xi=7,Bs=1,Ul=2,Wu=3,Xu=4,nn=5,hn=6,Qn=1,_y=2,fy=3;function Fg(){return{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:hs,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1}}function kg(t={}){return t.pieceId=0,t.shape="",t.x1=0,t.y1=0,t.x2=0,t.y2=0,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=0,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=0,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern=t.pattern||{type:hs,attributes:{}},t.pattern.type=hs,t.opacity=1,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1,t.isSelfLoop=!1,t.isText=!1,t.adjustTextAngle=!1,t.isBadge=!1,t.unusedFlag2=!1,t.unusedFlag3=!1,t}function z1(t={}){return t.duration=0,t.beginTime=-1,t.easing="linear",t}function Yu(){return{valid:!1,id:void 0,end:Fg(),start:Fg(),animation:{duration:0,beginTime:-1,easing:"linear"}}}function py(t,e,s,i){t.width=e*i,t.height=s*i,Sn(t,`${e}px`,`${s}px`)}var B1=class{constructor(){this._capacity=Gu,this._id=0,this.size=0,this.depth=0,this.animated=!1,this.stencilUsage=Qn,this.type=Ws,this._list=Array(this._capacity);for(let t=0;t<this._capacity;++t)this._list[t]=Yu()}reset(t,e,s,i){return this.type=t,this.animated=e,this.depth=s,i!==void 0&&(this._id=i),this.stencilUsage=Qn,this.size=0,this}next(){if(this.size>=this._capacity)throw new Error("internal error: block.next() was called on a full block");return this._list[this.size++]}nextAndReset(){const t=this.next();return t.end=kg(t.end),t.start=kg(t.start),t.animation=z1(t.animation),t}forEach(t){this._list.forEach(t)}getElement(t){return this._list[t]}getCurrentElement(){return this._list[this.size-1]}getElements(){return this._list}getId(){return this._id}setGlobalAnimation(t,e,s){for(let i=0;i<this.size;++i){const n=this._list[i].animation;n.duration=t,n.beginTime=e,n.easing=s}}},U1=class{constructor(){this._version=0,this._initialize()}reset(){this._initialize()}_initialize(){this._mustUpdate=!0,this.maxCoord=0,this.maxScaledSize=0,this.maxMinVisibleSize=0,this.maxSymbolicSize=0,this.maxDashLength=0,this.maxGapLength=0,this.maxPatternScale=0}set({maxCoord:t,maxScaledSize:e,maxMinVisibleSize:s,maxSymbolicSize:i,maxDashLength:n,maxGapLength:r,maxPatternScale:o}){const a=this.maxCoord<t||this.maxScaledSize<e||this.maxMinVisibleSize<s||this.maxSymbolicSize<i||this.maxDashLength<n||this.maxGapLength<r||this.maxPatternScale<o;return a&&(this.maxCoord=t,this.maxScaledSize=e,this.maxMinVisibleSize=s,this.maxSymbolicSize=i,this.maxDashLength=n,this.maxGapLength=r,this.maxPatternScale=o,this._mustUpdate=!0),a}update(){return this._mustUpdate&&(this._version+=1,this._mustUpdate=!1),this}getVersion(){return this._version}},G1={linear:[0,1,0,0],quadraticIn:[0,0,1,0,0,0,0,0],quadraticOut:[0,2,-1,0,0,0,0,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]},V1=class{constructor(){this._linearEasing=[0,1,0,0,0,1,0,0],this._nameToPolygon={},this._polygonToName={},this.add(G1)}add(t){Object.keys(t).forEach(e=>{const s=t[e].slice();s.length<8&&(s[4]=s[0],s[5]=s[1],s[6]=s[2],s[7]=s[3]);const i=eh(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);this._nameToPolygon[e]=s,this._polygonToName[i]=e})}getCoefficients(t){return this._nameToPolygon[t]||this._linearEasing}getName(t,e,s,i,n,r,o,a){const l=eh(t,e,s,i,n,r,o,a);return this._polygonToName[l]||"linear"}},$u=new V1,j1=0,H1=1,W1=2,X1=3,Y1=4,$1=5,q1=6,Z1=7,J1=8,K1=9,Gl=10,Q1=0,yy=1,xy=2,qu=30,by=0,tS=1,eS=2,Zu=3,sS=4,iS=5,Ju=6,vy=1e-6,Ds=Math.PI,Jr=2*Math.PI,Ey=Ds*(5/4),Ay=Ds*(7/4),Sy=Ds*(3/4),wy=Ds*(1/4),Dg=1.1,Rg=.07,nS=1,Og=1,zg=.17,rS=1,oS=-Ds/2,aS=Ds/2,lS={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}},dS={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0},hS={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0},uS=class{constructor(t,e,s,i,n){this._littleEndian=Ml(),this._maxScaledSize=0,this._maxMinVisibleSize=0,this._maxSymbolicSize=0,this._maxDashLength=0,this._maxGapLength=0,this._maxPatternScale=0,this._actualScaledSizeToBytes=I1,this._actualMinVisibleSizeToBytes=Eh,this._actualSymbolicSizeToBytes=Xn,this._actualDashLengthToBytes=Yn,this._actualGapLengthToBytes=Yn,this._actualPatternScaleToBytes=Xn,this._genericObject=Yu(),this._shapeManager=e,this._patternManager=t,this._textManager=s,this._bufferOffsetToId=i,this._colorParser=n}resizeBoundaries(t,e,s,i,n,r){this._maxScaledSize=t,this._maxMinVisibleSize=e,this._maxSymbolicSize=s,this._maxDashLength=i,this._maxGapLength=n,this._maxPatternScale=r,this._actualScaledSizeToBytes=oy/t,this._actualMinVisibleSizeToBytes=Eh/e,this._actualSymbolicSizeToBytes=Xn/s,this._actualDashLengthToBytes=Yn/i,this._actualGapLengthToBytes=Yn/n,this._actualPatternScaleToBytes=Xn/r}storeGenericObject(t,e,s){const i=this._shapeManager.getIdFromName(s.shape),n=s.pieceId,r=this._dashLengthToBytes(s.dashLength),o=this._gapLengthToBytes(s.gapLength),a=+s.hasHead,l=+s.hasTail,d=+s.isBodyTriangle,h=+s.isSelfLoop,u=this._patternScaleToBytes(s.patternScale),c=this._offsetAngleToBytes(s.offsetAngle),g=+s.isText,m=+s.adjustTextAngle,_=+s.isBadge,f=+s.unusedFlag2,p=+s.unusedFlag3,x=this._opacityToBytes(s.opacity),y=this._minVisibleSizeToBytes(s.globalMinVisibleSize),b=this._minVisibleSizeToBytes(s.strokeMinVisibleSize),v=this._minVisibleSizeToBytes(s.patternMinVisibleSize),E=this._symbolicSizeToBytes(s.symbolicSize),A=this._curvatureToBytes(s.curvature),S=s.pattern.attributes.colors;S&&(s.pattern.attributes.colors=S.split(";").map(se=>qo(this._colorToBytes(se.trim()))).join(";"));const T=this._patternManager.getIdFromDefinition(s.pattern),L=this._colorToBytes(s.fillColor),I=this._colorToBytes(s.strokeColor),R=this._colorToBytes(s.patternColor),{x1:z,y1:j,x2:C,y2:w}=s,H=this._scaledSizeToBytes(s.rectWidthOrSourceRadiusScaled),K=this._fixedSizeToBytes(s.rectWidthOrSourceRadiusFixed),it=this._scaledSizeToBytes(s.rectHeightOrTargetRadiusScaled),xt=this._fixedSizeToBytes(s.rectHeightOrTargetRadiusFixed),at=this._scaledSizeToBytes(s.thicknessOrFontSizeScaled),Tt=this._fixedSizeToBytes(s.thicknessOrFontSizeFixed),It=this._scaledSizeToBytes(s.strokeWidthScaled),dt=this._fixedSizeToBytes(s.strokeWidthFixed),bt=this._scaledSizeToBytes(s.offsetScaled),Ht=this._fixedSizeToBytes(s.offsetFixed),Qt=this._fixedSizeToBytes(s.pattern.attributes.paddingTop||0),Xt=this._fixedSizeToBytes(s.pattern.attributes.paddingLeft||0),mt=i+(n<<4)+(r<<8)+(o<<10)+(a<<12)+(l<<13)+(d<<14)+(h<<15),ft=u+(c<<8)+(g<<11)+(m<<12)+(_<<13)+(f<<14)+(p<<15),te=x+(y<<4)+(b<<8)+(v<<12),qt=E+(A<<8);this._setUint16(t,e+0,mt),this._setUint16(t,e+2,ft),this._setUint16(t,e+4,te),this._setUint16(t,e+6,qt),this._setUint16(t,e+8,T),this._setUint16(t,e+10,L),this._setUint16(t,e+12,I),this._setUint16(t,e+14,R),this._setFloat32(t,e+16,z),this._setFloat32(t,e+20,j),this._setFloat32(t,e+24,C),this._setFloat32(t,e+28,w),this._setUint16(t,e+32,H),this._setUint16(t,e+34,K),this._setUint16(t,e+36,it),this._setUint16(t,e+38,xt),this._setUint16(t,e+40,at),this._setUint16(t,e+42,Tt),this._setUint16(t,e+44,It),this._setUint16(t,e+46,dt),this._setUint16(t,e+48,bt),this._setInt16(t,e+50,Ht),this._setInt16(t,e+52,Qt),this._setInt16(t,e+54,Xt)}_setUint16(t,e,s){t.setUint16(e,s,this._littleEndian)}_setInt16(t,e,s){t.setUint16(e,this._signedToUnsignedInt16(s),this._littleEndian)}_setFloat32(t,e,s){t.setFloat32(e,s,this._littleEndian)}_colorToBytes(t){const e=this._colorParser(t);return Math.round(15*e[0])+(Math.round(15*e[1])<<4)+(Math.round(15*e[2])<<8)+(Math.round(15*e[3])<<12)}_scaledSizeToBytes(t){return Math.ceil(Math.min(t,this._maxScaledSize)*this._actualScaledSizeToBytes)}_fixedSizeToBytes(t){return t}_minVisibleSizeToBytes(t){return Math.round(Math.min(t,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)}_symbolicSizeToBytes(t){return Math.round(Math.min(t,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)}_dashLengthToBytes(t){return Math.round(Math.min(t,this._maxDashLength)*this._actualDashLengthToBytes)}_gapLengthToBytes(t){return Math.round(Math.min(t,this._maxGapLength)*this._actualGapLengthToBytes)}_patternScaleToBytes(t){return Math.round(Math.min(t,this._maxPatternScale)*this._actualPatternScaleToBytes)}_offsetAngleToBytes(t){return Math.round((t+Jr)%Jr*(8/Jr))}_opacityToBytes(t){return Math.round(15*Math.min(t,1))}_curvatureToBytes(t){return this._signedToUnsignedByte(t)}_signedToUnsignedByte(t){return zs(t,-128,127)+128}_signedToUnsignedInt16(t){return zs(t,-32768,32767)+32768}storeAnimationInformation(t,e,{beginTime:s,duration:i},n){this._setAnimationBeginTime(t,e,s),this._setAnimationDuration(t,e,i),this._setAnimationEasing(t,e,n)}_setAnimationBeginTime(t,e,s){this._setFloat32(t,e,s)}_setAnimationDuration(t,e,s){this._setFloat32(t,e+4,s)}_setAnimationEasing(t,e,s){this._setUint16(t,e+8,(s[0]+128<<8)+(s[4]+128)),this._setUint16(t,e+10,(s[1]+128<<8)+(s[5]+128)),this._setUint16(t,e+12,(s[2]+128<<8)+(s[6]+128)),this._setUint16(t,e+14,(s[3]+128<<8)+(s[7]+128))}extractGenericElement(t,e,s){const i=t.type,n=t.animated,r=t.getDataView(),o=e*t.elementSize,a=this._genericObject;if(a.valid=!1,r.getUint16(o)&&(a.valid=!0,this._extractGenericObject(a.end,r,o,s),n&&(this._extractGenericObject(a.start,r,o+hr,s),this._extractAnimationInformation(a.animation,r,o+2*hr)),a.id=this._bufferOffsetToId.get(t.getId(),e),i===mn)){const l=t.getSideDataView(),d=e*t.getTotalSideElementsSize(),h=d+t.getTotalSideElementsSize();a.end.pattern=this._textManager.extractTextFromDataView(l,d,h)}return a}_extractGenericObject(t,e,s,{bytesToActualCoord:i,bytesToActualScaledSize:n,bytesToActualMinVisibleSize:r,bytesToActualPatternScale:o,bytesToActualSymbolicSize:a,bytesToActualDashLength:l,bytesToActualGapLength:d}){const h=e,u=s,c=this._littleEndian,g=h.getUint16(u,c),m=Se(g,0,4),_=Se(g,4,8),f=Se(g,8,10),p=Se(g,10,12),x=Se(g,12,13),y=Se(g,13,14),b=Se(g,14,15),v=Se(g,15,16),E=h.getUint16(u+2,c),A=Se(E,0,8),S=Se(E,8,11),T=Se(E,11,12),L=Se(E,12,13),I=Se(E,13,14),R=Se(E,14,15),z=Se(E,15,16),j=h.getUint16(u+4,c),C=Se(j,0,4),w=Se(j,4,8),H=Se(j,8,12),K=Se(j,12,16),it=h.getUint16(u+6,c),xt=Se(it,0,8),at=Se(it,8,16),Tt=h.getUint16(u+8,c),It=h.getUint16(u+10,c),dt=h.getUint16(u+12,c),bt=h.getUint16(u+14,c),Ht=h.getFloat32(u+16,c),Qt=h.getFloat32(u+20,c),Xt=h.getFloat32(u+24,c),mt=h.getFloat32(u+28,c),ft=h.getUint16(u+32,c),te=h.getUint16(u+34,c),qt=h.getUint16(u+36,c),se=h.getUint16(u+38,c),ee=h.getUint16(u+40,c),$=h.getUint16(u+42,c),et=h.getUint16(u+44,c),ht=h.getUint16(u+46,c),lt=h.getUint16(u+48,c),rt=_d(h.getUint16(u+50,c)),nt=_d(h.getUint16(u+52,c)),Lt=_d(h.getUint16(u+54,c));t.pieceId=_,t.shape=this._shapeManager.getNameFromId(m),t.x1=Cs(Ht,i),t.y1=Cs(Qt,i),t.x2=Cs(Xt,i),t.y2=Cs(mt,i),t.rectWidthOrSourceRadiusScaled=Cs(ft,n),t.rectWidthOrSourceRadiusFixed=te,t.rectHeightOrTargetRadiusScaled=Cs(qt,n),t.rectHeightOrTargetRadiusFixed=se,t.thicknessOrFontSizeScaled=Cs(ee,n),t.thicknessOrFontSizeFixed=$,t.strokeWidthScaled=Cs(et,n),t.strokeWidthFixed=ht,t.offsetScaled=Cs(lt,n),t.offsetFixed=rt,t.pattern=this._patternManager.getDefinitionFromId(Tt),t.pattern.attributes.paddingTop=nt,t.pattern.attributes.paddingLeft=Lt,t.opacity=C/15,t.fillColor=qo(It),t.strokeColor=qo(dt),t.patternColor=qo(bt),t.globalMinVisibleSize=Cs(w,r),t.strokeMinVisibleSize=Cs(H,r),t.patternMinVisibleSize=Cs(K,r),t.offsetAngle=S*(2*Math.PI/8),t.patternScale=A*o,t.symbolicSize=xt*a,t.curvature=cS(at),t.dashLength=f*l,t.gapLength=p*d,t.hasHead=!!x,t.hasTail=!!y,t.isBodyTriangle=!!b,t.isSelfLoop=!!v,t.isText=!!T,t.adjustTextAngle=!!L,t.isBadge=!!I,t.unusedFlag2=!!R,t.unusedFlag3=!!z}_extractAnimationInformation(t,e,s){const i=this._littleEndian,n=e.getFloat32(s,i),r=e.getFloat32(s+4,i),o=e.getUint16(s+8,i),a=e.getUint16(s+10,i),l=e.getUint16(s+12,i),d=e.getUint16(s+14,i),h=(o>>8)-128,u=(a>>8)-128,c=(l>>8)-128,g=(d>>8)-128,m=o%256-128,_=a%256-128,f=l%256-128,p=d%256-128;t.beginTime=n,t.duration=r,t.easing=$u.getName(h,u,c,g,m,_,f,p)}};function Se(t,e,s){return t%(1<<s)>>e}function cS(t){return t-128}function _d(t){return t-32768}function Cs(t,e){return t*e}var Bg=new Array(65535);function qo(t){let e=Bg[t];if(!e){const s=Se(t,0,4)/15,i=Se(t,4,8)/15,n=Se(t,8,12)/15,r=Se(t,12,16)/15;e=`rgba(${255*s|0}, ${255*i|0}, ${255*n|0}, ${r})`,s+i+n+r===0&&(e=null),Bg[t]=e}return e}var gS={[Vi]:"image",[Mo]:"piechart",[dn]:"text",[_n]:"icon",[fn]:"badge"},mS=class{constructor(){this._pixelRatio=1,this._nextPatternId=1,this._version=0,this._init_()}reset(){this._init_()}_init_(){this._mustUpdate=!0,this._nextPatternId=1,this._patterns=[null],this._patternsByHash={},this._pixelRatio=1,this._nullPattern={id:-1,type:hs,attributes:{}}}_increaseNextId(){let t=this._nextPatternId++;for(t%256==255&&(t=this._nextPatternId++);this._patterns.length<=t;)this._patterns.push(void 0);return t}_createPattern({type:t,attributes:e}){const s={id:this._increaseNextId(),type:t,attributes:this._getAttributes(t,e)};return this._patterns[s.id]=s,this._mustUpdate=!0,s}_getAttributes(t,e){return t===Vi?{image:e.image,scaled:e.scaled,duplicated:e.duplicated}:t===dn||t===_n||t===fn?{font:e.font,size:e.size,style:e.style,text:e.text,paddingLeft:e.paddingLeft,paddingTop:e.paddingTop,align:e.align||"center",offset:e.offset||0}:t===Mo&&e.colors?{colors:e.colors,colorArray:e.colors.split(";").map(s=>s.trim())}:{}}getPatternList(){return this._patterns.filter(t=>t)}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}setPixelRatio(t){t!==this._pixelRatio&&(this._pixelRatio=t,this._mustUpdate=!0)}getPixelRatio(){return this._pixelRatio}notifyUpdate(){this._mustUpdate=!0}getIdFromDefinition(t){const{type:e,attributes:s}=t,i=e===dn||e===_n||e===fn;let n=0;return e&&e!==hs&&e!==Xi&&(e!==Vi||s.image)&&(!i||s.text&&s.font)&&(n=this._addPattern(t),e===dn&&s.style==="normal"&&(s.style="bold",this._addPattern(t))),n}_addPattern(t){const e=this._getPatternHash(t);let s=this._patternsByHash[e];return s||(this._nextPatternId>65500?Gi("maximum number of pattern exceeded"):(s=this._createPattern(t).id,this._patternsByHash[e]=s)),s}_getPatternHash({type:t,attributes:e}){const s=[gS[t]];return t===Vi?s.push(e.scaled?"scaled":"non-scaled",e.duplicated?"duplicated":"non-duplicated",e.image.src||e.image.toDataURL()):t===dn?s.push(e.text,e.font,e.style,e.size,e.align||"center",e.offset||0):t===_n||t===fn?s.push(e.text,e.font,e.style,e.size,e.paddingLeft,e.paddingTop):s.push(e.colors),s.join("+")}getDefinitionFromId(t){if(t&&this._patterns[t]){const e=this._patterns[t];if(e)return e}return this._nullPattern}getVersion(){return this._version}};function Ug(t){return t.map(({x:e,y:s,r:i=0})=>({x:e,y:s,r:i}))}var _S=class{constructor(){this._version=0,this._mustUpdate=!0,this._byName={},this._byId=new Array(dl+1)}register(t,{getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:i,hole:n,isSimple:r}){if(this._byName[t])return;let o=r?1:Ah;const a=r?Ah-1:dl;for(;this._byId[o];)o+=1;if(o>a)throw new Error("max number of shape exceeded");const l={id:o,name:t,getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:Ug(i.slice()),hole:n?Ug(n.slice()):null,isSimple:!!r};return this._mustUpdate=!0,this._byId[o]=l,this._byName[t]=l,l}getIdFromName(t){return this._byName[t].id}getNameFromId(t){const e=this._byId[t];return e?e.name:""}getDefinitionFromName(t){return this._byName[t]}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}getVersion(){return this._version}getShapeList(){return this._byId.filter(t=>t)}},Lh=300,Ch=150,Ty=class{constructor(){this.style={},this.width=Lh,this.height=Ch,this.__context=new Iy,this.style={},this.width=Lh,this.height=Ch}get __dummy(){return!0}get parentNode(){return null}getContext(t){return t==="2d"?this.__context:null}toDataURL(t="png"){return`data:image/${t};base64,`}addEventListener(){}removeEventListener(){}getBoundingClientRect(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}}},Iy=class{constructor(){this._fontSize=10}set font(t){const e=t.match(/\d+/);e&&(this._fontSize=parseFloat(e[0]))}set fillStyle(t){}set textBaseline(t){}set textAlign(t){}set strokeStyle(t){}set lineWidth(t){}fill(){}stroke(){}clearRect(){}fillRect(){}strokeRect(){}beginPath(){}closePath(){}moveTo(){}lineTo(){}rect(){}arc(){}save(){}restore(){}clip(){}translate(){}rotate(){}fillText(){}setLineDash(){}quadraticCurveTo(){}bezierCurveTo(){}drawImage(){}measureText(t){return{width:t.length*Math.ceil(.625*this._fontSize)}}getImageData(){return{width:0,height:0,data:new Uint8ClampedArray(0)}}},Zo=Os("canvas")||Os("canvas-prebuilt");function ss(t=Lh,e=Ch){if(Ei){const i=document.createElement("canvas");return i.width=t,i.height=e,i}if(Zo){let i=null;return i="createCanvas"in Zo?Zo.createCanvas(t,e):new Zo(t,e),i.style={},i}const s=new Ty;return s.width=t,s.height=e,s}function Mh(t,e,s=t.width,i=t.height){e.clearRect(0,0,s,i)}function Yi(t,e,s,i=""){t.font=`${i} ${s}px ${e}`}function Ly(){return Ku(ss(),{},"webgl")!==null}var Cy=t=>{const{canvas:e,width:s,height:i}=ct({canvas:document.createElement("canvas"),width:window.innerWidth*devicePixelRatio,height:window.innerHeight*devicePixelRatio},t);e.width=Math.ceil(s),e.height=Math.ceil(i),e.style.width=Math.ceil(s/devicePixelRatio)+"px",e.style.height=Math.ceil(i/devicePixelRatio)+"px";const n=e.getContext("webgl2",{antialias:!0});if(!n)throw new Error("WebGL 2.0 not supported");return n},My=(t,e,s)=>{const i=Cy();return i.canvas.addEventListener("webglcontextlost",s),{context:i,cleanUp:()=>{var n;i.canvas.removeEventListener("webglcontextlost",s),(n=i.getExtension("WEBGL_lose_context"))==null||n.loseContext()}}};function Ku(t,e,s){let i=t.getContext(s,e);return i||(i=t.getContext("experimental-webgl",e)),i||null}function Qu(t,e){if(e<2)return t;const s=t.split(`
`),i=[];for(let n=0;n<s.length;++n){const r=s[n];if(r.length<e)i.push(r);else{const o=Ny(s[n],e);for(let a=0;a<o.length;++a)i.push(o[a])}}return i.join(`
`)}function Ny(t,e){const s=[""],i=t.split(" ");for(let n=0;n<i.length;n++){const r=s[s.length-1],o=i[n];r.length+1+o.length<=e&&r.length?s[s.length-1]+=(r.length>0?" ":"")+o:s.push(o)}return s}function Py(t,e){if(t===null)return null;const s=(t=t.toString()).split(`
`),i=[];let n=0;for(let r=0;r<s.length;r++){let o=s[r];if(!e||e<=1||o.length<e)i.push(o),n=Math.max(n,o.length);else{const a=Ny(s[r],e);for(let l=0;l<a.length;l++)o=a[l],i.push(o),n=Math.max(n,o.length)}}return{data:i,maxLength:n,lines:i.length}}function Fy(){const t=Os("@mapbox/mapbox-gl-rtl-text")||Os("mapbox-gl-rtl-text"),e=t?t.processBidirectionalText:ji?window.processBidirectionalText:null,s=t?t.applyArabicShaping:ji?window.applyArabicShaping:null;return{processBidirectionalText:e?n=>{if(n===null||n==null)return"";const r=[];let o=0,a="";const l=n.split(`
`);for(let d=0;d<l.length;d++){const h=l[d],u=l[d].length+o;u>0&&d<l.length-1&&r.push(u),a+=d>0?""+h:h,o+=h.length}return e(a,r).join(`
`)}:n=>n,applyArabicShaping:s?n=>n==null?null:typeof n=="number"?n.toString():s(n):n=>n==null?null:n.toString()}}var fd=Ml(),Jo=10,fS=1<<17,pS=65536,yS=256,Gg=128,xS=25,ky=1e3,Nh=2,bS=class{constructor(t){this._patternManager=t,this._canvas=ss(),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0}),this._processBidirectionalText=Fy().processBidirectionalText,this._cornerRadius=0,this._version=0,this._textPattern={id:0,type:Xi,attributes:{text:"",font:"",size:0,style:"normal",align:"center"},dimensions:{width:0,height:0}},this._textDimensions={width:0,height:0},this._lineWidthList=new Array(64),this._init()}_init(){this._mustClear=!1,this._clear()}reset(){this._init()}clear(){this._mustClear=!0}_measureChar(t,e,s){return Yi(this._ctx,e,go,s),this._ctx.measureText(t).width/go}_getAtlas(t,e,s,i){const n=s===Lo?0:s,r=this._byFont[t]||(this._byFont[t]={none:void 0,bold:void 0,italic:void 0,normal:void 0}),o=r[i]||(r[i]={}),a=o[e]||(o[e]=new Array(50));return a[n]||(a[n]=new Array(256))}_getMeasurementAtlas(t,e){const s=this._widthAtlases[e];return s[t]||(s[t]=new Array(256))}measureText(t,e,s,i=1){if(!e)return this._textDimensions.width=0,this._textDimensions.height=0,this._textDimensions;const n=this._getMeasurementAtlas(e,s);let r=0,o=0,a=1;for(let l=0;l<t.length;++l){const d=t.charCodeAt(l);if(d===Jo)o>r&&(r=o),o=0,a+=1;else{let h=n[d];h===void 0&&(h=this._measureChar(t[l],e,s),n[d]=h),o+=h}}return o>r&&(r=o),this._textDimensions.width=r*i,this._textDimensions.height=a*i,this._textDimensions}_getCharInfo(t,e,s,i,n,r){let o=t[e];if(!o){const a=String.fromCharCode(e);o={ratio:this._measureChar(a,s,i),patternId:0},o.patternId=this._patternManager.getIdFromDefinition({id:0,type:dn,attributes:{text:a,font:s,style:i,size:n,align:r}}),t[e]=o}return o}storeTextInDataView(t,e,s,i){let n=e;if(i&&i.type===Xi){const{font:r,style:o,size:a,align:l}=i.attributes,d=l==="center",h=this._getAtlas(r,o,a,l);let u=0,c=1,g=0,m=0;const _=this._lineWidthList,f=this._processBidirectionalText(i.attributes.text);for(let b=0;b<f.length;++b){const v=f.charCodeAt(b);v===Jo?(g>u&&(u=g),_[m]=g,m++,g=0,c++):g+=this._getCharInfo(h,v,r,o,a,l).ratio}_[m]=g,g>u&&(u=g),m=0;let p=-(d?_[m]:u)/2,x=(1-c)/2,y=0;for(let b=0;b<f.length;++b){const v=f.charCodeAt(b),E=h[v];if(v===Jo)m+=1,p=-(d?_[m]:u)/2,x+=b===0?.5:1,y=0;else{const A=E.ratio,S=E.patternId;p+=(A+y)/2,y=A;const T=(zs(p*ky+pS,0,fS-1)<<8)+zs(x*Nh+Gg,0,yS-1);t.setUint16(n,S,fd),t.setUint32(n+2,T,fd),n+=Ga}}}this._fillWithZeros(t,n,s)}extractTextFromDataView(t,e,s){const i=t,n=fd,r=i.getUint16(e,n),o=this._textPattern,a=this._patternManager.getDefinitionFromId(r),{font:l,style:d,size:h,align:u}=a.attributes,c=this._getAtlas(l,d,h,u),g=[];let m=0,_=0,f=0,p=null;for(let y=e;y<s;y+=Ga){const b=i.getUint16(y,n);if(!b)break;const v=(i.getUint8(y+2)-Gg)/Nh,E=this._patternManager.getDefinitionFromId(b);if(!E||!E.attributes||!E.attributes.text)break;const A=E.attributes.text.charCodeAt(0),S=c[A];p===null?p=v:v>p&&(m>_&&(_=m),m=0,f+=1,g.push(Jo),p=v),g.push(A),S&&(m+=S.ratio)}m>_&&(_=m);const x=String.fromCharCode.apply(null,g);return o.attributes.style=d,o.attributes.font=l,o.attributes.size=h,o.attributes.align=u,o.attributes.text=this._processBidirectionalText(x),o.dimensions&&(o.dimensions.width=_,o.dimensions.height=f),o}_fillWithZeros(t,e,s){for(let i=e;i<s;i+=Ga)t.setUint16(i,0)}_clear(){this._byFont={},this._widthAtlases={normal:{},bold:{},italic:{}}}update(){this._mustClear&&(this._clear(),this._mustClear=!1)}getVersion(){return this._version}getCornerRadius(){return this._cornerRadius}setCornerRadius(t){t!==this._cornerRadius&&(this._cornerRadius=t,this._version++)}};function Ko(t,e,s,i,n){const r=1-n;return r*r*r*t+3*n*r*r*e+3*n*n*r*s+n*n*n*i}function $n(t,e,s,i){const n=1-i;return n*n*t+2*n*i*e+i*i*s}var Dy=(t,e)=>2/(1+Math.exp(-Math.abs(t*e))),Ph=class Fh extends Co{constructor({bufferList:e,patternManager:s,boundariesManager:i,shapeManager:n,textManager:r,memoryManager:o}){super(),this._firstFrame=!0,this._width=0,this._height=0,this._pixelRatio=0,this._viewX=0,this._viewY=0,this._viewZoom=0,this._viewAngle=0,this._viewAngleCos=0,this._viewAngleSin=0,this._currentTime=0,this._scales={bytesToActualCoord:0,bytesToActualScaledSize:0,bytesToActualMinVisibleSize:0,bytesToActualSymbolicSize:0,bytesToActualDashLength:0,bytesToActualGapLength:0,bytesToActualPatternScale:0},this._shapesVersion=0,this._patternsVersion=0,this._boundariesVersion=0,this._textsVersion=0,this._backgroundRgba=[1,1,1,0],this._renderBackground=!1,this._hideImages=!1,this._genericObject=Yu(),this._littleEndian=Ml(),this._bufferList=e,this._shapeManager=n,this._patternManager=s,this._boundariesManager=i,this._textManager=r,this._memoryManager=o}static createInitData(){return null}static getName(){return null}static isAvailable(){return!0}static setEdgeArrowSizeRatio(e){Fh.edgeArrowSizeRatio=e}static setMinEdgeTipSize(e){Fh.minEdgeTipSize=e}getDomElement(){return null}_initCanvas(e){e.style.touchAction="none"}export(e){return Promise.resolve()}extractElement(e,s){return this._memoryManager.extractGenericElement(e,s,this._scales)}_compareDimensions(e,s,i){return(e!==this._width||s!==this._height||i!==this._pixelRatio)&&(this._width=e,this._height=s,this._pixelRatio=i,!0)}_compareView(e,s,i,n){return(e!==this._viewX||s!==this._viewY||i!==this._viewZoom||n!==this._viewAngle)&&(this._viewX=e,this._viewY=s,this._viewZoom=i,this._viewAngle=n,this._viewAngleCos=Math.cos(n),this._viewAngleSin=Math.sin(n),!0)}_compareCurrentTime(e){return e!==this._currentTime&&(this._currentTime=e,!0)}_compareBackgroundColor(e,s){return(e!==this._backgroundColor||s!==this._renderBackground)&&(this._renderBackground=s,this._backgroundColor=e,this._backgroundRgba=ds(this._backgroundColor),!0)}_compareShapes(){return this._shapesVersion!==this._shapeManager.getVersion()&&(this._shapesVersion=this._shapeManager.getVersion(),!0)}_comparePatterns(){return this._patternsVersion!==this._patternManager.getVersion()&&(this._patternsVersion=this._patternManager.getVersion(),!0)}_compareBoundaries(){return this._boundariesVersion!==this._boundariesManager.getVersion()&&(this._boundariesVersion=this._boundariesManager.getVersion(),!0)}_compareTexts(){return this._textsVersion!==this._textManager.getVersion()&&(this._textsVersion=this._textManager.getVersion(),!0)}_compareIsDisplayableBuffer(e){return this._isBufferDisplayable!==e&&(this._isBufferDisplayable=e,!0)}_compareHideImages(e){return this._hideImages!==e&&(this._hideImages=e,!0)}renderFrame({x:e,y:s,zoom:i,angle:n,width:r,height:o,pixelRatio:a,backgroundColor:l,currentTime:d,isBufferDisplayable:h,hideImages:u,renderBackground:c}){const g=this._compareShapes(),m=this._comparePatterns(),_=this._compareBoundaries(),f=this._compareTexts(),p=this._compareDimensions(r,o,a),x=this._compareView(e,s,i,n),y=this._compareCurrentTime(d),b=this._compareBackgroundColor(l,c),v=this._compareIsDisplayableBuffer(h),E=this._compareHideImages(u);if(_){const A=this._boundariesManager,S=this._scales;S.bytesToActualCoord=1,S.bytesToActualScaledSize=A.maxScaledSize/oy,S.bytesToActualMinVisibleSize=A.maxMinVisibleSize/Eh,S.bytesToActualSymbolicSize=A.maxSymbolicSize/Xn,S.bytesToActualDashLength=A.maxDashLength/Yn,S.bytesToActualGapLength=A.maxGapLength/Yn,S.bytesToActualPatternScale=A.maxPatternScale/Xn}this._firstFrame&&this._beforeFirstFrame(),this._render({shapesChanged:g,patternsChanged:m,boundariesChanged:_,textsChanged:f,dimensionsChanged:p,viewChanged:x,currentTimeChanged:y,backgroundColorChanged:b,isBufferDisplayableChanged:v,isHideImagesChanged:E}),this._firstFrame&&(this._afterFirstFrame(),this._firstFrame=!1)}_render(e){}_beforeFirstFrame(){}_afterFirstFrame(){}destroy(){}ensureAnimationsReady(){}getImageData(){return null}setViewportClipping(e){}};Ph.edgeArrowSizeRatio=ly,Ph.minEdgeTipSize=dy;var xi=Ph,tc=()=>({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),xs=class ja{constructor(e={}){const{xValues:s=[],yValues:i=[],scaledSizeValues:n=[],fixedSizeValues:r=[]}=e;this.minX=mi(s),this.minY=mi(i),this.maxX=Wn(s),this.maxY=Wn(i),this.minScaledSize=mi(n),this.maxScaledSize=Wn(n),this.minFixedSize=mi(r),this.maxFixedSize=Wn(r),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY}reset(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.minScaledSize=1/0,this.maxScaledSize=-1/0,this.minFixedSize=1/0,this.maxFixedSize=-1/0,this.width=0,this.height=0,this.cx=0,this.cy=0,this}addPoint(e,s,i,n){return this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s),i!==void 0&&n!==void 0&&(n==="scaled"?(this.minScaledSize=Math.min(this.minScaledSize,i),this.maxScaledSize=Math.max(this.maxScaledSize,i)):(this.minFixedSize=Math.min(this.minFixedSize,i),this.maxFixedSize=Math.max(this.maxFixedSize,i))),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this}computeForZoom(e){const s=Math.max(this.maxScaledSize,this.maxFixedSize/e);return ja.from({minX:this.minX-s/2,minY:this.minY-s/2,maxX:this.maxX+s/2,maxY:this.maxY+s/2,width:this.width+s,height:this.height+s})}static from({minX:e,minY:s,maxX:i,maxY:n,width:r,height:o}={}){const a=new ja;return e!=null&&(a.minX=e),s!=null&&(a.minY=s),i!=null&&(a.maxX=i),n!=null&&(a.maxY=n),i!=null&&e!=null&&(a.width=r||(i-e)/2,a.cx=(e+i)/2),n!=null&&s!=null&&(a.height=o||(n-s)/2,a.cy=(s+n)/2),a}static fromValues(e,s,i){let n=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0;h<e.length;h++){const u=e[h],c=s[h],g=i[h];u-g<n&&(n=u-g),c-g<r&&(r=c-g),u+g>o&&(o=u+g),c+g>a&&(a=c+g),g>l&&(l=g)}const d=ja.from({minX:n,minY:r,maxX:o,maxY:a});return d.maxScaledSize=l,d}pad(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,this.width+=2*e,this.height+=2*e,this}isValid(){return isFinite(this.width)&&isFinite(this.height)}extend(e){return this.addPoint(e.minX,e.minY),this.addPoint(e.maxX,e.maxY),this}bottomLeft(){return{x:this.minX,y:this.minY}}topRight(){return{x:this.maxX,y:this.maxY}}},vS=5,Vg=5;function Vl(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/Vg*s)*Vg,l=-n+Math.PI,d=-n+Math.PI/2;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function In(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,m=-u*n/vS;return o.x=a+c*m,o.y=l+g*m,o}function jl(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(1-t)*(1-t)*e+2*(1-t)*t*r+t*t*i,a.y=(1-t)*(1-t)*s+2*(1-t)*t*o+t*t*n,a}function ec(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(2*t-2)*e+(2*i-4*r)*t+2*r,a.y=(2*t-2)*s+(2*n-4*o)*t+2*o,Cf(a)}function Ry(t,e,s,i,n,r,o,a={x:0,y:0}){return ec(t,e,s,i,n,r,s,a),Xa(a.x,a.y,0,0,Math.PI/2,a),a}function Oy(t,e,s,i,n,r,o,a,l,d=0,h=!1){const u=s-2*o+n,c=i-2*a+r,g=-((s-t)*c-(i-e)*u)/((2*o-2*s)*c-(2*a-2*i)*u);if(g<0||g>1)return!1;let m=l/2;h&&(m*=1-g),m+=d;const _=$n(s,o,n,g),f=$n(i,a,r,g);return je(_,f,t,e)<=m}function ES(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=In(i.x,i.y,n.x,n.y,s);return jl(e,i.x,i.y,n.x,n.y,r.x,r.y)}function AS(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=In(i.x,i.y,n.x,n.y,s);return Ry(e,i.x,i.y,n.x,n.y,r.x,r.y)}function SS(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=In(i.x,i.y,n.x,n.y,s);return ec(e,i.x,i.y,n.x,n.y,r.x,r.y)}function _o(t,e,s,i,n,r,o,a,l,d={x:0,y:0}){const h=(1-t)*(1-t)*(1-t),u=3*t*(1-t)*(1-t),c=3*t*t*(1-t),g=t*t*t;return d.x=h*e+u*r+c*a+g*i,d.y=h*s+u*o+c*l+g*n,d}function zy(t,e,s,i,n,r,o,a,l,d,h,u){const c=je(s,i,o,a);if(Math.abs(t-s)>c||Math.abs(e-i)>c)return!1;let g=.5,m=je(t,e,s,i)<je(t,e,n,r)?-.01:.01,_=100;const f=_o(g,s,i,n,r,o,a,l,d);let p,x=je(t,e,f.x,f.y);const y=h/2+u;for(;_-- >0&&g>=0&&g<=1&&x>y&&(m>.001||m<-.001);)p=x,_o(g,s,i,n,r,o,a,l,d,f),x=je(t,e,f.x,f.y),x>p?(m=-m/2,g+=m):g+m<0||g+m>1?(m/=2,x=p):g+=m;return x<y}function sc(t,e,s,i,n,r,o=tc()){const a=t+.6666666666666666*(s-t),l=e+2/3*(i-e);return Hl(t,e,a,l,a+1/3*(n-t),l+1/3*(r-e),n,r,o)}function Hl(t,e,s,i,n,r,o,a,l=tc()){const{min:d,max:h,sqrt:u}=Math;let c,g,m,_,f;l.minX=d(t,o),l.maxX=h(t,o),l.minY=d(e,a),l.maxY=h(e,a);for(let p,x,y,b,v,E,A,S=0;S<2;++S)if(S===0?(g=t,m=s,_=n,f=o):(g=e,m=i,_=r,f=a),x=6*g-12*m+6*_,p=-3*g+9*m-9*_+3*f,y=3*m-3*g,x|=0,p|=0,y|=0,p!==0)v=x*x-4*y*p,v<0||(E=(-x+u(v))/(2*p),E>0&&E<1&&(c=pd(E,g,m,_,f),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))),A=(-x-u(v))/(2*p),A>0&&A<1&&(c=pd(A,g,m,_,f),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))));else{if(x===0)continue;b=-y/x,b>0&&b<1&&(c=pd(b,g,m,_,f),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c)))}return l}function pd(t,e,s,i,n){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*s+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*n}function wS(t,e,s,i,n,r){const o=t-2*s+n,a=e-2*i+r,l=2*s-2*t,d=2*i-2*e,h=4*(o*o+a*a),u=4*(o*l+a*d),c=l*l+d*d,g=2*Math.sqrt(h+u+c),m=Math.sqrt(h),_=2*h*m,f=2*Math.sqrt(c),p=u/m;return(_*g+m*u*(g-f)+(4*c*h-u*u)*Math.log((2*m+p+g)/(p+f)))/(4*_)}function By(t,e,s,i,n,r,o,a=0,l=!1){const d=je(s,i,n,r),h=(o/2*(l?je(t,e,n,r)/d:1)+a)/d,u=(n-s)*h,c=(r-i)*h,g=s+c,m=i-u,_=t-g,f=e-m,p=s-c-g,x=i+u-m,y=n+c-g,b=r-u-m,v=_*p+f*x,E=_*y+f*b;return v>0&&v<p*p+x*x&&E>0&&E<y*y+b*b}function TS(t,e,s,i,n=!1){if(n&&(Qo(t,s)||Qo(t,i)||Qo(e,s)||Qo(e,i)))return!1;let r=(t.y-s.y)*(i.x-s.x)-(t.x-s.x)*(i.y-s.y);const o=(e.x-t.x)*(i.y-s.y)-(e.y-t.y)*(i.x-s.x);if(o===0)return!1;const a=r/o;r=(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y);const l=r/o;return!(a<=0||a>=1||l<=0||l>=1)}function Qo(t,e){return t.x===e.x&&t.y===e.y}function ur(t,e,s,i){return Math.atan2(i-e,s-t)}function IS(t,e,s){const i=ur(t.x,t.y,e.x,e.y)-ur(s.x,s.y,e.x,e.y);return i<0?i+2*Math.PI:i}function LS(t,e,s,i,n,r,o,a){const l=(a-r)*(s-t)-(o-n)*(i-e);if(l===0)return null;let d=e-r;return d=((o-n)*d-(a-r)*(t-n))/l,{x:t+d*(s-t),y:e+d*(i-e)}}function zr(t,e,s,i,n,r,o,a){const l=t-s,d=e-i,h=n-o,u=r-a,c=l*u-h*d,g=(d*(t-n)-l*(e-r))/c;if(g<0||g>1)return null;const m=(h*(r-e)+u*(t-n))/c;return m>=0&&m<=1?{x:t-m*l,y:e-m*d}:null}function Uy(t,e,s,i,n,r,o,a){let l;const d=[];return l=zr(t,e,s,i,n,r,n,a),l&&d.push(l),l=zr(t,e,s,i,n,a,o,a),l&&d.push(l),l=zr(t,e,s,i,o,a,o,r),l&&d.push(l),l=zr(t,e,s,i,o,r,n,r),l&&d.push(l),d}function qn(t,e,s,i,n,r,o,a){const l=((o-n)*(e-r)-(a-r)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e)),d=((s-t)*(e-r)-(i-e)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e));return l>=0&&l<=1&&d>=0&&d<=1}function ic(t,e,s,i,n,r,o,a){return t>=n&&e>=r&&t<=o&&e<=a||s>=n&&i>=r&&s<=o&&i<=a||!!qn(t,e,s,i,n,r,n,a)||!!qn(t,e,s,i,o,r,o,a)||!!qn(t,e,s,i,n,r,o,r)||!!qn(t,e,s,i,n,a,o,a)}function Gy(t,e,s){return Math.sqrt(nc(t.x,t.y,e.x,e.y,s.x,s.y))}function nc(t,e,s,i,n,r){const o=Da(s,i,n,r);if(o===0)return Da(t,e,s,i);let a=((t-s)*(n-s)+(e-i)*(r-i))/o;return a=Math.max(0,Math.min(1,a)),Da(t,e,s+a*(n-s),i+a*(r-i))}function Vy(t,e,s,i,n,r){const o=n-s,a=r-i;if(o===0&&a===0)return{x:s,y:i};const l=((t-s)*o+(e-i)*a)/(o*o+a*a);return l<0?{x:s,y:i}:l>1?{x:n,y:r}:{x:s+l*o,y:i+l*a}}function CS(t,e,s,i,n,r){const o=n-s,a=r-i,l=((t-s)*o+(e-i)*a)/(o*o+a*a);return{x:s+o*l,y:i+a*l}}function Wl(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,m=-u*n/Bl;return o.x=a+c*m,o.y=l+g*m,o}function rc(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/ul*s)*ul,l=-n+Ds,d=Ds/2-n;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}var MS={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}},NS=[{name:"topLeft",dx:-1,dy:-1},{name:"topRight",dx:1,dy:-1},{name:"bottomLeft",dx:-1,dy:1},{name:"bottomRight",dx:1,dy:1}],ci={x:0,y:0};function PS(t,e,s,i,n,r,o,a,l,d,h,u){r=r||o.getNodes()._indexes;const c=l.getZoom(),g=o.getObjectList(!0),m=a.getFlexArrays().nodes.current;let _=1/0,f=0,p=-1/0;a.update();for(let x=0;x<r.length;++x){const y=r[x];if(m.excluded.get(y)||!m.detectable.get(y)||h.has(y))continue;const b=m.x.get(y),v=m.y.get(y),E=m.layer.get(y);if(E<p)continue;ci.x=b,ci.y=v;const A=l.graphToScreenCoordinates(ci),S=A.x,T=A.y,L=m.shape.get(y),I=m.scalingMethod.get(y)==="scaled",R=m.radius.get(y)*(I?c:1),z=R+n,j=(t-S)/z,C=(e-T)/z;if(ci.x=t,ci.y=e,!(i&&jy(ci,y,a,l,d)))if(d.checkShapeHit(L,j,C)){const w=o.getAttribute(!0,"virtual").get(y)!==0;if(z>_&&w)continue;_=z}else{if(!s)continue;{const w=u(m.text.content.get(y)||null),H=m.textHidden.get(y),K=m.text.minVisibleSize.get(y);if(H||!w||(I?2*R:1/0)<K)continue;const it=Qu(w,m.text.maxLineLength.get(y)),xt=m.innerStroke.width.get(y),at=m.text.margin.get(y),Tt=m.text.padding.get(y),It=m.text.size.get(y),dt=m.text.scale.get(y),bt=m.text.scaling.get(y),Ht=m.text.font.get(y),Qt=m.text.style.get(y),Xt=m.text.position.get(y),mt=d.measureText(it,Ht,Qt,1),ft=bt?dt*R*2:It,te=mt.width*ft/2+Tt,qt=mt.height*ft/2+Tt,se=MS[Xt],ee=xt+at+R,$=S+(ee+te)*se.x,et=T+(ee+qt)*se.y;if(t<=$-te||t>=$+te||e<=et-qt||e>=et+qt)continue}}f=y,p=E}return g.get(f)||null}var jg=Math.cos(Math.PI/4);function jy(t,e,s,i,n){const r=s.getFlexArrays().nodes.current,o=i.getZoom(),a=r.scalingMethod.get(e)==="scaled",l=r.radius.get(e)*(a?o:1),d=r.x.get(e),h=r.y.get(e);for(let u=0;u<4;u++){const{name:c,dx:g,dy:m}=NS[u],_=r.badges[c].stroke.width.get(e),f=r.badges[c].stroke.scalingMethod.get(e)==="scaled",p=r.badges[c].scale.get(e)*l+(f?o:1)*_,x=r.badges[c].minVisibleSize.get(e)/2,y=r.badges[c].positionScale.get(e);if(!r.badges[c].text.content.get(e)&&!r.badges[c].image.url.get(e)||p<x)continue;const b=i.graphToScreenCoordinates({x:d+r.radius.get(e)*y*g*jg,y:h+r.radius.get(e)*y*m*jg}),{x:v,y:E}=b,A=(t.x-v)/p,S=(t.y-E)/p;if(n.checkShapeHit("circle",A,S))return c}}function FS(t,e,s,i,n,r,o,a,l){n=n||r.getEdges()._indexes;const d=r.getObjectList(!1),h=l.getFlexArrays(),u=h.edges.current,c=h.nodes.current,g=o.getZoom(),m=i/g;ci.x=t,ci.y=e;const _=o.screenToGraphCoordinates(ci),f=_.x,p=_.y;let x=0;l.update();for(let y=0;y<n.length;++y){const b=n[y],v=u.source.get(b),E=u.target.get(b),A=u.excluded.get(b),S=u.detectable.get(b),T=a.has(v),L=a.has(E);if(A||!S||T||L)continue;const I=v===E,R=u.curvature.get(b),z=u.shape.body.get(b)==="triangle",j=u.scalingMethod.get(b)==="scaled",C=u.width.get(b)/(j?1:g),w=c.x.get(v),H=c.y.get(v),K=c.x.get(E),it=c.y.get(E);if(I){const xt=c.scalingMethod.get(v)==="scaled",at=rc(w,H,R,c.radius.get(v)/(xt?1:g),0);if(!zy(f,p,w,H,w,H,at.x1,at.y1,at.x2,at.y2,C,m))continue}else if(R!==0){const xt=Wl(w,H,K,it,R);if(!Oy(f,p,w,H,K,it,xt.x,xt.y,C,m,z))continue}else if(!By(f,p,w,H,K,it,C,m,z))continue;x=b}return d.get(x)||null}function kS(t){const e=t.getNodeAttribute("radius"),s=t.getEdgeAttribute("width"),i=t.getNodes(),n=t.getEdges();let r=0,o=0;for(let a=0;a<i._indexes.length;a++){const l=i._indexes[a],d=e.get(l);d>r&&(r=d)}for(let a=0;a<n._indexes.length;a++){const l=n._indexes[a],d=s.get(l);d>o&&(o=d)}return Math.max(2*r,o)}function DS(t){return t===null?"none":t==="webgl"?"WebGL":t==="svg"?"SVG":t==="canvas"?"Canvas":t}function Hy(t,e,s,i){const n=(t-e)/s,r=n*n,o=r*n,a=$u.getCoefficients(i),l=n<.5?0:4;return zs(a[l]+a[l+1]*n+a[l+2]*r+a[l+3]*o,0,1)}function Br(t,e,s,i){if(t===e)return t;const[n,r,o,a]=ds(t),[l,d,h,u]=ds(e);return`rgba(${Math.round(255*ue(n,l,s))},${Math.round(255*ue(r,d,s))},${Math.round(255*ue(o,h,s))},${ue(a,u,i)})`}function RS(t,e){const[s,i,n,r]=ds(t);return`rgba(${255*s},${255*i},${255*n},${r*e})`}var ta=1/_s,Wy=class extends xi{constructor(t){super(t),this._cachePoints=[],this._nextCachePoint=0,this._tmp={x1:0,y1:0,x2:0,y2:0},this._pointCopies=Array(128),this._clipViewport=!0}_resetCachePoints(){this._nextCachePoint=0}_point(t,e){let s=this._cachePoints[this._nextCachePoint++];return s||(s={x:0,y:0},this._cachePoints.push(s)),s.x=t,s.y=e,s}setViewportClipping(t){this._clipViewport=t}_displayBuffer(t){const e=t.getSize(),s=t.animated;for(let i=0;i<e;++i){const n=this.extractElement(t,i);n.valid&&this._displayElement(n,s)}}_mixAttributes(t,e,s){const i=Hy(this._currentTime,s.beginTime,s.duration,s.easing);return t.dashLength=ue(e.dashLength,t.dashLength,i),t.gapLength=ue(e.gapLength,t.gapLength,i),t.offsetAngle=ue(e.offsetAngle,t.offsetAngle,i),t.opacity=ue(e.opacity,t.opacity,i),t.globalMinVisibleSize=ue(e.globalMinVisibleSize,t.globalMinVisibleSize,i),t.strokeMinVisibleSize=ue(e.strokeMinVisibleSize,t.strokeMinVisibleSize,i),t.patternMinVisibleSize=ue(e.patternMinVisibleSize,t.patternMinVisibleSize,i),t.symbolicSize=ue(e.symbolicSize,t.symbolicSize,i),t.curvature=ue(e.curvature,t.curvature,i),t.fillColor=Br(e.fillColor,t.fillColor,i,i),t.strokeColor=Br(e.strokeColor,t.strokeColor,i,i),t.patternColor=Br(e.patternColor,t.patternColor,i,i),t.x1=ue(e.x1,t.x1,i),t.y1=ue(e.y1,t.y1,i),t.x2=ue(e.x2,t.x2,i),t.y2=ue(e.y2,t.y2,i),t.rectWidthOrSourceRadiusScaled=ue(e.rectWidthOrSourceRadiusScaled,t.rectWidthOrSourceRadiusScaled,i),t.rectWidthOrSourceRadiusFixed=ue(e.rectWidthOrSourceRadiusFixed,t.rectWidthOrSourceRadiusFixed,i),t.rectHeightOrTargetRadiusScaled=ue(e.rectHeightOrTargetRadiusScaled,t.rectHeightOrTargetRadiusScaled,i),t.rectHeightOrTargetRadiusFixed=ue(e.rectHeightOrTargetRadiusFixed,t.rectHeightOrTargetRadiusFixed,i),t.thicknessOrFontSizeScaled=ue(e.thicknessOrFontSizeScaled,t.thicknessOrFontSizeScaled,i),t.thicknessOrFontSizeFixed=ue(e.thicknessOrFontSizeFixed,t.thicknessOrFontSizeFixed,i),t.strokeWidthScaled=ue(e.strokeWidthScaled,t.strokeWidthScaled,i),t.strokeWidthFixed=ue(e.strokeWidthFixed,t.strokeWidthFixed,i),t.offsetScaled=ue(e.offsetScaled,t.offsetScaled,i),t.offsetFixed=ue(e.offsetFixed,t.offsetFixed,i),t}_computeRenderInfo(t){const e=this._viewZoom,s=this._point(t.x1,t.y1),i=this._point(t.x2,t.y2);return{shape:this._shapeManager.getDefinitionFromName(t.shape),pieceId:t.pieceId,dashLength:t.dashLength,gapLength:t.gapLength,hasHead:t.hasHead,hasTail:t.hasTail,isBodyTriangle:t.isBodyTriangle,isSelfLoop:t.isSelfLoop,patternScale:t.patternScale,offsetAngle:sl(t.offsetAngle),isText:t.isText,adjustTextAngle:t.adjustTextAngle,isBadge:t.isBadge,unusedFlag2:t.unusedFlag2,unusedFlag3:t.unusedFlag3,opacity:t.opacity,globalMinVisibleSize:t.globalMinVisibleSize,strokeMinVisibleSize:t.strokeMinVisibleSize,patternMinVisibleSize:t.patternMinVisibleSize,symbolicSize:t.symbolicSize===0?1/0:t.symbolicSize*e,curvature:t.curvature,pattern:t.pattern,fillColor:t.fillColor,strokeColor:t.strokeColor,patternColor:t.patternColor,pos1OnGraph:s,pos2OnGraph:i,pos1:this._graphToScreenCoordinates(s),pos2:this._graphToScreenCoordinates(i),rectWidthOrSourceRadius:t.rectWidthOrSourceRadiusScaled*e+t.rectWidthOrSourceRadiusFixed,rectHeightOrTargetRadius:t.rectHeightOrTargetRadiusScaled*e+t.rectHeightOrTargetRadiusFixed,thicknessOrFontSize:t.thicknessOrFontSizeScaled*e+t.thicknessOrFontSizeFixed,strokeWidth:t.strokeWidthScaled*e+t.strokeWidthFixed,offset:t.offsetScaled*e+t.offsetFixed}}_applyBackgroundBlending(t){t.opacity!==1&&(t.fillColor=this._blendColor(t.fillColor,t.opacity),t.strokeColor=this._blendColor(t.strokeColor,t.opacity),t.textColor=this._blendColor(t.textColor,t.opacity))}_pointArray(t){let e=this._pointCopies[t];if(!e){e=new Array(t),this._pointCopies[t]=e;for(let s=0;s<t;++s)e[s]={x:0,y:0,r:0}}return e}_scalePoints(t,e,s,i){const n=t.shape.points.length,r=this._pointArray(n);for(let l=0;l<n;++l){const d=t.shape.points[l],h=r[l];h.x=e.x+d.x*s,h.y=e.y+d.y*i,h.r=d.r*s}const o=t.pos2OnGraph.x-t.pos1OnGraph.x,a=t.pos2OnGraph.y-t.pos1OnGraph.y;if(o!==0||a!==0){const l=Math.sqrt(o*o+a*a),d=o/l,h=a/l;for(const u of r){const c=u.x-e.x,g=u.y-e.y;u.x=e.x+d*c+h*g,u.y=e.y-h*c+d*g}}return r}_drawPoints(t,e=!1){t.length===1?this._drawCircle(t[0],t[0].r):this._drawPolygon(t,e)}_computeCenter(t){const e=Math.cos(t.offsetAngle),s=Math.sin(t.offsetAngle),i=(t.pos1.x+t.pos2.x)/2+e*t.offset,n=(t.pos1.y+t.pos2.y)/2+s*t.offset;return this._point(i,n)}_displayTextBox(t,e,s,i){const n=this._computeCenter(t),r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2;(e||i)&&this._drawRoundedRectangle(n,r,o,0,t.fillColor)}_displayNodeComponent(t,e,s,i){const n=this._computeCenter(t);if(t.pattern.type!==Xi){const r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2,a=this._scalePoints(t,n,r,o);if((e||i)&&this._drawPoints(a,!0),e&&this._fill(t.fillColor),i){if(this._startClip(),t.pattern.type===Mo){let l=t.pattern.attributes.colorArray;t.opacity!==1&&(l=l.map(d=>this._blendColor(d,t.opacity))),this._displayPieChart(n,r,l)}else if(t.pattern.type===_n||t.pattern.type===fn){const d=Math.round(t.rectHeightOrTargetRadius*t.patternScale),h=t.pattern.attributes.text,u=t.patternColor,c=t.pattern.attributes.font,g=t.pattern.attributes.style,m=t.pattern.attributes.align,_=t.rectWidthOrSourceRadius,f=t.pattern.attributes.paddingTop,p=t.pattern.attributes.paddingLeft;this._displayText(n,0,h,u,c,d,g,m,_,p,f,!0)}else if(t.pattern.type===Vi){const l=t.pattern.attributes.image;if(l.isDummy||l.width&&l.height){const d=t.pattern.attributes.duplicated,h=d?1:t.patternScale,u=t.rectWidthOrSourceRadius*h,c=t.rectHeightOrTargetRadius*h,g=t.pattern.attributes.scaled,m=t.opacity;this._displayImage(n,u,c,l,g,d,m)}}this._endClip()}if(s){const l=t.strokeWidth/2,d=this._scalePoints(t,n,r+l,o+l);this._drawPoints(d),this._stroke(t.strokeColor,t.strokeWidth)}}else if(i){const o=t.thicknessOrFontSize,a=t.pattern.attributes.text,l=t.patternColor,d=t.pattern.attributes.font,h=t.pattern.attributes.style,u=t.pattern.attributes.align,c=t.rectWidthOrSourceRadius;this._displayText(n,0,a,l,d,o,h,u,c,0,0,!1)}}_displayElement(t,e){if(!t.end||!t.end.shape||!t.end.pieceId||e&&(!t.start||!t.animation))return;this._resetCachePoints();const s=e?this._mixAttributes(t.end,t.start,t.animation):t.end,i=this._computeRenderInfo(s);if(i.symbolicSize<i.globalMinVisibleSize||i.opacity===0)return;this._applyBackgroundBlending(i);const n=!!(i.strokeColor&&i.strokeWidth>0&&i.symbolicSize>=i.strokeMinVisibleSize),r=i.pattern.type!==hs&&i.symbolicSize>=i.patternMinVisibleSize,o=!!i.fillColor;if(i.pieceId===Bs)return this._displayNodeComponent(i,o,n,r);if(i.pieceId===hn)return this._displayTextBox(i,o,n,r);const a=i.pos2.x-i.pos1.x,l=i.pos2.y-i.pos1.y,d=Math.sqrt(a*a+l*l);let h,u=null,c=null;if(i.isSelfLoop){const g=i.pieceId===nn||i.pieceId===nn+hn?i.strokeWidth/2:i.rectWidthOrSourceRadius,{x1:m,y1:_,x2:f,y2:p}=this._getSelfLoopControlPoints(i.pos1,i.curvature,g);u=this._point(m,_),c=this._point(f,p),h=zS(i.pos1,u,c,i.pos2,1)}else i.curvature?(u=this._getQuadraticCurveControlPoint(i),h=OS(i.curvature,d,1)):h=d;if(i.pieceId===nn||i.pieceId===nn+hn){const g=i.strokeWidth,m=this._getPointOnLine(i.pos1,u,c,i.pos2,.5),_=this._getTangentOnLine(i.pos1,u,c,i.pos2,.5);if(i.rectWidthOrSourceRadius>=h-g&&!i.isSelfLoop){if(!i.adjustTextAngle)return;_.x=1,_.y=0}let f=-Math.atan2(_.y,_.x);const p=sl(i.offsetAngle-f);(!i.isSelfLoop&&p<0||i.isSelfLoop&&i.offsetAngle<0)&&(_.x*=-1,_.y*=-1),(f>Math.PI/2||f<-Math.PI/2)&&(f+=Math.PI);const x=this._getOrthogonal(_),y=m.x+x.x*i.offset,b=m.y+x.y*i.offset;if(i.pieceId===nn+hn){if(!i.fillColor)return;const v=i.rectWidthOrSourceRadius/2,E=i.rectHeightOrTargetRadius/2;this._drawRoundedRectangle(this._point(y,b),v,E,p+Math.PI/2,i.fillColor)}else{const v=this._point(y,b),E=f,A=i.thicknessOrFontSize,S=i.pattern.attributes.text,T=i.patternColor,L=i.pattern.attributes.font,I=i.pattern.attributes.style,R=i.pattern.attributes.align,z=i.rectWidthOrSourceRadius;this._displayText(v,E,S,T,L,A,I,R,z,0,0,!1)}}else{const g=i.pieceId===Wu,m=i.pieceId===Xu,_=Math.cos(i.offsetAngle),f=Math.sin(i.offsetAngle);i.pos1.x+=_*i.offset,i.pos1.y+=f*i.offset,i.pos2.x+=_*i.offset,i.pos2.y+=f*i.offset;const p=i.shape.name==="line",x=i.thicknessOrFontSize,y=i.rectWidthOrSourceRadius,b=i.rectHeightOrTargetRadius,v=+i.hasHead,E=+i.hasTail,A=Math.max(xi.minEdgeTipSize,x*xi.edgeArrowSizeRatio),S=v*Math.min(5*y,A),T=E*Math.min(5*b,A),L=i.isSelfLoop?1/0:d-y-b,I=Math.min(0,L-S-T)/2,R=x/2;let z=y>R?y-Math.sqrt(y*y-R*R):R;const j=Math.max(y+T+E*I,0)-(1-v)*z;z=y>R?b-Math.sqrt(b*b-R*R):R;const C=Math.max(b+S+v*I,0)-(1-E)*z;if(g||m){const w=m?-1:1,H=(g?h-C:j)-w;let K=null,it=null;if(i.isSelfLoop&&u&&c){const xt=this._getTFromLengthOnCubicCurve(i.pos1,u,c,i.pos2,H-i.strokeWidth/2*w);K=this._getPointOnCubicCurve(i.pos1,u,c,i.pos2,xt),it=this._getTangentOnCubicCurve(i.pos1,u,c,i.pos2,xt)}else if(i.curvature&&u){const xt=this._getTFromLengthOnQuadraticCurve(i.pos1,u,i.pos2,H-i.strokeWidth/2*w);K=this._getPointOnQuadraticCurve(i.pos1,u,i.pos2,xt),it=this._getTangentOnQuadraticCurve(i.pos1,u,i.pos2,xt)}else{const xt=H/h;K=this._mixPoints(i.pos1,i.pos2,xt),it=this._point(a/d,l/d)}if(it.x*=w,it.y*=w,o){if(i.shape.hole){const at=this._makeEdgeExtremityPoints(K,it,A,i.shape.hole);this._drawPoints(at),this._startReverseClip()}const xt=this._makeEdgeExtremityPoints(K,it,A,i.shape.points);this._drawPoints(xt),this._fill(i.fillColor),i.shape.hole&&this._endReverseClip()}if(n){if(i.shape.hole){const Tt=this._makeEdgeExtremityPoints(K,it,A,i.shape.hole);this._drawPoints(Tt),this._stroke(i.strokeColor,i.strokeWidth)}const xt=A+i.strokeWidth/2,at=this._makeEdgeExtremityPoints(K,it,xt,i.shape.points);this._drawPoints(at),this._stroke(i.strokeColor,i.strokeWidth)}}else{if(h-j-C<=0)return;if(p){const w=BS(h,x,j,C,i.dashLength,i.gapLength);n&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.strokeColor,x+2*i.strokeWidth,w)),o&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.fillColor,x,w))}else{const w=j,H=h-C;if(n){const K=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,w,H,x+i.strokeWidth/2,i.strokeWidth/2);this._drawPoints(K),this._stroke(i.strokeColor,i.strokeWidth)}if(o){const K=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,w,H,x,0);this._drawPoints(K),this._fill(i.fillColor)}}}}}_makeTriangleEdgeBody(t,e,s,i,n,r,o,a){return e?s?this._makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a):this._makeCurveTriangleEdge(t,e,i,n,r,o,a):this._makeStraightTriangleEdge(t,i,n,r,o,a)}_makeCurveTriangleEdge(t,e,s,i,n,r,o){const a=2*_s+2,l=this._pointArray(a),d=this._getTFromLengthOnQuadraticCurve(t,e,s,i),h=(this._getTFromLengthOnQuadraticCurve(t,e,s,n)-d)/_s,u=(o-r)/_s/2;let c=r/2,g=d;for(let m=0;m<=_s;++m){const _=this._getPointOnQuadraticCurve(t,e,s,g),f=this._getTangentOnQuadraticCurve(t,e,s,g),p=this._getOrthogonal(f),x=p.x*c,y=p.y*c,b=l[m],v=l[a-1-m];b.x=_.x+x,b.y=_.y+y,v.x=_.x-x,v.y=_.y-y,g+=h,c+=u}return l}_makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a){const l=2*_s+2,d=this._pointArray(l),h=this._getTFromLengthOnCubicCurve(t,e,s,i,n),u=(this._getTFromLengthOnCubicCurve(t,e,s,i,r)-h)/_s,c=(a-o)/_s/2;let g=o/2,m=h;for(let _=0;_<=_s;++_){const f=this._getPointOnCubicCurve(t,e,s,i,m),p=this._getTangentOnCubicCurve(t,e,s,i,m),x=this._getOrthogonal(p),y=x.x*g,b=x.y*g,v=d[_],E=d[l-1-_];v.x=f.x+y,v.y=f.y+b,E.x=f.x-y,E.y=f.y-b,m+=u,g+=c}return d}_makeStraightTriangleEdge(t,e,s,i,n,r){const o=e.x-t.x,a=e.y-t.y,l=Math.sqrt(o*o+a*a),d=this._point(o/l,a/l),h=this._getOrthogonal(d),u=n/2,c=r/2,g=this._pointArray(4),m=g[0],_=g[1],f=g[2],p=g[3],x=t.x+d.x*s,y=t.y+d.y*s,b=t.x+d.x*i,v=t.y+d.y*i,E=h.x*u,A=h.y*u,S=h.x*c,T=h.y*c;return m.x=x+E,m.y=y+A,_.x=x-E,_.y=y-A,f.x=b-S,f.y=v-T,p.x=b+S,p.y=v+T,g}_makeEdgeExtremityPoints(t,e,s,i){const n=this._pointArray(i.length),r=s/2,o=t.x+e.x*r,a=t.y+e.y*r,l=e.x,d=e.y;for(let h=0;h<i.length;++h){const u=i[h],c=n[h],g=(l*u.x-d*u.y)*r,m=(d*u.x+l*u.y)*r;c.x=o+g,c.y=a+m,c.r=u.r*r}return n}_drawLine(t,e,s,i){e?s?this._drawCubicCurve(t,e,s,i):this._drawQuadraticCurve(t,e,i):this._drawStraightLine(t,i)}_getSelfLoopControlPoints(t,e,s){return rc(t.x,t.y,e,s,this._viewAngle,this._tmp)}_getQuadraticCurveControlPoint(t){return Wl(t.pos1.x,t.pos1.y,t.pos2.x,t.pos2.y,t.curvature,this._point(0,0))}_graphToScreenCoordinates(t){const e=this._width/2,s=this._height/2,i=(t.x-this._viewX)*this._viewZoom,n=(t.y-this._viewY)*this._viewZoom,r=this._viewAngleCos,o=this._viewAngleSin,a=r*i+o*n+e,l=-o*i+r*n+s;return this._point(a,l)}_blendColor(t,e){return t&&this._backgroundColor?Br(this._backgroundColor,t,e,1):t?RS(t,e):null}_getTangentOnLine(t,e,s,i,n){return e?s?this._getTangentOnCubicCurve(t,e,s,i,n):this._getTangentOnQuadraticCurve(t,e,i,n):this._getTangentOnStraightLine(t,i)}_getTangentOnStraightLine(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.sqrt(s*s+i*i);return this._point(s/n,i/n)}_getTangentOnQuadraticCurve(t,e,s,i){const n=1-i,r=n*e.x+i*s.x-(n*t.x+i*e.x),o=n*e.y+i*s.y-(n*t.y+i*e.y),a=Math.sqrt(r*r+o*o);return this._point(r/a,o/a)}_getTangentOnCubicCurve(t,e,s,i,n){const r=1-n,o=r*r,a=n*n,l=o*(e.x-t.x)+2*r*n*(s.x-e.x)+a*(i.x-s.x),d=o*(e.y-t.y)+2*r*n*(s.y-e.y)+a*(i.y-s.y),h=Math.sqrt(l*l+d*d);return this._point(l/h,d/h)}_mixPoints(t,e,s){const i=ue(t.x,e.x,s),n=ue(t.y,e.y,s);return this._point(i,n)}_getOrthogonal(t){return this._point(-t.y,t.x)}_getPointOnLine(t,e,s,i,n){return e?s?this._getPointOnCubicCurve(t,e,s,i,n):this._getPointOnQuadraticCurve(t,e,i,n):this._mixPoints(t,i,n)}_getPointOnQuadraticCurve(t,e,s,i){const n=$n(t.x,e.x,s.x,i),r=$n(t.y,e.y,s.y,i);return this._point(n,r)}_getPointOnCubicCurve(t,e,s,i,n){const r=Ko(t.x,e.x,s.x,i.x,n),o=Ko(t.y,e.y,s.y,i.y,n);return this._point(r,o)}_getTFromLengthOnCubicCurve(t,e,s,i,n){let r=t.x,o=t.y,a=0,l=0;for(let d=0;d<_s;++d){a+=ta;const h=Ko(t.x,e.x,s.x,i.x,a),u=Ko(t.y,e.y,s.y,i.y,a),c=h-r,g=u-o,m=Math.sqrt(c*c+g*g),_=l+m;if(_>n)return a-ta*((_-n)/m);l=_,r=h,o=u}return 1}_getTFromLengthOnQuadraticCurve(t,e,s,i){let n=t.x,r=t.y,o=0,a=0;for(let l=0;l<_s;++l){o+=ta;const d=$n(t.x,e.x,s.x,o),h=$n(t.y,e.y,s.y,o),u=d-n,c=h-r,g=Math.sqrt(u*u+c*c),m=a+g;if(m>i)return o-ta*((m-i)/g);a=m,n=d,r=h}return 1}};function OS(t,e,s){const i=Math.abs(t)/Bl+vy,n=i*i,r=s-.5,o=r*r,a=1/(16*n),l=Math.sqrt(o+a),d=.5/i*Math.sqrt(n+.25);return Math.abs(2*i)*(r*l+.5*d+a*Math.log(Math.abs((r+l)/(-.5+d))))*e}function zS(t,e,s,i,n){const r=(t.x+e.x+s.x)/3,o=(t.y+e.y+s.y)/3,a=r-e.x,l=o-e.y,d=e.x-s.x,h=e.y-s.y,u=a*a+l*l,c=(d*d+h*h)/4,g=Math.sqrt(u-c);return 2*hy*g*3.14159265359*n}function BS(t,e,s,i,n,r){const o=[];if(s&&o.push(0,s),n&&r){const a=n*e,l=r*e,d=a+l,h=t-i-s-d;let u=0;for(;u<h;)o.push(a,l),u+=d;const c=t-i-s-u,g=Math.min(a,c),m=Math.max(c-g,0);o.push(g,m)}else o.push(t-i-s,0);return i&&o.push(0,i),o}var Zn=0,Kr=1,Qr=2,rn=3,Hg=4,oc=0,kh=1,US={[Zn]:{min:"NEAREST",mag:"NEAREST",mipmap:!1},[Kr]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[Qr]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[rn]:{min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:!0}},GS={[oc]:"ALPHA",[kh]:"RGBA"};function cr(t){return Math.ceil((t+2*Wi)/as)*as}function VS(t,e,s,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r],l=a.x,d=a.y,h=l+i,u=d+n;let c=h<s&&u<s;if(c){for(let g=l;g<h;++g)if(e[g+d*s]===1){c=!1;break}}if(c){for(let g=d;g<u;++g)if(e[l+g*s]===1){c=!1;break}}if(c){for(let g=l;g<h;++g)for(let m=d;m<u;++m)e[g+m*s]=1;return t.splice(r,1),t.push({x:l,y:u},{x:h,y:d}),a}}return null}function Wg(t,e,s,i,n,r,o){const a=4*t,l=e>>1<<7,d=e%2<<7;o[a]=s/as,o[a+1]=i/as,o[a+2]=l+n/as,o[a+3]=d+r/as}function jS(t,e,s,i,n,r,o){i|=0,n|=0,r|=0,o|=0,e|=0;for(let a=0;a<r;++a)for(let l=0;l<o;++l){const d=4*(i+a+(n+l)*e),h=4*(a+l*r);t[d]=s[h],t[d+1]=s[h+1],t[d+2]=s[h+2],t[d+3]=s[h+3]}}function HS(t,e){let s=0,i=4;for(let r=0;r<t.length;++r){const{width:o,height:a}=t[r],l=cr(o),d=cr(a);s+=l*d,i=Math.max(i,Math.max(l,d))}const n=Oi(Math.max(i,Math.sqrt(s)));return Math.min(n,e)}function Xg(t,e){return Math.floor((e-t)/2)}function Yg(t,e,s,i,n,r,o){const{min:a,mag:l,mipmap:d}=US[r],h=t[GS[o]];if(o===oc){const u=new Uint8Array(n*n);for(let c=0;c<u.length;++c)u[c]=i[4*c+3];i=u}t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,h,n,n,0,h,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[l]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[a]),d&&t.generateMipmap(t.TEXTURE_2D)}function Xy(t,e,s,i,n){const r=new Uint8Array(s*s*4),o=Math.ceil(s/as),a=new Uint8Array(o*o),l=[{x:0,y:0}];for(let d=0;d<e.length;++d){const h=e[d],u=h.id,c=cr(h.width)/as,g=cr(h.height)/as,m=VS(l,a,o,c,g);if(m){const _=h.width,f=h.height,p=h.pixels,x=c*as,y=g*as,b=m.x*as+Xg(_,x),v=m.y*as+Xg(f,y);jS(r,s,p,b,v,_,f),Wg(u,t,b,v,x,y,n)}else{if(s<i)return Xy(t,e,2*s,i,n);Gi(`exceeded max WebGL texture size of ${i}; some texts/icons/images won't be displayed`),Wg(u,t,0,0,0,0,n)}}return{texture:r,size:s}}function WS(t,e,s,i){const{getDistanceFromStrokeVertically:n,getDistanceFromStrokeHorizontally:r}=t,o=e*(1-s)/2,a=(e-1)/2;for(let l=0;l<e;++l)for(let d=0;d<e;++d){const h=4*(d*e+l),u=(l-a)/o,c=(d-a)/o,g=zs(n(u,c),-1,1),m=zs(r(u,c),-1,1);XS(i,h,$g(g),$g(m))}}function $g(t){const e=(t+1)/2;return Math.floor(32768*e)}function XS(t,e,s,i){t[e]=s>>8,t[e+1]=s%256,t[e+2]=i>>8,t[e+3]=i%256}function Yy(t,e){let s=-Math.PI/2;const i=2*Math.PI/t.length;for(const n of t){const r=s+i;e(n,s,r),s=r}}function $y(t,e,s,i,n){Yy(e,(r,o,a)=>{t.beginPath(),t.moveTo(s,i),t.arc(s,i,n,o,a),t.fillStyle=r,t.fill()})}var YS=!ss().__dummy,$S=class extends Wy{constructor(t){super(t),this._canvas=ss(),this._imgCanvas=ss(),this._initCanvas(this._canvas),this._ctx=this._canvas.getContext("2d"),this._imgCtx=this._imgCanvas.getContext("2d")}static getName(){return"Canvas"}static isAvailable(){return YS}getDomElement(){return this._canvas}_render({dimensionsChanged:t}){t&&py(this._canvas,this._width,this._height,this._pixelRatio);const e=this._ctx,s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;e.clearRect(0,0,s,i),this._backgroundColor&&this._renderBackground&&(e.fillStyle=this._backgroundColor,e.fillRect(0,0,s,i));const n=this._bufferList.getBuffersByAscendingDepth();for(const r of n)this._isBufferDisplayable(r)&&this._displayBuffer(r)}_drawRoundedRectangle(t,e,s,i,n){const r=this._ctx,o=this._pixelRatio,a=t.x*o,l=t.y*o;e*=o,s*=o;const d=this._textManager.getCornerRadius(),h=Math.min(d*o,s);e+=h/2,r.save(),r.translate(a,l),r.rotate(i),r.beginPath(),r.arc(e-h,s-h,h,0,Math.PI/2),r.arc(-e+h,s-h,h,Math.PI/2,Math.PI),r.arc(-e+h,-s+h,h,Math.PI,3*Math.PI/2),r.arc(e-h,-s+h,h,3*Math.PI/2,0),n&&(r.fillStyle=n,r.fill()),r.restore()}_drawCircle(t,e){const s=this._ctx,i=this._pixelRatio,n=t.x*i,r=t.y*i,o=e*i;s.beginPath(),s.arc(n,r,o,0,2*Math.PI)}_drawPolygon(t){const e=this._ctx,s=this._pixelRatio;e.beginPath();const i=t[0];e.moveTo(i.x*s,i.y*s);for(let n=1;n<t.length;++n){const r=t[n];e.lineTo(r.x*s,r.y*s)}e.closePath()}_drawStraightLine(t,e){const s=this._ctx,i=this._pixelRatio;s.beginPath(),s.moveTo(t.x*i,t.y*i),s.lineTo(e.x*i,e.y*i)}_drawQuadraticCurve(t,e,s){const i=this._ctx,n=this._pixelRatio;i.beginPath(),i.moveTo(t.x*n,t.y*n),i.quadraticCurveTo(e.x*n,e.y*n,s.x*n,s.y*n)}_drawCubicCurve(t,e,s,i){const n=this._ctx,r=this._pixelRatio;n.beginPath(),n.moveTo(t.x*r,t.y*r),n.bezierCurveTo(e.x*r,e.y*r,s.x*r,s.y*r,i.x*r,i.y*r)}_fill(t){const e=this._ctx;e.fillStyle=t,e.fill()}_stroke(t,e,s=[]){if(e===0)return;const i=this._ctx,n=this._pixelRatio;i.setLineDash(s.map(r=>r*this._pixelRatio)),i.lineWidth=e*n,i.strokeStyle=t,i.stroke()}_startClip(){this._ctx.save(),this._ctx.clip()}_endClip(){this._ctx.restore()}_startReverseClip(){this._ctx.save(),this._ctx.rect(0,0,this._canvas.width,this._canvas.height),this._ctx.clip("evenodd")}_endReverseClip(){this._ctx.restore()}_displayText(t,e,s,i,n,r,o,a,l,d,h){const u=this._ctx,c=this._pixelRatio,g=t.x*c,m=t.y*c,_=r*c,f=a==="center"?0:-l/2;if(h=h*this._viewZoom*c,d=d*this._viewZoom*c,u.save(),u.translate(g,m+c),u.rotate(-e),u.textBaseline="middle",u.textAlign=a,Yi(u,n,_,o),u.fillStyle=i,s.indexOf(`
`)!==-1){const p=s.split(`
`),x=p.length;let y=(1-x)/2*_;for(let b=0;b<x;++b)u.fillText(p[b],d+f,h+y),y+=_}else u.fillText(s,d+f,h);u.restore()}_displayImage(t,e,s,i,n,r,o){if(this._hideImages||"isDummy"in i)return;let a=i;o!==1&&(a=this._blendImageOnBackground(i,o));const l=this._ctx,d=this._pixelRatio,h=t.x*d,u=t.y*d,c=e*d,g=s*d,m=a.width*d,_=a.height*d;if(n)l.drawImage(a,h-c/2,u-g/2,c,g);else if(r){const f=h-c/2,p=u-g/2,x=h+c/2,y=u+g/2;let b=h-m/2,v=u-_/2;for(;b>f;)b-=m;for(;v>p;)v-=_;const E=v;for(;b<x;){for(;v<y;)l.drawImage(a,b,v,m,_),v+=_;b+=m,v=E}}else l.drawImage(a,h-m/2,u-_/2,m,_)}_displayPieChart(t,e,s){const i=this._ctx,n=this._pixelRatio,r=t.x*n,o=t.y*n,a=e*n*2,l=2*a;s.length===1&&(i.fillStyle=s[0],i.fillRect(r-a,o-a,l,l)),s.length>1&&$y(i,s,r,o,a)}_blendImageOnBackground(t,e){const s=this._backgroundRgba,i=`rgb(${Math.round(255*s[0])},${Math.round(255*s[1])},${Math.round(255*s[2])})`;return this._imgCanvas.width=t.width,this._imgCanvas.height=t.height,this._imgCtx.clearRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=1,this._imgCtx.fillStyle=i,this._imgCtx.fillRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=e,this._imgCtx.drawImage(t,0,0),this._imgCanvas}getImageData(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)}},qy=!1;try{qy=!!ce("svg")}catch{}var wr="none",qS={left:"start",center:"middle",right:"end"},Fs="data-element-id",qg="data-text-component",ZS="node-text",JS="edge-text",KS="badge-text";function un(t){return Math.round(1e3*t)/1e3}function Zg(t,e,s,i,n,r){const o=ce("image");return o.setAttribute("width",un(i)),o.setAttribute("height",un(n)),o.setAttribute("x",un(e)),o.setAttribute("y",un(s)),o.setAttribute("href",t),r&&r.appendChild(o),o}function QS(t,e,s,i,n,r=1,o){const a=ce("rect");return a.setAttribute("x",t),a.setAttribute("y",e),a.setAttribute("width",s),a.setAttribute("height",i),a.setAttribute("fill",n),a.setAttribute("fill-opacity",r),o&&o.appendChild(a),a}var tw=class extends Wy{constructor(t){super(t),this._svg=ce("svg"),this._defs=ce("defs"),this._styles=ce("g",{class:"styles"}),this._background=ce("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"}),this._currentElementId="0",this._currentClipPathId=null,this._clipPathCounter=0,this._defs.appendChild(this._styles),this._svg.setAttribute("pointer-events","none"),this._svg.style.userSelect="none",this._svg.appendChild(this._defs),this._svg.appendChild(this._background),this._clear()}static getName(){return"SVG"}static isAvailable(){return qy}getDomElement(){return this._svg}_render({dimensionsChanged:t}){if(t&&ku(this._svg,{width:this._width,height:this._height}),this._backgroundColor&&this._renderBackground){const s=Un(this._backgroundColor);this._background.setAttribute("fill",s.color),this._background.setAttribute("fill-opacity",s.opacity)}const e=this._bufferList.getBuffersByAscendingDepth();this._clear(),this._svg.removeChild(this._container);for(let s=0;s<e.length;++s){const i=e[s];this._isBufferDisplayable(i)&&this._displayBuffer(i)}this._svg.appendChild(this._container)}_clear(){this._container&&this._svg.removeChild(this._container),this._container=ce("g"),this._svg.appendChild(this._container),this._clipPaths&&this._defs.removeChild(this._clipPaths),this._clipPaths=ce("g"),this._defs.appendChild(this._clipPaths),this._clipPaths.setAttribute("class","clip-paths"),this._filters&&this._defs.removeChild(this._filters),this._filters=ce("g"),this._defs.appendChild(this._filters)}_displayElement(t,e){this._currentElementId=t.id>=0?`n${t.id}`:"e"+-t.id,super._displayElement(t,e)}_addBackgroundBlendingFilter(t){const e=ds(this._backgroundColor),s=t,i=1-t,n=[s,0,0,0,e[0]*i,0,s,0,0,e[1]*i,0,0,s,0,e[2]*i,0,0,0,1,0].join(" "),r=`filter-${this._currentElementId}`,o=ce("filter",{id:r}),a=ce("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:n});return o.appendChild(a),this._filters.appendChild(o),r}_drawRoundedRectangle(t,e,s,i,n){const r=t.x,o=t.y,a=Math.min(this._textManager.getCornerRadius(),s);e+=a/2;const l=ce("path"),d=`M ${r+e-a} ${o+s}     A ${a} ${a} 0 0 0 ${r+e} ${o+s-a}     L ${r+e} ${o-s+a}     A ${a} ${a} 0 0 0 ${r+e-a} ${o-s}     L ${r-e+a} ${o-s}     A ${a} ${a} 0 0 0 ${r-e} ${o-s+a}     L ${r-e} ${o+s-a}     A ${a} ${a} 0 0 0 ${r-e+a} ${o+s}     L ${r+e-a} ${o+s}`;l.setAttribute("d",d),l.setAttribute("fill",wr),l.setAttribute("transform",`rotate(${Kd(i)} ${t.x} ${t.y})`),l.setAttribute(Fs,this._currentElementId),this._container.appendChild(l),this._element=l,n&&this._fill(n)}_drawCircle(t,e){const{x:s,y:i}=t,n=`M ${s-e}, ${i} a ${e},${e} 0 1,0 ${2*e},0 a ${e},${e} 0 1,0 -${2*e},0`,r=ce("path");r.setAttribute("d",n),r.setAttribute("fill",wr),r.setAttribute(Fs,this._currentElementId),this._container.appendChild(r),this._element=r}_drawPolygon(t,e){const s=ce("path");let i="";for(let n=0;n<t.length;n++){const{x:r,y:o}=t[n];i+=`${n===0?"M":"L"}${r},${o} `}i+="Z",s.setAttribute("d",i),s.setAttribute(Fs,this._currentElementId),s.setAttribute("fill",wr),e&&s.setAttribute(qg,!0),this._container.appendChild(s),this._element=s}_drawStraightLine(t,e){const s=ce("path"),i=`M ${t.x},${t.y} L${e.x},${e.y}`;s.setAttribute("d",i),s.setAttribute(Fs,this._currentElementId),this._container.appendChild(s),this._element=s}_drawQuadraticCurve(t,e,s){const i=ce("path"),n=`M ${t.x},${t.y} Q${e.x},${e.y} ${s.x},${s.y}`;i.setAttribute("d",n),i.setAttribute("fill",wr),i.setAttribute(Fs,this._currentElementId),this._container.appendChild(i),this._element=i}_drawCubicCurve(t,e,s,i){const n=ce("path"),r=`M ${t.x},${t.y} C${e.x},${e.y} ${s.x},${s.y} ${i.x},${i.y}`;n.setAttribute("d",r),n.setAttribute("fill",wr),n.setAttribute(Fs,this._currentElementId),this._container.appendChild(n),this._element=n}_fill(t){const e=Un(t);this._element.setAttribute("fill",e.color),this._element.setAttribute("fill-opacity",e.opacity),this._currentClipPathId&&this._element.setAttribute("clip-path",`url(#${this._currentClipPathId})`)}_stroke(t,e,s=[]){if(e===0)return;const i=this._element;i.setAttribute("stroke-width",e);const n=Un(t);i.setAttribute("stroke",n.color),i.setAttribute("stroke-opacity",n.opacity),s.length>0&&i.setAttribute("stroke-dasharray",s.map(un).toString())}_startClip(){const t=ce("clipPath"),e=this._element.cloneNode(!1);this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endClip(){this._currentClipPathId=null}_startReverseClip(){const t=ce("clipPath"),e=this._element.cloneNode(!1),s=e.getAttribute("d");e.setAttribute("clip-rule","evenodd"),e.setAttribute("d",`${s} M 0 0 L ${this._width} 0 L ${this._width} ${this._height} L 0 ${this._height}`),this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endReverseClip(){this._currentClipPathId=null}_displayText(t,e,s,i,n,r,o="normal",a,l,d,h,u){const c=ce("g");c.setAttribute(Fs,this._currentElementId),c.setAttribute(qg,!0);let g=this._currentElementId[0]==="n"?ZS:JS;u&&(g+=" "+KS),c.setAttribute("class",g);const m=Un(i),_=m.opacity,f=Un(m.color),p=t.x+d*this._viewZoom,x=t.y+1+h*this._viewZoom,y=un(p);c.setAttribute("font-family",n),c.setAttribute("font-size",r),o==="bold"?c.setAttribute("font-weight",o):c.setAttribute("font-style",o),c.setAttribute("fill",f.color),c.setAttribute("fill-opacity",_),e&&c.setAttribute("transform",`rotate(${Kd(-e)} ${p}, ${x})`),c.setAttribute("text-anchor",qS[a]||"middle"),c.setAttribute("dominant-baseline","middle");const b=s.split(`
`),v=b.length,E=un(x-(v+1)/2*r),A=a==="center"?0:-l/2;for(let S=0;S<v;S++){const T=ce("text");T.appendChild(Ru(b[S])),T.setAttribute("x",y+A),T.setAttribute("y",E+(S+1)*r),c.appendChild(T)}this._currentClipPathId&&c.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(c)}_displayImage(t,e,s,i,n,r,o){const a=t.x,l=t.y;if(this._hideImages||!("isDummy"in i)&&(!i.width||!i.height))return;const d=e,h=s;let u,c=i.width,g=i.height;if(n&&(c=d,g=h),r){const m=a-d/2,_=l-h/2,f=a+d/2,p=l+h/2;let x=a-c/2,y=l-g/2;for(u=ce("g"),u.setAttribute(Fs,this._currentElementId);x>m;)x-=c;for(;y>_;)y-=g;const b=y;for(;x<f;){for(;y<p;)Zg(i.src,x,y,c,g,u),y+=g;y=b,x+=c}}else u=Zg(i.src,a-c/2,l-g/2,c,g),u.setAttribute(Fs,this._currentElementId);if(this._currentClipPathId&&u.setAttribute("clip-path",`url(#${this._currentClipPathId})`),o!==1){const m=this._addBackgroundBlendingFilter(o);u.setAttribute("filter",`url(#${m})`)}this._container.appendChild(u)}_displayPieChart(t,e,s){const i=2*e,n=2*i,r=t.x,o=t.y;let a;const l=ce("g");l.setAttribute(Fs,this._currentElementId),s.length===1&&(a=QS(r-i,o-i,n,n,s[0],1,l)),s.length>1&&Yy(s,(d,h,u)=>{const c=r+e*Math.cos(u),g=o+e*Math.sin(u),m=r+e*Math.cos(h),_=o+e*Math.sin(h),f=u-h<=Math.PI?0:1,p=`M ${c},${g} A ${e},${e} 0 ${f} 0 ${m},${_} L ${r},${o} L ${c},${g}`;a=ce("path"),a.setAttribute("d",p),a.setAttribute("fill",d),a.setAttribute("stroke-width",0),l.appendChild(a)}),this._currentClipPathId&&l.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(l)}},ew=6,sw=class{constructor({gl:t,ext:e,staticProgram:s,animationProgram:i}){this._version=0,this._used=!1,this._dataBufferChanged=!1,this._gl=t,this._ext=e,this._staticProgram=s,this._animationProgram=i,this._glBuffer=this._gl.createBuffer()}setDataBuffer(t){this._dataBuffer!==t&&(this._program=t.animated?this._animationProgram:this._staticProgram,this._dataBuffer=t,this._dataBufferChanged=!0,t.hasSideData()&&!this._sideGlBuffer?this._sideGlBuffer=this._gl.createBuffer():!t.hasSideData()&&this._sideGlBuffer&&(this._gl.deleteBuffer(this._sideGlBuffer),delete this._sideGlBuffer))}setPrograms(t,e){this._staticProgram=t,this._animationProgram=e}markAsUnused(){return this._used=!1,this}getProgram(){return this._program}markAsUsed(){return this._used=!0,this}isUsed(){return this._used}draw(){const t=this._gl,e=this._dataBuffer.type,s=e===mn,i=s?this._dataBuffer.getNbSideElementsPerMainElement():1,n=e===cl?_s:1,r=this._dataBuffer.getSize(),o=this._dataBuffer.stencilUsage,a=this._dataBuffer.version,l=this._version!==a||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:l?this._dataBuffer.getByteArray():null,divisor:i}),this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:l&&s?this._dataBuffer.getSideByteArray():null,divisor:1}),this._program.setupStencil(o),l&&(this._version=a,this._dataBufferChanged=!1),this._ext.drawArraysInstancedANGLE(t.TRIANGLES,0,ew*n,r*i)}destroy(){this._gl.deleteBuffer(this._glBuffer),this._sideGlBuffer&&this._gl.deleteBuffer(this._sideGlBuffer)}},iw={byte:1,ubyte:1,short:2,ushort:2,ulong:4,float:4},nw={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",ulong:"UNSIGNED_LONG",float:"FLOAT"},Jg=class{constructor({gl:t,ext:e,specialGlBuffers:s,metaData:i,programWrapper:n}){this._stencilUsage=Qn,this._gl=t,this._ext=e,this._specialGlBuffers=s,this._metaData=Pe(i),this._programWrapper=n}_finishInit(){const t=this._gl,e=this._ext,s=this._programWrapper.getError();if(s)throw new Error(`WebGL compilation at step "${s.step}:
${s.message}"`);const i=this._programWrapper.getProgram();this._program=i,t.useProgram(i),this._metaData.attributes.forEach(o=>{o.location=t.getAttribLocation(this._program,o.name),o.byteSize=o.size*iw[o.type],o.glType=nw[o.type]}),this._specialAttributes=this._createSpecialAttributesFunctions();const n=[],r=[];for(const o of this._metaData.attributes)o.location!==-1&&(o.name.startsWith("a_text")?r.push(o):n.push(o));this._baseAttributes=yd(n,t,e),this._textAttributes=yd(r,t,e),this._setupUniforms=ow(this._metaData.uniforms,t,i)}_createSpecialAttributesFunctions(){return yd([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3,type:"byte",name:"special"}],this._gl,this._ext)}startPass(t){this._program||this._finishInit(),this._gl.useProgram(this._program),this._resetStencil(),this._setupUniforms(this._gl,t),this._specialAttributes.enable(this._gl),this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)}_setupAttributes(t,{glBuffer:e,dataBuffer:s,divisor:i}){t.enabled&&!e?t.disable(this._gl):!t.enabled&&e&&t.enable(this._gl),e&&t.setup(e,s,i)}setupBaseAttributes(t){this._setupAttributes(this._baseAttributes,t)}setupTextAttributes(t){this._setupAttributes(this._textAttributes,t)}_resetStencil(){const t=this._gl;this._stencilUsage=Qn,t.disable(t.STENCIL_TEST)}setupStencil(t){if(t!==this._stencilUsage){const e=this._gl;t!==Qn?(e.enable(e.STENCIL_TEST),t===_y?(e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilFunc(e.ALWAYS,1,1)):t===fy&&(e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilFunc(e.EQUAL,0,1))):e.disable(e.STENCIL_TEST),this._stencilUsage=t}}endPass(){const t=this._gl;this._specialAttributes.disable(t),this._baseAttributes.disable(t),this._textAttributes.disable(t)}};function rw(t,e,s){return(i,n,r)=>{let o=0,a=0;for(let l=0;l<t.length;l++)a+=t[l].byteSize;e.bindBuffer(e.ARRAY_BUFFER,i),n&&e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);for(let l=0;l<t.length;l++){const{location:d,size:h,glType:u,byteSize:c}=t[l];e.vertexAttribPointer(d,h,e[u],!1,a,o),o+=c,s.vertexAttribDivisorANGLE(d,r)}}}function ow(t,e,s){const i={};for(let n=0;n<t.length;++n){const{id:r,name:o}=t[n],a=e.getUniformLocation(s,o);a&&(i[r]=a)}return(n,r)=>{for(let o=0;o<t.length;++o){const{id:a,type:l}=t[o],d=i[a],h=r[a];if(d)switch(l){case"int":case"sampler2D":n.uniform1i(d,h);break;case"float":n.uniform1f(d,h);break;case"vec2":n.uniform2f(d,h[0],h[1]);break;case"vec3":n.uniform3f(d,h[0],h[1],h[2]);break;case"vec4":n.uniform4f(d,h[0],h[1],h[2],h[3])}}}}function aw(t){return e=>{for(let s=0;s<t.length;s++){const i=t[s].location;e.enableVertexAttribArray(i)}}}function lw(t){return e=>{for(let s=0;s<t.length;++s){const i=t[s].location;e.disableVertexAttribArray(i)}}}function yd(t,e,s){const i=aw(t),n=lw(t);return{enable(r){i(r),this.enabled=!0},disable(r){n(r),this.enabled=!1},setup:rw(t,e,s),enabled:!1}}var xd=`#define D3D9_FIX 0
precision highp float;
precision mediump int;
uniform vec3 u_backgroundColor;
uniform sampler2D u_patternNearestTexture;
uniform sampler2D u_patternLinearTexture;
uniform sampler2D u_patternLinearSdfTexture;
uniform sampler2D u_patternMipmapTexture;
uniform sampler2D u_shapeTexture;
varying vec4 dn;
varying vec4 dp;
varying vec4 dq;
varying vec2 dr;
varying vec2 ds;
varying vec4 ei;
varying float dt;
#if D3D9_FIX
#else
varying float dy;
varying vec2 dz;
varying vec2 ea;
varying vec2 eb;
varying float ec;
varying float ed;
varying vec2 ee;
varying vec2 ef;
varying float eg;
varying float eh;
#endif
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SDF_GAMMA = 0.0;
const float EPSILON = 0.000000001;
const float SDF_BUFFER = (256.0 - 64.0) / 256.0; 
vec4 abg(in vec4 um, in vec4 abh) {
float abi = abh.a;
float abj = um.a + EPSILON;
float abk = min(abi + abj, 1.0);
float r = abi / abk;
return vec4(mix(um.rgb, abh.rgb, r), abk);
}
float abl(in float abm, in float fp) {
float abn = (abm * 256.0 + fp) * 256.0;
float abo = abn / 32768.0;
return abo * 2.0 - 1.0;
}
bool mn(float ml, float mm) {
return abs(ml - mm) < EPSILON;
}
float abp(float ma) {
float abt = 2.;
vec2 wz = abs(dq.rg) - dq.ba - vec2(abt) + vec2(ma);
float es = min(max(wz.x, wz.y), 0.0) + length(max(wz, 0.0)) - ma;
return smoothstep(0.1, .5, (1. - es) / 10.);
}
void main() {
#if D3D9_FIX
#else
float aby = eb.x;
float abz = eb.y;
float aca = ee.x;
float acb = ee.y;
#endif
vec4 of = texture2D(u_shapeTexture, dr);
float acc = abl(of.b, of.a) * ef.x;
float acd = abl(of.r, of.g) * ef.y;
float zv = float(ei.z > EPSILON);
float tm = float(ei.w > EPSILON);
float aci = 1. - smoothstep(
0.01,
0.25760,
distance(ei.xy * ei.z - vec2(0.0586), dr * ei.z)
);
aci = aci * 2.5 - 1.5;
aci *= 0.5;
aci *= ef.x;
float acj = abp(dt) ;
vec4 hj = dn;
vec4 hk = dp;
if (eh > -EPSILON) {
vec2 ip = ds;
float aco =
step(dz.x, ip.x) *
step(ip.x, ea.x) *
step(dz.y, ip.y) *
step(ip.y, ea.y);
float acp = aco;
vec4 hl;
if (mn(eh, FILTER_NEAREST)) {
hl = texture2D(u_patternNearestTexture, ip);
} else if (mn(eh, FILTER_LINEAR)) { 
hl = texture2D(u_patternLinearTexture, ip);
} else if (mn(eh, FILTER_LINEAR_SDF)) { 
hl = texture2D(u_patternLinearSdfTexture, ip);
hl.a = smoothstep(SDF_BUFFER - eg, SDF_BUFFER + eg, hl.a);
} else if (mn(eh, FILTER_MIPMAP)) { 
hl = texture2D(u_patternMipmapTexture, ip);
}
hl.rgb += dq.rgb;
hl.a *= acp;
hj = abg(hj, hl);
}
float acu = (1. - zv) * min(acc, acd)
+ zv * aci;
acu = (1. - tm) * acu + tm * acj;
float adc = clamp(acu, 0.0, 1.0);
float adf = clamp(acu - dy, 0.0, 1.0);
float adg = adc - adf;
adg = 1.0 - clamp(acu - dy, 0.0, 1.0);
hj.a *= adf;
hk.a *= adg * step(EPSILON, dy);
vec4 adj = abg(hj, hk);
float adk = adc;
adj.rgb = mix(u_backgroundColor, adj.rgb, aby);
if (ed > EPSILON) {
float adv = fract(acb) * ed;
float adw = clamp(min(adv, aca - adv), 0.0, 1.0);
adk *= adw;
}
if (ec < 0.0 || ec > 1.0 || adk < EPSILON) {
discard;
}
adj.a *= adk;
adj.rgb *= adj.a;
gl_FragColor = adj;
}
`,bd=`#define D3D9_FIX 0
#define ANIMATED 0
precision highp float;
precision mediump int;
attribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_final_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_prev_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*float*/ vec2 a_animationBeginTime_animationDuration; 
attribute /*ushort*/ vec4 a_animationEasing; 
attribute /*ushort*/ vec3 a_text_charId_charOffsetXY; 
attribute vec3 a_vertexInfo;
uniform float u_viewWidth;
uniform float u_viewHeight;
uniform float u_viewX;
uniform float u_viewY;
uniform float u_viewAngle;
uniform float u_viewZoom;
uniform float u_currentTime;
uniform float u_pixelRatio;
uniform sampler2D u_patternInfoTexture;
varying vec4 dn;
varying vec4 dp;
varying vec4 dq;
varying vec2 dr;
varying vec2 ds;
varying float dt;
#if D3D9_FIX
#else
varying float dy;
varying vec2 dz;
varying vec2 ea;
varying vec2 eb;
varying float ec;
varying float ed;
varying vec2 ee;
varying vec2 ef;
varying float eg;
varying float eh;
#endif
varying vec4 ei;
const float EPSILON = 0.000001;
const float INFINITY = 10000000.0;
const float PI = 3.14159265359;
const float P2_17 = 131072.0;
const float P2_16 = 65536.0;
const float P2_14 = 32768.0;
const float P2_12 = 4096.0;
const float P2_8 = 256.0;
const float P2_7 = 128.0;
const float P2_6 = 64.0;
const float P2_5 = 32.0;
const float P2_4 = 16.0;
const float P2_3 = 8.0;
const float P2_2 = 4.0;
const float P2_1 = 2.0;
const float MAX_PROGRESS = 1.0;
uniform float BYTES_TO_COORD;
uniform float BYTES_TO_SCALED_SIZE;
uniform float BYTES_TO_MIN_VISIBLE_SIZE;
uniform float BYTES_TO_SYMBOLIC_SIZE;
uniform float BYTES_TO_CURVATURE;
uniform float BYTES_TO_DASH_LENGTH;
uniform float BYTES_TO_GAP_LENGTH;
uniform float BYTES_TO_PATTERN_SCALE;
uniform float PATTERN_POSITION_UNIT_SIZE;
uniform float PATTERN_INFO_TEXTURE_SIZE;
uniform float PATTERN_NEAREST_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;
uniform float PATTERN_MIPMAP_TEXTURE_SIZE;
uniform float ROUNDED_BOX_RADIUS;
const float BYTES_TO_OFFSET_ANGLE = 0.0;
const float BYTES_TO_COLOR = 0.0;
const float SDF_FONT_SIZE = 0.0;
const float SDF_GAMMA = 0.0;
const float CURVATURE_RATIO = 0.0;
const float PATTERN_PADDING = 0.0;
const float TEXT_WIDTH_MULTIPLIER = 0.0;
const float TEXT_HEIGHT_MULTIPLIER = 0.0;
const float SELF_LOOP_CURVATURE_RATIO = 0.0;
const float EDGE_ARROW_SIZE_RATIO = 0.0;
const float EDGE_MIN_TIP_SIZE = 0.0;
const float CURVE_SUBDIVISIONS = 0.0;
const float PIECE_NODE_COMPONENT = 0.0;
const float PIECE_TEXT_BOX = 0.0;
const float PIECE_EDGE_BODY = 0.0;
const float PIECE_EDGE_HEAD = 0.0;
const float PIECE_EDGE_TAIL = 0.0;
const float PIECE_EDGE_TEXT = 0.0;
const float MAX_TEXT_SIZE = 0.0;
const float BYTES_TO_TEXT_OFFSET_X = 0.0;
const float BYTES_TO_TEXT_OFFSET_Y = 0.0;
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SHAPE_TEXTURE_SIZE = 0.0;
const float SIMPLE_SHAPE_SAMPLING_SIZE = 0.0;
const float COMPLEX_SHAPE_SAMPLING_SIZE = 0.0;
const float SHAPE_SAMPLING_BUFFER_RATIO = 0.0;
const float MAX_SHAPES = 0.0;
const float FIRST_COMPLEX_SHAPE_ID = 0.0;
const float SELF_LOOP_TO_CIRCLE_APPROX = 0.0;
const float NB_SHAPES_BY_SIDE = SHAPE_TEXTURE_SIZE / COMPLEX_SHAPE_SAMPLING_SIZE;
const float SHAPE_FILL_PERCENT = 1.0 - SHAPE_SAMPLING_BUFFER_RATIO;
const float T_STEP_PER_CURVE_PIECE = 1.0 / CURVE_SUBDIVISIONS;
const float HEAD_TAIL_PX_ADJUST = 1.5;
const float SDF_SMOOTH_FACTOR = 2.0;
struct gk {
float gl;
float gm;
float gn;
float go;
float gp;
float gq;
float gr;
float gs;
};
struct gt {
float gu;
float gv;
float gw;
float gx;
float gy;
float gz;
float ha;
};
struct hb {
float gl;
float gm;
float gn;
float go;
float gp;
float gq;
float gr;
float gs;
float gu;
float gv;
float gw;
float gx;
float gy;
float gz;
float ha;
float hc;
float hd;
float he;
float hf;
float hg;
float hh;
float hi;
vec4 hj;
vec4 hk;
vec4 hl;
float hm;
float hn;
float ho;
float hp;
float hq;
float hr;
float hs;
float ht;
float hu;
float hv;
float hw;
float hx;
float hy;
float hz;
float ia;
float ib;
float ic;
float id;
float ie;
};
struct ig {
float ih;
vec2 ii;
vec4 hj;
vec4 hk;
float hc;
float ij;
float ik;
float gn;
float il;
vec2 im;
float io;
vec2 ip;
vec2 iq;
vec2 ir;
float is;
float it;
vec4 hl;
vec2 iu;
float iv;
float eu;
vec2 iw;
vec2 ix;
vec2 iy;
};
float iz(float cf, float ja, float jb) {
float jc = mod(cf, pow(2.0, jb));
return floor(jc / pow(2.0, ja));
}
gk jd(float cf) {
gk je;
je.gl = iz(cf, 0.0, 4.0);
je.gm = iz(cf, 4.0, 8.0);
je.gn = iz(cf, 8.0, 10.0);
je.go = iz(cf, 10.0, 12.0);
je.gp = iz(cf, 12.0, 13.0);
je.gq = iz(cf, 13.0, 14.0);
je.gr = iz(cf, 14.0, 15.0);
je.gs = iz(cf, 15.0, 16.0);
return je;
}
gt jf(float cf) {
gt je;
je.gu = iz(cf, 0.0, 8.0);
je.gv = iz(cf, 8.0, 11.0);
je.gw = iz(cf, 11.0, 12.0);
je.gx = iz(cf, 12.0, 13.0);
je.gy = iz(cf, 13.0, 14.0);
je.gz = iz(cf, 14.0, 15.0);
je.ha = iz(cf, 15.0, 16.0);
return je;
}
vec4 jg(in float cf) {
return vec4(
iz(cf, 0.0, 4.0),
iz(cf, 4.0, 8.0),
iz(cf, 8.0, 12.0),
iz(cf, 12.0, 16.0)
);
}
vec2 jh(in float cf) {
return vec2(mod(cf, 256.0), floor(cf / 256.0));
}
vec2 ji(in float cf) {
float jj = floor(cf / P2_6);
float jk = cf - (jj * P2_6);
return vec2(jj, jk);
}
vec2 jl(in float cf) {
float jm = floor(cf / P2_7);
float jn = cf - (jm * P2_7);
return vec2(jm, jn);
}
vec2 jo(in vec2 jp, in float jq) {
float jr = cos(jq);
float js = sin(jq);
return vec2(jr * jp.x + js * jp.y, -js * jp.x + jr * jp.y);
}
vec4 jt(in vec4 ju) {
return floor(ju / 256.0) - 128.0;
}
vec4 jv(in vec4 ju) {
return mod(ju, 256.0) - 128.0;
}
float jw(float cf) {
return cf - 128.0;
}
vec2 jw(vec2 cf) {
return cf - 128.0;
}
vec2 jx(vec2 jy) {
return vec2(-jy.y, jy.x);
}
vec2 jz(vec2 ka, vec2 kb, vec2 kc, float t) {
float kd = 1.0 - t;
return (kd * kd * ka) + (2.0 * kd * t * kb) + (t * t * kc);
}
vec2 ke(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {
float kd = 1.0 - t;
float kh = kd * kd;
float ki = kh * kd;
float kj = t * t;
float kk = kj * t;
return (ki * ka) + (3.0 * kh * t * kf) + (3.0 * kd * kj * kg) + (kk * kc);
}
vec2 kl(vec2 ka, vec2 kb, vec2 kc, float t) {
float kd = (1.0 - t);
vec2 jp = (kd * kb + t * kc) - (kd * ka + t * kb);
return normalize(jp);
}
vec2 km(vec2 ka, vec2 kb, vec2 kc, float t) {
return jx(kl(ka, kb, kc, t));
}
vec2 kn(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {
float kd = 1.0 - t;
float kh = kd * kd;
float kj = t * t;
vec2 jp = kh * (kf - ka) + 2.0 * kd * t * (kg - kf) + kj * (kc - kg);
return normalize(jp);
}
vec2 ko(vec2 ka, vec2 kf, vec2 kg, vec2 kc, float t) {
return jx(kn(ka, kf, kg, kc, t));
}
float ld(float hh, float le, float t) {
float y = abs(hh) / CURVATURE_RATIO + EPSILON;
float hp = y * y;
float kd = t - 0.5;
float kh = kd * kd;
float lf = 1.0 / (16.0 * hp);
float lg = sqrt(kh + lf);
float lh = (0.5 / y) * sqrt(hp + 0.25);
float li = (abs(2.0 * y)) * ((kd * lg) + (0.5 * lh) + (lf * log(abs((kd + lg) / (-0.5 + lh)))));
return li * le;
}
float lj(vec2 ka, vec2 lk, vec2 ll, vec2 kc, float lm) {
vec2 iu = (ka + lk + ll) / 3.0;
vec2 ln = iu - lk;
vec2 lo = lk - ll;
float lp = dot(ln, ln);
float lq = dot(lo, lo) / 4.0;
float ma = sqrt(lp - lq) * SELF_LOOP_TO_CIRCLE_APPROX * 1.55;
return 2.0 * PI * ma * lm;
}
float mb(float cf) {
return cf - 32.0;
}
float mc(float cf) {
return cf - 512.0;
}
float md(float cf) {
return cf - P2_14;
}
void me() {
gl_Position = vec4(-10.0, -10.0, 1.0, 1.0);
}
vec4 mf(vec2 mg) {
return vec4(((vec2(mg.x, u_viewHeight - mg.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);
}
float mk(float ml, float mm) {
return step(ml - EPSILON, mm) * step(mm, ml + EPSILON);
}
bool mn(float ml, float mm) {
return abs(ml - mm) < EPSILON;
}
bool mo(float cf) {
return cf > 0.5;
}
vec2 mp(vec2 mq) {
return jo((mq - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;
}
float mr(float eu) {
return max(EDGE_MIN_TIP_SIZE, eu * EDGE_ARROW_SIZE_RATIO);
}
float ms(float mt, float mu) {
return mt * BYTES_TO_SCALED_SIZE * u_viewZoom + mu;
}
float nb(float ij, float mz, float na) {
float nc = na - mz;
float a = 1.0 / nc;
float b = -mz / nc;
return ij * a + b;
}
struct nd {
vec2 ne;
vec2 nf;
};
nd ng(vec2 nh, float ma, float hh) {
nd cj;
float ni = (ma + ma / SELF_LOOP_CURVATURE_RATIO * hh) * SELF_LOOP_CURVATURE_RATIO;
float nj = -u_viewAngle + PI;
float nk = -u_viewAngle + PI / 2.0;
cj.ne = nh + vec2(cos(nj), sin(nj)) * ni;
cj.nf = nh + vec2(cos(nk), sin(nk)) * ni;
return cj;
}
float nq(vec2 nr, vec2 lk, vec2 ll, vec2 ns, float nt) {
vec2 nu = nr;
float t = 0.0;
float nv = 0.0;
float nw = lj(nr, lk, ll, ns, 1.0);
return nt / nw;
}
hb nx(
vec4 ny,
vec4 nz,
vec4 oa,
vec4 ob,
vec4 oc,
vec4 od,
vec3 oe
) {
hb a;
gk of = jd(ny.x);
gt og = jf(ny.y);
vec4 oh = jg(ny.z);
vec2 oi = jh(ny.w);
a.gl = of.gl;
a.gm = of.gm;
a.gn = of.gn;
a.go = of.go;
a.gp = of.gp;
a.gq = of.gq;
a.gr = of.gr;
a.gs = of.gs;
a.gu = og.gu;
a.gv = og.gv;
a.gw = og.gw;
a.gx = og.gx;
a.gy = og.gy;
a.gz = og.gz;
a.ha = og.ha;
a.hc = oh.x;
a.hd = oh.y;
a.he = oh.z;
a.hf = oh.w;
a.hg = oi.x;
a.hh = oi.y;
a.hi = nz.x;
a.hj = jg(nz.y);
a.hk = jg(nz.z);
a.hl = jg(nz.w);
a.hm = oa.x;
a.hn = oa.y;
a.ho = oa.z;
a.hp = oa.w;
a.hq = ob.x;
a.hr = ob.y;
a.hs = ob.z;
a.ht = ob.w;
a.hu = oc.x;
a.hv = oc.y;
a.hw = oc.z;
a.hx = oc.w;
a.hy = od.x;
a.hz = md(od.y);
a.id = md(od.z);
a.ie = md(od.w);
a.ia = oe.x;
float x = oe.y;
float y = mod(x, P2_8);
if (oe.z > 0.0) x += oe.z * P2_16;
a.ib = ((x - y) / P2_8) - P2_16;
a.ic = (y - P2_7) * BYTES_TO_TEXT_OFFSET_Y;
return a;
}
bool pp(const in hb a, out ig cj) {
float gl = a.gl;
float gm = a.gm;
float gn = a.gn * BYTES_TO_DASH_LENGTH;
float go = a.go * BYTES_TO_GAP_LENGTH;
float gp = a.gp;
float gq = a.gq;
float gr = a.gr;
float gs = a.gs;
float gu = a.gu * BYTES_TO_PATTERN_SCALE;
float gv = a.gv * BYTES_TO_OFFSET_ANGLE;
float gw = a.gw;
float gx = a.gx;
float gy = a.gy;
float gz = a.gz;
float ha = a.ha;
float hc = a.hc * BYTES_TO_COLOR;
float hd = a.hd * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float he = a.he * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float hf = a.hf * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float hg = a.hg * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom + step(a.hg, EPSILON) * INFINITY;
float hh = jw(a.hh);
float hi = a.hi;
vec4 hj = a.hj * BYTES_TO_COLOR;
vec4 hk = a.hk * BYTES_TO_COLOR;
vec4 hl = a.hl * BYTES_TO_COLOR;
vec2 pq = vec2(a.hm, a.hn) * BYTES_TO_COORD;
vec2 pr = vec2(a.ho, a.hp) * BYTES_TO_COORD;
vec2 nr = mp(pq);
vec2 ns = mp(pr);
float ps = ms(a.hq, a.hr);
float pt = ms(a.hs, a.ht);
float pu = ms(a.hu, a.hv);
float ih = ms(a.hw, a.hx);
float on = ms(a.hy, a.hz);
vec2 pv = a_vertexInfo.xy;
vec2 pw = vec2(0.0, 0.0);
float px = ps;
float py = pt;
float pz = pt * gu;
if (gw > EPSILON) {
if (a.ia < EPSILON) return false;
pz = pu;
hi = a.ia;
ps = pz * TEXT_WIDTH_MULTIPLIER * u_pixelRatio;
pt = pz * TEXT_HEIGHT_MULTIPLIER * u_pixelRatio;
}
bool qz = abs(hh) > EPSILON && mk(gm, PIECE_EDGE_BODY) < EPSILON;
bool ra = qz && a_vertexInfo.z > EPSILON;
if (gl < EPSILON || gm < EPSILON || hg < hd || ra) {
return false;
}
ih *= step(he, hg);
float rp = 0.0;
float rq = 1.0;
float rm = 0.0;
float ro = 1.0;
float rr = 0.0;
float sb = 1.0;
float sd = 1.0;
float so = 0.0;
float sp = 0.0;
vec2 iu;
vec2 iw;
vec2 ix;
vec2 iy;
float eu;
float iv;
float tk = 0.0;
float tl = 1.0;
bool tm = mk(gm, PIECE_TEXT_BOX) > EPSILON;
if (mk(gm, PIECE_NODE_COMPONENT) > EPSILON || tm) {
iu = ceil((nr + ns) / 2.0);
if(length(pr - pq) > EPSILON){
iw = normalize(pr - pq) * vec2(1.,-1.);
}else{
iw = vec2(1.0, 0.0);
}
ix = jx(iw);
iy = ix;
eu = ps;
iv = pt;
} else {
sd = 0.0;
float uf = distance(nr, ns);
vec2 ug = normalize(ns - nr);
vec2 uh = (nr + ns) / 2.0;
vec2 ui = jx(ug);
vec2 uj = uh + (ui * uf * -hh / CURVATURE_RATIO);
if (mk(gm, PIECE_EDGE_TEXT) > 0.0
|| mk(gm, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0
) {
tm = mk(gm, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0;
float un;
float uo = ih;
ih = 0.0;
if (gs > EPSILON) {
nd kb = ng(nr, uo / 2.0, hh);
iu = ke(nr, kb.ne, kb.nf, ns, 0.5);
iw = kn(nr, kb.ne, kb.nf, ns, 0.5);
ix = jx(iw);
iy = ix;
un = lj(nr, kb.ne, kb.nf, ns, 0.5);
} else if (abs(hh) > EPSILON) {
iu = jz(nr, uj, ns, 0.5);
iw = kl(nr, uj, ns, 0.5);
ix = jx(iw);
iy = ix;
un = ld(hh, uf, 1.0);
} else {
iu = uh;
iw = ug;
ix = ui;
iy = ui;
un = uf;
}
eu = ps;
iv = pt;
if(px > un - uo && gs < EPSILON){
if(gx > EPSILON){
iw = vec2(1.0, 0.0);
ix = vec2(0.0, 1.0);
iy = vec2(0.0, 1.0);
} else {
iw = vec2(0,0);
ix = vec2(0.0, 0.0);
iy = vec2(0.0, 0.0);
}
} else {
float jq = -atan(iw.y, iw.x);
tk = jq;
gv -= jq;
if ((jq > PI / 2.0 || jq < -PI / 2.0)) {
gv += (1.0 - gs) * PI;
tl = -1.0;
iw *= -1.0;
ix *= -1.0;
iy *= -1.0;
}
}
} else {
float uz = ps;
float va = pt;
float vb = mr(pu);
float vc = gp 
* min(5. * uz, vb);
float vd = gq 
* min(5. * va, vb);
float ve = mk(gm, PIECE_EDGE_HEAD);
float vf = mk(gm, PIECE_EDGE_TAIL);
float vg = INFINITY * gs + uf - uz - va;
float vq = min(0., vg - vc - vd)/2.;
float vz = pu / 2.;
float wa =
uz > vz
? uz - sqrt(uz * uz - vz * vz)
: vz;
float wb = max( uz +
vd
+ gq * vq, 
0.) - (1. - gp) * wa;
wa =
va > vz
? va - sqrt(va * va - vz * vz)
: vz;
float wc = max( va + 
vc
+ gp * vq
, 0.) - (1. - gq) * wa;
if (ve > EPSILON || vf > EPSILON) {
vec2 wf = ve * ns + vf * nr;
float on = ve * wc + vf * wb + (HEAD_TAIL_PX_ADJUST - 0.5);
float wg = ve * vc + vf * vd;
vec2 wh;
if (gs > EPSILON) {
nd kb = ng(nr, uz, hh);
float un = lj(nr, kb.ne, kb.nf, ns, 1.0);
float nt = ve * (un - wc) + vf * wb;
float t = nq(nr, kb.ne, kb.nf, ns, nt);
wh = ke(nr, kb.ne, kb.nf, ns, t);
} else {
float un = ld(hh, uf, 1.0);
float t = (ve * (un - wc) + vf * wb) / un;
wh = jz(nr, uj, ns, t);
}
iw = normalize(wf - wh);
ix = jx(iw);
iy = ix;
iu = wf - iw * (on - wg / 2.0);
eu = wg;
iv = wg;
gn = 0.0;
go = 0.0;
} else {
float wl;
float wm;
float wn;
if (abs(hh) < EPSILON) {
iu = uh;
iw = ug;
ix = ui;
iy = ix;
eu = uf;
wl = uf;
wm = 0.0;
wn = uf;
} else {
float wp = a_vertexInfo.z;
float wq = wp * T_STEP_PER_CURVE_PIECE;
float kj = wq + T_STEP_PER_CURVE_PIECE;
if (gs < EPSILON) {
vec2 wr = jz(nr, uj, ns, wq);
vec2 ws = jz(nr, uj, ns, kj);
iu = (wr + ws) / 2.0;
iw = normalize(ws - wr);
ix = km(nr, uj, ns, wq);
iy = km(nr, uj, ns, kj);
eu = distance(wr, ws);
wl = ld(hh, uf, 1.0);
wm = ld(hh, uf, wq);
wn = ld(hh, uf, kj);
} else {
nd kb = ng(nr, uz, hh);
vec2 lk = kb.ne;
vec2 ll = kb.nf;
vec2 wr = ke(nr, lk, ll, ns, wq);
vec2 ws = ke(nr, lk, ll, ns, kj);
iu = (wr + ws) / 2.0;
iw = normalize(ws - wr);
ix = ko(nr, lk, ll, ns, wq);
iy = ko(nr, lk, ll, ns, kj);
eu = distance(wr, ws);
wl = lj(nr, lk, ll, ns, 1.0);
wm = lj(nr, lk, ll, ns, wq);
wn = lj(nr, lk, ll, ns, kj);
}
}
iv = pu;
rm = (wb - 1.0) / wl - 0.015 * gs;
ro = MAX_PROGRESS + 0.015 * gs
- (wc - HEAD_TAIL_PX_ADJUST) / wl;
rp = wm / wl;
rq = wn / wl;
rr = wl;
if (gr > 0.0 && vg > 5.0) {
float wx = (wl * iv) / (wl - wb);
float nw = wl;
float hm = wb;
float ho = wl - wc;
float a = -wx / nw;
float b = wx;
float hn = a * hm + b;
float hp = a * ho + b;
float wy = hn / (hm - ho);
float wz = -wy * ho;
iv = min(min(wz, uz), va);;
sp = wy * nw + wz + 1.0;
}
}
}
}
vec2 ip = vec2(0.0, 0.0);
vec2 iq = vec2(EPSILON, EPSILON);
vec2 ir = vec2(-EPSILON, -EPSILON);
float is = -1.0;
float it = 0.0;
bool xb = false;
vec2 xc = vec2(0,0);
vec2 xd = vec2(0,0);
vec2 xe = vec2(0,0);
if (hi > EPSILON && hg > hf) {
float xi = floor(hi / PATTERN_INFO_TEXTURE_SIZE);
float xj = hi - (xi * PATTERN_INFO_TEXTURE_SIZE);
vec4 xk = texture2D(u_patternInfoTexture, vec2(xj, xi) / 255.0) * 255.0;
vec2 xl = jl(xk.z);
vec2 xm = jl(xk.w);
is = xl.x * 2.0 + xm.x;
float xn = 0.0;
if (mn(is, FILTER_NEAREST)) { 
xn = PATTERN_NEAREST_TEXTURE_SIZE;
} else if (mn(is, FILTER_LINEAR)) { 
xn = PATTERN_LINEAR_TEXTURE_SIZE;
} else if (mn(is, FILTER_LINEAR_SDF)) { 
xn = PATTERN_LINEAR_SDF_TEXTURE_SIZE;
xb = true;
} else if (mn(is, FILTER_MIPMAP)) { 
xn = PATTERN_MIPMAP_TEXTURE_SIZE;
}
float xu = 1.0 / xn;
vec2 xv = (vec2(xl.y, xm.y) * PATTERN_POSITION_UNIT_SIZE) * xu / 2.0;
xd += (xk.xy * PATTERN_POSITION_UNIT_SIZE * xu) + xv;
xv -= PATTERN_PADDING * xu * 2.0;
vec2 xw = vec2(eu / 2.0, iv / 2.0) * xu;
vec2 xx = vec2(ih, ih) * xu;
float ya = 1.0 * u_pixelRatio;
float yb = SDF_SMOOTH_FACTOR;
if (gu > EPSILON) {
if (xb) { 
if (a.gy > EPSILON) {
yb = SDF_SMOOTH_FACTOR * u_pixelRatio / SDF_GAMMA;
xc = vec2(-a.ie,-a.id);
}
it = yb * SDF_GAMMA / pz / u_pixelRatio;
ya = SDF_FONT_SIZE / pz;
} else { 
ya = (xv.y / xw.y) / gu;
}
}
xe = (xw + xx) * ya;
xv += PATTERN_PADDING * xu;
iq = xd - xv;
ir = xd + xv;
}
if (gw > EPSILON) {
pw.y = (a.ic) * pz;
sb = 0.0;
sd = 0.0;
pw.x = a.ib * pz * BYTES_TO_TEXT_OFFSET_X;
pw = jo(pw, tk);
pw *= tl;
}
vec2 yg = vec2(cos(gv), sin(gv)) * on;
vec2 yh = iu + yg + pw;
float yi = ih * 2.0;
float yj = eu + sd * (yi + 1.0);
float yk = iv + sb * (yi + 1.0);
vec2 yl = iw * yj / 2.0;
vec2 ym = ix * yk / 2.0;
vec2 yn = iy * yk / 2.0;
float yo = (rq - rp);
float yp = pv.x / 2.0 + 0.5;
float ij = rp + yo * yp;
float io = so + (sp - so) * ij / 2.0;
float yq = step(gl, FIRST_COMPLEX_SHAPE_ID - EPSILON);
float yr = yq * SIMPLE_SHAPE_SAMPLING_SIZE + (1.0 - yq) * COMPLEX_SHAPE_SAMPLING_SIZE;
float ys = yr / COMPLEX_SHAPE_SAMPLING_SIZE;
float yt = ys * SHAPE_SAMPLING_BUFFER_RATIO / 2.0;
float yu = ys * (1.0 - SHAPE_SAMPLING_BUFFER_RATIO);
vec2 ze = vec2(
mod(gl, NB_SHAPES_BY_SIDE),
floor(gl / NB_SHAPES_BY_SIDE)
);
vec2 zh = ze + vec2(yt) +
vec2(rp * yu, 0.0);
vec2 zk = vec2(yo, 1.0) * yu;
vec2 ii = (zh + zk * (pv / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE;
vec2 im = vec2(yj / yo, yk) / 2.0;
float zr = gn * pu;
float zs = go * pu;
float ik = zr + zs;
float il = (ij * rr) / ik;
ip = xd
+ xe
* (pv + xc / im * u_viewZoom);
cj.ii = ii;
float zv = float(gl == 1.);
ei = vec4(
(zh + zk * (vec2(0.5,0.5) / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE,
NB_SHAPES_BY_SIDE * (1. - gw) * zv,
float(tm)
);
cj.im = im;
cj.ih = ih;
cj.hj = hj;
cj.hk = hk;
cj.hc = hc;
cj.ij = nb(ij, rm, ro);
cj.ik = ik;
cj.gn = zr;
cj.il = il;
cj.io = io;
cj.ip = ip;
cj.iq = iq;
cj.ir = ir;
cj.is = is;
cj.it = it;
cj.hl = hl;
cj.iu = yh;
cj.eu = yj + zv;
cj.iv = yk + zv;
cj.iw = iw;
cj.ix = ix;
cj.iy = iy;
return true;
}
float aad(float aae, float aaf, vec4 aag) {
float aah = clamp(((u_currentTime - aae) / aaf), 0.0, 1.0);
float r = aah;
float aai = r * r;
float aaj = aai * r;
vec4 aak = aah < 0.5 ? jt(aag) : jv(aag);
float aal = aak.x;
float aam = aak.y;
float aan = aak.z;
float aao = aak.w;
float aap = aal + aam * r + aan * aai + aao * aaj;
return aap;
}
void main() {
hb a_final = nx(
a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_final_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_final_x1_y1_x2_y2,
a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
#if ANIMATED
float aae = a_animationBeginTime_animationDuration.x;
float aaf = a_animationBeginTime_animationDuration.y;
vec4 aag = a_animationEasing;
float po = aad(aae, aaf, aag);
hb a_prev = nx(
a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_prev_x1_y1_x2_y2,
a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
const float ONE = 1.0;
a_final.gl = mix(a_prev.gl, a_final.gl, ONE);
a_final.gn = mix(a_prev.gn, a_final.gn, po);
a_final.go = mix(a_prev.go, a_final.go, po);
a_final.gp = mix(a_prev.gp, a_final.gp, ONE);
a_final.gq = mix(a_prev.gq, a_final.gq, ONE);
a_final.gm = mix(a_prev.gm, a_final.gm, ONE);
a_final.gu = mix(a_prev.gu, a_final.gu, ONE);
a_final.gw = mix(a_prev.gw, a_final.gw, ONE);
a_final.gx = mix(a_prev.gx, a_final.gx, ONE);
a_final.gy = mix(a_prev.gy, a_final.gy, ONE);
a_final.gz = mix(a_prev.gz, a_final.gz, ONE);
a_final.gs = mix(a_prev.gs, a_final.gs, ONE);
a_final.gv = mix(a_prev.gv, a_final.gv, po);
a_final.hc = mix(a_prev.hc, a_final.hc, po);
a_final.hd = mix(a_prev.hd, a_final.hd, po);
a_final.he = mix(a_prev.he, a_final.he, po);
a_final.hf = mix(a_prev.hf, a_final.hf, po);
a_final.hg =mix(a_prev.hg, a_final.hg, po);
a_final.hh = mix(a_prev.hh, a_final.hh, po);
a_final.hi = mix(a_prev.hi, a_final.hi, ONE);
a_final.hj = mix(a_prev.hj, a_final.hj, po);
a_final.hk = mix(a_prev.hk, a_final.hk, po);
a_final.hl = mix(a_prev.hl, a_final.hl, po);
a_final.hm = mix(a_prev.hm, a_final.hm, po);
a_final.hn = mix(a_prev.hn, a_final.hn, po);
a_final.ho = mix(a_prev.ho, a_final.ho, po);
a_final.hp = mix(a_prev.hp, a_final.hp, po);
a_final.hq = mix(a_prev.hq, a_final.hq, po);
a_final.hr = mix(a_prev.hr, a_final.hr, po);
a_final.hs = mix(a_prev.hs, a_final.hs, po);
a_final.ht = mix(a_prev.ht, a_final.ht, po);
a_final.hu = mix(a_prev.hu, a_final.hu, po);
a_final.hv = mix(a_prev.hv, a_final.hv, po);
a_final.hw = mix(a_prev.hw, a_final.hw, po);
a_final.hx = mix(a_prev.hx, a_final.hx, po);
a_final.hy = mix(a_prev.hy, a_final.hy, po);
a_final.hz = mix(a_prev.hz, a_final.hz, po);
a_final.ia = mix(a_prev.ia, a_final.ia, ONE);
a_final.ib = mix(a_prev.ib, a_final.ib, ONE);
a_final.ic = mix(a_prev.ic, a_final.ic, ONE);
#endif
ig cj;
bool aau = pp(a_final, cj);
if (!aau) {
me();
return;
}
vec2 pv = a_vertexInfo.xy;
dn = cj.hj;
dp = cj.hk;
dq = cj.hl;
dr = cj.ii;
ds = cj.ip;
#if D3D9_FIX
#else
dy = cj.ih;
dz = cj.iq;
ea = cj.ir;
eb = vec2(cj.hc, cj.io);
ec = cj.ij;
ed = cj.ik;
ee = vec2(cj.gn, cj.il);
ef = cj.im;
eg = cj.it;
eh = cj.is;
#endif
float aaz = step(pv.x, 0.0);
float aba = 1.0 - aaz;
dt = min(cj.iv, ROUNDED_BOX_RADIUS * 2.) * u_pixelRatio;
vec2 mg = cj.iu
+ cj.iw * (cj.eu / 2.0) * pv.x
+ (aaz * cj.ix + aba * cj.iy) * cj.iv / 2.0 * pv.y;
dq = dq * (1. - ei.w)
+ vec4(
pv.x * cj.eu,
pv.y * cj.iv,
cj.eu,
cj.iv
) * u_pixelRatio * ei.w;
gl_Position = mf(mg);
}
`,to=1e20,dw=class{constructor({fontSize:t=24,buffer:e=8,radius:s=6,cutoff:i=.25}={}){this._maxDimension=1,this._gridSize=1,this._fontSize=t,this._buffer=e,this._radius=s,this._cutoff=i,this._height=Math.ceil(this._fontSize+2*this._buffer*hl),this._canvas=ss(),this._canvas.height=this._height,this._canvas.width=1;const n=this._canvas.getContext("2d",{willReadFrequently:!0});this._ctx=n,n.textBaseline="middle",n.textAlign="center",n.fillStyle="black"}setOptions({fontSize:t=24,buffer:e=8,cutoff:s=.25,radius:i=6}){this._fontSize=t,this._buffer=e,this._cutoff=s,this._radius=i,this._height=Math.ceil(this._fontSize+2*this._buffer*hl)}draw(t,e,s){Yi(this._ctx,e,this._fontSize,s);const i=hw(this._ctx.measureText(t).width+2*this._buffer)-2*Wi,n=this._height,r=i*n,o=Math.max(i,n);this._canvas.width<i&&(this._canvas.width=i,Yi(this._ctx,e,this._fontSize,s),this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="black"),r>this._gridSize&&(this._gridOuter=new Float64Array(r),this._gridInner=new Float64Array(r),this._gridSize=r),o>this._maxDimension&&(this._f=new Float64Array(o),this._d=new Float64Array(o),this._z=new Float64Array(o+1),this._v=new Int16Array(o),this._maxDimension=o),this._ctx.clearRect(0,0,i,n),this._ctx.fillText(t,i/2,n/2);const a=this._ctx.getImageData(0,0,i,n),l=new Uint8ClampedArray(r);for(let d=0;d<r;d++){const h=a.data[4*d+3]/255;this._gridOuter[d]=h===1?0:h===0?to:Math.pow(Math.max(0,.5-h),2),this._gridInner[d]=h===1?to:h===0?0:Math.pow(Math.max(0,h-.5),2)}Kg(this._gridOuter,i,n,this._f,this._d,this._v,this._z),Kg(this._gridInner,i,n,this._f,this._d,this._v,this._z);for(let d=0;d<r;d++){const h=this._gridOuter[d]-this._gridInner[d];l[d]=Math.max(0,Math.min(255,Math.round(255-255*(h/this._radius+this._cutoff))))}return{height:n,width:i,distance:l}}};function Kg(t,e,s,i,n,r,o){for(let a=0;a<e;a++){for(let l=0;l<s;l++)i[l]=t[l*e+a];Qg(i,n,r,o,s);for(let l=0;l<s;l++)t[l*e+a]=n[l]}for(let a=0;a<s;a++){for(let l=0;l<e;l++)i[l]=t[a*e+l];Qg(i,n,r,o,e);for(let l=0;l<e;l++)t[a*e+l]=Math.sqrt(n[l])}}function Qg(t,e,s,i,n){s[0]=0,i[0]=-to,i[1]=+to;for(let r=1,o=0;r<n;r++){let a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);for(;a<=i[o];)o--,a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);o++,s[o]=r,i[o]=a,i[o+1]=+to}for(let r=0,o=0;r<n;r++){for(;i[o+1]<r;)o++;e[r]=(r-s[o])*(r-s[o])+t[s[o]]}}function hw(t){return Math.ceil((t+2*Wi)/as)*as}var ea=256,uw=.275,cw=.25,gw=6,mw=C1-2*Wi,_w=L1-2*Wi,tm={fontSize:go,cutoff:uw,radius:gw},fw={fontSize:go,cutoff:cw,radius:8},pw=class{constructor(t,e){this._patternIdToInfoTexture=new Uint8Array(ea*ea*4),this._glTextures=[],this._textureSizes=[],this._pixelRatio=1,this._gl=t,this._glUnit=e;const s=ss(Gs,Gs),i=s.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Pattern: could not get 2d context");this._imageCanvasContext=i,this._imageCanvas=s,this._canvasForDuplicatedImage,this._sdfGenerator=new dw(tm),this._maxTextureSize=Math.min(4096,t.getParameter(t.MAX_TEXTURE_SIZE))}refresh(t){this._pixelRatio=t.getPixelRatio();const e=this._gl,s=this._getPatternsByFilter(t.getPatternList());for(let r=0;r<s.length;++r){const o=r,a=s[r],l=HS(a,this._maxTextureSize),{texture:d,size:h}=Xy(o,a,l,this._maxTextureSize,this._patternIdToInfoTexture),u=this._glTextures[o]||(this._glTextures[o]=e.createTexture()),c=o===Zn?oc:kh;Yg(e,u,this._glUnit+1+o,d,h,o,c),this._textureSizes[o]=h}const i=this._glTextureInfo||(this._glTextureInfo=e.createTexture()),n=this._patternIdToInfoTexture;Yg(e,i,this._glUnit,n,ea,Zn,kh)}bindMetaDataTexture(){const t=this._gl;t.activeTexture(t.TEXTURE0+this._glUnit),t.bindTexture(t.TEXTURE_2D,this._glTextureInfo)}getInfoTextureUnit(){return this._glUnit}getNearestTextureUnit(){return this._glUnit+1+Zn}getLinearTextureUnit(){return this._glUnit+1+Kr}getLinearSdfTextureUnit(){return this._glUnit+1+Qr}getMipmapTextureUnit(){return this._glUnit+1+rn}getInfoTextureSize(){return ea}getNearestTextureSize(){return this._textureSizes[Zn]}getLinearTextureSize(){return this._textureSizes[Kr]}getLinearSdfTextureSize(){return this._textureSizes[Qr]}getMipmapTextureSize(){return this._textureSizes[rn]}_getPatternsByFilter(t){const e=new Array(Hg);for(let s=0;s<Hg;++s)e[s]=[];for(let s=0;s<t.length;++s){const i=this._getPatternPixels(t[s]);e[i.filter].push(i)}return e}_getPatternPixels({id:t,type:e,attributes:s}){let i;const{text:n,font:r,style:o,image:a,scaled:l,duplicated:d,colorArray:h}=s;switch(e){case Vi:i=d?this._getDuplicatedImagePixels(a):l?this._getScaledImagePixels(a):this._getNonScaledImagePixels(a);break;case dn:i=this._getSdfTextPixels(n,r,o);break;case _n:i=this._getIconPixels(n,r,o);break;case fn:i=this._getBadgeIconPixels(n,r,o);break;case Mo:i=this._getPieChartPixels(h);break;default:throw new Error(`pattern type "${e}" does not exist`)}return i.id=t,i}_getScaledImagePixels(t){let e=t.width,s=t.height;if(e>0){const i=Gs/Math.max(t.width,t.height);e*=i,s*=i}return e&&s&&(e=cr(e),s=cr(s)),e-=2*Wi,s-=2*Wi,this._getImagePixels(t,e,s)}_getNonScaledImagePixels(t){return this._getImagePixels(t,t.width,t.height)}_getDuplicatedImagePixels(t){if(t.width===0||t.height===0)return this._getImagePixels(t,0,0);this._canvasForDuplicatedImage||(this._canvasForDuplicatedImage=ss(Gs,Gs));const e=this._canvasForDuplicatedImage,s=e.getContext("2d"),i=t.width,n=t.height;let r=(Gs-i)/2,o=(Gs-n)/2;for(;r>0;)r-=i;for(;o>0;)o-=n;for(let a=r;a<Gs;a+=i)for(let l=o;l<Gs;l+=n)s.drawImage(t,a,l);return this._getImagePixels(e,Gs,Gs)}_getImagePixels(t,e,s){let i;if(e===0||s===0)i=new Uint8Array(0);else{(this._imageCanvas.width<e||this._imageCanvas.height<s)&&(this._imageCanvas.width=e,this._imageCanvas.height=s);const n=this._imageCanvasContext;Mh(this._imageCanvas,n,e,s);try{n.drawImage(t,0,0,e,s)}catch{}i=n.getImageData(0,0,e,s).data}return{width:e,height:s,pixels:i,filter:rn}}_getPieChartPixels(t){const e=_w,s=this._imageCanvasContext,i=e/2,n=e/2;return Mh(this._imageCanvas,s,e,e),s.save(),s.rect(0,0,e,e),s.clip(),$y(s,t,i,n,e),s.restore(),{width:e,height:e,pixels:s.getImageData(0,0,e,e).data,filter:Kr}}_getTextPixels(t,e,s,i,n,r){const o=this._imageCanvasContext,a=n*this._pixelRatio;Yi(o,s,a,i);let l=Math.ceil(o.measureText(e).width);l===0&&(l=a);let d=0,h=0;t===rn||(d=2*Math.ceil(a*hl/2),h=2*Math.ceil(l*ay/2));const u=Math.ceil(l+h),c=Math.ceil(a+d),g=this._imageCanvas.height<c||this._imageCanvas.width<u;return this._imageCanvas.height<c&&(this._imageCanvas.height=c),this._imageCanvas.width<u&&(this._imageCanvas.width=u),g&&Yi(o,s,a,i),o.clearRect(0,0,u,c),o.fillStyle="black",o.textBaseline="middle",o.textAlign="left",o.fillText(e,r+h/2,c/2),{width:u,height:c,pixels:o.getImageData(0,0,u,c).data,filter:t}}_getIconPixels(t,e,s){return this._getTextPixels(rn,t,e,s,mw,0)}_getBadgeIconPixels(t,e,s){return this._sdfGenerator.setOptions(fw),this._getSdfPixels(t,e,s)}_getSdfTextPixels(t,e,s){return this._sdfGenerator.setOptions(tm),this._getSdfPixels(t,e,s)}_getSdfPixels(t,e,s){const{width:i,height:n,distance:r}=this._sdfGenerator.draw(t,e,s),o=new Uint8Array(i*n*4);for(let a=0;a<r.length;++a)o[4*a+3]=r[a];return{width:i,height:n,pixels:o,filter:Qr}}},yw=class{constructor(t,e){this._gl=t,this._glTextureUnit=e,this._simpleShapePixels=new Uint8Array(Ua*Ua*4),this._complexShapePixels=new Uint8Array(Di*Di*4),this._shapesWritten=[]}refresh(t){const e=t.getShapeList();for(const s of e)if(!this._shapesWritten.includes(s.id)){const i=s.isSimple?Ua:Di,n=s.isSimple?this._simpleShapePixels:this._complexShapePixels;WS(s,i,Sh,n),this._loadShapeInGpu(s.id,i,n),this._shapesWritten.push(s.id)}}_loadShapeInGpu(t,e,s){const i=this._gl,n=Th,r=t%wh*Di,o=Math.floor(t/wh)*Di;if(this._texture)i.bindTexture(i.TEXTURE_2D,this._texture);else{const a=new Uint8Array(n*n*4);this._texture=i.createTexture(),i.activeTexture(i.TEXTURE0+this._glTextureUnit),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,n,0,i.RGBA,i.UNSIGNED_BYTE,a)}i.texSubImage2D(i.TEXTURE_2D,0,r,o,e,e,i.RGBA,i.UNSIGNED_BYTE,s)}getTextureSize(){return Th}getSamplingSize(){return Di}getBufferRatio(){return Sh}getTextureUnit(){return this._glTextureUnit}},em=class{constructor(t,{vertex:e,fragment:s,constants:i,macros:n}){this._state=0,this._gl=t,this._vertexSource=e,this._fragmentSource=s,this._constants=Pe(i||{}),this._macros=Pe(n||{})}setConstant(t,e){this._constants[t]=e}setMacro(t,e){this._macros[t]=e}getState(){return this._state}getProgram(){return this._program}compile(){const t=this._gl,e=sm(this._vertexSource,this._macros,this._constants),s=sm(this._fragmentSource,this._macros,this._constants);this._program&&(t.deleteProgram(this._program),t.deleteShader(this._vertexShader),t.deleteShader(this._fragmentShader));const i=t.createProgram(),n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);if(!(i&&n&&r))throw new Error("Error instantiating WebGL program");this._program=i,this._vertexShader=n,this._fragmentShader=r,t.shaderSource(this._vertexShader,e),t.compileShader(this._vertexShader),t.attachShader(this._program,this._vertexShader),t.shaderSource(this._fragmentShader,s),t.compileShader(this._fragmentShader),t.attachShader(this._program,this._fragmentShader),t.linkProgram(this._program),this._state=1}getError(){const t=this._gl;if(!t.getShaderParameter(this._vertexShader,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(this._vertexShader)||"";let s=e;const i=e.match(/ERROR: (\d+):(\d+):(.*)\n/g);if(i&&i.length){const n=this._vertexSource.split(`
`);s=i.map(r=>{const o=r.match(/ERROR: (\d+):(\d+):(.*)\n/);if(!o)return r;const[a,l]=o.slice(2);return`${n[+a]}
${n[+a+1]}
~~~~~~~~~~~
${n[+a+2]}
 -> ${l}`}).join(`
`)}return{step:"vertex",message:s}}return t.getShaderParameter(this._fragmentShader,t.COMPILE_STATUS)?t.getProgramParameter(this._program,t.LINK_STATUS)?(this._state=2,null):{step:"link",message:t.getProgramInfoLog(this._program)||""}:{step:"fragment",message:t.getShaderInfoLog(this._fragmentShader)||""}}};function sm(t,e,s){const i=Object.keys(e),n=Object.keys(s);for(let r=0;r<i.length;++r){const o=i[r],a=e[o];t=t.replace(`#define ${o} 0`,`#define ${o} ${a}`)}for(let r=0;r<n.length;++r){const o=n[r],a=s[o],l=a+(a%1==0?".0":"");t=t.replace(`const float ${o} = 0.0;`,`const float ${o} = ${l};`)}return t}function xw(){return typeof window<"u"&&!!window.FORCE_WEBGL}/** @preserve instance id */var im=Ly(),bw={stencil:!0,antialias:!1,alpha:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!xw()},vw=0,Ew=1,Aw={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'},Zy=class extends Error{};function vd(t,e){if(!t&&e){const s=new Zy(Aw[e]);throw s.code=e,s}}var Sw=class Jy extends xi{constructor(e){super(e),this._2dcanvas=ss(),this._ctx=this._2dcanvas.getContext("2d"),this._bufferDrawers=[],this._mustResize=!1,this._error=null,this._onContextLost=l=>{l.preventDefault(),this._error=new Zy("WebGL context lost"),this.fire("error",this._error)};const s=Jy.createInitData(),{canvas:i,gl:n,ext:r,staticProgramWrapper:o,animationProgramWrapper:a}=s;vd(n,"NO_WEBGL"),vd(r,"NO_ANGLE_INSTANCED_ARRAYS"),this._glCanvas=i,this._gl=n,this._ext=r,this._staticProgramWrapper=o,this._animationProgramWrapper=a,this._shapeTexture=new yw(this._gl,vw),this._patternTexture=new pw(this._gl,Ew),this._initCanvas(this._glCanvas),this._computeShaderInfo(),this._initSpecialGlBuffers(),this._initGlPrograms(),this._initGl()}_initCanvas(e){super._initCanvas(e),e.addEventListener("webglcontextlost",this._onContextLost,!1)}static isAvailable(){return im||vd(null,"NO_WEBGL"),im}static createInitData(){const e=ss(),s=Ku(e,bw,"webgl"),i=s&&typeof s.getExtension=="function"?s.getExtension("ANGLE_instanced_arrays"):null,n=Iw(),r=new em(s,{vertex:bd,fragment:xd,constants:n,macros:{ANIMATED:0}}),o=new em(s,{vertex:bd,fragment:xd,constants:n,macros:{ANIMATED:1}});return s&&i&&(r.compile(),s.flush()),{canvas:e,gl:s,ext:i,staticProgramWrapper:r,animationProgramWrapper:o}}static getName(){return"WebGL"}_beforeFirstFrame(){this._animationProgramWrapper.getState()===0&&this._animationProgramWrapper.compile()}ensureAnimationsReady(){const e=this._animationProgramWrapper.getState();e!==2&&(e===0&&this._animationProgramWrapper.compile(),this._animationProgramWrapper.getError())}getDomElement(){return this._glCanvas}_initGl(){const e=this._gl;e.clearColor(0,0,0,0),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}_computeShaderInfo(){this._shaderMetadata=ww(bd,xd)}_initGlPrograms(){this._staticProgram=new Jg({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._staticProgramWrapper}),this._animationProgram=new Jg({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._animationProgramWrapper})}_initSpecialGlBuffers(){const e=this._gl,s=e.createBuffer(),i=new Int8Array(18*_s);for(let n=0;n<_s;++n){const r=[-1,-1,n,1,-1,n,1,1,n,-1,-1,n,-1,1,n,1,1,n],o=n*r.length;for(let a=0;a<r.length;a++)i[a+o]=r[a]}e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this._specialGlBuffers={vertexInfo:s}}_computeUniforms(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._scales.bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._scales.bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._scales.bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._scales.bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._scales.bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._scales.bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._scales.bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_UNIT_SIZE:as,ROUNDED_BOX_RADIUS:this._textManager.getCornerRadius(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}}_render({shapesChanged:e,patternsChanged:s,dimensionsChanged:i,backgroundColorChanged:n}){const r=this._gl;if(this._error)throw this._error;if(e&&(this._shapeTexture.refresh(this._shapeManager),this._patternTexture.bindMetaDataTexture()),s&&this._patternTexture.refresh(this._patternManager),i&&(this._mustResize=!0),n){const[l,d,h,u]=this._renderBackground?this._backgroundRgba:[0,0,0,0];r.clearColor(l*u,d*u,h*u,u)}const o=this._computeUniforms(),a=this._getSortedBufferList();this._mustResize&&a.length&&(Ja(this._glCanvas,this._width,this._height,this._pixelRatio),r.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),this._mustResize=!1),r.clear(r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT);for(let l=0;l<a.length;++l)this._displayBuffer(a[l],o);this._endFrame()}_displayBuffer(e,s){const i=e.getProgram();i!==this._currentProgram&&(this._currentProgram&&this._currentProgram.endPass(),this._currentProgram=i,this._currentProgram.startPass(s)),e.markAsUsed(),e.draw()}_getSortedBufferList(){const e=this._bufferList.getBuffersByAscendingDepth(),s=[];for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&n.markAsUnused()}for(let i=0;i<e.length;++i){const n=e[i],r=this._getBufferDrawer(n);r.markAsUsed(),!n.isEmpty()&&this._isBufferDisplayable(n)&&s.push(r)}for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&!n.isUsed()&&(n.destroy(),this._bufferDrawers[i]=void 0)}return s}_endFrame(){this._currentProgram&&(this._currentProgram.endPass(),this._currentProgram=null)}_getBufferDrawer(e){const s=e.getId();let i=this._bufferDrawers[s];if(!i){for(;this._bufferDrawers.length<=s;)this._bufferDrawers.push(void 0);i=new sw({gl:this._gl,ext:this._ext,staticProgram:this._staticProgram,animationProgram:this._animationProgram}),this._bufferDrawers[s]=i}return i.setDataBuffer(e),i}destroy(){this._glCanvas&&this._glCanvas.removeEventListener("webglcontextlost",this._onContextLost);const e=this._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}getImageData(){const e=this._glCanvas.width,s=this._glCanvas.height;return(this._2dcanvas.width<e||this._2dcanvas.height<s)&&(this._2dcanvas.width=e,this._2dcanvas.height=s),this._ctx.clearRect(0,0,e,s),this._ctx.drawImage(this._glCanvas,0,0),this._ctx.getImageData(0,0,e,s)}_getImageDataFlippedYAxis(){const e=this._gl,s=this._glCanvas.width,i=this._glCanvas.height,n=this._ctx.createImageData(s,i),r=new Uint8Array(n.data.buffer);return e.readPixels(0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,r),n}setConstant(e,s){this._staticProgramWrapper.setConstant(e,s),this._animationProgramWrapper.setConstant(e,s),this._staticProgramWrapper.compile(),this._animationProgramWrapper.compile(),this._initGlPrograms(),this._bufferDrawers.forEach(i=>{i==null||i.destroy()}),this._bufferDrawers=[]}};function ww(t,e){const s={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};return nm(s,t),nm(s,e),s}var Tw={float:1,vec2:2,vec3:3,vec4:4};function nm(t,e){const s=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g,i=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g,n=[];let r=s.exec(e);for(;r;){const o=r[0];o==="#endif"?n.pop():o.startsWith("#if")?n.push(r[4]):t.attributes.push({name:r[3],size:Tw[r[2]],type:r[1],tags:n.slice(),location:null,byteSize:0,glType:null}),r=s.exec(e)}for(r=i.exec(e);r;){if(!t.uniforms.some(({id:o})=>o===r[1])){const o=r[1],a=r[2],l=a.replace("u_","");t.uniforms.push({id:l,name:a,type:o})}r=i.exec(e)}}function Iw(){return{BYTES_TO_OFFSET_ANGLE:2*Math.PI/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:go,CURVATURE_RATIO:Bl,PATTERN_PADDING:Wi,TEXT_WIDTH_MULTIPLIER:ay,TEXT_HEIGHT_MULTIPLIER:hl,SELF_LOOP_CURVATURE_RATIO:ul,EDGE_ARROW_SIZE_RATIO:xi.edgeArrowSizeRatio,EDGE_MIN_TIP_SIZE:xi.minEdgeTipSize,CURVE_SUBDIVISIONS:_s,PIECE_NODE_COMPONENT:Bs,PIECE_TEXT_BOX:hn,PIECE_EDGE_BODY:Ul,PIECE_EDGE_HEAD:Wu,PIECE_EDGE_TAIL:Xu,PIECE_EDGE_TEXT:nn,MAX_TEXT_SIZE:xS,BYTES_TO_TEXT_OFFSET_X:1/ky,BYTES_TO_TEXT_OFFSET_Y:1/Nh,FILTER_NEAREST:Zn,FILTER_LINEAR:Kr,FILTER_LINEAR_SDF:Qr,FILTER_MIPMAP:rn,SHAPE_TEXTURE_SIZE:Th,SIMPLE_SHAPE_SAMPLING_SIZE:Ua,COMPLEX_SHAPE_SAMPLING_SIZE:Di,SHAPE_SAMPLING_BUFFER_RATIO:Sh,MAX_SHAPES:dl.toString(),FIRST_COMPLEX_SHAPE_ID:Ah,SELF_LOOP_TO_CIRCLE_APPROX:hy,SDF_GAMMA:P1}}var Lw={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,isBufferDisplayable:Fu,hideImages:!1,renderBackground:!1},sa={webgl:Sw,canvas:$S,svg:tw},rm=[0,0,0,0],Ed={webgl:null,svg:null,canvas:null},Ad=class extends Co{constructor(t){super(),this._view=Pe(Lw),this._domWrapper=Ei?document.createElement("div"):Za(),this._domElement=this._domWrapper.appendChild(Ei?document.createElement("div"):Za()),this._currentElementSize=0,this._currentBlockOffset=0,this._currentByteOffset=0,this._blockIdToAddress=new Uint32Array(0),this._renderersByType={},this._switchMainRenderer=!0,this._refreshTexts=!1,this._backgroundColor=null,this._initData=t||{},this._patternManager=new mS,this._shapeManager=new _S,this._boundariesManager=new U1,this._textManager=new bS(this._patternManager),this._bufferOffsetToId=new my,this._memoryManager=new uS(this._patternManager,this._shapeManager,this._textManager,this._bufferOffsetToId,e=>this.parseColor(e)||rm),this._bufferList=new D1}static createInitData(){const t={};for(const e in sa)t[e]=sa[e].createInitData();return t}static cacheInitData(t){Ed=t}static getCachedInitData(){return Ed}static clearCachedInitData(){Ed={webgl:null,svg:null,canvas:null}}freeBlock(t){this._checkBlockId(t);const e=this._blockIdToAddress[t],s=this._bufferList.freeBlock(e);return this._blockIdToAddress[t]=s,s}_ensureDomElementsFitParent(){const t=this._domElement.parentNode;!t||t.offsetWidth===this._view.width&&t.offsetHeight===this._view.height||Sn(t,`${this._view.width}px`,`${this._view.height}px`)}_ensureCorrectBackgroundColor(){const t=this._domElement.parentNode;this._backgroundColor!==this._view.backgroundColor&&t&&(t.style.backgroundColor=this._view.backgroundColor||"",this._backgroundColor=this._view.backgroundColor)}createGroup(){return new B1}parseColor(t){return ds(t)}clear(){this._blockIdToAddress.fill(0),this._patternManager.reset(),this._boundariesManager.reset(),this._textManager.reset(),this._bufferList.reset(),this._bufferOffsetToId.reset()}notifyFontsReloaded(){this._patternManager.notifyUpdate(),this._textManager.clear(),this._refreshTexts=!0}notifyPatternUpdate(){this._patternManager.notifyUpdate()}getShapePoints(t){return this._shapeManager.getDefinitionFromName(t).points}checkShapeHit(t,e,s){const{getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:n}=this._shapeManager.getDefinitionFromName(t);return Math.min(i(e,s),n(e,s))>=0}setGlobalBoundaries(t){const{maxBlockId:e=0,maxScaledSize:s,maxMinVisibleSize:i,maxSymbolicSize:n,maxDashLength:r,maxGapLength:o,maxPatternScale:a}=t;return e>this._blockIdToAddress.length&&this._resizeBlockArray(e),!!this._boundariesManager.set(t)&&(this._memoryManager.resizeBoundaries(s,i,n,r,o,a),!0)}_resizeBlockArray(t){const e=new Uint32Array(t);e.set(this._blockIdToAddress),this._blockIdToAddress=e}registerShape(t,e){this._shapeManager.register(t,e)}_bindBlock(t,e,s,i,n,r,o){this._checkBlockId(t);const a=this._blockIdToAddress[t],l=this._bufferList.allocateBlock(a,e,s,i,n,r,o);return this._blockIdToAddress[t]=l.address,this._currentDataView=l.buffer.getDataView(),this._currentElementSize=l.buffer.elementSize,this._currentBlockOffset=l.offset,this._currentByteOffset=this._currentBlockOffset*this._currentElementSize,this._currentSideDataView=l.buffer.getSideDataView(),this._currentSideElementSize=l.buffer.getTotalSideElementsSize(),this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize,l}_setItemIndex(t){const e=this._currentBlockOffset+t;this._currentByteOffset=e*this._currentElementSize,this._currentSideByteOffset=e*this._currentSideElementSize}_checkBlockId(t){t>=this._blockIdToAddress.length&&this._resizeBlockArray(Oi(t+1))}_setTextCharacters(t){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,t)}_storeElement(t,e){this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset,t.end),e&&(this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset+hr,t.start),this._memoryManager.storeAnimationInformation(this._currentDataView,this._currentByteOffset+2*hr,t.animation,$u.getCoefficients(t.animation.easing)))}storeGroup(t,e){if(!e||e.size===0)return this.freeBlock(t);const s=e.type,i=e.depth,n=e.size,r=e.getElements(),o=e.animated,a=e.stencilUsage,l=e.getId();let d=0;if(s===mn)for(let u=0;u<n;++u){const c=r[u],{start:g,end:m}=c;if(m.pattern.type===Xi){const _=m.pattern.attributes.text;d=Math.max(d,_.length)}if(o&&g.pattern.type===Xi){const _=g.pattern.attributes.text;d=Math.max(d,_.length)}}const h=this._bindBlock(t,s,o,i,n,d,a);for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._storeElement(c,o),this._bufferOffsetToId.set(h.buffer.getId(),h.offset+u,l)}if(s===mn)for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._setTextCharacters(c.end.pattern)}return h.address}_refreshTextElements(){const t=this._bufferList.getBuffers();for(const e of t)if(e&&e.type===mn){const s=e.getSideDataView(),i=e.getTotalSideElementsSize(),n=e.getSize();let r=0,o=i;for(let a=0;a<n;++a){const l=this._textManager.extractTextFromDataView(s,r,o);this._textManager.storeTextInDataView(s,r,o,l),r=o,o+=i}e.triggerUpdate()}}extractElement(t,e=0){if(!t)return null;const s=this._bufferList.getBlockInfo(t);return this._renderer.extractElement(s.buffer,s.offset+e)}getDomElement(){return this._domElement}getDomWrapper(){return this._domWrapper}measureText(t,e,s,i=1){return this._textManager.measureText(t,e,s,i)}setRenderType(t){this._renderType!==t&&(this._renderType=t,this._switchMainRenderer=!0)}setEdgeArrowSizeRatio(t){xi.setEdgeArrowSizeRatio(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_ARROW_SIZE_RATIO",t)}setEdgeMinTipSize(t){xi.setMinEdgeTipSize(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_MIN_TIP_SIZE",t)}_ensureMainRendererReady(){if(this._switchMainRenderer){this._renderType===null&&(this._renderType="canvas");const t=sa[this._renderType];t&&t.isAvailable()||(this._renderType="canvas"),this._renderer=this._renderersByType[this._renderType],this._renderer||(this._renderer=this._instanciateRenderer(this._renderType),this._renderer.on("error",e=>this.fire("error",e)),this._renderersByType[this._renderType]=this._renderer),this._updateDomElement()}}_updateDomElement(){const t=this._renderer&&this._renderer.getDomElement(),e=this._domElement;for(;e&&e.firstChild;)e.removeChild(e.firstChild);t&&this._appendDomChild(t)}_appendDomChild(t){t.style.position="absolute",t.style.left="0",t.style.top="0",this._domElement.appendChild(t)}_instanciateRenderer(t){return new(t===null?xi:sa[t])({initData:t===null?null:this._initData[t],bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,memoryManager:this._memoryManager})}setView(t){this._view=ct(ct({},this._view),t)}getTextManager(){return this._textManager}_updateManagers(){this._patternManager.setPixelRatio(this._view.pixelRatio),this._shapeManager.update(),this._patternManager.update(),this._textManager.update(),this._boundariesManager.update(),this._bufferList.update(),this._refreshTexts&&(this._refreshTexts=!1,this._refreshTextElements())}_resizeCanvas(t){py(t,this._view.width,this._view.height,this._view.pixelRatio)}render(){this._ensureMainRendererReady(),this._ensureDomElementsFitParent(),this._ensureCorrectBackgroundColor(),this._updateManagers(),this._renderer.renderFrame(this._view)}ensureAnimationsReady(){this._ensureMainRendererReady(),this._renderer.ensureAnimationsReady()}export(t,e,s){const i=this._instanciateRenderer(t),n=ct(ct({},this._view),e);return"setViewportClipping"in i&&i.setViewportClipping(!1),this._updateManagers(),i.renderFrame(n),i.export(s).then(()=>i.getDomElement())}getCurrentTime(){return ls()}getImageData(){return this._renderer&&this._renderer.getImageData()}destroy(){for(const t of Object.keys(this._renderersByType)){const e=this._renderersByType[t];e&&e.destroy()}}transparentify(t){const e=this.parseColor(t)||rm;return`rgba(${Math.round(255*e[0])},${Math.round(255*e[1])},${Math.round(255*e[2])},0)`}initDebugRenderingLoop({triggerKey:t="r",start:e=!0}={}){let s=e;document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s)});const i=n=>{(s||n)&&(this.setView({currentTime:ls()}),this.render()),window.requestAnimationFrame(()=>{i()})};window.requestAnimationFrame(()=>{document.body.appendChild(this.getDomElement()),i(!0)})}},Cw=Ll&&document.fonts,Mw=200,Sd="/qwerty/ [HELLO] ",om="serif",Nw=16,Pw=class{constructor(){this._fontFaceSet=Cw?document.fonts:null,this._canvas=ss(),this._ctx=this._canvas.getContext("2d")}_measureText(t,e){return this._ctx.font=`12px ${e}`,this._ctx.measureText(t).width}check(t){if(t===om)return!0;const e=this._measureText(Sd,om);return this._measureText(Sd,t)!==e}load(t){return this._fontFaceSet&&this._fontFaceSet.load?this._fontFaceSet.load(`12px ${t}`):(this._ctx.font=`12px ${t}`,this._ctx.fillText(Sd,10,50),Promise.resolve())}},Fw=class{constructor(t,e){this._fontLoaderCounter=0,this._loaded=!1,this._value=null,this._timeout=0,this._fontFaceSet=t,this._fontName=e,this._loaded=!1,this._value=null,this._timeout=0,Ll&&!this._fontFaceSet.check(this._fontName)||this._setLoaded()}_setLoaded(){this._loaded=!0,this._value=this._fontName}getValue(){return this._value}isLoaded(){return this._loaded}destroy(){clearTimeout(this._timeout)}load(){return this._tryLoad(Mw).then(()=>{this._setLoaded()})}_tryLoad(t){return this._fontFaceSet.load(this._fontName).then(()=>{if(!this._fontFaceSet.check(this._fontName)&&this._fontLoaderCounter<Nw)return new Promise(e=>{t<6e4&&(this._timeout=setTimeout(e,t))}).then(()=>(this._fontLoaderCounter++,this._tryLoad(1.5*t)))})}},kw=class{constructor(){this._fontFaceSet=new Pw,this._fonts={},this._onFontLoaded=[],this._hideUntilFontsLoaded=!0}setHideUntilFontsLoaded(t){this._hideUntilFontsLoaded=t}getFont(t){let e=this._fonts[t];return e||(e=new Fw(this._fontFaceSet,t),this._fonts[t]=e,e.isLoaded()||e.load().then(()=>this._triggerFontLoaded(t))),!this._hideUntilFontsLoaded&&t||e.getValue()}onFontLoaded(t){this._onFontLoaded.push(t)}destroy(){this._onFontLoaded=[],Object.keys(this._fonts).forEach(t=>this._fonts[t].destroy())}_triggerFontLoaded(t){this._onFontLoaded.forEach(e=>e(t))}};function Dw(t,e,s,i){ac(t,e,s,i),t.thicknessOrFontSizeScaled=e.widthScaled,t.thicknessOrFontSizeFixed=e.widthFixed,t.strokeWidthScaled=e.stroke.widthScaled,t.strokeWidthFixed=e.stroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.color,t.strokeColor=e.stroke.color,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=e.stroke.minVisibleSize,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function ac(t,e,s,i){t.pieceId=s,t.shape=i,t.x1=e.sourceX,t.y1=e.sourceY,t.x2=e.targetX,t.y2=e.targetY,t.rectWidthOrSourceRadiusScaled=e.sourceRadiusScaled,t.rectWidthOrSourceRadiusFixed=e.sourceRadiusFixed,t.rectHeightOrTargetRadiusScaled=e.targetRadiusScaled,t.rectHeightOrTargetRadiusFixed=e.targetRadiusFixed,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=hs,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.widthScaled,t.curvature=e.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=e.isSelfLoop,t.isText=!1}function Rw(t,e,s){const i=e.widthScaled+2*e.halo.widthScaled,n=e.widthFixed+2*e.halo.widthFixed;ac(t,e,s,"line"),t.thicknessOrFontSizeScaled=i,t.thicknessOrFontSizeFixed=n,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.halo.color,t.strokeColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1}function Ow(t,e,s,i){ac(t,e,s,i);const n=e.widthFixed*zg+rS;t.thicknessOrFontSizeScaled=e.widthScaled*Og,t.thicknessOrFontSizeFixed=e.widthFixed*Og,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=e.widthScaled*zg,t.offsetFixed=n,t.fillColor=e.outline.color,t.strokeColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,e.outline.minVisibleSize),t.strokeMinVisibleSize=0,t.offsetAngle=Math.PI/2,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function zw(t,e,s){Ky(t,e,s),t.pattern.type=Xi,t.pattern.attributes.text=e.content,t.pattern.attributes.size=Lo,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternColor=e.color,t.patternScale=1,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function Bw(t,e,s){Ky(t,e,s),t.pieceId+=hn,t.fillColor=e.backgroundColor,t.shape="square"}function Ky(t,e,s){const i=e.position==="centered"?0:(s.widthScaled+e.heightScaled)/2+s.stroke.widthScaled,n=e.position==="centered"?0:(s.widthFixed+e.heightFixed)/2+s.stroke.widthFixed+e.padding+e.margin;if(t.pieceId=nn,t.shape="square",t.x1=s.sourceX,t.y1=s.sourceY,t.x2=s.targetX,t.y2=s.targetY,!s.isSelfLoop&&s.curvature===0){const r=Math.atan2(t.y2-t.y1,t.x2-t.x1),o=s.sourceRadiusScaled-s.targetRadiusScaled,a=Math.cos(r),l=Math.sin(r);t.x1+=a*o,t.y1+=l*o}t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding+1,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=s.sourceRadiusScaled+s.targetRadiusScaled,t.strokeWidthFixed=s.sourceRadiusFixed+s.targetRadiusFixed,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=hs,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,s.minVisibleSize),t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.offsetAngle,t.patternScale=0,t.symbolicSize=s.widthScaled,t.curvature=s.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=s.isSelfLoop,t.isText=!1,t.adjustTextAngle=e.adjustAngle}var Uw=t=>!!t||t===0;function $s(t,e,s=0){return t==="inherit"?Array.isArray(e)?e[((s/(2*Math.PI)*e.length|0)+1)%e.length]:e:t}function Gw(t,e,s){return t==="source"?Array.isArray(e)?e[0]:e:t==="target"?Array.isArray(s)?s[0]:s:t}function Vw(t){const e=t.depth;return e===xy||e===yy||(e-qu)%Ju>=Zu}function Qy(t){const e=(t.depth-qu)%Ju;return e>=0&&e!==by&&e!==Zu}var No="shifted",jw="centered";xu(bf());function am(t,e,s,i,n,r){Hw(t,e,s,i,n,r),lm(t,e,s,i.text,n.texts.primary,r.texts.primary,r),lm(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r)}function Hw(t,e,s,i,n,r){if(i.width.get(s)!==0){if(wd(n.body,r,Dw),n.halo.body){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),wd(n.halo,r,Rw)}n.outline.body&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),wd(n.outline,r,Ow))}}function wd(t,e,s){s(t.body,e,Ul,e.shape.body),t.head&&s(t.head,e,Wu,e.shape.head),t.tail&&s(t.tail,e,Xu,e.shape.tail)}function lm(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=$s(a.color.get(s),o.color),r.position=a.position?a.position.get(s):No,r.style=a.style.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=Qu(r.content,r.maxLineLength),r.adjustAngle=a.adjustAngle.get(s),r.align=a.align.get(s),l){const h=a.scale.get(s);r.sizeScaled=o.widthScaled*h,r.sizeFixed=o.widthFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.offsetAngle=r===o.texts.primary?oS:aS,zw(n.text,r,o),n.background&&Bw(n.background,r,o)}}function dm(t,e){Td(t.body,e,!0,!0),Td(t.outline,e,e.outline.enabled,!0),Td(t.halo,e,!!e.halo.color,!1),hm(t.texts.primary,e.texts.primary),hm(t.texts.secondary,e.texts.secondary)}function Td(t,e,s,i){t.body=s,t.head=s&&i&&!!e.shape.head,t.tail=s&&i&&!!e.shape.tail}function hm(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor}function um(t,e,s,i,n,r){Ww(t,e,s,i,n,r),cm(t,e.texts.primary,s.text,i,e),cm(t,e.texts.secondary,s.text.secondary,i,e)}function Ww(t,e,s,i,n,r){const o=n.source,a=n.target,l=s.source.get(i),d=s.target.get(i),h=o.x.get(l),u=o.y.get(l),c=o.radius.get(l),g=o.color.get(l),m=+(o.scalingMethod.get(l)==="scaled"),_=a.x.get(d),f=a.y.get(d),p=a.radius.get(d),x=a.color.get(d),y=+(a.scalingMethod.get(d)==="scaled"),b=Gw(s.color.get(i),g,x),v=s.width.get(i),E=s.scalingMethod.get(i)==="scaled"?1:0,A=s.stroke.width.get(i),S=s.stroke.scalingMethod.get(i)==="scaled"?1:0,T=lS[s.shape.style.get(i)],L=s.adjustAnchors.get(i);if(e.source=l,e.target=d,e.sourceX=h,e.sourceY=u,e.targetX=_,e.targetY=f,e.sourceRadiusScaled=c*m,e.sourceRadiusFixed=c*(1-m),e.targetRadiusScaled=p*y,e.targetRadiusFixed=p*(1-y),e.widthScaled=v*E,e.widthFixed=v*(1-E),e.curvature=s.curvature.get(i),e.isSelfLoop=l===d,e.color=b,e.opacity=s.opacity.get(i),e.minVisibleSize=s.minVisibleSize.get(i),e.shape.body=s.shape.body.get(i),e.shape.head=s.shape.head.get(i),e.shape.tail=s.shape.tail.get(i),e.shape.dashLength=T.dash,e.shape.gapLength=T.gap,e.shape.isBodyTriangle=e.shape.body==="triangle",e.stroke.color=$s(s.stroke.color.get(i),b),e.stroke.widthScaled=A*S,e.stroke.widthFixed=A*(1-S),e.stroke.minVisibleSize=s.stroke.minVisibleSize.get(i),e.halo.color=s.halo.color.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1,L&&(e.shape.head||e.shape.tail||e.shape.body==="triangle")){const I=e,R=I.curvature,z=I.sourceX,j=I.sourceY,C=I.targetX,w=I.targetY;let H=1,K=1;if(R){if(!I.isSelfLoop){const it=Wl(z,j,C,w,R/2);H=ia(I,r,o,l,z,j,it.x,it.y),K=ia(I,r,a,d,C,w,it.x,it.y)}}else H=ia(I,r,o,l,z,j,C,w),K=ia(I,r,a,d,C,w,z,j);e.sourceRadiusScaled*=H,e.sourceRadiusFixed*=H,e.targetRadiusScaled*=K,e.targetRadiusFixed*=K}}function cm(t,e,s,i,n){e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=$s(s.backgroundColor.get(i),n.color)}function ia(t,e,s,i,n,r,o,a){const l=e.angle||0;let d,h=Math.atan2(a-r,o-n)-l,u=1,c=0;h<-Ds?h+=Jr:h>Ds&&(h-=Jr),h<-Ds/2?(c=Ey,d=s.badges.topLeft):h<0?(c=Ay,d=s.badges.topRight):h<Ds/2?(c=wy,d=s.badges.bottomRight):(c=Sy,d=s.badges.bottomLeft),c+=l;const g=d.text.content&&d.text.content.get(i),m=d.image.url&&d.image.url.get(i);if(Uw(g)||m){const _=d.positionScale.get(i),f=d.scale.get(i),p=Nf(o,a,n,r,n+Math.cos(c)*_,r+Math.sin(c)*_,f);if(p){const x=p.x-n,y=p.y-r,b=Math.sqrt(x*x+y*y);u=Math.max(u,b)}}if(s.shape.get(i)==="square"){const _=Math.abs(Math.cos(h)),f=Math.abs(Math.sin(h)),p=1/Math.max(_,f);u=Math.max(u,p)}return u}function gm(){return{source:0,target:0,sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:!1,color:"",opacity:0,minVisibleSize:0,shape:{body:"line",head:null,tail:null,dashLength:0,gapLength:0,isBodyTriangle:!1},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:!1,color:"",minVisibleSize:0},textHidden:!1,texts:{primary:mm(),secondary:mm()}}}function mm(){return{align:"left",hidden:!1,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",minVisibleSize:0,margin:0,padding:0,position:No,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:!1,offsetAngle:0}}function Xw(t){return t===null?t:void 0}function ts(t){return typeof t=="boolean"||t===0||t===1?t:void 0}function pn(t){return typeof t=="number"&&isFinite(t)?t:void 0}function Te(t){return typeof t=="number"&&isFinite(t)&&t>=0?t:void 0}var tx=-100,Yw=400,ex=t=>typeof t=="number"&&isFinite(t)&&t>=tx&&t<=Yw?t:void 0;function _i(t){return t===null||typeof t=="string"||typeof t=="number"?t:void 0}function zi(t){return t==="fixed"||t==="scaled"?t:void 0}function Bi(t){return ds(t)?t:void 0}function $w(t){return t===jw||t===No?t:void 0}function os(t){return t==="inherit"||ds(t)?t:void 0}function qw(t){return t==="source"||t==="target"||ds(t)?t:void 0}function tr(t){return t===null?null:typeof t=="string"?t.split(",").map(e=>{const s=e.trim(),i=s.indexOf(" ")!==-1,n=s[0];return i&&n!=='"'&&n!=="'"?`"${s}"`:s}).join(","):void 0}function er(t){return t==="none"?"normal":t==="normal"||t==="italic"||t==="bold"||t==="italic bold"||t==="bold italic"?t:void 0}function gl(t){return t==="left"||t==="center"?t:void 0}function Zw(t){return t==="equilateral"?"pentagon":t==="circle"||t==="square"||t==="cross"||t==="diamond"||t==="pentagon"||t==="star"?t:void 0}function Jw(t){return["line","tapered","arrow","dashed","dotted"].includes(t)?t:void 0}function Kw(t){return t==="line"||t==="triangle"?t:void 0}function _m(t){return[null,"arrow","circle-hole-arrow","triangle-hole-arrow","short-arrow","sharp-arrow","circle","square"].includes(t)?t:void 0}function Qw(t){return t==="plain"||t==="dashed"||t==="dotted"?t:void 0}function tT(t){return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="center"?t:void 0}function eT(t){if(ds(t))return t;if(Array.isArray(t)){if(t.length<1)return;for(let e=0;e<t.length;++e)if(!ds(t[e]))return;return t}}function ge(t){return function(e){if(typeof e=="number")return isFinite(e)&&e>=0?e:void 0;if(typeof e!="string"||e.charAt(e.length-1)!=="%")return;const s=parseFloat(e);return isNaN(s)?void 0:t*s/100}}function lc(){return{edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}}function fo(t,e=lc()){const s=(t-tx)*Ju+qu;return e.edgeHalo=Q1,e.nodeHaloStroke=yy,e.nodeHalo=xy,e.edgeBody=s+by,e.edgeTextBackground=s+tS,e.edgeText=s+eS,e.nodeBody=s+Zu,e.nodeTextBackground=s+sS,e.nodeText=s+iS,e}var sT=(t,e)=>{e.halo.body=e.halo.body||t.halo.body,e.halo.head=e.halo.head||t.halo.head,e.halo.tail=e.halo.tail||t.halo.tail,e.outline.body=e.outline.body||t.outline.body,e.outline.head=e.outline.head||t.outline.head,e.outline.tail=e.outline.tail||t.outline.tail,e.body.body=e.body.body||t.body.body,e.body.head=e.body.head||t.body.head,e.body.tail=e.body.tail||t.body.tail;const s=e.texts,i=t.texts;s.primary.text=s.primary.text||i.primary.text,s.primary.background=s.primary.background||i.primary.background,s.secondary.text=s.secondary.text||i.secondary.text,s.secondary.background=s.secondary.background||i.secondary.background},sx=t=>(e,s)=>{s.halo.body=e.halo.body[t],s.halo.head=e.halo.head[t],s.halo.tail=e.halo.tail[t],s.outline.body=e.outline.body[t],s.outline.head=e.outline.head[t],s.outline.tail=e.outline.tail[t],s.body.body=e.body.body[t],s.body.head=e.body.head[t],s.body.tail=e.body.tail[t],s.texts.primary.text=e.texts.primary.text[t],s.texts.primary.background=e.texts.primary.background[t],s.texts.secondary.text=e.texts.secondary.text[t],s.texts.secondary.background=e.texts.secondary.background[t]},iT=sx("start"),nT=sx("end"),rT=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,view:n,attributes:r,attributesPrev:o,nodeAttributes:a,nodeAttributesPrev:l}){this._fullComponents=Tr(),this._startComponents=Tr(),this._endComponents=Tr(),this._startFlags=Tr(),this._endFlags=Tr(),this._startInput=gm(),this._endInput=gm(),this._depthInfo=lc(),this._nullElt={id:-1,valid:!0},this._engine=t,this._view=n,this._helper={imageManager:e,fontManager:s,formatText:i},this._attributes=r,this._attributesPrev=o,this._nodeAttributes=a,this._nodeAttributesPrev=l,this._layers=fm(()=>t.createGroup()),this._blockIds=fm(()=>0)}drawEdge(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=-t,n=this._attributes,r=fo(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),o=n.source.get(t),a=n.target.get(t),l=n.curvature.get(t),d=this._attributesPrev.curvature.get(t),h=n.animationDuration.get(t),u=n.animationStart.get(t),c=n.animationEasing.get(t),g=h>0,m=l!==0||g&&d!==0;this._prepareBlocks(g,r,i,m);const _=this._extremitiesAttributes={source:this._nodeAttributes,target:this._nodeAttributes};if(um(s,this._endInput,n,t,_,this._view),dm(this._endFlags,this._endInput),g){const f=this._nodeAttributes.animationDuration.get(o)>0,p=this._nodeAttributes.animationDuration.get(a)>0;_.source=f?this._nodeAttributesPrev:this._nodeAttributes,_.target=p?this._nodeAttributesPrev:this._nodeAttributes,um(s,this._startInput,this._attributesPrev,t,_,this._view),dm(this._startFlags,this._startInput),sT(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._layers),nT(this._fullComponents,this._endComponents),am(e,s,t,this._attributes,this._endComponents,this._endInput),g&&(iT(this._fullComponents,this._startComponents),am(e,s,t,this._attributesPrev,this._startComponents,this._startInput),this._setBlocksAnimation(h,u,c)),this._setupHaloMasking(o,a),this._storeBlocks()}_setupHaloMasking(t,e){const s=this._nodeAttributes.halo,i=this._layers,n=s.color.get(t)&&s.hideNonAdjacentEdges.get(t),r=s.color.get(e)&&s.hideNonAdjacentEdges.get(e),o=!n&&!r?fy:Qn;i.body.stencilUsage=i.text.stencilUsage=i.textBg.stencilUsage=o}_computeBlockIds(t){const e=t*Gl,s=this._blockIds;s.body=e+$1,s.halo=e+J1,s.text=e+q1,s.textBg=e+Z1}_prepareBlocks(t,e,s,i){const n=this._layers;n.body.reset(i?cl:Ws,t,e.edgeBody,s),n.halo.reset(i?cl:Ws,t,e.edgeHalo,s),n.text.reset(mn,t,e.edgeText,s),n.textBg.reset(Ws,t,e.edgeTextBackground,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.halo,e.halo),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.halo),t.freeBlock(e.text),t.freeBlock(e.textBg)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._initEdgeComponents(t.halo,e.halo,s.halo),this._initEdgeComponents(t.outline,e.outline,s.body),this._initEdgeComponents(t.body,e.body,s.body),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initEdgeComponents(t,e,s){t.head=this._nextElement(e.head,s),t.tail=this._nextElement(e.tail,s),t.body=this._nextElement(e.body,s)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}};function fm(t){return{body:t(),halo:t(),text:t(),textBg:t()}}function Tr(){return{halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}}}function oT(t,e,s){ix(t,e,s),e.imageContent!==null?(t.pattern.type=Vi,t.pattern.attributes.image=e.imageContent,t.pattern.attributes.scaled=!0,t.pattern.attributes.duplicated=!1,t.patternScale=e.imageScale,t.patternMinVisibleSize=0,t.patternColor=null):(t.fillColor=null,t.strokeColor=null)}function aT(t,e,s){ix(t,e,s),e.textContent&&(t.pattern.type=fn,t.pattern.attributes.text=e.textContent,t.pattern.attributes.font=e.textFont,t.pattern.attributes.style=e.textStyle,t.pattern.attributes.paddingLeft=e.scale*e.textPaddingLeft*2,t.pattern.attributes.paddingTop=e.scale*e.textPaddingTop*2,t.pattern.attributes.size=Lo,t.patternMinVisibleSize=0,t.patternColor=e.textColor,t.patternScale=e.textScale,t.isBadge=!0),!e.imageUrl&&e.textContent||(t.fillColor=null,t.strokeColor=null)}function ix(t,e,s){const i=s.diameterScaled*e.scale,n=s.diameterFixed*e.scale,r=s.diameterScaled*e.positionScale/2,o=s.diameterFixed*e.positionScale/2;t.pieceId=Bs,t.shape="circle",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=i,t.rectWidthOrSourceRadiusFixed=n,t.rectHeightOrTargetRadiusScaled=i,t.rectHeightOrTargetRadiusFixed=n,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.strokeWidthScaled,t.strokeWidthFixed=e.strokeWidthFixed,t.offsetScaled=r,t.offsetFixed=o,t.pattern.type=hs,t.opacity=s.opacity,t.fillColor=e.color,t.strokeColor=e.strokeColor,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.angle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function lT(t,e,s){Xl(t,e),t.fillColor=Array.isArray(e.color)?null:e.color,t.strokeColor=e.innerStroke.color,t.strokeMinVisibleSize=e.innerStroke.minVisibleSize,t.strokeWidthScaled=e.innerStroke.widthScaled,t.strokeWidthFixed=e.innerStroke.widthFixed,s&&(t.pattern.type=hs)}function Xl(t,e){t.pieceId=Bs,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=e.diameterScaled,t.rectWidthOrSourceRadiusFixed=e.diameterFixed,t.rectHeightOrTargetRadiusScaled=e.diameterScaled,t.rectHeightOrTargetRadiusFixed=e.diameterFixed,t.shape=e.shape,t.opacity=e.opacity,t.symbolicSize=e.diameterScaled,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=null,t.strokeColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function dT(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=Bs,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=hs,t.opacity=e.opacity,t.fillColor=e.halo.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function hT(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=Bs,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.halo.strokeWidthScaled,t.strokeWidthFixed=e.halo.strokeWidthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=hs,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.halo.strokeColor,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function uT(t,e){Xl(t,e),t.pattern.type=_n,t.pattern.attributes.text=e.icon.content,t.pattern.attributes.font=e.icon.font,t.pattern.attributes.style=e.icon.style,t.pattern.attributes.size=Lo,t.patternMinVisibleSize=e.icon.minVisibleSize,t.patternColor=e.icon.color,t.patternScale=e.icon.scale}function cT(t,e){const s=e.image.fit&&!e.image.tile;Xl(t,e),t.pattern.type=Vi,t.pattern.attributes.image=e.image.content,t.pattern.attributes.scaled=s,t.pattern.attributes.duplicated=e.image.tile,t.patternScale=s?e.image.scale:0,t.patternMinVisibleSize=e.image.minVisibleSize,t.patternColor=null}function gT(t,e){const s=e.diameterScaled+2*e.innerStroke.widthScaled,i=e.diameterFixed+2*e.innerStroke.widthFixed;t.pieceId=Bs,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.outerStroke.widthScaled,t.strokeWidthFixed=e.outerStroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=hs,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.outerStroke.color,t.patternColor=null,t.globalMinVisibleSize=e.outerStroke.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function mT(t,e){const s=e.diameterScaled*Dg,i=e.diameterFixed*Dg;let n=e.diameterScaled*Rg,r=e.diameterFixed*Rg+nS;e.outerStroke.color&&(n+=e.outerStroke.widthScaled/2,r+=e.outerStroke.widthFixed/2),t.pieceId=Bs,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=hs,t.opacity=e.opacity,t.fillColor=e.outline.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.outline.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=1.5707963267948966,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function _T(t,e){Xl(t,e),Array.isArray(e.color)&&(t.pattern.type=Mo,t.pattern.attributes.colors=e.color.join(";"),t.patternScale=1,t.patternMinVisibleSize=0,t.patternColor=null)}function fT(t,e,s){nx(t,e,s),t.pattern.type=Xi,t.pattern.attributes.text=e.content,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternMinVisibleSize=0,t.patternColor=e.color,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function pT(t,e,s){nx(t,e,s),t.fillColor=e.backgroundColor,t.pieceId=hn,t.shape="square"}function yT(t,e,s){const i=Math.ceil(e.margin/2),n=s.diameterScaled/2,r=s.diameterFixed/2+i,o=hS[e.position],a=Math.cos(o),l=Math.sin(o),d=e.margin<12?1:e.margin<30?1-(e.margin-12)/18*.7:.25;t.pieceId=Bs,t.shape="triangle",t.x1=s.x-a,t.y1=s.y-l,t.x2=s.x+a,t.y2=s.y+l,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=e.margin,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=e.margin*d,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=hs,t.opacity=s.opacity,t.fillColor=e.backgroundColor,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1}function nx(t,e,s){let i=0,n=0;if(e.isPositionCenter||(i+=s.diameterScaled/2,n+=s.diameterFixed/2+e.margin+e.padding),e.isPositionVertical){if(i+=e.heightScaled/2,n+=e.heightFixed/2,e===s.texts.secondary&&s.texts.primary.position==="bottom"){const o=s.texts.primary;i+=o.heightScaled,n+=o.heightFixed+o.margin+2*o.padding}}else e.isPositionHorizontal&&(i+=e.widthScaled/2,n+=e.widthFixed/2);const r=Lo;t.pieceId=Bs,t.shape="square",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=hs,t.pattern.attributes.size=r,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=1,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function pm(t,e,s,i,n,r){const o=n.badges,a=i.badges,l=r.badges;xT(t,e,s,i,n,r),ym(t,e,s,i.text,n.texts.primary,r.texts.primary,r),ym(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r),na(t,e,s,a.topLeft,o.topLeft,l.topLeft,r),na(t,e,s,a.topRight,o.topRight,l.topRight,r),na(t,e,s,a.bottomLeft,o.bottomLeft,l.bottomLeft,r),na(t,e,s,a.bottomRight,o.bottomRight,l.bottomRight,r)}function xT(t,e,s,i,n,r){if(n.halo){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),dT(n.halo,r),n.haloStroke&&(r.halo.strokeWidthScaled=0,r.halo.strokeWidthFixed=i.halo.strokeWidth.get(s),hT(n.haloStroke,r))}if(n.outline&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),mT(n.outline,r)),n.outerStroke&&(r.outerStroke.minVisibleSize=i.outerStroke.minVisibleSize.get(s),gT(n.outerStroke,r)),n.pieChart&&_T(n.pieChart,r),n.image&&(r.image.content=e.imageManager.getImage(r.image.url),r.image.fit=i.image.fit.get(s),r.image.tile=i.image.tile.get(s),r.image.scale=i.image.scale.get(s),r.image.minVisibleSize=i.image.minVisibleSize.get(s),cT(n.image,r)),n.icon&&(r.icon.font=e.fontManager.getFont(i.icon.font.get(s)),r.icon.style=i.icon.style.get(s),r.icon.color=i.icon.color.get(s),r.icon.scale=i.icon.scale.get(s),r.icon.minVisibleSize=i.icon.minVisibleSize.get(s),uT(n.icon,r)),n.body){const o=!n.pieChart&&!n.image&&!n.icon;lT(n.body,r,o)}}function na(t,e,s,i,n,r,o){if(n.image||n.text){const a=i.stroke.width.get(s),l=+(i.stroke.scalingMethod.get(s)==="scaled");r.color=$s(i.color.get(s),o.color,r.angle),r.strokeColor=i.stroke.color.get(s),r.strokeWidthScaled=a*l,r.strokeWidthFixed=a*(1-l),r.minVisibleSize=i.minVisibleSize.get(s),r.positionScale=i.positionScale.get(s),r.scale=i.scale.get(s)}if(n.image&&(r.imageContent=e.imageManager.getImage(r.imageUrl),r.imageScale=i.image.scale.get(s),oT(n.image,r,o)),n.text){if(r.textFont=e.fontManager.getFont(i.text.font.get(s)),r.textStyle=i.text.style.get(s),r.textColor=$s(i.text.color.get(s),o.color),r.textScale=i.text.scale.get(s),r.textPaddingTop=i.text.paddingTop.get(s),r.textPaddingLeft=i.text.paddingLeft.get(s),t.measureText(r.textContent,r.textFont,r.textStyle,r.textScale).width>1){let a=0,l=0;for(;l<r.textContent.length&&a<1;)a+=t.measureText(r.textContent[l],r.textFont,r.textStyle,r.textScale).width,l+=1;l!==r.textContent.length&&(r.textContent=r.textContent.substring(0,l-1)+"")}aT(n.text,r,o)}}function ym(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=$s(a.color.get(s),o.color),r.style=a.style.get(s),r.align=a.align.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=Qu(r.content,r.maxLineLength),l){const h=a.scale.get(s);r.sizeScaled=o.diameterScaled*h,r.sizeFixed=o.diameterFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.positionAngle=dS[r.position],r.isPositionCenter=r.position==="center",r.isPositionVertical=r.position==="top"||r.position==="bottom",r.isPositionHorizontal=r.position==="left"||r.position==="right",fT(n.text,r,o),n.background&&(pT(n.background,r,o),n.tip&&yT(n.tip,r,o))}}function xm(t,e){bT(t,e),bm(t.texts.primary,e.texts.primary),bm(t.texts.secondary,e.texts.secondary),ra(t.badges.topLeft,e.badges.topLeft),ra(t.badges.topRight,e.badges.topRight),ra(t.badges.bottomLeft,e.badges.bottomLeft),ra(t.badges.bottomRight,e.badges.bottomRight)}function bT(t,e){t.body=!0,t.icon=!!e.icon.content,t.image=!!e.image.url,t.pieChart=Array.isArray(e.color),t.outerStroke=!!e.outerStroke.color,t.outline=!!e.outline.enabled,t.halo=!!e.halo.color,t.haloStroke=t.halo&&!!e.halo.strokeColor}function bm(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor,t.tip=t.background&&e.tip&&e.position!=="center"}function ra(t,e){t.text=!!e.textContent,t.image=!!e.imageUrl}function vm(t,e,s,i){vT(t,e,s,i),Em(t,e.texts.primary,s.text,i,e),Em(t,e.texts.secondary,s.text.secondary,i,e),oa(t,e.badges.topLeft,s.badges.topLeft,i),oa(t,e.badges.topRight,s.badges.topRight,i),oa(t,e.badges.bottomLeft,s.badges.bottomLeft,i),oa(t,e.badges.bottomRight,s.badges.bottomRight,i)}function vT(t,e,s,i){const n=+(s.scalingMethod.get(i)==="scaled"),r=2*s.radius.get(i),o=s.innerStroke.width.get(i),a=+(s.innerStroke.scalingMethod.get(i)==="scaled"),l=s.outerStroke.width.get(i),d=+(s.outerStroke.scalingMethod.get(i)==="scaled");e.x=s.x.get(i),e.y=s.y.get(i),e.shape=s.shape.get(i),e.color=s.color.get(i),e.opacity=s.opacity.get(i),e.diameterScaled=r*n,e.diameterFixed=r*(1-n),e.innerStroke.color=$s(s.innerStroke.color.get(i),e.color),e.innerStroke.widthScaled=o*a,e.innerStroke.widthFixed=o*(1-a),e.innerStroke.minVisibleSize=s.innerStroke.minVisibleSize.get(i),e.outerStroke.color=$s(s.outerStroke.color.get(i),e.color),e.outerStroke.widthScaled=l*d,e.outerStroke.widthFixed=l*(1-d),e.halo.color=s.halo.color.get(i),e.halo.strokeColor=s.halo.strokeColor.get(i),e.icon.content=t.formatText(s.icon.content.get(i)),e.image.url=s.image.url.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1}function Em(t,e,s,i,n){if(e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=$s(s.backgroundColor.get(i),n.color),e===n.texts.primary){const r=s;e.tip=r.tip.get(i),e.position=r.position.get(i)}else e.position="bottom"}function oa(t,e,s,i){const n=s.text.content.get(i);e.textContent=t.formatText(n),e.imageUrl=s.image.url.get(i)}function Am(){return{x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,style:"none",minVisibleSize:0},image:{url:"",content:null,scale:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:!1,color:"",minVisibleSize:0},badges:{topLeft:aa(Ey),topRight:aa(Ay),bottomLeft:aa(Sy),bottomRight:aa(wy)},textHidden:!1,texts:{primary:Sm(),secondary:Sm()}}}function aa(t){return{angle:t,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,textContent:"",textFont:"",textColor:"",textScale:0,textStyle:"none",imageUrl:"",imageContent:null,imageScale:0,textPaddingLeft:0,textPaddingTop:0}}function Sm(){return{hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1}}var ET=(t,e)=>{e.haloStroke=e.haloStroke||t.haloStroke,e.halo=e.halo||t.halo,e.outline=e.outline||t.outline,e.outerStroke=e.outerStroke||t.outerStroke,e.body=e.body||t.body,e.pieChart=e.pieChart||t.pieChart,e.image=e.image||t.image,e.icon=e.icon||t.icon;const s=t.badges,i=e.badges;i.topLeft.text=i.topLeft.text||s.topLeft.text,i.topLeft.image=i.topLeft.image||s.topLeft.image,i.topRight.text=i.topRight.text||s.topRight.text,i.topRight.image=i.topRight.image||s.topRight.image,i.bottomLeft.text=i.bottomLeft.text||s.bottomLeft.text,i.bottomLeft.image=i.bottomLeft.image||s.bottomLeft.image,i.bottomRight.text=i.bottomRight.text||s.bottomRight.text,i.bottomRight.image=i.bottomRight.image||s.bottomRight.image;const n=t.texts,r=e.texts;r.primary.text=r.primary.text||n.primary.text,r.primary.background=r.primary.background||n.primary.background,r.primary.tip=r.primary.tip||n.primary.tip,r.secondary.text=r.secondary.text||n.secondary.text,r.secondary.background=r.secondary.background||n.secondary.background,r.secondary.tip=r.secondary.tip||n.secondary.tip},rx=t=>(e,s)=>{s.haloStroke=e.haloStroke[t],s.halo=e.halo[t],s.outline=e.outline[t],s.outerStroke=e.outerStroke[t],s.body=e.body[t],s.pieChart=e.pieChart[t],s.image=e.image[t],s.icon=e.icon[t];const i=e.badges,n=s.badges;n.topLeft.text=i.topLeft.text[t],n.topLeft.image=i.topLeft.image[t],n.topRight.text=i.topRight.text[t],n.topRight.image=i.topRight.image[t],n.bottomLeft.text=i.bottomLeft.text[t],n.bottomLeft.image=i.bottomLeft.image[t],n.bottomRight.text=i.bottomRight.text[t],n.bottomRight.image=i.bottomRight.image[t];const r=e.texts,o=s.texts;o.primary.text=r.primary.text[t],o.primary.background=r.primary.background[t],o.primary.tip=r.primary.tip[t],o.secondary.text=r.secondary.text[t],o.secondary.background=r.secondary.background[t],o.secondary.tip=r.secondary.tip[t]},AT=rx("start"),ST=rx("end"),wT=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,attributes:n,attributesPrev:r}){this._fullComponents=Ir(),this._startComponents=Ir(),this._endComponents=Ir(),this._startFlags=Ir(),this._endFlags=Ir(),this._startInput=Am(),this._endInput=Am(),this._depthInfo=lc(),this._nodePatternAssigned=!1,this._nullElt={id:-1,valid:!0},this._engine=t,this._attributes=n,this._attributesPrev=r,this._helper={imageManager:e,fontManager:s,formatText:i},this._layers=wm(()=>t.createGroup()),this._blockIds=wm(()=>0)}drawNode(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=t,n=this._attributes,r=fo(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),o=n.animationDuration.get(t),a=o>0;if(this._prepareBlocks(a,r,i),vm(s,this._endInput,n,t),xm(this._endFlags,this._endInput),a&&(vm(s,this._startInput,this._attributesPrev,t),xm(this._startFlags,this._startInput),ET(this._endFlags,this._startFlags)),this._initComponents(this._fullComponents,this._endFlags,this._layers),ST(this._fullComponents,this._endComponents),pm(e,s,t,n,this._endComponents,this._endInput),a&&(AT(this._fullComponents,this._startComponents),pm(e,s,t,this._attributesPrev,this._startComponents,this._startInput)),a){const l=this._attributes.animationStart.get(t),d=this._attributes.animationEasing.get(t);this._setBlocksAnimation(o,l,d)}this._endFlags.halo&&this._attributes.halo.hideNonAdjacentEdges.get(t)&&(this._layers.halo.stencilUsage=this._layers.haloStroke.stencilUsage=_y),this._storeBlocks()}_computeBlockIds(t){const e=t*Gl,s=this._blockIds;s.body=e+j1,s.text=e+H1,s.textBg=e+W1,s.halo=e+X1,s.haloStroke=e+Y1}_prepareBlocks(t,e,s){const i=this._layers;i.body.reset(Ws,t,e.nodeBody,s),i.text.reset(mn,t,e.nodeText,s),i.textBg.reset(Ws,t,e.nodeTextBackground,s),i.halo.reset(Ws,t,e.nodeHalo,s),i.haloStroke.reset(Ws,t,e.nodeHaloStroke,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg),t.storeGroup(s.halo,e.halo),t.storeGroup(s.haloStroke,e.haloStroke)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.text),t.freeBlock(e.textBg),t.freeBlock(e.halo),t.freeBlock(e.haloStroke)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.haloStroke.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._nodePatternAssigned=!1,this._initBaseComponents(t,e,s),this._initBadgeComponents(t.badges.topLeft,e.badges.topLeft,s),this._initBadgeComponents(t.badges.topRight,e.badges.topRight,s),this._initBadgeComponents(t.badges.bottomLeft,e.badges.bottomLeft,s),this._initBadgeComponents(t.badges.bottomRight,e.badges.bottomRight,s),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initBaseComponents(t,e,s){t.haloStroke=this._nextElement(e.haloStroke,s.haloStroke),t.halo=this._nextElement(e.halo,s.halo),t.outline=this._nextElement(e.outline,s.body),t.outerStroke=this._nextElement(e.outerStroke,s.body),t.body=this._nextElement(e.body,s.body),t.pieChart=this._getNodePatternElement(e.pieChart,s),t.image=this._getNodePatternElement(e.image,s),t.icon=this._getNodePatternElement(e.icon,s)}_initBadgeComponents(t,e,s){t.image=this._nextElement(e.image,s.body),t.text=this._nextElement(e.text,s.body)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.tip=this._nextElement(e.tip,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}_getNodePatternElement(t,e){return t?this._nodePatternAssigned?e.body.next():(this._nodePatternAssigned=!0,e.body.getCurrentElement()):this._nullElt}};function wm(t){return{body:t(),text:t(),textBg:t(),halo:t(),haloStroke:t()}}function Ir(){return{haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}}}function TT({graph:t,elements:e,engine:s,imageManager:i,fontManager:n,view:r,attributes:o,boundaries:a,formatText:l}){const{nodeAttributes:d,nodeAttributesPrev:h,edgeAttributes:u,edgeAttributesPrev:c}=IT(o),{nodes:g,edges:m}=e,{maxSize:_,maxMinVisibleSize:f}=a;if(!g.size&&!m.size)return;const p=(Math.max(t.getNodeMaxIndex(),t.getEdgeMaxIndex())+1)*Gl,x=s.setGlobalBoundaries({maxBlockId:Oi(p),maxScaledSize:Oi(8*_),maxMinVisibleSize:Oi(f),maxSymbolicSize:Oi(_),maxDashLength:3,maxGapLength:1,maxPatternScale:2,maxCoord:-1/0}),y=(x?t.getNodes("_all"):g)._indexes,b=(x?t.getEdges("_all"):m)._indexes;if(y.length){const v=new wT({engine:s,imageManager:i,fontManager:n,formatText:l,attributes:d,attributesPrev:h});for(let E=0;E<y.length;++E)v.drawNode(y[E])}if(b.length){const v=new rT({engine:s,imageManager:i,fontManager:n,formatText:l,view:r,attributes:u,attributesPrev:c,nodeAttributes:d,nodeAttributesPrev:h});for(let E=0;E<b.length;++E)v.drawEdge(b[E])}}function IT(t){const e=jn(t.nodes.current,{text:{secondary:{scaling:t.nodes.current.text.scaling,maxLineLength:t.nodes.current.text.maxLineLength}}});return{nodeAttributes:e,nodeAttributesPrev:jn(t.nodes.previous,{textHidden:e.textHidden,text:{secondary:{scaling:t.nodes.previous.text.scaling,maxLineLength:t.nodes.previous.text.maxLineLength}}}),edgeAttributes:jn(t.edges.current,{text:{secondary:{scaling:t.edges.current.text.scaling,maxLineLength:t.edges.current.text.maxLineLength,adjustAngle:t.edges.current.text.adjustAngle}}}),edgeAttributesPrev:jn(t.edges.previous,{source:t.edges.current.source,target:t.edges.current.target,textHidden:t.edges.current.textHidden,text:{secondary:{scaling:t.edges.previous.text.scaling,maxLineLength:t.edges.previous.text.maxLineLength,adjustAngle:t.edges.previous.text.adjustAngle}}})}}function po(t,e,s){const i=s.length;let n=i-1,r=!1;for(let o=0;o<i;++o)(s[o].y<e&&s[n].y>=e||s[n].y<e&&s[o].y>=e)&&(s[o].x<=t||s[n].x<=t)&&(r=r!==s[o].x+(e-s[o].y)/(s[n].y-s[o].y)*(s[n].x-s[o].x)<t),n=o;return r}function la(t){const e=t.x*t.x+t.y*t.y;return{x:t.x/e,y:t.y/e}}function Tm(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=o.x*e.x+o.y*e.y;a<s&&(s=a),a>i&&(i=a)}return{x:s,y:i}}function LT(t,e){let s=t[1],i=t[0],n=la({x:s.x-i.x,y:s.y-i.y}),r=n.x;n.x=-n.y,n.y=r;const o=n;s=t[2],i=t[1],n=la({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const a=n;s=e[1],i=e[0],n=la({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const l=n;return s=e[2],i=e[1],n=la({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r,[o,a,l,n]}function ox(t,e){const s=LT(t,e);for(let i=0,n=s.length;i<n;i++){const r=s[i],o=Tm(t,r),a=Tm(e,r);if((o.x<=a.y&&o.y>=a.x?Math.min(o.y,a.y)-Math.max(o.x,a.x):0)===0)return!1}return!0}function CT(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}var MT=dc(4),NT=dc(5),PT=dc(10,.4),Ui=1/3,FT=[{x:-1,y:-Ui},{x:0,y:-Ui},{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:0,y:Ui},{x:-1,y:Ui}],kT=[{x:-1,y:-Ui},{x:-.55,y:-Ui},{x:-1,y:-1},{x:1,y:0},{x:-1,y:1},{x:-.55,y:Ui},{x:-1,y:Ui}],Im=[{x:-.6,y:-.3},{x:.1,y:0},{x:-.6,y:.3}],DT={circle:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>1-Math.sqrt(t*t+e*e),points:[{x:0,y:0,r:1}],isSimple:!0},square:{getDistanceFromStrokeVertically:(t,e)=>.996-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>.996-Math.abs(t),points:[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],isSimple:!0},line:{getDistanceFromStrokeVertically:(t,e)=>1-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:0},{x:1,y:0}],isSimple:!0},triangle:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},arrow:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},"circle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>Math.min(Math.sqrt((t+.4)*(t+.4)+e*e)-.27,(1-t)/2-Math.abs(e)),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:[{x:-.4,y:0,r:.3}],isSimple:!0},"triangle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>{const s=Math.min((1-t)/2-Math.abs(e),1-Math.abs(t)),i=-ax(t,e,Im);return Math.min(s,i)},getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:Im,isSimple:!0},"short-arrow":Lr(FT,!1),"sharp-arrow":Lr(kT,!1),cross:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>{const s=Math.abs(t),i=Math.abs(e),n=.31-Math.min(s,i),r=1-Math.max(s,i);return Math.min(n,r)},points:[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}],isSimple:!1},diamond:Lr(MT),pentagon:Lr(NT),star:Lr(PT)},RT=["circle","square","triangle","line"],OT=["cross","diamond","pentagon","star"],zT=["arrow","triangle-hole-arrow","circle-hole-arrow","short-arrow","sharp-arrow"];function Lm(t,e){for(const r of RT)Id(t,r);const s=e.nodes.current.shape.getValues(),i=e.edges.current.shape.head.getValues(),n=e.edges.current.shape.tail.getValues();for(const r of OT)s.includes(r)&&Id(t,r);for(const r of zT)r&&(i.includes(r)||n.includes(r))&&Id(t,r)}function Id(t,e){t.registerShape(e,DT[e])}function ax(t,e,s){let i=1/0;const n={x:t,y:e};for(let r=0;r<s.length;++r){const o=s[r],a=s[(r+1)%s.length];i=Math.min(i,Gy(n,o,a))}return i*(po(t,e,s)?1:-1)}function dc(t,e=1){const s=-Math.PI/2+vy,i=[],n=2*Math.PI/t;let r=s;for(let o=0;o<t;++o){const a=o%2==1?e:1;i.push({x:Math.cos(r)*a,y:Math.sin(r)*a}),r+=n}return i}function Lr(t,e=!1){return{getDistanceFromStrokeVertically:()=>1,getDistanceFromStrokeHorizontally:(s,i)=>ax(s,i,t),points:t,isSimple:e}}var BT=class extends Co{constructor(t,e){super(),this.isDummy=!0,this.width=0,this.height=0}set src(t){t&&(this._src=t,setTimeout(()=>{this.onload&&this.onload.call(this),this.width=1,this.height=1,this.fire("load")},10))}get src(){return this._src}addEventListener(t,e){this.on(t,e)}};function UT(t,e){return new(typeof Image<"u"?Image:BT)(t,e)}var GT=class{constructor(){this._images={},this._crossOrigin="anonymous",this._whenReady=[],this._onFetch=[],this._nbLoaded=0,this._nbToLoad=0}setImgCrossOrigin(t){this._crossOrigin=t}clear(){this._images={},this._nbLoaded=0,this._nbToLoad=0}getImage(t){let e=this._images[t];return e===void 0&&(this._nbToLoad+=1,e=UT(),e.crossOrigin=this._crossOrigin,e.onload=()=>this._onImgLoad(t),e.onerror=()=>{this._onImgLoad(t),this._images[t]=null},e.src=t,this._images[t]=e),e}_onImgLoad(t){this._nbLoaded+=1,this._onFetch.forEach(e=>e(t)),this._nbLoaded===this._nbToLoad&&(this._whenReady.forEach(e=>e()),this._whenReady=[])}onFetch(t){this._onFetch.push(t)}whenReady(){return this._nbLoaded===this._nbToLoad?Promise.resolve():new Promise(t=>this._whenReady.push(t))}destroy(){this._whenReady=[],this._onFetch=[]}},hc={};function VT(t){let e="";for(let s=0;s<t.length;s++)e+=t[s].cssText+`
`;return e}function lx(){const t=Ai(),e=t.styleSheets||[],s=xp(t),i=[],n=[];for(let o=0;o<e.length;o++){const a=e[o];a.href==null?i.push({href:s,content:VT(a.cssRules)}):n.push(a.href)}const r=/@font-face\s*\{[^}]+\}/g;return Promise.all(n.map(o=>pr(o).then(a=>({href:o,content:a})).catch(qa))).then(o=>o.concat(i)).then(o=>{const a=[];for(let l=0;l<o.length;l++){const d=o[l];if(d!==null){const{href:h,content:u}=d,c=u.match(r);if(c){const g=HT(c,h);a.push.apply(a,g)}}}return a})}function dx(t,e){return Promise.all(t.map(({formats:s,originalRule:i})=>Promise.all(s.map(({format:n,url:r})=>e?yp(r).then(o=>({format:n,src:o})).catch(qa):{format:n,src:r})).then(n=>{const r=[];for(const o of n)o!==null&&r.push(`url('${o.src}') format('${o.format}')`);if(r.length!==0){const o=`src: ${r.join(",")}`;return i.replace(/@font-face\s*{([^}]*);?}/,`@font-face{$1;${o}}`).replace(/\s+/," ").replace(/;+/,";")}return i})))}Ao(hc,{BUTTON_MAPPING:()=>Ou,BoundingBox:()=>xs,DummyCanvas:()=>Ty,DummyCanvasRenderingContext2D:()=>Iy,DummyDomElement:()=>hp,DummyFileReader:()=>ap,DummyTextNode:()=>fx,DummyXHR:()=>op,ElementSet:()=>Po,EventTarget:()=>Co,FlexArray:()=>ll,IndexList:()=>Kp,MOUSE_WHEEL_THROTTLE:()=>$f,Map2:()=>my,PathMap:()=>ux,PrioritySet:()=>Yf,SVG_NS:()=>Du,Table:()=>ph,XLINK:()=>gp,XML_NS:()=>ah,applyCursorStyle:()=>Ka,baseURI:()=>xp,binaryIndexOf:()=>Sf,cancelAnimFrame:()=>qf,clamp:()=>zs,clearCanvas:()=>Mh,componentsToRGBA:()=>uy,computeMax:()=>Wn,computeMin:()=>mi,concatenateArrays:()=>lv,createBlob:()=>ho,createCanvas:()=>ss,createDummyDomElement:()=>Za,createDummyXmlDocument:()=>yx,createElement:()=>lh,createSvgElement:()=>ce,createTextNode:()=>Ru,createWebGL2Context:()=>Cy,createWorker:()=>mx,createXmlDocument:()=>xx,dataUrlToBlob:()=>up,debounce:()=>CE,deepCopy:()=>Pe,displayPixelsOnScreen:()=>QT,ensureTransferable:()=>Pl,escapeDOMAttribute:()=>Hn,extendList:()=>PE,fadeElement:()=>bp,fetch:()=>pr,fetchBinary:()=>pp,fetchBinaryAsBase64:()=>yp,flatten:()=>lo,flattenArray:()=>Af,forEach:()=>ii,formatAngle:()=>sl,formatHex:()=>Va,formatWorkerMessage:()=>gx,getBaseLog:()=>Gp,getCurrentTime:()=>ls,getDate:()=>ip,getDocument:()=>Ai,getDocumentFontRules:()=>lx,getEmbeddedFontRules:()=>dx,getFlattenedKeys:()=>En,getGlContext:()=>My,getImage:()=>mp,getLeafValues:()=>Nl,getOptions:()=>Is,getPixelRatio:()=>Ss,getProperty:()=>Me,getResizeObserver:()=>lp,getStyle:()=>dp,getTime:()=>np,getValues:()=>$r,getWebglContext:()=>Ku,hash8:()=>eh,indexArrayToArray:()=>oo,indexByName:()=>FE,insertSortAsc:()=>Pr,insertSortDesc:()=>av,isArray:()=>es,isBlob:()=>BE,isHTMLElement:()=>fp,isInteger:()=>LE,isLittleEndian:()=>Ml,isObject:()=>He,isRawObject:()=>vn,isWebGLSupported:()=>Ly,lerp:()=>ue,mapKeys:()=>cy,mapValues:()=>gy,merge:()=>jn,mergeValues:()=>Ya,mix:()=>hh,nextPowerOfTwo:()=>Oi,objToValueList:()=>Yl,parseColor:()=>ds,parseColorHex:()=>Hu,parseColorRgba:()=>ju,pick:()=>ih,processQueue:()=>ME,promiseQueue:()=>Jf,promptDownload:()=>Ji,propertyPathToString:()=>th,removeFromArray:()=>dv,requestAnimFrame:()=>Nu,resizeElement:()=>Ja,resolvePath:()=>hx,rgbaToRgb:()=>Un,serializeXMLDocument:()=>uc,setAttributes:()=>ku,setCtxFont:()=>Yi,setElementSize:()=>Sn,setKeys:()=>$T,setProperty:()=>yi,setValues:()=>Ur,smartRequire:()=>Os,throttle:()=>Cl,toArray:()=>Jd,toHexa:()=>Ih,toPropertyPath:()=>bn,traverse:()=>Qf,unflatten:()=>sh,unorderedHash:()=>NE,workerIsAvailable:()=>cx});var jT={"embedded-opentype":!0,svg:!0};function HT(t,e){const s=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g,i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/,n=[];for(let r=0;r<t.length;r++){const o=t[r],a=o.match(i);if(a){const l=a[1],d=[];let h;for(;h=s.exec(o);){const u=h[1],c=h[2];jT[c.toLowerCase()]||d.push({format:c,url:hx(u,e)})}n.push({name:l,formats:d,originalRule:o})}}return n}function hx(t,e){if(/^http(s)?:/.test(t))return t;if(t[0]==="/"){const n=e.match(/((\w+:\/\/)([^/]+))/);return n?n[1]+t:t}const s=t.split("/"),i=e.split("/");for(e[e.length-1]!=="/"&&i.pop();s[0]==="..";)s.shift(),i.pop();return i.concat(s).join("/").replace(/[\w](\/{2,})/g,n=>n[0]+"/")}function WT(t){return t instanceof RegExp||t instanceof Date}var XT=typeof HTMLElement>"u"?t=>!1:t=>t instanceof HTMLElement,YT=function(t){return typeof t!="object"||t===null||es(t)||WT(t)};function Yl(t,e=[],s=[]){if(!XT(t)){if(YT(t))e.push({path:s.slice(),value:t});else{const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=s.slice();o.push(r),Yl(t[r],e,o)}}return e}}var ux=class{constructor(){this._keys=[],this._values=[],this._size=0,this._cachedPath=[],this._cachedIndex=-1}get size(){return this._size}set(t,e){const s=this._getIndex(t);s!==-1?this._values[s]=e:(Ld(this._cachedPath,t)&&(this._cachedIndex=this._keys.length),this._keys.push(t),this._values.push(e),this._size+=1)}get(t){const e=this._getIndex(t);if(e!==-1)return this._values[e]}has(t){return this._getIndex(t)!==-1}keys(){return this._keys.slice()}_getIndex(t){if(Ld(t,this._cachedPath))return this._cachedIndex;this._cachedPath=t.slice();const e=this._keys;for(let s=0;s<e.length;++s)if(Ld(e[s],t))return this._cachedIndex=s,s;return this._cachedIndex=-1,-1}};function Ld(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}var Dh,$T=function(e){return Array.from(e.keys())},Ur=function(e){return Array.from(e.values())},yo=Os("web-worker"),cx=!!yo||typeof Worker<"u"&&typeof Blob<"u";function gx(t){return yo?Rh(t):t}function Rh(t){if(ArrayBuffer.isView(t))return Array.from(t);if(Array.isArray(t)){for(let e=0;e<t.length;e++)t[e]=Rh(t[e]);return t}if(He(t)){const e=Object.keys(t);for(const s of e)t[s]=Rh(t[s]);return t}return t}function mx(t){return yo?ZT(t):qT(t)}function qT(t){const e=new Blob([t],{type:"application/javascript"}),s=URL.createObjectURL(e);return new Worker(s)}function ZT(t){if(yo)return new yo("data:application/javascript,"+t.replace(/\n/g,""))}var Cm=Os("xmldom");Dh=typeof XMLSerializer<"u"?XMLSerializer:Cm?Cm.XMLSerializer:null;var JT=class _x{constructor(e){this._attributes={},this._children=[],this._name=e}setAttribute(e,s){this._attributes[e]=s}appendChild(e){this._children.push(e)}get tagName(){return this._name}get children(){return this._children}get childNodes(){return this._children}get firstChild(){return this._children[0]||null}serialize(){const e=this._name,s=this._attributes,i=this._children,n=Object.keys(s).filter(o=>s[o]!==void 0).map(o=>` ${o}="${""+s[o]}"`).join(""),r=i.map(o=>o.serialize()).join("");return r.length?`<${e}${n}>${r}</${e}>`:`<${e}${n}/>`}cloneNode(e){const s=new _x(this._name),i=Object.keys(this._attributes);for(const n of i)s.setAttribute(n,this._attributes[n]);if(e)for(let n=0;n<this._children.length;n++)s.appendChild(this._children[n].cloneNode(e));return s}},fx=class px{constructor(e){this._text=e}serialize(){return this._text}cloneNode(){return new px(this._text)}},KT=class{constructor(){this._children=[],this._meta=[],this._children=[],this._meta=[]}appendChild(t){this._children.push(t)}serialize(){return this._meta.concat(this._children.map(t=>t.serialize())).join("")}createElement(t){return new JT(t)}createTextNode(t){return new fx(t)}},yx=()=>new KT;function uc(t){if(Dh)return new Dh().serializeToString(t)}var xx=()=>Ai().implementation.createDocument("","",null),Po=class{constructor(t,e){this._graph=t,this._nodes={elementList:t.nodeList,flexArray:t.createNodeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!0)},this._edges={elementList:t.edgeList,flexArray:t.createEdgeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!1)}}_get(t){return t.isNode?this._nodes:this._edges}addOrRemoveElements(t,e){return e?this.addElements(t):this.removeElements(t)}addElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength();for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];s.get(o)!==1&&(s.set(o,1),i.pushUnchecked(o))}return e(i.slice(n))}removeElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength(),r=i.getBuffer();if(n>r.length)return this.clear(),this.addElements(t),t;let o=0;for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];s.get(l)!==0&&(s.set(l,0),o+=1)}if(o===n)return e(i.sliceAndReset());if(o===0)return e();{const a=this._graph.acquireIndexList(t.isNode);let l=0;for(let d=0;d<n;++d){const h=r[d];s.get(h)===0?(l+=1,a.pushUnchecked(h)):r[d-l]=h}return i.setLength(n-o),e(a.sliceAndReset())}}hasElement(t){return!!this._get(t).flexArray.get(t._index)}clear(){this._nodes.indexList.isEmpty()||(this._nodes.indexList.reset(),this._nodes.flexArray.reset()),this._edges.indexList.isEmpty()||(this._edges.indexList.reset(),this._edges.flexArray.reset())}isEmpty(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()}getElements(){return{nodes:this._nodes.elementList(this._nodes.indexList.slice()),edges:this._edges.elementList(this._edges.indexList.slice())}}};function QT(t,e,s,i=0){e===void 0&&(e=s=Math.sqrt(t.length/4)),s===void 0&&(s=e);const n=document.createElement("canvas"),r=n.getContext("2d");if(r){const o=r.createImageData(e,s);n.style.imageRendering="pixelated",n.style.border="1px solid black",n.style.margin="2px",n.style.position="absolute",n.style.top=n.style.left="0px",n.width=e,n.height=s,o.data.set(t),r.putImageData(o,0,0);const a=document.getElementById("graph-container");a&&(a.style.position="static"),setTimeout(()=>document.body.appendChild(n),i)}}var t2=class{constructor(t,e){this._attributesManager=t,this._id=e}getDefinition(){return this._attributesManager.getAttributeLayerDefinition(this._id)}update(t){this._attributesManager.updateAttributeLayer(this._id,t)}destroy(){this._attributesManager.destroyAttributeLayer(this._id)}updateElements(t){this._attributesManager.updateElementsForAttributeLayer(this._id,t)}updateAll(){this._attributesManager.updateAllForAttributeLayer(this._id)}setAttributeValues(t,e,s){this._attributesManager.setAttributeLayerValues(this._id,t,e,s)}getUsedAttributeNames(t){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,t)}getFlexArrays(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)}},cc={};Ao(cc,{cubicIn:()=>n2,cubicInOut:()=>o2,cubicOut:()=>r2,linear:()=>ml,quadraticIn:()=>e2,quadraticInOut:()=>i2,quadraticOut:()=>s2});var ml=t=>t,e2=t=>t*t,s2=t=>t*(2-t),i2=t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1),n2=t=>t*t*t,r2=t=>--t*t*t+1,o2=t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2),a2={name:"animationStart",storage:32,default:0},l2={name:"animationDuration",storage:16,default:0},d2={name:"animationEasing",storage:"resource",default:"linear"},h2={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentNodes:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},u2={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},extremities:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},parallelEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},c2={x:1,y:1,radius:1,"halo.hideNonAdjacentEdges":1};function eo(t){return typeof t=="string"}var ps="Arial",$i="black",_l="rgba(255,255,255,0)",gr=12,xo=3,gc=7,g2=!0,mc=10,m2=5,bx=.08,vx="rgba(255,255,255,0)",Ex="normal",Ax="center",Sx=!1,wx=0,Oh="red",Tx="rgb(220, 220, 220)",Ix="red",Lx="rgb(220, 220, 220)",zh=1,Cx="scaled",Mx="grey",Nx=1,Px=0,Fx=0,kx=!0,Dx=0,Rx=!0,Ox="line",zx=null,Bx=null,Ux="plain",Gx="inherit",Bh=0,Vx="fixed",jx=0,Hx=null,Uh=10,Wx="fixed",Xx=1e3,Yx=800,$x="rgba(0, 0, 0, 0.6)",qx="rgba(0, 0, 0, 0)",Zx=10,Jx=1,Kx=2,Qx="rgba(0, 0, 0, 0.36)",t0=0,_2=1,e0="normal",s0="center",i0=2,Gh=2,n0=No,r0=4,o0=!0,a0=4,Vh=2,jh=12,l0=2;function f2(t,e,s){let i,n,r,o;s==="line"?(i="line",n="plain",r=null,o=null):s==="arrow"?(i="line",n="plain",r="arrow",o=null):s==="tapered"?(i="triangle",n="plain",r=null,o=null):s==="dashed"?(i="line",n="dashed",r=null,o=null):s==="dotted"&&(i="line",n="dotted",r=null,o=null),t.shape.body.set(e,i),t.shape.style.set(e,n),t.shape.head.set(e,r),t.shape.tail.set(e,o)}var d0={width:{_flexArray:zh,_check:ge(zh)},scalingMethod:{_flexArray:Cx,_check:zi},color:{_flexArray:Mx,_check:qw},opacity:{_flexArray:Nx,_check:Te},minVisibleSize:{_flexArray:Px,_check:Te},layer:{_flexArray:Fx,_check:ex},detectable:{_flexArray:kx,_check:ts},curvature:{_flexArray:Dx,_check:pn},adjustAnchors:{_flexArray:Rx,_check:ts},shape:{_check:Jw,_set:f2,type:"shape.head",body:{_flexArray:Ox,_check:Kw},head:{_flexArray:zx,_check:_m},tail:{_flexArray:Bx,_check:_m},style:{_flexArray:Ux,_check:Qw}},stroke:{color:{_flexArray:Gx,_check:os},width:{_flexArray:Bh,_check:ge(Bh)},scalingMethod:{_flexArray:Vx,_check:zi},minVisibleSize:{_flexArray:jx,_check:Te}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:Hx,_check:Bi},width:{_flexArray:Uh,_check:ge(Uh)},scalingMethod:{_flexArray:Wx,_check:zi},size:"halo.width"},pulse:{enabled:{_flexArray:!1,_check:ts},duration:{_flexArray:Xx,_check:Te},interval:{_flexArray:Yx,_check:Te},startColor:{_flexArray:$x,_check:os},endColor:{_flexArray:qx,_check:os},width:{_flexArray:Zx,_check:Te},startRatio:{_flexArray:Jx,_check:Te},endRatio:{_flexArray:Kx,_check:Te}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:ts},color:{_flexArray:Qx,_check:Bi},minVisibleSize:{_flexArray:t0,_check:Te}},text:{_alias:"text.content",content:{_flexArray:null,_check:_i},font:{_flexArray:ps,_check:tr},color:{_flexArray:$i,_check:Bi},size:{_flexArray:gr,_check:ge(gr)},scale:{_flexArray:1,_check:Te},style:{_flexArray:e0,_check:er},align:{_flexArray:s0,_check:gl},margin:{_flexArray:i0,_check:pn},padding:{_flexArray:Gh,_check:ge(Gh)},backgroundColor:{_flexArray:_l,_check:os},minVisibleSize:{_flexArray:r0,_check:Te},position:{_flexArray:n0,_check:$w},adjustAngle:{_flexArray:o0,_check:ts},scaling:{_flexArray:Sx,_check:ts},maxLineLength:{_flexArray:wx,_check:Te},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:_i},font:{_flexArray:ps,_check:tr},color:{_flexArray:$i,_check:Bi},size:{_flexArray:jh,_check:ge(jh)},scale:{_flexArray:bx,_check:Te},style:{_flexArray:Ex,_check:er},align:{_flexArray:Ax,_check:gl},margin:{_flexArray:l0,_check:pn},padding:{_flexArray:Vh,_check:ge(Vh)},backgroundColor:{_flexArray:vx,_check:os},minVisibleSize:{_flexArray:a0,_check:Te}}}},h0="grey",u0="white",_c=2,c0=null,fc=5,Hh=0,g0="rgba(0, 0, 0, 0.36)",p2=1,y2="circle",Wh=12,Gr="white",da=12,Vr="black",Jn=2,jr="black",pc=40,m0=null,_0=null,yc=1,f0="black",p0=1e3,y0=800,x0=1,b0=2,v0="rgba(0, 0, 0, 0.0)",E0="rgba(0, 0, 0, 0.6)",A0=50,x2=.1,Ri=12,ha=24,bo=1,Mm=bo/2,Nm=.45,Pm=.7,b2=10,S0=b2/2,w0=5,v2=ge(w0),E2=ge(gr),A2=ge(mc),S2=ge(_c),w2=ge(fc),T2=ge(gc),Fm=ge(xo),I2=ge(S0),L2=ge(pc),C2=ge(yc);function ua(t){return{_check:_i,_set:(e,s,i)=>{e.badges[t].text.content.set(s,i),i==null&&e.badges[t].image.url.set(s,i)},_get:(e,s)=>e.badges[t].text.content.get(s),color:{_flexArray:Gr,_check:os},scale:{_flexArray:Nm,_check:ge(Nm)},positionScale:{_flexArray:1,_check:Te},minVisibleSize:{_flexArray:Ri,_check:ge(Ri)},image:{_alias:`badges.${t}.image.url`,url:{_flexArray:null,_check:_i},scale:{_flexArray:bo,_check:ge(bo)}},stroke:{color:{_flexArray:Vr,_check:os},width:{_flexArray:Jn,_check:ge(Jn)},scalingMethod:{_flexArray:"fixed",_check:zi}},text:{_alias:`badges.${t}.text.content`,content:{_flexArray:null,_check:_i},color:{_flexArray:jr,_check:os},font:{_flexArray:ps,_check:tr},style:{_flexArray:"normal",_check:er},scale:{_flexArray:Mm,_check:ge(Mm)},paddingLeft:{_flexArray:0,_check:pn},paddingTop:{_flexArray:0,_check:pn}}}}var T0={x:{_flexArray:0,_check:pn,_disableMemoryOptimization:!0},y:{_flexArray:0,_check:pn,_disableMemoryOptimization:!0},radius:{_flexArray:w0,_check:v2},scalingMethod:{_flexArray:"scaled",_check:zi},color:{_flexArray:h0,_check:eT},opacity:{_flexArray:1,_check:Te},shape:{_flexArray:"circle",_check:Zw},layer:{_flexArray:0,_check:ex},detectable:{_flexArray:!0,_check:ts},draggable:{_flexArray:!0,_check:ts},layoutable:{_flexArray:!0,_check:ts},innerStroke:{_alias:"innerStroke.color",width:{_flexArray:_c,_check:S2},scalingMethod:{_flexArray:"fixed",_check:zi},color:{_flexArray:u0,_check:os},minVisibleSize:{_flexArray:Wh,_check:ge(Wh)}},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:fc,_check:w2},scalingMethod:{_flexArray:"fixed",_check:zi},color:{_flexArray:c0,_check:os},minVisibleSize:{_flexArray:Hh,_check:ge(Hh)}},badges:{_check:Xw,_set(t,e,s){t.badges.topLeft.text.content.set(e,s),t.badges.topLeft.image.url.set(e,s),t.badges.topRight.text.content.set(e,s),t.badges.topRight.image.url.set(e,s),t.badges.bottomLeft.text.content.set(e,s),t.badges.bottomLeft.image.url.set(e,s),t.badges.bottomRight.text.content.set(e,s),t.badges.bottomRight.image.url.set(e,s)},topLeft:ua("topLeft"),topRight:ua("topRight"),bottomLeft:ua("bottomLeft"),bottomRight:ua("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:m0,_check:Bi},width:{_flexArray:pc,_check:L2},scalingMethod:{_flexArray:"fixed",_check:zi},strokeColor:{_flexArray:_0,_check:Bi},strokeWidth:{_flexArray:yc,_check:C2},clustering:{_flexArray:!1,_check:ts},hideNonAdjacentEdges:{_flexArray:!1,_check:ts}},pulse:{enabled:{_flexArray:!1,_check:ts},duration:{_flexArray:p0,_check:Te},interval:{_flexArray:y0,_check:Te},startColor:{_flexArray:E0,_check:os},endColor:{_flexArray:v0,_check:os},width:{_flexArray:A0,_check:Te},startRatio:{_flexArray:x0,_check:Te},endRatio:{_flexArray:b0,_check:Te}},icon:{_alias:"icon.content",content:{_flexArray:null,_check:_i},font:{_flexArray:ps,_check:tr},color:{_flexArray:f0,_check:Bi},scale:{_flexArray:Pm,_check:ge(Pm)},style:{_flexArray:"normal",_check:er},minVisibleSize:{_flexArray:Ri,_check:ge(Ri)}},image:{_alias:"image.url",url:{_flexArray:null,_check:_i},scale:{_flexArray:bo,_check:ge(bo)},fit:{_flexArray:!0,_check:ts},tile:{_flexArray:!1,_check:ts},minVisibleSize:{_flexArray:Ri,_check:ge(Ri)}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:ts},color:{_flexArray:g0,_check:Bi},minVisibleSize:{_flexArray:Ri,_check:ge(Ri)}},text:{_alias:"text.content",content:{_flexArray:null,_check:_i},font:{_flexArray:ps,_check:tr},color:{_flexArray:$i,_check:os},size:{_flexArray:gr,_check:E2},scale:{_flexArray:x2,_check:Te},style:{_flexArray:"normal",_check:er},align:{_flexArray:"center",_check:gl},margin:{_flexArray:gc,_check:T2},padding:{_flexArray:xo,_check:Fm},backgroundColor:{_flexArray:null,_check:os},tip:{_flexArray:!0,_check:ts},minVisibleSize:{_flexArray:ha,_check:ge(ha)},scaling:{_flexArray:!1,_check:ts},position:{_flexArray:"bottom",_check:tT},maxLineLength:{_flexArray:0,_check:Te},truncateLength:{_flexArray:0,_check:Te},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:_i},font:{_flexArray:ps,_check:tr},color:{_flexArray:$i,_check:os},size:{_flexArray:mc,_check:A2},scale:{_flexArray:.08,_check:Te},style:{_flexArray:"normal",_check:er},align:{_flexArray:"center",_check:gl},margin:{_flexArray:S0,_check:I2},padding:{_flexArray:xo,_check:Fm},backgroundColor:{_flexArray:null,_check:os},minVisibleSize:{_flexArray:ha,_check:ge(ha)}}}},M2=t=>(e,s)=>e[t].get(s),N2=(t,e)=>(s,i)=>s[t][e].get(i),P2=(t,e,s)=>(i,n)=>i[t][e][s].get(n),F2=(t,e,s,i)=>(n,r)=>n[t][e][s][i].get(r),k2=t=>(e,s,i)=>e[t].set(s,i),D2=(t,e)=>(s,i,n)=>s[t][e].set(i,n),R2=(t,e,s)=>(i,n,r)=>i[t][e][s].set(n,r),O2=(t,e,s,i)=>(n,r,o)=>n[t][e][s][i].set(r,o),z2=[M2,N2,P2,F2],B2=[k2,D2,R2,O2];function km(t,e){if(!t._check)throw new Error(`error somewhere for ${e}`);const s=e.split("."),i=s.length-1,n=z2[i].apply(null,s),r=B2[i].apply(null,s);return{check:t._check,set:r,get:n,nested:{}}}function fl(t,e){const s=e?T0:d0,i=typeof t=="string"?[t]:En(t,"",[]);let n=!1;const r=[];for(let o=0;o<i.length;o++){const a=i[o].split(".");let l=s[a[0]];for(let h=1;h<a.length;h++)l=l[a[h]];l.type&&(i[o]=l.type),l._alias&&(i[o]=l._alias),i[o]==="badges"&&(i[o]="badges.topLeft.text.content",n=!0);const d=a[a.length-1];d!=="topLeft"&&d!=="topRight"&&d!=="bottomLeft"&&d!=="bottomRight"||(i[o]=`badges.${d}.text.content`,r.push(`badges.${d}.image.url`)),i[o]==="strokeWidth"&&(i[o]="stroke.width")}return n&&(i.push("badges.topLeft.image.url"),i.push("badges.topRight.text.content"),i.push("badges.topRight.image.url"),i.push("badges.bottomLeft.text.content"),i.push("badges.bottomLeft.image.url"),i.push("badges.bottomRight.text.content"),i.push("badges.bottomRight.image.url")),i.push(...r),i}var ca=t=>(e,s)=>({url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)}),ga=t=>(e,s)=>({color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)}),ma=t=>(e,s)=>({content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}),_a=t=>(e,s)=>({color:e.badges[t].color.get(s),scale:e.badges[t].scale.get(s),positionScale:e.badges[t].positionScale.get(s),minVisibleSize:e.badges[t].minVisibleSize.get(s),image:{url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)},stroke:{color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)},text:{content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}}),Pi={topLeft:_a("topLeft"),topRight:_a("topRight"),bottomLeft:_a("bottomLeft"),bottomRight:_a("bottomRight")},js={stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),innerStroke:(t,e)=>({width:t.innerStroke.width.get(e),scalingMethod:t.innerStroke.scalingMethod.get(e),color:t.innerStroke.color.get(e),minVisibleSize:t.innerStroke.minVisibleSize.get(e)}),outerStroke:(t,e)=>({width:t.outerStroke.width.get(e),scalingMethod:t.outerStroke.scalingMethod.get(e),color:t.outerStroke.color.get(e),minVisibleSize:t.outerStroke.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e),strokeColor:t.halo.strokeColor.get(e),strokeWidth:t.halo.strokeWidth.get(e),clustering:t.halo.clustering.get(e),hideNonAdjacentEdges:t.halo.hideNonAdjacentEdges.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),backgroundColor:t.text.backgroundColor.get(e),tip:t.text.tip.get(e),minVisibleSize:t.text.minVisibleSize.get(e),scaling:t.text.scaling.get(e),position:t.text.position.get(e),maxLineLength:t.text.maxLineLength.get(e),truncateLength:t.text.truncateLength.get(e),secondary:js["text.secondary"](t,e)}),image:(t,e)=>({url:t.image.url.get(e),scale:t.image.scale.get(e),fit:t.image.fit.get(e),tile:t.image.tile.get(e),minVisibleSize:t.image.minVisibleSize.get(e)}),icon:(t,e)=>({content:t.icon.content.get(e),font:t.icon.font.get(e),color:t.icon.color.get(e),scale:t.icon.scale.get(e),style:t.icon.style.get(e),minVisibleSize:t.icon.minVisibleSize.get(e)}),badges:(t,e)=>({topLeft:Pi.topLeft(t,e),topRight:Pi.topRight(t,e),bottomLeft:Pi.bottomLeft(t,e),bottomRight:Pi.bottomRight(t,e)}),"badges.topLeft":Pi.topLeft,"badges.topRight":Pi.topRight,"badges.bottomLeft":Pi.bottomLeft,"badges.bottomRight":Pi.bottomRight,"badges.topLeft.image":ca("topLeft"),"badges.topLeft.stroke":ga("topLeft"),"badges.topLeft.text":ma("topLeft"),"badges.topRight.image":ca("topRight"),"badges.topRight.stroke":ga("topRight"),"badges.topRight.text":ma("topRight"),"badges.bottomLeft.image":ca("bottomLeft"),"badges.bottomLeft.stroke":ga("bottomLeft"),"badges.bottomLeft.text":ma("bottomLeft"),"badges.bottomRight.image":ca("bottomRight"),"badges.bottomRight.stroke":ga("bottomRight"),"badges.bottomRight.text":ma("bottomRight"),all:(t,e)=>({x:t.x.get(e),y:t.y.get(e),radius:t.radius.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),shape:t.shape.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),draggable:t.draggable.get(e),layoutable:t.layoutable.get(e),innerStroke:js.innerStroke(t,e),outerStroke:js.outerStroke(t,e),badges:js.badges(t,e),halo:js.halo(t,e),pulse:js.pulse(t,e),icon:js.icon(t,e),image:js.image(t,e),outline:js.outline(t,e),text:js.text(t,e)})},ki={shape:(t,e)=>({body:t.shape.body.get(e),head:t.shape.head.get(e),tail:t.shape.tail.get(e),style:t.shape.style.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),position:t.text.position.get(e),backgroundColor:t.text.backgroundColor.get(e),minVisibleSize:t.text.minVisibleSize.get(e),adjustAngle:t.text.adjustAngle.get(e),scaling:t.text.scaling.get(e),maxLineLength:t.text.maxLineLength.get(e),secondary:ki["text.secondary"](t,e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e)}),all:(t,e)=>({width:t.width.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),minVisibleSize:t.minVisibleSize.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),curvature:t.curvature.get(e),adjustAnchors:t.adjustAnchors.get(e),shape:ki.shape(t,e),stroke:ki.stroke(t,e),halo:ki.halo(t,e),pulse:ki.pulse(t,e),outline:ki.outline(t,e),text:ki.text(t,e)})};function xc(t,e,s,i=!0){if((e=e||t)._flexArray!==void 0)return km(e,s);let n={check:Xs,get:Kt,set:Kt,nested:{}};if(eo(e)||e._alias){const r=eo(e)?e:e._alias;n=km(Me(t,r),r)}else{if(e._set?(n.set=e._set,n.check=e._check):(n.set=Kt,n.check=Kt),e._get)n.get=e._get;else{const r=i?js:ki;n.get=r[s||"all"]}n.nested={}}if(!eo(e)){const r=Object.keys(e);for(const o of r){const a=e[o];o.startsWith("_")||(n.nested[o]=xc(t,a,s?s+"."+o:o,i))}}return n}var U2=xc(T0,void 0,void 0,!0),G2=xc(d0,void 0,void 0,!1),V2=[];function Dm(t){let e=V2;return t.output===void 0?(typeof t.attributes=="function"&&(e="all"),He(t.attributes)&&(e=En(t.attributes))):t.output&&(e=t.output.attributes),bc(e,t.allAttributePaths)}function j2(t,e,s,i){if(i>s){for(const n of e.attributes)for(const r of t.attributes)if(r===n)return!0}for(const n of e.tags)for(const r of t.tags)if(n===r)return!0;return!1}function Ks(t,e,s,i,n,r){j2(s,i,n,r)&&t.push(e)}function H2(t){let e=t.dependencies;e===void 0?e=h2:He(e)||(e={});const s=Nl(t.attributes).some(o=>typeof o=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);let r=e.adjacentEdges;return!r&&e.adjacentNodes&&(r=!0),{self:si(e.self,n,t.allAttributePaths),adjacentNodes:si(e.adjacentNodes,n,t.allAttributePaths),adjacentEdges:si(r,n,t.allAttributePaths),allNodes:si(e.allNodes,n,t.allAttributePaths),allEdges:si(e.allEdges,n,t.allAttributePaths)}}function W2(t){let e=t.dependencies;e===void 0?e=u2:He(e)||(e={});const s=Nl(t.attributes).some(r=>typeof r=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);return{self:si(e.self,n,t.allAttributePaths),extremities:si(e.extremities,n,t.allAttributePaths),parallelEdges:si(e.parallelEdges,n,t.allAttributePaths),allNodes:si(e.allNodes,n,t.allAttributePaths),allEdges:si(e.allEdges,n,t.allAttributePaths)}}function si(t,e,s){if(!e)return{attributes:[],tags:[]};if(t===!0)return{attributes:[],tags:[yh]};const i={attributes:bc((t=t||{}).attributes,s),tags:$2(t.tags)};return t.data&&i.tags.push(xh),t.selection&&i.tags.push(we),t.hover&&i.tags.push(Zr),i}function X2(t){return Array.isArray(t)?t.join("."):t}function Y2(t){return t.map(X2).filter(eo)}function bc(t,e){if(t==="all")return e.slice();if(!Array.isArray(t))return[];const s=Y2(t);return e?e.filter(i=>s.some(n=>i.startsWith(n))):s}function $2(t){return Array.isArray(t)?t.filter(eo):[]}var Rm={storage:1,default:0},pl=class{constructor({graph:t,isNode:e,includeRemovedElements:s}){this._all=!1,this._isNode=e,this._graph=t,this._includeRemovedElements=s,this._eltList=e?this._graph.nodeList:this._graph.edgeList,this._flexArray=e?t.createNodeAttribute(Rm,!1):t.createEdgeAttribute(Rm,!1),this._all=!1,this._indexList=t.createIndexList(e)}_getAllIndexes(){const t=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex(),e=new Uint32Array(t);for(let s=1;s<=t;++s)e[s-1]=s;return e}addAll(){this._all=!0}add(t){if(!this._all)for(let e=0;e<t._indexes.length;e++){const s=t._indexes[e];this.addIndex(s)}}addIndex(t){this._flexArray.get(t)===0&&(this._flexArray.set(t,1),this._indexList.push(t))}isEmpty(){return!this._all&&this._indexList.isEmpty()}isFull(){return this._all}getListAndClear(){const t=this.getList();return this.clear(),t}getList(){let t;if(this._all&&!this._includeRemovedElements)t=this._isNode?this._graph.getNodes("all"):this._graph.getEdges("all");else{const e=this._all?this._getAllIndexes():this._indexList.slice();t=this._eltList(e)}return t}clear(){this._all=!1,this._indexList.isEmpty()||(this._indexList.reset(),this._flexArray.reset())}addSet(t){if(t._all)this.addAll();else{const e=t._indexList.getBuffer(),s=t._indexList.getLength();for(let i=0;i<s;++i)this.addIndex(e[i])}}};function I0(t,e=[],s=""){return t.constructor===ll?t.isInitialized()&&e.push(s):t.constructor===Object&&Object.keys(t).forEach(i=>{I0(t[i],e,s?s+"."+i:i)}),e}var Om=class{constructor(t,e,s){this._updatedAttributes=new Set,this._updatedAttributesTmp=new Set,this._allUsedAttributes=new Set,this._graph=t,this._eltName=e?"node":"edge",this._accessors=e?U2:G2,this._createFlexArrays=s;const i=this._createFlexArrays(t,{original:!0,useDefaultValues:!0});this._finalFlexArrays=i;const n=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._prevFlexArrays=n;const r=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._defaultFlexArrays=r,this._currentFlexArrays=this._defaultFlexArrays,this.setLastFlexArrays(this._defaultFlexArrays),this._elementsToRedraw=new pl({graph:t,isNode:e,includeRemovedElements:!0}),this._elementsUpdated=new pl({graph:t,isNode:e,includeRemovedElements:!1}),this._finalFlexArraysWrapped=ct($t(ct({},this._finalFlexArrays),{excluded:t.getAttribute(e,"excluded"),textHidden:t.getAttribute(e,"textHidden"),animationStart:t.createAttribute(e,a2),animationDuration:t.createAttribute(e,l2),animationEasing:t.createAttribute(e,d2),id:this._graph.getAttribute(e,"id")}),!e&&{source:t.getEdgeAttribute("source"),target:t.getEdgeAttribute("target")})}clear(){this._elementsToRedraw.clear(),this._elementsUpdated.clear(),this._updatedAttributes.clear(),this._updatedAttributesTmp.clear()}getAttributeFlexArrays(){return this._finalFlexArraysWrapped}getPrevAttributeFlexArrays(){return this._prevFlexArrays}getAnimationInformation(t){const e=t._indexes,s=Array(e.length),i=this._finalFlexArraysWrapped;for(let n=0;n<e.length;n++){const r=e[n];s[n]={duration:i.animationDuration.get(r),start:i.animationStart.get(r),easing:i.animationEasing.get(r)}}return s}setDefaultAttributes(t){En(t).forEach(e=>{const s=Me(this._currentFlexArrays,e),i=Me(this._prevFlexArrays,e),n=Me(this._defaultFlexArrays,e),r=Me(this._finalFlexArrays,e);if(!s)return;const o=Me(t,e);s.setDefaultValue(o),n.setDefaultValue(o),i.setDefaultValue(o),r.setDefaultValue(o)}),this.redrawAll()}startUpdate(){}prepareFlexArraysUpdate(t){this._currentFlexArrays=t.inputFlexArrays}setLastFlexArrays(t){this._lastFlexArrays=t}updateFlexArrays(t){const{attributes:e,selector:s,context:i,outputFlexArrays:n,toUpdate:r,formattedOutput:o}=t;this._elementsUpdated.addSet(r),this._elementsToRedraw.addSet(r);const a=r.getListAndClear();if(e&&a.size){const{valid:l,invalid:d}=Cp(this._graph,a,s,i);for(const h of o.attributes){const u=Me(n,h);for(let c=0;c<d._indexes.length;c++){const g=d._indexes[c];u.set(g,void 0)}}this._assignAttributesToFlexArrays(this._accessors,n,l,e,i),this._addUpdatedAttributes(t)}}endUpdate(){const t=this._elementsUpdated.getList(),e=Ur(this._updatedAttributesTmp);for(const s of e){const i=Me(this._lastFlexArrays,s),n=Me(this._finalFlexArrays,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];n.set(o,i.get(o))}}this._updatedAttributesTmp.clear(),this._currentFlexArrays=this._finalFlexArrays}setAttributeValues(t,e,s,i,n){const r=t.outputFlexArrays,o=this._accessors;this._assignAttributesToFlexArrays(o,r,e,s,null),this._addUpdatedAttributes(t,i),this._elementsUpdated.add(e),this._elementsToRedraw.add(e)}notifyLayerDestroyed(t){this._addUpdatedAttributes(t)}_addUpdatedAttributes(t,e){const{outputFlexArrays:s,formattedOutput:i}=t,n=Array.isArray(e)?bc(e):i.attributes;for(const r of n)Me(s,r).isInitialized()&&(this._updatedAttributes.add(r),this._updatedAttributesTmp.add(r),this._allUsedAttributes.add(r))}addUpdatedAttribute(t){this._updatedAttributes.add(t),this._updatedAttributesTmp.add(t),this._allUsedAttributes.add(t)}getUsedAttributeNames(t){return I0(t.outputFlexArrays)}redrawElements(t){this._elementsToRedraw.add(t)}redrawAll(){this._elementsToRedraw.addAll()}getAndResetElementsToRedraw(){return this._elementsToRedraw.getListAndClear()}getAndResetElementsUpdated(){return this._elementsUpdated.getListAndClear()}getAndResetAttributesUpdated(){const t=Ur(this._updatedAttributes);return this._updatedAttributes.clear(),t}getUpdatedAttributes(){return this._updatedAttributes}getUpdatedElementsList(){return this._elementsUpdated.getList()}getUpdatedAttributesSet(){return new Set(this._updatedAttributes)}createFlexArrays(){return this._createFlexArrays(this._graph,{original:!1,useDefaultValues:!1})}getAttributeValues(t,e,s,i){const n=i?this._prevFlexArrays:this._currentFlexArrays;return s?this._getMultipleAttributeValues(t,e,n):this._getSingleAttributeValues(t,e,n)}_getAccessor(t=""){let e=this._accessors;const s=bn(t);for(const i of s)if(e=e.nested[i],!e)throw new Error(`${this._eltName} attribute "${s.join("")}" does not exist`);return e}_getSingleAttributeValues(t,e,s){const i=this._getAccessor(e),n=t._indexes,r=Array(n.length);for(let o=0;o<n.length;o++)r[o]=i.get(s,n[o]);return r}_getMultipleAttributeValues(t,e,s){if(!e||e==="all")return this._getSingleAttributeValues(t,"",s);const i=Array(t.size);for(let n=0;n<i.length;++n)i[n]={};for(let n=0;n<e.length;n++){const r=e[n],o=this._getSingleAttributeValues(t,r,s);for(let a=0;a<i.length;++a)yi(i[a],r,o[a])}return i}setAnimationAttributes(t,{duration:e,startTime:s,easing:i}){const n=t._indexes,r=this._finalFlexArraysWrapped,o=r.animationDuration,a=r.animationStart,l=r.animationEasing,d=Ur(this._allUsedAttributes);if(e){let h=!1;for(const u of d){if(u==="x"||u==="y"){h=!0;continue}const c=Me(this._finalFlexArrays,u),g=Me(this._prevFlexArrays,u);for(let m=0;m<n.length;m++){const _=n[m];g.set(_,c.get(_))}}if(h){const u=ls(),c=this._finalFlexArrays.x,g=this._finalFlexArrays.y,m=this._prevFlexArrays.x,_=this._prevFlexArrays.y;for(let f=0;f<n.length;f++){const p=n[f],x=o.get(p);if(x){const y=a.get(p),b=l.get(p),v=(cc[b]||ml)(Math.min((u-y)/x,1)),E=hh(m.get(p),c.get(p),v),A=hh(_.get(p),g.get(p),v);m.set(p,E),_.set(p,A)}else m.set(p,c.get(p)),_.set(p,g.get(p))}}}o.fill(n,e),a.fill(n,s),l.fill(n,i)}resetAnimationAttributes(t){this._finalFlexArraysWrapped.animationDuration.fill(t._indexes,0)}getUsedAttributes(){return Ur(this._allUsedAttributes)}getDefaultFlexArrays(){return this._defaultFlexArrays}_assignAttributesToFlexArrays(t,e,s,i,n,r=[]){if(typeof i=="function"){const o=r.join(".");for(let a=0;a<s.size;++a){const l=s.get(a);if(l){const d=i(l,n,o);this._assignSingleValueToFlexArray(e,l,t,d,r)}}}else if(He(i)){const o=Object.keys(i);for(let a=0;a<o.length;++a){const l=o[a];r.push(l);const d=this._getNestedAccessor(t,l,r),h=i[l];this._assignAttributesToFlexArrays(d,e,s,h,n,r),r.pop()}}else if((Array.isArray(i)||ArrayBuffer.isView(i))&&r[0]!=="color")if(r.length===0)for(let o=0;o<s.size;++o)this._assignSingleValueToFlexArray(e,s.get(o),t,i[o],r);else for(let o=0;o<s.size;++o){const a=s._indexes[o],l=t.check(i[o]);t.set(e,a,l)}else{const o=t.check(i);for(let a=0;a<s.size;++a){const l=s.get(a);t.set(e,l._index,o)}}}_getNestedAccessor(t,e,s){const i=t.nested[e];if(!i)throw new Error(`${this._eltName} attribute "${s.join(".")}" does not exist`);return i}_assignSingleValueToFlexArray(t,e,s,i,n){if(He(i)){const r=Object.keys(i);for(const o of r){n.push(o);const a=i[o],l=this._getNestedAccessor(s,o,n);this._assignSingleValueToFlexArray(t,e,l,a,n),n.pop()}}else{const r=s.check(i);s.set(t,e._index,r)}}};function q2(t,{original:e,useDefaultValues:s}){const i="resource";return{width:t.createAttribute(!1,{storage:i,default:s?zh:void 0,name:"width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?Cx:void 0,name:"scalingMethod"},e),color:t.createAttribute(!1,{storage:i,default:s?Mx:void 0,name:"color"},e),opacity:t.createAttribute(!1,{storage:i,default:s?Nx:void 0,name:"opacity"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Px:void 0,name:"minVisibleSize"},e),layer:t.createAttribute(!1,{storage:i,default:s?Fx:void 0,name:"layer"},e),detectable:t.createAttribute(!1,{storage:i,default:s?kx:void 0,name:"detectable"},e),curvature:t.createAttribute(!1,{storage:i,default:s?Dx:void 0,name:"curvature"},e),adjustAnchors:t.createAttribute(!1,{storage:i,default:s?Rx:void 0,name:"adjustAnchors"},e),shape:{body:t.createAttribute(!1,{storage:i,default:s?Ox:void 0,name:"shape.body"},e),head:t.createAttribute(!1,{storage:i,default:s?zx:void 0,name:"shape.head"},e),tail:t.createAttribute(!1,{storage:i,default:s?Bx:void 0,name:"shape.tail"},e),style:t.createAttribute(!1,{storage:i,default:s?Ux:void 0,name:"shape.style"},e)},stroke:{color:t.createAttribute(!1,{storage:i,default:s?Gx:void 0,name:"stroke.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Bh:void 0,name:"stroke.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?Vx:void 0,name:"stroke.scalingMethod"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?jx:void 0,name:"stroke.minVisibleSize"},e)},halo:{color:t.createAttribute(!1,{storage:i,default:s?Hx:void 0,name:"halo.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Uh:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?Wx:void 0,name:"halo.scalingMethod"},e)},pulse:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!1,{storage:i,default:s?Xx:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!1,{storage:i,default:s?Yx:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!1,{storage:i,default:s?$x:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!1,{storage:i,default:s?qx:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!1,{storage:i,default:s?Zx:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!1,{storage:i,default:s?Jx:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!1,{storage:i,default:s?Kx:void 0,name:"pulse.endRatio"},e)},outline:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!1,{storage:i,default:s?Qx:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?t0:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!1,{storage:i,default:s?ps:void 0,name:"text.font"},e),color:t.createAttribute(!1,{storage:i,default:s?$i:void 0,name:"text.color"},e),size:t.createAttribute(!1,{storage:i,default:s?gr:void 0,name:"text.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?_2:void 0,name:"text.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?e0:void 0,name:"text.style"},e),align:t.createAttribute(!1,{storage:i,default:s?s0:void 0,name:"text.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?i0:void 0,name:"text.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?Gh:void 0,name:"text.padding"},e),position:t.createAttribute(!1,{storage:i,default:s?n0:void 0,name:"text.position"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?_l:void 0,name:"text.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?r0:void 0,name:"text.minVisibleSize"},e),adjustAngle:t.createAttribute(!1,{storage:i,default:s?o0:void 0,name:"text.adjustAngle"},e),scaling:t.createAttribute(!1,{storage:i,default:s?Sx:void 0,name:"text.scaling"},e),maxLineLength:t.createAttribute(!1,{storage:i,default:s?wx:void 0,name:"text.maxLineLength"},e),secondary:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!1,{storage:i,default:s?ps:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!1,{storage:i,default:s?$i:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!1,{storage:i,default:s?jh:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?bx:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?Ex:void 0,name:"text.secondary.style"},e),align:t.createAttribute(!1,{storage:i,default:s?Ax:void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?l0:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?Vh:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?vx:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?a0:void 0,name:"text.secondary.minVisibleSize"},e)}}}}function Z2(t,{original:e,useDefaultValues:s}){const i="resource";return{x:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"x"},e),y:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"y"},e),radius:t.createAttribute(!0,{storage:i,default:s?5:void 0,name:"radius"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?h0:void 0,name:"color"},e),opacity:t.createAttribute(!0,{storage:i,default:s?p2:void 0,name:"opacity"},e),shape:t.createAttribute(!0,{storage:i,default:s?y2:void 0,name:"shape"},e),layer:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"layer"},e),detectable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"detectable"},e),draggable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"draggable"},e),layoutable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"layoutable"},e),innerStroke:{width:t.createAttribute(!0,{storage:i,default:s?_c:void 0,name:"innerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"innerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?u0:void 0,name:"innerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Wh:void 0,name:"innerStroke.minVisibleSize"},e)},outerStroke:{width:t.createAttribute(!0,{storage:i,default:s?fc:void 0,name:"outerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"outerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?c0:void 0,name:"outerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Hh:void 0,name:"outerStroke.minVisibleSize"},e)},badges:{topLeft:{color:t.createAttribute(!0,{storage:i,default:s?Gr:void 0,name:"badges.topLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?da:void 0,name:"badges.topLeft.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Vr:void 0,name:"badges.topLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Jn:void 0,name:"badges.topLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topLeft.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.topLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ps:void 0,name:"badges.topLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.top"},e)}},topRight:{color:t.createAttribute(!0,{storage:i,default:s?Gr:void 0,name:"badges.topRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?da:void 0,name:"badges.topRight.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Vr:void 0,name:"badges.topRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Jn:void 0,name:"badges.topRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topRight.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.topRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ps:void 0,name:"badges.topRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topRight.text.scale"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.left"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.top"},e)}},bottomLeft:{color:t.createAttribute(!0,{storage:i,default:s?Gr:void 0,name:"badges.bottomLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?da:void 0,name:"badges.bottomLeft.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Vr:void 0,name:"badges.bottomLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Jn:void 0,name:"badges.bottomLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomLeft.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.bottomLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ps:void 0,name:"badges.bottomLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.top"},e)}},bottomRight:{color:t.createAttribute(!0,{storage:i,default:s?Gr:void 0,name:"badges.bottomRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?da:void 0,name:"badges.bottomRight.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Vr:void 0,name:"badges.bottomRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Jn:void 0,name:"badges.bottomRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomRight.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.bottomRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ps:void 0,name:"badges.bottomRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomRight.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.top"},e)}}},halo:{color:t.createAttribute(!0,{storage:i,default:s?m0:void 0,name:"halo.color"},e),width:t.createAttribute(!0,{storage:i,default:s?pc:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"halo.scalingMethod"},e),strokeColor:t.createAttribute(!0,{storage:i,default:s?_0:void 0,name:"halo.strokeColor"},e),strokeWidth:t.createAttribute(!0,{storage:i,default:s?yc:void 0,name:"halo.strokeWidth"},e),clustering:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.clustering"},e),hideNonAdjacentEdges:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.hideNonAdjacentEdges"},e)},pulse:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!0,{storage:i,default:s?p0:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!0,{storage:i,default:s?y0:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!0,{storage:i,default:s?E0:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!0,{storage:i,default:s?v0:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!0,{storage:i,default:s?A0:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!0,{storage:i,default:s?x0:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!0,{storage:i,default:s?b0:void 0,name:"pulse.endRatio"},e)},icon:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"icon.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ps:void 0,name:"icon.font"},e),color:t.createAttribute(!0,{storage:i,default:s?f0:void 0,name:"icon.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.7:void 0,name:"icon.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"icon.style"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"icon.minVisibleSize"},e)},image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"image.scale"},e),fit:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"image.fit"},e),tile:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"image.tile"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"image.minVisibleSize"},e)},outline:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!0,{storage:i,default:s?g0:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ps:void 0,name:"text.font"},e),color:t.createAttribute(!0,{storage:i,default:s?$i:void 0,name:"text.color"},e),size:t.createAttribute(!0,{storage:i,default:s?gr:void 0,name:"text.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.1:void 0,name:"text.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?gc:void 0,name:"text.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?xo:void 0,name:"text.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?_l:void 0,name:"text.backgroundColor"},e),tip:t.createAttribute(!0,{storage:i,default:s?g2:void 0,name:"text.tip"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.minVisibleSize"},e),scaling:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"text.scaling"},e),position:t.createAttribute(!0,{storage:i,default:s?"bottom":void 0,name:"text.position"},e),maxLineLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.maxLineLength"},e),truncateLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.truncateLength"},e),secondary:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ps:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!0,{storage:i,default:s?$i:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!0,{storage:i,default:s?mc:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.08:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.secondary.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?m2:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?xo:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?_l:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.secondary.minVisibleSize"},e)}}}}var J2=class{constructor(t){this.nodes=new Om(t,!0,Z2),this.edges=new Om(t,!1,q2)}setNodeDefaultAttributes(t){this.nodes.setDefaultAttributes(t)}setEdgeDefaultAttributes(t){this.edges.setDefaultAttributes(t)}getFlexArrays(){return{nodes:{current:this.nodes.getAttributeFlexArrays(),previous:this.nodes.getPrevAttributeFlexArrays()},edges:{current:this.edges.getAttributeFlexArrays(),previous:this.edges.getPrevAttributeFlexArrays()}}}redrawAll(){this.nodes.redrawAll(),this.edges.redrawAll()}clear(){this.nodes.clear(),this.edges.clear()}redrawElements(t){this._fetch(t).redrawElements(t)}getAnimationInformation(t){return this._fetch(t).getAnimationInformation(t)}redrawNodes(t){this.nodes.redrawElements(t)}getUsedAttributes(t,e){return this._fetch(e).getUsedAttributeNames(e.isNode?t.nodes:t.edges)}startUpdate(){this.nodes.startUpdate(),this.edges.startUpdate()}notifyDestroyed(t){this.nodes.notifyLayerDestroyed(t.nodes),this.edges.notifyLayerDestroyed(t.edges)}prepareUpdate(t){this.nodes.prepareFlexArraysUpdate(t.nodes),this.edges.prepareFlexArraysUpdate(t.edges)}onUpdate(t){this.nodes.updateFlexArrays(t.nodes),this.edges.updateFlexArrays(t.edges)}afterLayersUpdate(){this.nodes.endUpdate(),this.edges.endUpdate()}getAndResetElementsToRedraw(){return{nodes:this.nodes.getAndResetElementsToRedraw(),edges:this.edges.getAndResetElementsToRedraw()}}getAndResetElementsUpdated(){const t=this.nodes,e=this.edges;return{nodes:t.getAndResetElementsUpdated(),edges:e.getAndResetElementsUpdated(),nodeAttributesSet:t.getUpdatedAttributesSet(),nodeAttributes:t.getAndResetAttributesUpdated(),edgeAttributes:e.getAndResetAttributesUpdated()}}setAnimationAttributes({nodes:t,edges:e},s){this.nodes.setAnimationAttributes(t,s),this.edges.setAnimationAttributes(e,s)}resetAnimationAttributes({nodes:t,edges:e}){this.nodes.resetAnimationAttributes(t),this.edges.resetAnimationAttributes(e)}setLastOutput(t,e){this.nodes.setLastFlexArrays(t),this.edges.setLastFlexArrays(e)}getCurrentInput(){const t=Pe(this.nodes.getDefaultFlexArrays()),e=Pe(this.edges.getDefaultFlexArrays());return{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:En(t),allEdgeAttributePaths:En(e)}}initializeLayer(t,e,s){t.nodes.allAttributePaths=e,t.edges.allAttributePaths=s,t.nodes.formattedDependencies=H2(t.nodes),t.edges.formattedDependencies=W2(t.edges),t.nodes.formattedOutput={attributes:Dm(t.nodes),tags:t.tag?[t.tag]:[]},t.edges.formattedOutput={attributes:Dm(t.edges),tags:t.tag?[t.tag]:[]},t.nodes.redrawAdjacentEdges=t.nodes.formattedOutput.attributes.some(i=>c2[i]),t.initialized=!0}connectLayerInputOutput(t,e,s){const i=t.nodes.formattedOutput,n=t.edges.formattedOutput;for(const r of i.attributes){const o=Me(e,r),a=Me(t.nodes.outputFlexArrays,r);a.setFallback(o),yi(e,r,a)}for(const r of n.attributes){const o=Me(s,r),a=Me(t.edges.outputFlexArrays,r);a.setFallback(o),yi(s,r,a)}}setupLayerDependencies(t,e){if(t===e)return;const s=t.priority,i=e.priority,n=t.nodes.formattedOutput,r=t.edges.formattedOutput,o=e.nodes.formattedDependencies,a=e.edges.formattedDependencies;Ks(t.depsNodeSelf,e,n,o.self,s,i),Ks(t.depsNodeAdjacentNodes,e,n,o.adjacentNodes,s,i),Ks(t.depsNodeAdjacentEdges,e,r,a.extremities,s,i),Ks(t.depsNodeAllNodes,e,n,o.allNodes,s,i),Ks(t.depsNodeAllEdges,e,r,a.allNodes,s,i),Ks(t.depsEdgeSelf,e,r,a.self,s,i),Ks(t.depsEdgeExtremities,e,n,o.adjacentEdges,s,i),Ks(t.depsEdgeParallelEdges,e,r,a.parallelEdges,s,i),Ks(t.depsEdgeAllNodes,e,n,o.allEdges,s,i),Ks(t.depsEdgeAllEdges,e,r,a.allEdges,s,i)}createAttributeLayerData(t,e,s,{tag:i,onBeforeUpdate:n,standaloneSelectors:r}){const o=!!r;return{index:-1,id:e,name:t,tag:i||null,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:!1,onBeforeUpdate:n,nodes:{type:"node",name:t,standaloneSelector:o,toUpdate:new pl({graph:s,isNode:!0,includeRemovedElements:!1}),outputFlexArrays:this.nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{type:"edge",name:t,standaloneSelector:o,toUpdate:new pl({graph:s,isNode:!1,includeRemovedElements:!1}),outputFlexArrays:this.edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}}}setAttributeValues(t,e,s,i,n){this._fetch(e).setAttributeValues(t,e,s,i,n)}getAttributeValues(t,e,s,i){return this._fetch(t).getAttributeValues(t,e,s,i)}_fetch(t){return t.isNode?this.nodes:this.edges}},K2=(t,e)=>new t2(t,e),Q2=class{constructor(t,{graph:e,dom:s}){this._layerIdCounter=0,this._layers=[],this._destroyedLayers=[],this._layersNeedUpdate=!1,this._updateOngoing=!1,this._needUpdate=!1,this._ogma=t,this._graph=e,this._dom=s,this._emptySubgraph={nodes:t.nodeList(),edges:t.edgeList()},this._textHiddenSet=new Po(this._graph,"textHidden"),this._layerController=new J2(this._graph)}_getLayerById(t){for(let e=0;e<this._layers.length;++e){const s=this._layers[e];if(s.id===t)return s.index=e,s}throw new Error("usage of a destroyed style rule or class")}setDefaultAttributes(t,e){this._layerController.setNodeDefaultAttributes(t),this._layerController.setEdgeDefaultAttributes(e)}getFlexArrays(){return this._layerController.getFlexArrays()}clear(){this._updateOngoing=!1,this._needUpdate=!1,this._destroyedLayers=[],this._layerController.clear(),this.updateAllForAllAttributeLayers()}redrawElements(t){t.size&&(this._layerController.redrawElements(t),this._dom.refresh())}redrawAll(){this._layerController.redrawAll(),this._dom.refresh()}_triggerUpdate(){this._needUpdate=!0,this._dom.refresh()}_reconstructAttributeLayersIfNecessary(){return!!this._layersNeedUpdate&&(this._reconstructAttributeLayers(),this._layersNeedUpdate=!1,this._dom.refresh(),!0)}getAnimationInformation(t){return this._layerController.getAnimationInformation(t)}update(){if(!this._needUpdate||this._updateOngoing||!this._ogma._token)return!1;this._reconstructAttributeLayersIfNecessary(),this._updateOngoing=!0,this._layerController.startUpdate();for(const t of this._destroyedLayers)t.initialized&&this._layerController.notifyDestroyed(t);for(const t of this._layers)this._layerController.prepareUpdate(t),typeof t.onBeforeUpdate=="function"&&t.onBeforeUpdate(t,this,this._layerController),this._layerController.onUpdate(t);return this._layerController.afterLayersUpdate(),this._updateOngoing=!1,this._needUpdate=!1,!0}setAttributeLayerValues(t,e,s,i){const n=this._getLayerById(t),r=e.isNode?n.nodes:n.edges;this._reconstructAttributeLayersIfNecessary(),this._layerController.setAttributeValues(r,e,s,i,n),this._updateElementsForAttributeLayers([n],e)}getAttributeLayerFlexArrays(t){const e=this._getLayerById(t);return{nodes:e.nodes.outputFlexArrays,edges:e.edges.outputFlexArrays}}getUsedAttributeLayerAttributes(t,e){const s=this._getLayerById(t);return this._layerController.getUsedAttributes(s,e)}getUpdatedElements(){return{elementsToRedraw:this._layerController.getAndResetElementsToRedraw(),elementsUpdated:this._layerController.getAndResetElementsUpdated()}}addAttributeLayer(t){const{name:e,layerFactory:s=K2}=t;if(!e)throw new Error("Attribute layer must have a name");if(e&&this._layers.find(n=>n.name===e))throw new Error(`attribute layer with name "${t.name}" already exists`);const i=this._layerController.createAttributeLayerData(e,++this._layerIdCounter,this._graph,t);return this._layers.push(i),this._updateLayer(i,t),s(this,this._layerIdCounter)}_reconstructAttributeLayers(){this._layers.sort((n,r)=>n.priority-r.priority);const{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:s,allEdgeAttributePaths:i}=this._layerController.getCurrentInput();for(const n of this._layers)this._layerController.initializeLayer(n,s,i);for(const n of this._layers){n.nodes.inputFlexArrays=Pe(t),n.edges.inputFlexArrays=Pe(e),n.depsNodeSelf=[],n.depsNodeAdjacentNodes=[],n.depsNodeAdjacentEdges=[],n.depsNodeAllNodes=[],n.depsNodeAllEdges=[],n.depsEdgeSelf=[],n.depsEdgeExtremities=[],n.depsEdgeParallelEdges=[],n.depsEdgeAllNodes=[],n.depsEdgeAllEdges=[],n.nodes.toUpdate.addAll(),n.edges.toUpdate.addAll(),this._layerController.connectLayerInputOutput(n,t,e);for(const r of this._layers)this._layerController.setupLayerDependencies(n,r)}this._layerController.setLastOutput(t,e);for(const n of this._layers)n.nodes.needAdjacentElements=n.nodes.redrawAdjacentEdges||n.depsNodeAdjacentNodes.length>0||n.depsNodeAdjacentEdges.length>0,n.edges.needAdjacentElements=n.depsEdgeExtremities.length>0||n.depsEdgeParallelEdges.length>0}_updateLayer(t,{priority:e,fullOverwrite:s,nodeAttributes:i,nodeSelector:n,nodeContext:r,nodeDependencies:o,nodeOutput:a,edgeAttributes:l,edgeSelector:d,edgeContext:h,edgeDependencies:u,edgeOutput:c}={}){i!==void 0&&(t.nodes.attributes=s?i:Ya(t.nodes.attributes,i)),n!==void 0&&(t.nodes.selector=n),r!==void 0&&(t.nodes.context=r),o!==void 0&&(t.nodes.dependencies=o),a!==void 0&&(t.nodes.output=a),l!==void 0&&(t.edges.attributes=s?l:Ya(t.edges.attributes,l)),d!==void 0&&(t.edges.selector=d),h!==void 0&&(t.edges.context=h),u!==void 0&&(t.edges.dependencies=u),c!==void 0&&(t.edges.output=c),e!==void 0&&(t.priority=e),this._triggerLayerUpdate()}_triggerLayerUpdate(){this._layersNeedUpdate=!0,this._triggerUpdate()}updateAllForAttributeLayer(t){const e=this._getLayerById(t);this._updateAllForAttributeLayer(e)}updateAllForAllAttributeLayers(){for(const t of this._layers)this._updateAllForAttributeLayer(t)}_updateAllForAttributeLayer(t,e=!0,s=!0){if(e&&!t.nodes.toUpdate.isFull()){t.nodes.toUpdate.addAll();for(const i of t.depsNodeSelf)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsNodeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}if(s&&!t.edges.toUpdate.isFull()){t.edges.toUpdate.addAll();for(const i of t.depsEdgeSelf)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeExtremities)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeParallelEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}this._triggerUpdate()}updateElementsForAttributeLayer(t,e){const s=this._getLayerById(t);this._updateElementsForAttributeLayers([s],e)}updateForAllAttributeLayers(t){this._updateElementsForAttributeLayers(this._layers,t)}_updateElementsForAttributeLayers(t,e){let s=this._emptySubgraph;if(e.isNode){for(const i of t)if(!i.nodes.toUpdate.isFull()){i.nodes.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.nodes.toUpdate.add(e);for(const n of i.depsNodeSelf)n.nodes.toUpdate.add(e);for(const n of i.depsNodeAdjacentNodes)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsNodeAdjacentEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsNodeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsNodeAllEdges)this._updateAllForAttributeLayer(n,!1,!0);i.nodes.redrawAdjacentEdges&&this._layerController.redrawElements(s.edges)}}else for(const i of t)if(!i.edges.toUpdate.isFull()){i.edges.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.edges.toUpdate.add(e);for(const n of i.depsEdgeSelf)n.edges.toUpdate.add(e);for(const n of i.depsEdgeExtremities)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsEdgeParallelEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsEdgeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsEdgeAllEdges)this._updateAllForAttributeLayer(n,!1,!0)}this._triggerUpdate()}destroyAttributeLayer(t){const e=this._getLayerById(t);this._destroyedLayers.push(e),this._layers.splice(e.index,1),this._triggerLayerUpdate()}updateAttributeLayer(t,e){const s=this._getLayerById(t);this._updateLayer(s,e)}getAttributeLayerDefinition(t){const e=this._getLayerById(t),{priority:s,nodes:i,edges:n}=e;return{priority:s,nodeAttributes:i.attributes,nodeSelector:i.selector,nodeContext:i.context,nodeDependencies:i.dependencies,nodeOutput:i.output,edgeAttributes:n.attributes,edgeSelector:n.selector,edgeContext:n.context,edgeDependencies:n.dependencies,edgeOutput:n.output}}getAttributeValues(t,e,s,i){return this.update(),this._layerController.getAttributeValues(t,e,s,i)}setAnimationAttributes(t,e){return this._layerController.setAnimationAttributes(t,e)}resetAnimationAttributes(t){return this._layerController.resetAnimationAttributes(t)}setTextHidden(t,e){const s=this._textHiddenSet.addOrRemoveElements(t,e);this.redrawElements(s)}resetTextHidden(){const{nodes:t,edges:e}=this._textHiddenSet.getElements();this._textHiddenSet.clear(),this._layerController.redrawElements(t),this._layerController.redrawElements(e)}getUsedNodeAttributes(){return this._layerController.nodes.getUsedAttributes()}getUsedEdgeAttributes(){return this._layerController.edges.getUsedAttributes()}interpolateAttributes(t){const e=ls(),s=this._ogma.modules.graphics.getAttributesManager(),i=this._layerController,n=t.isNode?s.getUsedNodeAttributes():s.getUsedEdgeAttributes(),{animationDuration:r,animationEasing:o,animationStart:a}=i.getFlexArrays().nodes.current,l=r.getMultiple(t._indexes),d=o.getMultiple(t._indexes),h=a.getMultiple(t._indexes),u=[];for(let c=0;c<t.size;c++){const g={};n.forEach(m=>{const _=typeof m=="string"?m:m.join("."),f=Me(i.getFlexArrays().nodes.previous,m),p=Me(i.getFlexArrays().nodes.current,m);if(!p)return;const x=Hy(e,h[c],l[c],d[c]);isNaN(x)?g[_]=p.get(t._indexes[c]):_.match(/color/gi)?g[_]=Br(f.get(t._indexes[c]),p.get(t._indexes[c]),x,x):g[_]=ue(f.get(t._indexes[c]),p.get(t._indexes[c]),x)}),u.push(g)}return u}},tI=1e-12;function zm(t){return((t=Math.exp(t))+1/t)/2}function eI(t){return((t=Math.exp(t))-1/t)/2}function sI(t){return((t=Math.exp(2*t))-1)/(t+1)}var iI=function t(e,s,i){function n(r,o){var a,l,d=r[0],h=r[1],u=r[2],c=o[0],g=o[1],m=o[2],_=c-d,f=g-h,p=_*_+f*f;if(p<tI)l=Math.log(m/u)/e,a=function(A){return[d+A*_,h+A*f,u*Math.exp(e*A*l)]};else{var x=Math.sqrt(p),y=(m*m-u*u+i*p)/(2*u*s*x),b=(m*m-u*u-i*p)/(2*m*s*x),v=Math.log(Math.sqrt(y*y+1)-y),E=Math.log(Math.sqrt(b*b+1)-b);l=(E-v)/e,a=function(A){var S=A*l,T=zm(v),L=u/(s*x)*(T*sI(e*S+v)-eI(v));return[d+L*_,h+L*f,u*T/zm(e*S+v)]}}return a.duration=1e3*l*e/Math.SQRT2,a}return n.rho=function(r){var o=Math.max(.001,+r),a=o*o;return t(o,a,a*a)},n}(Math.SQRT2,2,4),nI="cubicOut",rI=({graphWidth:t,graphHeight:e,viewWidth:s,viewHeight:i})=>.2*Math.min(s/t,i/e),oI=({smallestNodeSize:t,viewWidth:e,viewHeight:s})=>t===1/0?1/0:Math.min(e,s)/t*.5;function aI(t,e,s){return e===void 0?lI(t):e==="alt"?t.altKey:e==="shift"?t.shiftKey:e==="space"?s.isPressed("space"):void 0}function lI(t){return!t.altKey&&(IE?t.metaKey:t.ctrlKey)&&!t.shiftKey}var Xh=Math.SQRT2,Yh=.15,dI=class extends Bt{constructor(t,e){super(t),this._zooming=!1,this.debug=!1,this._smoothZoom=Cl((s,i,n)=>{const r=this._modules.settings,o=r.get("interactions.zoom.duration"),a=r.get("interactions.zoom.easing"),l=this._modules.camera.getZoom(),d={duration:o,easing:a};this._zooming||(this._zooming=!0,this._updateVisibility("zoom",!0));const h=r.get("interactions.zoom.speed")||Yh;let u=Dy(s,h);s<0&&u!==0&&(u=1/u);const c=l*u;this._modules.camera.setZoom(c,d,{x:i,y:n}).then(()=>{this._zooming&&(this._zooming=!1,this._updateVisibility("zoom",!1))})},$f),this.debug=e}onMounted(){const t=this._modules.settings;t.register("interactions.zoom.enabled",!0),t.register("interactions.zoom.onDoubleClick",!1),t.register("interactions.zoom.duration",150),t.register("interactions.zoom.modifier",Xh),t.register("interactions.zoom.speed",Yh),t.register("interactions.zoom.easing",nI),t.register("interactions.zoom.minValue",this.debug?null:rI),t.register("interactions.zoom.maxValue",this.debug?null:oI),t.register("interactions.zoom.hideNodes",!1),t.register("interactions.zoom.hideEdges",!1),t.register("interactions.zoom.hideNodeTexts",!1),t.register("interactions.zoom.hideEdgeTexts",!1),t.register("interactions.zoom.scrollToPan",!1),t.register("interactions.zoom.metaKey",void 0),t.register("interactions.pan.enabled",!0),t.register("interactions.pan.hideNodes",!1),t.register("interactions.pan.hideEdges",!1),t.register("interactions.pan.hideNodeTexts",!1),t.register("interactions.pan.hideEdgeTexts",!1),t.register("interactions.rotation.enabled",!0),t.register("interactions.rotation.hideNodes",!1),t.register("interactions.rotation.hideEdges",!1),t.register("interactions.rotation.hideNodeTexts",!1),t.register("interactions.rotation.hideEdgeTexts",!1),t.register("interactions.gesture.enabled",!0),t.register("interactions.gesture.hideNodes",!1),t.register("interactions.gesture.hideEdges",!1),t.register("interactions.gesture.hideNodeTexts",!1),t.register("interactions.gesture.hideEdgeTexts",!1),this._setupInteractions()}_setupInteractions(){this._modules.interactions.onMouseWheel({priority:"zoom",check:()=>!!this._modules.settings.get("interactions.zoom.enabled"),handler:({x:t,y:e,delta:s,dx:i,dy:n,domEvent:r})=>{const o=i%1!=0||n%1!=0,a=this._modules.settings;!a.get("interactions.zoom.scrollToPan")||aI(r,a.get("interactions.zoom.metaKey"),this._modules.keyboard)||o?this._smoothZoom(s,t,e):this._modules.camera.move({x:i,y:n})}}),this._modules.interactions.onDoubleClick({priority:"zoom",check:()=>{const t=this._modules.settings.get("interactions.zoom.enabled"),e=this._modules.settings.get("interactions.zoom.onDoubleClick");return!(!t||!e)},handler:({x:t,y:e})=>this._smoothZoom(1,t,e)}),this._modules.interactions.onDrag({priority:"panning",disableDetection:!0,check:({button:t})=>{const e=!!this._modules.settings.get("interactions.pan.enabled");return t==="left"&&e},onStart:()=>this._updateVisibility("pan",!0),onProgress:({dx:t,dy:e})=>this._modules.camera.move({x:-t,y:-e}),onStop:()=>this._updateVisibility("pan",!1)}),this._modules.interactions.onDrag({priority:"rotation",disableDetection:!0,check:({button:t,domEvent:e})=>(t==="right"||e&&e.buttons===2)&&!!this._modules.settings.get("interactions.rotation.enabled"),onStart:({x:t,y:e})=>{this._rotationStart={x:t,y:e},this._updateVisibility("rotation",!0)},onProgress:({x:t,y:e})=>this._rotate({x:t,y:e}),onStop:()=>this._updateVisibility("rotation",!1)}),this._modules.interactions.onGesture({priority:"gesture",disableDetection:!0,check:()=>!!this._modules.settings.get("interactions.gesture.enabled"),onStart:()=>this._updateVisibility("gesture",!0),onProgress:({dx:t,dy:e,rotation:s,scale:i,x:n,y:r})=>{this._modules.settings.get("interactions.rotation.enabled")&&this._modules.camera.rotate(-s),this._modules.camera.zoomIn({modifier:i},{x:n,y:r}),this._modules.camera.move({x:-t,y:-e})},onStop:()=>this._updateVisibility("gesture",!0)})}_rotate({x:t,y:e}){const{width:s,height:i}=this._modules.camera.getSize(),n=s/2,r=i/2,o=this._rotationStart.x-n,a=this._rotationStart.y-r,l=t-n,d=e-r,h=Math.atan2(a,o)-Math.atan2(d,l);this._rotationStart.x=t,this._rotationStart.y=e,this._modules.camera.rotate(h)}_updateVisibility(t,e){const s=!e,i=this._modules.settings,n=i.get(`interactions.${t}.hideNodes`),r=i.get(`interactions.${t}.hideEdges`),o=i.get(`interactions.${t}.hideNodeTexts`),a=i.get(`interactions.${t}.hideEdgeTexts`);n&&this._modules.graphics.setNodesVisibility(s),o&&this._modules.graphics.setNodeTextsVisibility(s),r&&this._modules.graphics.setEdgesVisibility(s),a&&this._modules.graphics.setEdgeTextsVisibility(s)}},Bm=1e-8,Um=1e8,Cd={duration:0,startAfter:0,ignoreZoomLimits:!1,callback:Kt,easing:"quadraticOut"};function fa(t){return Math.abs(t)<1e-9}var hI=80,uI=class L0 extends Bt{constructor(){super(...arguments),this._minZoom=Bm,this._maxZoom=Um,this._timeout=0}onMounted(){this._reset(),this._modules.settings.register("minZoom",Bm,e=>{this._minZoom=e,this._zoom<e&&(this._zoom=e,this._modules.events.fire("move"))}),this._modules.settings.register("maxZoom",Um,e=>{this._maxZoom=e,this._zoom>e&&(this._zoom=e,this._modules.events.fire("move"))}),this._modules.events.on("setContainer",()=>{this._reset(),this._modules.events.fire("move")}).on("resize",()=>{this._reloadDimensions(),this._modules.events.fire("move")})}get x(){return this._x}get y(){return this._y}get zoom(){return this._zoom}get angle(){return this._angle}get width(){return this._dimensions.width}get height(){return this._dimensions.height}moveEnd(e){this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>{this._modules.events.fire("viewChanged",{type:e})},hI)}getSize(){return{width:this._dimensions.width,height:this._dimensions.height}}getCenter(){return{x:this._x,y:this._y}}setCenter({x:e,y:s},i){const n=this._x,r=this._y,o=e-this._x,a=s-this._y;return fa(o)&&fa(a)?Promise.resolve():new Promise(l=>{this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const d=this._modules.animations.play(h=>{this._x=n+o*h,this._y=r+a*h,this._modules.events.fire("move").fire("pan")},$t(ct(ct({},Cd),i),{callback:()=>this.moveEnd("pan"),resolve:l}));d&&(this._moveAnimation=d)})}move({x:e,y:s},i){const n=Gm({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle);return this.setCenter({x:this._x+n.x,y:this._y+n.y},i)}getZoom(){return this._zoom}setZoom(e,s,i={x:void 0,y:void 0}){const{x:n,y:r}=i;let o=zs(e,this._minZoom,this._maxZoom);return s&&s.ignoreZoomLimits||(o=this._applyZoomLimits(o)),fa(this._zoom-o)?Promise.resolve():new Promise(a=>{const l=$t(ct(ct({},Cd),s),{callback:()=>this.moveEnd("zoom"),resolve:a}),d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._zoom,c=d/u-d/o;if(n!==void 0&&r!==void 0){const m=(n-d)/u-(n-d)/o,_=(r-h)/u-(r-h)/o,f=this._cosAngle,p=this._sinAngle,x=f*m-p*_,y=p*m+f*_;this.setCenter({x:this._x+x,y:this._y+y},s)}this._zoomAnimation&&this._modules.animations.cancel(this._zoomAnimation),this._modules.dom.afterNextFrame().then(()=>{this._modules.events.fire("zoomStart",{duration:l.duration,easing:l.easing,startZoom:u,endZoom:o})});const g=this._modules.animations.play(m=>{this._zoom=d/(d/u-c*m),this._modules.events.fire("move").fire("zoom")},l);g&&(this._zoomAnimation=g)})}_applyZoomLimits(e){const s=this._modules.settings.get("interactions.zoom.minValue"),i=this._modules.settings.get("interactions.zoom.maxValue"),{minScaledSize:n,maxScaledSize:r,width:o,height:a,cx:l}=this._modules.locate.getGraphBoundingBox(),d=this._zoom,h=this.getSize();let u=e;if(!isNaN(l)){const c={smallestNodeSize:n,biggestNodeSize:r,graphWidth:o+r,graphHeight:a+r,viewWidth:h.width,viewHeight:h.height},g=s&&s(c),m=i&&i(c);Vm(g)&&u<g?u<d&&(u=Math.min(d,g)):Vm(m)&&u>m&&u>d&&(u=Math.max(d,m))}return u}zoomIn(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||Xh:e.modifier,this.setZoom(this._zoom*i,e,s)}moveToBounds(e,s={}){const i=this._modules.locate.computeConfigForBounds(e,{ignoreZoomLimits:!0});return this.moveTo(i,s)}moveTo(e,s={}){const i=this.getZoom(),n=this.getCenter(),r=e.zoom||this._zoom;return s.duration===0?this.setView(e):new Promise(o=>{const a=Math.min(this.width,this.height),l=iI([n.x,n.y,a/i],[e.x,e.y,a/r]),d=l.duration,h=s.duration||d;this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const u=this._modules.animations.play(c=>{const[g,m,_]=l(c);this._x=g,this._y=m,this._zoom=a/_,this._modules.events.fire("move"),this._modules.events.fire("pan")},{duration:h,easing:s.easing,callback:()=>this.moveEnd("pan"),resolve:o});u&&(this._moveAnimation=u)})}zoomOut(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||Xh:e.modifier,this.setZoom(this._zoom/i,e,s)}getAngle(){return this._angle}setAngle(e,s){const i=this._angle,n=e-i;return fa(n)?Promise.resolve():new Promise(r=>{this._rotateAnimation&&this._modules.animations.cancel(this._rotateAnimation);const o=this._modules.animations.play(a=>{for(this._angle=i+n*a;this._angle>Math.PI;)this._angle-=2*Math.PI;for(;this._angle<-Math.PI;)this._angle+=2*Math.PI;this._sinAngle=Math.sin(this._angle),this._cosAngle=Math.cos(this._angle),this._modules.events.fire("move").fire("rotate")},$t(ct(ct({},Cd),s),{callback:()=>this.moveEnd("rotate"),resolve:r}));o&&(this._rotateAnimation=o)})}rotate(e,s){return this.setAngle(this._angle+e,s)}getScreenCenter(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}}graphToScreenCoordinates({x:e,y:s},i={x:0,y:0}){const n=this._dimensions.width/2,r=this._dimensions.height/2;return Xa((e-this._x)*this._zoom+n,(s-this._y)*this._zoom+r,n,r,-this._angle,i)}screenToGraphCoordinates({x:e,y:s},i={x:0,y:0}){return Xa(this._x+(e-this._dimensions.width/2)/this._zoom,this._y+(s-this._dimensions.height/2)/this._zoom,this._x,this._y,this._angle,i)}projectBounds(e,s=e){const[i,n,r,o]=e,a=this._x,l=this._y,d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._sinAngle,c=this._cosAngle,g=1/this._zoom;let m=1/0,_=1/0,f=-1/0,p=-1/0;const x=[i,n,i,o,r,o,r,n];for(let y=0;y<x.length;y+=2){let b=x[y],v=x[y+1];b=a+(b-d)*g,v=l+(v-h)*g;const E=b-a,A=v-l;b=c*E-u*A+a,v=u*E+c*A+l,b<m&&(m=b),b>f&&(f=b),v<_&&(_=v),v>p&&(p=v)}return s[0]=m,s[1]=_,s[2]=f,s[3]=p,s}screenToGraphVector({x:e,y:s}){return Gm({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle)}getView(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}}setView(e,s){const{x:i,y:n,zoom:r,angle:o}=ct({x:this._x,y:this._y,zoom:this._zoom,angle:this._angle},e);return Promise.all([this.setCenter({x:i,y:n},s),this.setZoom(r,s),this.setAngle(o,s)]).then(Kt)}_reloadDimensions(){this._dimensions=this._modules.dom.getDimensions()}animationInProgress(){const e=this._moveAnimation,s=this._zoomAnimation,i=this._rotateAnimation;return!!(e&&!e.done||s&&!s.done||i&&!i.done)}getProjectedScreenBounds(e=0){const{width:s,height:i}=this._dimensions,n=Math.max(s,i)*e;return this.projectBounds([0-n,0-n,s+n,i+n])}_reset(){this._zoom=1,this._x=0,this._y=0,this._angle=0,this._sinAngle=0,this._cosAngle=1,this._dimensions=this._modules.dom.getDimensions()}clone(e){const s=new L0(this._ogma);return s._zoom=e.zoom||this._zoom,s._x=e.x||this._x,s._y=e.y||this._y,s._angle=e.angle||this._angle,s._sinAngle=Math.sin(s._angle),s._cosAngle=Math.cos(s._angle),s._dimensions={width:e.width||this._dimensions.width,height:e.height||this._dimensions.height},s}};function Gm({x:t,y:e},s,i,n){return{x:n*(t/=s)-i*(e/=s),y:i*t+n*e}}function Vm(t){return typeof t=="number"&&isFinite(t)}function cI(t){const e=t.filter(s=>isFinite(s)&&s>0);return e.length?mi(e):1}var gI="anonymous",mI="white",_I="default",fI={maxBlockId:1024,maxCoord:-1/0,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1,maxSymbolicSize:0,maxPatternScale:0},pI=Il?"webgl":null,jm=5,yI=class extends Bt{constructor(){super(...arguments),this._debug=!1,this._initDone=!1,this._boundaries={maxSize:10,maxMinVisibleSize:64},this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0},this._nextAnimationId=1,this._animations=[],this._rendererState={type:null,code:null,state:"ok",message:""},this._cursorStyle=[],this._fontsNewlyLoaded=[],this._nextGeIndex=1,this._availableGeIndexes=[],this._renderOnNewFrame=!0,this._isBufferDisplayable=t=>{const e=Vw(t),s=Qy(t),i=e?this._visibility.nodes:this._visibility.edges,n=e?this._visibility.nodeTexts:this._visibility.edgeTexts;return i===0&&(!s||n===0)},this._onRendererChange=t=>{this._updateRendererState({type:t,state:"requested",code:null,message:void 0}),this._engine.setRenderType(t),this._modules.dom.refresh()},this._onNewFrame=()=>{this._processAnimations(),this._loadGraphInGraphicsEngine(),this._renderOnNewFrame&&this._render()},this._applyCursorStyle=()=>{const t=this._cursorStyle[this._cursorStyle.length-1]||this._modules.settings.get("cursor.default");Ka(this._domWrapper,t)},this._updateImageCrossOrigin=()=>{this._imageManager.setImgCrossOrigin(this._modules.settings.get("imgCrossOrigin")||null)}}onMounted(){this._debug=this._ogma.isDebug(),this._renderOnNewFrame=!0,this._formatText=Fy().applyArabicShaping,this._attributesManager=new Q2(this._ogma,this._modules),this._imageManager=new GT,this._fontManager=new kw,this._engine=new Ad(Ad.getCachedInitData()),this._domWrapper=this._engine.getDomWrapper(),this._engine.on("error",this._onNewFrame),this._nodeAnimationMap=new Map,this._edgeAnimationMap=new Map,this._movingNodes=new Set,this._movingEdges=new Set,this._modules.events.register(["reloadFonts","rendererStateChange","beforeUpdateAttributes","updateAttributes","animate","move","pan","zoom","rotate","viewExportStart","viewExportEnd","afterImageExport","viewChanged","zoomStart"]),this._modules.settings.register("renderer",pI,this._onRendererChange),this._modules.settings.register("edgeTipRatio",ly,t=>{this._engine.setEdgeArrowSizeRatio(t),this._modules.dom.refresh()}),this._modules.settings.register("edgeMinTipSize",dy,t=>{this._engine.setEdgeMinTipSize(t),this._modules.dom.refresh()}),this._modules.settings.register("backgroundColor",mI,t=>{this._engine.parseColor(t)?this._modules.dom.refresh():(Gi(`Invalid background color "${t}" specified; will default to black.`),this._modules.settings.set("backgroundColor","black"))}),this._modules.settings.register("texts.hideUntilFontsLoaded",!0,t=>{this._fontManager.setHideUntilFontsLoaded(!!t)}),this._modules.settings.register("texts.cornerRadius",jm,t=>{this._engine.getTextManager().setCornerRadius(typeof t=="number"?t:jm),this._modules.dom.refresh()}),this._modules.settings.register("imgCrossOrigin",gI,this._updateImageCrossOrigin),this._modules.settings.register("cursor.default",_I,this._applyCursorStyle),this._modules.dom.setLayer("graphics",this._domWrapper),this._engine.setGlobalBoundaries(fI),this._modules.dom.beforeNextFrame().then(()=>{this._initDone=!0,this._fireRendererStateChangeEvent()}),this._imageManager.onFetch(()=>{this._engine.notifyPatternUpdate(),this._modules.dom.refresh()}),this._fontManager.onFontLoaded(t=>{this._fontsNewlyLoaded.push(t),this._engine.notifyPatternUpdate(),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}),this._modules.dom.addMediaListener("(min-resolution: 2dppx)",()=>this._modules.dom.refresh()),this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${yh})`,tag:yh,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${xh})`,tag:xh,nodeDependencies:void 0,edgeDependencies:void 0}),Lm(this._engine,this._attributesManager.getFlexArrays()),this._modules.events.on("move",()=>this._modules.dom.refresh()).on("frame",this._onNewFrame).on("viewExportStart",()=>{this._renderOnNewFrame=!1}).on("viewExportEnd",()=>{this._renderOnNewFrame=!0}).on("clearGraph",()=>{this._nextGeIndex=1,this._availableGeIndexes=[],this._engine.clear(),this._attributesManager.clear(),this._modules.dom.refresh(),this._animations=[],this._nodeAnimationMap.clear(),this._edgeAnimationMap.clear()}).on("viewChanged",({type:t})=>{if(t==="rotate"){const e=this._modules.graph.getEdges().filter(s=>s.getAttribute("adjustAnchors"));this._attributesManager.redrawElements(e)}}).on("addNodes",t=>{this._attributesManager.updateForAllAttributeLayers(t.nodes)}).on("addEdges",t=>{this._attributesManager.updateForAllAttributeLayers(t.edges)}).on("excludedStateChange",t=>{this._visibleAttributeLayer.updateElements(t.elements)}).on("setData",t=>{this._dataAttributeLayer.updateElements(t.elements)}),Ad.clearCachedInitData(),this._modules.dom.addWindowEventListener("unload",()=>this.destroy())}onReady(t){t.renderer!==void 0&&this._ogma.setOptions({renderer:t.renderer}),t.imgCrossOrigin!==void 0&&this._ogma.setOptions({imgCrossOrigin:t.imgCrossOrigin})}getTransparentBackgroundColor(){const t=this._modules.settings.get("backgroundColor");return t?this._engine.transparentify(t):null}_render(){const t=this._modules.dom.getDimensions(),e=this._modules.camera.getView(),s=Ss(),i=ls(),n=this._modules.settings.get("backgroundColor"),r=this._isBufferDisplayable;this._engine.setView({x:e.x,y:e.y,zoom:e.zoom,angle:e.angle,width:t.width,height:t.height,pixelRatio:s,currentTime:i,backgroundColor:n,isBufferDisplayable:r});try{this._engine.render(),this._rendererState.state==="requested"&&this._updateRendererState({state:"ok"})}catch(o){if(this._debug)throw o;const{message:a,code:l="OTHER"}=o,d=this._rendererState.type,h=DS(d);let u=this._rendererState.state==="requested"?`Error while initializing the ${h} renderer`:`The ${h} renderer encountered an unexpected runtime error`,c=null;d==="webgl"&&(u+="; fallbacking on canvas renderer",c="canvas"),Gi(a||""),Gi(u),this._updateRendererState({state:"error",code:l,message:a}),this._modules.settings.set("renderer",c)}}_fireRendererStateChangeEvent(){const t=this._rendererState;this._modules.events.fire("rendererStateChange",{type:t.type,state:t.state,code:t.code,message:t.message})}_updateRendererState({type:t,state:e,code:s,message:i}){let n=!1;t!==void 0&&this._rendererState.type!==t&&(this._rendererState.type=t,n=!0),e!==void 0&&this._rendererState.state!==e&&(this._rendererState.state=e,n=!0),s!==void 0&&this._rendererState.code!==s&&(this._rendererState.code=s,n=!0),i!==void 0&&this._rendererState.message!==i&&(this._rendererState.message=i,n=!0),n&&this._initDone&&this._fireRendererStateChangeEvent()}getImageData(){return this._modules.dom.afterNextFrame().then(()=>this._engine.getImageData())}getNodeAttributes(){return this._attributesManager.getFlexArrays().nodes.current}getEdgeAttributes(){return this._attributesManager.getFlexArrays().edges.current}getGraphicsEngine(){return this._engine}getImageManager(){return this._imageManager}getFontManager(){return this._fontManager}allocateGraphicsEngineBlockId(){return this._availableGeIndexes.length?this._availableGeIndexes.pop():this._nextGeIndex++*Gl+K1}releaseGraphicsEngineBlockId(t){this._engine.freeBlock(t),this._availableGeIndexes.push(t),this._modules.dom.refresh()}addCursorStyle(t){t&&(this._cursorStyle.push(t),this._applyCursorStyle())}removeCursorStyle(t){if(!t)return;const e=this._cursorStyle.lastIndexOf(t);e!==-1&&(this._cursorStyle.splice(e,1),this._applyCursorStyle())}reloadFonts(){this._modules.events.fire("reloadFonts"),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}getDomElement(){return this._domWrapper}setTextHidden(t,e){this._attributesManager.setTextHidden(t,e)}resetTextHidden(){this._attributesManager.resetTextHidden(),this._modules.dom.refresh()}getAttributesManager(){return this._attributesManager}_checkFontsNewlyLoaded(){return!!this._fontsNewlyLoaded.length&&(this._fontsNewlyLoaded=[],!0)}_loadGraphInGraphicsEngine(){this._attributesManager.update(),this._checkFontsNewlyLoaded()&&this._attributesManager.redrawAll(),this._modules.events.fire("beforeUpdateAttributes");const{elementsToRedraw:t,elementsUpdated:e}=this._attributesManager.getUpdatedElements(),s=e.nodes.size>0||e.edges.size>0;(e.nodeAttributesSet.has("radius")||e.edgeAttributes.includes("width"))&&(this._boundaries.maxSize=kS(this._modules.graph)),(e.nodeAttributesSet.has("shape")||e.edgeAttributes.includes("shape.head")||e.edgeAttributes.includes("shape.tail"))&&Lm(this._engine,this._attributesManager.getFlexArrays()),TT({graph:this._modules.graph,elements:t,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._modules.camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText}),s&&this._modules.events.fire("updateAttributes",e)}_forceCompleteGraphRefresh(){this._attributesManager.redrawAll(),this._loadGraphInGraphicsEngine()}export(t,e,s,i){let n;return Promise.all([this._modules.graph.getNodes().addClass(ln),this._modules.graph.getEdges().addClass(ln)]).then(()=>this.resolveAtNextFrame()).then(()=>this._imageManager.whenReady()).then(()=>{s==="all"?(n=vI(this._modules.graph),this._forceCompleteGraphRefresh()):this._loadGraphInGraphicsEngine();const r=this._modules.camera.clone(ct({},e));return this._modules.events.fire("viewExportStart",{preventOverlap:i.preventOverlap,camera:r,view:r.getView()}),this._ogma.view.afterNextFrame().then(()=>this._engine.export(t,e,i))}).then(r=>Promise.all([this._modules.graph.getNodes().removeClass(ln),this._modules.graph.getEdges().removeClass(ln)]).then(()=>r)).then(r=>(s==="all"&&(EI(n),this._forceCompleteGraphRefresh()),this._modules.events.fire("viewExportEnd"),r))}addAttributeLayer(t){return this._attributesManager.addAttributeLayer(t)}getAttributeValues(t,e,s,i){return this._attributesManager.getAttributeValues(t,e,s,i)}forceAttributesComputation(){this._attributesManager.update()}resolveAtNextFrame(t){return this._modules.dom.afterNextFrame().then(()=>t)}isMoving(t){return(t.isNode?this._movingNodes:this._movingEdges).has(t._index)}animate(t,e,s,i){const n=xI(i);return n.duration&&this._engine.ensureAnimationsReady(),this._animate(t,e,s,n)}isAnimating(){return this._animations.length>0}getAnimationInformation(t){return this._attributesManager.getAnimationInformation(t)}_toSubGraph(t){if(t instanceof Si||t instanceof ni)return{nodes:t.toList(),edges:t.getAdjacentEdges()};if(t instanceof Tn||t instanceof Hi)return{nodes:this._modules.graph.nodeList(),edges:t.toList()};const e=t,s={nodes:e.nodes||this._modules.graph.nodeList(),edges:e.edges||this._modules.graph.edgeList()};return s.nodes.size&&(s.edges.size?s.edges=s.edges.concat(s.nodes.getAdjacentEdges()).dedupe():s.edges=s.nodes.getAdjacentEdges()),s}_animate(t,e,s,{duration:i,easing:n}){if((!this._animations.length||s)&&!i)return e(t),Promise.resolve(t);const r=this._toSubGraph(t),o=r.nodes,a=r.edges;if(o.size===0&&a.size===0)return e(t),Promise.resolve(t);if(o.size){if(s)for(let c=0;c<o._indexes.length;c++)this._movingNodes.add(o._indexes[c]);this._modules.events.fire("animate",{elements:o,duration:i,updatesPositions:s,easing:n})}if(a.size){if(s)for(let c=0;c<a._indexes.length;c++)this._movingEdges.add(a._indexes[c]);this._modules.events.fire("animate",{elements:a,duration:i,updatesPositions:s,easing:n})}const l={id:this._nextAnimationId++,startTime:ls(),finished:!1,func:()=>e(t),duration:i,easing:n,nodes:o,edges:a,started:!1,updatesPositions:s,resolve:Kt};let d=l;const h=new Set;if(d=this._getLongestAnimation(d,l.nodes,h),d=this._getLongestAnimation(d,l.edges,h),d.updatesPositions){for(let c=0;c<o._indexes.length;c++)this._nodeAnimationMap.set(o._indexes[c],d);for(let c=0;c<a._indexes.length;c++)this._edgeAnimationMap.set(a._indexes[c],d);l.duration=d.duration,l.startTime=d.startTime}if(l.duration===0&&d.id===l.id)return e(t),Promise.resolve(t);const u=new Promise(c=>l.resolve=()=>c(t));return this._animations.push(l),this._modules.dom.refresh(),i||this._processAnimations(),u}_removeFinishedAnimations(){this._animations=this._animations.filter(t=>!t.finished)}_getAnimationElements(t){return{nodes:t.nodes,edges:t.edges}}_resetAnimationAttributes({nodes:t,edges:e}){this._attributesManager.resetAnimationAttributes({nodes:t,edges:e});for(let s=0;s<t._indexes.length;s++)this._nodeAnimationMap.delete(t._indexes[s]),this._movingNodes.delete(t._indexes[s]);for(let s=0;s<e._indexes.length;s++)this._edgeAnimationMap.delete(e._indexes[s]),this._movingEdges.delete(t._indexes[s])}_getLongestAnimation(t,e,s){const i=e.isNode?this._nodeAnimationMap:this._edgeAnimationMap;for(let n=0;n<e._indexes.length;n++){const r=i.get(e._indexes[n]);r&&!s.has(r.id)&&(s.add(r.id),(t.updatesPositions||!r.updatesPositions)&&r.duration+r.startTime<t.duration+t.startTime||(t=r))}return t}_processAnimations(){if(!this._animations.length)return;const t=ls(),e=[];this._attributesManager.update();for(const s of this._animations)s.started||(s.started=!0,e.push(s.func),this._attributesManager.setAnimationAttributes(this._getAnimationElements(s),s));for(const s of e)s();for(const s of this._animations)t>=s.startTime+s.duration&&(this._resetAnimationAttributes(this._getAnimationElements(s)),s.resolve(s.elements),s.finished=!0);this._removeFinishedAnimations(),this._animations.length&&this._modules.dom.refresh()}hideTexts(){this.setNodeTextsVisibility(!1),this.setEdgeTextsVisibility(!1)}showTexts(){this.setNodeTextsVisibility(!0),this.setEdgeTextsVisibility(!0)}setNodesVisibility(t){return this._updateVisibilityCounter("nodes",t)}setNodeTextsVisibility(t){return this._updateVisibilityCounter("nodeTexts",t)}setEdgesVisibility(t){return this._updateVisibilityCounter("edges",t)}setEdgeTextsVisibility(t){return this._updateVisibilityCounter("edgeTexts",t)}_updateVisibilityCounter(t,e){this._visibility[t]+=e?-1:1,this._modules.dom.refresh()}detectNode(t,e,s,i,n,r){return PS(t,e,s,i,n,r,this._modules.graph,this._attributesManager,this._modules.camera,this._engine,this._movingNodes,this._formatText)}detectEdge(t,e,s,i,n){return FS(t,e,s,i,n,this._modules.graph,this._modules.camera,this._movingNodes,this._attributesManager)}getVisibilityCounters(){return this._visibility}destroy(){this.getGraphicsEngine().destroy(),this.getImageManager().destroy(),this.getFontManager().destroy()}};function xI(t){return typeof t=="number"?t={duration:t}:typeof t=="object"&&t!==null||(t={duration:0}),{duration:bI(t.duration),easing:t.easing||"linear",chain:!!t.chain}}function bI(t){return typeof t!="number"||!isFinite(t)||t<0?0:t}function Hm(t,e){const s=e?t.getNodeAttribute("excluded"):t.getEdgeAttribute("excluded"),i=(e?t.getNodes("all"):t.getEdges("all"))._indexes,n=s.getMultiple(i);return s.fill(i,0),{excludedList:s,indexes:i,values:n}}function Wm({excludedList:t,indexes:e,values:s}){t.setMultiple(e,s)}function vI(t){return{nodes:Hm(t,!0),edges:Hm(t,!1)}}function EI({nodes:t,edges:e}){Wm(t),Wm(e)}var AI=250,SI=50,wI=class extends Bt{constructor(){super(...arguments),this._onAnyEvents=[],this._registeredEvents={},this.onIdle=Cl(()=>this.fire("idle"),SI)}onMounted(){this._registeredEvents={},this.register(["idle"]),this._ogma.onReady(()=>{this.on(["viewChanged","layoutEnd","addNodes","addEdges","removeNodes","removeEdges","animate","setMultipleAttributes","transformationRefresh"],()=>{this._modules.dom.clearTimeout(this._idleTimeout),this._idleTimeout=this._modules.dom.setTimeout(this.onIdle,AI)})})}isRegistered(t){return!!this._registeredEvents[t]}register(t,e=[]){t.forEach(s=>{if(this._registeredEvents[s])throw new Error(`event "${s}" already exists`);this._registeredEvents[s]=new TI(!1,s)})}onAnyEvent(t){this._onAnyEvents.push(t)}on(t,e){return Array.isArray(t)?(t.forEach(s=>this.on(s,e)),this):this._registeredEvents[t]?(this._registeredEvents[t].on(e),this):this}off(t){return Object.values(this._registeredEvents).forEach(e=>{e.off(t)}),this}fire(t,e=null){const s=this._getEvent(t);return this._onAnyEvents.forEach(i=>i(e,t)),s.trigger(e),this}once(t,e){const s=this,i=function(){e.apply(null,arguments),s.off(i)};return this.on(t,i)}_getEvent(t){if(!(t in this._registeredEvents))throw new Error(`Event ${t} does not exist`);return this._registeredEvents[t]}destroy(){Object.values(this._registeredEvents).forEach(t=>{t.destroy()})}},TI=class{constructor(t,e){this._subscribers=[],this._handlers=[],this._reverseOrder=t,this._name=e}trigger(t){for(const e of this._handlers)e(t,this._name);return this}on(t){if(typeof t!="function")throw new Error("handler is not a function");const e=this._reverseOrder?0:this._subscribers.length;return this._handlers.splice(e,0,t),this._subscribers.splice(e,0,t),this}off(t){let e;for(;(e=this._subscribers.indexOf(t))!==-1;)this._subscribers.splice(e,1),this._handlers.splice(e,1);return this}destroy(){this._subscribers=[],this._handlers=[]}},II=class extends Bt{onMounted(){this._graphics=this._modules.graphics,this._modules.events.register(["setMultipleAttributes"]),this._modules.events.on(["addNodes","addEdges"],({nodes:t,edges:e,objects:s})=>{this._onAddElements(t||e,s)}),this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:m1,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:p1,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0})}_onAddElements(t,e){const s=e.map(i=>i.attributes);this._originalAttributesLayer.setAttributeValues(t,s)}getOriginalAttributes(){return this._originalAttributesLayer.getFlexArrays()}getIndividualAttributes(){return this._individualAttributesLayer.getFlexArrays()}setMultipleAttributes(t,e,s){const i=Array.isArray(e)?e.length&&e[0]?fl(e[0],t.isNode):[]:fl(e,t.isNode),n=i.includes("x")||i.includes("y"),r=[];return this._modules.events.fire("setMultipleAttributes",{elements:t,values:e,updatedAttributes:i,options:s,promises:r}),this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,e)},n,s).then(o=>Promise.all(r).then(()=>o))}setSingleAttribute(t,e,s,i){const n={};return yi(n,e,s),this.setMultipleAttributes(t,n,i)}resetMultipleAttributes(t,e,s){const i=e||this._individualAttributesLayer.getUsedAttributeNames(t),n=i&&(i.includes("x")||i.includes("y")),r={};for(const o of i)yi(r,o,void 0);return this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,r)},n,s)}getMultipleAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!1)}getSingleAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!1)}replaceOriginalAttributes(t,e,s=[]){const i={},n=this._originalAttributesLayer.getUsedAttributeNames(t).filter(r=>!s.includes(r));for(let r=0;r<n.length;++r)yi(i,n[r],void 0);this._originalAttributesLayer.setAttributeValues(t,i),this._originalAttributesLayer.setAttributeValues(t,e)}getSinglePreviousAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!0)}getMultiplePreviousAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!0)}},LI=class extends Bt{constructor(){super(...arguments),this._currentValue={},this._onChange={},this._defaultValues={},this._keys=[]}onReady(t){t.renderer&&this.update({renderer:t.renderer}),t.options&&this.update(t.options)}register(t,e,s,i){return i===void 0&&(i=!0),this._keys.push(t),this._currentValue[t]=e,this._defaultValues[t]=e,this._onChange[t]=s||Kt,s&&i&&s(e),this}update(t){t=lo(t);const e=this._keys,s={},i=this._currentValue;for(let r=0;r<e.length;++r){const o=e[r];if(o in t){let a=t[o];a===void 0&&(a=this._defaultValues[o]),s[o]=i[o],i[o]=a}}const n=Object.keys(s);for(let r=0;r<n.length;++r){const o=n[r],a=this._currentValue[o],l=s[o];a!==l&&this._onChange[o](a,l)}return sh(s)}get(t){return arguments.length===0?sh(this._currentValue):this._currentValue[t]}set(t,e){const s=this._currentValue[t],i=this._onChange[t];this._currentValue[t]=e,i&&i(e,s)}},CI=class{constructor(t,e){this._classes=t,this._name=e}getName(){return this._name}getIndex(){return this._classes.getIndex(this._name)}setIndex(t){return this._classes.setIndex(this._name,t)}update(t){return this._classes.update(this._name,t),this}getDefinition(){return this._classes.getDefinition(this._name)}getNodes(t){return this._classes.getElementsByClass(this._name,t).nodes}getEdges(t){return this._classes.getElementsByClass(this._name,t).edges}clearNodes(t){this.getNodes(t).removeClass(this._name)}clearEdges(t){this.getEdges(t).removeClass(this._name)}add(t){t.addClass(this._name)}remove(t){t.removeClass(this._name)}destroy(){const t=this._classes.getElementsByClass(this._name);return Promise.all([t.nodes.removeClass(this._name),t.edges.removeClass(this._name)]).then(()=>this._classes.removeClass(this._name))}},MI=1e3,NI=.5/MI,PI=class extends Bt{constructor(){super(...arguments),this._builtinClasses=[],this._userClasses=[],this._classesByName={},this._onExcludedStateChange=({elements:t,value:e})=>{if(e){const s=this._builtinClasses.map(i=>i.name);this._addOrRemoveClassesToElements(s,t,!1)}},this._onClearGraph=()=>{this._builtinClasses.concat(this._userClasses).forEach(t=>t.elementSet.clear())},this._onRemoveElements=({nodes:t,edges:e})=>{const s=t||e;this._builtinClasses.concat(this._userClasses).forEach(i=>i.elementSet.removeElements(s))}}onMounted(){this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on("clearGraph",this._onClearGraph).on("removeEdges",this._onRemoveElements).on("removeNodes",this._onRemoveElements)}_getClassList(t){return t?this._builtinClasses:this._userClasses}createClass({name:t,isBuiltin:e=!1,after:s,nodeAttributes:i,nodeDependencies:n,nodeOutput:r,edgeAttributes:o,edgeDependencies:a,edgeOutput:l}={}){if(typeof t!="string")throw new Error('the "name" argument should be a string');const d=this._getClassList(e),h=s?FI(d,s)+1:d.length;if(h===-1)throw new Error(`createClass: class specified as \`after\` parameter "${s}" does not exist`);if(e&&!t.startsWith("_"))throw new Error(`invalid builtin class name "${t}": builtin classes should start with '_'`);const u=new Po(this._modules.graph),c=new CI(this,t),g={name:t,elementSet:u,attributeLayer:this._modules.graphics.addAttributeLayer({name:`class(${t})`,tag:t,standaloneSelectors:!0,nodeAttributes:i||void 0,edgeAttributes:o||void 0,nodeSelector:(m,_)=>_.hasElement(m),edgeSelector:(m,_)=>_.hasElement(m),nodeContext:u,edgeContext:u,nodeOutput:r,edgeOutput:l,nodeDependencies:n,edgeDependencies:a}),isBuiltin:e,wrapper:c};return d.splice(h,0,g),e&&d.sort((m,_)=>Ng.indexOf(m.name)-Ng.indexOf(_.name)),this._updatePriorities(e),this._classesByName[t]=g,this._modules.events.register([Dn(t,!0,!0),Dn(t,!0,!1),Dn(t,!1,!0),Dn(t,!1,!1)]),c}removeClass(t){const e=this._get(t),s=this._getClassList(e.isBuiltin),i=s.indexOf(e);if(i===-1)throw new Error(`class "${t}" does not exist`);return s.splice(i,1),e.attributeLayer.destroy(),delete this._classesByName[t],this._updatePriorities(e.isBuiltin),Promise.resolve(void 0)}_updatePriorities(t){const e=this._getClassList(t),s=y1+(t?.5:0);for(let i=0;i<e.length;++i){const n=e[i],r=s+NI*i;n.attributeLayer.update({priority:r})}}_get(t){const e=this._classesByName[t];if(!e)throw new Error(`class "${t}" does not exist`);return e}getIndex(t){const e=this._get(t);return this._getClassList(e.isBuiltin).indexOf(e)}setIndex(t,e){const s=this._get(t),i=this._getClassList(s.isBuiltin),n=i.indexOf(s),r=zs(e,0,i.length-1);i.splice(n,1),i.splice(r,0,s),this._updatePriorities(s.isBuiltin)}update(t,{nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a}={}){this._get(t).attributeLayer.update({nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a})}getDefinition(t){const e=this._get(t),{nodeAttributes:s,nodeDependencies:i,nodeOutput:n,edgeAttributes:r,edgeDependencies:o,edgeOutput:a}=e.attributeLayer.getDefinition();return{nodeAttributes:s||void 0,edgeAttributes:r||void 0,nodeDependencies:i,edgeDependencies:o,nodeOutput:n,edgeOutput:a}}_addOrRemoveClassesToElements(t,e,s){const i=e.isNode;for(let n=0;n<t.length;++n){const r=t[n],{elementSet:o,attributeLayer:a}=this._get(r),l=o.addOrRemoveElements(e,s),d=Dn(r,i,s);l.size&&(a.updateElements(l),this._modules.events.fire(d,i?{nodes:l}:{edges:l}))}}_animatedAttributesUpdatePositions(t,e){for(let s=0;s<t.length;++s){const i=t[s],n=this.getDefinition(i);if(e.isNode&&n.nodeAttributes&&(n.nodeAttributes.x||n.nodeAttributes.y))return!0}return!1}_getAnimatedAtrributes(t,e){return t.reduce((s,i)=>{const n=this.getDefinition(i);return e.isNode&&n.nodeAttributes&&s.push(...fl(n.nodeAttributes,!0)),!e.isNode&&n.edgeAttributes&&s.push(...fl(n.edgeAttributes,!1)),s},[])}addClassesToElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!0)},n,s)}removeClassesFromElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!1)},n,s)}hasSingleElementClass(t,e){return this._get(t).elementSet.hasElement(e)}getElementsClassList(t,e={}){const{includeBuiltinClasses:s=!1}=e,i=new Array(t.size);for(let n=0;n<i.length;++n)i[n]=[];return this._addClassNamesToList(i,t,this._userClasses),s&&this._addClassNamesToList(i,t,this._builtinClasses),i}_addClassNamesToList(t,e,s){const i=e.toList();for(let n=0;n<s.length;++n){const{name:r,elementSet:o}=s[n];for(let a=0;a<i.size;++a){const l=i.get(a);o.hasElement(l)&&t[a].push(r)}}}getClassByName(t,e=!1){const s=this._classesByName[t]||null;if(e&&!s)throw new Error(`class "${t}" does not exist`);return s&&s.wrapper}getClassList(){return this._userClasses.map(t=>t.wrapper)}getElementsByClass(t,e="visible"){const{elementSet:s}=this._get(t),i=s.getElements();let n=i.nodes,r=i.edges;return e==="visible"?(n=n.filter(o=>o.isVisible()),r=r.filter(o=>o.isVisible())):e==="raw"&&(n=n.filter(o=>!o.isVirtual()),r=r.filter(o=>!o.isVirtual())),{nodes:n,edges:r}}_onClassEvent(t,e,s,i){const n=Dn(t,s,i);this._modules.events.on(n,e)}onNodeClassAdded(t,e){this._onClassEvent(t,e,!0,!0)}onNodeClassRemoved(t,e){this._onClassEvent(t,e,!0,!1)}onEdgeClassAdded(t,e){this._onClassEvent(t,e,!1,!0)}onEdgeClassRemoved(t,e){this._onClassEvent(t,e,!1,!1)}};function Dn(t,e,s){return`${e?"node":"edge"}Class${s?"Added":"Removed"}_${t}`}function FI(t,e){for(let s=0;s<t.length;++s)if(t[s].name===e)return s;return-1}var C0=()=>({x:0,y:0,x1:0,y1:0,x2:0,y2:0});function Xm(t,e,s,{cells:i=!0,boxes:n=!0,query:r=!0}={}){const o=e.keys().map(l=>e.keyToBBox(Number(l))),a=e.getBoxes();if(i&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#707070",o.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.stroke()),n&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#ff7070",a.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.closePath(),t.stroke()),r&&s){const l=s;t.beginPath(),t.lineWidth=2,t.strokeStyle="#3030ff",t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1]),t.closePath(),t.stroke()}}function kI(t){const[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o]=t.getEdgeAttributes(["source","target","curvature"]),a=C0(),l=tc();return d=>{if(d<0){d=-d;const h=n.get(d),u=r.get(d),c=o.get(d),g=e.get(h),m=s.get(h),_=e.get(u),f=s.get(u);h===u?(Vl(g,m,c,i.get(h),0,a),Hl(g,m,a.x1,a.y1,a.x2,a.y2,_,f,l)):c===0?(l.minX=Math.min(g,_),l.minY=Math.min(m,f),l.maxX=Math.max(g,_),l.maxY=Math.max(m,f)):(In(g,m,_,f,c,a),sc(g,m,a.x,a.y,_,f,l))}else{const h=e.get(d),u=s.get(d),c=i.get(d);l.minX=h-c,l.minY=u-c,l.maxX=h+c,l.maxY=u+c}return[l.minX,l.minY,l.maxX,l.maxY]}}var DI=["x","y","radius"],RI=["width","curvature"],OI=.5,zI=class extends Bt{constructor(){super(...arguments),this._minCellSize=8,this._clear=()=>{this._index.clear(),this._elementsToUpdate.clear()},this._onGraphUpdate=t=>{if(t.nodes&&(!t.nodeAttributes||t.nodeAttributes.some(e=>DI.includes(e)))){const e=t.nodes.fastGetAdjacentElements().edges;this._elementsToUpdate.addElements(t.nodes),this._elementsToUpdate.addElements(e)}t.edges&&(t.edgeAttributes&&!t.edgeAttributes.some(e=>RI.includes(e))||this._elementsToUpdate.addElements(t.edges))}}onMounted(){this._index=new Wv(this._getIntersector(),kI(this._modules.graph),this._minCellSize,1e6),this._elementsToUpdate=new Po(this._modules.graph),this._removedNodes=this._modules.graph.getNodeAttribute("removed"),this._removedEdges=this._modules.graph.getEdgeAttribute("removed"),this._excludedNodes=this._modules.graph.getNodeAttribute("excluded"),this._excludedEdges=this._modules.graph.getEdgeAttribute("excluded"),this._queryResult={edges:[],nodes:[]},this._queryBounds=[0,0,0,0],this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges","updateAttributes"],this._onGraphUpdate).on("excludedStateChange",({elements:t})=>{this._elementsToUpdate.addElements(t)}).on("clearGraph",this._clear)}_getIntersector(){const t=this._modules.graph,[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o,a]=t.getEdgeAttributes(["source","target","width","curvature"]),l=C0();return(d,h,u,c,g)=>{if(d<0){d=-d;const m=n.get(d),_=r.get(d),f=a.get(d),p=o.get(d)/2,x=e.get(m),y=s.get(m),b=e.get(_),v=s.get(_);return m===_?(Vl(x,y,f,i.get(m),0,l),Df(x,y,l.x1,l.y1,l.x2,l.y2,b,v,h-p,u-p,c+p,g+p)):f===0?ic(x,y,b,v,h-p,u-p,c+p,g+p):(In(x,y,b,v,f,l),kf(x,y,l.x,l.y,b,v,h-p,u-p,c+p,g+p))}return Lu(e.get(d),s.get(d),i.get(d),h,u,c,g)}}reindex(){this._modules.graphics.forceAttributesComputation(),this._index.clear(),this._elementsToUpdate.clear(),this._updateItems(this._modules.graph.getNodes("all")._indexes,this._modules.graph.getEdges("all")._indexes)}getSize(){return this._index.size}_updateIndex(){if(!this._elementsToUpdate.isEmpty()){const{nodes:t,edges:e}=this._elementsToUpdate.getElements();if(t._indexes.length/this._modules.graph.getNodes("all").size>OI)return void this.reindex();this._updateItems(t._indexes,e._indexes),this._elementsToUpdate.clear()}}_updateItems(t,e){const s=this._index,i=this._removedNodes,n=this._removedEdges,r=this._excludedNodes,o=this._excludedEdges,a=[],l=[];if(i&&r)for(let d=0;d<t.length;d++){const h=t[d];i.get(h)!==0||r.get(h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}if(n&&o)for(let d=0;d<e.length;d++){const h=-e[d];n.get(-h)!==0||o.get(-h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}for(const d of a)s.remove(d);for(const d of l)s.insert(d)}getNodesInScreenByDistance(t){const{x:e,y:s}=t.getPositionOnScreen();return this._modules.graph.getNodes().filter(i=>i.isInScreen()&&i!==t).sort((i,n)=>{const r=i.getPositionOnScreen(),o=n.getPositionOnScreen();return je(r.x,r.y,e,s)-je(o.x,o.y,e,s)})}getNearestNodesForNode(t,e=240,s){const{x:i,y:n}=t.getPosition();return this.getNearestNodes(i,n,e,s,t)}getNearestNodes(t,e,s,i,n){if(this._updateIndex(),i){const r=this._modules.camera.screenToGraphVector({x:s,y:s});s=je(0,0,r.x,r.y)}return this._getNearestNodes(t,e,s,n)}_getNearestNodes(t,e,s,i){const n=[],r=s*s,o=i?i._index:0,a=this._modules.graph.getNodes()._indexes,[l,d]=this._modules.graph.getNodeAttributes(["x","y"]);for(let h=0,u=a.length;h<u;h++){const c=a[h];if(c===o)continue;const g=t-l.get(c),m=e-d.get(c);g*g+m*m<=r&&n.push(c)}return this._modules.graph.nodeList(new Uint32Array(n))}queryRaw(t,e,s,i){this._updateIndex();const n=this._queryBounds;n[0]=t,n[1]=e,n[2]=s,n[3]=i;const r=this._index.query(t,e,s,i),{nodes:o,edges:a}=this._queryResult;o.length=a.length=0;for(let l=0;l<r.length;l++){const d=r[l];d<0?a.push(-d):o.push(d)}return this._queryResult}queryRawProjected(t,e,s,i){const n=this._queryBounds;return n[0]=t,n[1]=e,n[2]=s,n[3]=i,this._modules.camera.projectBounds(n),this.queryRaw(n[0],n[1],n[2],n[3])}query(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRaw(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r.slice())),edges:n.edgeList(new Uint32Array(o.slice()))}}queryProjected(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRawProjected(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r.slice())),edges:n.edgeList(new Uint32Array(o.slice()))}}getNodesByBoundingBox(t,e,s,i,n){if(this._updateIndex(),n){let u;u=this._modules.camera.screenToGraphVector({x:t,y:e}),t=u.x,e=u.y,u=this._modules.camera.screenToGraphVector({x:s,y:i}),s=u.x,i=u.y}const r=this._modules.graph,o=r.getNodes()._indexes,a=[],l=r.getNodeAttribute("excluded"),[d,h]=r.getNodeAttributes(["x","y"]);for(let u=0,c=o.length;u<c;u++){const g=o[u];if(l&&l.get(g))continue;const m=d&&d.get(g),_=h&&h.get(g);m>=t&&m<=s&&_>=e&&_<=i&&a.push(g)}return r.nodeList(new Uint32Array(a))}toggleDebug(t){t?(this._layer=this._modules.layers.addCanvasLayer(e=>{Xm(e,this._index,this._queryBounds)},{isStatic:!1,noClear:!1}),this._layer.moveToTop()):this._layer&&(this._layer.destroy(),this._layer=null)}renderDebug(t){if(!this._layer)return this.toggleDebug(!0);this._layer.refresh(e=>{Xm(e,this._index,this._queryBounds,t)})}},M0={};function $l(t,e,s,i,n=0,r=Math.sin(n),o=Math.cos(n),a=[0,0,0,0]){const l=s/2,d=i/2,h=t+l,u=e+d;if(n===0)return a[0]=t,a[1]=e,a[2]=t+s,a[3]=e+i,a;let c,g,m,_,f,p,x,y;return m=-l,_=-d,c=h+m*o-_*r,g=u+m*r+_*o,f=x=c,p=y=g,m=-l,_=d,c=h+m*o-_*r,g=u+m*r+_*o,c<f?f=c:c>x&&(x=c),g<p?p=g:g>y&&(y=g),m=l,_=d,c=h+m*o-_*r,g=u+m*r+_*o,c<f?f=c:c>x&&(x=c),g<p?p=g:g>y&&(y=g),m=l,_=-d,c=h+m*o-_*r,g=u+m*r+_*o,c<f?f=c:c>x&&(x=c),g<p?p=g:g>y&&(y=g),a[0]=f,a[1]=p,a[2]=x,a[3]=y,a}function Fo(t,e,s,i,n=0){const r=s/2,o=i/2,a=t+r,l=e+o;if(n===0)return[{x:t,y:e},{x:t+s,y:e},{x:t+s,y:e+i},{x:t,y:e+i}];const d=Math.sin(n),h=Math.cos(n);let u,c,g,m;g=-r,m=-o,u=a+g*h-m*d,c=l+g*d+m*h;const _={x:u,y:c};g=-r,m=o,u=a+g*h-m*d,c=l+g*d+m*h;const f={x:u,y:c};g=r,m=o,u=a+g*h-m*d,c=l+g*d+m*h;const p={x:u,y:c};return g=r,m=-o,u=a+g*h-m*d,c=l+g*d+m*h,[_,f,p,{x:u,y:c}]}function $h(t,e=0,s=1,i=Lf.slice()){const n=s*Math.sin(e),r=s*Math.cos(e);return i[0]=t[0]+n,i[1]=t[1]+r,i[2]=t[2]+n,i[3]=t[3]+r,i}function BI(t,e){return Mf(t,e)}function UI(t,e){return N0(t[0],t[1],t[2],t[3],e[0],e[1],e[2],e[3])}function GI(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function N0(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}Ao(M0,{angle:()=>IS,circleCircleIntersection:()=>Tu,circleContainsCircle:()=>Lv,circleContainsPoint:()=>Iv,circleIntersectsBox:()=>Lu,circleLineIntersection:()=>Nf,circleSortCompare:()=>Iu,computeCentroid:()=>CT,cubicBezierAABB:()=>Df,defaultAABB:()=>Lf,degreesToRadians:()=>Tv,distToSegmentSquared:()=>nc,distance:()=>je,distancePointSegment:()=>Gy,extendBounds:()=>Mf,getAABB:()=>$l,getBezierCurveBoundingBox:()=>Hl,getClosestPointOnLine:()=>CS,getClosestPointOnSegment:()=>Vy,getNormalOnEdge:()=>AS,getNormalOnQuadraticCurve:()=>Ry,getOBBPoints:()=>Fo,getPointOnBezierCurve:()=>_o,getPointOnEdge:()=>ES,getPointOnQuadraticCurve:()=>jl,getQuadraticBezierCurveLength:()=>wS,getQuadraticCurveBoundingBox:()=>sc,getQuadraticCurveControlPoint:()=>In,getSelfLoopControlPoints:()=>Vl,getTangentOnEdge:()=>SS,getTangentOnQuadraticCurve:()=>ec,intersects:()=>GI,isPointInLine:()=>By,isPointInPolygon:()=>po,isPointOnBezierCurve:()=>zy,isPointOnQuadraticCurve:()=>Oy,lineAABB:()=>ic,lineAngle:()=>ur,lineIntersection:()=>LS,lineLine:()=>qn,move:()=>wv,moveAABB:()=>$h,normalize:()=>Cf,overlaps:()=>N0,overlapsAABB:()=>UI,padBounds:()=>BI,polygonsIntersect:()=>ox,quadBezierAABB:()=>kf,radiansToDegrees:()=>Kd,rotate:()=>Xa,segmentIntersection:()=>zr,segmentRectangleIntersection:()=>Uy,squaredDistance:()=>Da,twoSegmentsIntersect:()=>TS});var pa=40;function P0(t,e){const s=t.getAttribute("curvature"),i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen();if(i===n){const _=(s+i.getAttribute("radius"))*ul*e,f=r.x,p=r.y,x=f-_,y=p,b=f,v=p+_;return[r,...[.2,.4,.6,.8].map(E=>_o(E,f,p,f,p,x,y,b,v)),r]}const o=n.getPositionOnScreen();if(s===0)return[r,o];const a=o.x-r.x,l=o.y-r.y,d=Math.sqrt(a*a+l*l),h=(r.x+o.x)/2,u=(r.y+o.y)/2,c=s*(d/Bl)*2,g=h+l/d*c,m=u+-a/d*c;return[r,...[.25,.5,.75].map(_=>jl(_,r.x,r.y,o.x,o.y,g,m)),o]}function VI(t,e,s){const i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen(),o=n.getPositionOnScreen();if(po(r.x,r.y,e)||po(o.x,o.y,e))return!0;const a=P0(t,s);for(let l=0;l<a.length-1;++l){const d=a[l],h=a[l+1];for(let u=0;u<e.length-1;++u){const c=e[u],g=e[u+1];if(qn(d.x,d.y,h.x,h.y,c.x,c.y,g.x,g.y))return!0}}return!1}function jI(t,e,s){const i=t.getPositionOnScreen(),n=Number(t.getAttribute("radius"))*s;return F0(i.x,i.y,n,e)}function F0(t,e,s,i){const n=t-s,r=e-s,o=e+s;return t+s>=i.minX&&n<=i.maxX&&o>=i.minY&&r<=i.maxY}function HI(t,e,s){const i=P0(t,s);for(let n=0;n<i.length-1;++n){const r=i[n],o=i[n+1];if(ic(r.x,r.y,o.x,o.y,e.minX,e.minY,e.maxX,e.maxY))return!0}return!1}function Ym(t,e,s,i){typeof s=="number"&&(s={left:s,right:s,top:s,bottom:s});const n=s.left===void 0?pa:s.left,r=s.right===void 0?pa:s.right,o=s.top===void 0?pa:s.top,a=s.bottom===void 0?pa:s.bottom,l=n+r,d=o+a,h=t.width===0?t.maxFixedSize:t.width,u=t.height===0?t.maxFixedSize:t.height,c=cI([(e.width-l)/(h+t.maxScaledSize),(e.height-d)/(u+t.maxScaledSize),(e.width-l-t.maxFixedSize)/h,(e.height-d-t.maxFixedSize)/u,i/t.maxScaledSize||NaN]);return{x:t.cx+(r-n)/(2*c),y:t.cy+(a-o)/(2*c),zoom:c}}var WI="cubicOut",$m=200,XI=class extends Bt{constructor(){super(...arguments),this._isLocating=!1,this._cacheValid=!0,this._cachedGraphBoundingBox=new xs,this._onLocateStart=()=>{this._isLocating=!0},this._onLocated=()=>{this._isLocating=!1,this._modules.events.fire("locate")},this._invalidCache=()=>{this._cacheValid=!1}}onMounted(){this._modules.events.register(["locate"]),this._modules.events.on(["addNodes","removeNodes","addEdges","removeEdges","excludedStateChange","clearGraph","updateAttributes"],this._invalidCache)}onReady(){this.locateGraph({},!0)}locateGraph(t,e=!1){return this._onLocateStart(),e?this._locateGraph(t):this._modules.transformations.whenApplied().then(()=>this._locateGraph(t))}_locateGraph(t){return this._locateBoundingBox(this.getGraphBoundingBox(),t).then(this._onLocated)}locateElements(t,e){return this._modules.transformations.whenApplied().then(()=>this._locateBoundingBox(this.getBoundingBox(t),e)).then(this._onLocated)}locateRawGraph(t,e){return this._onLocateStart(),this._locateBoundingBox(this.getRawGraphBoundingBox(t),e).then(this._onLocated)}isLocating(){return this._isLocating}getGraphBoundingBox(t=!1){return t?this.getBoundingBox(this._ogma.getNodes(),!0,t):(this._cacheValid||this._updateCache(),Object.assign({},this._cachedGraphBoundingBox))}forceInvalidCache(){this._invalidCache()}_updateCache(){this._cacheValid=!0,this._cachedGraphBoundingBox=this.getBoundingBox(this._modules.graph.getNodes())}getBoundingBox(t,e=!1,s=!1,i){let n;if(n=t.isNode?this._getNodesBoundingBox(t.toList(),e):this._getEdgesBoundingBox(t.toList(),i),s){const r=this._ogma.modules.labels.getTextsBoundingBox(t.isNode?t.toList():null,t.isNode?null:t.toList());n=n.extend(r)}return n}_getNodesBoundingBox(t,e=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getNodeAttributes(),i=[],n=[],r=[],o=[];for(let a=0;a<t.size;++a){const l=t._indexes[a];if(s.excluded.get(l)===0){const d=s.x.get(l),h=s.y.get(l),u=s.radius.get(l),c=2*u;s.scalingMethod.get(l)==="scaled"?r.push(c):o.push(c),e?(i.push(d-u,d+u),n.push(h-u,h+u)):(i.push(d),n.push(h))}}return new xs({xValues:i,yValues:n,scaledSizeValues:r,fixedSizeValues:o})}_getEdgesBoundingBox(t,e=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getEdgeAttributes(),i=this._modules.graphics.getNodeAttributes(),n={x1:0,y1:0,x2:0,y2:0},r={x:0,y:0},o={minX:0,minY:0,maxX:0,maxY:0},a=[],l=[],d=[],h=[];for(let u=0;u<t.size;++u){const c=t._indexes[u],g=s.source.get(c),m=s.target.get(c),_=s.curvature.get(c),f=i.x.get(g),p=i.y.get(g),x=i.scalingMethod.get(g)==="scaled",y=2*i.radius.get(g),b=i.x.get(m),v=i.y.get(m),E=i.scalingMethod.get(m)==="scaled",A=2*i.radius.get(m);x?d.push(y):h.push(y),E?d.push(A):h.push(A),e||_===0?(a.push(f,b),l.push(p,v)):g===m?(rc(f,p,_,y/2,0,n),Hl(f,p,n.x1,n.y1,n.x2,n.y2,b,v,o),a.push(o.minX,o.maxX),l.push(o.minY,o.maxY)):(Wl(f,p,b,v,_,r),sc(f,p,r.x,r.y,b,v,o),a.push(o.minX,o.maxX),l.push(o.minY,o.maxY))}return new xs({xValues:a,yValues:l,scaledSizeValues:d,fixedSizeValues:h})}getRawGraphBoundingBox(t){const e=t.nodes.length,s=new Array(e),i=new Array(e),n=new Array(e);for(let r=0;r<e;r++){const o=t.nodes[r].attributes||{};s[r]=o.x||0,i[r]=o.y||0,n[r]=o.radius||5}return new xs({xValues:s,yValues:i,scaledSizeValues:n})}_locateBoundingBox(t,e={}){if(isNaN(t.cx))return Promise.resolve();const{padding:s={},easing:i=WI,duration:n=0,maxNodeSizeOnScreen:r=$m,ignoreZoomLimits:o=!1}=e,a=Ym(t,this._modules.dom.getDimensions(),s,r),l=a.x,d=a.y,h=a.zoom,u=h/this._modules.camera.getZoom();return this._moveCamera(l,d,h,n,i,u,o)}_moveCamera(t,e,s,i,n,r,o){const a={duration:i,easing:n,ignoreZoomLimits:o},l=this._modules.camera.setCenter({x:t,y:e},a);return r>1.01||r<.99?this._modules.camera.setZoom(s,a):l}computeConfigForBounds(t,e={}){const{padding:s={},maxNodeSizeOnScreen:i=$m}=e;return Ym(t,this._modules.dom.getDimensions(),s,i)}layoutDataBoundingBox({x:t,y:e,indexes:s}){const i=this._modules.graphics.getNodeAttributes(),n=[],r=[],o=[],a=[];for(let l=0;l<s.length;++l){const d=s[l],h=t[l],u=e[l],c=2*i.radius.get(d),g=i.scalingMethod.get(d)==="scaled";n.push(h),r.push(u),g?o.push(c):a.push(c)}return new xs({xValues:n,yValues:r,scaledSizeValues:o,fixedSizeValues:a})}isEdgeInPolygon(t,e){return VI(t,e,this._modules.camera.getZoom())}isElementInView(t,{margin:e=0}={}){const{width:s,height:i}=this._modules.camera.getSize(),n={minX:-e,minY:-e,maxX:s+e,maxY:i+e};return t.isNode?this.isNodeInRectangle(t,n):this.isEdgeInRectangle(t,n)}isNodeInRectangle(t,e){if(this._modules.geo.isEnabled()){const s=this._modules.geo.getContainerCoord(t);return F0(s.x,s.y,Number(t.getAttribute("radius")),e)}return jI(t,e,this._modules.camera.getZoom())}isNodeInPolygon(t,e){const s=t.getPositionOnScreen();return po(s.x,s.y,e)}isEdgeInRectangle(t,e){return HI(t,e,this._modules.camera.getZoom())}},YI=ji&&typeof navigator<"u"&&"msLaunchUri"in navigator&&Ei&&!("documentMode"in document);function $I(t){return YI?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/Ss():t.deltaY&&t.deltaMode===1?20*-t.deltaY:t.deltaY&&t.deltaMode===2?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}var qI=6,ZI=class extends Bt{constructor(){super(...arguments),this._px=0,this._py=0,this._pressX=0,this._pressY=0,this._left=!1,this._middle=!1,this._right=!1,this._clickCounter={left:0,middle:0,right:0},this._buttons={left:!1,middle:!1,right:!1},this._skipNextMove=!1,this._onMouseWheel=t=>{this._isEnabled()&&this._isWheelEnabled()&&(!this._disableWheelUntilMouseDown()||this._modules.dom.hasFocus())&&(t.preventDefault(),t.stopPropagation(),this._applyMouseWheelZoom(t))},this._onMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=e-this._px,n=s-this._py;i===0&&n===0||(this._skipNextMove?this._skipNextMove=!1:je(e,s,this._pressX,this._pressY)>=qI&&(this._resetClickCounter(),this._modules.events.fire("mousemoveInternal",{x:e,y:s,dx:i,dy:n,domEvent:this._evt})))},this._onDocumentMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._bounds,n=e-this._px,r=s-this._py;(e<0||e>i.width||s<0||s>i.height)&&this._modules.events.fire("documentMouseMove",{x:e,y:s,dx:n,dy:r,domEvent:this._evt})},this._onMouseUp=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._evt;this._buttons[i]=!1,this._clickCounter[this._button]===1?this._modules.events.fire("clickInternal",{button:i,x:e,y:s,domEvent:n}):this._clickCounter[i]>1&&(this._modules.events.fire("doubleclickInternal",{button:i,x:e,y:s,domEvent:n}),this._resetClickCounter(i)),this._modules.events.fire("mouseupInternal",{button:i,x:e,y:s,domEvent:n})},this._onDocumentMouseup=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button;this._buttons[i]=!1;const n=this._modules.dom;this._modules.events.fire("documentMouseUp",{button:i,x:e,y:s,domEvent:this._evt}),n.removeDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.removeDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onMouseDown=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._modules.dom;this._skipNextMove=!0,this._pressX=e,this._pressY=s,this._lastMouseDownTarget=t.target,n.focus(),this._buttons[i]=!0,this._clickCounter[i]+=1;const r=i;this._dbclickTimer=n.setTimeout(()=>{this._resetClickCounter(r,0)},this._getDoubleClickTimer()),this._modules.events.fire("mousedownInternal",{button:i,x:e,y:s,domEvent:this._evt}),n.addDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.addDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onDrop=t=>{if(!this._isEnabled()||!this._setXY(t))return;t.preventDefault();const{x:e,y:s}=this._modules.camera.screenToGraphCoordinates(this._modules.position);this._modules.events.fire("drop",{domEvent:this._evt,x:e,y:s})}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("mouse.enabled",!0),this._modules.settings.register("mouse.wheelEnabled",!0),this._modules.settings.register("mouse.disableWheelUntilMouseDown",!1),this._modules.settings.register("mouse.doubleClickTimer",500),this._modules.events.register(["mousedownInternal","mouseupInternal","mousemoveInternal","mousewheelInternal","clickInternal","doubleclickInternal","mouseoverInternal","mouseoutInternal","documentMouseUp","documentMouseMove","drop"]),this._modules.dom.afterNextFrame().then(()=>this._initializeListeners())}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get left(){return this._left}get right(){return this._right}get middle(){return this._middle}_isEnabled(){return this._modules.settings.get("mouse.enabled")}_isWheelEnabled(){return this._modules.settings.get("mouse.wheelEnabled")}_disableWheelUntilMouseDown(){return this._modules.settings.get("mouse.disableWheelUntilMouseDown")}_getDoubleClickTimer(){return this._modules.settings.get("mouse.doubleClickTimer")}_resetClickCounter(t,e=0){t?this._clickCounter[t]=e:(this._clickCounter.left=e,this._clickCounter.middle=e,this._clickCounter.right=e),this._modules.dom.clearTimeout(this._dbclickTimer),this._lastMouseDownTarget=null}_setXY(t){const e=this._domElt.getBoundingClientRect();return this._bounds=e,!!e&&(this._evt=t,this._button=Ou[t.button],this._px=this._modules.position.x,this._py=this._modules.position.y,this._modules.position.x=t.clientX-e.left,this._modules.position.y=t.clientY-e.top,this._left=this._buttons.left,this._right=this._buttons.right,this._middle=this._buttons.middle,!0)}_applyMouseWheelZoom(t){this._setXY(t)&&this._modules.events.fire("mousewheelInternal",{delta:$I(t),dx:t.deltaX,dy:t.deltaY,x:this._modules.position.x,y:this._modules.position.y,domEvent:this._evt})}_initializeListeners(){const t=this._domElt,e=this._modules.dom;Ll&&this._modules.dom.addElementEventListener(document,"contextmenu",i=>{this._lastMouseDownTarget&&i.target!==this._lastMouseDownTarget&&i.preventDefault()}),e.addElementEventListener(t,"contextmenu",i=>{this._setXY(i),this._modules.dom.hasFocus()&&this._modules.settings.get("mouse.enabled")&&i.preventDefault()},!1);const s="onwheel"in t?"wheel":t.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";e.addElementEventListener(t,s,this._onMouseWheel),e.addElementEventListener(t,"mousemove",this._onMouseMove),e.addElementEventListener(t,"mouseleave",i=>{if(!this._isEnabled())return;this._modules.dom.blur();const n=t.getBoundingClientRect();i.clientX>=n.left+1&&i.clientX<=n.right-1&&i.clientY>=n.top+1&&i.clientY<=n.bottom-1||this._modules.events.fire("mouseout",{domEvent:this._evt})}),e.addElementEventListener(t,"mousedown",this._onMouseDown),e.addElementEventListener(t,"mouseup",this._onMouseUp),e.addElementEventListener(t,"dragover",i=>{i.preventDefault()}),e.addElementEventListener(t,"drop",this._onDrop)}},JI={doubleTapTimer:500,touchEventRate:15},KI=class extends Bt{constructor(){super(...arguments),this._pressed=!1,this._addEvent=(t,e,s,i)=>{this._modules.dom.addElementEventListener(t,e,s,i)},this._addWinEvent=(t,e,s,i)=>{this._modules.dom.addDirectWindowEventListener(e,s,i)},this._removeWinEvent=(t,e,s)=>{this._modules.dom.removeDirectWindowEventListener(e,s)}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("touch.enabled",!0),this._modules.events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]),this._modules.dom.afterNextFrame().then(()=>{this._initialize(this)})}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get pressed(){return this._pressed}_listen(t,e,s){if(vp){if(e==="touchstart")return HE(this._addEvent,t,s);if(e==="touchmove")return XE(this._addWinEvent,t,s);if(e==="touchend")return YE(this._addWinEvent,t,s);if(e==="touchcancel")return WE(this._addWinEvent,t,s)}return this._modules.dom.addElementEventListener(t,e,s)}_initialize(t){let e=0,s=0,i=0,n=0,r=!1,o="left",a=0,l=!1,d=!1,h=0,u=null,c=null;const g=()=>{this._modules.position.x=e,this._modules.position.y=s,this._pressed=r},m=(b,v)=>{const E=this._domElt.getBoundingClientRect();if(!E||b.touches==null)return null;const[A,S]=b.touches,T=A.clientX-E.left,L=A.clientY-E.top,I=S.clientX-E.left,R=S.clientY-E.top,z=(T+I)/2,j=(L+R)/2,C=z-e,w=j-s,H=je(T,L,I,R),K=this._modules.settings.get("interactions.zoom.speed")||Yh,it=Dy(H,K),xt=ur(T,L,I,R),at={dx:C,dy:w,rotation:xt-h,scale:it};return((Tt,It,dt,bt)=>{h=It,e=dt,s=bt,g()})(0,xt,z,j),at},_=b=>{if(b.touches&&b.touches.length===2&&d){const v=m(b);if(v){const{dx:E,dy:A,rotation:S,scale:T}=v;this._modules.events.fire("touchProgressGesture",{dx:E,dy:A,rotation:S,scale:T,x:e,y:s,domEvent:u,button:o})}}},f=b=>{if(o=Ou[b.button],!b.touches)return!1;if(b.touches.length!==1)return r=!1,b.touches.length>1&&this._modules.events.fire("touchUp",{x:e,y:s,domEvent:u,button:o}),!1;const v=this._domElt.getBoundingClientRect();return v&&(i=e,n=s,e=b.touches[0].clientX-v.left|0,s=b.touches[0].clientY-v.top|0,r=!0,u=b,g()),!0},p=()=>{a=0,this._modules.dom.clearTimeout(c)},x=b=>{if(b.preventDefault(),!b.touches)return;if(b.touches.length!==2&&d&&(d=!1,this._modules.events.fire("touchEndGesture",{domEvent:u})),f(b),b.touches.length===0){const E={x:e,y:s,domEvent:u,button:o};a===1&&this._modules.events.fire("touchTap",E),a>1&&(this._modules.events.fire("touchDoubleTap",E),p()),this._modules.events.fire("touchUp",E)}const v=Ai().documentElement;Kc(this._removeWinEvent,v,"touchmove",this._onMove),Kc(this._removeWinEvent,v,"touchend",this._onEnd)},y=b=>{_(b),l?l=!1:(p(),f(b)&&this._modules.events.fire("touchMove",{x:e,y:s,dx:e-i,dy:s-n,domEvent:u,button:o}))};this._listen(this._domElt,"touchstart",b=>{if(!b.touches)return;b.touches.length!==2||d||m(b)&&(d=!0,this._modules.events.fire("touchStartGesture",{domEvent:u})),f(b)&&(this._modules.dom.focus(),this._modules.events.fire("touchDown",{x:e,y:s,domEvent:u,button:o}),a+=1,c=this._modules.dom.setTimeout(p,JI.doubleTapTimer),l=!0);const v=Ai().documentElement;this._onMove=this._listen(v,"touchmove",y),this._onEnd=this._listen(v,"touchend",x)})}},QI=class{getHoveredElement(){return this.modules.captor.getPointedElement()}getPointerInformation(){return this.modules.captor.getCursorInformation()}},tL=class{getNodesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getNodes(e)}getEdgesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getEdges(e)}},vc={};Ao(vc,{gexf:()=>k0,gexfFromUrl:()=>Ec,graphml:()=>z0,graphmlFromUrl:()=>B0,janus:()=>D0,json:()=>R0,jsonFromUrl:()=>Ac,mtx:()=>eL,mtxFromUrl:()=>sL,neo4j:()=>O0});var oi=xu(bf()),k0=t=>Promise.resolve(oi.gexf(t)),Ec=t=>pr(t).then(e=>oi.gexf(e)),D0=t=>Promise.resolve(oi.janus(t)),R0=(t,e)=>Promise.resolve(oi.json(t,e)),Ac=(t,e)=>pr(t).then(s=>oi.json(s,e)),O0=t=>Promise.resolve(oi.neo4j(t)),z0=t=>Promise.resolve(oi.graphml(t)),B0=t=>pr(t).then(e=>oi.graphml(e)),eL=t=>Promise.resolve(oi.mtx(t)),sL=t=>pr(t).then(e=>oi.mtx(e)),iL=class extends ve{constructor(){super(...arguments),this.wait=t=>new Promise(e=>setTimeout(e,t)),this.initRandomGraph=t=>this._ogma.generate.random(t).then(this._ogma.setGraph).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.initGrid=t=>{const e=Math.ceil(Math.sqrt(t));return this._ogma.generate.grid({rows:e,columns:e}).then(s=>this._ogma.setGraph(s)).then(()=>this._ogma.view.locateGraph())},this.initLine=t=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:t?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]}),this._ogma.view.locateGraph()),this.initSingleNode=()=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}],edges:[]}),this._ogma.view.locateGraph()),this.initContinuousRenderLoop=({triggerKey:t="r",start:e=!0}={})=>{let s=e;const i=()=>{s&&this._ogma.modules.dom.beforeNextFrame().then(i)};document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s,i())}),i()},this.appendToBody=()=>{const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.bottom="0",t.style.right="0",document.body.appendChild(t),this._ogma.setContainer(t)},this.loadFile=t=>(t.endsWith(".gexf")?Ec(t):Ac(t)).then(e=>this._ogma.setGraph(e)).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.enableLasso=t=>{this._ogma.events.on("dragStart",()=>{this._ogma.keyboard.isKeyPressed("ctrl")&&this._ogma.tools.lasso.enable(t)})},this.randomizeGraph=({minX:t=0,minY:e=0,maxX:s=500,maxY:i=500}={})=>this._ogma.getNodes().setAttributes(this._ogma.getNodes().map(()=>({x:t+Math.random()*(s-t),y:e+Math.random()*(i-e)})))}},nL=class{setContainer(t){this.modules.dom.setContainer(t)}getContainer(){return this.modules.dom.getContainer()}},rL=class extends ve{constructor(){super(...arguments),this.once=(t,e)=>(this._ogma.modules.events.once(t,e),this),this.removeListener=t=>{this._ogma.modules.events.off(t)},this.onNodesAdded=t=>(this._ogma.events.on("addNodes",t),this._ogma),this.onBeforeNodesRemoved=t=>(this._ogma.events.on("beforeRemoveNodes",t),this._ogma),this.onNodesRemoved=t=>(this._ogma.events.on("removeNodes",t),this._ogma),this.onEdgesAdded=t=>(this._ogma.events.on("addEdges",t),this._ogma),this.onBeforeEdgesRemoved=t=>(this._ogma.events.on("beforeRemoveEdges",t),this._ogma),this.onEdgesRemoved=t=>(this._ogma.events.on("removeEdges",t),this._ogma),this.onGraphCleared=t=>(this._ogma.events.on("clearGraph",t),this._ogma),this.onNodesClassAdded=(t,e)=>(this._ogma.modules.classes.onNodeClassAdded(t,e),this._ogma),this.onNodesClassRemoved=(t,e)=>(this._ogma.modules.classes.onNodeClassRemoved(t,e),this._ogma),this.onEdgesClassAdded=(t,e)=>(this._ogma.modules.classes.onEdgeClassAdded(t,e),this._ogma),this.onEdgesClassRemoved=(t,e)=>(this._ogma.modules.classes.onEdgeClassRemoved(t,e),this._ogma),this.onNodeDragStart=t=>(this._ogma.events.on("nodesDragStart",t),this._ogma),this.onNodeDragProgress=t=>(this._ogma.events.on("nodesDragProgress",t),this._ogma),this.onNodeDragEnd=t=>(this._ogma.events.on("nodesDragEnd",t),this._ogma),this.onDrop=t=>(this._ogma.events.on("drop",t),this._ogma),this.onNodesSelected=t=>this.onNodesClassAdded(we,t),this.onNodesUnselected=t=>this.onNodesClassRemoved(we,t),this.onEdgesSelected=t=>this.onEdgesClassAdded(we,t),this.onEdgesUnselected=t=>this.onEdgesClassRemoved(we,t),this.onNodeDataChange=t=>(this._ogma.events.on("updateNodeData",t),this._ogma),this.onEdgeDataChange=t=>(this._ogma.events.on("updateEdgeData",t),this._ogma),this.onAnimate=t=>(this._ogma.events.on("animate",t),this._ogma),this.onMouseMove=t=>(this._ogma.events.on("mousemove",t),this._ogma),this.onMouseButtonDown=t=>(this._ogma.events.on("mousedown",t),this._ogma),this.onMouseButtonUp=t=>(this._ogma.events.on("mouseup",t),this._ogma),this.onClick=t=>(this._ogma.events.on("click",t),this._ogma),this.onDoubleClick=t=>(this._ogma.events.on("doubleclick",t),this._ogma),this.onMouseWheel=t=>(this._ogma.events.on("mousewheel",t),this._ogma),this.onHover=t=>(this._ogma.events.on("mouseover",t),this._ogma),this.onUnhover=t=>(this._ogma.events.on("mouseout",t),this._ogma),this.onDragStart=t=>(this._ogma.events.on("dragStart",t),this._ogma),this.onDragProgress=t=>(this._ogma.events.on("dragProgress",t),this._ogma),this.onDragEnd=t=>(this._ogma.events.on("dragEnd",t),this._ogma),this.onGestureStart=t=>(this._ogma.events.on("gestureStart",t),this._ogma),this.onGestureProgress=t=>(this._ogma.events.on("gestureProgress",t),this._ogma),this.onGestureEnd=t=>(this._ogma.events.on("gestureEnd",t),this._ogma),this.onRendererStateChange=t=>(this._ogma.events.on("rendererStateChange",t),this._ogma),this.onZoomProgress=t=>(this._ogma.events.on("zoom",t),this._ogma),this.onViewChanged=t=>(this._ogma.events.on("viewChanged",t),this._ogma),this.onNodesConnected=t=>(this._ogma.events.on("connectNodes",t),this._ogma),this.onGeoModeEnabled=t=>(this._ogma.events.on("geoEnabled",t),this._ogma),this.onGeoModeDisabled=t=>(this._ogma.events.on("geoDisabled",t),this._ogma),this.onGeoModeLoaded=t=>(this._ogma.events.on("geoLoaded",t),this._ogma),this.onLayoutStart=t=>(this._ogma.events.on("layoutStart",t),this._ogma),this.onLayoutComplete=t=>(this._ogma.events.on("layoutEnd",t),this._ogma),this.onLayoutComputed=t=>(this._ogma.events.on("layoutComputed",t),this._ogma),this.onTooltipShown=t=>(this._ogma.events.on("tooltipShow",t),this._ogma),this.onTooltipHidden=t=>(this._ogma.events.on("tooltipHide",t),this._ogma),this.onTransformationEnabled=t=>(this._ogma.events.on("transformationEnabled",t),this._ogma),this.onTransformationDisabled=t=>(this._ogma.events.on("transformationDisabled",t),this._ogma),this.onTransformationSetIndex=t=>(this._ogma.events.on("transformationSetIndex",t),this._ogma),this.onTransformationDestroyed=t=>(this._ogma.modules.events.on("transformationDestroyed",t),this._ogma),this.onTransformationRefreshed=t=>(this._ogma.events.on("transformationRefresh",t),this._ogma)}on(t,e){return this._ogma.modules.events.on(t,e),this}off(t){return this._ogma.modules.events.off(t),this}onKeyPress(t,e){return this._ogma.modules.keyboard.onKeyPress(t,e),this._ogma}};function yl(t,e,s){if(t!=null)return Array.isArray(t)?t[0]:t}function qh(t){return t==null?null:typeof t=="string"||typeof t=="number"?`${t}`:t&&qh(t.content)}function oL(t){if(t!=null)return typeof t=="string"?t:t.style||"line"}var aL=["color","radius","shape","text.content","x","y"],lL=["color","width","shape.body","text.content"];function dL(t){return t!=="all"?{nodes:["x","y"],edges:[]}:{nodes:aL,edges:lL}}function hL(t,{nodes:e,edges:s}){const i=t.getOriginalAttributes();return{nodes:e.reduce((n,r)=>(n[r.getId()]={x:i.nodes.x.get(r._index),y:i.nodes.y.get(r._index),color:yl(i.nodes.color.get(r._index)),radius:i.nodes.radius.get(r._index),shape:i.nodes.shape.get(r._index),text:{content:i.nodes.text.content.get(r._index)}},n),{}),edges:s.reduce((n,r)=>(n[r.getId()]={color:yl(i.edges.color.get(r._index)),width:i.edges.width.get(r._index),shape:{type:i.edges.shape.body.get(r._index)},text:{content:i.edges.text&&i.edges.text.content&&i.edges.text.content.get(r._index)}},n),{})}}function uL(t){return{nodes:t.nodes.map(({id:e,attributes:s={},data:i})=>{const{color:n,radius:r,shape:o,text:a,x:l,y:d}=s;return{id:e,x:l,y:d,color:yl(n),size:r,shape:o,text:qh(a),data:i}}),edges:t.edges.map(({id:e,source:s,target:i,attributes:n={},data:r})=>{const{color:o,width:a,text:l,shape:d}=n;return{id:e,source:s,target:i,color:yl(o),size:a,shape:oL(d),text:qh(l),data:r}})}}function qm(t){return t instanceof ni?t.getId():t}function Zm(t){return t instanceof Hi?t.getId():t}function Jm(t){return t instanceof Si?t.getId():t instanceof ni?[t.getId()]:es(t)?t.map(qm):[qm(t)]}function Km(t){return t instanceof Tn?t.getId():t instanceof Hi?[t.getId()]:es(t)?t.map(Zm):[Zm(t)]}var Sc="visible";function cL(t,e){return t?Jm(t):typeof e=="object"?Jm(e.nodes):e||Sc}function gL(t,e){return t?Km(t):typeof e=="object"?Km(e.edges):e||Sc}function U0(t,e,s,i){const n=cL(e,i),r=gL(s,i);return{nodes:t.getNodes(n),edges:t.getEdges(r)}}function G0(t,{nodeAttributes:e,edgeAttributes:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const l=U0(t,i,n,r);return{nodes:l.nodes.toJSON({attributes:e,data:o}),edges:l.edges.toJSON({attributes:s,data:a})}}function ql(t,e,{styles:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const{nodes:l,edges:d}=dL(s),h=G0(t,{nodeAttributes:l,edgeAttributes:d,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a});if(s==="original"){const u=hL(e,U0(t,i,n,r));for(const c of h.nodes)c.id!=null&&(c.attributes=u[c.id]);for(const c of h.edges)c.id!=null&&(c.attributes=u[c.id])}return s==="all"&&h.edges.forEach(({source:u,target:c,attributes:g})=>{if(g){const m=t.getNode(u);if(g.color==="source"&&m){const f=m.getAttribute("color");g.color=Array.isArray(f)?f[0]:f}const _=t.getNode(c);if(g.color==="target"&&_){const f=_.getAttribute("color");g.color=Array.isArray(f)?f[0]:f}}}),uL(h)}function mL(t,e){for(let s=0;s<e.length;++s){if(t==null)return;t=t[e[s]]}return t}function _L(t,e,s){for(let i=0;i<e.length-1;++i){const n=e[i];let r=t[n];r===void 0&&(r={},t[n]=r),t=r}t[e[e.length-1]]=s}function fL(t){const e=ct({},t[0]);for(const s of t)for(const i of Object.keys(s))i in e||(e[i]=void 0);return Object.keys(e)}function Qm(t,e){return t==null||Array.isArray(t)&&!t.length?e:t}function pL(t){return typeof t=="string"}function yL(t,e,s,i,n){const r=e==="edges",o={};return t.forEach((a,l)=>{const d=n.get(l),h=Jd(Qm(s(d),e));if(!h.every(pL))throw Error(`The tab ${e} function returned an invalid value.`);const u=Jd(i(a.data,h));h.forEach((c,g)=>{const m=Qm(u[g],{}),_=Yl(ct(ct({internal___id:a.id},r?{internal___source:a.source,internal___target:a.target}:{}),m)).reduce((f,{path:p,value:x})=>(f[p.join(".")]=x,f),{});o[c]=o[c]||[],o[c].push(_)})}),o}function xL(t){if(!t.length)return[];const e=fL(t),s=[e];for(const i of t)s.push(e.map(n=>i[n]));return s[0]=s[0].map(i=>i.replace("internal___","")),s}function bL(t,e,s){const i=new ux;let n=e?1:3;const r=[];for(let a=0;a<t.length;++a){const l=t[a],d=new Array(n);let h=l.data;if(s){const c={};s.forEach(g=>{const m=bn(g),_=mL(h,m);_L(c,m,_)}),h=c}const u=Yl(h);d[0]=l.id,e||(d[1]=l.source,d[2]=l.target);for(let c=0;c<u.length;++c){const{path:g,value:m}=u[c];g.length&&(i.has(g)?d[i.get(g)]=m:(i.set(g,n),d[n]=m,n++))}r.push(d)}const o=[];return o.push("id"),e||(o.push("source"),o.push("target")),i.keys().forEach(a=>o.push(a[a.length-1])),r.unshift(o),r.forEach(a=>a.length=n),r}var vL=/[=+\-@|%]/,EL=t=>t.length>0&&vL.test(t[0])?`'${t=t.replace("|","|")}`:t;function V0(t){return t===void 0?"":t instanceof Date?t.toISOString():EL(""+t)}var AL={what:void 0,dataProperties:void 0,separator:",",textSeparator:'"',download:!0,filename:"graph.csv",filter:"visible",nodes:void 0,edges:void 0,nodeData:Xs,edgeData:Xs,styles:"none"};function SL(t,e){const{what:s,dataProperties:i,nodes:n,edges:r,separator:o,textSeparator:a,download:l,nodeData:d,edgeData:h,filename:u,filter:c}=Is(typeof e=="string"?{what:e}:e,AL),g=ql(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:n,edges:r,filter:c,nodeData:d,edgeData:h});try{const m=wL(g,{what:s,separator:o,textSeparator:a,dataProperties:i});return l&&Ji(m,u,"text"),Promise.resolve(m)}catch(m){return Promise.reject(m)}}function wL(t,{what:e,separator:s,textSeparator:i,dataProperties:n}){const r=new RegExp(i,"g");if(i&&i!=='"'&&i!=="'")throw new TypeError(`Invalid argument :"textSeparator" is not single-quote or double-quote, was ${i}`);if(e!=="nodes"&&e!=="edges")throw new TypeError('missing argument: "what": should have value "nodes" or "edges"');const o=e==="nodes";return bL(o?t.nodes:t.edges,o,n).map(a=>a.map(l=>function(h){return i+V0(h).replace(r,`${i}${i}`).replace(/\n/g,"\\n").replace(/\r/g,"")+i}(l))).map(a=>a.join(s)).join(`
`)}var Rn=t=>Math.round(255*t);function t_(t,e){if(e==="integer"&&typeof t=="number"){if(t%1!=0)return"float"}else if(typeof t!="number")return typeof t=="boolean"?"boolean":"string";return e}var Zh=t=>typeof t=="object"&&t!==null&&t.constructor===Object;function Jh(t,e={}){return ii(t,(s,i)=>{Zh(s)?Jh(s,e):e[i]=s}),e}var TL={creator:void 0,description:void 0,styles:"all",download:!0,filename:"graph.gexf",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function IL(t,e={}){const{styles:s,nodes:i,edges:n,download:r,filename:o,creator:a,description:l,filter:d,nodeData:h,edgeData:u}=Is(e,TL),c=LL(ql(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{creator:a,description:l});return r&&Ji(c,o,"text"),Promise.resolve(c)}function LL(t,e){const s=yx(),i={},n={};let r,o=0,a=0;const l=s.createElement("gexf");l.setAttribute("xmlns","http://www.gexf.net/1.2draft"),l.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),l.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),l.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),l.setAttribute("version","1.2");const d=s.createElement("meta");if(d.setAttribute("lastmodifieddate",ip()),e.creator){const _=s.createElement("creator");r=s.createTextNode(""+e.creator),_.appendChild(r),d.appendChild(_)}if(e.description){const _=s.createElement("description");r=s.createTextNode(""+e.description),_.appendChild(r),d.appendChild(_)}const h=s.createElement("graph");h.setAttribute("mode","static");const u=s.createElement("nodes");t.nodes.forEach(_=>{const f=s.createElement("node");if(f.setAttribute("id",String(_.id)),_.text&&f.setAttribute("label",Hn(_.text)),Zh(_.data)){const x=Jh(_.data),y=s.createElement("attvalues");Object.keys(x).forEach(b=>{b in i||(i[b]={id:o,type:"integer"},o++);const v=x[b];i[b].type=t_(v,i[b].type);const E=s.createElement("attvalue");E.setAttribute("for",i[b].id),E.setAttribute("value",Hn(v)),y.appendChild(E)}),f.appendChild(y)}if(_.color){const x=ds(_.color);if(x){const y=s.createElement("viz:color");y.setAttribute("r",Rn(x[0])),y.setAttribute("g",Rn(x[1])),y.setAttribute("b",Rn(x[2])),y.setAttribute("a",x[3]),f.appendChild(y)}}const p=s.createElement("viz:position");if(p.setAttribute("x",_.x),p.setAttribute("y",-_.y),f.appendChild(p),_.size){const x=s.createElement("viz:size");x.setAttribute("value",_.size),f.appendChild(x)}u.appendChild(f)});const c=s.createElement("attributes");c.setAttribute("class","node"),Object.keys(i).forEach(_=>{const f=s.createElement("attribute");f.setAttribute("id",i[_].id),f.setAttribute("title",_),f.setAttribute("type",i[_].type),c.appendChild(f)});const g=s.createElement("edges");t.edges.forEach(_=>{const f=s.createElement("edge");if(f.setAttribute("id",_.id.toString()),f.setAttribute("source",_.source),f.setAttribute("target",_.target),_.size&&f.setAttribute("weight",_.size),_.text&&f.setAttribute("label",Hn(_.text)),Zh(_.data)){const p=Jh(_.data),x=s.createElement("attvalues");Object.keys(p).forEach(y=>{y in n||(n[y]={id:a,type:"integer"},a++);const b=p[y];n[y].type=t_(b,n[y].type);const v=s.createElement("attvalue");v.setAttribute("for",n[y].id),v.setAttribute("value",Hn(b)),x.appendChild(v)}),f.appendChild(x)}if(_.color){const p=ds(_.color);if(p){const x=s.createElement("viz:color");x.setAttribute("r",Rn(p[0])),x.setAttribute("g",Rn(p[1])),x.setAttribute("b",Rn(p[2])),x.setAttribute("a",p[3]),f.appendChild(x)}}if(_.size){const p=s.createElement("viz:size");p.setAttribute("value",_.size),f.appendChild(p)}g.appendChild(f)});const m=s.createElement("attributes");return m.setAttribute("class","edge"),Object.keys(n).forEach(_=>{const f=s.createElement("attribute");f.setAttribute("id",n[_].id),f.setAttribute("title",_),f.setAttribute("type",n[_].type),m.appendChild(f)}),h.appendChild(c),h.appendChild(m),h.appendChild(u),h.appendChild(g),l.appendChild(d),l.appendChild(h),s.appendChild(l),`<?xml version="1.0" encoding="UTF-8"?>${s.serialize()}`}var CL={graphId:"G",directedEdges:!0,styles:"all",download:!0,filename:"graph.graphml",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function ML(t,e){const{styles:s,nodes:i,edges:n,download:r,filename:o,graphId:a,directedEdges:l,filter:d,nodeData:h,edgeData:u}=Is(e,CL),c=NL(ql(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{graphId:a,directedEdges:l,noStyles:s==="none"});return r&&Ji(c,o,"text"),Promise.resolve(c)}function NL(t,e){const s=xx();function i(c,g,m,_,f){m=m||{};const p=s.createElement(g);for(const x in m){if(!Object.prototype.hasOwnProperty.call(m,x))continue;const y=m[x];y!==void 0&&p.setAttribute(x,y)}return(_!==void 0||f)&&(Object.prototype.toString.call(_)==="[object Object]"&&(_=JSON.stringify(_)),p.appendChild(s.createTextNode(_))),c.appendChild(p),p}const n=["id","source","target"],r=["size","x","y","shape","text","color"],o={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}};e.noStyles&&(delete o.color,delete o.r,delete o.g,delete o.b,delete o.a,delete o.shape,r.pop());const a=[],l=[];function d(c,g){const m={id:c.id};r.forEach(_=>{let f=c[_];_==="y"&&f&&(f=-parseFloat(f)),f!==void 0&&(m[(g==="edge"?"edge_":"")+_]=f,_==="color"&&function(x,y){const b=ds(y);b&&(x.r=b[0],x.g=b[1],x.b=b[2])}(m,f))}),ii(c.data||{},(_,f)=>{r.indexOf(f)===-1&&n.indexOf(f)===-1&&(o[f]?o[f].for!==g&&(o[f].for="all"):o[f]={for:g,type:"string"},m[f]=_)}),g==="edge"?(m.source=c.source,m.target=c.target,l.push(m)):a.push(m)}t.nodes.forEach(c=>d(c,"node")),t.edges.forEach(c=>d(c,"edge"));const h=i(s,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});ii(o,(c,g)=>{c.for!=="node"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"node",id:g}),c.for!=="edge"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"edge",id:"edge_"+g})}),i(h,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"}),i(h,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});const u=i(h,"graph",{edgedefault:e.directedEdges||e.directedEdges===void 0?"directed":"undirected",id:e.graphId?e.graphId:"G","parse.nodes":t.nodes.length,"parse.edges":t.edges.length,"parse.order":"nodesfirst"});return a.forEach(c=>{const g=i(u,"node",{id:c.id});(function(_,f){const p=i(_,"data",{key:"nodegraphics"}),x=i(p,"y:ShapeNode");i(x,"y:Geometry",{x:f.x,y:f.y,width:f.size,height:f.size}),e.noStyles||i(x,"y:Fill",{color:Ih(f.color),transparent:!1}),i(x,"y:NodeLabel",null,f.text||""),i(x,"y:Shape",{type:f.shape})})(g,c),ii(c,(m,_)=>{n.indexOf(_)===-1&&i(g,"data",{key:_},m,!0)})}),l.forEach(c=>{const g=i(u,"edge",{id:c.id,source:c.source,target:c.target});(function(_,f){const p=i(_,"data",{key:"edgegraphics"}),x=i(p,"y:PolyLineEdge");i(x,"y:LineStyle",{type:f.edge_type,color:e.noStyles?void 0:Ih(f.edge_color),width:f.edge_size}),i(x,"y:EdgeLabel",null,f.edge_label)})(g,c),ii(c,(m,_)=>{n.indexOf(_)===-1&&i(g,"data",{key:_},m,!0)})}),`<?xml version="1.0" encoding="UTF-8"?>
${uc(s)}`}var PL={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:Xs,edgeData:Xs,filter:"visible",pretty:!1,download:!0,filename:"graph.json",anonymize:!1};function FL(t,e={}){e.anonymize&&(e={nodeAttributes:"all",edgeAttributes:"all",nodeData:qa,edgeData:qa,filter:e.filter||"all",download:e.download,pretty:e.pretty,filename:e.filename});const{nodeAttributes:s,edgeAttributes:i,nodeData:n,edgeData:r,filter:o,pretty:a,download:l,filename:d}=Is(e,PL),h=G0(t.modules.graph,{nodeAttributes:s,edgeAttributes:i,filter:o,nodeData:n,edgeData:r}),u=a?JSON.stringify(h,null," "):JSON.stringify(h);return l&&Ji(u,d,"text"),Promise.resolve(h)}function kL(t,e){return t.getBoundingBox().computeForZoom(e).extend(xs.fromValues(t.getAttribute("x"),t.getAttribute("y"),t.map(s=>s.getAttribute("radius")+s.getAttribute("innerStroke.width")+s.getAttribute("outerStroke.width"))))}function DL(t,e,s){const i=e.view.graphToScreenCoordinates(s.bottomLeft()),n=e.view.graphToScreenCoordinates(s.topRight()),r=Math.abs(n.x-i.x),o=Math.abs(n.y-i.y),a=Math.min(t.width/r,t.height/o);t.width=r*a,t.height=o*a}function j0(t,e={}){const s=t.view.get(),i=typeof e.margin=="number"?e.margin:0,n={pixelRatio:e.pixelRatio||Ss(),angle:0,backgroundColor:null,zoom:0,x:0,y:0,width:0,height:0,hideImages:!1,renderBackground:!0,isBufferDisplayable:$a};if(e.width&&e.height?(n.width=e.width,n.height=e.height):(n.width=s.width,n.height=s.height),e.clip)n.zoom=s.zoom,n.x=s.x,n.y=s.y;else{const r=kL(t.getNodes(e.filter),s.zoom);if(e.texts){const o=t.modules.labels.getTextsBoundingBox();o.isValid()&&r.extend(o)}e.width!=null&&isFinite(e.width)&&e.height!=null&&isFinite(e.height)||DL(n,t,r),n.width=Math.max(n.width,2*i),n.height=Math.max(n.height,2*i),n.x=r.cx,n.y=r.cy,n.zoom=Math.min((n.width-2*i)/r.width,(n.height-2*i)/r.height)}return t.modules.geo.isEnabled()?n.backgroundColor=null:e.background!==void 0&&(n.backgroundColor=e.background),n}function Kh(t,e,s,i,n=!1){const r=$t(ct({},s),{hideImages:n,angle:s.angle||0,currentTime:ls(),isBufferDisplayable:l=>e.texts||!Qy(l)}),o={};if(e.badges===!1){const l={text:null,image:null};o.badges={topLeft:l,topRight:l,bottomRight:l,bottomLeft:l}}const a=t.styles.getClass(ln);return a&&a.update({nodeAttributes:o}),t.modules.graphics.export(i,r,e.filter||Sc,e)}var ya=t=>({download:!0,filter:"visible",filename:`graph.${t}`,clip:!1,margin:10,width:void 0,height:void 0,background:null,badges:!0,legend:void 0,texts:!0,preventOverlap:!0,images:!0,textWatermark:{content:"",fontFamily:"Arial",fontSize:48,fontStyle:void 0,fontColor:"red",repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageWatermark:{url:void 0,width:void 0,height:void 0,repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageCrossOrigin:void 0,layers:!0,pixelRatio:void 0}),RL={png:ya("png"),jpg:ya("jpg"),tiff:ya("tiff"),gif:ya("gif")};function OL(t){const{canvas:e,parameters:s}=t;return s.textWatermark.content&&e_(e,s.textWatermark,WL,XL),s.imageWatermark.url?mp(s.imageWatermark.url).then(i=>(i&&(s.imageWatermark.content=i,e_(e,s.imageWatermark,$L,YL)),t)):t}function zL(t){const{ogma:e,canvas:s,parameters:i}=t,n=e.modules.legend;let r=null;return i.legend===void 0&&(r=!!n.enabled()&&n.getCurrentOptions()),i.legend===!0&&(r={}),r&&n.exportOnCanvas(s,r,t.parameters.pixelRatio),t}function BL(t){const{canvas:e,parameters:s,view:i}=t;if(!i.renderBackground)return t;i.renderBackground=!1;const n=e.getContext("2d");return n.fillStyle=s.background,n.fillRect(0,0,e.width,e.height),t}function UL(t){const{ogma:e,view:s}=t;return e.modules.geo.isEnabled()?e.modules.geo.exportBackground(s).then(i=>{const n=s.width*s.pixelRatio,r=s.height*s.pixelRatio,o=ss(n,r),a=o.getContext("2d");return a.drawImage(i,(n-i.width)/2,(r-i.height)/2),a.drawImage(t.canvas,0,0),t.canvas=o,t}):t}function GL(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,canvas:i,below:!0}).then(()=>t):t}function VL(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,below:!1,canvas:i}).then(()=>t):t}function jL(t){const{ogma:e,parameters:s,canvas:i,view:n}=t,r=i.getContext("2d");return Kh(e,s,n,"canvas",!s.images).then(o=>{try{const a=o.getContext("2d");if(!a)throw new Error("Failed to render graph");return a.getImageData(0,0,1,1),r.drawImage(o,0,0,i.width,i.height),t}catch(a){return Gi(a),Kh(e,s,n,"canvas",!0).then(l=>(r.drawImage(l,0,0,i.width,i.height),t))}})}function HL({canvas:t,parameters:e,type:s}){const i=t.toDataURL("image/"+s);return e.download&&Ji(i,e.filename,"dataURL"),i}function xa(t,e,s){const i=Is(e,RL[s]);i.filename.endsWith(s)||(i.filename+="."+s),i.background===null&&(i.background=t.modules.graphics.getTransparentBackgroundColor());const n=j0(t,i);i.pixelRatio=n.pixelRatio;const r=ss(n.width*n.pixelRatio,n.height*n.pixelRatio),o={ogma:t,parameters:i,canvas:r,view:n,type:s};return Promise.resolve().then(()=>o).then(BL).then(UL).then(GL).then(jL).then(VL).then(OL).then(zL).then(HL).then(a=>(t.modules.events.fire("afterImageExport"),a))}function WL(t,e,s,i){t.textAlign="center",t.textBaseline="middle",t.fillText(e,s,i)}function XL(t,e,s){return{width:t.measureText(e).width,height:s}}function YL(t,e,s,i,n){return{width:i===void 0?e.width:i,height:n===void 0?e.height:n}}function $L(t,e,s,i,n,r){t.drawImage(e,s-n/2,i-r/2,n,r)}function e_(t,e,s,i){if(!e)return;if(typeof e!="object")e={content:e};else if(!e.content)return;const{fontFamily:n,fontSize:r,fontStyle:o,fontColor:a,repeat:l,alpha:d,space:h,content:u}=e;let c=e.angle;const g=t.getContext("2d"),m=t.width,_=t.height,f=e.x===void 0?m/2:e.x,p=e.y===void 0?_/2:e.y,x=e.height,y=e.width;c=c/180*Math.PI,Yi(g,n,r,o),g.fillStyle=a,g.globalAlpha=d;const b=i(g,u,r,y,x);if(l){const v=b.width+h,E=b.height+h,A=Math.sqrt(m*m+_*_);g.save(),g.translate(0,0),g.rotate(c);for(let S=0;S<A;S+=v)for(let T=0;T<A;T+=E)s(g,u,S,T,b.width,b.height),T!==0&&s(g,u,S,-T,b.width,b.height);g.restore()}else g.save(),g.translate(f,p),g.rotate(c),s(g,u,0,0,b.width,b.height),g.restore()}var qL={download:!0,filename:"graph.svg",width:void 0,height:void 0,background:null,texts:!0,preventOverlap:!0,groupSemantically:!0,images:!0,badges:!0,embedFonts:!1,layers:!0,clip:!1,margin:10,prefix:"ogma"};function ZL(t,e){const s=Is(e,qL),{background:i,filename:n,download:r,layers:o}=s,a=t.modules.graphics;i===null&&(s.background=a.getTransparentBackgroundColor());const l=j0(t,s);return Kh(t,s,l,"svg",!s.images).then(d=>(d.removeAttribute("pointer-events"),d.setAttribute("version","1.1"),d.setAttributeNS(ah,"xmlns",Du),d.setAttributeNS(ah,"xmlns:xlink",gp),d)).then(d=>s.groupSemantically?KL(t,d,s):d).then(d=>tC(d,s)).then(d=>JL(t,l,d)).then(d=>s_(t,l,d,o,!0)).then(d=>s_(t,l,d,o,!1)).then(d=>(t.modules.events.fire("afterImageExport"),d)).then(d=>{const h=`<?xml version="1.0" encoding="utf-8"?>${uc(d)}`;return r&&Ji(h,n,"text/xml"),h})}function JL(t,e,s){return t.modules.geo.isEnabled()?t.modules.geo.exportBackground($t(ct({},e),{pixelRatio:1})).then(i=>{const n=ce("image",{width:i.width,height:i.height,x:0,y:0,href:i.toDataURL()});return s.insertBefore(n,s.children[0]),s}):Promise.resolve(s)}function s_(t,e,s,i,n=!1){return i?t.modules.layers.export({view:e,svg:s,below:n}).then(()=>s):Promise.resolve(s)}function KL(t,e,s){const i=e.childNodes[2],n=i.childNodes,r={},o=s.prefix;for(let g=0;g<n.length;g++){const m=n[g],_=m.getAttribute(Fs);_!=null&&(r[_]=r[_]||[],r[_].push(m))}const a=Object.keys(r),l=t.modules.graph,d=l.getNodeAttribute("id"),h=l.getEdgeAttribute("id"),u=ce("g",{class:`${o}-edges`}),c=ce("g",{class:`${o}-nodes`});for(let g=0;g<a.length;g++){const m=a[g],_=m.charAt(0)==="n",f=parseInt(m.substring(1)),p=r[m],x=Hn((_?d:h).get(f).toString()),y=ce("g");y.setAttribute(`data-${_?"node":"edge"}-id`,x),y.setAttribute("class",`${o}-${_?"node":"edge"}`);for(let b=0;b<p.length;b++){const v=p[b];y.appendChild(v),v.removeAttribute(Fs)}(_?c:u).appendChild(y)}return i.appendChild(u),i.appendChild(c),e}function QL(t){const e=[].concat(Array.prototype.slice.call(t.getElementsByTagName("text")||[])),s=[],i={};for(let n=0;n<e.length;n++){const r=e[n].parentNode.getAttribute("font-family");if(typeof r=="string"){const o=r.split(",");for(let a=0;a<o.length;a++){const l=o[a].replace(/['"]/g,"");l===""||i[l]||(i[l]=!0,s.push(l))}}}return{list:s,map:i}}function tC(t,e){const s=QL(t).map;return lx().then(i=>i.filter(n=>s[n.name])).then(i=>dx(i,!!e.embedFonts)).then(i=>{if(i.length!==0){const n=ce("style");for(let r=0;r<i.length;r++)n.appendChild(Ru(i[r]));t.childNodes[0].appendChild(n)}return t})}var eC={what:void 0,dataProperties:void 0,filter:"visible",nodes:void 0,edges:void 0,download:!0,filename:"graph.xlsx",tab:void 0,nodeData:void 0,edgeData:void 0};function sC(t,e={}){typeof e=="string"&&(e={what:e});const{what:s,nodes:i,edges:n,tab:r={nodes:()=>"nodes",edges:()=>"edges"},download:o,filename:a,dataProperties:l,filter:d,nodeData:h,edgeData:u}=Is(e,eC);r.nodes||(r.nodes=()=>"nodes"),r.edges||(r.edges=()=>"edges");const c=ql(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:i,edges:n,filter:d,nodeData:m=>m,edgeData:m=>m}),g=iC(c,{what:s,tabFunctions:r,tabContentFunctions:{nodes:h||(m=>ih(lo(m||{}),l)),edges:u||(m=>ih(lo(m||{}),l))}},{nodes:t.modules.graph.getNodes(c.nodes.map(({id:m})=>m)),edges:t.modules.graph.getEdges(c.edges.map(({id:m})=>m))});return o&&Ji(g,a,"blob"),Promise.resolve(g)}function iC(t,{what:e,tabFunctions:s,tabContentFunctions:i},n){const r=Os("XLSX")||Os("xlsx",{throwOnError:!0});if(!r)throw Error('The xlsx exports requires the "xlsx" peer dependency to be associated');const o=new rC;if(e){if(e!=="nodes"&&e!=="edges")throw new TypeError(`Invalid argument: "what" is not "nodes" or "edges", was ${e}`);e==="nodes"&&(t.edges=[]),e==="edges"&&(t.nodes=[])}const a={};for(const l of["nodes","edges"]){const d=yL(t[l],l,s[l],i[l],n[l]);for(const h of Object.keys(d))a[h]=[...a[h]||[],...d[h]]}for(const l of Object.keys(a))o.SheetNames.push(l),o.Sheets[l]=nC(r,xL(a[l]));return o.SheetNames.length===0&&(o.SheetNames=["nodes","edges"],o.Sheets.nodes={},o.Sheets.edges={}),ho([oC(r.write(o,{bookType:"xlsx",bookSST:!1,type:"binary"}))])}function nC(t,e){const s={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let n=0;n!==e.length;++n){const r=e[n];for(let o=0;o!==r.length;++o){const a=r[o];i.s.r>n&&(i.s.r=n),i.s.c>o&&(i.s.c=o),i.e.r<n&&(i.e.r=n),i.e.c<o&&(i.e.c=o);const l={v:V0(a)};s[t.utils.encode_cell({c:o,r:n})]=l}}return i.s.c<1e7&&(s["!ref"]=t.utils.encode_range(i)),s}var rC=class{constructor(){this.SheetNames=[],this.Sheets={}}};function oC(t){const e=new ArrayBuffer(t.length),s=new Uint8Array(e);for(let i=0;i!==t.length;++i)s[i]=255&t.charCodeAt(i);return e}var aC=class extends ve{constructor(t){super(t),this.csv=e=>SL(this._ogma,e),this.xlsx=e=>(e&&e.dataProperties&&void 0,sC(this._ogma,e)),this.gexf=e=>IL(this._ogma,e),this.graphml=(e={})=>ML(this._ogma,e),this.json=(e={})=>FL(this._ogma,e),this.svg=(e={})=>ZL(this._ogma,e),this.png=(e={})=>xa(this._ogma,e,"png"),this.jpg=(e={})=>xa(this._ogma,e,"jpg"),this.tiff=(e={})=>xa(this._ogma,e,"tiff"),this.gif=(e={})=>xa(this._ogma,e,"gif"),t.styles.createClass({name:ln,isBuiltin:!0})}},rs=xu(rv()),lC=class extends ve{constructor(){super(...arguments),this.balancedTree=t=>Promise.resolve(rs.balancedTree.generate(rs.balancedTree.configure(t))),this.barabasiAlbert=t=>Promise.resolve(rs.barabasiAlbert.generate(rs.barabasiAlbert.configure(t))),this.erdosRenyi=t=>Promise.resolve(rs.erdosRenyi.generate(rs.erdosRenyi.configure(t))),this.flower=t=>Promise.resolve(rs.flower.generate(rs.flower.configure(t))),this.grid=t=>Promise.resolve(rs.grid.generate(rs.grid.configure(t))),this.path=t=>Promise.resolve(rs.path.generate(rs.path.configure(t))),this.random=t=>Promise.resolve(rs.random.generate(rs.random.configure(t))),this.randomTree=t=>Promise.resolve(rs.randomTree.generate(rs.randomTree.configure(t)))}},dC=class extends ve{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.geo.enable(t),this.disable=t=>this._ogma.modules.geo.disable(t),this.setOptions=t=>this._ogma.modules.geo.setOptions(t),this.getOptions=()=>this._ogma.modules.geo.getOptions(),this.getMap=()=>this._ogma.modules.geo.getMap(),this.enabled=()=>this._ogma.modules.geo.isEnabled(),this.getCenter=()=>this._ogma.modules.geo.getCenter(),this.getView=()=>this._ogma.modules.geo.getView(),this.getZoom=()=>this._ogma.modules.geo.getZoom(),this.setZoom=t=>this._ogma.modules.geo.setZoom(t),this.setView=(t,e,s)=>this._ogma.modules.geo.setView(t,e,s),this.setCenter=(t,e)=>this._ogma.modules.geo.setCenter(t,e),this.toggle=t=>this._ogma.modules.geo.toggle(t),this.resetCoordinates=()=>this._ogma.modules.geo.resetCoordinates(),this.getUnprojectedCoordinates=t=>this._ogma.modules.geo.getUnprojectedCoordinates(this._ogma.getNodes(t)),this.runLayout=t=>xn(this,[t],function*({type:e,nodes:s,latitudePath:i=ti,longitudePath:n=ei,options:r,center:o}){if(e===void 0||r===void 0)throw new Error("Ogma.geo.runLayout: Both layout type and options are required");if(s=this._ogma.getNodes(s),o===void 0){let a=0;if(o=s.reduce((l,d)=>{const h=d.getData(i),u=d.getData(n);return isNaN(h)||isNaN(u)||(l.latitude+=h,l.longitude+=u,a++),l},{latitude:0,longitude:0}),isNaN(o.latitude)||isNaN(o.longitude))throw new Error("Ogma.geo.runLayout: No valid center coordinates found");o.latitude/=a,o.longitude/=a}return this._ogma.modules.geo.runLayout({center:o,nodes:s,type:e,options:r,latitudePath:i,longitudePath:n})})}},hC=class{reloadFonts(){this.modules.graphics.reloadFonts()}},uC=class extends ve{constructor(){super(...arguments),this.gexf=t=>k0(t),this.gexfFromUrl=t=>Ec(t),this.janus=t=>D0(t),this.json=(t,e)=>R0(t,e),this.jsonFromUrl=(t,e)=>Ac(t,e),this.neo4j=t=>O0(t),this.graphml=t=>z0(t),this.graphmlFromUrl=t=>B0(t)}},cC=class extends ve{constructor(){super(...arguments),this.isKeyPressed=t=>this._ogma.modules.keyboard.isPressed(t),this.resetKeys=()=>{this._ogma.modules.keyboard.resetKeys()}}},gC=class extends ve{addLayer(t,e){return this._ogma.modules.layers.addLayer(t,"layer",e)}addCanvasLayer(t,e,s){return this._ogma.modules.layers.addCanvasLayer(t,e,s)}addOverlay(t,e){if(!t.position)throw new Error("options.position argument is required");return this._ogma.modules.layers.addOverlay(t,e)}addSVGLayer(t,e){return t.element||(t.element=document.createElementNS("http://www.w3.org/2000/svg","svg")),t.draw||(t.draw=()=>{}),this._ogma.modules.layers.addSVGLayer(t,e)}},i_={name:"concentric",configure:function(t,{graph:e,data:s}){if(t.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');const i=$t(ct({},t),{centralNode:function(b,v){return v instanceof ni?v:b.getNode(v)}(e,t.centralNode)}),{centralNode:n,nodes:r}=i,o=e.getNode(n);if(o===void 0)throw new Error('concentric layout: "centralNode" parameter is not valid');const a=o._index,{x:l,y:d}=o.getPosition(),h=r.getAttribute("layoutable"),u=e.getNodes(r)._indexes,c=Array.from(u.filter((y,b)=>h[b]));c.indexOf(a)===-1&&c.push(a);const g=e.getNodeAttribute("radius").getMultiple(u),m=function(b,v,E,A){if(v)return v==="random"?"random":v==="radius"?A.slice():v==="degree"?E.getDegree():b.getProperty(E,v)}(s,i.sortBy,r,g),_=c.reduce((y,b,v)=>(y[b]=v,y),{}),f=c.map((y,b)=>b),p=new Set(t.edges.getExtremities()._indexes),x=c.map(y=>e.topology.getAdjacentElements(!0,new Uint32Array([y])).filter(b=>p.has(b)).map(b=>_[b]));return{sourceNodeIndex:c.indexOf(a),centerX:typeof i.centerX=="number"?i.centerX:l,centerY:typeof i.centerY=="number"?i.centerY:d,list:c,indexes:f,size:c.length,totalSize:c.length,attributes:{adjacentNodes:x,size:g},sortAttr:m,clockwise:i.clockwise===void 0||i.clockwise,circleHopRatio:i.circleHopRatio||5,allowOverlap:!!i.allowOverlap}},context:function(){return{dijkstra:function(t,e,s,i,n){const r=Math.pow(2,31)-1,o=new Int32Array(i),a=new Int32Array(i),l=new Int8Array(i);o.fill(r),a.fill(-1);for(let h=0;h<i;++h){const u=e[h];u!==void 0&&(o[u]=r,a[u]=-1)}o[n]=0;let d=0;for(;d!==-1;){let h=r;d=-1;for(let u=0;u<s;++u){const c=e[u],g=o[c];!l[c]&&g<h&&(h=g,d=c,l[c]=1)}if(d>-1){const u=t[d],c=h+1;u.forEach(g=>{const m=o[g];c<m&&(o[g]=c,a[g]=d)})}}return o},determinePropertyType:function(t,e,s){return e.some(i=>t[i]!=="number")?"string":"number"}}},update:function(t,e){const{attributes:s,indexes:i,size:n}=t,{sourceNodeIndex:r,centerX:o,centerY:a,sortAttr:l}=t,d=s.adjacentNodes,h=s.size,u=new Array(t.totalSize),c=new Array(t.totalSize),g=e.dijkstra(d,i,t.size,t.totalSize,r);let m=0;const _={};for(let E=0;E<n;E++){const A=h[i[E]];A>m&&(m=A)}const f=m*t.circleHopRatio;let p=0,x=0;const y=Math.PI/9;for(let E=0;E<n;E++){const A=i[E],S=g[A];let T=_[S];T||(T=[],_[S]=T),T.push(A)}const b=function(A,S,T){if(A==="random")return function(){return Math.random()-.5};if(A)return T.determinePropertyType(A,S,S.length)==="number"?function(L,I){return A[L]-A[I]}:function(L,I){return A[L]<A[I]?-1:1}}(l,i,e),v=l==="random"||l;return Object.keys(_).sort((E,A)=>parseInt(E)-parseInt(A)).forEach((E,A)=>{const S=_[E],T=S.length;let L=0,I=x;const R=2*Math.PI/T;if(A!==0&&!t.allowOverlap){const z=2*Math.PI*p;let j=0;L+=S.reduce((C,w)=>C+h[w],0),j=2*L*Math.SQRT2,j>z&&(p+=j/(2*Math.PI)-p)}v&&(S.sort(b),t.clockwise||S.reverse());for(let z=0;z<T;z++){const j=S[z];u[j]=Math.cos(I)*p+o,c[j]=Math.sin(I)*p+a;const C=h[j];I+=R*(t.allowOverlap?1:C/L*T)}p+=f,x+=y}),{x:u,y:c,indexes:t.list}},isRunning:function(){return!1},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}},mC=t=>(t.modules.layouts.register(i_),e=>t.modules.layouts.start(i_.name,e)),_C=Object.defineProperty,kt=(t,e)=>_C(t,"name",{value:e,configurable:!0}),fC=kt((t,e)=>t.map(s=>e*s),"Z"),pC=kt((t,e)=>t.map(e),"g"),yC=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),xC=kt(()=>({[WebGL2RenderingContext.FLOAT]:"uniform1f",[WebGL2RenderingContext.FLOAT_VEC2]:"uniform2fv",[WebGL2RenderingContext.FLOAT_VEC3]:"uniform3fv",[WebGL2RenderingContext.FLOAT_VEC4]:"uniform4fv",[WebGL2RenderingContext.INT]:"uniform1i",[WebGL2RenderingContext.INT_VEC2]:"uniform2iv",[WebGL2RenderingContext.INT_VEC3]:"uniform3iv",[WebGL2RenderingContext.INT_VEC4]:"uniform4iv",[WebGL2RenderingContext.UNSIGNED_INT]:"uniform1ui",[WebGL2RenderingContext.UNSIGNED_INT_VEC2]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC3]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC4]:"uniform2uiv",[WebGL2RenderingContext.FLOAT_MAT2]:"uniformMatrix2fv",[WebGL2RenderingContext.FLOAT_MAT3]:"uniformMatrix3fv",[WebGL2RenderingContext.FLOAT_MAT4]:"uniformMatrix4fv",[WebGL2RenderingContext.SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.SAMPLER_CUBE]:"uniform1i"}),"te"),cn=new Map,Md=new Map,bC=kt((t,e,s,i)=>{cn.has(t)||cn.set(t,cn.size);const n=`${cn.get(t)}:${e}:${s}`;return Md.has(n)||Md.set(n,i()),Md.get(n)},"re"),Nd=new Map,vC=kt((t,e)=>(cn.has(t)||cn.set(t,cn.size),Nd.has(t)||Nd.set(t,e()),Nd.get(t)),"oe"),EC=kt(t=>{const e=t.createBuffer();if(!e)throw new Error("Could not create buffer");return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,yC,t.STATIC_DRAW),e},"ne"),Ln=kt((t,e)=>vC(t,()=>{const s=t.getAttribLocation(e,"position");return t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),s}),"w"),n_=kt((t,e,s)=>{const i=t.createShader(e);if(i===null)throw new Error("Cannot create WebGL shader.");return t.shaderSource(i,s),t.compileShader(i),i},"X"),Cn=kt((t,e,s)=>bC(t,e,s,()=>{const i=t.createProgram();if(i===null)throw new Error("Cannot create WebGL program.");if(t.attachShader(i,n_(t,t.VERTEX_SHADER,e)),t.attachShader(i,n_(t,t.FRAGMENT_SHADER,s)),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const n=t.getProgramInfoLog(i);throw t.deleteProgram(i),new Error(`Could not link WebGL program: 
${n}`)}return i}),"R"),ai=kt((t,{size:e,data:s,type:i,internalFormat:n=t.RGBA32F,format:r=t.RGBA})=>{const o=t.createTexture();if(!o)throw new Error("Cannot create WebGL texture.");const[a,l]=pC(e,d=>Math.max(1,d));return s instanceof Float32Array&&s.byteLength===0?s=new Float32Array(a*l*4):s instanceof Uint32Array&&s.byteLength===0&&(s=new Uint32Array(a*l*4)),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,a,l,0,r,i,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{size:e,data:s,type:i,format:r,handle:o}},"F"),ri=kt((t,e)=>{const s=t.createFramebuffer();if(!s)throw new Error("Cannot create WebGL frame buffer.");t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i!==t.FRAMEBUFFER_COMPLETE)switch(i){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("Framebuffer: Attachment is NOT complete.");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("Framebuffer: No valid attachment.");case t.FRAMEBUFFER_UNSUPPORTED:throw new Error("Framebuffer: Attachment types are not supported.");default:throw new Error(`Framebuffer: Unknown reason (status: ${i}).`)}return s},"l"),mr=kt((t,e)=>()=>([t,e]=[e,t],t),"A"),Mn=kt((t,e,s)=>{t.useProgram(e);const i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const o=t.getActiveUniform(e,r);if(!o)throw new Error(`Cannot get GL active uniform ${r}.`);const{name:a,size:l,type:d}=o,h=t.getUniformLocation(e,a);if(!h)throw new Error(`Cannot get GL uniform location ${a}.`);i[a]={size:l,data:s[a],type:d,location:h}}return i},"M");function Ki(t,e,s={}){let i=0;const n=xC();return Object.entries(e).forEach(([r,{location:o,type:a,data:l}])=>{let d=s[r]!==void 0?s[r]:l;(a===t.SAMPLER_2D||a===t.INT_SAMPLER_2D||a===t.UNSIGNED_INT_SAMPLER_2D)&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,d),d=i,i++),t[n[a]](o,d)})}kt(Ki,"b");var Zl=kt(t=>Math.ceil(Math.sqrt(t)),"D"),H0=kt(t=>Math.ceil(Math.sqrt(2*t)),"Y"),AC=kt((t,e,s,i)=>{const n=Zl(e),r=new Float32Array(4*n**2);for(let o=0;o<e;o++){const a=4*o;r[a]=s[o],r[a+1]=i[o]}return ai(t,{size:[n,n],data:r,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"ue"),SC=kt((t,e,s,i)=>{const n=Zl(e),r=H0(s),o=new Uint32Array(3*n**2);let a=0;for(let l=0;l<e;l++){const d=3*l,h=a,u=Math.floor(h/r),c=h%r;o[d]=c,o[d+1]=u,o[d+2]=i[l],a+=i[l]}return ai(t,{size:[n,n],data:o,type:t.UNSIGNED_INT,format:t.RGB_INTEGER,internalFormat:t.RGB32UI})},"ie"),wC=kt((t,e,s,i,n)=>{const r=Zl(e),o=H0(s),a=new Uint32Array(2*o**2),l=Array.from({length:e},()=>[]);i.forEach((h,u)=>{l[h].push(n[u]),l[n[u]].push(h)});let d=0;for(let h=0;h<e;h++)for(const u of l[h]){const c=Math.floor(u/r),g=u%r;a[d]=g,a[d+1]=c,d+=2}return ai(t,{size:[o,o],data:a,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})},"ae"),TC=kt((t,e,s,i=new Float32Array(e),n=new Uint8Array(e))=>{const r=Zl(e),o=new Float32Array(4*r**2);for(let a=0;a<e;a++){const l=4*a;o[l]=s[a],o[l+1]=i[a],o[l+2]=n[a],o[l+3]=0}return ai(t,{size:[r,r],data:o,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"ce"),r_=kt(t=>{const e=new Map,s={nodes:[],edges:[]};return t.nodes.forEach((i,n)=>{e.has(i.id)&&console.warn(`Duplicated ID ${i.id}@${n}`),s.nodes.push($t(ct({},i),{id:n})),e.set(i.id,n)}),t.edges.forEach(i=>{const n=e.get(i.source),r=e.get(i.target);return n===void 0||r===void 0?console.warn(`Missing source ${i.source}`):void s.edges.push({source:Math.min(n,r),target:Math.max(n,r)})}),s.edges.sort((i,n)=>i.source-n.source||i.target-n.target),s},"De"),o_=kt(({nodes:t,edges:e},[s,i]=[0,0])=>{const n=Math.PI*(3-Math.sqrt(5)),r=t.map(a=>(a.x=(a.x||0)-s,a.y=(a.y||0)-i,a)).map(a=>({n:a,key:a.pinned?0:1+1e6*a.y+a.x})).sort((a,l)=>a.key-l.key);let o=0;return r.forEach(({n:a,key:l},d)=>{if(l*d==0||l!==r[d-1].key)return o=d;const h=Math.sqrt(d-o);a.x=r[o].n.x+h*Math.cos(n*(d-o)),a.y=r[o].n.y+h*Math.sin(n*(d-o))}),{nodes:t,edges:e}},"Be"),a_=kt((t,e)=>{const{nodes:s,edges:i}=e,n=s.length,r=i.length,o=new Uint32Array(r),a=new Uint32Array(r),l=new Uint32Array(n);for(let m=0;m<r;m++){const{source:_,target:f}=i[m];o[m]=_,a[m]=f,l[_]++,l[f]++}const d=new Float32Array(s.map(({x:m})=>m||0)),h=new Float32Array(s.map(({y:m})=>m||0)),u=new Float32Array(s.map(({r:m})=>isNaN(m)?1:m)),c=new Float32Array(s.map((m,_)=>l[_]+1)),g=new Uint8Array(s.map(({pinned:m})=>m?1:0));return{N:n,E:r,bodyTexture:AC(t,n,d,h),nodeTexture:SC(t,n,r,l),topologyTexture:wC(t,n,r,o,a),propertyTexture:TC(t,n,c,u,g)}},"Oe"),l_=kt((t,e)=>{t.deleteTexture(e.bodyTexture.handle),t.deleteTexture(e.nodeTexture.handle),t.deleteTexture(e.topologyTexture.handle),t.deleteTexture(e.propertyTexture.handle)},"We"),Nn=`#version 300 es

in vec2 position;

void main() {
  gl_Position = vec4(position, 0.0f, 1.0f);
}`,IC=`#version 300 es
precision highp float;uniform int u_0;uniform lowp sampler2D u_1,u_2;uniform int u_3,u_4;out vec4 outColor;void main(){ivec2 o=ivec2(gl_FragCoord.xy);if((o&65535<<u_3)!=o)return;if(outColor=vec4(1e9,1e9,-1e9,-1e9),u_3>0)for(int e;e<4;e++){ivec2 i=o+(ivec2(e&1,e>>1)<<u_3-1);vec4 t=texelFetch(u_2,i,0);outColor=vec4(min(outColor.xy,t.xy),max(outColor.zw,t.zw));}else if(textureSize(u_1,0).x*o.y+o.x<u_0)outColor.xy=outColor.zw=texelFetch(u_1,o,0).xy;if(u_3==u_4){vec2 o=outColor.zw-outColor.xy;o=vec2(max(o.x,o.y),max(o.x,o.y)),outColor=vec4(outColor.xy-vec2(1),o+vec2(2));}}`,LC=kt(t=>1<<Math.ceil(Math.log2(Math.sqrt(t))),"fe"),d_=kt((t,e,s)=>{const i=LC(e),n=new Float32Array(4*i**2);return s&&s.forEach((r,o)=>n[o]=r),ai(t,{size:[i,i],data:n,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"j"),CC=kt(t=>Math.ceil(Math.log2(Math.sqrt(t)))+1,"_e"),MC=kt((t,e,s)=>{const i=Cn(t,Nn,IC);Ln(t,i);const n=d_(t,e),r=d_(t,e),o=mr(n,r),a=ri(t,r.handle),l=ri(t,n.handle),d=mr(a,l),h=Mn(t,i,{u_0:e,u_1:s().handle,u_2:n.handle,u_3:0,u_4:0});let u=n;return{step:(c=CC(e))=>{t.viewport(0,0,n.size[0],n.size[1]),t.useProgram(i);for(let g=0;g<c;g++){t.bindFramebuffer(t.FRAMEBUFFER,d());const m=o();u=m===n?r:n,Ki(t,h,{u_2:m.handle,u_1:s().handle,u_4:c-1,u_3:g}),t.drawArrays(t.TRIANGLES,0,6)}},texture:()=>u,destroy:()=>{t.deleteFramebuffer(a),t.deleteFramebuffer(l),t.deleteTexture(r.handle),t.deleteTexture(n.handle)}}},"xe"),NC=`#version 300 es
precision lowp float;vec2 r(vec2 r,vec2 e){return vec2(r.x*e.x-r.y*e.y,r.x*e.y+r.y*e.x);}vec2 r(vec2 r){return r.y=-r.y,r;}vec2 r(vec2 u[8],vec2 i,vec2 o){vec2 t,c=i-o,e=vec2(1,0);for(int i;i<8;++i)t+=r(u[i],e),e=r(e,c);return t;}vec2 r(vec2 e,vec4 r){return(e-r.xy)/r.zw;}uniform float u_c,u_d,u_e,u_f,u_g,u_h,u_9,u_a,u_b;uniform int u_0;uniform lowp sampler2D u_1;uniform lowp usampler2D u_i,u_j;uniform lowp sampler2D u_k;uniform int u_5,u_l;uniform lowp sampler2D u_2;uniform lowp usampler2D u_m,u_n;uniform lowp sampler2D u_o;out vec4 outColor;void main(){uint a=uint(textureSize(u_1,0).x);int d=textureSize(u_j,0).x;ivec2 o=ivec2(gl_FragCoord.xy);if(int(a)*o.y+o.x>=u_0)return;vec3 u=texelFetch(u_k,o,0).xyz;if(u.z>0.)return;vec4 x=texelFetch(u_1,o,0);vec2 i=x.xy,e=x.zw;ivec4 t=ivec4(texelFetch(u_i,o,0));float c=float(t.z)+1.;vec4 v=texelFetch(u_2,ivec2(0),0);uint y=uint(textureSize(u_m,0).x);float p=float(1<<u_l-1);ivec2 m=ivec2(u_5,1),n=ivec2(p*r(i,v));vec2 g=(vec2(n)+.5)/p;ivec2 s=n-ivec2(1);for(int r;r<9;++r){ivec2 t=s+ivec2(r%3,r/3);if(t>>u_l-1!=ivec2(0))continue;uvec2 o=texelFetch(u_n,t,0).xy;for(uint r=o.x;r<o.y;r++){uint n=texelFetch(u_m,ivec2(r%y,r/y),0).x;ivec2 l=ivec2(n%a,n/a);vec2 t=texelFetch(u_1,l,0).xy-i;float v=dot(t,t)+1e-4;if(u_g>0.&&u_9<.5){float i=texelFetch(u_k,l,0).y,r=max(u.y+i+u_h,.01);if(v<r*r){float u=sqrt(v);e-=(r-u)*u_g*i/r*t/u;}}float x=float(texelFetch(u_i,l,0).z)+1.;e-=u_9*u_c*x*c*t/v/u.x;}}vec2 f[8];for(int r;r<8;r++)f[r]=r<u_5?texelFetch(u_o,m*n+ivec2(r,0),0).xy:vec2(0);vec2 F=r(r(f,g,r(i,v))/v.z);e-=u_9*u_c*F*c/u.x;ivec2 l;for(int a;a<t.z;a++){l=ivec2(texelFetch(u_j,t.xy,0).xy);vec2 r=texelFetch(u_1,l,0).xy-i;r*=1.-(u_f+u.y+texelFetch(u_k,l,0).y)/(length(r)+1e-4);float o=float(texelFetch(u_i,l,0).z)+1.,v=u_9*u_e*c*o/(min(c,o)*(o+c));if(e+=v*r/u.x,t.x+=1,t.x>=d)t.x=0,t.y+=1;}e=u_a*(e-u_9*u_d*i);float h=dot(e,e);if(h>u_b)e*=sqrt(u_b/h);outColor=vec4(i+e,e);}`,PC=kt((t,e,s,i,n,{handle:r},{handle:o},{N:a,bodyTexture:l,nodeTexture:d,topologyTexture:h,propertyTexture:u},{charge:c,gravity:g,inertia:m,edgeStrength:_,edgeLength:f,elasticity:p,margin:x,maxDisplacement:y})=>{const b=Cn(t,Nn,NC);Ln(t,b);const v=ai(t,{type:t.FLOAT,size:l.size,data:new Float32Array(l.data.buffer.slice(0)),format:t.RGBA,internalFormat:t.RGBA32F}),E=mr(l,v),A=ri(t,v.handle),S=ri(t,l.handle),T=mr(A,S),L=Mn(t,b,{u_9:1,u_a:m,u_b:y**2,u_c:c,u_d:g,u_e:_,u_f:f,u_g:p,u_h:x,u_0:a,u_1:l.handle,u_i:d.handle,u_j:h.handle,u_k:u.handle,u_5:s,u_l:e,u_2:i().handle,u_m:n().handle,u_n:r,u_o:o});let I=l;return{step:R=>{t.viewport(0,0,l.size[0],l.size[1]),t.useProgram(b),t.bindFramebuffer(t.FRAMEBUFFER,T());const z=E();I=z===l?v:l,Ki(t,L,{u_9:R,u_1:z.handle,u_2:i().handle,u_m:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>I,destroy:()=>{t.deleteFramebuffer(A),t.deleteFramebuffer(S),t.deleteTexture(v.handle)}}},"me"),FC=kt((t,e)=>fC([e,1],1<<t),"ve"),W0=kt((t,e,s,i)=>{const n=FC(e,s),r=new Float32Array(2*n[0]*n[1]);return i&&i.forEach((o,a)=>r[a]=o),ai(t,{size:n,data:r,type:t.FLOAT,format:t.RG,internalFormat:t.RG32F})},"H"),kC=`#version 300 es
precision lowp float;vec2 v(vec2 v,vec2 t){return vec2(v.x*t.x-v.y*t.y,v.x*t.y+v.y*t.x);}vec2 t(vec2 t,vec2 v){return vec2(dot(t,v),t.y*v.x-t.x*v.y)/dot(v,v);}vec2 v(vec2 v){return t(vec2(1,0),v);}const float f[64]=float[64](1.,1.,1.,1.,1.,1.,1.,1.,1.,2.,3.,4.,5.,6.,7.,8.,1.,3.,6.,10.,15.,21.,28.,36.,1.,4.,10.,20.,35.,56.,84.,120.,1.,5.,15.,35.,70.,126.,210.,330.,1.,6.,21.,56.,126.,252.,462.,792.,1.,7.,28.,84.,210.,462.,924.,1716.,1.,8.,36.,120.,330.,792.,1716.,3432.);uniform int u_5,u_6;uniform lowp sampler2D u_7,u_8;out vec2 outColor;void main(){float i=float(1<<u_6);ivec2 l=ivec2(u_5,1),c=ivec2(gl_FragCoord.xy)/l;vec2 d=(vec2(c)+.5)/i;uint o=uint(gl_FragCoord.x)%uint(u_5);if(u_6>2){ivec2 y=c>>1;vec2 e=(vec2(c&65534)+1.)/i-d,t=vec2(1,0);for(uint c;c<uint(u_5-int(o));++c)outColor+=f[c+(o<<3)]*v(texelFetch(u_7,l*y+ivec2(c+o,0),0).xy,t),t=v(t,e);}ivec2 y=(c&65534)-2;for(int r;r<36;r++){ivec2 u=y+ivec2(r%6,r/6);vec2 x=vec2(u-c);if(dot(x,x)<=2.||u>>u_6!=ivec2(0))continue;vec2 n=(vec2(u)+.5)/i-d,e=vec2(1,0);for(uint t;t<o;++t)e=v(e,-n);vec2 m=v(n),a;for(uint c;c<uint(u_5);++c){if(dot(e,e)<1e-20)break;a+=f[c+(o<<3)]*t(texelFetch(u_8,l*u+ivec2(c,0),0).xy,e),e=v(e,n);}outColor+=v(a,m);}}`,DC=kt((t,e,s,i)=>{const n=Cn(t,Nn,kC);Ln(t,n);const r=Array.from({length:e},(l,d)=>W0(t,d,s)),o=r.map(({handle:l})=>ri(t,l)),a=Mn(t,n,{u_5:s,u_6:e-1,u_7:r[0].handle,u_8:i(0).handle});return{step:()=>{t.useProgram(n);for(let l=2;l<e;l++){const{handle:d}=r[l-1],h=i(l);t.viewport(0,0,h.size[0],h.size[1]),t.bindFramebuffer(t.FRAMEBUFFER,o[l]),Ki(t,a,{u_6:l,u_7:d,u_8:h.handle}),t.drawArrays(t.TRIANGLES,0,6)}},texture:l=>r[l],destroy:()=>{o.forEach(l=>t.deleteFramebuffer(l)),r.forEach(({handle:l})=>t.deleteTexture(l))}}},"pe"),RC=`#version 300 es
precision lowp float;vec2 e(vec2 e,vec2 u){return vec2(e.x*u.x-e.y*u.y,e.x*u.y+e.y*u.x);}vec2 x(vec2 u,vec2 e){return vec2(dot(u,e),u.y*e.x-u.x*e.y)/dot(e,e);}const vec2 u[8]=vec2[8](vec2(1,0),vec2(-1,0),vec2(2,0),vec2(-6,0),vec2(24,0),vec2(-120,0),vec2(720,0),vec2(-5040,0));const float n[16]=float[16](1.,1.,2.,6.,24.,120.,720.,5040.,40320.,362880.,3628800.,39916800.,479001600.,6.227021e9,8.717829e1,1.3076744e12);vec2 e(vec2 u,vec4 e){return(u-e.xy)/e.zw;}uniform int u_5,u_l,u_6;uniform lowp sampler2D u_p,u_2;uniform lowp usampler2D u_m;uniform lowp sampler2D u_k,u_1;uniform lowp usampler2D u_n;out vec2 outColor;void main(){float i=float(1<<u_6);ivec2 o=ivec2(u_5,1),t=ivec2(gl_FragCoord.xy)/o;vec2 l=(vec2(t)+.5)/i;uint c=uint(gl_FragCoord.x)%uint(u_5);if(u_6==u_l-1){uint u=uint(textureSize(u_1,0).x),x=uint(textureSize(u_m,0).x);vec4 i=texelFetch(u_2,ivec2(0),0);uvec2 n=texelFetch(u_n,t,0).xy;for(uint t=n.x;t<n.y;t++){uint v=texelFetch(u_m,ivec2(t%x,t/x),0).x;ivec2 r=ivec2(v%u,v/u);vec2 d=l-e(texelFetch(u_1,r,0).xy,i),o=vec2(1,0);for(uint u;u<c;++u)o=e(o,d);outColor+=e(vec2(texelFetch(u_k,r,0).x,0),o);}}else for(int v;v<4;++v){ivec2 d=2*t+ivec2(v&1,v>>1);vec2 f=(vec2(d)+.5)/i/2.-l,r=vec2(1,0),y;for(uint t;t<=c;++t)y+=x(e(texelFetch(u_p,o*d+ivec2(c-t,0),0).xy,r),u[c-t]*n[t]),r=e(r,f);outColor+=e(y,u[c]);}}`,OC=kt((t,e,s,i,n,{handle:r},o,{handle:a})=>{const l=Cn(t,Nn,RC);Ln(t,l);const d=Array.from({length:e},(c,g)=>W0(t,g,s)),h=d.map(({handle:c})=>ri(t,c)),u=Mn(t,l,{u_5:s,u_l:e,u_6:e-1,u_p:d[0].handle,u_2:i().handle,u_m:n().handle,u_k:r,u_1:o().handle,u_n:a});return{step:()=>{t.useProgram(l);for(let c=e-1;c>=2;c--){const{handle:g}=d[(c+1)%e],m=d[c];t.viewport(0,0,m.size[0],m.size[1]),t.bindFramebuffer(t.FRAMEBUFFER,h[c]),Ki(t,u,{u_2:i().handle,u_m:n().handle,u_1:o().handle,u_6:c,u_p:g}),t.drawArrays(t.TRIANGLES,0,6)}},texture:c=>d[c],destroy:()=>{h.forEach(c=>t.deleteFramebuffer(c)),d.forEach(({handle:c})=>t.deleteTexture(c))}}},"Fe"),zC=`#version 300 es
uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 n){return u(n.y)<<1|u(n.x);}uniform uint u_0;uniform lowp usampler2D u_q,u_m;out uvec2 outColor;uint u(uint o,uint e,uint i){uint u,n=u_0;for(;u<n;){uint t=u+n>>1,r=texelFetch(u_m,ivec2(t%i,t/i),0).x;texelFetch(u_q,ivec2(r%e,r/e),0).x<o?u=t+1u:n=t;}return u;}void main(){uint n=uint(textureSize(u_q,0).x),e=uint(textureSize(u_m,0).x),i=u(uvec2(gl_FragCoord.xy));outColor=uvec2(u(i,n,e),u(i+1u,n,e));}`,BC=kt(t=>1<<t-1,"Ee"),UC=kt((t,e,s)=>{const i=BC(e),n=new Uint32Array(2*i**2);return s&&s.forEach((r,o)=>n[o]=r),ai(t,{size:[i,i],data:n,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})},"Te"),GC=kt((t,e,s,{handle:i},n)=>{const r=Cn(t,Nn,zC);Ln(t,r);const o=UC(t,s),a=ri(t,o.handle),l=Mn(t,r,{u_0:e,u_q:i,u_m:n()});return{step:()=>{t.viewport(0,0,o.size[0],o.size[1]),t.useProgram(r),t.bindFramebuffer(t.FRAMEBUFFER,a),Ki(t,l,{u_m:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>o,destroy:()=>{t.deleteFramebuffer(a),t.deleteTexture(o.handle)}}},"Ae"),VC=`#version 300 es
precision lowp float;uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 e){return u(e.y)<<1|u(e.x);}vec2 u(vec2 e,vec4 u){return(e-u.xy)/u.zw;}uniform int u_0,u_l;uniform lowp sampler2D u_2,u_1;out uint outColor;void main(){ivec2 e=ivec2(gl_FragCoord.xy);if(textureSize(u_1,0).x*e.y+e.x>=u_0)return;vec4 t=texelFetch(u_2,ivec2(0),0);vec2 o=u(texelFetch(u_1,e,0).xy,t);outColor=u(uvec2(float(1<<u_l-1)*o));}`,jC=kt(t=>Math.ceil(Math.sqrt(t)),"Re"),HC=kt((t,e,s)=>{const i=jC(e),n=new Uint32Array(i**2).fill(4294967295);return s&&s.forEach((r,o)=>n[o]=r),ai(t,{size:[i,i],data:n,type:t.UNSIGNED_INT,format:t.RED_INTEGER,internalFormat:t.R32UI})},"Me"),WC=kt((t,e,s,i,n)=>{const r=Cn(t,Nn,VC);Ln(t,r);const o=HC(t,e),a=ri(t,o.handle),l=Mn(t,r,{u_0:e,u_l:s,u_2:i().handle,u_1:n().handle});return{step:()=>{t.viewport(0,0,o.size[0],o.size[1]),t.useProgram(r),t.bindFramebuffer(t.FRAMEBUFFER,a),Ki(t,l,{u_2:i().handle,u_1:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>o,destroy:()=>{t.deleteFramebuffer(a),t.deleteTexture(o.handle)}}},"be"),XC=`#version 300 es
precision highp int;uniform uint u_r,u_s;uniform highp usampler2D u_u,u_t;out uint outColor;uint u(uint u,uint e,bool o,uint t){uint i=u<4294967295u?texelFetch(u_u,ivec2(u%t,u/t),0).x:u,n=e<4294967295u?texelFetch(u_u,ivec2(e%t,e/t),0).x:e;if(o)return i<n?u:e;return i>n?u:e;}void main(){uint e=uint(textureSize(u_t,0).x),s=uint(textureSize(u_u,0).x);uvec2 t=uvec2(gl_FragCoord.xy);uint c=texelFetch(u_t,ivec2(t),0).x,i=uint(t.x+e*t.y),o=i^1u<<u_r-u_s,x=texelFetch(u_t,ivec2(o%e,o/e),0).x;bool n=(i>>u_r-u_s&1u)==0u;(i>>u_r&2u)==2u&&(n=!n),outColor=u(c,x,n,s);}`,YC=kt(t=>Math.ceil(Math.sqrt(1<<Math.ceil(Math.log2(t)))),"Ge"),h_=kt((t,e)=>{const s=YC(e.length),i=new Uint32Array(s**2).fill(4294967295);return e&&e.forEach((n,r)=>i[r]=n),ai(t,{size:[s,s],data:i,type:t.UNSIGNED_INT,format:t.RED_INTEGER,internalFormat:t.R32UI})},"V"),$C=kt(t=>Math.max(0,Math.ceil(Math.log2(t))),"Le"),qC=kt(t=>t*(t+1)/2,"Ie"),ZC=kt((t,e,s)=>{const i=Cn(t,Nn,XC);Ln(t,i);const n=Array.from({length:e},(f,p)=>p),r=h_(t,n),o=h_(t,n),a=mr(r,o),l=ri(t,o.handle),d=ri(t,r.handle),h=mr(l,d),u=Mn(t,i,{u_r:0,u_s:0,u_t:r.handle,u_u:s.handle}),c=$C(e);let g=0,m=0,_=r;return{step:(f=qC(c))=>{t.useProgram(i),t.viewport(0,0,r.size[0],r.size[1]);for(let p=0;p<f;p++){t.bindFramebuffer(t.FRAMEBUFFER,h());const x=a();_=x===r?o:r,Ki(t,u,{u_r:g,u_s:m,u_t:x.handle}),t.drawArrays(t.TRIANGLES,0,6),m=(m+1)%(g+1),m===0&&(g=(g+1)%c)}},texture:()=>_,destroy:()=>{t.deleteFramebuffer(l),t.deleteFramebuffer(d),t.deleteTexture(o.handle),t.deleteTexture(r.handle)}}},"Ue"),JC=kt(t=>{let e;return()=>e||t().finally(()=>e=void 0)},"Ne"),KC=kt((t,e)=>Math.max(.1,1-(t/Math.max(1,e-20))**7.39),"K"),QC=kt((t,e=25,s=24e3)=>{const i=(s-e)/(e-1);return Math.ceil(e*i*4/(i+t))},"J"),u_={charge:10,edgeStrength:.5,edgeLength:30,elasticity:.9,margin:1,gravity:.002,inertia:.9,maxDisplacement:1e3,steps:300},tM=kt((t,e,s)=>{let[i,n]=[0,0];const r=EC(t),o=kt(()=>{t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0);for(let l=0;l<e;l++,i++)if(!s(i))return!0},"i"),a=kt(l=>{o()?l(i):n=requestAnimationFrame(()=>a(l))},"a");return{start:JC(()=>new Promise(l=>(i=0)||a(l))),step:o,stop:()=>cancelAnimationFrame(n)}},"Q"),Pd=kt((t,e,s)=>{var i,n;let{bodyTexture:r}=e;const{N:o,propertyTexture:a}=e,{steps:l,batch:d}=s,h=(i=s.order)!=null?i:4;if(h<2||h>8)throw new Error("Order must be between 2 and 8");const u=Math.max(1,(n=s.depth)!=null?n:Math.ceil(Math.log2(o)/2)),{step:c,texture:g,destroy:m}=MC(t,o,()=>r),{step:_,texture:f,destroy:p}=WC(t,o,u,g,()=>r),{step:x,texture:y,destroy:b}=ZC(t,o,f()),{step:v,texture:E,destroy:A}=GC(t,o,u,f(),y),{step:S,texture:T,destroy:L}=OC(t,u,h,g,y,a,()=>r,E()),{step:I,texture:R,destroy:z}=DC(t,u,h,T),{step:j,texture:C,destroy:w}=PC(t,u,h,g,y,E(),R(u-1),e,s);return $t(ct({},tM(t,d??QC(o),H=>(r=C(),c(),_(),x(),v(),S(),I(),j(KC(H,l)),H<l))),{destroy:()=>{m(),p(),b(),A(),L(),z(),w()}})},"qe"),c_=0,X0=typeof window>"u",eM=typeof performance<"u"&&performance.now?performance:Date,sM=X0?t=>{const e=eM.now(),s=Math.max(0,16-(e-c_)),i=setTimeout(()=>t(e+s),s);return c_=e+s,i}:window.requestAnimationFrame,iM=X0?t=>clearTimeout(t):window.cancelAnimationFrame;function Y0(t,e,s){for(let i=0;i<t.length;i++){const n=t[i];n.x=e[i],n.y=s[i]}}kt(Y0,"defaultUpdate");var nM=kt(()=>{},"noop"),Fd={movementRatio:7e-8,surfaceRatio:.0025},Qh=class{constructor(t={}){this.onUpdate=kt(e=>{},"onUpdate"),this.update=Y0,this.nextTick=sM,this.cancelTick=iM,this.onEnd=nM,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=Fd,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in t?t.autoStop&&(typeof t.autoStop=="boolean"?t.autoStop=Fd:t.autoStop=ct(ct({},t.autoStop),Fd)):t.steps;for(const e in t)t[e]===void 0&&e!=="order"&&e!=="depth"||(this[e]=t[e])}};kt(Qh,"Settings");var g_=class{constructor(t){this.promise=new Promise(t)}then(t){return this.promise.then(t)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function Ha(t,e,s={}){var i;let n,r;e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_color_buffer_float")||(i=e.getExtension("WEBGL_lose_context"))==null||i.loseContext();let o=new Qh(ct(ct({},u_),s));const a=t.nodes.length,l=s.cx||t.nodes.reduce((_,f)=>_+(f.x||0),0)/a,d=s.cy||t.nodes.reduce((_,f)=>_+(f.y||0),0)/a,h=[l,d],u=kt(_=>{if(!n)throw new Error("No graph has been set");const{size:f}=n.bodyTexture;if(f[0]*f[1]<=1)return{X:[0],Y:[0]};const p=new Float32Array(4*f[0]*f[1]);e.readPixels(0,0,f[0],f[1],e.RGBA,e.FLOAT,p),_&&(c(),g());const x=p.filter((b,v)=>v%4==0).map(b=>b+l),y=p.filter((b,v)=>v%4==1).map(b=>b+d);return{X:x,Y:y}},"readLayoutData"),c=kt(()=>{r&&(r.stop(),r.destroy(),r=void 0)},"simulationCleanup"),g=kt(()=>{n&&(l_(e,n),n=void 0)},"graphLayoutCleanup"),m={setOptions:(_={})=>(o=new Qh(ct(ct({},u_),_)),n&&(c(),r=Pd(e,n,o)),m),setGraph:(_={nodes:[],edges:[]})=>(n&&l_(e,n),n=a_(e,o_(r_(_),h)),o&&(c(),r=Pd(e,n,o)),m),start:()=>{if(!r)throw new Error("No graph has been set");return r.start().finally(()=>{var _;return(_=s.onEnd)==null?void 0:_.call(s,1)}),m},stop:()=>(r&&r.stop(),m),step:()=>{if(!r)throw new Error("No graph has been set");return r.step(),m},data:_=>u(_),iterations:()=>1};return n=a_(e,o_(r_(t),h)),r=Pd(e,n,o),m}/**
* @preserve
* @linkurious/force-layout@0.7.0
* Ogma general-purpose force-directed layout
*/function m_(){var t=(()=>{var e=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,r=(M,k)=>e(M,"name",{value:k,configurable:!0}),o={};((M,k)=>{for(var N in k)e(M,N,{get:k[N],enumerable:!0})})(o,{IntegratorType:()=>Ge,default:()=>Vt});var a=class{constructor(M){let k=l();this.c=1,this.s0=k(" "),this.s1=k(" "),this.s2=k(" "),this.s0-=k(String(M)),this.s0<0&&(this.s0+=1),this.s1-=k(String(M)),this.s1<0&&(this.s1+=1),this.s2-=k(M),this.s2<0&&(this.s2+=1),k=null}next(){return()=>{const M=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=M-(this.c=0|M)}}nextDouble(){const M=this.next();return()=>M()+11102230246251565e-32*(2097152*M()|0)}nextInt32(){const M=this.next();return()=>4294967296*M()|0}};function l(){let M=4022871197;return k=>{k=k.toString();for(let N=0;N<k.length;N++){M+=k.charCodeAt(N);let F=.02519603282416938*M;M=F>>>0,F-=M,F*=M,M=F>>>0,F-=M,M+=4294967296*F}return 23283064365386963e-26*(M>>>0)}}function d(M){return new a(M.toString()).next()}r(a,"Alea"),r(l,"Mash"),r(d,"impl");var h=d(42);function u(M){h=d(M)}function c(){return 1e-6*(h()-.5)}function g(M,k,{sources:N,targets:F,X:U,Y:X,R:G,fx:q,fy:Y,degrees:B,weights:V},{edgeStrength:Z,edgeLength:tt}){for(let ot=0;ot<k.length;ot++){const J=k[ot],st=N[J],_t=F[J],Et=1,pt=B[st]+Et,gt=B[_t]+Et,At=Z*V[J];let ut=U[_t]+q[_t]-U[st]-q[st]||c(),yt=X[_t]+Y[_t]-X[st]-Y[st]||c();const Ft=ut*ut+yt*yt,Dt=Math.sqrt(Ft),zt=tt+G[st]+G[_t];if(Dt<=zt)continue;const Rt=zt-Dt,Jt=1/Math.min(pt,gt),ae=Math.min(1,M*At*(Rt*Rt/Ft)*Jt);ut*=ae,yt*=ae;const he=gt/(gt+pt);q[st]+=ut*he,Y[st]+=yt*he,q[_t]-=ut*(1-he),Y[_t]-=yt*(1-he)}}r(u,"setSeed"),r(c,"randomize"),r(g,"attraction");var m=r((M,{edgeIds:k,sources:N,targets:F,degrees:U,weights:X})=>{for(let G=0;G<M.length;G++){const{source:q,target:Y,weight:B=1}=M[G];N[G]=q,F[G]=Y,X[G]=B,U[q]++,U[Y]++,k[G]=G,X[G]=B===void 0?1:B}},"initialize");function _(M,k,{X:N,Y:F,fx:U,fy:X},{gravity:G,cx:q,cy:Y}){const B=k.length;for(let V=0;V<B;V++){const Z=k[V],tt=q-N[Z]||c(),ot=Y-F[Z]||c(),J=G*M;U[Z]+=tt*J,X[Z]+=ot*J}}g.initialize=m,r(_,"center");var f=r((M,k,N)=>{const{X:F,Y:U}=k;let X=N.cx,G=N.cy;const q=M.length;if(X===void 0||G===void 0){X=G=0;for(let Y=0;Y<q;Y++)X+=F[Y],G+=U[Y];X/=q,G/=q}N.cx=X,N.cy=G},"initialize");_.initialize=f;var p=class{constructor(M,k,N,F){this.left=null,this.right=null,this.data=null,this.code=M,this.data=k,this.left=N,this.right=F}};function x(M,k,N,F,U){const X=new p(null,null,null,null),G=[X],q=[F,U];for(;G.length!==0;){const Y=q.pop(),B=q.pop(),V=G.pop();if(Y-B==0)V.code=N[B],V.data=M[k[B]];else{const Z=v(k,N,B,Y);V.code=Z,B<=Z&&(V.left=new p(null,null,null,null),G.push(V.left),q.push(B,Z)),Y>Z&&(V.right=new p(null,null,null,null),G.push(V.right),q.push(Z+1,Y))}}return X}function y(M,k,N,F,U,X){const G=new p(null,null,null,null),q=[G],Y=[F,U];for(;q.length!==0;){const B=Y.pop(),V=Y.pop(),Z=q.pop();if(B-V<X){const tt=new Array(B-V+1);for(let ot=V,J=0;ot<=B;ot++,J++)tt[J]=M[k[ot]];Z.code=N[V],Z.data=tt}else{const tt=v(k,N,V,B);Z.code=tt,V<=tt&&(Z.left=new p(null,null,null,null),q.push(Z.left),Y.push(V,tt)),B>tt&&(Z.right=new p(null,null,null,null),q.push(Z.right),Y.push(tt+1,B))}}return G}r(p,"Node"),r(x,"buildIterative"),r(y,"buildIterativeBuckets");var b=Math.clz32||r(function(k){let N=-2147483648;for(let F=0;F<31;F+=1){if(N&k)return F;N>>>=1}return 32},"clz");function v(M,k,N,F){const U=k[M[N]],X=k[M[F]];if(U===X)return N;const G=b(U^X);let q,Y,B,V=N,Z=F-N;do Z=Z+1>>1,q=V+Z,q<F&&(Y=k[M[q]],B=b(U^Y),B>G&&(V=q));while(Z>1);return V}function E(M,k){let N=M^k,F=65535^N,U=65535^(M|k),X=M&(65535^k),G=N|F>>1,q=N>>1^N,Y=U>>1^F&X>>1^U,B=N&U>>1^X>>1^X;N=G,F=q,U=Y,X=B,G=N&N>>2^F&F>>2,q=N&F>>2^F&(N^F)>>2,Y^=N&U>>2^F&X>>2,B^=F&U>>2^(N^F)&X>>2,N=G,F=q,U=Y,X=B,G=N&N>>4^F&F>>4,q=N&F>>4^F&(N^F)>>4,Y^=N&U>>4^F&X>>4,B^=F&U>>4^(N^F)&X>>4,N=G,F=q,U=Y,X=B,Y^=N&U>>8^F&X>>8,B^=F&U>>8^(N^F)&X>>8,N=Y^Y>>1,F=B^B>>1;let V=M^k,Z=F|65535^(V|N);return V=16711935&(V|V<<8),V=252645135&(V|V<<4),V=858993459&(V|V<<2),V=1431655765&(V|V<<1),Z=16711935&(Z|Z<<8),Z=252645135&(Z|Z<<4),Z=858993459&(Z|Z<<2),Z=1431655765&(Z|Z<<1),(Z<<1|V)>>>0}r(v,"findSplit"),r(E,"hilbert");var A=[0,1],S=[0,2];for(let M=4;M<65535;M<<=2)for(let k=0,N=A.length;k<N;k++)A.push(A[k]|M),S.push((A[k]|M)<<1);function T(M,k){return(S[255&k]|A[255&M])+65536*(S[k>>8&255]|A[M>>8&255])+4294967296*(S[k>>16&255]|A[M>>16&255])}r(T,"morton");var L=new Uint32Array(1024);function I(M,k){const N=new Uint32Array(k.length);for(let U=0;U<1024;U++)L[U]=0;const F=255;for(let U=0;U<k.length;U++){const X=k[U];L[X&F]++,L[256+(X>>8&F)]++,L[512+(X>>16&F)]++,L[768+(X>>24&F)]++}for(let U=0;U<4;U++){let X=0,G=0;const q=256*U;for(let Y=0;Y<256;Y++)X=L[Y+q],L[Y+q]=G,G+=X}for(let U=0;U<k.length;U++){const X=k[U];N[L[X&F]++]=U}for(let U=0;U<k.length;U++){const X=N[U],G=k[X];M[L[256+(G>>8&F)]++]=X}for(let U=0;U<k.length;U++){const X=M[U],G=k[X];N[L[512+(G>>16&F)]++]=X}for(let U=0;U<k.length;U++){const X=N[U],G=k[X];M[L[768+(G>>24&F)]++]=X}}r(I,"radixSort");var R=class{constructor(M,{getX:k,getY:N,bucketSize:F=0,sfc:U=1}={}){this.bucketSize=0,this._root=null;const X=M.length,G=new Uint32Array(X);let q=1/0,Y=1/0,B=-1/0,V=-1/0;this._x=k,this._y=N;const Z=U===1?E:T;this._project=Z;const tt=new Uint32Array(X);for(let st=0;st<X;st++){const _t=M[st],Et=k(_t),pt=N(_t);Et<q&&(q=Et),pt<Y&&(Y=pt),Et>B&&(B=Et),pt>V&&(V=pt),tt[st]=st}this._minX=q,this._minY=Y,this._maxX=B,this._maxY=V;const ot=65535/Math.max(B-q,1),J=65535/Math.max(V-Y,1);this._hw=ot,this._hh=J;for(let st=0;st<X;st++){const _t=M[st];G[st]=Z(ot*(k(_t)-q),J*(N(_t)-Y))}I(tt,G),this._root=F===0?x(M,tt,G,0,X-1):y(M,tt,G,0,X-1,F),this.bucketSize=F}get root(){return this._root}inOrder(M,k){let N=this._root;const F=[];let U=!1;for(;!U;)if(N)F.push(N),N=N.left;else if(F.length!==0){if(N=F.pop(),M.call(k,N))break;N=N.right}else U=!0;return this}preOrder(M,k){const N=[this._root];for(;N.length!==0;){const F=N.pop();M.call(k,F)||(F.right&&N.push(F.right),F.left&&N.push(F.left))}return this}postOrder(M,k){const N=[];let F,U=this._root;do{for(;U;)U.right&&N.push(U.right),N.push(U),U=U.left;U=N.pop(),F=N.length-1,U.right&&N[F]===U.right?(N[F]=U,U=U.right):(M.call(k,U),U=null)}while(N.length!==0);return this}map(M,k){const N=[];return this.inOrder(F=>{N.push(M.call(k,F))}),N}height(){return z(this._root)}toString(M=k=>k.code.toString()){const k=[];return j(this._root,"",!0,N=>k.push(N),M),k.join("")}size(){let M=0;return this.preOrder(()=>{M++}),M}destroy(){return this._root=null,this}};function z(M){return M?1+Math.max(z(M.left),z(M.right)):0}function j(M,k,N,F,U){if(M){F(k+(N?"^-- ":"|-- ")+U(M)+`
`);const X=k+(N?"    ":"|   ");M.left&&j(M.left,X,!1,F,U),M.right&&j(M.right,X,!0,F,U)}}function C(M){for(let k=M.length-1;k>=0;k--){let N=Math.floor(Math.random()*(k+1));N=Math.max(Math.min(N,k),0);const F=M[k];M[k]=M[N],M[N]=F}return M}r(R,"BVH"),r(z,"treeHeight"),r(j,"row"),r(C,"shuffle");var w,H,K,it,xt,at,Tt,It,dt,bt=r(M=>M.x,"getX"),Ht=r(M=>M.y,"getY"),Qt=r(M=>M.r,"getR");function Xt(M,k=bt,N=Ht,F=Qt){const U=C(M.slice()),X=U.length;let G,q=[],Y=0;for(;Y<X;){const B=U[Y];G&&te(G,k(B),N(B),F(B))?Y++:(q=mt(q,B,k,N,F),G=se(q,k,N,F),Y=0)}return G}function mt(M,k,N,F,U){const X=N(k),G=F(k),q=U(k),Y={x:X,y:G,r:q};if(qt(Y,M,N,F,U))return[k];for(let B=0;B<M.length;++B){const V=M[B],Z=N(V),tt=F(V),ot=U(V);if(!ft(Y,Z,tt,ot)&&qt($(Z,tt,ot,X,G,q),M,N,F,U))return[M[B],k]}for(let B=0;B<M.length-1;B++)for(let V=B+1;V<M.length;V++){const Z=M[B],tt=M[V],ot=N(Z),J=F(Z),st=U(Z),_t=N(tt),Et=F(tt),pt=U(tt);if(!ft($(ot,J,st,_t,Et,pt),X,G,q)&&!ft($(ot,J,st,X,G,q),_t,Et,pt)&&!ft($(_t,Et,pt,X,G,q),ot,J,st)&&qt(et(ot,J,st,_t,Et,pt,X,G,q),M,N,F,U))return[M[B],M[V],k]}throw new Error}function ft(M,k,N,F){const U=M.r-F,X=k-M.x,G=N-M.y;return U>=0&&U*U>X*X+G*G}function te(M,k,N,F){const U=M.r-F+1e-6,X=k-M.x,G=N-M.y;return U>0&&U*U>X*X+G*G}function qt(M,k,N,F,U){for(let X=0;X<k.length;++X){const G=k[X];if(!te(M,N(G),F(G),U(G)))return!1}return!0}function se(M,k,N,F){return M.length===1?ee(k(M[0]),N(M[0]),F(M[0])):M.length===2?$(k(M[0]),N(M[0]),F(M[0]),k(M[1]),N(M[1]),F(M[1])):et(k(M[0]),N(M[0]),F(M[0]),k(M[1]),N(M[1]),F(M[1]),k(M[2]),N(M[2]),F(M[2]))}function ee(M,k,N){return{x:M,y:k,r:N}}function $(M,k,N,F,U,X){const G=F-M,q=U-k,Y=X-N,B=Math.sqrt(G*G+q*q);return{x:(M+F+G/B*Y)/2,y:(k+U+q/B*Y)/2,r:(B+N+X)/2}}function et(M,k,N,F,U,X,G,q,Y){const B=M-F,V=M-G,Z=k-U,tt=k-q,ot=X-N,J=Y-N,st=M*M+k*k-N*N,_t=st-F*F-U*U+X*X,Et=st-G*G-q*q+Y*Y,pt=V*Z-B*tt,gt=(Z*Et-tt*_t)/(2*pt)-M,At=(tt*ot-Z*J)/pt,ut=(V*_t-B*Et)/(2*pt)-k,yt=(B*J-V*ot)/pt,Ft=At*At+yt*yt-1,Dt=2*(N+gt*At+ut*yt),zt=gt*gt+ut*ut-N*N,Rt=-(Ft?(Dt+Math.sqrt(Dt*Dt-4*Ft*zt))/(2*Ft):zt/Dt);return{x:M+gt+At*Rt,y:k+ut+yt*Rt,r:Rt}}function ht(M,k,N,{X:F,Y:U,R:X,fx:G,fy:q,bucketSize:Y},{elasticity:B}){if(B===0)return N;N||(N=new R(k,{getX:w,getY:H,bucketSize:Y})).postOrder(it);for(let V=0;V<k.length;V++)at=k[V],Tt=F[at]+G[at],It=U[at]+q[at],dt=X[at],N.preOrder(xt);return N}r(Xt,"med"),r(mt,"extend"),r(ft,"contains"),r(te,"containsWeak"),r(qt,"containsWeakAll"),r(se,"enclose"),r(ee,"from1"),r($,"from2"),r(et,"from3"),r(ht,"collisionForce");var lt,rt,nt,Lt,St,wt,Wt,Ut,ye,me=r(({X:M,Y:k,R:N,bucketSize:F})=>U=>{let X,G,q,Y;const B=U.data;if(B!==null)if(F!==0){const V=Xt(B,w,H,K);X=V.x,G=V.y,q=V.r}else{const V=B;X=M[V],G=k[V],q=N[V]}else if(U.left&&U.right){const V=U.left.cx,Z=U.left.cy,tt=U.right.cx,ot=U.right.cy,J=U.left.r,st=U.right.r,_t=tt-V,Et=ot-Z,pt=st-J,gt=Math.sqrt(_t*_t+Et*Et);X=(V+tt+_t/gt*pt)/2,G=(Z+ot+Et/gt*pt)/2,q=(gt+J+st)/2}else Y=U.left||U.right,Y&&(X=Y.cx,G=Y.cy,q=Y.r);U.cx=X,U.cy=G,U.r=q},"getMeasureBodies"),_e=r(({X:M,Y:k,R:N,fx:F,fy:U,bucketSize:X},{elasticity:G,margin:q})=>Y=>{const B=Y.data;if(B===null){const V=Y.cx-Tt,Z=Y.cy-It,tt=Y.r+dt;return V*V+Z*Z>tt*tt}if(X!==0){const V=B;for(let Z=0;Z<V.length;Z++){const tt=V[Z];if(tt>at){const ot=N[tt];let J=Tt-M[tt]-F[tt],st=It-k[tt]-U[tt];const _t=dt+ot+q;let Et=J*J+st*st;if(Et<_t*_t){J===0&&(J=c(),Et+=J*J),st===0&&(st=c(),Et+=st*st);const pt=Math.sqrt(Et),gt=(_t-pt)*G/pt,At=ot/_t;F[at]+=J*gt*At,U[at]+=st*gt*At,F[tt]-=J*gt*(1-At),U[tt]-=st*gt*(1-At)}}}}else{const V=Y.data;if(V>at){const Z=N[V];let tt=Tt-M[V],ot=It-k[V];const J=dt+Z+q;let st=tt*tt+ot*ot;if(st<J*J){tt===0&&(tt=c(),st+=tt*tt),ot===0&&(ot=c(),st+=ot*ot);const _t=Math.sqrt(st),Et=(J-_t)*G/_t,pt=Z/J;F[at]+=tt*Et*pt,U[at]+=ot*Et*pt,F[V]-=tt*Et*(1-pt),U[V]-=ot*Et*(1-pt)}}}},"getApplyForce"),Ee=r((M,k,N)=>{const{X:F,Y:U,R:X}=k;w=r(G=>F[G],"getX"),H=r(G=>U[G],"getY"),K=r(G=>X[G],"getR"),it=me(k),xt=_e(k,N)},"initialize");function Fe(M,k,{masses:N,X:F,Y:U,fx:X,fy:G},{charge:q}){const Y=k.length;let B,V,Z,tt,ot,J,st,_t,Et;for(let pt=0;pt<Y;pt++){B=k[pt];for(let gt=pt+1;gt<Y;gt++)if(pt!==gt){if(V=k[gt],B===V)continue;Z=F[B]-F[V]||c(),tt=U[B]-U[V]||c(),ot=Z*Z+tt*tt,ot<1&&(ot=Math.sqrt(1*ot)),J=q*N[V],st=M*J/ot,_t=q*N[B],Et=M*_t/ot,X[B]+=Z*st,G[B]+=tt*st,X[V]-=Z*Et,G[V]-=tt*Et}}}ht.initialize=Ee,r(Fe,"repulsion"),Fe.initialize=()=>{};var Zt=0;function de(M,k,N,{X:F,Y:U,R:X,bucketSize:G}){Zt=M,N===null&&(N=new R(k,{getX:nt,getY:Lt,bucketSize:G})).postOrder(lt);const q=k.length;for(let Y=0;Y<q;Y++)wt=k[Y],Wt=F[wt],Ut=U[wt],ye=X[wt],N.preOrder(rt);return N}r(de,"repulsion");var Ae=r(({fx:M,fy:k,X:N,Y:F,R:U,masses:X,bucketSize:G},{charge:q,theta:Y})=>B=>{let V=0,Z=0,tt=Wt-B.cx||c(),ot=Ut-B.cy||c(),J=tt*tt+ot*ot,st=ye+B.r;const _t=B.data;if(_t!==null){if(_t===wt)return!1;if(G!==0){const Et=_t;for(let pt=0;pt<Et.length;pt++){const gt=Et[pt];gt!==wt&&(tt=Wt-N[gt]||c(),ot=Ut-F[gt]||c(),J=tt*tt+ot*ot,st=ye+U[gt],J<1&&(J=Math.sqrt(1*J)),V=q*X[gt],Z=Zt*V/J,M[wt]+=tt*Z,k[wt]+=ot*Z)}}else J<1&&(J=Math.sqrt(1*J)),V=q*B.mass,Z=Zt*V/J,M[wt]+=tt*Z,k[wt]+=ot*Z}else{const Et=st/Y;if(J>Et*Et)return J<1&&(J=Math.sqrt(1*J)),V=q*B.mass,Z=Zt*V/J,M[wt]+=tt*Z,k[wt]+=ot*Z,!0}},"getApplyForce"),pe=r(({X:M,Y:k,R:N,masses:F,bucketSize:U})=>X=>{let G,q,Y=0,B=0,V=0,Z=0;const tt=X.data;if(tt!==null)if(U!==0){const ot=tt,J=Xt(ot,nt,Lt,St);Y=J.x,B=J.y,V=J.r;for(let st=0;st<ot.length;st++)Z+=F[ot[st]]}else q=tt,Y=M[q],B=k[q],V=N[q],Z=F[q];else if(X.left&&X.right){const ot=X.left.cx,J=X.left.cy,st=X.right.cx,_t=X.right.cy,Et=X.left.r,pt=X.right.r,gt=st-ot,At=_t-J,ut=pt-Et,yt=Math.sqrt(gt*gt+At*At);Y=(ot+st+gt/yt*ut)/2,B=(J+_t+At/yt*ut)/2,V=(yt+Et+pt)/2,Z=X.left.mass+X.right.mass}else G=X.left||X.right,Y=G.cx,B=G.cy,V=G.r,Z=G.mass;X.cx=Y,X.cy=B,X.r=V,X.mass=Z},"getAccumulateBodies"),ie=r((M,k,N)=>{const F=M.length,{X:U,Y:X,R:G,degrees:q,pinned:Y,masses:B,nodeIds:V}=k,{scaling:Z,defaultRadius:tt,bucketSize:ot}=N;k.bucketSize=ot===void 0?Math.floor(Math.log(F)):ot;let J=1/0,st=1/0,_t=-1/0,Et=-1/0;const pt=Math.PI*(3-Math.sqrt(5));let gt=0;for(let At=0;At<M.length;At++){const ut=M[At];let{x:yt,y:Ft,r:Dt}=ut;const{mass:zt}=ut;if(isNaN(yt)||isNaN(Ft)){const Rt=5*Math.sqrt(At),Jt=At*pt;yt=Rt*Math.cos(Jt),Ft=Rt*Math.sin(Jt)}Dt=Dt||tt,U[At]=yt,X[At]=Ft,G[At]=Dt,Y[At]=ut.pinned?1:0,B[At]=zt===void 0?(1+q[At])*Z:zt,V[At]=At,Dt>gt&&(gt=Dt),yt<J&&(J=yt),Ft<st&&(st=Ft),yt>_t&&(_t=yt),Ft>Et&&(Et=Ft)}if(M.length>1&&(_t-J<2*gt||Et-st<2*gt)){const At=(J+_t)/2,ut=(st+Et)/2;for(let yt=0;yt<F;yt++)if(!Y[yt]){const Ft=5*Math.sqrt(yt),Dt=yt*pt,zt=At+Ft*Math.cos(Dt),Rt=ut+Ft*Math.sin(Dt);U[yt]=zt,X[yt]=Rt,zt<J&&(J=zt),Rt<st&&(st=Rt),zt>_t&&(_t=zt),Rt>Et&&(Et=Rt)}}nt=r(At=>U[At],"getX"),Lt=r(At=>X[At],"getY"),St=r(At=>G[At],"getR"),lt=pe(k),rt=Ae(k,N)},"initialize");function Le(M,k,{X:N,Y:F,fx:U,fy:X,vx:G,vy:q,masses:Y,pinned:B},V){let Z=0,tt=0;const ot=M.length,J=1/8;for(let st=0;st<ot;st++){const _t=M[st],Et=Y[_t],pt=U[_t]/Et,gt=X[_t]/Et;G[_t]+=pt*J,q[_t]+=gt*J;const At=.2*G[_t]*J+.5*pt*J*J,ut=.2*q[_t]*J+.5*gt*J*J;U[_t]=X[_t]=0,B[_t]||(N[_t]+=At,F[_t]+=ut,Z+=Math.abs(At)*Et,tt+=Math.abs(ut)*Et)}return(Z*Z+tt*tt)/ot}function xe(M,k,{X:N,Y:F,fx:U,fy:X,vx:G,vy:q,pinned:Y,masses:B},V){const Z=M.length;let tt=0;for(let ot=0;ot<Z;ot++){const J=M[ot],st=B[J],_t=U[J]/st,Et=X[J]/st,pt=G[J]+1*_t,gt=q[J]+1*Et;let At=1*pt,ut=1*gt;At>1e4&&(At=.1),ut>1e4&&(ut=.1),G[J]=k*(pt+G[J])/2,q[J]=k*(gt+q[J])/2,U[J]=X[J]=0,Y[J]||(N[J]+=At,F[J]+=ut),tt+=.5*(At*At+ut*ut)}return tt}function ke(M,k,{X:N,Y:F,fx:U,fy:X,pinned:G,layer:q,layers:Y,surfaces:B,movements:V},{maxDisplacement:Z}){V.fill(0);let tt=0;const ot=M.length;let J=1/0,st=1/0,_t=-1/0,Et=-1/0;const pt=Z*Z;for(let ut=0;ut<ot;ut++){const yt=M[ut],Ft=U[yt]*=k,Dt=X[yt]*=k,zt=q[yt];let Rt=Ft,Jt=Dt;const ae=N[yt],he=F[yt];if(Rt*Rt+Jt*Jt>pt){const Ze=Math.sqrt(Rt*Rt+Jt*Jt)/Z;Jt/=Ze,Rt/=Ze}G[yt]||(N[yt]+=Rt,F[yt]+=Jt);const Ce=Math.sqrt(Rt*Rt+Jt*Jt);G[yt]||(ae<J&&(J=ae),he<st&&(st=he),ae>J&&(_t=ae),he>st&&(Et=he),V[zt-1]+=Ce),tt+=zt*Ce}const gt=Math.max(_t-J,0),At=Math.max(Et-st,0);for(let ut=0;ut<Y.length;ut++){const yt=Y[ut],Ft=yt.length;let Dt=1/0,zt=1/0,Rt=-1/0,Jt=-1/0,ae=0;for(let Je=0;Je<Ft;Je++){const Ls=yt[Je];if(G[Ls])continue;const ze=N[Ls],As=F[Ls];ze<Dt&&(Dt=ze),As<zt&&(zt=As),ze>Rt&&(Rt=ze),As>Jt&&(Jt=As),ae++}const he=Rt-Dt,Ce=Jt-zt,Ze=Math.max(1,Math.sqrt(he**2+Ce**2));B[ut]=Ze;const Es=ae===0?0:V[ut]/ae,Qe=gt*At||1;V[ut]=Es>ae?Es/Qe:0}return tt}function bs(M,k,N){ne(M,k,N),re(N)}function ne(M,k,{sources:N,targets:F,degrees:U,nodeIds:X,edgeIds:G}){const q={};for(let Y=0;Y<M.length;Y++)q[Y]=X[Y]=Y;for(let Y=0;Y<k.length;Y++){const{source:B,target:V}=k[Y],Z=q[B],tt=q[V];G[Y]=Y,N[Y]=Z,F[Y]=tt,U[Z]++,U[tt]++}}function re({nodeIds:M,edgeIds:k,sources:N,targets:F,degrees:U,layer:X,layers:G,component:q,components:Y,cluster:B,parent:V}){let Z=0,tt=1;const ot=new Uint32Array(M.length);for(let gt=0;gt<M.length;gt++)ot[gt]=U[gt];const J=new Array(M.length);for(let gt=0;gt<k.length;gt++){const At=k[gt],ut=N[At],yt=F[At];J[ut]=J[ut]||[],J[yt]=J[yt]||[],J[ut].push(yt),J[yt].push(ut)}const st=new Uint8Array(M.length),_t=new Uint8Array(M.length);V.fill(-1);let Et=0;for(let gt=0;gt<M.length;gt++)if(st[gt]===0){const At=[gt];for(;At.length!==0;){const ut=At.pop();if(st[ut]===0&&J[ut]!==void 0){const yt=J[ut];for(let Ft=0;Ft<yt.length;Ft++)At.push(yt[Ft])}st[ut]=1,q[ut]=Et}Et++}const pt=new Array(M.length);for(let gt=0;gt<M.length;gt++)X[gt]=0,pt[gt]=gt;for(;pt.length!==0;){const gt=[],At=[];for(let ut=0;ut<pt.length;ut++)ot[pt[ut]]<=Z&&(gt.push(ut),At.push(pt[ut]));for(let ut=0;ut<At.length;ut++){const yt=At[ut];_t[yt]=Z,X[yt]=tt;const Ft=J[yt];if(Ft)for(let Dt=0;Dt<Ft.length;Dt++)ot[Ft[Dt]]--}for(let ut=0;ut<At.length;ut++){const yt=At[ut],Ft=J[yt];if(Ft)for(let Dt=0;Dt<Ft.length;Dt++){const zt=Ft[Dt],Rt=X[zt];if(Rt===void 0||Rt>tt){V[yt]=zt;break}}}gt.reverse();for(let ut=0;ut<gt.length;ut++)pt.splice(gt[ut],1);if(tt+=1,pt.length>0){let ut=1/0;for(let yt=0;yt<pt.length;yt++){const Ft=ot[pt[yt]];Ft<ut&&(ut=Ft)}ut>=Z+1&&(Z=ut,tt=1)}}st.fill(0);for(let gt=0;gt<M.length;gt++){const At=M[gt],ut=X[At];if(V[At]===-1||X[V[At]]===ut){const yt=[At];for(st.fill(0);yt.length!==0;){const Ft=yt.pop();if(st[Ft])continue;if(X[Ft]>ut){V[At]=Ft;break}const Dt=J[Ft];if(st[Ft]=1,Dt)for(let zt=0;zt<Dt.length;zt++)yt.push(Dt[zt])}}}for(let gt=0;gt<M.length;gt++){const At=M[gt],ut=q[At];Y[ut]=Y[ut]||[],Y[ut].push(At);const yt=X[At]-1;G[yt]=G[yt]||[],G[yt].push(At),B[At]=V[At]}}de.initialize=ie,r(Le,"euler"),r(xe,"leapfrog"),r(ke,"velocityVerlet"),r(bs,"default"),r(ne,"initTopology"),r(re,"decomposition");var oe=class{constructor(M,k=!0){this.bucketSize=0;const N=M.nodes.length,F=M.edges.length;u(N+F),this.X=new Array(N),this.Y=new Array(N),this.R=new Array(N),this.fx=new Float32Array(N),this.fy=new Float32Array(N),this.vx=new Float32Array(N),this.vy=new Float32Array(N),this.pinned=new Uint8Array(N),this.masses=new Float32Array(N),this.weights=new Float32Array(F),this.lengths=new Float32Array(F),this.sources=new Uint32Array(F),this.targets=new Uint32Array(F),this.degrees=new Uint32Array(N),this.layer=new Uint32Array(N),this.parent=new Int32Array(N),this.cluster=new Int32Array(N),this.component=new Uint32Array(N),this.components=[],this.layers=[],this.nodeIds=new Array(N),this.edgeIds=new Array(F),k&&bs(M.nodes,M.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)}};function De(M,k){return M<k?M*k+Math.pow(k-M-1,2)/4:M*k+Math.pow(M-k-1,2)/4}function Re(M,k){return(M+k)*(M+k+1)/2+k}function Ke({edgeIds:M,sources:k,targets:N,pinned:F,degrees:U,X,Y:G,R:q},Y=0,B=.5){const V={},Z={};for(const tt of M){const ot=k[tt],J=N[tt];ot!==J&&(V[ot]=V[ot]||{},V[J]=V[J]||{},V[ot][J]=!0,V[J][ot]=!0)}Object.keys(V).forEach(tt=>{const ot=Number(tt),J=Object.keys(V[Number(ot)]);if(J.length===2){const[st,_t]=J,Et=De(Number(st),Number(_t));Et in Z||(Z[Et]=[Number(_t),Number(st)]),F[ot]||Z[Et].push(ot)}}),Object.keys(Z).forEach(tt=>{const[ot,J,...st]=Z[Number(tt)];if(st.length<3)return;const _t=X[ot],Et=G[ot],pt=X[J],gt=G[J],At=U[ot],ut=.25+.5*At/(At+U[J]);let yt=_t+(pt-_t)*ut,Ft=Et+(gt-Et)*ut,Dt=-(gt-Et),zt=pt-_t;const Rt=Math.sqrt(Math.pow(_t-pt,2)+Math.pow(Et-gt,2));Dt=-2*Dt/Rt,zt=-2*zt/Rt;const Jt=Math.acos(Dt/Math.sqrt(Dt*Dt+zt*zt));Y>0&&(Jt<Y||Jt>Math.PI-Y&&Jt<=Math.PI?(Dt=2*Math.cos(Math.PI-Y),zt=2*Math.sin(Math.PI-Y)):(Jt>2*Math.PI-Y||Jt>=Math.PI&&Jt<Math.PI+Y)&&(Dt=2*Math.cos(Y),zt=2*Math.sin(Y)));let ae=0,he=1;st.sort((Je,Ls)=>q[Ls]-q[Je]);let Ce=0,Ze=0;const Es=Math.max(q[st[0]],q[st[1]])/2;st.length%2==1&&(ae=1,yt-=Dt*Es,Ft-=zt*Es);const Qe=1+B;for(let Je=0;Je<st.length;Je++){const Ls=(ae+Je)%2,ze=st[Je],As=Je>=2?q[ze]:Es,ws=(Ls?Ce:Ze)+As;X[ze]=yt+Dt*he*ws,G[ze]=Ft+zt*he*ws,Ls?Ce+=As*Qe:Ze+=As*Qe,he=-he}})}function cs(M){let k=0,N=0;for(const G of M)k+=G.w*G.h,N=Math.max(N,G.w);M.sort((G,q)=>q.h-G.h);const F=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(k/.95)),N),h:1/0}];let U=0,X=0;for(const G of M)for(let q=F.length-1;q>=0;q--){const Y=F[q];if(!(G.w>Y.w||G.h>Y.h)){if(G.x=Y.x,G.y=Y.y,X=Math.max(X,G.y+G.h),U=Math.max(U,G.x+G.w),G.w===Y.w&&G.h===Y.h){const B=F.pop();q<F.length&&(F[q]=B)}else G.h===Y.h?(Y.x+=G.w,Y.w-=G.w):G.w===Y.w?(Y.y+=G.h,Y.h-=G.h):(F.push({x:Y.x+G.w,y:Y.y,w:Y.w-G.w,h:G.h}),Y.y+=G.h,Y.h-=G.h);break}}}function Oe(M,k=1){return cs(M.map(N=>(N.w+=N.maxr+k,N.h+=N.maxr+k,N)).sort((N,F)=>N.w*N.h-F.w*F.h))}r(oe,"LayoutData"),r(De,"unorderedPair"),r(Re,"orderedPair"),r(Ke,"alignSiblings"),r(cs,"potpack"),r(Oe,"boxpack");var qe=class{constructor(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}add(M,k,N,F){this.ids.push(M),k-F<this.xmin&&(this.xmin=k-F),N-F<this.ymin&&(this.ymin=N-F),k+F>this.xmax&&(this.xmax=k+F),N+F>this.ymax&&(this.ymax=N+F),F>this.maxr&&(this.maxr=F),this.mx+=F*k,this.my+=F*N,this.m+=F}measure(M=0){return this.w=this.xmax-this.xmin+2*M,this.h=this.ymax-this.ymin+2*M,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this}};function vs(M,k=20,N,F,U){for(const J of M){const{x:st,y:_t,r:Et}=Xt(J.ids,pt=>N[pt],pt=>F[pt],pt=>U[pt]);J.cx=st,J.cy=_t,J.radius=Et+k}const X=M.slice().sort((J,st)=>J.radius-st.radius),G=X.map(J=>({x:J.cx,y:J.cy,r:J.radius})),q=X.pop();let Y=3*Math.PI/2,B=q.radius;const V=2*Math.PI,{cx:Z,cy:tt}=q,ot=[q];for(;X.length!==0;){const J=X[X.length-1],st=B+J.radius,_t=Z+Math.cos(Y)*st,Et=tt+Math.sin(Y)*st;ot.some(pt=>{const gt=pt.cx-_t,At=pt.cy-Et;return Math.sqrt(gt*gt+At*At)<pt.radius+J.radius})?B+=1:(J.x=_t-J.w/2,J.y=Et-J.h/2,J.cx=_t,J.cy=Et,G[X.length-1].x=_t,G[X.length-1].y=Et,ot.push(X.pop()),Y+=(2*J.radius+1)/st*1%V)}}function qs(M,k,N,F){let U=0;const X=[];for(const G of F){const q=new qe;for(const Y of G)q.add(Y,M[Y],k[Y],N[Y]);X.push(q.measure()),G.length>X[U].ids.length&&(U=X.length-1)}return{boxes:X,biggest:U}}function fe(M,k,{X:N,Y:F,R:U,components:X,pinned:G,degrees:q,sources:Y,targets:B,edgeIds:V},{update:Z,onUpdate:tt,placement:ot,placementOffset:J,alignSiblings:st,siblingsMinAngle:_t,siblingsOffset:Et}){if(st&&(Ke({X:N,Y:F,R:U,degrees:q,pinned:G,sources:Y,targets:B,edgeIds:V},_t,Et),Z(M,N,F)),ot){const{boxes:pt,biggest:gt}=qs(N,F,U,X);if(ot==="spiral")vs(pt,J,N,F,U);else{if(ot!=="box")return;Oe(pt,J)}const At=pt[gt].xmin-pt[gt].x,ut=pt[gt].ymin-pt[gt].y;for(const yt of pt){const{xmin:Ft,ymin:Dt,x:zt,y:Rt,ids:Jt}=yt,ae=Ft-zt-At,he=Dt-Rt-ut;for(const Ce of Jt)N[Ce]-=ae,F[Ce]-=he}Z(M,N,F),tt()}}r(qe,"Component"),r(vs,"spiralpack"),r(qs,"groupAndMeasure"),r(fe,"postprocessing");var Ge=(M=>(M[M.verlet=0]="verlet",M[M.euler=1]="euler",M))(Ge||{}),We=0,P=typeof window>"u",D=typeof performance<"u"&&performance.now?performance:Date,W=P?M=>{const k=D.now(),N=Math.max(0,16-(k-We)),F=setTimeout(()=>M(k+N),N);return We=k+N,F}:window.requestAnimationFrame,O=P?M=>clearTimeout(M):window.cancelAnimationFrame;function Q(M,k,N){for(let F=0;F<M.length;F++){const U=M[F];U.x=k[F],U.y=N[F]}}r(Q,"defaultUpdate");var vt=r(()=>{},"noop"),Pt={movementRatio:7e-8,surfaceRatio:.0025},Ct=class{constructor(M={}){this.onUpdate=r(k=>{},"onUpdate"),this.update=Q,this.nextTick=W,this.cancelTick=O,this.onEnd=vt,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=Pt,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in M?M.autoStop&&(typeof M.autoStop=="boolean"?M.autoStop=Pt:M.autoStop=ct(ct({},M.autoStop),Pt)):M.steps;for(const k in M)M[k]===void 0&&k!=="order"&&k!=="depth"||(this[k]=M[k])}};function Nt(M,k,{X:N,Y:F,R:U,degrees:X,nodeIds:G,edgeIds:q,layers:Y,layer:B,cluster:V,masses:Z,weights:tt,sources:ot,targets:J},{cx:st,cy:_t,nextTick:Et,cancelTick:pt,update:gt,onUpdate:At,batch:ut,maxIterations:yt,steps:Ft,minMovement:Dt},zt,Rt){const Jt=Y.slice();ut=ut??1;let ae,he=0;function Ce(){pt(ae),gt(M,N,F),At(),Rt(he)}r(Ce,"stop");const Ze={};for(let is=0;is<k.length;is++)Ze[Number(k[is].id)||is]=is;const Es=new Map;for(let is=0;is<q.length;is++){const Zs=q[is];Es.set(Re(ot[Zs],J[Zs]),Zs)}for(let is=0;is<Y.length;is++){const Zs=Y[is],Ii=is;for(let Us=0;Us<Zs.length;Us++){const $e=Zs[Us],Xe=V[$e];Xe!==-1&&(Z[Xe]+=Z[$e])}for(let Us=0;Us<k.length;Us++){const $e=k[Us],Xe=Number($e.id)||Us,Js=$e.source,tn=$e.target,Do=tt[Ze[Xe]];if(B[Js]===Ii&&B[tn]===Ii){const Mc=V[Js],Nc=V[tn];if(Mc!==Nc){const Pc=Es.get(Re(Mc,Nc));Pc!==void 0&&(tt[Pc]+=Do)}}}}G.length=0,q.length=0,yt=1/0;let Qe=1;const Je=1-Math.pow(.1,1/Ft/2),Ls=(Qe-.1)/Ft;let ze,As,ws=.5;function Ql(){Qe+=(0-Qe)*Je;const is=zt(Qe,G,q);let Zs=Qe<=ws||is<Dt;if(he===0||Zs){const Ii=Jt.pop();if(Ii){ze&&(As=ze.reduce(($e,Xe)=>Math.max($e,st-N[Xe],_t-F[Xe]),0)),G.push.apply(G,Ii);for(let $e=0;$e<Ii.length;$e++){const Xe=Ii[$e],Js=V[Xe];if(Js!==-1){const tn=X[Xe]>1?2:1,Do=U[Js]+U[Xe];Z[Js]-=Z[Xe],N[Xe]=N[Js]+tn*Do*(2*h()-1),F[Xe]=F[Js]+tn*Do*(2*h()-1)}else ze&&(N[Xe]=st+2*As*(1-2*h()),F[Xe]=_t+2*As*(1-2*h()))}ze=Ii;const Us=G.reduce(($e,Xe)=>($e[Xe]=!0,$e),{});q.length=0;for(let $e=0;$e<k.length;$e++){const{source:Xe,target:Js,id:tn}=k[$e];Us[Xe]&&Us[Js]&&q.push(Ze[Number(tn)])}Zs=!1,Jt.length===0?(Qe=.2,ws=.1):(Qe=.1+2*Ls,ws=.1)}}he%ut==0&&(gt(M,N,F),At()),++he>=yt||Zs?Ce():ae=Et(Ql)}return r(Ql,"simulationStep"),{done:!1,start(){return ae=setTimeout(Ql),this},stop(){return Ce(),this},get iterations(){return he}}}r(Ct,"Settings"),r(Nt,"multiLevel");var Ot=class{constructor(M){this.promise=new Promise(M)}then(M){return this.promise.then(M)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function jt(M,k,{X:N,Y:F,nodeIds:U,edgeIds:X,layers:G,movements:q,movementsPrev:Y,surfaces:B,surfacesPrev:V},Z,tt,ot){var J;const{nextTick:st,cancelTick:_t,steps:Et,minMovement:pt,update:gt,onUpdate:At,autoStop:ut}=Z,yt=(J=Z.batch)!=null?J:1;let Ft=0,Dt=1,zt,Rt=1-Math.pow(.05,1/Et),Jt=!1;const ae=r(()=>{Jt=!0,_t(zt),At(),ot(Ft)},"stop");let he=!1;const Ce=r(()=>{Dt+=(.001-Dt)*Rt;const Ze=tt(Dt,U,X),Es=G.length;let Qe=!1,Je=!1;if(ut){Qe=Je=!0;const{movementRatio:ze,surfaceRatio:As}=ut;for(let ws=0;ws<Es;ws++)Qe&&Math.abs(1-B[ws]/V[ws])>As&&(Qe=!1),Je&&Math.abs(q[ws]-Y[ws])>ze&&(Je=!1)}Qe&&Je&&!he&&(Rt=1-Math.pow(.001,1/Math.max(10,Ft)),he=!0);const Ls=Jt||Dt<.05||Ze!==0&&Ze<=pt;if(Ft%yt==0&&(gt(M,N,F),At()),++Ft>=Et||Ls)return ae();for(let ze=0;ze<Es;ze++)Y[ze]=q[ze],V[ze]=B[ze];zt=st(Ce)},"simulationStep");return{done:!1,start(){return zt=setTimeout(Ce),this},stop(){return ae(),this},get iterations(){return Ft}}}r(Ot,"SimulationPromise"),r(jt,"singleLevel");var Yt,Gt={euler:Le,verlet:ke,leapfrog:xe};function Vt(M,k={}){let N,F;const U=r((tt={nodes:[],edges:[]})=>(N=tt.nodes,F=tt.edges,u(Re(N.length,F.length)),new oe(tt,!0)),"setGraph"),X=r((tt={})=>new Ct(tt),"setOptions");let G=U(M),q=X(k);m(F,G),ie(N,G,q),Ee(N,G,q),f(N,G,q);const Y=Gt[q.integrator]||ke;let B=null;const V=r((tt,ot,J)=>(B&&(B.destroy(),B=null),ot.length<=1?0:(q.barnesHutOptimization?B=de(tt,ot,B,G):Fe(tt,ot,G,q),g(tt,J,G,q),B&&q.elasticity!==0&&ht(0,ot,B,G,q),_(tt,ot,G,q),Y(ot,q.inertia,G,q))),"step");let Z;return{setOptions:(tt={})=>(q=X(tt),this),setGraph:({nodes:tt,edges:ot})=>(G=U(M),m(ot,G),ie(tt,G,q),Ee(tt,G,q),f(tt,G,q),this),start(){return Z=(q.multilevel?Nt:jt)(N,F,G,q,V,tt=>{Z.done||fe(N,0,G,q),q.onEnd(tt),Z.done=!0}).start(),this},iterations:()=>Z.iterations,data:()=>G,stop(){return Z&&Z.stop(),this},step(tt=1){return V(tt,G.nodeIds,G.edgeIds),q.update(N,G.X,G.Y),this}}}return r(Vt,"force"),Vt.run=(M,k)=>{let N;const F=new Ot(U=>{k.onEnd=U,N=Vt(M,k).start()});return F.simulation=N,F.stop=()=>(N.stop(),F),F},Yt=o,((M,k,N,F)=>{if(k&&typeof k=="object"||typeof k=="function")for(let U of i(k))n.call(M,U)||U===N||e(M,U,{get:()=>k[U],enumerable:!(F=s(k,U))||F.enumerable});return M})(e({},"__esModule",{value:!0}),Yt)})();return t.default.apply(this,arguments)}kt(g_,"SimulationPromise"),kt(Ha,"gpuLayout"),Ha.run=(t,e,s)=>{let i;const n=new g_(r=>{s.onEnd=r,i=Ha(t,e,s).start()});return n.simulation=i,n.stop=()=>(i.stop(),n),n};var rM=2,oM=1.25,__={name:"force",imports:{force:m_},configure(t,{graph:e,events:s}){const i=t.nodes._indexes,n=e.getNodeAttribute("x").getMultiple(i),r=e.getNodeAttribute("y").getMultiple(i),o=e.getNodeAttribute("radius").getMultiple(i),a=e.getNodeAttribute("layoutable").getMultiple(i),l=t.edges,d=[],h=[],u={};t.edgeStrength===void 0&&(t.edgeStrength=.5),t.gpu&&(t.edgeStrength/=rM),t.gravity==null&&(t.gravity=.01),t.siblingsOffset==null&&(t.siblingsOffset=0),t.theta==null&&(t.theta=.62),t.autoStop=!!t.autoStop,t.alignSiblings=!!t.alignSiblings;const c=t.radiusRatio||oM;for(let m=0;m<t.nodes._indexes.length;m++){const _=t.nodes._indexes[m];u[_]=m,d.push({id:m,x:n[m],y:r[m],r:o[m]*c,pinned:!a[m]})}l.forEach(m=>{const _=u[m.getSource()._index],f=u[m.getTarget()._index];_!==f&&_!==void 0&&f!==void 0&&h.push({source:_,target:f})});const g=Pl(ct({},t));return delete g.nodes,delete g.edges,{graph:{nodes:d,edges:h},options:g,indexes:t.nodes._indexes,done:!1,x:n,y:r,chunkPeriod:250}},update:function(t,e){if(!e.simulation&&t){let s;e.done=!1,e.graph=t.graph,e.options=t.options,e.indexes=t.indexes;let i=!1;if(t.options.gpu){const l=My("webgl2",{},()=>{Gi("GPU layout: WebGL context not available. Falling back on CPU."),e.simulation=void 0,e.options.gpu=!1,e.cleanUp&&e.cleanUp(),this._update(t,e)});l&&(s=l.context,e.cleanUp=l.cleanUp),i=!!s}let n=Date.now();i||(t.options.nextTick=l=>Date.now()-n<=e.chunkPeriod?l():(n=Date.now(),setTimeout(l,0))),t.options.update=(l,d,h)=>{e.x=d,e.y=h},t.options.onEnd=()=>{if(i&&s){const{X:l,Y:d}=e.simulation.data(!0);e.x=l,e.y=d}e.done=!0,e.simulation=void 0,e.cleanUp&&e.cleanUp()},t.options.bucketSize=0;const r=i&&s?Ha(t.graph,s,t.options).start():m_(t.graph,t.options).start();e.simulation=r;const{X:o,Y:a}=i&&s?{X:new Float32Array(t.graph.nodes.length),Y:new Float32Array(t.graph.nodes.length)}:r.data();e.x=o,e.y=a}return{graph:e.graph,indexes:e.indexes,x:e.x,y:e.y}},context:function(){return{done:!1,graph:{nodes:[],edges:[]},x:null,y:null,indexes:null,chunkPeriod:250}},stop:function(t){t.done=!0,t.simulation&&(t.simulation.stop(),delete t.simulation)},isRunning:function(t){return!t.done||(t.done=!1,!1)},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}};function aM(t,e,s,i=t.getNodes()){if(!e)return s?t.nodeList():i.filter(n=>n.getMetaNode()===null);if(!(e instanceof Si)){if(Array.isArray(e)&&e.length>0)return t.getNodes(e);throw Error("[Layout]: 'nodes' must be a NodeList or an NodeId[]")}return e}function lM(t,e,s=t.getEdges()){if(!e)return s;if(!(e instanceof Tn)){if(Array.isArray(e)&&e.length>0)return t.getEdges(e);throw Error("[Layout]: 'edges' must be a EdgeList or a valid EdgeId[]")}return e}function dM(t){if(!t.size)return;const e=new Set(t.getId());return t.getAdjacentEdges().filter(s=>s.getExtremities().getId().every(i=>e.has(i)))}function $0(t,e={},s=!0){s||(e.edges=void 0);const i=aM(t,e.nodes,e.edges),n=lM(t,e.edges,dM(i));return $t(ct({},e),{nodes:i.concat(n.getExtremities()).dedupe(),edges:n})}function hM(t,e,s,i,n){return{x:t+n*(s-t),y:e+n*(i-e)}}var uM=10;function cM(t,e,s){let i,n,r=1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o],d=e[(o+1)%a],h=nc(t[0],t[1],l[0],l[1],d[0],d[1]);h<r&&(r=h,i=l,n=d)}return gM(t[0],t[1],i[0],i[1],n[0],n[1],s)}function gM(t,e,s,i,n,r,o){const a=Vy(t,e,s,i,n,r);let l=-(i-r),d=s-n;const h=Math.sqrt(l*l+d*d);return l/=h,d/=h,[a.x-o*l,a.y-o*d]}function mM(t,e,s,i){for(let n=0;n<t.length;n++){const[r,o]=t[n],a=Math.abs(r-e),l=Math.abs(o-s);if(a+l<=i||!(a>i||l>i)&&a*a+l*l<=i*i)return!0}return!1}function _M(t,e,s){const i=Uy(s.cx,s.cy,t,e,s.minX,s.minY,s.maxX,s.maxY);let n,r=1/0,o={x:s.maxX,y:e};for(const a of i)n=je(t,e,a.x,a.y),n<r&&(r=n,o=a);return o}function fM(t){const e=t.bottomLeft(),s=t.topRight();return[[e.x,e.y],[e.x,s.y],[s.x,s.y],[s.x,e.y]]}function pM(t,e,s,i){const n=[],r=[],o=[];return t.forEach((a,l)=>{i[l]&&(n.push(a),r.push(e[l]),o.push(s[l]))}),{ids:n,subgraphPositions:r,radii:o}}function yM(t,e,s){const{duration:i=0,margin:n=5,referenceNodes:r,nodes:o}=e,{ids:a,subgraphPositions:l,radii:d}=pM(o.getId(),s,o.getAttribute("radius"),o.getAttribute("layoutable")),h=t.getNodes(a);let u=r;!u||u instanceof Si||(u=t.getNodes(u));const c=u||h.inverse(),g=c.getPosition().map(S=>[S.x,S.y]),m=h.getBoundingBox(),_=c.getBoundingBox();_.pad(_.maxScaledSize);const f={layoutName:"incremental",ids:h.getId(),positions:{before:l,current:l}};if(!h.size)return Promise.resolve(f);const p=wu(l.map(S=>S.x),l.map(S=>S.y),d),[x,y]=p,b=p[2]+_.maxScaledSize+n;let v,E=0,A=0;if(mM(g,x,y,b))if(c.size<=3){if(Lu(x,y,p[2],_.minX,_.minY,_.maxX,_.maxY)){const S=_M(x,y,_);v=je(_.cx,_.cy,S.x,S.y);const T=hM(_.cx,_.cy,S.x,S.y,(v+b)/v);E=T.x-x,A=T.y-y}}else{const S=wf.from(g,z=>z[0],z=>z[1]),T=oo(S.triangles,g),L=g.length>3?oo(S.hull,g):fM(_),I=If(c.getPosition(),uM,b,T,L);let R=cM([x,y],L,b);if(I.length>0){let z=Math.pow(x-R[0],2)+Math.pow(y-R[1],2);for(const j of I)E=x-j[0],A=y-j[1],v=E*E+A*A,v<z&&(z=v,R=j.slice(0,2));E=R[0]-x,A=R[1]-y}else E=R[0]-m.cx,A=R[1]-m.cy}if(E||A){const S=l.map(T=>(T.x+=E,T.y+=A,T));if(e.locate){typeof e.locate=="boolean"&&(e.locate={});const T=t.modules.locate.layoutDataBoundingBox({x:[...g.map(I=>I[0]),...S.map(I=>I.x)],y:[...g.map(I=>I[1]),...S.map(I=>I.y)],indexes:t.getNodes()._indexes}),L=t.modules.locate.computeConfigForBounds(T,e.locate);t.modules.camera.setView(L,{duration:i,easing:e.locate.easing,ignoreZoomLimits:!0})}return f.positions.current=S,h.setAttributes(S,i).then(()=>f)}return h.setAttributes(l,i).then(()=>f)}function xM(t,e,s){const i=Pe(e);return i.duration=0,i.dryRun=!0,i.locate=!1,delete i.incremental,s(i).then(n=>yM(t,e,n.positions.current))}function bM(t,e,s){const{nodes:i,duration:n,centralNode:r}=e,o=i,a=o.reduce((d,h)=>(d[h._index]=!0,d),{}),l=t.getNodes();if(e.focusOnGroupShape)return s({nodes:o,duration:0}).then(()=>{const d=o.concat(r),h=d.getAttribute("layoutable");return d.setAttributes({layoutable:!1}),s({nodes:t.getNodes(),duration:n}).then(()=>d.setAttributes(h))});{const d=Pe(e);return delete d.centralNode,d.incremental=!1,d.nodes=l,d.nodeMass=(h,u)=>(u+1)*(a[h._index]?1:2),s(d)}}function q0(t,e,s){const i=$0(e.modules.graph,t);if(typeof i.incremental!="boolean"&&"margin"in i.incremental&&!isFinite(i.incremental.margin))throw new Error("Incremental layout: margin has to be a positive number");const n=Pe(i);return typeof i.incremental!="boolean"&&(n.margin=i.incremental.margin,n.referenceNodes=i.incremental.referenceNodes),n.centralNode&&!n.centralNode.getAttribute("layoutable")?bM(e,n,s):xM(e,n,s)}var vM=t=>(t.modules.layouts.register(__),(e={})=>{if(e.incremental)return q0(e,t,t.layouts.force);if(e.edgeStrength!==void 0&&(!isFinite(e.edgeStrength)||e.edgeStrength<0))throw new Error("force layout: edgeStrength must be a positive number");if(e.steps!==void 0&&(!isFinite(e.steps)||e.steps<=0))throw new Error("force layout: 'steps' must be a positive integer");if(e.edgeLength!==void 0&&(!isFinite(e.edgeLength)||e.edgeLength<=0))throw new Error("force layout: 'edgeLength' must be positive");if(e.gravity!==void 0&&(!isFinite(e.gravity)||e.gravity<0||e.gravity>=1))throw new Error("force layout: 'gravity' must be between 0 and 1");if(e.charge!==void 0&&!isFinite(e.charge))throw new Error("force layout: 'charge' must be a number");if(e.radiusRatio!==void 0&&(!isFinite(e.radiusRatio)||e.radiusRatio<0))throw new Error("force layout: 'radiusRatio' must be a positive number");if(e.theta!==void 0&&(!isFinite(e.theta)||e.theta<0||e.theta>1))throw new Error("force layout: 'theta' must be between 0 and 1");if(!(e.cx===void 0&&e.cy===void 0||typeof e.cx=="number"&&typeof e.cy=="number"))throw new Error("force layout: both 'cx' and 'cy' must be numbers");if(e.siblingsOffset!==void 0&&!isFinite(e.siblingsOffset))throw new Error("force layout: 'siblingsOffset' must be a number");return e.gpu=!!e.gpu,e.gpu&&(e.useWebWorker=!1),t.modules.layouts.start(__.name,e)}),f_={name:"forceLink",configure:function(t,{graph:e,camera:s,graphics:i}){const n=t.nodes._indexes,r=t.edges._indexes,o={},a={},l=n.length,d=r.length;let h;var u=e.getObjectList(!0),c=e.getObjectList(!1);(t.nodes||t.edges)&&(delete(t=Pe(t)).nodes,delete t.edges);const g=e.getNodeAttribute("innerStroke.width").getMultiple(n),m=e.getNodeAttribute("outerStroke.width").getMultiple(n),_=e.degrees(n),f=e.getNodeAttribute("x").getMultiple(n),p=e.getNodeAttribute("y").getMultiple(n),x=e.getNodeAttribute("radius").getMultiple(n),y=e.nodeList(n).getAttribute("layoutable"),b=typeof t.nodeMass=="function"?t.nodeMass:function(C,w,H){return w+1};delete t.nodeMass;const v=typeof t.edgeWeight=="function"?t.edgeWeight:function(C){return 1};delete t.edgeWeight,isFinite(t.scalingRatio)||delete t.scalingRatio;const E=n.reduce((C,w,H)=>(y[H]||(C[w]=!0),C),{});let A=0,S=0,T=0;const L=s.getZoom();for(h=0;h<n.length;++h){const C=n[h],w=f[h],H=p[h],K=x[h]+(g[h]+m[h])/L;o[C]={id:C,x:w,y:H,degree:_[h],size:K,pinned:!!E[C],mass:b(u.get(C),_[h],h)},T=Math.max(K,T)}if(l>1)for(h=0;h<l;h++){const C=o[n[h]];A+=C.x,S+=C.y}A/=l,S/=l;const I={x:A,y:S},R=e.edgeList(r),z=R.getSource()._indexes,j=R.getTarget()._indexes;for(h=0;h<d;h++){const C=r[h],w=z[h],H=j[h];o[w]&&o[H]&&(a[C]={source:w,target:H},a[C].weight=v(c.get(C)))}return{nodes:o,edges:a,maxSize:T,config:Pl(t),barycentre:I}},context:function(){return{chunkPeriod:250}},update:function(t,e){let s;!e.W&&t?(s={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:!0,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!0,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}},e.W=s,function(C,w){const H=function(it,xt){let at,Tt,It,dt=it.nodes,bt=it.edges,Ht=it.maxSize,Qt=Object.keys(it.nodes),Xt=Object.keys(it.edges),mt=Qt.length*s.ppn,ft=Xt.length*s.ppe,te={};const qt=Math.pow(10,Math.log(Math.max(Ht,1))-6),se=qt/2,ee=Math.random,$=xt.randomizeFactor||1;let et;et=xt.randomize==="locally"?rt=>rt+ee()*$:xt.randomize==="globally"?rt=>ee()*$:rt=>rt+ee()*qt-se;const ht=new Float32Array(mt),lt=new Float32Array(ft);for(at=Tt=0,It=Qt.length;at<It;at++){const rt=Qt[at],nt=dt[rt];let Lt=nt.x,St=nt.y;nt.pinned||(Lt=et(Lt),St=et(St)),te[rt]=Tt,ht[Tt]=Lt,ht[Tt+1]=St,ht[Tt+2]=0,ht[Tt+3]=0,ht[Tt+4]=0,ht[Tt+5]=0,ht[Tt+6]=nt.mass,ht[Tt+7]=1,ht[Tt+8]=nt.size,ht[Tt+9]=nt.pinned||0,Tt+=s.ppn}for(at=Tt=0,It=Xt.length;at<It;at++){const rt=bt[Xt[at]];lt[Tt]=te[rt.source],lt[Tt+1]=te[rt.target],lt[Tt+2]=rt.weight||0,Tt+=s.ppe}return{nodes:ht,edges:lt}}(C,w);e.NodeMatrix=H.nodes,e.EdgeMatrix=H.edges,s.nodesLength=e.NodeMatrix.length,s.edgesLength=e.EdgeMatrix.length}(t,t.config),s.settings=function(C,w){for(const H in C)w[H]=C[H];return w}(t.config,s.settings),e.nodes=t.nodes,e.edges=t.edges,e.barycentre=t.barycentre):s=e.W;let i,n=e.NodeMatrix,r=e.EdgeMatrix;const o=0,a=1,l=2,d=3,h=4,u=5,c=6,g=7,m=8,_=9,f=0,p=1,x=2,y=0,b=1,v=2,E=3,A=4,S=5,T=6,L=7,I=8;function R(){let j,C,w,H,K,it,xt,at,Tt,It,dt,bt,Ht,Qt,Xt,mt,ft;for(w=0;w<s.nodesLength;w+=s.ppn)n[w+h]=n[w+l],n[w+u]=n[w+d],n[w+l]=0,n[w+d]=0;if(s.settings.outboundAttractionDistribution){for(Tt=0,w=0;w<s.nodesLength;w+=s.ppn)Tt+=n[w+c];Tt/=s.nodesLength}if(s.settings.barnesHutOptimize){let et,ht,lt,rt,nt=1/0,Lt=-1/0,St=1/0,wt=-1/0;for(i=[],w=0;w<s.nodesLength;w+=s.ppn)nt=Math.min(nt,n[w+o]),Lt=Math.max(Lt,n[w+o]),St=Math.min(St,n[w+a]),wt=Math.max(wt,n[w+a]);const Wt=Lt-nt,Ut=wt-St;for(Wt>Ut?(St-=(Wt-Ut)/2,wt=St+Wt):(nt-=(Ut-Wt)/2,Lt=nt+Ut),i[0+y]=-1,i[0+b]=(nt+Lt)/2,i[0+v]=(St+wt)/2,i[0+E]=Math.max(Lt-nt,wt-St),i[0+A]=-1,i[0+S]=-1,i[0+T]=0,i[0+L]=0,i[0+I]=0,j=1,w=0;w<s.nodesLength;w+=s.ppn)for(C=0,lt=s.MAX_SUBDIVISION_RETRIES;;){if(!(i[C+S]>=0)){if(i[C+y]<0){i[C+y]=w;break}if(i[C+S]=j*s.ppr,xt=i[C+E]/2,at=i[C+S],i[at+y]=-1,i[at+b]=i[C+b]-xt,i[at+v]=i[C+v]-xt,i[at+E]=xt,i[at+A]=at+s.ppr,i[at+S]=-1,i[at+T]=0,i[at+L]=0,i[at+I]=0,at+=s.ppr,i[at+y]=-1,i[at+b]=i[C+b]-xt,i[at+v]=i[C+v]+xt,i[at+E]=xt,i[at+A]=at+s.ppr,i[at+S]=-1,i[at+T]=0,i[at+L]=0,i[at+I]=0,at+=s.ppr,i[at+y]=-1,i[at+b]=i[C+b]+xt,i[at+v]=i[C+v]-xt,i[at+E]=xt,i[at+A]=at+s.ppr,i[at+S]=-1,i[at+T]=0,i[at+L]=0,i[at+I]=0,at+=s.ppr,i[at+y]=-1,i[at+b]=i[C+b]+xt,i[at+v]=i[C+v]+xt,i[at+E]=xt,i[at+A]=i[C+A],i[at+S]=-1,i[at+T]=0,i[at+L]=0,i[at+I]=0,j+=4,rt=C+y,et=n[i[rt]+o]<i[C+b]?n[i[rt]+a]<i[C+v]?i[C+S]:i[C+S]+s.ppr:n[i[rt]+a]<i[C+v]?i[C+S]+2*s.ppr:i[C+S]+3*s.ppr,i[C+T]=n[i[rt]+c],i[C+L]=n[i[rt]+o],i[C+I]=n[i[rt]+a],i[et+y]=i[C+y],i[C+y]=-1,ht=n[w+o]<i[C+b]?n[w+a]<i[C+v]?i[C+S]:i[C+S]+s.ppr:n[w+a]<i[C+v]?i[C+S]+2*s.ppr:i[C+S]+3*s.ppr,et===ht){if(lt--){C=et;continue}lt=s.MAX_SUBDIVISION_RETRIES;break}i[ht+y]=w;break}et=n[w+o]<i[C+b]?n[w+a]<i[C+v]?i[C+S]:i[C+S]+s.ppr:n[w+a]<i[C+v]?i[C+S]+2*s.ppr:i[C+S]+3*s.ppr,i[C+L]=(i[C+L]*i[C+T]+n[w+o]*n[w+c])/(i[C+T]+n[w+c]),i[C+I]=(i[C+I]*i[C+T]+n[w+a]*n[w+c])/(i[C+T]+n[w+c]),i[C+T]+=n[w+c],C=et}}if(s.settings.barnesHutOptimize)for(It=s.settings.scalingRatio,w=0;w<s.nodesLength;w+=s.ppn)for(C=0;;)if(i[C+S]>=0){if(mt=Math.sqrt((n[w+o]-i[C+L])*(n[w+o]-i[C+L])+(n[w+a]-i[C+I])*(n[w+a]-i[C+I])),2*i[C+E]/mt<s.settings.barnesHutTheta){if(dt=n[w+o]-i[C+L],bt=n[w+a]-i[C+I],s.settings.adjustSizes?mt>0?(ft=It*n[w+c]*i[C+T]/mt/mt,n[w+l]+=dt*ft,n[w+d]+=bt*ft):mt<0&&(ft=-It*n[w+c]*i[C+T]/mt,n[w+l]+=dt*ft,n[w+d]+=bt*ft):mt>0&&(ft=It*n[w+c]*i[C+T]/mt/mt,n[w+l]+=dt*ft,n[w+d]+=bt*ft),i[C+A]<0)break;C=i[C+A];continue}C=i[C+S]}else{if(i[C+y]>=0&&i[C+y]!==w&&(dt=n[w+o]-n[i[C+0]+o],bt=n[w+a]-n[i[C+0]+a],mt=Math.sqrt(dt*dt+bt*bt),s.settings.adjustSizes?mt>0?(ft=It*n[w+c]*n[i[C+0]+c]/mt/mt,n[w+l]+=dt*ft,n[w+d]+=bt*ft):mt<0&&(ft=-It*n[w+c]*n[i[C+0]+c]/mt,n[w+l]+=dt*ft,n[w+d]+=bt*ft):mt>0&&(ft=It*n[w+c]*n[i[C+0]+c]/mt/mt,n[w+l]+=dt*ft,n[w+d]+=bt*ft)),i[C+A]<0)break;C=i[C+A]}else for(It=s.settings.scalingRatio,H=0;H<s.nodesLength;H+=s.ppn)for(K=0;K<H;K+=s.ppn)dt=n[H+o]-n[K+o],bt=n[H+a]-n[K+a],s.settings.adjustSizes?(mt=Math.sqrt(dt*dt+bt*bt)-n[H+m]-n[K+m],mt>0?(ft=It*n[H+c]*n[K+c]/mt/mt,n[H+l]+=dt*ft,n[H+d]+=bt*ft,n[K+l]+=dt*ft,n[K+d]+=bt*ft):mt<0&&(ft=100*It*n[H+c]*n[K+c],n[H+l]+=dt*ft,n[H+d]+=bt*ft,n[K+l]-=dt*ft,n[K+d]-=bt*ft)):(mt=Math.sqrt(dt*dt+bt*bt),mt>0&&(ft=It*n[H+c]*n[K+c]/mt/mt,n[H+l]+=dt*ft,n[H+d]+=bt*ft,n[K+l]-=dt*ft,n[K+d]-=bt*ft));for(at=s.settings.gravity/s.settings.scalingRatio,It=s.settings.scalingRatio,w=0;w<s.nodesLength;w+=s.ppn)ft=0,dt=n[w+o],bt=n[w+a],mt=Math.sqrt(dt*dt+bt*bt),s.settings.strongGravityMode?mt>0&&(ft=It*n[w+c]*at):mt>0&&(ft=It*n[w+c]*at/mt),n[w+l]-=dt*ft,n[w+d]-=bt*ft;for(It=1*(s.settings.outboundAttractionDistribution?Tt:1),it=0;it<s.edgesLength;it+=s.ppe)H=r[it+f],K=r[it+p],xt=r[it+x],Xt=Math.pow(xt,s.settings.edgeWeightInfluence),dt=n[H+o]-n[K+o],bt=n[H+a]-n[K+a],s.settings.adjustSizes?(mt=Math.sqrt(dt*dt+bt*bt)-n[H+m]-n[K+m],s.settings.linLogMode?s.settings.outboundAttractionDistribution?mt>0&&(ft=-It*Xt*Math.log(1+mt)/mt/n[H+c]):mt>0&&(ft=-It*Xt*Math.log(1+mt)/mt):s.settings.outboundAttractionDistribution?mt>0&&(ft=-It*Xt/n[H+c]):mt>0&&(ft=-It*Xt)):(mt=Math.sqrt(dt*dt+bt*bt),s.settings.linLogMode?s.settings.outboundAttractionDistribution?mt>0&&(ft=-It*Xt*Math.log(1+mt)/mt/n[H+c]):mt>0&&(ft=-It*Xt*Math.log(1+mt)/mt):s.settings.outboundAttractionDistribution?(mt=1,ft=-It*Xt/n[H+c]):(mt=1,ft=-It*Xt)),mt>0&&(n[H+l]+=dt*ft,n[H+d]+=bt*ft,n[K+l]-=dt*ft,n[K+d]-=bt*ft);let te,qt,se,ee,$=0;if(s.settings.adjustSizes)for(w=0;w<s.nodesLength;w+=s.ppn)n[w+_]||(te=Math.sqrt(n[w+l]*n[w+l]+n[w+d]*n[w+d]),te>s.maxForce&&(n[w+l]=n[w+l]*s.maxForce/te,n[w+d]=n[w+d]*s.maxForce/te),qt=n[w+c]*Math.sqrt((n[w+h]-n[w+l])*(n[w+h]-n[w+l])+(n[w+u]-n[w+d])*(n[w+u]-n[w+d])),se=Math.sqrt((n[w+h]+n[w+l])*(n[w+h]+n[w+l])+(n[w+u]+n[w+d])*(n[w+u]+n[w+d]))/2,ee=.1*Math.log(1+se)/(1+Math.sqrt(qt)),Ht=n[w+o],Qt=n[w+a],n[w+o]=n[w+o]+n[w+l]*(ee/s.settings.slowDown),n[w+a]=n[w+a]+n[w+d]*(ee/s.settings.slowDown),dt=n[w+o],bt=n[w+a],mt=Math.sqrt((dt-Ht)*(dt-Ht)+(bt-Qt)*(bt-Qt)),$+=mt);else for(w=0;w<s.nodesLength;w+=s.ppn)n[w+_]||(qt=n[w+c]*Math.sqrt((n[w+h]-n[w+l])*(n[w+h]-n[w+l])+(n[w+u]-n[w+d])*(n[w+u]-n[w+d])),se=Math.sqrt((n[w+h]+n[w+l])*(n[w+h]+n[w+l])+(n[w+u]+n[w+d])*(n[w+u]+n[w+d]))/2,ee=n[w+g]*Math.log(1+se)/(1+Math.sqrt(qt)),n[w+g]=Math.min(1,Math.sqrt(ee*(n[w+l]*n[w+l]+n[w+d]*n[w+d])/(1+Math.sqrt(qt)))),Ht=n[w+o],Qt=n[w+a],n[w+o]=n[w+o]+n[w+l]*(ee/s.settings.slowDown),n[w+a]=n[w+a]+n[w+d]*(ee/s.settings.slowDown),dt=n[w+o],bt=n[w+a],mt=Math.sqrt((dt-Ht)*(dt-Ht)+(bt-Qt)*(bt-Qt)),$+=mt);if(s.iterations++,s.settings.autoStop&&(s.converged=s.iterations>s.settings.maxIterations||$/s.nodesLength<s.settings.avgDistanceThreshold,s.converged&&s.settings.alignNodeSiblings)){let et,ht,lt={},rt={};for(it=0;it<s.edgesLength;it+=s.ppe)H=r[it+f],K=r[it+p],H!==K&&(lt[H]=lt[H]||{},lt[K]=lt[K]||{},lt[H][K]=!0,lt[K][H]=!0);Object.keys(lt).forEach(Le=>{var xe=~~Le;ht=Object.keys(lt[xe]),ht.length==2&&(et=ht[0]+";"+ht[1],et in rt||(et=ht[1]+";"+ht[0],rt[et]||(rt[et]=[~~ht[1],~~ht[0]])),rt[et].push(xe))});let nt,Lt,St,wt,Wt,Ut,ye,me,_e,Ee,Fe,Zt,de,Ae,pe,ie=s.settings.nodeSiblingsAngleMin;Object.keys(rt).forEach(Le=>{if(Lt=rt[Le].shift(),St=rt[Le].shift(),nt=rt[Le].filter(ne=>!n[ne+_]),nt.length==1)return;if(Ut=n[Lt+o],ye=n[Lt+a],me=n[St+o],_e=n[St+a],wt=Object.keys(lt[Lt]).length,Wt=Object.keys(lt[St]).length,Ee=function(re,oe,De,Re,Ke){return(Ke-Re)*(re-oe)/(De-oe)+Re}(wt/(wt+Wt),0,1,1/4,3/4),Zt=function(re,oe,De,Re,Ke){return{x:re+(De-re)*Ke,y:oe+(Re-oe)*Ke}}(Ut,ye,me,_e,Ee),de=function(re,oe,De,Re){return{xi:-(Re-oe),yi:De-re,xiPrime:Re-oe,yiPrime:-(De-re)}}(Ut,ye,me,_e),Fe=function(re,oe,De,Re){const Ke=De-re,cs=Re-oe;return Math.sqrt(Ke*Ke+cs*cs)}(Ut,ye,me,_e),Ae=function(re,oe){return{x:(re.xiPrime-re.xi)/oe,y:(re.yiPrime-re.yi)/oe}}(de,Fe),pe=function(re){return Math.acos(re.x/Math.sqrt(re.x*re.x+re.y*re.y))}(Ae),2*ie>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");ie>0&&(pe<ie||pe>Math.PI-ie&&pe<=Math.PI?Ae={x:2*Math.cos(Math.PI-ie),y:2*Math.sin(Math.PI-ie)}:(pe>2*Math.PI-ie||pe>=Math.PI&&pe<Math.PI+ie)&&(Ae={x:2*Math.cos(ie),y:2*Math.sin(ie)}));let xe=0,ke=1,bs=1;nt.length%2==1&&(bs=0,xe=1);for(let ne=0;ne<nt.length;ne++)n[nt[ne]+o]=Zt.x+ke*Ae.x*bs*(xe||ne>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),n[nt[ne]+a]=Zt.y+ke*Ae.y*bs*(xe||ne>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),ke=-ke,bs+=(ne+xe)%2})}}function z(j){const C=Object.keys(j),w={};for(let H=0;H<n.length;H+=s.ppn){const K=C[H/s.ppn];w[K]={id:K,x:n[H+o],y:n[H+a],pinned:n[H+_]}}return w}return function(){if(s.settings.autoStop){const C=Date.now();for(;!(s.converged||Date.now()-C>=e.chunkPeriod);)R()}else{const C=s.iterations===0?s.settings.startingIterations:s.iterations+s.settings.iterationsPerRender;for(;s.iterations!==C;)R()}return{nodes:z(e.nodes),barycentre:e.barycentre}}()},isRunning:function(t){return!t.W.settings.autoStop||!t.W.converged||(t.W=void 0,!1)},stop:function(t){t.W&&(t.W.converged=!0)},onSync:function({nodes:t,barycentre:e},{graph:s}){const i=Object.keys(t),n=i.length;let r,o,a,l,d,h,u,c,g=0,m=0;const _=new Array(n),f=new Array(n),p=new Array(n),x=new Array(n),[y,b]=s.getAttributes(!0,["x","y"]);for(r=0;r<n;r++)o=i[r],a=t[o],c=parseInt(o),_[r]=c,x[r]=a.pinned,a.pinned?(l=y.get(c),d=b.get(c)):(l=a.x,d=a.y),f[r]=l,p[r]=d,g+=l,m+=d;for(h=g/n-e.x,u=m/n-e.y,r=0;r<n;r++)x[r]||(f[r]-=h,p[r]-=u);return{indexes:_,x:f,y:p}}},EM=t=>(t.modules.layouts.register(f_),(e={})=>e.incremental?q0(e,t,t.layouts.forceLink):t.modules.layouts.start(f_.name,e)),p_={name:"grid",configure:function(t,{graph:e,camera:s}){function i(E){return E===void 0||typeof E=="number"&&isFinite(E)&&E>0}const n=t.sortBy,r=t,o=r.nodes,a=Array.from(o._indexes),l=a.length,{rows:d,cols:h,rowDistance:u,colDistance:c}=function(A,S,T,L,I){if(!i(S))throw new TypeError('"rows" should be a positive integer');if(!i(T))throw new TypeError('"cols" should be a positive integer');if(!i(L))throw new TypeError('"rowDistance" should be a positive number');if(!i(I))throw new TypeError('"colDistance" should be a positive number');if(S)return{rows:S,cols:Math.ceil(A/S),rowDistance:L,colDistance:I};if(T)return{cols:T,rows:Math.ceil(A/T),rowDistance:L,colDistance:I};const R=Math.ceil(Math.sqrt(A));return{cols:R,rows:Math.ceil(A/R),rowDistance:L,colDistance:I}}(l,r.rows,r.cols,r.colDistance,r.rowDistance),g=function(A,S,T,L,I){return typeof A!="string"?L.map((R,z)=>z):A==="radius"?S.getAttribute(!0,"radius").getMultiple(L):A==="degree"?T.getDegree():A==="random"?L.map(()=>Math.random()):T.getData(A).map(R=>R||I)}(n,e,o,a,t.sortFallbackValue),m=o.getAttribute("layoutable"),_=a.reduce((E,A,S)=>(m[S]&&E.push({id:A,attr:g[S]}),E),[]),f=o.getBoundingBox(),p=.65*Math.max(f.maxScaledSize,f.maxFixedSize/s.getZoom());let x=f.minX+p,y=f.maxX-p,b=f.minY+p,v=f.maxY-p;return f.width<p*h*2&&(x=f.cx-p*h+p,y=f.cx+p*h-p),f.height<p*d*2&&(b=f.cy-p*d+p,v=f.cy+p*d-p),{sort:!!n,nodes:_,reverse:!!r.reverse,cols:h,rows:d,minX:x,maxX:y,minY:b,maxY:v,rowDistance:u,colDistance:c}},update:function({sort:t,nodes:e,maxX:s,minX:i,maxY:n,minY:r,reverse:o,rows:a,cols:l,rowDistance:d,colDistance:h}){t&&e.sort((p,x)=>{const y=p.attr,b=x.attr;return y<b?-1:y>b?1:0}),o&&e.reverse();let u=(s-i)/(l-1),c=(n-r)/(a-1);const g=i,m=r;isFinite(u)||(u=0),isFinite(c)||(c=0),d!==void 0&&isFinite(d)&&(u=d),h!==void 0&&isFinite(h)&&(c=h);let _=0,f=0;return e.forEach(p=>{p.x=g+_*u,p.y=m+f*c,_+=1,_===l&&(f+=1,_=0)}),e},onSync:function(t){return{indexes:t.map(({id:e})=>e),x:t.map(({x:e})=>e),y:t.map(({y:e})=>e)}}},AM=t=>(t.modules.layouts.register(p_),(e={})=>t.modules.layouts.start(p_.name,e));function SM(t){let e=0,s=0;for(const o of t)e+=o.w*o.h,s=Math.max(s,o.w);t.sort((o,a)=>a.h-o.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let n=0,r=0;for(const o of t)for(let a=i.length-1;a>=0;a--){const l=i[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,r=Math.max(r,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===l.w&&o.h===l.h){const d=i.pop();a<i.length&&(i[a]=d)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(i.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:n,h:r,fill:e/(n*r)||0}}var wM={down:()=>{},up:t=>t.y=-t.y,left:t=>{const e=t.x;t.x=-t.y,t.y=e},right:t=>{const e=t.x;t.x=t.y,t.y=-e}},kd=(t,e)=>isFinite(t)&&t>0?t:e;function TM(t){return{nodesSeparation:kd(t.nodesSeparation,0),componentsSeparation:kd(t.componentsSeparation,25),layerSeparation:kd(t.layerSeparation,50)}}function IM(t,{componentsSeparation:e,packing:s}){const i=[];for(let n=0;n<t.length;n++){const r=t[n],o=r.nodes;if(r.isFake&&r.w!==void 0&&r.h!==void 0){i.push({w:r.w,h:r.h,x:void 0,y:void 0,dag:r});continue}if(r.nodes.length===1){const c=2*o[0].data.radius;i.push({w:c+e/2,h:c+e/2,x:void 0,y:void 0,dag:r});continue}const{minX:a,maxX:l,minY:d,maxY:h}=o.reduce((c,{x:g,y:m,data:_})=>{const f=_.radius||0;return c.minX=Math.min(c.minX,g-f),c.maxX=Math.max(c.maxX,g+f),c.minY=Math.min(c.minY,m-f),c.maxY=Math.max(c.maxY,m+f),c},{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),u=(l+a)/2;o.forEach(c=>{c.x-=u}),i.push({w:Math.abs(l-a)+e/2,h:Math.abs(h-d)+e/2,minX:a,x:void 0,y:void 0,dag:r})}if(s!=="singleline")SM(i);else{let n=0;for(let r=0;r<i.length;r++){const o=i[r];o.x=n,o.y=0,n+=o.w}}return i}function LM(t,e={}){const{componentsSeparation:s}=TM(e);e.direction===void 0&&(e.direction="down");const i=IM(t,{componentsSeparation:s,packing:e.packing});for(let n=0;n<i.length;n++){const{x:r=0,y:o=0,dag:a}=i[n];for(const l of a.nodes)l.x+=r,l.y+=o,wM[e.direction](l)}}var wc={id:"__SENTINEL__",layer:-1,sink:!1,fixed:!1,siblingIndex:-1,parentIds:[],children:[],radius:0,ref:null},Hr=t=>t.data===wc||!1,tu=t=>!Hr(t),CM=[],MM=(t,e)=>({id:t,layer:e,data:wc,children:CM,ref:void 0,x:0,y:0}),NM=(t,e)=>({id:t,layer:-1,data:e,children:[],x:0,y:0}),y_=class{constructor(t,e,s){this.data=t,this.prev=e,this.next=s}toString(){return this.data}},Z0=t=>t.reduce((e,s)=>(e[s]=!0,e),{});function PM(t,e){const s=[t],i=Z0(s),n=[t];for(;s.length;){const r=s.shift();for(const o of e[r])i[o]||(i[o]=!0,n.push(o),s.push(o))}return n}function Tc(t){return t.reduce((e,{source:s,target:i})=>(e[s]=e[s]||[],e[i]=e[i]||[],e[s].push(i),e[i].push(s),e),{})}function FM(t){return t.reduce((e,{source:s,target:i})=>(e[s]=e[s]||[],e[s].push(i),e),{})}function kM(t,e,s){const i=s||Tc(e||[]);return t.filter(({id:n})=>!(n in i))}function DM(t,e){const s=Z0(e);return t.filter(i=>!(i in s))}function Ms(t,e){t.forEach((s,i)=>{s.forEach((n,r,o)=>{e(n,r,o,i)})})}var x_=t=>{let e=Math.floor(t.length/2);return(t=[...t].sort((s,i)=>s-i)).length%2!=0?t[e]:(t[e-1]+t[e])/2};function RM(t,e,s){const i=Tc(e);let n=Object.keys(i);const r=[];for(;n.length;){const o=PM(n[0],i);r.push(o),n=DM(n,o)}return s.skipSingletons?r:r.concat(kM(t,e,i).map(({id:o})=>[o]))}var OM=t=>t.reduce((e,{radius:s})=>Math.max(e,2*s),0);function zM(t,e){return ct({nodes:t.map(s=>$t(ct({},s),{data:s})),isFake:!0},e)}function BM(t,e,s){const i=Tc(e||[]),n=t.filter(({id:g})=>!(g in i)).sort((g,m)=>m.radius-g.radius),r=Math.sqrt(n.length);let o=Math.floor(r),a=Math.ceil(r);o*a<n.length&&(o<a?o++:a++);const l=Math.max(1,OM(n)),d=Math.max(s.nodesGridSeparation||0,1),h=l*a+d*(a-1),u=l*o+d*Math.max(o-1,0),c=zM(n,{w:h,h:u});return c.nodes.forEach((g,m)=>{const _=m%a,f=Math.floor(m/a);g.x=h*_/a,g.y=u*f/o}),c}function UM(t,e,s){const i=e.reduce((o,a)=>(o[a.source]=o[a.source]||[],o[a.source].push(a),o),{}),{result:n}=t.reduce(function o(a,l){const{visited:d,stack:h,result:u}=a;if(d[l.id])return a;d[l.id]=h[l.id]=1;const c=i[l.id]||[];for(const g of c)h[g.target]?u.push(g):o(a,s[g.target]);return delete h[l.id],a},{visited:{},stack:{},result:[]}),r=n.reduce((o,{source:a,target:l})=>(o[a]=o[a]||{},o[a][l]=1,o),{});return e.map(o=>{const{source:a,target:l,id:d}=o;return r[a]&&r[a][l]?{id:d,source:l,target:a}:o})}function GM(t){if(!t||!t.length)throw Error("Cannot stratify empty data");for(const n of t){if(!n)throw Error('Node data is "null"');if(n.id==null)throw Error('Node id contains a "null" value')}const e=t.map(n=>NM(n.id,n)),s=e.reduce((n,r)=>{if(n[r.id])throw Error(`The connected component contains id duplicates: ${r.id}`);return n[r.id]=r,n},{}),i=[];for(let n=0;n<e.length;n++){const r=e[n];for(let o=0;o<r.data.parentIds.length;o++){const a=r.data.parentIds[o],l=s[a];if(!l)throw Error(`The node ${r.id} has a missing parent id ${a}`);l.children.push(r)}r.data.parentIds.length||i.push(r)}return{isFake:!1,nodes:VM(i)}}function VM(t){const e={},s=[];for(;t.length;){const i=t.pop();e[i.id]||(s.push(i),e[i.id]=!0,t.push(...i.children))}return s}var jM=class{constructor(){this.byId={},this.byIndex={},this.length=0}append(t,e){let s;return this.head?(s=new y_(t,this.tail),this.tail=this.tail.next=s):(s=new y_(t),this.tail=this.head=s),this.byId[e]=s,this.byIndex[this.length++]=s,s}find(t){let e=this.head;do{if(e.data===t)return e;e=e.next}while(e)}forEach(t){let e=this.head,s=0;do t(e,s),s++;while(e=e.next)}},Ns=-1,Be=1e-5,Dd=[],HM=class{constructor(t,e,s){this.edges=[],this.nodeMap={},this.nodeIndexTopDown={},this.nodeToLayer={},this.longEdges={},this.virt={},this.height={},this.breadth={},this.first=[],this.totalW={},this.mDist={},this.X={},this.block={},this.nodeList=new jM,this.nodeDistance=e,this.layerDistance=s,this.layers=t;const{breadth:i,virt:n,height:r,nodeToLayer:o,nodeIndexTopDown:a,nodeMap:l,longEdges:d,edges:h}=this;let u=0;Ms(this.layers,(_,f,p,x)=>{if(a[_.id]=u++,l[_.id]=_,o[_.id]=x,this.nodeList.append(_,_.id),_.children.forEach(b=>{const v=Hr(b)||Hr(_);h.push({source:_.id,target:b.id,virtual:v,id:h.length})}),d[_.id])return;const y=[_.id];if(d[_.id]=y,!tu(_))for(let b=0;b<_.children.length;b++){const v=_.children[b];if(tu(v))continue;let E=v;for(;Hr(E);)y.push(E.id),d[E.id]=y,E=E.children[0]}});const c=this.adjacencyList=FM(h);this.N=t.reduce((_,f)=>_+f.length,0),this.Y=new Float32Array(t.length),this.first=t.map(_=>_[0]),t.forEach((_,f)=>r[f]=0),Ms(this.layers,(_,f,p,x)=>{const y=c[_.id]?c[_.id].length:0;n[_.id]=Hr(_)&&y===1,this.nodeToLayer[_.id]=x,n[_.id]?i[_.id]=0:(i[_.id]=2*_.data.radius,r[x]=Math.max(r[x]||0,2*_.data.radius))});const g={},m={};h.forEach(_=>{const f=_.source,p=_.target;g[p]=g[p]||[],g[p].push(f),m[f]=m[f]||[],m[f].push(p)}),Object.values(g).forEach(_=>{_.sort((f,p)=>this.nodeIndexTopDown[f]-this.nodeIndexTopDown[p])}),Object.values(m).forEach(_=>{_.sort((f,p)=>this.nodeIndexTopDown[f]-this.nodeIndexTopDown[p])}),this.neighbours={prev:g,next:m}}computeMinNodeDistances(){const{layers:t,totalW:e}=this;Ms(t,s=>{e[s.id]=0}),Ms(t,s=>e[s.data.id]=0),this.layers.forEach(s=>{e[s[0].id]=0,s.slice(1).forEach((i,n)=>{const r=s[n],o=i.id;e[o]=e[r.id]+r.data.radius+i.data.radius+this.nodeDistance})})}decrossVirtualEdges(){this.layers.forEach(t=>{let e=-1;t.forEach(s=>{if(!this.virt[s.id])return;const i=this.neighbours.next[s.id][0];if(this.virt[i])if(e!==-1&&e>this.nodeIndexTopDown[i]){const n=this.longEdges[s.id];let r=0;for(r=0;r<n.length&&n[r]!==i;r++);const o=n.slice(r);o.forEach(l=>this.longEdges[l]=o);const a=n.slice(0,r);a.forEach(l=>this.longEdges[l]=a)}else e=this.nodeIndexTopDown[i]})})}placeLongEdges(){const{X:t,layers:e}=this;Ms(e,s=>t[s.id]=0);for(let s=1;s>=-1;s-=2){const i={};let n=0;const r={};Ms(e,d=>r[d.id]=0),r[wc.id]=0;const o=s;e.forEach(d=>{let h=o===1?d[0]:d[d.length-1];r[h.id]||(this.longEdges[h.id].forEach(g=>{r[g]=n}),n++);let u=o===1?0:d.length-1,c=u+o;for(;c>=0&&c<d.length;)h=d[c],r[h.id]||this.longEdges[h.id].forEach(g=>{r[g]=r[d[u].id]}),u=c,c+=o});const a={};e.forEach(d=>{for(let h=o===1?0:d.length-1;o===1?h<d.length:h>=0;h+=o){const u=d[h],c=r[u.id];a[c]=a[c]||[],a[c].push(u.id)}});const l={};this.nodeList.forEach(d=>l[d.data.id]=0);for(let d=0;d<n;d++){const h={done:!1,dist:0},u=a[d];for(let c=0;c<u.length;c++){const g=u[c];this.sortLongEdges(g,s,l,h,r,i)}if(!h.done){const c=this.layers[this.nodeToLayer[a[d][0]]],g=[];c.forEach(m=>{for(const _ of this.neighbours.prev[m.id]||Dd){const f=Math.abs(l[_]-l[m.id]);g.push(f)}}),g.length!==0&&(h.dist=x_(g))}for(let c=0;c<u.length;c++)l[u[c]]-=s*h.dist}Ms(e,d=>t[d.id]+=l[d.id]/2)}}sortLongEdges(t,e,s,i,n,r){if(r[t])return!1;let o=!1,a=0;const{nodeToLayer:l,totalW:d}=this,h=this.longEdges[t];h.forEach(u=>r[u]=!0),h.forEach(u=>{const c=this.nodeList.byIndex[this.nodeIndexTopDown[u]-e];if(!c)return;const g=c.data.id,m=u,_=l[g]===l[m],f=n[g]===n[m];!_||!f||(this.sortLongEdges(g,e,s,i,n,r),(!o||e*(a-s[g])<e*(d[m]-d[g]))&&(o=!0,a=s[g]+d[m]-d[g]))}),h.forEach(u=>{s[u]=a;const c=this.nodeList.byId[u],g=e===1?c.next:c.prev;if(!g)return;const m=g.data.id,_=u,f=l[m]===l[_],p=n[m]!==n[_],x=e*(d[m]-d[_]-s[m]+s[_]);f&&p&&(!i.done||x>i.dist)&&(i.dist=x,i.done=!0)})}placeNonVirtualNodes(){const t={};Ms(this.layers,l=>t[l.id]=-1);const{X:e,totalW:s,virt:i,nodeIndexTopDown:n,mDist:r,nodeList:o}=this,a={};Ms(this.layers,(l,d,h,u)=>{if(!i[l.id])return void(a[l.id]=!1);let c=this.nodeList.byId[l.id].next;for(;c&&this.nodeToLayer[c.data.id]===u&&!i[c.data.id];)c=c.next;a[l.id]=this.nodeToLayer[c.data.id]===u&&e[c.data.id]-e[l.id]<s[c.data.id]-s[l.id]+Be}),Ms(this.layers,({id:l})=>{a[l]&&t[l]===-1&&this.longEdges[l].forEach(d=>{d!==l&&(t[d]=n[d]<n[l]?1:0)})}),Ms(this.layers,({id:l})=>r[l]=s[l]);for(let l=0;l<2;l++)for(let d=l?this.layers.length-1:0;d>=0&&d<this.layers.length;l?d--:d++){let h=Ns;const u=this.layers[d];if(u.forEach(({id:c},g,m)=>{if(i[c]){if(h===Ns){this.placeSequence(Ns,c,m[0].id,o.byId[c].prev.data.id,l);for(let _=0;_<g;_++){const f=m[_].id;r[f]=r[c]-e[c]+e[f]}}else if(t[h]!==1-l){a[h]||this.placeSequence(h,c,o.byId[h].next.data.id,o.byId[c].prev.data.id,l);const _=l===1?this.neighbours.prev:this.neighbours.next,f=_[h][0],p=_[c][0];if(i[f]&&i[p])for(let x=n[f]+1;x<n[p];x++)t[o.byIndex[x].data.id]=l}h=c}}),h===Ns)this.placeSequence(Ns,Ns,u[0].id,u[u.length-1].id,l),u.forEach(({id:c})=>r[c]=e[c]);else{this.placeSequence(h,Ns,o.byId[h].next.data.id,u[u.length-1].id,l);for(let c=u.length-1;c>=0;c--){const g=u[c].id;if(g===h)break;r[g]=r[h]-e[h]+e[g]}}}}placeSequence(t,e,s,i,n,r=0){const o=this.nodeIndexTopDown[s],a=this.nodeIndexTopDown[i],{X:l,nodeIndexTopDown:d,mDist:h}=this;if(o===a)l[s]=this.placeNode(s,t,e,l[s],n);else if(o<a){const u=Math.floor((d[s]+d[i])/2),c=this.nodeList.byIndex[u],g=c.next.data.id,m=h[g]-h[c.data.id];this.placeSequence(t,e,s,c.data.id,n,r+1),this.placeSequence(t,e,g,i,n,r+1),this.combineSequences(t,e,s,i,g,c.data.id,n,m)}}calculateBends(t,e,s,i,n,r,o,a){let l=0;const d=[],{X:h,mDist:u,neighbours:c}=this,g=this.nodeIndexTopDown[s],m=this.nodeIndexTopDown[i];for(let _=this.nodeList.byId[r],f=this.nodeIndexTopDown[_.data.id];f>=g&&f<=m&&_;_=t===-1?_.prev:_.next,f=_&&this.nodeIndexTopDown[_.data.id]){const p=_.data.id,x=(e===0?c.prev[p]:c.next[p])||Dd;let y=0;for(let v=0;v<x.length;v++){const E=x[v];if(t*(h[E]-h[p])<Be)y++;else{y--;const A=h[E]+u[r]-u[p];t*(h[r]-A)>-Be?l++:(a===Ns||t*(A-h[a]+u[a]-u[r])<Be)&&t*(A-h[n])<o-Be&&d.push({value:2,key:A})}}const b=h[p]+u[r]-u[p];t*(h[r]-b)>-Be?l+=y:(a===Ns||t*(b-h[a]+u[a]-u[r])<Be)&&t*(b-h[n])<o-Be&&d.push({value:y,key:b})}return a!==Ns&&d.push({value:this.edges.length,key:h[a]-u[a]+u[r]}),d.sort(({key:_},{key:f})=>_-f),{res:l,bends:d.reduce((_,f,p)=>{if(p<d.length-1){const x=d[p+1];Math.abs(f.key-x.key)>Be?f.value>0&&_.push(f):f.value+=x.value}else f.value>0&&_.push(f);return _},[])}}combineSequences(t,e,s,i,n,r,o,a){const{X:l,mDist:d,nodeIndexTopDown:h}=this;let{res:u,bends:c}=this.calculateBends(-1,o,s,i,n,r,a,t),{res:g,bends:m}=this.calculateBends(1,o,s,i,r,n,a,e);for(c.length>0&&c.reverse();l[n]-l[r]<a-Be;){let p=0,x=0;if(u<g){const y=c.length;if(y>0){const b=c.pop();p=b.value,l[r]=b.key}(y===0||l[n]-l[r]>a+Be)&&(l[r]=l[n]-a)}else if(u>g){const y=m.length;if(y>0){const b=m.pop();x=b.value,l[n]=b.key}(y===0||l[n]-l[r]>a+Be)&&(l[n]=l[r]+a)}else{let y=(a-l[n]+l[r])/2;const b=c.length===0?y+1:l[r]-c[c.length-1].key,v=m.length===0?y+1:m[m.length-1].key-l[n];b<y+Be&&b<v+Be&&(p=c.pop().value),v<y+Be&&v<b+Be&&(x=m.pop().value),y=Math.min(y,b,v),l[r]-=y,l[n]+=y}u+=p,g+=x}let _,f=this.nodeList.byId[r].prev;for(;f&&h[_=f.data.id]>=h[s]&&l[r]-l[_]<d[r]-d[_];)l[_]=l[r]-d[r]+d[_],f=f.prev;for(f=this.nodeList.byId[n].next;f&&h[_=f.data.id]<=h[i]&&l[n]-l[_]>d[n]-d[_];)l[_]=l[n]-d[n]+d[_],f=f.next}placeNode(t,e,s,i,n){const{X:r,neighbours:o,mDist:a}=this,l=((n===0?o.prev:o.next)[t]||Dd).map(d=>r[d]);return l.length===0?r[t]:(i=x_(l),e!==Ns&&(i=Math.max(i,r[e]+a[t]-a[e])),s!==Ns&&(i=Math.min(i,r[s]+a[t]-a[s])),i)}moveLongEdge(t,e,s){const{X:i,virt:n,totalW:r,nodeList:o}=this,{id:a}=t.data;if(s[a]||!n[a])return;const l=this.longEdges[a];if(!l)return;l.forEach(_=>s[_]=!0);const d=l[0],h=l[l.length-1],u=[];e<0?u.push(i[d]<i[h]?i[d]:i[h],i[d]<i[h]?i[h]:i[d]):e>0?u.push(i[d]<i[h]?i[h]:i[d],i[d]<i[h]?i[d]:i[h]):u.push(i[d],i[h]);const c=u[0];let g,m=!1;for(;!m&&u.length!==0;)g=u.pop(),m=!0,l.forEach(_=>{const f=this.layers[this.nodeToLayer[_]];if(_!==f[0].id){const p=o.byId[_].prev.data;g-i[p.data.id]<r[_]-r[p.data.id]&&this.moveLongEdge(p,-1,s),m=m&&g-i[p.data.id]>=r[_]-r[p.data.id]-Be}if(_!==f[f.length-1].id){const p=o.byId[_].next.data;g-i[p.data.id]>r[_]-r[p.data.id]&&this.moveLongEdge(p,1,s),m=m&&g-i[p.data.id]<=r[_]-r[p.data.id]+Be}});m||(g=c,l.forEach(_=>{const f=this.layers[this.nodeToLayer[_]];if(_!==f[0].id){const p=o.byId[_].prev.data;g=Math.max(g,i[p.data.id]+r[_]-r[p.data.id])}if(_!==f[f.length-1].id){const p=o.byId[_].next.data;g=Math.min(g,i[p.data.id]+r[_]-r[p.data.id])}})),l.forEach(_=>i[_]=g)}moveLongEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.moveLongEdge(e[i],0,t);for(let i=s-1;i>=0;i--)this.moveLongEdge(e[i],0,t)})}computeY(){const{Y:t,layers:e,height:s}=this;t[0]=0,e.slice(1).forEach((i,n)=>{t[n+1]=t[n]+(s[n]+s[n+1])/2+this.layerDistance})}straightenLongEdge(t,e){const{nodeList:s,longEdges:i,neighbours:n,X:r,Y:o,nodeToLayer:a,totalW:l}=this,d=i[t.id];if(e[t.id]||!n.prev[t.id]||n.prev[t.id].length!==1||!n.next[t.id]||n.next[t.id].length!==1||!(d&&d.length<2))return;e[t.id]=!0;const h=n.prev[t.id][0],u=n.next[t.id][0];if(a[u]===a[h])return;const c=r[h]+(r[u]-r[h])*(o[a[t.id]]-o[a[h]])/(o[a[u]]-o[a[h]]);if(t!==this.first[a[t.id]]){const m=s.byId[t.id].prev.data;if(c-r[m.id]<l[t.id]-l[m.id]-Be&&this.straightenLongEdge(m,e),c-r[m.id]<l[t.id]-l[m.id]-Be)return}const g=this.layers[a[t.id]];if(t!==g[g.length-1]){const m=s.byId[t.id].next.data;if(r[m.id]-c<l[m.id]-l[t.id]-Be&&this.straightenLongEdge(m,e),r[m.id]-c<l[m.id]-l[t.id]-Be)return}r[t.id]=c}straightenEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.straightenLongEdge(e[i],t);for(let i=s-1;i>=0;i--)this.straightenLongEdge(e[i],t)})}run(){this.computeMinNodeDistances(),this.decrossVirtualEdges(),this.placeLongEdges(),this.placeNonVirtualNodes(),this.moveLongEdges(),this.computeY(),this.straightenEdges(),Ms(this.layers,(t,e,s,i)=>{t.x=this.X[t.id],t.y=this.Y[i]})}},WM=(t,e=20,s=50)=>new HM(t,e,s).run();function XM(t){if(t.sort((i,n)=>i-n),t.length===0)return 0;const e=Math.floor(t.length/2),s=Math.floor(t.length/2);return(t[e]+t[s])/2}function eu(t,e,s){const i={};return e.forEach((n,r)=>i[n.id]=r),t.map(n=>(s[n.id]||[]).map(r=>i[r]).sort()).reduce((n,r,o,a)=>{const l=r.length?r[r.length-1]:-1;for(let d=o+1;d<a.length;d++)n+=a[d].filter(h=>h<l).length;return n},0)}function YM(t,e,s,i,n){const r={};for(let o=0;o<t.length;o++)r[t[o].id]=XM((e[t[o].id]||[]).map(a=>s[a]))||0;n?t.sort((o,a)=>{const l=r[o.id]-r[a.id],d=i[o.id]===i[a.id],h=o.data.siblingIndex,u=a.data.siblingIndex;return d&&h>-1&&u>-1?h-u:l===0?s[a.id]-s[o.id]:l}):t.sort((o,a)=>{const l=r[o.id]-r[a.id];return l===0?s[a.id]-s[o.id]:l})}function b_({layers:t,topDown:e,topDownAdj:s,bottomUpAdj:i,idToIndex:n,crossings:r,sortSiblings:o}){const a=e?s:i;for(let l=e?0:t.length-1;e?l<t.length:l>=0;e?l++:l--){YM(t[l],a[l]||{},n,i[l],o);const d=l>0?eu(t[l-1],t[l],s[l-1]):0,h=l<t.length-1?eu(t[l],t[l+1],s[l]):0;h+d<(r[l]||0)+(r[l-1]||0)?(r[l]=h,l>0&&(r[l-1]=d),t[l].forEach((u,c)=>n[u.id]=c)):t[l].sort((u,c)=>n[u.id]-n[c.id])}}var $M=(t,e,s)=>{if(!s&&!e)return;const i={},n=t.map(()=>({})),r=t.map(()=>({}));t.forEach((h,u)=>{h.forEach((c,g)=>{i[c.id]=s?c.data.siblingIndex:g,c.children.forEach(m=>{const _=m.layer;_>u?(n[u][c.id]=n[u][c.id]||[],n[u][c.id].push(m.id),r[_][m.id]=r[_][m.id]||[],r[_][m.id].push(c.id)):(n[_][m.id]=n[_][m.id]||[],n[_][m.id].push(c.id),r[u][c.id]=r[u][c.id]||[],r[u][c.id].push(m.id))})})}),i[-1]=-1,s&&t.forEach(h=>h.sort((u,c)=>i[u.id]-i[c.id]));const o=t.slice(1).map((h,u)=>eu(t[u],h,n[u])),a=[[50,100],[100,10],[1e3,1],[5e3,0]],l=Math.max(...t.map(h=>h.length)),d=(a.find(([h])=>l<h)||a[a.length-1])[1];for(let h=0;h<d;h++)b_({layers:t,topDown:!0,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s}),b_({layers:t,topDown:!1,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s})};function qM(t){const e={},s={},i={};t.nodes.forEach(o=>{i[o.id]=o});const n=o=>{if(e[o.id])return s[o.id];e[o.id]=!0;let a=1/0;for(const l of o.children)a=Math.min(a,n(i[l.id])-1);return a===1/0&&(a=0),s[o.id]=a,a};t.nodes.forEach(o=>{o.data.parentIds.length===0&&n(o)});let r=1/0;t.nodes.forEach(o=>{r=Math.min(r,s[o.id])}),t.nodes.forEach(o=>{s[o.id]-=r,o.layer=s[o.id]})}function ZM(t){const e=t.nodes.reduce((s,i)=>i.data.fixed&&(s===null||s.layer>i.layer)?i:s,null);return e&&t.nodes.forEach(s=>s.ref=e.id),t}function JM(t){t.nodes.forEach(e=>{e.layer=e.data.layer!=null?e.data.layer:e.layer})}function KM(t){if(t.nodes.every(e=>e.layer)){const e=t.nodes.reduce((s,i)=>Math.min(s,i.layer),1/0);t.nodes.forEach(s=>s.layer-=e)}}function QM(t){const e={};t.nodes.forEach(r=>{e[r.id]=[...e[r.id]||[],...r.children],r.children.forEach(o=>{e[o.id]=[...e[o.id]||[],r]})});const s=[];t.nodes.forEach(r=>{r.layer===0&&s.push(r)});const i={},n={};for(t.nodes.forEach(r=>{r.layer!==-1&&(n[r.id]=r.layer)});s.length;){const r=s.shift().id;for(const o of e[r])if(!i[o.id]){if(n[o.id]===void 0){const a=n[r]+1;n[o.id]=a,o.layer=a}i[o.id]=!0,s.push(o)}}}function tN(t){if(t.nodes.some(e=>e.data.sink)){const e=t.nodes.reduce((s,i)=>Math.max(s,i.layer),-1/0);t.nodes.forEach(s=>{s.data.sink&&(s.layer=e+1)})}}function eN(t){const e=[];t.nodes.forEach(i=>e[i.layer]=0);const s=Array.from(e).reduce((i,n,r)=>{if(r===0)return i.push(0),i;const o=i[r-1];return n!==void 0?(i.push(o),i):(i.push(o-1),i)},[]);t.nodes.forEach(i=>i.layer+=s[i.layer])}function sN(t){if(t.nodes.some(e=>"layer"in e.data&&e.data.layer<0))throw new Error("Some nodes have negative layering information");return t.nodes.some(e=>e.data&&!isNaN(e.data.layer)&&e.data.layer!==null)||qM(t),JM(t),QM(t),tN(t),KM(t),eN(t),t.nodes.forEach(e=>{const{below:s,above:i}=e.children.reduce((n,r)=>(e.layer>r.layer?n.above.push(r):n.below.push(r),n),{above:[],below:[]});i.forEach(n=>n.children.push(e)),e.children=s}),ZM(t)}var iN=(t,{nodeDistance:e,layerDistance:s,nodeLookup:i,customSort:n,sortSiblings:r,shouldDecross:o=!0})=>{sN(t);const a=nN(t);return t.nodes.length>1?($M(a,o,r),n&&a.forEach(l=>{l.sort((d,h)=>n(i[d.id],i[h.id]))}),WM(a,e,s)):(t.nodes[0].x=0,t.nodes[0].y=0),rN(t),t};function nN(t){return t.nodes.reduce((e,s)=>(e[s.layer]=e[s.layer]||[],e[s.layer].push(s),s.children=s.children.map(i=>{if(i.layer===s.layer+1)return i;let n=i;for(let r=i.layer-1;r>s.layer;r--){const o=MM(`${s.id}->${i.id}@${r}`,r);o.children=[n],e[r]=e[r]||[],e[r].push(o),n=o}return n}),e),[])}function rN(t){t.nodes.forEach(e=>{e.data&&(e.children=e.children.filter(tu))})}var Rd=({id:t,layer:e,sink:s,siblingIndex:i,radius:n,layoutable:r})=>({id:t,layer:e!==void 0?e:void 0,sink:s,siblingIndex:i||0,radius:n||0,fixed:r===!1,parentIds:[],children:[],ref:null});function oN(t){const e={x:0,y:0};let s=0;for(let i=0;i<t.length;i++){const n=t[i];for(let r=0;r<n.nodes.length;r++){const o=n.nodes[r];e.x+=o.x||0,e.y+=o.y||0,s++}}return e.x/=s,e.y/=s,e}function aN(t){const e={x:0,y:0};let s=0;for(const i in t)e.x+=t[i].x||0,e.y+=t[i].y||0,s++;return e.x/=s,e.y/=s,e}function lN(t,e,s){const i=oN(s),n=t.x-i.x,r=t.y-i.y;for(let o=0;o<s.length;o++){const a=s[o];for(let l=0;l<a.nodes.length;l++){const d=a.nodes[l],h=e[d.id];!h||d.data&&d.data.fixed||(h.x=d.x+n,h.y=d.y+r)}}}var dN=(t,e={})=>{const s=(t.edges||[]).filter(({source:l,target:d})=>l!==d),i={},n=new Map;for(const l of t.nodes)i[l.id]=l;const r=UM(t.nodes,s,i).filter(l=>{const d=n.get(l.source);if(!d){const h=new Map;return h.set(l.target,!0),n.set(l.source,h),!0}return!d.get(l.target)&&(d.set(l.target,!0),!0)}),o=RM(t.nodes,r,{skipSingletons:e.packing==="grid"}),a=r.reduce((l,d)=>(l[d.source]||(l[d.source]=Rd(i[d.source])),l[d.target]||(l[d.target]=Rd(i[d.target])),l[d.target].children.push(d.source),l[d.target].parentIds.push(d.source),l),{});return{components:o.map(l=>l.map(d=>a[d]||Rd(i[d]))),lookup:i}};function hN(t,e,s){const i=[];for(const n of t){const r=GM(n);i.push(r),iN(r,{nodeDistance:s.nodesSeparation,layerDistance:s.layerSeparation,shouldDecross:s.shouldDecross,customSort:s.customSort,sortSiblings:!!s.sortSiblings,nodeLookup:e})}return i}var v_=(t,e={})=>{if(!t||!t.nodes)return t;const s=$t(ct({direction:"down",packing:"fit",nodesGridSeparation:1},e),{shouldDecross:e.shouldDecross!==!1}),{components:i,lookup:n}=dN(t,s),r=aN(n),o=hN(i,n,s);if(s.packing==="grid"){const a=BM(t.nodes,t.edges,s);o.push(a)}return LM(o,s),lN(r,n,o),t},Od={direction:"TB",nodeDistance:5,levelDistance:50,componentDistance:50,gapWidth:1,arrangeComponents:"fit",gridDistance:50,layer:"layer",siblingIndex:""},su={name:"hierarchical",imports:{sequential:v_},configure:function(t,{graph:e,data:s}){function i(x,y,b=x.getNodes()){return y?y instanceof Si?y:x.getNodes(y):b}const n=$t(ct(ct({},Od),t),{nodeList:t.nodes});n.direction=t.direction||Od.direction,n.layerSeparation=n.levelDistance,n.nodesSeparation=n.nodeDistance,n.componentsSeparation=n.componentDistance,n.gapDistance=n.gapWidth,n.packing=n.arrangeComponents;const r=ct({},n),o=n.edges,a=n.nodeList;if(["TB","BT","LR","RL"].indexOf(n.direction)===-1)throw new Error('direction should be one of the "TB", "BT", "LR", "RL"');if(["fit","grid","singleLine"].indexOf(n.packing)===-1)throw new Error('arrangeComponents should be one of the "fit", "grid", "singleLine"');n.nodesGridSeparation=t.gridDistance||Od.gridDistance;const l=a.getId(),d=a.getAttribute("layoutable").reduce((x,y,b)=>(x[l[b]]=y,x),{}),h=a.getAttributes(["x","y"]).reduce((x,y,b)=>(x[l[b]]=y,x),{}),u=a.getAttribute("radius");if(typeof r.layer!="string")throw new Error("'layer' should be the valid data field name");if(r.siblingIndex===void 0&&(r.siblingIndex=""),typeof r.siblingIndex!="string")throw new Error("'siblingIndex' should be the valid data field name");const c=i(e,n.roots,e.nodeList()),g=s.getProperty(n.nodeList,r.layer),m=r.siblingIndex.length?s.getProperty(n.nodeList,r.siblingIndex):[],_=c.map(x=>{let y=-1;return n.nodeList.forEach((b,v)=>{b===x&&(y=v)}),y});for(const x of _)g[x]=0;const f=i(e,n.sinks,e.nodeList()).toArray().reduce((x,y)=>(x[y.getId()]=!0,x),{}),p=l.map(x=>f[x]);return{nodes:l,edges:o.map(x=>({id:x.getId(),source:x.getSource().getId(),target:x.getTarget().getId()})),options:Pl(n),layoutable:d,radiuses:u,siblingIndexes:m,layers:g,sinks:p,coords:h}},context:Kt,update:function({nodes:t,edges:e,options:s,layoutable:i,radiuses:n,layers:r,siblingIndexes:o,sinks:a,coords:l}){const d=e.filter(({source:c,target:g})=>c in i&&g in i),h={nodes:t.map((c,g)=>({id:c,radius:n[g],layer:r[g],siblingIndex:o[g],sink:a[g],layoutable:i[c],x:l[c].x,y:l[c].y})),edges:d},{nodes:u}=v_(h,{packing:{fit:"fit",singleLine:"singleline",grid:"grid"}[s.arrangeComponents],direction:{TB:"down",BT:"up",RL:"left",LR:"right"}[s.direction],layerSeparation:s.layerSeparation,nodesSeparation:s.nodesSeparation,sortSiblings:o.length>0,componentsSeparation:s.componentsSeparation,nodesGridSeparation:s.nodesGridSeparation,evenDistribution:s.evenDistribution});return{positions:u}},isRunning:function(){return!1},onSync:function({positions:t},{graph:e}){return{indexes:t.map(({id:s})=>(e.getNode(s)||{_index:-1})._index),x:t.map(({x:s})=>s),y:t.map(({y:s})=>s)}}},uN=t=>(t.modules.layouts.register(su),(e={})=>(e.useWebWorker=!1,t.modules.layouts.start(su.name,e))),iu=(t,e)=>t-e,E_={name:"radial",imports:{minHeap:vu,bellmanFord:Eu,dijkstra:Au,johnson:Zd,distance:je,circleCircleIntersection:Tu,circleSortCompare:Iu,weightedStress:vf,distanceStress:Ef,constrainedStress:$d,stressMinimizationStep:qd,removeRadialOverlap:Qd,linear:ml,calculateRadii:Bc},configure(t,{graph:e}){let s=t.nodes;const i=s.size;function n(E,A){return E!=null&&isFinite(E)?E:A}if(t.centralNode===void 0)throw new Error('radial layout: missing parameter "centralNode"');const r=e.getNode(t.centralNode);if(r===void 0)throw new Error('radial layout: parameter "centralNode" is not valid');t.radiusRatio=n(t.radiusRatio,Math.SQRT2),t.radiusDelta=n(t.radiusDelta,0),t.nodeGap=n(t.nodeGap,10),t.repulsion=i*n(t.repulsion,1);const o=r.getPosition(),a=n(t.centerX,o.x),l=n(t.centerY,o.y),d=r._index;s.includes(r)||(s=s.concat(r.toList()));let h=s._indexes;const u=s.getAttribute("layoutable");h=h.filter((E,A)=>u[A]||E===d),h.sort(iu);const c=h.length,g=cN(h,e.getConnectedComponents(s,{internalIndexes:!0}),d),m=e.degrees(h),_=new Float32Array(e.getNodeAttribute("x").getMultiple(h)),f=new Float32Array(e.getNodeAttribute("y").getMultiple(h)),p=e.getNodeAttribute("radius").getMultiple(h),x=e.getEdges()._indexes,y=e.getEdgeAttribute("source").getMultiple(x),b=e.getEdgeAttribute("target").getMultiple(x),v=e.getAdjacencyList({internalIndexes:!0,weight:1,indexes:h});return{centerIndex:d,centerIndexPos:0,cx:a,cy:l,D:null,indexes:h,components:g,normIndexes:null,radii:null,rings:null,x:_,y:f,degree:m,size:c,attributes:{size:p,adjacency:v,weights:b.map(()=>1),sources:y,targets:b},sortAttr:null,allowOverlap:!!t.allowOverlap,nodeGap:t.nodeGap,radiusRatio:t.radiusRatio,radiusDelta:t.radiusDelta,repulsion:t.repulsion,randomize:!("randomize"in t)||!!t.randomize,renderSteps:!!t.renderSteps,epsilon:n(t.epsilon,.001),maxSteps:n(t.maxIterations,100),iterationsPerRender:n(t.iterationsPerRender,20),step:-1,stress:Number.POSITIVE_INFINITY,prevStress:0,converged:!1,overlapRemoved:!1,done:!1}},context:()=>({data:null,gridPlacement(t,e,s=8){const i=t.length,n=new Float32Array(i),r=new Float32Array(i);let o=0;for(let c=0,g=t.length;c<g;c++){const m=e[t[c]];m>o&&(o=m)}const a=o*s,l=Math.ceil(Math.sqrt(i)),d=Math.ceil(i/l),h=-Math.floor((d-1)*a/2),u=-Math.floor((l-1)*a/2);for(let c=0;c<l;c++)for(let g=0;g<d;g++)n[c*d+g]=h+g*a,r[c*d+g]=u+c*a;return{x:n,y:r}},connectComponents(t,e,s,i,n,r){let o;function a(l,d){const h=new Uint32Array(l.length+1);return h.set(l),h[l.length]=d,h}for(let l=1;l<t.length;l++){const d=t[l];let h=0,u=0;d.forEach((m,_)=>{const f=n.get(m);f!=null&&f>h&&(u=_,h=f)}),o=d[u];const c=e[r.get(o)];c.weights=c.weights||[],c.nodes=a(c.nodes,s),c.weights.push(i);const g=e[r.get(s)];g.weights=g.weights||[],g.nodes=a(g.nodes,o),g.weights.push(i)}},correctSubgraphsDistances(t,e,s,i,n){const r=Array.prototype.reduce.call(t[s],(a,l,d)=>(d!==s&&l<i&&l>a&&(a=l),a),0),o=i-r-1;for(let a=1;a<e.length;a++){const l=e[a];for(let d=0,h=l.length;d<h;d++){const u=n.get(l[d]);u!=null&&(t[s][u]-=o,t[u][s]-=o)}}},initialize(t,e){t.data=e,e.step=0;const s=new Map,i=new Map;e.normIndexes=e.indexes.reduce((d,h,u)=>(d[u]=u,s.set(h,u),i.set(h,e.degree[u]),t.data&&h===e.centerIndex&&(t.data.centerIndexPos=u),d),new Uint32Array(e.indexes.length));const n=e.centerIndexPos,r=e.components[0].length;t.connectComponents(e.components,e.attributes.adjacency,e.centerIndex,r,i,s);const o=Zd({sources:e.attributes.sources,targets:e.attributes.targets,weights:e.attributes.weights,indexes:e.indexes,adjacency:e.attributes.adjacency,undirected:!0});t.correctSubgraphsDistances(o,e.components,n,r,s),e.D=o;const a=o[n],l={};for(let d=0,h=e.normIndexes.length;d<h;d++)if(d!==n){const u=a[d];l[u]=l[u]||[],l[u].push(e.normIndexes[d])}e.rings=l,e.radii=Bc(n,e.rings,e.attributes.size,e.nodeGap,e.radiusRatio,e.radiusDelta)},removeOverlaps(t,e){if(!t.data)return;const s=t.data.centerIndexPos,i=e.attributes.size,{rings:n,radii:r}=e,o=e.x[s],a=e.y[s];for(const l in n){const d=n[l];for(let h=0;h<d.length;h++){const u=d[h],c=r[l];let g=e.x[u]-o,m=e.y[u]-a;g+m===0&&(g=Math.sin(u)*Math.random()*.001,m=Math.cos(u)*Math.random()*.001);const _=Math.sqrt(g*g+m*m);if(_-c<0){const f=c/_;e.x[u]=o+g*f,e.y[u]=a+m*f}}}for(const l in n){const d=n[l],h=je(o,a,e.x[d[0]],e.y[d[0]]);Qd({X:e.x,Y:e.y,sizes:i,indexes:d,center:[o,a],R:h,gap:e.nodeGap,inPlace:!0})}}}),update(t,e){t||(t=e.data);const s=t.indexes,i=t.centerIndex;let n;t.x=t.x||new Float32Array(t.size),t.y=t.y||new Float32Array(t.size),t.step===-1&&e.initialize(e,t);const r=t.repulsion,o=a=>t.radii&&t.radii[a]||1;if(t.step===0&&t.randomize&&(n=e.gridPlacement(t.indexes,t.attributes.size),t.x=n.x,t.y=n.y),!t.converged){const a=t.maxSteps,l=t.iterationsPerRender;let d=t.step;const h=Math.min(d+l,a),{D:u,x:c,y:g,size:m,centerIndexPos:_,normIndexes:f}=t;for(;d<=h&&!t.converged;){const p=ml(Math.min(d,a)/a);t.step=d++,n=qd(u,c,g,m,_,r,p,f,o),t.x=n.x,t.y=n.y,t.prevStress=t.stress,t.stress=$d(u,c,g,m,_,r,p,f),t.converged=t.converged||Math.abs(t.stress-t.prevStress)<=t.epsilon}}if(t.converged)if(t.overlapRemoved||t.allowOverlap){t.done=!0;const a=t.rings||{};t.rings=Object.keys(a).reduce((l,d)=>(l[d]=a[d].map(h=>s[h]),l),{})}else e.removeOverlaps(e,t,i),t.overlapRemoved=!0;return t},isRunning:({data:t})=>!(!t||t.converged&&(t.allowOverlap||t.done))||(t&&(t.step=-1),!1),onSync(t){if(t.renderSteps||t.done)return A_(t)},onEnd:t=>A_(t)};function A_(t){const e=t.x,s=t.y,i=t.indexes.length,n=e[t.centerIndexPos]-t.cx,r=s[t.centerIndexPos]-t.cy;for(let o=0;o<i;o++)e[o]-=n,s[o]-=r;return{indexes:t.indexes,x:e,y:s}}function cN(t,e,s){const i=t.slice().sort(iu),n=[];for(let r=0,o=e.length;r<o;r++){const a=[],l=e[r];let d=!1;for(let h=0,u=l.length;h<u;h++){const c=l[h];Sf(i,c)!==-1&&(c===s&&(d=!0),a.push(c))}a.length!==0&&n[d?"unshift":"push"](a.sort(iu))}return n}var gN=t=>(t.modules.layouts.register(E_),e=>{if(e.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');if(e.maxIterations=e.maxIterations&&isFinite(e.maxIterations)?Math.floor(e.maxIterations):100,e.maxIterations<1)throw new RangeError("maxIterations must be a positive integer");if(e.iterationsPerRender=e.iterationsPerRender&&isFinite(e.iterationsPerRender)?Math.floor(e.iterationsPerRender):20,e.iterationsPerRender<1)throw new RangeError("iterationsPerRender must be a positive integer");if(e.epsilon=e.epsilon&&isFinite(e.epsilon)?e.epsilon:.001,e.epsilon<=0)throw new RangeError("epsilon has to be a positive number");return t.modules.layouts.start(E_.name,e)}),S_=$t(ct({},su),{name:"sequential"}),mN=t=>(t.modules.layouts.register(S_),(e={})=>{e.useWebWorker=!1;const s=$t(ct({},e),{evenDistribution:!0});return t.modules.layouts.start(S_.name,s)}),_N=class extends ve{constructor(t){super(t),this.stop=()=>this._ogma.modules.layouts.stop(),this.concentric=mC(t),this.radial=gN(t),this.force=vM(t),this.forceLink=EM(t),this.hierarchical=uN(t),this.sequential=mN(t),this.grid=AM(t)}},fN=class extends ve{constructor(){super(...arguments),this.move=t=>this._ogma.modules.virtualMouse.move(t),this.down=t=>this._ogma.modules.virtualMouse.down(t),this.up=t=>this._ogma.modules.virtualMouse.up(t),this.click=t=>this._ogma.modules.virtualMouse.click(t),this.rightClick=t=>this._ogma.modules.virtualMouse.rightClick(t),this.doubleclick=t=>this._ogma.modules.virtualMouse.doubleclick(t),this.drag=(t,e)=>this._ogma.modules.virtualMouse.drag(t,e),this.wheel=t=>this._ogma.modules.virtualMouse.wheel(t)}},pN=class extends ve{constructor(){super(...arguments),this.map=t=>this._ogma.modules.rules.createMapping(t),this.slices=t=>this._ogma.modules.rules.createSlices(t),this.template=t=>this._ogma.modules.rules.createTemplate(t)}},yN=class extends ve{constructor(){super(...arguments),this.watchNodeObjectProperty=t=>this._ogma.modules.watcher.watchNodeObjectProperty(t),this.watchEdgeObjectProperty=t=>this._ogma.modules.watcher.watchEdgeObjectProperty(t),this.watchNodeNonObjectProperty=t=>this._ogma.modules.watcher.watchNodeNonObjectProperty(t),this.watchEdgeNonObjectProperty=t=>this._ogma.modules.watcher.watchEdgeNonObjectProperty(t)}},xN=class{clearSelection(){return this.modules.selection.clear()}getSelectedNodes(){return this.modules.selection.getSelectedNodes()}getNonSelectedNodes(){return this.modules.selection.getNonSelectedNodes()}getSelectedEdges(){return this.modules.selection.getSelectedEdges()}getNonSelectedEdges(){return this.modules.selection.getNonSelectedEdges()}},bN=class{setOptions(t){return this.modules.settings.update(t)}getOptions(){return this.modules.settings.get()}},vN=class extends ve{constructor(){super(...arguments),this.setNodesVisibility=t=>this._ogma.modules.graphics.setNodesVisibility(t),this.setEdgesVisibility=t=>this._ogma.modules.graphics.setEdgesVisibility(t),this.setNodeTextsVisibility=t=>this._ogma.modules.graphics.setNodeTextsVisibility(t),this.setEdgeTextsVisibility=t=>this._ogma.modules.graphics.setEdgeTextsVisibility(t),this.addRule=(t={})=>this._ogma.modules.styleRules.addRule(t),this.getRuleList=()=>this._ogma.modules.styleRules.getRuleList(),this.addNodeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({nodeAttributes:s,nodeSelector:i})},this.addEdgeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({edgeAttributes:s,edgeSelector:i})},this.getNodeRules=()=>this.getRuleList().filter(t=>t.getDefinition().edgeAttributes===void 0),this.getEdgeRules=()=>this.getRuleList().filter(t=>t.getDefinition().nodeAttributes===void 0),this.createClass=t=>this._ogma.modules.classes.createClass(t),this.getClass=t=>this._ogma.modules.classes.getClassByName(t),this.getClassList=()=>this._ogma.modules.classes.getClassList(),this.setHoveredNodeAttributes=(t,e)=>{this._ogma.modules.hover.updateNodeAttributes(t,e)},this.setHoveredEdgeAttributes=(t,e)=>{this._ogma.modules.hover.updateEdgeAttributes(t,e)},this.setSelectedNodeAttributes=(t,e)=>this._ogma.modules.selection.setNodeAttributes(t,!!e),this.setSelectedEdgeAttributes=(t,e)=>this._ogma.modules.selection.setEdgeAttributes(t,!!e),this.setTheme=({nodeAttributes:t,edgeAttributes:e,selectedNodeAttributes:s,selectedEdgeAttributes:i,hoveredNodeAttributes:n,hoveredEdgeAttributes:r})=>{this._ogma.modules.pulses.setTheme(t&&t.pulse||{},e&&e.pulse||{}),this._ogma.modules.graphics.getAttributesManager().setDefaultAttributes(t||{},e||{}),this.setSelectedNodeAttributes(s||{}),this.setSelectedEdgeAttributes(i||{}),this.setHoveredNodeAttributes(n||{}),this.setHoveredEdgeAttributes(r||{})}}},EN=class extends ve{constructor(){super(...arguments),this.set=(t,e)=>this._ogma.modules.brand.set(t,e),this.remove=()=>{this._ogma.modules.brand.remove()}}},AN=class extends ve{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.connectNodes.enable(t),this),this.disable=()=>(this._ogma.modules.connectNodes.disable(),this),this.enabled=()=>this._ogma.modules.connectNodes.enabled()}},w_={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t})=>t.setSelected(!0),bothExtremities:!1},J0=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._points=[],this._bbox=new xs,this._onStart=({x:t,y:e})=>{this._bbox.reset(),this.savePoint(t,e,!1)},this._onStop=()=>{const{minX:t,minY:e,maxX:s,maxY:i}=this._bbox,{nodes:n,edges:r}=this._modules.spatial.queryProjected(t,e,s,i),o={},a=n.filter(d=>{const h=d.isVisible(),u=d.getAttribute("detectable"),c=h&&u&&this._modules.locate.isNodeInPolygon(d,this._points);return o[d._index]=c,c});let l=r.filter(d=>{const h=d.isVisible(),u=d.getAttribute("detectable");return h&&u&&this._modules.locate.isEdgeInPolygon(d,this._points)});this._options.bothExtremities&&(l=this.filterByExtremities(l,o)),this._layer.clear(),this._points=[],this.disable(),this._options.callback({nodes:a,edges:l})}}onMounted(){this._options=Pe(w_),this._cachedCursor="",this._modules.events.isRegistered("lassoEnabled")||this._modules.events.register(["lassoEnabled","lassoDisabled"]),this._interaction=this._modules.interactions.onDrag({priority:"lasso",check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this.savePoint(t,e,!0),onStop:this._onStop})}enable(t={}){var e;return this._enabled||(this._enabled=!0,this._modules.captor.setDetectionEnabled(!1),this._options=Is(t,w_),this._layer=this._modules.layers.addCanvasLayer(Kt,{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._cachedCursor=((e=this._layer.element.parentElement)==null?void 0:e.style.cursor)||"",Ka(this._layer.element.parentElement,this._options.cursorStyle),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorPosition()),this._modules.events.fire("lassoEnabled")),this}disable(){return this._enabled?(this._enabled=!1,this._modules.captor.setDetectionEnabled(!0),Ka(this._layer.element.parentElement,this._cachedCursor),this._layer.destroy(),this._modules.events.fire("lassoDisabled"),this):this}enabled(){return this._enabled}savePoint(t,e,s){const i=Ss(),n=this._options,r=this._points;if(this._bbox.addPoint(t,e),r.push({x:t,y:e}),s){const o=r[0];this._layer.refresh(a=>{a.lineWidth=n.strokeWidth,a.lineJoin="bevel",a.strokeStyle=n.strokeColor,a.fillStyle=n.fillColor,a.beginPath(),a.moveTo(o.x*i,o.y*i);for(let l=1;l<r.length;++l){const d=r[l];a.lineTo(d.x*i,d.y*i)}a.stroke(),n.fillColor&&a.fill()})}}filterByExtremities(t,e){const s=this._modules.graph.getEdgeAttribute("source"),i=this._modules.graph.getEdgeAttribute("target");return t.filter(n=>{const r=n._index,o=s.get(r),a=i.get(r);return e[o]&&e[a]})}},SN=class extends ve{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.lasso.enable(t),this),this.disable=()=>(this._ogma.modules.lasso.disable(),this),this.enabled=()=>this._ogma.modules.lasso.enabled()}},wN=class extends ve{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.legend.enable(t),this.disable=()=>this._ogma.modules.legend.disable(),this.enabled=()=>this._ogma.modules.legend.enabled(),this.getOptions=()=>this._ogma.modules.legend.getOptions(),this.export=t=>this._ogma.modules.legend.export(t)}},T_={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t,edges:e})=>{t.size?t.setSelected(!0):e.setSelected(!0)},bothExtremities:!1},TN=class extends J0{constructor(){super(...arguments),this._onStart=({x:t,y:e})=>{var s;this._rectangle.reset(),this._start={x:t,y:e},(s=this._layer)==null||s.refresh(i=>{i.fillStyle=this._options.fillColor,i.strokeStyle=this._options.strokeColor,i.lineWidth=this._options.strokeWidth})},this._onStop=()=>{var t;const e=this._modules.captor.getCursorPosition(),s=this._formatRectangle(e),{nodes:i,edges:n}=this._modules.spatial.queryProjected(s.minX,s.minY,s.maxX,s.maxY),r={},o=i.filter(l=>{const d=l.isVisible(),h=l.getAttribute("detectable"),u=d&&h&&this._modules.locate.isNodeInRectangle(l,s);return r[l._index]=u,u});let a=n.filter(l=>{const d=l.isVisible(),h=l.getAttribute("detectable");return d&&h&&this._modules.locate.isEdgeInRectangle(l,s)});this._options.bothExtremities&&(a=this.filterByExtremities(a,r)),(t=this._layer)==null||t.clear(),this.disable(),this._options.callback({nodes:o,edges:a})}}onMounted(){this._options=Pe(T_),this._enabled=!1,this._rectangle=new xs,this._interaction=this._modules.interactions.onDrag({priority:"lasso",disableDetection:!0,check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this._refreshRectangle({x:t,y:e}),onStop:this._onStop})}enable(t){return super.enable(Is(t,T_))}_formatRectangle(t){const e=this._start.x,s=this._start.y,i=t.x,n=t.y,r=Math.abs(e-i),o=Math.abs(s-n),a=e<i?e:i,l=s<n?s:n;return this._rectangle.reset().addPoint(a,l).addPoint(a+r,l+o)}_refreshRectangle(t){var e;const{minX:s,minY:i,width:n,height:r}=this._formatRectangle(t),o=Ss();(e=this._layer)==null||e.refresh(a=>{a.strokeRect(s*o,i*o,n*o,r*o),this._options.fillColor&&a.fillRect(s*o,i*o,n*o,r*o)})}},IN=class extends ve{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rectangleSelect.enable(t)},this.disable=()=>{this._ogma.modules.rectangleSelect.disable()},this.enabled=()=>this._ogma.modules.rectangleSelect.enabled()}},LN=class extends ve{constructor(){super(...arguments),this.enable=t=>{this._ogma.modules.resizing.enable(t)},this.disable=()=>{this._ogma.modules.resizing.disable()},this.enabled=()=>this._ogma.modules.resizing.enabled()}},CN=class extends ve{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rewiring.enable(t)},this.disable=()=>{this._ogma.modules.rewiring.disable()},this.enabled=()=>this._ogma.modules.rewiring.enabled()}},MN=class extends ve{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.snapping.enable(t)},this.disable=()=>{this._ogma.modules.snapping.disable()},this.enabled=()=>this._ogma.modules.snapping.enabled()}},NN=class extends ve{constructor(){super(...arguments),this.onNodeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.node",t,e)},this.onNodeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.node",t,e)},this.onNodeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.node",t,e)},this.onNodeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.node",t,e)},this.onEdgeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.edge",t,e)},this.onEdgeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.edge",t,e)},this.onEdgeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.edge",t,e)},this.onEdgeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.edge",t,e)},this.onBackgroundClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.background",t,e)},this.onBackgroundRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.background",t,e)},this.onBackgroundDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.background",t,e)},this.refresh=()=>this._ogma.modules.tooltip.refresh(),this.isShown=()=>this._ogma.modules.tooltip.isShown(),this.hide=()=>{this._ogma.modules.tooltip.hide()},this.show=(t,e)=>this._ogma.modules.tooltip.show(t,e)}},PN=class extends ve{constructor(t){super(t),this.lasso=new SN(t),this.connectNodes=new AN(t),this.legend=new wN(t),this.rectangleSelect=new IN(t),this.resize=new LN(t),this.rewire=new CN(t),this.snapping=new MN(t),this.tooltip=new NN(t),this.brand=new EN(t)}},FN=class extends ve{constructor(t){super(t),this.getList=()=>this._ogma.modules.transformations.api.getList(),this.clear=()=>this._ogma.modules.transformations.api.clear().then(()=>{}),this.getById=e=>this._ogma.modules.transformations.api.getById(e),this.afterNextUpdate=()=>this._ogma.modules.transformations.afterNextUpdate(),this.onGroupsUpdated=e=>{this._ogma.modules.transformations.onGroupsUpdated(e)},this.layoutGroups=(e,s,i=!1)=>this._ogma.modules.transformations.api.layoutGroups(e,s,i)}addNodeGrouping(t){return this._ogma.modules.transformations.api.addNodeGrouping(t)}addNodeClustering(t){return this._ogma.modules.transformations.api.addNodeClustering(t)}addEdgeGrouping(t){return this._ogma.modules.transformations.api.addEdgeGrouping(t)}addDrillDown(t){return this._ogma.modules.transformations.api.addDrilldown(t)}addNodeFilter(t){return this._ogma.modules.transformations.api.addNodeFilter(t)}addEdgeFilter(t){return this._ogma.modules.transformations.api.addEdgeFilter(t)}getNodeFilters(){return this._ogma.modules.transformations.getNodeFilters()}getEdgeFilters(){return this._ogma.modules.transformations.getEdgeFilters()}addNeighborGeneration(t){return this._ogma.modules.transformations.api.addNeighborGeneration(t)}addNeighborMerging(t){return this._ogma.modules.transformations.api.addNeighborMerging(t)}addNodeCollapsing(t){return this._ogma.modules.transformations.api.addNodeCollapsing(t)}addGeoClustering(t){return this._ogma.modules.transformations.api.addGeoClustering(t)}addVirtualProperties(t){return this._ogma.modules.transformations.api.addVirtualProperties(t)}},kN=class extends ve{constructor(){super(...arguments),this.setZoom=(t,e)=>this._ogma.modules.camera.setZoom(t,e),this.zoomIn=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomIn():this._ogma.modules.camera.zoomIn(t),this.zoomOut=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomOut():this._ogma.modules.camera.zoomOut(t),this.getZoom=()=>this._ogma.modules.camera.getZoom(),this.setCenter=(t,e)=>this._ogma.modules.camera.setCenter(t,e),this.move=(t,e)=>this._ogma.modules.camera.move(t,e),this.moveToBounds=(t,e)=>{if(!(t&&t instanceof xs)){if(!es(t)||t.length!==4)throw new Error("ogma.view.zoomToBounds requires a BoundingBox as a parameter");{const[s,i,n,r]=t;t=xs.from({minX:s,minY:i,maxX:n,maxY:r})}}return this._ogma.modules.camera.moveToBounds(t,e)},this.moveTo=(t,e)=>this._ogma.modules.camera.moveTo(t,e),this.getCenter=()=>this._ogma.modules.camera.getCenter(),this.setAngle=(t,e)=>this._ogma.modules.camera.setAngle(t,e),this.rotate=(t,e)=>this._ogma.modules.camera.rotate(t,e),this.getAngle=()=>this._ogma.modules.camera.getAngle(),this.set=(t,e)=>this._ogma.modules.camera.setView(t,e),this.get=()=>this._ogma.modules.camera.getView(),this.graphToScreenCoordinates=t=>this._ogma.modules.camera.graphToScreenCoordinates(t),this.screenToGraphCoordinates=t=>this._ogma.modules.camera.screenToGraphCoordinates(t),this.getImageData=()=>this._ogma.modules.graphics.getImageData(),this.getElementAt=t=>this._ogma.modules.captor.detectElementAt(t.x,t.y,!1,!0),this.getElementsInView=()=>{const{width:t,height:e}=this.get(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return this._ogma.modules.spatial.query(s.x,s.y,i.x,i.y)},this.getBounds=()=>{const{width:t,height:e}=this.getSize(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return{cx:(s.x+i.x)/2,cy:(s.y+i.y)/2,width:i.x-s.x,height:i.y-s.y,minX:s.x,minY:s.y,maxX:i.x,maxY:i.y}},this.getElementsInside=(t,e,s,i,n=!0)=>{const{spatial:r,camera:o}=this._ogma.modules;if(n){const a=o.graphToScreenCoordinates({x:t,y:e}),l=o.graphToScreenCoordinates({x:s,y:i});return r.queryProjected(a.x,a.y,l.x,l.y)}return r.queryProjected(t,e,s,i)},this.beforeNextFrame=()=>this._ogma.modules.dom.beforeNextFrame(),this.afterNextFrame=()=>this._ogma.modules.dom.afterNextFrame(),this.setFullScreen=t=>this._ogma.modules.dom.setFullScreen(t),this.isFullScreen=()=>this._ogma.modules.dom.isFullScreen(),this.forceResize=()=>this._ogma.modules.dom.forceResize(),this.getSize=()=>this._ogma.modules.dom.getDimensions(),this.setSize=t=>{if(!t||isNaN(t.width)||isNaN(t.height))throw new Error("Size must follow the format { width: number, height: number }");if(t.width<0)throw new Error("width must be positive");if(t.height<0)throw new Error("height must be positive");return this._ogma.modules.dom.setDimensions(t),Promise.resolve()},this.locateGraph=t=>this._ogma.modules.locate.locateGraph(t),this.locateRawGraph=(t,e)=>this._ogma.modules.locate.locateRawGraph(t,e),this.getGraphBoundingBox=({withTexts:t=!1}={})=>this._ogma.modules.locate.getGraphBoundingBox(t),this.animationInProgress=()=>this._ogma.modules.locate.isLocating()||this._ogma.modules.camera.animationInProgress(),this.getTextBoundingBox=t=>{if(!t)throw new Error("ogma.view.getTextBoundingBox: item must be a Node or an Edge");const e=t.getAttribute("text");return e==null||e===""?null:t.isList?this._ogma.modules.labels.getTextsBoundingBox(t):this._ogma.modules.labels.getTextsBoundingBox(t.toList())},this.getNodeBadgeAt=(t,e)=>{if(!t)throw new Error("ogma.view.getNodeBadgeAt: node is not defined");return jy(e,t._index,this._ogma.modules.graphics.getAttributesManager(),this._ogma.modules.camera,this._ogma.modules.graphics.getGraphicsEngine())}}},DN=class{constructor(t,e){this._ogma=t,this.settings=new LI(t),this.events=new wI(t),this.dom=new ZE(t),this.animations=new MP(t),this.camera=new uI(t),this.graph=new w1(t),this.data=new QE(t),this.graphics=new yI(t),this.layers=new Kk(t),this.individualAttributes=new II(t),this.algorithms=new Qk(t),this.position=new Vk(t),this.touch=new KI(t),this.mouse=new ZI(t),this.virtualMouse=new lF(t),this.spatial=new zI(t),this.captor=new VF(t),this.interactions=new kF(t),this.classes=new PI(t),this.cameraInteractions=new dI(t,!!e.debug),this.hover=new Gk(t),this.keyboard=new sk(t),this.selection=new EP(t),this.styleRules=new gF(t),this.legend=new Bk(t),this.sync=new AP(t),this.rules=new $k(t),this.transformations=new bP(t),this.locate=new XI(t),this.drag=new jF(t),this.pulses=new IP(t),this.curvatureManager=new WP(t),this.workers=new ZP(t),this.layouts=new KP(t),this.watcher=new iF(t),this.rectangleSelect=new TN(t),this.labels=new FF(t,e),this.brand=new jP(t),this.lasso=new J0(t),this.rewiring=new WF(t),this.resizing=new XF(t),this.snapping=new dF(t),this.connectNodes=new $F(t),this.tooltip=new tk(t),this.geo=new HP(t),Object.keys(this).forEach(s=>{const i=this[s];i instanceof Bt&&(i._setModules(this),i.onMounted())}),t.onReady(()=>{Object.keys(this).forEach(s=>{const i=this[s];i instanceof Bt&&i.onReady(e)})})}destroy(){Object.keys(this).forEach(t=>{const e=this[t];e instanceof Bt&&e.destroy(this._ogma)})}},RN=1,ON=[tL,QI,nL,l1,hC,xN,bN],Ic={version:"5.1.7",commit:"614bc2138",buildTime:"Fri Sep 13 2024 07:55:00 GMT+0000 (Coordinated Universal Time)"},sn=class nu{constructor(e={}){this.node=s=>new ni(s,this),this.edge=s=>new Hi(s,this),this.nodeList=s=>new Si(s||new Uint32Array(0),this),this.edgeList=s=>new Tn(s||new Uint32Array(0),this),this._onReady=[],this.build=Ic,this._init(e)}_init(e){this._initParameters=e,this._debug=!!e.debug,this._token=RN++,this.modules=new DN(this,e),this.styles=new vN(this),this.algorithms=new tD(this),this.export=new aC(this),this.keyboard=new cC(this),this.generate=new lC(this),this.layouts=new _N(this),this.parse=new uC(this),this.transformations=new FN(this),this.tools=new PN(this),this.view=new kN(this),this.mouse=new fN(this),this.events=new rL(this),this.schema=new yN(this),this.rules=new pN(this),this.geo=new dC(this),this.layers=new gC(this),this.debug=new iL(this),this._onReady.forEach(s=>s(this)),this.safelyBindToInstance(),this.modules.events.register(["destroy"]),this.build={version:"5.1.7",commit:"614bc2138",buildTime:"Fri Sep 13 2024 07:55:00 GMT+0000 (Coordinated Universal Time)"}}safelyBindToInstance(){for(const e of Object.getOwnPropertyNames(nu.prototype))typeof nu.prototype[e]=="function"&&(this[e]=this[e].bind(this))}onReady(e){this._onReady.push(e)}_destroy(){if(!this._token)throw new Error('"destroy" called twice on the same instance of Ogma');this._onReady=[],this.modules.destroy(),this.modules=null}destroy(){this.modules.events.fire("destroy",{}),this._destroy()}isDestroyed(){return!this.modules}reset(){const e=this._initParameters;this._destroy(),this._init(e)}isDebug(){return this._debug}};sn.libraries=tp,sn.geometry=M0,sn.parse=vc,sn.build=Ic,sn.algorithms=bu,sn.utils=hc;var Gn=sn;Gn.algorithms=bu,Gn.utils=hc,Gn.parse=vc,Gn.build=Ic,RE(Gn,ON);var K0=Gn,us=(t=>(t.NodeFilter="node-filter",t.EdgeFilter="edge-filter",t.NodeCollapsing="node-collapsing",t.VirtualProperties="virtual-properties",t.NeighborGeneration="neighbor-generation",t.NeighborMerging="neighbor-merging",t.NodeGrouping="node-grouping",t.EdgeGrouping="edge-grouping",t.NodeClustering="node-clustering",t.GeoClustering="geo-clustering",t.Unknown="unknown",t))(us||{}),Qi=class{constructor({id:t,duration:e,easing:s,ogma:i,module:n}){this.animation=s?{duration:e,easing:s}:e===void 0?0:e,this.destroyed=!1,this.id=t,this.ogma=i,this.context={},this.module=n,this.resetContext()}setOptions(t){var e;let s=typeof this.animation=="number"?this.animation:(e=this.animation)==null?void 0:e.duration,i=typeof this.animation=="object"?this.animation.easing:void 0;return typeof t.duration=="number"&&(s=t.duration),t.easing!==void 0&&(i=t.easing),this.animation=i?{duration:s,easing:i}:s===void 0?0:s,this.module.setOptions(this),this.module.afterNextUpdate()}enable(t){return this.animation=t===void 0?this.animation:t,this.module.enable(this)}disable(t){return this.animation=t===void 0?this.animation:t,this.module.disable(this)}isEnabled(){return this.module.isEnabled(this)}getId(){return this.id}whenApplied(){return this.module.afterNextUpdate().then(()=>this)}toggle(t){return this.animation=t===void 0?this.animation:t,this.isEnabled()?this.module.disable(this):this.module.enable(this)}run(t=!0){return Promise.resolve()}undo(t=!0){return Promise.resolve()}cleanup(){return this.resetContext(),Promise.resolve()}refresh(){return this.module.refreshTransformation(this),this.module.afterNextUpdate()}getIndex(){return this.module.getIndex(this)}setIndex(t){return this.module.setIndex(this,t),this.module.afterNextUpdate()}getAnimation(){return typeof this.animation=="number"?{duration:this.animation,easing:"linear"}:this.animation}getContext(){return this.context}setContent(t){this.context=t}resetContext(){this.context={}}getName(){return us.Unknown}destroy(t){return t!==void 0&&(this.animation=t),this.module.remove(this)}},zN=class{constructor(t){this.xs=new Map,this.ys=new Map,this.rs=new Map,this.curvatures=new Map,this.hiddenNodes=new Set,this.hiddenEdges=new Set,this.animations=[],this.before=[],this.after=[],this.enabled=!1,this.applying=!1,this._onLayoutEnd=e=>{if(!this.enabled)return;const s=e.positions.current,i=e.ids;for(let n=0;n<i.length;n++){const r=this.ogma.getNode(i[n])._index,o=s[n];o&&(this.xs.set(r,o.x),this.ys.set(r,o.y))}},this._onLayoutPrepare=e=>{this.enabled&&(e.params.dryRun=!0)},this._onNodesRemoved=e=>{const s=e.nodes._indexes;for(const i of s)this.xs.delete(i),this.ys.delete(i),this.rs.delete(i)},this._onLayoutGetData=({name:e,data:s})=>{if(this.enabled){if(e==="force"){const i=s.graph.nodes,n=s.indexes;for(let r=0;r<n.length;r++)this.xs.has(n[r])&&(i[r].x=this.xs.get(n[r]),i[r].y=this.ys.get(n[r]),i[r].r=this.rs.get(n[r])!==void 0?1.25*this.rs.get(n[r]):i[r].r)}else if(e==="hierarchical"||e==="sequential"){const i=s.options.nodes._indexes;for(let n=0;n<i.length;n++)this.rs.has(i[n])&&(s.radiuses[n]=this.rs.get(i[n]))}else if(e==="concentric"){const i=s.list;for(let n=0;n<i.length;n++)this.rs.has(i[n])&&(s.attributes.size[n]=this.rs.get(i[n]))}else if(e==="forceLink")for(const i in s.nodes){const n=Number(i),r=s.nodes[n];this.xs.has(n)&&(r.x=this.xs.get(n),r.y=this.ys.get(n)),this.rs.has(n)&&(r.size=this.rs.get(n))}else if(e==="radial"){const i=s.indexes;for(let n=0;n<i.length;n++){const r=i[n];this.xs.has(r)&&(s.x[n]=this.xs.get(r),s.y[n]=this.ys.get(r)),this.rs.has(r)&&(s.attributes.size[n]=this.rs.get(r))}}else if(e!=="grid")throw new Error(`Ogma transformtaions: Unsupported layout: ${e}`)}},this.ogma=t,this.layer=this.ogma.modules.graphics.addAttributeLayer({name:"ogma-transformations-animations",priority:4.1,nodeOutput:{attributes:["radius"]},edgeOutput:{attributes:["curvature"]},nodeDependencies:void 0,edgeDependencies:void 0}),this.attributeLayerData=this.layer._attributesManager._getLayerById(this.layer._id),this.initEvents()}initEvents(){this.ogma.events.on("layoutPrepare",this._onLayoutPrepare).on("layoutEnd",this._onLayoutEnd).on("removeNodes",this._onNodesRemoved).on("layoutGetData",this._onLayoutGetData)}handleLayoutPromises(t){return Promise.all(t).then(e=>{e.forEach(s=>{if(!s)return;const{res:i,subNodes:n}=s;if(!Array.isArray(i))return;const r=n._indexes;for(let o=0;o<r.length;o++){const{x:a,y:l,radius:d}=i[o];d!==void 0?this.setXYR(r[o],a,l,d):this.setXY(r[o],a,l)}})})}apply(t){const e=Array.from(this.xs.values()),s=Array.from(this.ys.values()),i=Array.from(this.rs.values()).map(u=>({radius:u})),n=Array.from(this.curvatures.values()).map(u=>({curvature:u})),r=this.ogma.nodeList(Array.from(this.hiddenNodes)),o=this.ogma.edgeList(Array.from(this.hiddenEdges)),a=e.map((u,c)=>({x:u,y:s[c]})),l=this.ogma.nodeList(Array.from(this.xs.keys())),d=this.ogma.nodeList(Array.from(this.rs.keys())),h=this.ogma.edgeList(Array.from(this.curvatures.keys()));return this.xs.clear(),this.ys.clear(),this.rs.clear(),this.curvatures.clear(),this.hiddenNodes.clear(),this.hiddenEdges.clear(),this.before.forEach(u=>u()),this.initCurvature(h._indexes),this.applying=a.length>0||i.length>0||n.length>0,Promise.all([a.length?l.setAttributes(a,t):Promise.resolve(),i.length?this.ogma.modules.graphics.animate(d,()=>this.layer.setAttributeValues(d,i),!1,t):Promise.resolve(),n.length?this.ogma.modules.graphics.animate(h,()=>this.layer.setAttributeValues(h,n),!1,t):Promise.resolve(),...this.animations.map(u=>u())]).then(()=>Promise.all(this.after.map(u=>u()))).then(()=>{this.deleteCurvatures(h._indexes),r.setVisible(!1),o.setVisible(!1),this.animations=[],this.before=[],this.after=[],this.applying=!1})}setXYR(t,e,s,i){if(typeof t=="number")this.xs.set(t,e),this.ys.set(t,s),i!==void 0&&this.rs.set(t,i);else for(const n of t)this.xs.set(n,e),this.ys.set(n,s),i!==void 0&&this.rs.set(n,i)}getOpenRadius(t){return this.attributeLayerData.nodes.outputFlexArrays.radius.get(t)}getCloseRadius(t){return this.attributeLayerData.nodes.inputFlexArrays.radius.get(t)}deleteOpenRadius(t){this.layer.getFlexArrays().nodes.radius.set(t,void 0)}initCurvature(t){const e=this.attributeLayerData.edges.inputFlexArrays.curvature,s=this.attributeLayerData.edges.outputFlexArrays.curvature;for(let i=0;i<t.length;i++)s.set(t[i],e.get(t[i]))}deleteCurvatures(t){const e=this.layer.getFlexArrays().edges.curvature;for(let s=0;s<t.length;s++)e.set(t[s],void 0)}hideNode(t){this.hiddenNodes.add(t)}showNode(t){this.hiddenNodes.delete(t)}hideNodes(t){for(const e of t)this.hiddenNodes.add(e)}showNodes(t){for(const e of t)this.hiddenNodes.delete(e)}hideEdge(t){this.hiddenEdges.add(t)}showEdge(t){this.hiddenEdges.delete(t)}hideEdges(t){for(const e of t)this.hiddenEdges.add(e)}showEdges(t){for(const e of t)this.hiddenEdges.delete(e)}pushBefore(t){Array.isArray(t)?this.before.push(...t):this.before.push(t)}pushAfter(t){Array.isArray(t)?this.after.push(...t):this.after.push(t)}setXY(t,e,s){this.xs.set(t,e),this.ys.set(t,s)}setR(t,e){this.rs.set(t,e)}setRs(t,e){for(let s=0;s<t.length;s++)this.rs.set(t[s],e[s])}setCurvatures(t,e){for(let s=0;s<t.length;s++)this.curvatures.set(t[s],e[s])}setCurvature(t,e){this.curvatures.set(t,e)}setOpenRadius(t,e){this.attributeLayerData.nodes.outputFlexArrays.radius.set(t,e)}push(t){Array.isArray(t)?this.animations.push(...t):this.animations.push(t)}enable(){this.enabled=!0}disable(){this.enabled=!1}getMaxAnimation(t,e){return(typeof t=="number"?t:t.duration)>(typeof e=="number"?e:e.duration)?t:e}isApplying(){return this.applying}},ru=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)i.hasOwnProperty(n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):I_(e[n])&&I_(i[n])?e[n]=ru(e[n],i[n]):e[n]=i[n])}return e};function Wr(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function BN(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Ogma transformations: Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}function UN(t,e){const s=t.get(0);return{data:s.getData(),attributes:s.getAttributes(e)}}function xl(t,e){return`gen_grp_${e}_${t}`}function I_(t){return!(!t||t.constructor!==Object&&t.constructor)}function GN(t){return t.map(({id:e,source:s,target:i})=>({id:e,source:s,target:i}))}function VN(t,e,s,i){let n=e,r=s;return!i&&n.toString()>r.toString()&&(n=s,r=e),`${t}[${n}-${r}]`}function jN(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`Ogma transformation: ${t} is not a valid id, expected string or number`);return t}function ba(t){return`data.${t}`}var HN=class{constructor(t){this.groupsByDepth=new Map,this.treeMap=new Map,this.dataMap=new Map,this.invalidEdges=new Map,this.edges=new Map,this.ogma=t.ogma,this.module=t.module,this.enabled=t.enabled===void 0||t.enabled,this.onGetSubgraph=t.onGetSubgraph,this.duration=t.duration||0,this.easing=t.easing||"quadraticOut",this.parentPath=t.parentPath||"parent",this.depthPath=t.depthPath||"depth",this.padding=t.padding||0,this.nodeGenerator=t.nodeGenerator||(()=>({})),this.showContents=t.showContents===void 0||t.showContents,this.onGroupUpdate=t.onGroupUpdate||(()=>Promise.resolve()),this.copyData=t.copyData===void 0||t.copyData,this.context={virtualEdges:this.ogma.edgeList()}}createGrouping(t){var e;const{ogma:s,groupsByDepth:i}=this,n=s.transformations.addNodeGrouping({selector:o=>o.getData(this.depthPath)===t,groupIdFunction:o=>o.getData(this.parentPath),showContents:o=>typeof this.showContents=="boolean"?this.showContents:this.showContents(o,t),onBeforeAddMetaEdges:(o,a)=>this.addEdges(o,a),onGroupUpdate:(o,a,l)=>this.onGroupUpdate(o,a,l,t),padding:o=>typeof this.padding=="number"?this.padding:this.padding(o,t),duration:this.duration,enabled:this.enabled,nodeGenerator:(o,a)=>{const l=this.nodeGenerator(o,a,n);return this.copyData&&(l.data||(l.data={}),l.data=ct(ct({},l.data),this.dataMap.get(a))),Wr(l,ba(this.parentPath),this.treeMap.get(a)),Wr(l,ba(this.depthPath),t-1),l.id=a,l}});if(!i.size)return i.set(t,n);const r=Array.from(i.keys()).reduce((o,a)=>Math.max(o,a));i.set(t,n),n.setIndex((e=i.get(r))==null?void 0:e.getIndex())}drill(t){return xn(this,null,function*(){if(this.treeMap.has(t.getId()))return;const{ogma:e,groupsByDepth:s}=this,i=t.getId(),n=this.getGroupId(i);this.treeMap.set(n,t.getData(this.parentPath)),this.dataMap.set(n,t.getData());const r=t.getData(this.depthPath)||0,o=t.getPosition(),a=yield this.onGetSubgraph(t);this.edges.set(n,t.getAdjacentEdges().map(d=>{const h=d.getSource().getId(),u=d.getTarget().getId();return{source:h===i?n:h,target:u===i?n:u,data:ct({},d.getData())}})),a.nodes.forEach(d=>{Wr(d,ba(this.parentPath),n),Wr(d,ba(this.depthPath),r+1),d.attributes||(d.attributes={}),d.attributes.x=o.x,d.attributes.y=o.y}),this.module.pause(),e.removeEdges(t.getAdjacentEdges()),e.removeNode(t),yield e.view.afterNextFrame(),yield e.addNodes(a.nodes);const l=a.edges.filter(d=>{const h=d.source,u=d.target;if(e.getNode(h)&&e.getNode(u))return!0;const c=e.getNode(h)?u:h;return this.invalidEdges.has(c)?this.invalidEdges.get(c).push(d):this.invalidEdges.set(c,[d]),!1});a.nodes.forEach(d=>{if(!this.invalidEdges.has(d.id))return;const{valid:h,invalid:u}=this.invalidEdges.get(d.id).reduce((c,g)=>(e.getNode(g.source)&&e.getNode(g.target)?c.valid.push(g):c.invalid.push(g),c),{valid:[],invalid:[]});e.addEdges(h),u.length?this.invalidEdges.set(d.id,u):this.invalidEdges.delete(d.id)}),yield e.addEdges(l),s.has(r+1)||this.createGrouping(r+1),this.module.resume(),yield this.module.afterNextUpdate()})}addEdges(t,e){return xn(this,null,function*(){e.forEach(s=>{const i=this.edges.get(s.getId());i&&this.ogma.addEdges(i,{virtual:!0}).then(n=>{this.context.virtualEdges=this.context.virtualEdges.concat(n)})})})}getGroupId(t){return`ogma-group-${t}`}getMaxDepth(){return this.groupsByDepth.size}disable(t){return this.enabled=!1,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach(e=>e.disable(t)),this.module.animations.hideEdges(this.context.virtualEdges._indexes),this.context.virtualEdges.setSelected(!0),this.module.afterNextUpdate()}enable(t){return this.enabled=!0,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach(e=>e.enable(t)),this.module.animations.showEdges(this.context.virtualEdges._indexes),this.module.afterNextUpdate().then(()=>this.context.virtualEdges.setVisible(!0))}toggle(t){return this.enabled?this.disable(t):this.enable(t)}setOptions(t){this.onGetSubgraph=t.onGetSubgraph?t.onGetSubgraph:this.onGetSubgraph,this.duration=t.duration!==void 0?t.duration:this.duration,this.easing=t.easing||this.easing,this.parentPath=t.parentPath||this.parentPath,this.depthPath=t.depthPath||this.depthPath,this.padding=t.padding!==void 0?t.padding:this.padding,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.showContents=t.showContents!==void 0?t.showContents:this.showContents,this.onGroupUpdate=t.onGroupUpdate||this.onGroupUpdate,this.copyData=t.copyData!==void 0?t.copyData:this.copyData;const e=this.enabled;return this.enabled=t.enabled!==void 0?t.enabled:this.enabled,this.enabled!==e&&this.groupsByDepth.forEach(s=>this.enabled?s.enable({duration:this.duration,easing:this.easing}):s.disable({duration:this.duration,easing:this.easing})),this.groupsByDepth.forEach(s=>s.refresh()),this.module.afterNextUpdate()}onRemove(t){this.context.virtualEdges=this.context.virtualEdges.filter(e=>!t.has(e._index))}},WN=class{constructor(t){this.drilldowns=[],this.module=t}addDrilldown(t){this.drilldowns.push(t)}removeDrilldown(t){this.drilldowns=this.drilldowns.filter(e=>e!==t)}onRemove(t,e){e||this.drilldowns.forEach(s=>s.onRemove(t))}},XN=class{constructor(t,e){this.enabled=!1,this.relayouted=new Set,this.shouldRelayout=new Set,this.layoutPerGroup=new Map,this.ogma=t,this.module=e,this.ogma.events.on("layoutPrepare",s=>{if(!s.params.nodes)return;const i=s.params.nodes,n=Array.isArray(i)?this.ogma.getNode(i[0])._index:i._indexes[0],r=this.module.nodeToMeta.get(n);if(!r)return;const o=$t(ct({},s),{params:ct({},s.params)});delete o.params.nodes,this.layoutPerGroup.set(r._index,o)})}getNodesToRecompute(t){const e=Array.from(t),s=new Set,i=[];for(;e.length>0;){const n=e.shift();if(s.has(n))continue;i.push(n),s.add(n);const r=this.module.nodeToMeta.get(n);r&&e.push(r._index)}return this.ogma.nodeList(i)}layoutGroups(t,e,s=!1){return xn(this,null,function*(){this.module.animations.enable(),this.enable();const i=new Map,n=this.ogma.getNodes(t.map(({groupId:a})=>a));t.forEach(({groupId:a,layout:l,params:d},h)=>{i.set(a,()=>this.ogma.layouts[l]($t(ct({},d),{nodes:this.module.metaToNodes.get(n.get(h)._index)})))});const r=this.getNodesToRecompute(n._indexes),o=new Map;r.forEach(a=>o.set(a._index,this.module.nodeToTransformation.get(a._index).getIndex())),r.sort((a,l)=>o.get(a._index)-o.get(l._index));for(let a=0;a<r.size;a++){const l=o.get(r._indexes[a]);let d;for(d=a+1;d<r.size&&o.get(r._indexes[d])===l;d++);const h=r.slice(a,d);a=d-1,yield Promise.all(h.map(u=>{this.relayouted.add(u._index);let c=Promise.resolve();if(i.has(u.getId()))c=i.get(u.getId())();else if(s&&this.layoutPerGroup.has(u._index)){const g=this.module.metaToNodes.get(u._index),m=this.layoutPerGroup.get(u._index);c=this.ogma.layouts[m.name]($t(ct({},m.params),{nodes:g}))}return c.then(()=>{this.module.groupController.setGroupXYR(u)})}))}return yield this.module.groupController.onAfterLayouts(),this.module.animations.apply(e||0).finally(()=>{this.disable(),this.module.animations.disable(),this.relayouted.clear()})})}hasRelayouted(t){return this.relayouted.has(t)}enable(){this.enabled=!0}disable(){this.enabled=!1}clear(){this.relayouted.clear(),this.shouldRelayout.clear()}},va=14,YN=class{constructor(t,e){this.subNodeOffsetX=new Map,this.subNodeOffsetY=new Map,this.savedRadius=new Map,this.alreadyGrouped=new Set,this.openGroups=new Set,this.closeGroups=new Set,this.destroyed=!1,this.nodeLayer=new Map,this.edgeLayer=new Map,this.padding=new Map,this.geoRadius=new Map,this.collapsedGroups=new Set,this.hasUpdated=new Set,this.onGroupsUpdate=()=>Promise.resolve(),this.runningLayouts=!1,this.onSetMultipleAttributes=({elements:i,values:n,options:r,updatedAttributes:o,promises:a})=>{if(this.module.isRefreshing()||this.destroyed||this.runningLayouts||this.module.animations.isApplying())return;const l=new Set(o),d=n;if(!i.isNode||!l.has("x")&&!l.has("y")&&!l.has("radius"))return Promise.resolve();const h=i.toList();if(!h.size)return Promise.resolve();const u=[],c=new Set,g=Array.from(h._indexes);for(;g.length;){const _=g.shift(),f=this.module.nodeToMeta.get(_);if(!f||c.has(f._index))continue;const p=this.getGroupXYR(f,this.module.getSubNodes(f),h,d);p.isGeo?u.push(f.setAttribute("radius",p.radius,r)):(delete p.isGeo,this.closeGroups.has(f._index)||this.collapsedGroups.has(f._index)?(this.savedRadius.set(f._index,p.radius),this.module.animations.setXY(f._index,p.x,p.y)):this.module.animations.setXYR(f._index,p.x,p.y,p.radius),c.add(f._index)),g.push(f._index)}const m=h.map((_,f)=>{if(!this.openGroups.has(_._index))return null;const p=_.getPosition();return Array.isArray(d)&&d[f]?(d[f].x!==void 0&&(p.x=d[f].x),d[f].y!==void 0&&(p.y=d[f].y)):(d.x!==void 0&&(p.x=d.x),d.y!==void 0&&(p.y=d.y)),{group:_,position:p}}).filter(_=>_);m.length&&m.forEach(({group:_,position:f})=>this.animateChildren(_,f)),(c.size>0||m.length)&&u.push(this.module.animations.apply(r)),a.push(...u)},this.ogma=t,this.layoutController=new XN(t,e),this.groupLayer=this.ogma.modules.graphics.addAttributeLayer({name:"groups-layer",priority:5.50225,edgeAttributes:{layer:i=>this.edgeLayer.get(i._index)},nodeAttributes:{layer:i=>this.nodeLayer.get(i._index)},nodeDependencies:void 0,edgeDependencies:void 0});const s=t.styles.getClass("_group-fading_");this.fadingClass=s||this.ogma.styles.createClass({name:"_group-fading_",nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this.module=e,t.events.on("setMultipleAttributes",this.onSetMultipleAttributes).on("beforeGeoCameraMove",({zoom:i})=>{const n=this.ogma.nodeList(Array.from(this.geoRadius.keys())).filter(r=>r&&!this.collapsedGroups.has(r._index)&&this.openGroups.has(r._index));n.forEach(r=>{const o=this.geoRadius.get(r._index)*2**i;this.module.animations.setOpenRadius(r._index,o)}),this.ogma.modules.geo._projection&&this.ogma.modules.geo._projection.updateElements(n)}).on(["geoEnabled","beforeGeoDisabled"],()=>this._onToggleGeo()).on("geoNodesMoved",({nodes:i})=>{const n=i._indexes;for(let r=0;r<n.length;r++){const o=this.module.getMetaNode(i.get(r));!o||!this.openGroups.has(o._index)||this.layoutController.shouldRelayout.add(o._index)}}).on(["nodeClassRemoved__hovered","nodeClassAdded__hovered","nodeClassRemoved__selected","nodeClassAdded__selected","nodeClassAdded__hoverExtremityHighlighted","nodeClassRemoved__hoverExtremityHighlighted"],({nodes:i})=>{const n=i._indexes;for(let r=0;r<n.length;r++){const o=i.get(r);if(!this.isOpen(o))continue;const a=o.getAttribute("layer");this.setSubEltsLayer(o,a,!0)}})}setSubEltsLayer(t,e,s){const i=s?1:-1;if(!this.isOpen(t))return;const n=this.module.getSubNodes(t);n.forEach(o=>{this.nodeLayer.set(o._index,e+i),this.setSubEltsLayer(o,e+i,s)});const r=n.getAdjacentEdges({bothExtremities:!0});for(let o=0;o<r.size;o++)this.edgeLayer.set(r._indexes[o],e+i)}closeGroup(t,e,s,i,n=!1){const r=[e],o=this.closeGroups.has(t._index)||this.collapsedGroups.has(t._index);this.openGroups.delete(t._index),this.closeGroups.add(t._index),this.hasUpdated.add(t._index);const a=this.module.animations,l=n?0:a.getCloseRadius(t._index),d=a.getOpenRadius(t._index);if(d!==void 0&&!o&&this.savedRadius.set(t._index,d),a.setXYR(t._index,s,i,l),n)return;for(;r.length;){const u=r.shift(),c=u._indexes,g=u.getAdjacentEdges({bothExtremities:!0}),m=new Set;for(let f=0;f<g._indexes.length;f++)m.add(g._indexes[f]);const _=u.getAdjacentEdges({bothExtremities:!1}).filter(f=>!m.has(f._index));a.setXYR(c,s,i,l),a.pushAfter(()=>{u.setVisible(!1),g.setVisible(!1),_.setVisible(!1);const f=[];for(let p=0;p<c.length;p++){const x=this.closeGroups.has(c[p]);f.push(x?l:this.savedRadius.get(c[p]))}this.module.animations.setRs(u._indexes,f)});for(let f=0;f<c.length;f++){if(!this.openGroups.has(c[f]))continue;const p=u.get(f);this.collapsedGroups.add(p._index);const x=this.module.getSubNodes(u.get(f));x.size&&r.push(x)}}const h=this.module.getMetaNode(t);h&&this.openGroups.has(h._index)&&this.layoutController.shouldRelayout.add(h._index)}setGroupXYR(t){const e=this.getGroupXYR(t,this.module.getSubNodes(t),void 0,void 0);e.isGeo?(this.setGeoLatLng(t,e.y,e.x),this.module.animations.setR(t._index,e.radius)):this.module.animations.setXYR(t._index,e.x,e.y,e.radius)}setGeoLatLng(t,e,s){this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.latitudePath,e,{virtual:!0}),this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.longitudePath,s,{virtual:!0})}expandGroup(t,e,s=!1){const i=this.module.animations,n=t.getPosition();s||(this.openGroups.add(t._index),this.closeGroups.delete(t._index),this.collapsedGroups.delete(t._index)),this.hasUpdated.add(t._index);const r=[{subNodes:e,offset:this.getOffset(t._index),isClosed:!1,wasCollapsed:!1}];for(;r.length;){const{subNodes:a,offset:l,isClosed:d,wasCollapsed:h}=r.shift();if((d||h)&&i.pushBefore(()=>a.setAttributes({x:n.x+l.x,y:n.y+l.y},0)),d)continue;const u=a._indexes,c=a.getAdjacentEdges({bothExtremities:!0,filter:"all"});a.setVisible(!0),c.setVisible(!0);for(let g=0;g<u.length;g++){const m=this.closeGroups.has(u[g]),_=this.collapsedGroups.has(u[g]);i.setXYR(u[g],n.x+l.x+this.subNodeOffsetX.get(u[g])||0,n.y+l.y+this.subNodeOffsetY.get(u[g])||0,m?this.module.animations.getCloseRadius(u[g]):this.savedRadius.get(u[g])),this.collapsedGroups.delete(u[g]);const f=this.module.getSubNodes(a.get(g));f.size&&r.push({subNodes:f,isClosed:m,wasCollapsed:_,offset:{x:l.x+this.subNodeOffsetX.get(u[g])||0,y:l.y+this.subNodeOffsetY.get(u[g])||0}})}}const o=this.module.getMetaNode(t);o&&this.openGroups.has(o._index)&&this.layoutController.shouldRelayout.add(o._index),i.setXYR(t._index,n.x,n.y,s?0:this.savedRadius.get(t._index))}getOffset(t){return this.collapsedGroups.has(t)&&this.subNodeOffsetX.has(t)?{x:this.subNodeOffsetX.get(t),y:this.subNodeOffsetY.get(t)}:{x:0,y:0}}restorePositions(t,e){const s=t.getPosition(),i=(e=e.filter(o=>!o.isVirtual()))._indexes,n=this.getOffset(t._index),r=[];for(let o=0;o<i.length;o++)r.push({x:n.x+s.x+this.subNodeOffsetX.get(i[o])||0,y:n.x+s.y+this.subNodeOffsetY.get(i[o])||0});e.setAttributes(r,0)}animateChildren(t,e){const s=[{parent:t,position:e}];for(;s.length;){const{parent:i,position:n}=s.shift();if(!i.isNode)continue;const r=this.module.getSubNodes(i);r.size&&r.forEach(o=>{const a=this.subNodeOffsetX.get(o._index)||0,l=this.subNodeOffsetY.get(o._index)||0,d={x:n.x+a,y:n.y+l};this.module.animations.setXY(o._index,d.x,d.y),s.push({parent:o,position:d})})}}addOpenGroup(t){this.openGroups.add(t._index),this.closeGroups.delete(t._index)}isOpen(t){return this.openGroups.has(t._index)}isClose(t){return this.closeGroups.has(t._index)}setPadding(t,e){const s=new Set,i=isNaN(+e),n=e;return t.forEach(r=>{const o=i?n(r):+e;this.padding.get(r._index)!==o&&s.add(r._index),this.padding.set(r._index,o)}),s}getGroupXYR(t,e,s,i){let n,r,o;const a=this.module.animations,l=this.ogma.geo.enabled();if(l){const g=e.getData(this.ogma.modules.geo.latitudePath),m=e.getData(this.ogma.modules.geo.longitudePath);n=[],r=[],o=[];for(let _=0;_<g.length;_++){const{x:f,y:p}=this.ogma.geo.getMap().project({lat:g[_],lng:m[_]},va);n.push(f),r.push(p),o.push(2**va*this.geoRadius.get(e._indexes[_])||10)}}else n=e.getAttribute("x"),r=e.getAttribute("y"),o=e.getAttribute("radius");if(s&&i&&s.isNode){const g=s._indexes,m=new Map,_=new Map,f=new Map;for(let x=0;x<g.length;x++){const y=Array.isArray(i)?i[x]:i;!isNaN(y.x)&&m.set(g[x],y.x),!isNaN(y.y)&&_.set(g[x],y.y),!isNaN(y.radius)&&f.set(g[x],y.radius)}const p=e._indexes;for(let x=0;x<p.length;x++)m.has(p[x])&&(n[x]=m.get(p[x])),_.has(p[x])&&(r[x]=_.get(p[x])),f.has(p[x])&&(o[x]=f.get(p[x]))}const d=e._indexes;for(let g=0;g<d.length;g++)this.savedRadius.has(d[g])&&(o[g]=this.savedRadius.get(d[g]));if(!l)for(let g=0;g<d.length;g++)a.xs.get(d[g])!==void 0&&(n[g]=a.xs.get(d[g])),a.ys.get(d[g])!==void 0&&(r[g]=a.ys.get(d[g])),a.rs.get(d[g])!==void 0&&(o[g]=a.rs.get(d[g]));let[h,u,c]=K0.algorithms.minDisk(n,r,o);if(c+=this.padding.get(t._index)||0,l){const{lat:g,lng:m}=this.ogma.geo.getMap().unproject({x:h,y:u},va);h=m,u=g,c/=2**va,this.geoRadius.set(t._index,c),c*=2**this.ogma.geo.getZoom()}else this.savedRadius.set(t._index,c),e.forEach((g,m)=>{this.subNodeOffsetX.set(g._index,n[m]-h),this.subNodeOffsetY.set(g._index,r[m]-u)});return{x:h,y:u,radius:c,isGeo:l}}onAfterLayouts(){return xn(this,null,function*(){const t=this.module.animations,e=this.module.getList().filter(a=>a.getName()===us.NodeGrouping&&a.isEnabled());if(!e.length)return;const s=[],i=[],n=[];let r=!1;for(let a=e.length-1;a>=0;a--)e[a].getContext().metaNodes.forEach(l=>{if(l.getMetaNode())return;r||(r=this.hasUpdated.has(l._index)||this.layoutController.relayouted.has(l._index)||this.layoutController.shouldRelayout.has(l._index)),i.push(l._index);const d=!this.collapsedGroups.has(l._index)&&!this.closeGroups.has(l._index);n.push(d),s.push({group:l,collapsed:!d})});if(!r)return;i.length&&(yield this.onGroupsUpdate({metaNodes:this.ogma.nodeList(s.map(a=>a.group._index)),isOpen:n}));const o=new Set;for(;s.length;){const{group:a,collapsed:l}=s.shift();if(o.has(a._index))continue;o.add(a._index);const d=this.module.getSubNodes(a),h=d._indexes,u=t.xs.get(a._index),c=t.ys.get(a._index);if(u!==void 0&&c!==void 0){if(l){t.deleteOpenRadius(a._index);for(let g=0;g<h.length;g++)t.setXY(h[g],u,c)}else for(let g=0;g<h.length;g++)t.setXY(h[g],u+this.subNodeOffsetX.get(h[g])||0,c+this.subNodeOffsetY.get(h[g])||0);for(let g=0;g<h.length;g++)this.module.isVirtual(h[g],!0)&&s.push({group:d.get(g),collapsed:this.collapsedGroups.has(h[g])||this.closeGroups.has(h[g])||l})}}this.hasUpdated.clear(),this.layoutController.clear()})}cleanup(t,e,s){let i=t._indexes;for(let n=0;n<i.length;n++)this.padding.delete(i[n]),this.openGroups.delete(i[n]),this.closeGroups.delete(i[n]),this.nodeLayer.delete(i[n]);for(let n=0;n<e.size;n++)this.edgeLayer.delete(e._indexes[n]);if(s){i=s._indexes;for(let n=0;n<i.length;n++)this.subNodeOffsetX.delete(i[n]),this.subNodeOffsetY.delete(i[n])}}getPositions(t,e){const{x:s,y:i}=t.getPosition();return e.map(n=>({x:s+(this.subNodeOffsetX.get(n._index)||0),y:i+(this.subNodeOffsetY.get(n._index)||0)}))}hideSubNodes(t){const e=[t];for(;e.length;){const s=e.pop();s.setVisible(!1);for(let i=0;i<s._indexes.length;i++)this.collapsedGroups.add(s._indexes[i]),this.openGroups.has(s._indexes[i])&&e.push(this.module.getSubNodes(s.get(i)))}}onRemove(t,e){if(!e)return;const s=[],i=new Set;for(let n=0;n<t.length;n++){const r=this.module.nodeToMeta.get(t[n]);r&&this.openGroups.has(r._index)&&(this.layoutController.shouldRelayout.add(r._index),s.push(r._index))}for(;s.length;){const n=s.shift();if(i.has(n))continue;i.add(n);const r=this.module.nodeToMeta.get(n);r&&this.openGroups.has(r._index)&&(this.layoutController.shouldRelayout.add(r._index),s.push(r._index))}}layoutGroups(t,e,s=!1){return this.runningLayouts=!0,this.layoutController.layoutGroups(t,e,s).finally(()=>{this.runningLayouts=!1})}_onToggleGeo(){this.geoRadius.clear();const t=this.module.getList().find(s=>s.getName()===us.NodeGrouping);if(!t)return;const e=Array.from(this.openGroups.keys());for(let s=0;s<e.length;s++)this.layoutController.shouldRelayout.add(e[s]);t.refresh()}startRefresh(){this.alreadyGrouped.clear()}destroy(){this.destroyed||(this.destroyed=!0,this.ogma.events.off(this.onSetMultipleAttributes))}},$N={setData:!1,addElement:!0,removeElement:!0,setOptions:!1,refresh:!1},qN=class ou{constructor(){this.prev={},this.next={},this.prevorder=[],this.nextorder=[],this.shouldAnimate=!1,this.minRefreshIndex=0}addTransformation(e,s){this.next[e]=s,this.nextorder.push(e)}removeTransformation(e){delete this.next[e]}setIndex(e,s){const i=this.nextorder.indexOf(e);this.nextorder.splice(i,1),this.nextorder.splice(s,0,e),this.minRefreshIndex=Math.min(this.minRefreshIndex,i,s)}setEnabled(e,s){this.next[e]=s}isEnabled(e){return this.prev[e]||!1}static getDiff(e,s){const i=new Map;for(const n in e)s[n]!==void 0?s[n]!==e[n]&&i.set(+n,{shouldDo:s[n],shouldUndo:e[n]}):i.set(+n,{shouldDo:!1,shouldUndo:e[n],shouldCleanup:!0});for(const n in s)e[n]===void 0&&s[n]===!0&&i.set(+n,{shouldDo:!0,shouldUndo:!1});return i}getFirstChange(e){const{nextorder:s}=this;let i=s.length;for(let n=0;n<s.length;n++){const r=e.get(s[n]);if(r&&(r.shouldUndo||r.shouldDo)){i=n;break}}return i}refreshFrom(e,s){const{nextorder:i}=this;for(let n=s;n<this.nextorder.length;n++)e.set(i[n],ct({shouldUndo:this.prev[i[n]],shouldDo:this.prev[i[n]]},e.get(i[n])||{}));return e}isDirty(){const e=ou.getDiff(this.prev,this.next),s=Math.min(this.minRefreshIndex,this.getFirstChange(e));return(e.size>0||s<this.nextorder.length)&&{reason:e.size>0?"diff":"refresh",index:s}}invalidateFrom(e,s){this.shouldAnimate||(this.shouldAnimate=$N[s]),this.minRefreshIndex=Math.min(this.minRefreshIndex,e)}step(){const e=ou.getDiff(this.prev,this.next);this.prev=ct({},this.next);const s=Math.min(this.minRefreshIndex,this.getFirstChange(e)),i=this.nextorder.reduce((o,a,l)=>o.set(a,l),new Map),n=this.prevorder.reduce((o,a,l)=>o.set(a,l),new Map);this.nextorder=this.nextorder.filter(o=>this.prev[o]!==void 0),this.prevorder=[...this.nextorder],this.minRefreshIndex=this.nextorder.length;const r=this.shouldAnimate;return this.shouldAnimate=!1,{diff:this.refreshFrom(e,s),nextorder:i,prevorder:n,shouldAnimate:r}}done(){}},ZN=class{constructor(t){this.transformations=[],this.nodeToTransformation=new Map,this.edgeToTransformation=new Map,this.nodeVirtual=new Set,this.edgeVirtual=new Set,this.nodeToMeta=new Map,this.edgeToMeta=new Map,this.metaToNodes=new Map,this.metaToEdges=new Map,this._onDestroy=()=>{this.destroy(),this.ogma.events.off(this._onFrame)},this._onFrame=()=>this.refresh(),this._onAddElements=({nodes:e,edges:s,virtual:i})=>{if(i){if(e)for(let n=0;n<e.size;n++)this.nodeVirtual.add(e._indexes[n]);if(s)for(let n=0;n<s.size;n++)this.edgeVirtual.add(s._indexes[n])}else this.state.invalidateFrom(0,"addElement"),this.invalidate()},this._onSetData=({elements:e,virtual:s})=>{if(s)return;const{isNode:i,_indexes:n}=e;let r=1/0;for(const o of n){const a=this.getTransformation(o,i);if(!a){r=0;break}r=Math.min(r,a.getIndex())}return this.state.invalidateFrom(r,"setData"),this.invalidate(),r},this._onRequestElementsToDelete=e=>{const{elementsToRemove:s}=e,i=s.isNode,n=s._indexes,r=this.getLeafElements(n,i);e.elementsToRemove=i?this.ogma.nodeList(r):this.ogma.edgeList(r)},this._onAfterRemoveElements=({nodes:e,edges:s})=>{if(!this.ogma.isDestroyed()){if(e)for(let i=0;i<e.size;i++)this.nodeVirtual.delete(e._indexes[i]);if(s)for(let i=0;i<s.size;i++)this.edgeVirtual.delete(s._indexes[i])}},this._onRemoveElements=({nodes:e,edges:s,virtual:i})=>{i||this.ogma.isDestroyed()||this._refreshPromise.then(()=>{const n=!!e,r=n?e._indexes:s._indexes,o=new Set(r);this.transformations.forEach(a=>a.onRemove(o,n)),this.groupController.onRemove(r,n),this.drilldownController.onRemove(o,n),this.nodeToMeta.clear(),this.edgeToMeta.clear(),this.metaToNodes.clear(),this.metaToEdges.clear(),this.nodeToTransformation.clear(),this.edgeToTransformation.clear(),this.state.invalidateFrom(0,"removeElement"),this.invalidate()})},this.ogma=t,this.state=new qN,this.animations=new zN(t),this._shouldRefresh=!1,this._refreshing=!1,this.isDestroyed=!1,this.isPaused=!1,this._refreshPromise=Promise.resolve(),this.groupController=new YN(t,this),this.drilldownController=new WN(this),this.ogma.events.on("frame",this._onFrame).on("setData",this._onSetData).on(["addNodes","addEdges"],this._onAddElements).on(["removeNodes","removeEdges"],this._onRemoveElements).on(["afterRemoveNodes","afterRemoveEdges"],this._onAfterRemoveElements).on("requestElementsToDelete",this._onRequestElementsToDelete).on("destroy",this._onDestroy)}addTransformation(t,e=!0){this.state.addTransformation(t.getId(),e),this.transformations.push(t),this.invalidate()}removeTransformation(t){const e=this.transformations.indexOf(t);e!==-1&&this.transformations.splice(e,1),this.invalidate()}step(){return xn(this,arguments,function*(t=0,e={fireEnabled:[],fireDisabled:[],fireRefresh:[],fireDestroy:[],fireSetIndex:[]}){var s;if(t>5)throw new Error("Ogma transformations: Transformations refresh in loop");const{diff:i,prevorder:n,nextorder:r}=this.state.step(),{fireEnabled:o,fireDisabled:a,fireRefresh:l,fireDestroy:d,fireSetIndex:h}=e,u=[],c=[],g=[];this.groupController.startRefresh();for(const _ of this.transformations){const f=_.getId();if(!i.has(f))continue;const{shouldDo:p,shouldUndo:x,shouldCleanup:y}=i.get(f);p&&!x?o.push(_):x&&!p?a.push(_):p&&x&&l.push(_),n.has(f)&&n.get(f)!==r.get(f)&&h.push(_),l.push(_),x&&u.push(_),p&&c.push(_),y&&(d.push(_),g.push(_))}let m=0;u.sort((_,f)=>n.get(f.getId())-n.get(_.getId())||0);for(const _ of u){const f=!((s=i.get(_.getId()))!=null&&s.shouldDo);f&&(m=this.animations.getMaxAnimation(m,_.getAnimation())),yield _.undo(f)}c.sort((_,f)=>r.get(_.getId())-r.get(f.getId())||0);for(let _=0;_<c.length;_++){const f=c[_],p=_===c.length-1;p&&(m=this.animations.getMaxAnimation(m,f.getAnimation())),yield f.run(p)}for(const _ of g)yield _.cleanup();if(yield this.groupController.onAfterLayouts(),yield this.animations.apply(m),!this.isDestroyed)return this.state.isDirty()?this.step(t+1,e):e})}refresh(){!this._shouldRefresh||this._refreshing||this.isDestroyed||this.isPaused||(this._shouldRefresh=!1,this._refreshing=!0,this._refreshPromise=this._refreshPromise.then(()=>(this.animations.enable(),this.step().then(t=>{if(this.animations.disable(),this._refreshing=!1,!t)return;const{fireEnabled:e,fireDisabled:s,fireRefresh:i,fireDestroy:n,fireSetIndex:r}=t,o=this.ogma.modules.events;s.reverse().forEach(a=>o.fire("transformationDisabled",{target:a})),e.forEach(a=>o.fire("transformationEnabled",{target:a})),r.forEach(a=>o.fire("transformationSetIndex",{target:a})),i.forEach(a=>o.fire("transformationRefresh",{target:a})),n.forEach(a=>o.fire("transformationDestroyed",{target:a}))}).finally(()=>this.animations.disable()))).catch(t=>{const e=this.state.isDirty();if(!e)throw t;const s=e.reason==="diff"?"You are constantly adding/removing/changing index of a transformation":"You are constantly adding/removing/updating nodes or edges while transformations refresh";throw new Error(`Ogma transformations, refresh failed.
${s}`)}).finally(()=>{}))}enable(t){return this.state.setEnabled(t.getId(),!0),this.invalidate(),this.afterNextUpdate()}disable(t){return this.state.setEnabled(t.getId(),!1),this.invalidate(),this.afterNextUpdate()}remove(t){return this.disable(t),this.state.removeTransformation(t.getId()),this.afterNextUpdate().then(()=>{this.transformations.splice(this.getIndex(t),1)})}isEnabled(t){return this.state.isEnabled(t.getId())}getList(){return this.transformations.slice()}getIndex(t){for(let e=0;e<this.transformations.length;e++)if(this.transformations[e]===t)return e;return-1}setIndex(t,e){const s=this.getIndex(t);this.state.setIndex(t.getId(),e),this.transformations.splice(s,1),this.transformations.splice(e,0,t),this.invalidate()}setOptions(t){this.state.invalidateFrom(this.getIndex(t),"setOptions"),this.invalidate()}refreshTransformation(t){this.state.invalidateFrom(this.getIndex(t),"refresh"),this.invalidate()}clear(){return this.transformations.forEach(t=>t.destroy(0)),this.invalidate(),this.afterNextUpdate()}destroy(){this.transformations.forEach(t=>t.destroy(0)),this.groupController.destroy(),this._refreshPromise=Promise.resolve(),this.isDestroyed=!0}invalidate(){this._refreshing||this.ogma.isDestroyed()||(this._shouldRefresh=!0,this.ogma.modules.dom.refresh())}afterNextUpdate(){return this.ogma.view.afterNextFrame().then(()=>this._refreshPromise)}getTransformation(t,e){return e?this.nodeToTransformation.get(t):this.edgeToTransformation.get(t)}setTransformation(t,e,s){s?this.nodeToTransformation.set(t,e):this.edgeToTransformation.set(t,e)}deleteTransformation(t){const e=t.isNode?this.nodeToTransformation:this.edgeToTransformation,s=t._indexes;for(const i of s)e.delete(i)}setMetaNode(t,e){this.nodeToMeta.set(t,e)}setSubNodes(t,e){this.metaToNodes.set(t,e)}removeMetaNodes(t){const e=t._indexes;for(const s of e){const i=this.metaToNodes.get(s);i&&i.forEach(n=>this.nodeToMeta.delete(n._index)),this.nodeToTransformation.delete(s),this.metaToNodes.delete(s)}}removeMetaEdges(t){const e=t._indexes;for(const s of e){const i=this.metaToEdges.get(s);i&&i.forEach(n=>this.edgeToMeta.delete(n._index)),this.edgeToTransformation.delete(s),this.metaToEdges.delete(s)}}clearSubNodes(t){this.metaToNodes.delete(t)}clearMetaNode(t){this.nodeToMeta.delete(t)}setMetaEdge(t,e){this.edgeToMeta.set(t,e)}setSubEdges(t,e){this.metaToEdges.set(t,e)}clearSubEdges(t){this.metaToEdges.delete(t)}clearMetaEdge(t){this.edgeToMeta.delete(t)}getMetaNode(t){return this.nodeToMeta.get(t._index)||null}getMetaEdge(t){return this.edgeToMeta.get(t._index)||null}getLeafElements(t,e){const s=[t],i=e?this.metaToNodes:this.metaToEdges,n=[];for(;s.length;){const r=s.pop();for(let o=0;o<r.length;o++){n.push(r[o]);const a=i.get(r[o]);a&&s.push(a._indexes)}}return n}getSubElements(t){const e=t.isNode?this.metaToNodes:this.metaToEdges,s=t.toList()._indexes;let i=t.isNode?this.ogma.nodeList():this.ogma.edgeList();for(let n=0;n<s.length;n++){const r=e.get(s[n]);r&&(i=i.concat(r))}return i}getSubNodes(t){return this.getSubElements(t)}getSubEdges(t){return this.getSubElements(t)}getById(t){return this.transformations.find(e=>e.getId()===t)}isIntraEdge(t){const e=t.getSource()._index;return this.nodeToMeta.has(e)&&this.nodeToMeta.get(e)===this.nodeToMeta.get(t.getTarget()._index)}isVirtual(t,e){return e?this.nodeVirtual.has(t):this.edgeVirtual.has(t)}isRefreshing(){return this._refreshing}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.refresh()}},fs="_transparent",_r=t=>!0,JN=()=>{};function Q0(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach((s,i)=>e.push(i)),e}function bl(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach(s=>e.push(s)),e}function L_(t){return!(!t||t.constructor!==Object&&t.constructor)}var gn=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)i.hasOwnProperty(n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):L_(e[n])&&L_(i[n])?e[n]=gn(e[n],i[n]):e[n]=i[n])}return e};function KN(t){return Array.isArray(t)?t:[t]}var au=()=>!0,tb=()=>!1,QN=()=>null,tP=class extends Qi{constructor(t){super(t),this.nodeSelector=t.criteria||_r}setOptions(t){return this.nodeSelector=t.criteria||this.nodeSelector,super.setOptions(t)}getName(){return us.NodeFilter}run(){const t=this.nodeSelector,e=this.ogma.getNodes().filter(a=>!t||!t(a)),s=e.getAdjacentEdges();this.module.animations.hideNodes(e._indexes),this.module.animations.hideEdges(s._indexes),e.setVisible(!1),s.setVisible(!1);const i=e.subtract(this.context.hiddenNodes),n=s.subtract(this.context.hiddenEdges),r=this.context.hiddenNodes.subtract(e),o=this.context.hiddenEdges.subtract(s);return this.module.animations.pushBefore(()=>{r.setVisible(!0),r.setVisible(!0),n.setVisible(!0),i.setVisible(!0),r.addClass(fs),o.addClass(fs)}),this.module.animations.push(()=>Promise.all([o.removeClass(fs,this.animation),r.removeClass(fs,this.animation),i.addClass(fs,this.animation),n.addClass(fs,this.animation)])),this.context=$t(ct({},this.context),{hiddenNodes:e,hiddenEdges:s}),Promise.resolve()}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s}=this.context,i=t?this.animation:0;return e.setExcluded(!1),s.setExcluded(!1),t&&(e.addClass(fs),s.addClass(fs),this.module.animations.push(()=>Promise.all([e.removeClass(fs,i),s.removeClass(fs,i)])),this.context.hiddenNodes=this.ogma.nodeList(),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e?this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index)):this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}resetContext(){this.context=$t(ct({},this.context),{hiddenEdges:this.ogma.edgeList(),hiddenNodes:this.ogma.nodeList()})}},eP=class extends Qi{constructor(t){super(t),this.edgeSelector=t.criteria||_r}setOptions(t){return this.edgeSelector=t.criteria||this.edgeSelector,super.setOptions(t)}getName(){return us.EdgeFilter}run(){const t=this.edgeSelector,e=this.ogma.getEdges().filter(r=>!t||!t(r)),s=this.module.animations;e.setVisible(!1);const i=e.subtract(this.context.hiddenEdges),n=this.context.hiddenEdges.subtract(e);return this.module.animations.pushBefore(()=>{i.setVisible(!0),n.setVisible(!0),n.addClass(fs)}),s.hideEdges(e._indexes),s.push(()=>Promise.all([n.removeClass(fs,this.animation),i.addClass(fs,this.animation)])),this.context=$t(ct({},this.context),{hiddenEdges:e}),Promise.resolve()}undo(t=!0){super.undo(t);const{hiddenEdges:e}=this.context,s=t?this.animation:0;return e.setExcluded(!1),t&&(e.addClass(fs),this.module.animations.push(()=>Promise.all([e.removeClass(fs,s)])),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e||(this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index)))}resetContext(){this.context=$t(ct({},this.context),{hiddenEdges:this.ogma.edgeList()})}},Ve="_faded",sP=class extends Qi{constructor(t){super(t),this.selector=t.selector||tb,this.dataFunction=t.dataFunction||JN}getName(){return us.NeighborMerging}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=[],r=new Map;for(let c=0;c<i.size;++c){const g=i.get(c),m=g.getAdjacentEdges(),_=this.dataFunction(g);for(let f=0;f<m.size;++f){const p=m.get(f),x=p.getSource(),y=p.getTarget();if(x!==y&&_!==void 0){const b=x===g?y:x;let v=r.get(b);v||(v=[],r.set(b,v)),v.push(_)}n.push(p)}}const o=e.getEdges(n),a=e.getNodes(Q0(r)),l=bl(r),d=a.getData(),h=new Array(a.size);for(let c=0;c<h.length;++c){const g=l[c];let m=d[c];for(let _=0;_<g.length;++_)m=gn(m,g[_]);h[c]=m}const u=this.module.animations;return u.hideNodes(i._indexes),u.hideEdges(o._indexes),u.push(()=>Promise.all([i.addClass(Ve,s),o.addClass(Ve,s)]).then(()=>{this.ogma.modules.data.setProperty(a,null,h,{dispatch:!0,virtual:!0})})),this.context=$t(ct({},this.context),{hiddenNodes:i,hiddenEdges:o,nodesWithDataChange:a,oldDataList:d}),Promise.resolve()}resetContext(){super.resetContext(),this.context=$t(ct({},this.context),{hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),nodesWithDataChange:this.ogma.nodeList(),oldDataList:[]})}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,nodesWithDataChange:i,oldDataList:n}=this.context,r=t?this.animation:0,o=this.module.animations;return this.context.hiddenEdges=this.ogma.edgeList(),this.context.hiddenNodes=this.ogma.nodeList(),this.context.nodesWithDataChange=this.ogma.nodeList(),this.context.oldDataList=[],e.setVisible(!0),s.setVisible(!0),o.pushBefore(()=>{e.addClass(Ve),s.addClass(Ve)}),o.push(()=>Promise.all([e.removeClass(Ve,r),s.removeClass(Ve,r)]).then(()=>{this.ogma.modules.data.setProperty(i,null,n,{dispatch:!0,virtual:!0})})),Promise.resolve()}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index))),this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}cleanup(){return Promise.resolve()}setOptions(t){return this.selector=t.selector||this.selector,this.dataFunction=t.dataFunction||this.dataFunction,super.setOptions(t)}};function iP(t){return t!=null}var nP=(t,e)=>({source:t.getId(),target:e.getId()}),rP=class extends Qi{constructor(t){super(t);const{selector:e=au,neighborIdFunction:s=QN,nodeGenerator:i=()=>({}),edgeGenerator:n=nP}=t;this.neighborIdFunction=s,this.selector=e,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i,this.edgeGenerator=n}getName(){return us.NeighborGeneration}run(t=!0){const{ogma:e,id:s}=this,i=t?this.animation:0,n=e.getNodes(),r=new Map;for(let c=0;c<n.size;++c){const g=n.get(c),m=(oP(this.generateIds(g))||[]).filter(iP);if(m)for(const _ of m){let f=r.get(_);f||(f=[],r.set(_,f)),f.push(g)}}const o=new Array(r.size),a=[],l=Q0(r),d=bl(r).map(c=>e.getNodes(c));for(let c=0;c<o.length;++c){const g=l[c],m=d[c],_=this.nodeGenerator(g,m);_.id=`_gen_${s}_${g}`;const f=BN(m.getPosition());_.attributes=_.attributes||{},_.attributes.x=f.x,_.attributes.y=f.y,o[c]=_}let h,u;return e.addNodes(o.map(c=>({id:c.id,attributes:c.attributes})),{virtual:!0}).then(()=>{h=e.getNodes(o.map(g=>g.id));const c=h._indexes;this.context.virtualNodes&&this.module.removeMetaNodes(this.context.virtualNodes);for(let g=0;g<h.size;g++)this.module.setTransformation(c[g],this,!0),this.module.setSubNodes(c[g],this.ogma.createNodeList());h.replaceOriginalAttributes(o.map(g=>g.attributes),["x","y"]),this.ogma.modules.data.setProperty(h,null,o.map(g=>g.data),{dispatch:!0,virtual:!0});for(let g=0;g<h.size;++g){const m=h.get(g),_=d[g];for(let f=0;f<_.size;++f){const p=_.get(f),x=this.edgeGenerator(p,m);!x.source&&!x.target&&(x.source=p.getId(),x.target=m.getId()),x.id||(x.id=`${x.source}-${x.target}`),a.push(x)}}return e.addEdges(a,{virtual:!0})}).then(()=>{u=e.getEdges(a.map(g=>g.id));const c=u._indexes;this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);for(let g=0;g<u.size;g++)this.module.setTransformation(c[g],this,!1),this.module.setSubEdges(c[g],this.ogma.createEdgeList());this.context={virtualEdges:u,virtualNodes:h},e.removeNodes(this.context.virtualNodes.subtract(h),{virtual:!0}),e.removeEdges(this.context.virtualEdges.subtract(u),{virtual:!0}),h.setVisible(!0),u.setVisible(!0),this.module.animations.pushBefore(()=>{h.addClass(Ve),u.addClass(Ve)}),this.module.animations.push(()=>Promise.all([h.removeClass(Ve,i),u.removeClass(Ve,i)]))})}undo(t=!0){const{virtualNodes:e,virtualEdges:s}=this.context;if(!s||!e)return Promise.resolve(this.context);const i=t?this.animation:0,n=this.module.animations;t?(n.hideNodes(e._indexes),n.hideEdges(s._indexes),n.push(()=>Promise.all([e.addClass(Ve,i),s.addClass(Ve,i)]))):(e.setVisible(!1),s.setVisible(!1))}onRemove(){}cleanup(){const{virtualEdges:t,virtualNodes:e}=this.context;return t&&e&&(this.module.removeMetaNodes(e),this.module.removeMetaEdges(t),this.ogma.removeNodes(e,{virtual:!0}),this.ogma.removeEdges(t,{virtual:!0}),this.context.virtualEdges=this.ogma.edgeList(),this.context.virtualNodes=this.ogma.nodeList()),Promise.resolve()}setOptions(t){const{selector:e,neighborIdFunction:s,nodeGenerator:i,edgeGenerator:n}=t;return this.selector=e||this.selector,this.neighborIdFunction=s||this.neighborIdFunction,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i||this.nodeGenerator,this.edgeGenerator=n||this.edgeGenerator,super.setOptions(t)}resetContext(){super.resetContext(),this.context=$t(ct({},this.context),{virtualNodes:this.ogma.nodeList(),virtualEdges:this.ogma.edgeList()})}};function oP(t){return Array.isArray(t)?t:t?[t]:null}function aP(t,e){return t.size===e.size&&t.filter(s=>e.includes(s)).size>0}var lP=class extends Qi{constructor(t){super(t),this.selector=t.selector||tb,this.edgeGenerator=t.edgeGenerator||(()=>({}))}getName(){return us.NodeCollapsing}resetContext(){this.context={hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),virtualEdges:this.ogma.edgeList()}}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=i.getAdjacentEdges(),r=[],o=i.map(l=>l.getAdjacentNodes().filter(d=>!this.selector(d)));for(let l=0;l<i.size;l++)for(let d=l;d<i.size;d++){const h=i.get(l),u=i.get(d);if(this.ogma.modules.graph.getEdgesBetweenTwoNodes(h,u).size>0&&(o[l].size||o[d].size)&&!aP(o[l],o[d]))throw Error(`addNodeCollapsing: invalid connected nodes [${h.getId()}] and [${u.getId()}] to be collapsed. The addNodeCollapsing function supports only disconnected nodes.`)}const a=new Map;for(let l=0;l<i.size;++l){const d=i.get(l),h=o[l];for(let u=0;u<h.size-1;++u){const c=h.get(u),g=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,c);if(c!==d)for(let m=u+1;m<h.size;++m){const _=h.get(m),f=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,_),p=this.edgeGenerator(d,c,_,g,f);if(p){const x=KN(p);for(let y=0;y<x.length;++y)r.push(dP(e,x[y],y,d,c,_,g,f)),a.set(r[r.length-1].id,g.concat(f))}}}}return e.addEdges(r,{virtual:!0}).then(()=>{const l=this.ogma.getEdges(r.map(u=>u.id));this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);const d=l._indexes;for(let u=0;u<l.size;u++){this.module.setTransformation(d[u],this,!1);const c=a.get(l.get(u).getId());this.module.setSubEdges(d[u],c);for(let g=0;g<c.size;g++)this.module.setMetaEdge(c._indexes[g],l.get(u))}e.removeEdges(this.context.virtualEdges.subtract(l),{virtual:!0});const h=this.module.animations;l.setVisible(!0),h.pushBefore(()=>l.addClass(Ve)),h.push(()=>Promise.all([l.removeClass(Ve,s),i.addClass(Ve,s),n.addClass(Ve,s)])),h.hideNodes(i._indexes),h.hideEdges(n._indexes),this.context={hiddenEdges:n,hiddenNodes:i,virtualEdges:l}})}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,virtualEdges:i}=this.context,n=t?this.animation:0,r=this.module.animations;return e.setVisible(!0),s.setVisible(!0),t?(r.hideEdges(i._indexes),r.pushBefore(()=>Promise.all([e.addClass(Ve),s.addClass(Ve)])),r.push(()=>Promise.all([i.addClass(Ve,n),e.removeClass(Ve,n),s.removeClass(Ve,n)]))):i.setVisible(!1),Promise.resolve()}cleanup(){const t=this.context.virtualEdges||this.ogma.createEdgeList();return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then(()=>{this.resetContext()})}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index))),this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}setOptions(t){return this.selector=t.selector||this.selector,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,super.setOptions(t)}};function dP(t,e,s,i,n,r,o,a){let l,d;if(e.source!==void 0&&(l=t.getNode(e.source),l!==n&&l!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid source [${e.source}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(e.target!==void 0&&(d=t.getNode(e.target),d!==n&&d!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid target [${e.target}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(l&&d&&l===d)throw new Error(`addNodeCollapsing: edge generator produced RawEdge with same source and target [${l.getId()}]`);if(l&&!d)d=l===n?r:n;else if(d&&!l)l=d===n?r:n;else if(!l&&!d){let h=!0;for(let u=0;u<o.size;++u)o.get(u).getSource()===n&&(h=!1);for(let u=0;u<a.size;++u)a.get(u).getTarget()===r&&(h=!1);h?(l=r,d=n):(l=n,d=r)}return l&&d?$t(ct({},e),{id:`_gen_${i.getId()}_${l.getId()}_${d.getId()}_${s}`,source:l.getId(),target:d.getId()}):{}}var hP=class extends Qi{constructor(t){super(t),this.nodeSelector=t.nodeSelector||au,this.edgeSelector=t.edgeSelector||au,this.nodeDataFunction=t.nodeDataFunction||null,this.edgeDataFunction=t.edgeDataFunction||null}getName(){return us.VirtualProperties}resetContext(){this.context={nodes:this.ogma.nodeList(),oldNodesData:[],edges:this.ogma.edgeList(),oldEdgesData:[]}}run(){const{ogma:t,context:e}=this;return this.nodeDataFunction&&(e.nodes=t.getNodes().filter(this.nodeSelector),e.oldNodesData=C_(e.nodes,this.nodeDataFunction,this.ogma)),this.edgeDataFunction&&(e.edges=t.getEdges().filter(this.edgeSelector),e.oldEdgesData=C_(e.edges,this.edgeDataFunction,this.ogma)),Promise.resolve()}undo(){const{nodes:t,oldNodesData:e,edges:s,oldEdgesData:i}=this.context,n=this.ogma.modules.data;return t&&n.setProperty(t,null,e,{dispatch:!0,virtual:!0}),s&&n.setProperty(s,null,i,{dispatch:!0,virtual:!0}),Promise.resolve()}onRemove(t,e){e&&(this.context.nodes=this.context.nodes.filter(s=>!t.has(s._index))),this.context.edges=this.context.edges.filter(s=>!t.has(s._index))}cleanup(){return this.resetContext(),Promise.resolve()}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.nodeDataFunction=t.nodeDataFunction||this.nodeDataFunction,this.edgeDataFunction=t.edgeDataFunction||this.edgeDataFunction,super.setOptions(t)}};function C_(t,e,s){const i=[],n=[];for(let r=0;r<t.size;++r){const o=t.get(r),a=o.getData(),l=e(o);n.push(gn(a,l)),i.push(a)}return s.modules.data.setProperty(t,null,n,{dispatch:!0,virtual:!0}),i}var fr=()=>"";function vo(){return{}}var eb=class extends Qi{constructor(t){super(t),this.nodeSelector=t.nodeSelector||_r,this.nodeGroupIdFunction=t.nodeGroupIdFunction||fr,this.nodeGenerator=t.nodeGenerator||vo,this.edgeSelector=t.edgeSelector||_r,this.edgeGroupIdFunction=t.edgeGroupIdFunction||fr,this.edgeGenerator=t.edgeGenerator||vo,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0&&t.separateEdgesByDirection,this.groupSelfLoopEdges=!!t.groupSelfLoopEdges,this.groupEdges=t.groupEdges===void 0||t.groupEdges,this.ogma.events.on("updateNodeData",({changes:e})=>this.checkChanges(e,!0)).on("updateEdgeData",({changes:e})=>this.checkChanges(e,!1))}computeNodeGroupId(t){if(this.nodeGroupIdFunction){if(!this.nodeSelector(t)||this.module.groupController.alreadyGrouped.has(t._index)||this.module.animations.hiddenNodes.has(t._index))return;const e=this.nodeGroupIdFunction(t);return e===void 0?void 0:e}}computeEdgeGroupId(t){if(this.edgeGroupIdFunction)return this.edgeSelector(t)&&!this.module.animations.hiddenEdges.has(t._index)?this.edgeGroupIdFunction(t):void 0}addMetaNodes(){const t=this.id,e=this.ogma,s=e.getNodes(),i=new Map;for(let d=0;d<s.size;++d){const h=s.get(d),u=this.computeNodeGroupId(h);if(u===void 0)continue;let c=i.get(u);c||(c={id:u,nodes:[]},i.set(u,c)),c.nodes.push(h)}const n=Array.from(i.values()),r=n.map(({nodes:d})=>e.getNodes(d)),o=[],a=[],{nodeDataUpdates:l}=this.context;for(let d=0;d<n.length;++d){const h=n[d].id,u=r[d],c=this.nodeGenerator(u,h,this);c?(c.id===void 0&&(c.id=xl(h,t)),a.push(c.id),o.push(c)):(n.splice(d,1),r.splice(d,1),d--)}return e.addNodes(o.map(({id:d,attributes:h})=>({id:d,attributes:h})),{virtual:!0}).then(d=>{const h=e.getNodes(a),u=h.getData();for(let g=0;g<u.length;g++){const m=u[g],_=o[g];u[g]=gn(gn(m,_.data),l.get(h._indexes[g]))}e.modules.data.setProperty(h,null,u,{dispatch:!0,virtual:!0}),h.setVisible(!0);const c=h._indexes;this.context.metaNodes&&this.module.removeMetaNodes(this.context.metaNodes);for(let g=0;g<c.length;g++){const m=c[g],_=r[g];this.module.setSubNodes(m,_),this.module.setTransformation(m,this,!0);for(let f=0;f<_._indexes.length;f++)this.module.groupController.alreadyGrouped.add(_._indexes[f]),this.module.setMetaNode(_._indexes[f],h.get(g))}return{metaNodes:h,newNodes:d}})}addMetaEdges(t){const e=this.id,s=this.ogma;let i,n=!1;t?(i=this.module.getSubNodes(t).getAdjacentElements({bothExtremities:!1}).edges,n=!0):i=s.getEdges();const r=new Map,o=this.ogma.modules.graphics.getAttributesManager().getUsedEdgeAttributes().filter(g=>g!=="curvature"),a=new Map;for(let g=0;g<i.size;++g){const m=i.get(g),_=this.computeEdgeGroupId(m);if(_==null)continue;let f=m.getSource(),p=m.getTarget();if(n){let b=this.module.nodeToMeta.get(f._index);b&&b.getTransformation().getId()!==this.getId()&&(b=f);let v=this.module.nodeToMeta.get(p._index);if(v&&v.getTransformation().getId()!==this.getId()&&(v=p),f=b||f,p=v||p,f&&f===p){a.has(f._index)?a.get(f._index).push(m._index):a.set(f._index,[m._index]);continue}}const x=this.groupEdges?VN(_,f.getId(),p.getId(),this.separateEdgesByDirection):String(m.getId());let y=r.get(x);y||(y={id:x,source:f,target:p,edges:[]},r.set(x,y)),y.edges.push(m)}const l=Array.from(r.values()),d=l.map(({edges:g})=>s.getEdges(g)),h=[],{edgeDataUpdates:u}=this.context,c=[];for(let g=0;g<l.length;++g){const m=l[g],_=m.id,f=d[g],p=this.groupEdges?this.edgeGenerator(f,_,this):UN(f,o);if(p){if(p.id===null)throw Error(`The id ${p.id} returned by the edgeGenerator function is not unique.`);p.id===void 0&&(p.id=xl(_,e)),c.push(p.id),p.source=m.source.getId(),p.target=m.target.getId(),h.push(p)}}return s.addEdges(GN(h),{virtual:!0}).then(()=>{const g=s.getEdges(c);g.setVisible(!1),g.setAttributes(h.map(f=>f.attributes));const m=g.getData();for(let f=0;f<m.length;f++){const p=h[f],x=m[f];m[f]=gn(gn(x,p.data),u.get(g._indexes[f]))}s.modules.data.setProperty(g,null,m,{dispatch:!0,virtual:!0}),this.context.metaEdges&&this.module.removeMetaEdges(this.context.metaEdges);const _=g._indexes;for(let f=0;f<_.length;f++){const p=d[f]._indexes,x=_[f];for(let y=0;y<p.length;y++)this.module.setMetaEdge(p[y],g.get(f));this.module.setSubEdges(x,d[f]),this.module.setTransformation(x,this,!1)}return{intraEdges:a,metaEdges:g}})}removeMetaEdges(t){t.forEach(e=>{const s=this.module.getSubEdges(e);if(!s)return;const i=s._indexes;for(let r=0;r<i.length;r++)this.module.clearMetaEdge(i[r]);this.module.clearSubEdges(e._index);const n=this.module.getMetaEdge(e);if(n){for(let r=0;r<i.length;r++)this.module.setMetaEdge(i[r],n);this.module.setSubEdges(n._index,this.module.getSubEdges(n).filter(r=>r!==e).concat(s))}s.filter(r=>r.getTarget().isVisible()&&r.getSource().isVisible()).setVisible(!0)}),t.setVisible(!1)}removeMetaNodes(t){t.forEach(e=>{const s=this.module.getSubNodes(e);if(!s)return;const i=s._indexes;for(const n of i)this.module.clearMetaNode(n);this.module.clearSubNodes(e._index),s.setVisible(!0)}),t.setVisible(!1)}onRemove(t,e){}checkChanges(t,e){const s=e?this.context.nodeDataUpdates:this.context.edgeDataUpdates,i=this.module;for(let n=0;n<t.length;n++){const{property:r,newValues:o,virtual:a,nodes:l,edges:d}=t[n];if(a)continue;const h=e?l.filter(u=>i.getTransformation(u._index,e)===this):d.filter(u=>i.getTransformation(u._index,e)===this);if(h.size)for(let u=0;u<h._indexes.length;u++){let c=s.get(h._indexes[u])||{};const g=o[u];r?Wr(c,r,g):c=g,s.set(h._indexes[u],c)}}}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.nodeGroupIdFunction=t.nodeGroupIdFunction||this.nodeGroupIdFunction,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.edgeGroupIdFunction=t.edgeGroupIdFunction||this.edgeGroupIdFunction,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0?!!t.separateEdgesByDirection:this.separateEdgesByDirection,this.groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this.groupSelfLoopEdges,this.groupEdges=t.groupEdges!==void 0?!!t.groupEdges:this.groupEdges,super.setOptions(t)}resetContext(){super.resetContext(),this.context=$t(ct({},this.context),{nodeDataUpdates:new Map,edgeDataUpdates:new Map})}},sb=class extends eb{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,padding:o=2,onBeforeAddMetaEdges:a,selector:l=_r,groupIdFunction:d=fr,edgeGroupIdFunction:h=fr,nodeGenerator:u=vo,edgeGenerator:c=vo,onGroupUpdate:g=()=>Promise.resolve(),separateEdgesByDirection:m=!1,groupSelfLoopEdges:_=!1,groupEdges:f=!0,restorePositions:p=!0,showContents:x=!1}){super({id:s,ogma:i,module:n,nodeSelector:l,nodeGroupIdFunction:d,edgeGroupIdFunction:h,nodeGenerator:u,edgeSelector:y=>!(!this.module.getMetaNode(y.getSource())&&!this.module.getMetaNode(y.getTarget())),edgeGenerator:c,separateEdgesByDirection:m,groupEdges:f,groupSelfLoopEdges:_,duration:t,easing:e,enabled:r}),this.onBeforeAddMetaEdges=a||(()=>Promise.resolve()),this.onGroupUpdate=g,this._padding=o,this._showContents=typeof x!="function"?()=>x:x,this._restorePositions=p}getName(){return us.NodeGrouping}get padding(){return this._padding}set padding(t){this._padding=t,this.refresh()}resetContext(){super.resetContext(),this.context=$t(ct({},this.context),{metaNodes:this.ogma.nodeList(),metaEdges:this.ogma.edgeList(),subNodes:this.ogma.nodeList(),intraEdges:this.ogma.edgeList(),subNodesPerMetaNode:new Map,subEdges:this.ogma.edgeList()})}run(){let t,e;const s=this.ogma,i=this.module.groupController,n=i.layoutController;let r=s.createNodeList(),o=s.createEdgeList();const a=[];let l=s.createEdgeList();const d=new Map,h=-(this.getIndex()+1),u=new Set,c=[];let g;const m=s.geo.enabled();return this.addMetaNodes().then(({metaNodes:_,newNodes:f})=>{g=i.setPadding(_,this._padding),t=_;for(let p=0;p<f.size;p++)u.add(f._indexes[p]);for(let p=0;p<t.size;p++)i.nodeLayer.set(t._indexes[p],h);return this.onBeforeAddMetaEdges(t,f).then(()=>this.addMetaEdges(t))}).then(({intraEdges:_,metaEdges:f})=>{e=f,o=this.module.getSubEdges(e),e.filter(y=>y.getExtremities().map(b=>b.isVisible()).every(b=>b)).setVisible(!0);for(let y=0;y<e.size;y++)i.edgeLayer.set(e._indexes[y],h);o.setVisible(!1);const p=this.context.metaNodes.subtract(t),x=this.context.metaEdges.subtract(e);return this.module.removeMetaNodes(p),this.module.removeMetaEdges(x),i.cleanup(p,x),s.removeNodes(p,{virtual:!0}).then(()=>s.removeEdges(x,{virtual:!0})).then(()=>({intraEdges:_,metaEdges:f}))}).then(({intraEdges:_})=>{const f=t._indexes,p=[],x=t.getPosition();for(let y=0;y<f.length;y++){const b=t.get(y),v=i.isClose(b),E=!v&&!i.isOpen(b),A=i.collapsedGroups.has(b._index),S=this._showContents(b),T=this.module.getSubNodes(b),L=x[y],I=T._indexes,R=new Set;if(E){const{x:H,y:K}=i.getGroupXYR(b,this.module.getSubNodes(b),void 0,void 0);m?i.setGeoLatLng(b,K,H):(b.setAttributes({x:H,y:K},0),L.x=H,L.y=K)}d.set(f[y],R);const z=_.has(b._index)&&s.edgeList(_.get(b._index));z&&(l=l.concat(z),z.setVisible(S&&!A)),r=r.concat(T);for(let H=0;H<I.length;H++)R.add(I[H]);const j=this.context.subNodesPerMetaNode.get(f[y]),C=g.has(b._index);let w=!j||n.shouldRelayout.has(b._index);if(!w&&j)for(const H of j.keys())w||(w=!R.has(H));if(!w&&j)for(let H=0;H<I.length;H++)w||(w=!j.has(I[H]));if(w&&(n.shouldRelayout.add(b._index),p.push(this.getLayoutPromise(b,T,S))),S){if(v?i.expandGroup(b,T):i.addOpenGroup(b),w||C){c.push(b);const H=this.module.getMetaNode(b);H&&n.shouldRelayout.add(H._index)}}else i.closeGroup(b,T,L.x,L.y)}return this.module.animations.handleLayoutPromises(p).then(()=>{c.forEach(y=>i.setGroupXYR(y)),m&&this.ogma.modules.geo._updateNodesCoordinates(t)})}).then(()=>(this.context={metaNodes:t,metaEdges:e,subNodesPerMetaNode:d,subNodes:r,intraEdges:l,nodeDataUpdates:this.context.nodeDataUpdates,edgeDataUpdates:this.context.edgeDataUpdates,subEdges:o},a))}undo(t=!0){super.undo(t);const{metaNodes:e,metaEdges:s,intraEdges:i,subNodes:n,subEdges:r}=this.context,o=this.module.animations,a=this.module.groupController,l=-(this.getIndex()+1);i.setVisible(!0),r.setVisible(!0),s.setVisible(!1),n.setVisible(!0),n.setAttribute("layer",l+1),e.setVisible(!1),t?(o.pushBefore(()=>{e.setVisible(!0),s.setVisible(!0)}),o.pushAfter(()=>{e.setVisible(!1),s.setVisible(!1)}),e.forEach(d=>{const h=this.module.getSubNodes(d);if(a.isClose(d))a.expandGroup(d,h,!0);else{const u=d.getPosition();a.closeGroup(d,h,u.x,u.y,!0)}})):e.forEach(d=>{a.restorePositions(d,this.module.getSubNodes(d))})}onRemove(t,e){if(e){const s=this.context.metaNodes.size;this.context.metaNodes=this.context.metaNodes.filter(n=>!t.has(n._index));const i=this.context.subNodes.size;this.context.subNodes=this.context.subNodes.filter(n=>!t.has(n._index)),(this.context.subNodes.size!==s||this.context.metaNodes.size!==i)&&this.context.subNodesPerMetaNode.clear()}else this.context.subEdges=this.context.subEdges.filter(s=>!t.has(s._index)),this.context.metaEdges=this.context.metaEdges.filter(s=>!t.has(s._index))}cleanup(){const{ogma:t}=this,e=this.context,{metaNodes:s,metaEdges:i,subNodes:n}=e;return this.module.removeMetaNodes(s),this.module.removeMetaEdges(i),this.module.groupController.cleanup(s,i,n),super.cleanup(),Promise.all([t.removeEdges(i,{virtual:!0}),t.removeNodes(s,{virtual:!0})]).then(()=>Promise.resolve())}setOptions({duration:t,easing:e,enabled:s,padding:i,selector:n,groupIdFunction:r,nodeGenerator:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupSelfLoopEdges:h,groupEdges:u,restorePositions:c,showContents:g}){return this._padding=i!==void 0?i:this.padding,this._showContents=g!==void 0?typeof g!="function"?()=>g:g:this._showContents,this._restorePositions=c===void 0?this._restorePositions:c,super.setOptions({nodeSelector:n,nodeGroupIdFunction:r,nodeGenerator:o,edgeSelector:m=>!(!this.module.getMetaNode(m.getSource())&&!this.module.getMetaNode(m.getTarget())),edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:u,groupSelfLoopEdges:h,duration:t,easing:e,enabled:s})}getLayoutPromise(t,e,s){return(this.onGroupUpdate(t,e,s)||Promise.resolve()).then(i=>i?{subNodes:e,res:i}:null)}},uP=class extends eb{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,selector:o=_r,groupIdFunction:a=fr,generator:l=vo,separateEdgesByDirection:d=!1}){super({id:s,ogma:i,module:n,nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:!0,groupSelfLoopEdges:!0,duration:t,easing:e,enabled:r})}resetContext(){super.resetContext(),this.context=$t(ct({},this.context),{metaEdges:this.ogma.edgeList(),subEdges:this.ogma.edgeList()})}getName(){return us.EdgeGrouping}run(){let t,e;const s=this.module.animations,i=new Set(this.context.metaEdges.getId());return this.addMetaEdges().then(({metaEdges:n})=>{t=n,e=this.module.getSubEdges(t),t.setVisible(!0),e.setVisible(!1),s.hideEdges(e._indexes);const r=t.concat(this.context.metaEdges).getParallelEdges().dedupe().filter(d=>!i.has(d.getId())),o=new Array(r.size),a=new Map;for(let d=0;d<r.size;d++)o[d]=this.ogma.modules.curvatureManager.computeCurvature(r.get(d),"visible"),a.set(r._indexes[d],o[d]);const l=this.module.getSubEdges(r);l.setVisible(!0),this.module.animations.setCurvatures(r._indexes,o);for(let d=0;d<l._indexes.length;d++)this.module.animations.setCurvature(e._indexes[d],a.get(this.module.getMetaEdge(e.get(d))._index)||0)}).then(()=>{this.context.metaEdges=t,this.context.subEdges=e})}undo(t=!0){super.undo(t);const{metaEdges:e,subEdges:s}=this.context;if(s.setVisible(!0),e.setVisible(!1),!t)return Promise.resolve();const i=s.getParallelEdges().dedupe(),n=new Array(i.size),r=new Map;for(let o=0;o<i.size;o++)n[o]=this.ogma.modules.curvatureManager.computeCurvature(i.get(o),"visible"),r.set(i._indexes[o],n[o]);return this.module.animations.setCurvatures(i._indexes,n),Promise.resolve()}onRemove(t,e){e||(this.context.subEdges=this.context.subEdges.filter(s=>!t.has(s._index)))}_getCurvatures(t){return t.map(e=>this.ogma.modules.curvatureManager.computeCurvature(e,"visible",()=>!0))}cleanup(){const{metaEdges:t}=this.context;return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then(()=>(this.context.metaEdges=this.ogma.edgeList(),this.context.subEdges=this.ogma.edgeList(),Promise.resolve()))}setOptions({duration:t,easing:e,enabled:s,selector:i,groupIdFunction:n,generator:r,separateEdgesByDirection:o}){return super.setOptions({nodeSelector:void 0,nodeGroupIdFunction:void 0,nodeGenerator:void 0,edgeSelector:i,edgeGroupIdFunction:n,edgeGenerator:r,separateEdgesByDirection:o,groupEdges:!0,duration:t,easing:e,enabled:s})}},M_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],zd=1,Cr=8,cP=class ib{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,i]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(n!==zd)throw new Error(`Got v${n} data when expected v${zd}.`);const r=M_[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new ib(a,o,r,e)}constructor(e,s=64,i=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=M_.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-a%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,Cr,e),this.coords=new this.ArrayType(this.data,Cr+a+l,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(Cr+o+a+l),this.ids=new this.IndexArrayType(this.data,Cr,e),this.coords=new this.ArrayType(this.data,Cr+a+l,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(zd<<4)+r]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=s,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return lu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:a}=this,l=[0,r.length-1,0],d=[];for(;l.length;){const h=l.pop()||0,u=l.pop()||0,c=l.pop()||0;if(u-c<=a){for(let f=c;f<=u;f++){const p=o[2*f],x=o[2*f+1];p>=e&&p<=i&&x>=s&&x<=n&&d.push(r[f])}continue}const g=c+u>>1,m=o[2*g],_=o[2*g+1];m>=e&&m<=i&&_>=s&&_<=n&&d.push(r[g]),(h===0?e<=m:s<=_)&&(l.push(c),l.push(g-1),l.push(1-h)),(h===0?i>=m:n>=_)&&(l.push(g+1),l.push(u),l.push(1-h))}return d}within(e,s,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,a=[0,n.length-1,0],l=[],d=i*i;for(;a.length;){const h=a.pop()||0,u=a.pop()||0,c=a.pop()||0;if(u-c<=o){for(let f=c;f<=u;f++)N_(r[2*f],r[2*f+1],e,s)<=d&&l.push(n[f]);continue}const g=c+u>>1,m=r[2*g],_=r[2*g+1];N_(m,_,e,s)<=d&&l.push(n[g]),(h===0?e-i<=m:s-i<=_)&&(a.push(c),a.push(g-1),a.push(1-h)),(h===0?e+i>=m:s+i>=_)&&(a.push(g+1),a.push(u),a.push(1-h))}return l}};function lu(t,e,s,i,n,r){if(n-i<=s)return;const o=i+n>>1;nb(t,e,o,i,n,r),lu(t,e,s,i,o-1,1-r),lu(t,e,s,o+1,n,1-r)}function nb(t,e,s,i,n,r){for(;n>i;){if(n-i>600){const d=n-i+1,h=s-i+1,u=Math.log(d),c=.5*Math.exp(2*u/3),g=.5*Math.sqrt(u*c*(d-c)/d)*(h-d/2<0?-1:1);nb(t,e,s,Math.max(i,Math.floor(s-h*c/d+g)),Math.min(n,Math.floor(s+(d-h)*c/d+g)),r)}const o=e[2*s+r];let a=i,l=n;for(Mr(t,e,i,s),e[2*n+r]>o&&Mr(t,e,i,n);a<l;){for(Mr(t,e,a,l),a++,l--;e[2*a+r]<o;)a++;for(;e[2*l+r]>o;)l--}e[2*i+r]===o?Mr(t,e,i,l):(l++,Mr(t,e,l,n)),l<=s&&(i=l+1),s<=l&&(n=l-1)}}function Mr(t,e,s,i){Bd(t,s,i),Bd(e,2*s,2*i),Bd(e,2*s+1,2*i+1)}function Bd(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function N_(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}var gP=t=>t/360+.5,mP=t=>{const e=Math.sin(t*Math.PI/180);return(t=.5-.25*Math.log((1+e)/(1-e))/Math.PI)<0?0:t>1?1:t},_P=[],fP=256,pP=class extends sb{constructor(t){super($t(ct({},t),{enabled:t.ogma.geo.enabled(),showContents:!1,selector:e=>{const s=this.getPosition(e);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!t.selector||t.selector(e))},groupIdFunction:e=>{let s=t.groupIdFunction?t.groupIdFunction(e):"geo-cluster";return s||(s="geo-cluster"),`${s}-${this.getNodeId(e)}`},edgeGroupIdFunction:e=>{let s=t.edgeGroupIdFunction?t.edgeGroupIdFunction(e):"";return s||(s=""),`${s}-${this.getNodeId(e.getSource())}-${this.getNodeId(e.getTarget())}`},nodeGenerator:(e,s,i)=>{let n=t.nodeGenerator?t.nodeGenerator(e,s,i):{};n||(n={});const r=this.getCoords(e.get(0));return n.data?n.data=ru(n.data,r):n.data=r,n}})),this._zoomLevels=t.zoomLevels?t.zoomLevels:[0,22],this._groupingRadius=t.radius===void 0?60:t.radius,this._generateIdFunction=t.groupIdFunction||(()=>""),this._shouldEnable=t.enabled,this._shouldRefreshClusters=!0,this.ogma.events.on("beforeGeoCameraMove",({zoom:e})=>{!this.isEnabled()||!this.ogma.geo.enabled()||this.getClosestZoomLevel(e).zoom===this._currentClusters.zoom||(this._shouldRefreshClusters=!1,this.refresh())}).on("geoDisabled",()=>{this.isEnabled()&&this.disable(0).then(()=>{this._shouldEnable=!0})}).on("geoEnabled",()=>{this._shouldEnable&&this.enable(0)})}getPosition(t){return{x:t.getData(this.ogma.modules.geo.latitudePath),y:t.getData(this.ogma.modules.geo.longitudePath)}}getMercatorPosition(t){return{x:gP(t.getData(this.ogma.modules.geo.longitudePath)),y:mP(t.getData(this.ogma.modules.geo.latitudePath))}}getNodeId(t){var e;return((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.id)||""}getName(){return us.GeoClustering}enable(t){return this.ogma&&!this.ogma.geo.enabled()?(this._shouldEnable=!0,Promise.resolve()):super.enable(t)}undo(t=!0){const{metaNodes:e,metaEdges:s,intraEdges:i,subNodes:n,subEdges:r}=this.context,o=-(this.getIndex()+1);return t?(i.setVisible(!0),r.setVisible(!0),s.setVisible(!1),n.setVisible(!0),n.setAttribute("layer",o+1),this.module.animations.push(()=>{s.filter(a=>a).setVisible(!1),e.filter(a=>a).setVisible(!1)}),Promise.resolve()):(e.setVisible(!1),s.setVisible(!1),n.setVisible(!0),r.setVisible(!0),i.setVisible(!0),Promise.resolve())}disable(t){return this._shouldEnable=!1,super.disable(t)}getCoords(t){var e;const s=((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.center)||{x:0,y:0},i={};return this.setToPropertyPath(i,this.ogma.modules.geo.latitudePath,s.x),this.setToPropertyPath(i,this.ogma.modules.geo.longitudePath,s.y),i}setToPropertyPath(t,e,s){if(typeof e=="string")return this.setToPropertyPath(t,e.split("."),s);{let i=t;e.forEach((n,r)=>{r===e.length-1?i[n]=s:i[n]||(i[n]={}),i=i[n]})}}nodeToElement(t){return{nodeId:t._index,generatedId:this._generateIdFunction(t),nodes:this.ogma.nodeList(new Uint32Array([t._index])),radius:t.getAttribute("radius"),center:this.getPosition(t),mercatorCenter:this.getMercatorPosition(t),zoom:1/0}}getCluster(t){const e=t.reduce((n,r)=>({x:n.x+r.center.x/t.length,y:n.y+r.center.y/t.length}),{x:0,y:0}),s=t.reduce((n,r)=>({x:n.x+r.mercatorCenter.x/t.length,y:n.y+r.mercatorCenter.y/t.length}),{x:0,y:0}),i=t.reduce((n,r)=>{const o=e.x-r.center.x,a=e.y-r.center.y,l=r.radius+Math.sqrt(o*o+a*a);return Math.max(l,n)},0);return{nodes:this.ogma.nodeList(new Uint32Array(t.map(({nodeId:n})=>n))),generatedId:t[0].generatedId,center:e,mercatorCenter:s,radius:i}}onePassCluster(t){const e=t.map(r=>this.nodeToElement(r)),[s,i]=this._zoomLevels,n=[];for(let r=i;Math.abs(r-s)>.01;r-=1*(i-s)/19){const o=[],a=new cP(e.length);e.forEach(l=>{a.add(l.mercatorCenter.x,l.mercatorCenter.y)}),a.finish(),e.forEach(l=>{if(l.zoom<=r)return;const d=this._groupingRadius/(fP*Math.pow(2,l.zoom-1));let h=a.within(l.mercatorCenter.x,l.mercatorCenter.y,d).map(u=>e[u]).filter(u=>u.zoom>r&&u&&u.generatedId===l.generatedId);h.length||(h=[l]),h.forEach(u=>u.zoom=r),o.push($t(ct({},this.getCluster(h)),{zoom:r,id:`${r.toFixed(2)}-${o.length}`}))}),n.push({zoom:r,clusters:o})}return n.map(({zoom:r,clusters:o})=>{const a=new Map;return o.forEach(l=>{l.nodes.forEach(({_index:d})=>a.set(d,l))}),{zoom:r,idToCluster:a}})}getClosestZoomLevel(t){return this._clustersByZoom.reduce((e,s)=>Math.abs(t-s.zoom)<Math.abs(t-e.zoom)?s:e)}run(){var t;this._shouldRefreshClusters&&(this._clustersByZoom=this.onePassCluster(this.ogma.getNodes().filter(u=>this.nodeSelector(u)))),this._shouldRefreshClusters=!0;const e=((t=this.ogma.geo.getMap())==null?void 0:t.getZoom())||0;let s,i;this._currentClusters=this.getClosestZoomLevel(e);const n=this.ogma,r=this.module.groupController;let o=n.createNodeList(),a=n.createEdgeList(),l=n.createEdgeList();const d=-(this.getIndex()+1),h=new Set;return this.addMetaNodes().then(({metaNodes:u,newNodes:c})=>{s=u;for(let g=0;g<c.size;g++)h.add(c._indexes[g]);for(let g=0;g<s.size;g++)r.nodeLayer.set(s._indexes[g],d);return this.addMetaEdges(s)}).then(({intraEdges:u,metaEdges:c})=>{i=c,a=this.module.getSubEdges(i),i.filter(_=>_.getExtremities().map(f=>f.isVisible()).every(f=>f)).setVisible(!0);for(let _=0;_<i.size;_++)r.edgeLayer.set(i._indexes[_],d);a.setVisible(!1);const g=this.context.metaNodes.subtract(s),m=this.context.metaEdges.subtract(i);return this.module.removeMetaNodes(g),this.module.removeMetaEdges(m),r.cleanup(g,m),n.removeNodes(g,{virtual:!0}).then(()=>n.removeEdges(m,{virtual:!0})).then(()=>({intraEdges:u,metaEdges:c}))}).then(({intraEdges:u})=>{const c=s._indexes;for(let g=0;g<c.length;g++){const m=s.get(g),_=this.module.getSubNodes(m),f=u.has(m._index)&&n.edgeList(u.get(m._index));f&&(l=l.concat(f),f.setVisible(!1)),o=o.concat(_),_.setVisible(!1)}return this.ogma.modules.geo._updateNodesCoordinates(s),this.ogma.modules.geo.updateProjection(),this.context={metaNodes:s,metaEdges:i,subNodes:o,intraEdges:l,subNodesPerMetaNode:new Map,nodeDataUpdates:this.context.nodeDataUpdates,edgeDataUpdates:this.context.edgeDataUpdates,subEdges:a},_P})}setOptions(t){const e=super.setOptions($t(ct({},t),{selector:s=>{const i=this.getPosition(s);return i&&!isNaN(i.x)&&!isNaN(i.y)&&(!t.selector||t.selector(s))},groupIdFunction:s=>{let i=t.groupIdFunction?t.groupIdFunction(s):"geo-cluster";return i||(i="geo-cluster"),`${i}-${this.getNodeId(s)}`},nodeGenerator:(s,i,n)=>{let r=t.nodeGenerator?t.nodeGenerator(s,i,n):{};r||(r={});const o=this.getCoords(s.get(0));return r.data?r.data=ru(r.data,o):r.data=o,r},edgeGroupIdFunction:s=>{let i=t.edgeGroupIdFunction?t.edgeGroupIdFunction(s):"";return i||(i=""),`${i}-${this.getNodeId(s.getSource())}-${this.getNodeId(s.getTarget())}`}}));return this._groupingRadius=t.radius===void 0?this._groupingRadius:t.radius,this._generateIdFunction=t.groupIdFunction||this._generateIdFunction,this._shouldRefreshClusters=!0,this._shouldEnable=t.enabled,e}},P_=()=>({}),yP=class extends Qi{constructor(t){super(t),this._groupSelfLoopEdges=!1,this._isCleaningUp=!1,this._isRunning=!1,this.shouldDo=!0,this.enabled=!1,this._onBeforeAdd=e=>{if(this._isCleaningUp||!this.enabled||e.virtual)return;const{isNode:s,objects:i}=e;if(s){const n=i;F_(n,this._groupNodes(n))}else{const n=i;F_(n,this._groupEdges(n))}this._shouldSetVirtual=!0},this._onAfterAdd=e=>{this._shouldSetVirtual&&(this._shouldSetVirtual=!1,this._setVirtual(e.nodes||e.edges,!!e.nodes))},this._onRequestElementsToDelete=e=>{if(e.virtual)return;const{ogma:s,context:i}=this,n=e.elementsToRemove.isNode,r=n?s.getNodes:s.getEdges,o=n?i.metaNodesSet:i.metaEdgesSet,a=n?i.nodeGroups:i.edgeGroups,l=n?s.removeNodes:s.removeEdges,d=e.elementsToRemove.size,h=r(Array.from(o)),u=e.elementsToRemove.slice();if(e.elementsToRemove=e.elementsToRemove.subtract(h),e.elementsToRemove.size===d)return;const c=u.subtract(e.elementsToRemove);if(c.forEach(g=>{a.delete(g.getId())}),n){const g=c.getAdjacentEdges().filter(m=>m.isVirtual());s.removeEdges(g)}l(c,{virtual:!0})},this._nodeToGroupId=t.groupIdFunction||fr,this._groupSelfLoopEdges=!!t.groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||P_,this._edgeGenerator=t.edgeGenerator||P_,this._shouldSetVirtual=!1,this._selector=t.selector,this.shouldDo=t.enabled===void 0||!!t.enabled,this.ogma.events.on("preAddElements",this._onBeforeAdd).on("requestElementsToDelete",this._onRequestElementsToDelete).on(["postAddGraph","addNodes","addEdges"],this._onAfterAdd),this.shouldDo&&(this.enable(),this.shouldDo=!1)}getName(){return us.NodeClustering}enable(){if(this.enabled)return Promise.resolve();this.enabled=!0,this.shouldDo=!0,this._isRunning=!0;const{ogma:t}=this;return t.getNodes().size?t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(e=>(t.clearGraph(),t.setGraph(e))).then(()=>(this._isRunning=!1,Promise.resolve())):(this._isRunning=!1,Promise.resolve())}disable(){return this.enabled?(this.enabled=!1,this.shouldDo=!1,super.disable()):Promise.resolve()}destroy(){return this.disable(),super.destroy()}run(){const{ogma:t}=this;return this.enabled||!this.shouldDo?Promise.resolve():t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(e=>(t.clearGraph(),t.setGraph(e)))}undo(){if(this._isRunning||this.enabled)return Promise.resolve();const{ogma:t,context:e}=this;this._isCleaningUp=!0;const s=t.getNodes(Array.from(e.metaNodesSet));this.module.removeMetaNodes(s);const i=t.getEdges(Array.from(e.metaEdgesSet));this.module.removeMetaEdges(i);const n=this._getSubNodes(),r=this._getSubEdges();return this.resetContext(),t.removeNodes(s,{virtual:!0}).then(()=>t.removeEdges(i,{virtual:!0})).then(()=>t.addNodes(n)).then(()=>t.addEdges(r)).then(()=>{this._isCleaningUp=!1,Promise.resolve()})}cleanup(){return this.ogma.events.off(this._onBeforeAdd).off(this._onRequestElementsToDelete).off(this._onAfterAdd),Promise.resolve()}resetContext(){this._isRunning||(this.context={nodeGroups:new Map,edgeGroups:new Map,metaNodesSet:new Set,metaEdgesSet:new Set,virtualNodes:this.ogma.createNodeList(),virtualEdges:this.ogma.createEdgeList(),nodeToGroupId:new Map})}getSubNodes(t){const e=this.context.nodeGroups.get(t.getId());return e?e.nodes:[]}getSubEdges(t){const e=this.context.edgeGroups.get(t.getId());return e?e.edges:[]}_getSubNodes(){return Array.from(this.context.nodeGroups.values()).reduce((t,{nodes:e})=>(t.push(...e),t),[])}_getSubEdges(){return Array.from(this.context.edgeGroups.values()).reduce((t,{edges:e})=>(t.push(...e),t),[])}_setVirtual(t,e){if(!t)return;const{context:s}=this,i=e?s.metaNodesSet:s.metaEdgesSet,n=t.filter(r=>i.has(r.getId()));if(e)for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubNodes(n._indexes[r],null);else for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubEdges(n._indexes[r],null);e?s.virtualNodes=s.virtualNodes.concat(n):s.virtualEdges=s.virtualEdges.concat(n)}setContext(){}_computeEdgeGroupId(t,e){return t>e?`${e}:${t}`:`${t}:${e}`}_groupEdges(t){const{ogma:e,id:s,context:i}=this,n=s,r=new Map,o=i.nodeToGroupId;i.edgeGroups.forEach(h=>{h.newEdges=[],r.set(h.id,h)});const a=[];for(let h=0;h<t.length;++h){const u=t[h];let c=i.nodeToGroupId.get(u.source),g=i.nodeToGroupId.get(u.target);if(!c&&!g){a.push(u);continue}c=c||u.source,g=g||u.target;const m=this._computeEdgeGroupId(c,g);if(m!==void 0){const _=o.get(u.source)||u.source,f=o.get(u.target)||u.target;let p=r.get(m);p||(p={id:m,source:_,target:f,edges:[],newEdges:[]},r.set(m,p)),p.edges.push(u),p.newEdges.push(u)}}const l=bl(r),d=l.map(({edges:h})=>h);for(let h=0;h<l.length;++h){const u=l[h];if(!u.newEdges.length)continue;const c=u.id,g=d[h],m=this._edgeGenerator(g,c);m.id===void 0&&(m.id=xl(c,n)),m.source=u.source,m.target=u.target,u.metaEdge=m,i.metaEdgesSet.add(m.id),i.edgeGroups.get(m.id)||i.edgeGroups.set(m.id,u),(this._groupSelfLoopEdges||m.source!==m.target)&&a.push(m)}return e.view.afterNextFrame().then(()=>{i.edgeGroups.forEach(({newEdges:h,metaEdge:u})=>{if(!(h.length&&u&&u.id&&u.attributes))return;const c=e.getEdge(u.id);c==null||c.setAttributes(u.attributes)})}),a}_groupNodes(t){const{id:e,context:s,ogma:i}=this,n=e,r=new Map;s.nodeGroups.forEach(u=>{u.newNodes=[],r.set(u.id,u)});const o=[];for(let u=0;u<t.length;u++){const c=t[u];if(this._selector&&!this._selector(c)){o.push(c);continue}c.id=jN(c.id);const g=this._nodeToGroupId(c);if(g!==void 0){let m=r.get(g);m||(m={id:g,nodes:[],newNodes:[]},r.set(g,m)),m.nodes.push(c),m.newNodes.push(c)}else s.nodeToGroupId.set(c.id,c.id)}const a=bl(r),l=a.map(({nodes:u})=>u),d=a.map(({newNodes:u})=>u),h=[];for(let u=0;u<a.length;++u){if(!a[u].newNodes.length)continue;const c=a[u].id,g=l[u],m=this._nodeGenerator(g,c);a[u].metaNode=m,m.id===void 0&&(m.id=xl(c,n));for(const _ of d[u])s.nodeToGroupId.set(_.id,m.id);s.metaNodesSet.add(m.id),s.nodeGroups.get(m.id)||s.nodeGroups.set(m.id,a[u]),h.push(m)}return h.push(...o),i.view.afterNextFrame().then(()=>{s.nodeGroups.forEach(({newNodes:u,metaNode:c})=>{if(!(u.length&&c&&c.id&&c.attributes))return;const g=i.getNode(c.id);g==null||g.setAttributes(c.attributes)})}),h}setOptions(t){return this._nodeToGroupId=t.groupIdFunction||this._nodeToGroupId,this._groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this._groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||this._nodeGenerator,this._edgeGenerator=t.edgeGenerator||this._edgeGenerator,this._selector=t.selector||this._selector,this.disable().then(()=>this.undo()).then(()=>this.ogma.view.afterNextFrame()).then(()=>this.enable())}onRemove(){}};function F_(t,e){const s=e.length;return t.length=s,t.splice(0,s,...e),t}function hi(t){return t.enabled!==!1}var xP=class extends ZN{_setOptions(t){const e=t;return e.ogma=this.ogma,e.module=this,e.id=this.transformations.length,e}addNodeGrouping(t={}){const e=new sb(this._setOptions(t));return this.addTransformation(e,hi(t)),e}addEdgeGrouping(t={}){const e=new uP(this._setOptions(t));return this.addTransformation(e,hi(t)),e}addGeoClustering(t={}){const e=new pP(this._setOptions(t));return this.addTransformation(e),e}addNodeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new tP(this._setOptions(e));return this.addTransformation(s,hi(e)),s}addEdgeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new eP(this._setOptions(e));return this.addTransformation(s,hi(e)),s}addNeighborMerging(t){const e=new sP(this._setOptions(t));return this.addTransformation(e,hi(t)),e}addNeighborGeneration(t){const e=new rP(this._setOptions(t));return this.addTransformation(e,hi(t)),e}addNodeCollapsing(t={}){const e=new lP(this._setOptions(t));return this.addTransformation(e,hi(t)),e}addVirtualProperties(t={}){const e=new hP(this._setOptions(t));return this.addTransformation(e,hi(t)),e}addNodeClustering(t={}){const e=new yP(this._setOptions(t));return this.addTransformation(e,hi(t)),e}addDrilldown(t={onGetSubgraph:()=>Promise.resolve({nodes:[],edges:[]})}){const e=new HN(this._setOptions(t));return this.drilldownController.addDrilldown(e),e}onGroupsUpdated(t){this.groupController.onGroupsUpdate=t}layoutGroups(t,e,s=!1){return this.groupController.layoutGroups(t,e,s)}},bP=class extends Bt{constructor(t){super(t),this.getSubElements=e=>this.api.getSubElements(e),this.getSubNodes=e=>this.api.getSubNodes(e),this.getSubEdges=e=>this.api.getSubEdges(e),this.onGroupsUpdated=e=>this.api.onGroupsUpdated(e)}onMounted(){this._modules.classes.createClass({name:ty,isBuiltin:!0,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this._modules.classes.createClass({name:ey,isBuiltin:!0,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}}),this._modules.settings.register("transformations.updateOnDataChange",!0),this._modules.events.register(["transformationEnabled","transformationDisabled","transformationSetIndex","transformationDestroyed","transformationRefresh"])}onReady(t){this.api=new xP(this._ogma)}destroy(){}isElementVirtual(t){return this.api.isVirtual(t._index,t.isNode)}getElementTransformation(t){return this.api.getTransformation(t._index,t.isNode)}getMetaElements(t){return t.map(e=>this.getMetaElement(e))}getMetaElement(t){var e;const s=t.isNode?this.api.getMetaNode(t):this.api.getMetaEdge(t);return s&&((e=this.api.getTransformation(s._index,s.isNode))!=null&&e.isEnabled())?s:null}getMetaEdge(t){return this.getMetaElement(t)}getMetaNode(t){return this.getMetaElement(t)}getMetaNodes(t){return this.getMetaElements(t)}getMetaEdges(t){return this.getMetaElements(t)}getNodeFilters(){return this.api.getList().filter(t=>t.getName()===us.NodeFilter)}getEdgeFilters(){return this.api.getList().filter(t=>t.getName()===us.EdgeFilter)}whenApplied(){return this.api.afterNextUpdate()}afterNextUpdate(){return this.api.afterNextUpdate()}},k_={layer:sy,outline:!0,outerStroke:{color:Oh,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:Tx,minVisibleSize:0}},vP={layer:sy,color:Oh,text:{backgroundColor:Tx,minVisibleSize:0},stroke:{color:Oh,width:0}},EP=class extends Bt{onMounted(){this._modules.events.register(["nodesSelected","nodesUnselected","edgesSelected","edgesUnselected"]),this._selectionExtremityHighlightedClass=this._modules.classes.createClass({name:vh,isBuiltin:!0,nodeAttributes:k_}),this._selectedClass=this._modules.classes.createClass({name:we,isBuiltin:!0,nodeAttributes:k_,edgeAttributes:vP}),this._modules.events.on(`nodeClassAdded_${we}`,e=>{this._modules.events.fire("nodesSelected",e)}),this._modules.events.on(`edgeClassAdded_${we}`,e=>{this._modules.events.fire("edgesSelected",e)}),this._modules.events.on(`nodeClassRemoved_${we}`,e=>{this._modules.events.fire("nodesUnselected",e)}),this._modules.events.on(`edgeClassRemoved_${we}`,e=>{this._modules.events.fire("edgesUnselected",e)}),this._modules.settings.register("interactions.selection.enabled",!0),this._modules.settings.register("interactions.selection.multiSelectionKey","ctrl"),this._modules.interactions.onClick({priority:"selection",check:({button:e})=>{const s=!!this._modules.settings.get("interactions.selection.enabled");return e==="left"&&s},handler:({target:e})=>{if(e){const s=this._modules.settings.get("interactions.selection.multiSelectionKey"),i=s&&this._modules.keyboard.isPressed(s);e.isNode?this._selectedClass.clearEdges():this._selectedClass.clearNodes(),i?e.hasClass(we)?e.removeClass(we):e.addClass(we):((e.isNode?this._selectedClass.getNodes():this._selectedClass.getEdges()).filter(n=>n!==e).removeClass(we),e.hasClass(we)||e.addClass(we))}else this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}});const t=()=>{this._selectionExtremityHighlightedClass.clearNodes(),this._selectedClass.getEdges().getExtremities().addClass(vh)};this._modules.events.on("beforeRemoveEdges",({edges:e})=>e.setSelected(!1)).on("excludedStateChange",({elements:e,value:s})=>{s||e.setSelected(!1)}).on(`edgeClassAdded_${we}`,t).on(`edgeClassRemoved_${we}`,t)}setNodeAttributes(t,e){this._selectedClass.update({nodeAttributes:t,fullOverwrite:e}),this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}setEdgeAttributes(t,e){this._selectedClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}_updateExtremityHighlightLayer(){const t=this._selectedClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}setActive(t,e){if(es(e)){const s=[],i=[];t.toList().forEach((n,r)=>{(e[r]?s:i).push(n.getId())}),s.length!==0&&this._modules.graph.getElements(t.isNode,s).addClass(we),i.length!==0&&this._modules.graph.getElements(t.isNode,i).removeClass(we)}else t.size&&t[e?"addClass":"removeClass"](we)}areActive(t){return t.hasClass(we)}getSelectedNodes(){return this._selectedClass.getNodes()}getSelectedEdges(){return this._selectedClass.getEdges()}getNonSelectedNodes(){return this._modules.graph.getNodes().filter(t=>!t.hasClass(we))}getNonSelectedEdges(){return this._modules.graph.getEdges().filter(t=>!t.hasClass(we))}clear(){this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}},AP=class extends Bt{onMounted(){this._delayedCalls=[],this._idIdle=()=>!this._modules.captor.isAnyButtonPressed()&&!this._modules.dom.isPlayingFrame(),this._modules.events.on(["mousedown","mouseup","beforeNewFrame","frame"],()=>{this._delayedCalls.forEach(t=>t.reset())})}_nextTimeIdle(t){const e=new SP(this._modules.dom,this._idIdle,t);return this._delayedCalls.push(e),e.whenDone().then(()=>{this._delayedCalls.splice(this._delayedCalls.indexOf(e),1)})}debounceIdle(t,e=0){let s=!1,i=[];const n=()=>{const r=i;s=!1,i=[],t(),r.forEach(o=>o())};return()=>new Promise(r=>{i.push(r),s||(s=!0,this._nextTimeIdle(e).then(n))})}},SP=class{constructor(t,e,s){this._timeout=null,this._done=!1,this._dom=t,this._promise=new Promise(i=>this._resolve=i),this._isIdle=e,this._delay=s,this._startTimeout()}_startTimeout(){this._timeout=this._dom.setTimeout(()=>{this._isIdle()?(this._done=!0,this._resolve()):this._startTimeout()},this._delay)}reset(){this._done||(this._dom.clearTimeout(this._timeout),this._startTimeout())}whenDone(){return this._promise}},Ea=-2,wP={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2,enabled:!1},TP={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2,enabled:!1},IP=class extends Bt{constructor(){super(...arguments),this._nodePromiseMap=new Map,this._edgePromiseMap=new Map,this._onAttributeChange=({nodes:t,edges:e,nodeAttributes:s,edgeAttributes:i})=>{this._onElementsAttributeChange(t,s),this._onElementsAttributeChange(e,i,!1)},this._refreshPulses=()=>{const{nodes:t,edges:e}=this._hasPulses.getElements();if(t.size!==0||e.size!==0){const s=this._engine.getCurrentTime();this._refreshElementsPulses(t,s),this._refreshElementsPulses(e,s),this._modules.dom.refresh()}}}onMounted(){this._modules.events.on("updateAttributes",this._onAttributeChange).on("frame",this._refreshPulses).on("beforeRemoveEdges",({edges:t})=>{this._removePulses(t)}).on("beforeRemoveNodes",({nodes:t})=>{this._removePulses(t)}).on("excludedStateChange",({elements:t,value:e})=>{e&&(this._hasPulses.removeElements(t),this._removePulses(t))}).on("clearGraph",()=>this._hasPulses.clear()),this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._nodePulses=this._modules.graph.createNodeAttribute({storage:"any"},!1),this._edgePulses=this._modules.graph.createEdgeAttribute({storage:"any"},!1),this._nodeNbPulsesRemaining=this._modules.graph.createNodeAttribute({storage:"int16",default:-1},!1),this._edgeNbPulsesRemaining=this._modules.graph.createEdgeAttribute({storage:"int16",default:-1},!1),this._nodeFlexArrays=this._modules.graphics.getNodeAttributes(),this._edgeFlexArrays=this._modules.graphics.getEdgeAttributes(),this._edgeSourceList=this._modules.graph.getEdgeAttribute("source"),this._edgeTargetList=this._modules.graph.getEdgeAttribute("target"),this._hasPulses=new Po(this._modules.graph)}_onElementsAttributeChange(t,e,s=!0){if(!e.includes("pulse.enabled"))return;const{valid:i,invalid:n}=Cp(this._modules.graph,t,o=>o.getAttribute("pulse.enabled")&&o.isVisible());this._hasPulses.removeElements(n),this._hasPulses.addElements(i);const r=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let o=0;o<i.size;o++)r.get(i._indexes[o])>0||r.set(i._indexes[o],Ea);this._removePulses(n)}_removePulses(t){const e=t.isNode?this._nodePulses:this._edgePulses,s=t.isNode?this._nodePromiseMap:this._edgePromiseMap;for(let i=0;i<t._indexes.length;i++){const n=t._indexes[i],r=e.get(n);if(r){for(let a=0;a<r.length;a++){const l=r[a];this._modules.graphics.releaseGraphicsEngineBlockId(l.blockId)}e.set(n,null);const o=s.get(n);o&&(o.resolve(),s.delete(n))}}}_refreshElementsPulses(t,e){const s=t.isNode,i=s?this._nodePulses:this._edgePulses,n=s?this._nodeFlexArrays.pulse.duration:this._edgeFlexArrays.pulse.duration,r=s?"_createNodePulseBlock":"_createEdgePulseBlock",o=s?this._nodeFlexArrays.pulse.interval:this._edgeFlexArrays.pulse.interval,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let l=0;l<t._indexes.length;l++){const d=t._indexes[l];let h=i.get(d);h||(h=[],i.set(d,h));for(let _=0;_<h.length;_++){const{startTime:f,duration:p,blockId:x}=h[_];e>=f+p&&(this._modules.graphics.releaseGraphicsEngineBlockId(x),h.splice(_--,1))}const u=h[h.length-1];if(u&&e<u.startTime+o.get(d))continue;const c=n.get(d),g=a.get(d);if(g<1&&g!==Ea)continue;h.push({blockId:this[r](d,e,c),startTime:e,duration:c});const m=g===Ea?Ea:g-1;a.set(d,m)}}_createNodePulseBlock(t,e,s){const i=this._nodeFlexArrays,n=i.color.get(t),r=i.layer.get(t),o=i.x.get(t),a=i.y.get(t),l=i.radius.get(t),d=i.scalingMethod.get(t)==="scaled",h=i.pulse.startRatio.get(t),u=i.pulse.endRatio.get(t),c=i.pulse.width.get(t),g=2*l*h,m=2*l*u,_=fo(r).nodeBody,f=i.pulse.startColor.get(t),p=i.pulse.endColor.get(t),x=this._modules.graphics.allocateGraphicsEngineBlockId(),y=this._group.reset(Ws,!0,_),b=y.nextAndReset(),v=$s(f,n),E=$s(p,n);return b.end.shape="circle",b.end.pieceId=Bs,b.end.x1=o,b.end.y1=a,b.end.x2=o,b.end.y2=a,b.end.rectWidthOrSourceRadiusScaled=d?m:0,b.end.rectHeightOrTargetRadiusScaled=d?m:0,b.end.rectWidthOrSourceRadiusFixed=d?0:m,b.end.rectHeightOrTargetRadiusFixed=d?0:m,b.end.strokeWidthFixed=c,b.end.strokeColor=E,b.start.shape="circle",b.start.pieceId=Bs,b.start.x1=o,b.start.y1=a,b.start.x2=o,b.start.y2=a,b.start.rectWidthOrSourceRadiusScaled=d?g:0,b.start.rectHeightOrTargetRadiusScaled=d?g:0,b.start.rectWidthOrSourceRadiusFixed=d?0:g,b.start.rectHeightOrTargetRadiusFixed=d?0:g,b.start.strokeWidthFixed=c,b.start.strokeColor=v,b.animation.duration=s,b.animation.beginTime=e,this._engine.storeGroup(x,y),x}_createEdgePulseBlock(t,e,s){const i=this._edgeFlexArrays,n=this._nodeFlexArrays,r=i.pulse.startRatio.get(t),o=i.pulse.endRatio.get(t),a=i.pulse.startColor.get(t),l=i.pulse.endColor.get(t),d=fo(i.layer.get(t)).edgeBody,h=this._edgeSourceList.get(t),u=this._edgeTargetList.get(t),c=i.curvature.get(t),g=c!==0,m=this._modules.graphics.allocateGraphicsEngineBlockId(),_=this._group.reset(g?cl:Ws,!0,d),f=_.nextAndReset(),p={isSelfLoop:h===u,curvature:c,sourceX:n.x.get(h),sourceY:n.y.get(h),targetX:n.x.get(u),targetY:n.y.get(u),sourceRadius:n.radius.get(h),targetRadius:n.radius.get(u),isSourceRadiusScaled:n.scalingMethod.get(h)==="scaled",isTargetRadiusScaled:n.scalingMethod.get(u)==="scaled",width:i.width.get(t),isWidthScaled:i.scalingMethod.get(t)==="scaled",strokeWidth:i.pulse.width.get(t)};return D_(f.start,p),D_(f.end,p),f.start.strokeColor=a,f.end.strokeColor=l,f.start.thicknessOrFontSizeScaled*=r,f.start.thicknessOrFontSizeFixed*=r,f.end.thicknessOrFontSizeScaled*=o,f.end.thicknessOrFontSizeFixed*=o,f.animation.duration=s,f.animation.beginTime=e,this._engine.storeGroup(m,_),m}pulse(t,e){const s=t.isNode,i=ct(ct(ct({},s?wP:TP),s?this._nodePulseTheme:this._edgePulseTheme),e),n=i.number,r=i.interval,o=i.duration,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining,l=(n-1)*r+o;let d;i.enabled=!0,delete i.number,t.setAttributes({pulse:i}),a.setMultiple(t._indexes,n),this._modules.dom.setTimeout(()=>{t.isList?t.filter(Xs).setAttribute("pulse.enabled",!1):t.setAttribute("pulse.enabled",!1),a.setMultiple(t._indexes,-1)},l);const h=new Promise(c=>{d=()=>c(t)}),u=t.isNode?this._nodePromiseMap:this._edgePromiseMap;return t.isList?t._indexes.forEach(c=>{this._setPromise(c,u,h,d)}):this._setPromise(t._index,u,h,d),h}_setPromise(t,e,s,i){e.has(t)&&e.get(t).resolve(),e.set(t,{promise:s,resolve:i})}setTheme(t,e){this._nodePulseTheme=t,this._edgePulseTheme=e}};function D_(t,{sourceX:e,sourceY:s,targetX:i,targetY:n,isSourceRadiusScaled:r,isTargetRadiusScaled:o,targetRadius:a,sourceRadius:l,isWidthScaled:d,width:h,strokeWidth:u,curvature:c,isSelfLoop:g}){t.pieceId=Ul,t.shape="line",t.x1=e,t.y1=s,t.x2=i,t.y2=n,t.rectWidthOrSourceRadiusScaled=r?l:0,t.rectWidthOrSourceRadiusFixed=r?0:l,t.rectHeightOrTargetRadiusScaled=o?a:0,t.rectHeightOrTargetRadiusFixed=o?0:a,t.thicknessOrFontSizeScaled=d?h:0,t.thicknessOrFontSizeFixed=d?0:h,t.strokeWidthFixed=u,t.curvature=c,t.isSelfLoop=g}var LP={duration:0,easing:"linear",callback:Kt,resolve:Kt,startAfter:0},CP=0,MP=class extends Bt{constructor(){super(...arguments),this._animationList=[],this._update=()=>{if(this._animationList.length===0)return;const t=ls(),e=[];for(let s=0;s<this._animationList.length;++s){const i=this._animationList[s],n=(t-i.creationDate)/i.duration,r=i.startAfter;let o=i.easing(n);n>=1?(i.func(1),i.done=!0,i.resolve(void 0),this._animationList.splice(s,1),s-=1,e.push(i.callback)):o>=r&&(o=(o-r)*(1/(1-r)),i.func(o))}for(let s=0;s<e.length;s++)e[s](!1);this._modules.dom.refresh()}}onMounted(){this._modules.events.on("beforeNewFrame",this._update)}play(t,e){const{duration:s,easing:i,callback:n,startAfter:r,resolve:o}=Is(e,LP);if(s<=0)return t(1),n(),o(void 0),null;const a={func:t,easing:typeof i=="function"?i:cc[i],duration:s,callback:n,resolve:o,startAfter:r,creationDate:ls(),done:!1,id:++CP};return this._animationList.push(a),this._modules.dom.refresh(),a}cancel(t){const e=this._animationList.indexOf(t);e!==-1&&(t.func(1),this._animationList.splice(e,1),t.done=!0,t.resolve(void 0))}},NP=(t,e,s,i)=>{const n=s._getMapPanePos(),r=t.getMapboxMap(),o=t.getCanvas(),a=t.getSize().round(),l=i.DomUtil.getPosition(t.getContainer()),d=l.x+n.x,h=l.y+n.y;return new Promise(u=>{function c(){e.drawImage(o,d,h,a.x,a.y),u()}if(r.loaded())return c();r.once("idle",c)})},PP=(t,e,s,i,n)=>{const r=s._getMapPanePos(),o=t.getContainer();if(!o)throw new Error(`Trying to access the container of ${t} but it does not exist.`);const a=i.DomUtil.getPosition(o);s.removeLayer(t),t.options.crossOrigin="anonymous";const l=[],d=[];return t.on("tileload",({tile:h})=>{const{x:u,y:c}=i.DomUtil.getPosition(h);l.push(h),d.push({x:u-a.x+r.x,y:c-a.y+r.y})}),s.addLayer(t),new Promise(h=>{t.once("load",()=>{const u=t.getTileSize();l.forEach((c,g)=>{const{x:m,y:_}=d[g];e.drawImage(c,m,_,u.x,u.y)}),h()})})},FP=(t,e,s,i,n,r)=>new Promise(o=>{const a=t.options.renderer;s.removeLayer(t),t.options.renderer=r,s.addLayer(t),r._updatePaths();const l=s._getMapPanePos(),d=r._container,h=i.DomUtil.getPosition(d);e.drawImage(r._container,h.x+l.x,h.y+l.y,d.width/n,d.height/n),s.removeLayer(t),t.options.renderer=a,s.addLayer(t),o()}),kP=(t,e,s,i,n)=>new Promise(r=>{const o=s.getPixelBounds().min,a=s.project(t.getLatLng(),s.getZoom()),l=/^data:/.test(t._icon.src),d=l?t._icon.src:rb(t._icon.src),h=new Image,u=t.options.icon;if(u){const c=u.options;let g=c.iconSize||[24,24];const m=a.subtract(o);let _=c.iconAnchor||[0,0];Array.isArray(g)||(g=[g.x,g.y]),Array.isArray(_)||(_=[_.x,_.y]);const f=Math.round(m.x-(g[0]-_[0])*n),p=Math.round(m.y-_[1]*n);h.crossOrigin="";const x=()=>{e.drawImage(h,f,p,g[0]*n,g[1]*n),r()};h.onload=x,h.src=d,l&&x()}}),DP=(t,e,s,i,n)=>new Promise(r=>{s.removeLayer(t),t.setUrl(rb(t.getUrl())),t.options.crossOrigin="anonymous",t.once("load",()=>{const o=t.getBounds(),a=s.latLngToContainerPoint(o.getNorthWest()),l=s.latLngToContainerPoint(o.getSouthEast()),d=l.x-a.x,h=l.y-a.y;e.drawImage(t._image,a.x,a.y,d,h),r()}),s.addLayer(t)});function rb(t){return t+(t.indexOf("?")===-1?"?":"&")+"noCache="+Date.now()}var RP={tileLayers:PP,imageOverlays:DP,vectorLayers:FP,markers:kP,vectorMap:NP};function OP(t,e){return t instanceof e.TileLayer?"tileLayers":t instanceof e.ImageOverlay?"imageOverlays":t instanceof e.Path?"vectorLayers":t instanceof e.Marker?"markers":"MapboxGL"in e&&t instanceof e.MapboxGL?"vectorMap":void 0}function zP(t,e,s,i,n,r){const o={vectorMap:[],tileLayers:[],vectorLayers:[],imageOverlays:[],markers:[]};return e.eachLayer(a=>{if(a!==t){const l=OP(a,i);if(l&&l in o){const d=RP[l];o[l].push(()=>d(a,s,e,i,n,r))}}}),o}function BP(t){t.TileLayer.prototype.getUrl=function(){return this._url},t.ImageOverlay.prototype.getUrl=function(){return this._url};const e="leaflet-zoom-animated";t.OgmaOverlay||(t.OgmaOverlay=t.Layer.extend({options:{pane:"overlayPane",padding:0,onUpdate:()=>{}},initialize:function(s){const{container:i}=s;t.Util.setOptions(this,s),this._container=i},setLocked:function(s){return this._locked=s,this},onAdd:function(s){this._map=s,this.getPane().appendChild(this._container),this._wgsOrigin=t.latLng([0,0]),this._wgsInitialShift=s.project(this._wgsOrigin,this._initialZoom),t.DomUtil.addClass(this._container,"leaflet-layer"),this._zoomAnimated&&(t.DomUtil.addClass(this._container,e),this._container.style.position="absolute",this._container.style.zIndex=9999),this._initialZoom=(this._map.getMaxZoom()+this._map.getMinZoom())/2,this._mapInitialZoom=this._map.getZoom(),this._updateBounds(),this._update({})},_updateBounds(){const s=this.options.padding,i=this._map.getSize(),n=this._map.containerPointToLayerPoint(i.multiplyBy(-s));this._bounds=new t.Bounds(n,n.add(i.multiplyBy(1+2*s))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_update(s){this._updateBounds(),this._redraw(this._bounds.min,s),this._positionTimer=t.Util.requestAnimFrame(()=>{this._container&&t.DomUtil.setPosition(this._container,this._bounds.min)})},_redraw(s,i){this.options.onUpdate()},_updateTransform(s,i){if(this._locked)return;const n=this._map.getZoomScale(i,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,i),a=r.multiplyBy(-n).add(o).subtract(this._map._getNewPixelOrigin(s,i));t.Browser.any3d?t.DomUtil.setTransform(this._container,a,n):t.DomUtil.setPosition(this._container,a)},_onZoom(s){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveEnd(s){this._update(s)},_onAnimZoom({center:s,zoom:i}){this._updateTransform(s,i)},bringToFront(){t.DomUtil.toFront(this._container)},getEvents(){return{zoom:this._onZoom,moveend:this._onMoveEnd,zoomanim:this._onAnimZoom,layeradd:this.bringToFront,zoomend:this.options.onUpdate}},onRemove:function(){t.DomUtil.removeClass(this._container,e);const s=this._container;["transform","webkitTransform","OTransform","MozTransform","msTransform","zIndex","position"].forEach(i=>s.style[i]=null),t.Util.cancelAnimFrame(this._positionTimer),this._container=null}}))}function UP(t,e,s,i){const n=t.filter(E=>E.isVisible()),r=n.size===0,{mapX:o,mapY:a}=n.reduce((E,A)=>{const{latitude:S,longitude:T}=A.getGeoCoordinates(),{x:L,y:I}=i(S,T);return E.mapX.push(L),E.mapY.push(I),E},{mapX:[],mapY:[]}),l=n.getAttribute("x"),d=n.getAttribute("y"),h=n.getAttribute("radius").map(Number),u=new xs({xValues:l,yValues:d,scaledSizeValues:h}),c=new xs({xValues:o,yValues:a});r&&(u.cx=u.cy=0,u.width=u.height=0),isFinite(c.width)&&isFinite(c.height)||(c.cx=c.cy=0,c.width=c.height=0);let g=c.cx-u.cx,m=c.cy-u.cy;const _=r?1:Math.max(c.width,c.height)/Math.max(u.width,u.height),[f,p]=h.reduce((E,A)=>(E[0]=Math.min(E[0],A*_),E[1]=Math.max(E[1],A*_),E),[1/0,0]);c.pad(p),c.minScaledSize=f,c.maxScaledSize=p;const x=s.computeConfigForBounds(c),y=e.zoom/UA(x.zoom);g+=(u.cx-e.x)*y,m+=(u.cy-e.y)*y;const b=u.cx+g,v=u.cy+m;return{offsetChanges:{name:"graph-to-geo",nodeAttributes:{radius:E=>Number(E.getAttribute("radius"))*y,x:E=>(E.getAttribute("x")+g-b)*y+b,y:E=>(E.getAttribute("y")+m-v)*y+v},edgeAttributes:{width:E=>Number(E.getAttribute("width"))*y}},camera:ct({zoom:e.zoom/y,x:(e.x+g-b)*y+b,y:(e.y+m-v)*y+v,angle:0},e.getSize())}}function GP(t,e,s,i){const n=t.getAttributes(["x","y","radius"]),r=t.getBoundingBox(),o=t.size===0,a=t.reduce((b,{_index:v},E)=>(b[v]=E,b),{});i();const l=t.getAttribute("x"),d=t.getAttribute("y"),h=t.getAttribute("radius"),u=new xs({xValues:l,yValues:d,scaledSizeValues:h.map(b=>2*b)});o&&(r.reset(),u.reset());let c=u.cx-r.cx,g=u.cy-r.cy,m=0,_=0;const f=s.computeConfigForBounds(u),p=e.zoom/f.zoom;let x,y;return isNaN(r.cx)||isNaN(r.cy)?(r.cx=e.x,r.cy=e.y,x=f.x,y=f.y):(c+=(r.cx-e.x)*p,g+=(r.cy-e.y)*p,m=r.cx+c,_=r.cy+g,x=(e.x+c-m)*p+m,y=(e.y+g-_)*p+_),{offsetChanges:{name:"geo-to-graph",nodeAttributes:{x:b=>(n[a[b._index]].x+c-m)*p+m,y:b=>(n[a[b._index]].y+g-_)*p+_}},camera:ct({zoom:f.zoom,x,y,angle:0},e.getSize())}}var ob={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"},VP={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"},R_={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:void 0},jP=class extends Bt{onMounted(){this._brand=null}set(t,e){let{position:s,horizontalMargin:i,verticalMargin:n,className:r}=ct(ct({},R_),e);ob[s]||(s=R_.position),this.remove();const o=document.createElement("div");return o.innerHTML=t,o.style.position="absolute",ab(o,s,i,n),o.style.padding="0px 0px 0px 0px",o.style.zIndex="10",r&&o.setAttribute("class",r),this._brand=o,this._modules.dom.setLayer("brand",this._brand),o}remove(){this._modules.dom.setLayer("brand",null),this._brand=null}};function ab(t,e,s,i){const n=s===void 0?"":s+"px",r=i===void 0?"":i+"px";t.style[ob[e]]=n,t.style[VP[e]]=r}var O_={},HP=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._settings=ct({},an),this._edgesOriginalTextStyle={},this._nodesOriginalTextStyle={},this._nodeDraggingSetting=!1,this._transition=!1,this._attribution=null,this._updating=!1,this._updateRate=50,this._x=0,this._y=0,this._onCameraUpdate=t=>{if(this.L&&this._enabled&&this._map&&this._map._loaded){const e=this._x-this._modules.camera.x,s=this._y-this._modules.camera.y;(e||s)&&this._syncMapWithCamera()}},this._syncMapWithCamera=()=>{if(!this._map)return;this._updating||(this._updating=!0,this._layer.setLocked(!0),this._map._moveStart(!0,!1));const t=this._fromPointToLatLng(this._modules.camera.x,this._modules.camera.y),e=dd(this._modules.camera.zoom),s=this.L.latLng(t.latitude,t.longitude);this._map._move(s,e,{pinch:!0,round:!1}),clearTimeout(this._updateRequest),this._updateRequest=this._modules.dom.setTimeout(()=>{this._updating=!1,this._layer.setLocked(!1),this._map&&this._map._move(s,e,{pinch:!0})._moveEnd(!0)},this._updateRate)},this._onNodesDragStart=()=>{this._enabled&&(this._setMapDragging(!1),this._nodeDragOffsetX=this._nodeDragOffsetY=0)},this._onNodesDragged=({nodes:t,dx:e,dy:s})=>{if(this._enabled){const i=t.map(n=>{const{x:r,y:o}=n.getAttributes(["x","y"]);return this._fromPointToLatLng(r+e-this._nodeDragOffsetX,o+s-this._nodeDragOffsetY)});return this._nodeDragOffsetX=e,this._nodeDragOffsetY=s,t.setGeoCoordinates(i)}return Promise.resolve(this._modules.graph.nodeList())},this._onMapUpdate=()=>{if(!this._map)return Promise.resolve(void 0);const{lat:t,lng:e}=this._map.getCenter(),s=this._fromLatLngToPoint(t,e);this._x=s.x,this._y=s.y;const i=BA(this._map.getZoom());return this._modules.events.fire("beforeGeoCameraMove",{zoom:this._map.getZoom()}),this._modules.camera.setView({zoom:i,x:s.x,y:s.y},{ignoreZoomLimits:!0}).then(()=>this._adjustMinvisibleSizes())},this.runLayout=t=>xn(this,[t],function*({type:e,nodes:s,latitudePath:i=ti,longitudePath:n=ei,options:r,center:o}){const a=s1(o),l=a([o.longitude,o.latitude]),d=s.getPosition(),h=[];return s.setAttributes(s.map(u=>{const c=u.getData(i),g=u.getData(n);if(isNaN(c)||isNaN(g))return{x:l[0],y:l[1]};const m=a([g,c]);return{x:m[0],y:m[1]}})).then(()=>this._ogma.layouts[e]($t(ct({},r),{nodes:s,dryRun:!0}))).then(u=>{const c=u.positions.current,g=new Array(c.length),m=new Array(c.length);return c.forEach((_,f)=>{const p=a.invert([_.x,_.y]);g[f]=p[1],m[f]=p[0],h.push({latitude:p[1],longitude:p[0]})}),s.setData(i,g),s.setData(n,m),s.setAttributes(d)}).then(()=>this._ogma.modules.geo._updateNodesCoordinates(s)).then(()=>h)})}onMounted(){this._modules.events.register(["geoEnabled","beforeGeoDisabled","geoDisabled","geoNodesMoved","geoLoaded","geoReady"]),bg()&&(this.L=Os("L")||Os("leaflet"),this.L&&BP(this.L)),this._modules.graph.createNodeAttribute({name:"geo.prevLat",storage:"float"},!0),this._modules.graph.createNodeAttribute({name:od,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:ti,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:ei,storage:"float"},!0),this._modules.events.register(["beforeGeoCameraMove"]),this._modules.events.on("addNodes",t=>{t.virtual||this._refreshOrAddNodes(t.nodes,!0)}).on("updateNodeData",t=>{this._onDataChange(t.changes)}).on("nodesDragProgress",this._onNodesDragged).on(["nodesDragStart","lassoEnabled"],this._onNodesDragStart).on(["nodesDragEnd","lassoDisabled"],()=>this._setMapDragging(!0)).on("viewChanged",this._onCameraUpdate)}_onDataChange(t){const e=th(this.latitudePath),s=th(this.longitudePath),i=t.filter(({virtual:r,property:o,newValues:a})=>!(r||!a.length)&&(o&&typeof o!="string"?o.find(l=>e.startsWith(l)||s.startsWith(l)):o===null||e.startsWith(o)||s.startsWith(o)));if(!i.length)return;const n=KA(i);n&&(this._modules.events.fire("geoNodesMoved",{nodes:n}),this._refreshOrAddNodes(n,!1))}_refreshOrAddNodes(t,e){e&&this._updatePrevNodesCoordinates(t),this._updateNodesCoordinates(t),this._enabled&&(this._cacheOriginalTextStyles(t,null),this._filter.refresh())}_updatePrevNodesCoordinates(t){Xo(this._modules.graph,t,ti,ig),Xo(this._modules.graph,t,ei,od)}_restorePrevNodesCoordinates(t){Xo(this._modules.graph,t,ig,ti),Xo(this._modules.graph,t,od,ei)}_updateNodesCoordinates(t){qA(this._modules.graph,t,this._settings)}_createMapTileLayer(t,e){if(t&&!He(t))return t;const s=t,i=s.wms?this.L.tileLayer.wms:this.L.tileLayer,n=GA(s,e)||"";return i(s.url,ct({attribution:n},t))}_setupTileLayer(t,e,s){const i=this._createMapTileLayer(t,e);return i.once("load",()=>{this._modules.events.fire("geoLoaded")}),i.addTo(this._map),xg(i,s),i}_onSettingsChanged(t,e){const s=t.wrapCoordinates!==e.wrapCoordinates,i=t.latitudePath!==e.latitudePath||t.longitudePath!==e.longitudePath;if(s||i){let n=Promise.resolve();this._enabled&&this._filter&&(n=n.then(()=>this._filter.refresh())),n.then(()=>this._updateNodesCoordinates(this._modules.graph.getNodes("all")))}this._enabled&&(HA(t,e)&&this._map&&(this._map.removeLayer(this._tileLayer),this._tileLayer=this._setupTileLayer(e.tiles,e.attribution,e.opacity)),t.sizeRatio!==e.sizeRatio&&this._updateSizes(),t.maxZoomLevel!==e.maxZoomLevel&&this._modules.settings.update({minZoom:1,maxZoom:Math.pow(2,e.maxZoomLevel)}),t.disableNodeDragging!==e.disableNodeDragging&&this._setDragging(!e.disableNodeDragging),t.attributionOptions!==e.attributionOptions&&this._setAttributionOptions(e.attributionOptions,e.attribution),xg(this._tileLayer,e.opacity))}_setMapDragging(t){if(this._map){const e=t?"enable":"disable";this._map.dragging[e]()}}_fromLatLngToPoint(t,e){return this._map.options.crs.latLngToPoint(this.L.latLng(t,e),el)}_fromPointToLatLng(t,e){const{lat:s,lng:i}=this._map.options.crs.pointToLatLng(this.L.point({x:t,y:e}),el);return{latitude:s,longitude:i}}_updateSizes(){this._enabled&&this._projection&&this._projection.updateAll()}enable(t){return this.setEnabled(!0,t)}getMap(){return this._enabled?this._map:null}getOptions(){return this._enabled?$t(ct({},this._settings),{tiles:He(this._settings.tiles)?ct({},this._settings.tiles):this._settings.tiles}):ct({},an)}setOptions(t){if(!this._enabled||this._transition)return;VA(t,this.L);const e=this._settings;this._settings=$t(ct(ct(ct({},an),e),t),{tiles:jA(an,t)}),this._onSettingsChanged(e,this._settings)}disable(t){return this.setEnabled(!1,t)}isEnabled(){return this._enabled}toggle(t={}){return this.setEnabled(!this._enabled,t)}getContainerCoords(t){return t.getGeoCoordinates().map(({latitude:e,longitude:s})=>this._map.latLngToContainerPoint([e,s]))}getContainerCoord(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return this._map.latLngToContainerPoint([e||0,s||0])}setEnabled(t,e){if(!bg())throw new Error("Ogma Geo cannot be used outside a browser");if(!this.L)throw new Error("You are trying to use Geo mode but Leaflet has not been found. Please follow our migration guide: https://bit.ly/2SYkF8A");if(this._transition||t===this._enabled)return Promise.resolve();const s=this._modules.settings;this._enabled||(this._prevSettings=s.get(),this._nodeDraggingSetting=!!s.get("interactions.drag.enabled")),this._enabled=t,this.setOptions(e),this._transition=!0;const i=this._settings;return t?this._show().then(()=>(this._registerTextStyle(this._modules.graph.getNodes(),this._modules.graph.getEdges()),this._setDragging(!i.disableNodeDragging),this._transition=!1,this._updating=!1,this._modules.events.fire("geoEnabled").fire("geoReady"),this._adjustMinvisibleSizes())):this._restoreTextStyle().then(()=>this._hide()).then(()=>{this._transition=!1,this._modules.events.fire("geoDisabled"),this._setDragging(this._nodeDraggingSetting,!0)}).then(()=>this._ogma.view.afterNextFrame())}destroy(){return this._enabled&&this._destroyMapSync(),Promise.resolve()}_cacheOriginalTextStyles(t,e){e&&(this._edgesOriginalTextStyle=Eg(e,this._edgesOriginalTextStyle)),t&&(this._nodesOriginalTextStyle=QA(t,this._nodesOriginalTextStyle))}_registerTextStyle(t,e){this._cacheOriginalTextStyles(t,e);const{nodeAttributes:s,edgeAttributes:i}=this._modules.hover.getHoverClassDefinition();this._hoverEdgesOriginalTextStyle=i||null,this._hoverNodesOriginalTextStyle=s||null,this._modules.hover.updateEdgeAttributes({text:{size:n=>(this._edgesOriginalTextStyle[n.getId()]||O_)["text.size"]}}),this._modules.hover.updateNodeAttributes({text:{size:n=>(this._nodesOriginalTextStyle[n.getId()]||O_)["text.size"]}})}_restoreTextStyle(){return this._modules.hover.updateEdgeAttributes(this._hoverEdgesOriginalTextStyle,!0),this._modules.hover.updateNodeAttributes(this._hoverNodesOriginalTextStyle,!0),Promise.all([e1(this._modules.graph.getEdges(),this._edgesOriginalTextStyle)]).then(()=>(this._edgesOriginalTextStyle=Eg(this._modules.graph.edgeList(),{}),this._nodesOriginalTextStyle={},this._edgesOriginalTextStyle={},Promise.resolve()))}_setDragging(t,e=!1){this._modules.settings.update({interactions:{drag:{enabled:t,applyResult:e}}})}_setAttributionOptions(t,e){if(this._map){if(this._attribution&&(this._attribution.remove(),this._attribution=null),this._attribution=this.L.control.attribution({prefix:!1}).addTo(this._map),He(t)){this._attribution.setPrefix(""),t.position=t.position||"bottom-right";const s=t.position.replace("-","");this._attribution.setPosition(s);const i=this._attribution.getContainer();i&&(t.className&&this.L.DomUtil.addClass(i,t.className),ab(i,t.position||"bottom-right",t.horizontalMargin,t.verticalMargin))}e!=null&&this._attribution.addAttribution(e)}}_nodeIsVisible(t){return ZA(t,this._settings,this._hasCustomProjection())}_updateSettingsForMap(){const t=this._modules.graphics.getGraphicsEngine().parseColor(this._settings.backgroundColor);t[3]=0,this._modules.settings.update({backgroundColor:uy(t),minZoom:1e-6,interactions:{rotation:{enabled:!1},drag:{enabled:!1},pan:{enabled:!1},zoom:{enabled:!1,onDoubleClick:!1}},mouse:{wheelEnabled:!1}})}getGraphPosition(t){const e=this.L.latLngBounds(YA(t));return{center:t.size>0?e.getCenter():this.L.latLng([0,0]),zoom:this._clampZoom(this._map.getBoundsZoom(e))}}_initMap(){this._updateSettingsForMap(),this._mapContainer=XA(this._modules.dom.getContainer());const t=$t(ct({},rA),{minZoom:this._settings.minZoomLevel,maxZoom:this._settings.maxZoomLevel});this._hasCustomProjection()&&(t.crs=this._settings.crs,t.worldCopyJump=!1,t.maxBoundsViscosity=0),this._map=new this.L.Map(this._mapContainer,t),this._map.on("movestart zoomstart",()=>{this._updating=!0}).on("moveend zoomend",()=>{this._updating=!1}),this._setAttributionOptions(this._settings.attributionOptions,this._settings.attribution),this._setupLayers()}_clampZoom(t){let e=this._tileLayer.options.maxZoom;return e===void 0&&(e=1/0),Math.min(t,e)}_show(){let t;return this._initMap(),this._filter?t=this.filter.enable(0):(this._filter=this._modules.transformations.api.addNodeFilter({criteria:e=>this._nodeIsVisible(e)}),this._filter.setIndex(0),t=this._filter.whenApplied()),t.then(()=>{const e=this._map,s=this._modules.graph.getNodes(),i=this._modules.graph.getEdges(),{center:n,zoom:r}=this.getGraphPosition(s),{offset:o,newCameraView:a}=this._transformToGeo();return this._modules.camera.setView(a,{ignoreZoomLimits:!0}).then(()=>(this._updatePrevNodesCoordinates(s),e.setView(n,r,{animate:!1}),this._modules.graphics.animate({nodes:s,edges:i},()=>{this._projection=this._createFinalPositionLayer()},!0,this._settings.duration))).then(()=>o.destroy())})}updateProjection(){var t;(t=this._projection)==null||t.update()}_hasCustomProjection(){return this._settings.crs!=null}_setupLayers(){this._settings.tiles&&(this._tileLayer=this._setupTileLayer(this._settings.tiles,this._settings.attribution,this._settings.opacity)),this._layer=new this.L.OgmaOverlay({container:this._modules.graphics.getDomElement(),mapContainer:this._mapContainer,onUpdate:()=>this._onMapUpdate()}),this._layer.addTo(this._map)}_adjustMinvisibleSizes(){return Promise.all([t1(this._modules.graph.getEdges(),this._edgesOriginalTextStyle,this._map.getZoom())])}_hide(){if(!this._map)return Promise.resolve();this._modules.settings.update(this._prevSettings);const t=this._map;t.removeLayer(this._layer);const e=this._modules.dom.getContainer(),s=this._modules.graphics.getDomElement();e&&e.appendChild(s),t.getContainer().style.zIndex="0";const i=this._modules.graph.getNodes("all"),n=this._modules.graph.getEdges("all"),{offset:r,newCameraView:o}=this._transformToGraph();return this._modules.camera.setView(o||{}).then(()=>(this._modules.events.fire("beforeGeoDisabled"),Promise.all([bp(t.getContainer(),1,0,this._settings.duration/2).then(()=>this._destroyMapSync()),this._modules.graphics.animate({nodes:i,edges:n},()=>r&&r.destroy(),!0,this._settings.duration)]))).then(()=>(this._map=null,this._filter.disable(0).then(()=>{})))}_destroyMapSync(){if(this._map){this._layer&&this._layer._map&&this._map.removeLayer(this._layer),this._map.remove(),this._map._animatingZoom=!1,this._map=null;const t=this._mapContainer.parentNode;t&&t.removeChild(this._mapContainer)}}_transformToGeo(){const t=this._modules.graph.getNodes(),{offsetChanges:e,camera:s}=UP(t,this._modules.camera,this._modules.locate,(i,n)=>this._fromLatLngToPoint(i,n));return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}_addGraphAttributesLayer(t){return this._modules.graphics.addAttributeLayer(ct({priority:x1,nodeSelector:e=>e.isVisible(),edgeSelector:e=>e.isVisible()},t))}_transformToGraph(){const t=this._modules.graph.getNodes("all"),{offsetChanges:e,camera:s}=GP(t,this._modules.camera,this._modules.locate,()=>{this._projection&&(this._projection.destroy(),this._projection=null)});return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}getPointFromLatLng(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return e==null?t.getAttributes(["x","y"]):this._fromLatLngToPoint(e,s)}_createFinalPositionLayer(){return this._addGraphAttributesLayer({name:"graph-2-geo-animation",nodeAttributes:{scalingMethod:"fixed",radius:t=>Number(t.getAttribute("radius"))*this._settings.sizeRatio,x:t=>this.getPointFromLatLng(t).x,y:t=>this.getPointFromLatLng(t).y},edgeAttributes:{scalingMethod:"fixed",width:t=>Number(t.getAttribute("width"))*this._settings.sizeRatio}})}setCenter(t,e){return this._enabled?this.setView(t,e,dd(this._modules.camera.getZoom())):Promise.resolve()}setZoom(t){return this._enabled&&this._map?(t=this._clampZoom(t),this._map.setZoom(t),new Promise(e=>{const s=this._map;if(s.getZoom()===t)return e(void 0);s.once("moveend zoomend",e)}).then(this._onMapUpdate)):Promise.resolve()}zoomIn(){return this.setZoom(this.getZoom()+1)}zoomOut(){return this.setZoom(this.getZoom()-1)}setView(t,e,s){if(!this._enabled||!this._map)return Promise.resolve();const i=this._map;s=this._clampZoom(s);const n=this.L.latLng([t,e]);return i.setView(n,s,{animate:!1,reset:!0}),new Promise(r=>{if(i.getZoom()===s&&i.getCenter().equals(n))return r(void 0);i.once("moveend zoomend",r)}).then(this._onMapUpdate)}getView(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{zoom:this._map.getZoom(),latitude:t.lat,longitude:t.lng}}getCenter(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{latitude:t.lat,longitude:t.lng}}getZoom(){if(this._enabled&&this._map)return this._map.getZoom()}resetCoordinates(){if(!this._enabled||!this._projection)return;const t=this._modules.graph.getNodes();this._restorePrevNodesCoordinates(this._modules.graph.getNodes());const e=this._modules.graph.getNodeAttribute(ti).getMultiple(t._indexes),s=this._modules.graph.getNodeAttribute(ei).getMultiple(t._indexes);t.setData(this._settings.latitudePath,e),t.setData(this._settings.longitudePath,s),this._projection.update()}getUnprojectedCoordinates(t){this._projection&&this._projection.destroy();const e=t.getPosition();return this._projection=this._createFinalPositionLayer(),e}get latitudePath(){return this._settings.latitudePath}get longitudePath(){return this._settings.longitudePath}get filter(){return this._filter}exportBackground(t){if(!this._map)return Promise.reject("Map is not ready");const{pixelRatio:e,width:s,height:i,zoom:n,x:r,y:o}=t,a=s*e,l=i*e,d=ss(a,l),h=d.getContext("2d"),u=this._map;if(!h)throw new Error(`Unable to get 2d context from  ${d}`);const c=this.getView(),g=ct({zoom:Math.round(dd(n*e))},this._fromPointToLatLng(r,o)),m=new this.L.Canvas;u.addLayer(m);const{vectorMap:_,tileLayers:f,vectorLayers:p,imageOverlays:x,markers:y}=zP(this._layer,u,h,this.L,e,m),b=u.options.zoomSnap;return Promise.resolve().then(()=>(Sn(this._mapContainer,a+"px",l+"px"),u.invalidateSize({animate:!1}),this.setView(g.latitude,g.longitude,g.zoom))).then(()=>Jf([..._,...f,...x,...p,...y])).then(()=>{Sn(this._mapContainer,"100%","100%"),u.invalidateSize({animate:!1}),u.options.zoomSnap=b,this.setView(c.latitude,c.longitude,c.zoom)}).then(()=>new Promise(v=>this.L.Util.requestAnimFrame(v))).then(()=>u.removeLayer(m)).then(()=>d)}},WP=class extends Bt{constructor(){super(...arguments),this._context={edgesAlwaysCurvy:!1,directedEdges:!1}}onMounted(){this._attributeLayer=this._addAttributeLayer(),this._modules.settings.register("edgesAlwaysCurvy",!1,t=>{this._context.edgesAlwaysCurvy=t,this._attributeLayer.updateAll()}),this._modules.settings.register("directedEdges",!1,t=>{this._context.directedEdges=t,this._attributeLayer.updateAll()})}computeCurvature(t,e="visible",s){const{edgesAlwaysCurvy:i,directedEdges:n}=this._context,r=t.getSource()===t.getTarget();if(!i&&t.hasParallelEdges()===!1&&!r)return 0;let o=t.getParallelEdges({filter:e});s&&(o=o.filter(d=>s(d)));const a=o.indexOf(t);if(a===-1)return 0;let l;if(r)l=(a+1)*Math.max(+t.getAttribute("width")||0,1);else{const d=t.getSource(),h=o.size;if(h===1&&!i)return 0;if(n){let u=0;for(let c=0;c<a;++c)o.get(c).getSource()===d&&(u+=1);l=u+1}else{const u=d!==o.get(0).getSource();l=h%2!=1||i?(1+(a/2|0))*(a%2==0?1:-1)*(u?-1:1):a===0?0:((a+1)/2|0)*(a%2==0?1:-1)*(u?-1:1)}}return l}_addAttributeLayer(){return this._modules.graphics.addAttributeLayer({name:"curvature",priority:_1,edgeDependencies:{parallelEdges:!0},edgeContext:this._context,edgeAttributes:{curvature:t=>this.computeCurvature(t)}})}},lb="worker_start",db="worker_configure",Lc="worker_update",wn="worker_stop",hb=class extends Co{constructor(t,e){super(),this._complete=!1,this._destroyed=!1,this._data=null,this._onStart=Kt,this._onStop=Kt,this._setIdle=Kt,this._onPause=Kt,this.timer={start:0,steps:0},this._modules=e,this.configure(t)}configure({configure:t=Xs,update:e=Kt,context:s=Kt,stop:i=Kt,isRunning:n=$a,onStart:r=Kt,onStop:o=Kt,onPause:a=Kt,setIdle:l=Kt}){this._configure=t,this._update=e,this._createContext=s,this._isRunning=n,this._stop=i,this._onStart=r,this._onStop=o,this._setIdle=l,this._onPause=a}setData(t){this._data=t}getData(){return this._data}start(t){this._complete=!1,this._onStart(),this.fire(lb,{target:this});const e=this._configure(t,this._modules);return this.fire(db,e),this.send(e),this}stop(t){return this._complete||(this._onStop(),this.send({type:wn}),this._complete=!0),this}pause(){this._onPause()}setIdle(t){this._setIdle(t)}isBusy(){return!this._complete}destroy(){this._destroyed||(this._destroyed=!0,this._modules&&(this.stop(),delete this._modules))}},ub=/^function\s*\(/,cb=/^\(|^\w+\s?=>/;function Aa(t){const e=t.toString();return e.indexOf("function")===0||cb.test(e)?e:`function ${e}`}var XP=class extends hb{constructor(t,e){super(t,e);const s=Aa(this._createContext),i=Aa(this._update),n=Aa(this._isRunning),r=Aa(this._stop),o=`
      ${YP(t.imports)}
      const __CONTEXT = (${s})();
      const __UPDATE_FUNC = ${i} ;
      const __IS_RUNNING_FUNC = ${n};
      const __STOP_FN = ${r};
      let result;

      self.addEventListener("message", function (evt) {
        if (evt.data && evt.data.type === '${wn}') {
          __STOP_FN(__CONTEXT);
          return self.postMessage({ result, isRunning: false });
        }
        result = __UPDATE_FUNC(evt.data, __CONTEXT);
        const isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);

        self.postMessage({ result, isRunning });
      });
    `;this._worker=mx(o),this._worker.addEventListener("message",a=>{e.dom.isDestroyed()||this.onWorkerMessage(a)})}onWorkerMessage(t){const e=t.data.isRunning,s=t.data.result,i={data:void 0};return this.fire(Lc,{worker:this,workerMessage:s,modules:this._modules,data:i,isRunning:e}),e?this.send(i.data):(this.fire(wn,{worker:this,result:s,modules:this._modules}),this.stop(s))}destroy(){super.destroy(),this._worker.terminate()}send(t){return this._complete||this._worker.postMessage(gx(t)),this}};function YP(t={}){const e=Object.keys(t),s=[];for(let i=0,n=e.length;i<n;i++){const r=e[i],o=t[r];if(typeof o!="function")throw new Error(`Asynchronous worker: dependency "${r}" is not found`);{const a=$P(o);a?(s.push(z_(o,r)),a!==r&&s.push(`var ${r} = ${a};`)):s.push(`var ${r} = ${z_(o,r)};`)}}return s.join(`
`)}function z_(t,e){const s=t.toString();return ub.test(s)?`function ${t.name||e} ${s.substring(s.indexOf("("))}`:cb.test(s)?`const ${t.name||e} = ${s.toString()}`:s}function $P(t){const e=t.toString();return t.name?t.name:ub.test(e)?null:e.substring(9,e.indexOf("(")).trim()}var qP=class extends hb{constructor(t,e){super(t,e),this._context=this._createContext()}sync(t){if(t&&t.type===wn)return this._stop(this._context);const e=this._update(t,this._context),s=this._isRunning(this._context,t),i={data:void 0};return this.fire(Lc,{worker:this,workerMessage:e,modules:this._modules,data:i,isRunning:s}),s?this.send(i.data):(this.fire(wn,{worker:this,result:e,modules:this._modules}),this.stop(e))}send(t){return this._complete||this._modules.dom.setTimeout(()=>this.sync(t),0),this}},ZP=class extends Bt{constructor(){super(...arguments),this._pool={}}create(t,e){const s=e&&cx,i=this._modules,n=`${t.name||"worker"}-${s?"async":"sync"}`;let r=this._pool[n];r||(r=this._pool[n]=[]);let o=r.find(a=>!a.isBusy());return o?o.configure(t):(o=s?new XP(t,i):new qP(t,i),this._pool[n].push(o)),o.on(wn,()=>{o.clearEvents(),this._pool[n].length<2||(o.destroy(),this._pool[n]=this._pool[n].filter(a=>a!==o))}),o}start(t,e){return t.start(e)}run(t,e,s){const i=this.create(t,s);return this.start(i,e)}destroy(){for(const t in this._pool)this._pool[t].forEach(e=>e.destroy()),delete this._pool[t]}},JP=16,du="cubicOut",Sa={duration:300,easing:du,skipTextDrawing:!0,useWebWorker:!0,locate:!1},KP=class extends Bt{constructor(){super(...arguments),this._running=[],this._textsHidden=!1,this.onInteractionStart=()=>{this.setWorkersIdle(!0)},this.onViewChanged=()=>{this.setWorkersIdle(!1)},this.onVisibilityChange=()=>{Ai().hidden?this.setWorkersIdle(!0):this.setWorkersIdle(!1)},this._onWorkerUpdate=(t,e,s,i,n,r)=>{const{duration:o,onSync:a,onUpdate:l,dryRun:d,locate:h}=r;if(a&&this._modules.dom.setTimeout(()=>a(s,this._modules,i),o),n){const u=n(s,this._modules,i);this._modules.events.fire("layoutComputed",{type:"layoutComputed",name:e,positions:u}),l&&l(s,u,i);const c=this._assignNodePositions(u,o,d,r.easing);i||(h&&u&&this._animateCamera(u,h,r.duration),c.then(()=>t.fire("taskComplete",u)))}else i||t.fire("taskComplete",s)},this._onWorkerComplete=(t,e,s,i,n,r,o)=>{for(let u=0;u<this._running.length;u++)if(this._running[u]===t){this._running.splice(u,1);break}i.onStop&&e&&i.onStop(n,e,this._modules);const a=this._modules.graph.nodeList(new Uint32Array(o.indexes)),l=n.dryRun&&e?s:this.collectNodesData(a),d=a.getId(),h={before:Ud(o),current:Ud(l)};this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:h,ids:d}),this._modules.dom.setTimeout(()=>{n.onEnd&&n.onEnd(e),n.skipTextDrawing&&this._textsHidden&&(this._modules.graphics.showTexts(),this._textsHidden=!1),r({name:i.name,positions:h,ids:d})})},this._onWorkerStart=(t,e,s)=>{e.skipTextDrawing&&!this._textsHidden&&(this._modules.graphics.hideTexts(),this._textsHidden=!0);const i=this._modules.graph.getNodes(e.nodes),n=this.collectNodesData(i),r=n.ids;s.setData(n),this._modules.events.fire("layoutStart",{type:"layoutStart",name:t.name,ids:r,worker:s})}}onMounted(){this._layouts={},this.timers=new Map,this._modules.events.register(["layoutGetData","layoutPrepare","layoutStart","layoutEnd","layoutComputed"]),this._modules.events.on("clearGraph",()=>this.stop()).on(["dragStart","zoomStart"],this.onInteractionStart).on(["dragEnd","viewChanged"],this.onViewChanged),this._modules.dom.addDocumentEventListener("visibilitychange",this.onVisibilityChange)}setWorkersIdle(t){this._running.forEach(e=>e.setIdle(t))}register(t){if(this._layouts[t.name])throw new Error(`Layout ${t.name} already exists`);this._layouts[t.name]=t}getAvailableLayouts(){return Object.keys(this._layouts)}start(t,e={}){const s=this._layouts[t];this._modules.events.fire("layoutPrepare",{name:t,params:e});const i=$0(this._modules.graph,e,["radial","grid"].indexOf(t)===-1);return new Promise(n=>{if(!s)throw new Error(`layout ${t} does not exist`);i.duration=typeof i.duration=="number"?i.duration:Sa.duration;const r=s.onSync;i.skipTextDrawing=i.skipTextDrawing===void 0?!!Sa.skipTextDrawing:!!i.skipTextDrawing;let o=i.locate||Sa.locate;o&&typeof o=="boolean"&&(o={}),i.locate=o;const a={name:t,update:s.update,isRunning:s.isRunning,configure:s.configure,context:s.context,imports:s.imports,stop:s.stop,setIdle:s.setIdle};this._modules.graphics.forceAttributesComputation();const l=i.useWebWorker===void 0?!!Sa.useWebWorker:!!i.useWebWorker,d=this._modules.workers.create(a,l);d.on(lb,()=>{s.onStart&&s.onStart(e),this._onWorkerStart(s,i,d)}).on(db,h=>{this._modules.events.fire("layoutGetData",{name:t,data:h})}).on(Lc,({workerMessage:h,isRunning:u})=>{const c=h.lastUpdate||-1/0,g=ls();u&&(!i.continuous||g-c<JP)||(h.lastUpdate=g,this._onWorkerUpdate(d,t,h,u,r,i))}).on(wn,({result:h})=>{d.once("taskComplete",u=>{this._onWorkerComplete(d,h,u,s,i,n,d.getData())})}),this._modules.workers.start(d,i),this._running.push(d)})}_animateCamera(t,e,s){if(t.indexes.length===0)return Promise.resolve();const i=this._modules.locate.layoutDataBoundingBox(t),n=this._modules.locate.computeConfigForBounds(i,e);return this._modules.camera.setView(n,{duration:s,easing:e.easing||du,ignoreZoomLimits:!0})}stop(){for(;this._running.length!==0;){const t=this._running.pop();t.stop(),t.fire("taskComplete",null)}return Promise.resolve()}isRunning(){return this._running.length!==0}_assignNodePositions(t,e,s,i=du){if(!t||s){const d=t?new Uint32Array(t.indexes):void 0,h=this._modules.graph.nodeList(d);return Promise.resolve(h)}const{indexes:n,x:r,y:o}=t,a=this._modules.graph.nodeList(new Uint32Array(n)),l=Ud(t);for(let d=0;d<l.length;d++)l[d]={x:r[d],y:o[d]};return a.setAttributes(l,{duration:e,easing:i})}collectNodesData(t){const e=t._indexes,s=this._modules.graph.getNodeAttribute("x").getMultiple(e),i=this._modules.graph.getNodeAttribute("y").getMultiple(e);return{ids:t.getId(),indexes:e,x:s,y:i}}};function Ud({x:t,y:e,indexes:s}){const i=s.length,n=new Array(i);for(let r=0;r<i;r++)n[r]={x:t[r],y:e[r]};return n}function B_(t){return typeof t=="number"&&isNaN(t)}var U_=class{constructor(){this._keys=[],this._values=[]}set(t,e){const s=this._getIndex(t);return s===-1?(this._keys.push(t.slice()),this._values.push(e),!0):(this._values[s]=e,!1)}get(t){const e=this._getIndex(t);return e===-1?void 0:this._values[e]}has(t){return this._getIndex(t)!==-1}delete(t){const e=this._getIndex(t);return e!==-1&&(this._keys.splice(e,1),this._values.splice(e,1),!0)}keys(){return this._keys.map(t=>t.slice())}values(){return this._values.slice()}_getIndex(t){for(let e=0;e<this._keys.length;e++){const s=this._keys[e];if(s.length===t.length){let i=!0;for(let n=0;n<t.length;n++){const r=s[n],o=t[n];if(!(r===o||B_(r)&&B_(o))){i=!1;break}}if(i)return e}}return-1}get size(){return this._keys.length}},QP=class{constructor(){this._map=new Map,this._arrays=new U_}clear(){return this._arrays=new U_,this._map.clear()}delete(t){return es(t)?this._arrays.delete(t):this._map.delete(t)}get(t){return es(t)?this._arrays.get(t):this._map.get(t)}set(t,e){return es(t)?this._arrays.set(t,e):this._map.set(t,e),this}keys(){return[...cy(this._map),...this._arrays.keys()]}values(){return[...gy(this._map),...this._arrays.values()]}get size(){return this._map.size+this._arrays.size}};function Jl(t){return typeof t=="number"&&isFinite(t)}var tF=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s||[],this._filter=i,this._unwindArrays=n,this._onUpdateHandlers=[],this._triggerUpdate=r=>{for(let o=0;o<this._onUpdateHandlers.length;++o)this._onUpdateHandlers[o](r)},this._info=t.watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}onUpdate(t){this._onUpdateHandlers.push(t)}getPropertyInfo(){return this._info}getPath(){return this._path.slice()}destroy(){this._module.unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}},eF=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s,this._filter=i,this._unwindArrays=n,this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[]}get path(){return this._path}onPropertyAdded(t){return this._onAddHandlers.push(t),this}onPropertyRemoved(t){return this._onRemoveHandlers.push(t),this}onPropertyUpdated(t){return this._onUpdateHandlers.push(t),this}getPath(){return this._path.slice()}getProperties(){return this._propertyList.slice()}getPropertyInfo(t){const e=this._properties[t];return e?e.info:null}destroy(){ii(this._properties,({handler:e},s)=>{const i=this._path.concat([s]);this._module.unwatchPropertyInformation(this._isNode,i,e,this._filter,this._unwindArrays)}),this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[];const t=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(t,1)}updateSubPropertiesToWatch(t,e){if(t!==this._isNode)return;const s=e.getData(this._path);for(let i=0;i<s.length;i++){const n=s[i];if(vn(n)){const r=Object.keys(n);for(let o=0;o<r.length;o++)this._addSubPropertyToWatch(r[o])}}}_addSubPropertyToWatch(t){if(!this._properties[t]){const e=this._path.concat([t]),s=()=>this._triggerPropertyUpdate(t),i=this._unwindArrays,n=this._isNode,r=this._filter,o=this._module.watchPropertyInformation(n,e,s,r,i);this._properties[t]={handler:s,info:o},this._triggerPropertyUpdate(t)}}_triggerPropertyUpdate(t){const{info:e}=this._properties[t],s=this._propertyList.indexOf(t),i=s!==-1,n=e.getType()!=="undefined";!i&&n?(this._propertyList.push(t),this._triggerHandlers("_onAddHandlers",t,e),this._triggerHandlers("_onUpdateHandlers",t,e)):i&&!n?(this._propertyList.splice(s,1),this._triggerHandlers("_onUpdateHandlers",t,e),this._triggerHandlers("_onRemoveHandlers",t,e)):i&&n&&this._triggerHandlers("_onUpdateHandlers",t,e)}_triggerHandlers(t,e,s){const i=this[t];for(let n=0,r=i.length;n<r;n++)i[n](e,s)}},sF=class{constructor(){}setWatcher(t){this._watcher=t}isNode(){return this._watcher.isNode}getPath(){return this._watcher.property.slice()}getBoundaries(){const t=this._watcher.boundaries;return t?{min:t.min,max:t.max}:null}getValues(){return this._watcher.values.keys()}getValueCount(t){return this._watcher.values.get(t)||0}getCount(){return this._watcher.total}getType(){return this._watcher.any>0?"any":this._watcher.numbers>0?"number":"undefined"}},iF=class extends Bt{constructor(){super(...arguments),this._onExcludedStateChange=({elements:t,value:e})=>{const s=!e;for(let i=0,n=this._propertyWatchers.length;i<n;i++){const r=this._propertyWatchers[i];r.isNode===t.isNode&&r.filter==="visible"&&(s?Xr(r,t.getData(r.property)):Wa(r,t.getData(r.property)),wa(r))}},this._onDataChange=({isNode:t,changes:e})=>{for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.property,r=i.filter==="all";if(i.isNode===t)for(let o=0;o<e.length;++o){const a=e[o],l=oF(a.property||[],n);if(l){const d=a.nodes||a.edges,h=[],u=[];if(d)for(let c=0;c<d.size;++c){const g=d.get(c);(r||g.isVisible())&&(h.push(Me(a.newValues[c],l)),u.push(Me(a.previousValues[c],l)))}h.length&&(Xr(i,h),Wa(i,u),wa(i))}}}for(let s=0,i=this._objectPropertyWatchers.length;s<i;s++){const n=this._objectPropertyWatchers[s],r=n.path;for(let o=0;o<e.length;++o){const{property:a,nodes:l,edges:d}=e[o],h=l||d;if(h){const u=h.isNode;(!a||a.length<=r.length+1&&r.every((c,g)=>c===a[g]))&&n.updateSubPropertiesToWatch(u,h)}}}},this._onElementsAdded=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s];if(i.isNode===e.isNode){const n=e.getData(i.property);n.length&&(Xr(i,n),wa(i))}}for(let s=0;s<this._objectPropertyWatchers.length;s++)this._objectPropertyWatchers[s].updateSubPropertiesToWatch(e.isNode,e)},this._onElementsRemoved=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.filter==="all";if(i.isNode===e.isNode&&n){const r=e.getData(i.property);r.length&&(Wa(i,r),wa(i))}}},this._onGraphClear=()=>{this._propertyWatchers.forEach(t=>{t.numbers=0,t.any=0,t.total=0,t.boundaries=null,t.values.clear()})}}onMounted(){this._propertyWatchers=[],this._objectPropertyWatchers=[],this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on(["updateNodeData","updateEdgeData"],this._onDataChange).on(["addNodes","addEdges"],this._onElementsAdded).on(["removeNodes","removeEdges"],this._onElementsRemoved).on("clearGraph",this._onGraphClear)}watchNodeObjectProperty(t){return this._watchObjectProperty(!0,Ta(t))}watchEdgeObjectProperty(t){return this._watchObjectProperty(!1,Ta(t))}watchNodeNonObjectProperty(t){return this._watchNonObjectProperty(!0,Ta(t))}watchEdgeNonObjectProperty(t){return this._watchNonObjectProperty(!1,Ta(t))}watchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n)||this._createWatcher(t,e,i,n);return s&&r.onChange.push(s),r.info}unwatchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n);if(!r)return;const o=r.onChange,a=o.indexOf(s);if(a!==-1&&(o.splice(a,1),o.length===0)){const l=this._propertyWatchers.indexOf(r);this._propertyWatchers.splice(l,1)}}_watchObjectProperty(t,e){const s=new eF(this,t,e);return this._objectPropertyWatchers.push(s),s.updateSubPropertiesToWatch(t,this._modules.graph[t?"getNodes":"getEdges"](e.filter)),s}_watchNonObjectProperty(t,e){return new tF(this,t,e)}_findWatcher(t,e,s,i){for(let n=0;n<this._propertyWatchers.length;++n){const r=this._propertyWatchers[n];if(r.isNode===t&&r.filter===s&&r.unwindArrays===i&&rF(r.property,e))return r}return null}_createWatcher(t,e,s,i){const n={isNode:t,property:e,numbers:0,any:0,total:0,values:new QP,boundaries:null,onChange:[],filter:s,unwindArrays:i,info:new sF};return n.info.setWatcher(n),Xr(n,this._modules.graph[t?"getNodes":"getEdges"](s).getData(e)),this._propertyWatchers.push(n),n}};function G_(t){return t==null?[]:bn(t)}function nF(t){return t==="all"?"all":"visible"}function wa(t){for(let e=0;e<t.onChange.length;++e)t.onChange[e](t.info)}function rF(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}function oF(t,e){if(t.length>e.length)return null;let s=0;for(;s<t.length;++s)if(t[s]!==e[s])return null;return e.slice(s)}function Xr(t,e,s){const i=t.values,n=!s&&t.unwindArrays;for(let r=0;r<e.length;++r){const o=e[r];if(s||o===void 0||(t.total+=1),n&&Array.isArray(o))Xr(t,o,!0);else{const a=i.get(o);a?i.set(o,a+1):(i.set(o,1),Jl(o)?(t.boundaries?o<t.boundaries.min?t.boundaries.min=o:o>t.boundaries.max&&(t.boundaries.max=o):t.boundaries={min:o,max:o},t.numbers+=1):o!==void 0&&(t.any+=1))}}}function Wa(t,e,s){const i=t.values,n=!s&&t.unwindArrays,r=t.boundaries;let o=!1;for(let a=0;a<e.length;++a){const l=e[a];if(s||l===void 0||(t.total-=1),n&&Array.isArray(l))o=o||Wa(t,l,!0);else{const d=i.get(l);d>1?i.set(l,d-1):(i.delete(l),Jl(l)?(t.numbers-=1,!r||r.min!==l&&r.max!==l||(o=!0)):l!==void 0&&(t.any-=1))}}return!s&&o&&(t.boundaries=aF(i.keys())),o}function aF(t){let e=null,s=null;for(let i=0;i<t.length;++i){const n=t[i];Jl(n)&&((e==null||n<e)&&(e=n),(s==null||n>s)&&(s=n))}return e==null||s==null?null:{min:e,max:s}}function Ta(t){return typeof t!="object"||t===null||Array.isArray(t)?{path:G_(t),filter:"visible",unwindArrays:!1}:{path:G_(t.path),filter:nF(t.filter||"visible"),unwindArrays:!!t.unwindArrays}}var lF=class extends Bt{onMounted(){this._modules.events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])}get x(){return this._modules.position.x||0}get y(){return this._modules.position.y||0}_later(){return this._modules.dom.afterNextFrame()}move({x:t,y:e}){if(t!==void 0&&e!==void 0){const s=t-this.x,i=e-this.y;this._modules.events.fire("virtualMove",{x:t,y:e,dx:s,dy:i})}return Promise.resolve()}down({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDown",{x:this.x,y:this.y,button:s}),this._modules.events.fire("virtualMove",{x:this.x,y:this.y,dx:0,dy:0,button:s})})}up({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualUp",{x:t,y:e,button:s})})}click({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}rightClick({x:t,y:e,button:s="right"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}doubleclick({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDoubleClick",{x:t,y:e,button:s})})}drag(t,e){return this.down(t).then(()=>this.move(e)).then(()=>this.up(e))}wheel({x:t,y:e,dx:s,dy:i,delta:n,metaKey:r,ctrlKey:o}){return this.move({x:t,y:e}).then(()=>(this._modules.events.fire("virtualWheel",{x:t,y:e,dx:s,dy:i,delta:n,domEvent:{metaKey:r,ctrlKey:o}}),this._later()))}};function Ps(t,e,s,i,n,r){const o=Ss(),a=r.graphToScreenCoordinates(t),l=r.graphToScreenCoordinates(e);n.beginPath(),n.moveTo(a.x*o,a.y*o),n.lineTo(l.x*o,l.y*o),n.strokeStyle=i,n.lineWidth=s,n.stroke()}function V_(t,e,s,i){let n,r,o,a=0,l=t.length-1;for(;a<l&&a>-1;)if(n=(a+l)/2|0,r=Math.abs(e[t[n]]-s),o=Math.abs(e[t[n+1]]-s),o<r)a=n+1;else if(o>r)l=n;else{const d=Math.abs(e[t[a]]-s),h=Math.abs(e[t[l]]-s);if(d<h)l=n;else{if(!(d>h))return l;a=n+1}}return i?l:t[l]}function j_(t,e,s,i,n,r,o){let a,l,d,h,u,c;for(let g=0,m=t.length;g<m;g++)for(let _=0;_<m;_++){if(g===_)continue;let f=t[g],p=t[_];_<g&&(h=p,p=f,f=h);const x=e[f],y=e[p],b=r.get(f),v=r.get(p);if(x+b<i-n&&y-v>i+n&&Math.abs(Math.abs(x+b-(i-n))-Math.abs(y-v-(i+n)))<=o)return a=f,l=s,d=p,c=x+b+Math.abs(y-v-(x+b))/2,u=[x+b,c-n,c+n,y-v],{a,b:l,c:d,current:s,target:c,points:u};if(x+b<i-n&&y+v<i-n&&Math.abs(Math.abs(x+b-(y-v))-Math.abs(Math.max(x+b,y+v)-(i-n)))<=o)return a=f,l=p,d=s,c=y+b+Math.abs(Math.abs(x+b-(y-v)))+n,u=[x+b,y-v,y+v,c-n],{a,b:l,c:d,current:s,target:c,points:u};if(x-b>i+n&&y-v>i+n&&Math.abs(Math.abs(x+b-(y-v))-Math.abs(Math.min(x-b,y-v)-(i+n)))<=o)return a=s,l=f,d=p,c=x-b-Math.abs(Math.abs(x+b-(y-v)))-n,u=[c+n,x-b,x+b,y-v],{a,b:l,c:d,current:s,target:c,points:u}}return null}var Gd={enabled:!1,tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:!0,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:!0,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}},dF=class extends Bt{constructor(){super(...arguments),this._options=Pe(Gd),this._enabled=!1,this._ysnap=0,this._xsnap=0,this._node=null,this._nodes=null,this._r=0,this._vguideline={start:{x:0,y:0},end:{x:0,y:0}},this._hguideline={start:{x:0,y:0},end:{x:0,y:0}},this._gridResolution=0,this._onNodeDragStart=({nodes:t})=>{t.size===1&&(this._node=t.get(0),this._cacheViewportData(),this._r=Number(this._node.getAttribute("radius")))},this._onNodeDragEnd=()=>{this._node=null,this._layer.refresh()}}onMounted(){this._options=Pe(Gd),this._enabled=!1}enable(t){this._enabled||(this._options=Is(t,Gd),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(e=>{e.clearRect(0,0,e.canvas.width,e.canvas.height)},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._modules.events.on("nodesDragStart",this._onNodeDragStart).on("nodesDragEnd",this._onNodeDragEnd),this._modules.settings.update({"interactions.drag.onBeforeDrag":(e,s,i,n)=>this._onBeforeDrag(s,i,n)}))}disable(){this._enabled&&(this._modules.events.off(this._onNodeDragStart).off(this._onNodeDragEnd),this._layer.destroy(),this._modules.settings.update({"interactions.drag.onBeforeDrag":null}),this._enabled=!1)}enabled(){return this._enabled}_onBeforeDrag(t,e,s){if(this._node){const i=s[0];this._layer.refresh(n=>{this._scan(n,i)}),this._node.setAttributes(i)}}_cacheViewportData(){const t=this._modules.camera,e=t.screenToGraphCoordinates({x:0,y:0}),s=t.screenToGraphCoordinates({x:t.width,y:t.height});if(this._nodes=this._modules.spatial.getNodesByBoundingBox(e.x,e.y,s.x,s.y),this._node==null)return;const i=this._node._index,n=Array.from(this._nodes._indexes);n.splice(n.indexOf(i),1);const r=this._modules.graph.getNodeAttribute("radius"),o=this._modules.graph.getNodeAttribute("x"),a=this._modules.graph.getNodeAttribute("y"),l=o.buffer(),d=a.buffer(),h=Pr(n.slice(),o),u=Pr(n.slice(),a),c={},g={};this._gridResolution=Number(this._node.getAttribute("radius"));const m=this._gridResolution;for(let _=0,f=n.length;_<f;_++){const p=h[_],x=u[_],y=l[p]/m|0,b=d[x]/m|0;c[y]||(c[y]=[]),g[b]||(g[b]=[]),c[y].push(p),g[b].push(x)}this._nodesByX=h,this._nodesByY=u,this._xGrid=c,this._yGrid=g,this._xList=o,this._yList=a,this._X=l,this._Y=d,this._R=r}_scan(t,e){if(this._node==null)return;const s=this._node._index,i=e.x,n=e.y,r=this._r,o=this._options,a=this._xList,l=this._yList,d=this._R,h=this._X,u=this._Y,c=this._modules.camera.zoom,g=Math.min(r,this._options.tolerance/c),m=2*r*o.sideSnapDistanceFactor,_=o.guidelineWidth,f=o.guidelineColor;let p,x,y,b,v,E,A,S,T=s,L=s,I=null,R=!1,z=!1;if(T=V_(this._nodesByX,h,i),L=V_(this._nodesByY,u,n),Math.abs(h[T]-i)>o.centerSnapDistance&&(T=s),Math.abs(u[L]-n)>o.centerSnapDistance&&(L=s),this._xsnap=0,T!==s){p=this._vguideline.start,x=this._vguideline.end,S=T,y=h[S],b=u[S],I=d.get(S),A=Math.abs(i-y);const j=Math.abs(i-r-(y-I)),C=Math.abs(i+r-(y+I));if(A<Math.max(r,I)){b<n?(p.y=b-I,x.y=n+r):(p.y=b+I,x.y=n-r);const w=Math.min(j,A,C);w===A?(p.x=x.x=y,x.y=n,p.y=b,this._xsnap=1):Math.abs(n-b)<I+r+m&&(w===j?(p.x=x.x=y-I,this._xsnap=2):(p.x=x.x=y+I,this._xsnap=3)),w<g&&(R=!0)}this._xsnap!==0&&Ps(p,x,_,f,t,this._modules.camera)}if(this._ysnap=0,L!==s){p=this._hguideline.start,x=this._hguideline.end,S=L,y=h[S],b=u[S],I=d.get(S),A=Math.abs(n-b);const j=Math.abs(n-r-(b-I)),C=Math.abs(n+r-(b+I));if(A<Math.max(r,I)){y<i?(p.x=y-I,x.x=i+r):(p.x=y+I,x.x=i-r);const w=Math.min(j,A,C);w===A?(p.y=x.y=b,x.x=i,p.x=y,this._ysnap=1):Math.abs(i-y)<I+r+m&&(w===j?(p.y=x.y=b-I,this._ysnap=4):(p.y=x.y=b+I,this._ysnap=5)),w<g&&(z=!0)}this._ysnap!==0&&Ps(p,x,_,f,t,this._modules.camera)}if(I!=null&&o.preferredDistance.enabled){const j=o.preferredDistance.ratio,C=Math.min(o.preferredDistance.tolerance/c,r),w=Math.max(r,I);if(T===s||this._xsnap!==0&&R){if(L!==s&&(this._ysnap===0||!z)&&(S=L,y=h[S],b=u[S],I=d.get(S),E=Math.abs(n-b)-(r+I)*(1+j),E<=C&&E>=-C)){const H=n<b?-1:1;p=this._hguideline.start,x=this._hguideline.end,p.x=y-w,x.x=y+w,p.y=x.y=b,Ps(p,x,_,f,t,this._modules.camera),p.x=i-w,x.x=i+w,p.y=x.y=b+H*(1+j)*(r+I),Ps(p,x,_,f,t,this._modules.camera),this._ysnap=1,z=!0}}else if(S=T,y=h[S],b=u[S],I=d.get(S),v=Math.abs(i-y)-(r+I)*(1+j),v<=C&&v>=-C){const H=i<y?-1:1;p=this._vguideline.start,x=this._vguideline.end,p.x=x.x=y+H*(1+j)*(r+I),p.y=b-w,x.y=b+w,p.x=x.x=y,Ps(p,x,_,f,t,this._modules.camera),p.y=n-w,x.y=n+w,p.x=x.x=y+H*(1+j)*(r+I),Ps(p,x,_,f,t,this._modules.camera),this._xsnap=1,R=!0}}if(o.neighbours.enabled){const j=this._gridResolution,C=i/j|0,w=n/j|0,H=this._xGrid,K=this._yGrid,it=[],xt=[].concat(K[w-1]||it,K[w]||it,K[w+1]||it),at=[].concat(H[C-1]||it,H[C]||it,H[C+1]||it);let Tt;xt.length>1&&(Pr(xt,a),Tt=j_(xt,h,s,i,r,d,g),Tt&&(this._drawNeighbourGuidelines(t,Tt,e,!1),R=!1)),at.length>1&&!Tt&&(Pr(at,l),Tt=j_(at,u,s,n,r,d,g),Tt&&(this._drawNeighbourGuidelines(t,Tt,e,!0),z=!1))}(R||z)&&this._snap(e,!R,!z)}_drawNeighbourGuidelines(t,{a:e,b:s,c:i,points:n,target:r},o,a){const l={x:0,y:0},d={x:0,y:0},h=this._R,u=this._X,c=this._Y;let[g,m,_]=h.getMultiple([e,s,i]);const{offset:f,lineWidth:p,lineColor:x}=this._options.neighbours;let y,b;a?(o.y=r,g=-g,m=-m,_=-_,y=d.x=l.x=Math.min(u[e]+g,u[s]+m,u[i]+_)-f,b=u):(o.x=r,y=d.y=l.y=Math.max(c[e]+g,c[s]+m,c[i]+_)+f,b=c);const v=a?"y":"x",E=a?"x":"y";l[v]=n[0],d[v]=n[1],Ps(l,d,p,x,t,this._modules.camera),l[v]=n[2],d[v]=n[3],Ps(l,d,p,x,t,this._modules.camera),l[v]=n[0],l[E]=y-f/2,d[v]=n[0],l[E]=b[e]+g,Ps(l,d,p,x,t,this._modules.camera),l[v]=n[1],l[E]=y-f/2,d[v]=n[1],l[E]=b[s]+m,Ps(l,d,p,x,t,this._modules.camera),l[v]=n[2],l[E]=y-f/2,d[v]=n[2],l[E]=b[s]+m,Ps(l,d,p,x,t,this._modules.camera),l[v]=n[3],l[E]=y-f/2,d[v]=n[3],l[E]=b[i]+_,Ps(l,d,p,x,t,this._modules.camera)}_snap(t,e,s){const i=this._xsnap,n=this._ysnap;let r;e||i===0||(r=this._vguideline.end,t.x=i===2?r.x+this._r:i===3?r.x-this._r:r.x),s||n===0||(r=this._hguideline.end,t.y=n===4?r.y+this._r:n===5?r.y-this._r:r.y)}},hF=class{constructor(t,e,s){this._module=t,this._id=e,this._whenApplied=s.then(()=>this)}getId(){return this._id}whenApplied(){return this._whenApplied}refresh(){return this._module.refreshRule(this._id)}getIndex(){return this._module.getRuleIndex(this._id)}setIndex(t){return this._module.setRuleIndex(this._id,t)}update(t){return this._module.updateRule(this._id,t)}getDefinition(){return this._module.getRuleDefinition(this._id)}destroy(){return this._module.destroyRule(this._id)}},uF=1e3,cF=1/uF,gF=class extends Bt{constructor(){super(...arguments),this._idCounter=1,this._rules=[]}onMounted(){this._rules=[],this._modules.events.register(["addStyleRule","removeStyleRule","updateStyleRule","refreshStyleRule"])}_get(t){for(let e=0;e<this._rules.length;++e){const s=this._rules[e];if(s.id===t)return s.index=e,s}throw new Error("calling a method on a destroyed style rule")}_updatePriorities(){for(let t=0;t<this._rules.length;++t){const e=this._rules[t],s=f1+t*cF;e.attributeLayer.update({priority:s})}}addRule(t={}){const e=this._idCounter++,s=this._modules.graphics.addAttributeLayer(ct({name:`rule(${e})`},H_(t))),i=this._modules.dom.afterNextFrame(),n=new hF(this,e,i),r={id:e,attributeLayer:s,wrapper:n};return this._rules.push(r),this._updatePriorities(),this._modules.events.fire("addStyleRule",{rule:r,options:t,id:r.id}),n}getRuleIndex(t){const e=this._get(t);return e.index==null?null:e.index}setRuleIndex(t,e){const s=this._get(t),i=zs(e,0,this._rules.length-1);return this._rules.splice(s.index,1),this._rules.splice(i,0,s),this._updatePriorities(),this._modules.dom.afterNextFrame()}updateRule(t,e){const s=this._get(t),i=Object.assign({fullOverwrite:e.fullOverwrite},e);return s.attributeLayer.update(i),this._modules.events.fire("updateStyleRule",{rule:s,options:e}),this._modules.dom.afterNextFrame()}getRuleDefinition(t){return H_(this._get(t).attributeLayer.getDefinition())}destroyRule(t){const e=this._get(t);return this._modules.events.fire("removeStyleRule",{rule:e,id:e.id}),e.attributeLayer.destroy(),this._rules.splice(e.index,1),this._modules.dom.afterNextFrame()}refreshRule(t){const e=this._get(t);return e.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:e,id:t}),this._modules.dom.afterNextFrame()}refreshAllRules(){for(const t of this._rules)t.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:t,id:t.id});return this._modules.dom.afterNextFrame()}getRuleList(){return this._rules.map(t=>t.wrapper)}};function H_(t){return{nodeAttributes:t.nodeAttributes,edgeAttributes:t.edgeAttributes,nodeSelector:t.nodeSelector,edgeSelector:t.edgeSelector,nodeDependencies:t.nodeDependencies,edgeDependencies:t.edgeDependencies,nodeOutput:t.nodeOutput,edgeOutput:t.edgeOutput}}var hu,Qs=6,gb=5,so=1,mb=0,_b=0,uu=-1;function fb(t,e,s,i){mb=t,hu=s,_b=e?1:0,uu=i}var W_=(t,e,s,i)=>n=>{const{rects:r,bboxes:o,intersects:a,indexToLayer:l,indexToRemoveNodeText:d,indexToRemoveEdgeText:h}=i;if(o[n*Qs+5]===mb&&o[n*Qs+4]===s)return!1;const u=n*gb,c=Fo(r[u],r[u+1],r[u+2],r[u+3],r[u+4]);if(ox(hu,c)){if(i.realIntersection=!0,uu<=0&&a.push(hu,c),!(l[o[n*Qs+5]]<uu))return!0;t.remove(n),i.realIntersection=!1,o[n*Qs+4]===_b?d[o[n*Qs+5]]=!0:h[o[n*Qs+5]]=!0}return!1};function X_(t,e,s="#22ff00"){return cu([[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]].map(i=>({x:i[0],y:i[1]})),e,s)}function cu(t,e,s="#ff0000"){e.strokeStyle=s,e.beginPath();for(let i=0,n=t.length;i<n;i++)i===0?e.moveTo(t[i].x,t[i].y):e.lineTo(t[i].x,t[i].y);e.closePath(),e.stroke()}function mF(t,e,s,i,n){for(let a=0,l=e.length;a<l;a+=Qs)X_(e.slice(a,a+4),t,"#aaaaaa");for(let a=0;a<s.length;a+=gb)cu(Fo(s[a],s[a+1],s[a+2],s[a+3],s[a+4]),t,"green");const r=[n.root];let o=n.root;for(;o=r.pop();)o.leaf||r.push.apply(r,o.children),X_(n.getNodeBounds(o),t,"rgba(0,0,0,0.2)"),o=r.pop();i.forEach(a=>cu(a,t,"red"))}var Nr={x1:0,y1:0,x2:0,y2:0},Vd={x:0,y:0},On={x:0,y:0},_F=Math.PI/2,fF=0;function pF(t,e,s,i,n,r,o,a,l,d,h){const u=a.remove.nodes,c=a.remove.edges,g=a.redraw.edges,m=s.angle,_=s.zoom,f=n.x,p=n.y,x=n.radius,y=Math.PI,{source:b,target:v,scalingMethod:E}=i,A=i.width,S=i.curvature,T=i.layer,L=i.text.content,I=i.text.scaling,R=i.text.size,z=i.text.font,j=i.text.style,C=i.text.scale,w=i.text.maxLineLength,H=i.text.margin,K=i.text.minVisibleSize,it=i.text.padding,xt=i.animationDuration,at=i.text.adjustAngle,Tt=i.text.position;a.indexToLayer={},a.indexToQuadIndex={},a.indexToRemoveNodeText={},a.indexToRemoveEdgeText={},a.indexToRedrawEdgeText={},a.byLayer=[];const{byLayer:It,indexToLayer:dt,indexToQuadIndex:bt,indexToRedrawEdgeText:Ht,indexToRemoveNodeText:Qt,indexToRemoveEdgeText:Xt}=a;for(let $=0;$<t.length;$++){const et=t[$],ht=T.get(et)-ny;for(let lt=1;lt<=ht;lt++)(It[lt]=It[lt]||[]).push(et);dt[et]=ht}if(l!==null){const $=It.length;for(let et=dt[l]+1;et<=$;et++)(It[et]=It[et]||[]).unshift(l);dt[l]=$}const mt=[0,0,0,0],ft=[0,0,0,0,0],{bboxes:te,rects:qt}=a,se=($,et=-1)=>{const ht=xt.get($);let lt=L?L.get($):"";if(lt===null||lt===""||ht)return!1;const rt=b.get($),nt=v.get($);let Lt=A.get($);const St=S.get($),wt=K.get($);if(Lt*_<wt)return Xt[$]=!0,!1;E.get($)==="fixed"&&(Lt/=_);let Wt=(f.get(rt)+f.get(nt))/2,Ut=(p.get(rt)+p.get(nt))/2;lt=lt?lt.toString():"";const ye=!I.get($),me=C.get($)*(ye?1:_),_e=z.get($),Ee=(ye?R.get($):me*Lt)*so,Fe=j.get($),Zt=w.get($),de=Tt.get($)===No;let Ae=+de*H.get($)+i.text.padding.get($);const pe=f.get(rt),ie=p.get(rt),Le=f.get(nt),xe=p.get(nt),ke=x.get(rt),bs=x.get(nt);if(St===0){const Ge=ur(pe,ie,Le,xe)-m,We=ke-bs;Wt+=We*Math.cos(Ge)/2,Ut+=We*Math.sin(Ge)/2}let ne;const re=rt===nt;if(re)ne=y/4-m,Vl(pe,ie,St,ke,0,Nr),_o(.5,pe,ie,Le,xe,Nr.x1,Nr.y1,Nr.x2,Nr.y2,On),Wt=On.x,Ut=On.y,Ae/=-_;else{if(pe===Le&&ie===xe)return!1;ne=ur(pe,ie,Le,xe)-m,St!==0&&(In(pe,ie,Le,xe,St,Vd),jl(.5,pe,ie,Le,xe,Vd.x,Vd.y,On),Wt=On.x,Ut=On.y)}const oe=Ae+fF,De=Py(lt,Zt);if(!De)return!1;const{lines:Re,data:Ke}=De;let cs=r(Ke[0],_e,Fe,Ee).width*so;for(let Ge=1;Ge<Re;Ge++)cs=Math.max(cs,r(Ke[Ge],_e,Fe,Ee).width*so);const Oe=Re*Ee,qe=cs/_/2,vs=Oe/_/2,qs=Math.abs(sl(ne))<_F?1:-1;let fe=de?re?Oe/_+Lt/2+Ae:qs*(oe/_+Lt/2+vs):0;if(!re&&St===0&&at.get($)){const Ge=it.get($);je(pe,ie,Le,xe)*_-(ke+bs)*(h?1:_)<cs+2*Ge+1&&(fe*=qs,ne=0)}if(ft[0]=Wt-qe,ft[1]=Ut-vs,ft[2]=Wt+qe,ft[3]=Ut+vs,ft[4]=ne+m,$h(ft,-(ne+m),-fe,ft),ft[2]=ft[2]-ft[0],ft[3]=ft[3]-ft[1],ne=y-ne-m,$l(Wt-qe,Ut-vs,2*qe,2*vs,ne,void 0,void 0,mt),$h(mt,ne,fe,mt),a.realIntersection=!1,fb($,!1,Fo(ft[0],ft[1],ft[2],ft[3],ft[4]),et),e.traverse(mt[0],mt[1],mt[2],mt[3],d),a.realIntersection&&!o)return Xt[$]=!0,!1;if(Ht[$]=!0,Qt[$]=!1,et<=0){const Ge=te.length/Qs;bt[$]=Ge,te.push(mt[0],mt[1],mt[2],mt[3],0,$),e.insert(Ge,mt[0],mt[1],mt[2],mt[3]),qt.push(ft[0],ft[1],ft[2],ft[3],ft[4])}else e.insert(bt[$],mt[0],mt[1],mt[2],mt[3])};for(const $ of t)se($);let ee=!0;for(let $=0;$<It.length;$++){const et=It[$];if(et)if(ee)ee=!1;else for(const ht of et)se(ht,$)}for(let $=0;$<t.length;$++){const et=t[$];Qt[et]?u.push(et):Ht[et]&&g.push(et),Xt[et]&&c.push(et)}return a}var yF={left:-1,right:1,top:0,bottom:0,center:0},xF={left:0,right:0,top:-1,bottom:1,center:0},bF={left:-1,right:0,top:-.5,bottom:-.5,center:-.5},vF={left:-.5,right:-.5,top:-1,bottom:0,center:-.5},EF=(t,e,s)=>Py(e,s.get(t))||{lines:0,data:[" "],maxLength:1},AF=(t,e,s,i,n,r,o)=>{const{lines:a,data:l}=EF(t,e,i);let d=s(l[0],n,r,o).width;for(let h=1;h<a;h++)d=Math.max(d,s(l[h],n,r,o).width);return[d,a*o*so]},SF=(t,e,s)=>{const i=e.text.content,n=e.radius,r=e.text.scaling,o=e.text.position,a=e.text.padding,l=e.text.scale,d=e.text.size,h=e.text.style,u=e.text.font,c=e.text.maxLineLength,g=e.text.margin,m=i.get(t),_=n.get(t),f=!r.get(t),p=o.get(t),x=a.get(t),y=l.get(t),b=(f?d.get(t):y*_*2)*so,v=h.get(t),E=u.get(t),A=x+g.get(t),S=yF[p],T=xF[p],[L,I]=AF(t,`${m}`,s,c,E,v,b),R=L/2,z=I/2;return[bF[p]*L,vF[p]*I,S*A,T*A,S*_,T*_,L,I,R,z]};function wF(t,e,s,i,n,r,o,a,l){const d=o.remove.nodes,h=o.remove.edges,u=o.redraw.nodes,c=s.angle,g=s.zoom,m=s.sin,_=s.cos,f=i.x,p=i.y,x=i.radius,y=i.layer,b=i.scalingMethod,v=i.text.content,E=i.text.scaling,A=i.text.minVisibleSize,S=i.animationDuration,T=i.textHidden,L=i.excluded;o.indexToLayer={},o.indexToQuadIndex={},o.indexToRemoveNodeText={},o.indexToRemoveEdgeText={},o.indexToRedrawNodeText={},o.byLayer=[];const{indexToLayer:I,indexToRedrawNodeText:R,indexToRemoveNodeText:z,indexToRemoveEdgeText:j,indexToQuadIndex:C,byLayer:w}=o;for(let dt=0;dt<t.length;dt++){const bt=t[dt],Ht=y.get(bt)-ny;(w[Ht]=w[Ht]||[]).push(bt),I[bt]=Ht}if(a!==null){const dt=w.length;for(let bt=I[a]+1;bt<=dt;bt++)(w[bt]=w[bt]||[]).unshift(a);I[a]=dt}let H;const K=[0,0,0,0],it=[0,0,0,0,0],{bboxes:xt,rects:at}=o,Tt=(dt,bt=-1)=>{const Ht=S.get(dt);let Qt=v.get(dt);if(Qt===null||Qt===""||Ht!==0)return!1;let Xt=x.get(dt);const mt=A.get(dt);if(L.get(dt)===1)return z[dt]=!0,!1;if(2*Xt*g<mt)return T.get(dt)===0&&(z[dt]=!0),!1;b.get(dt)==="fixed"&&(Xt/=g);const ft=f.get(dt),te=p.get(dt);typeof Qt=="number"&&(Qt=Qt.toString());let[qt,se,ee,$,et,ht,lt,rt,nt,Lt]=n(dt);const St=!E.get(dt),wt=St?g:1,Wt=b.get(dt)==="fixed"?g:1;St?(ee+=nt,$+=Lt,nt/=g,Lt/=g,lt/=g,rt/=g):(ee+=nt*g,$+=Lt*g),qt=qt/wt+ee/g+et/Wt,se=se/wt+$/g+ht/Wt,$l(ft-nt,te-Lt,lt,rt,-c,m,-_,K),it[0]=ft-nt,it[1]=te-Lt,it[2]=lt,it[3]=rt,it[4]=c;const Ut=_*qt-m*se,ye=m*qt+_*se;if(K[0]+=Ut,K[1]+=ye,K[2]+=Ut,K[3]+=ye,it[0]+=Ut,it[1]+=ye,o.realIntersection=!1,fb(dt,!0,Fo(it[0],it[1],it[2],it[3],it[4]),bt),e.traverse(K[0],K[1],K[2],K[3],l),o.realIntersection&&!r)return z[dt]=!0,!1;R[dt]=!0,z[dt]=!1,bt<=0?(H=xt.length/Qs,C[dt]=H,xt.push(K[0],K[1],K[2],K[3],1,dt),e.insert(H,K[0],K[1],K[2],K[3]),at.push(it[0],it[1],it[2],it[3],it[4])):e.insert(C[dt],K[0],K[1],K[2],K[3])};for(const dt of t)Tt(dt);let It=!0;for(let dt=0;dt<w.length;dt++){const bt=w[dt];if(bt)if(It)It=!1;else for(const Ht of bt)Tt(Ht,dt)}for(let dt=0;dt<t.length;dt++){const bt=t[dt];z[bt]?d.push(bt):R[bt]&&u.push(bt),j[bt]&&h.push(bt)}return o}var TF=1,IF="topDown",LF="bottomUp",CF=.15,MF=200,NF=80,PF=["x","y","radius","width","layer","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"].reduce((t,e)=>(t.add(e),t),new Set),FF=class extends Bt{constructor(t,e){super(t),this._textBBoxes=[],this._rects=[],this._enabled=!1,this._geoEnabled=!1,this._intersects=[],this._textDisplacement={},this._textDisplacementUpdate={},this._skipFrames=!1,this._output={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]},rects:this._rects,bboxes:this._textBBoxes,intersects:this._intersects,realIntersection:!1,indexToLayer:{},byLayer:[],indexToRedrawEdgeText:{},indexToRemoveEdgeText:{},indexToRedrawNodeText:{},indexToRemoveNodeText:{},indexToQuadIndex:{}},this._onZoomStart=Cl(({startZoom:s,endZoom:i})=>{this._enabled&&i<s&&this._updateLabels(this._modules.camera.clone({zoom:i}))},NF),this._onAttributesChanged=s=>{if([...s.edgeAttributes,...s.nodeAttributes].some(i=>PF.has(i))){const i=s.nodes._indexes;for(let n=0;n<i.length;n++)this._textDisplacementUpdate[i[n]]=!0;this._update()}},this._onItemsAdded=s=>{const i=s.nodes||s.edges;(this._enabled||this._forceEnabled)&&this._modules.settings.get("texts.preventOverlap")&&this._modules.graphics.setTextHidden(i,!0)},this._onToggle=s=>(s?this._update():this._reset(),this),this._update=()=>{(this._enabled||this._forceEnabled)&&this._updateDebounced()},this._toggleDebug=s=>{s?this._modules.layers.whenReady(()=>{this._layer=this._modules.layers.addCanvasLayer(i=>{i.lineWidth=1/this._modules.camera.getZoom(),mF(i,this._textBBoxes,this._rects,this._intersects,this._quadtree)},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._canvas=this._layer.element,this._ctx=this._canvas.getContext("2d"),this._update()}):this._canvas&&(this._layer.destroy(),this._canvas=this._ctx=null)},this._measureText=(s,i,n,r)=>this._engine.measureText(s,i,n,r),this._textDisplacement={},this._textDisplacementUpdate={},this._quadtree=new zf(s=>{const i=Qs,n=i*s;return this._textBBoxes.slice(n,n+i)},TF),e.forceEnableTextOverlapRemoval&&this.forceEnable()}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.events.register(["labelCollisionsRemoved"]),this.setRate(MF),this._modules.settings.register("texts.preventOverlap",!0,this._onToggle),this._modules.settings.register("texts.debug",!1,this._toggleDebug),this._modules.settings.register("texts.removalStrategy",IF);const t=this._output;this._nodeTraversal=W_(this._quadtree,!1,1,t),this._edgeTraversal=W_(this._quadtree,!1,0,t),this._modules.events.on(["addNodes","addEdges"],this._onItemsAdded).on(["layoutEnd","locate"],()=>this._updateLabels()).on(["viewChanged","mouseover","mouseout"],this._update).on("updateAttributes",this._onAttributesChanged).on("setContainer",({element:e})=>{if(e)return this._enable();this._disable()}).on("zoomStart",this._onZoomStart).on("viewExportStart",({preventOverlap:e,camera:s})=>{e&&this.forceUpdate(s)}).on("viewExportEnd",()=>{this.forceUpdate()}).on("geoEnabled",()=>this._geoEnabled=!0).on("geoDisabled",()=>this._geoEnabled=!1)}getTextsBoundingBox(t,e){if(this._skipFrames=!0,t||e?this._updateLabels(this._modules.camera,t?Array.from(t._indexes):[],e?Array.from(e._indexes):[]):this._updateLabels(),this._skipFrames=!1,this._rects===void 0)throw new Error("this._rects is undefined");const s=this._rects,i=new xs;for(let n=0;n<s.length;n+=5){const r=s[n],o=s[n+1],a=s[n+2],l=s[n+3],d=s[n+4],[h,u,c,g]=$l(r,o,a,l,d);i.addPoint(h,u).addPoint(c,g)}return i}setRate(t){this._updateDebounced=this._modules.sync.debounceIdle(e=>this._updateLabels(e),t)}forceEnable(){this._forceEnabled=!0}update(){this._update()}forceUpdate(t=this._modules.camera){this._updateLabels(t)}_enable(){this._enabled=!0,this._update()}_disable(){this._textBBoxes=[],this._rects=[],this._intersects=[],this._enabled=!1}_onCameraMove(){this._update()}_updateLabels(t=this._modules.camera,e,s){if(!this._modules.settings.get("texts.preventOverlap"))return;const i=this._modules.graphics.getNodeAttributes(),n=this._modules.graphics.getEdgeAttributes();this._intersects=[],this._textBBoxes=[],this._rects=[];const r=t.getAngle(),o=t.getProjectedScreenBounds(CF),a=this._modules.settings.get("texts.removalStrategy")===LF,l={angle:r,zoom:t.zoom,screen:o,sin:Math.sin(r),cos:Math.cos(r)};this._resetOutput();const d=this._output;if(!e||!s){const m=this._modules.spatial.queryRaw(o[0],o[1],o[2],o[3]);e=m.nodes,s=m.edges}const h=this._quadtree.clear().cover(o[0],o[1],o[2],o[3]);if(e.length+s.length===0)return;const u=this._modules.captor.getPointedElement();let c=null,g=null;u!==null&&(u.isNode?c=u._index:g=u._index);for(const m of e)!this._textDisplacementUpdate[m]&&this._textDisplacement[m]||(this._textDisplacement[m]=SF(m,i,this._measureText),this._textDisplacementUpdate[m]=!1);wF(e,h,l,i,m=>this._textDisplacement[m],a,d,c,this._nodeTraversal),pF(s,h,l,n,i,this._measureText,a,d,g,this._edgeTraversal,this._geoEnabled),this._skipFrames||this._clearOverlaps(this._output),this._modules.settings.get("texts.debug")&&this._layer.refresh()}_clearOverlaps(t){const e=this._modules.graph.nodeList,s=this._modules.graph.edgeList,i=this._modules.graphics,n=e(new Uint32Array(t.remove.nodes)),r=s(new Uint32Array(t.remove.edges)),o=e(new Uint32Array(t.redraw.nodes)),a=s(new Uint32Array(t.redraw.edges));i.setTextHidden(n,!0),i.setTextHidden(r,!0),i.setTextHidden(o,!1),i.setTextHidden(a,!1),this._modules.events.fire("labelCollisionsRemoved",t)}_resetOutput(){const t=this._output;t.remove.nodes=[],t.remove.edges=[],t.redraw.nodes=[],t.redraw.edges=[],t.rects=this._rects,t.bboxes=this._textBBoxes,t.intersects=this._intersects,t.realIntersection=!1,t.indexToLayer={},t.byLayer=[],t.indexToRedrawEdgeText={},t.indexToRemoveEdgeText={},t.indexToRedrawNodeText={},t.indexToRemoveNodeText={},t.indexToQuadIndex={}}_reset(){this._modules.graphics.resetTextHidden(),this._textDisplacement={},this._textDisplacementUpdate={}}},kF=class extends Bt{constructor(){super(...arguments),this._onStartInteractionEvent=(t,e)=>{if(this._current)return;const s=this._interactionsByStartEvent[e];let i;for(const n of s)n.check(t)&&(!i||n.priority>=i.priority)&&(i=n);i&&this._startInteraction(i,t)},this._onProgressInteractionEvent=(t,e)=>{this._current&&this._current.progressEventName===e&&this._current.onProgress&&this._current.onProgress(t)},this._onStopInteractionEvent=(t,e)=>{this._current&&this._current.stopEventName===e&&this._stopCurrentInteraction(null)}}onMounted(){this._interactionsByStartEvent={},this._boundProgressEvents={},this._boundStopEvents={}}_startInteraction(t,e){t.onStart&&t.onStart(e),t.onStop&&(this._current=t,t.disableDetection&&this._modules.captor.setDetectionEnabled(!1))}_stopCurrentInteraction(t){this._current&&this._current.disableDetection&&this._modules.captor.setDetectionEnabled(!0),this._current&&this._current.onStop&&this._current.onStop(t),this._current=void 0}_forceStartInteraction(t,e){this._current&&this._stopCurrentInteraction(e),this._startInteraction(t,e)}_createWrapper(t){return{start:e=>this._forceStartInteraction(t,e)}}_addInteraction(t,e){const s=this._interactionsByStartEvent[t];return s?s.push(e):(this._interactionsByStartEvent[t]=[e],this._modules.events.on(t,this._onStartInteractionEvent)),this._createWrapper(e)}_createProgressiveInteraction(t,e,s,i){const n={priority:Y_(i.priority),check:i.check||$a,onStart:i.onStart||Kt,onProgress:i.onProgress||Kt,onStop:i.onStop||Kt,disableDetection:!!i.disableDetection,progressEventName:e,stopEventName:s};return this._boundProgressEvents[e]||(this._boundProgressEvents[e]=!0,this._modules.events.on(e,this._onProgressInteractionEvent)),this._boundStopEvents[s]||(this._boundStopEvents[s]=!0,this._modules.events.on(s,this._onStopInteractionEvent)),this._addInteraction(t,n)}_createNonProgressiveInteraction(t,e){return this._addInteraction(t,{priority:Y_(e.priority),check:e.check||$a,onStart:e.handler||Kt,onProgress:void 0,onStop:void 0,disableDetection:!1,progressEventName:void 0,stopEventName:void 0})}onDrag(t){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",t)}onGesture(t){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",t)}onClick(t){return this._createNonProgressiveInteraction("click",t)}onDoubleClick(t){return this._createNonProgressiveInteraction("doubleclick",t)}onHover(t){return this._createNonProgressiveInteraction("mouseover",t)}onUnhover(t){return this._createNonProgressiveInteraction("mouseout",t)}onMouseWheel(t){return this._createNonProgressiveInteraction("mousewheel",t)}onMouseDown(t){return this._createNonProgressiveInteraction("mousedown",t)}onMouseUp(t){return this._createNonProgressiveInteraction("mouseup",t)}onMouseMove(t){return this._createNonProgressiveInteraction("mousemove",t)}};function Y_(t){return typeof t=="string"?A1.indexOf(t):typeof t!="number"||isNaN(t)?0:t}var DF=["virtualUp","mouseupInternal","touchUp"],RF=["virtualDown","mousedownInternal","touchDown"],OF=["virtualMove","mousemoveInternal","touchMove"],zF=["virtualClick","clickInternal","touchTap"],BF=["virtualDoubleClick","doubleclickInternal","touchDoubleTap"],UF=["virtualWheel","mousewheelInternal"],GF=100,VF=class extends Bt{constructor(){super(...arguments),this._elt=null,this._hoveredElt=null,this._draggedElt=null,this._hover=!1,this._disabledCounter=0,this._accDx=0,this._accDy=0,this._prevX=0,this._prevY=0,this._buttons={left:{isPressed:!1,isDragging:!1},middle:{isPressed:!1,isDragging:!1},right:{isPressed:!1,isDragging:!1}},this._onGraphChanged=()=>{this._resetCurrent(this._modules.position.x,this._modules.position.y),this._onMove({x:this._modules.position.x,y:this._modules.position.y,source:null,domEvent:null})}}onMounted(){this._modules.events.register(["mousemove","mousedown","mouseup","click","doubleclick","mousewheel","mouseout","mouseover","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]),this._modules.settings.register("detect.nodes",!0).register("detect.edges",!0).register("detect.nodeTexts",!0).register("detect.nodeBadges",!0).register("detect.edgeTexts",!0).register("detect.nodeErrorMargin",5).register("detect.edgeErrorMargin",2).register("detect.enableSpatialIndex",!0).register("detect.spatialIndexMarginRatio",20),this._modules.events.on(["removeNodes","removeEdges","clearGraph"],this._onGraphChanged).on(OF,(t,e)=>{this._onMove($t(ct({},t),{source:en(e)}))}).on(RF,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDown({domEvent:t,x:e,y:s,button:i,source:en(n)})}).on(DF,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onUp({domEvent:t,x:e,y:s,button:i,source:en(n)})}).on(zF,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onClick({domEvent:t,x:e,y:s,button:i,source:en(n)})}).on(BF,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDoubleClick({domEvent:t,x:e,y:s,button:i,source:en(n)})}).on(UF,({domEvent:t,x:e,y:s,delta:i,dx:n,dy:r})=>this._onWheel({domEvent:t,x:e,y:s,delta:i,source:"mouse",dx:n,dy:r})).on("touchStartGesture",t=>this._modules.events.fire("gestureStart",t)).on("touchProgressGesture",t=>this._modules.events.fire("gestureProgress",t)).on("touchEndGesture",t=>this._modules.events.fire("gestureEnd",t)).on("documentMouseMove",({domEvent:t,x:e,y:s},i)=>{this._onDocumentMove({domEvent:t,x:e,y:s,source:en(i)})}).on("documentMouseUp",({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDocumentUp({domEvent:t,x:e,y:s,source:en(n),button:i})})}triggerUnhover(){this._hover=!1,this._hoveredElt=null}triggerDetection(){this._detectElement(this._modules.position.x,this._modules.position.y,!1,!1),this._elt&&(this._hoveredElt=this._elt,this._hover=!0)}getPointedElement(){return this._hoveredElt}getDraggedElement(){return this._draggedElt}isAnyButtonPressed(){return this._buttons.left.isPressed||this._buttons.right.isPressed||this._buttons.middle.isPressed}isAnyButtonDragging(){return this._buttons.left.isDragging||this._buttons.right.isDragging||this._buttons.middle.isDragging}isButtonPressed(t){return this._buttons[t].isPressed}isLeftPressed(){return this.isButtonPressed("left")}getCursorPosition(){return{x:this._modules.position.x,y:this._modules.position.y}}getCursorInformation(){return{x:this._modules.position.x,y:this._modules.position.y,target:this._hoveredElt}}setDetectionEnabled(t){this._disabledCounter=Math.max(0,this._disabledCounter+(t?-1:1))}_resetCurrent(t,e){for(const s in this._buttons){const i=this._buttons[s];i.isDragging&&this._modules.events.fire("dragEnd",{domEvent:null,x:t,y:e,button:s,target:this._draggedElt}),i.isPressed=!1,i.isDragging=!1}this._hover&&this._hoveredElt&&this._modules.events.fire("mouseout",{domEvent:null,x:t,y:e,target:this._hoveredElt}),this._hover=!1,this._hoveredElt=null,this._draggedElt=null}_onMove({domEvent:t,x:e,y:s,source:i}){let{dx:n,dy:r}=this._setPointerPosition(e,s);this._modules.events.fire("mousemove",{domEvent:t,x:e,y:s,dx:n,dy:r,source:i});for(const o in this._buttons){const a=this._buttons[o];if(a.isPressed)if(a.isDragging){const l=this._getStoredDXY();n+=l.dx,r+=l.dy,this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:n,dy:r,button:o,source:i,target:this._draggedElt})}else a.isDragging=!0,this._hoveredElt&&this._hover&&(this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt}),this._hover=!1),this._draggedElt||(this._draggedElt=this._hoveredElt),this._storeDXY(n,r),this._modules.events.fire("dragStart",{domEvent:t,x:e,y:s,button:o,source:i,target:this._draggedElt})}t&&!this._modules.graphics.getDomElement().contains(t.target)||this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&(this._hoveredElt&&this._hover&&(this._hover=!0,this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})),this._hoveredElt=this._elt,this._elt&&(this._hover=!0,this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})))}_onDocumentMove({domEvent:t,x:e,y:s,source:i}){for(const n in this._buttons){const{isDragging:r}=this._buttons[n];if(r){const{dx:o,dy:a}=this._setPointerPosition(e,s);this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:o,dy:a,button:n,source:i,target:this._draggedElt})}}}_onDocumentUp({domEvent:t,x:e,y:s,source:i,button:n}){if(n!=null&&this._buttons[n].isDragging){this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:n,source:i,target:this._draggedElt});const r=this._buttons[n];r.isDragging=!1,r.isPressed=!1,this.isAnyButtonDragging()||(this._draggedElt=null)}}_onDown({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&this._resetCurrent(e,s);const r=this._buttons[i];this._hoveredElt=this._elt,r.isPressed=!0,this._elt&&t&&(t.stopPropagation(),t.preventDefault()),this._modules.events.fire("mousedown",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onDoubleClick({domEvent:t,x:e,y:s,button:i,source:n}){i!=null&&(q_(t,"doubleclick")||this._modules.events.fire("doubleclick",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt}))}_onUp({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;const r=this._buttons[i];r.isPressed&&(r.isDragging&&(this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:i,source:n,target:this._draggedElt}),r.isDragging=!1,this.isAnyButtonDragging()||(this._draggedElt=null)),r.isPressed=!1,this._detectElement(e,s,!1,!1),this._modules.events.fire("mouseup",{domEvent:t,x:e,y:s,button:i,source:n,target:this._elt}),this.isAnyButtonPressed()||this._hover||n==="touch"||(this._hoveredElt=this._elt,this._hoveredElt&&(this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:n,target:this._hoveredElt}),this._hover=!0)))}_onClick({domEvent:t,x:e,y:s,button:i,source:n}){q_(t,"click")||this._modules.events.fire("click",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onWheel({domEvent:t,x:e,y:s,delta:i,source:n,dx:r,dy:o}){this._modules.position.x=e,this._modules.position.y=s,this._modules.events.fire("mousewheel",{domEvent:t,x:e,y:s,dx:r,dy:o,delta:i,source:n,target:this._hoveredElt})}_storeDXY(t,e){this._accDx=t,this._accDy=e}_getStoredDXY(){const t=this._accDx,e=this._accDy;return this._accDx=0,this._accDy=0,{dx:t,dy:e}}_setPointerPosition(t,e){const s=t-this._prevX,i=e-this._prevY;return this._modules.position.x=t,this._modules.position.y=e,this._prevX=t,this._prevY=e,this._accDx=0,this._accDy=0,{dx:s,dy:i}}_detectElement(t,e,s,i){this._elt=this.detectElementAt(t,e,s,i)}detectElementAt(t,e,s,i){if(this._disabledCounter!==0)return null;const n=this._modules.settings,r=n.get("detect.enableSpatialIndex"),o=n.get("detect.nodeErrorMargin")||0,a=n.get("detect.edgeErrorMargin")||0;let l=n.get("detect.nodes"),d=n.get("detect.edges");i&&(l=!0,d=!0);let h=null,u=[],c=[];if(!s&&r&&(l||d)){const _=n.get("detect.spatialIndexMarginRatio"),f=Math.max(o*_,a*_),p=this._modules.spatial.queryRawProjected(t-f,e-f,t+f,e+f);u=p.nodes,c=p.edges}let g=null,m=null;if(l&&(g=this._modules.graphics.detectNode(t,e,!!n.get("detect.nodeTexts"),!!n.get("detect.nodeBadges"),o,u)),d&&(c.length<GF||!g)&&(m=this._modules.graphics.detectEdge(t,e,!!n.get("detect.edgeTexts"),a,c)),g&&m){const _=this._modules.graphics.getAttributesManager().getFlexArrays();h=_.nodes.current.layer.get(g._index)>=_.edges.current.layer.get(m._index)?g:m}else g?h=g:m&&(h=m);return h}};function en(t){return t.indexOf("touch")===0?"touch":"mouse"}var jd=!1,$_={down:{trigger:"pointerdown",duplicate:"mousedown"},click:{trigger:"pointerdown",duplicate:"mouseup"},doubleclick:{trigger:"pointerdown",duplicate:"mouseup"}};function q_(t,e){if(t)return t.type===$_[e].trigger&&(jd=!0),t.type===$_[e].duplicate&&jd?(jd=!1,!0):void 0}var jF=class extends Bt{constructor(){super(...arguments),this._dragged=null,this._start=[],this._end=[],this._shouldDrag=({target:t,button:e})=>{const s=e==="left",i=this._modules.settings.get("interactions.drag.enabled"),n=t!==null&&t.isNode&&t.getAttribute("draggable")===!0;return!!(s&&i&&n)},this._onDragStart=({x:t,y:e,target:s})=>{s&&(s.isSelected()?this._dragged=this._modules.selection.getSelectedNodes().filter(i=>i.getAttribute("draggable")):this._dragged=s.toList()),this._dragged&&(this._start=this._dragged.getPosition(),this._end=Pe(this._start),this._onBeforeDrag=this._modules.settings.get("interactions.drag.onBeforeDrag"),this._startDrag=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._dragged.addClass(Ba),this._modules.events.fire("nodesDragStart",{nodes:this._dragged}),this._modules.graphics.addCursorStyle(this._modules.settings.get("interactions.drag.cursor")))},this._onDrag=()=>{if(!this._dragged||!this._startDrag)return;const{x:t,y:e}=this._modules.captor.getCursorInformation(),s=this._dragged._indexes,i=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),n=i.x-this._startDrag.x,r=i.y-this._startDrag.y;for(let o=0;o<s.length;++o){const a=this._start[o],l=this._end[o];l.x=a.x+n,l.y=a.y+r}this._onBeforeDrag&&this._onBeforeDrag(this._dragged,t,e,this._end),this._modules.settings.get("interactions.drag.applyResult")&&this._modules.individualAttributes.setMultipleAttributes(this._dragged,this._end),this._modules.events.fire("nodesDragProgress",{nodes:this._dragged,dx:n,dy:r})},this._onDragEnd=()=>{this._dragged&&(this._dragged.removeClass(Ba),this._modules.graphics.removeCursorStyle(this._modules.settings.get("interactions.drag.cursor")),this._modules.events.fire("nodesDragEnd",{nodes:this._dragged,start:this._start,end:this._end}),this._dragged=null,this._start=[],this._end=[])}}onMounted(){this._modules.classes.createClass({name:Ba,isBuiltin:!0,nodeAttributes:{layer:v1}}),this._modules.events.register(["nodesDragStart","nodesDragProgress","nodesDragEnd"]),this._modules.settings.register("interactions.drag.enabled",!0).register("interactions.drag.cursor","move").register("interactions.drag.onBeforeDrag",void 0),this._modules.settings.register("interactions.drag.applyResult",!0),this._modules.interactions.onDrag({priority:"drag",disableDetection:!0,check:this._shouldDrag,onStart:this._onDragStart,onProgress:this._onDrag,onStop:this._onDragEnd})}},HF={color:"#00C3FF",radius:4,cursorOnHover:"grab",cursorOnDrag:"grabbing"},WF=class extends Bt{constructor(){super(...arguments),this._hoverHandle=!1,this._grabHandle=!1,this._x=0,this._y=0,this._enabled=!1,this._onMouseUp=()=>this._grabHandle=!1,this._onMouseDown=()=>{this._hoverHandle&&(this._grabHandle=!0)},this._onDragProgress=()=>{this._grabHandle&&this._refreshCanvas()},this._onDragStart=()=>{if(!this._movedEdges)return;this._nodesToHighlight=this._nodesToHighlight.filter(e=>e!==this._startNode&&!e.isVirtual()),this._movedEdges.setExcluded(!0);const t=this._options.cursorOnDrag;this._prevSettings=this._modules.settings.update({edgeHover:!1,cursor:{default:t,node:t,edge:t}})},this._onDragEnd=()=>{if(!this._movedEdges)return;this._restoreSettings();const t=this._getPointedNode();t&&this._movedEdges.forEach(e=>{e.getTarget()===this._startNode?e.setTarget(t):e.setSource(t)}),this._movedEdges.setExcluded(!1),this._movedEdges.setSelected(!0),this._movedEdges=null,this._refreshHandles()},this._refreshHandles=()=>{if(!this._enabled||this._movedEdges)return;const t=this._modules.selection.getSelectedEdges();this._nodesToHighlight=t.getExtremities().dedupe().filter(e=>!e.isVirtual()),this._rewirableClass.clearEdges(),this._rewirableClass.add(t),this._refreshCanvas()},this._shouldInteractionStart=({target:t})=>{if(!this._enabled||!t||!t.isNode||!this._hoverHandle||t.isVirtual())return!1;const e=t.getAdjacentEdges().filter(s=>s.isSelected());return!!e.size&&(this._movedEdges=e,this._edgeColors=this._movedEdges.getAttribute("color"),this._startNode=t,!0)},this._refreshCanvas=()=>{this._enabled&&this._layer.refresh()},this._checkForHover=()=>{if(!this._enabled||!this._nodesToHighlight)return;const t=this._options.radius,e=this._nodesToHighlight.getPosition(),s=this._modules.camera.screenToGraphCoordinates(this._modules.captor.getCursorPosition());for(let i=0;i<e.length;i++){const{x:n,y:r}=e[i];if(je(n,r,s.x,s.y)<t)return void this._enableCursorOnHover()}this._disableCursorOnHover()}}onMounted(){this._rewirableClass=this._modules.classes.createClass({name:Qp,isBuiltin:!0,edgeAttributes:{layer:E1}})}enable(t){this._enabled||(this._modules.events.on("move",this._checkForHover).on("mousemove",this._checkForHover).on("dragProgress",this._onDragProgress).on("nodesDragProgress",this._refreshCanvas).on("mousedown",this._onMouseDown).on("mouseup",this._onMouseUp).on("edgesSelected",this._refreshHandles).on("edgesUnselected",this._refreshHandles),this._interaction=this._modules.interactions.onDrag({priority:"rewiring",check:this._shouldInteractionStart,onStart:this._onDragStart,onProgress:({x:e,y:s})=>{this._x=e,this._y=s},onStop:this._onDragEnd}),this._options=ct(ct({},HF),t),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(e=>{if(!this._enabled||!this._nodesToHighlight)return;const s=this._modules.captor.getCursorPosition(),i=this._getPointedNode(),n=this._options.color,r=this._options.radius,o=2*r;if(this._displayMovedEdges(e),e.fillStyle=n,e.strokeStyle=n,this._nodesToHighlight.forEach(a=>{const{x:l,y:d}=a.getPosition();e.fillRect(l-r,d-r,o,o)}),this._movedEdges){const a=i?i.getPosition():s;e.fillRect(a.x-r,a.y-r,o,o)}},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._refreshHandles())}disable(){this._enabled&&(this._interaction&&this._interaction.stop&&this._interaction.stop(),this._interaction=void 0,this._modules.graphics.removeCursorStyle(this._options.cursorOnDrag),this._disableCursorOnHover(),this._restoreSettings(),this._layer.destroy(),this._rewirableClass.clearEdges(),this._enabled=!1,[this._checkForHover,this._onDragProgress,this._refreshCanvas,this._onMouseDown,this._onMouseUp,this._refreshHandles].forEach(t=>this._ogma.events.off(t)))}enabled(){return this._enabled}_restoreSettings(){this._prevSettings&&(this._modules.settings.update(this._prevSettings),this._prevSettings=void 0)}_disableCursorOnHover(){this._hoverHandle&&!this._grabHandle&&(this._hoverHandle=!1,this._modules.graphics.removeCursorStyle(this._options.cursorOnHover))}_enableCursorOnHover(){this._hoverHandle||(this._hoverHandle=!0,this._modules.graphics.addCursorStyle(this._options.cursorOnHover))}_displayMovedEdges(t){if(!this._movedEdges)return;const e=this._x,s=this._y,i=this._modules.camera.screenToGraphCoordinates({x:e,y:s});this._movedEdges.forEach((n,r)=>{const o=this._edgeColors[r],a=n.getSource(),l=n.getTarget(),d=this._getPointedNode(),h=l===this._startNode?a:l,u=Number(n.getAttribute("width")),c=h.getPosition(),g=d?d.getPosition():i;t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(g.x,g.y),t.strokeStyle=o,t.lineWidth=u,t.stroke()})}_getPointedNode(){const t=this._modules.captor.getPointedElement();return t&&t.isNode&&!t.isVirtual()?t:null}},Z_={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1},XF=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._nodesToHighlight=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[],this._onSelectionChange=()=>{this._enabled&&(this._nodesToHighlight=this._modules.selection.getSelectedNodes(),this._displayHandles())},this._displayHandlesHandler=()=>this._displayHandles(),this._moveHandler=({x:t,y:e})=>{this._modules.dom.setTimeout(()=>this._detectBoundingBoxes(t,e))}}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.interactions.onDrag({priority:"resizing",disableDetection:!0,check:()=>!(!this._enabled||!this._pointedNode),onStart:({x:t,y:e})=>{this._x=t,this._y=e,this._nodeBeingResized=this._pointedNode},onProgress:({x:t,y:e})=>{this._x=t,this._y=e,this._displayHandles()},onStop:()=>{if(this._nodesToHighlight){const t=this._modules.camera.zoom,e=this._nodesToHighlight.getAttributes(["x","y","radius"]).map(({x:s,y:i,radius:n},r)=>{const o=this._additionalRadiuses[r]/t;return{radius:+n+o,x:s+o,y:i-o}});this._nodesToHighlight.setAttributes(e)}this._pointedNode=null,this._nodeBeingResized=null,this._displayHandles()}})}onReady(){this._modules.events.on(["nodesSelected","nodesUnselected"],this._onSelectionChange)}_enableCursor(){this._cursorEnabled||(this._modules.graphics.addCursorStyle(this._options.cursor),this._cursorEnabled=!0)}_disableCursor(){this._cursorEnabled&&(this._modules.graphics.removeCursorStyle(this._options.cursor),this._cursorEnabled=!1)}_detectBoundingBoxes(t,e){if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight)return;const s=this._options.handleSize/2,i=this._options.detectionMargin;return this._pointedNode=null,this._forEachNodeToHighlight((n,r,o)=>{const a=r.x+o-s-i,l=r.x+o+s+i,d=r.y-o-s-i,h=r.y-o+s+i;t>=a&&t<=l&&e>=d&&e<=h&&(this._pointedNode=n)}),this._pointedNode?this._enableCursor():this._disableCursor()}_forEachNodeToHighlight(t){this._nodesToHighlight&&this._nodesToHighlight.forEach(e=>{const s=e.getPositionOnScreen(),i=this._getTotalRadius(e);t(e,s,i)})}_displayHandles(){this._enabled&&this._nodesToHighlight&&this._layer.refresh()}_displayNodePreview(t,e,s,i,n,r){if(n*=1/this._modules.camera.getZoom(),t.beginPath(),r.length===1)t.arc(s,i,n,0,2*Math.PI);else for(let o=0;o<r.length;++o){const a=r[o],l=s+a.x*n,d=i+a.y*n;o===0?t.moveTo(l,d):t.lineTo(l,d)}t.fillStyle=this._options.previewColor,t.fill()}_getTotalRadius(t,e=!0){return Number(t.getAttribute("radius"))*(this._modules.camera.zoom*(e?1:0))+Number(t.getAttribute("innerStroke.width"))+Number(t.getAttribute("outerStroke.width"))+this._options.lineWidth/2}_snap(t,e,s){const i=this._modules.spatial.getNodesInScreenByDistance(e).filter(u=>!u.isSelected()).slice(0,this._options.nbNodesToSnapTo),n=this._getTotalRadius(e),r=n+s,o=this._options.snappingRatio,a=r/n,l=Math.round(Gp(a,o));let d=n*Math.pow(o,l),h=null;if(i.forEach(u=>{const c=this._getTotalRadius(u);Math.abs(c-r)<=Math.abs(d-r)&&(d=c,h=u)}),h){t.save(),t.strokeStyle=this._options.sizeIndicatorColor,t.lineWidth=this._options.sizeIndicatorThickness/this._modules.camera.getZoom();const u=h.getAttribute("radius");this._displaySizeIndicator(t,e,d),i.filter(c=>c.getAttribute("radius")===u).forEach(c=>this._displaySizeIndicator(t,c)),t.restore()}return d-n}_displaySizeIndicator(t,e,s){s=s||void 0;const i=this._modules.camera.getZoom(),n=e.getPosition(),r=this._getTotalRadius(e),o=(s||r)/i,a=(s?s-r:0)/i,l=a+(-this._options.sizeIndicatorOffset-(s?Number(e.getAttribute("innerStroke.width"))+Number(e.getAttribute("outerStroke.width")):0))/i,d=n.x-o+l|0,h=n.y-o-a|0,u=n.y+o-a|0,c=this._options.sizeIndicatorWidth/i;t.beginPath(),t.moveTo(d-c,h),t.lineTo(d+c,h),t.moveTo(d,h),t.lineTo(d,u),t.moveTo(d-c,u),t.lineTo(d+c,u),t.stroke()}enable(t={}){this._enabled||(this._options=ct(ct({},Z_),t),this._layer=this._modules.layers.addCanvasLayer(e=>{const s=Ss(),i=this._modules.camera.getZoom(),{color:n,lineWidth:r}=this._options;let o=this._options.handleSize,a=0;if(this._nodeBeingResized){const l=this._getTotalRadius(this._nodeBeingResized),d=this._nodeBeingResized.getPositionOnScreen();a=Math.max(this._x-(d.x+l),-(this._y-(d.y-l)))/2}this._additionalRadiuses=[],this._nodesToHighlight&&this._nodesToHighlight.forEach(l=>{const d=l.getPosition();let h=this._getTotalRadius(l),u=0;if(this._nodeBeingResized){u=a;const c=-h+Number(l.getAttribute("innerStroke.width"))+Number(l.getAttribute("outerStroke.width"))+r/2+1;u=u<c?c:this._snap(e,l,u),this._additionalRadiuses.push(u);const g=l.getAttribute("shape"),m=this._engine.getShapePoints(g),_=d.x+u/i,f=d.y-u/i,p=h+u;this._displayNodePreview(e,s,_,f,p,m)}e.strokeStyle=n,e.fillStyle=n,e.lineWidth=r/i,h/=i,u/=i,o/=i*s,e.strokeRect(d.x-h,d.y-h-2*u,2*(u+h),2*(u+h)),e.fillRect(d.x+h+2*u-o/2,d.y-h-2*u-o/2,o,o)})},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._modules.events.on(["mousemove","mousedown"],this._moveHandler),this._enabled=!0)}disable(){this._enabled&&(this._modules.events.off(this._displayHandlesHandler),this._modules.events.off(this._moveHandler),this._layer.destroy(),this._disableCursor(),this._reset())}_reset(){this._enabled=!1,this._nodesToHighlight=null,this._options=ct({},Z_),this._nodeBeingResized=null,this._pointedNode=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[]}enabled(){return this._enabled}},YF={strokeColor:"black",strokeWidth:5,dashed:!0,cursorStyle:"cell",createNodes:!0,condition:Fu,onNodeCreated:Kt,onEdgeCreated:Kt,createNode:Xs,createEdge:Xs,onComplete:Kt},$F=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._blockId=0,this._cursorEnabled=!1}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._depth=fo(0).edgeBody,this._modules.events.register(["connectNodes"]),this._interaction=this._modules.interactions.onDrag({priority:"connectNodes",check:({target:t,button:e="left"})=>this._enabled&&e==="left"&&t&&t.isNode&&!t.isVirtual(),onStart:({target:t})=>this._onStart(t),onProgress:({x:t,y:e})=>this._onMove(t,e),onStop:()=>this._onStop()}),this._modules.events.on("clearGraph",()=>this.disable())}_onStart(t){t&&(this._cursorEnabled=!0,this._startNode=t,this._startPos=t.getPosition(),this._modules.graphics.addCursorStyle(this._options.cursorStyle),this._blockId=this._modules.graphics.allocateGraphicsEngineBlockId())}_onMove(t,e){this._startNode!==null&&(this._endPos=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._drawLine())}_onStop(){if(this._startNode===null)return;const{condition:t,onNodeCreated:e,onEdgeCreated:s,createEdge:i,createNode:n,onComplete:r,createNodes:o}=this._options;let a=this._modules.captor.getPointedElement(),l=null,d=null;if(this._modules.graphics.releaseGraphicsEngineBlockId(this._blockId),!a&&o){const h=n({attributes:{x:this._endPos.x,y:this._endPos.y}});a=this._modules.graph.addNode(h),d=a,e&&e(d)}if(a&&!a.isVirtual()&&(d||!t||t(this._startNode,a))){const h=i({source:this._startNode.getId(),target:a.getId()});l=this._modules.graph.addEdge(h),s&&s(l)}r&&(this._modules.events.fire("connectNodes",{source:this._startNode,target:a,edge:l}),r(this._startNode,a,l||void 0)),this.disable()}_drawLine(){this._group.reset(Ws,!1,this._depth);const t=this._group.nextAndReset().end;t.pieceId=Ul,t.shape="line",t.x1=this._startPos.x,t.y1=this._startPos.y,t.x2=this._endPos.x,t.y2=this._endPos.y,t.fillColor=this._options.strokeColor,t.thicknessOrFontSizeFixed=this._options.strokeWidth,this._options.dashed&&(t.dashLength=3,t.gapLength=1),this._engine.storeGroup(this._blockId,this._group),this._modules.dom.refresh()}enable(t={}){return this._enabled||(this._options=ct(ct({},YF),t),this._enabled=!0,this._cursorEnabled=!1,this._startNode=null,this._prevSettings=this._modules.settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":!1}),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorInformation())),this}disable(){return this._enabled?(this._enabled=!1,this._modules.settings.update(this._prevSettings),this._cursorEnabled&&this._modules.graphics.removeCursorStyle(this._options.cursorStyle),this):this}enabled(){return this._enabled}},qF=["top","bottom","left","right","cssDefined"],ZF=1e4,JF={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},KF={position:"top",autoAdjust:!0,delay:100},QF={hover:{node:({target:t})=>t&&t.isNode,edge:({target:t})=>t&&!t.isNode},click:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}},doubleclick:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}}},tk=class extends Bt{constructor(){super(...arguments),this._x=0,this._y=0}onMounted(){this._handlers={},this._currentHandlerName=null,this._tooltip=null,this._isHover=!1,this._modules.events.register(["tooltipShow","tooltipHide"]),this._modules.events.on(["mouseup","dragStart"],()=>{this._isHover||this._hideTooltip(!1)}).on("mouseout",()=>{this._isHover&&this._hideTooltip(!1)}).on("clearGraph",()=>this._hideTooltip(!1)),this._modules.interactions.onHover(this._createInteraction("hover",!0)),this._modules.interactions.onClick(this._createInteraction("click")),this._modules.interactions.onDoubleClick(this._createInteraction("doubleclick"))}hide(){this._hideTooltip(!0)}isShown(){return!!this._tooltip}refresh(){this._refreshTooltip()}show(t,{position:e="top",autoAdjust:s=!0,className:i,x:n=0,y:r=0}={}){this._showTooltip(t,{position:e,autoAdjust:s,className:i},{x:n,y:r})}setHandler(t,e,s){const i=ct(ct({},KF),s);i.position&&qF.indexOf(i.position)===-1&&(i.position="top"),this._handlers[t]={handler:e,condition:Me(QF,t),settings:i}}_hideTooltip(t){if(this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null),t&&(this._currentHandlerName=null),this._tooltip){const e=this._tooltip;this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null,this._modules.events.fire("tooltipHide",{tooltip:e})}}_createInteraction(t,e=!1){return{priority:"tooltip",check:s=>{const i=J_(t,s),n=this._handlers[i];return(!e||!this._modules.connectNodes.enabled())&&(!(!n||!n.condition(s))||!(e||!this._currentHandlerName||this._isHover)&&this._tooltip!==null)},handler:s=>{const{target:i,x:n,y:r}=s;this._hideTooltip(!1),this._isHover=e,this._elt=i,this._x=n,this._y=r,this._currentHandlerName=J_(t,s),this._refreshTooltip()}}}_refreshTooltip(){if(!this._currentHandlerName)return void this._hideTooltip(!1);const t=this._handlers[this._currentHandlerName];if(!t)return;const{settings:e,handler:s}=t,i=this._elt;if(i){const r=i.isNode?"node":"edge";if(this._currentHandlerName.indexOf(r)===-1)return}const n=s(i);Promise.resolve(n).then(r=>{this._schedule(()=>this._showTooltip(r,e),e.delay)})}_schedule(t,e){this._timeout&&this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>{this._timeout=null,t()},e)}_showTooltip(t,e,s){this._hideTooltip(!1);const{position:i,className:n,autoAdjust:r}=e;let o=this._x,a=this._y,l=this._elt;const d=this._modules.dom.getDimensions();let h=0,u=0;if(s&&(o=s.x,a=s.y,l=null),typeof t=="string")this._tooltip=ek("div"),this._tooltip.innerHTML=t;else{if(!fp(t))throw new Error(`invalid tooltip ${t}, expected HTML string or HTML element`);this._tooltip=t}const c=this._tooltip;if(n&&this._tooltip.classList.add(n),i!=="cssDefined"&&(c.style.position="absolute"),c.style.zIndex=ZF.toString(),this._modules.dom.appendElement(c),l&&l.isNode){const _=l,f=_.getPositionOnScreen(),p=Number(_.getAttribute("radius"))*(_.getAttribute("scalingMethod")==="fixed"?1:this._modules.camera.getZoom())+Number(_.getAttribute("innerStroke.width"))+Number(_.getAttribute("outerStroke.width"));o=f.x,a=f.y,h=p,u=p}const g=c.offsetWidth/2,m=c.offsetHeight/2;if(h+=g,u+=m,i&&i!=="cssDefined"){const _=JF[i];let f=_.x,p=_.y;if(r){const x=o+h*_.x,y=a+u*_.y;(x-g<0||x+g>=d.width)&&(i==="left"||i==="right"?f*=-1:f=x-g<0?(g-x+1)/h:(d.width-(x+g)-1)/h),(y-m<0||y+m>=d.height)&&(i==="top"||i==="bottom"?p*=-1:p=y-m<0?(m-y+1)/u:(d.height-(y+m)-1)/u)}c.style.left=o+h*f-g+"px",c.style.top=a+u*p-m+"px"}this._modules.events.fire("tooltipShow",{tooltip:c})}};function J_(t,{button:e,target:s}){return`${t}${e?`.${e}`:""}.${s!==null?s.isNode?"node":"edge":"background"}`}function ek(t){return Ei?document.createElement(t):Za()}var io={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"},K_=Object.keys(io).reduce((t,e)=>{const s=io[e];return t[s]||(t[s]=[]),t[s].push(e),t},{}),sk=class extends Bt{constructor(){super(...arguments),this._onBlur=()=>this.resetKeys(),this._onKeyUp=t=>{const e=t.keyCode||t.which;this._pressed[e]=!1,this._modules.events.fire("keyup",{domEvent:t,key:io[e],code:e})},this._onKeyDown=t=>{const e=t.keyCode||t.which,s=this._binds[e];if(!this._pressed[e]){if(this._pressed[e]=!0,s)for(const i of s)i.keys.every(n=>n.some(r=>this._pressed[r]))&&i.handler({domEvent:t});this._modules.events.fire("keydown",{domEvent:t,key:io[e],code:e})}}}onMounted(){this._modules.events.register(["keyup","keydown"]),this._binds=[],this._pressed=[],this._modules.dom.addWindowEventListener("keydown",this._onKeyDown).addWindowEventListener("keyup",this._onKeyUp).addWindowEventListener("visibilitychange",this._onBlur).addWindowEventListener("blur",this._onBlur,!1),this._idleTimeout=4e3,this._prevEventTimeStamp=ls(),this._modules.events.onAnyEvent(()=>{const t=ls();t-this._prevEventTimeStamp>this._idleTimeout&&this.resetKeys(),this._prevEventTimeStamp=t})}setIdleTimeout(t){if(!isFinite(t)||t<=1)throw new TypeError("Idle timeout must be a positive number > 1");this._idleTimeout=t}resetKeys(){for(let t=0;t<this._pressed.length;t++)this._pressed[t]&&(this._pressed[t]=!1,this._modules.events.fire("keyup",{key:io[t],code:t}))}onKeyPress(t,e){let s=[];if(typeof t=="number")s=[t];else if(typeof t=="string")s=t.split(" ");else{if(!Array.isArray(t))throw new TypeError(`${t} is not a number, string or array`);s=t}if(s.length===0)throw new Error("the array should contain at least one element");const i=s.map(o=>{if(typeof o=="number")return[o];if(typeof o=="string"){const a=K_[o];if(!a)throw new Error(`${o} is not a valid key identifier`);return a}throw new TypeError(`${o} is not a valid key identifier`)}),n=i.pop(),r={keys:i,handler:e};n&&n.forEach(o=>{this._binds[o]||(this._binds[o]=[]),this._binds[o].push(r)})}isPressed(t){if(typeof t=="number")return this._pressed[t];if(typeof t=="string"){const e=K_[t];if(e)return e.some(s=>this._pressed[s])}return!1}},ik=[{name:"color",isNode:!0},{name:"shape",isNode:!0},{name:"radius",isNode:!0},{name:"icon.content",isNode:!0},{name:"image.url",isNode:!0},{name:"image",isNode:!0},{name:"color",isNode:!1},{name:"shape",isNode:!1},{name:"width",isNode:!1}],wi=Math.PI,Ti=2*Math.PI,pb=Math.cos(wi/2-Ti/5),yb=Math.cos(wi/2-Ti/5*2),xb=Math.cos(wi/2-Ti/5*3),bb=Math.cos(wi/2-Ti/5*4),vb=Math.sin(-wi/2+Ti/5),Eb=Math.sin(-wi/2+Ti/5*2),Ab=Math.sin(-wi/2+Ti/5*3),Sb=Math.sin(-wi/2+Ti/5*4),vl=1.6,wb=3,nk=.9,Ia=.31,Hd=1/3,rk=[8,3],ok=[3,3],La={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:t=>t[t.length-1]},ak=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];function Tb(t){return Array.isArray(t)?t.reduce((e,s)=>e&&Tb(s),!0):t==="undefined"||!isNaN(Number(t))}function Ib(t){return Array.isArray(t)?t.reduce((e,s)=>Math.min(e,Ib(s)),1/0):typeof(t=Number(t))=="number"?isNaN(t)?1/0:+t:1/0}function Lb(t){return Array.isArray(t)?t.reduce((e,s)=>Math.max(e,Lb(s)),-1/0):typeof(t=Number(t))=="number"?isNaN(t)?-1/0:+t:-1/0}function bi(t){const e=["K","M","B","T","P","E","Z","Y"];if(t>9999){let s=0;for(;s<e.length&&t>999;)t/=1e3,s++;return(Q_(t,3)+e[s-1]).toString()}return Q_(t,4).toString()}function Q_(t,e=3){const s=e===4?10:1;return t<10?Math.round(100*t*s)/(100*s):t<100?Math.round(10*t*s)/(10*s):t<1e3?Math.round(t*s)/s:Math.round(t)}function Cb(t){return t.innerMargin+(t.titleFontSize+t.fontSize)*vl}var lk=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.title<=e.title?-1:1,dk=(t,e)=>t.height-e.height,hk=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:e.height-t.height,uk=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.content[0].title<=e.content[0].title?-1:1;function ck(t,e,s){const i=e.getContext("2d"),{x:n,y:r,height:o,isNode:a,styleProperty:l,title:d,mapping:h,iconFont:u,iconFontStyle:c}=s;_k(i,t,n,r,o),fk(i,t,d,n,r);const g=t.fontSize*vl,m=t.fontSize/2*vl*nk,_=t.fontSize*wb,f=t.fontSize,p=mk(t,a);let x=r+Cb(t);const y=n+t.innerMargin+p/2,b=n+2*t.innerMargin+p,v=$r(h),E=Tb(v),A=t.fontColor,S=t.shapeColor,T=Object.keys(h);if(E&&(T.sort((L,I)=>mi(h[I])-mi(h[L])),l==="radius"||l==="width")){const L=Ib(v),I=Lb(v);return(a?Nk:Pk)(t,i,n,x,L,(L+I)/2,I,S)}T.forEach(L=>{const I=h[L];l==="color"&&(a?Mb(i,y,x,m,L):yk(i,y,x,_,f,L)),l==="shape"&&(a?wk(i,y,x,m,L,S):Ck(i,y,x,_,f,L,S)),l==="icon.content"&&xk(i,y,x,L,u,m,A,c),l!=="image"&&l!=="image.url"||bk(i,y,x,m,L),pk(i,t,b,x,I,E),x+=g})}function gk(t,e,s,i,n,r){t.beginPath(),t.arc(e,s,i,0,Ti),t.strokeStyle=n,t.lineWidth=r,t.stroke()}function ko(t,e,s,i,n="left",r="normal"){t.textAlign=n,t.textBaseline="middle",t.fillStyle=i,t.font=`${r} ${s}px "${e}"`}function mk(t,e){const s=e?1:wb;return t.fontSize*s}function _k(t,e,s,i,n){return Mk(t,s,i,e.widgetWidth,n,e.borderRadius,e.backgroundColor,e.borderColor,e.borderWidth)}function fk(t,e,s,i,n){ko(t,e.fontFamily,e.titleFontSize,e.titleFontColor,e.titleTextAlign);const r=e.titleTextAlign==="center",o=e.widgetWidth-2*e.innerMargin,a=t.measureText(s).width,l=i+(r?e.widgetWidth/2:e.innerMargin),d=n+e.titleFontSize/2+e.innerMargin;if(a>o){const h=o/a,u=(s.length*h|0)-2;s=s.substr(0,u)+""}t.fillText(s,l,d)}function pk(t,e,s,i,n,r){let o=n.join();if(r)if(n.length===1)o=bi(n[0]);else{const a=mi(n),l=Wn(n);o=`${bi(a)} - ${bi(l)}`}ko(t,e.fontFamily,e.fontSize,e.fontColor),t.fillText(o,s,i)}function Mb(t,e,s,i,n){t.beginPath(),t.arc(e,s,i,0,2*wi),t.fillStyle=n,t.fill()}function yk(t,e,s,i,n,r){t.fillStyle=r,t.fillRect(e-i/2,s-n/2,i,n)}function xk(t,e,s,i,n,r,o,a){ko(t,n,2*r,o,"center",a),t.fillText(i,e,s)}function bk(t,e,s,i,n){if(typeof Image>"u")return;t._imgStore||(t._imgStore={});let r=t._imgStore[n];if(r)return t.drawImage(r,e-i,s-i,2*i,2*i);r=new Image,r.src=n,r.onload=()=>{t.drawImage(r,e-i,s-i,2*i,2*i)},t._imgStore[n]=r}function vk(t,e,s,i){t.fillRect(e-i,s-i*Ia,2*i,2*i*Ia),t.fillRect(e-i*Ia,s-i,2*i*Ia,2*i)}function Ek(t,e,s,i){return t.beginPath(),t.moveTo(e-i,s),t.lineTo(e,s-i),t.lineTo(e+i,s),t.lineTo(e,s+i),t.fill()}function Ak(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+pb*i,s+vb*i),t.lineTo(e+yb*i,s+Eb*i),t.lineTo(e+xb*i,s+Ab*i),t.lineTo(e+bb*i,s+Sb*i),t.fill()}function Sk(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+yb*i,s+Eb*i),t.lineTo(e+bb*i,s+Sb*i),t.lineTo(e+pb*i,s+vb*i),t.lineTo(e+xb*i,s+Ab*i),t.fill()}function wk(t,e,s,i,n,r){switch(t.fillStyle=r,n){case"square":return t.fillRect(e-i,s-i,2*i,2*i);case"circle":return Mb(t,e,s,i,r);case"cross":return vk(t,e,s,i);case"diamond":return Ek(t,e,s,i);case"equilateral":return Ak(t,e,s,i);case"star":return Sk(t,e,s,i)}}function Tk(t,e,s,i,n){t.fillRect(e-i/2,s-n/4,i*(1-Hd),n/2),t.beginPath(),t.moveTo(e+i*(1-Hd-.5),s-n/2),t.lineTo(e+i*(1-Hd-.5),s+n/2),t.lineTo(e+i/2,s),t.fill()}function Ik(t,e,s,i,n,r,o){t.beginPath(),t.moveTo(e-i/2,s),t.lineTo(e+i/2,s),t.strokeStyle=r,t.lineWidth=n/2,t.setLineDash(o==="dashed"?rk:ok),t.stroke()}function Lk(t,e,s,i,n){t.beginPath(),t.moveTo(e-i/2,s-n/2),t.lineTo(e-i/2,s+n/2),t.lineTo(e+i/2,s),t.fill()}function Ck(t,e,s,i,n,r,o){return t.fillStyle=o,r==="line"&&t.fillRect(e-i/2,s-n/4,i,n/2),r==="arrow"?Tk(t,e,s,i,n):r==="dashed"||r==="dotted"?Ik(t,e,s,i,n,o,r):r==="tapered"?Lk(t,e,s,i,n):void 0}function Mk(t,e,s,i,n,r,o,a,l){t.setLineDash([]),t.beginPath(),t.moveTo(e+r,s),t.lineTo(e+i-r,s),t.quadraticCurveTo(e+i,s,e+i,s+r),t.lineTo(e+i,s+n-r),t.quadraticCurveTo(e+i,s+n,e+i-r,s+n),t.lineTo(e+r,s+n),t.quadraticCurveTo(e,s+n,e,s+n-r),t.lineTo(e,s+r),t.quadraticCurveTo(e,s,e+r,s),t.closePath(),t.fillStyle=o,t.fill(),t.strokeStyle=a,t.lineWidth=l,t.stroke()}function Nk(t,e,s,i,n,r,o,a){const l=.7*t.fontSize,d=3*l,h=(l+d)/2,u=s+t.innerMargin+d,c=u+d+t.innerMargin,g=i+2*d-.5*t.innerMargin,m=t.circleStrokeWidth;for(const _ of[l,h,d])gk(e,u,g-_,_,a,m);ko(e,t.fontFamily,t.fontSize,t.fontColor,"left"),e.fillText(bi(n),c,g+l-2*l),e.fillText(bi(r),c,g+l-2*h),e.fillText(bi(o),c,g+l-2*d)}function Pk(t,e,s,i,n,r,o,a){const l=(t.widgetWidth-2*t.innerMargin)/3,d=t.fontSize,h=i-t.innerMargin/2,u=h+2*d,c=s+t.innerMargin;e.fillStyle=a,e.fillRect(c,h-d/2,l+1,d),e.fillRect(c+l,h-d/3,l+1,d/1.5),e.fillRect(c+2*l,h-d/6,l,d/3),ko(e,t.fontFamily,t.fontSize,t.fontColor,"center"),e.fillText(bi(o),c+.5*l,u),e.fillText(bi(r),c+1.5*l,u),e.fillText(bi(n),c+2.5*l,u)}function Fk(t,e,s,i){const n=i.outerMargin+Cb(i),r=i.fontSize*vl,o=n-.8*i.innerMargin;return e==="radius"||e==="width"?o+r*(s?3:2):o+Object.keys(t).length*r}function kk(t,e,s){const i={width:e.width,height:e.height};let n=!1;return!!(i.width&&i.height&&s)&&(n=t.position==="top"||t.position==="bottom"?zk(i,t,s,t.position==="bottom"):Dk(i,t,s,t.position==="left"),n&&s.forEach(r=>ck(t,e,r)),n)}function Dk(t,e,s,i){const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height;let a=e.outerMargin,l=i?e.outerMargin:t.width-n,d=1;s=s.slice().sort(lk);for(let h=0;h<s.length;++h){const u=s[h];if(a+u.height>o){if(a===e.outerMargin)return!1;a=e.outerMargin,d+=1,i?l+=n:l-=n}u.x=l,u.y=a,a+=u.height}return d<=r}function Rk(t,e,s){let i=null;for(let n=0;n<e.length;++n){const r=e[n];r.isNode!==t.isNode&&e.length!==1||!(i===null||r.height<e[i].height)||(i=n)}if(i!=null){const n=e[i];n.content.push(t),n.height+=t.height+s.outerMargin}}function Ok(t){let e=0;for(let s=1;s<t.length;++s)t[s].height>t[e].height&&(e=s);return e}function zk(t,e,s,i){s=s.slice();const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height-e.outerMargin,a=new Array(Math.min(r,s.length)),l=s.length;let d=0,h=0,u=0,c=0;for(let y=0;y<l;++y){const b=s[y];b.isNode?(d+=1,h+=b.height):(u+=1,c+=b.height)}const g=h+c,m=h/g,_=c/g;let f=Math.round(m*r);const p=Math.round(_*r);if(f>d?f=d:p>u&&(f=r-u),r===0)return!1;for(let y=0;y<a.length;y++)a[y]={content:[],height:0,isNode:y<f};for(let y=0;y<l;++y){const b=Ok(s);Rk(s[b],a,e),s.splice(b,1)}a.every(({content:y})=>y.length===1)?a.sort(uk):a.sort(hk);let x=e.outerMargin;for(let y=0;y<a.length;++y){const b=a[y];if(b.height>o)return!1;b.content.sort(dk);let v=0;for(let E=0;E<b.content.length;++E){const A=b.content[E];A.x=x,A.y=i?t.height-v-A.height-e.outerMargin:v+e.outerMargin,v+=A.height+e.outerMargin}x+=n}return!0}var Bk=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._mustRefresh=!1,this._promises=[]}onMounted(){this._modules.events.on("frame",()=>{this._enabled&&this._mustRefresh&&this._layer.refresh()}).on(["resize","reloadFonts"],()=>{this._mustRefresh=!0})}enable(t={}){const e=this._settings;return this._settings=ct(ct({},La),t),this._mustRefresh=!this._enabled||!this._sameOptions(e,this._settings),this._enabled?Promise.resolve():(this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(s=>{this._drawOnCanvas(this._settings,s.canvas,Ss());const i=this._promises;this._promises=[],i.forEach(n=>n()),this._mustRefresh=!1},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this.refresh())}_afterNextUpdate(){return new Promise(t=>this._promises.push(t))}_formatSettings(t,e){const s=ct(ct({},La),t);return ak.forEach(i=>s[i]*=e),s}disable(){return this._enabled&&(this._enabled=!1,this._layer.destroy()),Promise.resolve()}enabled(){return this._enabled}refresh(){return this._mustRefresh=!0,this._modules.dom.refresh(),this._afterNextUpdate()}destroy(){this._enabled=!1,this._mustRefresh=!1,this._settings=ct({},La),this._promises=[]}getOptions(){return this._enabled?ct({},this._settings):ct({},La)}getCurrentOptions(){return this._settings}_sameOptions(t,e){return t===e||Object.keys(t).reduce((s,i)=>s&&t[i]===e[i],!0)}_drawOnCanvas(t,e,s){const i=this._formatSettings(t,s);kk(i,e,this._computeWidgetList(i))}exportOnCanvas(t,e,s){return this._drawOnCanvas(e,t,s)}export(t={}){const{width:e,height:s}=ct(ct({},this._modules.camera.getSize()),t),i=Ss(),n=ss(e*i,s*i);return this._drawOnCanvas(t,n,i),Promise.resolve().then(()=>n)}_computeWidgetList(t){const e=[];return ik.forEach(({name:s,isNode:i})=>{const n=this._computeWidget(t,s,i);n&&e.push(n)}),e}_computeWidget(t,e,s){const i=this._computePropertyMapping(t,e,s);if(i){if(e!=="icon.content")return i;const n=this._getRulesForAttribute(s,"icon.font"),r=this._getRulesForAttribute(s,"icon.style");let o=null,a=null;if(n.length||(o="Arial",a="normal"),typeof n[0]=="string"&&(o=n[0],a=r[0]),o&&a)return i.iconFont=o,i.iconFontStyle=a,i}return null}_computePropertyMapping(t,e,s){const[i]=this._getRulesForAttribute(s,e),n=i&&i.mapping,r=n&&n.getValues(s);if(n&&r){const o=n.getField(),a={};return ii(r,(l,d)=>{l!==void 0&&d!=="undefined"&&(a[l]=a[l]||[],a[l].push(d))}),Object.keys(a).length===0?null:{isNode:s,title:t.titleFunction(o,e),styleProperty:e,dataProperty:o,mapping:a,height:Fk(a,e,s,t)}}return null}_getRulesForAttribute(t,e){return this._modules.styleRules.getRuleList().map(s=>{const i=s.getDefinition();return Me(t?i.nodeAttributes:i.edgeAttributes,e)}).filter(Xs).sort((s,i)=>s.mapping&&i.mapping?0:s.mapping?-1:1)}},tf={layer:iy,outerStroke:{color:Ix,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:Lx,minVisibleSize:0}},Uk={layer:iy,color:Ix,text:{backgroundColor:Lx,minVisibleSize:0}},ef={duration:150,easing:"quadradicOut"},Gk=class extends Bt{constructor(){super(...arguments),this._delay=16,this._manualTriggerDetection=!1,this._hovered=null,this._hoveredTextHidden=!1,this._onAnimate=({updatesPositions:t})=>{t&&this._hovered&&this._modules.graphics.isMoving(this._hovered)&&(this._manualTriggerDetection=!0,this._resetHover())},this._onBeforeNewFrame=()=>{if(this._manualTriggerDetection){this._manualTriggerDetection=!1,this._modules.captor.triggerDetection();const t=this._modules.captor.getPointedElement();t&&this._hover(t)}},this._onClear=()=>{this._hovered=null,this._timeout&&this._modules.dom.clearTimeout(this._timeout)},this._resetHover=()=>{this._hovered&&(this._unhover(this._hovered),this._modules.captor.triggerUnhover()),this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}}_setAnimationOptions(t){this._animationOptions={duration:(t==null?void 0:t.duration)!==void 0?t.duration:ef.duration,easing:(t==null?void 0:t.easing)!==void 0?t.easing:ef.easing},t==null||delete t.duration,t==null||delete t.easing}setRate(t){return this._delay=t,this}replaceNullColor(t,e){t&&Me(t,e)===null&&yi(t,e,this._modules.settings.get("backgroundColor"))}updateNodeAttributes(t,e){this._setAnimationOptions(t),this.replaceNullColor(t,"text.backgroundColor"),this._hoverClass.update({nodeAttributes:t,fullOverwrite:e}),this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}updateEdgeAttributes(t,e){this.replaceNullColor(t,"text.backgroundColor"),this.replaceNullColor(t,"text.secondary.backgroundColor"),this._setAnimationOptions(t),this._hoverClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}getHoverClassDefinition(){return this._hoverClass.getDefinition()}onMounted(){this._registerSettings(),this._setAnimationOptions(null),this._hoverExtremityHighlightedClass=this._modules.classes.createClass({name:bh,isBuiltin:!0,nodeAttributes:tf}),this._hoverClass=this._modules.classes.createClass({name:Zr,isBuiltin:!0,nodeAttributes:tf,edgeAttributes:Uk}),this._modules.events.on("mouseover",({target:t})=>t&&this._hover(t)).on("mouseout",({target:t})=>t&&this._unhover(t)).on("animate",this._onAnimate).on("beforeNewFrame",this._onBeforeNewFrame).on("mouseout",this._resetHover).on("clearGraph",this._onClear)}_registerSettings(){this._modules.settings.register("cursor.node","pointer",(t,e)=>{this._hovered&&this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("cursor.edge","pointer",(t,e)=>{this._hovered&&!this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("nodeHover",!0,t=>{!t&&this._hovered&&this._hovered.isNode&&this._unhover(this._hovered)}),this._modules.settings.register("edgeHover",!0,t=>{t||!this._hovered||this._hovered.isNode||this._unhover(this._hovered)})}_updateExtremityHighlightLayer(){const t=this._hoverClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}_removeTimeout(){this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}_hover(t){const e=t.isNode?"nodeHover":"edgeHover";this._modules.settings.get(e)&&t&&(this._removeTimeout(),this._timeout=this._modules.dom.setTimeout(()=>{this._setElementHighlight(!0,t),this._timeout=null},this._delay))}_unhover(t){this._removeTimeout(),this._hovered===t&&(this._setElementHighlight(!1,t),this._hoverExtremityHighlightedClass.clearNodes(),this._hovered=null)}_setElementHighlight(t,e){const s=this._modules.settings.get(e.isNode?"cursor.node":"cursor.edge");if(t?(this._modules.graphics.addCursorStyle(s),e.addClass(Zr,this._animationOptions),this._hovered=e):(this._modules.graphics.removeCursorStyle(s),e.removeClass(Zr,this._animationOptions)),e.isNode){const i=this._modules.graph.getAttribute(e.isNode,"textHidden"),n=e._index;t&&(this._hoveredTextHidden=i.get(n)!==0);const r=!t&&this._hoveredTextHidden;i.set(n,r)}else this._hoverExtremityHighlightedClass.clearNodes(),t&&e.getExtremities().addClass(bh,this._animationOptions)}},Vk=class extends Bt{constructor(){super(...arguments),this.x=0,this.y=0}},jk=class{constructor(t,e){this._nodeMapping={valid:!1,values:{}},this._edgeMapping={valid:!1,values:{}},this._computeMapping=e,this._field=t,this._assignedRules=[]}getValue(t,e){const s=t.isNode,i=s?this._nodeMapping:this._edgeMapping;i.valid||(i.values=this._computeMapping(s),i.valid=!0);const n=t.getData(this._field);return Array.isArray(n)?e==="color"?n.map(r=>i.values[r]):i.values[n[0]]:i.values[n]}markAsInvalid(){this._nodeMapping.valid=!1,this._edgeMapping.valid=!1}getValues(t){return t?this._nodeMapping.values:this._edgeMapping.values}getField(){return this._field}isAssignedTo(t){return this._assignedRules.find(e=>e===t)}getAssignedRules(){return this._assignedRules.slice()}assignTo(t){this.isAssignedTo(t)||this._assignedRules.push(t)}unAssignTo(t){this._assignedRules=this._assignedRules.filter(e=>e!==t)}};function Nb(t,e,s){const i=(e?t.getNodes():t.getEdges()).getData(s),n={};return i.forEach(r=>{if(!Array.isArray(r))return n[r]=1;r.forEach(o=>n[o]=1)}),"undefined"in n&&delete n[void 0],Object.keys(n).sort()}function Hk(t,e,s,i){const{values:n={},fallback:r}=s,o=Nb(t,i,e),a={};let l=0;for(let d=0;d<o.length;++d){const h=o[d];h in n?a[h]=n[h]:(a[h]=r[l],l=(l+1)%r.length)}return a}function Wk(t,{nbSlices:e,minValue:s,maxValue:i}){if(Array.isArray(t))return t.slice();const{min:n=s,max:r=i}=t,o=(r-n)/e,a=[];for(let l=1;l<e;++l)a.push(n+o*l);return a}function Xk(t,e){if(Array.isArray(t))return t;const{min:s,max:i}=t,n=e.length+1,r=(i-s)/e.length,o=[];for(let a=0;a<n;a++)o.push(s+a*r);return o}function Yk(t,e,s,i){const{fallback:n,stops:r={},values:o,reverse:a}=s,l=Nb(t,i,e);let d=1/0,h=-1/0;for(let m=0;m<l.length;m++){const _=+l[m];Jl(_)&&(d=Math.min(d,_),h=Math.max(h,_),l[m]=_)}const u={};if(!isFinite(d)){for(let m=0;m<l.length;m++)u[l[m]]=n;return u}const c=Wk(r,{nbSlices:Array.isArray(o)?o.length:o.nbSlices,minValue:d,maxValue:h}),g=Xk(o,c);a&&g.reverse();for(let m=0;m<l.length;++m){const _=l[m];if(isFinite(_)){let f=0;for(;f<c.length&&c[f]<=_;)f+=1;u[_]=g[f]}else u[_]=n}return u}var $k=class extends Bt{constructor(){super(...arguments),this._mappingList=[]}onMounted(){this._modules.events.on(["addStyleRule","updateStyleRule"],({rule:t,options:e})=>{const s=e.nodeAttributes&&typeof e.nodeAttributes!="function"?e.nodeAttributes:{},i=e.edgeAttributes&&typeof e.edgeAttributes!="function"?e.edgeAttributes:{};[...$r(s),...$r(i)].forEach(n=>{n&&this._recursiveGetMapping(n).forEach(r=>r.assignTo(t.id))})}).on("removeStyleRule",({rule:t})=>{this._mappingList.forEach(e=>e.unAssignTo(t.id))}).on(["addNodes","addEdges","updateNodeData","updateEdgeData","removeNodes","beforeRemoveEdges","excludedStateChange","clearGraph"],()=>{this._mappingList.forEach(t=>{const e=t.getAssignedRules();t.markAsInvalid(),e.forEach(s=>this._modules.styleRules.refreshRule(s))}),this._modules.legend.refresh()})}_recursiveGetMapping(t,e=[]){if(!t)return e;if(t.mapping)return e.push(t.mapping),e;if(typeof t!="object")return e;const s=$r(t).map(i=>this._recursiveGetMapping(i));return e.concat(...s)}createMapping({field:t,values:e={},fallback:s}={field:""}){if(t=bn(t),Array.isArray(s)?s.length===0&&(s=[void 0]):s=[s],!vn(e))throw new Error('"mapping" should be an object');return this._createMappingFunction(Hk,t,{values:e,fallback:s})}createSlices({field:t,fallback:e,stops:s={},values:i,reverse:n=!1}={field:"",values:[]}){if(t=bn(t),Array.isArray(i)||i.nbSlices||(i.nbSlices=7),Array.isArray(s)&&Array.isArray(i)&&s.length!==i.length-1)throw new Error("there should be exactly one more value that stops");return this._createMappingFunction(Yk,t,{fallback:e,stops:s,values:i,reverse:n})}_createMappingFunction(t,e,s){const i=new jk(e,r=>t(this._modules.graph,e,s,r));this._mappingList.push(i);const n=(r,o,a)=>i.getValue(r,a);return n.mapping=i,n}createTemplate(t){if(typeof t!="string")throw new TypeError('"template" should be a string');const e=[];let s=0,i=!1;for(;!i;){let n=-1;const r=t.indexOf("{{",s);r!==-1&&(n=t.indexOf("}}",r+2)),n!==-1?(e.push(t.substring(s,r)),e.push(t.substring(r+2,n)),s=n+2):(e.push(t.slice(s)),i=!0)}return function(n){let r=e[0];for(let o=1;o<e.length;o+=2)r+=n.getData(e[o]),r+=e[o+1];return r}}},sf=t=>t.stopPropagation(),qk=(t,e)=>{e.style.position="absolute",e.style.left="0",e.style.top="0",t.appendChild(e)},Zk=t=>e=>{for(;t.firstChild;)t.removeChild(t.firstChild);for(let s=0;s<e.length;++s)qk(t,e[s])},Jk=(t,e)=>{const s=document.createElement("img");return new Promise(i=>{s.addEventListener("load",()=>{e.drawImage(s,0,0,e.canvas.width,e.canvas.height),i(e)});const n=`data:image/svg+xml;base64,${btoa(new XMLSerializer().serializeToString(t))}`;s.src=n})},Kk=class extends Bt{constructor(){super(...arguments),this._elements=[],this._layers=[],this.readyCallbacks=[],this.render=(t,e,s,i)=>{const n=i&&i.pixelRatio?i.pixelRatio:Ss(),{zoom:r,x:o,y:a,width:l,height:d}=i||this._modules.camera.getView();if(r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=n*r;s.noClear||t.clearRect(0,0,l*n,d*n),s.isStatic||(t.save(),t.translate(l*n/2,d*n/2),t.rotate(i?-(i.angle||0):-this._modules.camera.getAngle()),t.translate(-o*h,-a*h),t.scale(h,h)),e(t),s.isStatic||t.restore()},this.createCanvas=(t,e)=>{const{width:s,height:i}=this._modules.camera.getSize(),n=e.canvas||ss(s,i),r=e.ctx||n.getContext("2d"),o=(h=t)=>{r&&this.render(r,h,e)},a=()=>{const{width:h,height:u}=this._modules.camera.getSize(),c=Ss();n.width=h*c,n.height=u*c,n.style.width=`${h}px`,n.style.height=`${u}px`,o()};let l,d;if(e.isStatic)this._modules.events.on("resize",a),l=()=>this._modules.events.off(a);else{let h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom(),c=!1;const g=0;let m;const _=500,f=()=>{c||(o(),c=!0,h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom())},p=()=>{c||f();const{x:b,y:v}=this._modules.camera.getCenter(),E=b-h.x,A=v-h.y,S=-E*u,T=-A*u,L=this._modules.camera.getZoom()/u,I=-this._modules.camera.getAngle();n.style.transform=`
          scale(${L})
          rotate(${-I}rad)
          translateX(${S}px)
          translateY(${T}px)
          rotate(${I}rad)
        `.replace(/\n/g,"")};d=()=>!c||(o(),c=!1,n.style.transform="scale(1) translateX(0px) translateY(0px)",!1);const x=b=>{m&&clearTimeout(m),f()},y=b=>{Date.now()<g&&m&&clearTimeout(m),m=setTimeout(d,b.duration+_),f()};this._modules.events.on("dragStart",x).on("zoomStart",y).on("dragEnd",d).on(["viewChanged","zoom","rotate","move","animate"],p),this._modules.dom.addDirectWindowEventListener("resize",d),this._modules.events.on("resize",a),l=()=>{this._modules.events.off(a).off(x).off(y).off(d).off(p),this._modules.dom.removeDirectWindowEventListener("resize",d)}}return n.style.touchAction="none",n.style.pointerEvents="none",a(),{element:n,removeListeners:l,refresh:h=>{d&&!d()||o(h)},clear:()=>r==null?void 0:r.clearRect(0,0,n.width,n.height)}},this.createSVG=t=>{const{element:e}=t;e.style["pointer-events"]="none";const s=()=>{t.draw(t.element)},i=n=>{let{zoom:r,x:o,y:a,width:l,height:d}=n||this._modules.camera.getView();if(l=Math.floor(l),d=Math.floor(d),r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=l/2/r,u=d/2/r,c=Math.cos(-this._modules.camera.getAngle()),g=Math.sin(-this._modules.camera.getAngle()),m=c*o-g*a-h,_=g*o+c*a-u,f=l/r,p=d/r;e.style.width=`${l}px`,e.style.height=`${d}px`,e.setAttribute("width",`${l}`),e.setAttribute("height",`${d}`),e.setAttribute("viewBox",`${m} ${_} ${f} ${p}`)};return this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],()=>i()),e.addEventListener("mousemove",sf),i(),s(),{element:e,removeListeners:()=>{this._modules.events.off(i)},updateTransformation:i,refresh:s}},this._createOverlay=t=>{const e=()=>{const{element:n,position:r}=t,{zoom:o,x:a,y:l,width:d,height:h}=this._modules.camera.getView();if(o===void 0||a===void 0||l===void 0||d===void 0||h===void 0)return null;const u=o,c=d/2,g=h/2,m=-this._modules.camera.getAngle(),_=(r.x-a)*u,f=(r.y-l)*u;n.style.transformOrigin="top left",n.style.transform=`translate(${c}px, ${g}px) rotate(${m}rad) translate(${_}px, ${f}px) ${t.scaled?`scale(${u}, ${u})`:""}`};this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],e);const{element:s,size:i}=t;return i&&(s.style.width=`${i.width}`,s.style.height=`${i.height}`),s.addEventListener("mousemove",sf),e(),{element:s,removeListeners:()=>{this._modules.events.off(e)},updateTransformation:e}},this.addLayer=(t,e="layer",s=this._elements.length)=>{const i=typeof t=="string"?lh(t):t;this._elements.push(i);const n={element:i};return n.type=e,n.getLevel=()=>this._elements.indexOf(i),n.moveTo=r=>(this._elements.splice(r,0,this._elements.splice(n.getLevel(),1)[0]),this._updateDom(this._elements),n),n.moveUp=()=>n.moveTo(n.getLevel()+1),n.moveDown=()=>n.moveTo(n.getLevel()-1),n.moveToTop=()=>n.moveTo(this._elements.length-1),n.moveToBottom=()=>n.moveTo(0),n.destroy=()=>this._removeLayer(n),n.hide=()=>(n.element&&(n.element.style.visibility="hidden"),n),n.show=()=>(n.element&&(n.element.style.visibility="visible"),n),n.isHidden=()=>n.element.style.visibility==="hidden",n.setOpacity=r=>(n.element&&(n.element.style.opacity=r.toString()),n),n.getOpacity=()=>parseFloat(n.element.style.opacity||"1"),n.setPosition=r=>{if(n.element){const o=n.element.style;o.left=`${r.x}px`,o.top=`${r.y}px`}return n},n.setSize=r=>{if(n.element&&r){const{width:o,height:a}=r,l=n.element.style;l.width=`${o}px`,l.height=`${a}px`}return n},n.moveTo(s),this._layers.push(n),n},this.addCanvasLayer=(t,e={isStatic:!1,noClear:!1},s=this._elements.length)=>{const i=this.createCanvas(t,e),{element:n,removeListeners:r,refresh:o,clear:a}=i,l=this.addLayer(n,"canvas",s);return n.classList.add("ogma-canvas-layer"),l.destroy=()=>this._removeLayer(l,r),l.refresh=o,l.clear=a,l.draw=t,l.options=e,l},this.addOverlay=(t,e=this._elements.length)=>{typeof t.element=="string"&&(t.element=lh(t.element)),t.scaled=t.scaled===void 0||t.scaled;const s=this._createOverlay(t),{element:i,removeListeners:n,updateTransformation:r}=s,o=this.addLayer(i,"overlay",e);return o._onViewChange=r,o._onDestroy=n,o.destroy=()=>this._removeLayer(o,n),o.setPosition=a=>(t.position=a,r(),o),t.size&&o.setSize(t.size),o},this.addSVGLayer=(t,e=this._elements.length)=>{const s=this.createSVG(t),{element:i,refresh:n,removeListeners:r,updateTransformation:o}=s,a=this.addLayer(i,"svg",e);return a._onViewChange=o,a._onDestroy=r,a.destroy=()=>this._removeLayer(a,r),a.refresh=n,a}}canvasToImage(t,e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");this.render(i,t.draw,$t(ct({},t.options),{noClear:!0}),$t(ct({},e),{pixelRatio:1}));const n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttribute("href",s.toDataURL("image/png")),n.setAttribute("width",s.width),n.setAttribute("height",s.height),n}exportPNG(t,e,s){const i=t.getContext("2d");let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?(this.render(i,r.draw,$t(ct({},r.options),{noClear:!0}),s),Promise.resolve()):(r._onViewChange&&r._onViewChange(s),Jk(r.element,i)))}),n}exportSVG(t,e,s,i){let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?Promise.resolve(this.canvasToImage(r,s)):(r._onViewChange&&r._onViewChange(s),r.element.cloneNode(!0))).then(o=>i?t.insertBefore(o,t.querySelector(".ogma-nodes").parentNode||t.firstChild):t.appendChild(o))}),n}export(t){const e=this._layers.sort((n,r)=>n.getLevel()-r.getLevel()).filter(n=>n.type==="canvas"||n.type==="svg"),s=this.ogmaLayer?this.ogmaLayer.getLevel():0,i=t.below?e.filter(n=>n.getLevel()<s):e.filter(n=>n.getLevel()>s);return t.canvas?this.exportPNG(t.canvas,i,t.view):this.exportSVG(t.svg,i,t.view,t.below)}onMounted(){const t=this._modules.graphics.getDomElement();this._updateDom=Zk(t);const e=t.firstChild;e&&(this.ogmaLayer=this.addLayer(e)),this.runCallbacks()}runCallbacks(){this.ogmaLayer&&(this.readyCallbacks.forEach(t=>t()),this.readyCallbacks=[])}whenReady(t){this.readyCallbacks.push(t),this.ogmaLayer&&this.runCallbacks()}_removeLayer(t,e){return t.element&&t.element.parentNode&&(this._elements.splice(t.getLevel(),1),e&&e(),t.element=null,this._updateDom(this._elements)),this._layers=this._layers.filter(s=>s!==t),t}destroy(){this._elements=[]}},Qk=class extends Bt{onMounted(){const t=this._modules.graph;this._nodeList=t.getNodeAttribute("object"),this._edgeList=t.getEdgeAttribute("object"),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target"),this._excludedList=t.getEdgeAttribute("excluded"),this._virtualList=t.getEdgeAttribute("virtual")}shortestPath(t={source:void 0,target:void 0}){const{source:e,target:s,directed:i=!1,edges:n=this._ogma.getEdges(),nodes:r=this._ogma.getNodes(),edgeCostFunction:o=()=>1,heuristicFunction:a=()=>0}=t,l=n.reduce((_,f)=>(_[f._index]=!0,_),{}),d=r.reduce((_,f)=>(_[f._index]=!0,_),{}),h=this._modules.graph.getNode(e),u=this._modules.graph.getNode(s);if(!h)throw new Error("the source is not a node");if(!u)throw new Error("the target is not a node");const c=h._index,g=u._index;d[c]=!0,d[g]=!0;let m=null;if(c===g)m={nodes:h.toList(),edges:this._modules.graph.edgeList()};else{const _=this._modules.graph.getNodeMaxIndex()+1,f=new Int32Array(_),p=new Float32Array(_),x=new Float32Array(_),y=new Set,b=new Yf(x);for(p.fill(1/0),x.fill(1/0),f.fill(-1),b.add(c),p[c]=0,x[c]=a(h,u);!b.isEmpty();){const v=b.removeMin();if(v===g){m=this._constructPath(f,c,g);break}y.add(v);const E=this._modules.graph.getAdjacentDirections(v);if(E)for(let A=0;A<E.length;++A){const S=E[A],T=this._modules.graph.getEdgeIndexesInDirection(S);let L=-1,I=0,R=-1;for(let z=0;z<T.length;++z){const j=T[z],C=this._sourceList.get(j),w=this._targetList.get(j);if(C===w||!d[C]||!d[w]||i&&v!==C||!l[j])continue;const H=o(this._edgeList.get(j));(L===-1||H<I)&&(L=j,I=H,R=C===v?w:C)}if(R!==-1||y.has(R)){const z=p[v]+I;if(!b.has(R)||z<p[R]){const j=this._nodeList.get(v);f[R]=L,p[R]=z,x[R]=z+a(j,u),b.add(R)}}}}}return Promise.resolve(m)}_constructPath(t,e,s){const i=[s],n=[];let r=s;for(;r!==e;){const o=t[r],a=this._sourceList.get(o),l=this._targetList.get(o);r=r===a?l:a,i.push(r),n.push(o)}return i.reverse(),n.reverse(),{nodes:this._modules.graph.nodeList(new Uint32Array(i)),edges:this._modules.graph.edgeList(new Uint32Array(n))}}detectCycle(t,e){const s=e.getSource(),i=e.getTarget(),n=Vf(t._indexes,s._indexes,i._indexes);return n?this._modules.graph.nodeList(new Uint32Array(n)).dedupe():this._modules.graph.nodeList()}getAllSimpleCycles(t,e){const s=e.getSource(),i=e.getTarget();return new Hf(t._indexes,s._indexes,i._indexes).getCycles().map(n=>this._modules.graph.nodeList(new Uint32Array(n)))}minimumSpanningTree(t,e,s){const i=this._modules.graph;t=i.getNodes(t),e=i.getEdges(e);const n=new Set;t.forEach(l=>n.add(l._index));const r=i.getConnectedComponents(t,{filter:l=>n.has(l),internalIndexes:!0}),o={};r.forEach((l,d)=>l.forEach(h=>o[h]=d));const a=[];return e.forEach(l=>{const d=o[l.getSource()._index];d!==void 0&&(a[d]===void 0&&(a[d]=[]),a[d].push(l._index))}),r.map((l,d)=>{const h=Wf(l,a[d]||[],u=>i.edge(u).getSource()._index,u=>i.edge(u).getTarget()._index,s?u=>s(i.edge(u)):void 0);return{nodes:i.nodeList(new Uint32Array(l)),edges:i.edgeList(new Uint32Array(h))}})}bfs({root:t,onNode:e,onEdge:s=Kt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.unshift(h)})}}}dfs({root:t,onNode:e,onEdge:s=Kt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.push(h)})}}}betweenness({nodes:t,edges:e,directed:s,normalized:i}){const n=this._ogma.getNodes().subtract(t),r=this._ogma.getEdges().subtract(e).concat(n.fastGetAdjacentElements().edges).dedupe();return Xf({adjacency:t.map(o=>{const a=this._ogma.edgeList(this._ogma.modules.graph.topology.getAdjacentElements(!1,o.toList()._indexes,{direction:s?"out":"both"})).subtract(r).dedupe();return{id:o._index,adj:a.map(l=>l.getSource()._index===o._index?l.getTarget()._index:l.getSource()._index)}}),directed:s,normalized:i})}},nf=(t,e)=>{if(!t)throw new Error("Traversal options are required");if(typeof t.onNode!="function")throw new Error("onNode callback is required");if(t.root=e.getNode(t.root),!t.root)throw new Error(`Root node '${t.root}' does not exist`);return t},Ca=()=>({nodes:void 0,edges:void 0}),tD=class extends ve{constructor(){super(...arguments),this.shortestPath=t=>this._ogma.modules.algorithms.shortestPath(t),this.hasCycle=t=>{const{nodes:e,edges:s}=t||Ca();return this.detectCycle({nodes:e,edges:s})!==null},this.getAllSimpleCycles=t=>{let{nodes:e,edges:s}=t||Ca();return e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0})),this._ogma.modules.algorithms.getAllSimpleCycles(e,s)},this.detectCycle=t=>{let{nodes:e,edges:s}=t||Ca();e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0}));const i=this._ogma.modules.algorithms.detectCycle(e,s);return i.size?i:null},this.minimumSpanningTree=t=>{const{nodes:e,edges:s,edgeCostFunction:i}=t||$t(ct({},Ca()),{edgeCostFunction:void 0});return this._ogma.modules.algorithms.minimumSpanningTree(e,s,i)},this.dfs=t=>this._ogma.modules.algorithms.dfs(nf(t,this._ogma.modules.graph)),this.bfs=t=>this._ogma.modules.algorithms.bfs(nf(t,this._ogma.modules.graph)),this.betweenness=(t={})=>(t={nodes:t.nodes||this._ogma.getNodes(),edges:t.edges||this._ogma.getEdges(),directed:t.directed!==void 0&&t.directed,normalized:t.normalized===void 0||t.normalized},this._ogma.modules.algorithms.betweenness(t)),this.getMinimumEnclosingCircle=t=>{if(!t||t.size===0)throw new Error("getMinimumEnclosingCircle: no nodes provided");const e=t.getAttribute("x"),s=t.getAttribute("y"),i=t.getAttribute("radius"),[n,r,o]=wu(e,s,i);return{x:n,y:r,radius:o}},this.circlePack=({nodes:t,margin:e=0,origin:s={x:0,y:0},duration:i=0,easing:n="linear",sort:r})=>{if(!t||t.size===0)throw new Error("circlePack: no nodes provided");let o=t.map((l,d)=>({index:d,radius:+l.getAttribute("radius")+e,id:l.getId()}));if(r)if(r==="asc")o=o.sort((l,d)=>d.radius-l.radius);else if(r==="desc")o=o.sort((l,d)=>l.radius-d.radius);else{if(typeof r!="function")throw new Error("circlePack: invalid sort option");o=o.sort((l,d)=>r(t.get(l.index),t.get(d.index)))}if(s&&(!isFinite(s.x)||!isFinite(s.y)))throw new Error("circlePack: invalid origin");const a=Pf(o,s.x,s.y).reduce((l,{index:d,x:h,y:u})=>(l[d]={x:h,y:u},l),new Array(t.size));return t.setAttributes(a,{duration:i,easing:n})}}},eD=K0;const Ye=-1,El="dragging",Al="dragstart",qi="dragend",gu="select",mu="unselect",sD="hover",iD="unhover",_u="remove",fu="add",nD="cancelDrawing",pu="update",rD="link";let Kl=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");const Eo={strokeType:"plain",strokeColor:"black",strokeWidth:1,head:"none",tail:"none"},rf={id:0,type:"Feature",properties:{type:"arrow",style:{...Eo}},geometry:{type:"LineString",coordinates:[[0,0],[100,100]]}},Cc=(t=0,e=0,s=0,i=0,n={...Eo})=>({id:Kl(),type:"Feature",properties:{type:"arrow",style:{...Eo,...n}},geometry:{type:"LineString",coordinates:[[t,e],[s,i]]}}),oD="http://www.w3.org/2000/svg";function no(t){return document.createElementNS(oD,t)}function Pb(t){return t.geometry.bbox||aD(t),t.geometry.bbox}function fi(t){const e=Pb(t);return{width:e[2]-e[0],height:e[3]-e[1]}}function gi(t){const e=Pb(t);return{x:e[0],y:e[1]}}function aD(t){const[e,s]=t.geometry.coordinates[0][0],[i,n]=t.geometry.coordinates[0][2];t.geometry.bbox=[e,s,i,n]}function lD(t,e,s,i,n){t.geometry.bbox=[e,s,e+i,s+n],t.geometry.coordinates=[[[e,s],[e+i,s],[e+i,s+n],[e,s+n],[e,s]]]}function ro(t){const[e,s]=t.geometry.coordinates[0];return{x:e,y:s}}function Ma(t,e){const[s,i]=t.geometry.coordinates[e==="start"?0:1];return{x:s,y:i}}function Sl(t){const[e,s]=t.geometry.coordinates[1];return{x:e,y:s}}function Fb(t,e,s){t.geometry.coordinates[0]=[e,s]}function kb(t,e,s){t.geometry.coordinates[1]=[e,s]}function wl(t){return{start:ro(t),end:Sl(t)}}function zn(t,e,s,i){e==="start"?Fb(t,s,i):kb(t,s,i)}const Db=t=>parseInt(t.getAttribute("data-handle-id")||"-1");function dD(t){return Array.isArray(t)&&t.length===2&&t.every(isFinite)}function hD(t,e,s,i){for(let n=0;n<t.coordinates.length;n++){const r=t.coordinates[n];if(dD(r))r[0]=s+(r[0]-s)*e,r[1]=i+(r[1]-i)*e;else for(let o=0;o<r.length;o++){const a=r[o];a[0]=s+(a[0]-s)*e,a[1]=i+(a[1]-i)*e}}return t}function Na(t,e,s){const i=Math.atan2(t.y-e.y,t.x-e.x);return{x:e.x+s*Math.cos(i),y:e.y+s*Math.sin(i)}}function yu(t,e){if(!e)return{x:t.clientX,y:t.clientY};const s=e.getBoundingClientRect();return{x:t.clientX-s.left-e.clientLeft,y:t.clientY-s.top-e.clientTop}}const yn=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),sr=t=>Math.sqrt(t.x*t.x+t.y*t.y),Rb=t=>({x:-t.x,y:-t.y}),Ob=t=>{const e=sr(t);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}},Kn=(t,e)=>({x:t.x+e.x,y:t.y+e.y}),zb=(t,e)=>({x:t.x*e,y:t.y*e}),Pa=(t,e)=>({x:t.x*e.x,y:t.y*e.y}),Rs=(t,e)=>{const s=Math.sin(e),i=Math.cos(e);return{x:t.x*i-t.y*s,y:t.x*s+t.y*i}},uD=(t,e)=>({x:t.x/e,y:t.y/e}),of=(t,e)=>t.x*e.x+t.y*e.y;function Bb(t,e=5,s=30){var a;const{start:i,end:n}=wl(t),r=yn(n,i),o=t.properties.style&&t.properties.style.strokeWidth?(a=t.properties.style)==null?void 0:a.strokeWidth:0;return Math.min(s,Math.max(3*o,sr(r)*.1,e))}function af(t,e,s,i){const n=zb(Rb(Ob(e)),i);if(!s||s==="none")return"";const r=Kn(t,Rs(n,Math.PI/8)),o=Kn(t,Rs(n,-Math.PI/8)),a=`${t.x} ${t.y}`;return`M ${r.x} ${r.y} L ${a} ${o.x} ${o.y} ${s==="arrow"?"":`${r.x} ${r.y}`}`}function cD(t,e,s,i,n){const{start:r,end:o}=wl(t),{tail:a,head:l,strokeColor:d,strokeWidth:h}=t.properties.style||s,u=yn(o,r),c=Bb(t,i,n),g=no("path");g.setAttribute("data-annotation",`${t.id}`),g.setAttribute("data-annotation-type","arrow");const m=l==="arrow-plain"||a==="arrow";g.setAttribute("stroke",d||"none"),g.setAttribute("stroke-width",`${h}`),g.setAttribute("fill",m?d||"":"none"),g.setAttribute("stroke-linecap","round"),g.setAttribute("stroke-linejoin","round");const _=af(r,Rb(u),a,c),f=af(o,u,l,c),p=_+`M ${r.x} ${r.y} ${o.x} ${o.y}`+f;g.setAttribute("d",p),e.appendChild(g)}var gD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ub(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Gb={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}function r(l,d,h,u,c){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new n(h,u||l,c),m=s?s+d:d;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],g]:l._events[m].push(g):(l._events[m]=g,l._eventsCount++),l}function o(l,d){--l._eventsCount===0?l._events=new i:delete l._events[d]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(s?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},a.prototype.listeners=function(d){var h=s?s+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,g=u.length,m=new Array(g);c<g;c++)m[c]=u[c].fn;return m},a.prototype.listenerCount=function(d){var h=s?s+d:d,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(d,h,u,c,g,m){var _=s?s+d:d;if(!this._events[_])return!1;var f=this._events[_],p=arguments.length,x,y;if(f.fn){switch(f.once&&this.removeListener(d,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,h),!0;case 3:return f.fn.call(f.context,h,u),!0;case 4:return f.fn.call(f.context,h,u,c),!0;case 5:return f.fn.call(f.context,h,u,c,g),!0;case 6:return f.fn.call(f.context,h,u,c,g,m),!0}for(y=1,x=new Array(p-1);y<p;y++)x[y-1]=arguments[y];f.fn.apply(f.context,x)}else{var b=f.length,v;for(y=0;y<b;y++)switch(f[y].once&&this.removeListener(d,f[y].fn,void 0,!0),p){case 1:f[y].fn.call(f[y].context);break;case 2:f[y].fn.call(f[y].context,h);break;case 3:f[y].fn.call(f[y].context,h,u);break;case 4:f[y].fn.call(f[y].context,h,u,c);break;default:if(!x)for(v=1,x=new Array(p-1);v<p;v++)x[v-1]=arguments[v];f[y].fn.apply(f[y].context,x)}}return!0},a.prototype.on=function(d,h,u){return r(this,d,h,u,!1)},a.prototype.once=function(d,h,u){return r(this,d,h,u,!0)},a.prototype.removeListener=function(d,h,u,c){var g=s?s+d:d;if(!this._events[g])return this;if(!h)return o(this,g),this;var m=this._events[g];if(m.fn)m.fn===h&&(!c||m.once)&&(!u||m.context===u)&&o(this,g);else{for(var _=0,f=[],p=m.length;_<p;_++)(m[_].fn!==h||c&&!m[_].once||u&&m[_].context!==u)&&f.push(m[_]);f.length?this._events[g]=f.length===1?f[0]:f:o(this,g)}return this},a.prototype.removeAllListeners=function(d){var h;return d?(h=s?s+d:d,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,t.exports=a})(Gb);var mD=Gb.exports;const Vb=Ub(mD);class jb extends Vb{constructor(s,i){super();Mt(this,"ogma");Mt(this,"elements");Mt(this,"layer");Mt(this,"editor");Mt(this,"selectedId",Ye);Mt(this,"hoveredId",Ye);Mt(this,"ogmaOptions");Mt(this,"shouldDetect");Mt(this,"isDragging");Mt(this,"showeditorOnHover");Mt(this,"_onKeyUp",s=>{s.code===27&&this.selectedId!==Ye?this.unselect():(s.code===46||s.code===8)&&this.selectedId!==Ye&&this._canRemove()&&this.remove(this.selectedId)});Mt(this,"_onClickMouseMove",s=>{if(!s.domEvent||this.isDragging||!this.shouldDetect||s.domEvent.type!=="mousemove"&&s.domEvent.target&&s.domEvent.target.tagName==="a")return;const i=this.ogma.view.screenToGraphCoordinates(s),n=this.shouldDetect||!this.shouldDetect&&+this.selectedId>-1?this.detect(i,0):void 0;s.domEvent.type==="mousemove"?n?this.hover(n.id):this.hoveredId!==Ye&&this.unhover():n?this.select(n.id):this.selectedId!==Ye&&this.unselect()});this.ogma=s,this.elements=[],this.shouldDetect=!0,this.isDragging=!1,this.showeditorOnHover=!0,this.ogmaOptions=s.getOptions(),s.events.on(["click","mousemove"],this._onClickMouseMove).on("keyup",this._onKeyUp).on("frame",()=>{this.refreshEditor(),this.refreshDrawing()}),this.layer=s.layers.addSVGLayer({draw:n=>this.draw(n)}),this.layer.moveToTop(),this.editor=s.layers.addLayer(i),this.editor.hide()}_canRemove(){return!0}add(s){const i=this.getDefaultOptions(),n=Object.assign(s,{id:s.id===void 0?Kl():s.id,type:s.type,properties:{...i.properties,...s.properties||{},style:{...i.properties.style,...s.properties.style||{}}},geometry:{...i.geometry,...s.geometry}});return this.elements.push(n),this.layer.refresh(),this.emit(fu,n),n}updateStyle(s,i){this.updateAnnotation(s,{properties:{style:i}})}updateGeometry(s,i){this.updateAnnotation(s,{geometry:i})}scale(s,i,n,r){this.updateGeometry(s,hD(s.geometry,i,n,r))}update(s,i){const n=this.getById(s);this.updateAnnotation(n,i)}updateAnnotation(s,i){if(!s)return;const n=s.id;Object.keys(i).forEach(r=>{if(r!=="id")if(r==="properties"){const o=i.properties||{style:{}};s.properties={...s.properties||{},...o||{},style:{...s.properties.style||{},...o.style||{}}}}else r==="geometry"?s.geometry={...s.geometry,...i.geometry}:s[r]=i[r]}),n===this.selectedId&&this.refreshEditor(),this.layer.refresh()}getById(s){const i=Number(s);for(let n=0;n<this.elements.length;n++){const r=this.elements[n];if(!(r.id!==s&&r.id!==i))return r}}select(s){const i=this.getById(s);i&&(this.editor.show(),this.selectedId=s,this.refreshEditor(),this.layer.refresh(),this.emit(gu,i))}hover(s){const i=this.getById(s);i&&(this.showeditorOnHover&&this.editor.show(),this.hoveredId=s,this.refreshEditor(),this.layer.refresh(),this.emit(sD,i))}getSelectedFeature(){return this.selectedId===Ye?null:this.getById(this.selectedId)}unselect(){const s=this.getById(this.selectedId);return s&&this.emit(mu,s),this.selectedId=Ye,this.hoveredId===Ye&&this.editor.hide(),this.layer.refresh(),this}unhover(){const s=this.getById(this.hoveredId);return this.emit(iD,s),this.hoveredId=Ye,this.selectedId===Ye&&this.editor.hide(),this.layer.refresh(),this}remove(s){const i=this.getById(s);s===this.hoveredId&&this.unhover(),s===this.selectedId&&this.unselect(),this.elements=this.elements.filter(n=>n.id!==s),i&&this.emit(_u,i),this.layer.refresh()}disableDragging(){this.ogma.setOptions({interactions:{drag:{enabled:!1},pan:{enabled:!1}},detect:{nodes:!1,edges:!1,nodeTexts:!1,edgeTexts:!1}})}restoreDragging(){this.ogma.setOptions(this.ogmaOptions)}enableDetection(){this.shouldDetect=!0}disableDetection(){this.shouldDetect=!1}refreshLayer(){this.layer.refresh()}refreshDrawing(){}getElements(){return[...this.elements]}destroy(){this.ogma.events.off(this._onClickMouseMove).off(this._onKeyUp),this.layer.destroy()}}const lf="handle-line",df="handle-start",hf="handle-end";class _D extends jb{constructor(s,i={}){super(s,`
    <div class="arrow-handle">
      <div id="${lf}" data-handle-id="0" class="handle line"></div>
      <div id="${df}" data-handle-id="1" class="handle point"></div>
      <div id="${hf}" data-handle-id="2" class="handle point"></div>
    </div>
  `);Mt(this,"draggedHandle",Ye);Mt(this,"start",{x:0,y:0});Mt(this,"end",{x:0,y:0});Mt(this,"arrow",{...rf});Mt(this,"startX",0);Mt(this,"startY",0);Mt(this,"minArrowHeight",0);Mt(this,"maxArrowHeight",0);Mt(this,"handles",[]);Mt(this,"onHandleMouseDown",s=>{const i=this.getById(this.selectedId)||this.getById(this.hoveredId);if(!i)return;const{x:n,y:r}=yu(s,this.ogma.getContainer());this.startDragging(i,n,r),this.draggedHandle=Db(s.target)});Mt(this,"onMouseUp",()=>{this.draggedHandle!==-1&&(this.restoreDragging(),this.isDragging=!1,this.draggedHandle=Ye,this.emit(qi,this.arrow))});Mt(this,"onMouseMove",s=>{if(!this.isDragging||this.draggedHandle===Ye)return;const i=this.handles[this.draggedHandle],n=this.ogma.view.getAngle(),{x:r,y:o}=Rs(uD({x:s.clientX-this.startX,y:s.clientY-this.startY},this.ogma.view.getZoom()),n),a=i.id===lf,l=i.id===df,d=i.id===hf;(a||l)&&Fb(this.arrow,this.start.x+r,this.start.y+o),(a||d)&&kb(this.arrow,this.end.x+r,this.end.y+o),this.emit(El,this.arrow,a?"line":l?"start":"end"),this.refreshEditor(),this.layer.refresh()});this.minArrowHeight=i.minArrowHeight||0,this.maxArrowHeight=i.maxArrowHeight||1e6,this.handles=Array.prototype.slice.call(this.editor.element.querySelectorAll(".arrow-handle>.handle")),this.handles.forEach(n=>n.addEventListener("mousedown",this.onHandleMouseDown)),document.addEventListener("mousemove",this.onMouseMove,!0),document.addEventListener("mouseup",this.onMouseUp)}startDrawing(s,i,n=Cc(s,i,s,i,Eo)){var a;this.disableDragging(),this.add(n),this.hoveredId=n.id;const r=this.ogma.view.graphToScreenCoordinates({x:s,y:i}),o=((a=this.ogma.getContainer())==null?void 0:a.getBoundingClientRect())||{left:0,top:0};this.startDragging(this.getById(n.id),r.x+(o==null?void 0:o.left),r.y+o.top),this.draggedHandle=2}cancelDrawing(){this.isDragging&&(this.remove(this.arrow.id),this.emit(qi,this.arrow),this.restoreDragging(),this.isDragging=!1,this.draggedHandle=Ye)}startDragging(s,i,n){this.selectedId!==s.id&&this.select(this.hoveredId),this.arrow=s,this.startX=i,this.startY=n,this.start=ro(this.arrow),this.end=Sl(this.arrow),this.disableDragging(),this.emit(Al,this.arrow),this.isDragging=!0}detect(s,i=0){return this.elements.find(n=>{const{start:r,end:o}=wl(n),a=yn(s,{x:(r.x+o.x)/2,y:(r.y+o.y)/2}),l=yn(o,r),d=sr(l),h=Ob(l),u=Bb(n);return Math.abs(of(h,a))<d/2+i&&Math.abs(of(Rs(h,Math.PI/2),a))<u/2+i})}refreshEditor(){if(+this.selectedId<0&&+this.hoveredId<0)return;const s=this.selectedId!==Ye?this.getById(this.selectedId):this.getById(this.hoveredId),i=wl(s),n=this.ogma.view.graphToScreenCoordinates(i.start),r=this.ogma.view.graphToScreenCoordinates(i.end),[o,a,l]=Array.prototype.slice.call(this.editor.element.querySelectorAll(".handle"));a.style.transform=`translate(${n.x}px, ${n.y}px) translate(-50%, -50%)`,l.style.transform=`translate(${r.x}px, ${r.y}px) translate(-50%, -50%)`;const d={x:(r.x+n.x)/2,y:(r.y+n.y)/2},h=yn(r,n),u=zb(h,1/sr(h)),c=Math.atan2(u.y,u.x);o.style.width=`${sr(h)}px`,o.style.left=`${d.x}px`,o.style.top=`${d.y}px`,o.style.transform=`translate(-50%, -50%) rotate(${c}rad)`}getDefaultOptions(){return rf}draw(s){s.innerHTML="";const i=no("g"),n=this.ogma.view.getAngle();i.setAttribute("transform",`rotate(${-n*(180/Math.PI)})`),this.elements.forEach(r=>cD(r,i,Eo,this.minArrowHeight,this.maxArrowHeight)),s.appendChild(i)}refreshDrawing(){const s=this.ogma.view.getAngle();this.layer.element!==null&&this.layer.element.children[0].setAttribute("transform",`rotate(${-s*(180/Math.PI)})`)}destroy(){super.destroy(),document.removeEventListener("mousemove",this.onMouseMove,!0),document.removeEventListener("mouseup",this.onMouseUp)}}const ir={font:"sans-serif",fontSize:12,color:"black",background:"",strokeWidth:1,strokeColor:"#000",strokeType:"plain"},Wd={id:0,type:"Feature",properties:{type:"text",content:"",style:{...ir}},geometry:{type:"Polygon",coordinates:[[[0,0],[100,0],[100,50],[0,50],[0,0]]]}},uf={handleSize:3.5,placeholder:"Your text..."},Hb=(t=0,e=0,s=100,i=50,n="",r={...ir})=>({id:Kl(),type:"Feature",properties:{type:"text",content:n,style:{...ir,...r}},geometry:{type:"Polygon",coordinates:[[[t,e],[t+s,e],[t+s,e+i],[t,e+i],[t,e]]]}});var Wb={exports:{}};(function(t,e){(function(s,i){t.exports=i()})(gD,()=>(()=>{var s={d:(P,D)=>{for(var W in D)s.o(D,W)&&!s.o(P,W)&&Object.defineProperty(P,W,{enumerable:!0,get:D[W]})},o:(P,D)=>Object.prototype.hasOwnProperty.call(P,D)},i={};function n(P){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},n(P)}s.d(i,{default:()=>We});var r=/^((?:[a-z\d-]+\s+)*)([\d.]+(%|em|px)|(?:x+-)?large|(?:x+-)?small|medium)(?:\s*\/\s*(normal|[\d.]+(%|px|em)?))?(\s.+)?$/,o=/\bsmall-caps\b/,a=/\b(?:italic|oblique)\b/,l=/\bbold(?:er)?\b/,d=13.3333333,h={"xx-small":9,"x-small":10,smaller:13.3333,small:13,medium:16,large:18,larger:19.2,"x-large":24,"xx-large":32};function u(P){var D="",W=this;return W.style&&W.style!=="normal"&&(D+=W.style),W.variant&&W.variant!=="normal"&&(D+=(D?" ":"")+W.variant),W.weight&&W.weight!=="normal"&&(D+=(D?" ":"")+W.weight),W.size&&(D+=(D?" ":"")+W.size+"px",W.height!==W.size&&(D+="/"+W.height+"px")),W.family&&(D+=(D?" ":"")+W.family),P&&(D+="::"+W.baseline),P&&(D+="::"+W.color),D}var c={id:"",family:"sans-serif",height:14,size:12,variant:"",style:"",weight:"",baseline:"",color:null,toString:u,valueOf:u};function g(P){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},W=r.exec(P);D.family=(W[6]||"").trim();var O=h[W[2]]||parseFloat(W[2]);W[3]==="%"?O*=.16:W[3]==="em"?O*=16:W[3]==="pt"&&(O*=d),D.size=O;var Q=parseFloat(W[4]);if(Q!=="normal"&&Q!=="inherit"&&Q?W[5]&&W[5]!=="em"?W[5]==="pt"?D.height=Q*d:W[5]==="%"?D.height=.01*O:D.height=Q:D.height=Q*O:D.height=Math.round(O*(7/6)),o.test(W[1])&&(D.variant="small-caps"),a.test(W[1])&&(D.style="italic"),l.test(W[1]))D.weight="bold";else{var vt=parseInt(/\b(\d+)\b/.exec(W[1]),10);vt>=100&&vt!==400&&(D.weight=vt)}return D}function m(){var P,D,W,O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"12px/14px sans-serif",Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},vt=14,Pt=12,Ct=null,Nt=null,Ot="";if(O&&O.nodeType){var jt=O&&(O.ownerDocument&&O.ownerDocument.defaultView||O.document&&O||O.defaultView),Yt=jt.getComputedStyle(O,null);P=Yt.getPropertyValue("font-family")||"",Pt=parseFloat(Yt.getPropertyValue("font-size")),vt=Yt.getPropertyValue("line-height"),Ct=Yt.getPropertyValue("font-weight"),Nt=Yt.getPropertyValue("font-style"),Ot=Yt.getPropertyValue("font-variant")||""}else if(typeof O=="string"){var Gt=g(O);P=Gt.family,Pt=Gt.size,vt=Gt.height,Ot=Gt.variant,Nt=Gt.style,Ct=Gt.weight}else n(O)==="object"&&(P=O.family,Pt=O.size,vt=O.height,Ot=O.variant,Ct=O.weight,Nt=O.style,D=O.baseline,W=O.color);Q.size&&Q.size<3&&(Pt*=Q.size),vt=vt!=="normal"&&vt?parseFloat(vt):Pt*(7/6),Q.height&&Q.height<3&&(vt*=Q.height);var Vt=Object.create(c);return Vt.family=Q.family||P||"sans-serif",Vt.height=vt??14,Vt.size=Pt??12,Vt.variant=Q.variant||Ot||"",Vt.style=Q.style||Nt||"",Vt.weight=Q.weight||Ct||"",Vt.baseline=D||0,Q.baseline!=null&&(Vt.baseline=Q.baseline),Vt.color=Q.color||W||"",Vt.id=u.call(Vt,!0),Vt}const _={"\n":.28,"\r":.28," ":.28,"":.28,"":.28,"":0,"":.5,"":1,"":.5,"":1,"":.33,"":.25,"":.16,"":.56,"":.28,"":.2,"":.15,"":0,"":.16,"":.22,"":1,"\uFEFF":0};var f,p=function(P){var D=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(100,100)||P&&P.createElement("canvas");if(D&&D.getContext){var W=D.getContext("2d");if(W&&typeof W.measureText=="function")return function(O,Q){return W.font=String(Q),W.measureText(O).width}}}(typeof document<"u"?document:null)||(f={},function(P,D){if(!f[D]){var W=m(D);f[D]=W,/\bmonospace\b/.test(W.family)?W.size*=.6:(W.size*=.45,W.weight&&(W.size*=1.18))}return P.length*f[D].size}),x={},y={trim:!0,collapse:!0};function b(P,D,W){var O=Object.assign({},y,W),Q=String(P);if(!Q)return 0;if(Q in _){var vt=D.id+"/"+Q;return vt in x||(x[vt]=p("_".concat(Q,"_"),D)-p("__",D)),x[vt]}return O.trim&&O.collapse?O.trim?Q=Q.trim():O.collapse&&(Q=Q.replace(/\s+/g," ")):Q=Q.replace(/\n/g," "),p(Q,D)+D.size*(P.tracking||0)}function v(P){return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},v(P)}function E(P,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function");P.prototype=Object.create(D&&D.prototype,{constructor:{value:P,writable:!0,configurable:!0}}),Object.defineProperty(P,"prototype",{writable:!1}),D&&A(P,D)}function A(P,D){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(W,O){return W.__proto__=O,W},A(P,D)}function S(P){var D=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var W,O=L(P);if(D){var Q=L(this).constructor;W=Reflect.construct(O,arguments,Q)}else W=O.apply(this,arguments);return T(this,W)}}function T(P,D){if(D&&(v(D)==="object"||typeof D=="function"))return D;if(D!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(W){if(W===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W}(P)}function L(P){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(D){return D.__proto__||Object.getPrototypeOf(D)},L(P)}function I(P,D){if(!(P instanceof D))throw new TypeError("Cannot call a class as a function")}function R(P,D){for(var W=0;W<D.length;W++){var O=D[W];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(P,(Q=function(vt,Pt){if(v(vt)!=="object"||vt===null)return vt;var Ct=vt[Symbol.toPrimitive];if(Ct!==void 0){var Nt=Ct.call(vt,Pt);if(v(Nt)!=="object")return Nt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(vt)}(O.key,"string"),v(Q)==="symbol"?Q:String(Q)),O)}var Q}function z(P,D,W){return D&&R(P.prototype,D),Object.defineProperty(P,"prototype",{writable:!1}),P}var j=function(){function P(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";I(this,P),this.value=D,this.weight=null,this.style=null,this.font=null,this.href=null,this.sub=!1,this.sup=!1}return z(P,[{key:"clone",value:function(){var D=new P(this.value);return D.value=this.value,D.weight=this.weight,D.style=this.style,D.font=this.font,D.href=this.href,D.sub=this.sub,D.sup=this.sup,D}},{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}}]),P}(),C=function(P){E(W,P);var D=S(W);function W(){return I(this,W),D.apply(this,arguments)}return z(W)}(j),w=function(P){E(W,P);var D=S(W);function W(){return I(this,W),D.apply(this,arguments)}return z(W)}(j),H=function(P){E(W,P);var D=S(W);function W(){return I(this,W),D.apply(this,arguments)}return z(W)}(j),K=/^[\n\r\t\x20\xA0\u2000-\u200B\u205F\u3000]/,it=/^[^\n\r\t\u0020\u2000-\u200B\u205F\u3000]{2,}/,xt=/^[\xA0\u2011\u202F\u2060\uFEFF]/,at=/^(?:[;\xAD%?]|,(?!\d))/,Tt=/^[$\u2212]/;function It(P,D){D!==!1&&(P=P.trim());for(var W,O,Q=[],vt=P.charAt(0),Pt=0,Ct=1,Nt=P.length;Ct<Nt;Ct++){W=P.charAt(Ct),O=P.charAt(Ct+1);var Ot=K.test(vt),jt=K.test(W),Yt=jt||Ot,Gt=void 0;if((Tt.test(W)&&!xt.test(vt)||at.test(vt+O)&&!xt.test(W))&&(Yt=!0),vt!=="-"&&vt!==""&&vt!==""&&vt!==""||((Gt=K.test(P.charAt(Ct-2)))&&!jt&&(Yt=!1),!Gt&&it.test(W+O)&&(Yt=!0)),Yt){var Vt=P.slice(Pt,Ct);/\u00AD$/.test(Vt)?(Q.push(new j(Vt.slice(0,-1))),Q.push(new H)):(Q.push(new j(Vt)),Q.push(new C)),Pt=Ct}vt=W}return Q.push(new j(P.slice(Pt))),Q}const dt={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:""};var bt=/^[\n\r\x20\u2000-\u200B\u205F\u3000]/,Ht=/^<\/([a-zA-Z0-9]+)([^>]*)>/,Qt=/^<([a-zA-Z0-9]+)((?:\s[^=\s/]+(?:\s*=\s*(?:"[^"]+"|'[^']+'|[^>\\s]+))?)+)?\s*(\/?)>(\n*)/,Xt=/^<!--(.+?)-->/,mt=/&(?:#(\d\d{2,})|#x([\da-fA-F]{2,})|([a-zA-Z][a-zA-Z1-4]{1,8}));/g,ft={b:function(P){P.weight="bold"},strong:function(P){P.weight="bold"},i:function(P){P.style="italic"},em:function(P){P.style="italic"},dfn:function(P){P.style="italic"},cite:function(P){P.style="italic"},code:function(P){P.family="monospace"},kbd:function(P){P.family="monospace"},samp:function(P){P.family="monospace"},var:function(P){P.family="monospace"},tt:function(P){P.family="monospace"},sub:function(P){P.sub=!0},sup:function(P){P.sup=!0}},te={div:1,li:1,blockquote:2,h1:2,h2:2,h3:2,h4:2,h5:2,h6:2,ul:2,ol:2,hr:2,p:2};function qt(P){return P.replace(mt,function(D,W,O,Q){if(W||O){var vt=W?10:16;return String.fromCharCode(parseInt(W||O,vt))}return Q in dt?dt[Q]:D})}function se(P){return P&&P.length>1&&(P[0]==='"'&&P[P.length-1]==='"'||P[0]==="'"&&P[P.length-1]==="'")?P.slice(1,-1):P}var ee=/^\s*([^=\s&]+)(?:\s*=\s*("[^"]+"|'[^']+'|[^>\s]+))?/;function $(P){var D,W={};if(P){do if(D=ee.exec(P)){var O=qt(se(D[2]||"")).replace(/[ \r\n\t]+/g," ").trim();if(W[D[1]]=O,(P=P.slice(D[0].length)).length&&/^\S/.test(P[0]))throw new Error("Attribute error")}while(D&&P.length);if(/\S/.test(P))throw new Error("Attribute error")}return W}const et={copyright:"",textcopyright:"",dag:"",textdagger:"",ddag:"",textdaggerdbl:"",guillemotleft:"",guillemotright:"",guilsinglleft:"",guilsinglright:"",ldots:"",dots:"",textellipsis:"",lq:"",P:"",textparagraph:"",pounds:"",textsterling:"",quotedblbase:"",quotesinglbase:"",rq:"",S:"",sim:"~",textasciicircum:"^",textasciitilde:"",texttildelow:"~",textasteriskcentered:"*",textbackslash:"'",textbar:"|",textbardbl:"",textbigcircle:"",textbraceleft:"{",textbraceright:"}",textbullet:"",textdollar:"$",textemdash:"",textendash:"",texteuro:"",eurosym:"",euro:"",textexclamdown:"",textgreater:">",textless:"<",textordfeminine:"",textordmasculine:"",textperiodcentered:"",cdot:"",textquestiondown:"",textquotedblleft:"",textquotedblright:"",textquoteleft:"",textquoteright:"",textquotestraightbase:"",textquotestraightdblbase:"",textregistered:"",textthreequartersemdash:"-",texttrademark:"",texttwelveudash:"-",textunderscore:"_",textvisiblespace:"",gets:"",textleftarrow:"",to:"",textrightarrow:"",textdegree:"",infty:"",triangle:"",triangledown:"",blacktriangle:"",blacktriangledown:"",angle:"",sphericalangle:"",aleph:"",hbar:"",imath:"",jmath:"",ell:"",wp:"",Re:"",Im:"",mho:"",prime:"",emptyset:"",nabla:"",surd:"",partial:"",top:"",bot:"",vdash:"",dashv:"",forall:"",exists:"",nexists:"",neg:"",lnot:"",flat:"",natural:"",sharp:"",backslash:"\\",Box:"",Diamond:"",clubsuit:"",diamondsuit:"",heartsuit:"",spadesuit:"",Join:"",blacksquare:"",bigstar:"",diagdown:"",diagup:"",blacklozenge:"",rfloor:"",lfloor:"",rceil:"",lceil:"",rangle:"",langle:"",sum:"",int:"",oint:"",prod:"",coprod:"",bigcap:"",bigcup:"",bigsqcup:"",bigvee:"",bigwedge:"",bigodot:"",bigotimes:"",bigoplus:"",biguplus:"",alpha:"",beta:"",chi:"",delta:"",epsilon:"",eta:"",gamma:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",omega:"",phi:"",pi:"",psi:"",rho:"",sigma:"",tau:"",theta:"",upsilon:"",xi:"",zeta:"",Alpha:"",Beta:"",Chi:"",Delta:"",Epsilon:"",Eta:"",Gamma:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Omega:"",Phi:"",Pi:"",Psi:"",Rho:"",Sigma:"",Tau:"",Theta:"",Upsilon:"",Xi:"",Zeta:"",aa:"",AA:"",ae:"",AE:"",dh:"",DH:"",dj:"",DJ:"",ij:"",IJ:"",l:"",L:"",ng:"",NG:"",o:"",O:"",oe:"",OE:"",ss:"",SS:"SS",th:"",TH:""};var ht=/^(\^|_|\\[^#$%&~_^\\{}()\s]+)(\{)?/,lt=/^%[^\n]+(?:\n|$)/,rt=/^[^#$%&~_^\\{}]+/,nt=/^\\([&{}$%#_])/,Lt=/(?:\\[\\@,!:;-]|-{2,3}|[!?]`|``?|,,|''?|~|<<|>>)/g,St={"---":"","--":"","!`":"","?`":"","``":"",",,":"","''":"","`":"","'":"","<<":"",">>":"","~":"","\\-":"","\\,":"","\\;":"","\\:":"","\\!":"","\\@":"\uFEFF","\\\\":"\\newline{}"},wt={bf:function(P){P.weight="bold"},it:function(P){P.style="italic"},sl:function(P){P.style="italic"},color:function(P,D){P.color=D},href:function(P,D){P.href=D},"^":function(P){P.sup=!0},_:function(P){P.sub=!0},par:function(P){this.tokens.push(new w,new w)},newline:function(P){this.tokens.push(new w)},url:function(P,D){this.open_context().href=D,this.add_token(new j(D)),this.close_context()}};wt.textsuperscript=wt["^"],wt.textsubscript=wt._,wt.textsl=wt.sl,wt.mathbf=wt.bf,wt.mathit=wt.it,wt.textbf=wt.bf,wt.textit=wt.it,wt.textcolor=wt.color;var Wt=/[\r\n\xA0]+/g;function Ut(P,D){P.sup&&(P.baseline=.45,P.size=.7),P.sub&&(P.baseline=-.3,P.size=.7);var W=D;return(P.style||P.weight||P.baseline||P.color||P.size||P.family)&&(W=m(D,P)),W}function ye(P,D,W){for(var O,Q,vt=P.width;vt+W.width>D&&P.length;)Q=(O=P[P.length-1]).width,O.width>W.width?(O.value=O.value.slice(0,-1),O.width=b(O,O.font),vt+=O.width):P.pop(),vt-=Q;P[P.length-1]instanceof H&&P.pop(),O=P[P.length-1]||O||{},W.font=m(W.font,O.bold,O.italic,""),W.href=P.length?O.href:null,W.rel=P.length?O.rel:null,W.target=P.length?O.target:null,P.push(W)}function me(P){return Math.round(1e6*P)/1e6}function _e(P){return function(D){if(Array.isArray(D))return Ee(D)}(P)||function(D){if(typeof Symbol<"u"&&D[Symbol.iterator]!=null||D["@@iterator"]!=null)return Array.from(D)}(P)||function(D,W){if(D){if(typeof D=="string")return Ee(D,W);var O=Object.prototype.toString.call(D).slice(8,-1);return O==="Object"&&D.constructor&&(O=D.constructor.name),O==="Map"||O==="Set"?Array.from(D):O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O)?Ee(D,W):void 0}}(P)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ee(P,D){(D==null||D>P.length)&&(D=P.length);for(var W=0,O=new Array(D);W<D;W++)O[W]=P[W];return O}var Fe={center:"middle",right:"end"},Zt={middle:.5,center:.5,bottom:1,end:1},de=function(P,D){return!P&&!D||P===D};function Ae(P,D){var W=[],O=D.font(),Q=O.size,vt=O.family,Pt=D.align(),Ct=D.createElement();if(P.length){var Nt=O.height,Ot=D.valign(),jt=D.height()(),Yt=D.width()(0),Gt=!isFinite(Yt)&&P.length===1,Vt=Gt?null:D.x(),M=me(Nt/Q),k=Gt?null:me(Nt/(1.15*Q+(Nt-Q)/2));if(Zt[Ot]&&isFinite(jt)){var N=Ot==="bottom"?1:.5;k+=(jt*N-Nt*P.length*N)/Q}var F=Pt==="justify",U=0;Pt==="right"?U=Yt:Pt==="center"&&(U=Yt/2);for(var X=[],G="tspan",q=null,Y="",B=function(){if(Y){var zt=Ct(G,q,Y);X.push(zt)}G="tspan",q=null,Y=""},V=0,Z=P.length;V<Z;V++){var tt="",ot="",J=0,st=P[V];if(st.length){X=[];for(var _t=0,Et=0,pt=void 0,gt=0,At=st.length;gt<At;gt++){var ut=st[gt],yt=ut.font;ut.whitespace&&_t++,Et+=ut.width,gt&&!ut.tracking&&!J&&de(yt.id,tt)&&de(ut.class,ot)&&de(pt,ut.href)?Y+=ut.value:(B(),Y=ut.value,q={fontFamily:yt.family!==vt?yt.family:null,fontSize:yt.size!==Q?yt.size:null,fontWeight:yt.weight||null,fontStyle:yt.style||null,fontVariant:yt.variant!=="normal"&&yt.variant||null,fill:yt.color||null,baselineShift:yt.baseline?100*yt.baseline+"%":null,className:ut.class||null},J&&(q.dx=me(J),J=0),ut.tracking&&(J=yt.size*ut.tracking),ut.href&&!pt?(pt=ut.href,G="a",q.href=pt,q.rel=ut.rel,q.target=ut.target):pt=null,tt=yt.id,ot=ut.class)}if(B(),Gt)W.push.apply(W,_e(X));else{var Ft=null,Dt=V===Z-1||st[st.length-1]instanceof w;F&&st.length>1&&!Dt&&(Ft=me((Yt-Et)/_t)),W.push(Ct.apply(void 0,["tspan",{wordSpacing:Ft,x:Vt(V)+U,dy:me(V?M:k)+"em"}].concat(_e(X))))}}else W.push(Ct("tspan",{x:Vt(V),dy:me(V?M:k)+"em"},""))}}return Ct.apply(void 0,["text",{fontFamily:vt,fontSize:Q,textAnchor:Fe[Pt]||"start"}].concat(W))}var pe={middle:.5,center:.5,bottom:1,end:1};function ie(P,D,W){if(P.length){W.textBaseline="middle";var O=D.font(),Q=O.height,vt=O.size,Pt=D.valign(),Ct=D.height()(),Nt=D.width()(0),Ot=D.align(),jt=Ot==="justify",Yt=.5*Q,Gt=pe[Pt];if(Gt&&isFinite(Ct)){var Vt=P.length*Q;Yt+=Ct*Gt-Vt*Gt}P.forEach(function(M,k){var N=D.x()(k),F=k*Q+Yt,U=0,X=0;M.forEach(function(Y){Y.whitespace&&U++,X+=Y.width});var G=0,q=k===P.length-1||M[M.length-1]instanceof w;jt&&M.length>1&&!q&&(G=(Nt-X)/U),M.forEach(function(Y){W.font=Y.font;var B=Y.font,V=B.baseline?vt*-B.baseline+.15*vt:0;W.fillStyle=function(ot,J){return ot.color?ot.color:J.href?"#00C":"#000"}(B,Y);var Z=0;if(Ot==="right"?Z+=Nt-X:Ot==="center"?Z+=Nt/2-X/2:Ot==="justify"&&(Y.whitespace||Y instanceof w)&&(N+=G),W.fillText(Y.value,N+Z,F+V),Y.href){W.beginPath(),W.strokeStyle=W.fillStyle;var tt=Math.floor(F+.45*vt)+.5;W.moveTo(N+Z,tt),W.lineTo(N+Z+Y.width,tt),W.stroke()}N+=Y.width})})}}function Le(P){return Le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},Le(P)}function xe(P){for(var D={},W=0;W<P.length;W++){var O=P[W];typeof O!="number"&&O!=null&&(typeof O=="string"?D.text=O:typeof O=="function"?D.fn=O:Le(O)==="object"&&O._groups?D.d3=O:O&&O.nodeType&&O.getContext?D.ctx=O.getContext("2d"):O&&O.fillText&&O.beginPath?D.ctx=O:O&&(D.text=O))}return D}function ke(P){return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},ke(P)}function bs(P,D){for(var W=0;W<D.length;W++){var O=D[W];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(P,(Q=function(vt,Pt){if(ke(vt)!=="object"||vt===null)return vt;var Ct=vt[Symbol.toPrimitive];if(Ct!==void 0){var Nt=Ct.call(vt,Pt);if(ke(Nt)!=="object")return Nt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(vt)}(O.key,"string"),ke(Q)==="symbol"?Q:String(Q)),O)}var Q}var ne=m(),re=function(P){return typeof P=="function"?P:function(){return P}},oe=function(){function P(O){if(function(vt,Pt){if(!(vt instanceof Pt))throw new TypeError("Cannot call a class as a function")}(this,P),this.props={overflow:"ellipsis",lineclamp:null,align:"left",wordBreak:null,valign:"top",width:function(){return 1/0},height:function(){return 1/0},x:function(){return 0},font:null,tAnchor:0,parser:P.defaultparser},O)for(var Q in O)typeof this[Q]=="function"&&this[Q](O[Q])}var D,W;return D=P,W=[{key:"linebreak",value:function(O){var Q=this,vt=this.props.parser(String(O)),Pt=this.font(),Ct=function(Nt,Ot,jt){if(!Nt.length)return[];var Yt=Ot.height(),Gt=Ot.width(),Vt=Ot.overflowLine(),M=Ot.overflowWrap(),k=m(jt,!0,!1),N=isFinite(Yt())?Math.floor(Yt()/jt.height):1/0;if(!Yt()&&!Gt(0)||!N)return[];for(var F=0,U=0,X=0,G=[],q=[],Y=!1;F<Nt.length&&U<N;){var B=Nt[F],V=Ut(B,jt);if(B.width=b(B,V),B.font=V,B.line=U,B.whitespace=B.value in _,B.value&&(B.value=B.value.replace(Wt," ")),!(!X&&B.whitespace||Y&&B.whitespace))if(B instanceof w)X=0,q=[],G.push(F+1),U++;else if(B instanceof C||B instanceof H)q.push({index:F,width:X});else if(B.whitespace||X+B.width<Gt(U))X+=B.width;else if(q.length){var Z=void 0,tt=void 0;do{tt=!0,Z=q.pop();var ot=Nt[Z.index],J=void 0;ot instanceof H&&(J=b("-",ot.font),Z.width+J>Gt(U)&&(tt=!q.length))}while(!tt);G.push(Z.index+1),X=0,U++,F=Z.index,q=[]}else if(M==="break-word"){var st=Gt(U);if(X+B.width>st){var _t=B.clone();do B.value=B.value.slice(0,-1),B.width=b(B,B.font),X+=B.width;while(B.value&&B.width>st);_t.value=_t.value.slice(B.value.length),Nt.splice(F+1,0,new C,_t)}G.push(F+1),X=0,U++}else X+=B.width;F++,Y=B.whitespace}F!==G[G.length-1]&&G.push(F);var Et=0,pt=0,gt=G.map(function(zt){for(var Rt,Jt=Et;(Rt=Nt[Jt])&&(Rt.whitespace||!Rt.value);)Jt++;for(var ae=zt,he=null;ae>Jt&&(Rt=Nt[ae-1])&&(Rt.whitespace||!(Rt.value||Rt instanceof H));)Rt instanceof w&&(he=Rt),ae--;Rt instanceof H&&(Rt.value="-",Rt.width=b("-",Rt.font)),Et=zt;var Ce=Nt.slice(Jt,ae).filter(function(Ze){return Ze.value});return he&&Ce.push(he),Ce.width=Ce.reduce(function(Ze,Es){return Ze+Es.width},0),Ce.width>pt&&(pt=Ce.width),Ce});if(gt.hasLineOverflow=!1,Vt){var At=Vt==="ellipsis"?"":Vt;gt.forEach(function(zt,Rt){var Jt=Gt(Rt);if(zt.width>Jt){var ae=new j(At);ae.font=jt,ae.width=b(At,k),ye(zt,Jt,ae),gt.hasLineOverflow=!0}})}var ut=Ot.overflow()==="ellipsis"?"":Ot.overflow();if(ut&&F!==Nt.length){var yt=Gt(gt.length-1),Ft=gt[gt.length-1],Dt=new j(ut);Dt.font=jt,Dt.width=b(ut,k),ye(Ft,yt,Dt),gt.hasOverflow=!0}else gt.hasOverflow=!1;return gt.font=jt,gt.width=pt,gt}(vt,this,Pt);return Ct.height=Ct.length*Pt.height,Ct.render=function(Nt){return Q.render(Ct,Nt)},Ct.svg=Ct.render,Ct.draw=Ct.render,Ct}},{key:"font",value:function(O){return arguments.length?(this.props.font=m(O),this):this.props.font||m(ne)}},{key:"overflow",value:function(O){return arguments.length?(this.props.overflow=String(O),this):this.props.overflow}},{key:"overflowLine",value:function(O){return arguments.length?(this.props.lineclamp=String(O),this):this.props.lineclamp}},{key:"valign",value:function(O){return arguments.length?(this.props.valign=O,this):this.props.valign}},{key:"align",value:function(O){if(!arguments.length)return this.props.align;var Q=String(O).toLowerCase();return Q==="left"||Q==="start"?(this.props.align="left",this.props.tAnchor=0):Q==="center"||Q==="middle"?(this.props.align="center",this.props.tAnchor=-.5):Q==="end"||Q==="right"?(this.props.align="right",this.props.tAnchor=-1):Q==="justify"&&(this.props.align=O,this.props.tAnchor=0),this}},{key:"overflowWrap",value:function(O){if(!arguments.length)return this.props.overflowWrap||"normal";var Q=String(O).toLowerCase();return Q==="break-word"?this.props.overflowWrap="break-word":Q!=="normal"&&O!=null||(this.props.overflowWrap=null),this}},{key:"width",value:function(O){return arguments.length?(this.props.width=re(O),this):this.props.width}},{key:"height",value:function(O){return arguments.length?(this.props.height=re(O),this):this.props.height}},{key:"x",value:function(O){return arguments.length?(this.props.x=re(O),this):this.props.x}},{key:"parser",value:function(O){if(!arguments.length)return this.props.parser;if(typeof O=="string"){var Q=P[O]||P[O+"parser"];typeof Q=="function"&&(O=Q)}if(typeof O!="function")throw new Error("Unknown parser: "+O);return this.props.parser=O,this}},{key:"createElement",value:function(O){return arguments.length?(this.props.createElement=O,this):this.props.createElement||P.createElement}},{key:"render",value:function(){var O=xe(arguments);return typeof O.text=="string"&&(O.text=this.linebreak(O.text)),O.ctx?ie(O.text,this,O.ctx):Ae(O.text,this)}}],W&&bs(D.prototype,W),Object.defineProperty(D,"prototype",{writable:!1}),P}();function De(P){return De=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},De(P)}function Re(P,D){(D==null||D>P.length)&&(D=P.length);for(var W=0,O=new Array(D);W<D;W++)O[W]=P[W];return O}function Ke(P,D){for(var W=0;W<D.length;W++){var O=D[W];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(P,(Q=function(vt,Pt){if(De(vt)!=="object"||vt===null)return vt;var Ct=vt[Symbol.toPrimitive];if(Ct!==void 0){var Nt=Ct.call(vt,Pt);if(De(Nt)!=="object")return Nt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(vt)}(O.key,"string"),De(Q)==="symbol"?Q:String(Q)),O)}var Q}var cs=function(P){return typeof P=="function"?P:function(){return P}},Oe=function(){function P(O){if(function(vt,Pt){if(!(vt instanceof Pt))throw new TypeError("Cannot call a class as a function")}(this,P),this.props={width:function(){return 1/0},height:function(){return 1/0},rotation:0,vAnchor:0,hAnchor:0},O)for(var Q in O)typeof this[Q]=="function"&&this[Q](O[Q]);this.render=this.render.bind(this)}var D,W;return D=P,W=[{key:"anchor",value:function(O){var Q=this.props,vt=Q.hAnchor,Pt=Q.vAnchor,Ct=Q.width,Nt=Q.height;if(!arguments.length)return[vt*Ct(0),Pt*Nt(0)];if(typeof O=="string"){var Ot=this.props;O.toLowerCase().trim().split(/\s+/).forEach(function(jt){jt==="top"&&(Ot.vAnchor=-0),jt==="middle"&&(Ot.vAnchor=-.5),jt==="bottom"&&(Ot.vAnchor=-1),jt==="left"&&(Ot.hAnchor=-0),jt==="center"&&(Ot.hAnchor=-.5),jt==="right"&&(Ot.hAnchor=-1)})}return this}},{key:"width",value:function(O){return arguments.length?(this.props.width=cs(O),this):this.props.width}},{key:"height",value:function(O){return arguments.length?(this.props.height=cs(O),this):this.props.height}},{key:"rotate",value:function(O){return arguments.length?(this.props.rotation=O,this):this.props.rotation}},{key:"createElement",value:function(O){return arguments.length?(this.props.createElement=O,this):this.props.createElement||P.createElement}},{key:"canvas",value:function(O,Q){var vt,Pt=O.getContext?O.getContext("2d"):O;return Pt.save(),Pt.rotate(this.rotate()*Math.PI/180),Pt.translate.apply(Pt,function(Ct){if(Array.isArray(Ct))return Re(Ct)}(vt=this.anchor())||function(Ct){if(typeof Symbol<"u"&&Ct[Symbol.iterator]!=null||Ct["@@iterator"]!=null)return Array.from(Ct)}(vt)||function(Ct,Nt){if(Ct){if(typeof Ct=="string")return Re(Ct,Nt);var Ot=Object.prototype.toString.call(Ct).slice(8,-1);return Ot==="Object"&&Ct.constructor&&(Ot=Ct.constructor.name),Ot==="Map"||Ot==="Set"?Array.from(Ct):Ot==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ot)?Re(Ct,Nt):void 0}}(vt)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()),Q(Pt),Pt.restore(),Pt}},{key:"render",value:function(){var O=xe(arguments);if(O.d3)return O.d3.attr("transform","rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")"));if(O.ctx)return this.canvas(O.ctx,O.fn);if(O.text){var Q=typeof O.text.render=="function"?O.text.render():O.text;return this.createElement()("g",{transform:"rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")")},Q)}}}],W&&Ke(D.prototype,W),Object.defineProperty(D,"prototype",{writable:!1}),P}(),qe=Object.prototype.hasOwnProperty,vs={};function qs(P){return vs[P]||(vs[P]=P.replace(/([a-z])([A-Z])/g,function(D,W,O){return W+"-"+O.toLowerCase()})),vs[P]}function fe(P,D){if(Array.isArray(D))return D.forEach(function(W){return fe(P,W)});typeof D=="string"&&(D=document.createTextNode(D)),P.appendChild(D)}function Ge(P,D){if(typeof document<"u"){var W=typeof P=="string"?document.createElementNS("http://www.w3.org/2000/svg",P):P;if(D&&W.setAttribute)for(var O in D)qe.call(D,O)&&D[O]!=null&&W.setAttribute(O==="className"?"class":qs(O),D[O]);for(var Q=arguments.length,vt=new Array(Q>2?Q-2:0),Pt=2;Pt<Q;Pt++)vt[Pt-2]=arguments[Pt];return vt!=null&&vt.length&&vt.forEach(function(Ct){fe(W,Ct)}),W}}oe.createElement=Ge,oe.textparser=It,oe.defaultparser=It,oe.htmlparser=function(P){P=String(P||"").trim();for(var D,W,O={weight:null,style:null,sub:!1,sup:!1,href:null,color:null,rel:null,target:null},Q=[],vt=[],Pt=function(Yt){for(var Gt in O)O[Gt]&&(Yt[Gt]=O[Gt]);Q.push(Yt)},Ct=function(Yt){var Gt=Q.length,Vt=te[Yt];if(Gt&&Vt){for(var M=Gt-1;Q[M]&&(Q[M]instanceof C||bt.test(Q[M].value));)M--;for(;Vt&&Q[M]&&Q[M]instanceof w;)M--,Vt--;for(;Vt-- >0;)Q.push(new w)}};P.length;){if(D=/^[^<]+/.exec(P))It(qt(D[0]),!1).forEach(Pt);else if(!(D=Xt.exec(P)))if(D=Ht.exec(P))vt.length&&(O=vt.pop()),Ct(D[1]);else if(D=Qt.exec(P)){var Nt=D[1];Ct(Nt),vt.push(O),O=Object.create(O),ft[Nt]&&ft[Nt](O,"");var Ot=$(D[2]);Nt==="a"&&(Ot.href&&(O.href=Ot.href),Ot.rel&&(O.rel=Ot.rel),Ot.target&&(O.target=Ot.target)),Ot.class&&(O.class=O.class?O.class+" "+Ot.class:Ot.class),Ot.style&&(W=/(?:^|\s|;)color\s*:\s*([^;\s"']+)/.exec(Ot.style))&&W[1]&&(O.color=W[1]),Nt==="br"&&Q.push(new w)}else D=[P.slice(0,1)],Pt(new j(D[0]));P=P.slice(D[0].length)}for(var jt=Q[Q.length-1];jt instanceof w;)Q.pop(),jt=Q[Q.length-1];return Q},oe.latexparser=function(P){P=String(P||"").trim();var D=[0];P=P.replace(/\\verb,(.*?),/,function(N,F){return D.push(F),"\\verb,"+(D.length-1)+","}).replace(/\\\\\n/g,function(){return"\\\\"}).replace(Lt,function(N,F,U){return U.charAt(F-1)==="\\"?N:St[N]}).replace(/\n\s+/g,function(N){return/\n/.test(N.slice(1))?"\\par ":N}).replace(/\\symbol\{(\d+)\}/,function(N,F,U,X){return X.charAt(U-1)==="\\"?N:String.fromCharCode(1*F)}).replace(/(^|[^\\])(\^|_)(\d|[^{]\S*)/g,function(N,F,U,X){return F+U+"{"+X+"}"}).replace(/\\verb,(.*?),/,function(N,F){return"\\verb,".concat(D[+F],",")});for(var W,O={weight:null,italic:null,variant:null,sub:!1,sup:!1,href:null},Q=[],vt=[],Pt=function(N){for(var F in O)O[F]&&(N[F]=O[F]);return Q.push(N),N},Ct=function(){vt.push(O),O=Object.create(O)},Nt=function(){if(!vt.length)throw new Error("Unexpected }");O=vt.pop()},Ot={tokens:Q,open_context:Ct,close_context:Nt,add_token:Pt};P.length;){if(W=rt.exec(P))It(W[0],!1).forEach(Pt);else if(W=nt.exec(P))Pt(new j(W[1]));else if(!(W=lt.exec(P))){if(W=/^\{/.exec(P))Ct();else if(W=/^\}/.exec(P))Nt();else if(!(W=/^\$/.exec(P)))if(W=/^\\verb,([^,]+),/.exec(P))Pt(new j(W[1]));else if(W=ht.exec(P)){var jt=W[1].slice(1)||W[1],Yt=!!W[2];if(/^(La)?TeX$/i.test(jt)){Ct(),O.family="serif";var Gt=void 0;jt==="LaTeX"&&((Gt=Pt(new j("L"))).tracking=-.25,(Gt=Pt(new j("A"))).size=.7,Gt.baseline=.3,Gt.tracking=-.1),(Gt=Pt(new j("T"))).tracking=-.17,(Gt=Pt(new j("E"))).baseline=-.22,Gt.tracking=-.13,Gt=Pt(new j("X")),Nt()}else if(jt in et)Pt(new j(et[jt])),Yt&&Ct();else if(jt in wt){var Vt=[],M=wt[jt].length-1,k=void 0;if(M){for(Yt=!1,P=P.slice(W[0].length-1);M--;){if(!(k=/^\{([^}]+)\}/.exec(P)))throw new Error(jt+" is missing an argument");Vt.push(k[1]),P=P.slice(k[0].length)}W[0]=/^\{/.exec(P)?"{":"",Yt=!!W[0]}Yt&&Ct(),wt[jt].apply(Ot,[O].concat(Vt))}else console.warn("unknown latex command",jt),Pt(new j(W[1])),Yt&&Ct()}else W=[P.slice(0,1)],Pt(new j(W[0]))}P=P.slice(W[0].length)}return Q},oe.measureText=function(P,D,W){return b(P,m(D),W)},oe.Token=j,oe.Break=C,oe.LineBreak=w,oe.SoftHyphen=H,oe.Rotator=Oe,Oe.createElement=Ge;const We=oe;return i.default})())})(Wb);var fD=Wb.exports;const cf=Ub(fD);function Xd(t){return t.replace(/$/,"")}function Yd(t){return t.children[0].innerHTML}function pD(t,e){const s=fi(t),{fontSize:i,font:n,padding:r=0}=t.properties.style||{};if(s.width===s.height&&s.width===0)return;const o=new cf({font:`${i}px/${i}px ${n}`.replace(/(px)+/g,"px"),width:s.width-r*2,height:s.height-r*2,align:"left",valign:"top",x:0,overflow:"ellipsis",parser:"html",createElement:cf.createElement});o.overflowWrap("break-word");const l=o.linebreak(t.properties.content.replaceAll(`
`,"<br>")).render(),d=[...l.children];let h=0;const u=[];t.properties.content.split(`
`).forEach(m=>{let _=m;for(;_.length&&h<d.length;){if(d[h].innerHTML==="&nbsp;"){_.startsWith(`
`)||u.push(h),h++;break}const f=Xd(Yd(d[h]));_.startsWith(f)&&(_=_.slice(f.length).trim()),h++}}),u.forEach(m=>l.removeChild(d[m]));const c=t.properties.content.match(/(https?:\/\/.*)/gm),g=c?c.map(m=>m.split(" ")[0]):[];l.setAttribute("transform",`translate(${r}, ${r})`),g.forEach(m=>{let _=m;const f=[];for(;_.length>0;){const p=d.find(y=>!!y.children[0]&&y.children[0].tagName==="tspan"&&_.startsWith(Xd(Yd(y))));if(!p)break;f.push(p);const x=Xd(p.children[0].innerHTML).length;if(!x)break;_=_.slice(x)}f.forEach(p=>{const x=document.createElementNS("http://www.w3.org/2000/svg","a");x.setAttribute("href",m),x.setAttribute("target","_blank"),x.innerHTML=Yd(p),p.children[0].innerHTML="",p.children[0].appendChild(x)})}),e.appendChild(l)}const gf=20;class yD extends jb{constructor(s,i={}){super(s,`
    <div class="annotation-text-handle">
    <span class="handle line-handle top" data-handle-id="0"></span>
    <span class="handle line-handle bottom" data-handle-id="1"></span>
    <span class="handle line-handle left" data-handle-id="2"></span>
    <span class="handle line-handle right" data-handle-id="3"></span>
    <span class="handle top right point-handle top-right" data-handle-id="4"></span>
    <span class="handle left top point-handle top-left" data-handle-id="5"></span>
    <span class="handle bottom right point-handle bottom-right" data-handle-id="6"></span>
    <span class="handle left bottom left-handle point-handle bottom-left" data-handle-id="7"></span>
    <textarea wrap="on"></textarea>
    </div>
  `);Mt(this,"textArea");Mt(this,"handleSize");Mt(this,"rect",{x:0,y:0,width:0,height:0});Mt(this,"annotation",{...Wd});Mt(this,"startX",0);Mt(this,"startY",0);Mt(this,"handles",[]);Mt(this,"draggedHandle",Ye);Mt(this,"isFocused",!1);Mt(this,"placeholder","Type your text here...");Mt(this,"_onFocus",()=>{this.textArea.value===this.placeholder&&(this.textArea.value=""),this.isFocused=!0});Mt(this,"_onBlur",()=>{this.isFocused=!1});Mt(this,"startDrawing",(s,i,n=Hb(s,i,0,0,"",ir))=>{this.add(n);const r=this.ogma.view.graphToScreenCoordinates({x:s,y:i});this.select(n.id),this.startDragging(this.getById(n.id),r.x,r.y),this.draggedHandle=6});Mt(this,"cancelDrawing",()=>{this.isDragging&&(this.remove(this.annotation.id),this.annotation={...Wd},this.draggedHandle=Ye,this.isDragging=!1,this.emit(qi,this.annotation))});Mt(this,"startDragging",(s,i,n)=>{this.annotation=s;const r=gi(this.annotation),o=fi(this.annotation);this.rect.x=r.x,this.rect.y=r.y,this.rect.width=o.width,this.rect.height=o.height,this.startX=i,this.startY=n,this.disableDragging(),this.textArea.classList.add("noevents"),this.textArea.setAttribute("disabled","disabled"),this.emit(Al,this.annotation),this.isDragging=!0});Mt(this,"onHandleMouseDown",s=>{const i=this.getById(this.selectedId)||this.getById(this.hoveredId);if(!i)return;this.selectedId!==i.id&&this.select(this.hoveredId);const{x:n,y:r}=yu(s,this.ogma.getContainer());this.startDragging(i,n,r),this.draggedHandle=Db(s.target)});Mt(this,"onMouseMove",s=>{requestAnimationFrame(()=>this._onMouseMove(s))});Mt(this,"_onMouseMove",s=>{if(!this.isDragging)return;s.stopPropagation(),s.preventDefault();const i=this.handles[this.draggedHandle],n=i.classList.contains("top"),r=i.classList.contains("left"),o=i.classList.contains("right"),a=i.classList.contains("bottom"),l=i.classList.contains("line-handle"),{x:d,y:h}=yu(s,this.ogma.getContainer()),u=this.ogma.view.getZoom(),c=(d-this.startX)/u,g=(h-this.startY)/u,m=this.ogma.view.getAngle(),_=Rs({x:c,y:g},m);(a&&r||n&&o)&&(_.y=0,_.x=0);const f=r||l?this.rect.x+_.x:this.rect.x,p=n||l?this.rect.y+_.y:this.rect.y,x=Math.max(this.rect.width+c*(l||r?0:1),gf),y=Math.max(this.rect.height+g*(l||n?0:1),gf);lD(this.annotation,f,p,x,y),this.emit(El,this.annotation,"text"),this.refreshEditor(),this.layer.refresh()});Mt(this,"onMouseUp",()=>{!this.isDragging||this.draggedHandle===Ye||(this.restoreDragging(),this.textArea.classList.remove("noevents"),this.textArea.removeAttribute("disabled"),this.emit(qi,this.annotation),this.isDragging=!1,this.draggedHandle=Ye)});Mt(this,"_onMousedown",s=>{s.stopPropagation()});Mt(this,"onViewChanged",()=>{const s=Math.max(2,this.handleSize/this.ogma.view.getZoom());document.documentElement.style.setProperty("--handle-scale",`${1/s}`)});Mt(this,"_onInput",()=>{const s=this.getById(this.selectedId);s&&(this.textArea.value=this.textArea.value.replace(/ +(?= )/g,""),this.textArea.focus(),s.properties.content=this.textArea.value,this.emit(pu,s),this.layer.refresh())});this.showeditorOnHover=!1,this.handleSize=uf.handleSize,this.placeholder=uf.placeholder;const n=this.textArea=this.editor.element.querySelector("textarea");n.addEventListener("input",this._onInput),n.addEventListener("focus",this._onFocus),n.addEventListener("blur",this._onBlur),n.addEventListener("mousedown",this._onMousedown),n.spellcheck=!1,this.handles=Array.prototype.slice.call(this.editor.element.querySelectorAll(".annotation-text-handle > .handle")),this.handles.forEach(r=>r.addEventListener("mousedown",this.onHandleMouseDown)),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousemove",this.onMouseMove,!0),s.events.on(["viewChanged","zoom"],this.onViewChanged)}_canRemove(){return!this.isFocused}detect({x:s,y:i},n=0){const r={x:s,y:i},o=this.ogma.view.getAngle();return this.elements.find(a=>{const{x:l,y:d}=gi(a),{width:h,height:u}=fi(a),c={x:l,y:d},{x:g,y:m}=Rs(yn(r,c),-o);return g>-n&&g<h+n&&m>-n&&m<u+n})}draw(s){s.innerHTML="";const i="",n=this.ogma.view.getAngle();this.elements.forEach((o,a)=>{const l=`class${a}`,d=fi(o),h=gi(o),u=o.id,{color:c,fontSize:g,font:m,strokeColor:_,strokeWidth:f,strokeType:p,background:x}=o.properties.style||ir;if(u===this.selectedId)return;const y=no("g");y.classList.add("annotation-text"),y.setAttribute("fill",`${c}`),y.setAttribute("font-size",`${g}px`),y.setAttribute("font-family",`${m}`);const b=no("rect");let v=!1;p&&p!=="none"&&(v=!0,b.setAttribute("stroke",_||"black"),b.setAttribute("stroke-width",`${f}`),p==="dashed"&&b.setAttribute("stroke-dasharray","5,5")),(x&&x.length||v)&&(v=!0,b.setAttribute("fill",x||"transparent")),v&&(b.setAttribute("width",`${d.width}`),b.setAttribute("height",`${d.height}`)),y.appendChild(b),pD(o,y);const{x:E,y:A}=Rs(h,-n);y.setAttribute("transform",`translate(${E},${A})`),y.classList.add(l),y.setAttribute("data-annotation",`${o.id}`),y.setAttribute("data-annotation-type","text"),s.appendChild(y)});const r=no("style");r.innerHTML=i,s.firstChild&&s.insertBefore(r,s.firstChild)}refreshDrawing(){const s=this.ogma.view.getAngle();[...this.layer.element.children].forEach(i=>{const n=i.getAttribute("data-annotation");if(!n)return;const r=gi(this.getById(n)),{x:o,y:a}=Rs(r,-s);i.setAttribute("transform",`translate(${o},${a})`)})}getDefaultOptions(){return Wd}refreshEditor(){if(+this.selectedId<0&&+this.hoveredId<0)return;const s=this.getById(this.selectedId)||this.getById(this.hoveredId),i=fi(s),n=this.ogma.view.graphToScreenCoordinates(gi(s)),r=this.ogma.view.getZoom(),{font:o,fontSize:a,color:l,background:d,padding:h=0}=s.properties.style||ir,u=(a||1)*r;this.textArea.value=s.properties.content,this.editor.element.style.transform=`translate(${n.x}px, ${n.y}px)translate(-50%, -50%)translate(${i.width/2*r}px, ${i.height/2*r}px)`,this.editor.element.style.width=`${i.width*r}px`,this.editor.element.style.height=`${i.height*r}px`,this.textArea.style.font=`${u} ${o}`,this.textArea.style.fontFamily=o||"sans-serif",this.textArea.style.fontSize=`${u}px`,this.textArea.style.padding=`${r*h}px`,this.textArea.style.lineHeight=`${u}px`,this.textArea.style.boxSizing="border-box",this.textArea.style.color=l||"black",this.textArea.style.background=d||"transparent",this.textArea.placeholder=this.placeholder,this.layer.refresh()}select(s){super.select(s),this.textArea.focus()}destroy(){super.destroy(),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove,!0),this.ogma.events.off(this.onViewChanged)}}class xD{constructor(){Mt(this,"links",{});Mt(this,"linksByTargetId",{});Mt(this,"linksByArrowId",{})}add(e,s,i,n,r){const o=Kl(),a=e.id,l={id:o,arrow:a,target:i,targetType:n,connectionPoint:r,side:s};return this.links[o]=l,this.linksByTargetId[i]||(this.linksByTargetId[i]=[]),this.linksByTargetId[i].push(o),this.linksByArrowId[a]||(this.linksByArrowId[a]={}),this.linksByArrowId[a][s]=o,e.properties.link=e.properties.link||{},e.properties.link[s]={id:i,side:s,type:n,magnet:r},this}arrowIsLinked(e,s){var i;return!!((i=this.linksByArrowId[e])!=null&&i[s])}remove(e,s){var a,l;const i=e.id,n=(a=this.linksByArrowId[i])==null?void 0:a[s];if((l=e.properties.link)==null||delete l[s],!n)return this;const r=this.links[n];delete this.links[n];const o=this.linksByTargetId[r.target];for(let d=0;d<o.length;d++)if(o[d]===n){o.splice(d,1);break}return delete this.linksByArrowId[i][s],this}getArrowLink(e,s){var n;const i=(n=this.linksByArrowId[e])==null?void 0:n[s];return i?this.links[i]:null}getTargetLinks(e,s){var i;return((i=this.linksByTargetId[e])==null?void 0:i.map(n=>this.links[n]).filter(n=>n.targetType===s))??[]}forEach(e){Object.values(this.links).forEach(e)}}const Vs=t=>t.properties.type==="arrow",Fi=t=>t.properties.type==="text",mf=t=>t.type==="FeatureCollection",bD={magnetColor:"#3e8",detectMargin:20,magnetHandleRadius:5,magnetRadius:10,textPlaceholder:"Type here",arrowHandleSize:3.5,textHandleSize:3.5,minArrowHeight:20,maxArrowHeight:30},_f=["start","end"],ff=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:0,y:.5},{x:1,y:.5},{x:0,y:1},{x:.5,y:1},{x:1,y:1}];class vD extends Vb{constructor(s,i={}){super();Mt(this,"arrows");Mt(this,"texts");Mt(this,"links",new xD);Mt(this,"layer");Mt(this,"annotations");Mt(this,"ogma");Mt(this,"options");Mt(this,"selected",null);Mt(this,"updateTimeout",0);Mt(this,"hoveredNode",null);Mt(this,"dragged",null);Mt(this,"textToMagnet");Mt(this,"activeLinks",[]);Mt(this,"_render",s=>{if(!this.dragged||this.textToMagnet===void 0)return;s.beginPath(),s.fillStyle="green";const i=this.ogma.view.getZoom();ff.forEach(n=>{if(!this.textToMagnet)return;const r=fi(this.textToMagnet),o=gi(this.textToMagnet),a=Pa(n,{x:r.width,y:r.height}),l=Rs(a,this.ogma.view.getAngle()),{x:d,y:h}=Kn(l,o);s.moveTo(d,h),s.arc(d,h,this.options.magnetHandleRadius/i,0,Math.PI*2)}),s.fill(),s.closePath()});Mt(this,"_onFeatureDrag",(s,i)=>{const n=i;if(Vs(s)&&n==="line")["start","end"].find(r=>{const o=r==="start"?ro(s):Sl(s);return this._snapToText(s,n,o)||this._findAndSnapToNode(s,r,o)});else if(Vs(s)&&n!=="line"){const r=n==="start"?ro(s):Sl(s);this._snapToText(s,n,r)||this._findAndSnapToNode(s,n,r)}else Fi(s)&&(this.activeLinks.forEach(({arrow:r,side:o,connectionPoint:a})=>{const l=this.getAnnotation(r),d=fi(s),h=gi(s),u=Pa(a,{x:d.width,y:d.height}),c=Rs(u,this.ogma.view.getAngle()),g=Kn(c,h);l.geometry.coordinates[o==="start"?0:1]=[g.x,g.y]}),this.activeLinks.length&&this.arrows.refreshLayer());this.layer.refresh(),this.emit(El,s,i)});Mt(this,"_onFeatureDragEnd",s=>{this.dragged!==null&&Vs(s)&&ro(this.dragged)&&_f.forEach(i=>{this.links.getArrowLink(s.id,i)&&this.emit(rD,{arrow:s,link:this.links.getArrowLink(s.id,i)})}),(Fi(s)||Vs(s))&&this.onUpdate(s),this.dragged=null,this.activeLinks=[],this.textToMagnet=void 0,this.annotations.forEach(i=>i.enableDetection()),this.layer.refresh(),this.emit(qi,s)});Mt(this,"_onFeatureDragStart",s=>{this.textToMagnet=void 0,Vs(s)?this.dragged=s:Fi(s)&&this.activeLinks.push(...this.links.getTargetLinks(s.id,"text")),this.annotations.forEach(i=>{const n=i.getSelectedFeature();n&&n!==s&&i.unhover().unselect(),i.disableDetection()}),this.emit(Al,s)});Mt(this,"_onNodesDragStart",()=>{this.arrows.unhover().unselect(),this.texts.unhover().unselect()});Mt(this,"_onNodesDrag",s=>{const{dx:i,dy:n}=s;this._moveNodes(s.nodes,i,n)});Mt(this,"_onLayoutEnd",s=>{s.ids.forEach((i,n)=>{this.links.getTargetLinks(i,"node").forEach(o=>{const a=this.getAnnotation(o.arrow),l=o.side,d=Ma(a,l==="start"?"end":"start"),h=s.positions.current[n],u=this.ogma.getNode(i).getAttribute("radius"),c=Na(d,h,+u);zn(a,l,c.x,c.y)})}),this.arrows.refreshLayer(),this.texts.refreshLayer()});Mt(this,"_onAdded",s=>{this.emit(fu,s)});Mt(this,"_onRemoved",s=>{this.emit(_u,s)});Mt(this,"_onUnselect",s=>{this.selected=null,this.emit(mu,s)});Mt(this,"_onSelect",s=>{this.selected!==s&&(this.selected=s,this.emit(gu,this.selected))});Mt(this,"onUpdate",s=>{cancelAnimationFrame(this.updateTimeout),this.updateTimeout=requestAnimationFrame(()=>this._onUpdate(s))});Mt(this,"_onUpdate",s=>{this.emit(pu,s)});this.options=this.setOptions({...bD,...i}),this.ogma=s,this.arrows=new _D(s,this.options),this.texts=new yD(s,this.options),this.annotations=[this.arrows,this.texts],this.annotations.forEach(n=>{n.on(Al,this._onFeatureDragStart).on(El,this._onFeatureDrag).on(qi,this._onFeatureDragEnd).on(pu,this.onUpdate).on(mu,this._onUnselect).on(gu,this._onSelect).on(fu,this._onAdded).on(_u,this._onRemoved)}),this.ogma.events.on("nodesDragStart",this._onNodesDragStart).on("nodesDragProgress",this._onNodesDrag).on("layoutEnd",this._onLayoutEnd).on(["viewChanged","rotate"],()=>{this.refreshTextLinks()}),this.layer=s.layers.addCanvasLayer(this._render),this.layer.moveToBottom()}_moveNodes(s,i,n){s.forEach(r=>{const o=this.links.getTargetLinks(r.getId(),"node"),a=r.getPosition();o.forEach(l=>{const d=this.getAnnotation(l.arrow),h=l.side,u=Ma(d,h==="start"?"end":"start");let c=a;const g=+r.getAttribute("radius"),m=1e-6;(l.connectionPoint.x-(a.x-i)>m||l.connectionPoint.y-(a.y-n)>m)&&(c=Na(u,a,g)),zn(d,h,c.x,c.y)})}),this.arrows.refreshLayer()}_snapToText(s,i,n){const r=this.texts.detect(n,this.options.detectMargin);if(this.links.remove(s,i),!r)return!1;this.textToMagnet=r;const o=this.findMagnetPoint(ff,r,n);return o?(zn(s,i,o.point.x,o.point.y),this.links.add(s,i,r.id,"text",o.magnet),!0):!1}_findAndSnapToNode(s,i,n){var a,l;const r=this.ogma.view.graphToScreenCoordinates(n),o=this.ogma.view.getElementAt(r);this.links.remove(s,i),o&&o.isNode?((a=this.hoveredNode)==null||a.setSelected(!1),this.hoveredNode=o,o.setSelected(!0),this._snapToNode(s,i,o,r)):((l=this.hoveredNode)==null||l.setSelected(!1),this.hoveredNode=null)}_snapToNode(s,i,n,r){const o=n.getPositionOnScreen(),a=+n.getAttribute("radius"),l=a*this.ogma.view.getZoom(),d=r.x-o.x,h=r.y-o.y,u=Math.sqrt(d*d+h*h),c=n.getPosition();if(u<l+this.options.detectMargin){let g=c;if(u>l/2){const m=Ma(s,i==="end"?"start":"end");g=Na(m,g,a)}zn(s,i,g.x,g.y),this.links.add(s,i,n.getId(),"node",g)}}refreshTextLinks(){let s=!1;this.links.forEach(({connectionPoint:i,targetType:n,target:r,arrow:o,side:a})=>{if(n!=="text")return;s=!0;const l=this.getAnnotation(r),d=this.getAnnotation(o),h=fi(l),u=gi(l),c=Pa(i,{x:h.width,y:h.height}),g=Rs(c,this.ogma.view.getAngle()),m=Kn(g,u);zn(d,a,m.x,m.y)}),s&&this.arrows.refreshLayer()}getSelected(){return this.selected}findMagnetPoint(s,i,n){let r;for(const o of s){const a=fi(i),l=gi(i),d=Pa(o,{x:a.width,y:a.height}),h=Rs(d,this.ogma.view.getAngle()),u=Kn(h,l),c=sr(yn(u,n)),g=Math.min(this.options.magnetRadius*this.ogma.view.getZoom(),a.width/2,a.height/2);if(c<Math.max(g,this.options.magnetHandleRadius)){r={point:u,magnet:o};break}}return r}setOptions(s={}){return this.options={...this.options||{},...s},this.options}select(s){const i=this.getAnnotations().features.find(n=>n.id===s);return i?(Vs(i)?this.arrows.select(i.id):Fi(i)&&this.texts.select(i.id),this):this}unselect(){return this.selected?(Vs(this.selected)?this.arrows.unselect():Fi(this.selected)&&this.texts.unselect(),this):this}add(s){if(mf(s)){const[i,n]=s.features.reduce((r,o)=>(Vs(o)?r[1].push(o):Fi(o)&&r[0].push(o),r),[[],[]]);return i.forEach(r=>this.add(r)),n.forEach(r=>this.add(r)),this.arrows.refreshLayer(),this}switch(s.properties.type){case"text":this.texts.add(s);break;default:this.arrows.add(s),this.loadLink(s);break}return this}remove(s){return mf(s)?(s.features.forEach(i=>this.remove(i)),this):(Vs(s)?(this.links.remove(s,"start"),this.links.remove(s,"end"),this.arrows.remove(s.id)):this.texts.remove(s.id),this)}loadLink(s){if(s.properties.link)for(const i of _f){const n=s.properties.link[i];if(!n)continue;const r=this.getAnnotation(n.id);if(n.type==="text"&&r)this.links.add(s,i,n.id,n.type,n.magnet);else if(n.type==="node"){const o=this.ogma.getNode(n.id);if(!o)continue;this.links.add(s,i,n.id,n.type,n.magnet);const a=o.getPosition(),l=o.getAttribute("radius")||0,d=Ma(s,i==="start"?"end":"start"),h=Na(d,a,+l);zn(s,i,h.x,h.y)}}}startArrow(s,i,n){this.cancelDrawing(),this.arrows.startDrawing(s,i,n)}startText(s,i,n){this.cancelDrawing(),this.texts.startDrawing(s,i,n)}cancelDrawing(){this.annotations.forEach(s=>s.cancelDrawing()),this.emit(nD)}updateStyle(s,i){const n=this.getAnnotations().features.find(r=>r.id===s);return n?(Vs(n)?this.arrows.updateStyle(n,i):Fi(n)&&this.texts.updateStyle(n,i),this.onUpdate(n),this):this}setScale(s,i,n,r){const o=this.getAnnotations().features.find(a=>a.id===s);return o?(Vs(o)?this.arrows.scale(o,i,n,r):Fi(o)&&this.texts.scale(o,i,n,r),this.onUpdate(o),this):this}getAnnotations(){const s={type:"FeatureCollection",features:[]};return this.annotations.forEach(i=>{s.features=[...s.features,...i.getElements()]}),s}getAnnotation(s){return this.getAnnotations().features.find(i=>i.id===s)}destroy(){this.annotations.forEach(s=>s.destroy()),this.layer.destroy()}}const vi=new eD({container:"app"}),Zi=new vD(vi);window.ogma=vi;const ED={type:"FeatureCollection",features:[{type:"Feature",id:2,properties:{type:"arrow",style:{strokeType:"plain",strokeColor:"#3b3",strokeWidth:2,head:"arrow-plain",tail:"none"},link:{end:{id:"n0",side:"end",type:"node",magnet:{x:5.050129380397267,y:3.193041958648245}}}},geometry:{type:"LineString",coordinates:[[-200,200],[5.050129380397267,3.193041958648245]]}},{type:"Feature",id:0,properties:{type:"text",content:"Another annotation",style:{font:"Helvetica",fontSize:52,color:"black",background:"rgba(255, 255, 255, 0.5)",strokeWidth:1,strokeColor:"#000",strokeType:"plain",padding:12}},geometry:{type:"Polygon",coordinates:[[[-200,-200],[-200,-50],[200,-50],[200,-200],[-200,-200]]],bbox:[-200,-200,200,-50]}}]};vi.generate.flower({depth:3}).then(t=>{const e=t.nodes.reduce((s,i,n)=>(s[i.id]=i,i.id=`n${n}`,s),{});return t.edges.forEach(s=>{s.source=e[s.source].id,s.target=e[s.target].id}),vi.setGraph(t)}).then(()=>vi.layouts.force({locate:!0})).then(()=>{Zi.add(ED)});window.control=Zi;window.createArrow=Cc;const Fa=document.getElementById("add-arrow");Fa.addEventListener("click",()=>{Fa.disabled||(Fa.disabled=!0,vi.events.once("mousedown",t=>{const{x:e,y:s}=vi.view.screenToGraphCoordinates(t),i=Cc(e,s,e,s,{strokeWidth:2,strokeColor:"#3b3",strokeType:"plain"});Zi.startArrow(e,s,i),Zi.once(qi,n=>{n.id===i.id&&(Fa.disabled=!1)})}))});const ka=document.getElementById("add-text");ka.addEventListener("click",()=>{ka.disabled||(ka.disabled=!0,vi.events.once("mousedown",t=>{const{x:e,y:s}=vi.view.screenToGraphCoordinates(t),i=Hb(e,s,0,0);Zi.startText(e,s,i),Zi.once(qi,n=>{n.id===i.id&&(ka.disabled=!1)})}))});document.addEventListener("keydown",t=>{t.key==="Escape"&&Zi.cancelDrawing()});Zi.on("cancelDrawing",()=>{console.log("cancelDrawing")})});export default AD();
