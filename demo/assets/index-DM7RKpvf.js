(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();var CA=Object.create,xc=Object.defineProperty,LA=Object.getOwnPropertyDescriptor,by=Object.getOwnPropertyNames,IA=Object.getPrototypeOf,MA=Object.prototype.hasOwnProperty,NA=(t,e)=>function(){return e||(0,t[by(t)[0]])((e={exports:{}}).exports,e),e.exports},Jo=(t,e)=>{for(var s in e)xc(t,s,{get:e[s],enumerable:!0})},RA=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of by(e))MA.call(t,n)||n===s||xc(t,n,{get:()=>e[n],enumerable:!(i=LA(e,n))||i.enumerable});return t},vy=(t,e,s)=>(s=t!=null?CA(IA(t)):{},RA(t&&t.__esModule?s:xc(s,"default",{value:t,enumerable:!0}),t)),Ey=NA({"node_modules/@linkurious/spatial-index/dist/esm/index.js"(t,e){var s,i;s=t,i=function(n){function r(Y,E,T,C,L){const R=Math.abs(T-Y),F=Y<T?1:-1,z=-Math.abs(C-E),V=E<C?1:-1;let H,X=R+z;for(;;){if(L(Y,E),H=2*X,H>=z){if(Y===T)break;X+=z,Y+=F}if(H<=R){if(E===C)break;X+=R,E+=V}}}function o(Y,E="assert error"){if(!Y)throw new Error(E)}function a(Y,E,T,C,L,R,F){var z,V,H,X,W,Q=L-T,rt=R-C,nt=Y-T,tt=E-C,gt=nt*rt-tt*Q;if(Q*Q+rt*rt>nt*nt+tt*tt&&(L=Y,Y=Q+T,R=E,E=rt+C,gt=-gt),gt!=0){nt+=Q,tt+=rt,z=2*(nt*=Q=Y<L?1:-1)*(tt*=rt=E<R?1:-1),nt*=nt,tt*=tt,gt*Q*rt<0&&(nt=-nt,tt=-tt,z=-z,gt=-gt),V=4*rt*(T-Y)*gt+nt-z,H=4*Q*(E-C)*gt+tt-z,nt+=nt,tt+=tt,X=V+H+z;do{if(gt=Math.min(V+z,-z-H),W=Math.max(V+z,-z-H),W+=2*W*gt*gt/(4*W*W+gt*gt),F(Y,E,255*Math.abs(X-V-H-z)/W),Y==L||E==R)break;T=Y,gt=V-X,C=+(2*X+H<0),2*X+V>0&&(X-H<W&&F(Y,E+rt,255*Math.abs(X-H)/W),Y+=Q,V-=z,X+=H+=tt),C&&(gt<W&&F(T+Q,E,255*Math.abs(gt)/W),E+=rt,H-=z,X+=V+=nt)}while(H<V)}(function(zt,Bt,wt,Ft,Vt){const ie=zt<wt?1:-1,Yt=Bt<Ft?1:-1;let oe,Qt=Math.abs(wt-zt),$t=Math.abs(Ft-Bt),Jt=Qt*Qt+$t*$t,ce=Jt===0?1:1/Math.sqrt(Jt);for(Qt*=ce,$t*=ce,Jt=Qt-$t;;){if(Vt(zt,Bt,Math.abs(Jt-(Qt+$t))>>16),ce=Jt,oe=zt,2*ce>=-Qt){if(zt===wt)break;ce+$t<16711680&&Vt(zt,Bt+Yt,ce+$t>>16),Jt-=$t,zt+=ie}if(2*ce<=$t){if(Bt===Ft)break;Qt-ce<16711680&&Vt(oe+ie,Bt,Qt-ce>>16),Jt+=Qt,Bt+=Yt}}})(Y,E,L,R,F)}function l(Y,E,T,C,L,R,F,z,V){var H,X,W,Q=1;let rt,nt,tt,gt,St,zt,Bt,wt,Ft,Vt,ie,Yt=Y<F?1:-1,oe=E<z?1:-1,Qt=-Math.abs(Y+T-L-F),$t=Qt-4*Yt*(T-L),Jt=Yt*(Y-T-L+F),ce=-Math.abs(E+C-R-z),be=ce-4*oe*(C-R),Ie=oe*(E-C-R+z),P=.01;if(o((T-Y)*(L-F)<P&&((F-Y)*(T-L)<P||Jt*Jt<$t*Qt+P),"slope change"),o((C-E)*(R-z)<P&&((z-E)*(C-R)<P||Ie*Ie<be*ce+P),"slope change"),$t==0&&be==0)return Yt=Math.floor((3*T-Y+1)/2),oe=Math.floor((3*C-E+1)/2),(function(k,U,Z,$,G,J,st){var lt,dt,at,ft,_t=G-Z,ht=J-$,ut=k-Z,mt=U-$,yt=ut*ht-mt*_t;if(o(ut*_t<=0&&mt*ht<=0,"sign of gradient must not change"),_t*_t+ht*ht>ut*ut+mt*mt&&(G=k,k=_t+Z,J=U,U=ht+$,yt=-yt),yt!=0){ut+=_t,mt+=ht,lt=2*(ut*=_t=k<G?1:-1)*(mt*=ht=U<J?1:-1),ut*=ut,mt*=mt,yt*_t*ht<0&&(ut=-ut,mt=-mt,lt=-lt,yt=-yt),dt=4*ht*yt*(Z-k)+ut-lt,at=4*_t*yt*(U-$)+mt-lt,ut+=ut,mt+=mt,ft=dt+at+lt;do{if(st(k,U),k==G&&U==J)return;$=+(2*ft<dt),2*ft>at&&(k+=_t,dt-=lt,ft+=at+=mt),$&&(U+=ht,at-=lt,ft+=dt+=ut)}while(at<0&&dt>0)}r(k,U,G,J,st)})(Y,E,Yt,oe,F,z,V);T=(T-Y)*(T-Y)+(C-E)*(C-E)+1,L=(L-F)*(L-F)+(R-z)*(R-z)+1;do{rt=$t*Ie-Jt*be,nt=$t*ce-Qt*be,tt=Jt*ce-Qt*Ie,Vt=rt*(rt+nt-3*tt)+nt*nt,rt*=H=Vt>0?1:Math.sqrt(1+1024/T),nt*=H,tt*=H,Vt*=H*H,zt=9*(rt+nt+tt)/8,gt=8*($t-be),wt=27*(8*rt*(Ie*Ie-be*ce)+Vt*(be+2*Ie+ce))/64-be*be*(zt-be),Ft=27*(8*rt*(Jt*Jt-$t*Qt)-Vt*($t+2*Jt+Qt))/64-$t*$t*(zt+$t),St=3*(3*rt*(3*Ie*Ie-be*be-2*be*ce)-be*(3*nt*(be+Ie)+be*gt))/4,Bt=3*(3*rt*(3*Jt*Jt-$t*$t-2*$t*Qt)-$t*(3*nt*($t+Jt)+$t*gt))/4,zt=$t*be*(6*rt+6*nt-3*tt+gt),nt=be*be,gt=$t*$t,zt=3*(zt+9*H*(gt*Ie*ce-Jt*Qt*nt)-18*Jt*Ie*rt)/8,Vt<0&&(wt=-wt,Ft=-Ft,St=-St,Bt=-Bt,zt=-zt,nt=-nt,gt=-gt),rt=6*be*nt,nt*=-6*$t,tt=6*be*gt,gt*=-6*$t,wt+=zt,Vt=wt+Ft,Ft+=zt;t:for(ie=zt,X=W=H;Y!=F&&E!=z;){V(Y,E);do{if(wt>ie||Ft<ie)break t;C=2*Vt-Ft,2*Vt>=wt&&(X--,Vt+=wt+=St,Ft+=zt+=nt,Bt+=tt,St+=rt),C<=0&&(W--,Vt+=Ft+=Bt,wt+=zt+=tt,St+=nt,Bt+=gt)}while(X>0&&W>0);2*X<=H&&(Y+=Yt,X+=H),2*W<=H&&(E+=oe,W+=H),ie==zt&&wt<0&&Ft>0&&(ie=P)}St=Y,Y=F,F=St,Yt=-Yt,Jt=-Jt,Bt=E,E=z,z=Bt,oe=-oe,Ie=-Ie,T=L}while(Q--);r(Y,E,F,z,V)}function d(Y,E,T,C,L,R,F,z,V){(function(X,W,Q,rt,nt,tt,gt,St,zt,Bt){let wt=0,Ft=0,Vt=X+Q-nt-gt,ie=Vt-4*(Q-nt),Yt=X-Q-nt+gt,oe=Yt+4*(Q+nt),Qt=W+rt-tt-St,$t=Qt-4*(rt-tt),Jt=W-rt-tt+St,ce=Jt+4*(rt+tt);var be,Ie,P,B,k,U,Z=X,$=W;let G,J=Yt*Yt-ie*Vt;const st=[0,0,0,0,0];for(ie==0?Math.abs(Vt)<2*Math.abs(Yt)&&(st[wt++]=Vt/(2*Yt)):J>0&&(G=Math.sqrt(J),J=(Yt-G)/ie,Math.abs(J)<1&&(st[wt++]=J),J=(Yt+G)/ie,Math.abs(J)<1&&(st[wt++]=J)),J=Jt*Jt-$t*Qt,$t==0?Math.abs(Qt)<2*Math.abs(Jt)&&(st[wt++]=Qt/(2*Jt)):J>0&&(G=Math.sqrt(J),J=(Jt-G)/$t,Math.abs(J)<1&&(st[wt++]=J),J=(Jt+G)/$t,Math.abs(J)<1&&(st[wt++]=J)),Ft=1;Ft<wt;Ft++)(J=st[Ft-1])>st[Ft]&&(st[Ft-1]=st[Ft],st[Ft]=J,Ft=0);for(J=-1,st[wt]=1,Ft=0;Ft<=wt;Ft++)G=st[Ft],be=(J*(J*Yt-2*Vt)-G*(J*(J*ie-2*Yt)+Vt)+oe)/8-Z,B=(J*(J*Jt-2*Qt)-G*(J*(J*$t-2*Jt)+Qt)+ce)/8-$,Ie=(G*(G*Yt-2*Vt)-J*(G*(G*ie-2*Yt)+Vt)+oe)/8-Z,k=(G*(G*Jt-2*Qt)-J*(G*(G*$t-2*Jt)+Qt)+ce)/8-$,Z-=P=(G*(G*(3*Yt-G*ie)-3*Vt)+oe)/8,$-=U=(G*(G*(3*Jt-G*$t)-3*Qt)+ce)/8,gt=Math.floor(P+.5),St=Math.floor(U+.5),Z!=0&&(be*=Z=(X-gt)/Z,Ie*=Z),$!=0&&(B*=$=(W-St)/$,k*=$),(X!=gt||W!=St)&&zt(X,W,X+be,W+B,X+Ie,W+k,gt,St,Bt),X=gt,W=St,Z=P,$=U,J=G})(Y,E,T,C,L,R,F,z,l,V)}for(var h=Object.freeze({__proto__:null,AABB:0,SEGMENT:1,CURVE:3,LOOP:4,POINT:5}),u=[0,1],c=[0,2],g=4;g<65535;g<<=2)for(var m=0,f=u.length;m<f;m++)u.push(u[m]|g),c.push((u[m]|g)<<1);function p(Y,E){return(c[255&E]|u[255&Y])+65536*(c[E>>8&255]|u[Y>>8&255])+4294967296*(c[E>>16&255]|u[Y>>16&255])}let _,x;function y(Y,E=[0,0]){if(Y>0xffffffffffff)throw"Only morton codes up to 48 bits are supported.";if(!_){_={},x={};for(var T=0;T<256;T++)_[p(T,0)]=T,x[p(0,T)]=T}var C=_[21845&Y],L=x[43690&Y];return Y>65535&&(C|=_[21845&(Y/=65536)]<<8,L|=x[43690&Y]<<8,Y>65535&&(C|=_[21845&(Y/=65536)]<<16,L|=x[43690&Y]<<16)),E[0]=C,E[1]=L,E}p.code=function(E,T,C){if(E>24)throw"Morton codes are only supported up to Z=24";var L=1<<24-E;return p(T*L,C*L)},p.range=function(E,T,C){if(E>24)throw"Morton ranges are only supported up to Z=24";var L=1<<24-E,R=p(T*L,C*L);return[R,R+L*L-1]},p.reverse=y,p.decode=function(E,T){var C=y(T),L=1<<24-E;return[C[0]/L,C[1]/L]},p.min=function(E,T){var C=1431655765&E,L=1431655765&T,R=2863311530&E,F=2863311530&T;return Math.min(C,L)+Math.min(R,F)};const b=p;let v,A,S;function w(Y,E,T){const C=1<<T;return[Y=~~(C*((Y+S)/A)),E=~~(C*((E+S)/A))]}function I(Y,E,T){const C=1<<T;return[Y=C*((Y+S)/A),E=C*((E+S)/A)]}function M(Y,E,T,C,L,R){const F=w(Y,E,L),z=w(T,C,L);for(let V=F[0];V<=z[0];V++)for(let H=F[1];H<=z[1];H++)R.push(b(V,H))}function N(Y,E,T){const[C,L]=w(Y[0],Y[1],E),[R,F]=w(Y[2],Y[3],E),[z,V]=w(Y[4],Y[5],E);(function(X,W,Q,rt,nt,tt,gt){var St,zt=X-Q,Bt=W-rt,wt=X-2*Q+nt;zt*(nt-Q)>0&&(Bt*(tt-rt)>0&&Math.abs((W-2*rt+tt)/wt*zt)>Math.abs(Bt)&&(X=nt,nt=zt+Q,W=tt,tt=Bt+rt),St=(1-(wt=(X-Q)/wt))*((1-wt)*W+2*wt*rt)+wt*wt*tt,wt=(X*nt-Q*Q)*wt/(X-Q),zt=Math.floor(wt+.5),Bt=Math.floor(St+.5),St=(rt-W)*(wt-X)/(Q-X)+W,a(X,W,zt,Math.floor(St+.5),zt,Bt,gt),St=(rt-tt)*(wt-nt)/(Q-nt)+tt,X=Q=zt,W=Bt,rt=Math.floor(St+.5)),(W-rt)*(tt-rt)>0&&(St=(1-(wt=(W-rt)/(wt=W-2*rt+tt)))*((1-wt)*X+2*wt*Q)+wt*wt*nt,wt=(W*tt-rt*rt)*wt/(W-rt),zt=Math.floor(St+.5),Bt=Math.floor(wt+.5),St=(Q-X)*(wt-W)/(rt-W)+X,a(X,W,Math.floor(St+.5),Bt,zt,Bt,gt),St=(Q-nt)*(wt-tt)/(rt-tt)+nt,X=zt,Q=Math.floor(St+.5),W=rt=Bt),a(X,W,Q,rt,nt,tt,gt)})(C,L,R,F,z,V,((H,X)=>{T.push(b(H,X))}))}(function(E){v=E,A=1<<v,S=1<<v-1})(14);const D=[[0,0],[0,0]];function q(Y,E){const T=Y.type,C=Y.coordinates,L=[];switch(T){case 1:D[0][0]=C[0],D[0][1]=C[1],D[1][0]=C[2],D[1][1]=C[3],(function(F,z,V,H){for(var X,W,Q=0;Q<F.length-1;Q++){var rt=I(F[Q][0],F[Q][1],z),nt=I(F[Q+1][0],F[Q+1][1],z),tt=rt[0],gt=rt[1],St=nt[0]-tt,zt=nt[1]-gt;if(zt!==0||St!==0){var Bt=St>0?1:-1,wt=zt>0?1:-1,Ft=Math.floor(tt),Vt=Math.floor(gt),ie=St===0?1/0:Math.abs(((St>0?1:0)+Ft-tt)/St),Yt=zt===0?1/0:Math.abs(((zt>0?1:0)+Vt-gt)/zt),oe=Math.abs(Bt/St),Qt=Math.abs(wt/zt);for(Ft===X&&Vt===W||(H.push(b(Ft,Vt)),X=Ft,W=Vt);ie<1||Yt<1;)ie<Yt?(ie+=oe,Ft+=Bt):(Yt+=Qt,Vt+=wt),H.push(b(Ft,Vt)),X=Ft,W=Vt}}})(D,E,void 0,L);break;case 0:M(C[0],C[1],C[2],C[3],E,L);break;case 5:M(C[0]-C[2],C[1]-C[2],C[0]+C[2],C[1]+C[2],E,L);break;case 3:N(C,E,L);break;case 4:(function(F,z,V){const[H,X]=w(F[0],F[1],z),[W,Q]=w(F[2],F[3],z),[rt,nt]=w(F[4],F[5],z),[tt,gt]=w(F[6],F[7],z);d(H,X,W,Q,rt,nt,tt,gt,((St,zt)=>{V.push(b(St,zt))}))})(C,E,L)}return L}class et{constructor(E=Int32Array,T=16,C=8){this._BIG_LIST=new Uint8Array([-1])[0],this._ArrayType=E,this._capacity=T,this._MAX_LIST_SIZE=C,this._freeIndex=-1,this.clear()}clear(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._idToIndex=new Map,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(E){let T;return this._freeIndex===-1?T=this._nextIndex++:(T=this._freeIndex,this._freeIndex=-1),this._idToIndex.set(E,T),T>=this._capacity&&this._expand(T+1),this._sizes[T]=0,T}getItems(E){const T=this._idToIndex.get(E);if(T===void 0)return;const C=this._sizes[T],L=this._MAX_LIST_SIZE*T;if(C<=this._MAX_LIST_SIZE){this._constList.length=C;for(let R=0,F=C;R<F;++R)this._constList[R]=this._buffer[L+R];return this._constList}if(C===this._BIG_LIST){const R=this._buffer[L];return this._bigLists[R]}}removeEntry(E){const T=this._idToIndex.get(E);if(this._sizes[T]===this._BIG_LIST){const C=this._MAX_LIST_SIZE*T,L=this._buffer[C];this._bigLists[L].length=0}this._sizes[T]=0,this._freeIndex=T}size(E){const T=this._idToIndex.get(E),C=this._sizes[T];return C<=this._MAX_LIST_SIZE?C:this._bigLists[this._buffer[T*this._MAX_LIST_SIZE]].length}sizes(E){const T=this._sizes,C=this._bigLists,L=this._buffer,R=this._MAX_LIST_SIZE,F=E.length,z=new Array(F);for(let V=0;V<F;V++){const H=this._idToIndex.get(E[V]),X=T[H];z[V]=X<=R?X:C[L[H*R]].length}return z}addTo(E,T){const C=this._idToIndex.get(E),L=this._sizes[C],R=C*this._MAX_LIST_SIZE;if(L<this._MAX_LIST_SIZE)this._buffer[R+L]=T,this._sizes[C]=L+1;else if(L===this._BIG_LIST){const F=this._buffer[R];this._bigLists[F].push(T)}else{const F=new Array(this._MAX_LIST_SIZE);for(let z=0;z<this._MAX_LIST_SIZE;++z)F[z]=this._buffer[R+z];F.push(T),this._bigLists.push(F),this._sizes[C]=this._BIG_LIST,this._buffer[R]=this._bigLists.length-1}}removeFrom(E,T){this.removeFromAndGetSize(E,T)}removeFromAndGetSize(E,T){const C=this._idToIndex.get(E);let L=this._sizes[C];const R=this._MAX_LIST_SIZE*C;if(L<=this._MAX_LIST_SIZE){for(let F=R,z=R+L;F<z;++F)if(this._buffer[F]===T)return L-=1,this._buffer[F]=this._buffer[z-1],this._sizes[C]=L,L}else if(L===this._BIG_LIST){const F=this._buffer[R],z=this._bigLists[F],V=z.indexOf(T);if(V!==-1)return z.splice(V,1),z.length}}reserve(E){this._capacity<E&&this._expand(E)}_expand(E){this._capacity=Math.pow(2,Math.ceil(Math.log2(E))),this._buffer=O(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=O(this._sizes,this._capacity)}has(E){const T=this._idToIndex.get(E);return!(T===void 0||T>=this._capacity)&&this._sizes[T]!==0}keys(){return Array.from(this._idToIndex.keys())}get averageSize(){let E=0;for(let T=0;T<this._capacity;T++)E+=this._sizes[T];return E/this._capacity}}function O(Y,E){const T=new Y.constructor(E);return T.set(Y),T}function K(){for(var Y=arguments,E=Y.length-1,T=E,C=[],L=0;L<=E&&Math.abs(Y[L])<=1e-12;L++)E--;switch(E){case 1:j(Y[T],Y[T-1],C);break;case 2:ot(Y[T],Y[T-1],Y[T-2],C);break;case 3:it(Y[T],Y[T-1],Y[T-2],Y[T-3],C)}return C}function j(Y,E,T=[]){return E!==0&&T.push(-Y/E),T}function ot(Y,E,T,C=[]){var L=E/T,R=L*L-Y/T*4;if(R>0){var F=Math.sqrt(R);C.push(.5*(-L+F)),C.push(.5*(-L-F))}else R===0&&C.push(.5*-L);return C}function it(Y,E,T,C,L=[]){var R,F,z=T/C,V=E/C,H=(3*V-z*z)/3,X=(2*z*z*z-9*V*z+Y/C*27)/27,W=z/3,Q=X*X/4+H*H*H/27,rt=X/2;if(Math.abs(Q)<=1e-6&&(Q=0),Q>0){var nt=Math.sqrt(Q);F=(R=-rt+nt)>=0?Math.pow(R,1/3):-Math.pow(-R,1/3),(R=-rt-nt)>=0?F+=Math.pow(R,1/3):F-=Math.pow(-R,1/3),L.push(F-W)}else if(Q<0){var tt=Math.sqrt(-H/3),gt=Math.atan2(Math.sqrt(-Q),-rt)/3,St=Math.cos(gt),zt=Math.sin(gt),Bt=Math.sqrt(3);L.push(2*tt*St-W),L.push(-tt*(St+Bt*zt)-W),L.push(-tt*(St-Bt*zt)-W)}else R=rt>=0?-Math.pow(rt,1/3):Math.pow(-rt,1/3),L.push(2*R-W),L.push(-R-W);return L}function ct(Y,E,T,C,L,R,F,z,V,H,X){for(var W,Q,rt=Math.min(F,V),nt=Math.min(z,H),tt=Math.max(F,V),gt=Math.max(z,H),St=K((W=z-H)*(Y+-2*T+L)+(Q=V-F)*(E+-2*C+R),W*(-2*Y+2*T)+Q*(-2*E+2*C),W*Y+Q*E+(F*H-V*z)),zt=0;zt<St.length;zt++){var Bt=St[zt];if(0<=Bt&&Bt<=1){var wt=Y+(T-Y)*Bt,Ft=E+(C-E)*Bt,Vt=wt+(T+(L-T)*Bt-wt)*Bt,ie=Ft+(C+(R-C)*Bt-Ft)*Bt;if(F===V){if(nt<=ie&&ie<=gt)return 1}else if(z===H){if(rt<=Vt&&Vt<=tt)return 1}else if(Vt>=rt&&ie>=nt&&Vt<=tt&&ie<=gt)return 1}}return X?X.length/2:0}function pt(Y,E,T,C,L,R,F,z,V,H,X,W,Q){for(var rt,nt,tt=Math.min(V,X),gt=Math.min(H,W),St=Math.max(V,X),zt=Math.max(H,W),Bt=K((rt=H-W)*(-1*Y+3*T+-3*L+F)+(nt=X-V)*(-1*E+3*C+-3*R+z),rt*(3*Y+-6*T+3*L)+nt*(3*E+-6*C+3*R),rt*(-3*Y+3*T)+nt*(-3*E+3*C),rt*Y+nt*E+(V*W-X*H)),wt=0;wt<Bt.length;wt++){var Ft=Bt[wt];if(0<=Ft&&Ft<=1){var Vt=Y+(T-Y)*Ft,ie=E+(C-E)*Ft,Yt=T+(L-T)*Ft,oe=C+(R-C)*Ft,Qt=Vt+(Yt-Vt)*Ft,$t=ie+(oe-ie)*Ft,Jt=Qt+(Yt+(L+(F-L)*Ft-Yt)*Ft-Qt)*Ft,ce=$t+(oe+(R+(z-R)*Ft-oe)*Ft-$t)*Ft;if(V===X){if(gt<=ce&&ce<=zt)return 1}else if(H===W){if(tt<=Jt&&Jt<=St)return 1}else if(Jt>=tt&&ce>=gt&&Jt<=St&&ce<=zt)return 1}}return Q?Q.length/2:0}const Pt=function(E,T,C,L,R,F,z,V,H,X,W){return z<=E&&H>=E&&V<=T&&X>=T||z<=R&&H>=R&&V<=F&&X>=F||ct(E,T,C,L,R,F,z,V,H,V)||ct(E,T,C,L,R,F,H,V,H,X)||ct(E,T,C,L,R,F,z,X,H,X)||ct(E,T,C,L,R,F,z,V,z,X)?1:0},At=function(E,T,C,L,R,F,z,V,H,X,W,Q,rt){return H<=E&&W>=E&&X<=T&&Q>=T||H<=z&&W>=z&&X<=V&&Q>=V||pt(E,T,C,L,R,F,z,V,H,X,W,X)||pt(E,T,C,L,R,F,z,V,W,X,W,Q)||pt(E,T,C,L,R,F,z,V,H,Q,W,Q)||pt(E,T,C,L,R,F,z,V,H,X,H,Q)?1:0};function bt(Y,E,T){return Math.min(Math.max(E,Y),T)}function It(Y,E,T,C,L,R,F,z){const V=((F-L)*(E-R)-(z-R)*(Y-L))/((z-R)*(T-Y)-(F-L)*(C-E)),H=((T-Y)*(E-R)-(C-E)*(Y-L))/((z-R)*(T-Y)-(F-L)*(C-E));return V>=0&&V<=1&&H>=0&&H<=1}function Ut(Y,E,T,C,L){const R=Y.type,F=Y.coordinates;return R===5?(function(V,H,X,W,Q,rt,nt){const tt=V-bt(V,W,rt),gt=H-bt(H,Q,nt);return tt*tt+gt*gt<X*X})(F[0],F[1],F[2],E,T,C,L):R===1?(function(V,H,X,W,Q,rt,nt,tt){return V>=Q&&H>=rt&&V<=nt&&H<=tt||X>=Q&&W>=rt&&X<=nt&&W<=tt||!!It(V,H,X,W,Q,rt,Q,tt)||!!It(V,H,X,W,nt,rt,nt,tt)||!!It(V,H,X,W,Q,rt,nt,rt)||!!It(V,H,X,W,Q,tt,nt,tt)})(F[0],F[1],F[2],F[3],E,T,C,L):R===3?Pt(F[0],F[1],F[2],F[3],F[4],F[5],E,T,C,L):R===4?At(F[0],F[1],F[2],F[3],F[4],F[5],F[6],F[7],E,T,C,L):(function(V,H){return V[3]>H[1]&&V[1]<H[3]&&V[2]>H[0]&&V[0]<H[2]})(F,[E,T,C,L])}const Gt=2863311530,Dt=4294967295,Rt=31;function Tt(Y,E,T){let C=E;for(let L=Rt;L>=0;L--){const R=1<<L,F=((T&R)<<2|(Y&R)<<1|E&R)>>L;if(F===1)C=Y&~(Gt>>>Rt-L)&Dt|1<<L,E=(E|Gt>>>Rt-L&~(Dt<<L)&Dt)&~(1<<L)&Dt;else{if(F===3)return Y;if(F===4)return C;F===5&&(Y=Y&~(Gt>>>Rt-L)&Dt|1<<L)}}return C}function Nt(Y,E,T){for(let C=Rt;C>=0;C--){const L=1<<C,R=((T&L)<<2|(Y&L)<<1|E&L)>>C;if(R===1)E=(E|Gt>>>Rt-C&~(Dt<<C)&Dt)&~(1<<C)&Dt;else{if(R===3||R===4)return!1;R===5&&(Y=Y&~(Gt>>>Rt-C)&Dt|1<<C)}}return!0}function Ht(Y,E,T){const C=T+1;let L=0;for(let R=Rt;R>=0;R--){const F=1<<R,z=(C&F)>>R,V=(Y&F)>>R,H=(E&F)>>R,X=1&R,W=L&3<<2*X;if(W===0&&z>H&&V<=H){L|=2<<2*X;break}if(W===0&&z<V){L|=1<<2*X;break}}return L===0?C:Tt(Y,E,T)}class qt{constructor(E,T){this.key=E,this.data=T,this.left=null,this.right=null}}function Zt(Y,E){return Y>E?1:Y<E?-1:0}function Lt(Y,E,T){if(E===null)return E;let C,L,R;const F=new qt;for(C=L=F;;){const z=T(Y,E.key);if(z<0){if(E.left===null||T(Y,E.left.key)<0&&(R=E.left,E.left=R.right,R.right=E,(E=R).left===null))break;L.left=E,L=E,E=E.left}else{if(!(z>0)||E.right===null||T(Y,E.right.key)>0&&(R=E.right,E.right=R.left,R.left=E,(E=R).right===null))break;C.right=E,C=E,E=E.right}}return C.right=E.left,L.left=E.right,E.left=F.right,E.right=F.left,E}function Kt(Y,E,T,C,L){const R=new qt(Y,E);if(L._size++,T===null)return R.left=R.right=null,R;const F=C(Y,(T=Lt(Y,T,C)).key);return F<0?(R.left=T.left,R.right=T,T.left=null):F>=0&&(R.right=T.right,R.left=T,T.right=null),R}function ue(Y,E,T,C){let L;return E===null?null:T(Y,(E=Lt(Y,E,T)).key)===0?(E.left===null?L=E.right:(L=Lt(Y,E.left,T),L.right=E.right),C._size--,L):E}function ne(Y,E,T){let C,L;if(E===null)C=L=null;else{const R=T((E=Lt(Y,E,T)).key,Y);R===0?(C=E.left,L=E.right):R<0?(L=E.right,E.right=null,C=E):(C=E.left,E.left=null,L=E)}return{left:C,right:L}}function se(Y,E,T,C,L){if(Y){C(`${E}${T?"└── ":"├── "}${L(Y)}
`);const R=E+(T?"    ":"│   ");Y.left&&se(Y.left,R,!1,C,L),Y.right&&se(Y.right,R,!0,C,L)}}class le{constructor(E=Zt){this._comparator=E,this._root=null,this._size=0}insert(E,T){return this._root=Kt(E,T,this._root,this._comparator,this)}add(E,T){return this._root=(function(L,R,F,z,V){const H=new qt(L,R);if(F===null)return H.left=H.right=null,V._size++,H;const X=z(L,(F=Lt(L,F,z)).key);return X===0?F:(X<0?(H.left=F.left,H.right=F,F.left=null):X>0&&(H.right=F.right,H.left=F,F.right=null),V._size++,H)})(E,T,this._root,this._comparator,this)}remove(E){this._root=ue(E,this._root,this._comparator,this)}pop(){let E=this._root;if(E){for(;E.left;)E=E.left;return this._root=Lt(E.key,this._root,this._comparator),this._root=ue(E.key,this._root,this._comparator,this),{key:E.key,data:E.data}}return null}findStatic(E){let T=this._root;const C=this._comparator;for(;T;){const L=C(E,T.key);if(L===0)return T;T=L<0?T.left:T.right}return null}find(E){return this._root&&(this._root=Lt(E,this._root,this._comparator),this._comparator(E,this._root.key)!==0)?null:this._root}contains(E){let T=this._root;const C=this._comparator;for(;T;){const L=C(E,T.key);if(L===0)return!0;T=L<0?T.left:T.right}return!1}forEach(E,T){let C=this._root;const L=[];let R=!1;for(;!R;)C!==null?(L.push(C),C=C.left):L.length!==0?(C=L.pop(),E.call(T,C),C=C.right):R=!0;return this}range(E,T,C,L){const R=[],F=this._comparator;let z,V=this._root;for(;R.length!==0||V;)if(V)R.push(V),V=V.left;else{if(V=R.pop(),z=F(V.key,T),z>0)break;if(F(V.key,E)>=0&&C.call(L,V))return this;V=V.right}return this}keys(){const E=[];return this.forEach((({key:T})=>E.push(T))),E}values(){const E=[];return this.forEach((({data:T})=>E.push(T))),E}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(E=this._root){if(E)for(;E.left;)E=E.left;return E}maxNode(E=this._root){if(E)for(;E.right;)E=E.right;return E}at(E){let T=this._root,C=!1,L=0;const R=[];for(;!C;)if(T)R.push(T),T=T.left;else if(R.length>0){if(T=R.pop(),L===E)return T;L++,T=T.right}else C=!0;return null}next(E){let T=this._root,C=null;if(E.right){for(C=E.right;C.left;)C=C.left;return C}const L=this._comparator;for(;T;){const R=L(E.key,T.key);if(R===0)break;R<0?(C=T,T=T.left):T=T.right}return C}prev(E){let T=this._root,C=null;if(E.left!==null){for(C=E.left;C.right;)C=C.right;return C}const L=this._comparator;for(;T;){const R=L(E.key,T.key);if(R===0)break;R<0?T=T.left:(C=T,T=T.right)}return C}clear(){return this._root=null,this._size=0,this}toList(){return(function(T){var C=T,L=[],R=!1;const F={next:null};let z=F;for(;!R;)C?(L.push(C),C=C.left):L.length>0?C=(C=z=z.next=L.pop()).right:R=!0;return z.next=null,F.next})(this._root)}load(E=[],T=[],C=!1){let L=E.length;const R=this._comparator;if(C&&Le(E,T,0,L-1,R),this._root===null)this._root=ge(this._root,E,T,0,L),this._size=L;else{const F=(function(V,H,X=((W,Q)=>W-Q)){const W={};let Q=W,rt=V,nt=H;for(;rt!==null&&nt!==null;)X(rt.key,nt.key)<0?(Q.next=rt,rt=rt.next):(Q.next=nt,nt=nt.next),Q=Q.next;return rt!==null?Q.next=rt:nt!==null&&(Q.next=nt),W.next})(this.toList(),(function(V,H){const X={next:null};let W=X;for(let Q=0;Q<V.length;Q++)W=W.next={key:V[Q],data:H[Q]};return W.next=null,X.next})(E,T),R);L=this._size+L,this._root=ve({head:F},0,L)}return this}isEmpty(){return this._root===null}get size(){return this._size}toString(E=(T=>T.key)){const T=[];return se(this._root,"",!0,(C=>T.push(C)),E),T.join("")}update(E,T,C){const L=this._comparator;let{left:R,right:F}=ne(E,this._root,L);this._size--,L(E,T)<0?F=Kt(T,C,F,L,this):R=Kt(T,C,R,L,this),this._root=(function(V,H,X){return H===null?V:(V===null||((H=Lt(V.key,H,X)).left=V),H)})(R,F,L)}split(E){return ne(E,this._root,this._comparator)}}function ge(Y,E,T,C,L){const R=L-C;if(R>0){const F=C+Math.floor(R/2),z={key:E[F],data:T[F],parent:Y};return z.left=ge(z,E,T,C,F),z.right=ge(z,E,T,F+1,L),z}return null}function ve(Y,E,T){const C=T-E;if(C>0){const L=E+Math.floor(C/2),R=ve(Y,E,L),F=Y.head;return F.left=R,Y.head=Y.head.next,F.right=ve(Y,L+1,T),F}return null}function Le(Y,E,T,C,L){if(T>=C)return;const R=Y[T+C>>1];let F=T-1,z=C+1;for(;;){do F++;while(L(Y[F],R)<0);do z--;while(L(Y[z],R)>0);if(F>=z)break;let V=Y[F];Y[F]=Y[z],Y[z]=V,V=E[F],E[F]=E[z],E[z]=V}Le(Y,E,T,z,L),Le(Y,E,z+1,C,L)}class Ae extends le{constructor(E){super(E)}lte(E){const T=this._comparator;let C,L=this._root;for(;L;){if(C=T(L.key,E),L.left===null&&L.right===null&&C>0)return null;if(C<=0&&L.right===null||C<=0&&T(L.right.key,E)>0)return L;L=C>=0?L.left:L.right}return L}gte(E){const T=[],C=this._comparator;let L=this._root;for(;T.length!==0||L;)if(L)T.push(L),L=L.left;else{if(L=T.pop(),C(L.key,E)>=0)break;L=L.right}return L}clear(){return this._root=null,this._size=0,this}}class Xt{constructor(E,T=8){this.setLevel(T),this.setAccessor(E),this._tree=new Ae(((C,L)=>C-L)),this._nodeToId=new et(Uint32Array,1e3,16),this._idToNode=new et(Uint32Array,16,8),this._size=0,this._checkedNodes=[],this._codeCache=[0,0]}setAccessor(E){return this._getGeometry=E,this}load(E){const T=[],C=this._nodeToId,L=this._idToNode,R=this._level,F=this._getGeometry;for(let z=0;z<E.length;z++){const V=E[z],H=q(F(V),R);L.addEntry(V);for(let X=0;X<H.length;X++){const W=H[X];C.has(W)||(C.addEntry(W),T.push(W)),C.addTo(W,V),L.addTo(V,W)}}return this._tree.load(T,[],!0),this._size+=E.length,this}addToPage(){}removeFromPage(){}insert(E){const T=q(this._getGeometry(E),this._level),C=this._idToNode,L=this._nodeToId,R=this._tree;this._size++,C.addEntry(E);for(let F=0;F<T.length;F++){const z=T[F];L.has(z)||(R.insert(z),L.addEntry(z)),L.addTo(z,E),C.addTo(E,z)}}remove(E){const T=this._idToNode.getItems(E),C=this._nodeToId,L=this._tree;if(T)for(let R=0;R<T.length;R++){const F=T[R];C.removeFromAndGetSize(F,E)===0&&L.remove(F)}return this._idToNode.removeEntry(E),this._size--,this}update(E){return this.remove(E),this.insert(E),this}forEach(E){return this._tree.forEach(E),this}all(){const E=[];return this._tree.forEach((T=>{E.push(T)})),E}clear(){return this._tree.clear(),this._nodeToId.clear(),this._idToNode.clear(),this}setLevel(E){return this._level=E,this}traverse(E,T,C,L,R){const[F,z]=I(E,T,this._level),[V,H]=I(C,L,this._level),X=p(F,z),W=p(V,H);let Q=this._tree._root;const rt=[];let nt=X;for(;rt.length>0||Q;)if(Q)rt.push(Q),Q=Q.left;else{Q=rt.pop();const tt=Q.key;if(tt>W)break;if(tt>=X&&tt>=nt&&(nt=Ht(X,W,tt),R(Q)))return this;Q=Q.right}return this}getKeys(E){const[T,C,L,R]=E,[F,z]=I(T,C,this._level),[V,H]=I(L,R,this._level),X=p(F,z),W=p(V,H);let Q=this._tree._root;const rt=[];let nt=X;for(;rt.length>0||Q;)if(Q)rt.push(Q),Q=Q.left;else{Q=rt.pop();const tt=Q.key;if(tt>W)break;tt>=X&&tt>=nt&&(nt=Ht(X,W,tt)),Q=Q.right}return this}traverseDescend(E,T,C,L,R){const F=I(T,C,this._level),z=I(L,R,this._level),V=p(F[0],F[1]),H=p(z[0],z[1]);return this._recurse(this._tree._root,V,H,V,H,E),this}traverseRange(E,T,C,L,R){const[F,z]=I(T,C,this._level),[V,H]=I(L,R,this._level),X=p(F,z),W=p(V,H);return this._tree.range(X,W,(Q=>{const rt=Q.key;if(Nt(X,W,rt)&&E(Q))return!0})),this}_recurse(E,T,C,L,R,F){if(E===null)return;const z=E.key;if(z<T)return this._recurse(E.right,T,C,L,R,F);if(z>C)return this._recurse(E.left,T,C,L,R,F);if(Nt(L,R,z)){if(this._recurse(E.left,T,z,L,R,F),F(E))return;this._recurse(E.right,z,C,L,R,F)}else{const V=Tt(L,R,z),H=(function(W,Q,rt){let nt=W;for(let tt=Rt;tt>=0;tt--){const gt=1<<tt,St=((rt&gt)<<2|(W&gt)<<1|Q&gt)>>tt;if(St===1)Q=(Q|Gt>>>Rt-tt&~(Dt<<tt)&Dt)&~(1<<tt)&Dt;else{if(St===3)return nt;if(St===4)return Q;St===5&&(nt=(Q|Gt>>>Rt-tt&~(Dt<<tt)&Dt)&~(1<<tt)&Dt,W=W&~(Gt>>>Rt-tt)&Dt|1<<tt)}}return nt})(L,R,z);this._recurse(E.left,T,H,L,R,F),this._recurse(E.right,V,C,L,R,F)}}query(E,T,C,L){const R=[],F=[];this.traverse(E,T,C,L,(H=>{R.push(H)}));const z={},V=this._getGeometry;this._intersectionChecks=0;for(let H=0;H<R.length;H++){const X=R[H],W=this._nodeToId.getItems(X.key);for(let Q=0;Q<W.length;Q++){const rt=W[Q];if(!z[rt]){const nt=V(rt);this._intersectionChecks++,Ut(nt,E,T,C,L)&&F.push(rt),z[rt]=!0}}}return this._checkedNodes=R,F}getItems(E){return this._nodeToId.getItems(E)}get intersectionChecks(){return this._intersectionChecks}get level(){return this._level}get size(){return this._size}keyToBBox(E){const T=(function(){return v})(),[C,L]=p.reverse(E),R=1<<12-this._level+(T-12),F=1<<T-1;return[C*R-F,L*R-F,(C+1)*R-F,(L+1)*R-F]}}Xt.MAX_ZOOM=12;var Wt=typeof Map>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(E){return!!this._values[E]}set(E,T){E in this._values||this._size++,this._values[E]=T}get(E){return this._values[E]}delete(E){E in this._values&&(delete this._values[E],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Map,is=typeof Set>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(E){return!!this._values[E]}add(E){E in this._values||this._size++,this._values[E]=!0}delete(E){E in this._values&&(delete this._values[E],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Set;class Rs{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(E){return this._getBounds=E,this}setIntersector(E){return this._intersects=E,this}}function ds(Y,E,T,C,L,R,F,z){return C>=R&&E<=z&&T>=L&&Y<=F}const vs=(Y,E,T,C,L,R)=>({minX:Y,minY:E,maxX:T,maxY:C,leaf:!0,level:R,parent:L,objects:[],final:!1,children:null});function Oi(Y){const{minX:E,minY:T,maxX:C,maxY:L}=Y;return[E,T,C,L]}function Bs(Y,E,T,C,L,R,F,z){return Y>=L&&T<=F&&E>=R&&C<=z}function Zs(Y,E,T,C,L,R,F,z){const V=(R+z)/2,H=(E+C)/2;return(Y+T)/2<=(L+F)/2?H<=V?0:1:H<=V?3:2}const Pe=Y=>Y;class Ke extends Rs{constructor(E=Pe,T=10,C,L=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=T,this._root=null,this._getBounds=E,this._rootLevel=L,this._maxLevel=L+30,this._idToCell={},C&&(this._root=vs(C[0],C[1],C[2],C[3],null,L))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(E,T,C,L,R,F=this._root){if(T||([T,C,L,R]=this._getBounds(E)),this._objects[E])return;if(this._objects[E]=!0,this._size++,!this._root){const nt=Math.max(Math.abs(L-T),Math.abs(R-C));return this._root=vs(T,C,T+nt,C+nt,null,this._rootLevel),this._idToCell[E]=[this._root],this._root.objects=[E],E}let z,V=[F],H=!1;const X=this._nodeCapacity,W=this._idToCell,Q=this._maxLevel;let rt;for(;rt=V.pop();){z=rt;const{minX:nt,minY:tt,maxX:gt,maxY:St}=z;ds(T,C,L,R,nt,tt,gt,St)&&(z.leaf?z.objects&&(z.objects.length<X||z.final)?(z.objects.push(E),W[E]?W[E].push(z):W[E]=[z],H=!0,(z.level>=Q||Math.abs(gt-nt)<=Math.abs(L-T)||Math.abs(St-tt)<=Math.abs(R-C))&&(z.final=!0)):(this.splitNode(z),V.push(z)):V.push.apply(V,z.children))}if(!Bs(T,C,L,R,(F=this._root).minX,F.minY,F.maxX,F.maxY)){let nt=this._rootLevel;for(;!Bs(T,C,L,R,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){F=this._root;const{minX:tt,minY:gt,maxX:St,maxY:zt}=F;let Bt=tt,wt=gt,Ft=St,Vt=zt;const ie=Math.abs(St-tt),Yt=Math.abs(zt-gt);if(Yt===0&&ie===0)break;const oe=Math.max(ie,Yt);T<tt?(Bt-=oe,C<gt?wt-=oe:Vt+=oe):(Ft+=oe,C<gt?wt-=oe:Vt+=oe);const Qt=vs(Bt,wt,Ft,Vt,null,--nt);this.splitNode(Qt),Qt.children[Zs(tt,gt,St,zt,Bt,wt,Ft,Vt)]=F,this._root=F.parent=Qt}for(V=[this._root],this._root.level=this._rootLevel;rt=V.shift();)if(z=rt,!z.leaf)for(let tt=0;tt<4;tt++){const gt=z.children[tt];gt.level=z.level+1,V.push(gt)}F=this._root;for(let tt=0;tt<4;tt++){const gt=F.children[tt];gt&&gt.leaf&&gt.objects&&(gt.objects.push(E),W[E]?W[E].push(gt):W[E]=[gt])}}return H?E:void 0}removeById(E){if(!this._objects[E])return E;this._size--;const T=this._idToCell[E];for(let C=0;C<T.length;C++){const L=T[C].objects||[];for(let R=0,F=L.length;R<F;R++)if(L[R]===E){L.splice(R,1);break}}return delete this._objects[E],delete this._idToCell[E],E}remove(E){const[T,C,L,R]=this._getBounds(E),F=[this._root];let z,V;const H=[];for(;z=F.pop();)if(ds(T,C,L,R,z.minX,z.minY,z.maxX,z.maxY))if(z.leaf){const X=z.objects||[];for(let W=0,Q=X.length;W<Q;W++)if(X[W]===E){X.splice(W,1),Q===1&&H.push(z);break}}else F.push.apply(F,z.children);if(delete this._idToCell[E],delete this._objects[E],this._size--,H.length)for(;V=H.pop();){let X=V.parent,W=!0;for(;X&&W;){if(!X.leaf){for(let Q=0;Q<4;Q++)if(z=X.children[Q],!z.leaf||z.objects&&z.objects.length!==0){W=!1;break}W&&(X.leaf=!0,X.children=[],X.objects=[])}X=X.parent}}return E}splitNode(E){const{minX:T,minY:C,maxX:L,maxY:R}=E,F=(T+L)/2,z=(C+R)/2,V=E.level+1,H=this._idToCell,X=this._maxLevel,W=[vs(T,C,F,z,E,V),vs(T,z,F,R,E,V),vs(F,z,L,R,E,V),vs(F,C,L,z,E,V)];if(E.objects!==null){const Q=E.objects,rt=this._getBounds;for(let nt=0,tt=Q.length;nt<tt;nt++){const gt=Q[nt],St=rt(gt);let zt=H[gt];for(let Bt=0;Bt<4;Bt++){const wt=W[Bt],{minX:Ft,minY:Vt,maxX:ie,maxY:Yt}=wt;ds(St[0],St[1],St[2],St[3],Ft,Vt,ie,Yt)&&(wt.objects&&wt.objects.push(gt),(wt.level>=X||Math.abs(ie-Ft)<=Math.abs(St[2]-St[0])||Math.abs(Yt-Vt)<=Math.abs(St[3]-St[1]))&&(wt.final=!0),zt?zt.push(wt):zt=[wt])}zt&&zt.splice(zt.indexOf(E),1)}}E.children=W,E.objects=null,E.leaf=!1}point(E,T,C){let L=[];const R=[this._root];let F,z,V;const H=this._getBounds;for(;F=R.pop();)if(E>=F.minX&&E<=F.maxX&&T>=F.minY&&T<=F.maxY){if(F.leaf){C&&F.objects&&(L=F.objects);const X=F.objects||[];for(let W=0,Q=X.length;W<Q;W++)V=X[W],z=H(V),E>=z[0]&&E<=z[2]&&T>=z[1]&&T<=z[3]&&L.push(V);break}R.push.apply(R,F.children)}return L.length?L:null}neigbours(E,T){let C,L=[];const R=[this._root];for(;C=R.pop();)if(E>=C.minX&&E<=C.maxX&&T>=C.minY&&T<=C.maxY){if(C.leaf){L=C.objects;break}R.push.apply(R,C.children)}return L}query(E,T,C,L){const R=[],F=[this._root];let z,V,H;const X=this._getBounds,W={},Q=this._intersects;let rt;for(;z=F.pop();)if(ds(E,T,C,L,z.minX,z.minY,z.maxX,z.maxY))if(z.leaf){const nt=z.objects||[];for(let tt=0,gt=nt.length;tt<gt;tt++)H=nt[tt],W[H]||(V=X(H),ds(E,T,C,L,V[0],V[1],V[2],V[3])&&(Q&&!Q(H,E,T,C,L)||R.push(H)),W[H]=!0)}else rt=Zs(E,T,C,L,z.minX,z.minY,z.maxX,z.maxY),F.push(z.children[(rt+3)%4],z.children[(rt+2)%4],z.children[(rt+1)%4],z.children[rt]);return R}traverse(E,T,C,L,R){const F=[],z=[this._root];let V,H,X;const W=this._getBounds,Q={},rt=this._intersects;let nt;for(;V=z.pop();)if(ds(E,T,C,L,V.minX,V.minY,V.maxX,V.maxY))if(V.leaf){const tt=V.objects||[];for(let gt=0,St=tt.length;gt<St;gt++)if(X=tt[gt],!Q[X]){if(H=W(X),ds(E,T,C,L,H[0],H[1],H[2],H[3])&&(!rt||rt(X,E,T,C,L))&&(F.push(X),R(X)))return F;Q[X]=!0}}else nt=Zs(E,T,C,L,V.minX,V.minY,V.maxX,V.maxY),z.push(V.children[(nt+3)%4],V.children[(nt+2)%4],V.children[(nt+1)%4],V.children[nt]);return F}getOverlaps(){const E=[this._root];let T,C,L;const R=[],F=this._getBounds,z={};for(;T=E.pop();)if(T.leaf){const V=T.objects||[],H=V.length;for(let X=0;X<H;X++)for(let W=0;W<H;W++)if(C=V[X],L=V[W],X!==W&&!z[C+":"+L]&&!z[L+":"+C]){z[C+":"+L]=!0;const Q=F(C),rt=F(L);ds(Q[0],Q[1],Q[2],Q[3],rt[0],rt[1],rt[2],rt[3])&&R.push(C,L)}}else E.push.apply(E,T.children);return R}cover(E,T,C,L){if(this._root===null)return this._root=vs(E,T,C,L,null,0),this;let R=this._root;if(!Bs(E,T,C,L,R.minX,R.minY,R.maxX,R.maxY)){let F=this._rootLevel;for(;!Bs(E,T,C,L,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){R=this._root;const{minX:X,minY:W,maxX:Q,maxY:rt}=R;let nt=X,tt=W,gt=Q,St=rt;const zt=Math.abs(Q-X),Bt=Math.abs(rt-W);if(Bt===0&&zt===0)break;const wt=Math.max(zt,Bt);E<X?(nt-=wt,T<W?tt-=wt:St+=wt):(gt+=wt,T<W?tt-=wt:St+=wt);const Ft=vs(nt,tt,gt,St,null,--F);this.splitNode(Ft),Ft.children[Zs(X,W,Q,rt,nt,tt,gt,St)]=R,this._root=R.parent=Ft}const z=[this._root];let V,H;for(this._root.level=this._rootLevel;V=z.shift();)if(H=V,!H.leaf)for(let X=0;X<4;X++){const W=H.children[X];W.level=H.level+1,z.push(W)}}return this}getAll(){return Object.keys(this._objects).map((E=>Number(E)))}forEach(E,T){const C=[this._root];let L;for(;L=C.pop();)if(L.leaf&&L.objects)for(let R=0,F=L.objects.length;R<F;R++)E.call(T,L.objects[R]);else C.push.apply(C,L.children);return this}getLeafs(){const E=[this._root],T=[];let C;for(;C=E.pop();)C.leaf?T.push(C):E.push.apply(E,C.children);return T}traverseFromRoot(E,T){const C=[this._root];let L;for(;L=C.pop();)E.call(T,L,L.objects)||L.leaf||C.push.apply(C,L.children);return this}update(E,T,C,L,R){return this.remove(E),this.insert(E,T,C,L,R),this}getNodeBounds(E){return Oi(E)}}Ke.flatAccessor=(Y,E)=>T=>{const C=E*T;return Y.slice(C,C+E)},Ke.inside=Bs,Ke.intersects=function(E,T,C,L,R,F,z,V){return E>R&&E<z&&T>F&&T<V||C>R&&C<z&&L>F&&L<V},Ke.overlaps=ds,Ke.getNodeBBox=Oi,n.GeometryTypes=h,n.HGrid=class extends Rs{constructor(E,T,C=16,L=65536,R=Int32Array,F=16){super(),this._occupied=0,this._idToCode=new Wt,this._codeCache=[0,0,0],this.code=(z,V,H)=>H|p(z,V)<<this._bitsForZoom,this.decode=(z,V)=>(p.reverse(z>>this._bitsForZoom,V),V[2]=z&this._zoomMask,V),this._intersects=E,this._getBounds=T,this._cells=new et(R),this._offset=L,this._maxLevels=F,this._mortonMax=(1<<this._maxLevels)-1,this._bitsForZoom=Math.log2(this._maxLevels),this._zoomMask=(1<<this._bitsForZoom)-1,this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._min=-L,this._max=L,this._resolution=this._mortonMax/(this._max-this._min),this._minCellSize=C*this._resolution,this._bounds=new Array(4*this._maxLevels);for(let z=0;z<this._maxLevels;z++)this._bounds[4*z]=1/0,this._bounds[4*z+1]=1/0,this._bounds[4*z+2]=-1/0,this._bounds[4*z+3]=-1/0}setMinCellSize(E){return this._minCellSize=E,this}setOffset(E){return this._offset=E,this._min=-E,this._max=E,this._resolution=this._mortonMax/(this._max-this._min),this}insert(E,T,C,L,R){T===void 0&&([T,C,L,R]=this._getBounds(E));const F=Math.max(L-T,R-C);let z,V=this._minCellSize;for(z=0;V<F&&z<this._maxLevels-1;z++)V*=2;const H=this._resolution,X=this._min,W=H*(.5*(L+T)-X)/V|0,Q=H*(.5*(R+C)-X)/V|0,rt=this.code(W,Q,z);this._cells.has(rt)||this._cells.addEntry(rt),this._cells.addTo(rt,E),this._objectsAtLevel[z]++,this._occupied|=1<<z;const nt=4*z,tt=this._bounds;return W<tt[nt]&&(tt[nt]=W),Q<tt[nt+1]&&(tt[nt+1]=Q),W>tt[nt+2]&&(tt[nt+2]=W),Q>tt[nt+3]&&(tt[nt+3]=Q),this._idToCode.set(E,rt),rt}has(E){return this._idToCode.has(E)}update(E,T,C,L,R){return this.remove(E),this.insert(E,T,C,L,R)}remove(E){const T=this._idToCode.get(E);this.decode(T,this._codeCache);const C=this._codeCache[2];return--this._objectsAtLevel[C]==0&&(this._occupied&=~(1<<C),this._bounds[4*C]=1/0,this._bounds[4*C+1]=1/0,this._bounds[4*C+2]=-1/0,this._bounds[4*C+3]=-1/0),this._cells.removeFrom(T,E),this._idToCode.delete(E),this}query(E,T,C,L){const R=this._cells,F=this._bounds,z=this._intersects,V=this._min,H=this._resolution;let X=this._minCellSize,W=this._occupied;const Q=[];for(let rt=0;rt<this._maxLevels&&W!==0;X*=2,W>>=1,rt++){if((1&W)==0)continue;const nt=1/X,tt=4*rt,gt=Math.max(F[tt],H*(E-V)*nt-1>>0),St=Math.max(F[tt+1],H*(T-V)*nt-1>>0),zt=Math.min(F[tt+2],H*(C-V)*nt+1>>0),Bt=Math.min(F[tt+3],H*(L-V)*nt+1>>0);for(let wt=gt;wt<=zt;wt++)for(let Ft=St;Ft<=Bt;Ft++){const Vt=this.code(wt,Ft,rt);if(!R.has(Vt))continue;const ie=R.getItems(Vt);if(ie!==void 0)for(let Yt=0;Yt<ie.length;Yt++){const oe=ie[Yt];z(oe,E,T,C,L)&&Q.push(oe)}}}return Q}traverse(E,T,C,L,R){const F=this._cells,z=this._bounds,V=this._intersects,H=this._min,X=this._resolution;let W=this._minCellSize,Q=this._occupied;const rt=[];for(let nt=0;nt<this._maxLevels&&Q!==0;W*=2,Q>>=1,nt++){if((1&Q)==0)continue;const tt=1/W,gt=4*nt,St=Math.max(z[gt],X*(E-H)*tt-1>>0),zt=Math.max(z[gt+1],X*(T-H)*tt-1>>0),Bt=Math.min(z[gt+2],X*(C-H)*tt+1>>0),wt=Math.min(z[gt+3],X*(L-H)*tt+1>>0);for(let Ft=St;Ft<=Bt;Ft++)for(let Vt=zt;Vt<=wt;Vt++){const ie=this.code(Ft,Vt,nt),Yt=F.getItems(ie);if(Yt!==void 0)for(let oe=0;oe<Yt.length;oe++){const Qt=Yt[oe];if(V(Qt,E,T,C,L)&&(rt.push(Qt),R(Qt)))return rt}}}return rt}collisions(E,T=this._getBounds){if(typeof T!="function")throw new Error("getBounds function is required to get the object bounds");const C=Array.from(this._idToCode.keys()),L=this._min,R=this._resolution,F=this._cells,z=new Wt,V=[];for(let H=0;H<C.length;H++){let X=0,W=this._minCellSize,Q=this._occupied;const rt=C[H];let[nt,tt,gt,St]=T(rt);const zt=Math.max(gt-nt,St-tt);for(X=0;W<zt;X++)W*=2,Q>>=1;nt=R*(nt-L),tt=R*(tt-L),gt=R*(gt-L),St=R*(St-L);for(let Bt=X;Bt<this._maxLevels&&Q!==0;W*=2,Q>>=1,Bt++){if((1&Q)==0)continue;const wt=1/W,Ft=tt*wt-1>>0,Vt=gt*wt+1>>0,ie=St*wt+1>>0;for(let Yt=nt*wt-1>>0;Yt<=Vt;Yt++)for(let oe=Ft;oe<=ie;oe++){const Qt=this.code(Yt,oe,Bt);if(z.get(Qt)===H)continue;z.set(Qt,H);const $t=F.getItems(Qt);if($t!==void 0)for(let Jt=0;Jt<$t.length;Jt++){const ce=$t[Jt],[be,Ie,P,B]=this._getBounds(ce);ce!==rt&&E(rt,be,Ie,P,B)&&V.push(rt,ce)}}}}return(function(X){const W=new is,Q=[];for(let rt=0;rt<X.length;rt+=2){const nt=X[rt],tt=X[rt+1],gt=nt<tt?nt*tt+(tt-nt-1)*(tt-nt-1)/4:nt*tt+(nt-tt-1)*(nt-tt-1)/4;W.has(gt)||(W.add(gt),Q.push(nt,tt))}return Q})(V)}clear(){this._occupied=0,this._cells.clear(),this._idToCode.clear(),this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._bounds=new Array(4*this._maxLevels);for(let E=0;E<this._maxLevels;E++)this._bounds[4*E]=1/0,this._bounds[4*E+1]=1/0,this._bounds[4*E+2]=-1/0,this._bounds[4*E+3]=-1/0;return this}keyToBBox(E){const[T,C,L]=this.decode(E,[0,0,0]),R=this._minCellSize*(1<<L),F=this._min,z=this._resolution;return[T*R/z+F,C*R/z+F,(T+1)*R/z+F,(C+1)*R/z+F]}keys(){return this._cells.keys()}get averageCellOccupancy(){return this._cells.averageSize}get size(){return this._idToCode.size}getBoxes(){return Array.from(this._idToCode.keys()).map((E=>this._getBounds(E)))}},n.Quadtree=Ke,n.SGrid=class extends Rs{constructor(E,T,C){super();const L=this.cells=[];if(E instanceof ArrayBuffer){this.arrayBuffer=E;const F=new Int32Array(this.arrayBuffer);E=F[0],T=F[1],C=F[2],this.d=T+2*C;for(let H=0;H<this.d*this.d;H++){const X=F[3+H],W=F[3+H+1];L.push(X===W?null:F.subarray(X,W))}const z=F[3+L.length],V=F[3+L.length+1];this.keys=F.subarray(z,V),this.bboxes=F.subarray(V),this.insert=this._insertReadonly}else{this.d=T+2*C;for(let F=0;F<this.d*this.d;F++)L.push([]);this.keys=[],this.bboxes=[]}this.n=T,this.extent=E,this.padding=C,this.scale=T/E,this.uid=0;const R=C/T*E;this.min=-R,this.max=E+R}insert(E,T,C,L,R){return T===void 0&&([T,C,L,R]=this._getBounds(E)),this._forEachCell(T,C,L,R,this._insertCell,this.uid++),this.keys.push(E),this.bboxes.push(T),this.bboxes.push(C),this.bboxes.push(L),this.bboxes.push(R),this}_insertReadonly(E,T,C,L,R){throw"Cannot insert into a GridIndex created from an ArrayBuffer."}_insertCell(E,T,C,L,R,F){this.cells[R].push(F)}query(E,T,C,L,R){const F=this.min,z=this.max;if(E<=F&&T<=F&&z<=C&&z<=L&&!R)return Array.prototype.slice.call(this.keys);{const V=[],H={};return this._forEachCell(E,T,C,L,this._queryCell,V,H,R),V}}traverse(E,T,C,L,R,F){const z=this.min,V=this.max;if(E<=z&&T<=z&&V<=C&&V<=L&&!F)return Array.prototype.slice.call(this.keys);{const H=[],X={};return this._forEachCell(E,T,C,L,this._queryCellEarlyStop,H,X,R,F),H}}_queryCell(E,T,C,L,R,F,z,V){const H=this.cells[R];if(H!==null){const X=this.keys,W=this.bboxes,Q=this._intersects;for(let rt=0;rt<H.length;rt++){const nt=H[rt];if(z[nt]===void 0){const tt=4*nt;!(V?V(W[tt+0],W[tt+1],W[tt+2],W[tt+3]):E<=W[tt+2]&&T<=W[tt+3]&&C>=W[tt+0]&&L>=W[tt+1])||Q&&!Q(nt,E,T,C,L)?Q&&!Q(nt,E,T,C,L)||(z[nt]=!1):(z[nt]=!0,F.push(X[nt]))}}}}_queryCellEarlyStop(E,T,C,L,R,F,z,V,H){const X=this.cells[R];if(X!==null){const W=this.keys,Q=this.bboxes,rt=this._intersects;for(let nt=0;nt<X.length;nt++){const tt=X[nt];if(z[tt]===void 0){const gt=4*tt;if(!(H?H(Q[gt+0],Q[gt+1],Q[gt+2],Q[gt+3]):E<=Q[gt+2]&&T<=Q[gt+3]&&C>=Q[gt+0]&&L>=Q[gt+1])||rt&&!rt(tt,E,T,C,L))rt&&!rt(tt,E,T,C,L)||(z[tt]=!1);else if(z[tt]=!0,F.push(W[tt]),V(tt))return!0}}}}remove(E){throw new Error("Method not implemented yet.")}update(E,T,C,L,R){throw new Error("Method not implemented yet.")}clear(){const E=this.cells=[];if(this.arrayBuffer){for(let T=0;T<this.d*this.d;T++)E.push(null);this.keys=new Int32Array([]),this.bboxes=new Int32Array([])}else{for(let T=0;T<this.d*this.d;T++)E.push([]);this.keys=[],this.bboxes=[]}return this.uid=0,this}_forEachCell(E,T,C,L,R,F,z,V,H){const X=this._convertToCellCoord(E),W=this._convertToCellCoord(T),Q=this._convertToCellCoord(C),rt=this._convertToCellCoord(L);for(let nt=X;nt<=Q;nt++)for(let tt=W;tt<=rt;tt++){const gt=this.d*tt+nt;if((!H||H(this._convertFromCellCoord(nt),this._convertFromCellCoord(tt),this._convertFromCellCoord(nt+1),this._convertFromCellCoord(tt+1)))&&R.call(this,E,T,C,L,gt,F,z,V,H))return}}_convertFromCellCoord(E){return(E-this.padding)/this.scale}_convertToCellCoord(E){return Math.max(0,Math.min(this.d-1,Math.floor(E*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const E=this.cells,T=3+this.cells.length+1+1;let C=0;for(let F=0;F<this.cells.length;F++)C+=this.cells[F].length;const L=new Int32Array(T+C+this.keys.length+this.bboxes.length);L[0]=this.extent,L[1]=this.n,L[2]=this.padding;let R=T;for(let F=0;F<E.length;F++){const z=E[F];L[3+F]=R,L.set(z,R),R+=z.length}return L[3+E.length]=R,L.set(this.keys,R),R+=this.keys.length,L[3+E.length+1]=R,L.set(this.bboxes,R),R+=this.bboxes.length,L.buffer}},n.UBTree=Xt,n.morton=p,Object.defineProperty(n,"__esModule",{value:!0})},typeof t=="object"&&e!==void 0?i(t):typeof define=="function"&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).SpatialIndex={})}}),Ce=class{constructor(t){this._ogma=t}};function Qr(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])>e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function FA(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])<e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function as(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function jh(t){return Array.isArray(t)?t:[t]}function Ay(t){const e=[];for(let s=0;s<t.length;++s){const i=t[s];if(Array.isArray(i))for(let n=0;n<i.length;++n)e.push(i[n]);else e.push(i)}return e}function PA(...t){if(t.length===0)return[];const e=t[0].constructor;let s=0;for(const r of t)s+=r.length;const i=new e(s);let n=0;for(const r of t){for(let o=0;o<r.length;o++)i[n+o]=r[o];n+=r.length}return i}function zA(t,e){const s=t.indexOf(e);return s!==-1&&(t.splice(s,1),!0)}function Sy(t,e){let s,i,n=0,r=t.length-1;for(;n<=r;)if(s=(n+r)/2|0,i=t[s],i<e)n=s+1;else{if(!(i>e))return s;r=s-1}return-1}var No=(t,e)=>{const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=e[t[i]];return s};function DA(t){return typeof t=="number"&&t%1==0}function Yh(t){return Array.isArray(t)?t.join("."):t}function zn(t){if(!t)return[];if(typeof t=="string")return t.split(".");if(Array.isArray(t)){for(let e=0;e<t.length;++e)if(typeof t[e]!="string")throw new TypeError(`${t[e]} is not a string`);return t.slice()}throw new TypeError(`invalid property path "${t}": expected string or array of strings`)}function Ro(t,e,s){let i,n,r;if(e===0)return function(){t.apply(s,arguments)};const o=function(){i=!1,n&&(r.apply(s,n),n=null)};return r=function(){let a;return i?n=arguments:(a=t.apply(s,arguments),setTimeout(o,e),i=!0),a},r}function wy(t,e){let s,i=!1;return function n(){s?i=!0:s=setTimeout((()=>{if(s=null,i)return n(),void(i=!1);i=!1,t()}),e)}}function kA(t,e,s){let i,n,r,o,a;const l=e===0||e===void 0?100:e;function d(){const u=Date.now()-o;u<l&&u>=0?i=setTimeout(d,l-u):(i=null,s||(a=t.apply(r,n),r=n=null))}const h=function(){r=this,n=arguments,o=Date.now();const u=s&&!i;return i||(i=setTimeout(d,e)),u&&(a=t.apply(r,n),r=n=null),a};return h.clear=function(){i&&(clearTimeout(i),i=null)},h.flush=function(){i&&(a=t.apply(r,n),r=n=null,clearTimeout(i),i=null)},h}function Ty(t,e,s,i,n){s(t[e],e,t,i,n).then((r=>{e===t.length-1?i(r):Ty(t,e+1,s,i,n)})).catch(n)}function OA(t,e){return new Promise(((s,i)=>Ty(t,0,e,s,i)))}function hd(){return new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120}function Cy(t){return t.reduce(((e,s)=>e.then(s)),Promise.resolve())}function Xh(t,e,s,i,n,r,o,a){return t+n+256*(e+r)+65536*(s+o)+16777216*(i+a)}function BA(t,e){return t<e?t*e+Math.pow(e-t-1,2)/4:t*e+Math.pow(t-e-1,2)/4}function Dn(t){return!(t===null||typeof t!="object"||as(t)||t instanceof RegExp||typeof HTMLElement<"u"&&t instanceof HTMLElement)}function yo(t){const e=Object.keys(t),s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=t[e[i]];return s}function _i(t,e,s){if(Array.isArray(t))return t.forEach(e,s);if(!Dn(t))throw new Error("forEach: invalid argument "+JSON.stringify(t));const i=Object.keys(t);if(s!==void 0)for(let n=0;n<i.length;++n){const r=i[n];e.call(s,t[r],r)}else for(let n=0;n<i.length;++n){const r=i[n];e(t[r],r)}}function ke(t){if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;++n)i[n]=ke(t[n]);return i}if(!Xe(t))return t;const e={},s=Object.keys(t);for(const i of s)e[i]=ke(t[i]);return e}function UA(t,e){e.forEach((s=>{t.indexOf(s)===-1&&t.push(s)}))}function Li(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function ze(t,e){const s=zn(e);if(!s.length)return t;if(t){for(let i=0;i<s.length-1;++i){const n=t[s[i]];if(!n)return;t=n}return t[s[s.length-1]]}}function Fo(t,e,s="."){e||(e=r=>!Dn(r));const i={},n=Object.keys(t);for(let r=0;r<n.length;++r){const o=n[r],a=t[o];if(a instanceof Date)i[o]=a;else if(e(a))i[o]=a;else{const l=Fo(a,e),d=Object.keys(l);for(let h=0;h<d.length;h++){const u=d[h];i[`${o}${s}${u}`]=l[u]}}}return i}function Wh(t){const e={},s=Object.keys(t);for(let i=0;i<s.length;++i){const n=s[i];Li(e,n,t[n])}return e}function kn(t,e,s=[]){const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=t[r],a=e?e+r:r;Xe(o)?kn(o,a+".",s):s.push(a)}return s}var Ly=Object.prototype.hasOwnProperty;function Iy(t,e){const s=[t];let i;for(;s.length>0;)if(i=s.pop(),i)if(Xe(i))for(const n in i)Ly.call(i,n)&&s.push(i[n]);else e(i)}function GA(t){const e={};return Iy(t,(s=>e[s.getName()]=s)),e}function ud(t,e=[]){if(Xe(t)){const s=Object.keys(t);for(const i of s)ud(t[i],e)}else e.push(t);return e}function cd(t){for(const e in t)typeof t[e]=="function"&&delete t[e];return t}function Os(t,e){if(t===void 0)return ke(e);if(!Dn(t))return t;const s={},i=Object.keys(e);for(const n of i){const r=e[n],o=t[n];Dn(r)?s[n]=Os(o,r):s[n]=o===void 0?ke(r):o}return s}function Xe(t){return t&&(t.constructor===Object||!t.constructor)}function Nl(t,e){if(!Xe(e)||!Xe(t))return e;const s=Object.assign({},t),i=Object.keys(e);for(const n of i)s[n]=Nl(s[n],e[n]);return s}function $h(t,e){return e==null?t:e.reduce(((s,i)=>(s[i]=t[i],s)),{})}var or=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)Ly.call(i,n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):Xe(e[n])&&Xe(i[n])?e[n]=or(e[n],i[n]):e[n]=i[n])}return e},ta={};function gd(t){if(t!==ta)throw new Error("Bad secret")}function VA(t,e){if(!HA(t)||e+1!==t.length)throw new TypeError(`
    ############################## ERROR ##############################

    It looks like you are trying to call a template tag function (fn\`...\`)
    using the normal function syntax (fn(...)), which is not supported.

    The functions in the safevalues library are not designed to be called
    like normal functions, and doing so invalidates the security guarantees
    that safevalues provides.

    If you are stuck and not sure how to proceed, please reach out to us
    instead through:
     - https://github.com/google/safevalues/issues

    ############################## ERROR ##############################`)}function Jr(t){return Object.isFrozen(t)&&Object.isFrozen(t.raw)}function pa(t){return t.toString().indexOf("`")===-1}var zg=pa((t=>t``))||pa((t=>t`\0`))||pa((t=>t`\n`))||pa((t=>t`\u0000`)),qA=Jr``&&Jr`\0`&&Jr`\n`&&Jr`\u0000`;function HA(t){return!(!Array.isArray(t)||!Array.isArray(t.raw))&&t.length===t.raw.length&&!(!zg&&t===t.raw)&&!!(zg&&!qA||Jr(t))}var Vd,jA="google#safe",YA=jA,XA=globalThis.trustedTypes,Dg=XA;function WA(){let t=null;if(!Dg)return t;try{const e=s=>s;t=Dg.createPolicy(YA,{createHTML:e,createScript:e,createScriptURL:e})}catch(e){throw e}return t}function bc(){return Vd===void 0&&(Vd=WA()),Vd}function _a(t){return{valueOf:t}.valueOf()}var My=class{constructor(t,e){gd(t),this.privateDoNotAccessOrElseWrappedHtml=e}toString(){return this.privateDoNotAccessOrElseWrappedHtml+""}},$A=My;function ZA(t){return new $A(ta,t)}function Ny(t){const e=t,s=bc();return ZA(s?s.createHTML(e):e)}function KA(t){return t instanceof My}function vc(t){if(KA(t))return t.privateDoNotAccessOrElseWrappedHtml;{let e="";throw e="Unexpected type when unwrapping SafeHtml",new Error(e)}}var Ry=class{constructor(t,e){gd(t),this.privateDoNotAccessOrElseWrappedResourceUrl=e}toString(){return this.privateDoNotAccessOrElseWrappedResourceUrl+""}},QA=Ry;function JA(t){return new QA(ta,t)}function tS(t){const e=t,s=bc();return JA(s?s.createScriptURL(e):e)}function eS(t){return t instanceof Ry}function zr(t){if(eS(t))return t.privateDoNotAccessOrElseWrappedResourceUrl;{let e="";throw e="Unexpected type when unwrapping TrustedResourceUrl",new Error(e)}}var Rl,kg,Fy=class{constructor(t,e){gd(t),this.privateDoNotAccessOrElseWrappedScript=e}toString(){return this.privateDoNotAccessOrElseWrappedScript+""}},sS=Fy;function iS(t){return new sS(ta,t)}function Ec(t){const e=t,s=bc();return iS(s?s.createScript(e):e)}function nS(t){return t instanceof Fy}function Py(t){if(nS(t))return t.privateDoNotAccessOrElseWrappedScript;{let e="";throw e="Unexpected type when unwrapping SafeScript",new Error(e)}}function rS(t,e){e.appendChild(t);let s=new XMLSerializer().serializeToString(e);return s=s.slice(s.indexOf(">")+1,s.lastIndexOf("</")),Ny(s)}function Og(t){try{return new URL(t,window.document.baseURI)}catch{return new URL("about:invalid")}}function oS(t){let e;try{e=new URL(t)}catch{return"https:"}return e.protocol}(function(t){t[t.STYLE_ELEMENT=0]="STYLE_ELEMENT",t[t.STYLE_ATTRIBUTE=1]="STYLE_ATTRIBUTE",t[t.HTML_ATTRIBUTE=2]="HTML_ATTRIBUTE"})(Rl||(Rl={})),(function(t){t[t.AT_KEYWORD=0]="AT_KEYWORD",t[t.CDC=1]="CDC",t[t.CDO=2]="CDO",t[t.CLOSE_CURLY=3]="CLOSE_CURLY",t[t.CLOSE_PAREN=4]="CLOSE_PAREN",t[t.CLOSE_SQUARE=5]="CLOSE_SQUARE",t[t.COLON=6]="COLON",t[t.COMMA=7]="COMMA",t[t.DELIM=8]="DELIM",t[t.DIMENSION=9]="DIMENSION",t[t.EOF=10]="EOF",t[t.FUNCTION=11]="FUNCTION",t[t.HASH=12]="HASH",t[t.IDENT=13]="IDENT",t[t.NUMBER=14]="NUMBER",t[t.OPEN_CURLY=15]="OPEN_CURLY",t[t.OPEN_PAREN=16]="OPEN_PAREN",t[t.OPEN_SQUARE=17]="OPEN_SQUARE",t[t.PERCENTAGE=18]="PERCENTAGE",t[t.SEMICOLON=19]="SEMICOLON",t[t.STRING=20]="STRING",t[t.WHITESPACE=21]="WHITESPACE"})(kg||(kg={}));var aS=["data:","http:","https:","mailto:","ftp:"],lS=/^\s*(?!javascript:)(?:[\w+.-]+:|[^:/?#]*(?:[/?#]|$))/i;function dS(t){const e=!lS.test(t);return e&&console.error(`A URL with content '${t}' was sanitized away.`),e}function hS(t){if(!dS(t))return t}function ea(t){return hS(t)}function uS(t){const e=oS(t);return e!==void 0&&aS.indexOf(e.toLowerCase())!==-1?t:"about:invalid#zClosurez"}var cS="display:inline-block;clip-path:inset(0);overflow:hidden;vertical-align:top;text-decoration:inherit",gS=`:host{${cS}}`;function mS(t,e){return t.createContextualFragment(vc(e))}function fS(t,e){if(e.defaultView)throw new Error("createInertFragment called with non-inert document");const s=e.createRange();return s.selectNode(e.body),mS(s,Ny(t))}function Bg(t){const e=t.nodeName;return typeof e=="string"?e:"FORM"}function Ug(t){return t.nodeType===3}function Gg(t){const e=t.nodeType;return e===1||typeof e!="number"}var we,ui=class{constructor(t,e,s,i,n){this.allowedElements=t,this.elementPolicies=e,this.allowedGlobalAttributes=s,this.globalAttributePolicies=i,this.globallyAllowedAttributePrefixes=n}isAllowedElement(t){return t!=="FORM"&&(this.allowedElements.has(t)||this.elementPolicies.has(t))}getAttributePolicy(t,e){const s=this.elementPolicies.get(e);return s?.has(t)?s.get(t):this.allowedGlobalAttributes.has(t)?{policyAction:we.KEEP}:this.globalAttributePolicies.get(t)||(this.globallyAllowedAttributePrefixes&&[...this.globallyAllowedAttributePrefixes].some((n=>t.indexOf(n)===0))?{policyAction:we.KEEP}:{policyAction:we.DROP})}};(function(t){t[t.DROP=0]="DROP",t[t.KEEP=1]="KEEP",t[t.KEEP_AND_SANITIZE_URL=2]="KEEP_AND_SANITIZE_URL",t[t.KEEP_AND_NORMALIZE=3]="KEEP_AND_NORMALIZE",t[t.KEEP_AND_SANITIZE_STYLE=4]="KEEP_AND_SANITIZE_STYLE",t[t.KEEP_AND_USE_RESOURCE_URL_POLICY=5]="KEEP_AND_USE_RESOURCE_URL_POLICY",t[t.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET=6]="KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET"})(we||(we={}));var pS=new Set(["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"]);function _S(t){return!pS.has(t.toUpperCase())&&/^[a-z][-_.a-z0-9]*-[-_.a-z0-9]*$/i.test(t)}var yS=["ARTICLE","SECTION","NAV","ASIDE","H1","H2","H3","H4","H5","H6","HEADER","FOOTER","ADDRESS","P","HR","PRE","BLOCKQUOTE","OL","UL","LH","LI","DL","DT","DD","FIGURE","FIGCAPTION","MAIN","DIV","EM","STRONG","SMALL","S","CITE","Q","DFN","ABBR","RUBY","RB","RT","RTC","RP","DATA","TIME","CODE","VAR","SAMP","KBD","SUB","SUP","I","B","U","MARK","BDI","BDO","SPAN","BR","WBR","NOBR","INS","DEL","PICTURE","PARAM","TRACK","MAP","TABLE","CAPTION","COLGROUP","COL","TBODY","THEAD","TFOOT","TR","TD","TH","SELECT","DATALIST","OPTGROUP","OPTION","OUTPUT","PROGRESS","METER","FIELDSET","LEGEND","DETAILS","SUMMARY","MENU","DIALOG","SLOT","CANVAS","FONT","CENTER","ACRONYM","BASEFONT","BIG","DIR","HGROUP","STRIKE","TT"],xS=[["A",new Map([["href",{policyAction:we.KEEP_AND_SANITIZE_URL}]])],["AREA",new Map([["href",{policyAction:we.KEEP_AND_SANITIZE_URL}]])],["LINK",new Map([["href",{policyAction:we.KEEP_AND_USE_RESOURCE_URL_POLICY,conditions:new Map([["rel",new Set(["alternate","author","bookmark","canonical","cite","help","icon","license","next","prefetch","dns-prefetch","prerender","preconnect","preload","prev","search","subresource"])]])}]])],["SOURCE",new Map([["src",{policyAction:we.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:we.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["IMG",new Map([["src",{policyAction:we.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:we.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["VIDEO",new Map([["src",{policyAction:we.KEEP_AND_USE_RESOURCE_URL_POLICY}]])],["AUDIO",new Map([["src",{policyAction:we.KEEP_AND_USE_RESOURCE_URL_POLICY}]])]],bS=["title","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-current","aria-disabled","aria-dropeffect","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","alt","align","autocapitalize","autocomplete","autocorrect","autofocus","autoplay","bgcolor","border","cellpadding","cellspacing","checked","cite","color","cols","colspan","controls","controlslist","datetime","disabled","download","draggable","enctype","face","formenctype","frameborder","height","hreflang","hidden","ismap","label","lang","loop","max","maxlength","media","minlength","min","multiple","muted","nonce","open","placeholder","poster","preload","rel","required","reversed","role","rows","rowspan","selected","shape","size","sizes","slot","span","spellcheck","start","step","summary","translate","type","valign","value","width","wrap","itemscope","itemtype","itemid","itemprop","itemref"],vS=[["dir",{policyAction:we.KEEP_AND_NORMALIZE,conditions:_a((()=>new Map([["dir",new Set(["auto","ltr","rtl"])]])))}],["async",{policyAction:we.KEEP_AND_NORMALIZE,conditions:_a((()=>new Map([["async",new Set(["async"])]])))}],["loading",{policyAction:we.KEEP_AND_NORMALIZE,conditions:_a((()=>new Map([["loading",new Set(["eager","lazy"])]])))}],["target",{policyAction:we.KEEP_AND_NORMALIZE,conditions:_a((()=>new Map([["target",new Set(["_self","_blank"])]])))}]],ES=new ui(new Set(yS),new Map(xS),new Set(bS),new Map(vS),void 0),AS=class{constructor(t,e,s,i,n,r){this.sanitizerTable=t,this.styleElementSanitizer=s,this.styleAttributeSanitizer=i,this.resourceUrlPolicy=n,this.openShadow=r,this.changes=[],gd(e)}sanitizeAssertUnchanged(t){this.changes=[];const e=this.sanitize(t);if(this.changes.length!==0)throw new Error(`Unexpected change to HTML value as a result of sanitization. Input: "${t}", sanitized output: "${e}"
List of changes:${this.changes.join(`
`)}`);return e}sanitize(t){const e=document.implementation.createHTMLDocument("");return rS(this.sanitizeToFragmentInternal(t,e),e.body)}sanitizeToFragment(t){const e=document.implementation.createHTMLDocument("");return this.styleElementSanitizer&&this.styleAttributeSanitizer?this.sanitizeWithCssToFragment(t,e):this.sanitizeToFragmentInternal(t,e)}sanitizeWithCssToFragment(t,e){const s=document.createElement("safevalues-with-css"),i=this.openShadow?"open":"closed",n=s.attachShadow({mode:i}),r=this.sanitizeToFragmentInternal(t,e),o=document.createElement("style");o.textContent=gS,o.id="safevalues-internal-style",n.appendChild(o),n.appendChild(r);const a=e.createDocumentFragment();return a.appendChild(s),a}sanitizeToFragmentInternal(t,e){const s=fS(t,e),i=document.createTreeWalker(s,5,(a=>this.nodeFilter(a)));let n=i.nextNode();const r=e.createDocumentFragment();let o=r;for(;n!==null;){let a;if(Ug(n))if(this.styleElementSanitizer&&o.nodeName==="STYLE"){const l=this.styleElementSanitizer(n.data);a=this.createTextNode(l)}else a=this.sanitizeTextNode(n);else{if(!Gg(n)){let l="";throw l="Node is not of type text or element",new Error(l)}a=this.sanitizeElementNode(n,e)}if(o.appendChild(a),n=i.firstChild(),n)o=a;else for(;!(n=i.nextSibling())&&(n=i.parentNode());)o=o.parentNode}return r}createTextNode(t){return document.createTextNode(t)}sanitizeTextNode(t){return this.createTextNode(t.data)}sanitizeElementNode(t,e){const s=Bg(t),i=e.createElement(s),n=t.attributes;for(const{name:r,value:o}of n){const a=this.sanitizerTable.getAttributePolicy(r,s);if(this.satisfiesAllConditions(a.conditions,n))switch(a.policyAction){case we.KEEP:yi(i,r,o);break;case we.KEEP_AND_SANITIZE_URL:const l=uS(o);l!==o&&this.recordChange(`Url in attribute ${r} was modified during sanitization. Original url:"${o}" was sanitized to: "${l}"`),yi(i,r,l);break;case we.KEEP_AND_NORMALIZE:yi(i,r,o.toLowerCase());break;case we.KEEP_AND_SANITIZE_STYLE:this.styleAttributeSanitizer?yi(i,r,this.styleAttributeSanitizer(o)):yi(i,r,o);break;case we.KEEP_AND_USE_RESOURCE_URL_POLICY:if(this.resourceUrlPolicy){const d={type:Rl.HTML_ATTRIBUTE,attributeName:r,elementName:s},h=Og(o),u=this.resourceUrlPolicy(h,d);u&&yi(i,r,u.toString())}else yi(i,r,o);break;case we.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET:if(this.resourceUrlPolicy){const d={type:Rl.HTML_ATTRIBUTE,attributeName:r,elementName:s},h=SS(o),u={parts:[]};for(const c of h.parts){const g=Og(c.url),m=this.resourceUrlPolicy(g,d);m&&u.parts.push({url:m.toString(),descriptor:c.descriptor})}yi(i,r,wS(u))}else yi(i,r,o);break;case we.DROP:this.recordChange(`Attribute: ${r} was dropped`);break;default:TS(a.policyAction,"Unhandled AttributePolicyAction case")}else this.recordChange(`Not all conditions satisfied for attribute: ${r}.`)}return i}nodeFilter(t){if(Ug(t))return 1;if(!Gg(t))return 2;const e=Bg(t);return e===null?(this.recordChange(`Node name was null for node: ${t}`),2):this.sanitizerTable.isAllowedElement(e)?1:(this.recordChange(`Element: ${e} was dropped`),2)}recordChange(t){this.changes.push(t)}satisfiesAllConditions(t,e){var s;if(!t)return!0;for(const[i,n]of t){const r=(s=e.getNamedItem(i))===null||s===void 0?void 0:s.value;if(r&&!n.has(r))return!1}return!0}};function yi(t,e,s){t.setAttribute(e,s)}function SS(t){const e=[];for(const s of t.split(",")){const[i,n]=s.trim().split(/\s+/,2);e.push({url:i,descriptor:n})}return{parts:e}}function wS(t){return t.parts.map((e=>{const{url:s,descriptor:i}=e;return`${s}${i?` ${i}`:""}`})).join(" , ")}function TS(t,e=`unexpected value ${t}!`){throw new Error(e)}var CS=class{constructor(){this.calledBuild=!1,this.sanitizerTable=ES}onlyAllowElements(t){const e=new Set,s=new Map;for(let i of t){if(i=i.toUpperCase(),!this.sanitizerTable.isAllowedElement(i))throw new Error(`Element: ${i}, is not allowed by html5_contract.textpb`);const n=this.sanitizerTable.elementPolicies.get(i);n!==void 0?s.set(i,n):e.add(i)}return this.sanitizerTable=new ui(e,s,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowCustomElement(t,e){const s=new Set(this.sanitizerTable.allowedElements),i=new Map(this.sanitizerTable.elementPolicies);if(!_S(t=t.toUpperCase()))throw new Error(`Element: ${t} is not a custom element`);if(e){const n=new Map;for(const r of e)n.set(r.toLowerCase(),{policyAction:we.KEEP});i.set(t,n)}else s.add(t);return this.sanitizerTable=new ui(s,i,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}onlyAllowAttributes(t){const e=new Set,s=new Map,i=new Map;for(const n of t)this.sanitizerTable.allowedGlobalAttributes.has(n)&&e.add(n),this.sanitizerTable.globalAttributePolicies.has(n)&&s.set(n,this.sanitizerTable.globalAttributePolicies.get(n));for(const[n,r]of this.sanitizerTable.elementPolicies.entries()){const o=new Map;for(const[a,l]of r.entries())t.has(a)&&o.set(a,l);i.set(n,o)}return this.sanitizerTable=new ui(this.sanitizerTable.allowedElements,i,e,s,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowDataAttributes(t){if(t===void 0){const s=new Set(this.sanitizerTable.globallyAllowedAttributePrefixes);return s.add("data-"),this.sanitizerTable=new ui(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,s),this}const e=new Set(this.sanitizerTable.allowedGlobalAttributes);for(const s of t){if(s.indexOf("data-")!==0)throw new Error(`data attribute: ${s} does not begin with the prefix "data-"`);e.add(s)}return this.sanitizerTable=new ui(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,e,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowStyleAttributes(){const t=new Map(this.sanitizerTable.globalAttributePolicies);return t.set("style",{policyAction:we.KEEP_AND_SANITIZE_STYLE}),this.sanitizerTable=new ui(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,this.sanitizerTable.allowedGlobalAttributes,t,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowClassAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("class"),this.sanitizerTable=new ui(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowIdAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("id"),this.sanitizerTable=new ui(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowIdReferenceAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("aria-activedescendant").add("aria-controls").add("aria-labelledby").add("aria-owns").add("for").add("list"),this.sanitizerTable=new ui(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}withResourceUrlPolicy(t){return this.resourceUrlPolicy=t,this}},LS=class extends CS{build(){if(this.calledBuild)throw new Error("this sanitizer has already called build");return this.calledBuild=!0,new AS(this.sanitizerTable,ta,void 0,void 0,this.resourceUrlPolicy)}};function IS(t){const e=Py(t).toString(),s=new Blob([e],{type:"text/javascript"});return tS(URL.createObjectURL(s))}function kr(t,...e){if(e.some((s=>s!=="")))throw new Error("safeScript only allows empty string expressions to enable inline comments.");return VA(t,e.length),Ec(t.join(""))}function MS(t){return Ec(t.map(Py).join(""))}function zy(t,e){const s=ea(e);s!==void 0&&(t.href=s)}function NS(t,e){const s=ea(e);s!==void 0&&(t.href=s)}function RS(t,e){t.href=zr(e)}function FS(t,e){const s=ea(e);s!==void 0&&(t.formAction=s)}function PS(t,e){t.src=zr(e)}function zS(t,e){const s=ea(e);s!==void 0&&(t.action=s)}function DS(t,e){t.src=zr(e).toString()}function kS(t,e){t.srcdoc=vc(e)}function OS(t,e){const s=ea(e);s!==void 0&&(t.formAction=s)}function BS(t,e){t.data=zr(e)}function US(t){return GS("script",t)}function GS(t,e=document){var s;const i=(s=e.querySelector)===null||s===void 0?void 0:s.call(e,`${t}[nonce]`);return i==null?"":i.nonce||i.getAttribute("nonce")||""}function VS(t){const e=US(t.ownerDocument);e&&t.setAttribute("nonce",e)}function qS(t,e,s){t.src=zr(e),VS(t)}function Dy(t,e){jS(t)&&HS(t),t.innerHTML=vc(e)}function HS(t){let e="";const s=t.tagName;if(/^(script|style)$/i.test(s))throw e=s.toLowerCase()==="script"?"Use setScriptTextContent with a SafeScript.":"Use setStyleTextContent with a SafeStyleSheet.",new Error(e)}function jS(t){return t.nodeType===1}function YS(t,e,s){if(t.namespaceURI!=="http://www.w3.org/1999/xhtml")throw new Error(`Cannot set attribute '${e}' on '${t.tagName}'.Element is not in the HTML namespace`);switch(e=e.toLowerCase(),`${t.tagName} ${e}`){case"A href":return void zy(t,s);case"AREA href":return void NS(t,s);case"BASE href":return void RS(t,s);case"BUTTON formaction":return void FS(t,s);case"EMBED src":return void PS(t,s);case"FORM action":return void zS(t,s);case"IFRAME src":return void DS(t,s);case"IFRAME srcdoc":return void kS(t,s);case"IFRAME sandbox":throw new Error("Can't set 'sandbox' on iframe tags. Use setIframeSrcWithIntent or setIframeSrcdocWithIntent instead");case"INPUT formaction":return void OS(t,s);case"LINK href":throw new Error("Can't set 'href' attribute on link tags. Use setLinkHrefAndRel instead");case"LINK rel":throw new Error("Can't set 'rel' attribute on link tags. Use setLinkHrefAndRel instead");case"OBJECT data":return void BS(t,s);case"SCRIPT src":return void qS(t,s);default:if(/^on./.test(e))throw new Error(`Attribute "${e}" looks like an event handler attribute. Please use a safe alternative like addEventListener instead.`);t.setAttribute(e,s)}}function XS(t,e){return new Worker(zr(t),e)}var WS=typeof global=="object"&&global!==null&&global.it!==void 0,Ri=typeof document<"u",sn=typeof window<"u",md=sn&&!window.__OGMA_HEADLESS,fd=md&&Ri,$S=typeof navigator<"u"&&navigator.userAgent!==void 0?navigator.userAgent.toLowerCase():"",ZS=sn&&/mac/.test($S),ky=typeof performance<"u"&&performance.now?()=>0|performance.now():()=>Date.now(),KS=ky();function ps(){return ky()-KS}function Oy(){const t=new Date,e=t.getDate(),s=t.getMonth()+1;return`${t.getFullYear()}-${s<10?"0"+s:s}-${e<10?"0"+e:e}`}function By(){const t=new Date;return`[${ya((t.getUTCHours()-(t.getTimezoneOffset()/60|0))%24)}:${ya(t.getUTCMinutes())}:${ya(t.getUTCSeconds())}:${ya(t.getUTCMilliseconds(),3)}]`}function ya(t,e=2){let s=Math.pow(10,e-1),i=String(t);for(;s>1;)t<s&&(i="0"+i),s/=10;return i}function tn(t){WS||console.warn(By()+" "+t)}function QS(t,e){e.forEach((s=>{Object.getOwnPropertyNames(s.prototype).forEach((i=>{Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(s.prototype,i)||Object.create(null))}))}))}var ae=()=>{},Fl=()=>!1,Ac=()=>!0,Pl=()=>null,ni=t=>t;function Uy(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];s(i.get(r),n,e)}}function Gy(t,e,s){const i=new Array(e.size),n=t.getObjectList(e.isNode);for(let r=0;r<e._indexes.length;++r){const o=e._indexes[r],a=n.get(o);i[r]=s(a,r,e)}return i}function Vy(t,e,s){s=s||Ac;const i=e.isNode,n=t.acquireIndexList(i),r=t.getObjectList(i),o=t.getListFactory(i);for(let a=0;a<e._indexes.length;++a){const l=e._indexes[a],d=r.get(l);d&&s(d,a,e)&&n.push(l)}return o(n.sliceAndReset())}function qy(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];if(!s(i.get(r),n,e))return!1}return!0}function Hy(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];if(s(i.get(r),n,e))return!0}return!1}function jy(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n],o=i.get(r);if(s(o,n,e))return o}}function Yy(t,e,s,i){const n=t.getListFactory(e.isNode);if(!s)return{valid:e,invalid:n()};const r=t.acquireIndexList(e.isNode),o=t.acquireIndexList(e.isNode),a=t.getObjectList(e.isNode);for(let l=0;l<e._indexes.length;l++){const d=e._indexes[l],h=a.get(d);h!==void 0&&(s(h,i)?r:o).pushUnchecked(d)}return{valid:n(r.sliceAndReset()),invalid:n(o.sliceAndReset())}}function Xy(t,e,s,i){const n=t.getObjectList(e.isNode);let r=i;for(let o=0;o<e._indexes.length;++o){const a=e._indexes[o];r=s(r,n.get(a),o)}return r}function Wy(t,e){const s=e.isNode,i=t.topology.getDeduper(s),n=t.acquireIndexList(s),r=t.getListFactory(s);for(let o=0;o<e._indexes.length;o++){const a=e._indexes[o];i.get(a)===0&&(i.set(a,1),n.push(a))}return r(n.sliceAndReset())}function $y(t,e,s){const i=e.isNode,n=s.topology.getDeduper(i),r=s.acquireIndexList(i),o=s.getListFactory(i);for(let a=0;a<e._indexes.length;a++){const l=e._indexes[a];n.set(l,1)}for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];n.get(l)===0&&r.push(l)}return o(r.sliceAndReset())}function Zy(t,e){const s=e.isNode,i=t.storage.fetch(s),n=i.getFlexArray("excluded"),r=i.getMaxIndex(),o=t.topology.getDeduper(s),a=t.acquireIndexList(s),l=t.getListFactory(s);for(let d=0;d<e._indexes.length;d++)o.set(e._indexes[d],1);for(let d=1;d<=r;++d)o.get(d)===0&&n.get(d)===0&&a.push(d);return l(a.sliceAndReset())}function Ky(t,e,s){const i=t.getListFactory(e.isNode),n=new Uint32Array(e._indexes.length+s._indexes.length);return n.set(e._indexes),n.set(s._indexes,e._indexes.length),i(n)}function Qy(t,e){return t.getObjectList(e.isNode).getMultiple(e._indexes)}function pd(t,e){const s=t.getStorage(e.isNode);if(e.isList){const i=new Array(e.size);for(let n=0;n<e._indexes.length;++n)i[n]=s.getId(e._indexes[n]);return i}return s.getId(e._index)}function Jy(t,e){return t.topology.getExtremity(!0,e)}function tx(t,e){return t.topology.getExtremity(!1,e)}function ex(t,e,s){return t.getObjectList(e.isNode).get(e._indexes[s])}function sx(t,e,s){const i=t.getListFactory(e.isNode),n=t.getObjectList(e.isNode),r=e._indexes.slice();return r.sort(((o,a)=>{const l=n.get(o),d=n.get(a);return s(l,d)})),i(r)}var JS=[];function ix(t){typeof t=="object"&&t!==null||(t={});const e=typeof t.data=="function"?t.data:ni;return{attributes:Array.isArray(t.attributes)?t.attributes:t.attributes||JS,data:e}}function _d(t,e){for(const s of t){const i=e;Object.keys(i).forEach((n=>{const r=i[n];s.prototype[n]=function(o,a){return tn(`Deprecated method "${n}"; please use "${r}" instead.`),this[r](o,a)}}))}}function Vg(t){const e=t.getFlexArray("removed"),s=t.getFlexArray("excluded"),i=t.getFlexArray("virtual");return{all:n=>e.get(n)===0,visible:n=>s.get(n)===0,excluded:n=>s.get(n)===1,raw:n=>i.get(n)===0&&e.get(n)===0,_all:n=>!0}}function qg(t,e,s){return{all:xa(s.all,t,e),visible:xa(s.visible,t,e),raw:xa(s.raw,t,e),_all:xa(s._all,t,e)}}function xa(t,e,s){let i=null;return{getList(){if(!i){const n=e(),r=s();r.reset();for(let o=1;o<=n;++o)t(o)&&r.push(o);i=r.sliceAndReset()}return i},invalidList(){i=null}}}function tw(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`${t} is not a valid id, expected string or number`);return t}var Hg=new Uint32Array(1),nn=class{constructor(t,e){this.size=1,this.isNode=!1,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return Hg[0]=this._index,Hg}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}hasParallelEdges(){return this._ogma.modules.graph.hasParallelEdges(this)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.filter((s=>s!==this)).dedupe()}}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.modules.graph.edgeList(new Uint32Array([this._index]))}getId(){return pd(this._ogma.modules.graph,this)}getSource(){return Jy(this._ogma.modules.graph,this)}getTarget(){return tx(this._ogma.modules.graph,this)}getExtremities(){return this._ogma.modules.graph.nodeList(new Uint32Array([this.getSource()._index,this.getTarget()._index]))}setSource(t){this._ogma.modules.graph.setSource(this,t)}setTarget(t){this._ogma.modules.graph.setTarget(this,t)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=ix(t);return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(e),data:s(ke(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdge(this)}getSubEdges(){return this._ogma.modules.transformations.getSubEdges(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};_d([nn],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var Un=class{constructor(t,e){this.isList=!0,this.isNode=!1,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.subtract(this).dedupe()}}isVisible(){return this.isExcluded().map((t=>!t))}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map((t=>this._ogma.modules.transformations.isElementVirtual(t)))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Qy(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.edgeList(this._indexes.slice())}getId(){return pd(this._ogma.modules.graph,this)}getSource(){return Jy(this._ogma.modules.graph,this)}getTarget(){return tx(this._ogma.modules.graph,this)}getExtremities(){return this.getSource().concat(this.getTarget())}get(t){return ex(this._ogma.modules.graph,this,t)}forEach(t){Uy(this._ogma.modules.graph,this,t)}map(t){return Gy(this._ogma.modules.graph,this,t)}find(t){return jy(this._ogma.modules.graph,this,t)}some(t){return Hy(this._ogma.modules.graph,this,t)}every(t){return qy(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return Vy(this._ogma.modules.graph,this,t)}reduce(t,e){return Xy(this._ogma.modules.graph,this,t,e)}concat(t){return Ky(this._ogma.modules.graph,this,t)}dedupe(){return Wy(this._ogma.modules.graph,this)}subtract(t){return $y(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.edgeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof nn?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}sort(t){return sx(this._ogma.modules.graph,this,t)}inverse(){return Zy(this._ogma.modules.graph,this)}toJSON(t={}){return this.map((e=>e.toJSON(t)))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!as(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map((e=>this._ogma.modules.classes.hasSingleElementClass(t,e)))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdges(this)}getSubEdges(){return this.map(this._ogma.modules.transformations.getSubEdges)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};_d([Un],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var mi="geo.latitude",fi="geo.longitude",jg="geo.prevLat",qd="geo.prevLng",Zh=85.0511287798,ew=6378137,zl=1,sw='Map data &copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap contributors</a>',En={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:22,minZoomLevel:0,wrapCoordinates:!0,tileUrlTemplate:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:void 0,backgroundColor:"silver",opacity:1,duration:0,disableNodeDragging:!0,tileBuffer:1,sizeRatio:1,tiles:{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",subdomains:"abc",tms:!1,wms:!1},crs:void 0},iw={maxBoundsViscosity:1,worldCopyJump:!0,zoomControl:!1,attributionControl:!1},nw=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let s=0;for(let i=0;i<this._n&&i<32;i++){const n=e[i],r=t+n,o=Math.abs(t)<Math.abs(n)?t-(r-n):n-(r-t);o&&(e[s++]=o),t=r}return e[s]=t,this._n=s+1,this}valueOf(){const t=this._partials;let e,s,i,n=this._n,r=0;if(n>0){for(r=t[--n];n>0&&(e=r,s=t[--n],r=e+s,i=s-(r-e),!i););n>0&&(i<0&&t[n-1]<0||i>0&&t[n-1]>0)&&(s=2*i,e=r+s,s==e-r&&(r=e))}return r}};function*rw(t){for(const e of t)yield*e}function nx(t){return Array.from(rw(t))}var Te=1e-6,me=Math.PI,js=me/2,Yg=me/4,ri=2*me,xi=180/me,Fs=me/180,Ve=Math.abs,ow=Math.atan,Ar=Math.atan2,De=Math.cos,Fe=Math.sin,aw=Math.sign||function(t){return t>0?1:t<0?-1:0},sa=Math.sqrt;function rx(t){return t>1?0:t<-1?me:Math.acos(t)}function Sr(t){return t>1?js:t<-1?-js:Math.asin(t)}function to(){}function Dl(t,e){t&&Wg.hasOwnProperty(t.type)&&Wg[t.type](t,e)}var Xg={Feature:function(t,e){Dl(t.geometry,e)},FeatureCollection:function(t,e){for(var s=t.features,i=-1,n=s.length;++i<n;)Dl(s[i].geometry,e)}},Wg={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)t=s[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){Kh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)Kh(s[i],e,0)},Polygon:function(t,e){$g(t.coordinates,e)},MultiPolygon:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)$g(s[i],e)},GeometryCollection:function(t,e){for(var s=t.geometries,i=-1,n=s.length;++i<n;)Dl(s[i],e)}};function Kh(t,e,s){var i,n=-1,r=t.length-s;for(e.lineStart();++n<r;)i=t[n],e.point(i[0],i[1],i[2]);e.lineEnd()}function $g(t,e){var s=-1,i=t.length;for(e.polygonStart();++s<i;)Kh(t[s],e,1);e.polygonEnd()}function lw(t,e){t&&Xg.hasOwnProperty(t.type)?Xg[t.type](t,e):Dl(t,e)}function Qh(t){return[Ar(t[1],t[0]),Sr(t[2])]}function wr(t){var e=t[0],s=t[1],i=De(s);return[i*De(e),i*Fe(e),Fe(s)]}function ba(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function kl(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Hd(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function va(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Jh(t){var e=sa(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function tu(t,e){function s(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(s.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),s}function eu(t,e){return Ve(t)>me&&(t-=Math.round(t/ri)*ri),[t,e]}function dw(t,e,s){return(t%=ri)?e||s?tu(Kg(t),Qg(e,s)):Kg(t):e||s?Qg(e,s):eu}function Zg(t){return function(e,s){return Ve(e+=t)>me&&(e-=Math.round(e/ri)*ri),[e,s]}}function Kg(t){var e=Zg(t);return e.invert=Zg(-t),e}function Qg(t,e){var s=De(t),i=Fe(t),n=De(e),r=Fe(e);function o(a,l){var d=De(l),h=De(a)*d,u=Fe(a)*d,c=Fe(l),g=c*s+h*i;return[Ar(u*n-g*r,h*s-c*i),Sr(g*n+u*r)]}return o.invert=function(a,l){var d=De(l),h=De(a)*d,u=Fe(a)*d,c=Fe(l),g=c*n-u*r;return[Ar(u*n+c*r,h*s+g*i),Sr(g*s-h*i)]},o}function hw(t,e,s,i,n,r){if(s){var o=De(e),a=Fe(e),l=i*s;n==null?(n=e+i*ri,r=e-l/2):(n=Jg(o,n),r=Jg(o,r),(i>0?n<r:n>r)&&(n+=i*ri));for(var d,h=n;i>0?h>r:h<r;h-=l)d=Qh([o,-a*De(h),-a*Fe(h)]),t.point(d[0],d[1])}}function Jg(t,e){(e=wr(e))[0]-=t,Jh(e);var s=rx(-e[1]);return((-e[2]<0?-s:s)+ri-Te)%ri}function ox(){var t,e=[];return{point:function(s,i,n){t.push([s,i,n])},lineStart:function(){e.push(t=[])},lineEnd:to,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var s=e;return e=[],t=null,s}}}function pl(t,e){return Ve(t[0]-e[0])<Te&&Ve(t[1]-e[1])<Te}function Ea(t,e,s,i){this.x=t,this.z=e,this.o=s,this.e=i,this.v=!1,this.n=this.p=null}function ax(t,e,s,i,n){var r,o,a=[],l=[];if(t.forEach((function(m){if(!((f=m.length-1)<=0)){var f,p,_=m[0],x=m[f];if(pl(_,x)){if(!_[2]&&!x[2]){for(n.lineStart(),r=0;r<f;++r)n.point((_=m[r])[0],_[1]);return void n.lineEnd()}x[0]+=2*Te}a.push(p=new Ea(_,m,null,!0)),l.push(p.o=new Ea(_,null,p,!1)),a.push(p=new Ea(x,m,null,!1)),l.push(p.o=new Ea(x,null,p,!0))}})),a.length){for(l.sort(e),tm(a),tm(l),r=0,o=l.length;r<o;++r)l[r].e=s=!s;for(var d,h,u=a[0];;){for(var c=u,g=!0;c.v;)if((c=c.n)===u)return;d=c.z,n.lineStart();do{if(c.v=c.o.v=!0,c.e){if(g)for(r=0,o=d.length;r<o;++r)n.point((h=d[r])[0],h[1]);else i(c.x,c.n.x,1,n);c=c.n}else{if(g)for(d=c.p.z,r=d.length-1;r>=0;--r)n.point((h=d[r])[0],h[1]);else i(c.x,c.p.x,-1,n);c=c.p}d=(c=c.o).z,g=!g}while(!c.v);n.lineEnd()}}}function tm(t){if(e=t.length){for(var e,s,i=0,n=t[0];++i<e;)n.n=s=t[i],s.p=n,n=s;n.n=s=t[0],s.p=n}}function jd(t){return Ve(t[0])<=me?t[0]:aw(t[0])*((Ve(t[0])+me)%ri-me)}function uw(t,e){var s=jd(e),i=e[1],n=Fe(i),r=[Fe(s),-De(s),0],o=0,a=0,l=new nw;n===1?i=js+Te:n===-1&&(i=-js-Te);for(var d=0,h=t.length;d<h;++d)if(c=(u=t[d]).length)for(var u,c,g=u[c-1],m=jd(g),f=g[1]/2+Yg,p=Fe(f),_=De(f),x=0;x<c;++x,m=b,p=A,_=S,g=y){var y=u[x],b=jd(y),v=y[1]/2+Yg,A=Fe(v),S=De(v),w=b-m,I=w>=0?1:-1,M=I*w,N=M>me,D=p*A;if(l.add(Ar(D*I*Fe(M),_*S+D*De(M))),o+=N?w+I*ri:w,N^m>=s^b>=s){var q=kl(wr(g),wr(y));Jh(q);var et=kl(r,q);Jh(et);var O=(N^w>=0?-1:1)*Sr(et[2]);(i>O||i===O&&(q[0]||q[1]))&&(a+=N^w>=0?1:-1)}}return(o<-Te||o<Te&&l<-1e-12)^1&a}function lx(t,e,s,i){return function(n){var r,o,a,l=e(n),d=ox(),h=e(d),u=!1,c={point:g,lineStart:f,lineEnd:p,polygonStart:function(){c.point=_,c.lineStart=x,c.lineEnd=y,o=[],r=[]},polygonEnd:function(){c.point=g,c.lineStart=f,c.lineEnd=p,o=nx(o);var b=uw(r,i);o.length?(u||(n.polygonStart(),u=!0),ax(o,gw,b,s,n)):b&&(u||(n.polygonStart(),u=!0),n.lineStart(),s(null,null,1,n),n.lineEnd()),u&&(n.polygonEnd(),u=!1),o=r=null},sphere:function(){n.polygonStart(),n.lineStart(),s(null,null,1,n),n.lineEnd(),n.polygonEnd()}};function g(b,v){t(b,v)&&n.point(b,v)}function m(b,v){l.point(b,v)}function f(){c.point=m,l.lineStart()}function p(){c.point=g,l.lineEnd()}function _(b,v){a.push([b,v]),h.point(b,v)}function x(){h.lineStart(),a=[]}function y(){_(a[0][0],a[0][1]),h.lineEnd();var b,v,A,S,w=h.clean(),I=d.result(),M=I.length;if(a.pop(),r.push(a),a=null,M)if(1&w){if((v=(A=I[0]).length-1)>0){for(u||(n.polygonStart(),u=!0),n.lineStart(),b=0;b<v;++b)n.point((S=A[b])[0],S[1]);n.lineEnd()}}else M>1&&2&w&&I.push(I.pop().concat(I.shift())),o.push(I.filter(cw))}return c}}function cw(t){return t.length>1}function gw(t,e){return((t=t.x)[0]<0?t[1]-js-Te:js-t[1])-((e=e.x)[0]<0?e[1]-js-Te:js-e[1])}eu.invert=eu;var em=lx((function(){return!0}),mw,pw,[-me,-js]);function mw(t){var e,s=NaN,i=NaN,n=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(r,o){var a=r>0?me:-me,l=Ve(r-s);Ve(l-me)<Te?(t.point(s,i=(i+o)/2>0?js:-js),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(r,i),e=0):n!==a&&l>=me&&(Ve(s-n)<Te&&(s-=n*Te),Ve(r-a)<Te&&(r-=a*Te),i=fw(s,i,r,o),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),e=0),t.point(s=r,i=o),n=a},lineEnd:function(){t.lineEnd(),s=i=NaN},clean:function(){return 2-e}}}function fw(t,e,s,i){var n,r,o=Fe(t-s);return Ve(o)>Te?ow((Fe(e)*(r=De(i))*Fe(s)-Fe(i)*(n=De(e))*Fe(t))/(n*r*o)):(e+i)/2}function pw(t,e,s,i){var n;if(t==null)n=s*js,i.point(-me,n),i.point(0,n),i.point(me,n),i.point(me,0),i.point(me,-n),i.point(0,-n),i.point(-me,-n),i.point(-me,0),i.point(-me,n);else if(Ve(t[0]-e[0])>Te){var r=t[0]<e[0]?me:-me;n=s*r/2,i.point(-r,n),i.point(0,n),i.point(r,n)}else i.point(e[0],e[1])}function _w(t){var e=De(t),s=2*Fs,i=e>0,n=Ve(e)>Te;function r(l,d){return De(l)*De(d)>e}function o(l,d,h){var u=[1,0,0],c=kl(wr(l),wr(d)),g=ba(c,c),m=c[0],f=g-m*m;if(!f)return!h&&l;var p=e*g/f,_=-e*m/f,x=kl(u,c),y=va(u,p);Hd(y,va(c,_));var b=x,v=ba(y,b),A=ba(b,b),S=v*v-A*(ba(y,y)-1);if(!(S<0)){var w=sa(S),I=va(b,(-v-w)/A);if(Hd(I,y),I=Qh(I),!h)return I;var M,N=l[0],D=d[0],q=l[1],et=d[1];D<N&&(M=N,N=D,D=M);var O=D-N,K=Ve(O-me)<Te;if(!K&&et<q&&(M=q,q=et,et=M),K||O<Te?K?q+et>0^I[1]<(Ve(I[0]-N)<Te?q:et):q<=I[1]&&I[1]<=et:O>me^(N<=I[0]&&I[0]<=D)){var j=va(b,(-v+w)/A);return Hd(j,y),[I,Qh(j)]}}}function a(l,d){var h=i?t:me-t,u=0;return l<-h?u|=1:l>h&&(u|=2),d<-h?u|=4:d>h&&(u|=8),u}return lx(r,(function(d){var h,u,c,g,m;return{lineStart:function(){g=c=!1,m=1},point:function(f,p){var _,x=[f,p],y=r(f,p),b=i?y?0:a(f,p):y?a(f+(f<0?me:-me),p):0;if(!h&&(g=c=y)&&d.lineStart(),y!==c&&(!(_=o(h,x))||pl(h,_)||pl(x,_))&&(x[2]=1),y!==c)m=0,y?(d.lineStart(),_=o(x,h),d.point(_[0],_[1])):(_=o(h,x),d.point(_[0],_[1],2),d.lineEnd()),h=_;else if(n&&h&&i^y){var v;b&u||!(v=o(x,h,!0))||(m=0,i?(d.lineStart(),d.point(v[0][0],v[0][1]),d.point(v[1][0],v[1][1]),d.lineEnd()):(d.point(v[1][0],v[1][1]),d.lineEnd(),d.lineStart(),d.point(v[0][0],v[0][1],3)))}!y||h&&pl(h,x)||d.point(x[0],x[1]),h=x,c=y,u=b},lineEnd:function(){c&&d.lineEnd(),h=null},clean:function(){return m|(g&&c)<<1}}}),(function(d,h,u,c){hw(c,t,s,u,d,h)}),i?[0,-t]:[-me,t-me])}function yw(t,e,s,i,n,r){var o,a=t[0],l=t[1],d=0,h=1,u=e[0]-a,c=e[1]-l;if(o=s-a,u||!(o>0)){if(o/=u,u<0){if(o<d)return;o<h&&(h=o)}else if(u>0){if(o>h)return;o>d&&(d=o)}if(o=n-a,u||!(o<0)){if(o/=u,u<0){if(o>h)return;o>d&&(d=o)}else if(u>0){if(o<d)return;o<h&&(h=o)}if(o=i-l,c||!(o>0)){if(o/=c,c<0){if(o<d)return;o<h&&(h=o)}else if(c>0){if(o>h)return;o>d&&(d=o)}if(o=r-l,c||!(o<0)){if(o/=c,c<0){if(o>h)return;o>d&&(d=o)}else if(c>0){if(o<d)return;o<h&&(h=o)}return d>0&&(t[0]=a+d*u,t[1]=l+d*c),h<1&&(e[0]=a+h*u,e[1]=l+h*c),!0}}}}}var eo=1e9,Aa=-eo;function xw(t,e,s,i){function n(d,h){return t<=d&&d<=s&&e<=h&&h<=i}function r(d,h,u,c){var g=0,m=0;if(d==null||(g=o(d,u))!==(m=o(h,u))||l(d,h)<0^u>0)do c.point(g===0||g===3?t:s,g>1?i:e);while((g=(g+u+4)%4)!==m);else c.point(h[0],h[1])}function o(d,h){return Ve(d[0]-t)<Te?h>0?0:3:Ve(d[0]-s)<Te?h>0?2:1:Ve(d[1]-e)<Te?h>0?1:0:h>0?3:2}function a(d,h){return l(d.x,h.x)}function l(d,h){var u=o(d,1),c=o(h,1);return u!==c?u-c:u===0?h[1]-d[1]:u===1?d[0]-h[0]:u===2?d[1]-h[1]:h[0]-d[0]}return function(d){var h,u,c,g,m,f,p,_,x,y,b,v=d,A=ox(),S={point:w,lineStart:function(){S.point=I,u&&u.push(c=[]),y=!0,x=!1,p=_=NaN},lineEnd:function(){h&&(I(g,m),f&&x&&A.rejoin(),h.push(A.result())),S.point=w,x&&v.lineEnd()},polygonStart:function(){v=A,h=[],u=[],b=!0},polygonEnd:function(){var N=(function(){for(var O=0,K=0,j=u.length;K<j;++K)for(var ot,it,ct=u[K],pt=1,Pt=ct.length,At=ct[0],bt=At[0],It=At[1];pt<Pt;++pt)ot=bt,it=It,bt=(At=ct[pt])[0],It=At[1],it<=i?It>i&&(bt-ot)*(i-it)>(It-it)*(t-ot)&&++O:It<=i&&(bt-ot)*(i-it)<(It-it)*(t-ot)&&--O;return O})(),D=b&&N,q=(h=nx(h)).length;(D||q)&&(d.polygonStart(),D&&(d.lineStart(),r(null,null,1,d),d.lineEnd()),q&&ax(h,a,N,r,d),d.polygonEnd()),v=d,h=u=c=null}};function w(M,N){n(M,N)&&v.point(M,N)}function I(M,N){var D=n(M,N);if(u&&c.push([M,N]),y)g=M,m=N,f=D,y=!1,D&&(v.lineStart(),v.point(M,N));else if(D&&x)v.point(M,N);else{var q=[p=Math.max(Aa,Math.min(eo,p)),_=Math.max(Aa,Math.min(eo,_))],et=[M=Math.max(Aa,Math.min(eo,M)),N=Math.max(Aa,Math.min(eo,N))];yw(q,et,t,e,s,i)?(x||(v.lineStart(),v.point(q[0],q[1])),v.point(et[0],et[1]),D||v.lineEnd(),b=!1):D&&(v.lineStart(),v.point(M,N),b=!1)}p=M,_=N,x=D}return S}}var sm=t=>t,Tr=1/0,Ol=Tr,Po=-Tr,Bl=Po,bw={point:vw,lineStart:to,lineEnd:to,polygonStart:to,polygonEnd:to,result:function(){var t=[[Tr,Ol],[Po,Bl]];return Po=Bl=-(Ol=Tr=1/0),t}};function vw(t,e){t<Tr&&(Tr=t),t>Po&&(Po=t),e<Ol&&(Ol=e),e>Bl&&(Bl=e)}var im=bw;function Sc(t){return function(e){var s=new su;for(var i in t)s[i]=t[i];return s.stream=e,s}}function su(){}function wc(t,e,s){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),lw(s,t.stream(im)),e(im.result()),i!=null&&t.clipExtent(i),t}function dx(t,e,s){return wc(t,(function(i){var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(n/(i[1][0]-i[0][0]),r/(i[1][1]-i[0][1])),a=+e[0][0]+(n-o*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(r-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([a,l])}),s)}function Ew(t,e,s){return dx(t,[[0,0],e],s)}function Aw(t,e,s){return wc(t,(function(i){var n=+e,r=n/(i[1][0]-i[0][0]),o=(n-r*(i[1][0]+i[0][0]))/2,a=-r*i[0][1];t.scale(150*r).translate([o,a])}),s)}function Sw(t,e,s){return wc(t,(function(i){var n=+e,r=n/(i[1][1]-i[0][1]),o=-r*i[0][0],a=(n-r*(i[1][1]+i[0][1]))/2;t.scale(150*r).translate([o,a])}),s)}su.prototype={constructor:su,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var nm=16,ww=De(30*Fs);function rm(t,e){return+e?Cw(t,e):Tw(t)}function Tw(t){return Sc({point:function(e,s){e=t(e,s),this.stream.point(e[0],e[1])}})}function Cw(t,e){function s(i,n,r,o,a,l,d,h,u,c,g,m,f,p){var _=d-i,x=h-n,y=_*_+x*x;if(y>4*e&&f--){var b=o+c,v=a+g,A=l+m,S=sa(b*b+v*v+A*A),w=Sr(A/=S),I=Ve(Ve(A)-1)<Te||Ve(r-u)<Te?(r+u)/2:Ar(v,b),M=t(I,w),N=M[0],D=M[1],q=N-i,et=D-n,O=x*q-_*et;(O*O/y>e||Ve((_*q+x*et)/y-.5)>.3||o*c+a*g+l*m<ww)&&(s(i,n,r,o,a,l,N,D,I,b/=S,v/=S,A,f,p),p.point(N,D),s(N,D,I,b,v,A,d,h,u,c,g,m,f,p))}}return function(i){var n,r,o,a,l,d,h,u,c,g,m,f,p={point:_,lineStart:x,lineEnd:b,polygonStart:function(){i.polygonStart(),p.lineStart=v},polygonEnd:function(){i.polygonEnd(),p.lineStart=x}};function _(w,I){w=t(w,I),i.point(w[0],w[1])}function x(){u=NaN,p.point=y,i.lineStart()}function y(w,I){var M=wr([w,I]),N=t(w,I);s(u,c,h,g,m,f,u=N[0],c=N[1],h=w,g=M[0],m=M[1],f=M[2],nm,i),i.point(u,c)}function b(){p.point=_,i.lineEnd()}function v(){x(),p.point=A,p.lineEnd=S}function A(w,I){y(n=w,I),r=u,o=c,a=g,l=m,d=f,p.point=y}function S(){s(u,c,h,g,m,f,r,o,n,a,l,d,nm,i),p.lineEnd=b,b()}return p}}var Lw=Sc({point:function(t,e){this.stream.point(t*Fs,e*Fs)}});function Iw(t){return Sc({point:function(e,s){var i=t(e,s);return this.stream.point(i[0],i[1])}})}function Mw(t,e,s,i,n){function r(o,a){return[e+t*(o*=i),s-t*(a*=n)]}return r.invert=function(o,a){return[(o-e)/t*i,(s-a)/t*n]},r}function om(t,e,s,i,n,r){if(!r)return Mw(t,e,s,i,n);var o=De(r),a=Fe(r),l=o*t,d=a*t,h=o/t,u=a/t,c=(a*s-o*e)/t,g=(a*e+o*s)/t;function m(f,p){return[l*(f*=i)-d*(p*=n)+e,s-d*f-l*p]}return m.invert=function(f,p){return[i*(h*f-u*p+c),n*(g-u*f-h*p)]},m}function Nw(t){return Rw((function(){return t}))()}function Rw(t){var e,s,i,n,r,o,a,l,d,h,u=150,c=480,g=250,m=0,f=0,p=0,_=0,x=0,y=0,b=1,v=1,A=null,S=em,w=null,I=sm,M=.5;function N(O){return l(O[0]*Fs,O[1]*Fs)}function D(O){return(O=l.invert(O[0],O[1]))&&[O[0]*xi,O[1]*xi]}function q(){var O=om(u,0,0,b,v,y).apply(null,e(m,f)),K=om(u,c-O[0],g-O[1],b,v,y);return s=dw(p,_,x),a=tu(e,K),l=tu(s,a),o=rm(a,M),et()}function et(){return d=h=null,N}return N.stream=function(O){return d&&h===O?d:d=Lw(Iw(s)(S(o(I(h=O)))))},N.preclip=function(O){return arguments.length?(S=O,A=void 0,et()):S},N.postclip=function(O){return arguments.length?(I=O,w=i=n=r=null,et()):I},N.clipAngle=function(O){return arguments.length?(S=+O?_w(A=O*Fs):(A=null,em),et()):A*xi},N.clipExtent=function(O){return arguments.length?(I=O==null?(w=i=n=r=null,sm):xw(w=+O[0][0],i=+O[0][1],n=+O[1][0],r=+O[1][1]),et()):w==null?null:[[w,i],[n,r]]},N.scale=function(O){return arguments.length?(u=+O,q()):u},N.translate=function(O){return arguments.length?(c=+O[0],g=+O[1],q()):[c,g]},N.center=function(O){return arguments.length?(m=O[0]%360*Fs,f=O[1]%360*Fs,q()):[m*xi,f*xi]},N.rotate=function(O){return arguments.length?(p=O[0]%360*Fs,_=O[1]%360*Fs,x=O.length>2?O[2]%360*Fs:0,q()):[p*xi,_*xi,x*xi]},N.angle=function(O){return arguments.length?(y=O%360*Fs,q()):y*xi},N.reflectX=function(O){return arguments.length?(b=O?-1:1,q()):b<0},N.reflectY=function(O){return arguments.length?(v=O?-1:1,q()):v<0},N.precision=function(O){return arguments.length?(o=rm(a,M=O*O),et()):sa(M)},N.fitExtent=function(O,K){return dx(N,O,K)},N.fitSize=function(O,K){return Ew(N,O,K)},N.fitWidth=function(O,K){return Aw(N,O,K)},N.fitHeight=function(O,K){return Sw(N,O,K)},function(){return e=t.apply(this,arguments),N.invert=e.invert&&D,q()}}function Fw(t){return function(e,s){var i=De(e),n=De(s),r=t(i*n);return r===1/0?[2,0]:[r*n*Fe(e),r*Fe(s)]}}function Pw(t){return function(e,s){var i=sa(e*e+s*s),n=t(i),r=Fe(n),o=De(n);return[Ar(e*r,i*o),Sr(i&&s*r/i)]}}var hx=Fw((function(t){return(t=rx(t))&&t/Fe(t)}));function zw(){return Nw(hx).scale(79.4188).clipAngle(179.999)}hx.invert=Pw((function(t){return t}));var Dw=(()=>{let t=0;return typeof requestAnimationFrame<"u"?requestAnimationFrame:function(e){const s=Date.now(),i=Math.min(16,Math.max(0,16-(s-t))),n=t=s+i;return setTimeout((()=>e(n)),i)}})(),ux=50,kw=typeof cancelAnimationFrame<"u"?cancelAnimationFrame:function(t){return clearTimeout(t)};function Tc(t,e){return Dw((s=>{t.call(e,s)}))}function cx(t){t&&kw(t)}var Yd,On,Cc,gx,Ow={},mx=Ow,_l={},fx={},iu=t=>null;if(typeof global=="object"&&(_l=global),typeof window=="object"&&(fx=window),typeof module=="object"&&typeof module.require=="function"){const t=module.require.bind(module);iu=e=>{try{return t(e)}catch{return null}}}else typeof _l.require=="function"&&(iu=t=>{const e=_l.require;try{return e(t)}catch{return null}});function Xs(t,{throwOnError:e}={}){let s=null;if(!s&&t&&(s=mx[t]),!s&&t&&(s=iu(t)),!s&&t&&(s=fx[t]),!s&&t&&(s=_l[t]),!s&&e){const i=[`unable to find module "${t}"; make sure one of these statements is true:`,`- Ogma.libraries['${t}'] is set to the right library`,`- require('${t}') returns the right library`,`- window['${t}'] is set to the right library`].join(`
`);throw new Error(i)}return s}var px=class so{constructor(){this.method=null,this.url=null,this.status=0,this.readyState=0,this.headers={},this.responseText=null,this.response=null,so.onCreate&&so.onCreate(this)}open(e,s){this.method=e,this.url=s,so.onSend&&so.onSend(this)}respond(e,s,i){this.readyState=4,this.status=e,this.headers=s,this.responseText=i,this.response=i,this.onreadystatechange()}send(){this.readyState=4}static{this.onCreate=ae}static{this.onSend=ae}},_x=class io{constructor(){this.onload=ae,io.onCreate&&io.onCreate(this)}static{this.onCreate=ae}static{this.onRead=ae}readAsDataURL(e){this._blob=e,io.onRead&&io.onRead(this)}load(e){this.result=typeof e=="function"?e(this._blob):e,this.onload&&this.onload()}};function Fi(){return On||{createElementNS:()=>null,createElement:()=>null,implementation:{createDocument(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}Yd=Xs("@xmldom/xmldom"),On=Ri?document:Yd?new Yd.DOMImplementation().createDocument():null,Cc=typeof XMLHttpRequest<"u"?XMLHttpRequest:px,gx=typeof FileReader<"u"?FileReader:_x;var Bw=class{observe(){}unobserve(){}disconnect(){}},Uw=typeof ResizeObserver>"u"?Bw:ResizeObserver,yx=t=>new Uw(t);function xx(t,e){if(document&&document.defaultView){let s=t.style[e];if((!s||s==="auto")&&Fi().defaultView){const i=document.defaultView.getComputedStyle(t,null);s=i?i[e]:null}return s==="auto"?null:s?s.toString():null}return null}var bx=class{constructor(){this.onmousewheel=ae,this.__dummy=!0,this.style={},this.clientWidth=0,this.clientHeight=0,this.childNodes=[],this.style={width:"0px",height:"0px",top:void 0,left:void 0,position:"",backgroundColor:void 0}}get offsetWidth(){return parseFloat(this.style.width||"0")}get offsetHeight(){return parseFloat(this.style.height||"0")}get firstChild(){return null}get parentNode(){return null}get classList(){return{length:0,value:"",add(){},remove(){},contains:t=>!1,item:null}}get innerHTML(){return""}set innerHTML(t){}appendChild(t){return this.childNodes.push(t),t}removeChild(){}addEventListener(){}removeEventListener(){}insertBefore(){}contains(t){return!1}};function Ul(){return new bx}var Ns=sn?()=>window.devicePixelRatio:()=>1;function vx(t){const e=";base64,";let s,i,n;if(t.indexOf(e)===-1)return s=t.split(","),i=s[0].split(":")[1],n=decodeURIComponent(s[1]),zo(n,i);s=t.split(e),i=s[0].split(":")[1],n=window.atob(s[1]);const r=n.length,o=new Uint8Array(r);for(let a=0;a<r;++a)o[a]=n.charCodeAt(a);return zo([o],i)}var Ex=class{constructor(t,e){this.data=t,this.type=e}};function zo(t,e){return typeof Blob<"u"?new Blob(t,{type:e}):new Ex(t,e)}function Gw(t){return typeof Blob<"u"&&t instanceof Blob||t instanceof Ex}function Vw(t,e,s="text/plain"){return e==="blob"?t:e==="dataURL"?vx(t):zo([t],s||"text/xml")}function un(t,e,s="text",i="text/plain"){if(!md)return t;let n=null,r=null,o=null;window.Blob?(n=Vw(t,s,i),r=URL.createObjectURL(n)):o="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(t);const a=document.createElement("a");return zy(a,r||o||""),a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a),r&&setTimeout((()=>window.URL.revokeObjectURL(r)),0),t}function Gl(t,e,s,i=Ns()){if(Bn(t,e+"px",s+"px"),t.tagName==="IMG"||t.tagName==="CANVAS"){const n=t;n.width=e*i,n.height=s*i}}function Lc(t,e){_i(e,((s,i)=>{s!==void 0&&t.setAttribute(i,s)}))}var Ic="http://www.w3.org/2000/svg",nu="http://www.w3.org/2000/xmlns/",Ax="http://www.w3.org/1999/xlink",qw=1;function _e(t,e){const s=On.createElementNS(Ic,t);return s.style||(s.style={}),e&&Lc(s,e),s}function ru(t){const e=On.createElement("div");if(e.innerHTML=t.trim().replace(/\s+/g," "),!e.firstChild||e.firstChild.nodeType!==qw)throw new Error(`Failed to create element from: "${t}". Expected an HTML string`);return e.firstChild}function Mc(t){if(On)return On.createTextNode(t)}function Sx(t){return typeof Image>"u"?Promise.resolve(null):new Promise((e=>{const s=new Image;s.src=t,s.onload=()=>e(s),s.onerror=()=>e(null)}))}function wx(t){if(t.indexOf("http://")===0||t.indexOf("https://")===0)return t;const e=window.location.origin;if(window.location.protocol==="blob:")return t;const s=window.location.pathname,i=s.lastIndexOf("/");return i===-1?e+"/"+t:e+s.substring(0,i)+"/"+t}function Dr(t){return new Promise(((e,s)=>{const i=new Cc;i.open("GET",wx(t),!0),i.onreadystatechange=function(){if(i.readyState===4){const n=i.status;n===200?e(i.responseText):s(n!==0?new Error(`cannot retrieve file at url "${t}"; the server responded with status code ${n}.`):new Error(`cannot send XMLHttpRequest to url "${t}"; if you're using the local file protocol this is most likely the cause.`))}},i.onerror=function(){s(new Error(`cannot retrieve file at url "${t}"; the XMLHttpRequest failed.`))},i.send()}))}function Tx(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function Vl(t,e){t.style.cursor=e,t.style.cursor!==e&&(t.style.cursor=`-webkit-${e}`)}function Cx(t){return new Promise(((e,s)=>{const i=new Cc;i.responseType="blob",i.open("GET",wx(t),!0),i.onreadystatechange=()=>{if(i.readyState===4){if(i.status===200)return e(i.response);s(i.status)}},i.onerror=n=>s(n),i.send()}))}function Lx(t){return Cx(t).then((e=>new Promise(((s,i)=>{const n=new gx;n.onerror=i,n.onload=()=>s(n.result),n.readAsDataURL(e)}))))}function ar(t,e=!0){const s=e?"&#13;":`
`;return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,s).replace(/[\r\n]/g,s)}var Nc={0:"left",1:"middle",2:"right"};function Ix(t){if(t.baseURI)return t.baseURI;const e=t.getElementsByTagName("base");return e.length>0?e[0].href:t.URL||(t.location?t.location.href:"")}function Mx(t,e,s,i){return new Promise((n=>{let r=e;const o=Date.now(),a=(s-e)*Math.min(1,1/(i/16));(function l(){Date.now()-o<i?(r=Math.min(1,Math.max(0,r+a)),t.style.opacity=r.toString(),Tc(l)):n()})()}))}function Bn(t,e,s){t.style.width=e,t.style.height=s}var Rc=new LS().allowClassAttributes().allowDataAttributes().allowIdAttributes().allowStyleAttributes().build();function Zi(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Ws(t,e,s){return Math.max(e,Math.min(s,t))}function ou(t,e,s){return t+(e-t)*s}function ye(t,e,s){return t*(1-s)+e*s}function lr(t){if(!t.length)return-1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n>e&&(e=n)}return e}function wi(t){if(!t.length)return 1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n<e&&(e=n)}return e}var Nx=(t,e)=>Math.log(t)/Math.log(e),ql=t=>t<-Math.PI?t+2*Math.PI:t>Math.PI?t-2*Math.PI:t;function am(t,e){t&&e!==void 0&&isFinite(e)&&t.setOpacity&&t.setOpacity(e)}function lm(){return sn||typeof global<"u"&&!global.process}function Xd(t){return Math.log2(t)+zl}function Hw(t){return 2**(t-zl)}function dm(t){return t!=null&&!isNaN(t)}function Rx(t,e){return Px(t,e,"longitude")}function Fx(t,e){return Px(t,e,"latitude")}function Px(t,e,s){if(isNaN(e))throw new TypeError(`node ${t}: ${e} is not a valid ${s}`)}var jw=t=>Math.pow(2,Math.ceil(Math.log2(t)));function Yw(t,e){return e==null&&t.url===En.tiles.url?sw:null}function Xw(t={},e){const{tileUrlSubdomains:s,tileUrlTemplate:i,attribution:n,attributionOptions:r,latitudePath:o,longitudePath:a,sizeRatio:l,tiles:d}=t;if(i!=null&&typeof i!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a URL string");if(s!=null&&typeof s!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a string");if(d!=null){if(!(Xe(d)||d instanceof e.Layer))throw new TypeError("Geo mode: tiles must be a object or L.Layer instance");const h=d;if(h.url!=null&&typeof h.url!="string")throw new TypeError("Geo mode: tiles.url must be a string");if(h.subdomains!=null&&typeof h.subdomains!="string")throw new TypeError("Geo mode: tiles.subdomains must be a string");if(h.tms&&typeof h.tms!="boolean")throw new TypeError("Geo mode: tiles.tms must be a boolean");if(h.wms&&typeof h.wms!="boolean")throw new TypeError("Geo mode: tiles.wms must be a boolean")}if(n!=null&&typeof n!="string")throw new TypeError("Geo mode: Map attribution must be a string");if(r!=null&&!Xe(r))throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object");if(o!=null&&typeof o!="string"&&!Array.isArray(o))throw new TypeError("Geo mode: Latitude path must be a valid property path: a string or an array of strings.");if(a!=null&&typeof a!="string"&&!Array.isArray(a))throw new TypeError("Geo mode: Longitude path must be a valid property path: a string or an array of strings.");if(l!=null&&(!isFinite(l)||l<=0))throw new TypeError("Geo mode: sizeRatio must be a positive number.")}function Ww(t,e={}){if(e.tiles===void 0||e.tileUrlTemplate||e.tileUrlSubdomains){const s=En.tiles;return{...e.tiles||{},...En.tiles,url:e.tileUrlTemplate||s.url,subdomains:e.tileUrlSubdomains||s.subdomains}}return Xe(e.tiles)?{...t.tiles,...e.tiles}:e.tiles}function $w(t,e){return t.attribution!==e.attribution||t.tiles!==e.tiles}var Zw=Fi().createElement("div");function Kw(t){const e=Fi().createElement("div");e.className="ogma-geo-container",Bn(e,"100%","100%");const s=t||Zw;return s.insertBefore(e,s.firstChild),e}function Qw(t){const e=[[1/0,1/0],[-1/0,-1/0]];return t.getGeoCoordinates().reduce(((s,{latitude:i,longitude:n})=>{const[r,o]=s;return r[0]=Math.min(r[0],i),r[1]=Math.min(r[1],n),o[0]=Math.max(o[0],i),o[1]=Math.max(o[1],n),s}),e)}function Jw(t,e,s,i){const n=e._indexes;t.getNodeAttribute(mi).setMultiple(n,s),t.getNodeAttribute(fi).setMultiple(n,i)}function t1(t,e,s){const{longitudePath:i,latitudePath:n,wrapCoordinates:r}=s,[o,a]=t.getAttributes(!0,[mi,fi]),l=e._indexes,d=e.getId(),h=l.length,u=e.getData(n),c=e.getData(i);for(let g=0;g<h;g++){let m=c[g],f=u[g];const p=l[g],_=d[g];f!=null&&m!=null&&(Rx(_,m),Fx(_,f),r&&(m%=180,f=Ws(+f,-Zh,Zh)),a.set(p,m),o.set(p,f))}}function e1(t,{longitudePath:e,latitudePath:s,wrapCoordinates:i},n){const r=t.getData(e),o=t.getData(s);return r!=null&&o!=null&&(!(!i&&!n)||Math.abs(o)<=Zh&&Math.abs(r)<=180)}function Sa(t,e,s,i){s1(t,!0,e,s,i)}function s1(t,e,s,i,n){const r=t.getAttribute(e,i),o=t.getAttribute(e,n),a=s._indexes;o.setMultiple(a,r.getMultiple(a))}function i1(t){return t.reduce(((e,{nodes:s,newValues:i})=>{if(!s)return e;const n=s.filter(((r,o)=>i[o]!=null));return e?e.concat(n):n}),null)}function n1(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","radius"]).forEach((({text:s,radius:i},n)=>{e[t.get(n).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:s.minVisibleSize,size:Math.max(1,Number(i))}})),e}function hm(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","minVisibleSize","width"]).forEach((({text:s,minVisibleSize:i,width:n},r)=>{e[t.get(r).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:i,size:Math.max(1,Number(n))}})),e}function r1(t,e,s){if(!e||!Object.keys(e).length)return Promise.resolve();const i=t.getId().filter((n=>e[n])).map((n=>{if(!e[n])return 0;const r=Number(e[n]["text.minVisibleSize"]),o=Number(e[n].minVisibleSize),a=Number(e[n]["text.size"]),l=Number(e[n]["text.scale"]),d=Number(e[n].size)*l*s;return d<=o||d<=r?0:a}));return t.setAttribute("text.size",i)}function o1(t,e){const s=t.getId().map((i=>{const n=e[i]||{};return Number(n["text.size"])}));return t.setAttribute("text.size",s)}var a1=t=>zw().rotate([-t.longitude,-t.latitude]).scale(ew),um=new Uint32Array(1),si=class{constructor(t,e){this.size=1,this.isNode=!0,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return um[0]=this._index,um}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this._ogma.modules.camera.graphToScreenCoordinates(this.getPosition())}isInScreen(){const t=this.getPositionOnScreen(),e=this._ogma.modules.camera;return t.x>=0&&t.x<=e.width&&t.y>=0&&t.y<=e.height}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)[0]}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}getConnectedComponent(t){return this._ogma.modules.graph.getConnectedComponentByNode(this,t)[0]}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.nodeList(new Uint32Array([+this._index]))}getId(){return pd(this._ogma.modules.graph,this)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=ix(t),i=this.getAttributes(e);return{id:this.getId(),attributes:i,data:s(ke(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getGeoCoordinates(){const t=this._ogma.modules.graph,e=t.getNodeAttribute(mi).get(this._index),s=t.getNodeAttribute(fi).get(this._index);return{latitude:dm(e)?e:void 0,longitude:dm(s)?s:void 0}}setGeoCoordinates(t){return this.toList().setGeoCoordinates([t]).then((()=>this))}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNode(this)}getSubNodes(){return this._ogma.modules.transformations.getSubNodes(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};_d([si],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var Pi=class{constructor(t,e){this.isList=!0,this.isNode=!0,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this.getPosition().map((t=>this._ogma.modules.camera.graphToScreenCoordinates(t)))}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)}getConnectedComponents(t){return this._ogma.modules.graph.getConnectedComponents(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}isVisible(){return this.isExcluded().map((t=>!t))}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map((t=>this._ogma.modules.transformations.isElementVirtual(t)))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Qy(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.nodeList(this._indexes.slice())}getId(){return pd(this._ogma.modules.graph,this)}get(t){return ex(this._ogma.modules.graph,this,t)}forEach(t){Uy(this._ogma.modules.graph,this,t)}find(t){return jy(this._ogma.modules.graph,this,t)}some(t){return Hy(this._ogma.modules.graph,this,t)}every(t){return qy(this._ogma.modules.graph,this,t)}map(t){return Gy(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return Vy(this._ogma.modules.graph,this,t)}reduce(t,e){return Xy(this._ogma.modules.graph,this,t,e)}concat(t){return Ky(this._ogma.modules.graph,this,t)}dedupe(){return Wy(this._ogma.modules.graph,this)}subtract(t){return $y(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.nodeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof si?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}inverse(){return Zy(this._ogma.modules.graph,this)}sort(t){return sx(this._ogma.modules.graph,this,t)}toJSON(t={}){return this.map((e=>e.toJSON(t)))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!as(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map((e=>this._ogma.modules.classes.hasSingleElementClass(t,e)))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getGeoCoordinates(){const t=this._ogma.modules.graph,e=new Array(this._indexes.length),s=t.getNodeAttribute(mi).getMultiple(this._indexes),i=t.getNodeAttribute(fi).getMultiple(this._indexes);for(let n=0,r=this._indexes.length;n<r;n++)e[n]={latitude:s[n],longitude:i[n]};return e}setGeoCoordinates(t){const e=this._ogma.modules.geo,s=this.getId(),i=this._indexes,n=new Array(i.length),r=new Array(i.length);if(t===null&&(t=new Array(i.length).fill(null)),t.length!==i.length)throw new RangeError("You must provide coordinates for each node in the NodeList");for(let l=0,d=i.length;l<d;l++){let{latitude:h,longitude:u}=t[l]||{latitude:void 0,longitude:void 0};const c=s[l];h==null&&u==null?h=u=void 0:(Fx(c,h),Rx(c,u)),n[l]=h,r[l]=u}this.setData(e.latitudePath,n),this.setData(e.longitudePath,r);const{dom:o,graph:a}=this._ogma.modules;return Jw(a,this,n,r),this._ogma.modules.geo.isEnabled()?o.afterNextFrame().then((()=>o.afterNextFrame())).then((()=>this)):o.afterNextFrame().then((()=>this))}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNodes(this)}getSubNodes(){return this.map(this._ogma.modules.transformations.getSubNodes)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};function l1(t,e,s,i,n){return ia(t,e,s,!0,[i],n)}function d1(t,e,s,i,n){return ia(t,e,s,!1,[i],n)}function h1(t,e,s,i,n){return ia(t,e,s,!0,i,n)}function u1(t,e,s,i,n){return ia(t,e,s,!1,i,n)}async function ia(t,e,s,i,n,r={}){Array.isArray(n)||n instanceof(i?Pi:Un)||(n=[n]);const{virtual:o=!1}=r;!o&&e.isRefreshing()&&await new Promise((m=>{s.once("idle",m)}));const a={elementsToRemove:t.getElements(i,n)};t.fireEvent("requestElementsToDelete",a);let{elementsToRemove:l}=a;if(!l.size)return Promise.resolve();l=l.dedupe();const d=t.storage.fetch(i),h=d.getFlexArray("removed");if(l=l.filter((m=>h.get(m._index)===0)),i){const m=l.getAdjacentEdges({filter:"all"});ia(t,e,s,!1,m,r)}const u=l._indexes,c=t.getCacheLists(i),g={virtual:o,[i?"nodes":"edges"]:l};if(t.fireEvent(i?"beforeRemoveNodes":"beforeRemoveEdges",g),c.visible.invalidList(),c.all.invalidList(),c.raw.invalidList(),t.setExcluded(l,!0),h.setMultiple(u,1),!i)for(let m=0;m<u.length;++m)t.topology.removeFromAdjacencyList(u[m]);return d.removeElements(u),t.fireEvent(i?"removeNodes":"removeEdges",g),t.fireEvent(i?"afterRemoveNodes":"afterRemoveEdges",g),Promise.resolve()}_d([Pi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var c1=class{addNodes(t,e){return this.modules.graph.addNodes(t,e)}addEdges(t,e){return this.modules.graph.addEdges(t,e)}addNode(t,e){return this.modules.graph.addNode(t,e)}addEdge(t,e){return this.modules.graph.addEdge(t,e)}removeNodes(t,e){return h1(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}removeEdges(t,e){return u1(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}removeNode(t,e){return l1(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}removeEdge(t,e){return d1(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}getNodes(t){return this.modules.graph.getNodes(t)}getEdges(t){return this.modules.graph.getEdges(t)}getNode(t){return this.modules.graph.getNode(t)}getEdge(t){return this.modules.graph.getEdge(t)}clearGraph(){this.modules.graph.clear()}setGraph(t,e){return this.modules.graph.clear(),this.addGraph(t,e)}addGraph(t,e){const s=this.modules.graph.getNodes().size===0,i=this.modules.graph.addGraph(t,e);return s?this.modules.locate.locateGraph({padding:30,ignoreZoomLimits:!1,duration:0}).then((()=>i)):i}createNodeList(){return this.getNodes([])}createEdgeList(){return this.getEdges([])}getConnectedComponents(t={}){return this.modules.graph.getConnectedComponents(this.getNodes(t.filter),t)}getConnectedComponentByNode(t,e){const s=this.modules.graph.getNode(t);if(s===void 0)throw new Error(`getComponentByNode: cannot find node ${t}`);return this.modules.graph.getConnectedComponentByNode(s,e)[0]}},Fc={};function zx(t,e,s,i,n,r){let o=0;for(let a=0;a<i;a++)for(let l=0;l<i;l++){const d=r[a],h=r[l];if(d!==h){const u=t[d][h]*n,c=1/(u*u);if(c){const g=e[d]-e[h],m=s[d]-s[h];o+=c*Math.pow(u-Math.sqrt(g*g+m*m),2)}}}return o}function Dx(t,e,s,i,n,r,o){let a=0;if(n===-1)return 0;for(let l=0;l<i;l++)for(let d=0;d<i;d++){const h=o[l],u=o[d];if(h!==u&&(h===n||u===n)){const c=t[h][u]*r,g=1/(c*c);if(g){const m=e[h]-e[u],f=s[h]-s[u];a+=g*Math.pow(c-Math.sqrt(m*m+f*f),2)}}}return a}function au(t,e,s,i,n,r,o,a){o=o||0;let l=0,d=0;for(let h=0;h<i;h++)for(let u=0;u<i;u++){const c=a[h],g=a[u];if(c!==g){const m=t[c][g]*r,f=1/(m*m);if(f){const p=e[c]-e[g],_=s[c]-s[g],x=f*Math.pow(m-Math.sqrt(p*p+_*_),2);l+=x,c!==n&&g!==n||(d+=x)}}}return(1-o)*l+o*d}function lu(t,e,s,i,n,r,o,a,l){o=o||0;const d=e,h=s;(n=n===void 0?-1:n)===-1&&(o=0);const u=e[n],c=s[n];for(let g=0;g<i;g++){const m=a[g],f=l(t[n][g]),p=o/(f*f);if(f===0)continue;let _=0,x=0,y=0;const b=e[m],v=s[m];for(let S=0;S<i;S++){const w=a[S];if(w!==m){const I=t[m][w]*r,M=1/(I*I),N=e[w],D=s[w];if(M!==0){const q=b-N,et=v-D,O=q*q+et*et,K=O<1e-12?0:1/Math.sqrt(O);x+=(1-o)*M*(N+I*(b-N)*K),y+=(1-o)*M*(D+I*(v-D)*K)}_+=M}}const A=(1-o)*_+p;if(A!==0){const S=b-u,w=v-c;let I=S*S+w*w;I=I<1e-12?0:1/Math.sqrt(I);const M=f===0?0:p*(f*I);d[m]=(x+M*e[m])/A,h[m]=(y+M*s[m])/A}}return{x:d,y:h}}function g1(t,e,s,i,n,r,o,a){o=o||0;const l=e,d=s;let h;(n=n===void 0?-1:n)===-1&&(o=0);for(let u=0;u<i;u++){const c=a[u];let g=0,m=0,f=0;const p=e[c],_=s[c];for(let x=0;x<i;x++){const y=a[x];let b=0;if(y!==c){let v=0;const A=t[c][y]*r,S=1/(A*A);c!==n&&y!==n||(v=S);const w=(1-o)*S+o*v;if(g+=w,S!==0){const I=e[y],M=s[y],N=p-I,D=_-M,q=N*N+D*D;q>1e-6&&(b=1/Math.sqrt(q)),m+=w*(I+A*(p-I)*b),f+=w*(M+A*(_-M)*b)}}}h=g,h!==0&&(l[c]=m/h,d[c]=f/h)}return{x:l,y:d}}function yd(t=((n,r)=>n-r),e=[],s={},i=(n=>n)){let n=e.length;function r(o){for(;;){const a=2*o+1,l=a+1;let d=o;if(a<n&&t(e[a],e[d])<0&&(d=a),l<n&&t(e[l],e[d])<0&&(d=l),d===o)return o;const h=e[d];e[d]=e[o],e[o]=h,s[i(e[d])]=d,s[i(h)]=o,o=d}}return{get keys(){return s},get size(){return n},heapify:r,pop(){if(n<=0)return;if(n===1)return n--,e[0];const o=e[0];return e[0]=e[n-1],n--,r(0),o},decreaseKey(o,a){for(a!==void 0&&(e[o]=a,s[i(a)]=o);o>0;){const l=o-1>>1;if(!(t(e[l],e[o])>0))break;{const d=e[o];e[o]=e[l],e[l]=d,s[i(e[o])]=o,s[i(d)]=l,o=l}}return o},min:()=>e[0],remove(o){return this.decreaseKey(o,Number.NEGATIVE_INFINITY),this.pop()},push(o){n++;let a=n-1;for(e[a]=o;a>0;){const l=a-1>>1;if(!(t(e[l],e[a])>0))break;{const d=e[a];e[a]=e[l],e[l]=d,s[i(e[a])]=a,s[i(d)]=l,a=l}}return a},empty:()=>n<=0,toArray:()=>e.slice(0,n)}}function Pc({sources:t,targets:e,weights:s,source:i,target:n,undirected:r=!1,indexes:o,N:a}){if(!(a=o?o.length:a)||!isFinite(a)||a===0)throw new Error("Invalid number of nodes "+a);const l=new Float32Array(a),d=new Int32Array(a),h={},u=Number.POSITIVE_INFINITY;if(!s){s=[];for(let f=0;f<a;f++)s[f]=1}if(!o){o=new Uint32Array(a);for(let f=0;f<a;f++)o[f]=f+1}for(let f=0;f<a;f++)l[f]=u,d[f]=-1,h[o[f]]=f;l[h[i]]=0;let c=!1;for(let f=1;f<=a;f++){for(let p=0;p<s.length;p++){const _=t[p],x=e[p],y=h[_],b=h[x];if(y!==void 0&&b!==void 0){const v=s[p];let A=l[y]+v;l[y]!==u&&A<l[b]&&(l[b]=A,d[b]=_,c=!0),r&&(A=l[b]+v,l[b]!==u&&A<l[y]&&(l[y]=A,d[y]=x,c=!0))}}if(!c)break}if(c)for(let f=0;f<s.length;f++){const p=t[f],_=e[f],x=h[p],y=h[_];if(x!==void 0&&y!==void 0){const b=s[f];if(l[x]+b<l[y])return null}}let g=null,m=null;if(n!==void 0){const f=h[n];if(f!==void 0&&l[f]!==u){g=[];for(let p=n;p!==-1;p=d[h[p]])g.push(p);g=g.reverse(),m=l[f]}}return{distances:l,path:g,pathLength:m}}function zc(t,e,s,i,n,r,o){const a=(i=i||t.map(((p,_)=>_+1))).length,l=new Float32Array(a),d=new Int32Array(a),h=new Uint32Array(a),u=Number.POSITIVE_INFINITY,c={};if(a===0)return{distances:l,path:null,pathLength:null};if(!n){n={};for(let p=0;p<a;p++)n[i[p]]=p}for(let p=0;p<a;p++)l[p]=u,d[p]=-1,h[p]=c[p]=p;const g=yd(((p,_)=>l[p]-l[_]),h,c);for(l[n[e]]=0,g.decreaseKey(c[n[e]]);g.size!==0;){const p=g.pop(),_=l[p],x=t[p];if(_===u)break;for(let y=0,b=x.nodes.length;y<b;y++){const v=x.nodes[y],A=r?1:o?o(i[p],v):x.weights?x.weights[y]:1,S=n[v];if(S===void 0)continue;const w=_+A;w<l[S]&&(l[S]=w,d[S]=p,g.decreaseKey(c[S]))}}let m=null,f=null;if(s!==void 0){const p=n[s];if(l[p]!==u){m=[];for(let _=p;_!==-1;_=d[_])m.push(i[_]);m.reverse(),f=l[s]}}return{distances:l,path:m,pathLength:f}}function du({sources:t,targets:e,weights:s,indexes:i,adjacency:n,undirected:r,ignoreWeights:o}){const a=Number.POSITIVE_INFINITY,l=i?i.length:n.length;if(!i){i=new Uint32Array(l);for(let f=0;f<l;f++)i[f]=f+1}const d=new Array(l),h={};for(let f=0;f<l;f++){d[f]=new Float32Array(l);for(let p=0;p<l;p++)d[f][p]=f===p?0:a;h[i[f]]=f}const u=l,c=s.length;t=t.slice(),e=e.slice(),s=s.slice();for(let f=0;f<l;f++)t[c+f]=u,e[c+f]=i[f],s[c+f]=0,o&&(s[f]=1);const g=Pc({sources:t,targets:e,weights:s,undirected:r,N:l+1,source:u});if(g===null)throw new Error("Graph has negative weight loops");const m=g.distances;for(let f=0;f<s.length;f++){const p=h[t[f]],_=h[e[f]];p!==void 0&&_!==void 0&&(s[f]=s[f]+m[p]-m[_])}t=t.slice(0,c),e=e.slice(0,c),s=s.slice(0,c);for(let f=0;f<l;f++){const p=i[f],{distances:_}=zc(n,p,void 0,i,h,!!o);for(let x=0;x<l;x++)d[f][x]=f===x?0:_[x]}return d}Jo(Fc,{CyclesFinder:()=>$x,Quadtree:()=>K1,bellmanFord:()=>Pc,betweenness:()=>Kx,circlePack:()=>qx,circleSpread:()=>D1,constrainedStress:()=>au,convexhull:()=>P1,detectCyclesDirected:()=>Xx,detectCyclesUndirected:()=>J1,detectCyclesUndirectedDFS:()=>tT,dijkstra:()=>zc,distanceStress:()=>Dx,fisheye:()=>Hx,johnson:()=>du,kruskal:()=>Zx,largestEmptyCircle:()=>Ox,minDisk:()=>ra,minHeap:()=>yd,removeRadialOverlap:()=>uu,stressMinimizationStep:()=>lu,stressMinimizationStepGeneral:()=>g1,weightedStress:()=>zx});var Ii=11102230246251565e-32,us=134217729,m1=(3+8*Ii)*Ii;function Wd(t,e,s,i,n){let r,o,a,l,d=e[0],h=i[0],u=0,c=0;h>d==h>-d?(r=d,d=e[++u]):(r=h,h=i[++c]);let g=0;if(u<t&&c<s)for(h>d==h>-d?(o=d+r,a=r-(o-d),d=e[++u]):(o=h+r,a=r-(o-h),h=i[++c]),r=o,a!==0&&(n[g++]=a);u<t&&c<s;)h>d==h>-d?(o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u]):(o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c]),r=o,a!==0&&(n[g++]=a);for(;u<t;)o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u],r=o,a!==0&&(n[g++]=a);for(;c<s;)o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c],r=o,a!==0&&(n[g++]=a);return r===0&&g!==0||(n[g++]=r),g}function f1(t,e){let s=e[0];for(let i=1;i<t;i++)s+=e[i];return s}function na(t){return new Float64Array(t)}var p1=(3+16*Ii)*Ii,_1=(2+12*Ii)*Ii,y1=(9+64*Ii)*Ii*Ii,Hn=na(4),cm=na(8),gm=na(12),mm=na(16),Es=na(4);function x1(t,e,s,i,n,r,o){let a,l,d,h,u,c,g,m,f,p,_,x,y,b,v,A,S,w;const I=t-n,M=s-n,N=e-r,D=i-r;b=I*D,c=us*I,g=c-(c-I),m=I-g,c=us*D,f=c-(c-D),p=D-f,v=m*p-(b-g*f-m*f-g*p),A=N*M,c=us*N,g=c-(c-N),m=N-g,c=us*M,f=c-(c-M),p=M-f,S=m*p-(A-g*f-m*f-g*p),_=v-S,u=v-_,Hn[0]=v-(_+u)+(u-S),x=b+_,u=x-b,y=b-(x-u)+(_-u),_=y-A,u=y-_,Hn[1]=y-(_+u)+(u-A),w=x+_,u=w-x,Hn[2]=x-(w-u)+(_-u),Hn[3]=w;let q=f1(4,Hn),et=_1*o;if(q>=et||-q>=et||(u=t-I,a=t-(I+u)+(u-n),u=s-M,d=s-(M+u)+(u-n),u=e-N,l=e-(N+u)+(u-r),u=i-D,h=i-(D+u)+(u-r),a===0&&l===0&&d===0&&h===0)||(et=y1*o+m1*Math.abs(q),q+=I*h+D*a-(N*d+M*l),q>=et||-q>=et))return q;b=a*D,c=us*a,g=c-(c-a),m=a-g,c=us*D,f=c-(c-D),p=D-f,v=m*p-(b-g*f-m*f-g*p),A=l*M,c=us*l,g=c-(c-l),m=l-g,c=us*M,f=c-(c-M),p=M-f,S=m*p-(A-g*f-m*f-g*p),_=v-S,u=v-_,Es[0]=v-(_+u)+(u-S),x=b+_,u=x-b,y=b-(x-u)+(_-u),_=y-A,u=y-_,Es[1]=y-(_+u)+(u-A),w=x+_,u=w-x,Es[2]=x-(w-u)+(_-u),Es[3]=w;const O=Wd(4,Hn,4,Es,cm);b=I*h,c=us*I,g=c-(c-I),m=I-g,c=us*h,f=c-(c-h),p=h-f,v=m*p-(b-g*f-m*f-g*p),A=N*d,c=us*N,g=c-(c-N),m=N-g,c=us*d,f=c-(c-d),p=d-f,S=m*p-(A-g*f-m*f-g*p),_=v-S,u=v-_,Es[0]=v-(_+u)+(u-S),x=b+_,u=x-b,y=b-(x-u)+(_-u),_=y-A,u=y-_,Es[1]=y-(_+u)+(u-A),w=x+_,u=w-x,Es[2]=x-(w-u)+(_-u),Es[3]=w;const K=Wd(O,cm,4,Es,gm);b=a*h,c=us*a,g=c-(c-a),m=a-g,c=us*h,f=c-(c-h),p=h-f,v=m*p-(b-g*f-m*f-g*p),A=l*d,c=us*l,g=c-(c-l),m=l-g,c=us*d,f=c-(c-d),p=d-f,S=m*p-(A-g*f-m*f-g*p),_=v-S,u=v-_,Es[0]=v-(_+u)+(u-S),x=b+_,u=x-b,y=b-(x-u)+(_-u),_=y-A,u=y-_,Es[1]=y-(_+u)+(u-A),w=x+_,u=w-x,Es[2]=x-(w-u)+(_-u),Es[3]=w;const j=Wd(K,gm,4,Es,mm);return mm[j-1]}function wa(t,e,s,i,n,r){const o=(e-r)*(s-n),a=(t-n)*(i-r),l=o-a,d=Math.abs(o+a);return Math.abs(l)>=p1*d?l:-x1(t,e,s,i,n,r,d)}var fm=Math.pow(2,-52),Ta=new Uint32Array(512),Dc=class kx{static from(e,s=S1,i=w1){const n=e.length,r=new Float64Array(2*n);for(let o=0;o<n;o++){const a=e[o];r[2*o]=s(a),r[2*o+1]=i(a)}return new kx(r)}constructor(e){const s=e.length>>1;if(s>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*s-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(s)),this._hullPrev=new Uint32Array(s),this._hullNext=new Uint32Array(s),this._hullTri=new Uint32Array(s),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(s),this._dists=new Float64Array(s),this.update()}update(){const{coords:e,_hullPrev:s,_hullNext:i,_hullTri:n,_hullHash:r}=this,o=e.length>>1;let a=1/0,l=1/0,d=-1/0,h=-1/0;for(let I=0;I<o;I++){const M=e[2*I],N=e[2*I+1];M<a&&(a=M),N<l&&(l=N),M>d&&(d=M),N>h&&(h=N),this._ids[I]=I}const u=(a+d)/2,c=(l+h)/2;let g,m,f;for(let I=0,M=1/0;I<o;I++){const N=$d(u,c,e[2*I],e[2*I+1]);N<M&&(g=I,M=N)}const p=e[2*g],_=e[2*g+1];for(let I=0,M=1/0;I<o;I++){if(I===g)continue;const N=$d(p,_,e[2*I],e[2*I+1]);N<M&&N>0&&(m=I,M=N)}let x=e[2*m],y=e[2*m+1],b=1/0;for(let I=0;I<o;I++){if(I===g||I===m)continue;const M=E1(p,_,x,y,e[2*I],e[2*I+1]);M<b&&(f=I,b=M)}let v=e[2*f],A=e[2*f+1];if(b===1/0){for(let N=0;N<o;N++)this._dists[N]=e[2*N]-e[0]||e[2*N+1]-e[1];dr(this._ids,this._dists,0,o-1);const I=new Uint32Array(o);let M=0;for(let N=0,D=-1/0;N<o;N++){const q=this._ids[N],et=this._dists[q];et>D&&(I[M++]=q,D=et)}return this.hull=I.subarray(0,M),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(wa(p,_,x,y,v,A)<0){const I=m,M=x,N=y;m=f,x=v,y=A,f=I,v=M,A=N}const S=A1(p,_,x,y,v,A);this._cx=S.x,this._cy=S.y;for(let I=0;I<o;I++)this._dists[I]=$d(e[2*I],e[2*I+1],S.x,S.y);dr(this._ids,this._dists,0,o-1),this._hullStart=g;let w=3;i[g]=s[f]=m,i[m]=s[g]=f,i[f]=s[m]=g,n[g]=0,n[m]=1,n[f]=2,r.fill(-1),r[this._hashKey(p,_)]=g,r[this._hashKey(x,y)]=m,r[this._hashKey(v,A)]=f,this.trianglesLen=0,this._addTriangle(g,m,f,-1,-1,-1);for(let I,M,N=0;N<this._ids.length;N++){const D=this._ids[N],q=e[2*D],et=e[2*D+1];if(N>0&&Math.abs(q-I)<=fm&&Math.abs(et-M)<=fm||(I=q,M=et,D===g||D===m||D===f))continue;let O=0;for(let ct=0,pt=this._hashKey(q,et);ct<this._hashSize&&(O=r[(pt+ct)%this._hashSize],O===-1||O===i[O]);ct++);O=s[O];let K,j=O;for(;K=i[j],wa(q,et,e[2*j],e[2*j+1],e[2*K],e[2*K+1])>=0;)if(j=K,j===O){j=-1;break}if(j===-1)continue;let ot=this._addTriangle(j,D,i[j],-1,-1,n[j]);n[D]=this._legalize(ot+2),n[j]=ot,w++;let it=i[j];for(;K=i[it],wa(q,et,e[2*it],e[2*it+1],e[2*K],e[2*K+1])<0;)ot=this._addTriangle(it,D,K,n[D],-1,n[it]),n[D]=this._legalize(ot+2),i[it]=it,w--,it=K;if(j===O)for(;K=s[j],wa(q,et,e[2*K],e[2*K+1],e[2*j],e[2*j+1])<0;)ot=this._addTriangle(K,D,j,-1,n[j],n[K]),this._legalize(ot+2),n[K]=ot,i[j]=j,w--,j=K;this._hullStart=s[D]=j,i[j]=s[it]=D,i[D]=it,r[this._hashKey(q,et)]=D,r[this._hashKey(e[2*j],e[2*j+1])]=j}this.hull=new Uint32Array(w);for(let I=0,M=this._hullStart;I<w;I++)this.hull[I]=M,M=i[M];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,s){return Math.floor(b1(e-this._cx,s-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:s,_halfedges:i,coords:n}=this;let r=0,o=0;for(;;){const a=i[e],l=e-e%3;if(o=l+(e+2)%3,a===-1){if(r===0)break;e=Ta[--r];continue}const d=a-a%3,h=l+(e+1)%3,u=d+(a+2)%3,c=s[o],g=s[e],m=s[h],f=s[u];if(v1(n[2*c],n[2*c+1],n[2*g],n[2*g+1],n[2*m],n[2*m+1],n[2*f],n[2*f+1])){s[e]=f,s[a]=c;const p=i[u];if(p===-1){let x=this._hullStart;do{if(this._hullTri[x]===u){this._hullTri[x]=e;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(e,p),this._link(a,i[o]),this._link(o,u);const _=d+(a+1)%3;r<Ta.length&&(Ta[r++]=_)}else{if(r===0)break;e=Ta[--r]}}return o}_link(e,s){this._halfedges[e]=s,s!==-1&&(this._halfedges[s]=e)}_addTriangle(e,s,i,n,r,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=s,this._triangles[a+2]=i,this._link(a,n),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}};function b1(t,e){const s=t/(Math.abs(t)+Math.abs(e));return(e>0?3-s:1+s)/4}function $d(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function v1(t,e,s,i,n,r,o,a){const l=t-o,d=e-a,h=s-o,u=i-a,c=n-o,g=r-a,m=h*h+u*u,f=c*c+g*g;return l*(u*f-m*g)-d*(h*f-m*c)+(l*l+d*d)*(h*g-u*c)<0}function E1(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l),g=(d*h-a*u)*c,m=(o*u-l*h)*c;return g*g+m*m}function A1(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l);return{x:t+(d*h-a*u)*c,y:e+(o*u-l*h)*c}}function dr(t,e,s,i){if(i-s<=20)for(let n=s+1;n<=i;n++){const r=t[n],o=e[r];let a=n-1;for(;a>=s&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let n=s+1,r=i;Or(t,s+i>>1,n),e[t[s]]>e[t[i]]&&Or(t,s,i),e[t[n]]>e[t[i]]&&Or(t,n,i),e[t[s]]>e[t[n]]&&Or(t,s,n);const o=t[n],a=e[o];for(;;){do n++;while(e[t[n]]<a);do r--;while(e[t[r]]>a);if(r<n)break;Or(t,n,r)}t[s+1]=t[r],t[r]=o,i-n+1>=r-s?(dr(t,e,n,i),dr(t,e,s,r-1)):(dr(t,e,s,r-1),dr(t,e,n,i))}}function Or(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function S1(t){return t[0]}function w1(t){return t[1]}function Ox(t,e=1,s=0,i,n){if(!i||!n){const u=t.map((g=>[g.x,g.y])),c=Dc.from(u,(g=>g[0]),(g=>g[1]));i=No(c.triangles,u),n=No(c.hull,u)}if(!n)return[];const r=s*s,o=[],a={};for(let u=0;u<i.length;u+=3)if(T1(n,kc(i[u],i[u+1],i[u+2]))){const c=L1(i[u],i[u+1],i[u+2]);c>r&&(o.push(u),a[u]=c)}if(o.length===0)return[];o.sort(((u,c)=>a[u]-a[c]));let l=o[0],d=a[l];const h=[];for(let u=0;u<o.length;u++){const c=o[u],g=a[c];g>d&&g>r&&(l=c,d=g,h.push(l),h.length>e&&h.shift())}return h.map((u=>C1(i[u],i[u+1],i[u+2])))}function T1(t,e){const s=t.length,i=t[s-1],[n,r]=e;let[o,a]=i,l=!1;for(let d=0;d<s;d++){const h=t[d],[u,c]=h;c>r!=a>r&&n<(o-u)*(r-c)/(a-c)+u&&(l=!l),o=u,a=c}return l}function C1(t,e,s){const i=kc(t,e,s);let n=0;for(let r=0;r<3;r++){const o=arguments[r],a=o[0]-i[0],l=o[1]-i[1],d=Math.sqrt(a*a+l*l);d>n&&(n=d)}return[i[0],i[1],n]}function L1(t,e,s){const[i,n]=kc(t,e,s),[r,o]=t,a=i-r,l=n-o;return a*a+l*l}function kc(t,e,s){const i=[(t[0]+e[0])/2,(t[1]+e[1])/2],n=[(e[0]+s[0])/2,(e[1]+s[1])/2],r=-1/((e[1]-t[1])/(e[0]-t[0])),o=-1/((s[1]-e[1])/(s[0]-e[0])),a=i[1]-r*i[0],l=(a-(n[1]-o*n[0]))/(o-r);return[l,r*l+a]}function ra(t,e,s,i){let n;if(i)n=i;else{n=new Uint32Array(t.length);for(let y=0,b=t.length;y<b;y++)n[y]=y}let r=t[n[0]],o=r,a=e[n[0]],l=a;for(let y=1;y<n.length;y++){const b=n[y],v=t[b],A=e[b];v<r&&(r=v),v>o&&(o=v),A<a&&(a=A),A>l&&(l=A)}const d=(r+o)/2,h=(a+l)/2;for(let y=0;y<n.length;y++){const b=n[y];t[b]-=d,e[b]-=h}function u(y,b,v,A,S,w){const I=v-w+1e-9*Math.max(v,w,1),M=A-y,N=S-b;return I>0&&I*I>M*M+N*N}function c(y,b,v,A,S,w,I){for(let M=0;M<A.length;++M){const N=A[M];if(!u(y,b,v,S[N],w[N],I[N]))return!1}return!0}function g(y,b,v,A,S,w){const I=A-y,M=S-b,N=w-v,D=Math.sqrt(I*I+M*M);return[(y+A+I/D*N)/2,(b+S+M/D*N)/2,(D+v+w)/2]}function m(y,b,v,A,S,w,I,M,N){const D=(y+A+I)/3,q=(b+S+M)/3,et=y-D,O=b-q,K=A-D,j=S-q,ot=I-D,it=M-q,ct=et-K,pt=et-ot,Pt=O-j,At=O-it,bt=w-v,It=N-v,Ut=et*et+O*O-v*v,Gt=Ut-K*K-j*j+w*w,Dt=Ut-ot*ot-it*it+N*N,Rt=pt*Pt-ct*At,Tt=(Pt*Dt-At*Gt)/(2*Rt)-et,Nt=(At*bt-Pt*It)/Rt,Ht=(pt*Gt-ct*Dt)/(2*Rt)-O,qt=(ct*It-pt*bt)/Rt,Zt=Nt*Nt+qt*qt-1,Lt=2*(v+Tt*Nt+Ht*qt),Kt=Tt*Tt+Ht*Ht-v*v,ue=-(Math.abs(Zt)>1e-6?(Lt+Math.sqrt(Lt*Lt-4*Zt*Kt))/(2*Zt):Kt/Lt);return[D+et+Tt+Nt*ue,q+O+Ht+qt*ue,ue]}function f(y,b,v,A){switch(y.length){case 1:const S=y[0];return(function(et,O,K){return[et,O,K]})(b[S],v[S],A[S]);case 2:const[w,I]=y;return g(b[w],v[w],A[w],b[I],v[I],A[I]);case 3:const[M,N,D]=y;return m(b[M],v[M],A[M],b[N],v[N],A[N],b[D],v[D],A[D]);default:return null}}function p(y,b,v,A,S,w){const I=v-w,M=A-y,N=S-b;return I<0||I*I<M*M+N*N}function _(y,b,v,A,S){const w=v[b],I=A[b],M=S[b];if(c(w,I,M,y,v,A,S))return[b];for(let N=0;N<y.length;++N){const D=y[N],q=v[D],et=A[D],O=S[D];if(p(w,I,M,q,et,O)){const[K,j,ot]=g(q,et,O,w,I,M);if(c(K,j,ot,y,v,A,S))return[y[N],b]}}for(let N=0;N<y.length-1;++N)for(let D=N+1;D<y.length;++D){const q=y[N],et=y[D],O=v[q],K=A[q],j=S[q],ot=v[et],it=A[et],ct=S[et],pt=g(O,K,j,ot,it,ct);if(p(pt[0],pt[1],pt[2],w,I,M)){const Pt=g(O,K,j,w,I,M);if(p(Pt[0],Pt[1],Pt[2],ot,it,ct)){const At=g(ot,it,ct,w,I,M);if(p(At[0],At[1],At[2],O,K,j)){const bt=m(O,K,j,ot,it,ct,w,I,M);if(c(bt[0],bt[1],bt[2],y,v,A,S))return[q,et,b]}}}}throw new Error}n=(function(b){for(let v=b.length-1;v>=0;v--){let A=Math.floor(Math.random()*(v+1));A=Math.max(Math.min(A,v),0);const S=b[v];b[v]=b[A],b[A]=S}return b})(n),s=s||new Array(t.length).fill(0);const x=(function(b,v,A,S,w){let I=null,M=[],N=0;for(;N<v;){const D=b[N];I&&u(I[0],I[1],I[2],A[D],S[D],w[D])?N++:(M=_(M,D,A,S,w),I=f(M,A,S,w),N=0)}return I})(n,n.length,t,e,s);x[0]+=d,x[1]+=h;for(let y=0;y<n.length;y++){const b=n[y];t[b]+=d,e[b]+=h}return x}var Bx=[1/0,1/0,-1/0,-1/0];function Hl(t,e,s,i,n,r={x:0,y:0}){const o=Math.cos(n),a=Math.sin(n),l=t-s,d=e-i;return r.x=o*l-a*d+s,r.y=a*l+o*d+i,r}function I1(t,e,s=0,i={x:0,y:0}){return i.x=t.x+s*Math.sin(e),i.y=t.y+s*Math.cos(e),i}var Ze=(t,e,s,i)=>Math.hypot(t-s,e-i);function yl(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function Ux(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=e,t.y/=e,t}function hu(t){return 180*t/Math.PI}function M1(t){return t*Math.PI/180}function Gx(t,e){return t.minX-=e,t.minY-=e,t.maxX+=e,t.maxY+=e,t.width===void 0&&(t.width=t.maxX-t.minX),t.height===void 0&&(t.height=t.maxY-t.minY),t.width+=2*e,t.height+=2*e,t}function Oc(t,e,s,i,n,r){const o=i-t,a=n-e,l=Math.sqrt(o*o+a*a);if(l>s+r||l<Math.abs(s-r))return null;const d=(s*s-r*r+l*l)/(2*l),h=t+o*d/l,u=e+a*d/l,c=Math.sqrt(s*s-d*d),g=c/l*-a,m=o*(c/l);return[[h+g,u+m],[h-g,u-m]]}function Bc(t,e,s,i,n,r){if(t-n>=0&&s-n<0)return 1;if(t-n<0&&s-n>=0)return-1;if(t-n==0&&s-n==0)return e-i>=0||i-r>=0?e-i:i-e;const o=(t-n)*(i-r)-(s-n)*(e-r);return o<0?1:o>0?-1:(t-n)*(t-n)+(e-r)*(e-r)-((s-n)*(s-n)+(i-r)*(i-r))}function N1([t,e,s],i,n){const r=Math.abs(t-i),o=Math.abs(e-n);return r+o<=s||!(r>s||o>s)&&Math.sqrt(r*r+o*o)<s+1e-12}function R1(t,e,s,i){const n=t[0]-e,r=t[1]-s,o=t[2]-i;return n*n+r*r<o*o+1e-6}function Uc(t,e,s,i,n,r,o){const a=t-Math.max(i,Math.min(r,t)),l=e-Math.max(n,Math.min(o,e));return a*a+l*l<s*s}function Vx(t,e,s,i,n,r,o,a={x:0,y:0}){const l=a||{x:0,y:0};let d,h,u,c;if(s===t){const _=t-n,x=o*o-_*_;if(x<0)return null;const y=Math.sqrt(x);d=t,u=t,h=r+y,c=r-y}else{const _=(i-e)/(s-t),x=e-_*t,y=x-r,b=_*_+1,v=2*(_*y-n),A=v*v-4*b*(n*n+y*y-o*o);if(A<0)return null;const S=-v,w=Math.sqrt(A),I=2*b;d=(S+w)/I,u=(S-w)/I,h=_*d+x,c=_*u+x}const g=t-d,m=e-h,f=t-u,p=e-c;return g*g+m*m<f*f+p*p?(l.x=d,l.y=h):(l.x=u,l.y=c),l}function uu({X:t,Y:e,sizes:s,indexes:i,R:n,center:r,gap:o=0,epsilon:a=.001,maxLoops:l=5,inPlace:d=!0}){const h=i.length,u=r[0],c=r[1];let g=h;d||(t=t.slice(),e=e.slice());const m=Oc,f=Bc,p=i.slice().sort(((M,N)=>f(t[M],e[M],t[N],e[N],u,c))),_=p[h-1],x=t[_],y=e[_];let b=!1;for(let M=0;M<g-1;M++){let N=M%h,D=(M+1)%h;M===-1&&(N=h-1,D=0),N=p[N],D=p[D];const q=t[N],et=e[N];let O=t[D],K=e[D];const j=s[N]+s[D]+o;let ot=f(q,et,O,K,u,c);if(ot===-1&&b&&(ot=1),!(j>n)){if(ot===1||j-Ze(q,et,O,K)>a){const it=m(u,c,n,q,et,j);if(it){const ct=it[0];b=O>u&&ct[0]<u,O=t[D]=ct[0],K=e[D]=ct[1]}}else b=!1;if(M%h==h-2){const it=p[h-1],ct=p[0];if(e[it]>c&&e[ct]>c&&t[it]-s[it]<t[ct]+s[it]){let pt=0;for(g=Math.min(h*l,g+h);e[p[it]]>c&&e[p[0]]>c&&t[p[it]]<t[p[0]]&&++pt<h;){const Pt=p.pop();Pt&&p.unshift(Pt)}}}}}const v=x-u,A=y-c,S=t[_]-u,w=e[_]-c,I=v===S?0:Math.abs(Math.acos((v*S+A*w)/(Math.sqrt(v*v+A*A)*Math.sqrt(S*S+w*w))));if(I!==0){const M=Math.sin(-I),N=Math.cos(-I);let D;for(let q=0;q<h;q++){D=p[q];const et=t[D]-u,O=e[D]-c;t[D]=et*N-O*M+u,e[D]=et*M+O*N+c}}return{X:t,Y:e}}function pm(t,e,s,i,n,r){const o={},a=s[t];let l=a,d=0;const h=a*n;for(const u in e){const c=e[u];let g=0,m=0;for(let x=0,y=c.length;x<y;x++){const b=s[c[x]];m=Math.max(m,b),g+=2*b+i}const f=g/(2*Math.PI),p=m+l,_=r?d+Math.max(r,p):d*n;d=Math.max(p,d,f,h,_),o[u]=d,l=m}return o[0]=0,o[Number.POSITIVE_INFINITY]=d,o}function F1(t,e,s){return(e[0]-t[0])*(s[1]-t[1])-(e[1]-t[1])*(s[0]-t[0])}function _m(t){const e=t.length,s=[0,1];let i=2;for(let n=2;n<e;n++){for(;i>1&&F1(t[s[i-2]],t[s[i-1]],t[n])<=0;)--i;s[i++]=n}return s.slice(0,i)}function P1(t){const e=t.length;if(e<3)return null;const s=new Array(e),i=new Array(e);for(let u=0;u<e;u++)s[u]=[+t[u][0],+t[u][1],u];s.sort(((u,c)=>u[0]-c[0]||u[1]-c[1]));for(let u=0;u<e;u++)i[u]=[s[u][0],-s[u][1]];const n=_m(s),r=_m(i),o=r[r.length-1],a=n[n.length-1],l=r[0]===n[0],d=o===a?1:0,h=[];for(let u=n.length-1;u>=0;--u)h.push(t[s[n[u]][2]]);for(let u=+l;u<r.length-d;u++)h.push(t[s[r[u]][2]]);return h}var ym=t=>--t*t*t+1,xm=(t,e,s)=>{const i=t-s[0],n=e-s[1];return i*i+n*n},z1=(t,e)=>{let s=1/0,i=-1/0;for(let n=0;n<t.length;n++){const r=t[n],o=e?e[r]:r;s=Math.min(o,s),i=Math.max(o,i)}return{min:s,max:i}};function D1({X:t,Y:e,R:s,center:i,maxSteps:n=1e3,padding:r=5,epsilon:o=1e-9,damping:a=2,pinned:l=-1,indexes:d,onUpdate:h,pushSmallerOut:u=!0}){const c=d?d.length:t.length;let g=d;if(g===void 0){g=new Uint32Array(c);for(let b=0;b<c;b++)g[b]=b}else g=d;if(l!==-1)i=[t[l],e[l]];else if(!i){let b=0,v=0;for(let A=0;A<c;A++)b+=t[g[A]],v+=e[g[A]];i=[b/c,v/c]}const{min:m,max:f}=z1(g,s);function p(b,v){let A=0;for(let M=0;M<c-1;M++)for(let N=M+1;N<c;N++){if(M===N)continue;const D=g[M],q=g[N],et=t[D],O=e[D],K=s[D],j=t[q],ot=e[q],it=s[q],ct=j-et,pt=ot-O,Pt=K+it+r,At=ct*ct+pt*pt;if(At<Pt*Pt-b){const bt=(Pt-Math.sqrt(At))*v,It=1/At,Ut=ct*It*bt,Gt=pt*It*bt,Dt=Ut*Ut+Gt*Gt;if(q!==l){const Rt=K/m;A+=Dt*Rt,t[q]+=Ut*Rt,e[q]+=Gt*Rt}if(D!==l){const Rt=it/m;A+=Dt*Rt,t[D]-=Ut*Rt,e[D]-=Gt*Rt}}}const S=b*a*(1-v),w=i[0],I=i[1];for(let M=0;M<c;M++){const N=g[M];if(N!==l){const D=t[N],q=e[N],et=s[N]/f,O=u?S*et:S,K=(D-w)*O,j=(q-I)*O;A+=K*K+j*j,t[N]-=K,e[N]-=j}}return A}g.sort(((b,v)=>s[v]*xm(t[v],e[v],i)-s[b]*xm(t[b],e[b],i)));let _=0,x=0;const y=ym(1/c);for(let b=0;b<n&&(_=p(y,ym((b+1)/n)),h&&setTimeout((()=>h(t,e))),!(Math.abs(_-x)<o));b++)x=_;return{X:t,Y:e}}var Ca=t=>({data:t,next:null,prev:null});function qx(t,e=0,s=0){const i=t.length;if(i===0)return t;const n=t[0];if(n.x=e,n.y=s,i===1)return t;const r=t[1];if(n.x=e-r.radius,r.x=e+n.radius,r.y=s,i===2)return t;const o=t[2];bm(r,n,o);let a=Ca(n),l=Ca(r),d=Ca(o);a.next=d.prev=l,l.next=a.prev=d,d.next=l.prev=a;t:for(let h=3;h<i;h++){d=Ca(t[h]),bm(a.data,l.data,t[h]);let u=l.next,c=a.prev,g=l.data.radius,m=a.data.radius;do if(g<=m){if(vm(u.data,d.data)){l=u,a.next=l,l.prev=a,--h;continue t}g+=u.data.radius,u=u.next}else{if(vm(c.data,d.data)){a=c,a.next=l,l.prev=a,--h;continue t}m+=c.data.radius,c=c.prev}while(u!==c.next);d.prev=a,d.next=l,a.next=l.prev=l=d;let f=Em(a);for(;(d=d.next)!==l;){const p=Em(d);p<f&&(a=d,f=p)}l=a.next}return t}function bm(t,e,s){const i=t.x-e.x;let n,r;const o=t.y-e.y,a=i*i+o*o;let l,d;a?(r=e.radius+s.radius,r*=r,d=t.radius+s.radius,d*=d,r>d?(n=(a+d-r)/(2*a),l=Math.sqrt(Math.max(0,d/a-n*n)),s.x=t.x-n*i-l*o,s.y=t.y-n*o+l*i):(n=(a+r-d)/(2*a),l=Math.sqrt(Math.max(0,r/a-n*n)),s.x=e.x+n*i-l*o,s.y=e.y+n*o+l*i)):(s.x=e.x+s.radius,s.y=e.y)}var k1=1e-6;function vm(t,e){const s=t.radius+e.radius-k1,i=e.x-t.x,n=e.y-t.y;return s>0&&s*s>i*i+n*n}function Em(t){const e=t.data,s=t.next.data,i=e.radius+s.radius,n=(e.x*s.radius+s.x*e.radius)/i,r=(e.y*s.radius+s.y*e.radius)/i;return n*n+r*r}function O1(t,e,s,i,n){const r=t.get(e),o=t.get(s),a=n.get(r._index)||r.getAttributes(["x","y","r"]),l=n.get(o._index)||o.getAttributes(["x","y","r"]),d=Number(l.radius),h=Number(a.radius),u=Ze(a.x,a.y,l.x,l.y),c=u;return i.push({source:e,target:s,weight:c}),u<=h+d+20?1:0}function B1(t){return t%3==2?t-2:t+1}function U1(t,e,s){const i=[],{triangles:n,halfedges:r}=t;for(let o=0;o<n.length;o++)o>r[o]&&O1(e,n[o],n[B1(o)],i,s);return i}var G1=(t,e)=>t.weight-e.weight;function V1(t,e){const s=new Set,i=new Array(t.length),n=[];for(const o of e)i[o.source]||(i[o.source]=[]),i[o.source].push(o),i[o.target]||(i[o.target]=[]),i[o.target].push(o);s.add(0);const r=yd(G1,i[0]);for(;r.size!==0;){const o=r.pop(),a=s.has(o.source)?s.has(o.target)?null:o.target:o.source;if(a){const l=o.source===a?o.target:o.source,d=a;n.push({source:l,target:d,weight:o.weight}),s.add(a);for(const h of i[a])r.push(h)}}return n}function Am(t,e,s){let i=t.x-e.x,n=t.y-e.y;const r=Math.sqrt(i*i+n*n);i/=r,n/=r;const o=s*i,a=s*n;t.x+=o,t.y+=a}function q1(t,e,s,i,n){const r=new Set;let o={x:0,y:0},a=-1;const l=n.map(((d,h)=>(t===s.get(h)&&(a=h,o={index:h,...d}),{x:d.x,y:d.y,r:d.radius,index:h})));if(s.size<3)return l.map(((d,h)=>{if(h===a)return d;const u=d.x-o.x,c=d.y-o.y,g=Math.sqrt(u*u+c*c),m=e*u/g,f=e*c/g;return{x:d.x+m,y:d.y+f,radius:d.r}}));for(const d of i){const h=l[d.target],u=l[d.source],c=1;u.index===a||r.has(d.source)||(Am(u,o,c*e),r.add(d.source)),h.index===a||r.has(d.target)||(Am(h,o,c*e),r.add(d.target))}return l.map((d=>({x:d.x,y:d.y})))}function Hx(t,e,s,i){t.includes(e)||(t=t.concat(e.toList())),i||(i=t.getAttributes(["x","y","radius"]));const n=Dc.from(i||t.getPosition(),(l=>l.x),(l=>l.y)),r=new Map;for(let l=0;l<t.size;l++)r.set(t._indexes[l],i[l]);const o=U1(n,t,r),a=V1(t.toArray(),o);return q1(e,s,t,a,i)}var H1=class{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(t){return this._getBounds=t,this}setIntersector(t){return this._intersects=t,this}};function j1(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function Ei(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}var bi=(t,e,s,i,n,r)=>({minX:t,minY:e,maxX:s,maxY:i,leaf:!0,level:r,parent:n,objects:[],final:!1,children:null});function jx(t){const{minX:e,minY:s,maxX:i,maxY:n}=t;return[e,s,i,n]}function no(t,e,s,i,n,r,o,a){return t>=n&&s<=o&&e>=r&&i<=a}var Y1=0,X1=1,W1=2,$1=3;function La(t,e,s,i,n,r,o,a){const l=(r+a)/2,d=(e+i)/2;return(t+s)/2<=(n+o)/2?d<=l?Y1:X1:d<=l?$1:W1}var Z1=t=>t,tr=class extends H1{constructor(t=Z1,e=10,s,i=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=e,this._root=null,this._getBounds=t,this._rootLevel=i,this._maxLevel=i+30,this._idToCell={},s&&(this._root=bi(s[0],s[1],s[2],s[3],null,i))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(t,e,s,i,n,r=this._root){if(e||([e,s,i,n]=this._getBounds(t)),this._objects[t])return;if(this._objects[t]=!0,this._size++,!this._root){const g=Math.max(Math.abs(i-e),Math.abs(n-s));return this._root=bi(e,s,e+g,s+g,null,this._rootLevel),this._idToCell[t]=[this._root],this._root.objects=[t],t}let o,a=[r],l=!1;const d=this._nodeCapacity,h=this._idToCell,u=this._maxLevel;let c;for(;c=a.pop();){o=c;const{minX:g,minY:m,maxX:f,maxY:p}=o;Ei(e,s,i,n,g,m,f,p)&&(o.leaf?o.objects&&(o.objects.length<d||o.final)?(o.objects.push(t),h[t]?h[t].push(o):h[t]=[o],l=!0,(o.level>=u||Math.abs(f-g)<=Math.abs(i-e)||Math.abs(p-m)<=Math.abs(n-s))&&(o.final=!0)):(this.splitNode(o),a.push(o)):a.push.apply(a,o.children))}if(!no(e,s,i,n,(r=this._root).minX,r.minY,r.maxX,r.maxY)){let g=this._rootLevel;for(;!no(e,s,i,n,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){r=this._root;const{minX:m,minY:f,maxX:p,maxY:_}=r;let x=m,y=f,b=p,v=_;const A=Math.abs(p-m),S=Math.abs(_-f);if(S===0&&A===0)break;const w=Math.max(A,S);e<m?(x-=w,s<f?y-=w:v+=w):(b+=w,s<f?y-=w:v+=w);const I=bi(x,y,b,v,null,--g);this.splitNode(I),I.children[La(m,f,p,_,x,y,b,v)]=r,this._root=r.parent=I}for(a=[this._root],this._root.level=this._rootLevel;c=a.shift();)if(o=c,!o.leaf)for(let m=0;m<4;m++){const f=o.children[m];f.level=o.level+1,a.push(f)}r=this._root;for(let m=0;m<4;m++){const f=r.children[m];f&&f.leaf&&f.objects&&(f.objects.push(t),h[t]?h[t].push(f):h[t]=[f])}}return l?t:void 0}removeById(t){if(!this._objects[t])return t;this._size--;const e=this._idToCell[t];for(let s=0;s<e.length;s++){const i=e[s].objects||[];for(let n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}}return delete this._objects[t],delete this._idToCell[t],t}remove(t){const[e,s,i,n]=this._getBounds(t),r=[this._root];let o,a;const l=[];for(;o=r.pop();)if(Ei(e,s,i,n,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const d=o.objects||[];for(let h=0,u=d.length;h<u;h++)if(d[h]===t){d.splice(h,1),u===1&&l.push(o);break}}else r.push.apply(r,o.children);if(delete this._idToCell[t],delete this._objects[t],this._size--,l.length)for(;a=l.pop();){let d=a.parent,h=!0;for(;d&&h;){if(!d.leaf){for(let u=0;u<4;u++)if(o=d.children[u],!o.leaf||o.objects&&o.objects.length!==0){h=!1;break}h&&(d.leaf=!0,d.children=[],d.objects=[])}d=d.parent}}return t}splitNode(t){const{minX:e,minY:s,maxX:i,maxY:n}=t,r=(e+i)/2,o=(s+n)/2,a=t.level+1,l=this._idToCell,d=this._maxLevel,h=[bi(e,s,r,o,t,a),bi(e,o,r,n,t,a),bi(r,o,i,n,t,a),bi(r,s,i,o,t,a)];if(t.objects!==null){const u=t.objects,c=this._getBounds;for(let g=0,m=u.length;g<m;g++){const f=u[g],p=c(f);let _=l[f];for(let x=0;x<4;x++){const y=h[x],{minX:b,minY:v,maxX:A,maxY:S}=y;Ei(p[0],p[1],p[2],p[3],b,v,A,S)&&(y.objects&&y.objects.push(f),(y.level>=d||Math.abs(A-b)<=Math.abs(p[2]-p[0])||Math.abs(S-v)<=Math.abs(p[3]-p[1]))&&(y.final=!0),_?_.push(y):_=[y])}_&&_.splice(_.indexOf(t),1)}}t.children=h,t.objects=null,t.leaf=!1}point(t,e,s){let i=[];const n=[this._root];let r,o,a;const l=this._getBounds;for(;r=n.pop();)if(t>=r.minX&&t<=r.maxX&&e>=r.minY&&e<=r.maxY){if(r.leaf){s&&r.objects&&(i=r.objects);const d=r.objects||[];for(let h=0,u=d.length;h<u;h++)a=d[h],o=l(a),t>=o[0]&&t<=o[2]&&e>=o[1]&&e<=o[3]&&i.push(a);break}n.push.apply(n,r.children)}return i.length?i:null}neigbours(t,e){let s,i=[];const n=[this._root];for(;s=n.pop();)if(t>=s.minX&&t<=s.maxX&&e>=s.minY&&e<=s.maxY){if(s.leaf){i=s.objects;break}n.push.apply(n,s.children)}return i}query(t,e,s,i){const n=[],r=[this._root];let o,a,l;const d=this._getBounds,h={},u=this._intersects;let c;for(;o=r.pop();)if(Ei(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const g=o.objects||[];for(let m=0,f=g.length;m<f;m++)l=g[m],h[l]||(a=d(l),Ei(t,e,s,i,a[0],a[1],a[2],a[3])&&(u&&!u(l,t,e,s,i)||n.push(l)),h[l]=!0)}else c=La(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY),r.push(o.children[(c+3)%4],o.children[(c+2)%4],o.children[(c+1)%4],o.children[c]);return n}traverse(t,e,s,i,n){const r=[],o=[this._root];let a,l,d;const h=this._getBounds,u={},c=this._intersects;let g;for(;a=o.pop();)if(Ei(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY))if(a.leaf){const m=a.objects||[];for(let f=0,p=m.length;f<p;f++)if(d=m[f],!u[d]){if(l=h(d),Ei(t,e,s,i,l[0],l[1],l[2],l[3])&&(!c||c(d,t,e,s,i))&&(r.push(d),n(d)))return r;u[d]=!0}}else g=La(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY),o.push(a.children[(g+3)%4],a.children[(g+2)%4],a.children[(g+1)%4],a.children[g]);return r}getOverlaps(){const t=[this._root];let e,s,i;const n=[],r=this._getBounds,o={};for(;e=t.pop();)if(e.leaf){const a=e.objects||[],l=a.length;for(let d=0;d<l;d++)for(let h=0;h<l;h++)if(s=a[d],i=a[h],d!==h&&!o[s+":"+i]&&!o[i+":"+s]){o[s+":"+i]=!0;const u=r(s),c=r(i);Ei(u[0],u[1],u[2],u[3],c[0],c[1],c[2],c[3])&&n.push(s,i)}}else t.push.apply(t,e.children);return n}cover(t,e,s,i){if(this._root===null)return this._root=bi(t,e,s,i,null,0),this;let n=this._root;if(!no(t,e,s,i,n.minX,n.minY,n.maxX,n.maxY)){let r=this._rootLevel;for(;!no(t,e,s,i,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){n=this._root;const{minX:d,minY:h,maxX:u,maxY:c}=n;let g=d,m=h,f=u,p=c;const _=Math.abs(u-d),x=Math.abs(c-h);if(x===0&&_===0)break;const y=Math.max(_,x);t<d?(g-=y,e<h?m-=y:p+=y):(f+=y,e<h?m-=y:p+=y);const b=bi(g,m,f,p,null,--r);this.splitNode(b),b.children[La(d,h,u,c,g,m,f,p)]=n,this._root=n.parent=b}const o=[this._root];let a,l;for(this._root.level=this._rootLevel;a=o.shift();)if(l=a,!l.leaf)for(let d=0;d<4;d++){const h=l.children[d];h.level=l.level+1,o.push(h)}}return this}getAll(){return Object.keys(this._objects).map((t=>Number(t)))}forEach(t,e){const s=[this._root];let i;for(;i=s.pop();)if(i.leaf&&i.objects)for(let n=0,r=i.objects.length;n<r;n++)t.call(e,i.objects[n]);else s.push.apply(s,i.children);return this}getLeafs(){const t=[this._root],e=[];let s;for(;s=t.pop();)s.leaf?e.push(s):t.push.apply(t,s.children);return e}traverseFromRoot(t,e){const s=[this._root];let i;for(;i=s.pop();)t.call(e,i,i.objects)||i.leaf||s.push.apply(s,i.children);return this}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n),this}getNodeBounds(t){return jx(t)}};tr.flatAccessor=(t,e)=>s=>{const i=e*s;return t.slice(i,i+e)},tr.inside=no,tr.intersects=j1,tr.overlaps=Ei,tr.getNodeBBox=jx;var K1=tr;function Gc(t,e,s,i,n){const r=new Array(t.length);for(let o=0;o<e.length;o++){const a=i[e[o]],l=i[s[o]];r[a]=r[a]||[],r[a].push(l),n&&(r[l]=r[l]||[],r[l].push(a))}return r}function Do(t,e){return t[e]===-1?e:Do(t,t[e])}function Q1(t,e,s){const i=Do(t,e),n=Do(t,s);t[i]=n}function J1(t,e,s,i=!1){const n=new Int32Array(t.length),r={};for(let o=0;o<t.length;o++)n[o]=-1,r[t[o]]=o;for(let o=0;o<e.length;o++){const a=r[e[o]],l=r[s[o]];if(i&&a===l)return!0;const d=Do(n,a),h=Do(n,l);if(d===h)return!0;Q1(n,d,h)}return!1}function Yx(t,e,s,i,n,r,o,a){if(i[t]=n,s[t])return!0;if(e[t])return!1;e[t]=1,s[t]=1;const l=r[t];if(l){for(const d of l)if(Yx(d,e,s,i,t,r,o,a))return o.push(a[d]),!0}return s[t]=0,!1}function Xx(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Uint8Array(i),o=new Int32Array(i),a={};for(let d=0;d<i;d++)a[t[d]]=d;const l=Gc(t,e,s,a,!1);for(let d=0;d<i;d++){const h=[];if(Yx(d,n,r,o,-1,l,h,t)&&h.length>1){const u=h[0];for(let c=1;c<h.length;c++)if(h[c]===u){h.length=c;break}return h.push(u),h.reverse()}}return!1}function Wx(t,e,s,i,n,r,o){e[t]=1,i[t]=s;const a=n[t];if(a){for(const l of a)if(e[l]){if(l!==s)return i[l]=t,r.push(o[l]),!0}else if(Wx(l,e,t,i,n,r,o))return r.push(o[l]),!0}return!1}function tT(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Int32Array(i),o={};for(let l=0;l<i;l++)o[t[l]]=l,r[l]=-1;const a=Gc(t,e,s,o,!0);for(let l=0;l<e.length;l++){const d=o[e[l]],h=o[s[l]];a[d]=a[d]||[],a[d].push(h)}for(let l=0;l<i;l++){const d=l,h=[];if(!n[d]&&Wx(d,n,-1,r,a,h,t))return!0}return!1}var $x=class{constructor(t,e,s){this.cycles=[],this.visitedLength=0,this.visitedStack=[],this.stack=[],this.idToIndex={},this.removed={},this.nodes=t,this.visited=new Uint8Array(this.nodes.length);for(let i=0;i<t.length;i++)this.idToIndex[t[i]]=i;this.adjacency=Gc(t,e,s,this.idToIndex)}getCycles(){this.visited=new Uint8Array(this.nodes.length),this.visitedStack=[];for(let t=0;t<this.nodes.length;t++)for(this.backtrack(t,t);this.visitedLength!==0;){const e=this.visitedStack.pop();e!==void 0&&this.visited[e]&&(this.visited[e]=0,this.visitedLength--)}return this.cycles}backtrack(t,e){let s=!1;this.stack.push(e),this.visited[e]||(this.visited[e]=1,this.visitedLength++),this.visitedStack.push(e);const i=this.adjacency[e]||[];for(const n of i)if(this.removed[e]=this.removed[e]||{},!this.removed[e][n]){if(n<t)this.removed[e][n]=!0;else if(n===t){s=!0;const r=[];for(let o=0,a=!1;o<this.stack.length;o++){const l=this.stack[o];t===l&&(a=!0),a&&r.push(this.nodes[l])}this.cycles.push(r)}else if(!this.visited[n]){const r=this.backtrack(t,n);s=s||r}}if(s){let n;do n=this.visitedStack.pop(),this.visited[n]&&(this.visited[n]=0,this.visitedLength--);while(n!==e)}return this.stack.pop(),s}};function eT(){return{index:{},parent:[],count:0}}function sT(t,e){t.index[e]===void 0&&(t.count+=1,t.index[e]=t.parent.push(-t.count))}function Sm(t,e){let s=t.index[e];if(s===void 0)return-1;for(;s>=0;)e=s,s=t.parent[s];return e}function iT(t,e,s){t.parent[s]=e,t.count-=1}function nT(t){return t.count<=1}function Zx(t,e,s,i,n){n&&e.sort(((a,l)=>n(a)-n(l)));const r=[],o=eT();t.forEach((a=>sT(o,a)));for(let a=0;a<e.length&&!nT(o);a++){const l=Sm(o,s(e[a])),d=Sm(o,i(e[a]));l!==d&&l>0&&d>0&&(iT(o,l,d),r.push(e[a]))}return r}function Kx({adjacency:t,directed:e=!1,normalized:s=!0}){const i=[],n=[],r={},o={},a={},l={};let d;const h=new Array(t.length),u={},c={},g={};for(let x=0;x<t.length;x++){const y=t[x];g[y.id]=y.adj,u[y.id]=!0,c[y.id]=x,e||y.adj.forEach((b=>{u[b]=!0}))}const m=Object.keys(u).map((x=>+x));for(let x=0;x<m.length;x++)h[x]=0;for(let x=0;x<m.length;x++)d=m[x],_(d),p();const f=s?m.length>2?1/((m.length-1)*(m.length-2)):0:e?0:.5;if(f)for(let x=0;x<h.length;x++)h[x]*=f;return h;function p(){for(let x=0;x<m.length;x++)l[m[x]]=0;for(;n.length;){const x=n.pop(),y=(1+l[x])/a[x],b=r[x];for(let v=0;v<b.length;++v){const A=b[v];l[A]+=a[A]*y}x!==d&&(h[c[x]]+=l[x])}}function _(x){for(let y=0;y<m.length;y++){const b=m[y];r[b]=[],o[b]=-1,a[b]=0}for(o[x]=0,a[x]=1,i.push(x);i.length;){const y=i.shift();n.push(y),g[y].forEach((b=>{o[b]===-1&&(o[b]=o[y]+1,i.push(b)),o[b]===o[y]+1&&(a[b]+=a[y],r[b].push(y))}))}}}var Qx=class{constructor(t){this._heap=[],this._size=0,this._keyToValue=t,this._keyToIndex=new Int32Array(t.length),this._keyToIndex.fill(-1)}add(t){let e=this._keyToIndex[t];e===-1&&(e=this._size++,this._heap[e]=t),this._keyToIndex[t]=this._bubble(e)}removeMin(){if(this._size===0)return NaN;const t=this._heap[0];return this._heap[0]=this._heap[--this._size],this._bubble(0),t}isEmpty(){return this._size===0}has(t){return this._keyToIndex[t]!==-1}_bubble(t){const e=this._indexToValue(t),s=this._getParentIndex(t),i=this._indexToValue(s);let n=t;if(t!==0&&i>e)n=this._swap(t,s);else{const r=this._getLeftChildIndex(t),o=this._getRightChildIndex(t),a=this._indexToValue(r),l=this._indexToValue(o),d=Math.min(e,a,l);d===e||(n=d===a?this._swap(t,r):this._swap(t,o))}return n===t?t:this._bubble(n)}_indexToValue(t){return t>=this._size?1/0:this._keyToValue[this._heap[t]]}_getParentIndex(t){return(t-1)/2|0}_getLeftChildIndex(t){return 2*t+1}_getRightChildIndex(t){return 2*t+2}_swap(t,e){const s=this._heap[t],i=this._heap[e];return this._heap[t]=i,this._heap[e]=s,this._keyToIndex[s]=e,this._keyToIndex[i]=t,e}},Jx=sn&&!!window.PointerEvent,xd="pointerdown",bd="pointermove",vd="pointerup",oa="pointercancel",Cr={},jl=0,t0=t=>t.pointerType==="mouse",e0=t=>t.pointerType!=="mouse";function rT(){if(Ri&&jl===0&&Jx){const t=document.documentElement;t.addEventListener(xd,s0,!0),t.addEventListener(bd,i0,!0),t.addEventListener(vd,Yl,!0),t.addEventListener(oa,Yl,!0)}jl++}function oT(){if(jl--,Ri&&jl===0){const t=document.documentElement;t.removeEventListener(xd,s0,!0),t.removeEventListener(bd,i0,!0),t.removeEventListener(vd,Yl,!0),t.removeEventListener(oa,Yl,!0)}}function s0(t){Cr[t.pointerId]=t}function i0(t){Cr[t.pointerId]&&(Cr[t.pointerId]=t)}function Yl(t){delete Cr[t.pointerId]}function Ed(t,e){t.touches=[];for(const s in Cr)t.touches.push(Cr[s]);t.changedTouches=[t],e(t)}function aT(t,e,s){const i=n=>{t0(n)||(e0(n)&&n.preventDefault(),Ed(n,s))};return t(e,xd,i,!1),i}function lT(t,e,s){const i=n=>{e0(n)&&n.preventDefault(),Ed(n,s)};return t(e,oa,i,!1),i}function dT(t,e,s){const i=n=>{t0(n)&&n.buttons===0||Ed(n,s)};return t(e,bd,i,!1),i}function hT(t,e,s){const i=n=>Ed(n,s);return t(e,vd,i,!1),t(e,oa,i,!1),i}function wm(t,e,s,i){return s==="touchstart"?t(e,xd,i,!1):s==="touchmove"?t(e,bd,i,!1):s==="touchend"?(t(e,vd,i,!1),t(e,oa,i,!1)):void 0}var te=class{constructor(t){this._ogma=t}_setModules(t){this._modules=t}onMounted(){}onReady(t){}destroy(t){}},uT=["graphics","legend","brand"],Zd=300,Kd=300,cT=200,gT=class extends te{constructor(){super(...arguments),this._width=Zd,this._height=Kd,this._resizeObserver=yx((()=>this._resize())),this._layers={},this._focus=!1,this._container=null,this._isFullScreen=!1,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],this._onNextFramePromises=[],this._refreshUntil=0,this._currentTime=ps(),this._timeouts=[],this._isDestroyed=!1,this._onDetachDom=[],this._isRealBrowser=md,this._isDocumentReady=fd,this._inFrame=!1,this._mustRefresh=!1,this._nextFrame=null,this._onWindowFocus=()=>this.refresh(),this._onFullscreenChange=()=>{this._isFullScreen=xo()},this._resize=t=>{if(!this._container&&!t)return;const e=this._width,s=this._height;let i=0,n=0;if(this._container){const r=this._modules.settings.get("minimumWidth"),o=this._modules.settings.get("minimumHeight"),a=this._container.clientWidth||1,l=this._container.clientHeight||1;i=Math.max(r,t?t.width:a),n=Math.max(o,t?t.height:l)}else t&&(i=t.width,n=t.height);i===e&&n===s||(this._width=i,this._height=n,_i(this._layers,(({element:r,automaticResize:o})=>{o&&Gl(r,i,n)})),this._modules.events.fire("resize",{prevWidth:e,prevHeight:s,width:i,height:n,difWidth:i-e,difHeight:n-s}))}}onMounted(){this._modules.settings.register("minimumWidth",Zd,(()=>this._resize()),!1),this._modules.settings.register("minimumHeight",Kd,(()=>this._resize()),!1),this._modules.events.register(["beforeNewFrame","frame","afterNewFrame","setContainer","resize"]),this._onDetachDom=[],rT(),this.addWindowEventListener("focus",this._onWindowFocus)}onReady(t){t.container&&this.setContainer(t.container),t.options?.width||t.options?.height?this._resize({width:t.options.width||Zd,height:t.options.height||Kd}):this._resize()}addWindowEventListener(t,e,s){return this._isRealBrowser&&this.addElementEventListener(window,t,e,s),this}addDirectWindowEventListener(t,e,s){this._isRealBrowser&&window.addEventListener(t,e,s)}removeDirectWindowEventListener(t,e){this._isRealBrowser&&window.removeEventListener(t,e)}addDocumentEventListener(t,e,s){return this._isDocumentReady&&this.addElementEventListener(document.documentElement,t,e,s),e}removeDocumentEventListener(t,e){this._isDocumentReady&&document.documentElement.removeEventListener(t,e)}addMediaListener(t,e){if(this._isDocumentReady&&typeof window.matchMedia=="function"){const s=window.matchMedia(t);s.addListener(e),this._onDetachDom.push((()=>s.removeListener(e)))}}addElementEventListener(t,e,s,i){return this._isDestroyed||(t.addEventListener(e,s,i),this._onDetachDom.push((()=>t.removeEventListener(e,s,i)))),s}detachFromDom(){this._onDetachDom.forEach((t=>t())),this._onDetachDom=[],this._emptyContainer()}setTimeout(t,e=0){const s=setTimeout((()=>{this._timeouts.splice(this._timeouts.indexOf(s),1),t()}),e);return this._timeouts.push(s),s}clearTimeout(t){return t&&(clearTimeout(t),this._timeouts.splice(this._timeouts.indexOf(t),1)),null}clearAllTimeouts(){this._timeouts.forEach(clearTimeout),this._timeouts=[]}stopFrames(){this._isDestroyed=!0,this._nextFrame&&(cx(this._nextFrame),this._nextFrame=null)}isDestroyed(){return this._isDestroyed}getDimensions(){return{width:this._width,height:this._height}}setDimensions(t){this._resize(t)}setLayer(t,e,{automaticResize:s=!1}={}){e?(e._ogmaLayer=t,s&&(e.style.position="absolute",e.style.top="0px",e.style.left="0px",Gl(e,this._width,this._height,Ns())),this._layers[t]={element:e,automaticResize:s}):e===null&&delete this._layers[t],this._updateContainerContent()}setContainer(t){let e;if(typeof t=="string"){if(e=document.getElementById(t),!e)throw new Error(`unable to find DOM element with id "${t}"`)}else e=t;if(e===this._container)return;e===null&&this._emptyContainer();const s=this._container;this._isFullScreen=!1,this._container&&this._resizeObserver.unobserve(this._container),this._container=e,this._container&&(["fullscreenchange","webkitfullscreenchange"].forEach((i=>{this.addElementEventListener(this._container,i,this._onFullscreenChange)})),this._resizeObserver.observe(this._container)),this._resize(),this._updateContainerContent(),this._modules.events.fire("setContainer",{element:e,prevElement:s})}getContainer(){return this._container}appendElement(t){this._container!==null&&this._container.appendChild(t)}focus(){this._focus=!0}blur(){this._focus=!1}hasFocus(){return this._focus}forceResize(){this._resize()}_beforeOrAfterNextFrame(t){const e=t===1?this._onNextFramePromises:t===2?this._afterNextFramePromises:this._beforeNextFramePromises,s=new Promise((i=>{e.push((()=>(i(void 0),s)))}));return this._refresh(),s}beforeNextFrame(){return this._beforeOrAfterNextFrame(0)}onNextFrame(){return this._beforeOrAfterNextFrame(1)}afterNextFrame(){return this._beforeOrAfterNextFrame(2)}refresh(t){t&&(this._refreshUntil=Math.max(this._refreshUntil,t)),this._refresh()}_emptyContainer(){if(this._container){const t=[];for(let e=0;e<this._container.childNodes.length;++e){const s=this._container.childNodes[e];s._ogmaLayer&&t.push(s)}for(let e=0;e<t.length;++e)this._container.removeChild(t[e])}}_fillContainer(){if(this._container){const t=xx(this._container,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(this._container.style.position="relative");const e=this._container.firstChild;uT.forEach((s=>{const i=this._layers[s];i&&i.element&&this._container&&this._container.insertBefore(i.element,e)}))}}_updateContainerContent(){this._emptyContainer(),this._fillContainer()}_refresh(){this._inFrame?this._mustRefresh=!0:this._nextFrame||this._isDestroyed||(this._nextFrame=Tc((()=>this._playFrame())))}_playFrame(){const t=ps(),e={elapsed:t-this._currentTime},s=this._modules.events,i=Ay([this._beforeNextFramePromises,()=>s.fire("beforeNewFrame",e),()=>s.fire("frame",e),this._onNextFramePromises,()=>s.fire("afterNewFrame",e),this._afterNextFramePromises,()=>{this._inFrame=!1,(this._mustRefresh||t<this._refreshUntil+17)&&(this._mustRefresh=!1,this._refresh())}]);this._inFrame=!0,this._nextFrame=null,this._mustRefresh=!1,this._currentTime=t,this._beforeNextFramePromises=[],this._onNextFramePromises=[],this._afterNextFramePromises=[],i.reduce(((n,r)=>n.then((()=>{if(!this._isDestroyed)return r()}))),Promise.resolve())}isPlayingFrame(){return this._inFrame||!!this._nextFrame}setFullScreen(t){let e=Promise.resolve();return t!==this._isFullScreen?(this._container&&(e=t?mT(this._container):fT()),e.then((()=>new Promise((s=>{this.setTimeout((()=>{this._isFullScreen=xo(),s(void 0)}),cT)}))))):e}isFullScreen(){return xo()}debounceBeforeFrame(t){let e=!1,s=[];const i=()=>{const n=s;e=!1,s=[],t(),n.forEach((r=>r()))};return()=>new Promise((n=>{s.push(n),e||(e=!0,this.beforeNextFrame().then(i))}))}destroy(){this._resizeObserver.disconnect(),oT(),this.detachFromDom(),this.clearAllTimeouts(),this.stopFrames()}};function xo(){return typeof document<"u"&&!!(document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}function mT(t){return xo()?Promise.resolve():t.requestFullscreen?t.requestFullscreen():t.requestFullScreen?t.requestFullScreen():t.webkitRequestFullScreen?Promise.resolve(t.webkitRequestFullScreen()):t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():Promise.resolve()}function fT(){return xo()?typeof document>"u"?Promise.resolve():document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?Promise.resolve(document.webkitCancelFullScreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve():Promise.resolve()}var pT=class extends te{constructor(){super(...arguments),this._nodeChanges=[],this._edgeChanges=[],this._shouldTriggerEvents=!1}onMounted(){this._nodeDataList=this._modules.graph.createAttribute(!0,{name:"data",storage:"any"},!1),this._edgeDataList=this._modules.graph.createAttribute(!1,{name:"data",storage:"any"},!1),this._nodeList=this._modules.graph.getNodeAttribute("object"),this._edgeList=this._modules.graph.getEdgeAttribute("object"),this._modules.events.register(["setData","updateNodeData","updateEdgeData"]),this._modules.events.on("addNodes",(({nodes:t,objects:e})=>this._onAddElements(t,e))).on("addEdges",(({edges:t,objects:e})=>this._onAddElements(t,e))).on("beforeNewFrame",(()=>{this._shouldTriggerEvents&&(this._shouldTriggerEvents=!1,this._triggerEvents())}))}_onAddElements(t,e){const{isNode:s,size:i,_indexes:n}=t,r=this[s?"_nodeDataList":"_edgeDataList"];for(let o=0;o<i;++o)r.set(n[o],e[o].data)}setProperty(t,e,s,{dispatch:i=!1,virtual:n=!1}={}){this._setDataProperty(t.isNode,t._indexes,e,s,i,n),this._modules.events.fire("setData",{elements:t,virtual:n})}getProperty(t,e){return this._getDataProperty(t.isNode,t._indexes,e)}_setDataProperty(t,e,s,i,n,r){n&&typeof i=="function"&&(n=!1);const o=Tm(s),a=typeof i=="function",l=t?this._nodeList:this._edgeList,d=t?this._nodeDataList:this._edgeDataList,h=_T(t?this._nodeChanges:this._edgeChanges,o);for(let u=0;u<e.length;++u){const c=e[u];let g=d.get(c);const m=l.get(c),f=n?i[u]:i;let p,_;if(o===null)p=g,_=a?f(m):f,d.set(c,_);else{g==null&&(g={},d.set(c,g));const x=o.length;for(let y=0;y<x;y++){const b=o[y];let v=g[b];y<x-1?(v==null&&(v={},g[b]=v),g=v):(p=v,_=a?f(m):f,g[b]=_)}}h.indexes.push(c),h.previousValues.push(p),h.newValues.push(_),h.virtual=r}this._scheduleEvents()}_getDataProperty(t,e,s,i){const n=Tm(s);i||(i=new Array(e.length));const r=t?this._nodeDataList:this._edgeDataList;for(let o=0;o<e.length;++o){const a=e[o];let l,d=r.get(a);if(n!==null&&n.length)if(d==null)l=void 0;else{const h=n.length;for(let u=0;u<h&&d;++u)l=d=d[n[u]]}else l=d;i[o]=l}return i}_scheduleEvents(){this._shouldTriggerEvents=!0,this._modules.dom.refresh()}_triggerEvents(){const t=this._prepareEvtPayload(!0),e=this._prepareEvtPayload(!1);this._modules.events.fire("updateNodeData",t),this._modules.events.fire("updateEdgeData",e)}_prepareEvtPayload(t){const e=t?this._modules.graph.nodeList:this._modules.graph.edgeList,s=t?"_nodeChanges":"_edgeChanges";let i=[];const n=this[s];this[s]=[];const r=[];for(let o=0;o<n.length;++o){const{indexes:a,property:l,newValues:d,previousValues:h,virtual:u}=n[o];i=i.concat(a||[]),t?r.push({property:l,newValues:d,previousValues:h,virtual:u,nodes:e(a)}):r.push({property:l,newValues:d,previousValues:h,virtual:u,edges:e(a)})}return t?{nodes:e(i).dedupe(),isNode:t,changes:r}:{edges:e(i).dedupe(),isNode:t,changes:r}}};function _T(t,e){for(let i=0;i<t.length;++i){const n=t[i],r=n.property;if(e===null&&r===null)return n;if(e&&r&&r.length===e.length){let o=!0;for(let a=0;a<r.length;++a)if(r[a]!==e[a]){o=!1;break}if(o)return n}}const s={property:e&&e.slice(),indexes:[],previousValues:[],newValues:[],nodes:null,virtual:!1,edges:null};return t.push(s),s}function Tm(t){return typeof t=="string"?t.split("."):as(t)?t:null}var Ui=()=>(t,e)=>t[e],Gi=()=>(t,e,s)=>{t[e]=s},Cm={1:Qd(1),2:Qd(2),4:Qd(4),8:Ui(),16:Ui(),32:Ui(),int8:Ui(),int16:Ui(),int32:Ui(),float:Ui(),any:Ui()},Lm={1:Jd(1),2:Jd(2),4:Jd(4),8:Gi(),16:Gi(),32:Gi(),int8:Gi(),int16:Gi(),int32:Gi(),float:Gi(),any:Gi()};function Qd(t){const e=8/t,s=(1<<t)-1;return(i,n)=>i[n/e|0]>>n%e*t&s}function Jd(t){const e=8/t,s=Math.pow(2,t)-1;return(i,n,r)=>{const o=n%e*t,a=n/e|0,l=r<<o,d=255-(s-r<<o);i[a]=i[a]&d|l}}function yT(t,e){return t===void 0&&e!=="any"&&e!=="resource"?0:t}var xT={get(t){return this._getArrayElt(this._buffer,t)},set(t,e){this._setArrayElt(this._buffer,t,e)}},bT={get(t){return this._byIndex[this._getArrayElt(this._buffer,t)]},set(t,e){let s=this._byName[e];s===void 0&&(s=this._nextIndex++,this._byIndex.push(e),this._getElementBitSize()>this._elementSize&&this.increaseElementSize(),this._byName[e]=s),this._setArrayElt(this._buffer,t,s)}},vT=0,Xl=class{constructor(t){this._id=vT++,this._initialized=!1;const e=t.name,s=t.storage,i=t.size||0,n=yT(t.default,s),r=Math.max(8,Im(i+1)),o=s==="resource"?1:s;this._name=e,this._storage=s,this._getArrayElt=Cm[o],this._setArrayElt=Lm[o],this._elementSize=o,this._nbElements=r,this._fallback=null,this._byName=void 0,this._byIndex=void 0,this._nextIndex=void 0,this._defaultValue=n,this._BASE_VALUE=s==="any"?void 0:0,this._methods=xT,this._initialized=!1,this._buffer=null,s==="resource"&&(this._methods=bT,this._byName=Object.create(null),this._byIndex=[],this._nextIndex=1,this._byName[n]=0,this._byIndex.push(n))}getValues(){return Object.keys(this._byName||{})}getName(){return this._name||""}setDefaultValue(t){this._defaultValue=t,this._storage==="resource"&&(this._byName[t]=0,this._byIndex[0]=t)}get(t){return this._get(t)}set(t,e){this._set(t,e)}_get(t){return this._defaultValue}_set(t,e){e!==this._defaultValue&&(this._initialize(),this._set(t,e))}setFallback(t){this._fallback=t,this.get=this._getWithFallback}_getWithFallback(t){const e=this._get(t);return e===void 0&&this._fallback?this._fallback.get(t):e}_initialize(){this._initialized=!0,this._buffer=th(this._nbElements,this._elementSize),this._get=this._methods.get,this._set=this._methods.set,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(0)}grow(t){const e=Im(t+1);if(!(e<=this._nbElements)){if(this._initialized)if(this._elementSize==="any")for(let s=this._nbElements;s<e;++s)this._buffer.push(this._defaultValue);else{const s=th(e,this._elementSize);s.set(this._buffer),this._buffer=s,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(this._nbElements)}this._nbElements=e}}increaseElementSize(){const t=this._elementSize;if(typeof t!="number"||t===32)throw new Error("FlexArray: cannot increase element size");const e=2*t,s=Cm[e],i=Lm[e];if(this._initialized){const n=this._nbElements,r=this._getArrayElt,o=this._buffer,a=th(n,e);if(t>=8)a.set(o);else for(let l=0;l<n;++l)i(a,l,r(o,l));this._buffer=a}this._elementSize=e,this._getArrayElt=s,this._setArrayElt=i}buffer(){if(!this._buffer)throw new Error("FlexArray: buffer not instantiated");return this._buffer}elementBitSize(){return this._elementSize}capacity(){return this._nbElements}byteSize(){return this._nbElements*this._elementSize/8}isInitialized(){return this._initialized||this._fallback&&this._fallback.isInitialized()}getMultiple(t,e){const s=t.length;e===void 0&&(e=new Array(s));for(let i=0,n=s;i<n;++i)e[i]=this.get(t[i]);return e}fill(t,e){for(let s=0,i=t.length;s<i;++s)this.set(t[s],e)}setMultiple(t,e,s){if(s||!Array.isArray(e)&&!ArrayBuffer.isView(e))for(let i=0,n=t.length;i<n;++i)this.set(t[i],e);else for(let i=0,n=t.length;i<n;++i)this.set(t[i],e[i])}reset(){return this._initialized&&this._reset(0),this}_reset(t){const e=this._storage==="resource"?0:this._defaultValue;if(this._buffer)if(typeof this._elementSize!="number"||this._elementSize>=8)this._buffer.fill(e,t);else{const s=8/this._elementSize;let i=0;for(let n=0;n<s;++n)i<<=this._elementSize,i+=e;if(t===void 0)this._buffer.fill(i);else{const n=t+(8-t%8);for(let r=t;r<n;++r)this._setArrayElt(this._buffer,r,e);this._buffer.fill(i,n/8)}}}_getElementBitSize(){if(this._nextIndex)return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))}};function Im(t){let e=2;for(;e<t;)e*=2;return e}function th(t,e){return e==="any"?new Array(t):e==="float"?new Float32Array(t):e==="int8"?new Int8Array(t):e==="int16"?new Int16Array(t):e==="int32"?new Int32Array(t):e===32?new Uint32Array(t):e===16?new Uint16Array(t):new Uint8Array(Math.ceil(t/8*e))}var Mm=4,n0=class{constructor(){this._buffer=new Uint32Array(Mm),this._capacity=Mm,this._size=0,this._busy=!1}isBusy(){return this._busy}markBusy(){return this._busy=!0,this}sliceAndReset(){this._busy=!1;const t=this.slice(0,this._size);return this.reset(),t}reset(){return this._size=0,this}reserve(t){return t>this._capacity&&this._setCapacity(Zi(t)),this}_setCapacity(t){const e=new Uint32Array(t);e.set(this._buffer),this._buffer=e,this._capacity=t}push(t){return this._size===this._capacity&&this._setCapacity(2*this._capacity),this._buffer[this._size++]=t,this}pushUnchecked(t){return this._buffer[this._size++]=t,this}slice(t=0,e=this._size){return this._buffer.slice(t,e)}getBuffer(){return this._buffer}getLength(){return this._size}getCapacity(){return this._capacity}setLength(t){return this._size=t,this}isEmpty(){return this._size===0}},Nm=class{constructor(t){this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._flexArrays=[],this._defaultValues=[],this._flexArraysByName={},this._indexLists=[],this._name=t?"node":"edge",this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._idFlexArray=new Xl({storage:"int32"}),this._idFlexArray.get=e=>this._indexToId[e],this._idFlexArray.getMultiple=e=>{const s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=this._indexToId[e[i]];return s},this._flexArraysByName.id=this._idFlexArray}addElements(t){const e=[];for(let s=0,i=t.length;s<i;++s){const n=t[s];let r=this._idToIndex[n];r===void 0&&(r=this._getNextIndex(),this._idToIndex[n]=r,this._indexToId[r]=n),e.push(r)}for(const s of this._flexArrays)s.grow(this._nextIndex);for(const s of this._indexLists)s.reserve(this._nextIndex);return new Uint32Array(e)}removeElements(t){for(let e=0,s=t.length;e<s;++e){const i=t[e],n=this._indexToId[i];n!==void 0&&(delete this._idToIndex[n],this._removeIndex(i))}}clear(){this._idToIndex=Object.create(null),this._indexToId=[void 0],this._nextIndex=1,this._freeIndexes=[];for(const t of this._flexArrays)t.reset();for(const t of this._indexLists)t.reset()}has(t){return this._indexToId[t]!==void 0}getIndex(t,e=!1){const s=this._idToIndex[t];if(s===void 0&&e)throw new Error(`${this._name} id "${t}" not found`);return s}createFlexArray(t,e){const{name:s}=t;if(s&&e&&this._flexArraysByName[s])throw new Error(`${this._name} flexArray "${s}" already exists`);let i=t.default;i===void 0&&t.storage!=="any"&&t.storage!=="resource"&&(i=0);const n=this._nextIndex,r={storage:t.storage,size:n,name:s,default:i};let o;return o=(i===void 0&&t.storage!=="any"&&t.storage,new Xl(r)),this._flexArrays.push(o),this._defaultValues.push(t.default),s&&e&&(this._flexArraysByName[s]=o),o}getFlexArray(t){return this._flexArraysByName[t]}getAllFlexArrays(){return this._flexArraysByName}createIndexList(){const t=new n0;return t.reserve(this._nextIndex),this._indexLists.push(t),t}getId(t){return this._indexToId[t]}getMaxIndex(){return this._nextIndex-1}_removeIndex(t){this._indexesToBeFreed.push(t)}_getNextIndex(){let t=this._freeIndexes.pop();return t===void 0&&(t=this._nextIndex++),t}freeIndexes(){for(const t of this._indexesToBeFreed)this._indexToId[t]=void 0,this._freeIndexes.push(t);for(let t=0;t<this._flexArrays.length;++t){const e=this._flexArrays[t],s=this._defaultValues[t];for(const i of this._indexesToBeFreed)e.set(i,s)}this._indexesToBeFreed=[]}};function Rm(t,e,s={},i={}){const n=ko(t,e,[s],i);return t.fireEvent("postAddElements",{nodes:e?n:void 0,edges:e?void 0:n,virtual:i&&i.virtual}),n.get(0)}function ET(t,{nodes:e=[],edges:s=[]},i={}){if(t.fireEvent("preAddGraph",{name:"preAddGraph"}),!i.batchSize)return Promise.all([ko(t,!0,e,i),ko(t,!1,s,i)]).then((([r,o])=>(t.fireEvent("postAddElements",{nodes:r,edges:o,virtual:i&&i.virtual}),t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{nodes:r,edges:o}),{nodes:r,edges:o})));let n;return Wl(t,!0,e,i).then((r=>(n=r,Wl(t,!1,s,i)))).then((r=>({nodes:n,edges:r}))).then((r=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{name:"addGraph"}),r)))}function Wl(t,e,s,i={}){if(i.batchSize){const n=[];for(let a=0;a<s.length;a+=i.batchSize)n.push(s.slice(a,a+i.batchSize));const r=(a,l)=>{let d;return a.then((h=>(d=h,t.getDom().afterNextFrame()))).then((()=>ko(t,e,l,i))).then((h=>d.concat(h)))},o=e?t.nodeList():t.edgeList();return n.reduce(r,Promise.resolve(o)).then((a=>(t.fireEvent("postAddElements",{nodes:e?a:void 0,edges:e?void 0:a,virtual:i&&i.virtual}),a)))}return Promise.resolve(ko(t,e,s,i)).then((n=>(t.fireEvent("postAddElements",{nodes:e?n:void 0,edges:e?void 0:n,virtual:i&&i.virtual}),n)))}function ko(t,e,s,i){const{virtual:n=!1}=i;t.fireEvent("preAddElements",{name:"preAddElements",objects:s,virtual:n,isNode:e});const r=!!i.ignoreInvalid,o=t.storage.fetch(e),a=[],l=[],d=[],h=[],u=new Set;for(const v of s){if(typeof v!="object"||v===null||Array.isArray(v)){if(r)continue;throw new Error(`${v} is not a valid ${e?"node":"edge"}`)}const A=tw(v.id);if(!o.getIndex(A,!1)&&!u.has(A)){if(!e){const S=v,w=t.getExtremityIndex(A,S.source,0,r),I=t.getExtremityIndex(A,S.target,1,r);if(r&&(!w||!I))continue;d.push(w),h.push(I)}l.push(A),a.push(v),u.add(A)}}const c=o.addElements(l);e?t.topology.allocateNodes(c):t.topology.allocateEdges(c,d,h);const g=o.getFlexArray("object"),m=o.getFlexArray("excluded"),f=o.getFlexArray("removed"),p=o.getFlexArray("virtual"),_=e?t.node:t.edge,x=e?t.nodeList:t.edgeList,y=t.getCacheLists(e),b=x(c);for(let v=0;v<c.length;v++){const A=c[v];g.set(A,_(A))}return m.setMultiple(c,0),f.setMultiple(c,0),p.setMultiple(c,n?1:0),y.visible.invalidList(),y.all.invalidList(),y._all.invalidList(),n||y.raw.invalidList(),b.size!==0&&(e?t.fireEvent("addNodes",{virtual:n,objects:a,nodes:b}):t.fireEvent("addEdges",{virtual:n,objects:a,edges:b})),b}var AT=1,ST=2,wT=3,TT=4,CT=5,LT=6,cu="_visible",gu="_data",bo="_hovered",mu="_hoverExtremityHighlighted",Ne="_selected",fu="_selectionExtremityHighlighted",xl="_dragged",r0="_rewirable",An="_export",o0="_faded",a0="_transparent",IT="_visual_groups",aa=-1,Ia="in",Ma="out",eh="both",Fm=[Ne,xl,fu,bo,mu,r0,An,o0,a0,IT],l0=2,d0=3,MT=3,NT=4,h0=-1,RT=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"],Pm=(t,e)=>(t+e)*(t+e+1)/2+e;function Br(t,e){const s=t<e?t:e;return 67108864*s+(t+e-s)}var FT=8,pu=class{constructor(){this._BIG_LIST=255,this._MAX_LIST_SIZE=8,this._capacity=FT,this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){return t===void 0&&(t=this._nextIndex++),t>=this._capacity&&this._reserve(t+1),this._sizes[t]=0,t}get(t){const e=this._sizes[t],s=this._MAX_LIST_SIZE*t;if(e<=this._MAX_LIST_SIZE){this._constList.length=e;for(let i=0,n=e;i<n;++i)this._constList[i]=this._buffer[s+i];return this._constList}if(e===this._BIG_LIST){const i=this._buffer[s];return this._bigLists[i]}throw new Error(`Table: ${t} out of bounds (${e})`)}size(t){const e=this._sizes[t];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=t[a],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._sizes[t],i=t*this._MAX_LIST_SIZE;if(s<this._MAX_LIST_SIZE)this._buffer[i+s]=e,this._sizes[t]=s+1;else if(s===this._BIG_LIST){const n=this._buffer[i];this._bigLists[n].push(e)}else{const n=new Array(this._MAX_LIST_SIZE);for(let r=0;r<this._MAX_LIST_SIZE;++r)n[r]=this._buffer[i+r];n.push(e),this._bigLists.push(n),this._sizes[t]=this._BIG_LIST,this._buffer[i]=this._bigLists.length-1}return this}removeFrom(t,e){return this.removeFromAndGetSize(t,e),this}removeFromAndGetSize(t,e){const s=this._MAX_LIST_SIZE*t;let i=this._sizes[t];if(i<=this._MAX_LIST_SIZE){for(let n=s,r=s+i;n<r;++n)if(this._buffer[n]===e)return i-=1,this._buffer[n]=this._buffer[r-1],this._sizes[t]=i,i}else if(i===this._BIG_LIST){const n=this._buffer[s],r=this._bigLists[n],o=r.indexOf(e);if(o!==-1)return r.splice(o,1),r.length}throw new Error('topology: Table: "removeFrom" failed, should not happen')}reserve(t){return this._capacity<t&&this._reserve(t),this}_reserve(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=zm(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=zm(this._sizes,this._capacity)}};function zm(t,e){const s=new t.constructor(e);return s.set(t),s}var jn=void 0,PT=class{constructor(t){this._neighborTable=new pu,this._parallelTable=new pu,this._parallelEdgesIndex=[],this._hasParallelEdges=new Set,this._fakeDeduper={get:()=>0,set:ae,reset(){return this}},this._fakeInvertedDeduper={get:()=>1,set:ae,reset(){return this}},this._graph=t,this.nodeDeduper=t.createNodeAttribute({storage:1},!1),this.edgeDeduper=t.createEdgeAttribute({storage:1},!1),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target")}getAdjacentDirections(t){return this._neighborTable.get(t)}getEdgeIndexesInDirection(t){return this._parallelTable.get(t)}allocateNodes(t){this._neighborTable.reserve(t.length);for(let e=0;e<t.length;++e)this._neighborTable.addEntry(t[e])}allocateEdges(t,e,s){this._parallelTable.reserve(Math.floor(t.length/2));for(let i=0;i<t.length;i++){const n=t[i],r=e[i],o=s[i];this._sourceList.set(n,r),this._targetList.set(n,o),this.addToAdjacencyList(n)}}getExtremity(t,e){const s=t?this._sourceList:this._targetList;if(e.isList){const i=this._graph.acquireIndexList(!0);for(let n=0;n<e._indexes.length;n++)i.push(s.get(e._indexes[n]));return this._graph.nodeList(i.sliceAndReset())}return this._graph.getObjectList(!0).get(s.get(e._index))}setExtremities(t,e,s){for(let i=0;i<t.length;++i)this.removeFromAdjacencyList(t[i]);e!==null&&this._sourceList.setMultiple(t,e),s!==null&&this._targetList.setMultiple(t,s);for(let i=0;i<t.length;++i)this.addToAdjacencyList(t[i])}addToAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Br(e,s);let n=this._parallelEdgesIndex[i];if(n===jn)n=this._parallelTable.addEntry(),this._parallelEdgesIndex[i]=n,this._neighborTable.addTo(e,n),e!==s&&this._neighborTable.addTo(s,n);else{this._hasParallelEdges.add(t);const r=this._parallelTable.get(+n);if(r)for(const o of r)this._hasParallelEdges.add(o)}this._parallelTable.addTo(n,t)}hasParallelEdges(t){return this._hasParallelEdges.has(t)}removeFromAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Br(e,s),n=this._parallelEdgesIndex[i];n!==jn&&this._parallelTable.removeFromAndGetSize(n,t)===0&&(this._neighborTable.removeFrom(e,n),e!==s&&this._neighborTable.removeFrom(s,n),this._parallelEdgesIndex[i]=jn,this._hasParallelEdges.delete(t))}getParallelEdges(t,e={}){const s=e.filter||"visible",i=this._graph.acquireIndexList(!1),n=this._graph.getFilter(!1,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r],a=Br(this._sourceList.get(o),this._targetList.get(o)),l=this._parallelEdgesIndex[a];if(l!==jn){const d=this._parallelTable.get(+l);if(d)for(const h of d)n(h)&&i.push(h)}}return this._graph.edgeList(i.sliceAndReset())}fastGetNodesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=this._neighborTable.get(o);for(const l of a){const d=this._parallelTable.get(l),h=d[0],u=i.get(h),c=n.get(h);if(u!==0&&c!==0){e.push(u+c-o);for(const g of d)s.push(g)}}}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}fastGetEdgesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=i.get(o),l=n.get(o),d=Br(a,l),h=this._parallelEdgesIndex[d];if(h!==jn){const u=this._parallelTable.get(+h);if(u)for(const c of u)s.push(c)}e.push(a),e.push(l)}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}getDeduper(t){return(t?this.nodeDeduper:this.edgeDeduper).reset()}collectAdjacentEdges(t,e,s,i=!1,n=!1){const r=e===Ia,o=!(e===Ma||r||n),a=this._graph.acquireIndexList(!1),l=this._graph.getFilter(!1,s),d=i?this.getDeduper(!1):this._fakeDeduper;let h=this._fakeInvertedDeduper;const u=this._sourceList,c=this._targetList;if(n){h=this.getDeduper(!0);for(let g=0;g<t.length;g++)h.set(t[g],1)}for(let g=0;g<t.length;g++){const m=t[g],f=this._neighborTable.get(m);for(const p of f){const _=this._parallelTable.get(p);if(o)for(const x of _)l(x)&&d.get(x)===0&&(a.push(x),d.set(x,1));else for(const x of _){const y=u.get(x),b=c.get(x),v=y+b-m;r!==(b===m)&&y!==b||!l(x)||d.get(x)!==0||h.get(v)!==1||(a.push(x),d.set(x,1))}}}return a.sliceAndReset()}collectAdjacentNodes(t,e,s,i=!1,n,r){const o=e!==Ia,a=e!==Ma,l=this._graph.acquireIndexList(!0),d=this._graph.getFilter(!1,s),h=i?this.getDeduper(!0):this._fakeDeduper,u=this._sourceList,c=this._targetList;if(n)for(let g=0;g<n.length;g++){const m=n[g];l.push(m),h.set(m,1)}if(r)for(let g=0;g<r.length;g++){const m=r[g];h.set(m,1)}for(let g=0;g<t.length;g++){const m=t[g],f=this._neighborTable.get(m);for(const p of f){const _=this._parallelTable.get(p);for(const x of _)if(d(x)){const y=u.get(x),b=c.get(x),v=y+b-m;if((a&&m===b||o&&m===y)&&h.get(v)===0){l.push(v),h.set(v,1);break}}}}return l.sliceAndReset()}getAdjacentElements(t,e,s={}){const i=s.direction||eh,n=s.filter||"visible",r=s.policy||"union",o=!!s.bothExtremities;if(t){const a=r==="include-sources"?e:null,l=r==="exclude-sources"?e:null;return this.collectAdjacentNodes(e,i,n,!0,a,l)}return this.collectAdjacentEdges(e,i,n,!0,o)}getEdgesBetweenTwoNodes(t,e){const s=Br(t,e),i=this._parallelEdgesIndex[s];if(i===jn)return new Uint32Array;const n=this._parallelTable.get(+i);return new Uint32Array(n)}getConnectedComponents(t,{filter:e="visible",returnIds:s=!1,internalIndexes:i=!1}={}){const n=this._graph,r=[],o={},a=n.acquireIndexList(!0);let l;typeof e=="string"?l=n.getFilter(!0,e):(l=e,e="visible");for(let u=0;u<t.length;u++){const c=t[u];l(c)&&a.push(c)}const d=a.sliceAndReset(),h={filter:e};for(let u=0;u<d.length;u++){const c=d[u];if(!o[c]){const g=[c],m=[];for(;g.length!==0;){const f=g.pop();!o[f]&&l(f)&&(g.push.apply(g,this.getAdjacentElements(!0,new Uint32Array([f]),h)),o[f]=!0,m.push(f))}m.length>0&&r.push(m)}}if(s){const u=n.getNodeAttribute("id");for(let c=0;c<r.length;c++)r[c]=u.getMultiple(r[c])}else if(!i)for(let u=0;u<r.length;u++)r[u]=n.nodeList(new Uint32Array(r[u]));return r}getAdjacencyList({directed:t,ids:e,weight:s,nodes:i}){const n=t?Ma:eh,r=new Array(i.length),o=this._graph;for(let m=0;m<i.length;++m)r[m]=this.collectAdjacentEdges(new Uint32Array([i[m]]),n,"all");const a=o.getEdgeAttribute("source"),l=o.getEdgeAttribute("target"),d=o.getEdgeAttribute("width"),h=o.getNodeAttribute("id"),u=[],c=typeof s=="number",g=typeof s!="function"&&!c&&!!s;for(let m=0;m<r.length;m++){const f=r[m],p=i[m],_=f.length,x=e?new Array(_):new Uint32Array(_),y=new Array(_);for(let v=0;v<_;v++){const A=f[v],S=a.get(A),w=l.get(A);let I=t||p===S?w:S;if(e&&(I=h.get(I)),x[v]=I,s){if(c&&(y[v]=s),typeof s=="function"){const M=o.getNode(S),N=o.getNode(w);y[v]=s(M,N)}g&&(y[v]=d.get(A)||1)}}const b={nodes:x,id:e?h.get(p):p,...s&&{weights:y}};u.push(b)}return u}degrees(t,e){if(e!==Ia&&e!==Ma)return this._neighborTable.sizes(t);const s=new Array(t.length),i=e===Ia;for(let n=0,r=t.length;n<r;n++)s[n]=this._degree(t[n],i);return s}_degree(t,e){const s=this._neighborTable.get(t),i=this._sourceList,n=this._targetList;let r=0;for(let o=0;o<s.length;++o){const a=this._parallelTable.get(s[o]);for(let l=0;l<a.length;++l){const d=a[l],h=i.get(d),u=n.get(d);if(e&&u===t||!e&&h===t){r+=1;break}}}return r}getDegree(t,e){const{direction:s,filter:i}=this._getDegreeOptions(e),n=new Array(t.length),r=new Uint32Array(1);for(let o=0;o<t.length;++o)r[0]=t[o],n[o]=this.collectAdjacentNodes(r,s,i).length;return n}_getDegreeOptions(t){const e={direction:eh,filter:"visible"};return typeof t=="string"?e.direction=t:t&&(typeof t.direction=="string"&&(e.direction=t.direction),typeof t.filter=="string"&&(e.filter=t.filter)),e}},zT=class extends te{constructor(){super(...arguments),this.storage={nodes:new Nm(!0),edges:new Nm(!1),fetch(t){return t?this.nodes:this.edges}},this._promisesToResolve=[],this._nodeIndexLists=[],this._edgeIndexLists=[],this._onNewFrame=()=>{this.storage.nodes.freeIndexes(),this.storage.edges.freeIndexes()}}onMounted(){this._modules.events.register(["preAddElements","postAddElements","addNodes","addEdges","preAddGraph","postAddGraph","addGraph","excludedStateChange","clearGraph","afterRemoveNodes","beforeRemoveNodes","requestElementsToDelete","removeNodes","beforeRemoveEdges","afterRemoveEdges","removeEdges"]),[{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}].forEach((t=>{this.createNodeAttribute(t,!0),this.createEdgeAttribute(t,!0)})),this.node=this._ogma.node,this.edge=this._ogma.edge,this.nodeList=this._ogma.nodeList,this.edgeList=this._ogma.edgeList,this._nodes=this.createAttribute(!0,{name:"object",storage:"any"},!0),this._edges=this.createAttribute(!1,{name:"object",storage:"any"},!0),this.createAttribute(!1,{name:"source",storage:32},!0),this.createAttribute(!1,{name:"target",storage:32},!0),this._nodeFilters=Vg(this.storage.nodes),this._edgeFilters=Vg(this.storage.edges),this._initialize(),this._modules.events.on("frame",this._onNewFrame)}onReady(t){if(t.graph){const{nodes:e,edges:s}=t.graph;e&&this.addNodes(e),s&&this.addEdges(s)}}createIndexList(t){return this.storage.fetch(t).createIndexList()}getDom(){return this._modules.dom}acquireIndexList(t){const e=t?this._nodeIndexLists:this._edgeIndexLists;let s=e.find((i=>!i.isBusy()));return s||(s=this.createIndexList(t),e.push(s)),s.markBusy(),s}getObjectList(t){return t?this._nodes:this._edges}getListFactory(t){return t?this.nodeList:this.edgeList}getStorage(t){return t?this.storage.nodes:this.storage.edges}getFilter(t,e){const s=t?this._nodeFilters:this._edgeFilters;return s[e]||s.visible}fireEvent(t,e){this._modules.events.fire(t,e)}getCacheLists(t){return t?this._nodeCacheLists:this._edgeCacheLists}_resolvePromises(){const t=this._promisesToResolve;this._promisesToResolve=[],t.forEach((e=>e()))}_initialize(){this._nodeCacheLists=qg((()=>this.getNodeMaxIndex()),(()=>this.acquireIndexList(!0)),this._nodeFilters),this._edgeCacheLists=qg((()=>this.getEdgeMaxIndex()),(()=>this.acquireIndexList(!1)),this._edgeFilters),this.topology=new PT(this),this._resolvePromises()}getNodeMaxIndex(){return this.storage.nodes.getMaxIndex()}getEdgeMaxIndex(){return this.storage.edges.getMaxIndex()}isExcluded(t){return this.storage.fetch(t.isNode).getFlexArray("excluded").getMultiple(t._indexes)}setExcluded(t,e){const s=e?1:0,i=t.isNode,n=this.storage.fetch(i),r=n.getFlexArray("excluded"),o=n.getFlexArray("removed"),a=this.acquireIndexList(i),l=this.getListFactory(i);for(let h=0;h<t._indexes.length;h++){const u=t._indexes[h],c=r.get(u),g=o.get(u);s!==c&&g===0&&a.push(u)}const d=a.sliceAndReset();if(d.length){this.getCacheLists(t.isNode).visible.invalidList();const h=l(d);r.setMultiple(d,s),this._modules.events.fire("excludedStateChange",{elements:h,value:e})}}addNode(t,e){return Rm(this,!0,t,e)}addEdge(t,e){return Rm(this,!1,t,e)}addNodes(t,e){return Wl(this,!0,t,e)}addEdges(t,e){return Wl(this,!1,t,e)}addGraph(t,e){return ET(this,t,e)}getExtremityIndex(t,e,s,i){if(e instanceof si)return e._index;{const n=this.storage.nodes.getIndex(e);if(!n&&!i)throw new Error(`addEdge(s): invalid ${s===0?"source":"target"} for edge "${t}"; node "${e}" does not exist`);return n}}getNodes(t){return this.getElements(!0,t)}getEdges(t){return this.getElements(!1,t)}getElements(t,e){const s=t?this.nodeList:this.edgeList,i=t?Pi:Un,n=t?si:nn;if(e&&typeof e!="string"){const r=this.acquireIndexList(t),o=this.storage.fetch(t);if(e instanceof n)r.push(e._index);else if(as(e)){const a=e;for(const l of a)if(l instanceof n)r.push(l._index);else{const d=o.getIndex(l);d&&r.push(d)}}else if(e instanceof i){const a=this.getFilter(t,"all"),l=e;for(let d=0;d<l._indexes.length;d++){const h=l._indexes[d];a(h)&&r.push(h)}}return s(r.sliceAndReset())}{const r=e||"visible",o=this.getCacheLists(t)[r];if(!o)throw new Error(`getNodes/getEdges: unexpected argument "${r}"`);return s(o.getList())}}getNode(t){return this._getElement(!0,t)}getEdge(t){return this._getElement(!1,t)}_getElement(t,e){if(e instanceof(t?si:nn))return e;const s=this.getStorage(t),i=this.getObjectList(t),n=s.getIndex(e);return n?i.get(n):void 0}clear(){this._modules.events.fire("clearGraph",{nodes:this.getNodes("all"),edges:this.getEdges("all")}),this.storage.nodes.clear(),this.storage.edges.clear(),this._initialize()}createAttribute(t,e,s=!1){return this.storage.fetch(t).createFlexArray(e,s)}createNodeAttribute(t,e){return this.createAttribute(!0,t,e)}createEdgeAttribute(t,e){return this.createAttribute(!1,t,e)}getAttribute(t,e){return this.storage.fetch(t).getFlexArray(e)}getAttributes(t,e){return e.map((s=>this.getAttribute(t,s)))}getNodeAttribute(t){return this.storage.nodes.getFlexArray(t)}getNodeAttributes(t){return this.getAttributes(!0,t)}getEdgeAttribute(t){return this.storage.edges.getFlexArray(t)}getEdgeAttributes(t){return this.getAttributes(!1,t)}getAllNodeAttributes(){return this.storage.nodes.getAllFlexArrays()}getAllEdgeAttributes(){return this.storage.edges.getAllFlexArrays()}setSource(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,s._indexes,null)}setTarget(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,null,s._indexes)}getParallelEdges(t,e={}){return this.topology.getParallelEdges(t,e)}hasParallelEdges(t){return this.topology.hasParallelEdges(t._index)}getEdgesBetweenTwoNodes(t,e){return this.edgeList(this.topology.getEdgesBetweenTwoNodes(t._index,e._index))}getAdjacentDirections(t){return this.topology.getAdjacentDirections(t)}getEdgeIndexesInDirection(t){return this.topology.getEdgeIndexesInDirection(t)}fastGetNodesAdjacentElements(t){const e=this._ogma.getNodes();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:e,edges:this._ogma.getEdges()}:this.topology.fastGetNodesAdjacentElements(t._indexes)}fastGetEdgesAdjacentElements(t){const e=this._ogma.getEdges();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:this._ogma.getNodes(),edges:e}:this.topology.fastGetEdgesAdjacentElements(t._indexes)}getAdjacentNodes(t,e){return this.nodeList(this.topology.getAdjacentElements(!0,t._indexes,e))}getAdjacentEdges(t,e){return this.edgeList(this.topology.getAdjacentElements(!1,t._indexes,e))}getDegree(t,e){return this.topology.getDegree(t._indexes,e)}degrees(t,e){return this.topology.degrees(t,e)}getAdjacencyList({directed:t=!1,internalIndexes:e=!1,weight:s=1,nodes:i,indexes:n}={}){return this.topology.getAdjacencyList({directed:t,weight:s,ids:!e,nodes:n||this.getNodes(i)._indexes})}getConnectedComponents(t,e){return this.topology.getConnectedComponents(t._indexes,e)}getConnectedComponentByNode(t,e){return this.topology.getConnectedComponents(t._indexes,e)}},Vc=512,qc=128,u0=Math.round(Math.log2(Vc)),Hc=Math.round(Math.log2(qc)),DT=u0+Hc,hr=255,kT=32767,c0=65535,Na=16384,_u=15,ur=3,$l=15,bl=32,Wi=128,yu=8,xu=1/16,bu=Math.round(Math.sqrt($l+1)),vu=Wi*bu,fs=16,rn=1,Js=256,OT=128,BT=128,Zl=1.5,g0=1,Lr=56,UT=16,GT=2*Lr+UT,vl=6,m0=3,f0=3,Ms=41,Ad=5,Kl=5,p0=.9721,Oo=24,VT=1.4142,qT=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function jc(t,e=[0,0,0,0]){const s=qT.exec(t);return s?(e[0]=parseInt(s[1])/255,e[1]=parseInt(s[2])/255,e[2]=parseInt(s[3])/255,e[3]=s[4]===void 0?1:parseFloat(s[4]),e):null}function El(t){return t<16?"0"+t.toString(16):t.toString(16)}function _0([t,e,s,i=1]){return`rgba(${256*t|0},${256*e|0},${256*s|0},${i})`}function Yc(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((s,i,n,r)=>i+i+n+n+r+r));const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255,1]:null}var sh=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"],Ur=[0,0,0,0],Bo=new Map;Bo.set(null,[0,0,0,0]),Bo.set("transparent",[0,0,0,0]);for(let t=0;t<sh.length;t+=2){const e=sh[t].toLowerCase(),s=sh[t+1];Bo.set(e,Yc(s))}var ys=t=>{let e=Bo.get(t);if(e===void 0){const s=t+"",i=s.charAt(0)==="#"?Yc(s):jc(s);Bo.set(t,i),e=i}return e},Eu=t=>{const e=ys(t);if(!e)return null;const[s,i,n]=e;return`#${El(255*s)}${El(255*i)}${El(255*n)}`},er=t=>{let e=1,s=t;return s&&jc(t,Ur)&&(s=`rgb(${255*+Ur[0]},${255*+Ur[1]},${255*+Ur[2]})`,e=parseFloat(Ur[3].toString())),{color:s,opacity:e}},la=class{on(e,s){if(typeof e!="string")throw new TypeError("Event name must be string");if(typeof s!="function")throw new TypeError("Event handler must be function");const i=this._events=this._events||{};return(i[e]=i[e]||[]).push(s),this}off(e,s){if(typeof e!="string")throw new TypeError("Event name must be string");const i=this._events=this._events||{},n=i[e];if(as(n))if(typeof s!="function")i[e]=null;else{const r=n.indexOf(s);r!==-1&&n.splice(r,1),n.length===0&&(i[e]=null)}return this}fire(e,...s){if(typeof e!="string")throw new TypeError("Event name must be string");const i=(this._events=this._events||{})[e];if(as(i)){const n=s;for(let r=0;r<i.length;r++){const o=i[r];o&&o.apply(this,n)}}return this}once(e,s){const i=this,n=function(...r){s.apply(i,r),i.off(e,n)};return n.handler=s,this.on(e,n)}hasListener(e,s){if(!e||!s)return!1;const i=(this._events=this._events||{})[e];if(as(i))for(let n=0,r=i.length;n<r;n++){const o=i[n];if(o===s||o.handler===s)return!0}return!1}clearEvents(){this._events={}}getListeners(e){return(this._events=this._events||{})[e]}};function y0(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach(((s,i)=>e.push(i))),e}function x0(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach((s=>e.push(s))),e}var b0=class{constructor(){this._map=new Map}reset(){this._map.clear()}set(t,e,s){this._map.set(Pm(t,e),s)}get(t,e){return this._map.get(Pm(t,e))}},HT=class{constructor({elementSize:t,sideElementSize:e,nbSideElementsPerMainElement:s,id:i,depth:n,elementType:r,animated:o,stencilUsage:a}){this._nbCellsAllocated=0,this._nbCellsFreed=0,this._isFullyAllocated=!1,this._isFullyFreed=!1,this._mustUpdate=!0,this._capacity=Vc,this.version=0,this._id=i,this.depth=n,this.type=r,this.animated=o,this.stencilUsage=a,this.elementSize=t,this._nbSideElementsPerMainElement=s,this._totalSideElementsSize=s*e,this._byteCapacity=this._capacity*this.elementSize,this._byteArray=new Uint8Array(this._byteCapacity),this._dataView=new DataView(this._byteArray.buffer),this._sideByteCapacity=this._capacity*this._totalSideElementsSize,this._sideByteArray=new Uint8Array(this._sideByteCapacity),this._sideDataView=new DataView(this._sideByteArray.buffer)}update(){this._mustUpdate&&(this.version+=1,this._mustUpdate=!1,this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated&&(this._isFullyFreed=!0))}allocate(t){let e=-1;return!this._isFullyAllocated&&this._nbCellsAllocated+t<=this._capacity?(e=this._nbCellsAllocated,this._nbCellsAllocated+=t,this._mustUpdate=!0):this._isFullyAllocated=!0,e}free(t,e){for(let s=0;s<e;s++){const i=(t+s)*this.elementSize;this._dataView.setUint16(i,0)}this._mustUpdate=!0,this._nbCellsFreed+=e}triggerUpdate(){this._mustUpdate=!0}isEmpty(){return this._nbCellsFreed===this._nbCellsAllocated}isFullyFreed(){return this._isFullyFreed}getId(){return this._id}getDataView(){return this._dataView}getByteArray(){return this._byteArray}getSize(){return this._nbCellsAllocated}getNbSideElementsPerMainElement(){return this._nbSideElementsPerMainElement}hasSideData(){return this._nbSideElementsPerMainElement>0}getSideDataView(){return this._sideDataView}getSideByteArray(){return this._sideByteArray}getTotalSideElementsSize(){return this._totalSideElementsSize}},Dm=8,jT=class{constructor(){this.version=0,this.version=0,this._blockInfo={buffer:null,offset:0,size:0,address:0},this._init_()}reset(){this._init_()}_init_(){this._buffersByDepth=new Array(100),this._buffersById=[],this._buffersByAscendingDepth=[],this._buffersByDescendingDepth=[],this._mustUpdate=!0}_fillBlockInfo(t,e,s,i){return this._blockInfo.buffer=t,this._blockInfo.offset=e,this._blockInfo.size=s,this._blockInfo.address=i,this._blockInfo}_createBuffer(t,e,s,i,n){const r=e?GT:Lr,o=this._buffersById.length,a=new HT({elementSize:r,sideElementSize:vl,nbSideElementsPerMainElement:i,id:o,depth:s,elementType:t,animated:e,stencilUsage:n});return this._buffersById.push(a),a}getBlockInfo(t){return this._fillBlockInfo(this._buffersById[t>>DT],(t>>Hc)%Vc,t%qc,t)}allocateBlock(t,e,s,i,n,r,o){const a=XT(r,Dm);this._mustUpdate=!0;let l=null,d=-1;if(t){const u=this.getBlockInfo(t),c=u.buffer,g=u.offset,m=u.size,f=u.size===n,p=c.depth===i,_=c.type===e,x=c.animated===s,y=c.getNbSideElementsPerMainElement()===a,b=c.stencilUsage===o;f&&p&&_&&x&&y&&b?(c.triggerUpdate(),l=c,d=g):c.free(g,m)}if(d===-1){const u=+s,c=a/Dm,g=this._buffersByDepth[i]||Array(2);this._buffersByDepth[i]=g;const m=g[u]||[];g[u]=m;const f=m[e]||Array(16);m[e]=f;const p=f[c]||Array(4);f[c]=p;const _=p[o]||[];p[o]=_;const x=_[_.length-1];x&&(l=x,d=x.allocate(n)),d===-1&&(l=this._createBuffer(e,s,i,a,o),d=l.allocate(n),_.push(l))}const h=YT(l.getId(),d,n);return this._fillBlockInfo(l,d,n,h)}freeBlock(t){if(t){this._mustUpdate=!0;const e=this.getBlockInfo(t);e.buffer.free(e.offset,e.size)}return 0}_sortBuffersByDepth(){const t=[];for(let e=0;e<this._buffersByDepth.length;e++){const s=this._buffersByDepth[e];if(s)for(let i=0;i<s.length;i++){const n=s[i];if(n)for(let r=0;r<n.length;r++){const o=n[r];if(o)for(let a=0;a<o.length;a++){const l=o[a];if(l)for(let d=0;d<l.length;d++){const h=l[d];if(h)for(let u=0;u<h.length;u++){const c=h[u];c.update(),c.isFullyFreed()?(this._buffersById[c.getId()]=void 0,h.splice(u,1),u-=1):t.push(c)}}}}}}this._buffersByAscendingDepth=t,this._buffersByDescendingDepth=t.slice().reverse()}update(){this._mustUpdate&&(this._sortBuffersByDepth(),this.version+=1,this._mustUpdate=!1)}getBuffers(){return this._buffersById}getBuffersByAscendingDepth(){return this._buffersByAscendingDepth}getBuffersByDescendingDepth(){return this._buffersByDescendingDepth}};function YT(t,e,s){return((t<<u0)+e<<Hc)+s}function XT(t,e){let s=0;for(;s<t;)s+=e;return s}var ei=1,Mn=2,Ql=3,xs=1,en=2,Sn=3,da=4,Nn=5,Rn=6,on=7,$s=1,Sd=2,Xc=3,Wc=4,_n=5,wn=6,xr=1,v0=2,E0=3;function km(){return{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:xs,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,bentEnable:!1,bentVertical:!1}}function Om(t={}){return t.pieceId=0,t.shape="",t.x1=0,t.y1=0,t.x2=0,t.y2=0,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=0,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=0,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern=t.pattern||{type:xs,attributes:{}},t.pattern.type=xs,t.opacity=1,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1,t.isSelfLoop=!1,t.isText=!1,t.adjustTextAngle=!1,t.isBadge=!1,t.bentEnable=!1,t.bentVertical=!1,t}function WT(t={}){return t.duration=0,t.beginTime=-1,t.easing="linear",t}function $c(){return{valid:!1,id:void 0,end:km(),start:km(),animation:{duration:0,beginTime:-1,easing:"linear"}}}function A0(t,e,s,i){t.width=e*i,t.height=s*i,Bn(t,`${e}px`,`${s}px`)}function $T(t){return 1/(1+Math.exp(-t))}var ZT=class{constructor(){this._capacity=qc,this._id=0,this.size=0,this.depth=0,this.animated=!1,this.stencilUsage=xr,this.type=ei,this._list=Array(this._capacity);for(let t=0;t<this._capacity;++t)this._list[t]=$c()}reset(t,e,s,i){return this.type=t,this.animated=e,this.depth=s,i!==void 0&&(this._id=i),this.stencilUsage=xr,this.size=0,this}next(){if(this.size>=this._capacity)throw new Error("internal error: block.next() was called on a full block");return this._list[this.size++]}nextAndReset(){const t=this.next();return t.end=Om(t.end),t.start=Om(t.start),t.animation=WT(t.animation),t}forEach(t){this._list.forEach(t)}getElement(t){return this._list[t]}getCurrentElement(){return this._list[this.size-1]}getElements(){return this._list}getId(){return this._id}setGlobalAnimation(t,e,s){for(let i=0;i<this.size;++i){const n=this._list[i].animation;n.duration=t,n.beginTime=e,n.easing=s}}},KT=class{constructor(){this._version=0,this._initialize()}reset(){this._initialize()}_initialize(){this._mustUpdate=!0,this.maxCoord=0,this.maxScaledSize=0,this.maxMinVisibleSize=0,this.maxSymbolicSize=0,this.maxDashLength=0,this.maxGapLength=0,this.maxPatternScale=0}set({maxCoord:t,maxScaledSize:e,maxMinVisibleSize:s,maxSymbolicSize:i,maxDashLength:n,maxGapLength:r,maxPatternScale:o}){const a=this.maxCoord<t||this.maxScaledSize<e||this.maxMinVisibleSize<s||this.maxSymbolicSize<i||this.maxDashLength<n||this.maxGapLength<r||this.maxPatternScale<o;return a&&(this.maxCoord=t,this.maxScaledSize=e,this.maxMinVisibleSize=s,this.maxSymbolicSize=i,this.maxDashLength=n,this.maxGapLength=r,this.maxPatternScale=o,this._mustUpdate=!0),a}update(){return this._mustUpdate&&(this._version+=1,this._mustUpdate=!1),this}getVersion(){return this._version}},QT={linear:[0,1,0,0],quadraticIn:[0,0,1,0],quadraticOut:[0,2,-1,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]},JT=class{constructor(){this._linearEasing=[0,1,0,0,0,1,0,0],this._nameToPolygon={},this._polygonToName={},this.add(QT)}add(t){Object.keys(t).forEach((e=>{const s=t[e].slice();s.length<8&&(s[4]=s[0],s[5]=s[1],s[6]=s[2],s[7]=s[3]);const i=Xh(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);this._nameToPolygon[e]=s,this._polygonToName[i]=e}))}getCoefficients(t){return this._nameToPolygon[t]||this._linearEasing}getName(t,e,s,i,n,r,o,a){const l=Xh(t,e,s,i,n,r,o,a);return this._polygonToName[l]||"linear"}},Zc=new JT;function wd(t){return typeof t=="number"&&isFinite(t)}var t2=t=>{if(t===0)return 0;if(isNaN(t))return 32256;if(!isFinite(t))return t>0?31744:64512;const e=t<0?32768:0;if((t=Math.abs(t))<6103515625e-14)return e|Math.round(4096*t);if(t>65504)return 31744|e;let s=Math.floor(Math.log2(t)),i=Math.round(1024*(t/Math.pow(2,s)-1));return i===1024&&(i=0,s++),e|s+15<<10|i},Bm=t=>{const e=32768&t?-1:1,s=t>>10&31,i=1023&t;return s===0?i===0?0*e:e*Math.pow(2,-14)*(i/1024):s===31?i?NaN:e*(1/0):e*Math.pow(2,s-15)*(1+i/1024)},e2=0,s2=1,i2=2,n2=3,r2=4,o2=5,a2=6,l2=7,d2=8,h2=9,Td=10,u2=0,S0=1,w0=2,Kc=30,T0=0,c2=1,g2=2,Qc=3,m2=4,f2=5,Jc=6,Cd=1e-6,Ys=Math.PI,vo=2*Math.PI,C0=Ys*(5/4),L0=Ys*(7/4),I0=Ys*(3/4),M0=Ys*(1/4),Um=1.1,Gm=.07,p2=1,Vm=1,qm=.17,_2=1,y2=-Ys/2,x2=Ys/2,b2={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}},v2={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0},E2={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0},Yn=8,A2=class{constructor(t,e,s,i,n){this._littleEndian=hd(),this._maxScaledSize=0,this._maxMinVisibleSize=0,this._maxSymbolicSize=0,this._maxDashLength=0,this._maxGapLength=0,this._maxPatternScale=0,this._actualScaledSizeToBytes=kT,this._actualMinVisibleSizeToBytes=_u,this._actualSymbolicSizeToBytes=hr,this._actualDashLengthToBytes=ur,this._actualGapLengthToBytes=ur,this._actualPatternScaleToBytes=hr,this._genericObject=$c(),this._shapeManager=e,this._patternManager=t,this._textManager=s,this._bufferOffsetToId=i,this._colorParser=n}resizeBoundaries(t,e,s,i,n,r){this._maxScaledSize=t,this._maxMinVisibleSize=e,this._maxSymbolicSize=s,this._maxDashLength=i,this._maxGapLength=n,this._maxPatternScale=r,this._actualScaledSizeToBytes=c0/t,this._actualMinVisibleSizeToBytes=_u/e,this._actualSymbolicSizeToBytes=hr/s,this._actualDashLengthToBytes=ur/i,this._actualGapLengthToBytes=ur/n,this._actualPatternScaleToBytes=hr/r}storeGenericObject(t,e,s){const i=this._shapeManager.getIdFromName(s.shape),n=s.pieceId,r=this._dashLengthToBytes(s.dashLength),o=this._gapLengthToBytes(s.gapLength),a=+s.hasHead,l=+s.hasTail,d=+s.isBodyTriangle,h=+s.isSelfLoop,u=this._patternScaleToBytes(s.patternScale),c=this._offsetAngleToBytes(s.offsetAngle),g=+s.isText,m=+s.adjustTextAngle,f=+s.isBadge,p=+s.bentEnable,_=+s.bentVertical,x=this._opacityToBytes(s.opacity),y=this._minVisibleSizeToBytes(s.globalMinVisibleSize),b=this._minVisibleSizeToBytes(s.strokeMinVisibleSize),v=this._minVisibleSizeToBytes(s.patternMinVisibleSize),A=this._symbolicSizeToBytes(s.symbolicSize),S=this._curvatureToBytes(s.curvature),w=s.pattern.attributes.colors;w&&(s.pattern.attributes.colors=w.split(";").map((qt=>Ra(this._colorToBytes(qt.trim())))).join(";"));const I=this._patternManager.getIdFromDefinition(s.pattern),M=this._colorToBytes(s.fillColor),N=this._colorToBytes(s.strokeColor),D=this._colorToBytes(s.patternColor),{x1:q,y1:et,x2:O,y2:K}=s,j=this._fixedSizeToBytes(s.rectWidthOrSourceRadiusFixed),ot=this._fixedSizeToBytes(s.rectHeightOrTargetRadiusFixed),it=this._scaledSizeToBytes(s.thicknessOrFontSizeScaled),ct=this._fixedSizeToBytes(s.thicknessOrFontSizeFixed),pt=this._scaledSizeToBytes(s.strokeWidthScaled),Pt=this._fixedSizeToBytes(s.strokeWidthFixed),At=this._scaledSizeToBytes(s.offsetScaled),bt=this._fixedSizeToBytes(s.offsetFixed),It=this._fixedSizeToBytes(s.pattern.attributes.paddingTop||0),Ut=this._fixedSizeToBytes(s.pattern.attributes.paddingLeft||0),Gt=i+(n<<4)+(r<<8)+(o<<10)+(a<<12)+(l<<13)+(d<<14)+(h<<15),Dt=u+(c<<8)+(g<<11)+(m<<12)+(f<<13)+(p<<14)+(_<<15),Rt=x+(y<<4)+(b<<8)+(v<<12),Tt=A+(S<<8),Nt=s.rectWidthOrSourceRadiusScaled/this._maxScaledSize*Na,Ht=s.rectHeightOrTargetRadiusScaled/this._maxScaledSize*Na;this._setUint16(t,e+0,Gt),this._setUint16(t,e+2,Dt),this._setUint16(t,e+4,Rt),this._setUint16(t,e+6,Tt),this._setUint16(t,e+8,I),this._setUint16(t,e+10,M),this._setUint16(t,e+12,N),this._setUint16(t,e+14,D),this._setFloat32(t,e+16,q),this._setFloat32(t,e+20,et),this._setFloat32(t,e+24,O),this._setFloat32(t,e+28,K),this._setFloat16(t,e+32,Nt),this._setUint16(t,e+34,j),this._setFloat16(t,e+36,Ht),this._setUint16(t,e+38,ot),this._setUint16(t,e+40,it),this._setUint16(t,e+42,ct),this._setUint16(t,e+44,pt),this._setUint16(t,e+46,Pt),this._setUint16(t,e+48,At),this._setInt16(t,e+50,bt),this._setInt16(t,e+52,It),this._setInt16(t,e+54,Ut)}_setUint16(t,e,s){t.setUint16(e,s,this._littleEndian)}_setFloat16(t,e,s){t.setUint16(e,t2(s),this._littleEndian)}_setInt16(t,e,s){t.setUint16(e,this._signedToUnsignedInt16(s),this._littleEndian)}_setFloat32(t,e,s){t.setFloat32(e,s,this._littleEndian)}_colorToBytes(t){const e=this._colorParser(t);return Math.round(15*e[0])+(Math.round(15*e[1])<<4)+(Math.round(15*e[2])<<8)+(Math.round(15*e[3])<<12)}_scaledSizeToBytes(t){return Math.ceil(Math.min(t,this._maxScaledSize)*this._actualScaledSizeToBytes)}_fixedSizeToBytes(t){return t}_minVisibleSizeToBytes(t){return Math.round(Math.min(t,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)}_symbolicSizeToBytes(t){return Math.round(Math.min(t,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)}_dashLengthToBytes(t){return Math.round(Math.min(t,this._maxDashLength)*this._actualDashLengthToBytes)}_gapLengthToBytes(t){return Math.round(Math.min(t,this._maxGapLength)*this._actualGapLengthToBytes)}_patternScaleToBytes(t){return Math.round(Math.min(t,this._maxPatternScale)*this._actualPatternScaleToBytes)}_offsetAngleToBytes(t){return Math.round((t+vo)%vo*(8/vo))}_opacityToBytes(t){return Math.round(15*Math.min(t,1))}_curvatureToBytes(t){return this._signedToUnsignedByte(t)}_signedToUnsignedByte(t){return Ws(t,-128,127)+128}_signedToUnsignedInt16(t){return Ws(t,-32768,32767)+32768}storeAnimationInformation(t,e,{beginTime:s,duration:i},n){this._setAnimationBeginTime(t,e,s),this._setAnimationDuration(t,e,i),this._setAnimationEasing(t,e,n)}_setAnimationBeginTime(t,e,s){this._setFloat32(t,e,s)}_setAnimationDuration(t,e,s){this._setFloat32(t,e+4,s)}_setAnimationEasing(t,e,s){this._setUint16(t,e+8,(s[0]+128<<8)+(s[4]+128)),this._setUint16(t,e+10,(s[1]+128<<8)+(s[5]+128)),this._setUint16(t,e+12,(s[2]+128<<8)+(s[6]+128)),this._setUint16(t,e+14,(s[3]+128<<8)+(s[7]+128))}extractGenericElement(t,e,s){const i=t.type,n=t.animated,r=t.getDataView(),o=e*t.elementSize,a=this._genericObject;if(a.valid=!1,r.getUint16(o)&&(a.valid=!0,this._extractGenericObject(a.end,r,o,s),n&&(this._extractGenericObject(a.start,r,o+Lr,s),this._extractAnimationInformation(a.animation,r,o+2*Lr)),a.id=this._bufferOffsetToId.get(t.getId(),e),i===Mn)){const l=t.getSideDataView(),d=e*t.getTotalSideElementsSize(),h=d+t.getTotalSideElementsSize();a.end.pattern=this._textManager.extractTextFromDataView(l,d,h)}return a}_extractGenericObject(t,e,s,{bytesToActualCoord:i,bytesToActualScaledSize:n,bytesToActualMinVisibleSize:r,bytesToActualPatternScale:o,bytesToActualSymbolicSize:a,bytesToActualDashLength:l,bytesToActualGapLength:d}){const h=e,u=s,c=this._littleEndian,g=h.getUint16(u,c),m=Me(g,0,4),f=Me(g,4,8),p=Me(g,8,10),_=Me(g,10,12),x=Me(g,12,13),y=Me(g,13,14),b=Me(g,14,15),v=Me(g,15,16),A=h.getUint16(u+2,c),S=Me(A,0,8),w=Me(A,8,11),I=Me(A,11,12),M=Me(A,12,13),N=Me(A,13,14),D=Me(A,14,15),q=Me(A,15,16),et=h.getUint16(u+4,c),O=Me(et,0,4),K=Me(et,4,8),j=Me(et,8,12),ot=Me(et,12,16),it=h.getUint16(u+6,c),ct=Me(it,0,8),pt=Me(it,8,16),Pt=h.getUint16(u+8,c),At=h.getUint16(u+10,c),bt=h.getUint16(u+12,c),It=h.getUint16(u+14,c),Ut=h.getFloat32(u+16,c),Gt=h.getFloat32(u+20,c),Dt=h.getFloat32(u+24,c),Rt=h.getFloat32(u+28,c),Tt=h.getUint16(u+32,c),Nt=h.getUint16(u+34,c),Ht=h.getUint16(u+36,c),qt=h.getUint16(u+38,c),Zt=h.getUint16(u+40,c),Lt=h.getUint16(u+42,c),Kt=h.getUint16(u+44,c),ue=h.getUint16(u+46,c),ne=h.getUint16(u+48,c),se=ih(h.getUint16(u+50,c)),le=ih(h.getUint16(u+52,c)),ge=ih(h.getUint16(u+54,c));t.pieceId=f,t.shape=this._shapeManager.getNameFromId(m),t.x1=di(Ut,i),t.y1=di(Gt,i),t.x2=di(Dt,i),t.y2=di(Rt,i),t.rectWidthOrSourceRadiusScaled=Bm(Tt)*this._maxScaledSize/Na,t.rectWidthOrSourceRadiusFixed=Nt,t.rectHeightOrTargetRadiusScaled=Bm(Ht)*this._maxScaledSize/Na,t.rectHeightOrTargetRadiusFixed=qt,t.thicknessOrFontSizeScaled=di(Zt,n),t.thicknessOrFontSizeFixed=Lt,t.strokeWidthScaled=di(Kt,n),t.strokeWidthFixed=ue,t.offsetScaled=di(ne,n),t.offsetFixed=se,t.pattern=this._patternManager.getDefinitionFromId(Pt),t.pattern.attributes.paddingTop=le,t.pattern.attributes.paddingLeft=ge,t.opacity=O/15,t.fillColor=Ra(At),t.strokeColor=Ra(bt),t.patternColor=Ra(It),t.globalMinVisibleSize=di(K,r),t.strokeMinVisibleSize=di(j,r),t.patternMinVisibleSize=di(ot,r),t.offsetAngle=w*(2*Math.PI/8),t.patternScale=S*o,t.symbolicSize=ct*a,t.curvature=S2(pt),t.dashLength=p*l,t.gapLength=_*d,t.hasHead=!!x,t.hasTail=!!y,t.isBodyTriangle=!!b,t.isSelfLoop=!!v,t.isText=!!I,t.adjustTextAngle=!!M,t.isBadge=!!N,t.bentEnable=!!D,t.bentVertical=!!q}_extractAnimationInformation(t,e,s){const i=this._littleEndian,n=e.getFloat32(s,i),r=e.getFloat32(s+4,i),o=e.getUint16(s+8,i),a=e.getUint16(s+10,i),l=e.getUint16(s+12,i),d=e.getUint16(s+14,i),h=(o>>8)-128,u=(a>>8)-128,c=(l>>8)-128,g=(d>>8)-128,m=o%256-128,f=a%256-128,p=l%256-128,_=d%256-128;t.beginTime=n,t.duration=r,t.easing=Zc.getName(h,u,c,g,m,f,p,_)}};function Me(t,e,s){return t%(1<<s)>>e}function S2(t){return t-128}function ih(t){return t-32768}function di(t,e){return t*e}var Hm=new Array(65535);function Ra(t){let e=Hm[t];if(!e){const s=Me(t,0,4)/15,i=Me(t,4,8)/15,n=Me(t,8,12)/15,r=Me(t,12,16)/15;e=`rgba(${255*s|0}, ${255*i|0}, ${255*n|0}, ${r})`,s+i+n+r===0&&(e=null),Hm[t]=e}return e}var w2={[en]:"image",[da]:"piechart",[Sn]:"text",[Nn]:"icon",[Rn]:"badge"},T2=class{constructor(){this._pixelRatio=1,this._nextPatternId=1,this._version=0,this._init_()}reset(){this._init_()}_init_(){this._mustUpdate=!0,this._nextPatternId=1,this._patterns=[null],this._patternsByHash={},this._pixelRatio=1,this._nullPattern={id:-1,type:xs,attributes:{}}}_increaseNextId(){let t=this._nextPatternId++;for(t%256==255&&(t=this._nextPatternId++);this._patterns.length<=t;)this._patterns.push(void 0);return t}_createPattern({type:t,attributes:e}){const s={id:this._increaseNextId(),type:t,attributes:this._getAttributes(t,e)};return this._patterns[s.id]=s,this._mustUpdate=!0,s}_getAttributes(t,e){return t===en?{image:e.image,scaled:e.scaled,duplicated:e.duplicated}:t===Sn||t===Nn||t===Rn?{font:e.font,size:e.size,style:e.style,text:e.text,paddingLeft:e.paddingLeft,paddingTop:e.paddingTop,align:e.align||"center",offset:e.offset||0}:t===da&&e.colors?{colors:e.colors,colorArray:e.colors.split(";").map((s=>s.trim()))}:{}}getPatternList(){return this._patterns.filter((t=>t))}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}setPixelRatio(t){t!==this._pixelRatio&&(this._pixelRatio=t,this._mustUpdate=!0)}getPixelRatio(){return this._pixelRatio}notifyUpdate(){this._mustUpdate=!0}getIdFromDefinition(t){const{type:e,attributes:s}=t,i=e===Sn||e===Nn||e===Rn;let n=0;return e&&e!==xs&&e!==on&&(e!==en||s.image)&&(!i||s.text&&s.font)&&(n=this._addPattern(t),e===Sn&&s.style==="normal"&&(s.style="bold",this._addPattern(t))),n}_addPattern(t){const e=this._getPatternHash(t);let s=this._patternsByHash[e];return s||(this._nextPatternId>65500?tn("maximum number of pattern exceeded"):(s=this._createPattern(t).id,this._patternsByHash[e]=s)),s}_getPatternHash({type:t,attributes:e}){const s=[w2[t]];return t===en?s.push(e.scaled?"scaled":"non-scaled",e.duplicated?"duplicated":"non-duplicated",e.image.src||e.image.toDataURL()):t===Sn?s.push(e.text,e.font,e.style,e.size,e.align||"center",e.offset||0):t===Nn||t===Rn?s.push(e.text,e.font,e.style,e.size,e.paddingLeft,e.paddingTop):s.push(e.colors),s.join("+")}getDefinitionFromId(t){if(t&&this._patterns[t]){const e=this._patterns[t];if(e)return e}return this._nullPattern}getVersion(){return this._version}};function jm(t){return t.map((({x:e,y:s,r:i=0})=>({x:e,y:s,r:i})))}var C2=class{constructor(){this._version=0,this._mustUpdate=!0,this._byName={},this._byId=new Array($l+1)}register(t,{getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:i,hole:n,isSimple:r}){if(this._byName[t])return;let o=r?1:yu;const a=r?yu-1:$l;for(;this._byId[o];)o+=1;if(o>a)throw new Error("max number of shape exceeded");const l={id:o,name:t,getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:jm(i.slice()),hole:n?jm(n.slice()):null,isSimple:!!r};return this._mustUpdate=!0,this._byId[o]=l,this._byName[t]=l,l}updateShape(t,e){const s=this._byName[t];s&&(delete this._byId[s.id],delete this._byName[t],this.register(t,e))}getIdFromName(t){return this._byName[t].id}getNameFromId(t){const e=this._byId[t];return e?e.name:""}getDefinitionFromName(t){return this._byName[t]}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}getVersion(){return this._version}getShapeList(){return this._byId.filter((t=>t))}},Au=300,Su=150,N0=class{constructor(){this.style={},this.width=Au,this.height=Su,this.__context=new R0,this.style={},this.width=Au,this.height=Su}get __dummy(){return!0}get parentNode(){return null}getContext(t){return t==="2d"?this.__context:null}toDataURL(t="png"){return`data:image/${t};base64,`}addEventListener(){}removeEventListener(){}getBoundingClientRect(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}}},R0=class{constructor(){this._fontSize=10}set font(t){const e=t.match(/\d+/);e&&(this._fontSize=parseFloat(e[0]))}set fillStyle(t){}set textBaseline(t){}set textAlign(t){}set strokeStyle(t){}set lineWidth(t){}fill(){}stroke(){}clearRect(){}fillRect(){}strokeRect(){}beginPath(){}closePath(){}moveTo(){}lineTo(){}rect(){}arc(){}save(){}restore(){}clip(){}translate(){}rotate(){}fillText(){}setLineDash(){}quadraticCurveTo(){}bezierCurveTo(){}drawImage(){}measureText(t){return{width:t.length*Math.ceil(.625*this._fontSize)}}getImageData(){return{width:0,height:0,data:new Uint8ClampedArray(0)}}},Fa=Xs("canvas")||Xs("canvas-prebuilt");function ls(t=Au,e=Su){if(Ri){const i=document.createElement("canvas");return i.width=t,i.height=e,i}if(Fa){let i=null;return i="createCanvas"in Fa?Fa.createCanvas(t,e):new Fa(t,e),i.style={},i}const s=new N0;return s.width=t,s.height=e,s}function wu(t,e,s=t.width,i=t.height){e.clearRect(0,0,s,i)}function an(t,e,s,i=""){t.font=`${i} ${s}px ${e}`}function F0(){return tg(ls(),{},"webgl")!==null}var P0=t=>{const{canvas:e,width:s,height:i}={canvas:document.createElement("canvas"),width:window.innerWidth*devicePixelRatio,height:window.innerHeight*devicePixelRatio,...t};e.width=Math.ceil(s),e.height=Math.ceil(i),e.style.width=Math.ceil(s/devicePixelRatio)+"px",e.style.height=Math.ceil(i/devicePixelRatio)+"px";const n=e.getContext("webgl2",{antialias:!0});if(!n)throw new Error("WebGL 2.0 not supported");return n},z0=(t,e,s)=>{const i=P0();return i.canvas.addEventListener("webglcontextlost",s),{context:i,cleanUp:()=>{i.canvas.removeEventListener("webglcontextlost",s),i.getExtension("WEBGL_lose_context")?.loseContext()}}};function tg(t,e,s){let i=t.getContext(s,e);return i||(i=t.getContext("experimental-webgl",e)),i||null}function eg(t,e){if(e<2)return t;const s=t.split(`
`),i=[];for(let n=0;n<s.length;++n){const r=s[n];if(r.length<e)i.push(r);else{const o=D0(s[n],e);for(let a=0;a<o.length;++a)i.push(o[a])}}return i.join(`
`)}function D0(t,e){const s=[""],i=t.split(" ");for(let n=0;n<i.length;n++){const r=s[s.length-1],o=i[n];r.length+1+o.length<=e&&r.length?s[s.length-1]+=(r.length>0?" ":"")+o:s.push(o)}return s}function k0(t,e){if(t===null)return null;const s=(t=t.toString()).split(`
`),i=[];let n=0;for(let r=0;r<s.length;r++){let o=s[r];if(!e||e<=1||o.length<e)i.push(o),n=Math.max(n,o.length);else{const a=D0(s[r],e);for(let l=0;l<a.length;l++)o=a[l],i.push(o),n=Math.max(n,o.length)}}return{data:i,maxLength:n,lines:i.length}}function O0(){const t=Xs("@mapbox/mapbox-gl-rtl-text")||Xs("mapbox-gl-rtl-text"),e=t?t.processBidirectionalText:sn?window.processBidirectionalText:null,s=t?t.applyArabicShaping:sn?window.applyArabicShaping:null;return{processBidirectionalText:e?i=>{if(i===null||i==null)return"";const n=[];let r=0,o="";const a=i.split(`
`);for(let l=0;l<a.length;l++){const d=a[l],h=a[l].length+r;h>0&&l<a.length-1&&n.push(h),o+=l>0?""+d:d,r+=d.length}return e(o,n).join(`
`)}:i=>i,applyArabicShaping:s?i=>i==null?null:typeof i=="number"?i.toString():s(i):i=>i==null?null:i.toString()}}var nh=hd(),Pa=10,L2=1<<17,I2=65536,M2=256,Ym=128,N2=25,B0=1e3,Tu=2,U0=["100","200","300","400","500","600","700","800","900","none","bold","italic","normal","italic bold","bold italic","100 italic","200 italic","300 italic","400 italic","500 italic","600 italic","700 italic","800 italic","900 italic"],Xm=()=>{const t={};for(const e of U0)t[e]={};return t},R2=class{constructor(t){this._widthAtlases=Xm(),this._patternManager=t,this._canvas=ls(),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0}),this._processBidirectionalText=O0().processBidirectionalText,this._cornerRadius=0,this._version=0,this._textPattern={id:0,type:on,attributes:{text:"",font:"",size:0,style:"normal",align:"center"},dimensions:{width:0,height:0}},this._textDimensions={width:0,height:0},this._lineWidthList=new Array(64),this._init()}_init(){this._mustClear=!1,this._clear()}reset(){this._init()}clear(){this._mustClear=!0}_measureChar(t,e,s){return an(this._ctx,e,Oo,s),this._ctx.measureText(t).width/Oo}_getAtlas(t,e,s,i){const n=s===aa?0:s,r=this._byFont[t]||(this._byFont[t]=U0.reduce(((l,d)=>(l[d]=void 0,l)),{})),o=r[i]||(r[i]={}),a=o[e]||(o[e]=new Array(50));return a[n]||(a[n]=new Array(256))}_getMeasurementAtlas(t,e){const s=this._widthAtlases[e];return s[t]||(s[t]=new Array(256))}measureText(t,e,s,i=1){if(!e||t===null)return this._textDimensions.width=0,this._textDimensions.height=0,this._textDimensions;const n=this._getMeasurementAtlas(e,s);let r=0,o=0,a=1;for(let l=0;l<t.length;++l){const d=t.charCodeAt(l);if(d===Pa)o>r&&(r=o),o=0,a+=1;else{let h=n[d];h===void 0&&(h=this._measureChar(t[l],e,s),n[d]=h),o+=h}}return o>r&&(r=o),this._textDimensions.width=r*i,this._textDimensions.height=a*i,this._textDimensions}_getCharInfo(t,e,s,i,n,r){let o=t[e];if(!o){const a=String.fromCharCode(e);o={ratio:this._measureChar(a,s,i),patternId:0},o.patternId=this._patternManager.getIdFromDefinition({id:0,type:Sn,attributes:{text:a,font:s,style:i,size:n,align:r}}),t[e]=o}return o}storeTextInDataView(t,e,s,i){let n=e;if(i&&i.type===on){const{font:r,style:o,size:a,align:l}=i.attributes,d=l==="center",h=this._getAtlas(r,o,a,l);let u=0,c=1,g=0,m=0;const f=this._lineWidthList,p=this._processBidirectionalText(i.attributes.text);for(let b=0;b<p.length;++b){const v=p.charCodeAt(b);v===Pa?(g>u&&(u=g),f[m]=g,m++,g=0,c++):g+=this._getCharInfo(h,v,r,o,a,l).ratio}f[m]=g,g>u&&(u=g),m=0;let _=-(d?f[m]:u)/2,x=(1-c)/2,y=0;for(let b=0;b<p.length;++b){const v=p.charCodeAt(b),A=h[v];if(v===Pa)m+=1,_=-(d?f[m]:u)/2,x+=b===0?.5:1,y=0;else{const S=A.ratio,w=A.patternId;_+=(S+y)/2,y=S;const I=(Ws(_*B0+I2,0,L2-1)<<8)+Ws(x*Tu+Ym,0,M2-1);t.setUint16(n,w,nh),t.setUint32(n+2,I,nh),n+=vl}}}this._fillWithZeros(t,n,s)}extractTextFromDataView(t,e,s){const i=t,n=nh,r=i.getUint16(e,n),o=this._textPattern,a=this._patternManager.getDefinitionFromId(r),{font:l,style:d,size:h,align:u}=a.attributes,c=this._getAtlas(l,d,h,u),g=[];let m=0,f=0,p=0,_=null;for(let y=e;y<s;y+=vl){const b=i.getUint16(y,n);if(!b)break;const v=(i.getUint8(y+2)-Ym)/Tu,A=this._patternManager.getDefinitionFromId(b);if(!A||!A.attributes||!A.attributes.text)break;const S=A.attributes.text.charCodeAt(0),w=c[S];_===null?_=v:v>_&&(m>f&&(f=m),m=0,p+=1,g.push(Pa),_=v),g.push(S),w&&(m+=w.ratio)}m>f&&(f=m);const x=String.fromCharCode.apply(null,g);return o.attributes.style=d,o.attributes.font=l,o.attributes.size=h,o.attributes.align=u,o.attributes.text=this._processBidirectionalText(x),o.dimensions&&(o.dimensions.width=f,o.dimensions.height=p),o}_fillWithZeros(t,e,s){for(let i=e;i<s;i+=vl)t.setUint16(i,0)}_clear(){this._byFont={},this._widthAtlases=Xm()}update(){this._mustClear&&(this._clear(),this._mustClear=!1)}getVersion(){return this._version}getCornerRadius(){return this._cornerRadius}setCornerRadius(t){t!==this._cornerRadius&&(this._cornerRadius=t,this._version++)}},sg=()=>({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),Cs=class sr{constructor(e={}){const{xValues:s=[],yValues:i=[],scaledSizeValues:n=[],fixedSizeValues:r=[]}=e;this.minX=wi(s),this.minY=wi(i),this.maxX=lr(s),this.maxY=lr(i),this.minScaledSize=wi(n),this.maxScaledSize=lr(n),this.minFixedSize=wi(r),this.maxFixedSize=lr(r),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY}reset(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.minScaledSize=1/0,this.maxScaledSize=-1/0,this.minFixedSize=1/0,this.maxFixedSize=-1/0,this.width=0,this.height=0,this.cx=0,this.cy=0,this}addPoint(e,s,i,n){if(!isFinite(e)||!isFinite(s))return this;this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s),i!==void 0&&n!==void 0&&(n==="scaled"?(this.minScaledSize=Math.min(this.minScaledSize,i),this.maxScaledSize=Math.max(this.maxScaledSize,i)):(this.minFixedSize=Math.min(this.minFixedSize,i),this.maxFixedSize=Math.max(this.maxFixedSize,i)));const r=this.maxX-this.minX,o=this.maxY-this.minY;return this.cx=this.minX+r/2,this.cy=this.minY+o/2,this.width=r,this.height=o,this}computeForZoom(e){const s=Math.max(this.maxScaledSize,this.maxFixedSize/e);return sr.from({minX:this.minX-s/2,minY:this.minY-s/2,maxX:this.maxX+s/2,maxY:this.maxY+s/2,width:this.width+s,height:this.height+s})}static from({minX:e,minY:s,maxX:i,maxY:n,width:r,height:o}={}){const a=new sr;return e!=null&&(a.minX=e),s!=null&&(a.minY=s),i!=null&&(a.maxX=i),n!=null&&(a.maxY=n),i!=null&&e!=null&&(a.width=r||Math.abs(i-e),a.cx=(e+i)/2),n!=null&&s!=null&&(a.height=o||Math.abs(n-s),a.cy=(s+n)/2),a.maxScaledSize=a.minScaledSize=0,a}static fromValues(e,s,i){let n=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0;h<e.length;h++){const u=e[h],c=s[h],g=i[h];u-g<n&&(n=u-g),c-g<r&&(r=c-g),u+g>o&&(o=u+g),c+g>a&&(a=c+g),g>l&&(l=g)}const d=sr.from({minX:n,minY:r,maxX:o,maxY:a});return d.maxScaledSize=l,d}pad(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,this.width+=2*e,this.height+=2*e,this}isValid(){return isFinite(this.width)&&isFinite(this.height)}extend(e){let s,i,n,r;return e instanceof sr?(s=e.minX,i=e.minY,n=e.maxX,r=e.maxY):Array.isArray(e)&&(s=e[0],i=e[1],n=e[2],r=e[3]),this.addPoint(s,i).addPoint(n,r)}bottomLeft(){return{x:this.minX,y:this.minY}}topRight(){return{x:this.maxX,y:this.maxY}}center(){return{x:this.cx,y:this.cy}}clone(){const e=new sr;return e.minX=this.minX,e.minY=this.minY,e.maxX=this.maxX,e.maxY=this.maxY,e.minScaledSize=this.minScaledSize,e.maxScaledSize=this.maxScaledSize,e.minFixedSize=this.minFixedSize,e.maxFixedSize=this.maxFixedSize,e.cx=this.cx,e.cy=this.cy,e.width=this.width,e.height=this.height,e}},F2=1e-6,P2=1e-12;function G0(){for(var t=arguments,e=t.length-1,s=e,i=[],n=0;n<=e&&Math.abs(t[n])<=P2;n++)e--;switch(e){case 1:z2(t[s],t[s-1],i);break;case 2:D2(t[s],t[s-1],t[s-2],i);break;case 3:k2(t[s],t[s-1],t[s-2],t[s-3],i)}return i}function z2(t,e,s=[]){return e!==0&&s.push(-t/e),s}function D2(t,e,s,i=[]){var n=e/s,r=n*n-4*(t/s);if(r>0){var o=Math.sqrt(r);i.push(.5*(-n+o)),i.push(.5*(-n-o))}else r===0&&i.push(.5*-n);return i}function k2(t,e,s,i,n=[]){var r,o,a=s/i,l=e/i,d=(3*l-a*a)/3,h=(2*a*a*a-9*l*a+27*(t/i))/27,u=a/3,c=h*h/4+d*d*d/27,g=h/2;if(Math.abs(c)<=F2&&(c=0),c>0){var m=Math.sqrt(c);o=(r=-g+m)>=0?Math.pow(r,1/3):-Math.pow(-r,1/3),(r=-g-m)>=0?o+=Math.pow(r,1/3):o-=Math.pow(-r,1/3),n.push(o-u)}else if(c<0){var f=Math.sqrt(-d/3),p=Math.atan2(Math.sqrt(-c),-g)/3,_=Math.cos(p),x=Math.sin(p),y=Math.sqrt(3);n.push(2*f*_-u),n.push(-f*(_+y*x)-u),n.push(-f*(_-y*x)-u)}else r=g>=0?-Math.pow(g,1/3):Math.pow(-g,1/3),n.push(2*r-u),n.push(-r-u);return n}function Vi(t,e,s,i,n,r,o,a,l,d,h){for(var u,c,g=Math.min(o,l),m=Math.min(a,d),f=Math.max(o,l),p=Math.max(a,d),_=G0((u=a-d)*(t+-2*s+n)+(c=l-o)*(e+-2*i+r),u*(-2*t+2*s)+c*(-2*e+2*i),u*t+c*e+(o*d-l*a)),x=0;x<_.length;x++){var y=_[x];if(0<=y&&y<=1){var b=t+(s-t)*y,v=e+(i-e)*y,A=b+(s+(n-s)*y-b)*y,S=v+(i+(r-i)*y-v)*y;if(o===l){if(m<=S&&S<=p){if(!h)return 1;h.push(A,S)}}else if(a===d){if(g<=A&&A<=f){if(!h)return 1;h.push(A,S)}}else if(A>=g&&S>=m&&A<=f&&S<=p){if(!h)return 1;h.push(A,S)}}}return h?h.length/2:0}function V0(t,e,s,i,n,r,o,a,l,d,h){return h?(Vi(t,e,s,i,n,r,o,a,l,a,h),Vi(t,e,s,i,n,r,l,a,l,d,h),Vi(t,e,s,i,n,r,o,d,l,d,h),Vi(t,e,s,i,n,r,o,a,o,d,h),h.length/2):o<=t&&l>=t&&a<=e&&d>=e||o<=n&&l>=n&&a<=r&&d>=r||Vi(t,e,s,i,n,r,o,a,l,a)||Vi(t,e,s,i,n,r,l,a,l,d)||Vi(t,e,s,i,n,r,o,d,l,d)||Vi(t,e,s,i,n,r,o,a,o,d)?1:0}function qi(t,e,s,i,n,r,o,a,l,d,h,u,c){for(var g,m,f=Math.min(l,h),p=Math.min(d,u),_=Math.max(l,h),x=Math.max(d,u),y=G0((g=d-u)*(-1*t+3*s+-3*n+o)+(m=h-l)*(-1*e+3*i+-3*r+a),g*(3*t+-6*s+3*n)+m*(3*e+-6*i+3*r),g*(-3*t+3*s)+m*(-3*e+3*i),g*t+m*e+(l*u-h*d)),b=0;b<y.length;b++){var v=y[b];if(0<=v&&v<=1){var A=t+(s-t)*v,S=e+(i-e)*v,w=s+(n-s)*v,I=i+(r-i)*v,M=A+(w-A)*v,N=S+(I-S)*v,D=M+(w+(n+(o-n)*v-w)*v-M)*v,q=N+(I+(r+(a-r)*v-I)*v-N)*v;if(l===h){if(p<=q&&q<=x){if(!c)return 1;c.push(D,q)}}else if(d===u){if(f<=D&&D<=_){if(!c)return 1;c.push(D,q)}}else if(D>=f&&q>=p&&D<=_&&q<=x){if(!c)return 1;c.push(D,q)}}}return c?c.length/2:0}function Cu(t,e,s,i,n,r,o,a,l,d,h,u,c){return c?(qi(t,e,s,i,n,r,o,a,l,d,h,d,c),qi(t,e,s,i,n,r,o,a,h,d,h,u,c),qi(t,e,s,i,n,r,o,a,l,u,h,u,c),qi(t,e,s,i,n,r,o,a,l,d,l,u,c),c.length/2):l<=t&&h>=t&&d<=e&&u>=e||l<=o&&h>=o&&d<=a&&u>=a||qi(t,e,s,i,n,r,o,a,l,d,h,d)||qi(t,e,s,i,n,r,o,a,h,d,h,u)||qi(t,e,s,i,n,r,o,a,l,u,h,u)||qi(t,e,s,i,n,r,o,a,l,d,l,u)?1:0}function Wm(t,e,s,i,n){const r=1-n;return r*r*r*t+3*n*r*r*e+3*n*n*r*s+n*n*n*i}function cr(t,e,s,i){const n=1-i;return n*n*t+2*n*i*e+i*i*s}var O2=(t,e)=>2/(1+Math.exp(-Math.abs(t*e))),B2=5,$m=5;function Ld(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/$m*s)*$m,l=-n+Math.PI,d=-n+Math.PI/2;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function Id(t,e,s,i,n,r,o,a){const l=a||{x1:0,y1:0,x2:0,y2:0};if(r){const d=$T(n);if(o){const h=d*e+(1-d)*i;l.x1=t,l.y1=h,l.x2=s,l.y2=h}else{const h=d*t+(1-d)*s;l.x1=h,l.y1=e,l.x2=h,l.y2=i}}else l.x1=t,l.y1=e,l.x2=s,l.y2=i;return l}function Gn(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,m=-u*n/B2;return o.x=a+c*m,o.y=l+g*m,o}function Md(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(1-t)*(1-t)*e+2*(1-t)*t*r+t*t*i,a.y=(1-t)*(1-t)*s+2*(1-t)*t*o+t*t*n,a}function ig(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(2*t-2)*e+(2*i-4*r)*t+2*r,a.y=(2*t-2)*s+(2*n-4*o)*t+2*o,Ux(a)}function q0(t,e,s,i,n,r,o,a={x:0,y:0}){return ig(t,e,s,i,n,r,s,a),Hl(a.x,a.y,0,0,Math.PI/2,a),a}function H0(t,e,s,i,n,r,o,a,l,d=0,h=!1){const u=s-2*o+n,c=i-2*a+r,g=-((s-t)*c-(i-e)*u)/((2*o-2*s)*c-(2*a-2*i)*u);if(g<0||g>1)return!1;let m=l/2;h&&(m*=1-g),m+=d;const f=cr(s,o,n,g),p=cr(i,a,r,g);return Ze(f,p,t,e)<=m}function U2(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Gn(i.x,i.y,n.x,n.y,s);return Md(e,i.x,i.y,n.x,n.y,r.x,r.y)}function G2(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Gn(i.x,i.y,n.x,n.y,s);return q0(e,i.x,i.y,n.x,n.y,r.x,r.y)}function V2(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Gn(i.x,i.y,n.x,n.y,s);return ig(e,i.x,i.y,n.x,n.y,r.x,r.y)}function Uo(t,e,s,i,n,r,o,a,l,d={x:0,y:0}){const h=(1-t)*(1-t)*(1-t),u=3*t*(1-t)*(1-t),c=3*t*t*(1-t),g=t*t*t;return d.x=h*e+u*r+c*a+g*i,d.y=h*s+u*o+c*l+g*n,d}function Lu(t,e,s,i,n,r,o,a,l,d,h,u){let c=.5,g=Ze(t,e,s,i)<Ze(t,e,n,r)?-.01:.01,m=100;const f=Uo(c,s,i,n,r,o,a,l,d);let p,_=Ze(t,e,f.x,f.y);const x=h/2+u;for(;m-- >0&&c>=0&&c<=1&&_>x&&(g>.001||g<-.001);)p=_,Uo(c,s,i,n,r,o,a,l,d,f),_=Ze(t,e,f.x,f.y),_>p?(g=-g/2,c+=g):c+g<0||c+g>1?(g/=2,_=p):c+=g;return _<x}function ng(t,e,s,i,n,r,o=sg()){const a=t+.6666666666666666*(s-t),l=e+2/3*(i-e);return Nd(t,e,a,l,a+1/3*(n-t),l+1/3*(r-e),n,r,o)}function Nd(t,e,s,i,n,r,o,a,l=sg()){const{min:d,max:h,sqrt:u}=Math;let c,g,m,f,p;l.minX=d(t,o),l.maxX=h(t,o),l.minY=d(e,a),l.maxY=h(e,a);for(let _,x,y,b,v,A,S,w=0;w<2;++w)if(w===0?(g=t,m=s,f=n,p=o):(g=e,m=i,f=r,p=a),x=6*g-12*m+6*f,_=-3*g+9*m-9*f+3*p,y=3*m-3*g,x|=0,_|=0,y|=0,_!==0)v=x*x-4*y*_,v<0||(A=(-x+u(v))/(2*_),A>0&&A<1&&(c=rh(A,g,m,f,p),w===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))),S=(-x-u(v))/(2*_),S>0&&S<1&&(c=rh(S,g,m,f,p),w===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))));else{if(x===0)continue;b=-y/x,b>0&&b<1&&(c=rh(b,g,m,f,p),w===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c)))}return l}function rh(t,e,s,i,n){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*s+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*n}function q2(t,e,s,i,n,r){const o=t-2*s+n,a=e-2*i+r,l=2*s-2*t,d=2*i-2*e,h=4*(o*o+a*a),u=4*(o*l+a*d),c=l*l+d*d,g=2*Math.sqrt(h+u+c),m=Math.sqrt(h),f=2*h*m,p=2*Math.sqrt(c),_=u/m;return(f*g+m*u*(g-p)+(4*c*h-u*u)*Math.log((2*m+_+g)/(_+p)))/(4*f)}var Mi=class Iu extends la{constructor({bufferList:e,patternManager:s,boundariesManager:i,shapeManager:n,textManager:r,memoryManager:o}){super(),this._firstFrame=!0,this._width=0,this._height=0,this._pixelRatio=0,this._viewX=0,this._viewY=0,this._viewZoom=0,this._viewAngle=0,this._viewAngleCos=0,this._viewAngleSin=0,this._currentTime=0,this._scales={bytesToActualCoord:0,bytesToActualScaledSize:0,bytesToActualMinVisibleSize:0,bytesToActualSymbolicSize:0,bytesToActualDashLength:0,bytesToActualGapLength:0,bytesToActualPatternScale:0},this._shapesVersion=0,this._patternsVersion=0,this._boundariesVersion=0,this._textsVersion=0,this._backgroundRgba=[1,1,1,0],this._renderBackground=!1,this._hideImages=!1,this._genericObject=$c(),this._littleEndian=hd(),this._bufferList=e,this._shapeManager=n,this._patternManager=s,this._boundariesManager=i,this._textManager=r,this._memoryManager=o}static{this.edgeArrowSizeRatio=m0}static{this.minEdgeTipSize=f0}static createInitData(){return null}static getName(){return null}static isAvailable(){return!0}static setEdgeArrowSizeRatio(e){Iu.edgeArrowSizeRatio=e}static setMinEdgeTipSize(e){Iu.minEdgeTipSize=e}getDomElement(){return null}_initCanvas(e){e.style.touchAction="none"}export(e){return Promise.resolve()}extractElement(e,s){return this._memoryManager.extractGenericElement(e,s,this._scales)}_compareDimensions(e,s,i){return(e!==this._width||s!==this._height||i!==this._pixelRatio)&&(this._width=e,this._height=s,this._pixelRatio=i,!0)}_compareView(e,s,i,n){return(e!==this._viewX||s!==this._viewY||i!==this._viewZoom||n!==this._viewAngle)&&(this._viewX=e,this._viewY=s,this._viewZoom=i,this._viewAngle=n,this._viewAngleCos=Math.cos(n),this._viewAngleSin=Math.sin(n),!0)}_compareCurrentTime(e){return e!==this._currentTime&&(this._currentTime=e,!0)}_compareBackgroundColor(e,s){return(e!==this._backgroundColor||s!==this._renderBackground)&&(this._renderBackground=s,this._backgroundColor=e,this._backgroundRgba=ys(this._backgroundColor),!0)}_compareShapes(){return this._shapesVersion!==this._shapeManager.getVersion()&&(this._shapesVersion=this._shapeManager.getVersion(),!0)}_comparePatterns(){return this._patternsVersion!==this._patternManager.getVersion()&&(this._patternsVersion=this._patternManager.getVersion(),!0)}_compareBoundaries(){return this._boundariesVersion!==this._boundariesManager.getVersion()&&(this._boundariesVersion=this._boundariesManager.getVersion(),!0)}_compareTexts(){return this._textsVersion!==this._textManager.getVersion()&&(this._textsVersion=this._textManager.getVersion(),!0)}_compareIsDisplayableBuffer(e){return this._isBufferDisplayable!==e&&(this._isBufferDisplayable=e,!0)}_compareHideImages(e){return this._hideImages!==e&&(this._hideImages=e,!0)}renderFrame({x:e,y:s,zoom:i,angle:n,width:r,height:o,pixelRatio:a,backgroundColor:l,currentTime:d,isBufferDisplayable:h,hideImages:u,renderBackground:c}){const g=this._compareShapes(),m=this._comparePatterns(),f=this._compareBoundaries(),p=this._compareTexts(),_=this._compareDimensions(r,o,a),x=this._compareView(e,s,i,n),y=this._compareCurrentTime(d),b=this._compareBackgroundColor(l,c),v=this._compareIsDisplayableBuffer(h),A=this._compareHideImages(u);if(f){const S=this._boundariesManager,w=this._scales;w.bytesToActualCoord=1,w.bytesToActualScaledSize=S.maxScaledSize/c0,w.bytesToActualMinVisibleSize=S.maxMinVisibleSize/_u,w.bytesToActualSymbolicSize=S.maxSymbolicSize/hr,w.bytesToActualDashLength=S.maxDashLength/ur,w.bytesToActualGapLength=S.maxGapLength/ur,w.bytesToActualPatternScale=S.maxPatternScale/hr}this._firstFrame&&this._beforeFirstFrame(),this._render({shapesChanged:g,patternsChanged:m,boundariesChanged:f,textsChanged:p,dimensionsChanged:_,viewChanged:x,currentTimeChanged:y,backgroundColorChanged:b,isBufferDisplayableChanged:v,isHideImagesChanged:A}),this._firstFrame&&(this._afterFirstFrame(),this._firstFrame=!1)}_render(e){}_beforeFirstFrame(){}_afterFirstFrame(){}destroy(){}ensureAnimationsReady(){}getImageData(){return null}setViewportClipping(e){}};function j0(t,e,s,i,n,r,o,a=0,l=!1){const d=Ze(s,i,n,r),h=(o/2*(l?Ze(t,e,n,r)/d:1)+a)/d,u=(n-s)*h,c=(r-i)*h,g=s+c,m=i-u,f=t-g,p=e-m,_=s-c-g,x=i+u-m,y=n+c-g,b=r-u-m,v=f*_+p*x,A=f*y+p*b;return v>0&&v<_*_+x*x&&A>0&&A<y*y+b*b}function H2(t,e,s,i,n=!1){if(n&&(za(t,s)||za(t,i)||za(e,s)||za(e,i)))return!1;let r=(t.y-s.y)*(i.x-s.x)-(t.x-s.x)*(i.y-s.y);const o=(e.x-t.x)*(i.y-s.y)-(e.y-t.y)*(i.x-s.x);if(o===0)return!1;const a=r/o;r=(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y);const l=r/o;return!(a<=0||a>=1||l<=0||l>=1)}function za(t,e){return t.x===e.x&&t.y===e.y}function Ir(t,e,s,i){return Math.atan2(i-e,s-t)}function j2(t,e,s){const i=Ir(t.x,t.y,e.x,e.y)-Ir(s.x,s.y,e.x,e.y);return i<0?i+2*Math.PI:i}function Y2(t,e,s,i,n,r,o,a){const l=(a-r)*(s-t)-(o-n)*(i-e);if(l===0)return null;let d=e-r;return d=((o-n)*d-(a-r)*(t-n))/l,{x:t+d*(s-t),y:e+d*(i-e)}}function ro(t,e,s,i,n,r,o,a){const l=t-s,d=e-i,h=n-o,u=r-a,c=l*u-h*d,g=(d*(t-n)-l*(e-r))/c;if(g<0||g>1)return null;const m=(h*(r-e)+u*(t-n))/c;return m>=0&&m<=1?{x:t-m*l,y:e-m*d}:null}function Y0(t,e,s,i,n,r,o,a){let l;const d=[];return l=ro(t,e,s,i,n,r,n,a),l&&d.push(l),l=ro(t,e,s,i,n,a,o,a),l&&d.push(l),l=ro(t,e,s,i,o,a,o,r),l&&d.push(l),l=ro(t,e,s,i,o,r,n,r),l&&d.push(l),d}function gr(t,e,s,i,n,r,o,a){const l=((o-n)*(e-r)-(a-r)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e)),d=((s-t)*(e-r)-(i-e)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e));return l>=0&&l<=1&&d>=0&&d<=1}function rg(t,e,s,i,n,r,o,a){return t>=n&&e>=r&&t<=o&&e<=a||s>=n&&i>=r&&s<=o&&i<=a||!!gr(t,e,s,i,n,r,n,a)||!!gr(t,e,s,i,o,r,o,a)||!!gr(t,e,s,i,n,r,o,r)||!!gr(t,e,s,i,n,a,o,a)}function X0(t,e,s){return Math.sqrt(og(t.x,t.y,e.x,e.y,s.x,s.y))}function og(t,e,s,i,n,r){const o=yl(s,i,n,r);if(o===0)return yl(t,e,s,i);let a=((t-s)*(n-s)+(e-i)*(r-i))/o;return a=Math.max(0,Math.min(1,a)),yl(t,e,s+a*(n-s),i+a*(r-i))}function W0(t,e,s,i,n,r){const o=n-s,a=r-i;if(o===0&&a===0)return{x:s,y:i};const l=((t-s)*o+(e-i)*a)/(o*o+a*a);return l<0?{x:s,y:i}:l>1?{x:n,y:r}:{x:s+l*o,y:i+l*a}}function X2(t,e,s,i,n,r){const o=n-s,a=r-i,l=((t-s)*o+(e-i)*a)/(o*o+a*a);return{x:s+o*l,y:i+a*l}}function Rd(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,m=-u*n/Ad;return o.x=a+c*m,o.y=l+g*m,o}function ag(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/Kl*s)*Kl,l=-n+Ys,d=Ys/2-n;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function W2(t,e,s,i){const n=Math.abs(t.x-e.x-s.x+i.x)+Math.abs(t.y-e.y-s.y+i.y)<.01,r=9*(e.x-t.x)**2,o=(-243*t.x+189*e.x+51*s.x+3*i.x)**2/1e4,a=(-48*t.x+24*e.x+21*s.x+3*i.x)**2/625,l=(-147*t.x+21*e.x+99*s.x+27*i.x)**2/1e4,d=(-27*t.x-9*e.x+24*s.x+12*i.x)**2/625,h=9/16*(s.x+i.x-t.x-e.x)**2,u=9*(e.y-t.y)**2,c=(-243*t.y+189*e.y+51*s.y+3*i.y)**2/1e4,g=(-48*t.y+24*e.y+21*s.y+3*i.y)**2/625,m=(-147*t.y+21*e.y+99*s.y+27*i.y)**2/1e4,f=(-27*t.y-9*e.y+24*s.y+12*i.y)**2/625,p=9/16*(s.y+i.y-t.y-e.y)**2,_=Math.sqrt(r+u),x=Math.sqrt(o+c),y=Math.sqrt(a+g),b=Math.sqrt(l+m),v=Math.sqrt(d+f),A=Math.sqrt(h+p);if(n)return 5/2993760*(32134*_+212600*x-97050*y+544800*b-521100*v+427368*A);const S=(-12*t.x-24*e.x+9*s.x+27*i.x)**2/625,w=(-27*t.x-99*e.x-21*s.x+147*i.x)**2/1e4,I=(-3*t.x-21*e.x-24*s.x+48*i.x)**2/625,M=(-3*t.x-51*e.x-189*s.x+243*i.x)**2/1e4,N=9*(i.x-s.x)**2,D=(-12*t.y-24*e.y+9*s.y+27*i.y)**2/625,q=(-27*t.y-99*e.y-21*s.y+147*i.y)**2/1e4,et=(-3*t.y-21*e.y-24*s.y+48*i.y)**2/625,O=(-3*t.y-51*e.y-189*s.y+243*i.y)**2/1e4,K=9*(i.y-s.y)**2,j=Math.sqrt(S+D),ot=Math.sqrt(w+q),it=Math.sqrt(I+et),ct=Math.sqrt(M+O);return 5/2993760*(16067*(_+Math.sqrt(N+K))+106300*(x+ct)-48525*(y+it)+272400*(b+ot)-260550*(v+j)+427368*A)}var $2={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}},Z2=[{name:"topLeft",dx:-1,dy:-1,cornerIndex:2},{name:"topRight",dx:1,dy:-1,cornerIndex:3},{name:"bottomLeft",dx:-1,dy:1,cornerIndex:1},{name:"bottomRight",dx:1,dy:1,cornerIndex:0}],Ai={x:0,y:0};function K2(t,e,s,i,n,r,o,a,l,d,h,u){r=r||o.getNodes()._indexes;const c=l.getZoom(),g=o.getObjectList(!0),m=a.getFlexArrays().nodes.current;let f=1/0,p=0,_=-1/0;a.update();for(let x=0;x<r.length;++x){const y=r[x];if(m.excluded.get(y)||!m.detectable.get(y)||h.has(y))continue;const b=m.x.get(y),v=m.y.get(y),A=m.layer.get(y);if(A<_)continue;Ai.x=b,Ai.y=v;const S=l.graphToScreenCoordinates(Ai),w=S.x,I=S.y,M=m.shape.get(y),N=m.scalingMethod.get(y)==="scaled",D=m.radius.get(y)*(N?c:1),q=D+n,et=(t-w)/q,O=(e-I)/q;if(Ai.x=t,Ai.y=e,!(i&&$0(Ai,y,a,l,d)))if(d.checkShapeHit(M,et,O)){const K=o.getAttribute(!0,"virtual").get(y)!==0;if(q>f&&K)continue;f=q}else{if(!s)continue;{const K=u(m.text.content.get(y)||null),j=m.textHidden.get(y),ot=m.text.minVisibleSize.get(y),it=N?2*D:1/0;if(j||!K||it<ot)continue;const ct=eg(K,m.text.maxLineLength.get(y)),pt=m.innerStroke.width.get(y),Pt=m.text.margin.get(y),At=m.text.padding.get(y),bt=m.text.size.get(y),It=m.text.scale.get(y),Ut=m.text.scaling.get(y),Gt=m.text.font.get(y),Dt=m.text.style.get(y),Rt=m.text.position.get(y),Tt=d.measureText(ct,Gt,Dt,1),Nt=Ut?It*D*2:bt,Ht=Tt.width*Nt/2+At,qt=Tt.height*Nt/2+At,Zt=$2[Rt],Lt=pt+Pt+D,Kt=w+(Lt+Ht)*Zt.x,ue=I+(Lt+qt)*Zt.y,ne=Kt+Ht,se=ue-qt,le=ue+qt;if(t<=Kt-Ht||t>=ne||e<=se||e>=le)continue}}p=y,_=A}return g.get(p)||null}function $0(t,e,s,i,n){const r=s.getFlexArrays().nodes.current,o=i.getZoom(),a=r.scalingMethod.get(e)==="scaled",l=r.radius.get(e)*(a?o:1),d=r.x.get(e),h=r.y.get(e),u=r.radius.get(e);for(let c=0;c<4;c++){const{name:g,cornerIndex:m}=Z2[c],f=r.badges[g].scalingMethod.get(e)==="fixed",p=r.badges[g].scale.get(e),_=f?Math.min(p*l,r.radius.get(e)*p):p*l,x=r.badges[g].minVisibleSize.get(e)/2,y=r.badges[g].positionScale.get(e);if(!r.badges[g].text.content.get(e)&&!r.badges[g].image.url.get(e)||_<x)continue;const b=i.graphToScreenCoordinates({x:d+u*y*i.getCornerCos(m),y:h+u*y*i.getCornerSin(m)}),{x:v,y:A}=b,S=(t.x-v)/_,w=(t.y-A)/_;if(n.checkShapeHit("circle",S,w))return g}}function Q2(t,e,s,i,n,r,o,a,l,d,h){n=n||r.getEdges()._indexes;const u=r.getObjectList(!1),c=l.getFlexArrays(),g=c.edges.current,m=c.nodes.current,f=o.getZoom(),p=o.getAngle(),_=Math.cos(p),x=Math.sin(p),y=i/f;Ai.x=t,Ai.y=e;const b=o.screenToGraphCoordinates(Ai),v=b.x,A=b.y;let S=0;l.update();for(let w=0;w<n.length;++w){const I=n[w],M=g.source.get(I),N=g.target.get(I),D=g.excluded.get(I),q=g.detectable.get(I),et=a.has(M),O=a.has(N);if(D||!q||et||O)continue;const K=M===N,j=g.curvature.get(I),ot=g.shape.body.get(I)==="triangle",it=g.scalingMethod.get(I)==="scaled",ct=g.width.get(I)/(it?1:f),pt=m.x.get(M),Pt=m.y.get(M),At=m.x.get(N),bt=m.y.get(N);if(K){const It=m.scalingMethod.get(M)==="scaled",Ut=ag(pt,Pt,j,m.radius.get(M)/(It?1:f),0);if(!Lu(v,A,pt,Pt,pt,Pt,Ut.x1,Ut.y1,Ut.x2,Ut.y2,ct,y))continue}else if(d){const It=Id(pt*_-Pt*x,Pt*_+pt*x,At*_-bt*x,bt*_+At*x,j,d,h);if(!Lu(v,A,pt,Pt,At,bt,It.x1*_+It.y1*x,It.y1*_-It.x1*x,It.x2*_+It.y2*x,It.y2*_-It.x2*x,ct,y))continue}else if(j!==0){const It=Rd(pt,Pt,At,bt,j);if(!H0(v,A,pt,Pt,At,bt,It.x,It.y,ct,y,ot))continue}else if(!j0(v,A,pt,Pt,At,bt,ct,y,ot))continue;S=I}return u.get(S)||null}function J2(t){const e=t.getNodeAttribute("radius"),s=t.getEdgeAttribute("width"),i=t.getNodes(),n=t.getEdges();let r=0,o=0;for(let a=0;a<i._indexes.length;a++){const l=i._indexes[a],d=e.get(l);d>r&&(r=d)}for(let a=0;a<n._indexes.length;a++){const l=n._indexes[a],d=s.get(l);d>o&&(o=d)}return Math.max(2*r,o)}function tC(t){return t===null?"none":t==="webgl"?"WebGL":t==="svg"?"SVG":t==="canvas"?"Canvas":t}function Z0(t,e,s,i){const n=(t-e)/s,r=n*n,o=r*n,a=Zc.getCoefficients(i),l=n<.5?0:4;return Ws(a[l]+a[l+1]*n+a[l+2]*r+a[l+3]*o,0,1)}function oo(t,e,s,i){if(t===e)return t;const[n,r,o,a]=ys(t),[l,d,h,u]=ys(e);return`rgba(${Math.round(255*ye(n,l,s))},${Math.round(255*ye(r,d,s))},${Math.round(255*ye(o,h,s))},${ye(a,u,i)})`}function eC(t,e){const[s,i,n,r]=ys(t);return`rgba(${255*s},${255*i},${255*n},${r*e})`}var Zm=1/Ms,K0=class extends Mi{constructor(t){super(t),this._cachePoints=[],this._nextCachePoint=0,this._tmp={x1:0,y1:0,x2:0,y2:0},this._ccp={x1:0,y1:0,x2:0,y2:0},this._pointCopies=Array(128),this._clipViewport=!0}_resetCachePoints(){this._nextCachePoint=0}_point(t,e){let s=this._cachePoints[this._nextCachePoint++];return s||(s={x:0,y:0},this._cachePoints.push(s)),s.x=t,s.y=e,s}setViewportClipping(t){this._clipViewport=t}_displayBuffer(t){const e=t.getSize(),s=t.animated;for(let i=0;i<e;++i){const n=this.extractElement(t,i);n.valid&&this._displayElement(n,s)}}_mixAttributes(t,e,s){const i=Z0(this._currentTime,s.beginTime,s.duration,s.easing);return t.dashLength=ye(e.dashLength,t.dashLength,i),t.gapLength=ye(e.gapLength,t.gapLength,i),t.offsetAngle=ye(e.offsetAngle,t.offsetAngle,i),t.opacity=ye(e.opacity,t.opacity,i),t.globalMinVisibleSize=ye(e.globalMinVisibleSize,t.globalMinVisibleSize,i),t.strokeMinVisibleSize=ye(e.strokeMinVisibleSize,t.strokeMinVisibleSize,i),t.patternMinVisibleSize=ye(e.patternMinVisibleSize,t.patternMinVisibleSize,i),t.symbolicSize=ye(e.symbolicSize,t.symbolicSize,i),t.curvature=ye(e.curvature,t.curvature,i),t.fillColor=oo(e.fillColor,t.fillColor,i,i),t.strokeColor=oo(e.strokeColor,t.strokeColor,i,i),t.patternColor=oo(e.patternColor,t.patternColor,i,i),t.x1=ye(e.x1,t.x1,i),t.y1=ye(e.y1,t.y1,i),t.x2=ye(e.x2,t.x2,i),t.y2=ye(e.y2,t.y2,i),t.rectWidthOrSourceRadiusScaled=ye(e.rectWidthOrSourceRadiusScaled,t.rectWidthOrSourceRadiusScaled,i),t.rectWidthOrSourceRadiusFixed=ye(e.rectWidthOrSourceRadiusFixed,t.rectWidthOrSourceRadiusFixed,i),t.rectHeightOrTargetRadiusScaled=ye(e.rectHeightOrTargetRadiusScaled,t.rectHeightOrTargetRadiusScaled,i),t.rectHeightOrTargetRadiusFixed=ye(e.rectHeightOrTargetRadiusFixed,t.rectHeightOrTargetRadiusFixed,i),t.thicknessOrFontSizeScaled=ye(e.thicknessOrFontSizeScaled,t.thicknessOrFontSizeScaled,i),t.thicknessOrFontSizeFixed=ye(e.thicknessOrFontSizeFixed,t.thicknessOrFontSizeFixed,i),t.strokeWidthScaled=ye(e.strokeWidthScaled,t.strokeWidthScaled,i),t.strokeWidthFixed=ye(e.strokeWidthFixed,t.strokeWidthFixed,i),t.offsetScaled=ye(e.offsetScaled,t.offsetScaled,i),t.offsetFixed=ye(e.offsetFixed,t.offsetFixed,i),t}_computeRenderInfo(t){const e=this._viewZoom,s=this._point(t.x1,t.y1),i=this._point(t.x2,t.y2),n=t.isBadge,r=n&&t.rectWidthOrSourceRadiusScaled&&t.rectWidthOrSourceRadiusFixed,o=r?Math.min(t.rectWidthOrSourceRadiusScaled*e,t.rectWidthOrSourceRadiusFixed):t.rectWidthOrSourceRadiusScaled*e+t.rectWidthOrSourceRadiusFixed,a=r?o:t.rectHeightOrTargetRadiusScaled*e+t.rectHeightOrTargetRadiusFixed,l=t.symbolicSize===0?1/0:t.symbolicSize*e;return{shape:this._shapeManager.getDefinitionFromName(t.shape),pieceId:t.pieceId,dashLength:t.dashLength,gapLength:t.gapLength,hasHead:t.hasHead,hasTail:t.hasTail,isBodyTriangle:t.isBodyTriangle,isSelfLoop:t.isSelfLoop,patternScale:t.patternScale,offsetAngle:ql(t.offsetAngle),isText:t.isText,adjustTextAngle:t.adjustTextAngle,isBadge:n,bentEnable:t.bentEnable,bentVertical:t.bentVertical,opacity:t.opacity,globalMinVisibleSize:t.globalMinVisibleSize,strokeMinVisibleSize:t.strokeMinVisibleSize,patternMinVisibleSize:t.patternMinVisibleSize,symbolicSize:l,curvature:t.curvature,pattern:t.pattern,fillColor:t.fillColor,strokeColor:t.strokeColor,patternColor:t.patternColor,pos1OnGraph:s,pos2OnGraph:i,pos1:this._graphToScreenCoordinates(s),pos2:this._graphToScreenCoordinates(i),rectWidthOrSourceRadius:o,rectHeightOrTargetRadius:a,thicknessOrFontSize:t.thicknessOrFontSizeScaled*e+t.thicknessOrFontSizeFixed,strokeWidth:t.strokeWidthScaled*e+t.strokeWidthFixed,offset:t.offsetScaled*e+t.offsetFixed}}_applyBackgroundBlending(t){t.opacity!==1&&(t.fillColor=this._blendColor(t.fillColor,t.opacity),t.strokeColor=this._blendColor(t.strokeColor,t.opacity),t.textColor=this._blendColor(t.textColor,t.opacity))}_pointArray(t){let e=this._pointCopies[t];if(!e){e=new Array(t),this._pointCopies[t]=e;for(let s=0;s<t;++s)e[s]={x:0,y:0,r:0}}return e}_scalePoints(t,e,s,i){const n=t.shape.points.length,r=this._pointArray(n);for(let l=0;l<n;++l){const d=t.shape.points[l],h=r[l];h.x=e.x+d.x*s,h.y=e.y+d.y*i,h.r=d.r*s}const o=t.pos2OnGraph.x-t.pos1OnGraph.x,a=t.pos2OnGraph.y-t.pos1OnGraph.y;if(o!==0||a!==0){const l=Math.sqrt(o*o+a*a),d=o/l,h=a/l;for(const u of r){const c=u.x-e.x,g=u.y-e.y;u.x=e.x+d*c+h*g,u.y=e.y-h*c+d*g}}return r}_drawPoints(t,e=!1){t.length===1?this._drawCircle(t[0],t[0].r):this._drawPolygon(t,e)}_computeCenter(t){const e=Math.cos(t.offsetAngle),s=Math.sin(t.offsetAngle),i=(t.pos1.x+t.pos2.x)/2+e*t.offset,n=(t.pos1.y+t.pos2.y)/2+s*t.offset;return this._point(i,n)}_displayTextBox(t,e,s,i){const n=this._computeCenter(t),r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2;(e||i)&&this._drawRoundedRectangle(n,r,o,0,t.fillColor)}_displayNodeComponent(t,e,s,i){const n=this._computeCenter(t);if(t.pattern.type!==on){const r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2,a=this._scalePoints(t,n,r,o);if((e||i)&&this._drawPoints(a,!0),e&&this._fill(t.fillColor),i){if(this._startClip(),t.pattern.type===da){let l=t.pattern.attributes.colorArray;t.opacity!==1&&(l=l.map((d=>this._blendColor(d,t.opacity)))),this._displayPieChart(n,r,l)}else if(t.pattern.type===Nn||t.pattern.type===Rn){const d=Math.round(t.rectHeightOrTargetRadius*t.patternScale),h=t.pattern.attributes.text,u=this._blendColor(t.patternColor,t.opacity),c=t.pattern.attributes.font,g=t.pattern.attributes.style,m=t.pattern.attributes.align,f=t.rectWidthOrSourceRadius,p=t.pattern.attributes.paddingTop,_=t.pattern.attributes.paddingLeft;this._displayText(n,0,h,u,c,d,g,m,f,_,p,!0)}else if(t.pattern.type===en){const l=t.pattern.attributes.image;if(l.isDummy||l.width&&l.height){const d=t.pattern.attributes.duplicated,h=d?1:t.patternScale,u=t.rectWidthOrSourceRadius*h,c=t.rectHeightOrTargetRadius*h,g=t.pattern.attributes.scaled,m=t.opacity;this._displayImage(n,u,c,l,g,d,m)}}this._endClip()}if(s){const l=t.strokeWidth/2,d=this._scalePoints(t,n,r+l,o+l);this._drawPoints(d),this._stroke(t.strokeColor,t.strokeWidth)}}else if(i){const o=t.thicknessOrFontSize,a=t.pattern.attributes.text,l=this._blendColor(t.patternColor,t.opacity),d=t.pattern.attributes.font,h=t.pattern.attributes.style,u=t.pattern.attributes.align,c=t.rectWidthOrSourceRadius;this._displayText(n,0,a,l,d,o,h,u,c,0,0,!1)}}_displayElement(t,e){if(!t.end||!t.end.shape||!t.end.pieceId||e&&(!t.start||!t.animation))return;this._resetCachePoints();const s=e?this._mixAttributes(t.end,t.start,t.animation):t.end,i=this._computeRenderInfo(s);if(i.symbolicSize<i.globalMinVisibleSize||i.opacity===0)return;this._applyBackgroundBlending(i);const n=!!(i.strokeColor&&i.strokeWidth>0&&i.symbolicSize>=i.strokeMinVisibleSize),r=i.pattern.type!==xs&&i.symbolicSize>=i.patternMinVisibleSize,o=!!i.fillColor;if(i.pieceId===$s)return this._displayNodeComponent(i,o,n,r);if(i.pieceId===wn)return this._displayTextBox(i,o,n,r);const a=i.pos2.x-i.pos1.x,l=i.pos2.y-i.pos1.y,d=Math.sqrt(a*a+l*l);let h,u=null,c=null;if(i.bentEnable&&!i.isSelfLoop)this._tmp.x1=i.pos1.x,this._tmp.y1=i.pos1.y,this._tmp.x2=i.pos2.x,this._tmp.y2=i.pos2.y,i.pos1.x=this._tmp.x1*this._viewAngleCos-this._tmp.y1*this._viewAngleSin,i.pos1.y=this._tmp.y1*this._viewAngleCos+this._tmp.x1*this._viewAngleSin,i.pos2.x=this._tmp.x2*this._viewAngleCos-this._tmp.y2*this._viewAngleSin,i.pos2.y=this._tmp.y2*this._viewAngleCos+this._tmp.x2*this._viewAngleSin,Id(i.pos1.x,i.pos1.y,i.pos2.x,i.pos2.y,i.curvature,i.bentEnable,i.bentVertical,this._ccp),i.pos1.x=this._tmp.x1,i.pos1.y=this._tmp.y1,i.pos2.x=this._tmp.x2,i.pos2.y=this._tmp.y2,this._tmp.x1=this._ccp.x1,this._tmp.y1=this._ccp.y1,this._tmp.x2=this._ccp.x2,this._tmp.y2=this._ccp.y2,this._ccp.x1=this._tmp.x1*this._viewAngleCos+this._tmp.y1*this._viewAngleSin,this._ccp.y1=this._tmp.y1*this._viewAngleCos-this._tmp.x1*this._viewAngleSin,this._ccp.x2=this._tmp.x2*this._viewAngleCos+this._tmp.y2*this._viewAngleSin,this._ccp.y2=this._tmp.y2*this._viewAngleCos-this._tmp.x2*this._viewAngleSin,u=this._point(this._ccp.x1,this._ccp.y1),c=this._point(this._ccp.x2,this._ccp.y2),h=W2(i.pos1,u,c,i.pos2);else if(i.isSelfLoop){const g=i.pieceId===_n||i.pieceId===_n+wn?i.strokeWidth/2:i.rectWidthOrSourceRadius,{x1:m,y1:f,x2:p,y2:_}=this._getSelfLoopControlPoints(i.pos1,i.curvature,g);u=this._point(m,f),c=this._point(p,_),h=iC(i.pos1,u,c,i.pos2,1)}else i.curvature?(u=this._getQuadraticCurveControlPoint(i),h=sC(i.curvature,d,1)):h=d;if(i.pieceId===_n||i.pieceId===_n+wn){const g=i.strokeWidth,m=this._getPointOnLine(i.pos1,u,c,i.pos2,.5),f=this._getTangentOnLine(i.pos1,u,c,i.pos2,.5);if(i.rectWidthOrSourceRadius>=h-g&&!i.isSelfLoop){if(!i.adjustTextAngle)return;f.x=1,f.y=0}let p=-Math.atan2(f.y,f.x);const _=ql(i.offsetAngle-p);(!i.isSelfLoop&&_<0||i.isSelfLoop&&i.offsetAngle<0)&&(f.x*=-1,f.y*=-1),(p>Math.PI/2||p<-Math.PI/2)&&(p+=Math.PI);const x=this._getOrthogonal(f),y=m.x+x.x*i.offset,b=m.y+x.y*i.offset;if(i.pieceId===_n+wn){if(!i.fillColor)return;const v=i.rectWidthOrSourceRadius/2,A=i.rectHeightOrTargetRadius/2;this._drawRoundedRectangle(this._point(y,b),v,A,_+Math.PI/2,i.fillColor)}else{const v=this._point(y,b),A=p,S=i.thicknessOrFontSize,w=i.pattern.attributes.text,I=this._blendColor(i.patternColor,i.opacity),M=i.pattern.attributes.font,N=i.pattern.attributes.style,D=i.pattern.attributes.align,q=i.rectWidthOrSourceRadius;this._displayText(v,A,w,I,M,S,N,D,q,0,0,!1)}}else{const g=i.pieceId===Xc,m=i.pieceId===Wc,f=Math.cos(i.offsetAngle),p=Math.sin(i.offsetAngle);i.pos1.x+=f*i.offset,i.pos1.y+=p*i.offset,i.pos2.x+=f*i.offset,i.pos2.y+=p*i.offset;const _=i.shape.name==="line",x=i.thicknessOrFontSize,y=i.rectWidthOrSourceRadius,b=i.rectHeightOrTargetRadius,v=+i.hasHead,A=+i.hasTail,S=Math.max(Mi.minEdgeTipSize,x*Mi.edgeArrowSizeRatio),w=v*Math.min(5*y,S),I=A*Math.min(5*b,S),M=i.isSelfLoop?1/0:d-y-b,N=Math.min(0,M-w-I)/2,D=x/2;let q=y>D?y-Math.sqrt(y*y-D*D):D;const et=Math.max(y+I+A*N,0)-(1-v)*q;q=y>D?b-Math.sqrt(b*b-D*D):D;const O=Math.max(b+w+v*N,0)-(1-A)*q;if(g||m){const K=m?-1:1,j=(g?h-O:et)-K;let ot=null,it=null;if((i.bentEnable||i.isSelfLoop)&&u&&c){const ct=this._getTFromLengthOnCubicCurve(i.pos1,u,c,i.pos2,(g?O:et)+1+i.strokeWidth/2,m);ot=this._getPointOnCubicCurve(i.pos1,u,c,i.pos2,ct),it=this._getTangentOnCubicCurve(i.pos1,u,c,i.pos2,ct)}else if(i.curvature&&u){const ct=this._getTFromLengthOnQuadraticCurve(i.pos1,u,i.pos2,j-i.strokeWidth/2*K);ot=this._getPointOnQuadraticCurve(i.pos1,u,i.pos2,ct),it=this._getTangentOnQuadraticCurve(i.pos1,u,i.pos2,ct)}else{const ct=j/h;ot=this._mixPoints(i.pos1,i.pos2,ct),it=this._point(a/d,l/d)}if(it.x*=K,it.y*=K,o){if(i.shape.hole){const pt=this._makeEdgeExtremityPoints(ot,it,S,i.shape.hole);this._drawPoints(pt),this._startReverseClip()}const ct=this._makeEdgeExtremityPoints(ot,it,S,i.shape.points);this._drawPoints(ct),this._fill(i.fillColor),i.shape.hole&&this._endReverseClip()}if(n){if(i.shape.hole){const Pt=this._makeEdgeExtremityPoints(ot,it,S,i.shape.hole);this._drawPoints(Pt),this._stroke(i.strokeColor,i.strokeWidth)}const ct=S+i.strokeWidth/2,pt=this._makeEdgeExtremityPoints(ot,it,ct,i.shape.points);this._drawPoints(pt),this._stroke(i.strokeColor,i.strokeWidth)}}else{if(h-et-O<=0)return;if(_){const K=nC(h,x,et,O,i.dashLength,i.gapLength);n&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.strokeColor,x+2*i.strokeWidth,K)),o&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.fillColor,x,K))}else{const K=et,j=h-O;if(n){const ot=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,K,j,x+i.strokeWidth/2,i.strokeWidth/2,h);this._drawPoints(ot),this._stroke(i.strokeColor,i.strokeWidth)}if(o){const ot=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,K,j,x,0,h);this._drawPoints(ot),this._fill(i.fillColor)}}}}}_makeTriangleEdgeBody(t,e,s,i,n,r,o,a,l){return e?s?this._makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a,l):this._makeCurveTriangleEdge(t,e,i,n,r,o,a):this._makeStraightTriangleEdge(t,i,n,r,o,a)}_makeCurveTriangleEdge(t,e,s,i,n,r,o){const a=2*Ms+2,l=this._pointArray(a),d=this._getTFromLengthOnQuadraticCurve(t,e,s,i),h=(this._getTFromLengthOnQuadraticCurve(t,e,s,n)-d)/Ms,u=(o-r)/Ms/2;let c=r/2,g=d;for(let m=0;m<=Ms;++m){const f=this._getPointOnQuadraticCurve(t,e,s,g),p=this._getTangentOnQuadraticCurve(t,e,s,g),_=this._getOrthogonal(p),x=_.x*c,y=_.y*c,b=l[m],v=l[a-1-m];b.x=f.x+x,b.y=f.y+y,v.x=f.x-x,v.y=f.y-y,g+=h,c+=u}return l}_makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a,l){const d=2*Ms+2,h=this._pointArray(d),u=this._getTFromLengthOnCubicCurve(t,e,s,i,n),c=(this._getTFromLengthOnCubicCurve(t,e,s,i,l-r,!1)-u)/Ms,g=(a-o)/Ms/2;let m=o/2,f=u;for(let p=0;p<=Ms;++p){const _=this._getPointOnCubicCurve(t,e,s,i,f),x=this._getTangentOnCubicCurve(t,e,s,i,f),y=this._getOrthogonal(x),b=y.x*m,v=y.y*m,A=h[p],S=h[d-1-p];A.x=_.x+b,A.y=_.y+v,S.x=_.x-b,S.y=_.y-v,f+=c,m+=g}return h}_makeStraightTriangleEdge(t,e,s,i,n,r){const o=e.x-t.x,a=e.y-t.y,l=Math.sqrt(o*o+a*a),d=this._point(o/l,a/l),h=this._getOrthogonal(d),u=n/2,c=r/2,g=this._pointArray(4),m=g[0],f=g[1],p=g[2],_=g[3],x=t.x+d.x*s,y=t.y+d.y*s,b=t.x+d.x*i,v=t.y+d.y*i,A=h.x*u,S=h.y*u,w=h.x*c,I=h.y*c;return m.x=x+A,m.y=y+S,f.x=x-A,f.y=y-S,p.x=b-w,p.y=v-I,_.x=b+w,_.y=v+I,g}_makeEdgeExtremityPoints(t,e,s,i){const n=this._pointArray(i.length),r=s/2,o=t.x+e.x*r,a=t.y+e.y*r,l=e.x,d=e.y;for(let h=0;h<i.length;++h){const u=i[h],c=n[h],g=(l*u.x-d*u.y)*r,m=(d*u.x+l*u.y)*r;c.x=o+g,c.y=a+m,c.r=u.r*r}return n}_drawLine(t,e,s,i){e?s?this._drawCubicCurve(t,e,s,i):this._drawQuadraticCurve(t,e,i):this._drawStraightLine(t,i)}_getSelfLoopControlPoints(t,e,s){return ag(t.x,t.y,e,s,this._viewAngle,this._tmp)}_getQuadraticCurveControlPoint(t){return Rd(t.pos1.x,t.pos1.y,t.pos2.x,t.pos2.y,t.curvature,this._point(0,0))}_graphToScreenCoordinates(t){const e=this._width/2,s=this._height/2,i=(t.x-this._viewX)*this._viewZoom,n=(t.y-this._viewY)*this._viewZoom,r=this._viewAngleCos,o=this._viewAngleSin,a=r*i+o*n+e,l=-o*i+r*n+s;return this._point(a,l)}_blendColor(t,e){return t&&this._backgroundColor?oo(this._backgroundColor,t,e,1):t?eC(t,e):null}_getTangentOnLine(t,e,s,i,n){return e?s?this._getTangentOnCubicCurve(t,e,s,i,n):this._getTangentOnQuadraticCurve(t,e,i,n):this._getTangentOnStraightLine(t,i)}_getTangentOnStraightLine(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.sqrt(s*s+i*i);return this._point(s/n,i/n)}_getTangentOnQuadraticCurve(t,e,s,i){const n=1-i,r=n*e.x+i*s.x-(n*t.x+i*e.x),o=n*e.y+i*s.y-(n*t.y+i*e.y),a=Math.sqrt(r*r+o*o);return this._point(r/a,o/a)}_getTangentOnCubicCurve(t,e,s,i,n){const r=1-n,o=r*r,a=n*n,l=o*(e.x-t.x)+2*r*n*(s.x-e.x)+a*(i.x-s.x),d=o*(e.y-t.y)+2*r*n*(s.y-e.y)+a*(i.y-s.y),h=Math.sqrt(l*l+d*d);return this._point(l/h,d/h)}_mixPoints(t,e,s){const i=ye(t.x,e.x,s),n=ye(t.y,e.y,s);return this._point(i,n)}_getOrthogonal(t){return this._point(-t.y,t.x)}_getPointOnLine(t,e,s,i,n){return e?s?this._getPointOnCubicCurve(t,e,s,i,n):this._getPointOnQuadraticCurve(t,e,i,n):this._mixPoints(t,i,n)}_getPointOnQuadraticCurve(t,e,s,i){const n=cr(t.x,e.x,s.x,i),r=cr(t.y,e.y,s.y,i);return this._point(n,r)}_getPointOnCubicCurve(t,e,s,i,n){const r=Wm(t.x,e.x,s.x,i.x,n),o=Wm(t.y,e.y,s.y,i.y,n);return this._point(r,o)}_getTFromLengthOnCubicCurve(t,e,s,i,n,r=!0){if(!r)return 1-this._getTFromLengthOnCubicCurve(i,s,e,t,n,!0);let o=0,a=1,l=0;for(let d=0;d<10;d++){const h=(o+a)/2,u=h,c=this._getPointOnCubicCurve(t,e,s,i,u),g=Math.hypot(t.x-c.x,t.y-c.y);if(Math.abs(g-n)<.01)return h;g<n?(o=h,l=h):a=h}return l}_getTFromLengthOnQuadraticCurve(t,e,s,i){let n=t.x,r=t.y,o=0,a=0;for(let l=0;l<Ms;++l){o+=Zm;const d=cr(t.x,e.x,s.x,o),h=cr(t.y,e.y,s.y,o),u=d-n,c=h-r,g=Math.sqrt(u*u+c*c),m=a+g;if(m>i)return o-Zm*((m-i)/g);a=m,n=d,r=h}return 1}};function sC(t,e,s){const i=Math.abs(t)/Ad+Cd,n=i*i,r=s-.5,o=r*r,a=1/(16*n),l=Math.sqrt(o+a),d=.5/i*Math.sqrt(n+.25);return Math.abs(2*i)*(r*l+.5*d+a*Math.log(Math.abs((r+l)/(-.5+d))))*e}function iC(t,e,s,i,n){const r=(t.x+e.x+s.x)/3,o=(t.y+e.y+s.y)/3,a=r-e.x,l=o-e.y,d=e.x-s.x,h=e.y-s.y,u=a*a+l*l,c=(d*d+h*h)/4,g=Math.sqrt(u-c);return 2*p0*g*3.14159265359*n}function nC(t,e,s,i,n,r){const o=[];if(s&&o.push(0,s),n&&r){const a=n*e,l=r*e,d=a+l,h=t-i-s-d;let u=0;for(;u<h;)o.push(a,l),u+=d;const c=t-i-s-u,g=Math.min(a,c),m=Math.max(c-g,0);o.push(g,m)}else o.push(t-i-s,0);return i&&o.push(0,i),o}var mr=0,Eo=1,Ao=2,yn=3,Km=4,lg=0,Mu=1,rC={[mr]:{min:"NEAREST",mag:"NEAREST",mipmap:!1},[Eo]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[Ao]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[yn]:{min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:!0}},oC={[lg]:"ALPHA",[Mu]:"RGBA"};function Mr(t){return Math.ceil((t+2*rn)/fs)*fs}function aC(t,e,s,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r],l=a.x,d=a.y,h=l+i,u=d+n;let c=h<s&&u<s;if(c){for(let g=l;g<h;++g)if(e[g+d*s]===1){c=!1;break}}if(c){for(let g=d;g<u;++g)if(e[l+g*s]===1){c=!1;break}}if(c){for(let g=l;g<h;++g)for(let m=d;m<u;++m)e[g+m*s]=1;return t.splice(r,1),t.push({x:l,y:u},{x:h,y:d}),a}}return null}function Qm(t,e,s,i,n,r,o){const a=4*t,l=e>>1<<7,d=e%2<<7;o[a]=s/fs,o[a+1]=i/fs,o[a+2]=l+n/fs,o[a+3]=d+r/fs}function lC(t,e,s,i,n,r,o){i|=0,n|=0,r|=0,o|=0,e|=0;for(let a=0;a<r;++a)for(let l=0;l<o;++l){const d=4*(i+a+(n+l)*e),h=4*(a+l*r);t[d]=s[h],t[d+1]=s[h+1],t[d+2]=s[h+2],t[d+3]=s[h+3]}}function dC(t,e){let s=0,i=4;for(let r=0;r<t.length;++r){const{width:o,height:a}=t[r],l=Mr(o),d=Mr(a);s+=l*d,i=Math.max(i,Math.max(l,d))}const n=Zi(Math.max(i,Math.sqrt(s)));return Math.min(n,e)}function Jm(t,e){return Math.floor((e-t)/2)}function tf(t,e,s,i,n,r,o){const{min:a,mag:l,mipmap:d}=rC[r],h=t[oC[o]];if(o===lg){const u=new Uint8Array(n*n);for(let c=0;c<u.length;++c)u[c]=i[4*c+3];i=u}t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,h,n,n,0,h,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[l]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[a]),d&&t.generateMipmap(t.TEXTURE_2D)}function Q0(t,e,s,i,n){const r=new Uint8Array(s*s*4),o=Math.ceil(s/fs),a=new Uint8Array(o*o),l=[{x:0,y:0}];for(let d=0;d<e.length;++d){const h=e[d],u=h.id,c=Mr(h.width)/fs,g=Mr(h.height)/fs,m=aC(l,a,o,c,g);if(m){const f=h.width,p=h.height,_=h.pixels,x=c*fs,y=g*fs,b=m.x*fs+Jm(f,x),v=m.y*fs+Jm(p,y);lC(r,s,_,b,v,f,p),Qm(u,t,b,v,x,y,n)}else{if(s<i)return Q0(t,e,2*s,i,n);tn(`exceeded max WebGL texture size of ${i}; some texts/icons/images won't be displayed`),Qm(u,t,0,0,0,0,n)}}return{texture:r,size:s}}function hC(t,e,s,i){const{getDistanceFromStrokeVertically:n,getDistanceFromStrokeHorizontally:r}=t,o=e*(1-s)/2,a=(e-1)/2;for(let l=0;l<e;++l)for(let d=0;d<e;++d){const h=4*(d*e+l),u=(l-a)/o,c=(d-a)/o,g=Ws(n(u,c),-1,1),m=Ws(r(u,c),-1,1);uC(i,h,ef(g),ef(m))}}function ef(t){const e=(t+1)/2;return Math.floor(32768*e)}function uC(t,e,s,i){t[e]=s>>8,t[e+1]=s%256,t[e+2]=i>>8,t[e+3]=i%256}function J0(t,e){let s=-Math.PI/2;const i=2*Math.PI/t.length;for(const n of t){const r=s+i;e(n,s,r),s=r}}function tb(t,e,s,i,n){J0(e,((r,o,a)=>{t.beginPath(),t.moveTo(s,i),t.arc(s,i,n,o,a),t.fillStyle=r,t.fill()}))}var cC=!ls().__dummy,gC=class extends K0{constructor(t){super(t),this._canvas=ls(),this._imgCanvas=ls(),this._initCanvas(this._canvas),this._ctx=this._canvas.getContext("2d"),this._imgCtx=this._imgCanvas.getContext("2d")}static getName(){return"Canvas"}static isAvailable(){return cC}getDomElement(){return this._canvas}_render({dimensionsChanged:t}){t&&A0(this._canvas,this._width,this._height,this._pixelRatio);const e=this._ctx,s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;e.clearRect(0,0,s,i),this._backgroundColor&&this._renderBackground&&(e.fillStyle=this._backgroundColor,e.fillRect(0,0,s,i));const n=this._bufferList.getBuffersByAscendingDepth();for(const r of n)this._isBufferDisplayable(r)&&this._displayBuffer(r)}_drawRoundedRectangle(t,e,s,i,n){const r=this._ctx,o=this._pixelRatio,a=t.x*o,l=t.y*o;e*=o,s*=o;const d=this._textManager.getCornerRadius(),h=Math.min(d*o,s);e+=h/2,r.save(),r.translate(a,l),r.rotate(i),r.beginPath(),r.arc(e-h,s-h,h,0,Math.PI/2),r.arc(-e+h,s-h,h,Math.PI/2,Math.PI),r.arc(-e+h,-s+h,h,Math.PI,3*Math.PI/2),r.arc(e-h,-s+h,h,3*Math.PI/2,0),n&&(r.fillStyle=n,r.fill()),r.restore()}_drawCircle(t,e){const s=this._ctx,i=this._pixelRatio,n=t.x*i,r=t.y*i,o=e*i;s.beginPath(),s.arc(n,r,o,0,2*Math.PI)}_drawPolygon(t){const e=this._ctx,s=this._pixelRatio;e.beginPath();const i=t[0];e.moveTo(i.x*s,i.y*s);for(let n=1;n<t.length;++n){const r=t[n];e.lineTo(r.x*s,r.y*s)}e.closePath()}_drawStraightLine(t,e){const s=this._ctx,i=this._pixelRatio;s.beginPath(),s.moveTo(t.x*i,t.y*i),s.lineTo(e.x*i,e.y*i)}_drawQuadraticCurve(t,e,s){const i=this._ctx,n=this._pixelRatio;i.beginPath(),i.moveTo(t.x*n,t.y*n),i.quadraticCurveTo(e.x*n,e.y*n,s.x*n,s.y*n)}_drawCubicCurve(t,e,s,i){const n=this._ctx,r=this._pixelRatio;n.beginPath(),n.moveTo(t.x*r,t.y*r),n.bezierCurveTo(e.x*r,e.y*r,s.x*r,s.y*r,i.x*r,i.y*r)}_fill(t){const e=this._ctx;e.fillStyle=t,e.fill()}_stroke(t,e,s=[]){if(e===0)return;const i=this._ctx,n=this._pixelRatio;i.setLineDash(s.map((r=>r*this._pixelRatio))),i.lineWidth=e*n,i.strokeStyle=t,i.stroke()}_startClip(){this._ctx.save(),this._ctx.clip()}_endClip(){this._ctx.restore()}_startReverseClip(){this._ctx.save(),this._ctx.rect(0,0,this._canvas.width,this._canvas.height),this._ctx.clip("evenodd")}_endReverseClip(){this._ctx.restore()}_displayText(t,e,s,i,n,r,o,a,l,d,h){const u=this._ctx,c=this._pixelRatio,g=t.x*c,m=t.y*c,f=r*c,p=a==="center"?0:-l/2;if(h=h*this._viewZoom*c,d=d*this._viewZoom*c,u.save(),u.translate(g,m+c),u.rotate(-e),u.textBaseline="middle",u.textAlign=a,an(u,n,f,o),u.fillStyle=i,s.indexOf(`
`)!==-1){const _=s.split(`
`),x=_.length;let y=(1-x)/2*f;for(let b=0;b<x;++b)u.fillText(_[b],d+p,h+y),y+=f}else u.fillText(s,d+p,h);u.restore()}_displayImage(t,e,s,i,n,r,o){if(this._hideImages||"isDummy"in i)return;let a=i;o!==1&&(a=this._blendImageOnBackground(i,o));const l=this._ctx,d=this._pixelRatio,h=t.x*d,u=t.y*d,c=e*d,g=s*d,m=a.width*d,f=a.height*d;if(n)l.drawImage(a,h-c/2,u-g/2,c,g);else if(r){const p=h-c/2,_=u-g/2,x=h+c/2,y=u+g/2;let b=h-m/2,v=u-f/2;for(;b>p;)b-=m;for(;v>_;)v-=f;const A=v;for(;b<x;){for(;v<y;)l.drawImage(a,b,v,m,f),v+=f;b+=m,v=A}}else l.drawImage(a,h-m/2,u-f/2,m,f)}_displayPieChart(t,e,s){const i=this._ctx,n=this._pixelRatio,r=t.x*n,o=t.y*n,a=e*n*2,l=2*a;s.length===1&&(i.fillStyle=s[0],i.fillRect(r-a,o-a,l,l)),s.length>1&&tb(i,s,r,o,a)}_blendImageOnBackground(t,e){const s=this._backgroundRgba,i=`rgb(${Math.round(255*s[0])},${Math.round(255*s[1])},${Math.round(255*s[2])})`;return this._imgCanvas.width=t.width,this._imgCanvas.height=t.height,this._imgCtx.clearRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=1,this._imgCtx.fillStyle=i,this._imgCtx.fillRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=e,this._imgCtx.drawImage(t,0,0),this._imgCanvas}getImageData(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)}},eb=!1;try{eb=!!_e("svg")}catch{}var Gr="none",mC={left:"start",center:"middle",right:"end"},qs="data-element-id",sf="data-text-component",fC="node-text",pC="edge-text",_C="badge-text";function fr(t){return Math.round(1e3*t)/1e3}function nf(t,e,s,i,n,r){const o=_e("image");return o.setAttribute("width",fr(i)),o.setAttribute("height",fr(n)),o.setAttribute("x",fr(e)),o.setAttribute("y",fr(s)),o.setAttribute("href",t),r&&r.appendChild(o),o}function yC(t,e,s,i,n,r=1,o){const a=_e("rect");return a.setAttribute("x",t),a.setAttribute("y",e),a.setAttribute("width",s),a.setAttribute("height",i),a.setAttribute("fill",n),a.setAttribute("fill-opacity",r),o&&o.appendChild(a),a}var xC=class extends K0{constructor(t){super(t),this._svg=_e("svg"),this._defs=_e("defs"),this._styles=_e("g",{class:"styles"}),this._background=_e("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"}),this._currentElementId="0",this._currentClipPathId=null,this._clipPathCounter=0,this._defs.appendChild(this._styles),this._svg.setAttribute("pointer-events","none"),this._svg.style.userSelect="none",this._svg.appendChild(this._defs),this._svg.appendChild(this._background),this._clear()}static getName(){return"SVG"}static isAvailable(){return eb}getDomElement(){return this._svg}_render({dimensionsChanged:t}){if(t&&Lc(this._svg,{width:this._width,height:this._height}),this._backgroundColor&&this._renderBackground){const s=er(this._backgroundColor);this._background.setAttribute("fill",s.color),this._background.setAttribute("fill-opacity",s.opacity)}const e=this._bufferList.getBuffersByAscendingDepth();this._clear(),this._svg.removeChild(this._container);for(let s=0;s<e.length;++s){const i=e[s];this._isBufferDisplayable(i)&&this._displayBuffer(i)}this._svg.appendChild(this._container)}_clear(){this._container&&this._svg.removeChild(this._container),this._container=_e("g"),this._svg.appendChild(this._container),this._clipPaths&&this._defs.removeChild(this._clipPaths),this._clipPaths=_e("g"),this._defs.appendChild(this._clipPaths),this._clipPaths.setAttribute("class","clip-paths"),this._filters&&this._defs.removeChild(this._filters),this._filters=_e("g"),this._defs.appendChild(this._filters)}_displayElement(t,e){this._currentElementId=t.id>=0?`n${t.id}`:"e"+-t.id,super._displayElement(t,e)}_addBackgroundBlendingFilter(t){const e=ys(this._backgroundColor),s=t,i=1-t,n=[s,0,0,0,e[0]*i,0,s,0,0,e[1]*i,0,0,s,0,e[2]*i,0,0,0,1,0].join(" "),r=`filter-${this._currentElementId}`,o=_e("filter",{id:r}),a=_e("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:n});return o.appendChild(a),this._filters.appendChild(o),r}_drawRoundedRectangle(t,e,s,i,n){const r=t.x,o=t.y,a=Math.min(this._textManager.getCornerRadius(),s);e+=a/2;const l=_e("path"),d=`M ${r+e-a} ${o+s}     A ${a} ${a} 0 0 0 ${r+e} ${o+s-a}     L ${r+e} ${o-s+a}     A ${a} ${a} 0 0 0 ${r+e-a} ${o-s}     L ${r-e+a} ${o-s}     A ${a} ${a} 0 0 0 ${r-e} ${o-s+a}     L ${r-e} ${o+s-a}     A ${a} ${a} 0 0 0 ${r-e+a} ${o+s}     L ${r+e-a} ${o+s}`;l.setAttribute("d",d),l.setAttribute("fill",Gr),l.setAttribute("transform",`rotate(${hu(i)} ${t.x} ${t.y})`),l.setAttribute(qs,this._currentElementId),this._container.appendChild(l),this._element=l,n&&this._fill(n)}_drawCircle(t,e){const{x:s,y:i}=t,n=`M ${s-e}, ${i} a ${e},${e} 0 1,0 ${2*e},0 a ${e},${e} 0 1,0 -${2*e},0`,r=_e("path");r.setAttribute("d",n),r.setAttribute("fill",Gr),r.setAttribute(qs,this._currentElementId),this._container.appendChild(r),this._element=r}_drawPolygon(t,e){const s=_e("path");let i="";for(let n=0;n<t.length;n++){const{x:r,y:o}=t[n];i+=`${n===0?"M":"L"}${r},${o} `}i+="Z",s.setAttribute("d",i),s.setAttribute(qs,this._currentElementId),s.setAttribute("fill",Gr),e&&s.setAttribute(sf,!0),this._container.appendChild(s),this._element=s}_drawStraightLine(t,e){const s=_e("path"),i=`M ${t.x},${t.y} L${e.x},${e.y}`;s.setAttribute("d",i),s.setAttribute(qs,this._currentElementId),this._container.appendChild(s),this._element=s}_drawQuadraticCurve(t,e,s){const i=_e("path"),n=`M ${t.x},${t.y} Q${e.x},${e.y} ${s.x},${s.y}`;i.setAttribute("d",n),i.setAttribute("fill",Gr),i.setAttribute(qs,this._currentElementId),this._container.appendChild(i),this._element=i}_drawCubicCurve(t,e,s,i){const n=_e("path"),r=`M ${t.x},${t.y} C${e.x},${e.y} ${s.x},${s.y} ${i.x},${i.y}`;n.setAttribute("d",r),n.setAttribute("fill",Gr),n.setAttribute(qs,this._currentElementId),this._container.appendChild(n),this._element=n}_fill(t){const e=er(t);this._element.setAttribute("fill",e.color),this._element.setAttribute("fill-opacity",e.opacity),this._currentClipPathId&&this._element.setAttribute("clip-path",`url(#${this._currentClipPathId})`)}_stroke(t,e,s=[]){if(e===0)return;const i=this._element;i.setAttribute("stroke-width",e);const n=er(t);i.setAttribute("stroke",n.color),i.setAttribute("stroke-opacity",n.opacity),s.length>0&&i.setAttribute("stroke-dasharray",s.map(fr).toString())}_startClip(){const t=_e("clipPath"),e=this._element.cloneNode(!1);this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endClip(){this._currentClipPathId=null}_startReverseClip(){const t=_e("clipPath"),e=this._element.cloneNode(!1),s=e.getAttribute("d");e.setAttribute("clip-rule","evenodd"),e.setAttribute("d",`${s} M 0 0 L ${this._width} 0 L ${this._width} ${this._height} L 0 ${this._height}`),this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endReverseClip(){this._currentClipPathId=null}_displayText(t,e,s,i,n,r,o="normal",a,l,d,h,u){const c=_e("g");c.setAttribute(qs,this._currentElementId),c.setAttribute(sf,!0);let g=this._currentElementId[0]==="n"?fC:pC;u&&(g+=" "+_C),c.setAttribute("class",g);const m=er(i),f=m.opacity,p=er(m.color),_=t.x+d*this._viewZoom,x=t.y+1+h*this._viewZoom,y=fr(_);if(c.setAttribute("font-family",n),c.setAttribute("font-size",r),o==="normal"||o==="italic")c.setAttribute("font-style",o);else if(o.includes("italic")){c.setAttribute("font-style","italic");const w=o.replace("italic","").trim();w&&c.setAttribute("font-weight",w)}else c.setAttribute("font-weight",o);c.setAttribute("fill",p.color),c.setAttribute("fill-opacity",f),e&&c.setAttribute("transform",`rotate(${hu(-e)} ${_}, ${x})`),c.setAttribute("text-anchor",mC[a]||"middle"),c.setAttribute("dominant-baseline","middle");const b=s.split(`
`),v=b.length,A=x-(v+1)/2*r,S=a==="center"?0:-l/2;for(let w=0;w<v;w++){const I=_e("text");I.appendChild(Mc(b[w])),I.setAttribute("x",y+S),I.setAttribute("y",A+(w+1)*r),c.appendChild(I)}this._currentClipPathId&&c.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(c)}_displayImage(t,e,s,i,n,r,o){const a=t.x,l=t.y;if(this._hideImages||!("isDummy"in i)&&(!i.width||!i.height))return;const d=e,h=s;let u,c=i.width,g=i.height;if(n&&(c=d,g=h),r){const m=a-d/2,f=l-h/2,p=a+d/2,_=l+h/2;let x=a-c/2,y=l-g/2;for(u=_e("g"),u.setAttribute(qs,this._currentElementId);x>m;)x-=c;for(;y>f;)y-=g;const b=y;for(;x<p;){for(;y<_;)nf(i.src,x,y,c,g,u),y+=g;y=b,x+=c}}else u=nf(i.src,a-c/2,l-g/2,c,g),u.setAttribute(qs,this._currentElementId);if(this._currentClipPathId&&u.setAttribute("clip-path",`url(#${this._currentClipPathId})`),o!==1){const m=this._addBackgroundBlendingFilter(o);u.setAttribute("filter",`url(#${m})`)}this._container.appendChild(u)}_displayPieChart(t,e,s){const i=2*e,n=2*i,r=t.x,o=t.y;let a;const l=_e("g");l.setAttribute(qs,this._currentElementId),s.length===1&&(a=yC(r-i,o-i,n,n,s[0],1,l)),s.length>1&&J0(s,((d,h,u)=>{const c=r+e*Math.cos(u),g=o+e*Math.sin(u),m=r+e*Math.cos(h),f=o+e*Math.sin(h),p=u-h<=Math.PI?0:1,_=`M ${c},${g} A ${e},${e} 0 ${p} 0 ${m},${f} L ${r},${o} L ${c},${g}`;a=_e("path"),a.setAttribute("d",_),a.setAttribute("fill",d),a.setAttribute("stroke-width",0),l.appendChild(a)})),this._currentClipPathId&&l.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(l)}},bC=6,vC=class{constructor({gl:t,ext:e,staticProgram:s,animationProgram:i}){this._version=0,this._used=!1,this._dataBufferChanged=!1,this._gl=t,this._ext=e,this._staticProgram=s,this._animationProgram=i,this._glBuffer=this._gl.createBuffer()}setDataBuffer(t){this._dataBuffer!==t&&(this._program=t.animated?this._animationProgram:this._staticProgram,this._dataBuffer=t,this._dataBufferChanged=!0,t.hasSideData()&&!this._sideGlBuffer?this._sideGlBuffer=this._gl.createBuffer():!t.hasSideData()&&this._sideGlBuffer&&(this._gl.deleteBuffer(this._sideGlBuffer),delete this._sideGlBuffer))}setPrograms(t,e){this._staticProgram=t,this._animationProgram=e}markAsUnused(){return this._used=!1,this}getProgram(){return this._program}markAsUsed(){return this._used=!0,this}isUsed(){return this._used}draw(){const t=this._gl,e=this._dataBuffer.type,s=e===Mn,i=s?this._dataBuffer.getNbSideElementsPerMainElement():1,n=e===Ql?Ms:1,r=this._dataBuffer.getSize(),o=this._dataBuffer.stencilUsage,a=this._dataBuffer.version,l=this._version!==a||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:l?this._dataBuffer.getByteArray():null,divisor:i}),this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:l&&s?this._dataBuffer.getSideByteArray():null,divisor:1}),this._program.setupStencil(o),l&&(this._version=a,this._dataBufferChanged=!1),this._ext.drawArraysInstancedANGLE(t.TRIANGLES,0,bC*n,r*i)}destroy(){this._gl.deleteBuffer(this._glBuffer),this._sideGlBuffer&&this._gl.deleteBuffer(this._sideGlBuffer)}},EC={byte:1,ubyte:1,short:2,ushort:2,ulong:4,float:4},AC={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",ulong:"UNSIGNED_LONG",float:"FLOAT"},rf=class{constructor({gl:t,ext:e,specialGlBuffers:s,metaData:i,programWrapper:n}){this._stencilUsage=xr,this._gl=t,this._ext=e,this._specialGlBuffers=s,this._metaData=ke(i),this._programWrapper=n}_finishInit(){const t=this._gl,e=this._ext,s=this._programWrapper.getError();if(s)throw new Error(`WebGL compilation at step "${s.step}:
${s.message}"`);const i=this._programWrapper.getProgram();this._program=i,t.useProgram(i),this._metaData.attributes.forEach((o=>{o.location=t.getAttribLocation(this._program,o.name),o.byteSize=o.size*EC[o.type],o.glType=AC[o.type]})),this._specialAttributes=this._createSpecialAttributesFunctions();const n=[],r=[];for(const o of this._metaData.attributes)o.location!==-1&&(o.name.startsWith("a_text")?r.push(o):n.push(o));this._baseAttributes=oh(n,t,e),this._textAttributes=oh(r,t,e),this._setupUniforms=wC(this._metaData.uniforms,t,i)}_createSpecialAttributesFunctions(){return oh([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3,type:"byte",name:"special"}],this._gl,this._ext)}startPass(t){this._program||this._finishInit(),this._gl.useProgram(this._program),this._resetStencil(),this._setupUniforms(this._gl,t),this._specialAttributes.enable(this._gl),this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)}_setupAttributes(t,{glBuffer:e,dataBuffer:s,divisor:i}){t.enabled&&!e?t.disable(this._gl):!t.enabled&&e&&t.enable(this._gl),e&&t.setup(e,s,i)}setupBaseAttributes(t){this._setupAttributes(this._baseAttributes,t)}setupTextAttributes(t){this._setupAttributes(this._textAttributes,t)}_resetStencil(){const t=this._gl;this._stencilUsage=xr,t.disable(t.STENCIL_TEST)}setupStencil(t){if(t!==this._stencilUsage){const e=this._gl;t!==xr?(e.enable(e.STENCIL_TEST),t===v0?(e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilFunc(e.ALWAYS,1,1)):t===E0&&(e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilFunc(e.EQUAL,0,1))):e.disable(e.STENCIL_TEST),this._stencilUsage=t}}endPass(){const t=this._gl;this._specialAttributes.disable(t),this._baseAttributes.disable(t),this._textAttributes.disable(t)}};function SC(t,e,s){return(i,n,r)=>{let o=0,a=0;for(let l=0;l<t.length;l++)a+=t[l].byteSize;e.bindBuffer(e.ARRAY_BUFFER,i),n&&e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);for(let l=0;l<t.length;l++){const{location:d,size:h,glType:u,byteSize:c}=t[l];e.vertexAttribPointer(d,h,e[u],!1,a,o),o+=c,s.vertexAttribDivisorANGLE(d,r)}}}function wC(t,e,s){const i={};for(let n=0;n<t.length;++n){const{id:r,name:o}=t[n],a=e.getUniformLocation(s,o);a&&(i[r]=a)}return(n,r)=>{for(let o=0;o<t.length;++o){const{id:a,type:l}=t[o],d=i[a],h=r[a];if(d)switch(l){case"int":case"sampler2D":n.uniform1i(d,h);break;case"float":n.uniform1f(d,h);break;case"vec2":n.uniform2f(d,h[0],h[1]);break;case"vec3":n.uniform3f(d,h[0],h[1],h[2]);break;case"vec4":n.uniform4f(d,h[0],h[1],h[2],h[3])}}}}function TC(t){return e=>{for(let s=0;s<t.length;s++){const i=t[s].location;e.enableVertexAttribArray(i)}}}function CC(t){return e=>{for(let s=0;s<t.length;++s){const i=t[s].location;e.disableVertexAttribArray(i)}}}function oh(t,e,s){const i=TC(t),n=CC(t);return{enable(r){i(r),this.enabled=!0},disable(r){n(r),this.enabled=!1},setup:SC(t,e,s),enabled:!1}}var ah=`#define D3D9_FIX 0
precision highp float;
precision mediump int;
uniform vec3 u_backgroundColor;
uniform sampler2D u_patternNearestTexture;
uniform sampler2D u_patternLinearTexture;
uniform sampler2D u_patternLinearSdfTexture;
uniform sampler2D u_patternMipmapTexture;
uniform sampler2D u_shapeTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying vec4 f;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SDF_GAMMA = 0.0;
const float EPSILON = 0.000000001;
const float SDF_BUFFER = (256.0 - 64.0) / 256.0; 
vec4 af(in vec4 ag, in vec4 ah) {
float ai = ah.a;
float aj = ag.a + EPSILON;
float ak = min(ai + aj, 1.0);
float r = ai / ak;
return vec4(mix(ag.rgb, ah.rgb, r), ak);
}
float al(in float am, in float an) {
float ao = (am * 256.0 + an) * 256.0;
float ap = ao / 32768.0;
return ap * 2.0 - 1.0;
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
float at(float au) {
float bh = 2.;
vec2 bi = abs(c.rg) - c.ba - vec2(bh) + vec2(au);
float bj = min(max(bi.x, bi.y), 0.0) + length(max(bi, 0.0)) - au;
return smoothstep(0.1, .5, (1. - bj) / 10.);
}
void main() {
#if D3D9_FIX
#else
float br = o.x;
float bs = o.y;
float bt = r.x;
float bu = r.y;
#endif
vec4 bx = texture2D(u_shapeTexture, d);
float by = al(bx.b, bx.a) * s.x;
float bz = al(bx.r, bx.g) * s.y;
float ch = float(f.z > EPSILON);
float ci = float(f.w > EPSILON);
float cj = 1. - smoothstep(
0.01,
0.25760,
distance(f.xy * f.z - vec2(0.0586), d * f.z)
);
cj = cj * 2.5 - 1.5;
cj *= 0.5;
cj *= s.x;
float ck = at(g) ;
vec4 cl = a;
vec4 cm = b;
if (u > -EPSILON) {
vec2 cq = e;
float dd =
step(m.x, cq.x) *
step(cq.x, n.x) *
step(m.y, cq.y) *
step(cq.y, n.y);
float de = dd;
vec4 dh;
if (aq(u, FILTER_NEAREST)) {
dh = texture2D(u_patternNearestTexture, cq);
} else if (aq(u, FILTER_LINEAR)) { 
dh = texture2D(u_patternLinearTexture, cq);
} else if (aq(u, FILTER_LINEAR_SDF)) { 
dh = texture2D(u_patternLinearSdfTexture, cq);
dh.a = smoothstep(SDF_BUFFER - t, SDF_BUFFER + t, dh.a);
} else if (aq(u, FILTER_MIPMAP)) { 
dh = texture2D(u_patternMipmapTexture, cq);
}
dh.rgb += c.rgb;
dh.a *= de;
cl = af(cl, dh);
}
float dw = (1. - ch) * min(by, bz)
+ ch * cj;
dw = (1. - ci) * dw + ci * ck;
float ek = clamp(dw, 0.0, 1.0);
float en = clamp(dw - l, 0.0, 1.0);
float eo = ek - en;
eo = 1.0 - clamp(dw - l, 0.0, 1.0);
cl.a *= en;
cm.a *= eo * step(EPSILON, l);
vec4 ew = af(cl, cm);
float ex = ek;
ew.rgb = mix(u_backgroundColor, ew.rgb, br);
if (q > EPSILON) {
float fk = fract(bu) * q;
float fl = clamp(min(fk, bt - fk), 0.0, 1.0);
ex *= fl;
}
if (p < 0.0 || p > 1.0 || ex < EPSILON) {
discard;
}
ew.a *= ex;
ew.rgb *= ew.a;
gl_FragColor = ew;
}
`,lh=`#define D3D9_FIX 0
#define ANIMATED 0
precision highp float;
precision mediump int;
attribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_final_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_prev_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*float*/ vec2 a_animationBeginTime_animationDuration; 
attribute /*ushort*/ vec4 a_animationEasing; 
attribute /*ushort*/ vec3 a_text_charId_charOffsetXY; 
attribute vec3 a_vertexInfo;
uniform float u_viewWidth;
uniform float u_viewHeight;
uniform float u_viewX;
uniform float u_viewY;
uniform float u_viewAngle;
uniform float u_viewZoom;
uniform float u_currentTime;
uniform float u_pixelRatio;
uniform sampler2D u_patternInfoTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
varying vec4 f;
const float EPSILON = 0.000001;
const float INFINITY = 10000000.0;
const float PI = 3.14159265359;
const float P2_17 = 131072.0;
const float P2_16 = 65536.0;
const float P2_14 = 32768.0;
const float P2_12 = 4096.0;
const float P2_8 = 256.0;
const float P2_7 = 128.0;
const float P2_6 = 64.0;
const float P2_5 = 32.0;
const float P2_4 = 16.0;
const float P2_3 = 8.0;
const float P2_2 = 4.0;
const float P2_1 = 2.0;
const float MAX_FLOAT16_OFFSET = 16384.0;
const float MAX_FLOAT16 = 65535.0;
const float MAX_PROGRESS = 1.0;
uniform float BYTES_TO_COORD;
uniform float BYTES_TO_SCALED_SIZE;
uniform float BYTES_TO_MIN_VISIBLE_SIZE;
uniform float BYTES_TO_SYMBOLIC_SIZE;
uniform float BYTES_TO_CURVATURE;
uniform float BYTES_TO_DASH_LENGTH;
uniform float BYTES_TO_GAP_LENGTH;
uniform float BYTES_TO_PATTERN_SCALE;
uniform float PATTERN_POSITION_UNIT_SIZE;
uniform float PATTERN_INFO_TEXTURE_SIZE;
uniform float PATTERN_NEAREST_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;
uniform float PATTERN_MIPMAP_TEXTURE_SIZE;
uniform float ROUNDED_BOX_RADIUS;
const float BYTES_TO_OFFSET_ANGLE = 0.0;
const float BYTES_TO_COLOR = 0.0;
const float SDF_FONT_SIZE = 0.0;
const float SDF_GAMMA = 0.0;
const float CURVATURE_RATIO = 0.0;
const float PATTERN_PADDING = 0.0;
const float TEXT_WIDTH_MULTIPLIER = 0.0;
const float TEXT_HEIGHT_MULTIPLIER = 0.0;
const float SELF_LOOP_CURVATURE_RATIO = 0.0;
const float EDGE_ARROW_SIZE_RATIO = 0.0;
const float EDGE_MIN_TIP_SIZE = 0.0;
const float CURVE_SUBDIVISIONS = 0.0;
const float PIECE_NODE_COMPONENT = 0.0;
const float PIECE_TEXT_BOX = 0.0;
const float PIECE_EDGE_BODY = 0.0;
const float PIECE_EDGE_HEAD = 0.0;
const float PIECE_EDGE_TAIL = 0.0;
const float PIECE_EDGE_TEXT = 0.0;
const float MAX_TEXT_SIZE = 0.0;
const float BYTES_TO_TEXT_OFFSET_X = 0.0;
const float BYTES_TO_TEXT_OFFSET_Y = 0.0;
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SHAPE_TEXTURE_SIZE = 0.0;
const float SIMPLE_SHAPE_SAMPLING_SIZE = 0.0;
const float COMPLEX_SHAPE_SAMPLING_SIZE = 0.0;
const float SHAPE_SAMPLING_BUFFER_RATIO = 0.0;
const float MAX_SHAPES = 0.0;
const float FIRST_COMPLEX_SHAPE_ID = 0.0;
const float SELF_LOOP_TO_CIRCLE_APPROX = 0.0;
const float NB_SHAPES_BY_SIDE = SHAPE_TEXTURE_SIZE / COMPLEX_SHAPE_SAMPLING_SIZE;
const float SHAPE_FILL_PERCENT = 1.0 - SHAPE_SAMPLING_BUFFER_RATIO;
const float T_STEP_PER_CURVE_PIECE = 1.0 / CURVE_SUBDIVISIONS;
const float HEAD_TAIL_PX_ADJUST = 1.5;
const float SDF_SMOOTH_FACTOR = 2.0;
struct pv {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
};
struct qe {
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
};
struct qm {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
float dc;
float qn;
float qo;
float qp;
float qq;
float qr;
float qs;
vec4 cl;
vec4 cm;
vec4 dh;
float qt;
float qu;
float qv;
float qw;
float qx;
float qy;
float qz;
float ra;
float rb;
float rc;
float rd;
float re;
float rf;
float rg;
float rh;
float ri;
float rj;
float rk;
float rl;
};
struct rm {
float eu;
vec2 rn;
vec4 cl;
vec4 cm;
float dc;
float ro;
float rp;
float py;
float rq;
vec2 rr;
float rs;
vec2 cq;
vec2 rt;
vec2 ru;
float rv;
float rw;
vec4 dh;
vec2 bd;
float rx;
float or;
vec2 ry;
vec2 rz;
vec2 sa;
};
float sb(float nq, float sc, float sd) {
float se = mod(nq, pow(2.0, sd));
return floor(se / pow(2.0, sc));
}
pv sf(float nq) {
pv sg;
sg.pw = sb(nq, 0.0, 4.0);
sg.px = sb(nq, 4.0, 8.0);
sg.py = sb(nq, 8.0, 10.0);
sg.pz = sb(nq, 10.0, 12.0);
sg.qa = sb(nq, 12.0, 13.0);
sg.qb = sb(nq, 13.0, 14.0);
sg.qc = sb(nq, 14.0, 15.0);
sg.qd = sb(nq, 15.0, 16.0);
return sg;
}
qe sh(float nq) {
qe sg;
sg.qf = sb(nq, 0.0, 8.0);
sg.qg = sb(nq, 8.0, 11.0);
sg.qh = sb(nq, 11.0, 12.0);
sg.qi = sb(nq, 12.0, 13.0);
sg.qj = sb(nq, 13.0, 14.0);
sg.qk = sb(nq, 14.0, 15.0);
sg.ql = sb(nq, 15.0, 16.0);
return sg;
}
float si(float ll) {
float sj = mod(floor(ll / 32768.0), 2.0) == 1.0 ? -1.0 : 1.0; 
float sl = mod(floor(ll / 1024.0), 32.0); 
float sn = mod(ll, 1024.0); 
float sq = float(sl == 0.0 || sl == 31.0);
return (1. - sq)
* sj * pow(2.0, sl - 15.0) * (1.0 + sn / 1024.0);
}
vec4 sr(in float nq) {
return vec4(
sb(nq, 0.0, 4.0),
sb(nq, 4.0, 8.0),
sb(nq, 8.0, 12.0),
sb(nq, 12.0, 16.0)
);
}
vec2 ss(in float nq) {
return vec2(mod(nq, 256.0), floor(nq / 256.0));
}
vec2 st(in float nq) {
float su = floor(nq / P2_6);
float sv = nq - (su * P2_6);
return vec2(su, sv);
}
vec2 sw(in float nq) {
float sx = floor(nq / P2_7);
float sy = nq - (sx * P2_7);
return vec2(sx, sy);
}
vec2 sz(in vec2 ta, in float tb) {
float tc = cos(tb);
float td = sin(tb);
return vec2(tc * ta.x + td * ta.y, -td * ta.x + tc * ta.y);
}
vec4 te(in vec4 tf) {
return floor(tf / 256.0) - 128.0;
}
vec4 tg(in vec4 tf) {
return mod(tf, 256.0) - 128.0;
}
float th(float nq) {
return nq - 128.0;
}
vec2 th(vec2 nq) {
return nq - 128.0;
}
vec2 ti(vec2 tj) {
return vec2(-tj.y, tj.x);
}
vec2 tk(vec2 tl, vec2 ih, vec2 tm, float t) {
float tn = 1.0 - t;
return (tn * tn * tl) + (2.0 * tn * t * ih) + (t * t * tm);
}
vec2 to(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
float tn = 1.0 - t;
float tr = tn * tn;
float ts = tr * tn;
float tt = t * t;
float tu = tt * t;
return (ts * tl) + (3.0 * tr * t * tp) + (3.0 * tn * tt * tq) + (tu * tm);
}
vec2 tv(vec2 tl, vec2 ih, vec2 tm, float t) {
float tn = (1.0 - t);
vec2 ta = (tn * ih + t * tm) - (tn * tl + t * ih);
return normalize(ta);
}
vec2 tw(vec2 tl, vec2 ih, vec2 tm, float t) {
return ti(tv(tl, ih, tm, t));
}
vec2 tx(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
float tn = 1.0 - t;
float tr = tn * tn;
float tt = t * t;
vec2 ta = tr * (tp - tl) + 2.0 * tn * t * (tq - tp) + tt * (tm - tq);
return normalize(ta);
}
vec2 ty(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
return ti(tx(tl, tp, tq, tm, t));
}
float uj(float qr, float uk, float t) {
float y = abs(qr) / CURVATURE_RATIO + EPSILON;
float qw = y * y;
float tn = t - 0.5;
float tr = tn * tn;
float ul = 1.0 / (16.0 * qw);
float um = sqrt(tr + ul);
float un = (0.5 / y) * sqrt(qw + 0.25);
float uo = (abs(2.0 * y)) * ((tn * um) + (0.5 * un) + (ul * log(abs((tn + um) / (-0.5 + un)))));
return uo * uk;
}
float uz(vec2 va, vec2 vb, vec2 vc, vec2 vd) {
bool vk = abs(va.x - vb.x - vc.x + vd.x) + abs(va.y - vb.y - vc.y + vd.y) < EPSILON;
float vl = 9.0 * pow(vb.x - va.x, 2.0); 
float vo = pow(-243.0 * va.x + 189.0 * vb.x + 51.0 * vc.x + 3.0 * vd.x, 2.0) / 10000.0; 
float vp = pow(-48.0 * va.x + 24.0 * vb.x + 21.0 * vc.x + 3.0 * vd.x, 2.0) / 625.0; 
float vq = pow(-147.0 * va.x + 21.0 * vb.x + 99.0 * vc.x + 27.0 * vd.x, 2.0) / 10000.0; 
float vr = pow(-27.0 * va.x - 9.0 * vb.x + 24.0 * vc.x + 12.0 * vd.x, 2.0) / 625.0; 
float vs = (9.0 / 16.0) * pow(vc.x + vd.x - va.x - vb.x, 2.0); 
float vt = 9.0 * pow(vb.y - va.y, 2.0); 
float vv = pow(-243.0 * va.y + 189.0 * vb.y + 51.0 * vc.y + 3.0 * vd.y, 2.0) / 10000.0; 
float vw = pow(-48.0 * va.y + 24.0 * vb.y + 21.0 * vc.y + 3.0 * vd.y, 2.0) / 625.0; 
float vx = pow(-147.0 * va.y + 21.0 * vb.y + 99.0 * vc.y + 27.0 * vd.y, 2.0) / 10000.0; 
float vy = pow(-27.0 * va.y - 9.0 * vb.y + 24.0 * vc.y + 12.0 * vd.y, 2.0) / 625.0; 
float vz = (9.0 / 16.0) * pow(vc.y + vd.y - va.y - vb.y, 2.0); 
float wa = sqrt(vl + vt); 
float wc = sqrt(vo + vv); 
float wd = sqrt(vp + vw); 
float we = sqrt(vq + vx); 
float wf = sqrt(vr + vy); 
float wg = sqrt(vs + vz); 
if(vk)
return (5.0 / 2993760.0) *
(32134.0 * wa +
212600.0 * wc -
97050.0 * wd +
544800.0 * we -
521100.0 * wf +
427368.0 * wg);
float wh = pow(-12.0 * va.x - 24.0 * vb.x + 9.0 * vc.x + 27.0 * vd.x, 2.0) / 625.0; 
float wi = pow(-27.0 * va.x - 99.0 * vb.x - 21.0 * vc.x + 147.0 * vd.x, 2.0) / 10000.0; 
float wj = pow(-3.0 * va.x - 21.0 * vb.x - 24.0 * vc.x + 48.0 * vd.x, 2.0) / 625.0; 
float wk = pow(-3.0 * va.x - 51.0 * vb.x - 189.0 * vc.x + 243.0 * vd.x, 2.0) / 10000.0; 
float wl = 9.0 * pow(vd.x - vc.x, 2.0); 
float wm = pow(-12.0 * va.y - 24.0 * vb.y + 9.0 * vc.y + 27.0 * vd.y, 2.0) / 625.0; 
float wn = pow(-27.0 * va.y - 99.0 * vb.y - 21.0 * vc.y + 147.0 * vd.y, 2.0) / 10000.0; 
float wo = pow(-3.0 * va.y - 21.0 * vb.y - 24.0 * vc.y + 48.0 * vd.y, 2.0) / 625.0; 
float wp = pow(-3.0 * va.y - 51.0 * vb.y - 189.0 * vc.y + 243.0 * vd.y, 2.0) / 10000.0; 
float wq = 9.0 * pow(vd.y - vc.y, 2.0); 
float wr = sqrt(wh + wm); 
float ws = sqrt(wi + wn); 
float wt = sqrt(wj + wo); 
float wu = sqrt(wk + wp); 
float wv = sqrt(wl + wq); 
return (5.0 / 2993760.0) *
(16067.0 * (wa + wv) +
106300.0 * (wc + wu) -
48525.0 * (wd + wt) +
272400.0 * (we + ws) -
260550.0 * (wf + wr) +
427368.0 * wg);
}
float ww(float nq) {
return nq - 32.0;
}
float wx(float nq) {
return nq - 512.0;
}
float wy(float nq) {
return nq - P2_14;
}
void wz() {
gl_Position = vec4(-10.0, -10.0, 1.0, 1.0);
}
vec4 xa(vec2 xb) {
return vec4(((vec2(xb.x, u_viewHeight - xb.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);
}
float xf(float ar, float as) {
return step(ar - EPSILON, as) * step(as, ar + EPSILON);
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
bool xg(float nq) {
return nq > 0.5;
}
vec2 xh(vec2 xi) {
return sz((xi - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;
}
float xj(float or) {
return max(EDGE_MIN_TIP_SIZE, or * EDGE_ARROW_SIZE_RATIO);
}
float xk(float xl, float xm) {
return xl * BYTES_TO_SCALED_SIZE * u_viewZoom + xm;
}
float xn(float xl, float xm) {
return xl * BYTES_TO_SCALED_SIZE * MAX_FLOAT16 / MAX_FLOAT16_OFFSET * u_viewZoom + xm;
}
float xo(float xl, float xm) {
return min(xl * BYTES_TO_SCALED_SIZE * MAX_FLOAT16 / MAX_FLOAT16_OFFSET * u_viewZoom, xm);
}
float xu(float ro, float xs, float xt) {
float xv = xt - xs;
float a = 1.0 / xv;
float b = -xs / xv;
return ro * a + b;
}
struct xw {
vec2 vb;
vec2 vc;
};
xw xx(vec2 xy, float au, float qr) {
xw ns;
float xz = (au + au / SELF_LOOP_CURVATURE_RATIO * qr) * SELF_LOOP_CURVATURE_RATIO;
float ya = -u_viewAngle + PI;
float yb = -u_viewAngle + PI / 2.0;
ns.vb = xy + vec2(cos(ya), sin(ya)) * xz;
ns.vc = xy + vec2(cos(yb), sin(yb)) * xz;
return ns;
}
float yc(vec2 yd, vec2 ye, vec2 yf, vec2 yg, float yh) {
const int MAX_ITERATIONS = 10; 
const float EPSILON = 0.01; 
float yo = 0.0;
float cf = 1.0;
float yp = 0.0;
for (int yq = 0; yq < MAX_ITERATIONS; yq++) {
float yr = (yo + cf) * 0.5;
vec2 ys = to(yd, ye, yf, yg, yr);
float yt = distance(yd, ys);
if (abs(yt - yh) < EPSILON) {
return yr;
}
if (yt < yh) {
yo = yr;
yp = yr;
} else {
cf = yr;
}
}
return yp;
}
float za(vec2 yd, vec2 ye, vec2 yf, vec2 yg, float yh, bool zb) {
if (!zb) {
return 1.0 - yc(yg, yf, ye, yd, yh);
}
return yc(yd, ye, yf, yg, yh);
}
qm ze(
vec4 zf,
vec4 zg,
vec4 zh,
vec4 zi,
vec4 zj,
vec4 zk,
vec3 zl
) {
qm a;
pv bx = sf(zf.x);
qe zm = sh(zf.y);
vec4 zn = sr(zf.z);
vec2 zo = ss(zf.w);
a.pw = bx.pw;
a.px = bx.px;
a.py = bx.py;
a.pz = bx.pz;
a.qa = bx.qa;
a.qb = bx.qb;
a.qc = bx.qc;
a.qd = bx.qd;
a.qf = zm.qf;
a.qg = zm.qg;
a.qh = zm.qh;
a.qi = zm.qi;
a.qj = zm.qj;
a.qk = zm.qk;
a.ql = zm.ql;
a.dc = zn.x;
a.qn = zn.y;
a.qo = zn.z;
a.qp = zn.w;
a.qq = zo.x;
a.qr = zo.y;
a.qs = zg.x;
a.cl = sr(zg.y);
a.cm = sr(zg.z);
a.dh = sr(zg.w);
a.qt = zh.x;
a.qu = zh.y;
a.qv = zh.z;
a.qw = zh.w;
a.qx = si(zi.x);
a.qy = zi.y;
a.qz = si(zi.z);
a.ra = zi.w;
a.rb = zj.x;
a.rc = zj.y;
a.rd = zj.z;
a.re = zj.w;
a.rf = zk.x;
a.rg = wy(zk.y);
a.rk = wy(zk.z);
a.rl = wy(zk.w);
a.rh = zl.x;
float x = zl.y;
float y = mod(x, P2_8);
if (zl.z > 0.0) x += zl.z * P2_16;
a.ri = ((x - y) / P2_8) - P2_16;
a.rj = (y - P2_7) * BYTES_TO_TEXT_OFFSET_Y;
return a;
}
bool aar(const in qm a, out rm ns) {
float pw = a.pw;
float px = a.px;
float py = a.py * BYTES_TO_DASH_LENGTH;
float pz = a.pz * BYTES_TO_GAP_LENGTH;
float qa = a.qa;
float qb = a.qb;
float qc = a.qc;
float qd = a.qd;
float qf = a.qf * BYTES_TO_PATTERN_SCALE;
float qg = a.qg * BYTES_TO_OFFSET_ANGLE;
float qh = a.qh;
float qi = a.qi;
float qj = a.qj;
float qk = a.qk;
float ql = a.ql;
float dc = a.dc * BYTES_TO_COLOR;
float qn = a.qn * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qo = a.qo * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qp = a.qp * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qr = th(a.qr);
float qs = a.qs;
vec4 cl = a.cl * BYTES_TO_COLOR;
vec4 cm = a.cm * BYTES_TO_COLOR;
vec4 dh = a.dh * BYTES_TO_COLOR;
vec2 aas = vec2(a.qt, a.qu) * BYTES_TO_COORD;
vec2 aat = vec2(a.qv, a.qw) * BYTES_TO_COORD;
vec2 yd = xh(aas);
vec2 yg = xh(aat);
float aax = float(
qj > EPSILON &&
a.qy > EPSILON &&
a.ra > EPSILON
);
float aay = 1. - aax;
float aaz = aax * xo(
a.qx,
a.qy
) + aay * xn(
a.qx,
a.qy
);
float aba = aax * xo(
a.qz,
a.ra
) + aay * xn(
a.qz,
a.ra
);
float qq = a.qq * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom +
step(a.qq, EPSILON) * INFINITY;
float abb = xk(a.rb, a.rc);
float eu = xk(a.rd, a.re);
float zt = xk(a.rf, a.rg);
vec2 abc = a_vertexInfo.xy;
vec2 abd = vec2(0.0, 0.0);
float abe = aaz;
float abf = aba;
float abg = aba * qf;
if (qh > EPSILON || dc< EPSILON) {
if (a.rh < EPSILON || dc< EPSILON) return false;
abg = abb;
qs = a.rh;
aaz = abg * TEXT_WIDTH_MULTIPLIER * u_pixelRatio;
aba = abg * TEXT_HEIGHT_MULTIPLIER * u_pixelRatio;
}
bool aca = abs(qr) > EPSILON && xf(px, PIECE_EDGE_BODY) < EPSILON;
bool acb = aca && a_vertexInfo.z > EPSILON;
if (pw < EPSILON || px < EPSILON || qq < qn || acb) {
return false;
}
eu *= step(qo, qq);
float aco = 0.0;
float acp = 1.0;
float acl = 0.0;
float acn = 1.0;
float acq = 0.0;
float ada = 1.0;
float adc = 1.0;
float adm = 0.0;
float adn = 0.0;
vec2 bd;
vec2 ry;
vec2 rz;
vec2 sa;
float or;
float rx;
float aee = 0.0;
float aef = 1.0;
bool ci = xf(px, PIECE_TEXT_BOX) > EPSILON;
if (xf(px, PIECE_NODE_COMPONENT) > EPSILON || ci) {
bd = ceil((yd + yg) / 2.0);
if(length(aat - aas) > EPSILON){
ry = normalize(aat - aas) * vec2(1.,-1.);
}else{
ry = vec2(1.0, 0.0);
}
rz = ti(ry);
sa = rz;
or = aaz;
rx = aba;
} else {
adc = 0.0;
float aev = distance(yd, yg);
vec2 aew = normalize(yg - yd);
vec2 aex = (yd + yg) / 2.0;
vec2 aey = ti(aew);
vec2 ye;
vec2 yf;
if (qk > EPSILON) {
vec2 afe = sz(yd, -u_viewAngle);
vec2 aff = sz(yg, -u_viewAngle);
float afi = 1. / (1. + exp(-qr));
if (ql > EPSILON) {
float afj = afi * afe.y + (1. - afi) * aff.y;
ye = vec2(afe.x, afj);
yf = vec2(aff.x, afj);
} else {
float afk = afi * afe.x + (1. - afi) * aff.x;
ye = vec2(afk, afe.y);
yf = vec2(afk, aff.y);
}
ye = sz(ye, u_viewAngle);
yf = sz(yf, u_viewAngle);
}
vec2 afl = aex + (aey * aev * -qr / CURVATURE_RATIO);
if (xf(px, PIECE_EDGE_TEXT) > 0.0
|| xf(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0
) {
ci = xf(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0;
float afm;
float afn = eu;
eu = 0.0;
if (qd > EPSILON) {
xw ih = xx(yd, afn / 2.0, qr);
bd = to(yd, ih.vb, ih.vc, yg, 0.5);
ry = tx(yd, ih.vb, ih.vc, yg, 0.5);
rz = ti(ry);
sa = rz;
afm = .5 * uz(yd, ih.vb, ih.vc, yg);
} else if (qk > EPSILON) {
bd = to(yd, ye, yf, yg, 0.5);
ry = tx(yd, ye, yf, yg, 0.5);
rz = ti(ry);
sa = rz;
afm = uz(yd, ye, yf, yg);
} else if (abs(qr) > EPSILON) {
bd = tk(yd, afl, yg, 0.5);
ry = tv(yd, afl, yg, 0.5);
rz = ti(ry);
sa = rz;
afm = uj(qr, aev, 1.0);
} else {
bd = aex;
ry = aew;
rz = aey;
sa = aey;
afm = aev;
}
or = aaz;
rx = aba;
if(abe > afm - afn && qd < EPSILON){
if(qi > EPSILON){
ry = vec2(1.0, 0.0);
rz = vec2(0.0, 1.0);
sa = vec2(0.0, 1.0);
} else {
ry = vec2(0,0);
rz = vec2(0.0, 0.0);
sa = vec2(0.0, 0.0);
}
} else {
float tb = -atan(ry.y, ry.x);
aee = tb;
qg -= tb;
if ((tb > PI / 2.0 || tb < -PI / 2.0)) {
qg += (1.0 - qd) * PI;
aef = -1.0;
ry *= -1.0;
rz *= -1.0;
sa *= -1.0;
}
}
} else {
float afu = aaz;
float afv = aba;
float afw = xj(abb);
float afx = qa
* min(5. * afu, afw);
float afy = qb
* min(5. * afv, afw);
float afz = xf(px, PIECE_EDGE_HEAD);
float aga = xf(px, PIECE_EDGE_TAIL);
float agb = INFINITY * qd + aev - afu - afv;
float agk = min(0., agb - afx - afy)/2.;
float agp = abb / 2.;
float agq =
afu > agp
? afu - sqrt(afu * afu - agp * agp)
: agp;
float agr = max( afu +
afy
+ qb * agk,
0.) - (1. - qa) * agq;
agq =
afv > agp
? afv - sqrt(afv * afv - agp * agp)
: agp;
float ags = max( afv +
afx
+ qa * agk
, 0.) - (1. - qb) * agq;
if(qk > EPSILON && qd < EPSILON) {
agr = afu + afy / 2.;
ags = afv + afx / 2.;
}
if (afz > EPSILON || aga > EPSILON) {
vec2 agx = afz * yg + aga * yd;
float zt = afz * ags + aga * agr + (HEAD_TAIL_PX_ADJUST - 0.5);
float agy = afz * afx + aga * afy;
vec2 agz;
if (qk > EPSILON && qd < EPSILON) {
float yh = afz > EPSILON ? ags : agr;
float t = za(yd, ye, yf, yg, yh, aga > EPSILON);
agz = to(yd, ye, yf, yg, t);
ry = normalize(agz - to(yd, ye, yf, yg, t - 0.01));
if(aga > EPSILON) ry *= -1.;
bd = agz;
} else {
if (qd > EPSILON) {
xw ih = xx(yd, afu, qr);
float yh = afz * ags + aga * agr;
float t = za(yd, ih.vb, ih.vc, yg, yh, aga > EPSILON);
agz = to(yd, ih.vb, ih.vc, yg, t);
} else {
float afm = uj(qr, aev, 1.0);
float t = (afz * (afm - ags) + aga * agr) / afm;
agz = tk(yd, afl, yg, t);
}
ry = normalize(agx - agz);
bd = agx - ry * (zt - agy / 2.0);
}
rz = ti(ry);
sa = rz;
or = agy;
rx = agy;
py = 0.0;
pz = 0.0;
} else {
float ahd;
float ahe;
float ahf;
if(qk > EPSILON && qd < EPSILON) {
float ahg = za(yd, ye, yf, yg, agr, true);
float ahh = za(yd, ye, yf, yg, ags, false);
float ahi = ahh - ahg;
float ahj = a_vertexInfo.z;
float ahk = (ahg + ahi * ahj * T_STEP_PER_CURVE_PIECE);
float tt = (ahg + ahi * (ahj + 1.) * T_STEP_PER_CURVE_PIECE);
vec2 ahl = to(yd, ye, yf, yg, ahk);
vec2 ahm = to(yd, ye, yf, yg, tt);
bd = (ahl + ahm) / 2.0;
ry = normalize(ahm - ahl);
rz = ty(yd, ye, yf, yg, ahk);
sa = ty(yd, ye, yf, yg, tt);
or = distance(ahl, ahm);
ahd = uz(yd, ye, yf, yg);
ahe = ahd * ahk;
ahf = ahd * tt;
} else {
if (abs(qr) < EPSILON) {
bd = aex;
ry = aew;
rz = aey;
sa = rz;
or = aev;
ahd = aev;
ahe = 0.0;
ahf = aev;
} else {
float ahj = a_vertexInfo.z;
float ahk = ahj * T_STEP_PER_CURVE_PIECE;
float tt = ahk + T_STEP_PER_CURVE_PIECE;
if (qd < EPSILON) {
vec2 ahl = tk(yd, afl, yg, ahk);
vec2 ahm = tk(yd, afl, yg, tt);
bd = (ahl + ahm) / 2.0;
ry = normalize(ahm - ahl);
rz = tw(yd, afl, yg, ahk);
sa = tw(yd, afl, yg, tt);
or = distance(ahl, ahm);
ahd = uj(qr, aev, 1.0);
ahe = uj(qr, aev, ahk);
ahf = uj(qr, aev, tt);
} else {
xw ih = xx(yd, afu, qr);
vec2 ye = ih.vb;
vec2 yf = ih.vc;
vec2 ahl = to(yd, ye, yf, yg, ahk);
vec2 ahm = to(yd, ye, yf, yg, tt);
bd = (ahl + ahm) / 2.0;
ry = normalize(ahm - ahl);
rz = ty(yd, ye, yf, yg, ahk);
sa = ty(yd, ye, yf, yg, tt);
or = distance(ahl, ahm);
ahd = uz(yd, ye, yf, yg);
ahe = ahk * ahd;
ahf = tt * ahd;
}
}
}
rx = abb;
if(qd > EPSILON) {
xw ih = xx(yd, afu, qr);
float ahq = za(yd, ih.vb, ih.vc, yg, agr, true);
float ahh = za(yd, ih.vb, ih.vc, yg, ags, false);
acl = ahq;
acn = ahh;
} else if(qk < EPSILON) {
acl = (agr - 1.0) / ahd;
acn = MAX_PROGRESS - (ags - HEAD_TAIL_PX_ADJUST) / ahd;
}
aco = ahe / ahd;
acp = ahf / ahd;
acq = ahd;
if (abb < EPSILON)
cl.a = 0.; 
if (qc > 0.0 && agb > 5.0) {
float ahu = (ahd * rx) / (ahd - agr);
float ahv = ahd;
float qt = agr;
float qv = ahd - ags;
float a = -ahu / ahv;
float b = ahu;
float qu = a * qt + b;
float qw = a * qv + b;
float ahw = qu / (qt - qv);
float bi = -ahw * qv;
rx = min(min(bi, afu), afv);;
adn = ahw * ahv + bi + 1.0;
}
}
}
}
vec2 cq = vec2(0.0, 0.0);
vec2 rt = vec2(EPSILON, EPSILON);
vec2 ru = vec2(-EPSILON, -EPSILON);
float rv = -1.0;
float rw = 0.0;
bool ahy = false;
vec2 ahz = vec2(0,0);
vec2 aia = vec2(0,0);
vec2 aib = vec2(0,0);
if (qs > EPSILON && qq > qp) {
float aie = floor(qs / PATTERN_INFO_TEXTURE_SIZE);
float aif = qs - (aie * PATTERN_INFO_TEXTURE_SIZE);
vec4 aig = texture2D(u_patternInfoTexture, vec2(aif, aie) / 255.0) * 255.0;
vec2 aih = sw(aig.z);
vec2 aii = sw(aig.w);
rv = aih.x * 2.0 + aii.x;
float aij = 0.0;
if (aq(rv, FILTER_NEAREST)) { 
aij = PATTERN_NEAREST_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR)) { 
aij = PATTERN_LINEAR_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR_SDF)) { 
aij = PATTERN_LINEAR_SDF_TEXTURE_SIZE;
ahy = true;
} else if (aq(rv, FILTER_MIPMAP)) { 
aij = PATTERN_MIPMAP_TEXTURE_SIZE;
}
float aim = 1.0 / aij;
vec2 ain = (vec2(aih.y, aii.y) * PATTERN_POSITION_UNIT_SIZE) * aim / 2.0;
aia += (aig.xy * PATTERN_POSITION_UNIT_SIZE * aim) + ain;
ain -= PATTERN_PADDING * aim * 2.0;
vec2 aio = vec2(or / 2.0, rx / 2.0) * aim;
vec2 aip = vec2(eu, eu) * aim;
float air = 1.0 * u_pixelRatio;
float ais = SDF_SMOOTH_FACTOR;
if (qf > EPSILON) {
if (ahy) { 
if (a.qj > EPSILON) {
ais = SDF_SMOOTH_FACTOR * u_pixelRatio / SDF_GAMMA;
ahz = vec2(-a.rl,-a.rk);
}
rw = ais * SDF_GAMMA / abg / u_pixelRatio;
air = SDF_FONT_SIZE / abg;
} else { 
air = (ain.y / aio.y) / qf;
}
}
aib = (aio + aip) * air;
ain += PATTERN_PADDING * aim;
rt = aia - ain;
ru = aia + ain;
}
if (qh > EPSILON) {
abd.y = (a.rj) * abg;
ada = 0.0;
adc = 0.0;
abd.x = a.ri * abg * BYTES_TO_TEXT_OFFSET_X;
abd = sz(abd, aee);
abd *= aef;
}
vec2 aix = vec2(cos(qg), sin(qg)) * zt;
vec2 aiy = bd + aix + abd;
float aiz = eu * 2.0;
float aja = or + adc * (aiz + 1.0);
float ajb = rx + ada * (aiz + 1.0);
vec2 ajc = ry * aja / 2.0;
vec2 ajd = rz * ajb / 2.0;
vec2 aje = sa * ajb / 2.0;
float ajf = (acp - aco);
float ajg = abc.x / 2.0 + 0.5;
float ro = aco + ajf * ajg;
float rs = adm + (adn - adm) * ro / 2.0;
float ajh = step(pw, FIRST_COMPLEX_SHAPE_ID - EPSILON);
float aji = ajh * SIMPLE_SHAPE_SAMPLING_SIZE + (1.0 - ajh) * COMPLEX_SHAPE_SAMPLING_SIZE;
float ajj = aji / COMPLEX_SHAPE_SAMPLING_SIZE;
float ajk = ajj * SHAPE_SAMPLING_BUFFER_RATIO / 2.0;
float ajl = ajj * (1.0 - SHAPE_SAMPLING_BUFFER_RATIO);
vec2 ajs = vec2(
mod(pw, NB_SHAPES_BY_SIDE),
floor(pw / NB_SHAPES_BY_SIDE)
);
vec2 ajt = ajs + vec2(ajk) +
vec2(aco * ajl, 0.0);
vec2 ajw = vec2(ajf, 1.0) * ajl;
vec2 rn = (ajt + ajw * (abc / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE;
vec2 rr = vec2(aja / ajf, ajb) / 2.0;
float akc = py * abb;
float akd = pz * abb;
float rp = akc + akd;
float rq = (ro * acq) / rp;
cq = aia
+ aib
* (abc + ahz / rr * u_viewZoom);
ns.rn = rn;
float ch = float(pw == 1.);
f = vec4(
(ajt + ajw * (vec2(0.5,0.5) / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE,
NB_SHAPES_BY_SIDE * (1. - qh) * ch,
float(ci)
);
ns.rr = rr;
ns.eu = eu;
ns.cl = cl;
ns.cm = cm;
ns.dc = dc;
ns.ro = xu(ro, acl, acn);
ns.rp = rp;
ns.py = akc;
ns.rq = rq;
ns.rs = rs;
ns.cq = cq;
ns.rt = rt;
ns.ru = ru;
ns.rv = rv;
ns.rw = rw;
ns.dh = dh;
ns.bd = aiy;
ns.or = aja + ch;
ns.rx = ajb + ch;
ns.ry = ry;
ns.rz = rz;
ns.sa = sa;
return true;
}
float aki(float akj, float akk, vec4 akl) {
float akm = clamp(((u_currentTime - akj) / akk), 0.0, 1.0);
float r = akm;
float akn = r * r;
float ako = akn * r;
vec4 akp = akm < 0.5 ? te(akl) : tg(akl);
float akq = akp.x;
float akr = akp.y;
float aks = akp.z;
float akt = akp.w;
float aku = akq + akr * r + aks * akn + akt * ako;
return aku;
}
void main() {
qm a_final = ze(
a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_final_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_final_x1_y1_x2_y2,
a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
#if ANIMATED
float akj = a_animationBeginTime_animationDuration.x;
float akk = a_animationBeginTime_animationDuration.y;
vec4 akl = a_animationEasing;
float aaq = aki(akj, akk, akl);
qm a_prev = ze(
a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_prev_x1_y1_x2_y2,
a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
const float ONE = 1.0;
a_final.pw = mix(a_prev.pw, a_final.pw, ONE);
a_final.py = mix(a_prev.py, a_final.py, aaq);
a_final.pz = mix(a_prev.pz, a_final.pz, aaq);
a_final.qa = mix(a_prev.qa, a_final.qa, ONE);
a_final.qb = mix(a_prev.qb, a_final.qb, ONE);
a_final.px = mix(a_prev.px, a_final.px, ONE);
a_final.qf = mix(a_prev.qf, a_final.qf, ONE);
a_final.qh = mix(a_prev.qh, a_final.qh, ONE);
a_final.qi = mix(a_prev.qi, a_final.qi, ONE);
a_final.qj = mix(a_prev.qj, a_final.qj, ONE);
a_final.qk = mix(a_prev.qk, a_final.qk, ONE);
a_final.qd = mix(a_prev.qd, a_final.qd, ONE);
a_final.qg = mix(a_prev.qg, a_final.qg, aaq);
a_final.dc = mix(a_prev.dc, a_final.dc, aaq);
a_final.qn = mix(a_prev.qn, a_final.qn, aaq);
a_final.qo = mix(a_prev.qo, a_final.qo, aaq);
a_final.qp = mix(a_prev.qp, a_final.qp, aaq);
a_final.qq =mix(a_prev.qq, a_final.qq, aaq);
a_final.qr = mix(a_prev.qr, a_final.qr, aaq);
a_final.qs = mix(a_prev.qs, a_final.qs, ONE);
a_final.cl = mix(a_prev.cl, a_final.cl, aaq);
a_final.cm = mix(a_prev.cm, a_final.cm, aaq);
a_final.dh = mix(a_prev.dh, a_final.dh, aaq);
a_final.qt = mix(a_prev.qt, a_final.qt, aaq);
a_final.qu = mix(a_prev.qu, a_final.qu, aaq);
a_final.qv = mix(a_prev.qv, a_final.qv, aaq);
a_final.qw = mix(a_prev.qw, a_final.qw, aaq);
a_final.qx = mix(a_prev.qx, a_final.qx, aaq);
a_final.qy = mix(a_prev.qy, a_final.qy, aaq);
a_final.qz = mix(a_prev.qz, a_final.qz, aaq);
a_final.ra = mix(a_prev.ra, a_final.ra, aaq);
a_final.rb = mix(a_prev.rb, a_final.rb, aaq);
a_final.rc = mix(a_prev.rc, a_final.rc, aaq);
a_final.rd = mix(a_prev.rd, a_final.rd, aaq);
a_final.re = mix(a_prev.re, a_final.re, aaq);
a_final.rf = mix(a_prev.rf, a_final.rf, aaq);
a_final.rg = mix(a_prev.rg, a_final.rg, aaq);
a_final.rh = mix(a_prev.rh, a_final.rh, ONE);
a_final.ri = mix(a_prev.ri, a_final.ri, ONE);
a_final.rj = mix(a_prev.rj, a_final.rj, ONE);
#endif
rm ns;
bool aky = aar(a_final, ns);
if (!aky) {
wz();
return;
}
vec2 abc = a_vertexInfo.xy;
a = ns.cl;
b = ns.cm;
c = ns.dh;
d = ns.rn;
e = ns.cq;
#if D3D9_FIX
#else
l = ns.eu;
m = ns.rt;
n = ns.ru;
o = vec2(ns.dc, ns.rs);
p = ns.ro;
q = ns.rp;
r = vec2(ns.py, ns.rq);
s = ns.rr;
t = ns.rw;
u = ns.rv;
#endif
float alb = step(abc.x, 0.0);
float alc = 1.0 - alb;
g = min(ns.rx, ROUNDED_BOX_RADIUS * 2.) * u_pixelRatio;
vec2 xb = ns.bd
+ ns.ry * (ns.or / 2.0) * abc.x
+ (alb * ns.rz + alc * ns.sa) * ns.rx / 2.0 * abc.y;
c = c * (1. - f.w)
+ vec4(
abc.x * ns.or,
abc.y * ns.rx,
ns.or,
ns.rx
) * u_pixelRatio * f.w;
gl_Position = xa(xb);
}
`,So=1e20,LC=class{constructor({fontSize:t=24,buffer:e=8,radius:s=6,cutoff:i=.25}={}){this._maxDimension=1,this._gridSize=1,this._fontSize=t,this._buffer=e,this._radius=s,this._cutoff=i,this._height=Math.ceil(this._fontSize+2*this._buffer*Zl),this._canvas=ls(),this._canvas.height=this._height,this._canvas.width=1;const n=this._canvas.getContext("2d",{willReadFrequently:!0});this._ctx=n,n.textBaseline="middle",n.textAlign="center",n.fillStyle="black"}setOptions({fontSize:t=24,buffer:e=8,cutoff:s=.25,radius:i=6}){this._fontSize=t,this._buffer=e,this._cutoff=s,this._radius=i,this._height=Math.ceil(this._fontSize+2*this._buffer*Zl)}draw(t,e,s){an(this._ctx,e,this._fontSize,s);const i=IC(this._ctx.measureText(t).width+2*this._buffer)-2*rn,n=this._height,r=i*n,o=Math.max(i,n);this._canvas.width<i&&(this._canvas.width=i,an(this._ctx,e,this._fontSize,s),this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="black"),r>this._gridSize&&(this._gridOuter=new Float64Array(r),this._gridInner=new Float64Array(r),this._gridSize=r),o>this._maxDimension&&(this._f=new Float64Array(o),this._d=new Float64Array(o),this._z=new Float64Array(o+1),this._v=new Int16Array(o),this._maxDimension=o),this._ctx.clearRect(0,0,i,n),this._ctx.fillText(t,i/2,n/2);const a=this._ctx.getImageData(0,0,i,n),l=new Uint8ClampedArray(r);for(let d=0;d<r;d++){const h=a.data[4*d+3]/255;this._gridOuter[d]=h===1?0:h===0?So:Math.pow(Math.max(0,.5-h),2),this._gridInner[d]=h===1?So:h===0?0:Math.pow(Math.max(0,h-.5),2)}of(this._gridOuter,i,n,this._f,this._d,this._v,this._z),of(this._gridInner,i,n,this._f,this._d,this._v,this._z);for(let d=0;d<r;d++){const h=this._gridOuter[d]-this._gridInner[d];l[d]=Math.max(0,Math.min(255,Math.round(255-255*(h/this._radius+this._cutoff))))}return{height:n,width:i,distance:l}}};function of(t,e,s,i,n,r,o){for(let a=0;a<e;a++){for(let l=0;l<s;l++)i[l]=t[l*e+a];af(i,n,r,o,s);for(let l=0;l<s;l++)t[l*e+a]=n[l]}for(let a=0;a<s;a++){for(let l=0;l<e;l++)i[l]=t[a*e+l];af(i,n,r,o,e);for(let l=0;l<e;l++)t[a*e+l]=Math.sqrt(n[l])}}function af(t,e,s,i,n){s[0]=0,i[0]=-So,i[1]=+So;for(let r=1,o=0;r<n;r++){let a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);for(;a<=i[o];)o--,a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);o++,s[o]=r,i[o]=a,i[o+1]=+So}for(let r=0,o=0;r<n;r++){for(;i[o+1]<r;)o++;e[r]=(r-s[o])*(r-s[o])+t[s[o]]}}function IC(t){return Math.ceil((t+2*rn)/fs)*fs}var Da=256,MC=.275,NC=.25,RC=6,FC=BT-2*rn,PC=OT-2*rn,lf={fontSize:Oo,cutoff:MC,radius:RC},zC={fontSize:Oo,cutoff:NC,radius:8},DC=class{constructor(t,e){this._patternIdToInfoTexture=new Uint8Array(Da*Da*4),this._glTextures=[],this._textureSizes=[],this._pixelRatio=1,this._gl=t,this._glUnit=e;const s=ls(Js,Js),i=s.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Pattern: could not get 2d context");this._imageCanvasContext=i,this._imageCanvas=s,this._sdfGenerator=new LC(lf),this._maxTextureSize=Math.min(4096,t.getParameter(t.MAX_TEXTURE_SIZE))}refresh(t){this._pixelRatio=t.getPixelRatio();const e=this._gl,s=this._getPatternsByFilter(t.getPatternList());for(let r=0;r<s.length;++r){const o=r,a=s[r],l=dC(a,this._maxTextureSize),{texture:d,size:h}=Q0(o,a,l,this._maxTextureSize,this._patternIdToInfoTexture),u=this._glTextures[o]||(this._glTextures[o]=e.createTexture()),c=o===mr?lg:Mu;tf(e,u,this._glUnit+1+o,d,h,o,c),this._textureSizes[o]=h}const i=this._glTextureInfo||(this._glTextureInfo=e.createTexture()),n=this._patternIdToInfoTexture;tf(e,i,this._glUnit,n,Da,mr,Mu)}bindMetaDataTexture(){const t=this._gl;t.activeTexture(t.TEXTURE0+this._glUnit),t.bindTexture(t.TEXTURE_2D,this._glTextureInfo)}getInfoTextureUnit(){return this._glUnit}getNearestTextureUnit(){return this._glUnit+1+mr}getLinearTextureUnit(){return this._glUnit+1+Eo}getLinearSdfTextureUnit(){return this._glUnit+1+Ao}getMipmapTextureUnit(){return this._glUnit+1+yn}getInfoTextureSize(){return Da}getNearestTextureSize(){return this._textureSizes[mr]}getLinearTextureSize(){return this._textureSizes[Eo]}getLinearSdfTextureSize(){return this._textureSizes[Ao]}getMipmapTextureSize(){return this._textureSizes[yn]}_getPatternsByFilter(t){const e=new Array(Km);for(let s=0;s<Km;++s)e[s]=[];for(let s=0;s<t.length;++s){const i=this._getPatternPixels(t[s]);e[i.filter].push(i)}return e}_getPatternPixels({id:t,type:e,attributes:s}){let i;const{text:n,font:r,style:o,image:a,scaled:l,duplicated:d,colorArray:h}=s;switch(e){case en:i=d?this._getDuplicatedImagePixels(a):l?this._getScaledImagePixels(a):this._getNonScaledImagePixels(a);break;case Sn:i=this._getSdfTextPixels(n,r,o);break;case Nn:i=this._getIconPixels(n,r,o);break;case Rn:i=this._getBadgeIconPixels(n,r,o);break;case da:i=this._getPieChartPixels(h);break;default:throw new Error(`pattern type "${e}" does not exist`)}return i.id=t,i}_getScaledImagePixels(t){let e=t.width,s=t.height;if(e>0){const i=Js/Math.max(t.width,t.height);e*=i,s*=i}return e&&s&&(e=Mr(e),s=Mr(s)),e-=2*rn,s-=2*rn,this._getImagePixels(t,e,s)}_getNonScaledImagePixels(t){return this._getImagePixels(t,t.width,t.height)}_getDuplicatedImagePixels(t){if(t.width===0||t.height===0)return this._getImagePixels(t,0,0);this._canvasForDuplicatedImage||(this._canvasForDuplicatedImage=ls(Js,Js));const e=this._canvasForDuplicatedImage,s=e.getContext("2d"),i=t.width,n=t.height;let r=(Js-i)/2,o=(Js-n)/2;for(;r>0;)r-=i;for(;o>0;)o-=n;for(let a=r;a<Js;a+=i)for(let l=o;l<Js;l+=n)s.drawImage(t,a,l);return this._getImagePixels(e,Js,Js)}_getImagePixels(t,e,s){let i;if(e===0||s===0)i=new Uint8Array(0);else{(this._imageCanvas.width<e||this._imageCanvas.height<s)&&(this._imageCanvas.width=e,this._imageCanvas.height=s);const n=this._imageCanvasContext;wu(this._imageCanvas,n,e,s);try{n.drawImage(t,0,0,e,s)}catch{}i=n.getImageData(0,0,e,s).data}return{width:e,height:s,pixels:i,filter:yn}}_getPieChartPixels(t){const e=PC,s=this._imageCanvasContext,i=e/2,n=e/2;return wu(this._imageCanvas,s,e,e),s.save(),s.rect(0,0,e,e),s.clip(),tb(s,t,i,n,e),s.restore(),{width:e,height:e,pixels:s.getImageData(0,0,e,e).data,filter:Eo}}_getTextPixels(t,e,s,i,n,r){const o=this._imageCanvasContext,a=n*this._pixelRatio;an(o,s,a,i);let l=Math.ceil(o.measureText(e).width);l===0&&(l=a);let d=0,h=0;t===yn||(d=2*Math.ceil(a*Zl/2),h=2*Math.ceil(l*g0/2));const u=Math.ceil(l+h),c=Math.ceil(a+d),g=this._imageCanvas.height<c||this._imageCanvas.width<u;return this._imageCanvas.height<c&&(this._imageCanvas.height=c),this._imageCanvas.width<u&&(this._imageCanvas.width=u),g&&an(o,s,a,i),o.clearRect(0,0,u,c),o.fillStyle="black",o.textBaseline="middle",o.textAlign="left",o.fillText(e,r+h/2,c/2),{width:u,height:c,pixels:o.getImageData(0,0,u,c).data,filter:t}}_getIconPixels(t,e,s){return this._getTextPixels(yn,t,e,s,FC,0)}_getBadgeIconPixels(t,e,s){return this._sdfGenerator.setOptions(zC),this._getSdfPixels(t,e,s)}_getSdfTextPixels(t,e,s){return this._sdfGenerator.setOptions(lf),this._getSdfPixels(t,e,s)}_getSdfPixels(t,e,s){const{width:i,height:n,distance:r}=this._sdfGenerator.draw(t,e,s),o=new Uint8Array(i*n*4);for(let a=0;a<r.length;++a)o[4*a+3]=r[a];return{width:i,height:n,pixels:o,filter:Ao}}},kC=class{constructor(t,e){this._gl=t,this._glTextureUnit=e,this._simpleShapePixels=new Uint8Array(bl*bl*4),this._complexShapePixels=new Uint8Array(Wi*Wi*4),this._shapesWritten=new Set}refresh(t){const e=t.getShapeList();for(const s of e)if(!this._shapesWritten.has(s.id)){const i=s.isSimple?bl:Wi,n=s.isSimple?this._simpleShapePixels:this._complexShapePixels;hC(s,i,xu,n),this._loadShapeInGpu(s.id,i,n),this._shapesWritten.add(s.id)}}_loadShapeInGpu(t,e,s){const i=this._gl,n=vu,r=t%bu*Wi,o=Math.floor(t/bu)*Wi;if(this._texture)i.bindTexture(i.TEXTURE_2D,this._texture);else{const a=new Uint8Array(n*n*4);this._texture=i.createTexture(),i.activeTexture(i.TEXTURE0+this._glTextureUnit),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,n,0,i.RGBA,i.UNSIGNED_BYTE,a)}i.texSubImage2D(i.TEXTURE_2D,0,r,o,e,e,i.RGBA,i.UNSIGNED_BYTE,s)}getTextureSize(){return vu}getSamplingSize(){return Wi}getBufferRatio(){return xu}getTextureUnit(){return this._glTextureUnit}rewriteShape(t){this._shapesWritten.delete(t)}},df=class{constructor(t,{vertex:e,fragment:s,constants:i,macros:n}){this._state=0,this._gl=t,this._vertexSource=e,this._fragmentSource=s,this._constants=ke(i||{}),this._macros=ke(n||{})}setConstant(t,e){this._constants[t]=e}setMacro(t,e){this._macros[t]=e}getState(){return this._state}getProgram(){return this._program}compile(){const t=this._gl,e=hf(this._vertexSource,this._macros,this._constants),s=hf(this._fragmentSource,this._macros,this._constants);this._program&&(t.deleteProgram(this._program),t.deleteShader(this._vertexShader),t.deleteShader(this._fragmentShader));const i=t.createProgram(),n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);if(!(i&&n&&r))throw new Error("Error instantiating WebGL program");this._program=i,this._vertexShader=n,this._fragmentShader=r,t.shaderSource(this._vertexShader,e),t.compileShader(this._vertexShader),t.attachShader(this._program,this._vertexShader),t.shaderSource(this._fragmentShader,s),t.compileShader(this._fragmentShader),t.attachShader(this._program,this._fragmentShader),t.linkProgram(this._program),this._state=1}getError(){const t=this._gl;if(!t.getShaderParameter(this._vertexShader,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(this._vertexShader)||"";let s=e;const i=e.match(/ERROR: (\d+):(\d+):(.*)\n/g);if(i&&i.length){const n=this._vertexSource.split(`
`);s=i.map((r=>{const o=r.match(/ERROR: (\d+):(\d+):(.*)\n/);if(!o)return r;const[a,l]=o.slice(2);return`${n[+a]}
${n[+a+1]}
~~~~~~~~~~~
${n[+a+2]}
 -> ${l}`})).join(`
`)}return{step:"vertex",message:s}}return t.getShaderParameter(this._fragmentShader,t.COMPILE_STATUS)?t.getProgramParameter(this._program,t.LINK_STATUS)?(this._state=2,null):{step:"link",message:t.getProgramInfoLog(this._program)||""}:{step:"fragment",message:t.getShaderInfoLog(this._fragmentShader)||""}}};function hf(t,e,s){const i=Object.keys(e),n=Object.keys(s);for(let r=0;r<i.length;++r){const o=i[r],a=e[o];t=t.replace(`#define ${o} 0`,`#define ${o} ${a}`)}for(let r=0;r<n.length;++r){const o=n[r],a=s[o],l=a+(a%1==0?".0":"");t=t.replace(`const float ${o} = 0.0;`,`const float ${o} = ${l};`)}return t}function OC(){return typeof window<"u"&&!!window.FORCE_WEBGL}var uf=F0(),BC={stencil:!0,antialias:!1,alpha:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!OC()},UC=0,GC=1,VC={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'},sb=class extends Error{};function dh(t,e){if(!t&&e){const s=new sb(VC[e]);throw s.code=e,s}}var qC=class ib extends Mi{constructor(e){super(e),this._2dcanvas=ls(),this._ctx=this._2dcanvas.getContext("2d"),this._bufferDrawers=[],this._mustResize=!1,this._error=null,this._onContextLost=l=>{l.preventDefault(),this._error=new sb("WebGL context lost"),this.fire("error",this._error)};const s=ib.createInitData(),{canvas:i,gl:n,ext:r,staticProgramWrapper:o,animationProgramWrapper:a}=s;dh(n,"NO_WEBGL"),dh(r,"NO_ANGLE_INSTANCED_ARRAYS"),this._glCanvas=i,this._gl=n,this._ext=r,this._staticProgramWrapper=o,this._animationProgramWrapper=a,this._shapeTexture=new kC(this._gl,UC),this._patternTexture=new DC(this._gl,GC),this._initCanvas(this._glCanvas),this._computeShaderInfo(),this._initSpecialGlBuffers(),this._initGlPrograms(),this._initGl()}_initCanvas(e){super._initCanvas(e),e.addEventListener("webglcontextlost",this._onContextLost,!1)}static isAvailable(){return uf||dh(null,"NO_WEBGL"),uf}static createInitData(){const e=ls(),s=tg(e,BC,"webgl"),i=s&&typeof s.getExtension=="function"?s.getExtension("ANGLE_instanced_arrays"):null,n=YC(),r=new df(s,{vertex:lh,fragment:ah,constants:n,macros:{ANIMATED:0}}),o=new df(s,{vertex:lh,fragment:ah,constants:n,macros:{ANIMATED:1}});return s&&i&&(r.compile(),s.flush()),{canvas:e,gl:s,ext:i,staticProgramWrapper:r,animationProgramWrapper:o}}static getName(){return"WebGL"}_beforeFirstFrame(){this._animationProgramWrapper.getState()===0&&this._animationProgramWrapper.compile()}ensureAnimationsReady(){const e=this._animationProgramWrapper.getState();e!==2&&(e===0&&this._animationProgramWrapper.compile(),this._animationProgramWrapper.getError())}getDomElement(){return this._glCanvas}_initGl(){const e=this._gl;e.clearColor(0,0,0,0),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}_computeShaderInfo(){this._shaderMetadata=HC(lh,ah)}_initGlPrograms(){this._staticProgram=new rf({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._staticProgramWrapper}),this._animationProgram=new rf({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._animationProgramWrapper})}_initSpecialGlBuffers(){const e=this._gl,s=e.createBuffer(),i=new Int8Array(18*Ms);for(let n=0;n<Ms;++n){const r=[-1,-1,n,1,-1,n,1,1,n,-1,-1,n,-1,1,n,1,1,n],o=n*r.length;for(let a=0;a<r.length;a++)i[a+o]=r[a]}e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this._specialGlBuffers={vertexInfo:s}}_computeUniforms(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._scales.bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._scales.bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._scales.bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._scales.bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._scales.bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._scales.bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._scales.bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_UNIT_SIZE:fs,ROUNDED_BOX_RADIUS:this._textManager.getCornerRadius(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}}_render({shapesChanged:e,patternsChanged:s,dimensionsChanged:i,backgroundColorChanged:n}){const r=this._gl;if(this._error)throw this._error;if(e&&(this._shapeTexture.refresh(this._shapeManager),this._patternTexture.bindMetaDataTexture()),s&&this._patternTexture.refresh(this._patternManager),i&&(this._mustResize=!0),n){const[l,d,h,u]=this._renderBackground?this._backgroundRgba:[0,0,0,0];r.clearColor(l*u,d*u,h*u,u)}const o=this._computeUniforms(),a=this._getSortedBufferList();this._mustResize&&a.length&&(Gl(this._glCanvas,this._width,this._height,this._pixelRatio),r.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),this._mustResize=!1),r.clear(r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT);for(let l=0;l<a.length;++l)this._displayBuffer(a[l],o);this._endFrame()}_displayBuffer(e,s){const i=e.getProgram();i!==this._currentProgram&&(this._currentProgram&&this._currentProgram.endPass(),this._currentProgram=i,this._currentProgram.startPass(s)),e.markAsUsed(),e.draw()}_getSortedBufferList(){const e=this._bufferList.getBuffersByAscendingDepth(),s=[];for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&n.markAsUnused()}for(let i=0;i<e.length;++i){const n=e[i],r=this._getBufferDrawer(n);r.markAsUsed(),!n.isEmpty()&&this._isBufferDisplayable(n)&&s.push(r)}for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&!n.isUsed()&&(n.destroy(),this._bufferDrawers[i]=void 0)}return s}_endFrame(){this._currentProgram&&(this._currentProgram.endPass(),this._currentProgram=null)}_getBufferDrawer(e){const s=e.getId();let i=this._bufferDrawers[s];if(!i){for(;this._bufferDrawers.length<=s;)this._bufferDrawers.push(void 0);i=new vC({gl:this._gl,ext:this._ext,staticProgram:this._staticProgram,animationProgram:this._animationProgram}),this._bufferDrawers[s]=i}return i.setDataBuffer(e),i}destroy(){this._glCanvas&&this._glCanvas.removeEventListener("webglcontextlost",this._onContextLost);const e=this._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}getImageData(){const e=this._glCanvas.width,s=this._glCanvas.height;return(this._2dcanvas.width<e||this._2dcanvas.height<s)&&(this._2dcanvas.width=e,this._2dcanvas.height=s),this._ctx.clearRect(0,0,e,s),this._ctx.drawImage(this._glCanvas,0,0),this._ctx.getImageData(0,0,e,s)}_getImageDataFlippedYAxis(){const e=this._gl,s=this._glCanvas.width,i=this._glCanvas.height,n=this._ctx.createImageData(s,i),r=new Uint8Array(n.data.buffer);return e.readPixels(0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,r),n}setConstant(e,s){this._staticProgramWrapper.setConstant(e,s),this._animationProgramWrapper.setConstant(e,s),this._staticProgramWrapper.compile(),this._animationProgramWrapper.compile(),this._initGlPrograms(),this._bufferDrawers.forEach((i=>{i?.destroy()})),this._bufferDrawers=[]}getShapeTexture(){return this._shapeTexture}};function HC(t,e){const s={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};return cf(s,t),cf(s,e),s}var jC={float:1,vec2:2,vec3:3,vec4:4};function cf(t,e){const s=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g,i=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g,n=[];let r=s.exec(e);for(;r;){const o=r[0];o==="#endif"?n.pop():o.startsWith("#if")?n.push(r[4]):t.attributes.push({name:r[3],size:jC[r[2]],type:r[1],tags:n.slice(),location:null,byteSize:0,glType:null}),r=s.exec(e)}for(r=i.exec(e);r;){if(!t.uniforms.some((({id:o})=>o===r[1]))){const o=r[1],a=r[2],l=a.replace("u_","");t.uniforms.push({id:l,name:a,type:o})}r=i.exec(e)}}function YC(){return{BYTES_TO_OFFSET_ANGLE:2*Math.PI/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:Oo,CURVATURE_RATIO:Ad,PATTERN_PADDING:rn,TEXT_WIDTH_MULTIPLIER:g0,TEXT_HEIGHT_MULTIPLIER:Zl,SELF_LOOP_CURVATURE_RATIO:Kl,EDGE_ARROW_SIZE_RATIO:Mi.edgeArrowSizeRatio,EDGE_MIN_TIP_SIZE:Mi.minEdgeTipSize,CURVE_SUBDIVISIONS:Ms,PIECE_NODE_COMPONENT:$s,PIECE_TEXT_BOX:wn,PIECE_EDGE_BODY:Sd,PIECE_EDGE_HEAD:Xc,PIECE_EDGE_TAIL:Wc,PIECE_EDGE_TEXT:_n,MAX_TEXT_SIZE:N2,BYTES_TO_TEXT_OFFSET_X:1/B0,BYTES_TO_TEXT_OFFSET_Y:1/Tu,FILTER_NEAREST:mr,FILTER_LINEAR:Eo,FILTER_LINEAR_SDF:Ao,FILTER_MIPMAP:yn,SHAPE_TEXTURE_SIZE:vu,SIMPLE_SHAPE_SAMPLING_SIZE:bl,COMPLEX_SHAPE_SAMPLING_SIZE:Wi,SHAPE_SAMPLING_BUFFER_RATIO:xu,MAX_SHAPES:$l.toString(),FIRST_COMPLEX_SHAPE_ID:yu,SELF_LOOP_TO_CIRCLE_APPROX:p0,SDF_GAMMA:VT}}var XC={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,isBufferDisplayable:Ac,hideImages:!1,renderBackground:!1,bentEnable:!1,bentVertical:!1},ka={webgl:qC,canvas:gC,svg:xC},gf=[0,0,0,0],hh={webgl:null,svg:null,canvas:null},uh=class extends la{constructor(t){super(),this._view=ke(XC),this._domWrapper=Ri?document.createElement("div"):Ul(),this._domElement=this._domWrapper.appendChild(Ri?document.createElement("div"):Ul()),this._currentElementSize=0,this._currentBlockOffset=0,this._currentByteOffset=0,this._blockIdToAddress=new Uint32Array(0),this._renderersByType={},this._switchMainRenderer=!0,this._refreshTexts=!1,this._backgroundColor=null,this._initData=t||{},this._patternManager=new T2,this._shapeManager=new C2,this._boundariesManager=new KT,this._textManager=new R2(this._patternManager),this._bufferOffsetToId=new b0,this._memoryManager=new A2(this._patternManager,this._shapeManager,this._textManager,this._bufferOffsetToId,(e=>this.parseColor(e)||gf)),this._bufferList=new jT}static createInitData(){const t={};for(const e in ka)t[e]=ka[e].createInitData();return t}static cacheInitData(t){hh=t}static getCachedInitData(){return hh}static clearCachedInitData(){hh={webgl:null,svg:null,canvas:null}}freeBlock(t){this._checkBlockId(t);const e=this._blockIdToAddress[t],s=this._bufferList.freeBlock(e);return this._blockIdToAddress[t]=s,s}_ensureDomElementsFitParent(){const t=this._domElement.parentNode;!t||t.offsetWidth===this._view.width&&t.offsetHeight===this._view.height||Bn(t,`${this._view.width}px`,`${this._view.height}px`)}_ensureCorrectBackgroundColor(){const t=this._domElement.parentNode;this._backgroundColor!==this._view.backgroundColor&&t&&(t.style.backgroundColor=this._view.backgroundColor||"",this._backgroundColor=this._view.backgroundColor)}createGroup(){return new ZT}parseColor(t){return ys(t)}clear(){this._blockIdToAddress.fill(0),this._patternManager.reset(),this._boundariesManager.reset(),this._textManager.reset(),this._bufferList.reset(),this._bufferOffsetToId.reset()}notifyFontsReloaded(){this._patternManager.notifyUpdate(),this._textManager.clear(),this._refreshTexts=!0}notifyPatternUpdate(){this._patternManager.notifyUpdate()}getShapePoints(t){return this._shapeManager.getDefinitionFromName(t).points}checkShapeHit(t,e,s){const{getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:n}=this._shapeManager.getDefinitionFromName(t);return Math.min(i(e,s),n(e,s))>=0}setGlobalBoundaries(t){const{maxBlockId:e=0,maxScaledSize:s,maxMinVisibleSize:i,maxSymbolicSize:n,maxDashLength:r,maxGapLength:o,maxPatternScale:a}=t;return e>this._blockIdToAddress.length&&this._resizeBlockArray(e),!!this._boundariesManager.set(t)&&(this._memoryManager.resizeBoundaries(s,i,n,r,o,a),!0)}_resizeBlockArray(t){const e=new Uint32Array(t);e.set(this._blockIdToAddress),this._blockIdToAddress=e}registerShape(t,e){this._shapeManager.register(t,e)}updateShape(t,e){this._shapeManager.updateShape(t,e);const s=this._renderersByType.webgl?.getShapeTexture();s&&s.rewriteShape(this._shapeManager.getIdFromName(t))}_bindBlock(t,e,s,i,n,r,o){this._checkBlockId(t);const a=this._blockIdToAddress[t],l=this._bufferList.allocateBlock(a,e,s,i,n,r,o);return this._blockIdToAddress[t]=l.address,this._currentDataView=l.buffer.getDataView(),this._currentElementSize=l.buffer.elementSize,this._currentBlockOffset=l.offset,this._currentByteOffset=this._currentBlockOffset*this._currentElementSize,this._currentSideDataView=l.buffer.getSideDataView(),this._currentSideElementSize=l.buffer.getTotalSideElementsSize(),this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize,l}_setItemIndex(t){const e=this._currentBlockOffset+t;this._currentByteOffset=e*this._currentElementSize,this._currentSideByteOffset=e*this._currentSideElementSize}_checkBlockId(t){t>=this._blockIdToAddress.length&&this._resizeBlockArray(Zi(t+1))}_setTextCharacters(t){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,t)}_storeElement(t,e){this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset,t.end),e&&(this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset+Lr,t.start),this._memoryManager.storeAnimationInformation(this._currentDataView,this._currentByteOffset+2*Lr,t.animation,Zc.getCoefficients(t.animation.easing)))}storeGroup(t,e){if(!e||e.size===0)return this.freeBlock(t);const s=e.type,i=e.depth,n=e.size,r=e.getElements(),o=e.animated,a=e.stencilUsage,l=e.getId();let d=0;if(s===Mn)for(let u=0;u<n;++u){const c=r[u],{start:g,end:m}=c;if(m.pattern.type===on){const f=m.pattern.attributes.text;d=Math.max(d,f.length)}if(o&&g.pattern.type===on){const f=g.pattern.attributes.text;d=Math.max(d,f.length)}}const h=this._bindBlock(t,s,o,i,n,d,a);for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._storeElement(c,o),this._bufferOffsetToId.set(h.buffer.getId(),h.offset+u,l)}if(s===Mn)for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._setTextCharacters(c.end.pattern)}return h.address}_refreshTextElements(){const t=this._bufferList.getBuffers();for(const e of t)if(e&&e.type===Mn){const s=e.getSideDataView(),i=e.getTotalSideElementsSize(),n=e.getSize();let r=0,o=i;for(let a=0;a<n;++a){const l=this._textManager.extractTextFromDataView(s,r,o);this._textManager.storeTextInDataView(s,r,o,l),r=o,o+=i}e.triggerUpdate()}}extractElement(t,e=0){if(!t)return null;const s=this._bufferList.getBlockInfo(t);return this._renderer.extractElement(s.buffer,s.offset+e)}getDomElement(){return this._domElement}getDomWrapper(){return this._domWrapper}measureText(t,e,s,i=1){return this._textManager.measureText(t,e,s,i)}setRenderType(t){this._renderType!==t&&(this._renderType=t,this._switchMainRenderer=!0)}setEdgeArrowSizeRatio(t){Mi.setEdgeArrowSizeRatio(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_ARROW_SIZE_RATIO",t)}setEdgeMinTipSize(t){Mi.setMinEdgeTipSize(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_MIN_TIP_SIZE",t)}setBentEdges(t,e){this._view.bentEnable=t,this._view.bentVertical=e}getBentEdges(){return{bentEnable:this._view.bentEnable,bentVertical:this._view.bentVertical}}_ensureMainRendererReady(){if(this._switchMainRenderer){this._renderType===null&&(this._renderType="canvas");const t=ka[this._renderType];t&&t.isAvailable()||(this._renderType="canvas"),this._renderer=this._renderersByType[this._renderType],this._renderer||(this._renderer=this._instanciateRenderer(this._renderType),this._renderer.on("error",(e=>this.fire("error",e))),this._renderersByType[this._renderType]=this._renderer),this._updateDomElement()}}_updateDomElement(){const t=this._renderer&&this._renderer.getDomElement(),e=this._domElement;for(;e&&e.firstChild;)e.removeChild(e.firstChild);t&&this._appendDomChild(t)}_appendDomChild(t){t.style.position="absolute",t.style.left="0",t.style.top="0",this._domElement.appendChild(t)}_instanciateRenderer(t){return new(t===null?Mi:ka[t])({initData:t===null?null:this._initData[t],bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,memoryManager:this._memoryManager})}setView(t){this._view={...this._view,...t}}getTextManager(){return this._textManager}_updateManagers(){this._patternManager.setPixelRatio(this._view.pixelRatio),this._shapeManager.update(),this._patternManager.update(),this._textManager.update(),this._boundariesManager.update(),this._bufferList.update(),this._refreshTexts&&(this._refreshTexts=!1,this._refreshTextElements())}_resizeCanvas(t){A0(t,this._view.width,this._view.height,this._view.pixelRatio)}render(){this._ensureMainRendererReady(),this._ensureDomElementsFitParent(),this._ensureCorrectBackgroundColor(),this._updateManagers(),this._renderer.renderFrame(this._view)}ensureAnimationsReady(){this._ensureMainRendererReady(),this._renderer.ensureAnimationsReady()}export(t,e,s){const i=this._instanciateRenderer(t),n={...this._view,...e};return"setViewportClipping"in i&&i.setViewportClipping(!1),this._updateManagers(),i.renderFrame(n),i.export(s).then((()=>i.getDomElement()))}getCurrentTime(){return ps()}getImageData(){return this._renderer&&this._renderer.getImageData()}destroy(){for(const t of Object.keys(this._renderersByType)){const e=this._renderersByType[t];e&&e.destroy()}}transparentify(t){const e=this.parseColor(t)||gf;return`rgba(${Math.round(255*e[0])},${Math.round(255*e[1])},${Math.round(255*e[2])},0)`}initDebugRenderingLoop({triggerKey:t="r",start:e=!0}={}){let s=e;document.addEventListener("keydown",(({key:n})=>{n===t&&(s=!s)}));const i=n=>{(s||n)&&(this.setView({currentTime:ps()}),this.render()),window.requestAnimationFrame((()=>{i()}))};window.requestAnimationFrame((()=>{document.body.appendChild(this.getDomElement()),i(!0)}))}},WC=fd&&document.fonts,$C=200,ch="/qwerty/ [HELLO] ",mf="serif",ZC=16,KC=class{constructor(){this._fontFaceSet=WC?document.fonts:null,this._canvas=ls(),this._ctx=this._canvas.getContext("2d")}_measureText(t,e){return this._ctx.font=`12px ${e}`,this._ctx.measureText(t).width}check(t){if(t===mf)return!0;const e=this._measureText(ch,mf);return this._measureText(ch,t)!==e}load(t){return this._fontFaceSet&&this._fontFaceSet.load?this._fontFaceSet.load(`12px ${t}`):(this._ctx.font=`12px ${t}`,this._ctx.fillText(ch,10,50),Promise.resolve())}},QC=class{constructor(t,e){this._fontLoaderCounter=0,this._loaded=!1,this._value=null,this._timeout=0,this._fontFaceSet=t,this._fontName=e,this._loaded=!1,this._value=null,this._timeout=0,fd&&!this._fontFaceSet.check(this._fontName)||this._setLoaded()}_setLoaded(){this._loaded=!0,this._value=this._fontName}getValue(){return this._value}isLoaded(){return this._loaded}destroy(){clearTimeout(this._timeout)}load(){return this._tryLoad($C).then((()=>this._setLoaded()))}_tryLoad(t){return this._fontFaceSet.load(this._fontName).then((()=>{if(!this._fontFaceSet.check(this._fontName)&&this._fontLoaderCounter<ZC)return new Promise((e=>{t<6e4&&(this._timeout=setTimeout(e,t))})).then((()=>(this._fontLoaderCounter++,this._tryLoad(1.5*t))))}))}},JC=class{constructor(){this._fontFaceSet=new KC,this._fonts={},this._onFontLoaded=[],this._hideUntilFontsLoaded=!0}setHideUntilFontsLoaded(t){this._hideUntilFontsLoaded=t}getFont(t){let e=this._fonts[t];return e||(e=new QC(this._fontFaceSet,t),this._fonts[t]=e,e.isLoaded()||e.load().then((()=>this._triggerFontLoaded(t)))),!this._hideUntilFontsLoaded&&t||e.getValue()}onFontLoaded(t){this._onFontLoaded.push(t)}destroy(){this._onFontLoaded=[],Object.keys(this._fonts).forEach((t=>this._fonts[t].destroy()))}_triggerFontLoaded(t){this._onFontLoaded.forEach((e=>e(t)))}},ha="shifted",tL="centered";function Hi(t,e,s){s=s||e,e in t&&(t.attributes[s]=t[e])}function nb(t,e=(s=>s)){const s=e(JSON.parse(t)),i=s.nodes||[],n=s.edges||[];for(let r=0;r<i.length;r++){const o=i[r];o.attributes||(o.attributes={}),typeof o.size=="string"&&(o.size=+o.size),typeof o.x=="string"&&(o.x=+o.x),typeof o.y=="string"&&(o.y=+o.y),Hi(o,"x"),Hi(o,"y"),Hi(o,"size","radius"),Hi(o,"color"),Hi(o,"text")}for(let r=0;r<n.length;r++){const o=n[r];o.attributes||(o.attributes={}),typeof o.size=="string"&&(o.size=+o.size),Hi(o,"size","width"),Hi(o,"color"),Hi(o,"text")}return{nodes:i,edges:n}}function eL(t){return t.type==="vertex"||t._type==="vertex"||t.inE||t.outE||t._inE||t._outE}function sL(t){return t.type==="edge"||t._type==="edge"||t.inV||t.outV||t._outV||t._inV}function ao(t,e,s){if(t&&typeof t=="object"){if(Array.isArray(t))return t.forEach((i=>ao(i,e,s)));if(eL(t)){const i={};t.properties&&Object.keys(t.properties).forEach((r=>{i[r]=t.properties[r][0].value}));const n=Nu(t);e.push({id:n,data:{id:t.id+"",categories:[t.label],properties:i}});for(const r in t)r!=="properties"&&ao(t[r],e,s);return}if(sL(t)){const i=Nu(t);s.push({id:i,source:ff(t,["inV","_inV"]),target:ff(t,["outV","_outV"]),data:{id:i,type:t.label,properties:t.properties||{}}});for(const n in t)n!=="properties"&&ao(t[n],e,s);return}Object.keys(t).forEach((i=>ao(t[i],e,s)))}}function ff(t,e){for(const s of e)if(t[s])return Nu(t[s])}function Nu(t){if(typeof t=="string"||isFinite(t))return String(t);const e=t;return String(e.id||e._id)}function iL(t){const e=[],s=[];return ao(typeof t=="string"?JSON.parse(t):t,e,s),{nodes:e,edges:s}}var Ls=t=>t.charCodeAt(0),nL=Ls(" "),pf=Ls("<"),Al=Ls(">"),_f=Ls('"'),rL=Ls(`
`),oL=Ls("\r"),Sl=Ls("/"),aL=Ls("\\"),lL=Ls("a"),dL=Ls("z"),hL=Ls("A"),uL=Ls("Z"),cL=Ls("0"),gL=Ls("9"),mL=Ls(":"),rb=-1,Ru=-2,ob=-3,ab=-4;function fL(t){const e=new Int32Array(t.length);for(let s=0,i=t.length;s<i;++s)e[s]=t.charCodeAt(s);return e}function pL(t,e,s,i){const n=i.length;if(s-e!==n)return!1;for(let r=0;r<n;++r)if(t[e+r]!==i[r])return!1;return!0}function _L(t,e,s,i){return lb(t.tags,e,s,i)}function yL(t,e,s,i){return lb(t.attributes,e,s,i)}function lb(t,e,s,i){const n=t.length;for(let r=0;r<n;++r)if(pL(e,s,i,t[r]))return r;return t.push(e.slice(s,i)),n}function xL(t,e,s){let i=wl(e,s),n=e[i];if(n===Al||n===Sl)return i;let r=i;i=hb(e,i);const o=yL(t,e,r,i);for(;e[i]!==_f;)++i;for(++i,r=i;(n=e[i])!==_f;)n===aL&&++i,++i;return t.tokens.push(ob,o,r,i),i+1}function bL(t,e){let s,i;const n={tags:[],attributes:[],tokens:[]},r=n.tokens;let o=wl(t,e);for(;o<t.length;){let a=t[o];if(a===pf){if(o=wl(t,++o),t[o]===Sl)for(r.push(Ru);t[++o]!==Al;);else{s=o,o=hb(t,s);const l=_L(n,t,s,o);for(r.push(rb,l),a=t[o];a!==Al&&a!==Sl;)o=xL(n,t,o),a=t[o];if(a===Sl)for(r.push(Ru);t[++o]!==Al;);}o+=1}else{for(s=o;t[++o]!==pf;);for(i=o-1;db(t[i]);)--i;r.push(ab,s,i+1)}o=wl(t,o)}return n}function db(t){return t===nL||t===rL||t===oL}function wl(t,e){for(;db(t[e]);)++e;return e}function vL(t){return t>=lL&&t<=dL||t>=hL&&t<=uL||t===mL||t>=cL&&t<=gL}function hb(t,e){for(;vL(t[e]);)++e;return e}function yf(t,e){const s=Object.keys(e),i={};if(s.length>0)for(let n=0;n<s.length;++n){const r=e[s[n]],o=r.title;i[o]=r.default!==void 0?JSON.stringify(r.default):void 0}return t?()=>({id:void 0,attributes:{text:void 0,color:void 0,radius:void 0,x:void 0,y:void 0},data:{...i}}):()=>({id:void 0,source:void 0,target:void 0,attributes:{color:void 0,text:void 0,width:void 0},data:{...i}})}function xf(t){return t.indexOf("\\")===-1||(t=t.replace(/\\"/g,'"')),t}function ub(t){if(t.indexOf("<gexf")===-1)throw new Error("not a GEXF file");const e=fL(t),s=bL(e,t.indexOf("<gexf ")),i={},n={};s.tags.forEach(((Ae,Xt)=>{const Wt=String.fromCharCode.apply(null,Ae);i[Wt]=Xt})),s.attributes.forEach(((Ae,Xt)=>{const Wt=String.fromCharCode.apply(null,Ae);n[Wt]=Xt}));const r=i.attributes,o=i.attribute,a=i.node,l=i.edge,d=i.default,h=i["viz:position"],u=i["viz:size"],c=i["viz:color"],g=i.attvalue,m=n.class,f=n.id,p=n.type,_=n.title,x=n.label,y=n.source,b=n.target,v=n.x,A=n.y,S=n.r,w=n.g,I=n.b,M=n.a,N=n.value,D=n.for,q=n.weight,et={float:1,double:1,integer:2,boolean:3,string:4,"list-string":5};let O=0;const K=s.tokens,j=K.length,ot=new Array(16);let it=0,ct=0,pt=0,Pt=!0;const At={},bt={};let It,Ut,Gt="",Dt="",Rt="",Tt={attributes:{}},Nt=0,Ht=0,qt=0,Zt=1,Lt="",Kt=!1,ue=!0,ne=null,se=null;const le=[],ge=[];let ve=0,Le={};for(;O<j;){const Ae=K[O];if(Ae===rb)ct=it,it=K[O+1],ot[pt]=it,pt+=1,it===a?(ne||(ne=yf(!0,At)),Tt=ne(),ue=!0,Le=At):it===l&&(se||(se=yf(!1,bt)),Tt=se(),ue=!1,Le=bt),O+=2;else if(Ae===Ru){if(Gt&&it===o){Le=Pt?At:bt;const Xt=et[Dt];let Wt=It;Wt&&(Xt===1?Wt=+Wt:Xt===2?Wt=0|+Wt:Xt===3?Wt=Wt==="true":Xt===5&&(Wt=Wt.split(" ").filter((is=>is)))),Le[Gt]={title:Rt||Gt,default:Wt,type:Xt},Gt="",Rt="",Dt="",It=void 0}else if(it===a&&pt===4)Kt&&Tt.attributes&&(Tt.attributes.color=`rgba(${Nt}, ${Ht}, ${qt}, ${Zt})`,Nt=0,Ht=0,qt=0,Zt=1,Kt=!1),Tt.id||(Tt.id=++ve),le.push(Tt);else if(it===l&&pt===4)Tt.id||(Tt.id=++ve),ge.push(Tt);else if(it===g&&pt===6&&Lt){const Xt=(ue?At:bt)[Lt];if(Xt){if(Ut===void 0)Ut=Xt.default;else{const is=Xt.type;is&&(is===1?Ut=+Ut:is===2?Ut=0|+Ut:is===3?Ut=Ut==="true":is===5?Ut=Ut.split(" ").filter((Rs=>Rs)).map((Rs=>xf(Rs))):typeof e=="string"&&(Ut=xf(Ut)))}Tt.data||(Tt.data={});const Wt=Le;Tt.data[Wt[Lt].title]=Ut}Lt="",Ut=null}pt-=1,it=ct,ct=ot[pt-2],O+=1}else if(Ae===ob){const Xt=K[O+1],Wt=t.substring(K[O+2],K[O+3]);if(it===r)Xt===m&&(Pt=Wt!=="edge"&&Wt!=="edges");else if(it===o)Xt===f?Gt=Wt:Xt===p?Dt=Wt:Xt===_&&(Rt=Wt);else if(it!==a&&it!==l||pt!==4)if(it===h&&pt===5){if(Xt===v)Tt.attributes.x=parseFloat(Wt);else if(Xt===A){const is=parseFloat(Wt);Tt.attributes.y=is===0?is:-is}}else it===c&&pt===5?(Kt=!0,Xt===S?Nt=parseInt(Wt):Xt===w?Ht=parseInt(Wt):Xt===I?qt=parseInt(Wt):Xt===M&&(Zt=parseFloat(Wt))):it===u&&pt===5?Xt===N&&(ue?Tt.attributes.radius=+Wt:Tt.attributes.width=+Wt):it===g&&pt===6&&(Xt===D||Xt===f?Lt=Wt:Xt===N&&(Ut=Wt));else Xt===f?Tt.id=Wt:Xt===x?Tt.attributes.text=Wt:Xt===y?Tt.source=Wt:Xt===b?Tt.target=Wt:Xt===q&&(Tt.attributes.width=+Wt);O+=4}else{if(Ae!==ab)throw new Error(`at index ${O}: token ${Ae}`);{const Xt=t.substring(K[O+1],K[O+2]);it===d&&(It=Xt),O+=3}}}return{nodes:le,edges:ge}}function EL(t){for(let e=0;e<64;++e)t[e]^=1;for(let e=0;e<64&&!(t[e]^=1);++e);}function AL(t,e,s){for(let i=0;i<32;++i)s[i]=+!!(t&1<<i);for(let i=0;i<32;++i)s[i+32]=+!!(e&1<<i);return s}function bf(t,e){let s=0;for(let i=0;i<20;++i){const n=s+t[i]+e[i];s=+(n>=10),t[i]=n%10}}var SL=class{constructor(){this._decimalPowerOfTwo=new Uint8Array(20),this._binaryNumber=new Uint8Array(64),this._decimalNumber=new Uint8Array(20)}int64ToString({low:t,high:e}){if(t===0&&e===0)return"0";AL(t,e,this._binaryNumber),this._decimalNumber.fill(0),this._decimalPowerOfTwo.fill(0),this._decimalPowerOfTwo[0]=1;const s=this._binaryNumber[63]===1;s&&EL(this._binaryNumber);for(let r=0;r<64;++r)this._binaryNumber[r]&&bf(this._decimalNumber,this._decimalPowerOfTwo),bf(this._decimalPowerOfTwo,this._decimalPowerOfTwo);const i=[];let n=this._decimalNumber.length-1;for(s&&i.push("-");!this._decimalNumber[n];)n-=1;for(let r=n;r>=0;--r)i.push(String(this._decimalNumber[r]));return i.join("")}},wL=new SL;function Oa(t){return wL.int64ToString(t)}function Ba(t){return typeof t=="object"&&"high"in t&&"low"in t}function TL(t){return"start"in t&&"end"in t}function CL(t){if(typeof t!="object"||t===null)throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. Please make sure that your Cypher query returns nodes and edges, not values.");const e=Object.keys(t.properties);for(const s of e){const i=t.properties[s];Ba(i)&&(t.properties[s]=Oa(i))}if(t.identity!==void 0){if(Ba(t.identity)&&(t.identity=Oa(t.identity)),TL(t)){const s=t.start.identity||t.start,i=t.end.identity||t.end;Ba(s)&&(t.start=Oa(s)),Ba(i)&&(t.end=Oa(i))}}else t.id&&(t.identity=t.id)}var LL=t=>"start"in t&&"end"in t&&"type"in t,IL=t=>"segments"in t;function ML(t,e,s,i){e.segments.forEach((n=>{wo(t,n.start,s,i),wo(t,n.end,s,i),wo(t,n.relationship,s,i)}))}function wo(t,e,s,i){if(e)if(Array.isArray(e))e.forEach((n=>wo(t,n,s,i)));else if(IL(e))ML(t,e,s,i);else if(CL(e),LL(e))i.has(e.identity)||(i.add(e.identity),t.edges.push({id:e.identity,source:e.start,target:e.end,data:{neo4jType:e.type,neo4jProperties:e.properties}}));else{const n=e;s.has(n.identity)||(s.add(n.identity),t.nodes.push({id:n.identity,attributes:{},data:{neo4jLabels:n.labels,neo4jProperties:n.properties}}))}}var NL=t=>"queryKeys"in t&&"values"in t;function RL(t){const e=[];return t.values.forEach((s=>{const{nodes:i=[],relationships:n=[],segments:r=[]}=s.adapted,o=[{segments:r,properties:{}}];e.push({_fields:[...i,...n,...o]})})),{records:e}}function FL(t){let e=typeof t=="string"?JSON.parse(t):t;const s={nodes:[],edges:[]},i=new Set,n=new Set;return NL(e)&&(e=RL(e)),e.records.forEach((({_fields:r})=>r.forEach((o=>wo(s,o,i,n))))),s}var PL={boolean:t=>t.toLowerCase()==="true",int:parseFloat,long:parseFloat,float:parseFloat,double:parseFloat,string:t=>t};function zL(t){const e={graph:{},node:{},edge:{}},s={graph:{},node:{},edge:{}};for(let i=0;i<t.length;i++){const n=t[i],r=n.getAttribute("for")||"node",o=n.getAttribute("id"),a=n.getAttribute("attr.name"),l=n.getAttribute("attr.type")||"string",d=n.getElementsByTagName("default"),h=d.length!==0?d[0].textContent:void 0;e[r][o]={name:a,parse:PL[l]},typeof h<"u"&&(s[r][a]=h)}return{definitions:e,defaults:s}}function vf(t,e,s){const i=t.getElementsByTagName("data"),n={};for(let r=0;r<i.length;r++){const o=i[r],a=o.getAttribute("key");if(a===null)continue;const l=e[a];typeof l>"u"?n[a]=o.textContent:o.textContent&&o.textContent.length!==0&&(n[l.name]=l.parse(o.textContent))}for(const r in s)r in n||(n[r]=s[r]);return n}function gh(t){return t.color?t.color:t.r&&t.g&&t.b?`rgb(${t.r}, ${t.g}, ${t.b})`:void 0}var DL=new Set(["x","y","size","color","r","g","b","label"]);function Ef(t){const e={};for(const s in t)DL.has(s)||t[s]===void 0||(e[s]=t[s]);return e}function cb(t,e){if(!e){if(typeof DOMParser>"u")throw new Error("DOMParser is not available. You need to provide a DOMParser instance as second argument, if you are not in the browser environment");e=new DOMParser}const s=e.parseFromString(t,"application/xml"),i=s.getElementsByTagName("key"),n=s.getElementsByTagName("node"),r=s.getElementsByTagName("edge"),{definitions:o,defaults:a}=zL(i),l=[],d=new Set;for(let u=0;u<n.length;u++){const c=n[u],g=c.getAttribute("id"),m=c.getAttribute("href")||void 0,f=vf(c,o.node,a.node);d.add(g);const p={id:g,attributes:{x:f.x,y:f.y,radius:f.size,color:gh(f),text:f.label},data:Ef(f)};f.x!==void 0&&(p.attributes.x=f.x),f.y!==void 0&&(p.attributes.y=f.y),f.size!==void 0&&(p.attributes.radius=f.size),f.label!==void 0&&(p.attributes.text=f.label);const _=gh(f);_!==void 0&&(p.attributes.color=_),m!==void 0&&(p.data.href=m),l.push(p)}const h=[];for(let u=0;u<r.length;u++){const c=r[u],g=c.getAttribute("id")||u,m=c.getAttribute("source"),f=c.getAttribute("target"),p=c.getAttribute("xlink:href")||void 0;if(!d.has(m)||!d.has(f))throw new Error(`Invalid edge: ${m} -> ${f}`);const _=vf(c,o.edge,a.edge),x={id:g,source:m,target:f,attributes:{},data:Ef(_)},y=gh(_);y!==void 0&&(x.attributes.color=y),p!==void 0&&(x.data.href=p),h.push(x)}return{nodes:l,edges:h}}var gb=t=>{const e=t.split(`
`).filter((n=>!n.startsWith("%"))),[s]=e[0].split(" ").map(Number),i=e.slice(1).map((n=>n.split(" ").slice(0,2).map(Number))).filter((n=>n.length===2));return{nodes:Array.from({length:Number(s)},((n,r)=>({id:r}))),edges:i.map((([n,r])=>({source:n%s,target:r%s})))}};function kL(t,e,s,i){dg(t,e,s,i),t.thicknessOrFontSizeScaled=e.widthScaled,t.thicknessOrFontSizeFixed=e.widthFixed,t.strokeWidthScaled=e.stroke.widthScaled,t.strokeWidthFixed=e.stroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.color,t.strokeColor=e.stroke.color,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=e.stroke.minVisibleSize,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function dg(t,e,s,i){t.pieceId=s,t.shape=i,t.x1=e.sourceX,t.y1=e.sourceY,t.x2=e.targetX,t.y2=e.targetY,t.rectWidthOrSourceRadiusScaled=e.sourceRadiusScaled,t.rectWidthOrSourceRadiusFixed=e.sourceRadiusFixed,t.rectHeightOrTargetRadiusScaled=e.targetRadiusScaled,t.rectHeightOrTargetRadiusFixed=e.targetRadiusFixed,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=xs,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.widthScaled,t.curvature=e.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=e.isSelfLoop,t.isText=!1}function OL(t,e,s){const i=e.widthScaled+2*e.halo.widthScaled,n=e.widthFixed+2*e.halo.widthFixed;dg(t,e,s,"line"),t.thicknessOrFontSizeScaled=i,t.thicknessOrFontSizeFixed=n,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.halo.color,t.strokeColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1}function BL(t,e,s,i){dg(t,e,s,i);const n=e.widthFixed*qm+_2;t.thicknessOrFontSizeScaled=e.widthScaled*Vm,t.thicknessOrFontSizeFixed=e.widthFixed*Vm,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=e.widthScaled*qm,t.offsetFixed=n,t.fillColor=e.outline.color,t.strokeColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,e.outline.minVisibleSize),t.strokeMinVisibleSize=0,t.offsetAngle=Math.PI/2,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function UL(t,e,s){mb(t,e,s),t.pattern.type=on,t.pattern.attributes.text=e.content,t.pattern.attributes.size=aa,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternColor=e.color,t.patternScale=1,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function GL(t,e,s){mb(t,e,s),t.pieceId+=wn,t.fillColor=e.backgroundColor,t.shape="square"}function mb(t,e,s){let i=e.position==="centered"?0:(s.widthScaled+e.heightScaled)/2+s.stroke.widthScaled,n=e.position==="centered"?0:(s.widthFixed+e.heightFixed)/2+s.stroke.widthFixed+e.padding+e.margin;if(e===s.texts.secondary&&s.texts.primary.position==="centered"&&(n=s.texts.primary.heightFixed/2+s.texts.primary.padding+s.texts.primary.margin+e.padding+e.margin,i=0),t.pieceId=_n,t.shape="square",t.x1=s.sourceX,t.y1=s.sourceY,t.x2=s.targetX,t.y2=s.targetY,!s.isSelfLoop&&s.curvature===0){const r=Math.atan2(t.y2-t.y1,t.x2-t.x1),o=s.sourceRadiusScaled-s.targetRadiusScaled,a=Math.cos(r),l=Math.sin(r);t.x1+=a*o,t.y1+=l*o}t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding+1,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=s.sourceRadiusScaled+s.targetRadiusScaled,t.strokeWidthFixed=s.sourceRadiusFixed+s.targetRadiusFixed,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=xs,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,s.minVisibleSize),t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.offsetAngle,t.patternScale=0,t.symbolicSize=s.widthScaled,t.curvature=s.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=s.isSelfLoop,t.isText=!1,t.adjustTextAngle=e.adjustAngle}var VL=t=>!!t||t===0;function oi(t,e,s=0){return t==="inherit"?Array.isArray(e)?e[((s/(2*Math.PI)*e.length|0)+1)%e.length]:e:t}function qL(t,e,s){return t==="source"?Array.isArray(e)?e[0]:e:t==="target"?Array.isArray(s)?s[0]:s:t}function HL(t){const e=t.depth;return e===w0||e===S0||(e-Kc)%Jc>=Qc}function fb(t){const e=(t.depth-Kc)%Jc;return e>=0&&e!==T0&&e!==Qc}function Af(t,e,s,i,n,r){jL(t,e,s,i,n,r),Sf(t,e,s,i.text,n.texts.primary,r.texts.primary,r),Sf(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r)}function jL(t,e,s,i,n,r){if(mh(n.body,r,kL),n.halo.body){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),mh(n.halo,r,OL)}n.outline.body&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),mh(n.outline,r,BL))}function mh(t,e,s){s(t.body,e,Sd,e.shape.body),t.head&&e.shape.head!==null&&s(t.head,e,Xc,e.shape.head),t.tail&&e.shape.tail!==null&&s(t.tail,e,Wc,e.shape.tail)}function Sf(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=oi(a.color.get(s),o.color),r.position=a.position?a.position.get(s):ha,r.style=a.style.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=eg(r.content,r.maxLineLength),r.adjustAngle=a.adjustAngle.get(s),r.align=a.align.get(s),l){const h=a.scale.get(s);r.sizeScaled=o.widthScaled*h,r.sizeFixed=o.widthFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.offsetAngle=r===o.texts.primary?y2:x2,UL(n.text,r,o),n.background&&GL(n.background,r,o)}}function wf(t,e){fh(t.body,e,!0,!0),fh(t.outline,e,e.outline.enabled,!0),fh(t.halo,e,!!e.halo.color,!1),Tf(t.texts.primary,e.texts.primary),Tf(t.texts.secondary,e.texts.secondary)}function fh(t,e,s,i){t.body=s,t.head=s&&i&&!!e.shape.head,t.tail=s&&i&&!!e.shape.tail}function Tf(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor}function Cf(t,e,s,i,n,r){YL(t,e,s,i,n,r),Lf(t,e.texts.primary,s.text,i,e),Lf(t,e.texts.secondary,s.text.secondary,i,e)}function YL(t,e,s,i,n,r){const o=n.source,a=n.target,l=s.source.get(i),d=s.target.get(i),h=o.x.get(l),u=o.y.get(l),c=o.radius.get(l),g=o.innerStroke.width.get(l),m=+(o.innerStroke.color.get(l)!==null),f=+(o.innerStroke.scalingMethod.get(l)==="scaled"),p=o.outerStroke.width.get(l),_=+(o.outerStroke.color.get(l)!==null),x=+(o.outerStroke.scalingMethod.get(l)==="scaled"),y=o.color.get(l),b=+(o.scalingMethod.get(l)==="scaled"),v=a.x.get(d),A=a.y.get(d),S=a.radius.get(d),w=a.innerStroke.width.get(d),I=+(a.innerStroke.color.get(d)!==null),M=+(a.innerStroke.scalingMethod.get(d)==="scaled"),N=a.outerStroke.width.get(d),D=+(a.outerStroke.color.get(d)!==null),q=+(a.outerStroke.scalingMethod.get(d)==="scaled"),et=a.color.get(d),O=+(a.scalingMethod.get(d)==="scaled"),K=qL(s.color.get(i),y,et),j=s.width.get(i),ot=s.scalingMethod.get(i)==="scaled"?1:0,it=s.stroke.width.get(i),ct=s.stroke.scalingMethod.get(i)==="scaled"?1:0,pt=b2[s.shape.style.get(i)],Pt=s.adjustAnchors.get(i);if(e.source=l,e.target=d,e.sourceX=h,e.sourceY=u,e.targetX=v,e.targetY=A,e.sourceRadiusScaled=g*m*f+p*_*x+c*b,e.sourceRadiusFixed=g*m*(1-f)+p*_*(1-x)+c*(1-b),e.targetRadiusScaled=w*I*M+N*D*q+S*O,e.targetRadiusFixed=w*I*(1-M)+N*D*(1-q)+S*(1-O),e.widthScaled=j*ot,e.widthFixed=j*(1-ot),e.curvature=s.curvature.get(i),e.isSelfLoop=l===d,e.color=K,e.opacity=s.opacity.get(i),e.minVisibleSize=s.minVisibleSize.get(i),e.shape.body=s.shape.body.get(i),e.shape.head=s.shape.head.get(i),e.shape.tail=s.shape.tail.get(i),e.shape.dashLength=pt.dash,e.shape.gapLength=pt.gap,e.shape.isBodyTriangle=e.shape.body==="triangle",e.stroke.color=oi(s.stroke.color.get(i),K),e.stroke.widthScaled=it*ct,e.stroke.widthFixed=it*(1-ct),e.stroke.minVisibleSize=s.stroke.minVisibleSize.get(i),e.halo.color=s.halo.color.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1,Pt&&(e.shape.head||e.shape.tail||e.shape.body==="triangle")){const At=e,bt=At.curvature,It=At.sourceX,Ut=At.sourceY,Gt=At.targetX,Dt=At.targetY;let Rt=1,Tt=1;if(bt){if(!At.isSelfLoop){const Nt=Rd(It,Ut,Gt,Dt,bt/2);Rt=Ua(At,r,o,l,It,Ut,Nt.x,Nt.y),Tt=Ua(At,r,a,d,Gt,Dt,Nt.x,Nt.y)}}else Rt=Ua(At,r,o,l,It,Ut,Gt,Dt),Tt=Ua(At,r,a,d,Gt,Dt,It,Ut);e.sourceRadiusScaled*=Rt,e.sourceRadiusFixed*=Rt,e.targetRadiusScaled*=Tt,e.targetRadiusFixed*=Tt}}function Lf(t,e,s,i,n){e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=oi(s.backgroundColor.get(i),n.color)}function Ua(t,e,s,i,n,r,o,a){const l=e.angle||0;let d,h=Math.atan2(a-r,o-n)-l,u=1,c=0;h<-Ys?h+=vo:h>Ys&&(h-=vo),h<-Ys/2?(c=C0,d=s.badges.topLeft):h<0?(c=L0,d=s.badges.topRight):h<Ys/2?(c=M0,d=s.badges.bottomRight):(c=I0,d=s.badges.bottomLeft),c+=l;const g=d.text.content&&d.text.content.get(i),m=d.image.url&&d.image.url.get(i);if(VL(g)||m){const f=d.positionScale.get(i),p=d.scale.get(i),_=Vx(o,a,n,r,n+Math.cos(c)*f,r+Math.sin(c)*f,p);if(_){const x=_.x-n,y=_.y-r,b=Math.sqrt(x*x+y*y);u=Math.max(u,b)}}if(s.shape.get(i)==="square"){const f=Math.abs(Math.cos(h)),p=Math.abs(Math.sin(h)),_=1/Math.max(f,p);u=Math.max(u,_)}return u}function If(){return{source:0,target:0,sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:!1,color:"",opacity:0,minVisibleSize:0,shape:{body:"line",head:null,tail:null,dashLength:0,gapLength:0,isBodyTriangle:!1},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:!1,color:"",minVisibleSize:0},textHidden:!1,texts:{primary:Mf(),secondary:Mf()}}}function Mf(){return{align:"left",hidden:!1,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",minVisibleSize:0,margin:0,padding:0,position:ha,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:!1,offsetAngle:0}}function XL(t){return t===null?t:void 0}function rs(t){return typeof t=="boolean"||t===0||t===1?t:void 0}function Fn(t){return typeof t=="number"&&isFinite(t)?t:void 0}function Re(t){return typeof t=="number"&&isFinite(t)&&t>=0?t:void 0}var pb=-100,WL=400,_b=t=>typeof t=="number"&&isFinite(t)&&t>=pb&&t<=WL?t:void 0;function Ti(t){return t===null||typeof t=="string"||typeof t=="number"?t:void 0}function Ci(t){return t==="fixed"||t==="scaled"?t:void 0}function Ki(t){return ys(t)?t:void 0}function $L(t){return t===tL||t===ha?t:void 0}function gs(t){return t==="inherit"||ys(t)?t:void 0}function ZL(t){return t==="source"||t==="target"||ys(t)?t:void 0}function br(t){return t===null?null:typeof t=="string"?t.split(",").map((e=>{const s=e.trim(),i=s.indexOf(" ")!==-1,n=s[0];return i&&n!=='"'&&n!=="'"?`"${s}"`:s})).join(","):void 0}function vr(t){return t==="none"?"normal":t==="normal"||t==="italic"||t==="bold"||t==="italic bold"||t==="bold italic"||t==="100"||t==="200"||t==="300"||t==="400"||t==="500"||t==="600"||t==="700"||t==="800"||t==="900"?t:void 0}function Jl(t){return t==="left"||t==="center"?t:void 0}function KL(t){return t==="equilateral"?"pentagon":t==="triangle"?"triangleUp":t==="triangleRight"?"triangle":t==="circle"||t==="square"||t==="cross"||t==="diamond"||t==="pentagon"||t==="hexagon"||t==="star"||t==="triangleUp"||t==="triangleDown"||t==="triangleLeft"||t==="triangle"?t:void 0}var QL=new Set(["line","tapered","arrow","dashed","dotted"]);function JL(t){return QL.has(t)?t:void 0}function tI(t){return t==="line"||t==="triangle"?t:void 0}function Nf(t){return t===null||t==="arrow"||t==="circle-hole-arrow"||t==="triangle-hole-arrow"||t==="short-arrow"||t==="sharp-arrow"||t==="circle"||t==="square"?t:void 0}function eI(t){return t==="plain"||t==="dashed"||t==="dotted"?t:void 0}function sI(t){return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="center"?t:void 0}function iI(t){if(ys(t))return t;if(Array.isArray(t)){if(t.length<1)return;for(let e=0;e<t.length;++e)if(!ys(t[e]))return;return t}}function xe(t){return function(e){if(typeof e=="number")return isFinite(e)&&e>=0?e:void 0;if(typeof e!="string"||e.charAt(e.length-1)!=="%")return;const s=parseFloat(e);return isNaN(s)?void 0:t*s/100}}function hg(){return{edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}}function Go(t,e=hg()){const s=(t-pb)*Jc+Kc;return e.edgeHalo=u2,e.nodeHaloStroke=S0,e.nodeHalo=w0,e.edgeBody=s+T0,e.edgeTextBackground=s+c2,e.edgeText=s+g2,e.nodeBody=s+Qc,e.nodeTextBackground=s+m2,e.nodeText=s+f2,e}var nI=(t,e)=>{e.halo.body=e.halo.body||t.halo.body,e.halo.head=e.halo.head||t.halo.head,e.halo.tail=e.halo.tail||t.halo.tail,e.outline.body=e.outline.body||t.outline.body,e.outline.head=e.outline.head||t.outline.head,e.outline.tail=e.outline.tail||t.outline.tail,e.body.body=e.body.body||t.body.body,e.body.head=e.body.head||t.body.head,e.body.tail=e.body.tail||t.body.tail;const s=e.texts,i=t.texts;s.primary.text=s.primary.text||i.primary.text,s.primary.background=s.primary.background||i.primary.background,s.secondary.text=s.secondary.text||i.secondary.text,s.secondary.background=s.secondary.background||i.secondary.background},yb=t=>(e,s)=>{s.halo.body=e.halo.body[t],s.halo.head=e.halo.head[t],s.halo.tail=e.halo.tail[t],s.outline.body=e.outline.body[t],s.outline.head=e.outline.head[t],s.outline.tail=e.outline.tail[t],s.body.body=e.body.body[t],s.body.head=e.body.head[t],s.body.tail=e.body.tail[t],s.texts.primary.text=e.texts.primary.text[t],s.texts.primary.background=e.texts.primary.background[t],s.texts.secondary.text=e.texts.secondary.text[t],s.texts.secondary.background=e.texts.secondary.background[t]},rI=yb("start"),oI=yb("end"),aI=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,view:n,attributes:r,attributesPrev:o,nodeAttributes:a,nodeAttributesPrev:l}){this._fullComponents=Vr(),this._startComponents=Vr(),this._endComponents=Vr(),this._startFlags=Vr(),this._endFlags=Vr(),this._startInput=If(),this._endInput=If(),this._depthInfo=hg(),this._nullElt={id:-1,valid:!0},this._engine=t,this._view=n,this._helper={imageManager:e,fontManager:s,formatText:i},this._attributes=r,this._attributesPrev=o,this._nodeAttributes=a,this._nodeAttributesPrev=l,this._layers=Rf((()=>t.createGroup())),this._blockIds=Rf((()=>0))}drawEdge(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=-t,n=this._attributes,{bentEnable:r,bentVertical:o}=e.getBentEdges(),a=Go(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),l=n.source.get(t),d=n.target.get(t),h=n.curvature.get(t),u=this._attributesPrev.curvature.get(t),c=n.animationDuration.get(t),g=n.animationStart.get(t),m=n.animationEasing.get(t),f=c>0,p=h!==0||f&&u!==0||this._engine.getBentEdges().bentEnable;this._prepareBlocks(f,a,i,p);const _=this._extremitiesAttributes={source:this._nodeAttributes,target:this._nodeAttributes};if(Cf(s,this._endInput,n,t,_,this._view),wf(this._endFlags,this._endInput),f){const x=this._nodeAttributes.animationDuration.get(l)>0,y=this._nodeAttributes.animationDuration.get(d)>0;_.source=x?this._nodeAttributesPrev:this._nodeAttributes,_.target=y?this._nodeAttributesPrev:this._nodeAttributes,Cf(s,this._startInput,this._attributesPrev,t,_,this._view),wf(this._startFlags,this._startInput),nI(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._layers),oI(this._fullComponents,this._endComponents),this._endComponents.body.body.bentEnable=r,this._endComponents.body.body.bentVertical=o,this._endComponents.body.head&&(this._endComponents.body.head.bentEnable=r,this._endComponents.body.head.bentVertical=o),this._endComponents.body.tail&&(this._endComponents.body.tail.bentEnable=r,this._endComponents.body.tail.bentVertical=o),Af(e,s,t,this._attributes,this._endComponents,this._endInput),this._endComponents.texts.primary.text&&(this._endComponents.texts.primary.background&&(this._endComponents.texts.primary.background.bentEnable=r,this._endComponents.texts.primary.background.bentVertical=o),this._endComponents.texts.primary.text.bentEnable=r,this._endComponents.texts.primary.text.bentVertical=o),this._endComponents.texts.secondary.text&&(this._endComponents.texts.secondary.background&&(this._endComponents.texts.secondary.background.bentEnable=r,this._endComponents.texts.secondary.background.bentVertical=o),this._endComponents.texts.secondary.text.bentEnable=r,this._endComponents.texts.secondary.text.bentVertical=o),f&&(rI(this._fullComponents,this._startComponents),Af(e,s,t,this._attributesPrev,this._startComponents,this._startInput),this._setBlocksAnimation(c,g,m)),this._setupHaloMasking(l,d),this._storeBlocks()}_setupHaloMasking(t,e){const s=this._nodeAttributes.halo,i=this._layers,n=s.color.get(t)&&s.hideNonAdjacentEdges.get(t),r=s.color.get(e)&&s.hideNonAdjacentEdges.get(e),o=!n&&!r?E0:xr;i.body.stencilUsage=i.text.stencilUsage=i.textBg.stencilUsage=o}_computeBlockIds(t){const e=t*Td,s=this._blockIds;s.body=e+o2,s.halo=e+d2,s.text=e+a2,s.textBg=e+l2}_prepareBlocks(t,e,s,i){const n=this._layers;n.body.reset(i?Ql:ei,t,e.edgeBody,s),n.halo.reset(i?Ql:ei,t,e.edgeHalo,s),n.text.reset(Mn,t,e.edgeText,s),n.textBg.reset(ei,t,e.edgeTextBackground,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.halo,e.halo),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.halo),t.freeBlock(e.text),t.freeBlock(e.textBg)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._initEdgeComponents(t.halo,e.halo,s.halo),this._initEdgeComponents(t.outline,e.outline,s.body),this._initEdgeComponents(t.body,e.body,s.body),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initEdgeComponents(t,e,s){t.head=this._nextElement(e.head,s),t.tail=this._nextElement(e.tail,s),t.body=this._nextElement(e.body,s)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}};function Rf(t){return{body:t(),halo:t(),text:t(),textBg:t()}}function Vr(){return{halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}}}function lI(t,e,s){xb(t,e,s),e.imageContent!==null?(t.pattern.type=en,t.pattern.attributes.image=e.imageContent,t.pattern.attributes.scaled=!0,t.pattern.attributes.duplicated=!1,t.patternScale=e.imageScale,t.patternMinVisibleSize=0,t.patternColor=null):(t.fillColor=null,t.strokeColor=null)}function dI(t,e,s){xb(t,e,s),e.textContent&&(t.pattern.type=Rn,t.pattern.attributes.text=e.textContent,t.pattern.attributes.font=e.textFont,t.pattern.attributes.style=e.textStyle,t.pattern.attributes.paddingLeft=e.scale*e.textPaddingLeft*2,t.pattern.attributes.paddingTop=e.scale*e.textPaddingTop*2,t.pattern.attributes.size=aa,t.patternMinVisibleSize=0,t.patternColor=e.textColor,t.patternScale=e.textScale,t.isBadge=!0),!e.imageUrl&&e.textContent||(t.fillColor=null,t.strokeColor=null)}function xb(t,e,s){const i=e.scalingMethod==="fixed",n=s.diameterScaled*e.scale;let r=0;const o=s.diameterScaled;i&&(r=s.diameterScaled*e.scale);const a=s.diameterScaled*e.positionScale/2,l=s.diameterFixed*e.positionScale/2;t.pieceId=$s,t.shape="circle",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=n,t.rectWidthOrSourceRadiusFixed=r,t.rectHeightOrTargetRadiusScaled=n,t.rectHeightOrTargetRadiusFixed=r,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.strokeWidthScaled,t.strokeWidthFixed=e.strokeWidthFixed,t.offsetScaled=a,t.offsetFixed=l,t.pattern.type=xs,t.opacity=s.opacity,t.fillColor=e.color,t.strokeColor=e.strokeColor,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.angle,t.patternScale=0,t.symbolicSize=o,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1,t.isBadge=!0}function hI(t,e,s){Fd(t,e),t.fillColor=Array.isArray(e.color)?null:e.color,t.strokeColor=e.innerStroke.color,t.strokeMinVisibleSize=e.innerStroke.minVisibleSize,t.strokeWidthScaled=e.innerStroke.widthScaled,t.strokeWidthFixed=e.innerStroke.widthFixed,s&&(t.pattern.type=xs)}function Fd(t,e){t.pieceId=$s,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=e.diameterScaled,t.rectWidthOrSourceRadiusFixed=e.diameterFixed,t.rectHeightOrTargetRadiusScaled=e.diameterScaled,t.rectHeightOrTargetRadiusFixed=e.diameterFixed,t.shape=e.shape,t.opacity=e.opacity,t.symbolicSize=e.diameterScaled,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=null,t.strokeColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function uI(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=$s,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=xs,t.opacity=e.opacity,t.fillColor=e.halo.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function cI(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=$s,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.halo.strokeWidthScaled,t.strokeWidthFixed=e.halo.strokeWidthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=xs,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.halo.strokeColor,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function gI(t,e){Fd(t,e),t.pattern.type=Nn,t.pattern.attributes.text=e.icon.content,t.pattern.attributes.font=e.icon.font,t.pattern.attributes.style=e.icon.style,t.pattern.attributes.size=aa,t.patternMinVisibleSize=e.icon.minVisibleSize,t.patternColor=e.icon.color,t.patternScale=e.icon.scale}function mI(t,e){const s=e.image.fit&&!e.image.tile;Fd(t,e),t.pattern.type=en,t.pattern.attributes.image=e.image.content,t.pattern.attributes.scaled=s,t.pattern.attributes.duplicated=e.image.tile,t.patternScale=s?e.image.scale:0,t.patternMinVisibleSize=e.image.minVisibleSize,t.patternColor=null}function fI(t,e){const s=e.diameterScaled+2*e.innerStroke.widthScaled,i=e.diameterFixed+2*e.innerStroke.widthFixed;t.pieceId=$s,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.outerStroke.widthScaled,t.strokeWidthFixed=e.outerStroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=xs,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.outerStroke.color,t.patternColor=null,t.globalMinVisibleSize=e.outerStroke.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function pI(t,e){const s=e.diameterScaled*Um,i=e.diameterFixed*Um;let n=e.diameterScaled*Gm,r=e.diameterFixed*Gm+p2;e.outerStroke.color&&(n+=e.outerStroke.widthScaled/2,r+=e.outerStroke.widthFixed/2),t.pieceId=$s,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=xs,t.opacity=e.opacity,t.fillColor=e.outline.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.outline.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=1.5707963267948966,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function _I(t,e){Fd(t,e),Array.isArray(e.color)&&(t.pattern.type=da,t.pattern.attributes.colors=e.color.join(";"),t.patternScale=1,t.patternMinVisibleSize=0,t.patternColor=null)}function yI(t,e,s){bb(t,e,s),t.pattern.type=on,t.pattern.attributes.text=e.content,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternMinVisibleSize=0,t.patternColor=e.color,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function xI(t,e,s){bb(t,e,s),t.fillColor=e.backgroundColor,t.pieceId=wn,t.shape="square"}function bI(t,e,s){const i=Math.ceil(e.margin/2),n=s.diameterScaled/2,r=s.diameterFixed/2+i,o=E2[e.position],a=Math.cos(o),l=Math.sin(o),d=e.margin<12?1:e.margin<30?1-(e.margin-12)/18*.7:.25;t.pieceId=$s,t.shape="triangle",t.x1=s.x-a,t.y1=s.y-l,t.x2=s.x+a,t.y2=s.y+l,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=e.margin,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=e.margin*d,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=xs,t.opacity=s.opacity,t.fillColor=e.backgroundColor,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1}function bb(t,e,s){let i=0,n=0;if(e.isPositionCenter||(i+=s.diameterScaled/2,n+=s.diameterFixed/2+e.margin+e.paddingFixed+e.paddingScaled),e.isPositionVertical){if(i+=e.heightScaled/2,n+=e.heightFixed/2,e===s.texts.secondary&&s.texts.primary.position==="bottom"){const o=s.texts.primary;i+=o.heightScaled,n+=o.heightFixed+o.margin+2*(o.paddingFixed+o.paddingScaled)}}else e.isPositionHorizontal&&(i+=e.widthScaled/2,n+=e.widthFixed/2);const r=aa;t.pieceId=$s,t.shape="square",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=e.widthScaled+2*e.paddingScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.paddingFixed,t.rectHeightOrTargetRadiusScaled=e.heightScaled+2*e.paddingScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.paddingFixed,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=xs,t.pattern.attributes.size=r,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=1,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function Ff(t,e,s,i,n,r){const o=n.badges,a=i.badges,l=r.badges;vI(t,e,s,i,n,r),Pf(t,e,s,i.text,n.texts.primary,r.texts.primary,r),Pf(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r),Ga(t,e,s,a.topLeft,o.topLeft,l.topLeft,r),Ga(t,e,s,a.topRight,o.topRight,l.topRight,r),Ga(t,e,s,a.bottomLeft,o.bottomLeft,l.bottomLeft,r),Ga(t,e,s,a.bottomRight,o.bottomRight,l.bottomRight,r)}function vI(t,e,s,i,n,r){if(n.halo){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),uI(n.halo,r),n.haloStroke&&(r.halo.strokeWidthScaled=0,r.halo.strokeWidthFixed=i.halo.strokeWidth.get(s),cI(n.haloStroke,r))}if(n.outline&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),pI(n.outline,r)),n.outerStroke&&(r.outerStroke.minVisibleSize=i.outerStroke.minVisibleSize.get(s),fI(n.outerStroke,r)),n.pieChart&&_I(n.pieChart,r),n.image&&(r.image.content=e.imageManager.getImage(r.image.url),r.image.fit=i.image.fit.get(s),r.image.tile=i.image.tile.get(s),r.image.scale=i.image.scale.get(s),r.image.minVisibleSize=i.image.minVisibleSize.get(s),mI(n.image,r)),n.icon&&(r.icon.font=e.fontManager.getFont(i.icon.font.get(s)),r.icon.style=i.icon.style.get(s),r.icon.color=i.icon.color.get(s),r.icon.scale=i.icon.scale.get(s),r.icon.minVisibleSize=i.icon.minVisibleSize.get(s),gI(n.icon,r)),n.body){const o=!n.pieChart&&!n.image&&!n.icon;hI(n.body,r,o)}}function Ga(t,e,s,i,n,r,o){if(n.image||n.text){const a=i.stroke.width.get(s),l=+(i.stroke.scalingMethod.get(s)==="scaled");r.color=oi(i.color.get(s),o.color,r.angle),r.strokeColor=i.stroke.color.get(s),r.strokeWidthScaled=a*l,r.strokeWidthFixed=a*(1-l),r.minVisibleSize=i.minVisibleSize.get(s),r.positionScale=i.positionScale.get(s),r.scale=i.scale.get(s)}if(n.image&&(r.imageContent=e.imageManager.getImage(r.imageUrl),r.imageScale=i.image.scale.get(s),lI(n.image,r,o)),n.text){if(r.textFont=e.fontManager.getFont(i.text.font.get(s)),r.textStyle=i.text.style.get(s),r.textColor=oi(i.text.color.get(s),o.color),r.textScale=i.text.scale.get(s),r.textPaddingTop=i.text.paddingTop.get(s),r.textPaddingLeft=i.text.paddingLeft.get(s),t.measureText(r.textContent,r.textFont,r.textStyle,r.textScale).width>1){let a=0,l=0;for(;l<r.textContent.length&&a<1;)a+=t.measureText(r.textContent[l],r.textFont,r.textStyle,r.textScale).width,l+=1;l!==r.textContent.length&&(r.textContent=r.textContent.substring(0,l-1)+"‥")}dI(n.text,r,o)}}function Pf(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);r.font=e.fontManager.getFont(a.font.get(s)),r.color=oi(a.color.get(s),o.color),r.style=a.style.get(s),r.align=a.align.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s);const d=a.padding.get(s);if(r.maxLineLength=a.maxLineLength.get(s),r.content=eg(r.content,r.maxLineLength),l){const u=a.scale.get(s);r.paddingFixed=0,r.paddingScaled=d*u,r.sizeScaled=o.diameterScaled*u,r.sizeFixed=o.diameterFixed*u}else r.sizeFixed=a.size.get(s),r.sizeScaled=0,r.paddingFixed=d,r.paddingScaled=0;const h=t.measureText(r.content,r.font,r.style);r.widthScaled=h.width*r.sizeScaled,r.widthFixed=h.width*r.sizeFixed,r.heightScaled=h.height*r.sizeScaled,r.heightFixed=h.height*r.sizeFixed,r.positionAngle=v2[r.position],r.isPositionCenter=r.position==="center",r.isPositionVertical=r.position==="top"||r.position==="bottom",r.isPositionHorizontal=r.position==="left"||r.position==="right",yI(n.text,r,o),n.background&&(xI(n.background,r,o),n.tip&&bI(n.tip,r,o))}}function zf(t,e){EI(t,e),Df(t.texts.primary,e.texts.primary),Df(t.texts.secondary,e.texts.secondary),Va(t.badges.topLeft,e.badges.topLeft),Va(t.badges.topRight,e.badges.topRight),Va(t.badges.bottomLeft,e.badges.bottomLeft),Va(t.badges.bottomRight,e.badges.bottomRight)}function EI(t,e){t.body=!0,t.icon=!!e.icon.content,t.image=!!e.image.url,t.pieChart=Array.isArray(e.color),t.outerStroke=!!e.outerStroke.color,t.outline=!!e.outline.enabled,t.halo=!!e.halo.color,t.haloStroke=t.halo&&!!e.halo.strokeColor}function Df(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor,t.tip=t.background&&e.tip&&e.position!=="center"}function Va(t,e){t.text=!!e.textContent,t.image=!!e.imageUrl}function kf(t,e,s,i){AI(t,e,s,i),Of(t,e.texts.primary,s.text,i,e),Of(t,e.texts.secondary,s.text.secondary,i,e),qa(t,e.badges.topLeft,s.badges.topLeft,i),qa(t,e.badges.topRight,s.badges.topRight,i),qa(t,e.badges.bottomLeft,s.badges.bottomLeft,i),qa(t,e.badges.bottomRight,s.badges.bottomRight,i)}function AI(t,e,s,i){const n=+(s.scalingMethod.get(i)==="scaled"),r=2*s.radius.get(i),o=s.innerStroke.width.get(i),a=+(s.innerStroke.scalingMethod.get(i)==="scaled"),l=s.outerStroke.width.get(i),d=+(s.outerStroke.scalingMethod.get(i)==="scaled");e.x=s.x.get(i),e.y=s.y.get(i),e.shape=s.shape.get(i),e.color=s.color.get(i),e.opacity=s.opacity.get(i),e.diameterScaled=r*n,e.diameterFixed=r*(1-n),e.innerStroke.color=oi(s.innerStroke.color.get(i),e.color),e.innerStroke.widthScaled=o*a,e.innerStroke.widthFixed=o*(1-a),e.innerStroke.minVisibleSize=s.innerStroke.minVisibleSize.get(i),e.outerStroke.color=oi(s.outerStroke.color.get(i),e.color),e.outerStroke.widthScaled=l*d,e.outerStroke.widthFixed=l*(1-d),e.halo.color=s.halo.color.get(i),e.halo.strokeColor=s.halo.strokeColor.get(i),e.icon.content=t.formatText(s.icon.content.get(i)),e.image.url=s.image.url.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1}function Of(t,e,s,i,n){if(e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=oi(s.backgroundColor.get(i),n.color),e===n.texts.primary){const r=s;e.tip=r.tip.get(i),e.position=r.position.get(i)}else e.position="bottom"}function qa(t,e,s,i){const n=s.text.content.get(i);e.textContent=t.formatText(n),e.imageUrl=s.image.url.get(i),e.scalingMethod=s.scalingMethod.get(i)}var Ha=t=>({angle:t,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,scalingMethod:"scaled",textContent:"",textFont:"",textColor:"",textScale:0,textStyle:"none",imageUrl:"",imageContent:null,imageScale:0,textPaddingLeft:0,textPaddingTop:0}),Bf=()=>({hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,paddingScaled:0,paddingFixed:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1}),Uf=()=>({x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,style:"none",minVisibleSize:0},image:{url:"",content:null,scale:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:!1,color:"",minVisibleSize:0},badges:{topLeft:Ha(C0),topRight:Ha(L0),bottomLeft:Ha(I0),bottomRight:Ha(M0)},textHidden:!1,texts:{primary:Bf(),secondary:Bf()}}),SI=(t,e)=>{e.haloStroke=e.haloStroke||t.haloStroke,e.halo=e.halo||t.halo,e.outline=e.outline||t.outline,e.outerStroke=e.outerStroke||t.outerStroke,e.body=e.body||t.body,e.pieChart=e.pieChart||t.pieChart,e.image=e.image||t.image,e.icon=e.icon||t.icon;const s=t.badges,i=e.badges;i.topLeft.text=i.topLeft.text||s.topLeft.text,i.topLeft.image=i.topLeft.image||s.topLeft.image,i.topRight.text=i.topRight.text||s.topRight.text,i.topRight.image=i.topRight.image||s.topRight.image,i.bottomLeft.text=i.bottomLeft.text||s.bottomLeft.text,i.bottomLeft.image=i.bottomLeft.image||s.bottomLeft.image,i.bottomRight.text=i.bottomRight.text||s.bottomRight.text,i.bottomRight.image=i.bottomRight.image||s.bottomRight.image;const n=t.texts,r=e.texts;r.primary.text=r.primary.text||n.primary.text,r.primary.background=r.primary.background||n.primary.background,r.primary.tip=r.primary.tip||n.primary.tip,r.secondary.text=r.secondary.text||n.secondary.text,r.secondary.background=r.secondary.background||n.secondary.background,r.secondary.tip=r.secondary.tip||n.secondary.tip},vb=t=>(e,s)=>{s.haloStroke=e.haloStroke[t],s.halo=e.halo[t],s.outline=e.outline[t],s.outerStroke=e.outerStroke[t],s.body=e.body[t],s.pieChart=e.pieChart[t],s.image=e.image[t],s.icon=e.icon[t];const i=e.badges,n=s.badges;n.topLeft.text=i.topLeft.text[t],n.topLeft.image=i.topLeft.image[t],n.topRight.text=i.topRight.text[t],n.topRight.image=i.topRight.image[t],n.bottomLeft.text=i.bottomLeft.text[t],n.bottomLeft.image=i.bottomLeft.image[t],n.bottomRight.text=i.bottomRight.text[t],n.bottomRight.image=i.bottomRight.image[t];const r=e.texts,o=s.texts;o.primary.text=r.primary.text[t],o.primary.background=r.primary.background[t],o.primary.tip=r.primary.tip[t],o.secondary.text=r.secondary.text[t],o.secondary.background=r.secondary.background[t],o.secondary.tip=r.secondary.tip[t]},wI=vb("start"),TI=vb("end"),CI=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,attributes:n,attributesPrev:r}){this._fullComponents=qr(),this._startComponents=qr(),this._endComponents=qr(),this._startFlags=qr(),this._endFlags=qr(),this._startInput=Uf(),this._endInput=Uf(),this._depthInfo=hg(),this._nodePatternAssigned=!1,this._nullElt={id:-1,valid:!0},this._engine=t,this._attributes=n,this._attributesPrev=r,this._helper={imageManager:e,fontManager:s,formatText:i},this._layers=Gf((()=>t.createGroup())),this._blockIds=Gf((()=>0))}drawNode(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=t,n=this._attributes,r=Go(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),o=n.animationDuration.get(t),a=o>0;if(this._prepareBlocks(a,r,i),kf(s,this._endInput,n,t),zf(this._endFlags,this._endInput),a&&(kf(s,this._startInput,this._attributesPrev,t),zf(this._startFlags,this._startInput),SI(this._endFlags,this._startFlags)),this._initComponents(this._fullComponents,this._endFlags,this._layers),TI(this._fullComponents,this._endComponents),Ff(e,s,t,n,this._endComponents,this._endInput),a&&(wI(this._fullComponents,this._startComponents),Ff(e,s,t,this._attributesPrev,this._startComponents,this._startInput)),a){const l=this._attributes.animationStart.get(t),d=this._attributes.animationEasing.get(t);this._setBlocksAnimation(o,l,d)}this._endFlags.halo&&this._attributes.halo.hideNonAdjacentEdges.get(t)&&(this._layers.halo.stencilUsage=this._layers.haloStroke.stencilUsage=v0),this._storeBlocks()}_computeBlockIds(t){const e=t*Td,s=this._blockIds;s.body=e+e2,s.text=e+s2,s.textBg=e+i2,s.halo=e+n2,s.haloStroke=e+r2}_prepareBlocks(t,e,s){const i=this._layers;i.body.reset(ei,t,e.nodeBody,s),i.text.reset(Mn,t,e.nodeText,s),i.textBg.reset(ei,t,e.nodeTextBackground,s),i.halo.reset(ei,t,e.nodeHalo,s),i.haloStroke.reset(ei,t,e.nodeHaloStroke,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg),t.storeGroup(s.halo,e.halo),t.storeGroup(s.haloStroke,e.haloStroke)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.text),t.freeBlock(e.textBg),t.freeBlock(e.halo),t.freeBlock(e.haloStroke)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.haloStroke.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._nodePatternAssigned=!1,this._initBaseComponents(t,e,s),this._initBadgeComponents(t.badges.topLeft,e.badges.topLeft,s),this._initBadgeComponents(t.badges.topRight,e.badges.topRight,s),this._initBadgeComponents(t.badges.bottomLeft,e.badges.bottomLeft,s),this._initBadgeComponents(t.badges.bottomRight,e.badges.bottomRight,s),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initBaseComponents(t,e,s){t.haloStroke=this._nextElement(e.haloStroke,s.haloStroke),t.halo=this._nextElement(e.halo,s.halo),t.outline=this._nextElement(e.outline,s.body),t.outerStroke=this._nextElement(e.outerStroke,s.body),t.body=this._nextElement(e.body,s.body),t.pieChart=this._getNodePatternElement(e.pieChart,s),t.image=this._getNodePatternElement(e.image,s),t.icon=this._getNodePatternElement(e.icon,s)}_initBadgeComponents(t,e,s){t.image=this._nextElement(e.image,s.body),t.text=this._nextElement(e.text,s.body)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.tip=this._nextElement(e.tip,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}_getNodePatternElement(t,e){return t?this._nodePatternAssigned?e.body.next():(this._nodePatternAssigned=!0,e.body.getCurrentElement()):this._nullElt}};function Gf(t){return{body:t(),text:t(),textBg:t(),halo:t(),haloStroke:t()}}function qr(){return{haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}}}function LI({graph:t,elements:e,engine:s,imageManager:i,fontManager:n,view:r,attributes:o,boundaries:a,formatText:l}){const{nodeAttributes:d,nodeAttributesPrev:h,edgeAttributes:u,edgeAttributesPrev:c}=II(o),{nodes:g,edges:m}=e,{maxSize:f,maxMinVisibleSize:p}=a;if(!g.size&&!m.size)return;const _=(Math.max(t.getNodeMaxIndex(),t.getEdgeMaxIndex())+1)*Td,x=f<1024?8*f:2*f,y=s.setGlobalBoundaries({maxBlockId:Zi(_),maxScaledSize:Zi(x),maxMinVisibleSize:Zi(p),maxSymbolicSize:Zi(f),maxDashLength:3,maxGapLength:1,maxPatternScale:2,maxCoord:-1/0}),b=(y?t.getNodes("_all"):g)._indexes,v=(y?t.getEdges("_all"):m)._indexes;if(b.length){const A=new CI({engine:s,imageManager:i,fontManager:n,formatText:l,attributes:d,attributesPrev:h});for(let S=0;S<b.length;++S)A.drawNode(b[S])}if(v.length){const A=new aI({engine:s,imageManager:i,fontManager:n,formatText:l,view:r,attributes:u,attributesPrev:c,nodeAttributes:d,nodeAttributesPrev:h});for(let S=0;S<v.length;++S)A.drawEdge(v[S])}}function II(t){const e=or(t.nodes.current,{text:{secondary:{scaling:t.nodes.current.text.scaling,maxLineLength:t.nodes.current.text.maxLineLength}}});return{nodeAttributes:e,nodeAttributesPrev:or(t.nodes.previous,{textHidden:e.textHidden,text:{secondary:{scaling:t.nodes.previous.text.scaling,maxLineLength:t.nodes.previous.text.maxLineLength}}}),edgeAttributes:or(t.edges.current,{text:{secondary:{scaling:t.edges.current.text.scaling,maxLineLength:t.edges.current.text.maxLineLength,adjustAngle:t.edges.current.text.adjustAngle}}}),edgeAttributesPrev:or(t.edges.previous,{source:t.edges.current.source,target:t.edges.current.target,textHidden:t.edges.current.textHidden,text:{secondary:{scaling:t.edges.previous.text.scaling,maxLineLength:t.edges.previous.text.maxLineLength,adjustAngle:t.edges.previous.text.adjustAngle}}})}}function Vo(t,e,s){const i=s.length;let n=i-1,r=!1;for(let o=0;o<i;++o)(s[o].y<e&&s[n].y>=e||s[n].y<e&&s[o].y>=e)&&(s[o].x<=t||s[n].x<=t)&&(r=r!==s[o].x+(e-s[o].y)/(s[n].y-s[o].y)*(s[n].x-s[o].x)<t),n=o;return r}function ja(t){const e=t.x*t.x+t.y*t.y;return{x:t.x/e,y:t.y/e}}function Vf(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=o.x*e.x+o.y*e.y;a<s&&(s=a),a>i&&(i=a)}return{x:s,y:i}}function MI(t,e){let s=t[1],i=t[0],n=ja({x:s.x-i.x,y:s.y-i.y}),r=n.x;n.x=-n.y,n.y=r;const o=n;s=t[2],i=t[1],n=ja({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const a=n;s=e[1],i=e[0],n=ja({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const l=n;return s=e[2],i=e[1],n=ja({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r,[o,a,l,n]}function Eb(t,e){const s=MI(t,e);for(let i=0,n=s.length;i<n;i++){const r=s[i],o=Vf(t,r),a=Vf(e,r);if((o.x<=a.y&&o.y>=a.x?Math.min(o.y,a.y)-Math.max(o.x,a.x):0)===0)return!1}return!0}function NI(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}var Ab=ua(4),Sb=ua(5),wb=ua(10,.4),Qi=1/3,RI=[{x:-1,y:-Qi},{x:0,y:-Qi},{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:0,y:Qi},{x:-1,y:Qi}],Tb=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],FI=[{x:-1,y:-Qi},{x:-.55,y:-Qi},{x:-1,y:-1},{x:1,y:0},{x:-1,y:1},{x:-.55,y:Qi},{x:-1,y:Qi}],qf=[{x:-.6,y:-.3},{x:.1,y:0},{x:-.6,y:.3}],Cb=[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}],Yi={circle:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>1-Math.sqrt(t*t+e*e),points:[{x:0,y:0,r:1}],isSimple:!0},square:{getDistanceFromStrokeVertically:(t,e)=>.996-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>.996-Math.abs(t),points:Tb,isSimple:!0},line:{getDistanceFromStrokeVertically:(t,e)=>1-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:0},{x:1,y:0}],isSimple:!0},triangle:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},arrow:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},"circle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>Math.min(Math.sqrt((t+.4)*(t+.4)+e*e)-.27,(1-t)/2-Math.abs(e)),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:[{x:-.4,y:0,r:.3}],isSimple:!0},"triangle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>{const s=Math.min((1-t)/2-Math.abs(e),1-Math.abs(t)),i=-Lb(t,e,qf);return Math.min(s,i)},getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:qf,isSimple:!0},"short-arrow":Ss(RI,!1),"sharp-arrow":Ss(FI,!1),cross:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>{const s=Math.abs(t),i=Math.abs(e),n=.31-Math.min(s,i),r=1-Math.max(s,i);return Math.min(n,r)},points:Cb,isSimple:!1},diamond:Ss(Ab),pentagon:Ss(Sb),star:Ss(wb),triangleUp:Ss([{x:-1,y:1},{x:1,y:1},{x:0,y:-1}],!0),triangleDown:Ss([{x:-1,y:-1},{x:1,y:-1},{x:0,y:1}],!0),triangleLeft:Ss([{x:1,y:-1},{x:1,y:1},{x:-1,y:0}],!0),hexagon:Ss(ua(6,1,-Math.PI/2+Cd),!1)},PI=["circle","square","triangle","line","triangleUp","triangleDown","triangleLeft"],zI=["cross","diamond","pentagon","star","hexagon"],DI=["arrow","triangle-hole-arrow","circle-hole-arrow","short-arrow","sharp-arrow"];function Hf(t,e){for(const r of PI)ph(t,r);const s=e.nodes.current.shape.getValues(),i=e.edges.current.shape.head.getValues(),n=e.edges.current.shape.tail.getValues();for(const r of zI)s.includes(r)&&ph(t,r);for(const r of DI)r&&(i.includes(r)||n.includes(r))&&ph(t,r)}function ph(t,e){t.registerShape(e,Yi[e])}function kI(t,e){Yi.star=Ss(Xn(wb,e,Yn)),Yi.pentagon=Ss(Xn(Sb,e,Yn)),Yi.hexagon=Ss(Xn(ua(6,1,-Math.PI/2+Cd),e,Yn)),Yi.square=Ss(Xn(Tb,e,Yn)),Yi.cross=Ss(Xn(Cb,e,Yn)),Yi.diamond=Ss(Xn(Ab,e,Yn)),["star","pentagon","hexagon","square","cross","diamond"].forEach((s=>t.updateShape(s,Yi[s])))}function Lb(t,e,s){let i=1/0;const n={x:t,y:e};for(let r=0;r<s.length;++r){const o=s[r],a=s[(r+1)%s.length];i=Math.min(i,X0(n,o,a))}return i*(Vo(t,e,s)?1:-1)}function ua(t,e=1,s=-Math.PI/2+Cd){const i=[],n=2*Math.PI/t;let r=s;for(let o=0;o<t;++o){const a=o%2==1?e:1;i.push({x:Math.cos(r)*a,y:Math.sin(r)*a}),r+=n}return i}function Ss(t,e=!1){return{getDistanceFromStrokeVertically:()=>1,getDistanceFromStrokeHorizontally:(s,i)=>Lb(s,i,t),points:t,isSimple:e}}function Xn(t,e,s=5){if(e===0)return t;const i=[],n=t.length;for(let r=0;r<n;r++){const o=t[(r+n-1)%n],a=t[r%n],l=t[(r+1)%n],d=o.x-a.x,h=o.y-a.y,u=Math.sqrt(d*d+h*h),c=d/u,g=h/u,m=Math.atan2(g,c),f=l.x-a.x,p=l.y-a.y,_=Math.sqrt(f*f+p*p),x=f/_,y=p/_,b=Math.atan2(y,x),v=c*y-g*x,A=c*x-g*-y;let S=Math.asin(v<-1?-1:v>1?1:v),w=1,I=!1;A<0?S<0?S=Math.PI+S:(S=Math.PI-S,w=-1,I=!0):S>0&&(w=-1,I=!0);const M=S/2;let N=Math.abs(Math.cos(M)*e/Math.sin(M)),D=e;N>Math.min(u/2,_/2)&&(N=Math.min(u/2,_/2),D=Math.abs(N*Math.sin(M)/Math.cos(M)));let q=a.x+x*N,et=a.y+y*N;q+=-y*D*w,et+=x*D*w;const O=m+Math.PI/2*w;let K=b-Math.PI/2*w-O;K=I?K>0?K-2*Math.PI:K:K<0?K+2*Math.PI:K;for(let j=0;j<s;j++){const ot=O+K*(j/(s-1)),it=q+D*Math.cos(ot),ct=et+D*Math.sin(ot);i.push({x:it,y:ct})}}return i}var OI=class extends la{constructor(t,e){super(),this.isDummy=!0,this.width=0,this.height=0,this.namespaceURI="http://www.w3.org/1999/xhtml"}setAttribute(t,e){t==="src"&&(this.src=e),t==="crossOrigin"&&(this.crossOrigin=e)}set src(t){t&&(this._src=t,setTimeout((()=>{this.onload&&this.onload.call(this),this.width=1,this.height=1,this.fire("load")}),10))}get src(){return this._src}addEventListener(t,e){this.on(t,e)}};function BI(t,e){return new(typeof Image<"u"?Image:OI)(t,e)}var UI=class{constructor(){this._images={},this._crossOrigin="anonymous",this._whenReady=[],this._onFetch=[],this._nbLoaded=0,this._nbToLoad=0}setImgCrossOrigin(t){this._crossOrigin=t}clear(){this._images={},this._nbLoaded=0,this._nbToLoad=0}getImage(t){let e=this._images[t];return e===void 0&&(this._nbToLoad+=1,e=BI(),e.crossOrigin=this._crossOrigin,e.addEventListener("load",(()=>this._onImgLoad(t))),e.addEventListener("error",(()=>{this._onImgLoad(t),this._images[t]=null})),YS(e,"src",t),this._images[t]=e),e}_onImgLoad(t){this._nbLoaded+=1,this._onFetch.forEach((e=>e(t))),this._nbLoaded===this._nbToLoad&&(this._whenReady.forEach((e=>e())),this._whenReady=[])}onFetch(t){this._onFetch.push(t)}whenReady(){return this._nbLoaded===this._nbToLoad?Promise.resolve():new Promise((t=>this._whenReady.push(t)))}destroy(){this._whenReady=[],this._onFetch=[]}},ug={};Jo(ug,{BUTTON_MAPPING:()=>Nc,BoundingBox:()=>Cs,DummyCanvas:()=>N0,DummyCanvasRenderingContext2D:()=>R0,DummyDomElement:()=>bx,DummyFileReader:()=>_x,DummyTextNode:()=>dv,DummyXHR:()=>px,ElementSet:()=>ca,EventTarget:()=>la,FlexArray:()=>Xl,IndexList:()=>n0,MOUSE_WHEEL_THROTTLE:()=>ux,Map2:()=>b0,PathMap:()=>nv,PrioritySet:()=>Qx,SVG_NS:()=>Ic,Table:()=>pu,XLINK:()=>Ax,XML_NS:()=>nu,applyCursorStyle:()=>Vl,baseURI:()=>Ix,binaryIndexOf:()=>Sy,cancelAnimFrame:()=>cx,clamp:()=>Ws,clearCanvas:()=>wu,componentsToRGBA:()=>_0,computeMax:()=>lr,computeMin:()=>wi,concatenateArrays:()=>PA,createBlob:()=>zo,createCanvas:()=>ls,createDummyDomElement:()=>Ul,createDummyXmlDocument:()=>uv,createElement:()=>ru,createSvgElement:()=>_e,createTextNode:()=>Mc,createWebGL2Context:()=>P0,createWorker:()=>av,createXmlDocument:()=>cv,dataUrlToBlob:()=>vx,debounce:()=>kA,deepCopy:()=>ke,displayPixelsOnScreen:()=>nM,ensureTransferable:()=>cd,escapeDOMAttribute:()=>ar,extendList:()=>UA,fadeElement:()=>Mx,fetch:()=>Dr,fetchBinary:()=>Cx,fetchBinaryAsBase64:()=>Lx,flatten:()=>Fo,flattenArray:()=>Ay,fontSizeToBadgeScale:()=>iv,forEach:()=>_i,formatAngle:()=>ql,formatHex:()=>El,formatWorkerMessage:()=>ov,getBaseLog:()=>Nx,getCurrentTime:()=>ps,getDate:()=>Oy,getDocument:()=>Fi,getDocumentFontRules:()=>tv,getEmbeddedFontRules:()=>ev,getFlattenedKeys:()=>kn,getGlContext:()=>z0,getImage:()=>Sx,getLeafValues:()=>ud,getOptions:()=>Os,getPixelRatio:()=>Ns,getProperty:()=>ze,getResizeObserver:()=>yx,getStyle:()=>xx,getTime:()=>By,getValues:()=>yo,getWebglContext:()=>tg,hash8:()=>Xh,htmlSanitizer:()=>Rc,indexArrayToArray:()=>No,indexByName:()=>GA,insertSortAsc:()=>Qr,insertSortDesc:()=>FA,isArray:()=>as,isBlob:()=>Gw,isHTMLElement:()=>Tx,isInteger:()=>DA,isLittleEndian:()=>hd,isObject:()=>Xe,isRawObject:()=>Dn,isWebGLSupported:()=>F0,lerp:()=>ye,lightDebounce:()=>wy,mapKeys:()=>y0,mapValues:()=>x0,merge:()=>or,mergeValues:()=>Nl,mix:()=>ou,nextPowerOfTwo:()=>Zi,objToValueList:()=>Pd,parseColor:()=>ys,parseColorHex:()=>Yc,parseColorRgba:()=>jc,pick:()=>$h,processQueue:()=>OA,promiseQueue:()=>Cy,promptDownload:()=>un,propertyPathToString:()=>Yh,removeFromArray:()=>zA,requestAnimFrame:()=>Tc,resizeElement:()=>Gl,resolvePath:()=>sv,rgbaToRgb:()=>er,serializeXMLDocument:()=>yg,setAttributes:()=>Lc,setCtxFont:()=>an,setElementSize:()=>Bn,setKeys:()=>JI,setProperty:()=>Li,setValues:()=>co,smartRequire:()=>Xs,throttle:()=>Ro,toArray:()=>jh,toHexa:()=>Eu,toPropertyPath:()=>zn,traverse:()=>Iy,unflatten:()=>Wh,unorderedHash:()=>BA,workerIsAvailable:()=>rv});var ws="Arial",ln="black",td="rgba(255,255,255,0)",Nr=12,qo=3,cg=7,GI=!0,gg=10,VI=5,Ib=.08,Mb="rgba(255,255,255,0)",Nb="normal",Rb="center",Fb=!1,Pb=0,Fu="red",zb="rgb(220, 220, 220)",Db="red",kb="rgb(220, 220, 220)",Ob="grey",Bb="white",mg=2,Ub=null,fg=5,Pu=0,Gb="rgba(0, 0, 0, 0.36)",qI=1,HI="circle",zu=12,lo="white",pr=40,ho="black",_r=2,uo="black",pg=40,Vb=null,qb=null,_g=1,Hb="black",jb=1e3,Yb=800,Xb=1,Wb=2,$b="rgba(0, 0, 0, 0.0)",Zb="rgba(0, 0, 0, 0.6)",Kb=50,jI=.1,Wn=12,Ya=24,Ho=1,Du=Ho/2,jf=.45,Yf=.7,YI=10,Qb=YI/2,Jb=5;function XI(t){let e="";for(let s=0;s<t.length;s++)e+=t[s].cssText+`
`;return e}function tv(){const t=Fi(),e=t.styleSheets||[],s=Ix(t),i=[],n=[];for(let o=0;o<e.length;o++){const a=e[o];a.href==null?i.push({href:s,content:XI(a.cssRules)}):n.push(a.href)}const r=/@font-face\s*\{[^}]+\}/g;return Promise.all(n.map((o=>Dr(o).then((a=>({href:o,content:a}))).catch(Pl)))).then((o=>o.concat(i))).then((o=>{const a=[];for(let l=0;l<o.length;l++){const d=o[l];if(d!==null){const{href:h,content:u}=d,c=u.match(r);if(c){const g=$I(c,h);a.push.apply(a,g)}}}return a}))}function ev(t,e){return Promise.all(t.map((({formats:s,originalRule:i})=>Promise.all(s.map((({format:n,url:r})=>e?Lx(r).then((o=>({format:n,src:o}))).catch(Pl):{format:n,src:r}))).then((n=>{const r=[];for(const o of n)o!==null&&r.push(`url('${o.src}') format('${o.format}')`);if(r.length!==0){const o=`src: ${r.join(",")}`;return i.replace(/@font-face\s*{([^}]*);?}/,`@font-face{$1;${o}}`).replace(/\s+/," ").replace(/;+/,";")}return i})))))}var WI={"embedded-opentype":!0,svg:!0};function $I(t,e){const s=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g,i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/,n=[];for(let r=0;r<t.length;r++){const o=t[r],a=o.match(i);if(a){const l=a[1],d=[];let h;for(;h=s.exec(o);){const u=h[1],c=h[2];WI[c.toLowerCase()]||d.push({format:c,url:sv(u,e)})}n.push({name:l,formats:d,originalRule:o})}}return n}function sv(t,e){if(/^http(s)?:/.test(t))return t;if(t[0]==="/"){const n=e.match(/((\w+:\/\/)([^/]+))/);return n?n[1]+t:t}const s=t.split("/"),i=e.split("/");for(e[e.length-1]!=="/"&&i.pop();s[0]==="..";)s.shift(),i.pop();return i.concat(s).join("/").replace(/[\w](\/{2,})/g,(n=>n[0]+"/"))}function iv(t,e,s=Du){return t/s/(2*e)}function ZI(t){return t instanceof RegExp||t instanceof Date}var KI=typeof HTMLElement>"u"?t=>!1:t=>t instanceof HTMLElement,QI=function(t){return typeof t!="object"||t===null||as(t)||ZI(t)};function Pd(t,e=[],s=[]){if(!KI(t)){if(QI(t))e.push({path:s.slice(),value:t});else{const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=s.slice();o.push(r),Pd(t[r],e,o)}}return e}}var nv=class{constructor(){this._keys=[],this._values=[],this._size=0,this._cachedPath=[],this._cachedIndex=-1}get size(){return this._size}set(t,e){const s=this._getIndex(t);s!==-1?this._values[s]=e:(_h(this._cachedPath,t)&&(this._cachedIndex=this._keys.length),this._keys.push(t),this._values.push(e),this._size+=1)}get(t){const e=this._getIndex(t);if(e!==-1)return this._values[e]}has(t){return this._getIndex(t)!==-1}keys(){return this._keys.slice()}_getIndex(t){if(_h(t,this._cachedPath))return this._cachedIndex;this._cachedPath=t.slice();const e=this._keys;for(let s=0;s<e.length;++s)if(_h(e[s],t))return this._cachedIndex=s,s;return this._cachedIndex=-1,-1}};function _h(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}var ku,JI=function(e){return Array.from(e.keys())},co=function(e){return Array.from(e.values())},jo=Xs("web-worker"),rv=!!jo||typeof Worker<"u"&&typeof Blob<"u";function ov(t){return jo?Ou(t):t}function Ou(t){if(ArrayBuffer.isView(t))return Array.from(t);if(Array.isArray(t)){for(let e=0;e<t.length;e++)t[e]=Ou(t[e]);return t}if(Xe(t)){const e=Object.keys(t);for(const s of e)t[s]=Ou(t[s]);return t}return t}function av(t){return jo?eM(t.toString()):tM(t)}function tM(t){return XS(IS(t))}function eM(t){if(jo)return new jo("data:application/javascript,"+t.replace(/\n/g,""))}var Xf=Xs("@xmldom/xmldom");ku=typeof XMLSerializer<"u"?XMLSerializer:Xf?Xf.XMLSerializer:null;var sM=class lv{constructor(e){this._attributes={},this._children=[],this._name=e}setAttribute(e,s){this._attributes[e]=s}appendChild(e){this._children.push(e)}get tagName(){return this._name}get children(){return this._children}get childNodes(){return this._children}get firstChild(){return this._children[0]||null}serialize(){const e=this._name,s=this._attributes,i=this._children,n=Object.keys(s).filter((o=>s[o]!==void 0)).map((o=>` ${o}="${""+s[o]}"`)).join(""),r=i.map((o=>o.serialize())).join("");return r.length?`<${e}${n}>${r}</${e}>`:`<${e}${n}/>`}cloneNode(e){const s=new lv(this._name),i=Object.keys(this._attributes);for(const n of i)s.setAttribute(n,this._attributes[n]);if(e)for(let n=0;n<this._children.length;n++)s.appendChild(this._children[n].cloneNode(e));return s}},dv=class hv{constructor(e){this._text=e}serialize(){return this._text}cloneNode(){return new hv(this._text)}},iM=class{constructor(){this._children=[],this._meta=[],this._children=[],this._meta=[]}appendChild(t){this._children.push(t)}serialize(){return this._meta.concat(this._children.map((t=>t.serialize()))).join("")}createElement(t){return new sM(t)}createTextNode(t){return new dv(t)}},uv=()=>new iM;function yg(t){if(ku)return new ku().serializeToString(t)}var cv=()=>Fi().implementation.createDocument("","",null),ca=class{constructor(t,e){this._graph=t,this._nodes={elementList:t.nodeList,flexArray:t.createNodeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!0)},this._edges={elementList:t.edgeList,flexArray:t.createEdgeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!1)}}_get(t){return t.isNode?this._nodes:this._edges}addOrRemoveElements(t,e){return e?this.addElements(t):this.removeElements(t)}addElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength();for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];s.get(o)!==1&&(s.set(o,1),i.pushUnchecked(o))}return e(i.slice(n))}removeElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength(),r=i.getBuffer();if(n>r.length)return this.clear(),this.addElements(t),t;let o=0;for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];s.get(l)!==0&&(s.set(l,0),o+=1)}if(o===n)return e(i.sliceAndReset());if(o===0)return e();{const a=this._graph.acquireIndexList(t.isNode);let l=0;for(let d=0;d<n;++d){const h=r[d];s.get(h)===0?(l+=1,a.pushUnchecked(h)):r[d-l]=h}return i.setLength(n-o),e(a.sliceAndReset())}}hasElement(t){return!!this._get(t).flexArray.get(t._index)}clear(){this._nodes.indexList.isEmpty()||(this._nodes.indexList.reset(),this._nodes.flexArray.reset()),this._edges.indexList.isEmpty()||(this._edges.indexList.reset(),this._edges.flexArray.reset())}isEmpty(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()}getElements(){return{nodes:this._nodes.elementList(this._nodes.indexList.slice()),edges:this._edges.elementList(this._edges.indexList.slice())}}};function nM(t,e,s,i=0){e===void 0&&(e=s=Math.sqrt(t.length/4)),s===void 0&&(s=e);const n=document.createElement("canvas"),r=n.getContext("2d");if(r){const o=r.createImageData(e,s);n.style.imageRendering="pixelated",n.style.border="1px solid black",n.style.margin="2px",n.style.position="absolute",n.style.top=n.style.left="0px",n.width=e,n.height=s,o.data.set(t),r.putImageData(o,0,0);const a=document.getElementById("graph-container");a&&(a.style.position="static"),setTimeout((()=>document.body.appendChild(n)),i)}}var rM=class{constructor(t,e){this._attributesManager=t,this._id=e}getDefinition(){return this._attributesManager.getAttributeLayerDefinition(this._id)}update(t){this._attributesManager.updateAttributeLayer(this._id,t)}destroy(){this._attributesManager.destroyAttributeLayer(this._id)}updateElements(t){this._attributesManager.updateElementsForAttributeLayer(this._id,t)}updateAll(){this._attributesManager.updateAllForAttributeLayer(this._id)}setAttributeValues(t,e,s){this._attributesManager.setAttributeLayerValues(this._id,t,e,s)}getUsedAttributeNames(t){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,t)}getFlexArrays(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)}},xg={};Jo(xg,{cubicIn:()=>dM,cubicInOut:()=>uM,cubicOut:()=>hM,linear:()=>ed,quadraticIn:()=>oM,quadraticInOut:()=>lM,quadraticOut:()=>aM});var ed=t=>t,oM=t=>t*t,aM=t=>t*(2-t),lM=t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1),dM=t=>t*t*t,hM=t=>--t*t*t+1,uM=t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2),cM={name:"animationStart",storage:32,default:0},gM={name:"animationDuration",storage:16,default:0},mM={name:"animationEasing",storage:"resource",default:"linear"},fM={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentNodes:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},pM={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},extremities:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},parallelEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},_M={x:1,y:1,radius:1,"halo.hideNonAdjacentEdges":1};function To(t){return typeof t=="string"}var Bu=1,gv="scaled",mv="grey",fv=1,pv=0,_v=0,yv=!0,xv=0,bv=!0,vv="line",Ev=null,Av=null,Sv="plain",wv="inherit",Uu=0,Tv="fixed",Cv=0,Lv=null,Gu=10,Iv="fixed",Mv=1e3,Nv=800,Rv="rgba(0, 0, 0, 0.6)",Fv="rgba(0, 0, 0, 0)",Pv=10,zv=1,Dv=2,kv="rgba(0, 0, 0, 0.36)",Ov=0,yM=1,Bv="normal",Uv="center",Gv=2,Vu=2,Vv=ha,qv=4,Hv=!0,jv=4,qu=2,Hu=12,Yv=2;function xM(t,e,s){let i,n,r,o;s==="line"?(i="line",n="plain",r=null,o=null):s==="arrow"?(i="line",n="plain",r="arrow",o=null):s==="tapered"?(i="triangle",n="plain",r=null,o=null):s==="dashed"?(i="line",n="dashed",r=null,o=null):s==="dotted"&&(i="line",n="dotted",r=null,o=null),t.shape.body.set(e,i),t.shape.style.set(e,n),t.shape.head.set(e,r),t.shape.tail.set(e,o)}var Xv={width:{_flexArray:Bu,_check:xe(Bu)},scalingMethod:{_flexArray:gv,_check:Ci},color:{_flexArray:mv,_check:ZL},opacity:{_flexArray:fv,_check:Re},minVisibleSize:{_flexArray:pv,_check:Re},layer:{_flexArray:_v,_check:_b},detectable:{_flexArray:yv,_check:rs},curvature:{_flexArray:xv,_check:Fn},adjustAnchors:{_flexArray:bv,_check:rs},shape:{_check:JL,_set:xM,type:"shape.head",body:{_flexArray:vv,_check:tI},head:{_flexArray:Ev,_check:Nf},tail:{_flexArray:Av,_check:Nf},style:{_flexArray:Sv,_check:eI}},stroke:{color:{_flexArray:wv,_check:gs},width:{_flexArray:Uu,_check:xe(Uu)},scalingMethod:{_flexArray:Tv,_check:Ci},minVisibleSize:{_flexArray:Cv,_check:Re}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:Lv,_check:Ki},width:{_flexArray:Gu,_check:xe(Gu)},scalingMethod:{_flexArray:Iv,_check:Ci},size:"halo.width"},pulse:{enabled:{_flexArray:!1,_check:rs},duration:{_flexArray:Mv,_check:Re},interval:{_flexArray:Nv,_check:Re},startColor:{_flexArray:Rv,_check:gs},endColor:{_flexArray:Fv,_check:gs},width:{_flexArray:Pv,_check:Re},startRatio:{_flexArray:zv,_check:Re},endRatio:{_flexArray:Dv,_check:Re}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:rs},color:{_flexArray:kv,_check:Ki},minVisibleSize:{_flexArray:Ov,_check:Re}},text:{_alias:"text.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:ws,_check:br},color:{_flexArray:ln,_check:Ki},size:{_flexArray:Nr,_check:xe(Nr)},scale:{_flexArray:1,_check:Re},style:{_flexArray:Bv,_check:vr},align:{_flexArray:Uv,_check:Jl},margin:{_flexArray:Gv,_check:Fn},padding:{_flexArray:Vu,_check:xe(Vu)},backgroundColor:{_flexArray:td,_check:gs},minVisibleSize:{_flexArray:qv,_check:Re},position:{_flexArray:Vv,_check:$L},adjustAngle:{_flexArray:Hv,_check:rs},scaling:{_flexArray:Fb,_check:rs},maxLineLength:{_flexArray:Pb,_check:Re},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:ws,_check:br},color:{_flexArray:ln,_check:Ki},size:{_flexArray:Hu,_check:xe(Hu)},scale:{_flexArray:Ib,_check:Re},style:{_flexArray:Nb,_check:vr},align:{_flexArray:Rb,_check:Jl},margin:{_flexArray:Yv,_check:Fn},padding:{_flexArray:qu,_check:xe(qu)},backgroundColor:{_flexArray:Mb,_check:gs},minVisibleSize:{_flexArray:jv,_check:Re}}}},bM=xe(Jb),vM=xe(Nr),EM=xe(gg),AM=xe(mg),SM=xe(fg),wM=xe(cg),Wf=xe(qo),TM=xe(Qb),CM=xe(pg),LM=xe(_g);function Xa(t){return{_check:Ti,_set:(e,s,i)=>{e.badges[t].text.content.set(s,i),i==null&&e.badges[t].image.url.set(s,i)},_get:(e,s)=>e.badges[t].text.content.get(s),color:{_flexArray:lo,_check:gs},scale:{_flexArray:jf,_check:xe(jf)},positionScale:{_flexArray:1,_check:Re},minVisibleSize:{_flexArray:pr,_check:xe(pr)},scalingMethod:{_flexArray:"scaled",_check:Ci},image:{_alias:`badges.${t}.image.url`,url:{_flexArray:null,_check:Ti},scale:{_flexArray:Ho,_check:xe(Ho)}},stroke:{color:{_flexArray:ho,_check:gs},width:{_flexArray:_r,_check:xe(_r)},scalingMethod:{_flexArray:"fixed",_check:Ci}},text:{_alias:`badges.${t}.text.content`,content:{_flexArray:null,_check:Ti},color:{_flexArray:uo,_check:gs},font:{_flexArray:ws,_check:br},style:{_flexArray:"normal",_check:vr},scale:{_flexArray:Du,_check:xe(Du)},paddingLeft:{_flexArray:0,_check:Fn},paddingTop:{_flexArray:0,_check:Fn}}}}var Wv={x:{_flexArray:0,_check:Fn,_disableMemoryOptimization:!0},y:{_flexArray:0,_check:Fn,_disableMemoryOptimization:!0},radius:{_flexArray:Jb,_check:bM},scalingMethod:{_flexArray:"scaled",_check:Ci},color:{_flexArray:Ob,_check:iI},opacity:{_flexArray:1,_check:Re},shape:{_flexArray:"circle",_check:KL},layer:{_flexArray:0,_check:_b},detectable:{_flexArray:!0,_check:rs},draggable:{_flexArray:!0,_check:rs},layoutable:{_flexArray:!0,_check:rs},innerStroke:{_alias:"innerStroke.color",width:{_flexArray:mg,_check:AM},scalingMethod:{_flexArray:"fixed",_check:Ci},color:{_flexArray:Bb,_check:gs},minVisibleSize:{_flexArray:zu,_check:xe(zu)}},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:fg,_check:SM},scalingMethod:{_flexArray:"fixed",_check:Ci},color:{_flexArray:Ub,_check:gs},minVisibleSize:{_flexArray:Pu,_check:xe(Pu)}},badges:{_check:XL,_set(t,e,s){t.badges.topLeft.text.content.set(e,s),t.badges.topLeft.image.url.set(e,s),t.badges.topRight.text.content.set(e,s),t.badges.topRight.image.url.set(e,s),t.badges.bottomLeft.text.content.set(e,s),t.badges.bottomLeft.image.url.set(e,s),t.badges.bottomRight.text.content.set(e,s),t.badges.bottomRight.image.url.set(e,s)},topLeft:Xa("topLeft"),topRight:Xa("topRight"),bottomLeft:Xa("bottomLeft"),bottomRight:Xa("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:Vb,_check:Ki},width:{_flexArray:pg,_check:CM},scalingMethod:{_flexArray:"fixed",_check:Ci},strokeColor:{_flexArray:qb,_check:Ki},strokeWidth:{_flexArray:_g,_check:LM},clustering:{_flexArray:!1,_check:rs},hideNonAdjacentEdges:{_flexArray:!1,_check:rs}},pulse:{enabled:{_flexArray:!1,_check:rs},duration:{_flexArray:jb,_check:Re},interval:{_flexArray:Yb,_check:Re},startColor:{_flexArray:Zb,_check:gs},endColor:{_flexArray:$b,_check:gs},width:{_flexArray:Kb,_check:Re},startRatio:{_flexArray:Xb,_check:Re},endRatio:{_flexArray:Wb,_check:Re}},icon:{_alias:"icon.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:ws,_check:br},color:{_flexArray:Hb,_check:Ki},scale:{_flexArray:Yf,_check:xe(Yf)},style:{_flexArray:"normal",_check:vr},minVisibleSize:{_flexArray:Wn,_check:xe(Wn)}},image:{_alias:"image.url",url:{_flexArray:null,_check:Ti},scale:{_flexArray:Ho,_check:xe(Ho)},fit:{_flexArray:!0,_check:rs},tile:{_flexArray:!1,_check:rs},minVisibleSize:{_flexArray:Wn,_check:xe(Wn)}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:rs},color:{_flexArray:Gb,_check:Ki},minVisibleSize:{_flexArray:Wn,_check:xe(Wn)}},text:{_alias:"text.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:ws,_check:br},color:{_flexArray:ln,_check:gs},size:{_flexArray:Nr,_check:vM},scale:{_flexArray:jI,_check:Re},style:{_flexArray:"normal",_check:vr},align:{_flexArray:"center",_check:Jl},margin:{_flexArray:cg,_check:wM},padding:{_flexArray:qo,_check:Wf},backgroundColor:{_flexArray:null,_check:gs},tip:{_flexArray:!0,_check:rs},minVisibleSize:{_flexArray:Ya,_check:xe(Ya)},scaling:{_flexArray:!1,_check:rs},position:{_flexArray:"bottom",_check:sI},maxLineLength:{_flexArray:0,_check:Re},truncateLength:{_flexArray:0,_check:Re},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:ws,_check:br},color:{_flexArray:ln,_check:gs},size:{_flexArray:gg,_check:EM},scale:{_flexArray:.08,_check:Re},style:{_flexArray:"normal",_check:vr},align:{_flexArray:"center",_check:Jl},margin:{_flexArray:Qb,_check:TM},padding:{_flexArray:qo,_check:Wf},backgroundColor:{_flexArray:null,_check:gs},minVisibleSize:{_flexArray:Ya,_check:xe(Ya)}}}},IM=t=>(e,s)=>e[t].get(s),MM=(t,e)=>(s,i)=>s[t][e].get(i),NM=(t,e,s)=>(i,n)=>i[t][e][s].get(n),RM=(t,e,s,i)=>(n,r)=>n[t][e][s][i].get(r),FM=t=>(e,s,i)=>e[t].set(s,i),PM=(t,e)=>(s,i,n)=>s[t][e].set(i,n),zM=(t,e,s)=>(i,n,r)=>i[t][e][s].set(n,r),DM=(t,e,s,i)=>(n,r,o)=>n[t][e][s][i].set(r,o),kM=[IM,MM,NM,RM],OM=[FM,PM,zM,DM];function $f(t,e){if(!t._check)throw new Error(`error somewhere for ${e}`);const s=e.split("."),i=s.length-1,n=kM[i].apply(null,s),r=OM[i].apply(null,s);return{check:t._check,set:r,get:n,nested:{}}}function sd(t,e){const s=e?Wv:Xv,i=typeof t=="string"?[t]:kn(t,"",[]);let n=!1;const r=[];for(let o=0;o<i.length;o++){const a=i[o].split(".");let l=s[a[0]];for(let h=1;h<a.length;h++)l=l[a[h]];l.type&&(i[o]=l.type),l._alias&&(i[o]=l._alias),i[o]==="badges"&&(i[o]="badges.topLeft.text.content",n=!0);const d=a[a.length-1];d!=="topLeft"&&d!=="topRight"&&d!=="bottomLeft"&&d!=="bottomRight"||(i[o]=`badges.${d}.text.content`,r.push(`badges.${d}.image.url`)),i[o]==="strokeWidth"&&(i[o]="stroke.width")}return n&&(i.push("badges.topLeft.image.url"),i.push("badges.topRight.text.content"),i.push("badges.topRight.image.url"),i.push("badges.bottomLeft.text.content"),i.push("badges.bottomLeft.image.url"),i.push("badges.bottomRight.text.content"),i.push("badges.bottomRight.image.url")),i.push(...r),i}var Wa=t=>(e,s)=>({url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)}),$a=t=>(e,s)=>({color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)}),Za=t=>(e,s)=>({content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}),Ka=t=>(e,s)=>({color:e.badges[t].color.get(s),scale:e.badges[t].scale.get(s),positionScale:e.badges[t].positionScale.get(s),minVisibleSize:e.badges[t].minVisibleSize.get(s),image:{url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)},stroke:{color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)},text:{content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}}),ji={topLeft:Ka("topLeft"),topRight:Ka("topRight"),bottomLeft:Ka("bottomLeft"),bottomRight:Ka("bottomRight")},ti={stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),innerStroke:(t,e)=>({width:t.innerStroke.width.get(e),scalingMethod:t.innerStroke.scalingMethod.get(e),color:t.innerStroke.color.get(e),minVisibleSize:t.innerStroke.minVisibleSize.get(e)}),outerStroke:(t,e)=>({width:t.outerStroke.width.get(e),scalingMethod:t.outerStroke.scalingMethod.get(e),color:t.outerStroke.color.get(e),minVisibleSize:t.outerStroke.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e),strokeColor:t.halo.strokeColor.get(e),strokeWidth:t.halo.strokeWidth.get(e),clustering:t.halo.clustering.get(e),hideNonAdjacentEdges:t.halo.hideNonAdjacentEdges.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),backgroundColor:t.text.backgroundColor.get(e),tip:t.text.tip.get(e),minVisibleSize:t.text.minVisibleSize.get(e),scaling:t.text.scaling.get(e),position:t.text.position.get(e),maxLineLength:t.text.maxLineLength.get(e),truncateLength:t.text.truncateLength.get(e),secondary:ti["text.secondary"](t,e)}),image:(t,e)=>({url:t.image.url.get(e),scale:t.image.scale.get(e),fit:t.image.fit.get(e),tile:t.image.tile.get(e),minVisibleSize:t.image.minVisibleSize.get(e)}),icon:(t,e)=>({content:t.icon.content.get(e),font:t.icon.font.get(e),color:t.icon.color.get(e),scale:t.icon.scale.get(e),style:t.icon.style.get(e),minVisibleSize:t.icon.minVisibleSize.get(e)}),badges:(t,e)=>({topLeft:ji.topLeft(t,e),topRight:ji.topRight(t,e),bottomLeft:ji.bottomLeft(t,e),bottomRight:ji.bottomRight(t,e)}),"badges.topLeft":ji.topLeft,"badges.topRight":ji.topRight,"badges.bottomLeft":ji.bottomLeft,"badges.bottomRight":ji.bottomRight,"badges.topLeft.image":Wa("topLeft"),"badges.topLeft.stroke":$a("topLeft"),"badges.topLeft.text":Za("topLeft"),"badges.topRight.image":Wa("topRight"),"badges.topRight.stroke":$a("topRight"),"badges.topRight.text":Za("topRight"),"badges.bottomLeft.image":Wa("bottomLeft"),"badges.bottomLeft.stroke":$a("bottomLeft"),"badges.bottomLeft.text":Za("bottomLeft"),"badges.bottomRight.image":Wa("bottomRight"),"badges.bottomRight.stroke":$a("bottomRight"),"badges.bottomRight.text":Za("bottomRight"),all:(t,e)=>({x:t.x.get(e),y:t.y.get(e),radius:t.radius.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),shape:t.shape.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),draggable:t.draggable.get(e),layoutable:t.layoutable.get(e),innerStroke:ti.innerStroke(t,e),outerStroke:ti.outerStroke(t,e),badges:ti.badges(t,e),halo:ti.halo(t,e),pulse:ti.pulse(t,e),icon:ti.icon(t,e),image:ti.image(t,e),outline:ti.outline(t,e),text:ti.text(t,e)})},Xi={shape:(t,e)=>({body:t.shape.body.get(e),head:t.shape.head.get(e),tail:t.shape.tail.get(e),style:t.shape.style.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),position:t.text.position.get(e),backgroundColor:t.text.backgroundColor.get(e),minVisibleSize:t.text.minVisibleSize.get(e),adjustAngle:t.text.adjustAngle.get(e),scaling:t.text.scaling.get(e),maxLineLength:t.text.maxLineLength.get(e),secondary:Xi["text.secondary"](t,e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e)}),all:(t,e)=>({width:t.width.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),minVisibleSize:t.minVisibleSize.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),curvature:t.curvature.get(e),adjustAnchors:t.adjustAnchors.get(e),shape:Xi.shape(t,e),stroke:Xi.stroke(t,e),halo:Xi.halo(t,e),pulse:Xi.pulse(t,e),outline:Xi.outline(t,e),text:Xi.text(t,e)})};function bg(t,e,s,i=!0){if((e=e||t)._flexArray!==void 0)return $f(e,s);let n={check:ni,get:ae,set:ae,nested:{}};if(To(e)||e._alias){const r=To(e)?e:e._alias;n=$f(ze(t,r),r)}else{if(e._set?(n.set=e._set,n.check=e._check):(n.set=ae,n.check=ae),e._get)n.get=e._get;else{const r=i?ti:Xi;n.get=r[s||"all"]}n.nested={}}if(!To(e)){const r=Object.keys(e);for(const o of r){const a=e[o];o.startsWith("_")||(n.nested[o]=bg(t,a,s?s+"."+o:o,i))}}return n}var BM=bg(Wv,void 0,void 0,!0),UM=bg(Xv,void 0,void 0,!1),GM=[];function Zf(t){let e=GM;return t.output===void 0?(typeof t.attributes=="function"&&(e="all"),Xe(t.attributes)&&(e=kn(t.attributes))):t.output&&(e=t.output.attributes),vg(e,t.allAttributePaths)}function VM(t,e,s,i){if(i>s){for(const n of e.attributes)for(const r of t.attributes)if(r===n)return!0}for(const n of e.tags)for(const r of t.tags)if(n===r)return!0;return!1}function hi(t,e,s,i,n,r){VM(s,i,n,r)&&t.push(e)}function qM(t){let e=t.dependencies;e===void 0?e=fM:Xe(e)||(e={});const s=ud(t.attributes).some((o=>typeof o=="function")),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);let r=e.adjacentEdges;return!r&&e.adjacentNodes&&(r=!0),{self:pi(e.self,n,t.allAttributePaths),adjacentNodes:pi(e.adjacentNodes,n,t.allAttributePaths),adjacentEdges:pi(r,n,t.allAttributePaths),allNodes:pi(e.allNodes,n,t.allAttributePaths),allEdges:pi(e.allEdges,n,t.allAttributePaths)}}function HM(t){let e=t.dependencies;e===void 0?e=pM:Xe(e)||(e={});const s=ud(t.attributes).some((r=>typeof r=="function")),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);return{self:pi(e.self,n,t.allAttributePaths),extremities:pi(e.extremities,n,t.allAttributePaths),parallelEdges:pi(e.parallelEdges,n,t.allAttributePaths),allNodes:pi(e.allNodes,n,t.allAttributePaths),allEdges:pi(e.allEdges,n,t.allAttributePaths)}}function pi(t,e,s){if(!e)return{attributes:[],tags:[]};if(t===!0)return{attributes:[],tags:[cu]};const i={attributes:vg((t=t||{}).attributes,s),tags:XM(t.tags)};return t.data&&i.tags.push(gu),t.selection&&i.tags.push(Ne),t.hover&&i.tags.push(bo),i}function jM(t){return Array.isArray(t)?t.join("."):t}function YM(t){return t.map(jM).filter(To)}function vg(t,e){if(t==="all")return e.slice();if(!Array.isArray(t))return[];const s=YM(t);return e?e.filter((i=>s.some((n=>i.startsWith(n))))):s}function XM(t){return Array.isArray(t)?t.filter(To):[]}var Kf={storage:1,default:0},id=class{constructor({graph:t,isNode:e,includeRemovedElements:s}){this._all=!1,this._isNode=e,this._graph=t,this._includeRemovedElements=s,this._eltList=e?this._graph.nodeList:this._graph.edgeList,this._flexArray=e?t.createNodeAttribute(Kf,!1):t.createEdgeAttribute(Kf,!1),this._all=!1,this._indexList=t.createIndexList(e)}_getAllIndexes(){const t=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex(),e=new Uint32Array(t);for(let s=1;s<=t;++s)e[s-1]=s;return e}addAll(){this._all=!0}add(t){if(!this._all)for(let e=0;e<t._indexes.length;e++){const s=t._indexes[e];this.addIndex(s)}}addIndex(t){this._flexArray.get(t)===0&&(this._flexArray.set(t,1),this._indexList.push(t))}isEmpty(){return!this._all&&this._indexList.isEmpty()}isFull(){return this._all}getListAndClear(){const t=this.getList();return this.clear(),t}getList(){let t;if(this._all&&!this._includeRemovedElements)t=this._isNode?this._graph.getNodes("all"):this._graph.getEdges("all");else{const e=this._all?this._getAllIndexes():this._indexList.slice();t=this._eltList(e)}return t}clear(){this._all=!1,this._indexList.isEmpty()||(this._indexList.reset(),this._flexArray.reset())}addSet(t){if(t._all)this.addAll();else{const e=t._indexList.getBuffer(),s=t._indexList.getLength();for(let i=0;i<s;++i)this.addIndex(e[i])}}};function $v(t,e=[],s=""){return t.constructor===Xl?t.isInitialized()&&e.push(s):t.constructor===Object&&Object.keys(t).forEach((i=>{$v(t[i],e,s?s+"."+i:i)})),e}var Qf=class{constructor(t,e,s){this._updatedAttributes=new Set,this._updatedAttributesTmp=new Set,this._allUsedAttributes=new Set,this._graph=t,this._eltName=e?"node":"edge",this._accessors=e?BM:UM,this._createFlexArrays=s;const i=this._createFlexArrays(t,{original:!0,useDefaultValues:!0});this._finalFlexArrays=i;const n=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._prevFlexArrays=n;const r=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._defaultFlexArrays=r,this._currentFlexArrays=this._defaultFlexArrays,this.setLastFlexArrays(this._defaultFlexArrays),this._elementsToRedraw=new id({graph:t,isNode:e,includeRemovedElements:!0}),this._elementsUpdated=new id({graph:t,isNode:e,includeRemovedElements:!1}),this._finalFlexArraysWrapped={...this._finalFlexArrays,excluded:t.getAttribute(e,"excluded"),textHidden:t.getAttribute(e,"textHidden"),animationStart:t.createAttribute(e,cM),animationDuration:t.createAttribute(e,gM),animationEasing:t.createAttribute(e,mM),id:this._graph.getAttribute(e,"id"),...!e&&{source:t.getEdgeAttribute("source"),target:t.getEdgeAttribute("target")}}}clear(){this._elementsToRedraw.clear(),this._elementsUpdated.clear(),this._updatedAttributes.clear(),this._updatedAttributesTmp.clear()}getAttributeFlexArrays(){return this._finalFlexArraysWrapped}getPrevAttributeFlexArrays(){return this._prevFlexArrays}getAnimationInformation(t){const e=t._indexes,s=Array(e.length),i=this._finalFlexArraysWrapped;for(let n=0;n<e.length;n++){const r=e[n];s[n]={duration:i.animationDuration.get(r),start:i.animationStart.get(r),easing:i.animationEasing.get(r)}}return s}setDefaultAttributes(t){kn(t).forEach((e=>{const s=ze(this._currentFlexArrays,e),i=ze(this._prevFlexArrays,e),n=ze(this._defaultFlexArrays,e),r=ze(this._finalFlexArrays,e);if(!s)return;const o=ze(t,e);s.setDefaultValue(o),n.setDefaultValue(o),i.setDefaultValue(o),r.setDefaultValue(o)})),this.redrawAll()}startUpdate(){}prepareFlexArraysUpdate(t){this._currentFlexArrays=t.inputFlexArrays}setLastFlexArrays(t){this._lastFlexArrays=t}updateFlexArrays(t){const{attributes:e,selector:s,context:i,outputFlexArrays:n,toUpdate:r,formattedOutput:o}=t;this._elementsUpdated.addSet(r),this._elementsToRedraw.addSet(r);const a=r.getListAndClear();if(e&&a.size){const{valid:l,invalid:d}=Yy(this._graph,a,s,i);for(const h of o.attributes){const u=ze(n,h);for(let c=0;c<d._indexes.length;c++){const g=d._indexes[c];u.set(g,void 0)}}this._assignAttributesToFlexArrays(this._accessors,n,l,e,i),this._addUpdatedAttributes(t)}}endUpdate(){const t=this._elementsUpdated.getList(),e=co(this._updatedAttributesTmp);for(const s of e){const i=ze(this._lastFlexArrays,s),n=ze(this._finalFlexArrays,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];n.set(o,i.get(o))}}this._updatedAttributesTmp.clear(),this._currentFlexArrays=this._finalFlexArrays}setAttributeValues(t,e,s,i,n){const r=t.outputFlexArrays,o=this._accessors;this._assignAttributesToFlexArrays(o,r,e,s,null),this._addUpdatedAttributes(t,i),this._elementsUpdated.add(e),this._elementsToRedraw.add(e)}notifyLayerDestroyed(t){this._addUpdatedAttributes(t)}_addUpdatedAttributes(t,e){const{outputFlexArrays:s,formattedOutput:i}=t,n=Array.isArray(e)?vg(e):i.attributes;for(const r of n)ze(s,r).isInitialized()&&(this._updatedAttributes.add(r),this._updatedAttributesTmp.add(r),this._allUsedAttributes.add(r))}addUpdatedAttribute(t){this._updatedAttributes.add(t),this._updatedAttributesTmp.add(t),this._allUsedAttributes.add(t)}getUsedAttributeNames(t){return $v(t.outputFlexArrays)}redrawElements(t){this._elementsToRedraw.add(t)}redrawAll(){this._elementsToRedraw.addAll()}getAndResetElementsToRedraw(){return this._elementsToRedraw.getListAndClear()}getAndResetElementsUpdated(){return this._elementsUpdated.getListAndClear()}getAndResetAttributesUpdated(){const t=co(this._updatedAttributes);return this._updatedAttributes.clear(),t}getUpdatedAttributes(){return this._updatedAttributes}getUpdatedElementsList(){return this._elementsUpdated.getList()}getUpdatedAttributesSet(){return new Set(this._updatedAttributes)}createFlexArrays(){return this._createFlexArrays(this._graph,{original:!1,useDefaultValues:!1})}getAttributeValues(t,e,s,i){const n=i?this._prevFlexArrays:this._currentFlexArrays;return s?this._getMultipleAttributeValues(t,e,n):this._getSingleAttributeValues(t,e,n)}_getAccessor(t=""){let e=this._accessors;const s=zn(t);for(const i of s)if(e=e.nested[i],!e)throw new Error(`${this._eltName} attribute "${s.join("")}" does not exist`);return e}_getSingleAttributeValues(t,e,s){const i=this._getAccessor(e),n=t._indexes,r=Array(n.length);for(let o=0;o<n.length;o++)r[o]=i.get(s,n[o]);return r}_getMultipleAttributeValues(t,e,s){if(!e||e==="all")return this._getSingleAttributeValues(t,"",s);const i=Array(t.size);for(let n=0;n<i.length;++n)i[n]={};for(let n=0;n<e.length;n++){const r=e[n],o=this._getSingleAttributeValues(t,r,s);for(let a=0;a<i.length;++a)Li(i[a],r,o[a])}return i}setAnimationAttributes(t,{duration:e,startTime:s,easing:i}){const n=t._indexes,r=this._finalFlexArraysWrapped,o=r.animationDuration,a=r.animationStart,l=r.animationEasing,d=co(this._allUsedAttributes);if(e){let h=!1;for(const u of d){if(u==="x"||u==="y"){h=!0;continue}const c=ze(this._finalFlexArrays,u),g=ze(this._prevFlexArrays,u);for(let m=0;m<n.length;m++){const f=n[m];g.set(f,c.get(f))}}if(h){const u=ps(),c=this._finalFlexArrays.x,g=this._finalFlexArrays.y,m=this._prevFlexArrays.x,f=this._prevFlexArrays.y;for(let p=0;p<n.length;p++){const _=n[p],x=o.get(_);if(x){const y=a.get(_),b=l.get(_),v=(xg[b]||ed)(Math.min((u-y)/x,1)),A=ou(m.get(_),c.get(_),v),S=ou(f.get(_),g.get(_),v);m.set(_,A),f.set(_,S)}else m.set(_,c.get(_)),f.set(_,g.get(_))}}}o.fill(n,e),a.fill(n,s),l.fill(n,i)}resetAnimationAttributes(t){this._finalFlexArraysWrapped.animationDuration.fill(t._indexes,0)}getUsedAttributes(){return co(this._allUsedAttributes)}getDefaultFlexArrays(){return this._defaultFlexArrays}_assignAttributesToFlexArrays(t,e,s,i,n,r=[]){if(typeof i=="function"){const o=r.join(".");for(let a=0;a<s.size;++a){const l=s.get(a);if(l){const d=i(l,n,o);this._assignSingleValueToFlexArray(e,l,t,d,r)}}}else if(Xe(i)){const o=Object.keys(i);for(let a=0;a<o.length;++a){const l=o[a];r.push(l);const d=this._getNestedAccessor(t,l,r),h=i[l];this._assignAttributesToFlexArrays(d,e,s,h,n,r),r.pop()}}else if((Array.isArray(i)||ArrayBuffer.isView(i))&&r[0]!=="color")if(r.length===0)for(let o=0;o<s.size;++o)this._assignSingleValueToFlexArray(e,s.get(o),t,i[o],r);else for(let o=0;o<s.size;++o){const a=s._indexes[o],l=t.check(i[o]);t.set(e,a,l)}else{const o=t.check(i);for(let a=0;a<s.size;++a){const l=s.get(a);t.set(e,l._index,o)}}}_getNestedAccessor(t,e,s){const i=t.nested[e];if(!i)throw new Error(`${this._eltName} attribute "${s.join(".")}" does not exist`);return i}_assignSingleValueToFlexArray(t,e,s,i,n){if(Xe(i)){const r=Object.keys(i);for(const o of r){n.push(o);const a=i[o],l=this._getNestedAccessor(s,o,n);this._assignSingleValueToFlexArray(t,e,l,a,n),n.pop()}}else{const r=s.check(i);s.set(t,e._index,r)}}};function WM(t,{original:e,useDefaultValues:s}){const i="resource";return{width:t.createAttribute(!1,{storage:i,default:s?Bu:void 0,name:"width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?gv:void 0,name:"scalingMethod"},e),color:t.createAttribute(!1,{storage:i,default:s?mv:void 0,name:"color"},e),opacity:t.createAttribute(!1,{storage:i,default:s?fv:void 0,name:"opacity"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?pv:void 0,name:"minVisibleSize"},e),layer:t.createAttribute(!1,{storage:i,default:s?_v:void 0,name:"layer"},e),detectable:t.createAttribute(!1,{storage:i,default:s?yv:void 0,name:"detectable"},e),curvature:t.createAttribute(!1,{storage:i,default:s?xv:void 0,name:"curvature"},e),adjustAnchors:t.createAttribute(!1,{storage:i,default:s?bv:void 0,name:"adjustAnchors"},e),shape:{body:t.createAttribute(!1,{storage:i,default:s?vv:void 0,name:"shape.body"},e),head:t.createAttribute(!1,{storage:i,default:s?Ev:void 0,name:"shape.head"},e),tail:t.createAttribute(!1,{storage:i,default:s?Av:void 0,name:"shape.tail"},e),style:t.createAttribute(!1,{storage:i,default:s?Sv:void 0,name:"shape.style"},e)},stroke:{color:t.createAttribute(!1,{storage:i,default:s?wv:void 0,name:"stroke.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Uu:void 0,name:"stroke.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?Tv:void 0,name:"stroke.scalingMethod"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Cv:void 0,name:"stroke.minVisibleSize"},e)},halo:{color:t.createAttribute(!1,{storage:i,default:s?Lv:void 0,name:"halo.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Gu:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?Iv:void 0,name:"halo.scalingMethod"},e)},pulse:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!1,{storage:i,default:s?Mv:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!1,{storage:i,default:s?Nv:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!1,{storage:i,default:s?Rv:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!1,{storage:i,default:s?Fv:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!1,{storage:i,default:s?Pv:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!1,{storage:i,default:s?zv:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!1,{storage:i,default:s?Dv:void 0,name:"pulse.endRatio"},e)},outline:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!1,{storage:i,default:s?kv:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Ov:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!1,{storage:i,default:s?ws:void 0,name:"text.font"},e),color:t.createAttribute(!1,{storage:i,default:s?ln:void 0,name:"text.color"},e),size:t.createAttribute(!1,{storage:i,default:s?Nr:void 0,name:"text.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?yM:void 0,name:"text.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?Bv:void 0,name:"text.style"},e),align:t.createAttribute(!1,{storage:i,default:s?Uv:void 0,name:"text.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Gv:void 0,name:"text.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?Vu:void 0,name:"text.padding"},e),position:t.createAttribute(!1,{storage:i,default:s?Vv:void 0,name:"text.position"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?td:void 0,name:"text.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?qv:void 0,name:"text.minVisibleSize"},e),adjustAngle:t.createAttribute(!1,{storage:i,default:s?Hv:void 0,name:"text.adjustAngle"},e),scaling:t.createAttribute(!1,{storage:i,default:s?Fb:void 0,name:"text.scaling"},e),maxLineLength:t.createAttribute(!1,{storage:i,default:s?Pb:void 0,name:"text.maxLineLength"},e),secondary:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!1,{storage:i,default:s?ws:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!1,{storage:i,default:s?ln:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!1,{storage:i,default:s?Hu:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?Ib:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?Nb:void 0,name:"text.secondary.style"},e),align:t.createAttribute(!1,{storage:i,default:s?Rb:void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Yv:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?qu:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?Mb:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?jv:void 0,name:"text.secondary.minVisibleSize"},e)}}}}function $M(t,{original:e,useDefaultValues:s}){const i="resource";return{x:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"x"},e),y:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"y"},e),radius:t.createAttribute(!0,{storage:i,default:s?5:void 0,name:"radius"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?Ob:void 0,name:"color"},e),opacity:t.createAttribute(!0,{storage:i,default:s?qI:void 0,name:"opacity"},e),shape:t.createAttribute(!0,{storage:i,default:s?HI:void 0,name:"shape"},e),layer:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"layer"},e),detectable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"detectable"},e),draggable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"draggable"},e),layoutable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"layoutable"},e),innerStroke:{width:t.createAttribute(!0,{storage:i,default:s?mg:void 0,name:"innerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"innerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?Bb:void 0,name:"innerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?zu:void 0,name:"innerStroke.minVisibleSize"},e)},outerStroke:{width:t.createAttribute(!0,{storage:i,default:s?fg:void 0,name:"outerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"outerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?Ub:void 0,name:"outerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Pu:void 0,name:"outerStroke.minVisibleSize"},e)},badges:{topLeft:{color:t.createAttribute(!0,{storage:i,default:s?lo:void 0,name:"badges.topLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.topLeft.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.topLeft.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?ho:void 0,name:"badges.topLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?_r:void 0,name:"badges.topLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topLeft.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?uo:void 0,name:"badges.topLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ws:void 0,name:"badges.topLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.top"},e)}},topRight:{color:t.createAttribute(!0,{storage:i,default:s?lo:void 0,name:"badges.topRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.topRight.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.topRight.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?ho:void 0,name:"badges.topRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?_r:void 0,name:"badges.topRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topRight.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?uo:void 0,name:"badges.topRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ws:void 0,name:"badges.topRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topRight.text.scale"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.left"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.top"},e)}},bottomLeft:{color:t.createAttribute(!0,{storage:i,default:s?lo:void 0,name:"badges.bottomLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.bottomLeft.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.bottomLeft.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?ho:void 0,name:"badges.bottomLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?_r:void 0,name:"badges.bottomLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomLeft.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?uo:void 0,name:"badges.bottomLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ws:void 0,name:"badges.bottomLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.top"},e)}},bottomRight:{color:t.createAttribute(!0,{storage:i,default:s?lo:void 0,name:"badges.bottomRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.bottomRight.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.bottomRight.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?ho:void 0,name:"badges.bottomRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?_r:void 0,name:"badges.bottomRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomRight.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?uo:void 0,name:"badges.bottomRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ws:void 0,name:"badges.bottomRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomRight.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.top"},e)}}},halo:{color:t.createAttribute(!0,{storage:i,default:s?Vb:void 0,name:"halo.color"},e),width:t.createAttribute(!0,{storage:i,default:s?pg:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"halo.scalingMethod"},e),strokeColor:t.createAttribute(!0,{storage:i,default:s?qb:void 0,name:"halo.strokeColor"},e),strokeWidth:t.createAttribute(!0,{storage:i,default:s?_g:void 0,name:"halo.strokeWidth"},e),clustering:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.clustering"},e),hideNonAdjacentEdges:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.hideNonAdjacentEdges"},e)},pulse:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!0,{storage:i,default:s?jb:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!0,{storage:i,default:s?Yb:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!0,{storage:i,default:s?Zb:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!0,{storage:i,default:s?$b:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!0,{storage:i,default:s?Kb:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!0,{storage:i,default:s?Xb:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!0,{storage:i,default:s?Wb:void 0,name:"pulse.endRatio"},e)},icon:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"icon.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ws:void 0,name:"icon.font"},e),color:t.createAttribute(!0,{storage:i,default:s?Hb:void 0,name:"icon.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.7:void 0,name:"icon.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"icon.style"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"icon.minVisibleSize"},e)},image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"image.scale"},e),fit:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"image.fit"},e),tile:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"image.tile"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"image.minVisibleSize"},e)},outline:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!0,{storage:i,default:s?Gb:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ws:void 0,name:"text.font"},e),color:t.createAttribute(!0,{storage:i,default:s?ln:void 0,name:"text.color"},e),size:t.createAttribute(!0,{storage:i,default:s?Nr:void 0,name:"text.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.1:void 0,name:"text.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?cg:void 0,name:"text.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?qo:void 0,name:"text.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?td:void 0,name:"text.backgroundColor"},e),tip:t.createAttribute(!0,{storage:i,default:s?GI:void 0,name:"text.tip"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.minVisibleSize"},e),scaling:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"text.scaling"},e),position:t.createAttribute(!0,{storage:i,default:s?"bottom":void 0,name:"text.position"},e),maxLineLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.maxLineLength"},e),truncateLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.truncateLength"},e),secondary:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ws:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!0,{storage:i,default:s?ln:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!0,{storage:i,default:s?gg:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.08:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.secondary.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?VI:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?qo:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?td:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.secondary.minVisibleSize"},e)}}}}var ZM=class{constructor(t){this.nodes=new Qf(t,!0,$M),this.edges=new Qf(t,!1,WM)}setNodeDefaultAttributes(t){this.nodes.setDefaultAttributes(t)}setEdgeDefaultAttributes(t){this.edges.setDefaultAttributes(t)}getFlexArrays(){return{nodes:{current:this.nodes.getAttributeFlexArrays(),previous:this.nodes.getPrevAttributeFlexArrays()},edges:{current:this.edges.getAttributeFlexArrays(),previous:this.edges.getPrevAttributeFlexArrays()}}}redrawAll(){this.nodes.redrawAll(),this.edges.redrawAll()}clear(){this.nodes.clear(),this.edges.clear()}redrawElements(t){this._fetch(t).redrawElements(t)}getAnimationInformation(t){return this._fetch(t).getAnimationInformation(t)}redrawNodes(t){this.nodes.redrawElements(t)}getUsedAttributes(t,e){return this._fetch(e).getUsedAttributeNames(e.isNode?t.nodes:t.edges)}startUpdate(){this.nodes.startUpdate(),this.edges.startUpdate()}notifyDestroyed(t){this.nodes.notifyLayerDestroyed(t.nodes),this.edges.notifyLayerDestroyed(t.edges)}prepareUpdate(t){this.nodes.prepareFlexArraysUpdate(t.nodes),this.edges.prepareFlexArraysUpdate(t.edges)}onUpdate(t){this.nodes.updateFlexArrays(t.nodes),this.edges.updateFlexArrays(t.edges)}afterLayersUpdate(){this.nodes.endUpdate(),this.edges.endUpdate()}getAndResetElementsToRedraw(){return{nodes:this.nodes.getAndResetElementsToRedraw(),edges:this.edges.getAndResetElementsToRedraw()}}getAndResetElementsUpdated(){const t=this.nodes,e=this.edges;return{nodes:t.getAndResetElementsUpdated(),edges:e.getAndResetElementsUpdated(),nodeAttributesSet:t.getUpdatedAttributesSet(),nodeAttributes:t.getAndResetAttributesUpdated(),edgeAttributes:e.getAndResetAttributesUpdated()}}setAnimationAttributes({nodes:t,edges:e},s){this.nodes.setAnimationAttributes(t,s),this.edges.setAnimationAttributes(e,s)}resetAnimationAttributes({nodes:t,edges:e}){this.nodes.resetAnimationAttributes(t),this.edges.resetAnimationAttributes(e)}setLastOutput(t,e){this.nodes.setLastFlexArrays(t),this.edges.setLastFlexArrays(e)}getCurrentInput(){const t=ke(this.nodes.getDefaultFlexArrays()),e=ke(this.edges.getDefaultFlexArrays());return{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:kn(t),allEdgeAttributePaths:kn(e)}}initializeLayer(t,e,s){t.nodes.allAttributePaths=e,t.edges.allAttributePaths=s,t.nodes.formattedDependencies=qM(t.nodes),t.edges.formattedDependencies=HM(t.edges),t.nodes.formattedOutput={attributes:Zf(t.nodes),tags:t.tag?[t.tag]:[]},t.edges.formattedOutput={attributes:Zf(t.edges),tags:t.tag?[t.tag]:[]},t.nodes.redrawAdjacentEdges=t.nodes.formattedOutput.attributes.some((i=>_M[i])),t.initialized=!0}connectLayerInputOutput(t,e,s){const i=t.nodes.formattedOutput,n=t.edges.formattedOutput;for(const r of i.attributes){const o=ze(e,r),a=ze(t.nodes.outputFlexArrays,r);a.setFallback(o),Li(e,r,a)}for(const r of n.attributes){const o=ze(s,r),a=ze(t.edges.outputFlexArrays,r);a.setFallback(o),Li(s,r,a)}}setupLayerDependencies(t,e){if(t===e)return;const s=t.priority,i=e.priority,n=t.nodes.formattedOutput,r=t.edges.formattedOutput,o=e.nodes.formattedDependencies,a=e.edges.formattedDependencies;hi(t.depsNodeSelf,e,n,o.self,s,i),hi(t.depsNodeAdjacentNodes,e,n,o.adjacentNodes,s,i),hi(t.depsNodeAdjacentEdges,e,r,a.extremities,s,i),hi(t.depsNodeAllNodes,e,n,o.allNodes,s,i),hi(t.depsNodeAllEdges,e,r,a.allNodes,s,i),hi(t.depsEdgeSelf,e,r,a.self,s,i),hi(t.depsEdgeExtremities,e,n,o.adjacentEdges,s,i),hi(t.depsEdgeParallelEdges,e,r,a.parallelEdges,s,i),hi(t.depsEdgeAllNodes,e,n,o.allEdges,s,i),hi(t.depsEdgeAllEdges,e,r,a.allEdges,s,i)}createAttributeLayerData(t,e,s,{tag:i,onBeforeUpdate:n,standaloneSelectors:r}){const o=!!r;return{index:-1,id:e,name:t,tag:i||null,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:!1,onBeforeUpdate:n,nodes:{type:"node",name:t,standaloneSelector:o,toUpdate:new id({graph:s,isNode:!0,includeRemovedElements:!1}),outputFlexArrays:this.nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{type:"edge",name:t,standaloneSelector:o,toUpdate:new id({graph:s,isNode:!1,includeRemovedElements:!1}),outputFlexArrays:this.edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}}}setAttributeValues(t,e,s,i,n){this._fetch(e).setAttributeValues(t,e,s,i,n)}getAttributeValues(t,e,s,i){return this._fetch(t).getAttributeValues(t,e,s,i)}_fetch(t){return t.isNode?this.nodes:this.edges}},KM=(t,e)=>new rM(t,e),QM=class{constructor(t,{graph:e,dom:s}){this._layerIdCounter=0,this._layers=[],this._destroyedLayers=[],this._layersNeedUpdate=!1,this._updateOngoing=!1,this._needUpdate=!1,this._ogma=t,this._graph=e,this._dom=s,this._emptySubgraph={nodes:t.nodeList(),edges:t.edgeList()},this._textHiddenSet=new ca(this._graph,"textHidden"),this._layerController=new ZM(this._graph)}_getLayerById(t){for(let e=0;e<this._layers.length;++e){const s=this._layers[e];if(s.id===t)return s.index=e,s}throw new Error("usage of a destroyed style rule or class")}setDefaultAttributes(t,e){this._layerController.setNodeDefaultAttributes(t),this._layerController.setEdgeDefaultAttributes(e)}getFlexArrays(){return this._layerController.getFlexArrays()}clear(){this._updateOngoing=!1,this._needUpdate=!1,this._destroyedLayers=[],this._layerController.clear(),this.updateAllForAllAttributeLayers()}redrawElements(t){t.size&&(this._layerController.redrawElements(t),this._dom.refresh())}redrawAll(){this._layerController.redrawAll(),this._dom.refresh()}_triggerUpdate(){this._needUpdate=!0,this._dom.refresh()}_reconstructAttributeLayersIfNecessary(){return!!this._layersNeedUpdate&&(this._reconstructAttributeLayers(),this._layersNeedUpdate=!1,this._dom.refresh(),!0)}getAnimationInformation(t){return this._layerController.getAnimationInformation(t)}update(){if(!this._needUpdate||this._updateOngoing||!this._ogma._token)return!1;this._reconstructAttributeLayersIfNecessary(),this._updateOngoing=!0,this._layerController.startUpdate();for(const t of this._destroyedLayers)t.initialized&&this._layerController.notifyDestroyed(t);for(const t of this._layers)this._layerController.prepareUpdate(t),typeof t.onBeforeUpdate=="function"&&t.onBeforeUpdate(t,this,this._layerController),this._layerController.onUpdate(t);return this._layerController.afterLayersUpdate(),this._updateOngoing=!1,this._needUpdate=!1,!0}setAttributeLayerValues(t,e,s,i){const n=this._getLayerById(t),r=e.isNode?n.nodes:n.edges;this._reconstructAttributeLayersIfNecessary(),this._layerController.setAttributeValues(r,e,s,i,n),this._updateElementsForAttributeLayers([n],e)}getAttributeLayerFlexArrays(t){const e=this._getLayerById(t);return{nodes:e.nodes.outputFlexArrays,edges:e.edges.outputFlexArrays}}getUsedAttributeLayerAttributes(t,e){const s=this._getLayerById(t);return this._layerController.getUsedAttributes(s,e)}getUpdatedElements(){return{elementsToRedraw:this._layerController.getAndResetElementsToRedraw(),elementsUpdated:this._layerController.getAndResetElementsUpdated()}}addAttributeLayer(t){const{name:e,layerFactory:s=KM}=t;if(!e)throw new Error("Attribute layer must have a name");if(e&&this._layers.find((n=>n.name===e)))throw new Error(`attribute layer with name "${t.name}" already exists`);const i=this._layerController.createAttributeLayerData(e,++this._layerIdCounter,this._graph,t);return this._layers.push(i),this._updateLayer(i,t),s(this,this._layerIdCounter)}_reconstructAttributeLayers(){this._layers.sort(((n,r)=>n.priority-r.priority));const{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:s,allEdgeAttributePaths:i}=this._layerController.getCurrentInput();for(const n of this._layers)this._layerController.initializeLayer(n,s,i);for(const n of this._layers){n.nodes.inputFlexArrays=ke(t),n.edges.inputFlexArrays=ke(e),n.depsNodeSelf=[],n.depsNodeAdjacentNodes=[],n.depsNodeAdjacentEdges=[],n.depsNodeAllNodes=[],n.depsNodeAllEdges=[],n.depsEdgeSelf=[],n.depsEdgeExtremities=[],n.depsEdgeParallelEdges=[],n.depsEdgeAllNodes=[],n.depsEdgeAllEdges=[],n.nodes.toUpdate.addAll(),n.edges.toUpdate.addAll(),this._layerController.connectLayerInputOutput(n,t,e);for(const r of this._layers)this._layerController.setupLayerDependencies(n,r)}this._layerController.setLastOutput(t,e);for(const n of this._layers)n.nodes.needAdjacentElements=n.nodes.redrawAdjacentEdges||n.depsNodeAdjacentNodes.length>0||n.depsNodeAdjacentEdges.length>0,n.edges.needAdjacentElements=n.depsEdgeExtremities.length>0||n.depsEdgeParallelEdges.length>0}_updateLayer(t,{priority:e,fullOverwrite:s,nodeAttributes:i,nodeSelector:n,nodeContext:r,nodeDependencies:o,nodeOutput:a,edgeAttributes:l,edgeSelector:d,edgeContext:h,edgeDependencies:u,edgeOutput:c}={}){i!==void 0&&(t.nodes.attributes=s?i:Nl(t.nodes.attributes,i)),n!==void 0&&(t.nodes.selector=n),r!==void 0&&(t.nodes.context=r),o!==void 0&&(t.nodes.dependencies=o),a!==void 0&&(t.nodes.output=a),l!==void 0&&(t.edges.attributes=s?l:Nl(t.edges.attributes,l)),d!==void 0&&(t.edges.selector=d),h!==void 0&&(t.edges.context=h),u!==void 0&&(t.edges.dependencies=u),c!==void 0&&(t.edges.output=c),e!==void 0&&(t.priority=e),this._triggerLayerUpdate()}_triggerLayerUpdate(){this._layersNeedUpdate=!0,this._triggerUpdate()}updateAllForAttributeLayer(t){const e=this._getLayerById(t);this._updateAllForAttributeLayer(e)}updateAllForAllAttributeLayers(){for(const t of this._layers)this._updateAllForAttributeLayer(t)}_updateAllForAttributeLayer(t,e=!0,s=!0){if(e&&!t.nodes.toUpdate.isFull()){t.nodes.toUpdate.addAll();for(const i of t.depsNodeSelf)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsNodeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}if(s&&!t.edges.toUpdate.isFull()){t.edges.toUpdate.addAll();for(const i of t.depsEdgeSelf)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeExtremities)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeParallelEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}this._triggerUpdate()}updateElementsForAttributeLayer(t,e){const s=this._getLayerById(t);this._updateElementsForAttributeLayers([s],e)}updateForAllAttributeLayers(t){this._updateElementsForAttributeLayers(this._layers,t)}_updateElementsForAttributeLayers(t,e){let s=this._emptySubgraph;if(e.isNode){for(const i of t)if(!i.nodes.toUpdate.isFull()){i.nodes.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.nodes.toUpdate.add(e);for(const n of i.depsNodeSelf)n.nodes.toUpdate.add(e);for(const n of i.depsNodeAdjacentNodes)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsNodeAdjacentEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsNodeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsNodeAllEdges)this._updateAllForAttributeLayer(n,!1,!0);i.nodes.redrawAdjacentEdges&&this._layerController.redrawElements(s.edges)}}else for(const i of t)if(!i.edges.toUpdate.isFull()){i.edges.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.edges.toUpdate.add(e);for(const n of i.depsEdgeSelf)n.edges.toUpdate.add(e);for(const n of i.depsEdgeExtremities)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsEdgeParallelEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsEdgeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsEdgeAllEdges)this._updateAllForAttributeLayer(n,!1,!0)}this._triggerUpdate()}destroyAttributeLayer(t){const e=this._getLayerById(t);this._destroyedLayers.push(e),this._layers.splice(e.index,1),this._triggerLayerUpdate()}updateAttributeLayer(t,e){const s=this._getLayerById(t);this._updateLayer(s,e)}getAttributeLayerDefinition(t){const e=this._getLayerById(t),{priority:s,nodes:i,edges:n}=e;return{priority:s,nodeAttributes:i.attributes,nodeSelector:i.selector,nodeContext:i.context,nodeDependencies:i.dependencies,nodeOutput:i.output,edgeAttributes:n.attributes,edgeSelector:n.selector,edgeContext:n.context,edgeDependencies:n.dependencies,edgeOutput:n.output}}getAttributeValues(t,e,s,i){return this.update(),this._layerController.getAttributeValues(t,e,s,i)}setAnimationAttributes(t,e){return this._layerController.setAnimationAttributes(t,e)}resetAnimationAttributes(t){return this._layerController.resetAnimationAttributes(t)}setTextHidden(t,e){const s=this._textHiddenSet.addOrRemoveElements(t,e);this.redrawElements(s)}resetTextHidden(){const{nodes:t,edges:e}=this._textHiddenSet.getElements();this._textHiddenSet.clear(),this._layerController.redrawElements(t),this._layerController.redrawElements(e)}getUsedNodeAttributes(){return this._layerController.nodes.getUsedAttributes()}getUsedEdgeAttributes(){return this._layerController.edges.getUsedAttributes()}interpolateAttributes(t){const e=ps(),s=this._ogma.modules.graphics.getAttributesManager(),i=this._layerController,n=t.isNode?s.getUsedNodeAttributes():s.getUsedEdgeAttributes(),{animationDuration:r,animationEasing:o,animationStart:a}=i.getFlexArrays().nodes.current,l=r.getMultiple(t._indexes),d=o.getMultiple(t._indexes),h=a.getMultiple(t._indexes),u=[];for(let c=0;c<t.size;c++){const g={};n.forEach((m=>{const f=typeof m=="string"?m:m.join("."),p=ze(i.getFlexArrays().nodes.previous,m),_=ze(i.getFlexArrays().nodes.current,m);if(!_)return;const x=Z0(e,h[c],l[c],d[c]);isNaN(x)?g[f]=_.get(t._indexes[c]):f.match(/color/gi)?g[f]=oo(p.get(t._indexes[c]),_.get(t._indexes[c]),x,x):g[f]=ye(p.get(t._indexes[c]),_.get(t._indexes[c]),x)})),u.push(g)}return u}},JM=1e-12;function Jf(t){return((t=Math.exp(t))+1/t)/2}function tN(t){return((t=Math.exp(t))-1/t)/2}function eN(t){return((t=Math.exp(2*t))-1)/(t+1)}var sN=(function t(e,s,i){function n(r,o){var a,l,d=r[0],h=r[1],u=r[2],c=o[0],g=o[1],m=o[2],f=c-d,p=g-h,_=f*f+p*p;if(_<JM)l=Math.log(m/u)/e,a=function(S){return[d+S*f,h+S*p,u*Math.exp(e*S*l)]};else{var x=Math.sqrt(_),y=(m*m-u*u+i*_)/(2*u*s*x),b=(m*m-u*u-i*_)/(2*m*s*x),v=Math.log(Math.sqrt(y*y+1)-y),A=Math.log(Math.sqrt(b*b+1)-b);l=(A-v)/e,a=function(S){var w=S*l,I=Jf(v),M=u/(s*x)*(I*eN(e*w+v)-tN(v));return[d+M*f,h+M*p,u*I/Jf(e*w+v)]}}return a.duration=1e3*l*e/Math.SQRT2,a}return n.rho=function(r){var o=Math.max(.001,+r),a=o*o;return t(o,a,a*a)},n})(Math.SQRT2,2,4),iN="cubicOut",nN=({graphWidth:t,graphHeight:e,viewWidth:s,viewHeight:i})=>.2*Math.min(s/t,i/e),rN=({smallestNodeSize:t,viewWidth:e,viewHeight:s})=>t===1/0?1/0:Math.min(e,s)/t*.5;function oN(t,e,s){return e===void 0?aN(t):e==="alt"?t.altKey:e==="shift"?t.shiftKey:e==="space"?s.isPressed("space"):void 0}function aN(t){return!t.altKey&&(ZS?t.metaKey:t.ctrlKey)&&!t.shiftKey}var ju=Math.SQRT2,tp=.15,lN=class extends te{constructor(t,e){super(t),this._zooming=!1,this.debug=!1,this._smoothZoom=Ro(((s,i,n)=>{const r=this._modules.settings,o=r.get("interactions.zoom.duration"),a=r.get("interactions.zoom.easing"),l=this._modules.camera.getZoom(),d={duration:o,easing:a};this._zooming||(this._zooming=!0,this._updateVisibility("zoom",!0));const h=r.get("interactions.zoom.speed")||tp;let u=O2(s,h);s<0&&u!==0&&(u=1/u);const c=l*u;this._modules.camera.setZoom(c,d,{x:i,y:n}).then((()=>{this._zooming&&(this._zooming=!1,this._updateVisibility("zoom",!1))}))}),ux),this.debug=e}onMounted(){const t=this._modules.settings;t.register("interactions.zoom.enabled",!0),t.register("interactions.zoom.onDoubleClick",!1),t.register("interactions.zoom.duration",150),t.register("interactions.zoom.modifier",ju),t.register("interactions.zoom.speed",tp),t.register("interactions.zoom.easing",iN),t.register("interactions.zoom.minValue",this.debug?null:nN),t.register("interactions.zoom.maxValue",this.debug?null:rN),t.register("interactions.zoom.hideNodes",!1),t.register("interactions.zoom.hideEdges",!1),t.register("interactions.zoom.hideNodeTexts",!1),t.register("interactions.zoom.hideEdgeTexts",!1),t.register("interactions.zoom.scrollToPan",!1),t.register("interactions.zoom.metaKey",void 0),t.register("interactions.pan.enabled",!0),t.register("interactions.pan.hideNodes",!1),t.register("interactions.pan.hideEdges",!1),t.register("interactions.pan.hideNodeTexts",!1),t.register("interactions.pan.hideEdgeTexts",!1),t.register("interactions.rotation.enabled",!0),t.register("interactions.rotation.hideNodes",!1),t.register("interactions.rotation.hideEdges",!1),t.register("interactions.rotation.hideNodeTexts",!1),t.register("interactions.rotation.hideEdgeTexts",!1),t.register("interactions.gesture.enabled",!0),t.register("interactions.gesture.hideNodes",!1),t.register("interactions.gesture.hideEdges",!1),t.register("interactions.gesture.hideNodeTexts",!1),t.register("interactions.gesture.hideEdgeTexts",!1),this._setupInteractions()}_setupInteractions(){this._modules.interactions.onMouseWheel({priority:"zoom",check:()=>!!this._modules.settings.get("interactions.zoom.enabled"),handler:({x:t,y:e,delta:s,dx:i,dy:n,domEvent:r})=>{const o=i%1!=0||n%1!=0,a=this._modules.settings;!a.get("interactions.zoom.scrollToPan")||oN(r,a.get("interactions.zoom.metaKey"),this._modules.keyboard)||o?this._smoothZoom(s,t,e):this._modules.camera.move({x:i,y:n})}}),this._modules.interactions.onDoubleClick({priority:"zoom",check:()=>{const t=this._modules.settings.get("interactions.zoom.enabled"),e=this._modules.settings.get("interactions.zoom.onDoubleClick");return!(!t||!e)},handler:({x:t,y:e})=>this._smoothZoom(1,t,e)}),this._modules.interactions.onDrag({priority:"panning",disableDetection:!0,check:({button:t})=>{const e=!!this._modules.settings.get("interactions.pan.enabled");return t==="left"&&e},onStart:()=>this._updateVisibility("pan",!0),onProgress:({dx:t,dy:e})=>this._modules.camera.move({x:-t,y:-e}),onStop:()=>this._updateVisibility("pan",!1)}),this._modules.interactions.onDrag({priority:"rotation",disableDetection:!0,check:({button:t,domEvent:e})=>(t==="right"||e&&e.buttons===2)&&!!this._modules.settings.get("interactions.rotation.enabled"),onStart:({x:t,y:e})=>{this._rotationStart={x:t,y:e},this._updateVisibility("rotation",!0)},onProgress:({x:t,y:e})=>this._rotate({x:t,y:e}),onStop:()=>this._updateVisibility("rotation",!1)}),this._modules.interactions.onGesture({priority:"gesture",disableDetection:!0,check:()=>!!this._modules.settings.get("interactions.gesture.enabled"),onStart:()=>this._updateVisibility("gesture",!0),onProgress:({dx:t,dy:e,rotation:s,scale:i,x:n,y:r})=>{this._modules.settings.get("interactions.rotation.enabled")&&this._modules.camera.rotate(-s),this._modules.camera.zoomIn({modifier:i},{x:n,y:r}),this._modules.camera.move({x:-t,y:-e})},onStop:()=>this._updateVisibility("gesture",!0)})}_rotate({x:t,y:e}){const{width:s,height:i}=this._modules.camera.getSize(),n=s/2,r=i/2,o=this._rotationStart.x-n,a=this._rotationStart.y-r,l=t-n,d=e-r,h=Math.atan2(a,o)-Math.atan2(d,l);this._rotationStart.x=t,this._rotationStart.y=e,this._modules.camera.rotate(h)}_updateVisibility(t,e){const s=!e,i=this._modules.settings,n=i.get(`interactions.${t}.hideNodes`),r=i.get(`interactions.${t}.hideEdges`),o=i.get(`interactions.${t}.hideNodeTexts`),a=i.get(`interactions.${t}.hideEdgeTexts`);n&&this._modules.graphics.setNodesVisibility(s),o&&this._modules.graphics.setNodeTextsVisibility(s),r&&this._modules.graphics.setEdgesVisibility(s),a&&this._modules.graphics.setEdgeTextsVisibility(s)}},dN=1e-8,hN=1e8,yh={duration:0,startAfter:0,ignoreZoomLimits:!1,callback:ae,easing:"quadraticOut"};function Qa(t){return Math.abs(t)<1e-9}var uN=80,cN=class Zv extends te{constructor(){super(...arguments),this._minZoom=dN,this._maxZoom=hN,this._timeout=0,this._cornerCosSin=new Float32Array([0,0,0,0,0,0,0,0])}onMounted(){this._reset(),this._modules.events.on("setContainer",(()=>{this._reset(),this._modules.events.fire("move")})).on("resize",(()=>{this._reloadDimensions(),this._modules.events.fire("move")}))}get x(){return this._x}get y(){return this._y}get zoom(){return this._zoom}get angle(){return this._angle}get width(){return this._dimensions.width}get height(){return this._dimensions.height}moveEnd(e){this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout((()=>{this._modules.events.fire("viewChanged",{type:e})}),uN)}getSize(){return{width:this._dimensions.width,height:this._dimensions.height}}getCenter(){return{x:this._x,y:this._y}}setCenter({x:e,y:s},i){const n=this._x,r=this._y,o=e-this._x,a=s-this._y;return Qa(o)&&Qa(a)?Promise.resolve():new Promise((l=>{this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const d=this._modules.animations.play((h=>{this._x=n+o*h,this._y=r+a*h,this._modules.events.fire("move").fire("pan")}),{...yh,...i,callback:()=>this.moveEnd("pan"),resolve:l});d&&(this._moveAnimation=d)}))}move({x:e,y:s},i){const n=ep({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle);return this.setCenter({x:this._x+n.x,y:this._y+n.y},i)}getZoom(){return this._zoom}setZoom(e,s,i={x:void 0,y:void 0}){const{x:n,y:r}=i;let o=Ws(e,this._minZoom,this._maxZoom);return s&&s.ignoreZoomLimits||(o=this._applyZoomLimits(o)),Qa(this._zoom-o)?Promise.resolve():new Promise((a=>{const l={...yh,...s,callback:()=>this.moveEnd("zoom"),resolve:a},d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._zoom,c=d/u-d/o;if(n!==void 0&&r!==void 0){const m=(n-d)/u-(n-d)/o,f=(r-h)/u-(r-h)/o,p=this._cosAngle,_=this._sinAngle,x=p*m-_*f,y=_*m+p*f;this.setCenter({x:this._x+x,y:this._y+y},s)}this._zoomAnimation&&this._modules.animations.cancel(this._zoomAnimation),this._modules.dom.afterNextFrame().then((()=>this._modules.events.fire("zoomStart",{duration:l.duration,easing:l.easing,startZoom:u,endZoom:o})));const g=this._modules.animations.play((m=>{this._zoom=d/(d/u-c*m),this._modules.events.fire("move").fire("zoom")}),l);g&&(this._zoomAnimation=g)}))}_applyZoomLimits(e){const s=this._modules.settings.get("interactions.zoom.minValue"),i=this._modules.settings.get("interactions.zoom.maxValue"),{minScaledSize:n,maxScaledSize:r,width:o,height:a,cx:l}=this._modules.locate.getGraphBoundingBox(),d=this._zoom,h=this.getSize();let u=e;if(!isNaN(l)){const c={smallestNodeSize:n,biggestNodeSize:r,graphWidth:o+r,graphHeight:a+r,viewWidth:h.width,viewHeight:h.height},g=s&&s(c),m=i&&i(c);sp(g)&&u<g?u<d&&(u=Math.min(d,g)):sp(m)&&u>m&&u>d&&(u=Math.max(d,m))}return u}zoomIn(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||ju:e.modifier,this.setZoom(this._zoom*i,e,s)}moveToBounds(e,s={}){const i=this._modules.locate.computeConfigForBounds(e,{ignoreZoomLimits:!0});return this.moveTo(i,s)}moveTo(e,s={}){const i=this.getZoom(),n=this.getCenter(),r=e.zoom||this._zoom;return s.duration===0?this.setView(e):new Promise((o=>{const a=Math.min(this.width,this.height),l=sN([n.x,n.y,a/i],[e.x,e.y,a/r]),d=l.duration,h=s.duration||d;this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const u=this._modules.animations.play((c=>{const[g,m,f]=l(c);this._x=g,this._y=m,this._zoom=a/f,this._modules.events.fire("move"),this._modules.events.fire("pan")}),{duration:h,easing:s.easing,callback:()=>this.moveEnd("pan"),resolve:o});u&&(this._moveAnimation=u)}))}zoomOut(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||ju:e.modifier,this.setZoom(this._zoom/i,e,s)}getAngle(){return this._angle}setAngle(e,s){const i=this._angle,n=e-i;return Qa(n)?Promise.resolve():new Promise((r=>{this._rotateAnimation&&this._modules.animations.cancel(this._rotateAnimation);const o=this._modules.animations.play((a=>{for(this._angle=i+n*a,this.calculateBoxCornerAngles();this._angle>Math.PI;)this._angle-=2*Math.PI;for(;this._angle<-Math.PI;)this._angle+=2*Math.PI;this._sinAngle=Math.sin(this._angle),this._cosAngle=Math.cos(this._angle),this._modules.events.fire("move").fire("rotate")}),{...yh,...s,callback:()=>this.moveEnd("rotate"),resolve:r});o&&(this._rotateAnimation=o)}))}rotate(e,s){return this.setAngle(this._angle+e,s)}getScreenCenter(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}}graphToScreenCoordinates({x:e,y:s},i={x:0,y:0}){const n=this._dimensions.width/2,r=this._dimensions.height/2;return Hl((e-this._x)*this._zoom+n,(s-this._y)*this._zoom+r,n,r,-this._angle,i)}screenToGraphCoordinates({x:e,y:s},i={x:0,y:0}){return Hl(this._x+(e-this._dimensions.width/2)/this._zoom,this._y+(s-this._dimensions.height/2)/this._zoom,this._x,this._y,this._angle,i)}projectBounds(e,s=e){const i=e[0],n=e[1],r=e[2],o=e[3],a=this._x,l=this._y,d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._sinAngle,c=this._cosAngle,g=1/this._zoom;let m=1/0,f=1/0,p=-1/0,_=-1/0;const x=[i,n,i,o,r,o,r,n];for(let y=0;y<x.length;y+=2){let b=x[y],v=x[y+1];b=a+(b-d)*g,v=l+(v-h)*g;const A=b-a,S=v-l;b=c*A-u*S+a,v=u*A+c*S+l,b<m&&(m=b),b>p&&(p=b),v<f&&(f=v),v>_&&(_=v)}return s[0]=m,s[1]=f,s[2]=p,s[3]=_,s}screenToGraphVector({x:e,y:s}){return ep({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle)}getView(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}}setView(e,s){const{x:i,y:n,zoom:r,angle:o}={x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,...e};return Promise.all([this.setCenter({x:i,y:n},s),this.setZoom(r,s),this.setAngle(o,s)]).then(ae)}_reloadDimensions(){this._dimensions=this._modules.dom.getDimensions()}animationInProgress(){const e=this._moveAnimation,s=this._zoomAnimation,i=this._rotateAnimation;return!!(e&&!e.done||s&&!s.done||i&&!i.done)}getProjectedScreenBounds(e=0){const{width:s,height:i}=this._dimensions,n=Math.max(s,i)*e;return this.projectBounds([0-n,0-n,s+n,i+n])}calculateBoxCornerAngles(){const e=this._angle;this._cornerCosSin[0]=Math.cos(e+Math.PI/4),this._cornerCosSin[1]=Math.sin(e+Math.PI/4),this._cornerCosSin[2]=Math.cos(e+3*Math.PI/4),this._cornerCosSin[3]=Math.sin(e+3*Math.PI/4),this._cornerCosSin[4]=Math.cos(e-3*Math.PI/4),this._cornerCosSin[5]=Math.sin(e-3*Math.PI/4),this._cornerCosSin[6]=Math.cos(e-Math.PI/4),this._cornerCosSin[7]=Math.sin(e-Math.PI/4)}getCornerCos(e){return this._cornerCosSin[2*e]}getCornerSin(e){return this._cornerCosSin[2*e+1]}_reset(){this._zoom=1,this._x=0,this._y=0,this._angle=0,this.calculateBoxCornerAngles(),this._sinAngle=0,this._cosAngle=1,this._dimensions=this._modules.dom.getDimensions()}clone(e){const s=new Zv(this._ogma);return s._zoom=e.zoom||this._zoom,s._x=e.x||this._x,s._y=e.y||this._y,s._angle=e.angle||this._angle,s._sinAngle=Math.sin(s._angle),s._cosAngle=Math.cos(s._angle),s.calculateBoxCornerAngles(),s._dimensions={width:e.width||this._dimensions.width,height:e.height||this._dimensions.height},s}};function ep({x:t,y:e},s,i,n){return{x:n*(t/=s)-i*(e/=s),y:i*t+n*e}}function sp(t){return typeof t=="number"&&isFinite(t)}function gN(t){const e=t.filter((s=>isFinite(s)&&s>0));return e.length?wi(e):1}var mN="anonymous",fN="white",pN="default",_N={maxBlockId:1024,maxCoord:-1/0,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1,maxSymbolicSize:0,maxPatternScale:0},yN=md?"webgl":null,ip=5,xN=class extends te{constructor(){super(...arguments),this._debug=!1,this._initDone=!1,this._boundaries={maxSize:10,maxMinVisibleSize:64},this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0},this._nextAnimationId=1,this._animations=[],this._rendererState={type:null,code:null,state:"ok",message:""},this._cursorStyle=[],this._fontsNewlyLoaded=[],this._nextGeIndex=1,this._availableGeIndexes=[],this._renderOnNewFrame=!0,this._isBufferDisplayable=t=>{const e=HL(t),s=fb(t),i=e?this._visibility.nodes:this._visibility.edges,n=e?this._visibility.nodeTexts:this._visibility.edgeTexts;return i===0&&(!s||n===0)},this._onRendererChange=t=>{this._updateRendererState({type:t,state:"requested",code:null,message:void 0}),this._engine.setRenderType(t),this._modules.dom.refresh()},this._onNewFrame=()=>{this._processAnimations(),this._loadGraphInGraphicsEngine(),this._renderOnNewFrame&&this._render()},this._applyCursorStyle=()=>{const t=this._cursorStyle[this._cursorStyle.length-1]||this._modules.settings.get("cursor.default");Vl(this._domWrapper,t)},this._updateImageCrossOrigin=()=>{this._imageManager.setImgCrossOrigin(this._modules.settings.get("imgCrossOrigin")||null)}}onMounted(){this._debug=this._ogma.isDebug(),this._renderOnNewFrame=!0,this._formatText=O0().applyArabicShaping,this._attributesManager=new QM(this._ogma,this._modules),this._imageManager=new UI,this._fontManager=new JC,this._engine=new uh(uh.getCachedInitData()),this._domWrapper=this._engine.getDomWrapper(),this._engine.on("error",this._onNewFrame),this._nodeAnimationMap=new Map,this._edgeAnimationMap=new Map,this._movingNodes=new Set,this._movingEdges=new Set,this._modules.events.register(["reloadFonts","rendererStateChange","beforeUpdateAttributes","updateAttributes","animate","move","pan","zoom","rotate","viewExportStart","viewExportEnd","afterImageExport","viewChanged","zoomStart"]),this._modules.settings.register("renderer",yN,this._onRendererChange),this._modules.settings.register("edgeTipRatio",m0,(t=>{this._engine.setEdgeArrowSizeRatio(t),this._modules.dom.refresh()})),this._modules.settings.register("nodeCornerRadius",0,(t=>{kI(this._engine,t),this._modules.dom.refresh()})),this._modules.settings.register("edgeMinTipSize",f0,(t=>{this._engine.setEdgeMinTipSize(t),this._modules.dom.refresh()})),this._modules.settings.register("backgroundColor",fN,(t=>{this._engine.parseColor(t)?this._modules.dom.refresh():(tn(`Invalid background color "${t}" specified; will default to black.`),this._modules.settings.set("backgroundColor","black"))})),this._modules.settings.register("texts.hideUntilFontsLoaded",!0,(t=>{this._fontManager.setHideUntilFontsLoaded(!!t)})),this._modules.settings.register("texts.cornerRadius",ip,(t=>{this._engine.getTextManager().setCornerRadius(typeof t=="number"?t:ip),this._modules.dom.refresh()})),this._modules.settings.register("imgCrossOrigin",mN,this._updateImageCrossOrigin),this._modules.settings.register("cursor.default",pN,this._applyCursorStyle),this._modules.dom.setLayer("graphics",this._domWrapper),this._engine.setGlobalBoundaries(_N),this._modules.dom.beforeNextFrame().then((()=>{this._initDone=!0,this._fireRendererStateChangeEvent()})),this._imageManager.onFetch((()=>{this._engine.notifyPatternUpdate(),this._modules.dom.refresh()})),this._fontManager.onFontLoaded((t=>{this._fontsNewlyLoaded.push(t),this._engine.notifyPatternUpdate(),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()})),this._modules.dom.addMediaListener("(min-resolution: 2dppx)",(()=>this._modules.dom.refresh())),this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${cu})`,tag:cu,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${gu})`,tag:gu,nodeDependencies:void 0,edgeDependencies:void 0}),Hf(this._engine,this._attributesManager.getFlexArrays()),this._modules.events.on("move",(()=>this._modules.dom.refresh())).on("frame",this._onNewFrame).on("viewExportStart",(()=>{this._renderOnNewFrame=!1})).on("viewExportEnd",(()=>{this._renderOnNewFrame=!0})).on("clearGraph",(()=>{this._nextGeIndex=1,this._availableGeIndexes=[],this._engine.clear(),this._attributesManager.clear(),this._modules.dom.refresh(),this._animations=[],this._nodeAnimationMap.clear(),this._edgeAnimationMap.clear()})).on("viewChanged",(({type:t})=>{if(t==="rotate"){const e=this._modules.graph.getEdges().filter((s=>s.getAttribute("adjustAnchors")));this._attributesManager.redrawElements(e)}})).on("addNodes",(t=>{this._attributesManager.updateForAllAttributeLayers(t.nodes)})).on("addEdges",(t=>{this._attributesManager.updateForAllAttributeLayers(t.edges)})).on("excludedStateChange",(t=>{this._visibleAttributeLayer.updateElements(t.elements)})).on("setData",(t=>{this._dataAttributeLayer.updateElements(t.elements)})),uh.clearCachedInitData(),this._modules.dom.addWindowEventListener("unload",(()=>this.destroy()))}onReady(t){t.renderer!==void 0&&this._ogma.setOptions({renderer:t.renderer}),t.imgCrossOrigin!==void 0&&this._ogma.setOptions({imgCrossOrigin:t.imgCrossOrigin})}getTransparentBackgroundColor(){const t=this._modules.settings.get("backgroundColor");return t?this._engine.transparentify(t):null}pauseRendering(){this._renderOnNewFrame=!1}resumeRendering(){this._renderOnNewFrame=!0}_render(){const t=this._modules.dom.getDimensions(),e=this._modules.camera.getView(),s=Ns(),i=ps(),n=this._modules.settings.get("backgroundColor"),r=this._isBufferDisplayable;this._engine.setView({x:e.x,y:e.y,zoom:e.zoom,angle:e.angle,width:t.width,height:t.height,pixelRatio:s,currentTime:i,backgroundColor:n,isBufferDisplayable:r});try{this._engine.render(),this._rendererState.state==="requested"&&this._updateRendererState({state:"ok"})}catch(o){if(this._debug)throw o;const{message:a,code:l="OTHER"}=o,d=this._rendererState.type,h=tC(d),u=`Error while initializing the ${h} renderer`,c=`The ${h} renderer encountered an unexpected runtime error`;let g=this._rendererState.state==="requested"?u:c,m=null;d==="webgl"&&(g+="; fallbacking on canvas renderer",m="canvas"),tn(a||""),tn(g),this._updateRendererState({state:"error",code:l,message:a}),this._modules.settings.set("renderer",m)}}_fireRendererStateChangeEvent(){const t=this._rendererState;this._modules.events.fire("rendererStateChange",{type:t.type,state:t.state,code:t.code,message:t.message})}_updateRendererState({type:t,state:e,code:s,message:i}){let n=!1;t!==void 0&&this._rendererState.type!==t&&(this._rendererState.type=t,n=!0),e!==void 0&&this._rendererState.state!==e&&(this._rendererState.state=e,n=!0),s!==void 0&&this._rendererState.code!==s&&(this._rendererState.code=s,n=!0),i!==void 0&&this._rendererState.message!==i&&(this._rendererState.message=i,n=!0),n&&this._initDone&&this._fireRendererStateChangeEvent()}getImageData(){return this._modules.dom.afterNextFrame().then((()=>this._engine.getImageData()))}getNodeAttributes(){return this._attributesManager.getFlexArrays().nodes.current}getEdgeAttributes(){return this._attributesManager.getFlexArrays().edges.current}getGraphicsEngine(){return this._engine}getImageManager(){return this._imageManager}getFontManager(){return this._fontManager}allocateGraphicsEngineBlockId(){return this._availableGeIndexes.length?this._availableGeIndexes.pop():this._nextGeIndex++*Td+h2}releaseGraphicsEngineBlockId(t){this._engine.freeBlock(t),this._availableGeIndexes.push(t),this._modules.dom.refresh()}addCursorStyle(t){t&&(this._cursorStyle.push(t),this._applyCursorStyle())}removeCursorStyle(t){if(!t)return;const e=this._cursorStyle.lastIndexOf(t);e!==-1&&(this._cursorStyle.splice(e,1),this._applyCursorStyle())}reloadFonts(){this._modules.events.fire("reloadFonts"),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}getDomElement(){return this._domWrapper}setTextHidden(t,e){this._attributesManager.setTextHidden(t,e)}resetTextHidden(){this._attributesManager.resetTextHidden(),this._modules.dom.refresh()}getAttributesManager(){return this._attributesManager}_checkFontsNewlyLoaded(){return!!this._fontsNewlyLoaded.length&&(this._fontsNewlyLoaded=[],!0)}_loadGraphInGraphicsEngine(){this._attributesManager.update(),this._checkFontsNewlyLoaded()&&this._attributesManager.redrawAll(),this._modules.events.fire("beforeUpdateAttributes");const{elementsToRedraw:t,elementsUpdated:e}=this._attributesManager.getUpdatedElements(),s=e.nodes.size>0||e.edges.size>0;(e.nodeAttributesSet.has("radius")||e.edgeAttributes.includes("width"))&&(this._boundaries.maxSize=J2(this._modules.graph)),(e.nodeAttributesSet.has("shape")||e.edgeAttributes.includes("shape.head")||e.edgeAttributes.includes("shape.tail"))&&Hf(this._engine,this._attributesManager.getFlexArrays()),LI({graph:this._modules.graph,elements:t,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._modules.camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText}),s&&this._modules.events.fire("updateAttributes",e)}_forceCompleteGraphRefresh(){this._attributesManager.redrawAll(),this._loadGraphInGraphicsEngine()}export(t,e,s,i){let n;return Promise.all([this._modules.graph.getNodes().addClass(An),this._modules.graph.getEdges().addClass(An)]).then((()=>this.resolveAtNextFrame())).then((()=>this._imageManager.whenReady())).then((()=>{s==="all"?(n=EN(this._modules.graph),this._forceCompleteGraphRefresh()):this._loadGraphInGraphicsEngine();const r=this._modules.camera.clone({...e});return this._modules.events.fire("viewExportStart",{preventOverlap:i.preventOverlap,camera:r,view:r.getView()}),this._ogma.view.afterNextFrame().then((()=>this._engine.export(t,e,i)))})).then((r=>Promise.all([this._modules.graph.getNodes().removeClass(An),this._modules.graph.getEdges().removeClass(An)]).then((()=>r)))).then((r=>(s==="all"&&(AN(n),this._forceCompleteGraphRefresh()),this._modules.events.fire("viewExportEnd"),r)))}addAttributeLayer(t){return this._attributesManager.addAttributeLayer(t)}getAttributeValues(t,e,s,i){return this._attributesManager.getAttributeValues(t,e,s,i)}forceAttributesComputation(){this._attributesManager.update()}resolveAtNextFrame(t){return this._modules.dom.afterNextFrame().then((()=>t))}isMoving(t){return(t.isNode?this._movingNodes:this._movingEdges).has(t._index)}animate(t,e,s,i){const n=bN(i);return n.duration&&this._engine.ensureAnimationsReady(),this._animate(t,e,s,n)}isAnimating(){return this._animations.length>0}getAnimationInformation(t){return this._attributesManager.getAnimationInformation(t)}_toSubGraph(t){if(t instanceof Pi||t instanceof si)return{nodes:t.toList(),edges:t.getAdjacentEdges()};if(t instanceof Un||t instanceof nn)return{nodes:this._modules.graph.nodeList(),edges:t.toList()};const e=t,s={nodes:e.nodes||this._modules.graph.nodeList(),edges:e.edges||this._modules.graph.edgeList()};return s.nodes.size&&(s.edges.size?s.edges=s.edges.concat(s.nodes.getAdjacentEdges()).dedupe():s.edges=s.nodes.getAdjacentEdges()),s}_animate(t,e,s,{duration:i,easing:n}){if((!this._animations.length||s)&&!i)return e(t),Promise.resolve(t);const r=this._toSubGraph(t),o=r.nodes,a=r.edges;if(o.size===0&&a.size===0)return e(t),Promise.resolve(t);if(o.size){if(s)for(let c=0;c<o._indexes.length;c++)this._movingNodes.add(o._indexes[c]);this._modules.events.fire("animate",{elements:o,duration:i,updatesPositions:s,easing:n})}if(a.size){if(s)for(let c=0;c<a._indexes.length;c++)this._movingEdges.add(a._indexes[c]);this._modules.events.fire("animate",{elements:a,duration:i,updatesPositions:s,easing:n})}const l={id:this._nextAnimationId++,startTime:ps(),finished:!1,func:()=>e(t),duration:i,easing:n,nodes:o,edges:a,started:!1,updatesPositions:s,resolve:ae};let d=l;const h=new Set;if(d=this._getLongestAnimation(d,l.nodes,h),d=this._getLongestAnimation(d,l.edges,h),d.updatesPositions){for(let c=0;c<o._indexes.length;c++)this._nodeAnimationMap.set(o._indexes[c],d);for(let c=0;c<a._indexes.length;c++)this._edgeAnimationMap.set(a._indexes[c],d);l.duration=d.duration,l.startTime=d.startTime}if(l.duration===0&&d.id===l.id)return e(t),Promise.resolve(t);const u=new Promise((c=>l.resolve=()=>c(t)));return this._animations.push(l),this._modules.dom.refresh(),i||this._processAnimations(),u}_removeFinishedAnimations(){this._animations=this._animations.filter((t=>!t.finished))}_getAnimationElements(t){return{nodes:t.nodes,edges:t.edges}}_resetAnimationAttributes({nodes:t,edges:e}){this._attributesManager.resetAnimationAttributes({nodes:t,edges:e});for(let s=0;s<t._indexes.length;s++)this._nodeAnimationMap.delete(t._indexes[s]),this._movingNodes.delete(t._indexes[s]);for(let s=0;s<e._indexes.length;s++)this._edgeAnimationMap.delete(e._indexes[s]),this._movingEdges.delete(t._indexes[s])}_getLongestAnimation(t,e,s){const i=e.isNode?this._nodeAnimationMap:this._edgeAnimationMap;for(let n=0;n<e._indexes.length;n++){const r=i.get(e._indexes[n]);r&&!s.has(r.id)&&(s.add(r.id),(t.updatesPositions||!r.updatesPositions)&&r.duration+r.startTime<t.duration+t.startTime||(t=r))}return t}_processAnimations(){if(!this._animations.length)return;const t=ps(),e=[];this._attributesManager.update();for(const s of this._animations)s.started||(s.started=!0,e.push(s.func),this._attributesManager.setAnimationAttributes(this._getAnimationElements(s),s));for(const s of e)s();for(const s of this._animations)t>=s.startTime+s.duration&&(this._resetAnimationAttributes(this._getAnimationElements(s)),s.resolve(s.elements),s.finished=!0);this._removeFinishedAnimations(),this._animations.length&&this._modules.dom.refresh()}hideTexts(){this.setNodeTextsVisibility(!1),this.setEdgeTextsVisibility(!1)}showTexts(){this.setNodeTextsVisibility(!0),this.setEdgeTextsVisibility(!0)}setNodesVisibility(t){return this._updateVisibilityCounter("nodes",t)}setNodeTextsVisibility(t){return this._updateVisibilityCounter("nodeTexts",t)}setEdgesVisibility(t){return this._updateVisibilityCounter("edges",t)}setEdgeTextsVisibility(t){return this._updateVisibilityCounter("edgeTexts",t)}_updateVisibilityCounter(t,e){this._visibility[t]+=e?-1:1,this._modules.dom.refresh()}detectNode(t,e,s,i,n,r){return K2(t,e,s,i,n,r,this._modules.graph,this._attributesManager,this._modules.camera,this._engine,this._movingNodes,this._formatText)}detectEdge(t,e,s,i,n){const{bentEnable:r,bentVertical:o}=this._modules.graphics.getGraphicsEngine().getBentEdges();return Q2(t,e,s,i,n,this._modules.graph,this._modules.camera,this._movingNodes,this._attributesManager,r,o)}getVisibilityCounters(){return this._visibility}destroy(){this.getGraphicsEngine().destroy(),this.getImageManager().destroy(),this.getFontManager().destroy()}};function bN(t){return typeof t=="number"?t={duration:t}:typeof t=="object"&&t!==null||(t={duration:0}),{duration:vN(t.duration),easing:t.easing||"linear",chain:!!t.chain}}function vN(t){return typeof t!="number"||!isFinite(t)||t<0?0:t}function np(t,e){const s=e?t.getNodeAttribute("excluded"):t.getEdgeAttribute("excluded"),i=(e?t.getNodes("all"):t.getEdges("all"))._indexes,n=s.getMultiple(i);return s.fill(i,0),{excludedList:s,indexes:i,values:n}}function rp({excludedList:t,indexes:e,values:s}){t.setMultiple(e,s)}function EN(t){return{nodes:np(t,!0),edges:np(t,!1)}}function AN({nodes:t,edges:e}){rp(t),rp(e)}var SN=180,wN=50,TN=class extends te{constructor(){super(...arguments),this._onAnyEvents=[],this._registeredEvents={},this.onIdle=Ro((()=>this.fire("idle")),wN),this.fireIdle=wy(this.onIdle,SN)}onMounted(){this._registeredEvents={},this.register(["idle"]),this._ogma.onReady((()=>{this.on(["viewChanged","layoutEnd","addNodes","addEdges","removeNodes","removeEdges","animate","setMultipleAttributes","transformationRefresh"],this.fireIdle)}))}isRegistered(t){return!!this._registeredEvents[t]}register(t,e=[]){t.forEach((s=>{this._registeredEvents[s]||(this._registeredEvents[s]=new CN(!1,s))}))}onAnyEvent(t){this._onAnyEvents.push(t)}on(t,e){return Array.isArray(t)?(t.forEach((s=>this.on(s,e))),this):this._registeredEvents[t]?(this._registeredEvents[t].on(e),this):this}off(t){return Object.values(this._registeredEvents).forEach((e=>e.off(t))),this}fire(t,e=null){const s=this._getEvent(t);return this._onAnyEvents.forEach((i=>i(e,t))),s.trigger(e),this}once(t,e){return Array.isArray(t)?(t.forEach((s=>this.once(s,e))),this):this._registeredEvents[t]?(this._registeredEvents[t].once(e),this):this}_getEvent(t){if(!(t in this._registeredEvents))throw new Error(`Event ${t} does not exist`);return this._registeredEvents[t]}destroy(){Object.values(this._registeredEvents).forEach((t=>{t.destroy()}))}},CN=class{constructor(t,e){this._subscribers=[],this._handlers=[],this._onceWrappers=new WeakMap,this._reverseOrder=t,this._name=e}trigger(t){for(const e of this._handlers)e(t,this._name);return this}on(t){if(typeof t!="function")throw new Error("handler is not a function");const e=this._reverseOrder?0:this._subscribers.length;return this._handlers.splice(e,0,t),this._subscribers.splice(e,0,t),this}once(t){if(typeof t!="function")throw new Error("handler is not a function");const e=this,s=function(){t.apply(null,arguments),e.off(s)};return this._onceWrappers.set(t,s),this.on(s),this}off(t){const e=this._onceWrappers.get(t),s=e||t;let i;for(;(i=this._subscribers.indexOf(s))!==-1;)this._subscribers.splice(i,1),this._handlers.splice(i,1);return e&&this._onceWrappers.delete(t),this}destroy(){this._subscribers=[],this._handlers=[]}},LN=class extends te{onMounted(){this._graphics=this._modules.graphics,this._modules.events.register(["setMultipleAttributes"]),this._modules.events.on(["addNodes","addEdges"],(({nodes:t,edges:e,objects:s})=>{this._onAddElements(t||e,s)})),this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:AT,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:TT,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0})}_onAddElements(t,e){const s=e.map((i=>i.attributes));this._originalAttributesLayer.setAttributeValues(t,s)}getOriginalAttributes(){return this._originalAttributesLayer.getFlexArrays()}getIndividualAttributes(){return this._individualAttributesLayer.getFlexArrays()}setMultipleAttributes(t,e,s){const i=Array.isArray(e)?e.length&&e[0]?sd(e[0],t.isNode):[]:sd(e,t.isNode),n=i.includes("x")||i.includes("y"),r=[];return this._modules.events.fire("setMultipleAttributes",{elements:t,values:e,updatedAttributes:i,options:s,promises:r}),this._graphics.animate(t,(()=>{this._individualAttributesLayer.setAttributeValues(t,e)}),n,s).then((o=>Promise.all(r).then((()=>o))))}setSingleAttribute(t,e,s,i){const n={};return Li(n,e,s),this.setMultipleAttributes(t,n,i)}resetMultipleAttributes(t,e,s){const i=e||this._individualAttributesLayer.getUsedAttributeNames(t),n=i&&(i.includes("x")||i.includes("y")),r={};for(const o of i)Li(r,o,void 0);return this._graphics.animate(t,(()=>{this._individualAttributesLayer.setAttributeValues(t,r)}),n,s)}getMultipleAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!1)}getSingleAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!1)}replaceOriginalAttributes(t,e,s=[]){const i={},n=this._originalAttributesLayer.getUsedAttributeNames(t).filter((r=>!s.includes(r)));for(let r=0;r<n.length;++r)Li(i,n[r],void 0);this._originalAttributesLayer.setAttributeValues(t,i),this._originalAttributesLayer.setAttributeValues(t,e)}getSinglePreviousAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!0)}getMultiplePreviousAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!0)}},IN=class extends te{constructor(){super(...arguments),this._currentValue={},this._onChange={},this._defaultValues={},this._keys=[]}onReady(t){t.renderer&&this.update({renderer:t.renderer}),t.options&&this.update(t.options)}register(t,e,s,i){return i===void 0&&(i=!0),this._keys.push(t),this._currentValue[t]=e,this._defaultValues[t]=e,this._onChange[t]=s||ae,s&&i&&s(e),this}update(t){t=Fo(t);const e=this._keys,s={},i=this._currentValue;for(let r=0;r<e.length;++r){const o=e[r];if(o in t){let a=t[o];a===void 0&&(a=this._defaultValues[o]),s[o]=i[o],i[o]=a}}const n=Object.keys(s);for(let r=0;r<n.length;++r){const o=n[r],a=this._currentValue[o],l=s[o];a!==l&&this._onChange[o](a,l)}return Wh(s)}get(t){return arguments.length===0?Wh(this._currentValue):this._currentValue[t]}set(t,e){const s=this._currentValue[t],i=this._onChange[t];this._currentValue[t]=e,i&&i(e,s)}},MN=class{constructor(t,e){this._classes=t,this._name=e}getName(){return this._name}getIndex(){return this._classes.getIndex(this._name)}setIndex(t){return this._classes.setIndex(this._name,t)}update(t){return this._classes.update(this._name,t),this}getDefinition(){return this._classes.getDefinition(this._name)}getNodes(t){return this._classes.getElementsByClass(this._name,t).nodes}getEdges(t){return this._classes.getElementsByClass(this._name,t).edges}clearNodes(t){this.getNodes(t).removeClass(this._name)}clearEdges(t){this.getEdges(t).removeClass(this._name)}add(t){t.addClass(this._name)}remove(t){t.removeClass(this._name)}destroy(){const t=this._classes.getElementsByClass(this._name);return Promise.all([t.nodes.removeClass(this._name),t.edges.removeClass(this._name)]).then((()=>this._classes.removeClass(this._name)))}},NN=1e3,RN=.5/NN,FN=class extends te{constructor(){super(...arguments),this._builtinClasses=[],this._userClasses=[],this._classesByName={},this._onExcludedStateChange=({elements:t,value:e})=>{if(e){const s=this._builtinClasses.map((i=>i.name));this._addOrRemoveClassesToElements(s,t,!1)}},this._onClearGraph=()=>{this._builtinClasses.concat(this._userClasses).forEach((t=>t.elementSet.clear()))},this._onRemoveElements=({nodes:t,edges:e})=>{const s=t||e;this._builtinClasses.concat(this._userClasses).forEach((i=>i.elementSet.removeElements(s)))}}onMounted(){this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on("clearGraph",this._onClearGraph).on("removeEdges",this._onRemoveElements).on("removeNodes",this._onRemoveElements)}_getClassList(t){return t?this._builtinClasses:this._userClasses}createClass({name:t,isBuiltin:e=!1,after:s,nodeAttributes:i,nodeDependencies:n,nodeOutput:r,edgeAttributes:o,edgeDependencies:a,edgeOutput:l}={}){if(typeof t!="string")throw new Error('the "name" argument should be a string');const d=this._getClassList(e),h=s?PN(d,s)+1:d.length;if(h===-1)throw new Error(`createClass: class specified as \`after\` parameter "${s}" does not exist`);if(e&&!t.startsWith("_"))throw new Error(`invalid builtin class name "${t}": builtin classes should start with '_'`);const u=new ca(this._modules.graph),c=new MN(this,t),g={name:t,elementSet:u,attributeLayer:this._modules.graphics.addAttributeLayer({name:`class(${t})`,tag:t,standaloneSelectors:!0,nodeAttributes:i||void 0,edgeAttributes:o||void 0,nodeSelector:(m,f)=>f.hasElement(m),edgeSelector:(m,f)=>f.hasElement(m),nodeContext:u,edgeContext:u,nodeOutput:r,edgeOutput:l,nodeDependencies:n,edgeDependencies:a}),isBuiltin:e,wrapper:c};return d.splice(h,0,g),e&&d.sort(((m,f)=>Fm.indexOf(m.name)-Fm.indexOf(f.name))),this._updatePriorities(e),this._classesByName[t]=g,this._modules.events.register([$n(t,!0,!0),$n(t,!0,!1),$n(t,!1,!0),$n(t,!1,!1)]),c}removeClass(t){const e=this._get(t),s=this._getClassList(e.isBuiltin),i=s.indexOf(e);return i!==-1&&(s.splice(i,1),e.attributeLayer.destroy(),delete this._classesByName[t],this._updatePriorities(e.isBuiltin)),Promise.resolve(void 0)}_updatePriorities(t){const e=this._getClassList(t),s=CT+(t?.5:0);for(let i=0;i<e.length;++i){const n=e[i],r=s+RN*i;n.attributeLayer.update({priority:r})}}_get(t){const e=this._classesByName[t];if(!e)throw new Error(`class "${t}" does not exist`);return e}getIndex(t){const e=this._get(t);return this._getClassList(e.isBuiltin).indexOf(e)}setIndex(t,e){const s=this._get(t),i=this._getClassList(s.isBuiltin),n=i.indexOf(s),r=Ws(e,0,i.length-1);i.splice(n,1),i.splice(r,0,s),this._updatePriorities(s.isBuiltin)}update(t,{nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a}={}){this._get(t).attributeLayer.update({nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a})}getDefinition(t){const e=this._get(t),{nodeAttributes:s,nodeDependencies:i,nodeOutput:n,edgeAttributes:r,edgeDependencies:o,edgeOutput:a}=e.attributeLayer.getDefinition();return{nodeAttributes:s||void 0,edgeAttributes:r||void 0,nodeDependencies:i,edgeDependencies:o,nodeOutput:n,edgeOutput:a}}_addOrRemoveClassesToElements(t,e,s){const i=e.isNode;for(let n=0;n<t.length;++n){const r=t[n],{elementSet:o,attributeLayer:a}=this._get(r),l=o.addOrRemoveElements(e,s),d=$n(r,i,s);l.size&&(a.updateElements(l),this._modules.events.fire(d,i?{nodes:l}:{edges:l}))}}_animatedAttributesUpdatePositions(t,e){for(let s=0;s<t.length;++s){const i=t[s],n=this.getDefinition(i);if(e.isNode&&n.nodeAttributes&&(n.nodeAttributes.x||n.nodeAttributes.y))return!0}return!1}_getAnimatedAtrributes(t,e){return t.reduce(((s,i)=>{const n=this.getDefinition(i);return e.isNode&&n.nodeAttributes&&s.push(...sd(n.nodeAttributes,!0)),!e.isNode&&n.edgeAttributes&&s.push(...sd(n.edgeAttributes,!1)),s}),[])}addClassesToElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,(()=>{this._addOrRemoveClassesToElements(t,i,!0)}),n,s)}removeClassesFromElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,(()=>{this._addOrRemoveClassesToElements(t,i,!1)}),n,s)}hasSingleElementClass(t,e){return!!this._classesByName[t]&&this._get(t).elementSet.hasElement(e)}getElementsClassList(t,e={}){const{includeBuiltinClasses:s=!1}=e,i=new Array(t.size);for(let n=0;n<i.length;++n)i[n]=[];return this._addClassNamesToList(i,t,this._userClasses),s&&this._addClassNamesToList(i,t,this._builtinClasses),i}_addClassNamesToList(t,e,s){const i=e.toList();for(let n=0;n<s.length;++n){const{name:r,elementSet:o}=s[n];for(let a=0;a<i.size;++a){const l=i.get(a);o.hasElement(l)&&t[a].push(r)}}}getClassByName(t,e=!1){const s=this._classesByName[t]||null;if(e&&!s)throw new Error(`class "${t}" does not exist`);return s&&s.wrapper}getClassList(){return this._userClasses.map((t=>t.wrapper))}getElementsByClass(t,e="visible"){const{elementSet:s}=this._get(t),i=s.getElements();let n=i.nodes,r=i.edges;return e==="visible"?(n=n.filter((o=>o.isVisible())),r=r.filter((o=>o.isVisible()))):e==="raw"&&(n=n.filter((o=>!o.isVirtual())),r=r.filter((o=>!o.isVirtual()))),{nodes:n,edges:r}}_onClassEvent(t,e,s,i){const n=$n(t,s,i);this._modules.events.on(n,e)}onNodeClassAdded(t,e){this._onClassEvent(t,e,!0,!0)}onNodeClassRemoved(t,e){this._onClassEvent(t,e,!0,!1)}onEdgeClassAdded(t,e){this._onClassEvent(t,e,!1,!0)}onEdgeClassRemoved(t,e){this._onClassEvent(t,e,!1,!1)}};function $n(t,e,s){return`${e?"node":"edge"}Class${s?"Added":"Removed"}_${t}`}function PN(t,e){for(let s=0;s<t.length;++s)if(t[s].name===e)return s;return-1}var zN=vy(Ey()),Kv=()=>({x:0,y:0,x1:0,y1:0,x2:0,y2:0});function op(t,e,s,{cells:i=!0,boxes:n=!0,query:r=!0}={}){const o=e.keys().map((l=>e.keyToBBox(Number(l)))),a=e.getBoxes();if(i&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#707070",o.forEach((l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])})),t.stroke()),n&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#ff7070",a.forEach((l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])})),t.closePath(),t.stroke()),r&&s){const l=s;t.beginPath(),t.lineWidth=2,t.strokeStyle="#3030ff",t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1]),t.closePath(),t.stroke()}}function DN(t){const[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o]=t.getEdgeAttributes(["source","target","curvature"]),a=Kv(),l=sg();return d=>{if(d<0){d=-d;const h=n.get(d),u=r.get(d),c=o.get(d),g=e.get(h),m=s.get(h),f=e.get(u),p=s.get(u);h===u?(Ld(g,m,c,i.get(h),0,a),Nd(g,m,a.x1,a.y1,a.x2,a.y2,f,p,l)):c===0?(l.minX=Math.min(g,f),l.minY=Math.min(m,p),l.maxX=Math.max(g,f),l.maxY=Math.max(m,p)):(Gn(g,m,f,p,c,a),ng(g,m,a.x,a.y,f,p,l))}else{const h=e.get(d),u=s.get(d),c=i.get(d);l.minX=h-c,l.minY=u-c,l.maxX=h+c,l.maxY=u+c}return[l.minX,l.minY,l.maxX,l.maxY]}}var kN=["x","y","radius"],ON=["width","curvature"],BN=.5,ap=1,lp=128,dp=4,hp=16,UN=1e4,GN=class extends te{constructor(){super(...arguments),this._minCellSize=hp,this._clear=()=>{this._index.clear(),this._elementsToUpdate.clear()},this._onGraphUpdate=t=>{if(t.nodes&&(!t.nodeAttributes||t.nodeAttributes.some((e=>kN.includes(e))))){const e=t.nodes.fastGetAdjacentElements().edges;this._elementsToUpdate.addElements(t.nodes),this._elementsToUpdate.addElements(e)}t.edges&&(t.edgeAttributes&&!t.edgeAttributes.some((e=>ON.includes(e)))||this._elementsToUpdate.addElements(t.edges))}}onMounted(){this._index=new zN.HGrid(this._getIntersector(),DN(this._modules.graph),this._minCellSize,1e6),this._elementsToUpdate=new ca(this._modules.graph),this._removedNodes=this._modules.graph.getNodeAttribute("removed"),this._removedEdges=this._modules.graph.getEdgeAttribute("removed"),this._excludedNodes=this._modules.graph.getNodeAttribute("excluded"),this._excludedEdges=this._modules.graph.getEdgeAttribute("excluded"),this._queryResult={edges:[],nodes:[]},this._queryBounds=[0,0,0,0],this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges","updateAttributes"],this._onGraphUpdate).on("excludedStateChange",(({elements:t})=>{this._elementsToUpdate.addElements(t)})).on("clearGraph",this._clear)}_getIntersector(){const t=this._modules.graph,[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o,a]=t.getEdgeAttributes(["source","target","width","curvature"]),l=Kv(),d=this._modules.camera.getAngle(),h=Math.cos(d),u=Math.sin(d);return(c,g,m,f,p)=>{const{bentEnable:_,bentVertical:x}=this._modules.graphics.getGraphicsEngine().getBentEdges();if(c<0){c=-c;const y=n.get(c),b=r.get(c),v=a.get(c),A=o.get(c)/2,S=e.get(y),w=s.get(y),I=e.get(b),M=s.get(b);return _?(Id(S*h-w*u,w*h+S*u,I*h-M*u,M*h+I*u,v,_,x,l),Cu(S,w,l.x1*h+l.y1*u,l.y1*h-l.x1*u,l.x2*h+l.y2*u,l.y2*h-l.x2*u,I,M,g-A,m-A,f+A,p+A)):y===b?(Ld(S,w,v,i.get(y),0,l),Cu(S,w,l.x1,l.y1,l.x2,l.y2,I,M,g-A,m-A,f+A,p+A)):v===0?rg(S,w,I,M,g-A,m-A,f+A,p+A):(Gn(S,w,I,M,v,l),V0(S,w,l.x,l.y,I,M,g-A,m-A,f+A,p+A))}return Uc(e.get(c),s.get(c),i.get(c),g,m,f,p)}}reindex(){this._modules.graphics.forceAttributesComputation(),this._index.clear(),this._elementsToUpdate.clear(),this._updateItems(this._modules.graph.getNodes("all")._indexes,this._modules.graph.getEdges("all")._indexes)}getSize(){return this._index.size}_updateIndex(){if(this._elementsToUpdate.isEmpty())return;const{nodes:t,edges:e}=this._elementsToUpdate.getElements(),s=t._indexes.length,i=this._modules.graph.getNodes("all").size;let n=!1;if(this._index.averageCellOccupancy<ap)for(;this._index.averageCellOccupancy<ap&&this._minCellSize<UN;)this._minCellSize=this._minCellSize*dp,this._index.setMinCellSize(this._minCellSize),this.reindex(),n=!0;if(!n&&this._index.averageCellOccupancy>lp)for(;this._index.averageCellOccupancy>lp&&this._minCellSize>hp;)this._minCellSize=this._minCellSize/dp,this._index.setMinCellSize(this._minCellSize),this.reindex(),n=!0;!n&&s/i>BN&&this.reindex(),this._updateItems(t._indexes,e._indexes),this._elementsToUpdate.clear()}_updateItems(t,e){const s=this._index,i=this._removedNodes,n=this._removedEdges,r=this._excludedNodes,o=this._excludedEdges,a=[],l=[];if(i&&r)for(let d=0;d<t.length;d++){const h=t[d];i.get(h)!==0||r.get(h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}if(n&&o)for(let d=0;d<e.length;d++){const h=-e[d];n.get(-h)!==0||o.get(-h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}for(const d of a)s.remove(d);for(const d of l)s.insert(d)}getNodesInScreenByDistance(t){const{x:e,y:s}=t.getPositionOnScreen();return this._modules.graph.getNodes().filter((i=>i.isInScreen()&&i!==t)).sort(((i,n)=>{const r=i.getPositionOnScreen(),o=n.getPositionOnScreen();return Ze(r.x,r.y,e,s)-Ze(o.x,o.y,e,s)}))}getNearestNodesForNode(t,e=240,s){const{x:i,y:n}=t.getPosition();return this.getNearestNodes(i,n,e,s,t)}getNearestNodes(t,e,s,i,n){if(this._updateIndex(),i){const r=this._modules.camera.screenToGraphVector({x:s,y:s});s=Ze(0,0,r.x,r.y)}return this._getNearestNodes(t,e,s,n)}_getNearestNodes(t,e,s,i){const n=[],r=s*s,o=i?i._index:0,a=this._modules.graph.getNodes()._indexes,[l,d]=this._modules.graph.getNodeAttributes(["x","y"]);for(let h=0,u=a.length;h<u;h++){const c=a[h];if(c===o)continue;const g=t-l.get(c),m=e-d.get(c);g*g+m*m<=r&&n.push(c)}return this._modules.graph.nodeList(new Uint32Array(n))}queryRaw(t,e,s,i){this._updateIndex();const n=this._queryBounds;n[0]=t,n[1]=e,n[2]=s,n[3]=i;const r=this._index.query(t,e,s,i),{nodes:o,edges:a}=this._queryResult;o.length=a.length=0;for(let l=0;l<r.length;l++){const d=r[l];d<0?a.push(-d):o.push(d)}return this._queryResult}queryRawProjected(t,e,s,i){const n=this._queryBounds;n[0]=t,n[1]=e,n[2]=s,n[3]=i,this._modules.camera.projectBounds(n);const r=this.queryRaw(n[0],n[1],n[2],n[3]);return this._modules.labels.query(n[0],n[1],n[2],n[3],r),r}query(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRaw(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r.slice())),edges:n.edgeList(new Uint32Array(o.slice()))}}queryProjected(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRawProjected(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r)),edges:n.edgeList(new Uint32Array(o))}}getNodesByBoundingBox(t,e,s,i,n){if(this._updateIndex(),n){let u;u=this._modules.camera.screenToGraphVector({x:t,y:e}),t=u.x,e=u.y,u=this._modules.camera.screenToGraphVector({x:s,y:i}),s=u.x,i=u.y}const r=this._modules.graph,o=r.getNodes()._indexes,a=[],l=r.getNodeAttribute("excluded"),[d,h]=r.getNodeAttributes(["x","y"]);for(let u=0,c=o.length;u<c;u++){const g=o[u];if(l&&l.get(g))continue;const m=d&&d.get(g),f=h&&h.get(g);m>=t&&m<=s&&f>=e&&f<=i&&a.push(g)}return r.nodeList(new Uint32Array(a))}toggleDebug(t){t?(this._layer=this._modules.layers.addCanvasLayer((e=>{op(e,this._index,this._queryBounds)}),{isStatic:!1,noClear:!1}),this._layer.moveToTop()):this._layer&&(this._layer.destroy(),this._layer=null)}renderDebug(t){if(!this._layer)return this.toggleDebug(!0);this._layer.refresh((e=>{op(e,this._index,this._queryBounds,t)}))}},Qv={};function zd(t,e,s,i,n=0,r=Math.sin(n),o=Math.cos(n),a=[0,0,0,0]){const l=s/2,d=i/2,h=t+l,u=e+d;if(n===0)return a[0]=t,a[1]=e,a[2]=t+s,a[3]=e+i,a;let c,g,m,f,p,_,x,y;return m=-l,f=-d,c=h+m*o-f*r,g=u+m*r+f*o,p=x=c,_=y=g,m=-l,f=d,c=h+m*o-f*r,g=u+m*r+f*o,c<p?p=c:c>x&&(x=c),g<_?_=g:g>y&&(y=g),m=l,f=d,c=h+m*o-f*r,g=u+m*r+f*o,c<p?p=c:c>x&&(x=c),g<_?_=g:g>y&&(y=g),m=l,f=-d,c=h+m*o-f*r,g=u+m*r+f*o,c<p?p=c:c>x&&(x=c),g<_?_=g:g>y&&(y=g),a[0]=p,a[1]=_,a[2]=x,a[3]=y,a}function ga(t,e,s,i,n=0){const r=s/2,o=i/2,a=t+r,l=e+o;if(n===0)return[{x:t,y:e},{x:t+s,y:e},{x:t+s,y:e+i},{x:t,y:e+i}];const d=Math.sin(n),h=Math.cos(n);let u,c,g,m;g=-r,m=-o,u=a+g*h-m*d,c=l+g*d+m*h;const f={x:u,y:c};g=-r,m=o,u=a+g*h-m*d,c=l+g*d+m*h;const p={x:u,y:c};g=r,m=o,u=a+g*h-m*d,c=l+g*d+m*h;const _={x:u,y:c};return g=r,m=-o,u=a+g*h-m*d,c=l+g*d+m*h,[f,p,_,{x:u,y:c}]}function Yu(t,e=0,s=1,i=Bx.slice()){const n=s*Math.sin(e),r=s*Math.cos(e);return i[0]=t[0]+n,i[1]=t[1]+r,i[2]=t[2]+n,i[3]=t[3]+r,i}function VN(t,e){return Gx(t,e)}function qN(t,e){return Jv(t[0],t[1],t[2],t[3],e[0],e[1],e[2],e[3])}function HN(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function Jv(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}Jo(Qv,{angle:()=>j2,circleCircleIntersection:()=>Oc,circleContainsCircle:()=>R1,circleContainsPoint:()=>N1,circleIntersectsBox:()=>Uc,circleLineIntersection:()=>Vx,circleSortCompare:()=>Bc,computeCentroid:()=>NI,cubicBezierAABB:()=>Cu,defaultAABB:()=>Bx,degreesToRadians:()=>M1,distToSegmentSquared:()=>og,distance:()=>Ze,distancePointSegment:()=>X0,extendBounds:()=>Gx,getAABB:()=>zd,getBentEdgesControlPoints:()=>Id,getBezierCurveBoundingBox:()=>Nd,getClosestPointOnLine:()=>X2,getClosestPointOnSegment:()=>W0,getNormalOnEdge:()=>G2,getNormalOnQuadraticCurve:()=>q0,getOBBPoints:()=>ga,getPointOnBezierCurve:()=>Uo,getPointOnEdge:()=>U2,getPointOnQuadraticCurve:()=>Md,getQuadraticBezierCurveLength:()=>q2,getQuadraticCurveBoundingBox:()=>ng,getQuadraticCurveControlPoint:()=>Gn,getSelfLoopControlPoints:()=>Ld,getTangentOnEdge:()=>V2,getTangentOnQuadraticCurve:()=>ig,intersects:()=>HN,isPointInLine:()=>j0,isPointInPolygon:()=>Vo,isPointOnBezierCurve:()=>Lu,isPointOnQuadraticCurve:()=>H0,lineAABB:()=>rg,lineAngle:()=>Ir,lineIntersection:()=>Y2,lineLine:()=>gr,minDisk:()=>ra,move:()=>I1,moveAABB:()=>Yu,normalize:()=>Ux,overlaps:()=>Jv,overlapsAABB:()=>qN,padBounds:()=>VN,polygonsIntersect:()=>Eb,quadBezierAABB:()=>V0,radiansToDegrees:()=>hu,rotate:()=>Hl,segmentIntersection:()=>ro,segmentRectangleIntersection:()=>Y0,squaredDistance:()=>yl,twoSegmentsIntersect:()=>H2});var Ja=40;function tE(t,e){const s=t.getAttribute("curvature"),i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen();if(i===n){const f=(s+i.getAttribute("radius"))*Kl*e,p=r.x,_=r.y,x=p-f,y=_,b=p,v=_+f;return[r,...[.2,.4,.6,.8].map((A=>Uo(A,p,_,p,_,x,y,b,v))),r]}const o=n.getPositionOnScreen();if(s===0)return[r,o];const a=o.x-r.x,l=o.y-r.y,d=Math.sqrt(a*a+l*l),h=(r.x+o.x)/2,u=(r.y+o.y)/2,c=s*(d/Ad)*2,g=h+l/d*c,m=u+-a/d*c;return[r,...[.25,.5,.75].map((f=>Md(f,r.x,r.y,o.x,o.y,g,m))),o]}function jN(t,e,s){const i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen(),o=n.getPositionOnScreen();if(Vo(r.x,r.y,e)||Vo(o.x,o.y,e))return!0;const a=tE(t,s);for(let l=0;l<a.length-1;++l){const d=a[l],h=a[l+1];for(let u=0;u<e.length-1;++u){const c=e[u],g=e[u+1];if(gr(d.x,d.y,h.x,h.y,c.x,c.y,g.x,g.y))return!0}}return!1}function YN(t,e,s){const i=t.getPositionOnScreen(),n=Number(t.getAttribute("radius"))*s;return eE(i.x,i.y,n,e)}function eE(t,e,s,i){const n=t-s,r=e-s,o=e+s;return t+s>=i.minX&&n<=i.maxX&&o>=i.minY&&r<=i.maxY}function XN(t,e,s){const i=tE(t,s);for(let n=0;n<i.length-1;++n){const r=i[n],o=i[n+1];if(rg(r.x,r.y,o.x,o.y,e.minX,e.minY,e.maxX,e.maxY))return!0}return!1}function up(t,e,s,i){typeof s=="number"&&(s={left:s,right:s,top:s,bottom:s});const n=s.left===void 0?Ja:s.left,r=s.right===void 0?Ja:s.right,o=s.top===void 0?Ja:s.top,a=s.bottom===void 0?Ja:s.bottom,l=n+r,d=o+a,h=t.width===0?t.maxFixedSize:t.width,u=t.height===0?t.maxFixedSize:t.height,c=gN([(e.width-l)/(h+t.maxScaledSize),(e.height-d)/(u+t.maxScaledSize),(e.width-l-t.maxFixedSize)/h,(e.height-d-t.maxFixedSize)/u,i/t.maxScaledSize||NaN]);return{x:t.cx+(r-n)/(2*c),y:t.cy+(a-o)/(2*c),zoom:c}}var WN="cubicOut",cp=200,$N=class extends te{constructor(){super(...arguments),this._isLocating=!1,this._cacheValid=!0,this._cachedGraphBoundingBox=new Cs,this._onLocateStart=()=>{this._isLocating=!0},this._onLocated=()=>{this._isLocating=!1,this._modules.events.fire("locate")},this._invalidCache=()=>{this._cacheValid=!1}}onMounted(){this._modules.events.register(["locate"]),this._modules.events.on(["addNodes","removeNodes","addEdges","removeEdges","excludedStateChange","clearGraph","updateAttributes"],this._invalidCache)}onReady(){this.locateGraph({},!0)}locateGraph(t,e=!1){return this._onLocateStart(),e?this._locateGraph(t):this._modules.transformations.whenApplied().then((()=>this._locateGraph(t)))}_locateGraph(t){return this._locateBoundingBox(this.getGraphBoundingBox(),t).then(this._onLocated)}locateElements(t,e){return this._modules.transformations.whenApplied().then((()=>this._locateBoundingBox(this.getBoundingBox(t),e))).then(this._onLocated)}locateRawGraph(t,e){return this._onLocateStart(),this._locateBoundingBox(this.getRawGraphBoundingBox(t),e).then(this._onLocated)}isLocating(){return this._isLocating}getGraphBoundingBox(t=!1){if(t){const e=this.getBoundingBox(this._ogma.getNodes(),!0,t),s=this.getBoundingBox(this._ogma.getEdges(),!1,t);return e.extend(s)}return this._cacheValid||this._updateCache(),this._cachedGraphBoundingBox.clone()}forceInvalidCache(){this._invalidCache()}_updateCache(){this._cacheValid=!0,this._cachedGraphBoundingBox=this.getBoundingBox(this._modules.graph.getNodes()).extend(this.getBoundingBox(this._modules.graph.getEdges()))}getBoundingBox(t,e=!1,s=!1,i){let n;if(n=t.isNode?this._getNodesBoundingBox(t.toList(),e):this._getEdgesBoundingBox(t.toList(),i),s){const r=this._ogma.modules.labels.getTextsBoundingBox(t.isNode?t.toList():null,t.isNode?null:t.toList());n=n.extend(r)}return n}_getNodesBoundingBox(t,e=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getNodeAttributes(),i=[],n=[],r=[],o=[];for(let a=0;a<t.size;++a){const l=t._indexes[a];if(s.excluded.get(l)===0){const d=s.x.get(l),h=s.y.get(l),u=s.radius.get(l),c=2*u;s.scalingMethod.get(l)==="scaled"?r.push(c):o.push(c),e?(i.push(d-u,d+u),n.push(h-u,h+u)):(i.push(d),n.push(h))}}return new Cs({xValues:i,yValues:n,scaledSizeValues:r,fixedSizeValues:o})}_getEdgesBoundingBox(t,e=!1){return this._getEdgesBoundingBoxInternal(t._indexes,e)}_getEdgesBoundingBoxInternal(t,e=!1,s,i){this._modules.graphics.forceAttributesComputation();const n=this._modules.graphics.getEdgeAttributes(),r=this._modules.graphics.getNodeAttributes(),o={x1:0,y1:0,x2:0,y2:0},a={x:0,y:0},l={minX:0,minY:0,maxX:0,maxY:0},d=[],h=[],u=[],c=[],g=s||r.x,m=i||r.y;for(let f=0;f<t.length;++f){const p=t[f],_=n.source.get(p),x=n.target.get(p),y=n.curvature.get(p),b=g.get(_),v=m.get(_),A=r.scalingMethod.get(_)==="scaled",S=2*r.radius.get(_),w=g.get(x),I=m.get(x),M=r.scalingMethod.get(x)==="scaled",N=2*r.radius.get(x);A?u.push(S):c.push(S),M?u.push(N):c.push(N),e||y===0?(d.push(b,w),h.push(v,I)):_===x?(ag(b,v,y,S/2,0,o),Nd(b,v,o.x1,o.y1,o.x2,o.y2,w,I,l),d.push(l.minX,l.maxX),h.push(l.minY,l.maxY)):(Rd(b,v,w,I,y,a),ng(b,v,a.x,a.y,w,I,l),d.push(l.minX,l.maxX),h.push(l.minY,l.maxY))}return new Cs({xValues:d,yValues:h,scaledSizeValues:u,fixedSizeValues:c})}getRawGraphBoundingBox(t){const e=t.nodes.length,s=new Array(e),i=new Array(e),n=new Array(e);for(let r=0;r<e;r++){const o=t.nodes[r].attributes||{};s[r]=o.x||0,i[r]=o.y||0,n[r]=o.radius||5}return new Cs({xValues:s,yValues:i,scaledSizeValues:n})}_locateBoundingBox(t,e={}){if(isNaN(t.cx))return Promise.resolve();const{padding:s={},easing:i=WN,duration:n=0,maxNodeSizeOnScreen:r=cp,ignoreZoomLimits:o=!1}=e,a=up(t,this._modules.dom.getDimensions(),s,r),l=a.x,d=a.y,h=a.zoom,u=h/this._modules.camera.getZoom();return this._moveCamera(l,d,h,n,i,u,o)}_moveCamera(t,e,s,i,n,r,o){const a={duration:i,easing:n,ignoreZoomLimits:o},l=this._modules.camera.setCenter({x:t,y:e},a);return r>1.01||r<.99?this._modules.camera.setZoom(s,a):l}computeConfigForBounds(t,e={}){const{padding:s={},maxNodeSizeOnScreen:i=cp}=e;return up(t,this._modules.dom.getDimensions(),s,i)}layoutDataBoundingBox({x:t,y:e,indexes:s}){const i=this._modules.graphics.getNodeAttributes(),n=[],r=[],o=[],a=[],l=new Map,d=new Map;for(let c=0;c<s.length;++c){const g=s[c],m=t[c],f=e[c];l.set(g,m),d.set(g,f);const p=2*i.radius.get(g),_=i.scalingMethod.get(g)==="scaled";n.push(m),r.push(f),_?o.push(p):a.push(p)}const h=this._modules.graph.topology.getAdjacentElements(!1,s,{bothExtremities:!0}),u=this._getEdgesBoundingBoxInternal(h,!1,l,d);return new Cs({xValues:n,yValues:r,scaledSizeValues:o,fixedSizeValues:a}).extend(u)}isEdgeInPolygon(t,e){return jN(t,e,this._modules.camera.getZoom())}isElementInView(t,{margin:e=0}={}){const{width:s,height:i}=this._modules.camera.getSize(),n={minX:-e,minY:-e,maxX:s+e,maxY:i+e};return t.isNode?this.isNodeInRectangle(t,n):this.isEdgeInRectangle(t,n)}isNodeInRectangle(t,e){if(this._modules.geo.isEnabled()){const s=this._modules.geo.getContainerCoord(t);return eE(s.x,s.y,Number(t.getAttribute("radius")),e)}return YN(t,e,this._modules.camera.getZoom())}isNodeInPolygon(t,e){const s=t.getPositionOnScreen();return Vo(s.x,s.y,e)}isEdgeInRectangle(t,e){return XN(t,e,this._modules.camera.getZoom())}},ZN=sn&&typeof navigator<"u"&&"msLaunchUri"in navigator&&Ri&&!("documentMode"in document);function KN(t){return ZN?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/Ns():t.deltaY&&t.deltaMode===1?20*-t.deltaY:t.deltaY&&t.deltaMode===2?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}var QN=6,JN=class extends te{constructor(){super(...arguments),this._px=0,this._py=0,this._pressX=0,this._pressY=0,this._left=!1,this._middle=!1,this._right=!1,this._clickCounter={left:0,middle:0,right:0},this._buttons={left:!1,middle:!1,right:!1},this._skipNextMove=!1,this._onMouseWheel=t=>{this._isEnabled()&&this._isWheelEnabled()&&(!this._disableWheelUntilMouseDown()||this._modules.dom.hasFocus())&&(t.preventDefault(),t.stopPropagation(),this._applyMouseWheelZoom(t))},this._onMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=e-this._px,n=s-this._py;i===0&&n===0||(this._skipNextMove?this._skipNextMove=!1:Ze(e,s,this._pressX,this._pressY)>=QN&&(this._resetClickCounter(),this._modules.events.fire("mousemoveInternal",{x:e,y:s,dx:i,dy:n,domEvent:this._evt})))},this._onDocumentMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._bounds,n=e-this._px,r=s-this._py;(e<0||e>i.width||s<0||s>i.height)&&this._modules.events.fire("documentMouseMove",{x:e,y:s,dx:n,dy:r,domEvent:this._evt})},this._onMouseUp=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._evt;this._buttons[i]=!1,this._clickCounter[this._button]===1?this._modules.events.fire("clickInternal",{button:i,x:e,y:s,domEvent:n}):this._clickCounter[i]>1&&(this._modules.events.fire("doubleclickInternal",{button:i,x:e,y:s,domEvent:n}),this._resetClickCounter(i)),this._modules.events.fire("mouseupInternal",{button:i,x:e,y:s,domEvent:n})},this._onDocumentMouseup=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button;this._buttons[i]=!1;const n=this._modules.dom;this._modules.events.fire("documentMouseUp",{button:i,x:e,y:s,domEvent:this._evt}),n.removeDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.removeDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onMouseDown=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._modules.dom;this._skipNextMove=!0,this._pressX=e,this._pressY=s,this._lastMouseDownTarget=t.target,n.focus(),this._buttons[i]=!0,this._clickCounter[i]+=1;const r=i;this._dbclickTimer=n.setTimeout((()=>{this._resetClickCounter(r,0)}),this._getDoubleClickTimer()),this._modules.events.fire("mousedownInternal",{button:i,x:e,y:s,domEvent:this._evt}),n.addDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.addDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onDrop=t=>{if(!this._isEnabled()||!this._setXY(t))return;t.preventDefault();const{x:e,y:s}=this._modules.camera.screenToGraphCoordinates(this._modules.position);this._modules.events.fire("drop",{domEvent:this._evt,x:e,y:s})}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("mouse.enabled",!0),this._modules.settings.register("mouse.wheelEnabled",!0),this._modules.settings.register("mouse.disableWheelUntilMouseDown",!1),this._modules.settings.register("mouse.doubleClickTimer",500),this._modules.events.register(["mousedownInternal","mouseupInternal","mousemoveInternal","mousewheelInternal","clickInternal","doubleclickInternal","mouseoverInternal","mouseoutInternal","documentMouseUp","documentMouseMove","drop"]),this._modules.dom.afterNextFrame().then((()=>this._initializeListeners()))}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get left(){return this._left}get right(){return this._right}get middle(){return this._middle}_isEnabled(){return this._modules.settings.get("mouse.enabled")}_isWheelEnabled(){return this._modules.settings.get("mouse.wheelEnabled")}_disableWheelUntilMouseDown(){return this._modules.settings.get("mouse.disableWheelUntilMouseDown")}_getDoubleClickTimer(){return this._modules.settings.get("mouse.doubleClickTimer")}_resetClickCounter(t,e=0){t?this._clickCounter[t]=e:(this._clickCounter.left=e,this._clickCounter.middle=e,this._clickCounter.right=e),this._modules.dom.clearTimeout(this._dbclickTimer),this._lastMouseDownTarget=null}_setXY(t){const e=this._domElt.getBoundingClientRect();return this._bounds=e,!!e&&(this._evt=t,this._button=Nc[t.button],this._px=this._modules.position.x,this._py=this._modules.position.y,this._modules.position.x=t.clientX-e.left,this._modules.position.y=t.clientY-e.top,this._left=this._buttons.left,this._right=this._buttons.right,this._middle=this._buttons.middle,!0)}_applyMouseWheelZoom(t){this._setXY(t)&&this._modules.events.fire("mousewheelInternal",{delta:KN(t),dx:t.deltaX,dy:t.deltaY,x:this._modules.position.x,y:this._modules.position.y,domEvent:this._evt})}_initializeListeners(){const t=this._domElt,e=this._modules.dom;fd&&this._modules.dom.addElementEventListener(document,"contextmenu",(i=>{this._lastMouseDownTarget&&i.target!==this._lastMouseDownTarget&&i.preventDefault()})),e.addElementEventListener(t,"contextmenu",(i=>{this._setXY(i),this._modules.dom.hasFocus()&&this._modules.settings.get("mouse.enabled")&&i.preventDefault()}),!1);const s="onwheel"in t?"wheel":t.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";e.addElementEventListener(t,s,this._onMouseWheel,{passive:!1}),e.addElementEventListener(t,"mousemove",this._onMouseMove),e.addElementEventListener(t,"mouseleave",(i=>{if(!this._isEnabled())return;this._modules.dom.blur();const n=t.getBoundingClientRect();i.clientX>=n.left+1&&i.clientX<=n.right-1&&i.clientY>=n.top+1&&i.clientY<=n.bottom-1||this._modules.events.fire("mouseout",{domEvent:this._evt})})),e.addElementEventListener(t,"mousedown",this._onMouseDown),e.addElementEventListener(t,"mouseup",this._onMouseUp),e.addElementEventListener(t,"dragover",(i=>{i.preventDefault()})),e.addElementEventListener(t,"drop",this._onDrop)}},tR={doubleTapTimer:500},eR=class extends te{constructor(){super(...arguments),this._pressed=!1,this._addEvent=(t,e,s,i)=>{this._modules.dom.addElementEventListener(t,e,s,i)},this._addWinEvent=(t,e,s,i)=>{this._modules.dom.addDirectWindowEventListener(e,s,i)},this._removeWinEvent=(t,e,s)=>{this._modules.dom.removeDirectWindowEventListener(e,s)}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("touch.enabled",!0),this._modules.events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]),this._modules.dom.afterNextFrame().then((()=>{this._initialize(this)}))}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get pressed(){return this._pressed}_listen(t,e,s){if(Jx){if(e==="touchstart")return aT(this._addEvent,t,s);if(e==="touchmove")return dT(this._addWinEvent,t,s);if(e==="touchend")return hT(this._addWinEvent,t,s);if(e==="touchcancel")return lT(this._addWinEvent,t,s)}return this._modules.dom.addElementEventListener(t,e,s)}_initialize(t){let e=0,s=0,i=0,n=0,r=!1,o="left",a=0,l=!1,d=!1,h=0,u=1,c=null,g=null;const m=()=>{this._modules.position.x=e,this._modules.position.y=s,this._pressed=r},f=(v,A)=>{const S=this._domElt.getBoundingClientRect();if(!S||v.touches==null)return null;const[w,I]=v.touches,M=w.clientX-S.left,N=w.clientY-S.top,D=I.clientX-S.left,q=I.clientY-S.top,et=(M+D)/2,O=(N+q)/2,K=et-e,j=O-s,ot=Ze(M,N,D,q),it=ot/u,ct=Ir(M,N,D,q),pt={dx:K,dy:j,rotation:ct-h,scale:it};return((Pt,At,bt,It)=>{u=Pt,h=At,e=bt,s=It,m()})(ot,ct,et,O),pt},p=v=>{if(v.touches&&v.touches.length===2&&d){const A=f(v);if(A){const{dx:S,dy:w,rotation:I,scale:M}=A;this._modules.events.fire("touchProgressGesture",{dx:S,dy:w,rotation:I,scale:M,x:e,y:s,domEvent:c,button:o})}}},_=v=>{if(o=Nc[v.button],!v.touches)return!1;if(v.touches.length!==1)return r=!1,v.touches.length>1&&this._modules.events.fire("touchUp",{x:e,y:s,domEvent:c,button:o}),!1;const A=this._domElt.getBoundingClientRect();return A&&(i=e,n=s,e=v.touches[0].clientX-A.left|0,s=v.touches[0].clientY-A.top|0,r=!0,c=v,m()),!0},x=()=>{a=0,this._modules.dom.clearTimeout(g)},y=v=>{if(v.preventDefault(),!v.touches)return;if(v.touches.length!==2&&d&&(d=!1,this._modules.events.fire("touchEndGesture",{domEvent:c})),_(v),v.touches.length===0){const S={x:e,y:s,domEvent:c,button:o};a===1&&this._modules.events.fire("touchTap",S),a>1&&(this._modules.events.fire("touchDoubleTap",S),x()),this._modules.events.fire("touchUp",S)}const A=Fi().documentElement;wm(this._removeWinEvent,A,"touchmove",this._onMove),wm(this._removeWinEvent,A,"touchend",this._onEnd)},b=v=>{p(v),l?l=!1:(x(),_(v)&&this._modules.events.fire("touchMove",{x:e,y:s,dx:e-i,dy:s-n,domEvent:c,button:o}))};this._listen(this._domElt,"touchstart",(v=>{if(!v.touches)return;v.touches.length!==2||d||(u=1,f(v)&&(d=!0,this._modules.events.fire("touchStartGesture",{domEvent:c}))),_(v)&&(this._modules.dom.focus(),this._modules.events.fire("touchDown",{x:e,y:s,domEvent:c,button:o}),a+=1,g=this._modules.dom.setTimeout(x,tR.doubleTapTimer),l=!0);const A=Fi().documentElement;this._onMove=this._listen(A,"touchmove",b),this._onEnd=this._listen(A,"touchend",y)}))}},sR=class extends te{constructor(t){super(t),this.getSubElements=e=>this.api.getSubElements(e),this.getSubNodes=e=>this.api.getSubNodes(e),this.getSubEdges=e=>this.api.getSubEdges(e),this.getXYR=e=>this.api.getXYR(e),this.onGroupsUpdated=e=>this.api.onGroupsUpdated(e)}onMounted(){this._modules.classes.createClass({name:o0,isBuiltin:!0,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this._modules.classes.createClass({name:a0,isBuiltin:!0,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}}),this._modules.settings.register("transformations.updateOnDataChange",!0),this._modules.events.register(["transformationEnabled","transformationDisabled","transformationSetIndex","transformationDestroyed","transformationRefresh"])}onReady(t){this.api=new $B(this._ogma)}destroy(){}isElementVirtual(t){return this.api.isVirtual(t._index,t.isNode)}getElementTransformation(t){return this.api.getTransformation(t._index,t.isNode)}getMetaElements(t){return t.map((e=>this.getMetaElement(e)))}getMetaElement(t){const e=t.isNode?this.api.getMetaNode(t):this.api.getMetaEdge(t);return e&&this.api.getTransformation(e._index,e.isNode)?.isEnabled()?e:null}getMetaEdge(t){return this.getMetaElement(t)}getMetaNode(t){return this.getMetaElement(t)}getMetaNodes(t){return this.getMetaElements(t)}getMetaEdges(t){return this.getMetaElements(t)}getNodeFilters(){return this.api.getList().filter((t=>t.getName()===bs.NodeFilter))}getEdgeFilters(){return this.api.getList().filter((t=>t.getName()===bs.EdgeFilter))}whenApplied(){return this.api.afterNextUpdate()}afterNextUpdate(){return this.api.afterNextUpdate()}isRefreshing(){return this.api.isRefreshing()}triggerGroupUpdated(t){const e=t._indexes,s=this._ogma.modules.transformations.api.groupController.layoutController.shouldRelayout;for(let i=0;i<t.size;i++)s.add(e[i])}},gp={layer:l0,outline:!0,outerStroke:{color:Fu,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:zb,minVisibleSize:0}},iR={layer:l0,color:Fu,text:{backgroundColor:zb,minVisibleSize:0},stroke:{color:Fu,width:0}},nR=class extends te{onMounted(){this.shouldTriggerEvents=!0,this._modules.events.register(["nodesSelected","nodesUnselected","edgesSelected","edgesUnselected"]),this._selectionExtremityHighlightedClass=this._modules.classes.createClass({name:fu,isBuiltin:!0,nodeAttributes:gp}),this._selectedClass=this._modules.classes.createClass({name:Ne,isBuiltin:!0,nodeAttributes:gp,edgeAttributes:iR}),this._modules.events.on(`nodeClassAdded_${Ne}`,(e=>{this.shouldTriggerEvents&&this._modules.events.fire("nodesSelected",e)})),this._modules.events.on(`edgeClassAdded_${Ne}`,(e=>{this.shouldTriggerEvents&&this._modules.events.fire("edgesSelected",e)})),this._modules.events.on(`nodeClassRemoved_${Ne}`,(e=>{this.shouldTriggerEvents&&this._modules.events.fire("nodesUnselected",e)})),this._modules.events.on(`edgeClassRemoved_${Ne}`,(e=>{this.shouldTriggerEvents&&this._modules.events.fire("edgesUnselected",e)})),this._modules.settings.register("interactions.selection.enabled",!0),this._modules.settings.register("interactions.selection.multiSelectionKey","ctrl"),this._modules.interactions.onClick({priority:"selection",check:({button:e})=>{const s=!!this._modules.settings.get("interactions.selection.enabled");return e==="left"&&s},handler:({target:e})=>{if(e){const s=this._modules.settings.get("interactions.selection.multiSelectionKey"),i=s&&this._modules.keyboard.isPressed(s);e.isNode?this._selectedClass.clearEdges():this._selectedClass.clearNodes(),i?e.hasClass(Ne)?e.removeClass(Ne):e.addClass(Ne):((e.isNode?this._selectedClass.getNodes():this._selectedClass.getEdges()).filter((n=>n!==e)).removeClass(Ne),e.hasClass(Ne)||e.addClass(Ne))}else this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}});const t=()=>{this._selectionExtremityHighlightedClass.clearNodes(),this._selectedClass.getEdges().getExtremities().addClass(fu)};this._modules.events.on("beforeRemoveEdges",(({edges:e})=>e.setSelected(!1))).on("excludedStateChange",(({elements:e,value:s})=>{s||e.setSelected(!1)})).on(`edgeClassAdded_${Ne}`,t).on(`edgeClassRemoved_${Ne}`,t)}setNodeAttributes(t,e){this._selectedClass.update({nodeAttributes:t,fullOverwrite:e}),this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}setEdgeAttributes(t,e){this._selectedClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}setEdgeExtremitiesAttributes(t,e){this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e})}_updateExtremityHighlightLayer(){const t=this._selectedClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}setActive(t,e){if(as(e)){const s=[],i=[];t.toList().forEach(((n,r)=>{(e[r]?s:i).push(n.getId())})),s.length!==0&&this._modules.graph.getElements(t.isNode,s).addClass(Ne),i.length!==0&&this._modules.graph.getElements(t.isNode,i).removeClass(Ne)}else t.size&&t[e?"addClass":"removeClass"](Ne)}areActive(t){return t.hasClass(Ne)}getSelectedNodes(){return this._selectedClass.getNodes()}getSelectedEdges(){return this._selectedClass.getEdges()}getNonSelectedNodes(){return this._modules.graph.getNodes().filter((t=>!t.hasClass(Ne)))}getNonSelectedEdges(){return this._modules.graph.getEdges().filter((t=>!t.hasClass(Ne)))}disableEvents(){this.shouldTriggerEvents=!1}enableEvents(){this.shouldTriggerEvents=!0}clear(){this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}},rR=class extends te{onMounted(){this._delayedCalls=[],this._idIdle=()=>!this._modules.captor.isAnyButtonPressed()&&!this._modules.dom.isPlayingFrame(),this._modules.events.on(["mousedown","mouseup","beforeNewFrame","frame"],(()=>{this._delayedCalls.forEach((t=>t.reset()))}))}_nextTimeIdle(t){const e=new oR(this._modules.dom,this._idIdle,t);return this._delayedCalls.push(e),e.whenDone().then((()=>{this._delayedCalls.splice(this._delayedCalls.indexOf(e),1)}))}debounceIdle(t,e=0){let s=!1,i=[];const n=()=>{const r=i;s=!1,i=[],t(),r.forEach((o=>o()))};return()=>new Promise((r=>{i.push(r),s||(s=!0,this._nextTimeIdle(e).then(n))}))}},oR=class{constructor(t,e,s){this._timeout=null,this._done=!1,this._dom=t,this._promise=new Promise((i=>this._resolve=i)),this._isIdle=e,this._delay=s,this._startTimeout()}_startTimeout(){this._timeout=this._dom.setTimeout((()=>{this._isIdle()?(this._done=!0,this._resolve()):this._startTimeout()}),this._delay)}reset(){this._done||(this._dom.clearTimeout(this._timeout),this._startTimeout())}whenDone(){return this._promise}},tl=-2,aR={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2,enabled:!1},lR={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2,enabled:!1},dR=class extends te{constructor(){super(...arguments),this._nodePromiseMap=new Map,this._edgePromiseMap=new Map,this._onAttributeChange=({nodes:t,edges:e,nodeAttributes:s,edgeAttributes:i})=>{this._onElementsAttributeChange(t,s),this._onElementsAttributeChange(e,i,!1)},this._refreshPulses=()=>{const{nodes:t,edges:e}=this._hasPulses.getElements();if(t.size!==0||e.size!==0){const s=this._engine.getCurrentTime();this._refreshElementsPulses(t,s),this._refreshElementsPulses(e,s),this._modules.dom.refresh()}}}onMounted(){this._modules.events.on("updateAttributes",this._onAttributeChange).on("frame",this._refreshPulses).on("beforeRemoveEdges",(({edges:t})=>{this._removePulses(t)})).on("beforeRemoveNodes",(({nodes:t})=>{this._removePulses(t)})).on("excludedStateChange",(({elements:t,value:e})=>{e&&(this._hasPulses.removeElements(t),this._removePulses(t))})).on("clearGraph",(()=>this._hasPulses.clear())),this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._nodePulses=this._modules.graph.createNodeAttribute({storage:"any"},!1),this._edgePulses=this._modules.graph.createEdgeAttribute({storage:"any"},!1),this._nodeNbPulsesRemaining=this._modules.graph.createNodeAttribute({storage:"int16",default:-1},!1),this._edgeNbPulsesRemaining=this._modules.graph.createEdgeAttribute({storage:"int16",default:-1},!1),this._nodeFlexArrays=this._modules.graphics.getNodeAttributes(),this._edgeFlexArrays=this._modules.graphics.getEdgeAttributes(),this._edgeSourceList=this._modules.graph.getEdgeAttribute("source"),this._edgeTargetList=this._modules.graph.getEdgeAttribute("target"),this._hasPulses=new ca(this._modules.graph)}_onElementsAttributeChange(t,e,s=!0){if(!e.includes("pulse.enabled"))return;const{valid:i,invalid:n}=Yy(this._modules.graph,t,(o=>o.getAttribute("pulse.enabled")&&o.isVisible()));this._hasPulses.removeElements(n),this._hasPulses.addElements(i);const r=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let o=0;o<i.size;o++)r.get(i._indexes[o])>0||r.set(i._indexes[o],tl);this._removePulses(n)}_removePulses(t){const e=t.isNode?this._nodePulses:this._edgePulses,s=t.isNode?this._nodePromiseMap:this._edgePromiseMap;for(let i=0;i<t._indexes.length;i++){const n=t._indexes[i],r=e.get(n);if(r){for(let a=0;a<r.length;a++){const l=r[a];this._modules.graphics.releaseGraphicsEngineBlockId(l.blockId)}e.set(n,null);const o=s.get(n);o&&(o.resolve(),s.delete(n))}}}_refreshElementsPulses(t,e){const s=t.isNode,i=s?this._nodePulses:this._edgePulses,n=s?this._nodeFlexArrays.pulse.duration:this._edgeFlexArrays.pulse.duration,r=s?"_createNodePulseBlock":"_createEdgePulseBlock",o=s?this._nodeFlexArrays.pulse.interval:this._edgeFlexArrays.pulse.interval,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let l=0;l<t._indexes.length;l++){const d=t._indexes[l];let h=i.get(d);h||(h=[],i.set(d,h));for(let f=0;f<h.length;f++){const{startTime:p,duration:_,blockId:x}=h[f];e>=p+_&&(this._modules.graphics.releaseGraphicsEngineBlockId(x),h.splice(f--,1))}const u=h[h.length-1];if(u&&e<u.startTime+o.get(d))continue;const c=n.get(d),g=a.get(d);if(g<1&&g!==tl)continue;h.push({blockId:this[r](d,e,c),startTime:e,duration:c});const m=g===tl?tl:g-1;a.set(d,m)}}_createNodePulseBlock(t,e,s){const i=this._nodeFlexArrays,n=i.color.get(t),r=i.layer.get(t),o=i.x.get(t),a=i.y.get(t),l=i.radius.get(t),d=i.scalingMethod.get(t)==="scaled",h=i.pulse.startRatio.get(t),u=i.pulse.endRatio.get(t),c=i.pulse.width.get(t),g=2*l*h,m=2*l*u,f=Go(r).nodeBody,p=i.pulse.startColor.get(t),_=i.pulse.endColor.get(t),x=this._modules.graphics.allocateGraphicsEngineBlockId(),y=this._group.reset(ei,!0,f),b=y.nextAndReset(),v=oi(p,n),A=oi(_,n);return b.end.shape="circle",b.end.pieceId=$s,b.end.x1=o,b.end.y1=a,b.end.x2=o,b.end.y2=a,b.end.rectWidthOrSourceRadiusScaled=d?m:0,b.end.rectHeightOrTargetRadiusScaled=d?m:0,b.end.rectWidthOrSourceRadiusFixed=d?0:m,b.end.rectHeightOrTargetRadiusFixed=d?0:m,b.end.strokeWidthFixed=c,b.end.strokeColor=A,b.start.shape="circle",b.start.pieceId=$s,b.start.x1=o,b.start.y1=a,b.start.x2=o,b.start.y2=a,b.start.rectWidthOrSourceRadiusScaled=d?g:0,b.start.rectHeightOrTargetRadiusScaled=d?g:0,b.start.rectWidthOrSourceRadiusFixed=d?0:g,b.start.rectHeightOrTargetRadiusFixed=d?0:g,b.start.strokeWidthFixed=c,b.start.strokeColor=v,b.animation.duration=s,b.animation.beginTime=e,this._engine.storeGroup(x,y),x}_createEdgePulseBlock(t,e,s){const i=this._edgeFlexArrays,n=this._nodeFlexArrays,r=i.pulse.startRatio.get(t),o=i.pulse.endRatio.get(t),a=i.pulse.startColor.get(t),l=i.pulse.endColor.get(t),d=Go(i.layer.get(t)).edgeBody,h=this._edgeSourceList.get(t),u=this._edgeTargetList.get(t),c=i.curvature.get(t),g=c!==0,m=this._modules.graphics.allocateGraphicsEngineBlockId(),f=this._group.reset(g?Ql:ei,!0,d),p=f.nextAndReset(),_={isSelfLoop:h===u,curvature:c,sourceX:n.x.get(h),sourceY:n.y.get(h),targetX:n.x.get(u),targetY:n.y.get(u),sourceRadius:n.radius.get(h),targetRadius:n.radius.get(u),isSourceRadiusScaled:n.scalingMethod.get(h)==="scaled",isTargetRadiusScaled:n.scalingMethod.get(u)==="scaled",width:i.width.get(t),isWidthScaled:i.scalingMethod.get(t)==="scaled",strokeWidth:i.pulse.width.get(t)};return mp(p.start,_),mp(p.end,_),p.start.strokeColor=a,p.end.strokeColor=l,p.start.thicknessOrFontSizeScaled*=r,p.start.thicknessOrFontSizeFixed*=r,p.end.thicknessOrFontSizeScaled*=o,p.end.thicknessOrFontSizeFixed*=o,p.animation.duration=s,p.animation.beginTime=e,this._engine.storeGroup(m,f),m}pulse(t,e){const s=t.isNode,i={...s?aR:lR,...s?this._nodePulseTheme:this._edgePulseTheme,...e},n=i.number,r=i.interval,o=i.duration,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining,l=(n-1)*r+o;let d;i.enabled=!0,delete i.number,t.setAttributes({pulse:i}),a.setMultiple(t._indexes,n),this._modules.dom.setTimeout((()=>{t.isList?t.filter(ni).setAttribute("pulse.enabled",!1):t.setAttribute("pulse.enabled",!1),a.setMultiple(t._indexes,-1)}),l);const h=new Promise((c=>{d=()=>c(t)})),u=t.isNode?this._nodePromiseMap:this._edgePromiseMap;return t.isList?t._indexes.forEach((c=>{this._setPromise(c,u,h,d)})):this._setPromise(t._index,u,h,d),h}_setPromise(t,e,s,i){e.has(t)&&e.get(t).resolve(),e.set(t,{promise:s,resolve:i})}setTheme(t,e){this._nodePulseTheme=t,this._edgePulseTheme=e}};function mp(t,{sourceX:e,sourceY:s,targetX:i,targetY:n,isSourceRadiusScaled:r,isTargetRadiusScaled:o,targetRadius:a,sourceRadius:l,isWidthScaled:d,width:h,strokeWidth:u,curvature:c,isSelfLoop:g}){t.pieceId=Sd,t.shape="line",t.x1=e,t.y1=s,t.x2=i,t.y2=n,t.rectWidthOrSourceRadiusScaled=r?l:0,t.rectWidthOrSourceRadiusFixed=r?0:l,t.rectHeightOrTargetRadiusScaled=o?a:0,t.rectHeightOrTargetRadiusFixed=o?0:a,t.thicknessOrFontSizeScaled=d?h:0,t.thicknessOrFontSizeFixed=d?0:h,t.strokeWidthFixed=u,t.curvature=c,t.isSelfLoop=g}var hR={duration:0,easing:"linear",callback:ae,resolve:ae,startAfter:0},uR=0,cR=class extends te{constructor(){super(...arguments),this._animationList=[],this._update=()=>{if(this._animationList.length===0)return;const t=ps(),e=[];for(let s=0;s<this._animationList.length;++s){const i=this._animationList[s],n=(t-i.creationDate)/i.duration,r=i.startAfter;let o=i.easing(n);n>=1?(i.func(1),i.done=!0,i.resolve(void 0),this._animationList.splice(s,1),s-=1,e.push(i.callback)):o>=r&&(o=(o-r)*(1/(1-r)),i.func(o))}for(let s=0;s<e.length;s++)e[s](!1);this._modules.dom.refresh()}}onMounted(){this._modules.events.on("beforeNewFrame",this._update)}play(t,e){const{duration:s,easing:i,callback:n,startAfter:r,resolve:o}=Os(e,hR);if(s<=0)return t(1),n(),o(void 0),null;const a={func:t,easing:typeof i=="function"?i:xg[i],duration:s,callback:n,resolve:o,startAfter:r,creationDate:ps(),done:!1,id:++uR};return this._animationList.push(a),this._modules.dom.refresh(),a}cancel(t){const e=this._animationList.indexOf(t);e!==-1&&(t.func(1),this._animationList.splice(e,1),t.done=!0,t.resolve(void 0))}},Eg=t=>typeof t.export=="function",gR=(t,e,s,i)=>{const n=s._getMapPanePos(),r=t.getMapboxMap(),o=t.getCanvas(),a=t.getSize().round(),l=i.DomUtil.getPosition(t.getContainer()),d=l.x+n.x,h=l.y+n.y;return new Promise((u=>{function c(){e.drawImage(o,d,h,a.x,a.y),u()}if(r.loaded())return c();r.once("idle",c)}))},mR=(t,e,s,i,n)=>{if(Eg(t))return t.export(e);const r=s._getMapPanePos(),o=t.getContainer();if(!o)throw new Error(`Trying to access the container of ${t} but it does not exist.`);const a=i.DomUtil.getPosition(o);s.removeLayer(t),t.options.crossOrigin="anonymous";const l=[],d=[];return t.on("tileload",(({tile:h})=>{const{x:u,y:c}=i.DomUtil.getPosition(h);l.push(h),d.push({x:u-a.x+r.x,y:c-a.y+r.y})})),s.addLayer(t),new Promise((h=>{t.once("load",(()=>{const u=t.getTileSize();l.forEach(((c,g)=>{const{x:m,y:f}=d[g];e.drawImage(c,m,f,u.x,u.y)})),h()}))}))},fR=(t,e,s,i,n,r)=>new Promise((o=>{const a=t.options.renderer;s.removeLayer(t),t.options.renderer=r,s.addLayer(t),r._updatePaths();const l=s._getMapPanePos(),d=r._container,h=i.DomUtil.getPosition(d);e.drawImage(r._container,h.x+l.x,h.y+l.y,d.width/n,d.height/n),s.removeLayer(t),t.options.renderer=a,s.addLayer(t),o()})),pR=(t,e,s,i,n)=>new Promise((r=>{if(Eg(t))return t.export(e).then(r);const o=s.getPixelBounds().min,a=s.project(t.getLatLng(),s.getZoom());if(!t._icon||t._icon.tagName!=="IMG")return r();const l=/^data:/.test(t._icon.src),d=l?t._icon.src:sE(t._icon.src),h=new Image,u=t.options.icon;if(u){const c=u.options;let g=c.iconSize||[24,24];const m=a.subtract(o);let f=c.iconAnchor||[0,0];Array.isArray(g)||(g=[g.x,g.y]),Array.isArray(f)||(f=[f.x,f.y]);const p=Math.round(m.x-(g[0]-f[0])*n),_=Math.round(m.y-f[1]*n);h.crossOrigin="";const x=()=>{e.drawImage(h,p,_,g[0]*n,g[1]*n),r()};h.onload=x,h.src=d,l&&x()}}));function _R(t){if(t.options.pane==="overlayPane"&&"getElement"in t){const e=t.getElement();return e&&e.tagName.toLowerCase()==="canvas"}return!1}var yR=(t,e,s,i,n)=>new Promise((r=>{const o=t.getElement(),a=o.width,l=o.height;e.drawImage(o,0,0,a,l),r()})),xR=(t,e,s,i,n)=>new Promise((r=>{s.removeLayer(t),t.setUrl(sE(t.getUrl())),t.options.crossOrigin="anonymous",t.once("load",(()=>{const o=t.getBounds(),a=s.latLngToContainerPoint(o.getNorthWest()),l=s.latLngToContainerPoint(o.getSouthEast()),d=l.x-a.x,h=l.y-a.y;e.drawImage(t._image,a.x,a.y,d,h),r()})),s.addLayer(t)}));function sE(t){return t+(t.indexOf("?")===-1?"?":"&")+"noCache="+Date.now()}var bR={tileLayers:mR,imageOverlays:xR,canvasOverlays:yR,vectorLayers:fR,markers:pR,vectorMap:gR};function vR(t,e){return t instanceof e.TileLayer||t.options.pane==="tilePane"&&Eg(t)?"tileLayers":_R(t)?"canvasOverlays":t instanceof e.ImageOverlay?"imageOverlays":t instanceof e.Path?"vectorLayers":t instanceof e.Marker?"markers":"MapboxGL"in e&&t instanceof e.MapboxGL?"vectorMap":void 0}function ER(t,e,s,i,n,r){const o={vectorMap:[],tileLayers:[],vectorLayers:[],canvasOverlays:[],imageOverlays:[],markers:[]};return e.eachLayer((a=>{if(a!==t){const l=vR(a,i);if(l&&l in o){const d=bR[l];o[l].push((()=>d(a,s,e,i,n,r)))}}})),o}function AR(t){t.TileLayer.prototype.getUrl=function(){return this._url},t.ImageOverlay.prototype.getUrl=function(){return this._url};const e="leaflet-zoom-animated";t.OgmaOverlay||(t.OgmaOverlay=t.Layer.extend({options:{pane:"overlayPane",padding:0,onUpdate:()=>{}},initialize:function(s){const{container:i}=s;t.Util.setOptions(this,s),this._container=i},setLocked:function(s){return this._locked=s,this},onAdd:function(s){this._map=s,this.getPane().appendChild(this._container),this._wgsOrigin=t.latLng([0,0]),this._wgsInitialShift=s.project(this._wgsOrigin,this._initialZoom),t.DomUtil.addClass(this._container,"leaflet-layer"),this._zoomAnimated&&(t.DomUtil.addClass(this._container,e),this._container.style.position="absolute",this._container.style.zIndex=9999),this._initialZoom=(this._map.getMaxZoom()+this._map.getMinZoom())/2,this._mapInitialZoom=this._map.getZoom(),this._updateBounds(),this._update({})},_updateBounds(){const s=this.options.padding,i=this._map.getSize(),n=this._map.containerPointToLayerPoint(i.multiplyBy(-s));this._bounds=new t.Bounds(n,n.add(i.multiplyBy(1+2*s))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_update(s){this._updateBounds(),this._redraw(this._bounds.min,s),this._positionTimer=t.Util.requestAnimFrame((()=>{this._container&&t.DomUtil.setPosition(this._container,this._bounds.min)}))},_redraw(s,i){this.options.onUpdate()},_updateTransform(s,i){if(this._locked)return;const n=this._map.getZoomScale(i,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,i),a=r.multiplyBy(-n).add(o).subtract(this._map._getNewPixelOrigin(s,i));t.Browser.any3d?t.DomUtil.setTransform(this._container,a,n):t.DomUtil.setPosition(this._container,a)},_onZoom(s){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveEnd(s){this._update(s)},_onAnimZoom({center:s,zoom:i}){this._updateTransform(s,i)},bringToFront(){t.DomUtil.toFront(this._container)},getEvents(){return{zoom:this._onZoom,moveend:this._onMoveEnd,zoomanim:this._onAnimZoom,layeradd:this.bringToFront,zoomend:this.options.onUpdate}},onRemove:function(){t.DomUtil.removeClass(this._container,e);const s=this._container;["transform","webkitTransform","OTransform","MozTransform","msTransform","zIndex","position"].forEach((i=>s.style[i]=null)),t.Util.cancelAnimFrame(this._positionTimer),this._container=null}}))}function SR(t,e,s,i){const n=t.filter((A=>A.isVisible())),r=n.size===0,{mapX:o,mapY:a}=n.reduce(((A,S)=>{const{latitude:w,longitude:I}=S.getGeoCoordinates(),{x:M,y:N}=i(w,I);return A.mapX.push(M),A.mapY.push(N),A}),{mapX:[],mapY:[]}),l=n.getAttribute("x"),d=n.getAttribute("y"),h=n.getAttribute("radius").map(Number),u=new Cs({xValues:l,yValues:d,scaledSizeValues:h}),c=new Cs({xValues:o,yValues:a});r&&(u.cx=u.cy=0,u.width=u.height=0),isFinite(c.width)&&isFinite(c.height)||(c.cx=c.cy=0,c.width=c.height=0);let g=c.cx-u.cx,m=c.cy-u.cy;const f=r?1:Math.max(c.width,c.height)/Math.max(u.width,u.height),[p,_]=h.reduce(((A,S)=>(A[0]=Math.min(A[0],S*f),A[1]=Math.max(A[1],S*f),A)),[1/0,0]);c.pad(_),c.minScaledSize=p,c.maxScaledSize=_;const x=s.computeConfigForBounds(c),y=e.zoom/jw(x.zoom);g+=(u.cx-e.x)*y,m+=(u.cy-e.y)*y;const b=u.cx+g,v=u.cy+m;return{offsetChanges:{name:"graph-to-geo",nodeAttributes:{radius:A=>Number(A.getAttribute("radius"))*y,x:A=>(A.getAttribute("x")+g-b)*y+b,y:A=>(A.getAttribute("y")+m-v)*y+v},edgeAttributes:{width:A=>Number(A.getAttribute("width"))*y}},camera:{zoom:e.zoom/y,x:(e.x+g-b)*y+b,y:(e.y+m-v)*y+v,angle:0,...e.getSize()}}}function wR(t,e,s,i){const n=t.getAttributes(["x","y","radius"]),r=t.getBoundingBox(),o=t.size===0,a=t.reduce(((b,{_index:v},A)=>(b[v]=A,b)),{});i();const l=t.getAttribute("x"),d=t.getAttribute("y"),h=t.getAttribute("radius"),u=new Cs({xValues:l,yValues:d,scaledSizeValues:h.map((b=>2*b))});o&&(r.reset(),u.reset());let c=u.cx-r.cx,g=u.cy-r.cy,m=0,f=0;const p=s.computeConfigForBounds(u),_=e.zoom/p.zoom;let x,y;return isNaN(r.cx)||isNaN(r.cy)?(r.cx=e.x,r.cy=e.y,x=p.x,y=p.y):(c+=(r.cx-e.x)*_,g+=(r.cy-e.y)*_,m=r.cx+c,f=r.cy+g,x=(e.x+c-m)*_+m,y=(e.y+g-f)*_+f),{offsetChanges:{name:"geo-to-graph",nodeAttributes:{x:b=>(n[a[b._index]].x+c-m)*_+m,y:b=>(n[a[b._index]].y+g-f)*_+f}},camera:{zoom:p.zoom,x,y,angle:0,...e.getSize()}}}var iE={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"},TR={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"},fp={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:void 0},CR=class extends te{onMounted(){this._brand=null}set(t,e){let{position:s,horizontalMargin:i,verticalMargin:n,className:r}={...fp,...e};iE[s]||(s=fp.position),this.remove();const o=document.createElement("div");return Dy(o,Rc.sanitize(t)),o.style.position="absolute",nE(o,s,i,n),o.style.zIndex="10",r&&o.setAttribute("class",r),this._brand=o,this._modules.dom.setLayer("brand",this._brand),o}remove(){this._modules.dom.setLayer("brand",null),this._brand=null}};function nE(t,e,s,i){const n=s===void 0?"":s+"px",r=i===void 0?"":i+"px";t.style[iE[e]]=n,t.style[TR[e]]=r}var pp={},LR=class extends te{constructor(){super(...arguments),this._enabled=!1,this._settings={...En},this._edgesOriginalTextStyle={},this._nodesOriginalTextStyle={},this._nodeDraggingSetting=!1,this._transition=!1,this._attribution=null,this._updating=!1,this._updateRate=50,this._x=0,this._y=0,this._onCameraUpdate=t=>{if(this.L&&this._enabled&&this._map&&this._map._loaded){const e=this._x-this._modules.camera.x,s=this._y-this._modules.camera.y;(e||s)&&this._syncMapWithCamera()}},this._syncMapWithCamera=()=>{if(!this._map)return;this._updating||(this._updating=!0,this._layer.setLocked(!0),this._map._moveStart(!0,!1));const t=this._fromPointToLatLng(this._modules.camera.x,this._modules.camera.y),e=Xd(this._modules.camera.zoom),s=this.L.latLng(t.latitude,t.longitude);this._map._move(s,e,{pinch:!0,round:!1}),clearTimeout(this._updateRequest),this._updateRequest=this._modules.dom.setTimeout((()=>{this._updating=!1,this._layer.setLocked(!1),this._map&&this._map._move(s,e,{pinch:!0})._moveEnd(!0)}),this._updateRate)},this._onNodesDragStart=()=>{this._enabled&&(this._setMapDragging(!1),this._nodeDragOffsetX=this._nodeDragOffsetY=0)},this._onNodesDragged=({nodes:t,dx:e,dy:s})=>{if(this._enabled){const i=t.map((n=>{const{x:r,y:o}=n.getAttributes(["x","y"]);return this._fromPointToLatLng(r+e-this._nodeDragOffsetX,o+s-this._nodeDragOffsetY)}));return this._nodeDragOffsetX=e,this._nodeDragOffsetY=s,t.setGeoCoordinates(i)}return Promise.resolve(this._modules.graph.nodeList())},this._onMapUpdate=()=>{if(!this._map)return Promise.resolve(void 0);const{lat:t,lng:e}=this._map.getCenter(),s=this._fromLatLngToPoint(t,e);this._x=s.x,this._y=s.y;const i=Hw(this._map.getZoom());return this._modules.events.fire("beforeGeoCameraMove",{zoom:this._map.getZoom()}),this._modules.camera.setView({zoom:i,x:s.x,y:s.y},{ignoreZoomLimits:!0}).then((()=>this._adjustMinvisibleSizes()))},this.runLayout=async({type:t,nodes:e,latitudePath:s=mi,longitudePath:i=fi,options:n,center:r})=>{const o=a1(r),a=o([r.longitude,r.latitude]),l=e.getPosition(),d=[];return e.setAttributes(e.map((h=>{const u=h.getData(s),c=h.getData(i);if(isNaN(u)||isNaN(c))return{x:a[0],y:a[1]};const g=o([c,u]);return{x:g[0],y:g[1]}}))).then((()=>this._ogma.layouts[t]({...n,nodes:e,dryRun:!0}))).then((h=>{const u=h.positions.current,c=new Array(u.length),g=new Array(u.length),m=new Array(u.length).fill(10);u.forEach(((x,y)=>{const b=o.invert([x.x,x.y]);c[y]=b[1],g[y]=b[0],d.push({latitude:b[1],longitude:b[0]})}));const f=ra(g,c,m),p=f[0]-r.longitude,_=f[1]-r.latitude;for(let x=0;x<d.length;x++)c[x]-=_,g[x]-=p,d[x].latitude-=_,d[x].longitude-=p;return e.setData(s,c),e.setData(i,g),e.setAttributes(l)})).then((()=>this._ogma.modules.geo._updateNodesCoordinates(e))).then((()=>d))}}onMounted(){this._modules.events.register(["geoEnabled","beforeGeoDisabled","geoDisabled","geoNodesMoved","geoLoaded","geoReady"]),lm()&&(this.L=Xs("L")||Xs("leaflet"),this.L&&AR(this.L)),this._modules.graph.createNodeAttribute({name:"geo.prevLat",storage:"float"},!0),this._modules.graph.createNodeAttribute({name:qd,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:mi,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:fi,storage:"float"},!0),this._modules.events.register(["beforeGeoCameraMove"]),this._modules.events.on("addNodes",(t=>{t.virtual||this._refreshOrAddNodes(t.nodes,!0)})).on("updateNodeData",(t=>{this._onDataChange(t.changes)})).on("nodesDragProgress",this._onNodesDragged).on(["nodesDragStart","lassoEnabled"],this._onNodesDragStart).on(["nodesDragEnd","lassoDisabled"],(()=>this._setMapDragging(!0))).on("viewChanged",this._onCameraUpdate)}_onDataChange(t){const e=Yh(this.latitudePath),s=Yh(this.longitudePath),i=t.filter((({virtual:r,property:o,newValues:a})=>!(r||!a.length)&&(o&&typeof o!="string"?o.find((l=>e.startsWith(l)||s.startsWith(l))):o===null||e.startsWith(o)||s.startsWith(o))));if(!i.length)return;const n=i1(i);n&&(this._modules.events.fire("geoNodesMoved",{nodes:n}),this._refreshOrAddNodes(n,!1))}_refreshOrAddNodes(t,e){e&&this._updatePrevNodesCoordinates(t),this._updateNodesCoordinates(t),this._enabled&&(this._cacheOriginalTextStyles(t,null),this._filter.refresh())}_updatePrevNodesCoordinates(t){Sa(this._modules.graph,t,mi,jg),Sa(this._modules.graph,t,fi,qd)}_restorePrevNodesCoordinates(t){Sa(this._modules.graph,t,jg,mi),Sa(this._modules.graph,t,qd,fi)}_updateNodesCoordinates(t){t1(this._modules.graph,t,this._settings)}_createMapTileLayer(t,e,s){if(t&&!Xe(t))return t;const i=t,n=i.wms?this.L.tileLayer.wms:this.L.tileLayer,r=Yw(i,e)||"";return n(i.url,{attribution:r,maxZoom:s,...t})}_setupTileLayer(t,e,s,i){const n=this._createMapTileLayer(t,e,i);return n.once("load",(()=>{this._modules.events.fire("geoLoaded")})),n.addTo(this._map),am(n,s),n}_onSettingsChanged(t,e){const s=t.wrapCoordinates!==e.wrapCoordinates,i=t.latitudePath!==e.latitudePath||t.longitudePath!==e.longitudePath;if(s||i){let n=Promise.resolve();this._enabled&&this._filter&&(n=n.then((()=>this._filter.refresh()))),n.then((()=>this._updateNodesCoordinates(this._modules.graph.getNodes("all"))))}this._enabled&&($w(t,e)&&this._map&&(this._map.removeLayer(this._tileLayer),this._tileLayer=this._setupTileLayer(e.tiles,e.attribution,e.opacity,e.maxZoomLevel)),t.sizeRatio!==e.sizeRatio&&this._updateSizes(),t.maxZoomLevel!==e.maxZoomLevel&&(this._modules.settings.update({minZoom:1,maxZoom:Math.pow(2,e.maxZoomLevel)}),this._map?.setMaxZoom(e.maxZoomLevel),this._tileLayer&&this._tileLayer.options&&(this._tileLayer.options.maxZoom=e.maxZoomLevel)),t.disableNodeDragging!==e.disableNodeDragging&&this._setDragging(!e.disableNodeDragging),t.attributionOptions!==e.attributionOptions&&this._setAttributionOptions(e.attributionOptions,e.attribution),am(this._tileLayer,e.opacity))}_setMapDragging(t){if(this._map){const e=t?"enable":"disable";this._map.dragging[e]()}}_fromLatLngToPoint(t,e){return this._map.options.crs.latLngToPoint(this.L.latLng(t,e),zl)}_fromPointToLatLng(t,e){const{lat:s,lng:i}=this._map.options.crs.pointToLatLng(this.L.point({x:t,y:e}),zl);return{latitude:s,longitude:i}}_updateSizes(){this._enabled&&this._projection&&this._projection.updateAll()}enable(t){return this.setEnabled(!0,t)}getMap(){return this._enabled?this._map:null}getOptions(){return this._enabled?{...this._settings,tiles:Xe(this._settings.tiles)?{...this._settings.tiles}:this._settings.tiles}:{...En}}setOptions(t){if(!this._enabled||this._transition)return;Xw(t,this.L);const e=this._settings;this._settings={...En,...e,...t,tiles:Ww(En,t)},this._onSettingsChanged(e,this._settings)}disable(t){return this.setEnabled(!1,t)}isEnabled(){return this._enabled}toggle(t={}){return this.setEnabled(!this._enabled,t)}getContainerCoords(t){return t.getGeoCoordinates().map((({latitude:e,longitude:s})=>this._map.latLngToContainerPoint([e,s])))}getContainerCoord(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return this._map.latLngToContainerPoint([e||0,s||0])}setEnabled(t,e){if(!lm())throw new Error("Ogma Geo cannot be used outside a browser");if(!this.L)throw new Error("You are trying to use Geo mode but Leaflet has not been found. Please follow our migration guide: https://bit.ly/2SYkF8A");if(this._transition||t===this._enabled)return Promise.resolve();const s=this._modules.settings;this._enabled||(this._prevSettings=s.get(),this._nodeDraggingSetting=!!s.get("interactions.drag.enabled")),this._enabled=t,this.setOptions(e),this._transition=!0;const i=this._settings;return t?this._show(e?.latitude,e?.longitude,e?.zoom).then((()=>(this._registerTextStyle(this._modules.graph.getNodes(),this._modules.graph.getEdges()),this._setDragging(!i.disableNodeDragging),this._transition=!1,this._updating=!1,this._modules.events.fire("geoEnabled").fire("geoReady"),this._adjustMinvisibleSizes()))):this._restoreTextStyle().then((()=>this._hide())).then((()=>{this._transition=!1,this._modules.events.fire("geoDisabled"),this._setDragging(this._nodeDraggingSetting,!0)})).then((()=>this._ogma.view.afterNextFrame()))}destroy(){return this._enabled&&this._destroyMapSync(),Promise.resolve()}_cacheOriginalTextStyles(t,e){e&&(this._edgesOriginalTextStyle=hm(e,this._edgesOriginalTextStyle)),t&&(this._nodesOriginalTextStyle=n1(t,this._nodesOriginalTextStyle))}_registerTextStyle(t,e){this._cacheOriginalTextStyles(t,e);const{nodeAttributes:s,edgeAttributes:i}=this._modules.hover.getHoverClassDefinition();this._hoverEdgesOriginalTextStyle=i||null,this._hoverNodesOriginalTextStyle=s||null,this._modules.hover.updateEdgeAttributes({text:{size:n=>(this._edgesOriginalTextStyle[n.getId()]||pp)["text.size"]}}),this._modules.hover.updateNodeAttributes({text:{size:n=>(this._nodesOriginalTextStyle[n.getId()]||pp)["text.size"]}})}_restoreTextStyle(){return this._modules.hover.updateEdgeAttributes(this._hoverEdgesOriginalTextStyle,!0),this._modules.hover.updateNodeAttributes(this._hoverNodesOriginalTextStyle,!0),Promise.all([o1(this._modules.graph.getEdges(),this._edgesOriginalTextStyle)]).then((()=>{this._edgesOriginalTextStyle=hm(this._modules.graph.edgeList(),{}),this._nodesOriginalTextStyle={},this._edgesOriginalTextStyle={}}))}_setDragging(t,e=!1){this._modules.settings.update({interactions:{drag:{enabled:t,applyResult:e}}})}_setAttributionOptions(t,e){if(this._map){if(this._attribution&&(this._attribution.remove(),this._attribution=null),this._attribution=this.L.control.attribution({prefix:!1}).addTo(this._map),Xe(t)){this._attribution.setPrefix(""),t.position=t.position||"bottom-right";const s=t.position.replace("-","");this._attribution.setPosition(s);const i=this._attribution.getContainer();i&&(t.className&&this.L.DomUtil.addClass(i,t.className),nE(i,t.position||"bottom-right",t.horizontalMargin,t.verticalMargin))}e!=null&&this._attribution.addAttribution(e)}}_nodeIsVisible(t){return e1(t,this._settings,this._hasCustomProjection())}_updateSettingsForMap(){const t=this._modules.graphics.getGraphicsEngine().parseColor(this._settings.backgroundColor);t[3]=0,this._modules.settings.update({backgroundColor:_0(t),minZoom:1e-6,interactions:{rotation:{enabled:!1},drag:{enabled:!1},pan:{enabled:!1},zoom:{enabled:!1,onDoubleClick:!1}},mouse:{wheelEnabled:!1}})}getGraphPosition(t){const e=this.L.latLngBounds(Qw(t));return{center:t.size>0?e.getCenter():this.L.latLng([0,0]),zoom:this._clampZoom(this._map.getBoundsZoom(e))}}_initMap(){this._updateSettingsForMap(),this._mapContainer=Kw(this._modules.dom.getContainer());const t={...iw,minZoom:this._settings.minZoomLevel,maxZoom:this._settings.maxZoomLevel};this._hasCustomProjection()&&(t.crs=this._settings.crs,t.worldCopyJump=!1,t.maxBoundsViscosity=0),this._map=new this.L.Map(this._mapContainer,t),this._map.on("movestart zoomstart",(()=>{this._updating=!0})).on("moveend zoomend",(()=>{this._updating=!1})),this._setAttributionOptions(this._settings.attributionOptions,this._settings.attribution),this._setupLayers()}_clampZoom(t){let e=this._tileLayer.options.maxZoom;return e===void 0&&(e=1/0),Math.min(t,e)}_show(t,e,s){let i;return this._initMap(),this._filter?i=this.filter.enable(0):(this._filter=this._modules.transformations.api.addNodeFilter({criteria:n=>this._nodeIsVisible(n)}),this._filter.setIndex(0),i=this._filter.whenApplied()),i.then((()=>{const n=this._map,r=this._modules.graph.getNodes(),o=this._modules.graph.getEdges(),a=this.getGraphPosition(r),l=a.center;t!==void 0&&e!==void 0&&(l.lat=t,l.lng=e);const d=s??a.zoom,{offset:h,newCameraView:u}=this._transformToGeo();return this._modules.camera.setView(u,{ignoreZoomLimits:!0}).then((()=>(this._updatePrevNodesCoordinates(r),n.setView(l,d,{animate:!1}),this._modules.graphics.animate({nodes:r,edges:o},(()=>{this._projection=this._createFinalPositionLayer()}),!0,this._settings.duration)))).then((()=>h.destroy()))}))}updateProjection(){this._projection?.update()}_hasCustomProjection(){return this._settings.crs!=null}_setupLayers(){this._settings.tiles&&(this._tileLayer=this._setupTileLayer(this._settings.tiles,this._settings.attribution,this._settings.opacity,this._settings.maxZoomLevel)),this._layer=new this.L.OgmaOverlay({container:this._modules.graphics.getDomElement(),mapContainer:this._mapContainer,onUpdate:()=>this._onMapUpdate()}),this._layer.addTo(this._map)}_adjustMinvisibleSizes(){return Promise.all([r1(this._modules.graph.getEdges(),this._edgesOriginalTextStyle,this._map.getZoom())])}_hide(){if(!this._map)return Promise.resolve();this._modules.settings.update(this._prevSettings);const t=this._map;t.removeLayer(this._layer);const e=this._modules.dom.getContainer(),s=this._modules.graphics.getDomElement();e&&e.appendChild(s),t.getContainer().style.zIndex="0";const i=this._modules.graph.getNodes("all"),n=this._modules.graph.getEdges("all"),{offset:r,newCameraView:o}=this._transformToGraph();return this._modules.camera.setView(o||{}).then((()=>(this._modules.events.fire("beforeGeoDisabled"),Promise.all([Mx(t.getContainer(),1,0,this._settings.duration/2).then((()=>this._destroyMapSync())),this._modules.graphics.animate({nodes:i,edges:n},(()=>r&&r.destroy()),!0,this._settings.duration)])))).then((()=>(this._map=null,this._filter.disable(0).then((()=>{})))))}_destroyMapSync(){if(this._map){this._layer&&this._layer._map&&this._map.removeLayer(this._layer),this._map.remove(),this._map._animatingZoom=!1,this._map=null;const t=this._mapContainer.parentNode;t&&t.removeChild(this._mapContainer)}}_transformToGeo(){const t=this._modules.graph.getNodes(),{offsetChanges:e,camera:s}=SR(t,this._modules.camera,this._modules.locate,((i,n)=>this._fromLatLngToPoint(i,n)));return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}_addGraphAttributesLayer(t){return this._modules.graphics.addAttributeLayer({priority:LT,nodeSelector:e=>e.isVisible(),edgeSelector:e=>e.isVisible(),...t})}_transformToGraph(){const t=this._modules.graph.getNodes("all"),{offsetChanges:e,camera:s}=wR(t,this._modules.camera,this._modules.locate,(()=>{this._projection&&(this._projection.destroy(),this._projection=null)}));return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}getPointFromLatLng(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return e==null?t.getAttributes(["x","y"]):this._fromLatLngToPoint(e,s)}_createFinalPositionLayer(){return this._addGraphAttributesLayer({name:"graph-2-geo-animation",nodeAttributes:{scalingMethod:"fixed",radius:t=>Number(t.getAttribute("radius"))*this._settings.sizeRatio,x:t=>this.getPointFromLatLng(t).x,y:t=>this.getPointFromLatLng(t).y},edgeAttributes:{scalingMethod:"fixed",width:t=>Number(t.getAttribute("width"))*this._settings.sizeRatio}})}setCenter(t,e){return this._enabled?this.setView(t,e,Xd(this._modules.camera.getZoom())):Promise.resolve()}setZoom(t){return this._enabled&&this._map?(t=this._clampZoom(t),this._map.setZoom(t),new Promise((e=>{const s=this._map;if(s.getZoom()===t)return e(void 0);s.once("moveend zoomend",e)})).then(this._onMapUpdate)):Promise.resolve()}zoomIn(){return this.setZoom(this.getZoom()+1)}zoomOut(){return this.setZoom(this.getZoom()-1)}setView(t,e,s){if(!this._enabled||!this._map)return Promise.resolve();const i=this._map;s=this._clampZoom(s);const n=this.L.latLng([t,e]);return i.setView(n,s,{animate:!1,reset:!0}),new Promise((r=>{if(i.getZoom()===s&&i.getCenter().equals(n))return r(void 0);i.once("moveend zoomend",r)})).then(this._onMapUpdate)}getView(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{zoom:this._map.getZoom(),latitude:t.lat,longitude:t.lng}}getCenter(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{latitude:t.lat,longitude:t.lng}}getZoom(){if(this._enabled&&this._map)return this._map.getZoom()}resetCoordinates(){if(!this._enabled||!this._projection)return;const t=this._modules.graph.getNodes();this._restorePrevNodesCoordinates(this._modules.graph.getNodes());const e=this._modules.graph.getNodeAttribute(mi).getMultiple(t._indexes),s=this._modules.graph.getNodeAttribute(fi).getMultiple(t._indexes);t.setData(this._settings.latitudePath,e),t.setData(this._settings.longitudePath,s),this._projection.update()}getUnprojectedCoordinates(t){this._projection&&this._projection.destroy();const e=t.getPosition();return this._projection=this._createFinalPositionLayer(),e}get latitudePath(){return this._settings.latitudePath}get longitudePath(){return this._settings.longitudePath}get filter(){return this._filter}exportBackground(t){if(!this._map)return Promise.reject("Map is not ready");const{pixelRatio:e,width:s,height:i,zoom:n,x:r,y:o}=t,a=s*e,l=i*e,d=ls(a,l),h=d.getContext("2d"),u=this._map;if(!h)throw new Error(`Unable to get 2d context from  ${d}`);const c=this.getView(),g={zoom:Math.round(Xd(n*e)),...this._fromPointToLatLng(r,o)},m=new this.L.Canvas;u.addLayer(m);const{vectorMap:f,tileLayers:p,vectorLayers:_,canvasOverlays:x,imageOverlays:y,markers:b}=ER(this._layer,u,h,this.L,e,m),v=u.options.zoomSnap;return Promise.resolve().then((()=>(Bn(this._mapContainer,a+"px",l+"px"),u.invalidateSize({animate:!1}),this.setView(g.latitude,g.longitude,g.zoom)))).then((()=>Cy([...f,...p,...x,...y,..._,...b]))).then((()=>{Bn(this._mapContainer,"100%","100%"),u.invalidateSize({animate:!1}),u.options.zoomSnap=v,this.setView(c.latitude,c.longitude,c.zoom)})).then((()=>new Promise((A=>this.L.Util.requestAnimFrame(A))))).then((()=>u.removeLayer(m))).then((()=>d))}},IR=class extends te{constructor(){super(...arguments),this._context={edgesAlwaysCurvy:!1,edgesRoutingStyle:"none",directedEdges:!1}}onMounted(){this._attributeLayer=this._addAttributeLayer(),this._modules.settings.register("edgesAlwaysCurvy",!1,(t=>{this._context.edgesAlwaysCurvy=t,this._attributeLayer.updateAll()})),this._modules.settings.register("directedEdges",!1,(t=>{this._context.directedEdges=t,this._attributeLayer.updateAll()})),this._modules.settings.register("edgesRoutingStyle","none",(t=>{const e=t&&t!=="none",s=t==="vertical",i=this._ogma.modules?.graphics.getGraphicsEngine();i&&i.setBentEdges(e,s),this._attributeLayer.updateAll()}))}computeCurvature(t,e="visible",s){const{edgesAlwaysCurvy:i,directedEdges:n}=this._context,r=t.getSource()===t.getTarget();if(!i&&t.hasParallelEdges()===!1&&!r)return 0;let o=t.getParallelEdges({filter:e});s&&(o=o.filter((d=>s(d))));const a=o.indexOf(t);if(a===-1)return 0;let l;if(r)l=(a+1)*Math.max(+t.getAttribute("width")||0,1);else{const d=t.getSource(),h=o.size;if(h===1&&!i)return 0;if(n){let u=0;for(let c=0;c<a;++c)o.get(c).getSource()===d&&(u+=1);l=u+1}else{const u=d!==o.get(0).getSource();l=h%2!=1||i?(1+(a/2|0))*(a%2==0?1:-1)*(u?-1:1):a===0?0:((a+1)/2|0)*(a%2==0?1:-1)*(u?-1:1)}}return l}_addAttributeLayer(){return this._modules.graphics.addAttributeLayer({name:"curvature",priority:ST,edgeDependencies:{parallelEdges:!0},edgeContext:this._context,edgeAttributes:{curvature:t=>this.computeCurvature(t)}})}};function MR(t){if(typeof t!="string"||t.trim()===""){let e="Calls to uncheckedconversion functions must go through security review.";throw e+=" A justification must be provided to capture what security assumptions are being made.",new Error(e)}}function Hr(t,e){return MR(e.justification),Ec(t)}var rE="worker_start",oE="worker_configure",nd="worker_stop",Yo="worker_update",NR=0,aE=class extends la{constructor(t,e){super(),this._complete=!1,this._busy=!1,this._destroyed=!1,this._data=null,this._onStart=ae,this._onStop=ae,this._setIdle=ae,this._onPause=ae,this.timer={start:0,steps:0},this._modules=e,this._busy=!1,this.id=++NR,this.configure(t)}configure({configure:t=ni,update:e=ae,context:s=ae,stop:i=ae,isRunning:n=Fl,onStart:r=ae,onStop:o=ae,onPause:a=ae,setIdle:l=ae}){this._configure=t,this._update=e,this._createContext=s,this._isRunning=n,this._stop=i,this._onStart=r,this._onStop=o,this._setIdle=l,this._onPause=a}setData(t){this._data=t}getData(){return this._data}start(t){this.promise=new Promise(((s,i)=>{this.resolve=s,this.reject=i})),this._complete=!1,this._busy=!0,this._onStart(),this.fire(rE,{target:this});const e=this._configure(t,this._modules);return this.fire(oE,e),this.send(e),this}stop(t=!0){return this._complete?Promise.resolve():(this._onStop(),t&&this.send({type:nd}),this.promise.then((()=>{this.fire(nd,{target:this}),this.clearEvents(),this._complete=!0})))}pause(){this._onPause()}setIdle(t){this._setIdle(t)}isBusy(){return!this._complete||this._busy}setBusy(t){this._busy=t}getPromise(){return this.promise}destroy(){this._destroyed||(this._destroyed=!0,this._modules&&(this._busy&&this.stop(),delete this._modules))}},lE=/^function\s*\(/,dE=/^\(|^\w+\s?=>/,RR="Layout control code for the worker",jr={justification:RR};function el(t){const e=t.toString();return e.indexOf("function")===0||dE.test(e)?e:`function ${e}`}var FR=class extends aE{constructor(t,e){super(t,e);const s=MS([Hr(PR(t.imports),jr),kr`\nconst __CONTEXT = (`,Hr(el(this._createContext),jr),kr`)();\nconst __UPDATE_FUNC = `,Hr(el(this._update),jr),kr`\nconst __IS_RUNNING_FUNC = `,Hr(el(this._isRunning),jr),kr`\nconst __STOP_FN = `,Hr(el(this._stop),jr),kr`\nlet result;
      self.addEventListener("message", function (evt) {
        if (evt.data && evt.data.type === 'worker_stop') {
          __STOP_FN(__CONTEXT);
          return self.postMessage({ result, isRunning: false, stopped: true });
        }
        result = __UPDATE_FUNC(evt.data, __CONTEXT);
        const isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);
        self.postMessage({ result, isRunning });
      });
    `]);this._worker=av(s),this._worker.addEventListener("message",(i=>{e.dom.isDestroyed()||this.onWorkerMessage(i)}))}onWorkerMessage(t){const e=t.data.isRunning,s=t.data.stopped,i={data:void 0},n={worker:this,workerMessage:t.data.result,modules:this._modules,data:i,isRunning:e};if(!s)return e?(this.fire(Yo,n),this.send(i.data)):(this.fire(Yo,n),this.stop());this.resolve()}destroy(){super.destroy(),this._worker.terminate()}send(t){return this._complete||this._worker.postMessage(ov(t)),this}};function PR(t={}){const e=Object.keys(t),s=[];for(let i=0,n=e.length;i<n;i++){const r=e[i],o=t[r];if(typeof o!="function")throw new Error(`Asynchronous worker: dependency "${r}" is not found`);{const a=zR(o);a?(s.push(_p(o,r)),a!==r&&s.push(`var ${r} = ${a};`)):s.push(`var ${r} = ${_p(o,r)};`)}}return s.join(`
`)}function _p(t,e){const s=t.toString();return lE.test(s)?`function ${t.name||e} ${s.substring(s.indexOf("("))}`:dE.test(s)?`const ${t.name||e} = ${s.toString()}`:s}function zR(t){const e=t.toString();return t.name?t.name:lE.test(e)?null:e.substring(9,e.indexOf("(")).trim()}var DR=class extends aE{constructor(t,e){super(t,e),this._context=this._createContext()}sync(t){if(t&&t.type===nd)return this._stop(this._context),void this.resolve();const e=this._update(t,this._context),s=this._isRunning(this._context,t),i={data:void 0},n={worker:this,workerMessage:e,modules:this._modules,data:i,isRunning:s};return s?(this.fire(Yo,n),this.send(i.data)):(this.fire(Yo,n),this.stop())}send(t){return this._complete||this._modules.dom.setTimeout((()=>{this.sync(t)}),0),this}},kR=3,OR=class extends te{constructor(){super(...arguments),this._pool={}}create(t,e){const s=e&&rv,i=this._modules,n=`${t.name||"worker"}-${s?"async":"sync"}`;let r=this._pool[n];r||(r=this._pool[n]=[]);let o=r.find((a=>!a.isBusy()));return o?o.configure(t):(o=s?new FR(t,i):new DR(t,i),this._pool[n].push(o)),o.on(nd,(()=>{this._pool[n].length<=kR||(o.destroy(),this._pool[n]=this._pool[n].filter((a=>a!==o)))})),o}start(t,e){return t.start(e)}run(t,e,s){const i=this.create(t,s);return this.start(i,e)}destroy(){for(const t in this._pool)this._pool[t].forEach((e=>e.destroy())),delete this._pool[t]}};function BR(t,e,s,i=t.getNodes()){if(!e)return s?t.nodeList():i.filter((n=>n.getMetaNode()===null));if(!(e instanceof Pi)){if(Array.isArray(e)&&e.length>0)return t.getNodes(e);throw Error("[Layout]: 'nodes' must be a NodeList or an NodeId[]")}return e}function UR(t,e,s=t.getEdges()){if(!e)return s;if(!(e instanceof Un)){if(Array.isArray(e)&&e.length>0)return t.getEdges(e);throw Error("[Layout]: 'edges' must be a EdgeList or a valid EdgeId[]")}return e}function GR(t){if(!t.size)return;const e=new Set(t.getId());return t.getAdjacentEdges().filter((s=>s.getExtremities().getId().every((i=>e.has(i)))))}function hE(t,e={},s=!0){s||(e.edges=void 0);const i=BR(t,e.nodes,e.edges),n=UR(t,e.edges,GR(i));return{...e,nodes:i.concat(n.getExtremities()).dedupe(),edges:n}}var VR=16,yp="cubicOut",xp={duration:300,locate:!1},qR=new Set(["force"]),HR=class extends te{constructor(){super(...arguments),this.resolves=new Map,this._batchMode=!1,this._batchStarted=!1,this._batches=new Map,this._running=[],this._textsHidden=!1,this.onInteractionStart=()=>{this.setWorkersIdle(!0)},this.onViewChanged=()=>{this.setWorkersIdle(!1)},this.onVisibilityChange=()=>{Fi().hidden?this.setWorkersIdle(!0):this.setWorkersIdle(!1)},this._onWorkerUpdate=(t,e,s,i,n)=>{const{duration:r,onSync:o,onUpdate:a,dryRun:l,locate:d}=i,h=n.workerMessage,u=n.isRunning;if(o&&this._modules.dom.setTimeout((()=>o(h,this._modules,u)),r),s){const c=s(h,this._modules,u);this._modules.events.fire("layoutComputed",{type:"layoutComputed",name:e,positions:c}),a&&a(h,c,u),this._assignNodePositions(c,r,l,i.easing).then((()=>{u||this._onWorkerComplete(t,c,h,this._layouts[e],i,t.getData())})),u||d&&c&&this._animateCamera(c,d,i.duration)}else u||t.fire("taskComplete",h)},this._onWorkerComplete=(t,e,s,i,n,r)=>{for(let c=0;c<this._running.length;c++)if(this._running[c]===t){this._running.splice(c,1);break}i.onStop&&e&&i.onStop(n,e,this._modules);const o=this._batchMode&&this._batchStarted&&this._batches.get(i.name);if(o){const c=this._batches.get(i.name),g=c.subGraphs,m=c.resolves;let f=0;for(let p=0;p<g.length;p++){const _=m[p],x=g[p].length,y=f,b=new Uint32Array(r.indexes.slice(f,f+x)),v=this._modules.graph.nodeList(b),A=n.dryRun&&e?e:this.collectNodesData(v),S=v.getId(),w={before:Yr({...r,indexes:b},y),current:Yr({...A,indexes:b},y)};this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:w,ids:S}),_({name:i.name,positions:w,ids:S}),f+=x}}const a=this._modules.graph.nodeList(new Uint32Array(r.indexes)),l=n.dryRun&&e?e:this.collectNodesData(a),d=a.getId(),h={before:Yr(r),current:Yr(l)};if(o||this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:h,ids:d}),n.onEnd&&n.onEnd(s),n.skipTextDrawing&&this._textsHidden&&(this._modules.graphics.showTexts(),this._textsHidden=!1),!this.resolves.has(t))throw new Error("Worker not found");const u=this.resolves.get(t);this.resolves.delete(t),u({name:i.name,positions:h,ids:d}),t.setBusy(!1)},this._onWorkerStart=(t,e,s)=>{e.skipTextDrawing&&!this._textsHidden&&(this._modules.graphics.hideTexts(),this._textsHidden=!0);const i=this._modules.graph.getNodes(e.nodes),n=this.collectNodesData(i),r=n.ids;s.setData(n),this._modules.events.fire("layoutStart",{type:"layoutStart",name:t.name,ids:r,worker:s})}}onMounted(){this._layouts={},this.timers=new Map,this.resolves=new Map,this._modules.events.register(["layoutGetData","layoutPrepare","layoutStart","layoutEnd","layoutComputed"]),this._modules.events.on("clearGraph",(()=>this.stop())).on(["dragStart","zoomStart"],this.onInteractionStart).on(["dragEnd","viewChanged"],this.onViewChanged),this._modules.dom.addDocumentEventListener("visibilitychange",this.onVisibilityChange)}setWorkersIdle(t){this._running.forEach((e=>e.setIdle(t)))}register(t){if(this._layouts[t.name])throw new Error(`Layout ${t.name} already exists`);this._layouts[t.name]=t}getAvailableLayouts(){return Object.keys(this._layouts)}enableBatching(){this._batchMode||(this._batches.clear(),this._batchMode=!0,this._batchStarted=!1)}runBatch(){const t=Array.from(this._batches.keys());return this._batchStarted=!0,Promise.all(t.map((e=>{const s=this._batches.get(e);return s.options.groups=s.subGraphs,this.start(e,s.options)}))).finally((()=>{this._batchStarted=!1,this._batches.clear(),this._batchMode=!1}))}_addToBatch(t,e,s){e.nodes.isList||(e.nodes=this._modules.graph.getNodes(e.nodes));const i=e.nodes.size;if(e.edges.isList||(e.edges=this._modules.graph.getEdges(e.edges)),!this._batches.has(t))return this._batches.set(t,{resolves:[s],subGraphs:[Array.from({length:i}).map(((o,a)=>a))],options:e});const n=this._batches.get(t);n.resolves.push(s);const r=n.options.nodes.size;n.options.nodes=n.options.nodes.concat(e.nodes),n.options.edges=n.options.edges.concat(e.edges),n.options.xs&&e.xs&&(n.options.xs=n.options.xs.concat(e.xs)),n.options.ys&&e.ys&&(n.options.ys=n.options.ys.concat(e.ys)),n.options.rs&&e.rs&&(n.options.rs=n.options.rs.concat(e.rs)),n.subGraphs.push(Array.from({length:i}).map(((o,a)=>a+r)))}start(t,e={}){const s=this._layouts[t];this._modules.events.fire("layoutPrepare",{name:t,params:e});const i=hE(this._modules.graph,e,["radial","grid"].indexOf(t)===-1);return new Promise((n=>{if(!s)throw new Error(`layout ${t} does not exist`);if(this._batchMode&&!this._batchStarted&&qR.has(t))return this._addToBatch(t,i,n);i.duration=typeof i.duration=="number"?i.duration:xp.duration;const r=s.onSync;i.skipTextDrawing=i.skipTextDrawing===void 0?!0:!!i.skipTextDrawing;let o=i.locate||xp.locate;o&&typeof o=="boolean"&&(o={}),i.locate=o;const a={name:t,update:s.update,isRunning:s.isRunning,configure:s.configure,context:s.context,imports:s.imports,stop:s.stop,setIdle:s.setIdle};this._modules.graphics.forceAttributesComputation();const l=i.useWebWorker===void 0?!0:!!i.useWebWorker,d=this._modules.workers.create(a,l);this.resolves.set(d,n),d.on(rE,(()=>{s.onStart?.(e),this._onWorkerStart(s,i,d)})).on(oE,(h=>{this._modules.events.fire("layoutGetData",{name:t,data:h})})).on(Yo,(h=>{const u=h.workerMessage,c=u.lastUpdate||-1/0,g=h.isRunning,m=ps();g&&(!i.continuous||m-c<VR)||(u.lastUpdate=m,this._onWorkerUpdate(d,t,r,i,h))})),this._modules.workers.start(d,i),this._running.push(d)}))}_animateCamera(t,e,s){if(t.indexes.length===0)return Promise.resolve();const i=this._modules.locate.layoutDataBoundingBox(t),n=this._modules.locate.computeConfigForBounds(i,e);return this._modules.camera.setView(n,{duration:s,easing:e.easing||yp,ignoreZoomLimits:!0})}stop(){for(;this._running.length!==0;){const t=this._running.pop();t.stop(),t.fire("taskComplete",null)}return Promise.resolve()}isRunning(){return this._running.length!==0}_assignNodePositions(t,e,s,i=yp){if(!t||s){const d=t?new Uint32Array(t.indexes):void 0,h=this._modules.graph.nodeList(d);return Promise.resolve(h)}const{indexes:n,x:r,y:o}=t,a=this._modules.graph.nodeList(new Uint32Array(n)),l=Yr(t);for(let d=0;d<l.length;d++)l[d]={x:r[d],y:o[d]};return a.setAttributes(l,{duration:e,easing:i})}collectNodesData(t){const e=t._indexes,s=this._modules.graph.getNodeAttribute("x").getMultiple(e),i=this._modules.graph.getNodeAttribute("y").getMultiple(e);return{ids:t.getId(),indexes:e,x:s,y:i}}};function Yr({x:t,y:e,indexes:s},i=0){const n=s.length,r=new Array(n);for(let o=0;o<n;o++)r[o]={x:t[o+i],y:e[o+i]};return r}function bp(t){return typeof t=="number"&&isNaN(t)}var vp=class{constructor(){this._keys=[],this._values=[]}set(t,e){const s=this._getIndex(t);return s===-1?(this._keys.push(t.slice()),this._values.push(e),!0):(this._values[s]=e,!1)}get(t){const e=this._getIndex(t);return e===-1?void 0:this._values[e]}has(t){return this._getIndex(t)!==-1}delete(t){const e=this._getIndex(t);return e!==-1&&(this._keys.splice(e,1),this._values.splice(e,1),!0)}keys(){return this._keys.map((t=>t.slice()))}values(){return this._values.slice()}_getIndex(t){for(let e=0;e<this._keys.length;e++){const s=this._keys[e];if(s.length===t.length){let i=!0;for(let n=0;n<t.length;n++){const r=s[n],o=t[n];if(!(r===o||bp(r)&&bp(o))){i=!1;break}}if(i)return e}}return-1}get size(){return this._keys.length}},jR=class{constructor(){this._map=new Map,this._arrays=new vp}clear(){return this._arrays=new vp,this._map.clear()}delete(t){return as(t)?this._arrays.delete(t):this._map.delete(t)}get(t){return as(t)?this._arrays.get(t):this._map.get(t)}set(t,e){return as(t)?this._arrays.set(t,e):this._map.set(t,e),this}keys(){return[...y0(this._map),...this._arrays.keys()]}values(){return[...x0(this._map),...this._arrays.values()]}get size(){return this._map.size+this._arrays.size}},YR=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s||[],this._filter=i,this._unwindArrays=n,this._onUpdateHandlers=[],this._triggerUpdate=r=>{for(let o=0;o<this._onUpdateHandlers.length;++o)this._onUpdateHandlers[o](r)},this._info=t.watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}onUpdate(t){this._onUpdateHandlers.push(t)}getPropertyInfo(){return this._info}getPath(){return this._path.slice()}destroy(){this._module.unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}},XR=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s,this._filter=i,this._unwindArrays=n,this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[]}get path(){return this._path}onPropertyAdded(t){return this._onAddHandlers.push(t),this}onPropertyRemoved(t){return this._onRemoveHandlers.push(t),this}onPropertyUpdated(t){return this._onUpdateHandlers.push(t),this}getPath(){return this._path.slice()}getProperties(){return this._propertyList.slice()}getPropertyInfo(t){const e=this._properties[t];return e?e.info:null}destroy(){_i(this._properties,(({handler:e},s)=>{const i=this._path.concat([s]);this._module.unwatchPropertyInformation(this._isNode,i,e,this._filter,this._unwindArrays)})),this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[];const t=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(t,1)}updateSubPropertiesToWatch(t,e){if(t!==this._isNode)return;const s=e.getData(this._path);for(let i=0;i<s.length;i++){const n=s[i];if(Dn(n)){const r=Object.keys(n);for(let o=0;o<r.length;o++)this._addSubPropertyToWatch(r[o])}}}_addSubPropertyToWatch(t){if(!this._properties[t]){const e=this._path.concat([t]),s=()=>this._triggerPropertyUpdate(t),i=this._unwindArrays,n=this._isNode,r=this._filter,o=this._module.watchPropertyInformation(n,e,s,r,i);this._properties[t]={handler:s,info:o},this._triggerPropertyUpdate(t)}}_triggerPropertyUpdate(t){const{info:e}=this._properties[t],s=this._propertyList.indexOf(t),i=s!==-1,n=e.getType()!=="undefined";!i&&n?(this._propertyList.push(t),this._triggerHandlers("_onAddHandlers",t,e),this._triggerHandlers("_onUpdateHandlers",t,e)):i&&!n?(this._propertyList.splice(s,1),this._triggerHandlers("_onUpdateHandlers",t,e),this._triggerHandlers("_onRemoveHandlers",t,e)):i&&n&&this._triggerHandlers("_onUpdateHandlers",t,e)}_triggerHandlers(t,e,s){const i=this[t];for(let n=0,r=i.length;n<r;n++)i[n](e,s)}},WR=class{constructor(){}setWatcher(t){this._watcher=t}isNode(){return this._watcher.isNode}getPath(){return this._watcher.property.slice()}getBoundaries(){const t=this._watcher.boundaries;return t?{min:t.min,max:t.max}:null}getValues(){return this._watcher.values.keys()}getValueCount(t){return this._watcher.values.get(t)||0}getCount(){return this._watcher.total}getType(){return this._watcher.any>0?"any":this._watcher.numbers>0?"number":"undefined"}},$R=class extends te{constructor(){super(...arguments),this._onExcludedStateChange=({elements:t,value:e})=>{const s=!e;for(let i=0,n=this._propertyWatchers.length;i<n;i++){const r=this._propertyWatchers[i];r.isNode===t.isNode&&r.filter==="visible"&&(s?go(r,t.getData(r.property)):Tl(r,t.getData(r.property)),sl(r))}},this._onDataChange=({isNode:t,changes:e})=>{for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.property,r=i.filter==="all";if(i.isNode===t)for(let o=0;o<e.length;++o){const a=e[o],l=QR(a.property||[],n);if(l){const d=a.nodes||a.edges,h=[],u=[];if(d)for(let c=0;c<d.size;++c){const g=d.get(c);(r||g.isVisible())&&(h.push(ze(a.newValues[c],l)),u.push(ze(a.previousValues[c],l)))}h.length&&(go(i,h),Tl(i,u),sl(i))}}}for(let s=0,i=this._objectPropertyWatchers.length;s<i;s++){const n=this._objectPropertyWatchers[s],r=n.path;for(let o=0;o<e.length;++o){const{property:a,nodes:l,edges:d}=e[o],h=l||d;if(h){const u=h.isNode;(!a||a.length<=r.length+1&&r.every(((c,g)=>c===a[g])))&&n.updateSubPropertiesToWatch(u,h)}}}},this._onElementsAdded=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s];if(i.isNode===e.isNode){const n=e.getData(i.property);n.length&&(go(i,n),sl(i))}}for(let s=0;s<this._objectPropertyWatchers.length;s++)this._objectPropertyWatchers[s].updateSubPropertiesToWatch(e.isNode,e)},this._onElementsRemoved=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.filter==="all";if(i.isNode===e.isNode&&n){const r=e.getData(i.property);r.length&&(Tl(i,r),sl(i))}}},this._onGraphClear=()=>{this._propertyWatchers.forEach((t=>{t.numbers=0,t.any=0,t.total=0,t.boundaries=null,t.values.clear()}))}}onMounted(){this._propertyWatchers=[],this._objectPropertyWatchers=[],this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on(["updateNodeData","updateEdgeData"],this._onDataChange).on(["addNodes","addEdges"],this._onElementsAdded).on(["removeNodes","removeEdges"],this._onElementsRemoved).on("clearGraph",this._onGraphClear)}watchNodeObjectProperty(t){return this._watchObjectProperty(!0,il(t))}watchEdgeObjectProperty(t){return this._watchObjectProperty(!1,il(t))}watchNodeNonObjectProperty(t){return this._watchNonObjectProperty(!0,il(t))}watchEdgeNonObjectProperty(t){return this._watchNonObjectProperty(!1,il(t))}watchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n)||this._createWatcher(t,e,i,n);return s&&r.onChange.push(s),r.info}unwatchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n);if(!r)return;const o=r.onChange,a=o.indexOf(s);if(a!==-1&&(o.splice(a,1),o.length===0)){const l=this._propertyWatchers.indexOf(r);this._propertyWatchers.splice(l,1)}}_watchObjectProperty(t,e){const s=new XR(this,t,e);return this._objectPropertyWatchers.push(s),s.updateSubPropertiesToWatch(t,this._modules.graph[t?"getNodes":"getEdges"](e.filter)),s}_watchNonObjectProperty(t,e){return new YR(this,t,e)}_findWatcher(t,e,s,i){for(let n=0;n<this._propertyWatchers.length;++n){const r=this._propertyWatchers[n];if(r.isNode===t&&r.filter===s&&r.unwindArrays===i&&KR(r.property,e))return r}return null}_createWatcher(t,e,s,i){const n={isNode:t,property:e,numbers:0,any:0,total:0,values:new jR,boundaries:null,onChange:[],filter:s,unwindArrays:i,info:new WR};return n.info.setWatcher(n),go(n,this._modules.graph[t?"getNodes":"getEdges"](s).getData(e)),this._propertyWatchers.push(n),n}};function Ep(t){return t==null?[]:zn(t)}function ZR(t){return t==="all"?"all":"visible"}function sl(t){for(let e=0;e<t.onChange.length;++e)t.onChange[e](t.info)}function KR(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}function QR(t,e){if(t.length>e.length)return null;let s=0;for(;s<t.length;++s)if(t[s]!==e[s])return null;return e.slice(s)}function go(t,e,s){const i=t.values,n=!s&&t.unwindArrays;for(let r=0;r<e.length;++r){const o=e[r];if(s||o===void 0||(t.total+=1),n&&Array.isArray(o))go(t,o,!0);else{const a=i.get(o);a?i.set(o,a+1):(i.set(o,1),wd(o)?(t.boundaries?o<t.boundaries.min?t.boundaries.min=o:o>t.boundaries.max&&(t.boundaries.max=o):t.boundaries={min:o,max:o},t.numbers+=1):o!==void 0&&(t.any+=1))}}}function Tl(t,e,s){const i=t.values,n=!s&&t.unwindArrays,r=t.boundaries;let o=!1;for(let a=0;a<e.length;++a){const l=e[a];if(s||l===void 0||(t.total-=1),n&&Array.isArray(l))o=o||Tl(t,l,!0);else{const d=i.get(l);d>1?i.set(l,d-1):(i.delete(l),wd(l)?(t.numbers-=1,!r||r.min!==l&&r.max!==l||(o=!0)):l!==void 0&&(t.any-=1))}}return!s&&o&&(t.boundaries=JR(i.keys())),o}function JR(t){let e=null,s=null;for(let i=0;i<t.length;++i){const n=t[i];wd(n)&&((e==null||n<e)&&(e=n),(s==null||n>s)&&(s=n))}return e==null||s==null?null:{min:e,max:s}}function il(t){return typeof t!="object"||t===null||Array.isArray(t)?{path:Ep(t),filter:"visible",unwindArrays:!1}:{path:Ep(t.path),filter:ZR(t.filter||"visible"),unwindArrays:!!t.unwindArrays}}var tF=class extends te{onMounted(){this._modules.events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])}get x(){return this._modules.position.x||0}get y(){return this._modules.position.y||0}_later(){return this._modules.dom.afterNextFrame()}move({x:t,y:e}){if(t!==void 0&&e!==void 0){const s=t-this.x,i=e-this.y;this._modules.events.fire("virtualMove",{x:t,y:e,dx:s,dy:i})}return Promise.resolve()}down({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then((()=>{this._modules.events.fire("virtualDown",{x:this.x,y:this.y,button:s}),this._modules.events.fire("virtualMove",{x:this.x,y:this.y,dx:0,dy:0,button:s})}))}up({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then((()=>{this._modules.events.fire("virtualUp",{x:t,y:e,button:s})}))}click({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then((()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})}))}rightClick({x:t,y:e,button:s="right"}={}){return this.move({x:t,y:e}).then((()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})}))}doubleclick({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then((()=>{this._modules.events.fire("virtualDoubleClick",{x:t,y:e,button:s})}))}drag(t,e){return this.down(t).then((()=>this.move(e))).then((()=>this.up(e)))}wheel({x:t,y:e,dx:s,dy:i,delta:n,metaKey:r,ctrlKey:o}){return this.move({x:t,y:e}).then((()=>(this._modules.events.fire("virtualWheel",{x:t,y:e,dx:s,dy:i,delta:n,domEvent:{metaKey:r,ctrlKey:o}}),this._later())))}};function Us(t,e,s,i,n,r){const o=Ns(),a=r.graphToScreenCoordinates(t),l=r.graphToScreenCoordinates(e);n.beginPath(),n.moveTo(a.x*o,a.y*o),n.lineTo(l.x*o,l.y*o),n.strokeStyle=i,n.lineWidth=s,n.stroke()}function Ap(t,e,s,i){let n,r,o,a=0,l=t.length-1;for(;a<l&&a>-1;)if(n=(a+l)/2|0,r=Math.abs(e[t[n]]-s),o=Math.abs(e[t[n+1]]-s),o<r)a=n+1;else if(o>r)l=n;else{const d=Math.abs(e[t[a]]-s),h=Math.abs(e[t[l]]-s);if(d<h)l=n;else{if(!(d>h))return l;a=n+1}}return i?l:t[l]}function Sp(t,e,s,i,n,r,o){let a,l,d,h,u,c;for(let g=0,m=t.length;g<m;g++)for(let f=0;f<m;f++){if(g===f)continue;let p=t[g],_=t[f];f<g&&(h=_,_=p,p=h);const x=e[p],y=e[_],b=r.get(p),v=r.get(_);if(x+b<i-n&&y-v>i+n&&Math.abs(Math.abs(x+b-(i-n))-Math.abs(y-v-(i+n)))<=o)return a=p,l=s,d=_,c=x+b+Math.abs(y-v-(x+b))/2,u=[x+b,c-n,c+n,y-v],{a,b:l,c:d,current:s,target:c,points:u};if(x+b<i-n&&y+v<i-n&&Math.abs(Math.abs(x+b-(y-v))-Math.abs(Math.max(x+b,y+v)-(i-n)))<=o)return a=p,l=_,d=s,c=y+b+Math.abs(Math.abs(x+b-(y-v)))+n,u=[x+b,y-v,y+v,c-n],{a,b:l,c:d,current:s,target:c,points:u};if(x-b>i+n&&y-v>i+n&&Math.abs(Math.abs(x+b-(y-v))-Math.abs(Math.min(x-b,y-v)-(i+n)))<=o)return a=s,l=p,d=_,c=x-b-Math.abs(Math.abs(x+b-(y-v)))-n,u=[c+n,x-b,x+b,y-v],{a,b:l,c:d,current:s,target:c,points:u}}return null}var xh={enabled:!1,tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:!0,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:!0,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}},eF=class extends te{constructor(){super(...arguments),this._options=ke(xh),this._enabled=!1,this._ysnap=0,this._xsnap=0,this._node=null,this._nodes=null,this._r=0,this._vguideline={start:{x:0,y:0},end:{x:0,y:0}},this._hguideline={start:{x:0,y:0},end:{x:0,y:0}},this._gridResolution=0,this._onNodeDragStart=({nodes:e})=>{e.size===1&&(this._node=e.get(0),this._cacheViewportData(),this._r=Number(this._node.getAttribute("radius")))},this._onNodeDragEnd=()=>{this._node=null,this._layer.refresh()}}onMounted(){this._options=ke(xh),this._enabled=!1}enable(e){this._enabled||(this._options=Os(e,xh),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((s=>{s.clearRect(0,0,s.canvas.width,s.canvas.height)}),{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._modules.events.on("nodesDragStart",this._onNodeDragStart).on("nodesDragEnd",this._onNodeDragEnd),this._modules.settings.update({"interactions.drag.onBeforeDrag":(s,i,n,r)=>this._onBeforeDrag(i,n,r)}))}disable(){this._enabled&&(this._modules.events.off(this._onNodeDragStart).off(this._onNodeDragEnd),this._layer.destroy(),this._modules.settings.update({"interactions.drag.onBeforeDrag":null}),this._enabled=!1)}enabled(){return this._enabled}_onBeforeDrag(e,s,i){if(this._node){const n=i[0];this._layer.refresh((r=>{this._scan(r,n)})),this._node.setAttributes(n)}}_cacheViewportData(){const e=this._modules.camera,s=e.screenToGraphCoordinates({x:0,y:0}),i=e.screenToGraphCoordinates({x:e.width,y:e.height});if(this._nodes=this._modules.spatial.getNodesByBoundingBox(s.x,s.y,i.x,i.y),this._node==null)return;const n=this._node._index,r=Array.from(this._nodes._indexes);r.splice(r.indexOf(n),1);const o=this._modules.graph.getNodeAttribute("radius"),a=this._modules.graph.getNodeAttribute("x"),l=this._modules.graph.getNodeAttribute("y"),d=a.buffer(),h=l.buffer(),u=Qr(r.slice(),a),c=Qr(r.slice(),l),g={},m={};this._gridResolution=Number(this._node.getAttribute("radius"));const f=this._gridResolution;for(let p=0,_=r.length;p<_;p++){const x=u[p],y=c[p],b=d[x]/f|0,v=h[y]/f|0;g[b]||(g[b]=[]),m[v]||(m[v]=[]),g[b].push(x),m[v].push(y)}this._nodesByX=u,this._nodesByY=c,this._xGrid=g,this._yGrid=m,this._xList=a,this._yList=l,this._X=d,this._Y=h,this._R=o}_scan(e,s){if(this._node==null)return;const i=this._node._index,n=s.x,r=s.y,o=this._r,a=this._options,l=this._xList,d=this._yList,h=this._R,u=this._X,c=this._Y,g=this._modules.camera.zoom,m=Math.min(o,this._options.tolerance/g),f=2*o*a.sideSnapDistanceFactor,p=a.guidelineWidth,_=a.guidelineColor;let x,y,b,v,A,S,w,I,M=i,N=i,D=null,q=!1,et=!1;if(M=Ap(this._nodesByX,u,n),N=Ap(this._nodesByY,c,r),Math.abs(u[M]-n)>a.centerSnapDistance&&(M=i),Math.abs(c[N]-r)>a.centerSnapDistance&&(N=i),this._xsnap=0,M!==i){x=this._vguideline.start,y=this._vguideline.end,I=M,b=u[I],v=c[I],D=h.get(I),w=Math.abs(n-b);const O=Math.abs(n-o-(b-D)),K=Math.abs(n+o-(b+D));if(w<Math.max(o,D)){v<r?(x.y=v-D,y.y=r+o):(x.y=v+D,y.y=r-o);const j=Math.min(O,w,K);j===w?(x.x=y.x=b,y.y=r,x.y=v,this._xsnap=1):Math.abs(r-v)<D+o+f&&(j===O?(x.x=y.x=b-D,this._xsnap=2):(x.x=y.x=b+D,this._xsnap=3)),j<m&&(q=!0)}this._xsnap!==0&&Us(x,y,p,_,e,this._modules.camera)}if(this._ysnap=0,N!==i){x=this._hguideline.start,y=this._hguideline.end,I=N,b=u[I],v=c[I],D=h.get(I),w=Math.abs(r-v);const O=Math.abs(r-o-(v-D)),K=Math.abs(r+o-(v+D));if(w<Math.max(o,D)){b<n?(x.x=b-D,y.x=n+o):(x.x=b+D,y.x=n-o);const j=Math.min(O,w,K);j===w?(x.y=y.y=v,y.x=n,x.x=b,this._ysnap=1):Math.abs(n-b)<D+o+f&&(j===O?(x.y=y.y=v-D,this._ysnap=4):(x.y=y.y=v+D,this._ysnap=5)),j<m&&(et=!0)}this._ysnap!==0&&Us(x,y,p,_,e,this._modules.camera)}if(D!=null&&a.preferredDistance.enabled){const O=a.preferredDistance.ratio,K=Math.min(a.preferredDistance.tolerance/g,o),j=Math.max(o,D);if(M===i||this._xsnap!==0&&q){if(N!==i&&(this._ysnap===0||!et)&&(I=N,b=u[I],v=c[I],D=h.get(I),S=Math.abs(r-v)-(o+D)*(1+O),S<=K&&S>=-K)){const ot=r<v?-1:1;x=this._hguideline.start,y=this._hguideline.end,x.x=b-j,y.x=b+j,x.y=y.y=v,Us(x,y,p,_,e,this._modules.camera),x.x=n-j,y.x=n+j,x.y=y.y=v+ot*(1+O)*(o+D),Us(x,y,p,_,e,this._modules.camera),this._ysnap=1,et=!0}}else if(I=M,b=u[I],v=c[I],D=h.get(I),A=Math.abs(n-b)-(o+D)*(1+O),A<=K&&A>=-K){const ot=n<b?-1:1;x=this._vguideline.start,y=this._vguideline.end,x.x=y.x=b+ot*(1+O)*(o+D),x.y=v-j,y.y=v+j,x.x=y.x=b,Us(x,y,p,_,e,this._modules.camera),x.y=r-j,y.y=r+j,x.x=y.x=b+ot*(1+O)*(o+D),Us(x,y,p,_,e,this._modules.camera),this._xsnap=1,q=!0}}if(a.neighbours.enabled){const O=this._gridResolution,K=n/O|0,j=r/O|0,ot=this._xGrid,it=this._yGrid,ct=[],pt=[].concat(it[j-1]||ct,it[j]||ct,it[j+1]||ct),Pt=[].concat(ot[K-1]||ct,ot[K]||ct,ot[K+1]||ct);let At;pt.length>1&&(Qr(pt,l),At=Sp(pt,u,i,n,o,h,m),At&&(this._drawNeighbourGuidelines(e,At,s,!1),q=!1)),Pt.length>1&&!At&&(Qr(Pt,d),At=Sp(Pt,c,i,r,o,h,m),At&&(this._drawNeighbourGuidelines(e,At,s,!0),et=!1))}(q||et)&&this._snap(s,!q,!et)}_drawNeighbourGuidelines(e,{a:s,b:i,c:n,points:r,target:o},a,l){const d={x:0,y:0},h={x:0,y:0},u=this._R,c=this._X,g=this._Y;let[m,f,p]=u.getMultiple([s,i,n]);const{offset:_,lineWidth:x,lineColor:y}=this._options.neighbours;let b,v;l?(a.y=o,m=-m,f=-f,p=-p,b=h.x=d.x=Math.min(c[s]+m,c[i]+f,c[n]+p)-_,v=c):(a.x=o,b=h.y=d.y=Math.max(g[s]+m,g[i]+f,g[n]+p)+_,v=g);const A=l?"y":"x",S=l?"x":"y";d[A]=r[0],h[A]=r[1],Us(d,h,x,y,e,this._modules.camera),d[A]=r[2],h[A]=r[3],Us(d,h,x,y,e,this._modules.camera),d[A]=r[0],d[S]=b-_/2,h[A]=r[0],d[S]=v[s]+m,Us(d,h,x,y,e,this._modules.camera),d[A]=r[1],d[S]=b-_/2,h[A]=r[1],d[S]=v[i]+f,Us(d,h,x,y,e,this._modules.camera),d[A]=r[2],d[S]=b-_/2,h[A]=r[2],d[S]=v[i]+f,Us(d,h,x,y,e,this._modules.camera),d[A]=r[3],d[S]=b-_/2,h[A]=r[3],d[S]=v[n]+p,Us(d,h,x,y,e,this._modules.camera)}_snap(e,s,i){const n=this._xsnap,r=this._ysnap;let o;s||n===0||(o=this._vguideline.end,e.x=n===2?o.x+this._r:n===3?o.x-this._r:o.x),i||r===0||(o=this._hguideline.end,e.y=r===4?o.y+this._r:r===5?o.y-this._r:o.y)}},sF=class{constructor(t,e,s){this._module=t,this._id=e,this._whenApplied=s.then((()=>this))}getId(){return this._id}whenApplied(){return this._whenApplied}refresh(){return this._module.refreshRule(this._id)}getIndex(){return this._module.getRuleIndex(this._id)}setIndex(t){return this._module.setRuleIndex(this._id,t)}update(t){return this._module.updateRule(this._id,t)}getDefinition(){return this._module.getRuleDefinition(this._id)}destroy(){return this._module.destroyRule(this._id)}},iF=1e3,nF=1/iF,rF=class extends te{constructor(){super(...arguments),this._idCounter=1,this._rules=[]}onMounted(){this._rules=[],this._modules.events.register(["addStyleRule","removeStyleRule","updateStyleRule","refreshStyleRule"])}_get(t){for(let e=0;e<this._rules.length;++e){const s=this._rules[e];if(s.id===t)return s.index=e,s}throw new Error("calling a method on a destroyed style rule")}_updatePriorities(){for(let t=0;t<this._rules.length;++t){const e=this._rules[t],s=wT+t*nF;e.attributeLayer.update({priority:s})}}addRule(t={}){const e=this._idCounter++,s=this._modules.graphics.addAttributeLayer({name:`rule(${e})`,...wp(t)}),i=this._modules.dom.afterNextFrame(),n=new sF(this,e,i),r={id:e,attributeLayer:s,wrapper:n};return this._rules.push(r),this._updatePriorities(),this._modules.events.fire("addStyleRule",{rule:r,options:t,id:r.id}),n}getRuleIndex(t){const e=this._get(t);return e.index==null?null:e.index}setRuleIndex(t,e){const s=this._get(t),i=Ws(e,0,this._rules.length-1);return this._rules.splice(s.index,1),this._rules.splice(i,0,s),this._updatePriorities(),this._modules.dom.afterNextFrame()}updateRule(t,e){const s=this._get(t),i=Object.assign({fullOverwrite:e.fullOverwrite},e);return s.attributeLayer.update(i),this._modules.events.fire("updateStyleRule",{rule:s,options:e}),this._modules.dom.afterNextFrame()}getRuleDefinition(t){return wp(this._get(t).attributeLayer.getDefinition())}destroyRule(t){const e=this._get(t);return this._modules.events.fire("removeStyleRule",{rule:e,id:e.id}),e.attributeLayer.destroy(),this._rules.splice(e.index,1),this._modules.dom.afterNextFrame()}refreshRule(t){const e=this._get(t);return e.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:e,id:t}),this._modules.dom.afterNextFrame()}refreshAllRules(){for(const t of this._rules)t.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:t,id:t.id});return this._modules.dom.afterNextFrame()}getRuleList(){return this._rules.map((t=>t.wrapper))}};function wp(t){return{nodeAttributes:t.nodeAttributes,edgeAttributes:t.edgeAttributes,nodeSelector:t.nodeSelector,edgeSelector:t.edgeSelector,nodeDependencies:t.nodeDependencies,edgeDependencies:t.edgeDependencies,nodeOutput:t.nodeOutput,edgeOutput:t.edgeOutput}}var Xu,Tp={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t})=>t.setSelected(!0),bothExtremities:!1},uE=class extends te{constructor(){super(...arguments),this._enabled=!1,this._points=[],this._bbox=new Cs,this._onStart=({x:t,y:e})=>{this._bbox.reset(),this.savePoint(t,e,!1)},this._onStop=()=>{const{minX:t,minY:e,maxX:s,maxY:i}=this._bbox,{nodes:n,edges:r}=this._modules.spatial.queryProjected(t,e,s,i),o={},a=n.filter((h=>{const u=h.isVisible(),c=h.getAttribute("detectable"),g=u&&c&&this._modules.locate.isNodeInPolygon(h,this._points);return o[h._index]=g,g}));let l=r.filter((h=>{const u=h.isVisible(),c=h.getAttribute("detectable");return u&&c&&this._modules.locate.isEdgeInPolygon(h,this._points)}));this._options.bothExtremities&&(l=this.filterByExtremities(l,o)),this._layer.clear();const d=this._points.slice();this._points=[],this.disable(),this._options.callback({nodes:a,edges:l,points:d})}}onMounted(){this._options=ke(Tp),this._cachedCursor="",this._modules.events.isRegistered("lassoEnabled")||this._modules.events.register(["lassoEnabled","lassoDisabled"]),this._interaction=this._modules.interactions.onDrag({priority:"lasso",check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this.savePoint(t,e,!0),onStop:this._onStop})}enable(t={}){return this._enabled||(this._enabled=!0,this._modules.captor.setDetectionEnabled(!1),this._options=Os(t,Tp),this._layer=this._modules.layers.addCanvasLayer(ae,{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._cachedCursor=this._layer.element.parentElement?.style.cursor||"",Vl(this._layer.element.parentElement,this._options.cursorStyle),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorPosition()),this._modules.events.fire("lassoEnabled")),this}disable(){return this._enabled?(this._enabled=!1,this._modules.captor.setDetectionEnabled(!0),Vl(this._layer.element.parentElement,this._cachedCursor),this._layer.destroy(),this._modules.events.fire("lassoDisabled"),this):this}enabled(){return this._enabled}savePoint(t,e,s){const i=Ns(),n=this._options,r=this._points;if(this._bbox.addPoint(t,e),r.push({x:t,y:e}),s){const o=r[0];this._layer.refresh((a=>{a.lineWidth=n.strokeWidth,a.lineJoin="bevel",a.strokeStyle=n.strokeColor,a.fillStyle=n.fillColor,a.beginPath(),a.moveTo(o.x*i,o.y*i);for(let l=1;l<r.length;++l){const d=r[l];a.lineTo(d.x*i,d.y*i)}a.stroke(),n.fillColor&&a.fill()}))}}filterByExtremities(t,e){const s=this._modules.graph.getEdgeAttribute("source"),i=this._modules.graph.getEdgeAttribute("target");return t.filter((n=>{const r=n._index,o=s.get(r),a=i.get(r);return e[o]&&e[a]}))}},Cp={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t,edges:e})=>{t.size?t.setSelected(!0):e.setSelected(!0)},bothExtremities:!1},oF=class extends uE{constructor(){super(...arguments),this._onStart=({x:t,y:e})=>{this._rectangle.reset(),this._start={x:t,y:e},this._layer?.refresh((s=>{s.fillStyle=this._options.fillColor,s.strokeStyle=this._options.strokeColor,s.lineWidth=this._options.strokeWidth}))},this._onStop=()=>{const t=this._modules.captor.getCursorPosition(),e=this._formatRectangle(t),{nodes:s,edges:i}=this._modules.spatial.queryProjected(e.minX,e.minY,e.maxX,e.maxY),n={},r=s.filter((a=>{const l=a.isVisible(),d=a.getAttribute("detectable"),h=l&&d&&this._modules.locate.isNodeInRectangle(a,e);return n[a._index]=h,h}));let o=i.filter((a=>{const l=a.isVisible(),d=a.getAttribute("detectable");return l&&d&&this._modules.locate.isEdgeInRectangle(a,e)}));this._options.bothExtremities&&(o=this.filterByExtremities(o,n)),this._layer?.clear(),this.disable(),this._options.callback({nodes:r,edges:o,rectangle:{minX:e.minX,minY:e.minY,maxX:e.maxX,maxY:e.maxY,width:e.width,height:e.height,cx:e.cx,cy:e.cy}})}}onMounted(){this._options=ke(Cp),this._enabled=!1,this._rectangle=new Cs,this._interaction=this._modules.interactions.onDrag({priority:"lasso",disableDetection:!0,check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this._refreshRectangle({x:t,y:e}),onStop:this._onStop})}enable(t){return super.enable(Os(t,Cp))}_formatRectangle(t){const e=this._start.x,s=this._start.y,i=t.x,n=t.y,r=Math.abs(e-i),o=Math.abs(s-n),a=e<i?e:i,l=s<n?s:n;return this._rectangle.reset().addPoint(a,l).addPoint(a+r,l+o)}_refreshRectangle(t){const{minX:e,minY:s,width:i,height:n}=this._formatRectangle(t),r=Ns();this._layer?.refresh((o=>{o.strokeRect(e*r,s*r,i*r,n*r),this._options.fillColor&&o.fillRect(e*r,s*r,i*r,n*r)}))}},aF=vy(Ey()),gi=6,cE=5,Co=1,gE=0,mE=0,Wu=-1;function fE(t,e,s,i){gE=t,Xu=s,mE=e?1:0,Wu=i}var Lp=(t,e,s,i)=>n=>{const{rects:r,bboxes:o,intersects:a,indexToLayer:l,indexToRemoveNodeText:d,indexToRemoveEdgeText:h}=i;if(o[n*gi+5]===gE&&o[n*gi+4]===s)return!1;const u=n*cE,c=ga(r[u],r[u+1],r[u+2],r[u+3],r[u+4]);if(Eb(Xu,c)){if(i.realIntersection=!0,Wu<=0&&a.push(Xu,c),!(l[o[n*gi+5]]<Wu))return!0;t.remove(n),i.realIntersection=!1,o[n*gi+4]===mE?d[o[n*gi+5]]=!0:h[o[n*gi+5]]=!0}return!1};function Ip(t,e,s="#22ff00"){return $u([[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]].map((i=>({x:i[0],y:i[1]}))),e,s)}function $u(t,e,s="#ff0000"){e.strokeStyle=s,e.beginPath();for(let i=0,n=t.length;i<n;i++)i===0?e.moveTo(t[i].x,t[i].y):e.lineTo(t[i].x,t[i].y);e.closePath(),e.stroke()}function lF(t,e,s,i,n){for(let a=0,l=e.length;a<l;a+=gi)Ip(e.slice(a,a+4),t,"#aaaaaa");for(let a=0;a<s.length;a+=cE)$u(ga(s[a],s[a+1],s[a+2],s[a+3],s[a+4]),t,"green");const r=[n.root];let o=n.root;for(;o=r.pop();)o.leaf||r.push.apply(r,o.children),Ip(n.getNodeBounds(o),t,"rgba(0,0,0,0.2)"),o=r.pop();i.forEach((a=>$u(a,t,"red")))}var Xr={x1:0,y1:0,x2:0,y2:0},bh={x:0,y:0},Zn={x:0,y:0},dF=Math.PI/2,hF=0;function uF(t,e,s,i,n,r,o,a,l,d,h){const u=a.remove.nodes,c=a.remove.edges,g=a.redraw.edges,m=s.angle,f=s.zoom,p=n.x,_=n.y,x=n.radius,y=Math.PI,{source:b,target:v,scalingMethod:A}=i,S=i.width,w=i.curvature,I=i.layer,M=i.text.content,N=i.text.scaling,D=i.text.size,q=i.text.font,et=i.text.style,O=i.text.scale,K=i.text.maxLineLength,j=i.text.margin,ot=i.text.minVisibleSize,it=i.text.padding,ct=i.animationDuration,pt=i.text.adjustAngle,Pt=i.text.position;a.indexToLayer={},a.indexToQuadIndex={},a.indexToRemoveNodeText={},a.indexToRemoveEdgeText={},a.indexToRedrawEdgeText={},a.byLayer=[];const{byLayer:At,indexToLayer:bt,indexToQuadIndex:It,indexToRedrawEdgeText:Ut,indexToRemoveNodeText:Gt,indexToRemoveEdgeText:Dt}=a;for(let Lt=0;Lt<t.length;Lt++){const Kt=t[Lt],ue=I.get(Kt)-h0;for(let ne=1;ne<=ue;ne++)(At[ne]=At[ne]||[]).push(Kt);bt[Kt]=ue}if(l!==null){const Lt=At.length;for(let Kt=bt[l]+1;Kt<=Lt;Kt++)(At[Kt]=At[Kt]||[]).unshift(l);bt[l]=Lt}const Rt=[0,0,0,0],Tt=[0,0,0,0,0],{bboxes:Nt,rects:Ht}=a,qt=(Lt,Kt=-1)=>{const ue=ct.get(Lt);let ne=M?M.get(Lt):"";if(ne===null||ne===""||ue)return!1;const se=b.get(Lt),le=v.get(Lt);let ge=S.get(Lt);const ve=w.get(Lt),Le=ot.get(Lt);if(ge*f<Le)return Dt[Lt]=!0,!1;A.get(Lt)==="fixed"&&(ge/=f);let Ae=(p.get(se)+p.get(le))/2,Xt=(_.get(se)+_.get(le))/2;ne=ne?ne.toString():"";const Wt=!N.get(Lt),is=O.get(Lt)*(Wt?1:f),Rs=q.get(Lt),ds=(Wt?D.get(Lt):is*ge)*Co,vs=et.get(Lt),Oi=K.get(Lt),Bs=Pt.get(Lt)===ha;let Zs=+Bs*j.get(Lt)+i.text.padding.get(Lt);const Pe=p.get(se),Ke=_.get(se),Y=p.get(le),E=_.get(le),T=x.get(se),C=x.get(le);if(ve===0){const gt=Ir(Pe,Ke,Y,E)-m,St=T-C;Ae+=St*Math.cos(gt)/2,Xt+=St*Math.sin(gt)/2}let L;const R=se===le;if(R)L=y/4-m,Ld(Pe,Ke,ve,T,0,Xr),Uo(.5,Pe,Ke,Y,E,Xr.x1,Xr.y1,Xr.x2,Xr.y2,Zn),Ae=Zn.x,Xt=Zn.y,Zs/=-f;else{if(Pe===Y&&Ke===E)return!1;L=Ir(Pe,Ke,Y,E)-m,ve!==0&&(Gn(Pe,Ke,Y,E,ve,bh),Md(.5,Pe,Ke,Y,E,bh.x,bh.y,Zn),Ae=Zn.x,Xt=Zn.y)}const F=Zs+hF,z=k0(ne,Oi);if(!z)return!1;const{lines:V,data:H}=z;let X=r(H[0],Rs,vs,ds).width*Co;for(let gt=1;gt<V;gt++)X=Math.max(X,r(H[gt],Rs,vs,ds).width*Co);const W=V*ds,Q=X/f/2,rt=W/f/2,nt=Math.abs(ql(L))<dF?1:-1;let tt=Bs?R?W/f+ge/2+Zs:nt*(F/f+ge/2+rt):0;if(!R&&ve===0&&pt.get(Lt)){const gt=it.get(Lt);Ze(Pe,Ke,Y,E)*f-(T+C)*(h?1:f)<X+2*gt+1&&(tt*=nt,L=0)}if(Tt[0]=Ae-Q,Tt[1]=Xt-rt,Tt[2]=Ae+Q,Tt[3]=Xt+rt,Tt[4]=L+m,Yu(Tt,-(L+m),-tt,Tt),Tt[2]=Tt[2]-Tt[0],Tt[3]=Tt[3]-Tt[1],L=y-L-m,zd(Ae-Q,Xt-rt,2*Q,2*rt,L,void 0,void 0,Rt),Yu(Rt,L,tt,Rt),a.realIntersection=!1,fE(Lt,!1,ga(Tt[0],Tt[1],Tt[2],Tt[3],Tt[4]),Kt),e.traverse(Rt[0],Rt[1],Rt[2],Rt[3],d),a.realIntersection&&!o)return Dt[Lt]=!0,!1;if(Ut[Lt]=!0,Gt[Lt]=!1,Kt<=0){const gt=Nt.length/gi;It[Lt]=gt,Nt.push(Rt[0],Rt[1],Rt[2],Rt[3],0,Lt),e.insert(gt,Rt[0],Rt[1],Rt[2],Rt[3]),Ht.push(Tt[0],Tt[1],Tt[2],Tt[3],Tt[4])}else e.insert(It[Lt],Rt[0],Rt[1],Rt[2],Rt[3])};for(const Lt of t)qt(Lt);let Zt=!0;for(let Lt=0;Lt<At.length;Lt++){const Kt=At[Lt];if(Kt)if(Zt)Zt=!1;else for(const ue of Kt)qt(ue,Lt)}for(let Lt=0;Lt<t.length;Lt++){const Kt=t[Lt];Gt[Kt]?u.push(Kt):Ut[Kt]&&g.push(Kt),Dt[Kt]&&c.push(Kt)}return a}var cF={left:-1,right:1,top:0,bottom:0,center:0},gF={left:0,right:0,top:-1,bottom:1,center:0},mF={left:-1,right:0,top:-.5,bottom:-.5,center:-.5},fF={left:-.5,right:-.5,top:-1,bottom:0,center:-.5},pF=(t,e,s)=>k0(e,s.get(t))||{lines:0,data:[" "],maxLength:1},_F=(t,e,s,i,n,r,o)=>{const{lines:a,data:l}=pF(t,e,i);let d=s(l[0],n,r,o).width;for(let h=1;h<a;h++)d=Math.max(d,s(l[h],n,r,o).width);return[d,a*o*Co]},yF=(t,e,s)=>{const i=e.text.content,n=e.radius,r=e.text.scaling,o=e.text.position,a=e.text.padding,l=e.text.scale,d=e.text.size,h=e.text.style,u=e.text.font,c=e.text.maxLineLength,g=e.text.margin,m=i.get(t),f=n.get(t),p=!r.get(t),_=o.get(t),x=a.get(t),y=l.get(t),b=(p?d.get(t):y*f*2)*Co,v=h.get(t),A=u.get(t),S=x+g.get(t),w=cF[_],I=gF[_],[M,N]=_F(t,`${m}`,s,c,A,v,b),D=M/2,q=N/2;return[mF[_]*M,fF[_]*N,w*S,I*S,w*f,I*f,M,N,D,q]};function xF(t,e,s,i,n,r,o,a,l){const d=o.remove.nodes,h=o.remove.edges,u=o.redraw.nodes,c=s.angle,g=s.zoom,m=s.sin,f=s.cos,p=i.x,_=i.y,x=i.radius,y=i.layer,b=i.scalingMethod,v=i.text.content,A=i.text.scaling,S=i.text.minVisibleSize,w=i.animationDuration,I=i.textHidden,M=i.excluded;o.indexToLayer={},o.indexToQuadIndex={},o.indexToRemoveNodeText={},o.indexToRemoveEdgeText={},o.indexToRedrawNodeText={},o.byLayer=[];const{indexToLayer:N,indexToRedrawNodeText:D,indexToRemoveNodeText:q,indexToRemoveEdgeText:et,indexToQuadIndex:O,byLayer:K}=o;for(let bt=0;bt<t.length;bt++){const It=t[bt],Ut=y.get(It)-h0;(K[Ut]=K[Ut]||[]).push(It),N[It]=Ut}if(a!==null){const bt=K.length;for(let It=N[a]+1;It<=bt;It++)(K[It]=K[It]||[]).unshift(a);N[a]=bt}let j;const ot=[0,0,0,0],it=[0,0,0,0,0],{bboxes:ct,rects:pt}=o,Pt=(bt,It=-1)=>{const Ut=w.get(bt);let Gt=v.get(bt);if(Gt===null||Gt===""||Ut!==0)return!1;let Dt=x.get(bt);const Rt=S.get(bt);if(M.get(bt)===1)return q[bt]=!0,!1;if(2*Dt*g<Rt)return I.get(bt)===0&&(q[bt]=!0),!1;b.get(bt)==="fixed"&&(Dt/=g);const Tt=p.get(bt),Nt=_.get(bt);typeof Gt=="number"&&(Gt=Gt.toString());let[Ht,qt,Zt,Lt,Kt,ue,ne,se,le,ge]=n(bt);const ve=!A.get(bt),Le=ve?g:1,Ae=b.get(bt)==="fixed"?g:1;ve?(Zt+=le,Lt+=ge,le/=g,ge/=g,ne/=g,se/=g):(Zt+=le*g,Lt+=ge*g),Ht=Ht/Le+Zt/g+Kt/Ae,qt=qt/Le+Lt/g+ue/Ae,zd(Tt-le,Nt-ge,ne,se,-c,m,-f,ot),it[0]=Tt-le,it[1]=Nt-ge,it[2]=ne,it[3]=se,it[4]=c;const Xt=f*Ht-m*qt,Wt=m*Ht+f*qt;if(ot[0]+=Xt,ot[1]+=Wt,ot[2]+=Xt,ot[3]+=Wt,it[0]+=Xt,it[1]+=Wt,o.realIntersection=!1,fE(bt,!0,ga(it[0],it[1],it[2],it[3],it[4]),It),e.traverse(ot[0],ot[1],ot[2],ot[3],l),o.realIntersection&&!r)return q[bt]=!0,!1;D[bt]=!0,q[bt]=!1,It<=0?(j=ct.length/gi,O[bt]=j,ct.push(ot[0],ot[1],ot[2],ot[3],1,bt),e.insert(j,ot[0],ot[1],ot[2],ot[3]),pt.push(it[0],it[1],it[2],it[3],it[4])):e.insert(O[bt],ot[0],ot[1],ot[2],ot[3])};for(const bt of t)Pt(bt);let At=!0;for(let bt=0;bt<K.length;bt++){const It=K[bt];if(It)if(At)At=!1;else for(const Ut of It)Pt(Ut,bt)}for(let bt=0;bt<t.length;bt++){const It=t[bt];q[It]?d.push(It):D[It]&&u.push(It),et[It]&&h.push(It)}return o}var bF=1,vF="topDown",EF="bottomUp",AF=.15,SF=200,Mp=80,wF=["x","y","radius","width","layer","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"].reduce(((t,e)=>(t.add(e),t)),new Set),TF=class extends te{constructor(t,e){super(t),this._textBBoxes=[],this._rects=[],this._enabled=!1,this._geoEnabled=!1,this._intersects=[],this._textDisplacement={},this._textDisplacementUpdate={},this._skipFrames=!1,this._output={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]},rects:this._rects,bboxes:this._textBBoxes,intersects:this._intersects,realIntersection:!1,indexToLayer:{},byLayer:[],indexToRedrawEdgeText:{},indexToRemoveEdgeText:{},indexToRedrawNodeText:{},indexToRemoveNodeText:{},indexToQuadIndex:{}},this._onZoomStart=Ro((({startZoom:s,endZoom:i})=>{this._enabled&&i<s&&this._updateLabels(this._modules.camera.clone({zoom:i}))}),Mp),this._onLayoutEnd=Ro((()=>{this._enabled&&this._updateLabels()}),Mp),this._onAttributesChanged=s=>{if([...s.edgeAttributes,...s.nodeAttributes].some((i=>wF.has(i)))){const i=s.nodes._indexes;for(let n=0;n<i.length;n++)this._textDisplacementUpdate[i[n]]=!0;this._update()}},this._onToggle=s=>(s?this._update():this._reset(),this),this._update=()=>{(this._enabled||this._forceEnabled)&&this._updateDebounced()},this._toggleDebug=s=>{s?this._modules.layers.whenReady((()=>{this._layer=this._modules.layers.addCanvasLayer((i=>{i.lineWidth=1/this._modules.camera.getZoom(),lF(i,this._textBBoxes,this._rects,this._intersects,this._quadtree)}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._canvas=this._layer.element,this._ctx=this._canvas.getContext("2d"),this._update()})):this._canvas&&(this._layer.destroy(),this._canvas=this._ctx=null)},this._measureText=(s,i,n,r)=>this._engine.measureText(s,i,n,r),this._textDisplacement={},this._textDisplacementUpdate={},this._quadtree=new aF.Quadtree((s=>{const i=gi,n=i*s;return this._textBBoxes.slice(n,n+i)}),bF),e.forceEnableTextOverlapRemoval&&this.forceEnable()}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.events.register(["labelCollisionsRemoved"]),this.setRate(SF),this._modules.settings.register("texts.preventOverlap",!0,this._onToggle),this._modules.settings.register("texts.debug",!1,this._toggleDebug),this._modules.settings.register("texts.removalStrategy",vF);const t=this._output;this._nodeTraversal=Lp(this._quadtree,!1,1,t),this._edgeTraversal=Lp(this._quadtree,!1,0,t),this._modules.events.on(["layoutEnd","locate"],this._onLayoutEnd).on(["viewChanged","mouseover","mouseout"],this._update).on("updateAttributes",this._onAttributesChanged).on("setContainer",(({element:e})=>{if(e)return this._enable();this._disable()})).on("zoomStart",this._onZoomStart).on("viewExportStart",(({preventOverlap:e,camera:s})=>{e&&this.forceUpdate(s)})).on("viewExportEnd",(()=>{this.forceUpdate()})).on("geoEnabled",(()=>this._geoEnabled=!0)).on("geoDisabled",(()=>this._geoEnabled=!1))}getTextsBoundingBox(t,e){if(this._skipFrames=!0,t||e?this._updateLabels(this._modules.camera,t?Array.from(t._indexes):[],e?Array.from(e._indexes):[]):this._updateLabels(),this._skipFrames=!1,this._rects===void 0)throw new Error("this._rects is undefined");const s=this._rects,i=new Cs;for(let n=0;n<s.length;n+=5){const r=s[n],o=s[n+1],a=s[n+2],l=s[n+3],d=s[n+4],[h,u,c,g]=zd(r,o,a,l,d);i.addPoint(h,u).addPoint(c,g)}return i}setRate(t){this._updateDebounced=this._modules.sync.debounceIdle((e=>this._updateLabels(e)),t)}forceEnable(){this._forceEnabled=!0}update(){this._update()}forceUpdate(t=this._modules.camera){this._updateLabels(t)}query(t,e,s,i,n){const r=this._quadtree.query(t,e,s,i);for(let o=0;o<r.length;o++){const a=this._textBBoxes[6*r[o]+4],l=this._textBBoxes[6*r[o]+5];a?n.nodes.push(l):n.edges.push(l)}}_enable(){this._enabled=!0,this._update()}_disable(){this._textBBoxes=[],this._rects=[],this._intersects=[],this._enabled=!1}_onCameraMove(){this._update()}_updateLabels(t=this._modules.camera,e,s){if(!this._modules.settings.get("texts.preventOverlap"))return;const i=this._modules.graphics.getNodeAttributes(),n=this._modules.graphics.getEdgeAttributes();this._intersects=[],this._textBBoxes=[],this._rects=[];const r=t.getAngle(),o=t.getProjectedScreenBounds(AF),a=this._modules.settings.get("texts.removalStrategy")===EF,l={angle:r,zoom:t.zoom,sin:Math.sin(r),cos:Math.cos(r)};this._resetOutput();const d=this._output;if(!e||!s){const m=this._modules.spatial.queryRaw(o[0],o[1],o[2],o[3]);e=m.nodes,s=m.edges}const h=this._quadtree.clear().cover(o[0],o[1],o[2],o[3]);if(e.length+s.length===0)return;const u=this._modules.captor.getPointedElement();let c=null,g=null;u!==null&&(u.isNode?c=u._index:g=u._index);for(const m of e)!this._textDisplacementUpdate[m]&&this._textDisplacement[m]||(this._textDisplacement[m]=yF(m,i,this._measureText),this._textDisplacementUpdate[m]=!1);xF(e,h,l,i,(m=>this._textDisplacement[m]),a,d,c,this._nodeTraversal),uF(s,h,l,n,i,this._measureText,a,d,g,this._edgeTraversal,this._geoEnabled),this._skipFrames||this._clearOverlaps(this._output),this._modules.settings.get("texts.debug")&&this._layer.refresh()}_clearOverlaps(t){const e=this._modules.graph.nodeList,s=this._modules.graph.edgeList,i=this._modules.graphics,n=e(new Uint32Array(t.remove.nodes)),r=s(new Uint32Array(t.remove.edges)),o=e(new Uint32Array(t.redraw.nodes)),a=s(new Uint32Array(t.redraw.edges));i.setTextHidden(n,!0),i.setTextHidden(r,!0),i.setTextHidden(o,!1),i.setTextHidden(a,!1),this._modules.events.fire("labelCollisionsRemoved",t)}_resetOutput(){const t=this._output;t.remove.nodes=[],t.remove.edges=[],t.redraw.nodes=[],t.redraw.edges=[],t.rects=this._rects,t.bboxes=this._textBBoxes,t.intersects=this._intersects,t.realIntersection=!1,t.indexToLayer={},t.byLayer=[],t.indexToRedrawEdgeText={},t.indexToRemoveEdgeText={},t.indexToRedrawNodeText={},t.indexToRemoveNodeText={},t.indexToQuadIndex={}}_reset(){this._modules.graphics.resetTextHidden(),this._textDisplacement={},this._textDisplacementUpdate={}}},CF=class extends te{constructor(){super(...arguments),this._onStartInteractionEvent=(t,e)=>{const s=e==="mousewheel";if(this._current&&!s)return;const i=this._interactionsByStartEvent[e];let n;for(const r of i)r.check(t)&&(!n||r.priority>=n.priority)&&(n=r);n&&(s?n.onStart&&n.onStart(t):this._startInteraction(n,t))},this._onProgressInteractionEvent=(t,e)=>{this._current&&this._current.progressEventName===e&&this._current.onProgress&&this._current.onProgress(t)},this._onStopInteractionEvent=(t,e)=>{this._current&&this._current.stopEventName===e&&this._stopCurrentInteraction(null)}}onMounted(){this._interactionsByStartEvent={},this._boundProgressEvents={},this._boundStopEvents={}}_startInteraction(t,e){t.onStart&&t.onStart(e),t.onStop&&(this._current=t,t.disableDetection&&this._modules.captor.setDetectionEnabled(!1))}_stopCurrentInteraction(t){this._current&&this._current.disableDetection&&this._modules.captor.setDetectionEnabled(!0),this._current&&this._current.onStop&&this._current.onStop(t),this._current=void 0}_forceStartInteraction(t,e){this._current&&this._stopCurrentInteraction(e),this._startInteraction(t,e)}_createWrapper(t){return{start:e=>this._forceStartInteraction(t,e)}}_addInteraction(t,e){const s=this._interactionsByStartEvent[t];return s?s.push(e):(this._interactionsByStartEvent[t]=[e],this._modules.events.on(t,this._onStartInteractionEvent)),this._createWrapper(e)}_createProgressiveInteraction(t,e,s,i){const n={priority:Np(i.priority),check:i.check||Fl,onStart:i.onStart||ae,onProgress:i.onProgress||ae,onStop:i.onStop||ae,disableDetection:!!i.disableDetection,progressEventName:e,stopEventName:s};return this._boundProgressEvents[e]||(this._boundProgressEvents[e]=!0,this._modules.events.on(e,this._onProgressInteractionEvent)),this._boundStopEvents[s]||(this._boundStopEvents[s]=!0,this._modules.events.on(s,this._onStopInteractionEvent)),this._addInteraction(t,n)}_createNonProgressiveInteraction(t,e){return this._addInteraction(t,{priority:Np(e.priority),check:e.check||Fl,onStart:e.handler||ae,onProgress:void 0,onStop:void 0,disableDetection:!1,progressEventName:void 0,stopEventName:void 0})}onDrag(t){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",t)}onGesture(t){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",t)}onClick(t){return this._createNonProgressiveInteraction("click",t)}onDoubleClick(t){return this._createNonProgressiveInteraction("doubleclick",t)}onHover(t){return this._createNonProgressiveInteraction("mouseover",t)}onUnhover(t){return this._createNonProgressiveInteraction("mouseout",t)}onMouseWheel(t){return this._createNonProgressiveInteraction("mousewheel",t)}onMouseDown(t){return this._createNonProgressiveInteraction("mousedown",t)}onMouseUp(t){return this._createNonProgressiveInteraction("mouseup",t)}onMouseMove(t){return this._createNonProgressiveInteraction("mousemove",t)}};function Np(t){return typeof t=="string"?RT.indexOf(t):typeof t!="number"||isNaN(t)?0:t}var LF=["virtualUp","mouseupInternal","touchUp"],IF=["virtualDown","mousedownInternal","touchDown"],MF=["virtualMove","mousemoveInternal","touchMove"],NF=["virtualClick","clickInternal","touchTap"],RF=["virtualDoubleClick","doubleclickInternal","touchDoubleTap"],FF=["virtualWheel","mousewheelInternal"],PF=100,zF=class extends te{constructor(){super(...arguments),this.spatialIndexMarginRatio=5,this._elt=null,this._hoveredElt=null,this._draggedElt=null,this._hover=!1,this._disabledCounter=0,this._accDx=0,this._accDy=0,this._prevX=0,this._prevY=0,this._buttons={left:{isPressed:!1,isDragging:!1},middle:{isPressed:!1,isDragging:!1},right:{isPressed:!1,isDragging:!1}},this._onGraphChanged=()=>{this._resetCurrent(this._modules.position.x,this._modules.position.y),this._onMove({x:this._modules.position.x,y:this._modules.position.y,source:null,domEvent:null})}}onMounted(){this._modules.events.register(["mousemove","mousedown","mouseup","click","doubleclick","mousewheel","mouseout","mouseover","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]),this._modules.settings.register("detect.nodes",!0).register("detect.edges",!0).register("detect.nodeTexts",!0).register("detect.nodeBadges",!0).register("detect.edgeTexts",!0).register("detect.nodeErrorMargin",5).register("detect.edgeErrorMargin",2).register("detect.enableSpatialIndex",!0),this._modules.events.on(["removeNodes","removeEdges","clearGraph"],this._onGraphChanged).on(MF,((t,e)=>{this._onMove({...t,source:pn(e)})})).on(IF,(({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDown({domEvent:t,x:e,y:s,button:i,source:pn(n)})})).on(LF,(({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onUp({domEvent:t,x:e,y:s,button:i,source:pn(n)})})).on(NF,(({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onClick({domEvent:t,x:e,y:s,button:i,source:pn(n)})})).on(RF,(({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDoubleClick({domEvent:t,x:e,y:s,button:i,source:pn(n)})})).on(FF,(({domEvent:t,x:e,y:s,delta:i,dx:n,dy:r})=>this._onWheel({domEvent:t,x:e,y:s,delta:i,source:"mouse",dx:n,dy:r}))).on("touchStartGesture",(t=>this._modules.events.fire("gestureStart",t))).on("touchProgressGesture",(t=>this._modules.events.fire("gestureProgress",t))).on("touchEndGesture",(t=>this._modules.events.fire("gestureEnd",t))).on("documentMouseMove",(({domEvent:t,x:e,y:s},i)=>{this._onDocumentMove({domEvent:t,x:e,y:s,source:pn(i)})})).on("documentMouseUp",(({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDocumentUp({domEvent:t,x:e,y:s,source:pn(n),button:i})}))}triggerUnhover(){this._hover=!1,this._hoveredElt=null}triggerDetection(){this._detectElement(this._modules.position.x,this._modules.position.y,!1,!1),this._elt&&(this._hoveredElt=this._elt,this._hover=!0)}getPointedElement(){return this._hoveredElt}getDraggedElement(){return this._draggedElt}isAnyButtonPressed(){return this._buttons.left.isPressed||this._buttons.right.isPressed||this._buttons.middle.isPressed}isAnyButtonDragging(){return this._buttons.left.isDragging||this._buttons.right.isDragging||this._buttons.middle.isDragging}isButtonPressed(t){return this._buttons[t].isPressed}isLeftPressed(){return this.isButtonPressed("left")}getCursorPosition(){return{x:this._modules.position.x,y:this._modules.position.y}}getCursorInformation(){return{x:this._modules.position.x,y:this._modules.position.y,target:this._hoveredElt}}setDetectionEnabled(t){this._disabledCounter=Math.max(0,this._disabledCounter+(t?-1:1))}_resetCurrent(t,e){for(const s in this._buttons){const i=this._buttons[s];i.isDragging&&this._modules.events.fire("dragEnd",{domEvent:null,x:t,y:e,button:s,target:this._draggedElt}),i.isPressed=!1,i.isDragging=!1}this._hover&&this._hoveredElt&&this._modules.events.fire("mouseout",{domEvent:null,x:t,y:e,target:this._hoveredElt}),this._hover=!1,this._hoveredElt=null,this._draggedElt=null}_onMove({domEvent:t,x:e,y:s,source:i}){let{dx:n,dy:r}=this._setPointerPosition(e,s);this._modules.events.fire("mousemove",{domEvent:t,x:e,y:s,dx:n,dy:r,source:i});for(const o in this._buttons){const a=this._buttons[o];if(a.isPressed)if(a.isDragging){const l=this._getStoredDXY();n+=l.dx,r+=l.dy,this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:n,dy:r,button:o,source:i,target:this._draggedElt})}else a.isDragging=!0,this._hoveredElt&&this._hover&&(this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt}),this._hover=!1),this._draggedElt||(this._draggedElt=this._hoveredElt),this._storeDXY(n,r),this._modules.events.fire("dragStart",{domEvent:t,x:e,y:s,button:o,source:i,target:this._draggedElt})}t&&!this._modules.graphics.getDomElement().contains(t.target)||this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&(this._hoveredElt&&this._hover&&(this._hover=!0,this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})),this._hoveredElt=this._elt,this._elt&&(this._hover=!0,this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})))}_onDocumentMove({domEvent:t,x:e,y:s,source:i}){for(const n in this._buttons){const{isDragging:r}=this._buttons[n];if(r){const{dx:o,dy:a}=this._setPointerPosition(e,s);this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:o,dy:a,button:n,source:i,target:this._draggedElt})}}}_onDocumentUp({domEvent:t,x:e,y:s,source:i,button:n}){if(n!=null&&this._buttons[n].isDragging){this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:n,source:i,target:this._draggedElt});const r=this._buttons[n];r.isDragging=!1,r.isPressed=!1,this.isAnyButtonDragging()||(this._draggedElt=null)}}_onDown({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&this._resetCurrent(e,s);const r=this._buttons[i];this._hoveredElt=this._elt,r.isPressed=!0,this._elt&&t&&(t.stopPropagation(),t.preventDefault()),this._modules.events.fire("mousedown",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onDoubleClick({domEvent:t,x:e,y:s,button:i,source:n}){i!=null&&(Fp(t,"doubleclick")||this._modules.events.fire("doubleclick",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt}))}_onUp({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;const r=this._buttons[i];r.isPressed&&(r.isDragging&&(this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:i,source:n,target:this._draggedElt}),r.isDragging=!1,this.isAnyButtonDragging()||(this._draggedElt=null)),r.isPressed=!1,this._detectElement(e,s,!1,!1),this._modules.events.fire("mouseup",{domEvent:t,x:e,y:s,button:i,source:n,target:this._elt}),this.isAnyButtonPressed()||this._hover||n==="touch"||(this._hoveredElt=this._elt,this._hoveredElt&&(this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:n,target:this._hoveredElt}),this._hover=!0)))}_onClick({domEvent:t,x:e,y:s,button:i,source:n}){Fp(t,"click")||this._modules.events.fire("click",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onWheel({domEvent:t,x:e,y:s,delta:i,source:n,dx:r,dy:o}){this._modules.position.x=e,this._modules.position.y=s,this._modules.events.fire("mousewheel",{domEvent:t,x:e,y:s,dx:r,dy:o,delta:i,source:n,target:this._hoveredElt})}_storeDXY(t,e){this._accDx=t,this._accDy=e}_getStoredDXY(){const t=this._accDx,e=this._accDy;return this._accDx=0,this._accDy=0,{dx:t,dy:e}}_setPointerPosition(t,e){const s=t-this._prevX,i=e-this._prevY;return this._modules.position.x=t,this._modules.position.y=e,this._prevX=t,this._prevY=e,this._accDx=0,this._accDy=0,{dx:s,dy:i}}_detectElement(t,e,s,i){this._elt=this.detectElementAt(t,e,s,i)}detectElementAt(t,e,s,i){if(this._disabledCounter!==0)return null;const n=this._modules.settings,r=n.get("detect.enableSpatialIndex"),o=n.get("detect.nodeErrorMargin")||0,a=n.get("detect.edgeErrorMargin")||0;let l=n.get("detect.nodes"),d=n.get("detect.edges");i&&(l=!0,d=!0);let h=null,u=[],c=[];if(!s&&r&&(l||d)){const f=this.spatialIndexMarginRatio,p=Math.max(o*f,a*f),_=this._modules.spatial.queryRawProjected(t-p,e-p,t+p,e+p);u=_.nodes,c=_.edges}let g=null,m=null;if(l&&(g=this._modules.graphics.detectNode(t,e,!!n.get("detect.nodeTexts"),!!n.get("detect.nodeBadges"),o,u)),d&&(c.length<PF||!g)&&(m=this._modules.graphics.detectEdge(t,e,!!n.get("detect.edgeTexts"),a,c)),g&&m){const f=this._modules.graphics.getAttributesManager().getFlexArrays();h=f.nodes.current.layer.get(g._index)>=f.edges.current.layer.get(m._index)?g:m}else g?h=g:m&&(h=m);return h}};function pn(t){return t.indexOf("touch")===0?"touch":"mouse"}var vh=!1,Rp={down:{trigger:"pointerdown",duplicate:"mousedown"},click:{trigger:"pointerdown",duplicate:"mouseup"},doubleclick:{trigger:"pointerdown",duplicate:"mouseup"}};function Fp(t,e){if(t)return t.type===Rp[e].trigger&&(vh=!0),t.type===Rp[e].duplicate&&vh?(vh=!1,!0):void 0}var DF=class extends te{constructor(){super(...arguments),this._dragged=null,this._start=[],this._end=[],this._shouldDrag=({target:t,button:e})=>{const s=e==="left",i=this._modules.settings.get("interactions.drag.enabled"),n=t!==null&&t.isNode&&t.getAttribute("draggable")===!0;return!!(s&&i&&n)},this._onDragStart=({x:t,y:e,target:s})=>{s&&(s.isSelected()?this._dragged=this._modules.selection.getSelectedNodes().filter((i=>i.getAttribute("draggable"))):this._dragged=s.toList()),this._dragged&&(this._start=this._dragged.getPosition(),this._end=ke(this._start),this._onBeforeDrag=this._modules.settings.get("interactions.drag.onBeforeDrag"),this._startDrag=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._dragged.addClass(xl),this._modules.events.fire("nodesDragStart",{nodes:this._dragged}),this._modules.graphics.addCursorStyle(this._modules.settings.get("interactions.drag.cursor")))},this._onDrag=()=>{if(!this._dragged||!this._startDrag)return;const{x:t,y:e}=this._modules.captor.getCursorInformation(),s=this._dragged._indexes,i=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),n=i.x-this._startDrag.x,r=i.y-this._startDrag.y;for(let o=0;o<s.length;++o){const a=this._start[o],l=this._end[o];l.x=a.x+n,l.y=a.y+r}this._onBeforeDrag&&this._onBeforeDrag(this._dragged,t,e,this._end),this._modules.settings.get("interactions.drag.applyResult")&&this._modules.individualAttributes.setMultipleAttributes(this._dragged,this._end),this._modules.events.fire("nodesDragProgress",{nodes:this._dragged,dx:n,dy:r})},this._onDragEnd=()=>{this._dragged&&(this._dragged.removeClass(xl),this._modules.graphics.removeCursorStyle(this._modules.settings.get("interactions.drag.cursor")),this._modules.events.fire("nodesDragEnd",{nodes:this._dragged,start:this._start,end:this._end}),this._dragged=null,this._start=[],this._end=[])}}onMounted(){this._modules.classes.createClass({name:xl,isBuiltin:!0,nodeAttributes:{layer:MT}}),this._modules.events.register(["nodesDragStart","nodesDragProgress","nodesDragEnd"]),this._modules.settings.register("interactions.drag.enabled",!0).register("interactions.drag.cursor","move").register("interactions.drag.onBeforeDrag",void 0),this._modules.settings.register("interactions.drag.applyResult",!0),this._modules.interactions.onDrag({priority:"drag",disableDetection:!0,check:this._shouldDrag,onStart:this._onDragStart,onProgress:this._onDrag,onStop:this._onDragEnd})}},kF={color:"#00C3FF",radius:4,cursorOnHover:"grab",cursorOnDrag:"grabbing"},OF=class extends te{constructor(){super(...arguments),this._hoveredNode=null,this._hoverHandle=!1,this._grabHandle=!1,this._x=0,this._y=0,this._enabled=!1,this._onMouseUp=()=>this._grabHandle=!1,this._onMouseDown=()=>{this._hoverHandle&&(this._grabHandle=!0)},this._onDragProgress=()=>{this._grabHandle&&this._refreshCanvas()},this._onDragStart=()=>{if(!this._movedEdges)return;this._nodesToHighlight=this._nodesToHighlight.filter((e=>e!==this._startNode&&!e.isVirtual())),this._movedEdges.setExcluded(!0);const t=this._options.cursorOnDrag;this._prevSettings=this._modules.settings.update({edgeHover:!1,cursor:{default:t,node:t,edge:t}})},this._onDragEnd=()=>{if(!this._movedEdges)return;this._restoreSettings();const t=this._getPointedNode();t?this._movedEdges.forEach((e=>{e.getTarget()===this._startNode?e.setTarget(t):e.setSource(t)})):this._options.onMouseUpInVoid&&this._options.onMouseUpInVoid(this._modules.camera.screenToGraphCoordinates({x:this._x,y:this._y}),this._startNode,this._movedEdges,this._movedEdges.map((e=>e.getSource()===this._startNode))),this._movedEdges.setExcluded(!1),this._movedEdges.setSelected(!0),this._movedEdges=null,this._refreshHandles()},this._refreshHandles=()=>{if(!this._enabled||this._movedEdges)return;const t=this._modules.selection.getSelectedEdges();this._nodesToHighlight=t.getExtremities().dedupe().filter((e=>!e.isVirtual())),this._rewirableClass.clearEdges(),this._rewirableClass.add(t),this._refreshCanvas()},this._shouldInteractionStart=()=>{if(!this._enabled||!this._hoveredNode||!this._hoverHandle||this._hoveredNode.isVirtual())return!1;const t=this._hoveredNode.getAdjacentEdges().filter((e=>e.isSelected()));return!!t.size&&(this._movedEdges=t,this._edgeColors=this._movedEdges.getAttribute("color"),this._startNode=this._hoveredNode,!0)},this._refreshCanvas=()=>{this._enabled&&this._layer.refresh()},this._checkForHover=()=>{if(!this._enabled||!this._nodesToHighlight)return;const t=this._options.radius,e=this._nodesToHighlight.getPosition(),s=this._modules.camera.screenToGraphCoordinates(this._modules.captor.getCursorPosition());for(let i=0;i<e.length;i++){const{x:n,y:r}=e[i];if(!(n-t>s.x||n+t<s.x||r-t>s.y||r+t<s.y))return this._hoveredNode=this._nodesToHighlight.get(i),void this._enableCursorOnHover()}this._hoveredNode=null,this._disableCursorOnHover()}}onMounted(){this._rewirableClass=this._modules.classes.createClass({name:r0,isBuiltin:!0,edgeAttributes:{layer:NT}})}enable(t){this._enabled||(this._modules.events.on("move",this._checkForHover).on("mousemove",this._checkForHover).on("dragProgress",this._onDragProgress).on("nodesDragProgress",this._refreshCanvas).on("mousedown",this._onMouseDown).on("mouseup",this._onMouseUp).on("edgesSelected",this._refreshHandles).on("edgesUnselected",this._refreshHandles),this._interaction=this._modules.interactions.onDrag({priority:"rewiring",check:this._shouldInteractionStart,onStart:this._onDragStart,onProgress:({x:e,y:s})=>{this._x=e,this._y=s},onStop:this._onDragEnd}),this._options={...kF,...t},this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((e=>{if(!this._enabled||!this._nodesToHighlight)return;const s=this._modules.captor.getCursorPosition(),i=this._getPointedNode(),n=this._options.color,r=this._options.radius,o=2*r;if(this._displayMovedEdges(e),e.fillStyle=n,e.strokeStyle=n,this._nodesToHighlight.forEach((a=>{const{x:l,y:d}=a.getPosition();e.fillRect(l-r,d-r,o,o)})),this._movedEdges){const a=i?i.getPosition():s;e.fillRect(a.x-r,a.y-r,o,o)}}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._refreshHandles())}disable(){this._enabled&&(this._interaction&&this._interaction.stop&&this._interaction.stop(),this._interaction=void 0,this._modules.graphics.removeCursorStyle(this._options.cursorOnDrag),this._disableCursorOnHover(),this._hoveredNode=null,this._restoreSettings(),this._layer.destroy(),this._rewirableClass.clearEdges(),this._enabled=!1,[this._checkForHover,this._onDragProgress,this._refreshCanvas,this._onMouseDown,this._onMouseUp,this._refreshHandles].forEach((t=>this._ogma.events.off(t))))}enabled(){return this._enabled}_restoreSettings(){this._prevSettings&&(this._modules.settings.update(this._prevSettings),this._prevSettings=void 0)}_disableCursorOnHover(){this._hoverHandle&&!this._grabHandle&&(this._hoverHandle=!1,this._modules.graphics.removeCursorStyle(this._options.cursorOnHover))}_enableCursorOnHover(){this._hoverHandle||(this._hoverHandle=!0,this._modules.graphics.addCursorStyle(this._options.cursorOnHover))}_displayMovedEdges(t){if(!this._movedEdges)return;const e=this._x,s=this._y,i=this._modules.camera.screenToGraphCoordinates({x:e,y:s});this._movedEdges.forEach(((n,r)=>{const o=this._edgeColors[r],a=n.getSource(),l=n.getTarget(),d=this._getPointedNode(),h=l===this._startNode?a:l,u=Number(n.getAttribute("width")),c=h.getPosition(),g=d?d.getPosition():i;t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(g.x,g.y),t.strokeStyle=o,t.lineWidth=u,t.stroke()}))}_getPointedNode(){const t=this._modules.captor.getPointedElement();return t&&t.isNode&&!t.isVirtual()?t:null}},Pp={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1},BF=class extends te{constructor(){super(...arguments),this._enabled=!1,this._nodesToHighlight=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[],this._onSelectionChange=()=>{this._enabled&&(this._nodesToHighlight=this._modules.selection.getSelectedNodes(),this._displayHandles())},this._displayHandlesHandler=()=>this._displayHandles(),this._moveHandler=({x:t,y:e})=>{this._modules.dom.setTimeout((()=>this._detectBoundingBoxes(t,e)),0)}}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.interactions.onDrag({priority:"resizing",disableDetection:!0,check:()=>!(!this._enabled||!this._pointedNode),onStart:({x:t,y:e})=>{this._x=t,this._y=e,this._nodeBeingResized=this._pointedNode},onProgress:({x:t,y:e})=>{this._x=t,this._y=e,this._displayHandles()},onStop:()=>{if(this._nodesToHighlight){const t=this._modules.camera.zoom,e=this._nodesToHighlight.getAttributes(["x","y","radius"]).map((({x:s,y:i,radius:n},r)=>{const o=this._additionalRadiuses[r]/t;return{radius:+n+o,x:s+o,y:i-o}}));this._nodesToHighlight.setAttributes(e)}this._pointedNode=null,this._nodeBeingResized=null,this._displayHandles()}})}onReady(){this._modules.events.on(["nodesSelected","nodesUnselected"],this._onSelectionChange)}_enableCursor(){this._cursorEnabled||(this._modules.graphics.addCursorStyle(this._options.cursor),this._cursorEnabled=!0)}_disableCursor(){this._cursorEnabled&&(this._modules.graphics.removeCursorStyle(this._options.cursor),this._cursorEnabled=!1)}_detectBoundingBoxes(t,e){if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight)return;const s=this._options.handleSize/2,i=this._options.detectionMargin;return this._pointedNode=null,this._forEachNodeToHighlight(((n,r,o)=>{const a=r.x+o-s-i,l=r.x+o+s+i,d=r.y-o-s-i,h=r.y-o+s+i;t>=a&&t<=l&&e>=d&&e<=h&&(this._pointedNode=n)})),this._pointedNode?this._enableCursor():this._disableCursor()}_forEachNodeToHighlight(t){this._nodesToHighlight&&this._nodesToHighlight.forEach((e=>{const s=e.getPositionOnScreen(),i=this._getTotalRadius(e);t(e,s,i)}))}_displayHandles(){this._enabled&&this._nodesToHighlight&&this._layer.refresh()}_displayNodePreview(t,e,s,i,n,r){if(n*=1/this._modules.camera.getZoom(),t.beginPath(),r.length===1)t.arc(s,i,n,0,2*Math.PI);else for(let o=0;o<r.length;++o){const a=r[o],l=s+a.x*n,d=i+a.y*n;o===0?t.moveTo(l,d):t.lineTo(l,d)}t.fillStyle=this._options.previewColor,t.fill()}_getTotalRadius(t,e=!0){return Number(t.getAttribute("radius"))*(this._modules.camera.zoom*(e?1:0))+Number(t.getAttribute("innerStroke.width"))+Number(t.getAttribute("outerStroke.width"))+this._options.lineWidth/2}_snap(t,e,s){const i=this._modules.spatial.getNodesInScreenByDistance(e).filter((u=>!u.isSelected())).slice(0,this._options.nbNodesToSnapTo),n=this._getTotalRadius(e),r=n+s,o=this._options.snappingRatio,a=r/n,l=Math.round(Nx(a,o));let d=n*Math.pow(o,l),h=null;if(i.forEach((u=>{const c=this._getTotalRadius(u);Math.abs(c-r)<=Math.abs(d-r)&&(d=c,h=u)})),h){t.save(),t.strokeStyle=this._options.sizeIndicatorColor,t.lineWidth=this._options.sizeIndicatorThickness/this._modules.camera.getZoom();const u=h.getAttribute("radius");this._displaySizeIndicator(t,e,d),i.filter((c=>c.getAttribute("radius")===u)).forEach((c=>this._displaySizeIndicator(t,c))),t.restore()}return d-n}_displaySizeIndicator(t,e,s){s=s||void 0;const i=this._modules.camera.getZoom(),n=e.getPosition(),r=this._getTotalRadius(e),o=(s||r)/i,a=(s?s-r:0)/i,l=a+(-this._options.sizeIndicatorOffset-(s?Number(e.getAttribute("innerStroke.width"))+Number(e.getAttribute("outerStroke.width")):0))/i,d=n.x-o+l|0,h=n.y-o-a|0,u=n.y+o-a|0,c=this._options.sizeIndicatorWidth/i;t.beginPath(),t.moveTo(d-c,h),t.lineTo(d+c,h),t.moveTo(d,h),t.lineTo(d,u),t.moveTo(d-c,u),t.lineTo(d+c,u),t.stroke()}enable(t={}){this._enabled||(this._options={...Pp,...t},this._layer=this._modules.layers.addCanvasLayer((e=>{const s=Ns(),i=this._modules.camera.getZoom(),{color:n,lineWidth:r}=this._options;let o=this._options.handleSize,a=0;if(this._nodeBeingResized){const l=this._getTotalRadius(this._nodeBeingResized),d=this._nodeBeingResized.getPositionOnScreen();a=Math.max(this._x-(d.x+l),-(this._y-(d.y-l)))/2}this._additionalRadiuses=[],this._nodesToHighlight&&this._nodesToHighlight.forEach((l=>{const d=l.getPosition();let h=this._getTotalRadius(l),u=0;if(this._nodeBeingResized){u=a;const c=-h+Number(l.getAttribute("innerStroke.width"))+Number(l.getAttribute("outerStroke.width"))+r/2+1;u=u<c?c:this._snap(e,l,u),this._additionalRadiuses.push(u);const g=l.getAttribute("shape"),m=this._engine.getShapePoints(g),f=d.x+u/i,p=d.y-u/i,_=h+u;this._displayNodePreview(e,s,f,p,_,m)}e.strokeStyle=n,e.fillStyle=n,e.lineWidth=r/i,h/=i,u/=i,o/=i*s,e.strokeRect(d.x-h,d.y-h-2*u,2*(u+h),2*(u+h)),e.fillRect(d.x+h+2*u-o/2,d.y-h-2*u-o/2,o,o)}))}),{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._modules.events.on(["mousemove","mousedown"],this._moveHandler),this._enabled=!0)}disable(){this._enabled&&(this._modules.events.off(this._displayHandlesHandler).off(this._moveHandler),this._layer.destroy(),this._disableCursor(),this._reset())}_reset(){this._enabled=!1,this._nodesToHighlight=null,this._options={...Pp},this._nodeBeingResized=null,this._pointedNode=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[]}enabled(){return this._enabled}},UF={strokeColor:"black",strokeWidth:5,dashed:!0,cursorStyle:"cell",createNodes:!0,condition:Ac,onNodeCreated:ae,onEdgeCreated:ae,createNode:ni,createEdge:ni,onComplete:ae},GF=class extends te{constructor(){super(...arguments),this._enabled=!1,this._blockId=0,this._cursorEnabled=!1}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._depth=Go(0).edgeBody,this._modules.events.register(["connectNodes"]),this._interaction=this._modules.interactions.onDrag({priority:"connectNodes",check:({target:t,button:e="left"})=>this._enabled&&e==="left"&&t&&t.isNode&&!t.isVirtual(),onStart:({target:t})=>this._onStart(t),onProgress:({x:t,y:e})=>this._onMove(t,e),onStop:()=>this._onStop()}),this._modules.events.on("clearGraph",(()=>this.disable()))}_onStart(t){t&&(this._cursorEnabled=!0,this._startNode=t,this._startPos=t.getPosition(),this._modules.graphics.addCursorStyle(this._options.cursorStyle),this._blockId=this._modules.graphics.allocateGraphicsEngineBlockId())}_onMove(t,e){this._startNode!==null&&(this._endPos=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._drawLine())}_onStop(){if(this._startNode===null)return;const{condition:t,onNodeCreated:e,onEdgeCreated:s,createEdge:i,createNode:n,onComplete:r,createNodes:o}=this._options;let a=this._modules.captor.getPointedElement(),l=null,d=null;if(this._modules.graphics.releaseGraphicsEngineBlockId(this._blockId),!a&&o){const h=n({attributes:{x:this._endPos.x,y:this._endPos.y}});a=this._modules.graph.addNode(h),d=a,e&&e(d)}if(a&&!a.isVirtual()&&(d||!t||t(this._startNode,a))){const h=i({source:this._startNode.getId(),target:a.getId()});l=this._modules.graph.addEdge(h),s&&s(l)}r&&(this._modules.events.fire("connectNodes",{source:this._startNode,target:a,edge:l}),r(this._startNode,a,l||void 0)),this.disable()}_drawLine(){this._group.reset(ei,!1,this._depth);const t=this._group.nextAndReset().end;t.pieceId=Sd,t.shape="line",t.x1=this._startPos.x,t.y1=this._startPos.y,t.x2=this._endPos.x,t.y2=this._endPos.y,t.fillColor=this._options.strokeColor,t.thicknessOrFontSizeFixed=this._options.strokeWidth,this._options.dashed&&(t.dashLength=3,t.gapLength=1),this._engine.storeGroup(this._blockId,this._group),this._modules.dom.refresh()}enable(t={}){return this._enabled||(this._options={...UF,...t},this._enabled=!0,this._cursorEnabled=!1,this._startNode=null,this._prevSettings=this._modules.settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":!1}),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorInformation())),this}disable(){return this._enabled?(this._enabled=!1,this._modules.settings.update(this._prevSettings),this._cursorEnabled&&this._modules.graphics.removeCursorStyle(this._options.cursorStyle),this):this}enabled(){return this._enabled}},VF=["top","bottom","left","right","cssDefined"],qF=1e4,HF={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},jF={position:"top",autoAdjust:!0,delay:100},YF={hover:{node:({target:t})=>t&&t.isNode,edge:({target:t})=>t&&!t.isNode},click:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}},doubleclick:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}}},XF=class extends te{constructor(){super(...arguments),this._x=0,this._y=0}onMounted(){this._handlers={},this._currentHandlerName=null,this._tooltip=null,this._isHover=!1,this._modules.events.register(["tooltipShow","tooltipHide"]),this._modules.events.on(["mouseup","dragStart"],(()=>{this._isHover||this._hideTooltip(!1)})).on("mouseout",(()=>{this._isHover&&this._hideTooltip(!1)})).on("clearGraph",(()=>this._hideTooltip(!1))),this._modules.interactions.onHover(this._createInteraction("hover",!0)),this._modules.interactions.onClick(this._createInteraction("click")),this._modules.interactions.onDoubleClick(this._createInteraction("doubleclick"))}hide(){this._hideTooltip(!0)}isShown(){return!!this._tooltip}refresh(){this._refreshTooltip()}show(t,{position:e="top",autoAdjust:s=!0,className:i,x:n=0,y:r=0}={}){this._showTooltip(t,{position:e,autoAdjust:s,className:i},{x:n,y:r})}setHandler(t,e,s){const i={...jF,...s};i.position&&VF.indexOf(i.position)===-1&&(i.position="top"),this._handlers[t]={handler:e,condition:ze(YF,t),settings:i}}_hideTooltip(t){if(this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null),t&&(this._currentHandlerName=null),this._tooltip){const e=this._tooltip;this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null,this._modules.events.fire("tooltipHide",{tooltip:e})}}_createInteraction(t,e=!1){return{priority:"tooltip",check:s=>{const i=zp(t,s),n=this._handlers[i];return(!e||!this._modules.connectNodes.enabled())&&(!(!n||!n.condition(s))||!(e||!this._currentHandlerName||this._isHover)&&this._tooltip!==null)},handler:s=>{const{target:i,x:n,y:r}=s;this._hideTooltip(!1),this._isHover=e,this._elt=i,this._x=n,this._y=r,this._currentHandlerName=zp(t,s),this._refreshTooltip()}}}_refreshTooltip(){if(!this._currentHandlerName)return void this._hideTooltip(!1);const t=this._handlers[this._currentHandlerName];if(!t)return;const{settings:e,handler:s}=t,i=this._elt;if(i){const r=i.isNode?"node":"edge";if(this._currentHandlerName.indexOf(r)===-1)return}const n=s(i);Promise.resolve(n).then((r=>this._schedule((()=>this._showTooltip(r,e)),e.delay)))}_schedule(t,e){this._timeout&&this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout((()=>{this._timeout=null,t()}),e)}_showTooltip(t,e,s){this._hideTooltip(!1);const{position:i,className:n,autoAdjust:r}=e;let o=this._x,a=this._y,l=this._elt;const d=this._modules.dom.getDimensions();let h=0,u=0;if(s&&(o=s.x,a=s.y,l=null),typeof t=="string")this._tooltip=WF("div"),Dy(this._tooltip,Rc.sanitize(t));else{if(!Tx(t))throw new Error(`invalid tooltip ${t}, expected HTML string or HTML element`);this._tooltip=t}const c=this._tooltip;if(n&&this._tooltip.classList.add(n),i!=="cssDefined"&&(c.style.position="absolute"),c.style.zIndex=qF.toString(),this._modules.dom.appendElement(c),l&&l.isNode){const f=l,p=f.getPositionOnScreen(),_=Number(f.getAttribute("radius"))*(f.getAttribute("scalingMethod")==="fixed"?1:this._modules.camera.getZoom())+Number(f.getAttribute("innerStroke.width"))+Number(f.getAttribute("outerStroke.width"));o=p.x,a=p.y,h=_,u=_}const g=c.offsetWidth/2,m=c.offsetHeight/2;if(h+=g,u+=m,i&&i!=="cssDefined"){const f=HF[i];let p=f.x,_=f.y;if(r){const x=o+h*f.x,y=a+u*f.y;(x-g<0||x+g>=d.width)&&(i==="left"||i==="right"?p*=-1:p=x-g<0?(g-x+1)/h:(d.width-(x+g)-1)/h),(y-m<0||y+m>=d.height)&&(i==="top"||i==="bottom"?_*=-1:_=y-m<0?(m-y+1)/u:(d.height-(y+m)-1)/u)}c.style.left=o+h*p-g+"px",c.style.top=a+u*_-m+"px"}this._modules.events.fire("tooltipShow",{tooltip:c})}};function zp(t,{button:e,target:s}){return`${t}${e?`.${e}`:""}.${s!==null?s.isNode?"node":"edge":"background"}`}function WF(t){return Ri?document.createElement(t):Ul()}var Lo={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"},Dp=Object.keys(Lo).reduce(((t,e)=>{const s=Lo[e];return t[s]||(t[s]=[]),t[s].push(e),t}),{}),$F=38,ZF=40,KF=37,QF=39,JF=187,tP=189,eP=class extends te{constructor(){super(...arguments),this._onKeyPress=t=>{if((t==="zoomIn"||t==="zoomOut")&&!this._modules.settings.get("interactions.zoom.keyboard")||(t==="moveUp"||t==="moveDown"||t==="moveLeft"||t==="moveRight")&&!this._modules.settings.get("interactions.pan.keyboard")||this._modules.dom.hasFocus()===!1)return;const{width:e,height:s}=this._ogma.view.getGraphBoundingBox(),i=Math.max(e,s)/10,n={duration:150,easing:"cubicOut"};if(t==="zoomIn")return this._ogma.view.zoomIn(n);if(t==="zoomOut")return this._ogma.view.zoomOut(n);const r={x:0,y:0};return t==="moveLeft"?r.x=-i:t==="moveRight"?r.x=i:t==="moveUp"?r.y=-i:t==="moveDown"&&(r.y=i),this._ogma.view.move(r,n)},this._onBlur=()=>this.resetKeys(),this._onKeyUp=t=>{const e=t.keyCode||t.which;this._pressed[e]=!1,this._modules.events.fire("keyup",{domEvent:t,key:Lo[e],code:e})},this._onKeyDown=t=>{const e=t.keyCode||t.which,s=this._binds[e];if(!this._pressed[e]){if(this._pressed[e]=!0,s)for(const i of s)i.keys.every((n=>n.some((r=>this._pressed[r]))))&&i.handler({domEvent:t});this._modules.events.fire("keydown",{domEvent:t,key:Lo[e],code:e})}}}onMounted(){this._modules.events.register(["keyup","keydown"]),this._binds=[],this._pressed=[],this._modules.dom.addWindowEventListener("keydown",this._onKeyDown).addWindowEventListener("keyup",this._onKeyUp).addWindowEventListener("visibilitychange",this._onBlur).addWindowEventListener("blur",this._onBlur,!1),this._idleTimeout=4e3,this._prevEventTimeStamp=ps(),this._modules.events.onAnyEvent((()=>{const t=ps();t-this._prevEventTimeStamp>this._idleTimeout&&this.resetKeys(),this._prevEventTimeStamp=t})),this._modules.settings.register("interactions.pan.keyboard",!0),this._modules.settings.register("interactions.zoom.keyboard",!0),this._setupManualControls()}_setupManualControls(){this.onKeyPress(JF,(()=>this._onKeyPress("zoomIn"))).onKeyPress(tP,(()=>this._onKeyPress("zoomOut"))).onKeyPress($F,(()=>this._onKeyPress("moveUp"))).onKeyPress(ZF,(()=>this._onKeyPress("moveDown"))).onKeyPress(KF,(()=>this._onKeyPress("moveLeft"))).onKeyPress(QF,(()=>this._onKeyPress("moveRight")))}setIdleTimeout(t){if(!isFinite(t)||t<=1)throw new TypeError("Idle timeout must be a positive number > 1");this._idleTimeout=t}resetKeys(){for(let t=0;t<this._pressed.length;t++)this._pressed[t]&&(this._pressed[t]=!1,this._modules.events.fire("keyup",{key:Lo[t],code:t}))}onKeyPress(t,e){let s=[];if(typeof t=="number")s=[t];else if(typeof t=="string")s=t.split(" ");else{if(!Array.isArray(t))throw new TypeError(`${t} is not a number, string or array`);s=t}if(s.length===0)throw new Error("the array should contain at least one element");const i=s.map((o=>{if(typeof o=="number")return[o];if(typeof o=="string"){const a=Dp[o];if(!a)throw new Error(`${o} is not a valid key identifier`);return a}throw new TypeError(`${o} is not a valid key identifier`)})),n=i.pop(),r={keys:i,handler:e};return n&&n.forEach((o=>{this._binds[o]||(this._binds[o]=[]),this._binds[o].push(r)})),this}isPressed(t){if(typeof t=="number")return this._pressed[t];if(typeof t=="string"){const e=Dp[t];if(e)return e.some((s=>this._pressed[s]))}return!1}},sP=[{name:"color",isNode:!0},{name:"shape",isNode:!0},{name:"radius",isNode:!0},{name:"icon.content",isNode:!0},{name:"image.url",isNode:!0},{name:"image",isNode:!0},{name:"color",isNode:!1},{name:"shape",isNode:!1},{name:"width",isNode:!1}],zi=Math.PI,Di=2*Math.PI,pE=Math.cos(zi/2-Di/5),_E=Math.cos(zi/2-Di/5*2),yE=Math.cos(zi/2-Di/5*3),xE=Math.cos(zi/2-Di/5*4),bE=Math.sin(-zi/2+Di/5),vE=Math.sin(-zi/2+Di/5*2),EE=Math.sin(-zi/2+Di/5*3),AE=Math.sin(-zi/2+Di/5*4),rd=1.6,SE=3,iP=.9,nl=.31,Eh=1/3,nP=[8,3],rP=[3,3],rl={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:t=>t[t.length-1]},oP=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];function wE(t){return Array.isArray(t)?t.reduce(((e,s)=>e&&wE(s)),!0):t==="undefined"||!isNaN(Number(t))}function TE(t){return Array.isArray(t)?t.reduce(((e,s)=>Math.min(e,TE(s))),1/0):typeof(t=Number(t))=="number"?isNaN(t)?1/0:+t:1/0}function CE(t){return Array.isArray(t)?t.reduce(((e,s)=>Math.max(e,CE(s))),-1/0):typeof(t=Number(t))=="number"?isNaN(t)?-1/0:+t:-1/0}function Ni(t){const e=["K","M","B","T","P","E","Z","Y"];if(t>9999){let s=0;for(;s<e.length&&t>999;)t/=1e3,s++;return(kp(t,3)+e[s-1]).toString()}return kp(t,4).toString()}function kp(t,e=3){const s=e===4?10:1;return t<10?Math.round(100*t*s)/(100*s):t<100?Math.round(10*t*s)/(10*s):t<1e3?Math.round(t*s)/s:Math.round(t)}function LE(t){return t.innerMargin+(t.titleFontSize+t.fontSize)*rd}var aP=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.title<=e.title?-1:1,lP=(t,e)=>t.height-e.height,dP=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:e.height-t.height,hP=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.content[0].title<=e.content[0].title?-1:1;function uP(t,e,s){const i=e.getContext("2d"),{x:n,y:r,height:o,isNode:a,styleProperty:l,title:d,mapping:h,iconFont:u,iconFontStyle:c}=s;mP(i,t,n,r,o),fP(i,t,d,n,r);const g=t.fontSize*rd,m=t.fontSize/2*rd*iP,f=t.fontSize*SE,p=t.fontSize,_=gP(t,a);let x=r+LE(t);const y=n+t.innerMargin+_/2,b=n+2*t.innerMargin+_,v=yo(h),A=wE(v),S=t.fontColor,w=t.shapeColor,I=Object.keys(h);if(A&&(I.sort(((M,N)=>wi(h[N])-wi(h[M]))),l==="radius"||l==="width")){const M=TE(v),N=CE(v);return(a?MP:NP)(t,i,n,x,M,(M+N)/2,N,w)}I.forEach((M=>{const N=h[M];l==="color"&&(a?IE(i,y,x,m,M):_P(i,y,x,f,p,M)),l==="shape"&&(a?SP(i,y,x,m,M,w):LP(i,y,x,f,p,M,w)),l==="icon.content"&&yP(i,y,x,M,u,m,S,c),l!=="image"&&l!=="image.url"||xP(i,y,x,m,M),pP(i,t,b,x,N,A),x+=g}))}function cP(t,e,s,i,n,r){t.beginPath(),t.arc(e,s,i,0,Di),t.strokeStyle=n,t.lineWidth=r,t.stroke()}function ma(t,e,s,i,n="left",r="normal"){t.textAlign=n,t.textBaseline="middle",t.fillStyle=i,t.font=`${r} ${s}px "${e}"`}function gP(t,e){const s=e?1:SE;return t.fontSize*s}function mP(t,e,s,i,n){return IP(t,s,i,e.widgetWidth,n,e.borderRadius,e.backgroundColor,e.borderColor,e.borderWidth)}function fP(t,e,s,i,n){ma(t,e.fontFamily,e.titleFontSize,e.titleFontColor,e.titleTextAlign);const r=e.titleTextAlign==="center",o=e.widgetWidth-2*e.innerMargin,a=t.measureText(s).width,l=i+(r?e.widgetWidth/2:e.innerMargin),d=n+e.titleFontSize/2+e.innerMargin;if(a>o){const h=o/a,u=(s.length*h|0)-2;s=s.substr(0,u)+"…"}t.fillText(s,l,d)}function pP(t,e,s,i,n,r){let o=n.join();if(r)if(n.length===1)o=Ni(n[0]);else{const a=wi(n),l=lr(n);o=`${Ni(a)} - ${Ni(l)}`}ma(t,e.fontFamily,e.fontSize,e.fontColor),t.fillText(o,s,i)}function IE(t,e,s,i,n){t.beginPath(),t.arc(e,s,i,0,2*zi),t.fillStyle=n,t.fill()}function _P(t,e,s,i,n,r){t.fillStyle=r,t.fillRect(e-i/2,s-n/2,i,n)}function yP(t,e,s,i,n,r,o,a){ma(t,n,2*r,o,"center",a),t.fillText(i,e,s)}function xP(t,e,s,i,n){if(typeof Image>"u")return;t._imgStore||(t._imgStore={});let r=t._imgStore[n];if(r)return t.drawImage(r,e-i,s-i,2*i,2*i);r=new Image,r.src=n,r.onload=()=>{t.drawImage(r,e-i,s-i,2*i,2*i)},t._imgStore[n]=r}function bP(t,e,s,i){t.fillRect(e-i,s-i*nl,2*i,2*i*nl),t.fillRect(e-i*nl,s-i,2*i*nl,2*i)}function vP(t,e,s,i){return t.beginPath(),t.moveTo(e-i,s),t.lineTo(e,s-i),t.lineTo(e+i,s),t.lineTo(e,s+i),t.fill()}function EP(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+pE*i,s+bE*i),t.lineTo(e+_E*i,s+vE*i),t.lineTo(e+yE*i,s+EE*i),t.lineTo(e+xE*i,s+AE*i),t.fill()}function AP(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+_E*i,s+vE*i),t.lineTo(e+xE*i,s+AE*i),t.lineTo(e+pE*i,s+bE*i),t.lineTo(e+yE*i,s+EE*i),t.fill()}function SP(t,e,s,i,n,r){switch(t.fillStyle=r,n){case"square":return t.fillRect(e-i,s-i,2*i,2*i);case"circle":return IE(t,e,s,i,r);case"cross":return bP(t,e,s,i);case"diamond":return vP(t,e,s,i);case"equilateral":return EP(t,e,s,i);case"star":return AP(t,e,s,i)}}function wP(t,e,s,i,n){t.fillRect(e-i/2,s-n/4,i*(1-Eh),n/2),t.beginPath(),t.moveTo(e+i*(1-Eh-.5),s-n/2),t.lineTo(e+i*(1-Eh-.5),s+n/2),t.lineTo(e+i/2,s),t.fill()}function TP(t,e,s,i,n,r,o){t.beginPath(),t.moveTo(e-i/2,s),t.lineTo(e+i/2,s),t.strokeStyle=r,t.lineWidth=n/2,t.setLineDash(o==="dashed"?nP:rP),t.stroke()}function CP(t,e,s,i,n){t.beginPath(),t.moveTo(e-i/2,s-n/2),t.lineTo(e-i/2,s+n/2),t.lineTo(e+i/2,s),t.fill()}function LP(t,e,s,i,n,r,o){return t.fillStyle=o,r==="line"&&t.fillRect(e-i/2,s-n/4,i,n/2),r==="arrow"?wP(t,e,s,i,n):r==="dashed"||r==="dotted"?TP(t,e,s,i,n,o,r):r==="tapered"?CP(t,e,s,i,n):void 0}function IP(t,e,s,i,n,r,o,a,l){t.setLineDash([]),t.beginPath(),t.moveTo(e+r,s),t.lineTo(e+i-r,s),t.quadraticCurveTo(e+i,s,e+i,s+r),t.lineTo(e+i,s+n-r),t.quadraticCurveTo(e+i,s+n,e+i-r,s+n),t.lineTo(e+r,s+n),t.quadraticCurveTo(e,s+n,e,s+n-r),t.lineTo(e,s+r),t.quadraticCurveTo(e,s,e+r,s),t.closePath(),t.fillStyle=o,t.fill(),t.strokeStyle=a,t.lineWidth=l,t.stroke()}function MP(t,e,s,i,n,r,o,a){const l=.7*t.fontSize,d=3*l,h=(l+d)/2,u=s+t.innerMargin+d,c=u+d+t.innerMargin,g=i+2*d-.5*t.innerMargin,m=t.circleStrokeWidth;for(const f of[l,h,d])cP(e,u,g-f,f,a,m);ma(e,t.fontFamily,t.fontSize,t.fontColor,"left"),e.fillText(Ni(n),c,g+l-2*l),e.fillText(Ni(r),c,g+l-2*h),e.fillText(Ni(o),c,g+l-2*d)}function NP(t,e,s,i,n,r,o,a){const l=(t.widgetWidth-2*t.innerMargin)/3,d=t.fontSize,h=i-t.innerMargin/2,u=h+2*d,c=s+t.innerMargin;e.fillStyle=a,e.fillRect(c,h-d/2,l+1,d),e.fillRect(c+l,h-d/3,l+1,d/1.5),e.fillRect(c+2*l,h-d/6,l,d/3),ma(e,t.fontFamily,t.fontSize,t.fontColor,"center"),e.fillText(Ni(o),c+.5*l,u),e.fillText(Ni(r),c+1.5*l,u),e.fillText(Ni(n),c+2.5*l,u)}function RP(t,e,s,i){const n=i.outerMargin+LE(i),r=i.fontSize*rd,o=n-.8*i.innerMargin;return e==="radius"||e==="width"?o+r*(s?3:2):o+Object.keys(t).length*r}function FP(t,e,s){const i={width:e.width,height:e.height};let n=!1;return!!(i.width&&i.height&&s)&&(n=t.position==="top"||t.position==="bottom"?kP(i,t,s,t.position==="bottom"):PP(i,t,s,t.position==="left"),n&&s.forEach((r=>uP(t,e,r))),n)}function PP(t,e,s,i){const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height;let a=e.outerMargin,l=i?e.outerMargin:t.width-n,d=1;s=s.slice().sort(aP);for(let h=0;h<s.length;++h){const u=s[h];if(a+u.height>o){if(a===e.outerMargin)return!1;a=e.outerMargin,d+=1,i?l+=n:l-=n}u.x=l,u.y=a,a+=u.height}return d<=r}function zP(t,e,s){let i=null;for(let n=0;n<e.length;++n){const r=e[n];r.isNode!==t.isNode&&e.length!==1||!(i===null||r.height<e[i].height)||(i=n)}if(i!=null){const n=e[i];n.content.push(t),n.height+=t.height+s.outerMargin}}function DP(t){let e=0;for(let s=1;s<t.length;++s)t[s].height>t[e].height&&(e=s);return e}function kP(t,e,s,i){s=s.slice();const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height-e.outerMargin,a=new Array(Math.min(r,s.length)),l=s.length;let d=0,h=0,u=0,c=0;for(let y=0;y<l;++y){const b=s[y];b.isNode?(d+=1,h+=b.height):(u+=1,c+=b.height)}const g=h+c,m=h/g,f=c/g;let p=Math.round(m*r);const _=Math.round(f*r);if(p>d?p=d:_>u&&(p=r-u),r===0)return!1;for(let y=0;y<a.length;y++)a[y]={content:[],height:0,isNode:y<p};for(let y=0;y<l;++y){const b=DP(s);zP(s[b],a,e),s.splice(b,1)}a.every((({content:y})=>y.length===1))?a.sort(hP):a.sort(dP);let x=e.outerMargin;for(let y=0;y<a.length;++y){const b=a[y];if(b.height>o)return!1;b.content.sort(lP);let v=0;for(let A=0;A<b.content.length;++A){const S=b.content[A];S.x=x,S.y=i?t.height-v-S.height-e.outerMargin:v+e.outerMargin,v+=S.height+e.outerMargin}x+=n}return!0}var OP=class extends te{constructor(){super(...arguments),this._enabled=!1,this._mustRefresh=!1,this._promises=[]}onMounted(){this._modules.events.on("frame",(()=>{this._enabled&&this._mustRefresh&&this._layer.refresh()})).on(["resize","reloadFonts"],(()=>{this._mustRefresh=!0}))}enable(t={}){const e=this._settings;return this._settings={...rl,...t},this._mustRefresh=!this._enabled||!this._sameOptions(e,this._settings),this._enabled?Promise.resolve():(this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer((s=>{this._drawOnCanvas(this._settings,s.canvas,Ns());const i=this._promises;this._promises=[],i.forEach((n=>n())),this._mustRefresh=!1}),{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this.refresh())}_afterNextUpdate(){return new Promise((t=>this._promises.push(t)))}_formatSettings(t,e){const s={...rl,...t};return oP.forEach((i=>s[i]*=e)),s}disable(){return this._enabled&&(this._enabled=!1,this._layer.destroy()),Promise.resolve()}enabled(){return this._enabled}refresh(){return this._mustRefresh=!0,this._modules.dom.refresh(),this._afterNextUpdate()}destroy(){this._enabled=!1,this._mustRefresh=!1,this._settings={...rl},this._promises=[]}getOptions(){return this._enabled?{...this._settings}:{...rl}}getCurrentOptions(){return this._settings}_sameOptions(t,e){return t===e||Object.keys(t).reduce(((s,i)=>s&&t[i]===e[i]),!0)}_drawOnCanvas(t,e,s){const i=this._formatSettings(t,s);FP(i,e,this._computeWidgetList(i))}exportOnCanvas(t,e,s){return this._drawOnCanvas(e,t,s)}export(t={}){const{width:e,height:s}={...this._modules.camera.getSize(),...t},i=Ns(),n=ls(e*i,s*i);return this._drawOnCanvas(t,n,i),Promise.resolve().then((()=>n))}_computeWidgetList(t){const e=[];return sP.forEach((({name:s,isNode:i})=>{const n=this._computeWidget(t,s,i);n&&e.push(n)})),e}_computeWidget(t,e,s){const i=this._computePropertyMapping(t,e,s);if(i){if(e!=="icon.content")return i;const n=this._getRulesForAttribute(s,"icon.font"),r=this._getRulesForAttribute(s,"icon.style");let o=null,a=null;if(n.length||(o="Arial",a="normal"),typeof n[0]=="string"&&(o=n[0],a=r[0]),o&&a)return i.iconFont=o,i.iconFontStyle=a,i}return null}_computePropertyMapping(t,e,s){const[i]=this._getRulesForAttribute(s,e),n=i&&i.mapping,r=n&&n.getValues(s);if(n&&r){const o=n.getField(),a={};return _i(r,((l,d)=>{l!==void 0&&d!=="undefined"&&(a[l]=a[l]||[],a[l].push(d))})),Object.keys(a).length===0?null:{isNode:s,title:t.titleFunction(o,e),styleProperty:e,dataProperty:o,mapping:a,height:RP(a,e,s,t)}}return null}_getRulesForAttribute(t,e){return this._modules.styleRules.getRuleList().map((s=>{const i=s.getDefinition();return ze(t?i.nodeAttributes:i.edgeAttributes,e)})).filter(ni).sort(((s,i)=>s.mapping&&i.mapping?0:s.mapping?-1:1))}},Op={layer:d0,outerStroke:{color:Db,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:kb,minVisibleSize:0}},BP={layer:d0,color:Db,text:{backgroundColor:kb,minVisibleSize:0}},Bp={duration:150,easing:"quadradicOut"},UP=class extends te{constructor(){super(...arguments),this._delay=16,this._manualTriggerDetection=!1,this._hovered=null,this._hoveredTextHidden=!1,this._onAnimate=({updatesPositions:t})=>{t&&this._hovered&&this._modules.graphics.isMoving(this._hovered)&&(this._manualTriggerDetection=!0,this._resetHover())},this._onBeforeNewFrame=()=>{if(this._manualTriggerDetection){this._manualTriggerDetection=!1,this._modules.captor.triggerDetection();const t=this._modules.captor.getPointedElement();t&&this._hover(t)}},this._onClear=()=>{this._hovered=null,this._timeout&&this._modules.dom.clearTimeout(this._timeout)},this._resetHover=()=>{this._hovered&&(this._unhover(this._hovered),this._modules.captor.triggerUnhover()),this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}}_setAnimationOptions(t){this._animationOptions={duration:t?.duration!==void 0?t.duration:Bp.duration,easing:t?.easing!==void 0?t.easing:Bp.easing},delete t?.duration,delete t?.easing}setRate(t){return this._delay=t,this}replaceNullColor(t,e){t&&ze(t,e)===null&&Li(t,e,this._modules.settings.get("backgroundColor"))}updateNodeAttributes(t,e){this._setAnimationOptions(t),this.replaceNullColor(t,"text.backgroundColor"),this._hoverClass.update({nodeAttributes:t,fullOverwrite:e}),this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}updateEdgeAttributes(t,e){this.replaceNullColor(t,"text.backgroundColor"),this.replaceNullColor(t,"text.secondary.backgroundColor"),this._setAnimationOptions(t),this._hoverClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}getHoverClassDefinition(){return this._hoverClass.getDefinition()}onMounted(){this._registerSettings(),this._setAnimationOptions(null),this._hoverExtremityHighlightedClass=this._modules.classes.createClass({name:mu,isBuiltin:!0,nodeAttributes:Op}),this._hoverClass=this._modules.classes.createClass({name:bo,isBuiltin:!0,nodeAttributes:Op,edgeAttributes:BP}),this._modules.events.on("mouseover",(({target:t})=>t&&this._hover(t))).on("mouseout",(({target:t})=>t&&this._unhover(t))).on("animate",this._onAnimate).on("beforeNewFrame",this._onBeforeNewFrame).on("mouseout",this._resetHover).on("clearGraph",this._onClear)}_registerSettings(){this._modules.settings.register("cursor.node","pointer",((t,e)=>{this._hovered&&this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))})),this._modules.settings.register("cursor.edge","pointer",((t,e)=>{this._hovered&&!this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))})),this._modules.settings.register("nodeHover",!0,(t=>{!t&&this._hovered&&this._hovered.isNode&&this._unhover(this._hovered)})),this._modules.settings.register("edgeHover",!0,(t=>{t||!this._hovered||this._hovered.isNode||this._unhover(this._hovered)}))}setEdgeExtremitiesAttributes(t,e){this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e})}_updateExtremityHighlightLayer(){const t=this._hoverClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}_removeTimeout(){this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}_hover(t){const e=t.isNode?"nodeHover":"edgeHover";this._modules.settings.get(e)&&t&&(this._removeTimeout(),this._timeout=this._modules.dom.setTimeout((()=>{this._setElementHighlight(!0,t),this._timeout=null}),this._delay))}_unhover(t){this._removeTimeout(),this._hovered===t&&(this._setElementHighlight(!1,t),this._hoverExtremityHighlightedClass.clearNodes(),this._hovered=null)}_setElementHighlight(t,e){const s=this._modules.settings.get(e.isNode?"cursor.node":"cursor.edge");if(t?(this._modules.graphics.addCursorStyle(s),e.addClass(bo,this._animationOptions),this._hovered=e):(this._modules.graphics.removeCursorStyle(s),e.removeClass(bo,this._animationOptions)),e.isNode){const i=this._modules.graph.getAttribute(e.isNode,"textHidden"),n=e._index;t&&(this._hoveredTextHidden=i.get(n)!==0);const r=!t&&this._hoveredTextHidden;i.set(n,r)}else this._hoverExtremityHighlightedClass.clearNodes(),t&&e.getExtremities().addClass(mu,this._animationOptions)}},GP=class extends te{constructor(){super(...arguments),this.x=0,this.y=0}},VP=class{constructor(t,e){this._nodeMapping={valid:!1,values:{}},this._edgeMapping={valid:!1,values:{}},this._computeMapping=e,this._field=t,this._assignedRules=[]}getValue(t,e){const s=t.isNode,i=s?this._nodeMapping:this._edgeMapping;i.valid||(i.values=this._computeMapping(s),i.valid=!0);const n=t.getData(this._field);return Array.isArray(n)?e==="color"?n.map((r=>i.values[r])):i.values[n[0]]:i.values[n]}markAsInvalid(){this._nodeMapping.valid=!1,this._edgeMapping.valid=!1}getValues(t){return t?this._nodeMapping.values:this._edgeMapping.values}getField(){return this._field}isAssignedTo(t){return this._assignedRules.find((e=>e===t))}getAssignedRules(){return this._assignedRules.slice()}assignTo(t){this.isAssignedTo(t)||this._assignedRules.push(t)}unAssignTo(t){this._assignedRules=this._assignedRules.filter((e=>e!==t))}};function ME(t,e,s){const i=(e?t.getNodes():t.getEdges()).getData(s),n={};return i.forEach((r=>{if(!Array.isArray(r))return n[r]=1;r.forEach((o=>n[o]=1))})),Object.keys(n).sort()}function qP(t,e,s,i){const{values:n={},fallback:r}=s,o=ME(t,i,e),a={};let l=0;for(let d=0;d<o.length;++d){const h=o[d];h in n?a[h]=n[h]:(a[h]=r[l],l=(l+1)%r.length)}return a}function HP(t,{nbSlices:e,minValue:s,maxValue:i}){if(Array.isArray(t))return t.slice();const{min:n=s,max:r=i}=t,o=(r-n)/e,a=[];for(let l=1;l<e;++l)a.push(n+o*l);return a}function jP(t,e){if(Array.isArray(t))return t;const{min:s,max:i}=t,n=e.length+1,r=(i-s)/e.length,o=[];for(let a=0;a<n;a++)o.push(s+a*r);return o}function YP(t,e,s,i){const{fallback:n,stops:r={},values:o,reverse:a}=s,l=ME(t,i,e);let d=1/0,h=-1/0;for(let m=0;m<l.length;m++){const f=+l[m];wd(f)&&(d=Math.min(d,f),h=Math.max(h,f),l[m]=f)}const u={};if(!isFinite(d)){for(let m=0;m<l.length;m++)u[l[m]]=n;return u}const c=HP(r,{nbSlices:Array.isArray(o)?o.length:o.nbSlices,minValue:d,maxValue:h}),g=jP(o,c);a&&g.reverse();for(let m=0;m<l.length;++m){const f=l[m];if(isFinite(f)){let p=0;for(;p<c.length&&c[p]<=f;)p+=1;u[f]=g[p]}else u[f]=n}return u}var XP=class extends te{constructor(){super(...arguments),this._mappingList=[],this._onStyleRuleRemoved=({rule:t})=>{for(const e of this._mappingList)e.unAssignTo(t.id)},this._onStyleRuleAdded=({rule:t,options:e})=>{const s=e.nodeAttributes&&typeof e.nodeAttributes!="function"?e.nodeAttributes:{},i=e.edgeAttributes&&typeof e.edgeAttributes!="function"?e.edgeAttributes:{};[...yo(s),...yo(i)].forEach((n=>{n&&this._recursiveGetMapping(n).forEach((r=>r.assignTo(t.id)))}))},this._refreshRulesAndLegend=()=>{this._mappingList.forEach((t=>{const e=t.getAssignedRules();t.markAsInvalid(),e.forEach((s=>this._modules.styleRules.refreshRule(s)))})),this._modules.legend.refresh()}}onMounted(){this._modules.events.on(["addStyleRule","updateStyleRule"],this._onStyleRuleAdded).on("removeStyleRule",this._onStyleRuleRemoved).on(["addNodes","addEdges","updateNodeData","updateEdgeData","removeNodes","beforeRemoveEdges","excludedStateChange","clearGraph"],this._refreshRulesAndLegend)}_recursiveGetMapping(t,e=[]){if(!t)return e;if(t.mapping)return e.push(t.mapping),e;if(typeof t!="object")return e;const s=yo(t).map((i=>this._recursiveGetMapping(i)));return e.concat(...s)}createMapping({field:t,values:e={},fallback:s}={field:""}){if(t=zn(t),Array.isArray(s)?s.length===0&&(s=[void 0]):s=[s],!Dn(e))throw new Error('"mapping" should be an object');return this._createMappingFunction(qP,t,{values:e,fallback:s})}createSlices({field:t,fallback:e,stops:s={},values:i,reverse:n=!1}={field:"",values:[]}){if(t=zn(t),Array.isArray(i)||i.nbSlices||(i.nbSlices=7),Array.isArray(s)&&Array.isArray(i)&&s.length!==i.length-1)throw new Error("there should be exactly one more value that stops");return this._createMappingFunction(YP,t,{fallback:e,stops:s,values:i,reverse:n})}_createMappingFunction(t,e,s){const i=new VP(e,(r=>t(this._modules.graph,e,s,r)));this._mappingList.push(i);const n=(r,o,a)=>i.getValue(r,a);return n.mapping=i,n}createTemplate(t){if(typeof t!="string")throw new TypeError('"template" should be a string');const e=[];let s=0,i=!1;for(;!i;){let n=-1;const r=t.indexOf("{{",s);r!==-1&&(n=t.indexOf("}}",r+2)),n!==-1?(e.push(t.substring(s,r)),e.push(t.substring(r+2,n)),s=n+2):(e.push(t.slice(s)),i=!0)}return function(n){let r=e[0];for(let o=1;o<e.length;o+=2)r+=n.getData(e[o]),r+=e[o+1];return r}}},Up=t=>t.stopPropagation(),WP=(t,e)=>{e.style.position="absolute",e.style.left="0",e.style.top="0",t.appendChild(e)},$P=t=>e=>{for(;t.firstChild;)t.removeChild(t.firstChild);for(let s=0;s<e.length;++s)WP(t,e[s])},ZP=(t,e)=>{const s=document.createElement("img");return new Promise((i=>{s.addEventListener("load",(()=>{e.drawImage(s,0,0,e.canvas.width,e.canvas.height),i(e)}));const n=`data:image/svg+xml;base64,${btoa(new XMLSerializer().serializeToString(t))}`;s.src=n}))},KP=class extends te{constructor(){super(...arguments),this._elements=[],this._layers=[],this.readyCallbacks=[],this.render=(t,e,s,i)=>{const n=i&&i.pixelRatio?i.pixelRatio:Ns(),{zoom:r,x:o,y:a,width:l,height:d}=i||this._modules.camera.getView();if(r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=n*r;s.noClear||t.clearRect(0,0,l*n,d*n),s.isStatic||(t.save(),t.translate(l*n/2,d*n/2),t.rotate(i?-(i.angle||0):-this._modules.camera.getAngle()),t.translate(-o*h,-a*h),t.scale(h,h)),e(t),s.isStatic||t.restore()},this.createCanvas=(t,e)=>{const{width:s,height:i}=this._modules.camera.getSize(),n=e.canvas||ls(s,i),r=e.ctx||n.getContext("2d"),o=(h=t)=>{r&&this.render(r,h,e)},a=()=>{const{width:h,height:u}=this._modules.camera.getSize(),c=Ns();n.width=h*c,n.height=u*c,n.style.width=`${h}px`,n.style.height=`${u}px`,o()};let l,d;if(e.isStatic)this._modules.events.on("resize",a),l=()=>this._modules.events.off(a);else{let h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom(),c=!1;const g=0;let m;const f=500,p=()=>{c||(o(),c=!0,h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom())},_=()=>{c||p();const{x:b,y:v}=this._modules.camera.getCenter(),A=b-h.x,S=v-h.y,w=-A*u,I=-S*u,M=this._modules.camera.getZoom()/u,N=-this._modules.camera.getAngle();n.style.transform=`
          scale(${M})
          rotate(${-N}rad)
          translateX(${w}px)
          translateY(${I}px)
          rotate(${N}rad)
        `.replace(/\n/g,"")};d=()=>!c||(o(),c=!1,n.style.transform="scale(1) translateX(0px) translateY(0px)",!1);const x=b=>{m&&clearTimeout(m),p()},y=b=>{Date.now()<g&&m&&clearTimeout(m),m=setTimeout(d,b.duration+f),p()};this._modules.events.on("dragStart",x).on("zoomStart",y).on("dragEnd",d).on(["viewChanged","zoom","rotate","move","animate"],_),this._modules.dom.addDirectWindowEventListener("resize",d),this._modules.events.on("resize",a),l=()=>{this._modules.events.off(a).off(x).off(y).off(d).off(_),this._modules.dom.removeDirectWindowEventListener("resize",d)}}return n.style.touchAction="none",n.style.pointerEvents="none",a(),{element:n,removeListeners:l,refresh:h=>{d&&!d()||o(h)},clear:()=>r?.clearRect(0,0,n.width,n.height)}},this.createSVG=t=>{const{element:e}=t;e.style["pointer-events"]="none";const s=()=>{t.draw(t.element)},i=n=>{let{zoom:r,x:o,y:a,width:l,height:d}=n||this._modules.camera.getView();if(l=Math.floor(l),d=Math.floor(d),r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=l/2/r,u=d/2/r,c=Math.cos(-this._modules.camera.getAngle()),g=Math.sin(-this._modules.camera.getAngle()),m=c*o-g*a-h,f=g*o+c*a-u,p=l/r,_=d/r;e.style.width=`${l}px`,e.style.height=`${d}px`,e.setAttribute("width",`${l}`),e.setAttribute("height",`${d}`),e.setAttribute("viewBox",`${m} ${f} ${p} ${_}`)};return this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],(()=>i())),e.addEventListener("mousemove",Up),i(),s(),{element:e,removeListeners:()=>{this._modules.events.off(i)},updateTransformation:i,refresh:s}},this._createOverlay=t=>{const e=()=>{const{element:n,position:r}=t,{zoom:o,x:a,y:l,width:d,height:h}=this._modules.camera.getView();if(o===void 0||a===void 0||l===void 0||d===void 0||h===void 0)return null;const u=o,c=d/2,g=h/2,m=-this._modules.camera.getAngle(),f=(r.x-a)*u,p=(r.y-l)*u;n.style.transformOrigin="top left",n.style.transform=`translate(${c}px, ${g}px) rotate(${m}rad) translate(${f}px, ${p}px) ${t.scaled?`scale(${u}, ${u})`:""}`};this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],e);const{element:s,size:i}=t;return i&&(s.style.width=`${i.width}`,s.style.height=`${i.height}`),s.addEventListener("mousemove",Up),e(),{element:s,removeListeners:()=>{this._modules.events.off(e)},updateTransformation:e}},this.addLayer=(t,e="layer",s=this._elements.length)=>{const i=typeof t=="string"?ru(t):t;this._elements.push(i);const n={element:i};return n.type=e,n.getLevel=()=>this._elements.indexOf(i),n.moveTo=r=>(this._elements.splice(r,0,this._elements.splice(n.getLevel(),1)[0]),this._updateDom(this._elements),n),n.moveUp=()=>n.moveTo(n.getLevel()+1),n.moveDown=()=>n.moveTo(n.getLevel()-1),n.moveToTop=()=>n.moveTo(this._elements.length-1),n.moveToBottom=()=>n.moveTo(0),n.destroy=()=>this._removeLayer(n),n.hide=()=>(n.element&&(n.element.style.visibility="hidden"),n),n.show=()=>(n.element&&(n.element.style.visibility="visible"),n),n.isHidden=()=>n.element.style.visibility==="hidden",n.setOpacity=r=>(n.element&&(n.element.style.opacity=r.toString()),n),n.getOpacity=()=>parseFloat(n.element.style.opacity||"1"),n.setPosition=r=>{if(n.element){const o=n.element.style;o.left=`${r.x}px`,o.top=`${r.y}px`}return n},n.setSize=r=>{if(n.element&&r){const{width:o,height:a}=r,l=n.element.style;l.width=`${o}px`,l.height=`${a}px`}return n},n.moveTo(s),this._layers.push(n),n},this.addCanvasLayer=(t,e={isStatic:!1,noClear:!1},s=this._elements.length)=>{const i=this.createCanvas(t,e),{element:n,removeListeners:r,refresh:o,clear:a}=i,l=this.addLayer(n,"canvas",s);return n.classList.add("ogma-canvas-layer"),l.destroy=()=>this._removeLayer(l,r),l.refresh=o,l.clear=a,l.draw=t,l.options=e,l},this.addOverlay=(t,e=this._elements.length)=>{typeof t.element=="string"&&(t.element=ru(t.element)),t.scaled=t.scaled===void 0||t.scaled;const s=this._createOverlay(t),{element:i,removeListeners:n,updateTransformation:r}=s,o=this.addLayer(i,"overlay",e);return o._onViewChange=r,o._onDestroy=n,o.destroy=()=>this._removeLayer(o,n),o.setPosition=a=>(t.position=a,r(),o),t.size&&o.setSize(t.size),o},this.addSVGLayer=(t,e=this._elements.length)=>{const s=this.createSVG(t),{element:i,refresh:n,removeListeners:r,updateTransformation:o}=s,a=this.addLayer(i,"svg",e);return a._onViewChange=o,a._onDestroy=r,a.destroy=()=>this._removeLayer(a,r),a.refresh=n,a}}canvasToImage(t,e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");this.render(i,t.draw,{...t.options,noClear:!0},{...e,pixelRatio:1});const n=_e("image");return n.setAttribute("href",s.toDataURL("image/png")),n.setAttribute("width",s.width),n.setAttribute("height",s.height),n}exportPNG(t,e,s){const i=t.getContext("2d");let n=Promise.resolve();return e.forEach((r=>{n=n.then((()=>{if(r.type!=="canvas")return r._onViewChange?.(s),ZP(r.element,i);this.render(i,r.draw,{...r.options,noClear:!0},s)}))})),n}exportSVG(t,e,s,i){let n=Promise.resolve();return e.forEach((r=>{n=n.then((()=>r.type==="canvas"?this.canvasToImage(r,s):(r._onViewChange?.(s),r.element.cloneNode(!0)))).then((o=>i?t.insertBefore(o,t.querySelector(".ogma-nodes").parentNode||t.firstChild):t.appendChild(o)))})),n}export(t){const e=this._layers.sort(((n,r)=>n.getLevel()-r.getLevel())).filter((n=>n.type==="canvas"||n.type==="svg")),s=this.ogmaLayer?this.ogmaLayer.getLevel():0,i=t.below?e.filter((n=>n.getLevel()<s)):e.filter((n=>n.getLevel()>s));return t.canvas?this.exportPNG(t.canvas,i,t.view):this.exportSVG(t.svg,i,t.view,t.below)}onMounted(){const t=this._modules.graphics.getDomElement();this._updateDom=$P(t);const e=t.firstChild;e&&(this.ogmaLayer=this.addLayer(e)),this.runCallbacks()}runCallbacks(){this.ogmaLayer&&(this.readyCallbacks.forEach((t=>t())),this.readyCallbacks=[])}whenReady(t){this.readyCallbacks.push(t),this.ogmaLayer&&this.runCallbacks()}_removeLayer(t,e){return t.element&&t.element.parentNode&&(this._elements.splice(t.getLevel(),1),e&&e(),t.element=null,this._updateDom(this._elements)),this._layers=this._layers.filter((s=>s!==t)),t}destroy(){this._elements=[]}},QP=class extends te{onMounted(){const t=this._modules.graph;this._nodeList=t.getNodeAttribute("object"),this._edgeList=t.getEdgeAttribute("object"),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target"),this._excludedList=t.getEdgeAttribute("excluded"),this._virtualList=t.getEdgeAttribute("virtual")}shortestPath(t={source:void 0,target:void 0}){const{source:e,target:s,directed:i=!1,edges:n=this._ogma.getEdges(),nodes:r=this._ogma.getNodes(),edgeCostFunction:o=(()=>1),heuristicFunction:a=(()=>0)}=t,l=n.reduce(((f,p)=>(f[p._index]=!0,f)),{}),d=r.reduce(((f,p)=>(f[p._index]=!0,f)),{}),h=this._modules.graph.getNode(e),u=this._modules.graph.getNode(s);if(!h)throw new Error("the source is not a node");if(!u)throw new Error("the target is not a node");const c=h._index,g=u._index;d[c]=!0,d[g]=!0;let m=null;if(c===g)m={nodes:h.toList(),edges:this._modules.graph.edgeList()};else{const f=this._modules.graph.getNodeMaxIndex()+1,p=new Int32Array(f),_=new Float32Array(f),x=new Float32Array(f),y=new Set,b=new Qx(x);for(_.fill(1/0),x.fill(1/0),p.fill(-1),b.add(c),_[c]=0,x[c]=a(h,u);!b.isEmpty();){const v=b.removeMin();if(v===g){m=this._constructPath(p,c,g);break}y.add(v);const A=this._modules.graph.getAdjacentDirections(v);if(A)for(let S=0;S<A.length;++S){const w=A[S],I=this._modules.graph.getEdgeIndexesInDirection(w);let M=-1,N=0,D=-1;for(let q=0;q<I.length;++q){const et=I[q],O=this._sourceList.get(et),K=this._targetList.get(et);if(O===K||!d[O]||!d[K]||i&&v!==O||!l[et])continue;const j=o(this._edgeList.get(et));(M===-1||j<N)&&(M=et,N=j,D=O===v?K:O)}if(D!==-1||y.has(D)){const q=_[v]+N;if(!b.has(D)||q<_[D]){const et=this._nodeList.get(v);p[D]=M,_[D]=q,x[D]=q+a(et,u),b.add(D)}}}}}return Promise.resolve(m)}_constructPath(t,e,s){const i=[s],n=[];let r=s;for(;r!==e;){const o=t[r],a=this._sourceList.get(o),l=this._targetList.get(o);r=r===a?l:a,i.push(r),n.push(o)}return i.reverse(),n.reverse(),{nodes:this._modules.graph.nodeList(new Uint32Array(i)),edges:this._modules.graph.edgeList(new Uint32Array(n))}}detectCycle(t,e){const s=e.getSource(),i=e.getTarget(),n=Xx(t._indexes,s._indexes,i._indexes);return n?this._modules.graph.nodeList(new Uint32Array(n)).dedupe():this._modules.graph.nodeList()}getAllSimpleCycles(t,e){const s=e.getSource(),i=e.getTarget();return new $x(t._indexes,s._indexes,i._indexes).getCycles().map((n=>this._modules.graph.nodeList(new Uint32Array(n))))}minimumSpanningTree(t,e,s){const i=this._modules.graph;t=i.getNodes(t),e=i.getEdges(e);const n=new Set;t.forEach((l=>n.add(l._index)));const r=i.getConnectedComponents(t,{filter:l=>n.has(l),internalIndexes:!0}),o={};r.forEach(((l,d)=>l.forEach((h=>o[h]=d))));const a=[];return e.forEach((l=>{const d=o[l.getSource()._index];d!==void 0&&(a[d]===void 0&&(a[d]=[]),a[d].push(l._index))})),r.map(((l,d)=>{const h=Zx(l,a[d]||[],(u=>i.edge(u).getSource()._index),(u=>i.edge(u).getTarget()._index),s?u=>s(i.edge(u)):void 0);return{nodes:i.nodeList(new Uint32Array(l)),edges:i.edgeList(new Uint32Array(h))}}))}bfs({root:t,onNode:e,onEdge:s=ae,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach((d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.unshift(h)}))}}}dfs({root:t,onNode:e,onEdge:s=ae,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach((d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.push(h)}))}}}betweenness({nodes:t,edges:e,directed:s,normalized:i}){const n=this._ogma.getNodes().subtract(t),r=this._ogma.getEdges().subtract(e).concat(n.fastGetAdjacentElements().edges).dedupe();return Kx({adjacency:t.map((o=>{const a=this._ogma.edgeList(this._ogma.modules.graph.topology.getAdjacentElements(!1,o.toList()._indexes,{direction:s?"out":"both"})).subtract(r).dedupe();return{id:o._index,adj:a.map((l=>l.getSource()._index===o._index?l.getTarget()._index:l.getSource()._index))}})),directed:s,normalized:i})}fishEyeExpand(t,e,s,i){return Hx(t,e,s,i)}},Gp=(t,e)=>{if(!t)throw new Error("Traversal options are required");if(typeof t.onNode!="function")throw new Error("onNode callback is required");if(t.root=e.getNode(t.root),!t.root)throw new Error(`Root node '${t.root}' does not exist`);return t},ol=()=>({nodes:void 0,edges:void 0}),JP=class extends Ce{constructor(){super(...arguments),this.shortestPath=t=>this._ogma.modules.algorithms.shortestPath(t),this.hasCycle=t=>{const{nodes:e,edges:s}=t||ol();return this.detectCycle({nodes:e,edges:s})!==null},this.getAllSimpleCycles=t=>{let{nodes:e,edges:s}=t||ol();return e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0})),this._ogma.modules.algorithms.getAllSimpleCycles(e,s)},this.detectCycle=t=>{let{nodes:e,edges:s}=t||ol();e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0}));const i=this._ogma.modules.algorithms.detectCycle(e,s);return i.size?i:null},this.minimumSpanningTree=t=>{const{nodes:e,edges:s,edgeCostFunction:i}=t||{...ol(),edgeCostFunction:void 0};return this._ogma.modules.algorithms.minimumSpanningTree(e,s,i)},this.dfs=t=>this._ogma.modules.algorithms.dfs(Gp(t,this._ogma.modules.graph)),this.bfs=t=>this._ogma.modules.algorithms.bfs(Gp(t,this._ogma.modules.graph)),this.betweenness=(t={})=>(t={nodes:t.nodes||this._ogma.getNodes(),edges:t.edges||this._ogma.getEdges(),directed:t.directed!==void 0&&t.directed,normalized:t.normalized===void 0||t.normalized},this._ogma.modules.algorithms.betweenness(t)),this.getMinimumEnclosingCircle=t=>{if(!t||t.size===0)throw new Error("getMinimumEnclosingCircle: no nodes provided");const e=t.getAttribute("x"),s=t.getAttribute("y"),i=t.getAttribute("radius"),[n,r,o]=ra(e,s,i);return{x:n,y:r,radius:o}},this.circlePack=({nodes:t,margin:e=0,origin:s={x:0,y:0},duration:i=0,easing:n="linear",sort:r,dryRun:o})=>{if(!t||t.size===0)throw new Error("circlePack: no nodes provided");let a=t.map(((d,h)=>({index:h,radius:+d.getAttribute("radius")+e,id:d.getId()})));if(r)if(r==="asc")a=a.sort(((d,h)=>h.radius-d.radius));else if(r==="desc")a=a.sort(((d,h)=>d.radius-h.radius));else{if(typeof r!="function")throw new Error("circlePack: invalid sort option");a=a.sort(((d,h)=>r(t.get(d.index),t.get(h.index))))}if(s&&(!isFinite(s.x)||!isFinite(s.y)))throw new Error("circlePack: invalid origin");const l=qx(a,s.x,s.y).reduce(((d,{index:h,x:u,y:c})=>(d[h]={x:u,y:c},d)),new Array(t.size));return o?l:t.setAttributes(l,{duration:i,easing:n}).then((()=>l))},this.fishEyeExpand=({nodes:t,focusNode:e,deltaRadius:s,duration:i=0,dryRun:n=!1,easing:r="linear",xyr:o})=>{if(!t||t.size===0)throw new Error("Expand/collapse: no nodes provided");if(!(e instanceof si))throw new Error("Expand/collapse: no focus node provided");if(!isFinite(s))throw new Error("Expand/collapse: invalid delta radius");const a=this._ogma.modules.algorithms.fishEyeExpand(t,e,s,o);return n?a:t.setAttributes(a,{duration:i,easing:r}).then((()=>a))}}},tz=class{getHoveredElement(){return this.modules.captor.getPointedElement()}getPointerInformation(){return this.modules.captor.getCursorInformation()}},ez=class{getNodesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getNodes(e)}getEdgesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getEdges(e)}},Ag={};Jo(Ag,{gexf:()=>NE,gexfFromUrl:()=>Sg,graphml:()=>zE,graphmlFromUrl:()=>DE,janus:()=>RE,json:()=>FE,jsonFromUrl:()=>wg,mtx:()=>sz,mtxFromUrl:()=>iz,neo4j:()=>PE});var NE=t=>Promise.resolve(ub(t)),Sg=t=>Dr(t).then((e=>ub(e))),RE=t=>Promise.resolve(iL(t)),FE=(t,e)=>Promise.resolve(nb(t,e)),wg=(t,e)=>Dr(t).then((s=>nb(s,e))),PE=t=>Promise.resolve(FL(t)),zE=(t,e)=>Promise.resolve(cb(t,e)),DE=(t,e)=>Dr(t).then((s=>cb(s,e))),sz=t=>Promise.resolve(gb(t)),iz=t=>Dr(t).then((e=>gb(e))),nz=class extends Ce{constructor(){super(...arguments),this.wait=t=>new Promise((e=>setTimeout(e,t))),this.initRandomGraph=t=>this._ogma.generate.random(t).then(this._ogma.setGraph).then((()=>this._ogma.view.locateGraph())).then((()=>this._ogma.view.afterNextFrame())),this.initGrid=t=>{const e=Math.ceil(Math.sqrt(t));return this._ogma.generate.grid({rows:e,columns:e}).then((s=>this._ogma.setGraph(s))).then((()=>this._ogma.view.locateGraph()))},this.initLine=t=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:t?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]}),this._ogma.view.locateGraph()),this.initSingleNode=()=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}],edges:[]}),this._ogma.view.locateGraph()),this.initContinuousRenderLoop=({triggerKey:t="r",start:e=!0}={})=>{let s=e;const i=()=>{s&&this._ogma.modules.dom.beforeNextFrame().then(i)};document.addEventListener("keydown",(({key:n})=>{n===t&&(s=!s,i())})),i()},this.appendToBody=()=>{const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.bottom="0",t.style.right="0",document.body.appendChild(t),this._ogma.setContainer(t)},this.loadFile=t=>(t.endsWith(".gexf")?Sg(t):wg(t)).then((e=>this._ogma.setGraph(e))).then((()=>this._ogma.view.locateGraph())).then((()=>this._ogma.view.afterNextFrame())),this.enableLasso=t=>{this._ogma.events.on("dragStart",(()=>{this._ogma.keyboard.isKeyPressed("ctrl")&&this._ogma.tools.lasso.enable(t)}))},this.randomizeGraph=({minX:t=0,minY:e=0,maxX:s=500,maxY:i=500}={})=>this._ogma.getNodes().setAttributes(this._ogma.getNodes().map((()=>({x:t+Math.random()*(s-t),y:e+Math.random()*(i-e)}))))}},rz=class{setContainer(t){this.modules.dom.setContainer(t)}getContainer(){return this.modules.dom.getContainer()}},oz=class extends Ce{constructor(){super(...arguments),this.once=(t,e)=>(this._ogma.modules.events.once(t,e),this),this.removeListener=t=>{this._ogma.modules.events.off(t)},this.onNodesAdded=t=>(this._ogma.events.on("addNodes",t),this._ogma),this.onBeforeNodesRemoved=t=>(this._ogma.events.on("beforeRemoveNodes",t),this._ogma),this.onNodesRemoved=t=>(this._ogma.events.on("removeNodes",t),this._ogma),this.onEdgesAdded=t=>(this._ogma.events.on("addEdges",t),this._ogma),this.onBeforeEdgesRemoved=t=>(this._ogma.events.on("beforeRemoveEdges",t),this._ogma),this.onEdgesRemoved=t=>(this._ogma.events.on("removeEdges",t),this._ogma),this.onGraphCleared=t=>(this._ogma.events.on("clearGraph",t),this._ogma),this.onNodesClassAdded=(t,e)=>(this._ogma.modules.classes.onNodeClassAdded(t,e),this._ogma),this.onNodesClassRemoved=(t,e)=>(this._ogma.modules.classes.onNodeClassRemoved(t,e),this._ogma),this.onEdgesClassAdded=(t,e)=>(this._ogma.modules.classes.onEdgeClassAdded(t,e),this._ogma),this.onEdgesClassRemoved=(t,e)=>(this._ogma.modules.classes.onEdgeClassRemoved(t,e),this._ogma),this.onNodeDragStart=t=>(this._ogma.events.on("nodesDragStart",t),this._ogma),this.onNodeDragProgress=t=>(this._ogma.events.on("nodesDragProgress",t),this._ogma),this.onNodeDragEnd=t=>(this._ogma.events.on("nodesDragEnd",t),this._ogma),this.onDrop=t=>(this._ogma.events.on("drop",t),this._ogma),this.onNodesSelected=t=>this.onNodesClassAdded(Ne,t),this.onNodesUnselected=t=>this.onNodesClassRemoved(Ne,t),this.onEdgesSelected=t=>this.onEdgesClassAdded(Ne,t),this.onEdgesUnselected=t=>this.onEdgesClassRemoved(Ne,t),this.onNodeDataChange=t=>(this._ogma.events.on("updateNodeData",t),this._ogma),this.onEdgeDataChange=t=>(this._ogma.events.on("updateEdgeData",t),this._ogma),this.onAnimate=t=>(this._ogma.events.on("animate",t),this._ogma),this.onMouseMove=t=>(this._ogma.events.on("mousemove",t),this._ogma),this.onMouseButtonDown=t=>(this._ogma.events.on("mousedown",t),this._ogma),this.onMouseButtonUp=t=>(this._ogma.events.on("mouseup",t),this._ogma),this.onClick=t=>(this._ogma.events.on("click",t),this._ogma),this.onDoubleClick=t=>(this._ogma.events.on("doubleclick",t),this._ogma),this.onMouseWheel=t=>(this._ogma.events.on("mousewheel",t),this._ogma),this.onHover=t=>(this._ogma.events.on("mouseover",t),this._ogma),this.onUnhover=t=>(this._ogma.events.on("mouseout",t),this._ogma),this.onDragStart=t=>(this._ogma.events.on("dragStart",t),this._ogma),this.onDragProgress=t=>(this._ogma.events.on("dragProgress",t),this._ogma),this.onDragEnd=t=>(this._ogma.events.on("dragEnd",t),this._ogma),this.onGestureStart=t=>(this._ogma.events.on("gestureStart",t),this._ogma),this.onGestureProgress=t=>(this._ogma.events.on("gestureProgress",t),this._ogma),this.onGestureEnd=t=>(this._ogma.events.on("gestureEnd",t),this._ogma),this.onRendererStateChange=t=>(this._ogma.events.on("rendererStateChange",t),this._ogma),this.onZoomProgress=t=>(this._ogma.events.on("zoom",t),this._ogma),this.onViewChanged=t=>(this._ogma.events.on("viewChanged",t),this._ogma),this.onNodesConnected=t=>(this._ogma.events.on("connectNodes",t),this._ogma),this.onGeoModeEnabled=t=>(this._ogma.events.on("geoEnabled",t),this._ogma),this.onGeoModeDisabled=t=>(this._ogma.events.on("geoDisabled",t),this._ogma),this.onGeoModeLoaded=t=>(this._ogma.events.on("geoLoaded",t),this._ogma),this.onLayoutStart=t=>(this._ogma.events.on("layoutStart",t),this._ogma),this.onLayoutComplete=t=>(this._ogma.events.on("layoutEnd",t),this._ogma),this.onLayoutComputed=t=>(this._ogma.events.on("layoutComputed",t),this._ogma),this.onTooltipShown=t=>(this._ogma.events.on("tooltipShow",t),this._ogma),this.onTooltipHidden=t=>(this._ogma.events.on("tooltipHide",t),this._ogma),this.onTransformationEnabled=t=>(this._ogma.events.on("transformationEnabled",t),this._ogma),this.onTransformationDisabled=t=>(this._ogma.events.on("transformationDisabled",t),this._ogma),this.onTransformationSetIndex=t=>(this._ogma.events.on("transformationSetIndex",t),this._ogma),this.onTransformationDestroyed=t=>(this._ogma.modules.events.on("transformationDestroyed",t),this._ogma),this.onTransformationRefreshed=t=>(this._ogma.events.on("transformationRefresh",t),this._ogma)}on(t,e){return this._ogma.modules.events.on(t,e),this}off(t){return this._ogma.modules.events.off(t),this}onKeyPress(t,e){return this._ogma.modules.keyboard.onKeyPress(t,e),this._ogma}};function od(t,e,s){if(t!=null)return Array.isArray(t)?t[0]:t}function Zu(t){return t==null?null:typeof t=="string"||typeof t=="number"?`${t}`:t&&Zu(t.content)}function az(t){if(t!=null)return typeof t=="string"?t:t.style||"line"}var lz=["color","radius","shape","text.content","x","y"],dz=["color","width","shape.body","text.content"];function hz(t){return t!=="all"?{nodes:["x","y"],edges:[]}:{nodes:lz,edges:dz}}function uz(t,{nodes:e,edges:s}){const i=t.getOriginalAttributes();return{nodes:e.reduce(((n,r)=>(n[r.getId()]={x:i.nodes.x.get(r._index),y:i.nodes.y.get(r._index),color:od(i.nodes.color.get(r._index)),radius:i.nodes.radius.get(r._index),shape:i.nodes.shape.get(r._index),text:{content:i.nodes.text.content.get(r._index)}},n)),{}),edges:s.reduce(((n,r)=>(n[r.getId()]={color:od(i.edges.color.get(r._index)),width:i.edges.width.get(r._index),shape:{type:i.edges.shape.body.get(r._index)},text:{content:i.edges.text&&i.edges.text.content&&i.edges.text.content.get(r._index)}},n)),{})}}function cz(t){return{nodes:t.nodes.map((({id:e,attributes:s={},data:i})=>{const{color:n,radius:r,shape:o,text:a,x:l,y:d}=s;return{id:e,x:l,y:d,color:od(n),size:r,shape:o,text:Zu(a),data:i}})),edges:t.edges.map((({id:e,source:s,target:i,attributes:n={},data:r})=>{const{color:o,width:a,text:l,shape:d}=n;return{id:e,source:s,target:i,color:od(o),size:a,shape:az(d),text:Zu(l),data:r}}))}}function Vp(t){return t instanceof si?t.getId():t}function qp(t){return t instanceof nn?t.getId():t}function Hp(t){return t instanceof Pi?t.getId():t instanceof si?[t.getId()]:as(t)?t.map(Vp):[Vp(t)]}function jp(t){return t instanceof Un?t.getId():t instanceof nn?[t.getId()]:as(t)?t.map(qp):[qp(t)]}var Tg="visible";function gz(t,e){return t?Hp(t):typeof e=="object"?Hp(e.nodes):e||Tg}function mz(t,e){return t?jp(t):typeof e=="object"?jp(e.edges):e||Tg}function kE(t,e,s,i){const n=gz(e,i),r=mz(s,i);return{nodes:t.getNodes(n),edges:t.getEdges(r)}}function OE(t,{nodeAttributes:e,edgeAttributes:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const l=kE(t,i,n,r);return{nodes:l.nodes.toJSON({attributes:e,data:o}),edges:l.edges.toJSON({attributes:s,data:a})}}function Dd(t,e,{styles:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const{nodes:l,edges:d}=hz(s),h=OE(t,{nodeAttributes:l,edgeAttributes:d,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a});if(s==="original"){const u=uz(e,kE(t,i,n,r));for(const c of h.nodes)c.id!=null&&(c.attributes=u[c.id]);for(const c of h.edges)c.id!=null&&(c.attributes=u[c.id])}return s==="all"&&h.edges.forEach((({source:u,target:c,attributes:g})=>{if(g){const m=t.getNode(u);if(g.color==="source"&&m){const p=m.getAttribute("color");g.color=Array.isArray(p)?p[0]:p}const f=t.getNode(c);if(g.color==="target"&&f){const p=f.getAttribute("color");g.color=Array.isArray(p)?p[0]:p}}})),cz(h)}function fz(t,e){for(let s=0;s<e.length;++s){if(t==null)return;t=t[e[s]]}return t}function pz(t,e,s){for(let i=0;i<e.length-1;++i){const n=e[i];let r=t[n];r===void 0&&(r={},t[n]=r),t=r}t[e[e.length-1]]=s}function _z(t){const e={...t[0]};for(const s of t)for(const i of Object.keys(s))i in e||(e[i]=void 0);return Object.keys(e)}function Yp(t,e){return t==null||Array.isArray(t)&&!t.length?e:t}function yz(t){return typeof t=="string"}function xz(t,e,s,i,n){const r=e==="edges",o={};return t.forEach(((a,l)=>{const d=n.get(l),h=jh(Yp(s(d),e));if(!h.every(yz))throw Error(`The tab ${e} function returned an invalid value.`);const u=jh(i(a.data,h));h.forEach(((c,g)=>{const m=Yp(u[g],{}),f=Pd({internal___id:a.id,...r?{internal___source:a.source,internal___target:a.target}:{},...m}).reduce(((p,{path:_,value:x})=>(p[_.join(".")]=x,p)),{});o[c]=o[c]||[],o[c].push(f)}))})),o}function bz(t){if(!t.length)return[];const e=_z(t),s=[e];for(const i of t)s.push(e.map((n=>i[n])));return s[0]=s[0].map((i=>i.replace("internal___",""))),s}function vz(t,e,s){const i=new nv;let n=e?1:3;const r=[];for(let a=0;a<t.length;++a){const l=t[a],d=new Array(n);let h=l.data;if(s){const c={};s.forEach((g=>{const m=zn(g),f=fz(h,m);pz(c,m,f)})),h=c}const u=Pd(h);d[0]=l.id,e||(d[1]=l.source,d[2]=l.target);for(let c=0;c<u.length;++c){const{path:g,value:m}=u[c];g.length&&(i.has(g)?d[i.get(g)]=m:(i.set(g,n),d[n]=m,n++))}r.push(d)}const o=[];return o.push("id"),e||(o.push("source"),o.push("target")),i.keys().forEach((a=>o.push(a[a.length-1]))),r.unshift(o),r.forEach((a=>a.length=n)),r}var Ez=/[=+\-@|%]/,Az=t=>t.length>0&&Ez.test(t[0])?!isNaN(Number(t))&&isFinite(Number(t))?`${t}`:`'${t=t.replace("|","|")}`:t;function BE(t){return t===void 0?"":t instanceof Date?t.toISOString():Az(""+t)}var Sz={what:void 0,dataProperties:void 0,separator:",",textSeparator:'"',download:!0,filename:"graph.csv",filter:"visible",nodes:void 0,edges:void 0,nodeData:ni,edgeData:ni,styles:"none"};function wz(t,e){const{what:s,dataProperties:i,nodes:n,edges:r,separator:o,textSeparator:a,download:l,nodeData:d,edgeData:h,filename:u,filter:c}=Os(typeof e=="string"?{what:e}:e,Sz),g=Dd(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:n,edges:r,filter:c,nodeData:d,edgeData:h});try{const m=Tz(g,{what:s,separator:o,textSeparator:a,dataProperties:i});return l&&un(m,u,"text","text/csv"),Promise.resolve(m)}catch(m){return Promise.reject(m)}}function Tz(t,{what:e,separator:s,textSeparator:i,dataProperties:n}){const r=new RegExp(i,"g");if(i&&i!=='"'&&i!=="'")throw new TypeError(`Invalid argument :"textSeparator" is not single-quote or double-quote, was ${i}`);if(e!=="nodes"&&e!=="edges")throw new TypeError('missing argument: "what": should have value "nodes" or "edges"');const o=e==="nodes";return vz(o?t.nodes:t.edges,o,n).map((a=>a.map((l=>(function(h){return i+BE(h).replace(r,`${i}${i}`).replace(/\n/g,"\\n").replace(/\r/g,"")+i})(l))))).map((a=>a.join(s))).join(`
`)}var Kn=t=>Math.round(255*t);function Xp(t,e){if(e==="integer"&&typeof t=="number"){if(t%1!=0)return"float"}else if(typeof t!="number")return typeof t=="boolean"?"boolean":"string";return e}var Ku=t=>typeof t=="object"&&t!==null&&t.constructor===Object;function Qu(t,e={}){return _i(t,((s,i)=>{Ku(s)?Qu(s,e):e[i]=s})),e}var Cz={creator:void 0,description:void 0,styles:"all",download:!0,filename:"graph.gexf",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function Lz(t,e={}){const{styles:s,nodes:i,edges:n,download:r,filename:o,creator:a,description:l,filter:d,nodeData:h,edgeData:u}=Os(e,Cz),c=Iz(Dd(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{creator:a,description:l});return r&&un(c,o,"text","text/xml"),Promise.resolve(c)}function Iz(t,e){const s=uv(),i={},n={};let r,o=0,a=0;const l=s.createElement("gexf");l.setAttribute("xmlns","http://www.gexf.net/1.2draft"),l.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),l.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),l.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),l.setAttribute("version","1.2");const d=s.createElement("meta");if(d.setAttribute("lastmodifieddate",Oy()),e.creator){const f=s.createElement("creator");r=s.createTextNode(""+e.creator),f.appendChild(r),d.appendChild(f)}if(e.description){const f=s.createElement("description");r=s.createTextNode(""+e.description),f.appendChild(r),d.appendChild(f)}const h=s.createElement("graph");h.setAttribute("mode","static");const u=s.createElement("nodes");t.nodes.forEach((f=>{const p=s.createElement("node");if(p.setAttribute("id",String(f.id)),f.text&&p.setAttribute("label",ar(f.text)),Ku(f.data)){const x=Qu(f.data),y=s.createElement("attvalues");Object.keys(x).forEach((b=>{b in i||(i[b]={id:o,type:"integer"},o++);const v=x[b];i[b].type=Xp(v,i[b].type);const A=s.createElement("attvalue");A.setAttribute("for",i[b].id),A.setAttribute("value",ar(v)),y.appendChild(A)})),p.appendChild(y)}if(f.color){const x=ys(f.color);if(x){const y=s.createElement("viz:color");y.setAttribute("r",Kn(x[0])),y.setAttribute("g",Kn(x[1])),y.setAttribute("b",Kn(x[2])),y.setAttribute("a",x[3]),p.appendChild(y)}}const _=s.createElement("viz:position");if(_.setAttribute("x",f.x),_.setAttribute("y",-f.y),p.appendChild(_),f.size){const x=s.createElement("viz:size");x.setAttribute("value",f.size),p.appendChild(x)}u.appendChild(p)}));const c=s.createElement("attributes");c.setAttribute("class","node"),Object.keys(i).forEach((f=>{const p=s.createElement("attribute");p.setAttribute("id",i[f].id),p.setAttribute("title",f),p.setAttribute("type",i[f].type),c.appendChild(p)}));const g=s.createElement("edges");t.edges.forEach((f=>{const p=s.createElement("edge");if(p.setAttribute("id",f.id.toString()),p.setAttribute("source",f.source),p.setAttribute("target",f.target),f.size&&p.setAttribute("weight",f.size),f.text&&p.setAttribute("label",ar(f.text)),Ku(f.data)){const _=Qu(f.data),x=s.createElement("attvalues");Object.keys(_).forEach((y=>{y in n||(n[y]={id:a,type:"integer"},a++);const b=_[y];n[y].type=Xp(b,n[y].type);const v=s.createElement("attvalue");v.setAttribute("for",n[y].id),v.setAttribute("value",ar(b)),x.appendChild(v)})),p.appendChild(x)}if(f.color){const _=ys(f.color);if(_){const x=s.createElement("viz:color");x.setAttribute("r",Kn(_[0])),x.setAttribute("g",Kn(_[1])),x.setAttribute("b",Kn(_[2])),x.setAttribute("a",_[3]),p.appendChild(x)}}if(f.size){const _=s.createElement("viz:size");_.setAttribute("value",f.size),p.appendChild(_)}g.appendChild(p)}));const m=s.createElement("attributes");return m.setAttribute("class","edge"),Object.keys(n).forEach((f=>{const p=s.createElement("attribute");p.setAttribute("id",n[f].id),p.setAttribute("title",f),p.setAttribute("type",n[f].type),m.appendChild(p)})),h.appendChild(c),h.appendChild(m),h.appendChild(u),h.appendChild(g),l.appendChild(d),l.appendChild(h),s.appendChild(l),`<?xml version="1.0" encoding="UTF-8"?>${s.serialize()}`}var Mz={graphId:"G",directedEdges:!0,styles:"all",download:!0,filename:"graph.graphml",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function Nz(t,e){const{styles:s,nodes:i,edges:n,download:r,filename:o,graphId:a,directedEdges:l,filter:d,nodeData:h,edgeData:u}=Os(e,Mz),c=Rz(Dd(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{graphId:a,directedEdges:l,noStyles:s==="none"});return r&&un(c,o,"text","text/xml"),Promise.resolve(c)}function Rz(t,e){const s=cv();function i(c,g,m,f,p){m=m||{};const _=s.createElement(g);for(const x in m){if(!Object.prototype.hasOwnProperty.call(m,x))continue;const y=m[x];y!==void 0&&_.setAttribute(x,y)}return(f!==void 0||p)&&(Object.prototype.toString.call(f)==="[object Object]"&&(f=JSON.stringify(f)),_.appendChild(s.createTextNode(f))),c.appendChild(_),_}const n=["id","source","target"],r=["size","x","y","shape","text","color"],o={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}};e.noStyles&&(delete o.color,delete o.r,delete o.g,delete o.b,delete o.a,delete o.shape,r.pop());const a=[],l=[];function d(c,g){const m={id:c.id};r.forEach((f=>{let p=c[f];f==="y"&&p&&(p=-parseFloat(p)),p!==void 0&&(m[(g==="edge"?"edge_":"")+f]=p,f==="color"&&(function(x,y){const b=ys(y);b&&(x.r=b[0],x.g=b[1],x.b=b[2])})(m,p))})),_i(c.data||{},((f,p)=>{r.indexOf(p)===-1&&n.indexOf(p)===-1&&(o[p]?o[p].for!==g&&(o[p].for="all"):o[p]={for:g,type:"string"},m[p]=f)})),g==="edge"?(m.source=c.source,m.target=c.target,l.push(m)):a.push(m)}t.nodes.forEach((c=>d(c,"node"))),t.edges.forEach((c=>d(c,"edge")));const h=i(s,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});_i(o,((c,g)=>{c.for!=="node"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"node",id:g}),c.for!=="edge"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"edge",id:"edge_"+g})})),i(h,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"}),i(h,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});const u=i(h,"graph",{edgedefault:e.directedEdges||e.directedEdges===void 0?"directed":"undirected",id:e.graphId?e.graphId:"G","parse.nodes":t.nodes.length,"parse.edges":t.edges.length,"parse.order":"nodesfirst"});return a.forEach((c=>{const g=i(u,"node",{id:c.id});(function(f,p){const _=i(f,"data",{key:"nodegraphics"}),x=i(_,"y:ShapeNode");i(x,"y:Geometry",{x:p.x,y:p.y,width:p.size,height:p.size}),e.noStyles||i(x,"y:Fill",{color:Eu(p.color),transparent:!1}),i(x,"y:NodeLabel",null,p.text||""),i(x,"y:Shape",{type:p.shape})})(g,c),_i(c,((m,f)=>{n.indexOf(f)===-1&&i(g,"data",{key:f},m,!0)}))})),l.forEach((c=>{const g=i(u,"edge",{id:c.id,source:c.source,target:c.target});(function(f,p){const _=i(f,"data",{key:"edgegraphics"}),x=i(_,"y:PolyLineEdge");i(x,"y:LineStyle",{type:p.edge_type,color:e.noStyles?void 0:Eu(p.edge_color),width:p.edge_size}),i(x,"y:EdgeLabel",null,p.edge_label)})(g,c),_i(c,((m,f)=>{n.indexOf(f)===-1&&i(g,"data",{key:f},m,!0)}))})),`<?xml version="1.0" encoding="UTF-8"?>
${yg(s)}`}var Fz={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:ni,edgeData:ni,filter:"visible",pretty:!1,download:!0,filename:"graph.json",anonymize:!1};function Pz(t,e={}){e.anonymize&&(e={nodeAttributes:"all",edgeAttributes:"all",nodeData:Pl,edgeData:Pl,filter:e.filter||"all",download:e.download,pretty:e.pretty,filename:e.filename});const{nodeAttributes:s,edgeAttributes:i,nodeData:n,edgeData:r,filter:o,pretty:a,download:l,filename:d}=Os(e,Fz),h=OE(t.modules.graph,{nodeAttributes:s,edgeAttributes:i,filter:o,nodeData:n,edgeData:r}),u=a?JSON.stringify(h,null," "):JSON.stringify(h);return l&&un(u,d,"text","application/json"),Promise.resolve(h)}function zz(t,e){return t.getBoundingBox().computeForZoom(e).extend(Cs.fromValues(t.getAttribute("x"),t.getAttribute("y"),t.map((s=>s.getAttribute("radius")+s.getAttribute("innerStroke.width")+s.getAttribute("outerStroke.width")))))}function Dz(t,e,s){const i=e.view.graphToScreenCoordinates(s.bottomLeft()),n=e.view.graphToScreenCoordinates(s.topRight()),r=Math.abs(n.x-i.x),o=Math.abs(n.y-i.y),a=Math.min(t.width/r,t.height/o);t.width=r*a,t.height=o*a}function UE(t,e={}){const s=t.view.get(),i=typeof e.margin=="number"?e.margin:0,n={pixelRatio:e.pixelRatio||Ns(),angle:0,backgroundColor:null,zoom:0,x:0,y:0,width:0,height:0,hideImages:!1,renderBackground:!0,isBufferDisplayable:Fl};if(e.width&&e.height?(n.width=e.width,n.height=e.height):(n.width=s.width,n.height=s.height),e.clip)n.zoom=s.zoom,n.x=s.x,n.y=s.y;else{const r=zz(t.getNodes(e.filter),s.zoom);if(e.texts){const o=t.modules.labels.getTextsBoundingBox();o.isValid()&&r.extend(o)}e.width!=null&&isFinite(e.width)&&e.height!=null&&isFinite(e.height)||Dz(n,t,r),n.width=Math.max(n.width,2*i),n.height=Math.max(n.height,2*i),n.x=r.cx,n.y=r.cy,n.zoom=Math.min((n.width-2*i)/r.width,(n.height-2*i)/r.height)}return t.modules.geo.isEnabled()?n.backgroundColor=null:e.background!==void 0&&(n.backgroundColor=e.background),n}function Ju(t,e,s,i,n=!1){const r={...s,hideImages:n,angle:s.angle||0,currentTime:ps(),isBufferDisplayable:l=>e.texts||!fb(l),bentEnable:!1,bentVertical:!1},o={};if(e.badges===!1){const l={text:null,image:null};o.badges={topLeft:l,topRight:l,bottomRight:l,bottomLeft:l}}const a=t.styles.getClass(An);return a&&a.update({nodeAttributes:o}),t.modules.graphics.export(i,r,e.filter||Tg,e)}var al=t=>({download:!0,filter:"visible",filename:`graph.${t}`,clip:!1,margin:10,width:void 0,height:void 0,background:null,badges:!0,legend:void 0,texts:!0,preventOverlap:!0,images:!0,textWatermark:{content:"",fontFamily:"Arial",fontSize:48,fontStyle:void 0,fontColor:"red",repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageWatermark:{url:void 0,width:void 0,height:void 0,repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageCrossOrigin:void 0,layers:!0,pixelRatio:void 0}),kz={png:al("png"),jpg:al("jpg"),tiff:al("tiff"),gif:al("gif")};function Oz(t){const{canvas:e,parameters:s}=t;return s.textWatermark.content&&Wp(e,s.textWatermark,Yz,Xz),s.imageWatermark.url?Sx(s.imageWatermark.url).then((i=>(i&&(s.imageWatermark.content=i,Wp(e,s.imageWatermark,$z,Wz)),t))):t}function Bz(t){const{ogma:e,canvas:s,parameters:i}=t,n=e.modules.legend;let r=null;return i.legend===void 0&&(r=!!n.enabled()&&n.getCurrentOptions()),i.legend===!0&&(r={}),r&&n.exportOnCanvas(s,r,t.parameters.pixelRatio),t}function Uz(t){const{canvas:e,parameters:s,view:i}=t;if(!i.renderBackground)return t;i.renderBackground=!1;const n=e.getContext("2d");return n.fillStyle=s.background,n.fillRect(0,0,e.width,e.height),t}function Gz(t){const{ogma:e,view:s}=t;return e.modules.geo.isEnabled()?e.modules.geo.exportBackground(s).then((i=>{const n=s.width*s.pixelRatio,r=s.height*s.pixelRatio,o=ls(n,r),a=o.getContext("2d");return a.drawImage(i,(n-i.width)/2,(r-i.height)/2),a.drawImage(t.canvas,0,0),t.canvas=o,t})):t}function Vz(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,canvas:i,below:!0}).then((()=>t)):t}function qz(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,below:!1,canvas:i}).then((()=>t)):t}function Hz(t){const{ogma:e,parameters:s,canvas:i,view:n}=t,r=i.getContext("2d");return Ju(e,s,n,"canvas",!s.images).then((o=>{try{const a=o.getContext("2d");if(!a)throw new Error("Failed to render graph");return a.getImageData(0,0,1,1),r.drawImage(o,0,0,i.width,i.height),t}catch(a){return tn(a),Ju(e,s,n,"canvas",!0).then((l=>(r.drawImage(l,0,0,i.width,i.height),t)))}}))}function jz({canvas:t,parameters:e,type:s}){const i=t.toDataURL("image/"+s);return e.download&&un(i,e.filename,"dataURL","image/"+s),i}function ll(t,e,s){const i=Os(e,kz[s]);i.filename.endsWith(s)||(i.filename+="."+s),i.background===null&&(i.background=t.modules.graphics.getTransparentBackgroundColor());const n=UE(t,i);i.pixelRatio=n.pixelRatio;const r=ls(n.width*n.pixelRatio,n.height*n.pixelRatio),o={ogma:t,parameters:i,canvas:r,view:n,type:s};return Promise.resolve().then((()=>o)).then(Uz).then(Gz).then(Vz).then(Hz).then(qz).then(Oz).then(Bz).then(jz).then((a=>(t.modules.events.fire("afterImageExport"),a)))}function Yz(t,e,s,i){t.textAlign="center",t.textBaseline="middle",t.fillText(e,s,i)}function Xz(t,e,s){return{width:t.measureText(e).width,height:s}}function Wz(t,e,s,i,n){return{width:i===void 0?e.width:i,height:n===void 0?e.height:n}}function $z(t,e,s,i,n,r){t.drawImage(e,s-n/2,i-r/2,n,r)}function Wp(t,e,s,i){if(!e)return;if(typeof e!="object")e={content:e};else if(!e.content)return;const{fontFamily:n,fontSize:r,fontStyle:o,fontColor:a,repeat:l,alpha:d,space:h,content:u}=e;let c=e.angle;const g=t.getContext("2d"),m=t.width,f=t.height,p=e.x===void 0?m/2:e.x,_=e.y===void 0?f/2:e.y,x=e.height,y=e.width;c=c/180*Math.PI,an(g,n,r,o),g.fillStyle=a,g.globalAlpha=d;const b=i(g,u,r,y,x);if(l){const v=b.width+h,A=b.height+h,S=Math.sqrt(m*m+f*f);g.save(),g.translate(0,0),g.rotate(c);for(let w=0;w<S;w+=v)for(let I=0;I<S;I+=A)s(g,u,w,I,b.width,b.height),I!==0&&s(g,u,w,-I,b.width,b.height);g.restore()}else g.save(),g.translate(p,_),g.rotate(c),s(g,u,0,0,b.width,b.height),g.restore()}var Zz={download:!0,filename:"graph.svg",width:void 0,height:void 0,background:null,texts:!0,preventOverlap:!0,groupSemantically:!0,images:!0,badges:!0,embedFonts:!1,layers:!0,clip:!1,margin:10,prefix:"ogma"};function Kz(t,e){const s=Os(e,Zz),{background:i,filename:n,download:r,layers:o}=s,a=t.modules.graphics;i===null&&(s.background=a.getTransparentBackgroundColor());const l=UE(t,s);return Ju(t,s,l,"svg",!s.images).then((d=>(d.removeAttribute("pointer-events"),d.setAttribute("version","1.1"),d.setAttributeNS(nu,"xmlns",Ic),d.setAttributeNS(nu,"xmlns:xlink",Ax),d))).then((d=>s.groupSemantically?Jz(t,d,s):d)).then((d=>eD(d,s))).then((d=>Qz(t,l,d))).then((d=>$p(t,l,d,o,!0))).then((d=>$p(t,l,d,o,!1))).then((d=>(t.modules.events.fire("afterImageExport"),d))).then((d=>{const h=`<?xml version="1.0" encoding="utf-8"?>${yg(d)}`;return r&&un(h,n,"text","image/svg+xml"),h}))}function Qz(t,e,s){return t.modules.geo.isEnabled()?t.modules.geo.exportBackground({...e,pixelRatio:1}).then((i=>{const n=_e("image",{width:i.width,height:i.height,x:0,y:0,href:i.toDataURL()});return s.insertBefore(n,s.children[0]),s})):Promise.resolve(s)}function $p(t,e,s,i,n=!1){return i?t.modules.layers.export({view:e,svg:s,below:n}).then((()=>s)):Promise.resolve(s)}function Jz(t,e,s){const i=e.childNodes[2],n=i.childNodes,r={},o=s.prefix;for(let g=0;g<n.length;g++){const m=n[g],f=m.getAttribute(qs);f!=null&&(r[f]=r[f]||[],r[f].push(m))}const a=Object.keys(r),l=t.modules.graph,d=l.getNodeAttribute("id"),h=l.getEdgeAttribute("id"),u=_e("g",{class:`${o}-edges`}),c=_e("g",{class:`${o}-nodes`});for(let g=0;g<a.length;g++){const m=a[g],f=m.charAt(0)==="n",p=parseInt(m.substring(1)),_=r[m],x=ar((f?d:h).get(p).toString()),y=_e("g");y.setAttribute(`data-${f?"node":"edge"}-id`,x),y.setAttribute("class",`${o}-${f?"node":"edge"}`);for(let b=0;b<_.length;b++){const v=_[b];y.appendChild(v),v.removeAttribute(qs)}(f?c:u).appendChild(y)}return i.appendChild(u),i.appendChild(c),e}function tD(t){const e=[].concat(Array.prototype.slice.call(t.getElementsByTagName("text")||[])),s=[],i={};for(let n=0;n<e.length;n++){const r=e[n].parentNode.getAttribute("font-family");if(typeof r=="string"){const o=r.split(",");for(let a=0;a<o.length;a++){const l=o[a].replace(/['"]/g,"");l===""||i[l]||(i[l]=!0,s.push(l))}}}return{list:s,map:i}}function eD(t,e){const s=tD(t).map;return tv().then((i=>i.filter((n=>s[n.name])))).then((i=>ev(i,!!e.embedFonts))).then((i=>{if(i.length!==0){const n=_e("style");for(let r=0;r<i.length;r++)n.appendChild(Mc(i[r]));t.childNodes[0].appendChild(n)}return t}))}var sD={what:void 0,dataProperties:void 0,filter:"visible",nodes:void 0,edges:void 0,download:!0,filename:"graph.xlsx",tab:void 0,nodeData:void 0,edgeData:void 0};function iD(t,e={}){typeof e=="string"&&(e={what:e});const{what:s,nodes:i,edges:n,tab:r={nodes:()=>"nodes",edges:()=>"edges"},download:o,filename:a,dataProperties:l,filter:d,nodeData:h,edgeData:u}=Os(e,sD);r.nodes||(r.nodes=()=>"nodes"),r.edges||(r.edges=()=>"edges");const c=Dd(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:i,edges:n,filter:d,nodeData:m=>m,edgeData:m=>m}),g=nD(c,{what:s,tabFunctions:r,tabContentFunctions:{nodes:h||(m=>$h(Fo(m||{}),l)),edges:u||(m=>$h(Fo(m||{}),l))}},{nodes:t.modules.graph.getNodes(c.nodes.map((({id:m})=>m))),edges:t.modules.graph.getEdges(c.edges.map((({id:m})=>m)))});return o&&un(g,a,"blob","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),Promise.resolve(g)}function nD(t,{what:e,tabFunctions:s,tabContentFunctions:i},n){const r=Xs("XLSX")||Xs("xlsx",{throwOnError:!0});if(!r)throw Error('The xlsx exports requires the "xlsx" peer dependency to be associated');const o=new oD;if(e){if(e!=="nodes"&&e!=="edges")throw new TypeError(`Invalid argument: "what" is not "nodes" or "edges", was ${e}`);e==="nodes"&&(t.edges=[]),e==="edges"&&(t.nodes=[])}const a={};for(const l of["nodes","edges"]){const d=xz(t[l],l,s[l],i[l],n[l]);for(const h of Object.keys(d))a[h]=[...a[h]||[],...d[h]]}for(const l of Object.keys(a))o.SheetNames.push(l),o.Sheets[l]=rD(r,bz(a[l]));return o.SheetNames.length===0&&(o.SheetNames=["nodes","edges"],o.Sheets.nodes={},o.Sheets.edges={}),zo([aD(r.write(o,{bookType:"xlsx",bookSST:!1,type:"binary"}))],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")}function rD(t,e){const s={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let n=0;n!==e.length;++n){const r=e[n];for(let o=0;o!==r.length;++o){const a=r[o];i.s.r>n&&(i.s.r=n),i.s.c>o&&(i.s.c=o),i.e.r<n&&(i.e.r=n),i.e.c<o&&(i.e.c=o);const l={v:a,t:"s"};typeof a=="number"?l.t="n":a instanceof Date?l.t="d":typeof a=="boolean"?l.t="b":l.v=BE(a),s[t.utils.encode_cell({c:o,r:n})]=l}}return i.s.c<1e7&&(s["!ref"]=t.utils.encode_range(i)),s}var oD=class{constructor(){this.SheetNames=[],this.Sheets={}}};function aD(t){const e=new ArrayBuffer(t.length),s=new Uint8Array(e);for(let i=0;i!==t.length;++i)s[i]=255&t.charCodeAt(i);return e}var lD=class extends Ce{constructor(t){super(t),this.csv=e=>wz(this._ogma,e),this.xlsx=e=>(e&&e.dataProperties&&void 0,iD(this._ogma,e)),this.gexf=e=>Lz(this._ogma,e),this.graphml=(e={})=>Nz(this._ogma,e),this.json=(e={})=>Pz(this._ogma,e),this.svg=(e={})=>Kz(this._ogma,e),this.png=(e={})=>ll(this._ogma,e,"png"),this.jpg=(e={})=>ll(this._ogma,e,"jpg"),this.tiff=(e={})=>ll(this._ogma,e,"tiff"),this.gif=(e={})=>ll(this._ogma,e,"gif"),t.styles.createClass({name:An,isBuiltin:!0})}};function dD(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zp,Kp={exports:{}};function hD(){return Zp||(Zp=1,Kp.exports=(function(){return t.importState=function(s){var i=new t;return i.importState(s),i},t;function t(){return(function(s){var i=0,n=0,r=0,o=1;s.length==0&&(s=[+new Date]);var a=e();i=a(" "),n=a(" "),r=a(" ");for(var l=0;l<s.length;l++)(i-=a(s[l]))<0&&(i+=1),(n-=a(s[l]))<0&&(n+=1),(r-=a(s[l]))<0&&(r+=1);a=null;var d=function(){var h=2091639*i+23283064365386963e-26*o;return i=n,n=r,r=h-(o=0|h)};return d.next=d,d.uint32=function(){return 4294967296*d()},d.fract53=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.version="Alea 0.9",d.args=s,d.exportState=function(){return[i,n,r,o]},d.importState=function(h){i=+h[0]||0,n=+h[1]||0,r=+h[2]||0,o=+h[3]||0},d})(Array.prototype.slice.call(arguments))}function e(){var s=4022871197,i=function(n){n=n.toString();for(var r=0;r<n.length;r++){var o=.02519603282416938*(s+=n.charCodeAt(r));o-=s=o>>>0,s=(o*=s)>>>0,s+=4294967296*(o-=s)}return 23283064365386963e-26*(s>>>0)};return i.version="Mash 0.9",i}})()),Kp.exports}var uD=hD(),cD=dD(uD),gD=cD(42),Ye=()=>gD.next(),mD=({nodes:t=10,edges:e=10,texts:s=!1,scale:i=100}={})=>({nodes:t,edges:e,texts:s,scale:i});function fD({nodes:t,scale:e,texts:s,edges:i}){const n=[],r=[];for(let o=0;o<t;o++)n.push({id:o,attributes:{x:Ye()*e,y:Ye()*e,text:s?`Node ${o}`:void 0}});for(let o=0;o<i;o++)r.push({id:o,source:Ye()*t|0,target:Ye()*t|0,attributes:{text:s?`Edge ${o}`:void 0}});return{nodes:n,edges:r}}var Qp=Object.freeze(Object.defineProperty({__proto__:null,configure:mD,generate:fD},Symbol.toStringTag,{value:"Module"})),pD=({rows:t=4,columns:e=4,columnDistance:s=20,rowDistance:i=20,xmin:n=0,ymin:r=0}={})=>({rows:t,columns:e,columnDistance:s,rowDistance:i,xmin:n,ymin:r});function _D({rows:t,columns:e,columnDistance:s,rowDistance:i,xmin:n,ymin:r}){const o={nodes:[],edges:[]};let a=0;for(let l=0;l<t;++l)for(let d=0;d<e;++d){const h=l*e+d;o.nodes.push({id:h,attributes:{x:n+d*s,y:r+l*i}}),d!==e-1&&(o.edges.push({id:a,source:h,target:l*e+d+1}),a++),l!==t-1&&(o.edges.push({id:a,source:h,target:(l+1)*e+d}),a++)}return o}var Jp=Object.freeze(Object.defineProperty({__proto__:null,configure:pD,generate:_D},Symbol.toStringTag,{value:"Module"})),yD=({length:t=5,scale:e=100}={})=>({length:t,scale:e});function xD({length:t,scale:e}){const s={nodes:[],edges:[]};if(t<=0)return s;s.nodes.push({id:0,attributes:{x:Ye()*e,y:Ye()*e}});for(let i=1;i<t;++i)s.nodes.push({id:i,attributes:{x:Ye()*e,y:Ye()*e}}),s.edges.push({id:i-1,source:i-1,target:i});return s}var t_=Object.freeze(Object.defineProperty({__proto__:null,configure:yD,generate:xD},Symbol.toStringTag,{value:"Module"}));function bD(t){return typeof t=="number"&&isFinite(t)&&t>=0?t:void 0}function vD(t){return typeof t=="number"&&isFinite(t)&&t>0?t:void 0}function mo(t){return typeof t=="number"&&isFinite(t)?t:void 0}function ED({children:t=2,height:e=3}={}){if(!vD(t))throw new TypeError('Invalid argument: "children" is not a positive number, was '+t);if(!bD(e))throw new TypeError('Invalid argument: "height" is not a positive number, was '+e);return{children:t,height:e}}function AD({children:t,height:e}){e+=1;const s=Math.pow(t,e),i=[],n=[];let r=1,o=0,a=0;for(let l=0;l<e;++l){const d=s/(r+1)/1.5;for(let h=0;h<r;++h){const u=o++;if(i.push({id:u,attributes:{x:(h+1)*d*10,y:20*l}}),l!==e-1)for(let c=0;c<t;++c)n.push({id:a,source:u,target:u*t+c+1}),a+=1}r*=t}return{nodes:i,edges:n}}var e_=Object.freeze(Object.defineProperty({__proto__:null,configure:ED,generate:AD},Symbol.toStringTag,{value:"Module"}));function SD({nodes:t=20,edges:e,p:s,scale:i=100}={}){if(!mo(t)||t<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t);if(e!==void 0&&s!==void 0)throw new TypeError("Invalid argument: choose between options.edges and options.p");return e===void 0&&s===void 0&&(s=.1),s===void 0&&(s=-1),e===void 0&&(e=-1),{nodes:t,p:s,edges:e,scale:i}}function wD(t){const e={nodes:[],edges:[]},s=t.nodes,i=t.p,n=t.scale;if(i>=0){let r=0;for(let o=0;o<s;o++){e.nodes.push({id:o,attributes:{x:Ye()*n,y:Ye()*n}});for(let a=0;a<o;a++)Ye()<i&&e.edges.push({id:r++,source:o,target:a})}}else{const r=[],o=t.edges;for(let l=0;l<s;l++){e.nodes.push({id:l,attributes:{x:100*Ye(),y:100*Ye()}});for(let d=l+1;d<s;d++)r.push({source:l,target:d})}let a=r.length-1;for(let l=0;l<o;l++){const d=r.splice(Math.floor(Ye()*a),1)[0];d.id=l,e.edges.push(d),a--}}return e}var s_=Object.freeze(Object.defineProperty({__proto__:null,configure:SD,generate:wD},Symbol.toStringTag,{value:"Module"}));function TD({nodes:t=40,m0:e=5,m:s=1,scale:i=100}={}){if(!mo(t)||t<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t);if(!mo(e)||e>=t)throw new TypeError(`Invalid argument: options.m0 is not a number < ${t}, was ${e}`);if(!mo(e)||s>=e)throw new TypeError(`Invalid argument: options.m is not a number <= ${e}, was ${s}`);if(!mo(i)||i<0)throw new TypeError("Invalid argument: options.scale is not a number or is less than 0");return{nodes:t,m0:e,m:s,scale:i}}function CD({scale:t,nodes:e,m0:s,m:i}){const n={nodes:[],edges:[]},r={},o=[],a=t/10;let l=0;for(let d=0;d<s;d++)n.nodes.push({id:d,attributes:{x:Ye()*a,y:Ye()*a}}),o[d]=0;for(let d=0;d<s;d++)for(let h=d+1;h<s;h++){const u={id:l++,source:d,target:h};r[u.source+"-"+u.target]=u,n.edges.push(u),o[d]++,o[h]++}for(let d=s;d<e;d++){n.nodes.push({id:d,attributes:{x:Ye()*t,y:Ye()*t}}),o[d]=0;let h=0;for(let c=0;c<d;c++)h+=o[c];let u=0;for(let c=0;c<i;c++){const g=Ye();let m=0;for(let f=0;f<d;f++)if(!r[`${d}-${f}`]&&!r[`${f}-${d}`]&&(m=d===1?1:m+o[f]/h+u/(d-c),g<=m)){u+=o[f]/h;const p={id:l++,source:d,target:f};r[`${p.source}-${p.target}`]=p,n.edges.push(p),o[d]++,o[f]++;break}}}return n}var i_=Object.freeze(Object.defineProperty({__proto__:null,configure:TD,generate:CD},Symbol.toStringTag,{value:"Module"}));function LD({nodes:t=50,width:e=100,height:s=100,x:i=0,y:n=0}={}){if(!isFinite(t)||t<1)throw new RangeError("Tree generator: number of nodes must be a positive integer");return{nodes:t,width:e,height:s,x:i,y:n}}function ID({nodes:t,x:e,y:s,width:i,height:n}){const r=e-i/2,o=s-n/2;return{nodes:new Array(t).fill(0).map(((a,l)=>({id:l,attributes:{x:r+Ye()*i,y:o+Ye()*n}}))),edges:new Array(t-1).fill(0).map(((a,l)=>({id:l,source:Math.floor(Math.sqrt(l)),target:l+1})))}}var n_=Object.freeze(Object.defineProperty({__proto__:null,configure:LD,generate:ID},Symbol.toStringTag,{value:"Module"})),MD=5,ND=10,RD=10,FD=2.7,PD=.2;function zD({depth:t=3,breadth:e=3,nodes:s}){return s!==void 0?(e=5,t=Math.ceil(Math.log(s)/Math.log(5))):s=-1,{depth:t,breadth:e,nodes:s}}function DD({depth:t,breadth:e,nodes:s}){const i={id:0,attributes:{x:0,y:0,radius:VE(t+1)}},n={nodes:[i],edges:[]};return qE(n,e,t,i,1),s!==void 0&&s>=0&&(n.nodes=n.nodes.slice(0,s),n.edges=n.edges.slice(0,Math.max(s-1,0))),n}function GE(t){return Math.pow(FD,t)*ND}function VE(t){return MD+GE(t)/RD}function qE(t,e,s,i,n){if(s===0)return n;const r=GE(s),o=VE(s),a=o*PD;let l=-Math.PI;const d=2*Math.PI/e,h=i.attributes.x||0,u=i.attributes.y||0;for(let c=0;c<e;++c){const g={id:n,attributes:{x:h+r*Math.cos(l),y:u+r*Math.sin(l),radius:o}},m={id:n,source:i.id,target:n,attributes:{width:a}};t.nodes.push(g),t.edges.push(m),n=qE(t,e,s-1,g,n+1),l+=d}return n}var r_=Object.freeze(Object.defineProperty({__proto__:null,configure:zD,generate:DD},Symbol.toStringTag,{value:"Module"})),kD=class extends Ce{constructor(){super(...arguments),this.balancedTree=t=>Promise.resolve(e_.generate(e_.configure(t))),this.barabasiAlbert=t=>Promise.resolve(i_.generate(i_.configure(t))),this.erdosRenyi=t=>Promise.resolve(s_.generate(s_.configure(t))),this.flower=t=>Promise.resolve(r_.generate(r_.configure(t))),this.grid=t=>Promise.resolve(Jp.generate(Jp.configure(t))),this.path=t=>Promise.resolve(t_.generate(t_.configure(t))),this.random=t=>Promise.resolve(Qp.generate(Qp.configure(t))),this.randomTree=t=>Promise.resolve(n_.generate(n_.configure(t)))}},OD=class extends Ce{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.geo.enable(t),this.disable=t=>this._ogma.modules.geo.disable(t),this.setOptions=t=>this._ogma.modules.geo.setOptions(t),this.getOptions=()=>this._ogma.modules.geo.getOptions(),this.getMap=()=>this._ogma.modules.geo.getMap(),this.enabled=()=>this._ogma.modules.geo.isEnabled(),this.getCenter=()=>this._ogma.modules.geo.getCenter(),this.getView=()=>this._ogma.modules.geo.getView(),this.getZoom=()=>this._ogma.modules.geo.getZoom(),this.setZoom=t=>this._ogma.modules.geo.setZoom(t),this.setView=(t,e,s)=>this._ogma.modules.geo.setView(t,e,s),this.setCenter=(t,e)=>this._ogma.modules.geo.setCenter(t,e),this.toggle=t=>this._ogma.modules.geo.toggle(t),this.resetCoordinates=()=>this._ogma.modules.geo.resetCoordinates(),this.getUnprojectedCoordinates=t=>this._ogma.modules.geo.getUnprojectedCoordinates(this._ogma.getNodes(t)),this.runLayout=async({type:t,nodes:e,latitudePath:s=mi,longitudePath:i=fi,options:n,center:r})=>{if(t===void 0||n===void 0)throw new Error("Ogma.geo.runLayout: Both layout type and options are required");if(e=this._ogma.getNodes(e),r===void 0){let o=0;if(r=e.reduce(((a,l)=>{const d=l.getData(s),h=l.getData(i);return isNaN(d)||isNaN(h)||(a.latitude+=d,a.longitude+=h,o++),a}),{latitude:0,longitude:0}),isNaN(r.latitude)||isNaN(r.longitude))throw new Error("Ogma.geo.runLayout: No valid center coordinates found");r.latitude/=o,r.longitude/=o}return this._ogma.modules.geo.runLayout({center:r,nodes:e,type:t,options:n,latitudePath:s,longitudePath:i})}}},BD=class{reloadFonts(){this.modules.graphics.reloadFonts()}},UD=class extends Ce{constructor(){super(...arguments),this.gexf=t=>NE(t),this.gexfFromUrl=t=>Sg(t),this.janus=t=>RE(t),this.json=(t,e)=>FE(t,e),this.jsonFromUrl=(t,e)=>wg(t,e),this.neo4j=t=>PE(t),this.graphml=(t,e)=>zE(t,e),this.graphmlFromUrl=(t,e)=>DE(t,e)}},GD=class extends Ce{constructor(){super(...arguments),this.isKeyPressed=t=>this._ogma.modules.keyboard.isPressed(t),this.resetKeys=()=>{this._ogma.modules.keyboard.resetKeys()}}},VD=class extends Ce{addLayer(t,e){return this._ogma.modules.layers.addLayer(t,"layer",e)}addCanvasLayer(t,e,s){return this._ogma.modules.layers.addCanvasLayer(t,e,s)}addOverlay(t,e){if(!t.position)throw new Error("options.position argument is required");return this._ogma.modules.layers.addOverlay(t,e)}addSVGLayer(t,e){return t.element||(t.element=document.createElementNS("http://www.w3.org/2000/svg","svg")),t.draw||(t.draw=()=>{}),this._ogma.modules.layers.addSVGLayer(t,e)}},o_={name:"concentric",configure:function(t,{graph:e,data:s}){if(t.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');const i={...t,centralNode:(function(b,v){return v instanceof si?v:b.getNode(v)})(e,t.centralNode)},{centralNode:n,nodes:r}=i,o=e.getNode(n);if(o===void 0)throw new Error('concentric layout: "centralNode" parameter is not valid');const a=o._index,{x:l,y:d}=o.getPosition(),h=r.getAttribute("layoutable"),u=e.getNodes(r)._indexes,c=Array.from(u.filter(((y,b)=>h[b])));c.indexOf(a)===-1&&c.push(a);const g=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(u),m=(function(b,v,A,S){if(v)return v==="random"?"random":v==="radius"?S.slice():v==="degree"?A.getDegree():b.getProperty(A,v)})(s,i.sortBy,r,g),f=c.reduce(((y,b,v)=>(y[b]=v,y)),{}),p=c.map(((y,b)=>b)),_=new Set(t.edges.getExtremities()._indexes),x=c.map((y=>e.topology.getAdjacentElements(!0,new Uint32Array([y])).filter((b=>_.has(b))).map((b=>f[b]))));return{sourceNodeIndex:c.indexOf(a),centerX:typeof i.centerX=="number"?i.centerX:l,centerY:typeof i.centerY=="number"?i.centerY:d,list:c,indexes:p,size:c.length,totalSize:c.length,attributes:{adjacentNodes:x,size:g},sortAttr:m,clockwise:i.clockwise===void 0||i.clockwise,circleHopRatio:i.circleHopRatio||5,allowOverlap:!!i.allowOverlap}},context:function(){return{dijkstra:function(t,e,s,i,n){const r=Math.pow(2,31)-1,o=new Int32Array(i),a=new Int32Array(i),l=new Int8Array(i);o.fill(r),a.fill(-1);for(let h=0;h<i;++h){const u=e[h];u!==void 0&&(o[u]=r,a[u]=-1)}o[n]=0;let d=0;for(;d!==-1;){let h=r;d=-1;for(let u=0;u<s;++u){const c=e[u],g=o[c];!l[c]&&g<h&&(h=g,d=c,l[c]=1)}if(d>-1){const u=t[d],c=h+1;u.forEach((g=>{const m=o[g];c<m&&(o[g]=c,a[g]=d)}))}}return o},determinePropertyType:function(t,e,s){return e.some((i=>t[i]!=="number"))?"string":"number"}}},update:function(t,e){const{attributes:s,indexes:i,size:n}=t,{sourceNodeIndex:r,centerX:o,centerY:a,sortAttr:l}=t,d=s.adjacentNodes,h=s.size,u=new Array(t.totalSize),c=new Array(t.totalSize),g=e.dijkstra(d,i,t.size,t.totalSize,r);let m=0;const f={};for(let A=0;A<n;A++){const S=h[i[A]];S>m&&(m=S)}const p=m*t.circleHopRatio;let _=0,x=0;const y=Math.PI/9;for(let A=0;A<n;A++){const S=i[A],w=g[S];let I=f[w];I||(I=[],f[w]=I),I.push(S)}const b=(function(S,w,I){if(S==="random")return function(){return Math.random()-.5};if(S)return I.determinePropertyType(S,w,w.length)==="number"?function(M,N){return S[M]-S[N]}:function(M,N){return S[M]<S[N]?-1:1}})(l,i,e),v=l==="random"||l;return Object.keys(f).sort(((A,S)=>parseInt(A)-parseInt(S))).forEach(((A,S)=>{const w=f[A],I=w.length;let M=0,N=x;const D=2*Math.PI/I;if(S!==0&&!t.allowOverlap){const q=2*Math.PI*_;let et=0;M+=w.reduce(((O,K)=>O+h[K]),0),et=2*M*Math.SQRT2,et>q&&(_+=et/(2*Math.PI)-_)}v&&(w.sort(b),t.clockwise||w.reverse());for(let q=0;q<I;q++){const et=w[q];u[et]=Math.cos(N)*_+o,c[et]=Math.sin(N)*_+a;const O=h[et];N+=D*(t.allowOverlap?1:O/M*I)}_+=p,x+=y})),{x:u,y:c,indexes:t.list}},isRunning:function(){return!1},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}},qD=t=>(t.modules.layouts.register(o_),e=>t.modules.layouts.start(o_.name,e)),HD=Object.defineProperty,Ot=(t,e)=>HD(t,"name",{value:e,configurable:!0});function Rr(t){let e=0,s=0;for(const o of t)e+=o.w*o.h,s=Math.max(s,o.w);t.sort(((o,a)=>a.h-o.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let n=0,r=0;for(const o of t)for(let a=i.length-1;a>=0;a--){const l=i[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,r=Math.max(r,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===l.w&&o.h===l.h){const d=i.pop();a<i.length&&(i[a]=d)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(i.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:n,h:r,fill:e/(n*r)||0}}Ot(Rr,"g");var a_=Ot(((t,e)=>Array.from({length:t},((s,i)=>e(i)))),"me"),ki=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),jD=Ot((()=>({[WebGL2RenderingContext.FLOAT]:"uniform1f",[WebGL2RenderingContext.FLOAT_VEC2]:"uniform2fv",[WebGL2RenderingContext.FLOAT_VEC3]:"uniform3fv",[WebGL2RenderingContext.FLOAT_VEC4]:"uniform4fv",[WebGL2RenderingContext.INT]:"uniform1i",[WebGL2RenderingContext.INT_VEC2]:"uniform2iv",[WebGL2RenderingContext.INT_VEC3]:"uniform3iv",[WebGL2RenderingContext.INT_VEC4]:"uniform4iv",[WebGL2RenderingContext.UNSIGNED_INT]:"uniform1ui",[WebGL2RenderingContext.UNSIGNED_INT_VEC2]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC3]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC4]:"uniform2uiv",[WebGL2RenderingContext.FLOAT_MAT2]:"uniformMatrix2fv",[WebGL2RenderingContext.FLOAT_MAT3]:"uniformMatrix3fv",[WebGL2RenderingContext.FLOAT_MAT4]:"uniformMatrix4fv",[WebGL2RenderingContext.SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.SAMPLER_CUBE]:"uniform1i"})),"we"),dl=new Map,Ah=new Map,YD=Ot(((t,e,s,i)=>{dl.has(t)||dl.set(t,dl.size);const n=`${dl.get(t)}:${e}:${s}`;return Ah.has(n)||Ah.set(n,i()),Ah.get(n)}),"ze"),dn=Ot(((t,e)=>()=>([t,e]=[e,t],[t,e])),"$"),ee=Ot(((t,e=ki)=>{const s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),s}),"b"),l_=Ot(((t,e,s)=>{const i=t.createShader(e);if(i===null)throw new Error("Cannot create WebGL shader.");return t.shaderSource(i,s),t.compileShader(i),i}),"ce"),cn=Ot(((t,e,s)=>YD(t,e,s,(()=>{const i=t.createProgram();if(t.attachShader(i,l_(t,t.VERTEX_SHADER,e)),t.attachShader(i,l_(t,t.FRAGMENT_SHADER,s)),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const n=t.getProgramInfoLog(i);throw t.deleteProgram(i),new Error(`Could not link WebGL program: 
${n}`)}return i}))),"q"),Ts=Ot(((t,{size:e,data:s,type:i,internalFormat:n=t.RGBA32F,format:r=t.RGBA})=>{const o=t.createTexture(),[a,l]=e.map((d=>Math.max(1,d)));return s instanceof Float32Array&&s.byteLength===0?s=new Float32Array(a*l*4):s instanceof Uint32Array&&s.byteLength===0&&(s=new Uint32Array(a*l*4)),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,a,l,0,r,i,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{size:e,data:s,type:i,format:r,handle:o}}),"k"),hn=Ot(((t,e)=>{const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i!==t.FRAMEBUFFER_COMPLETE){const n={[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]:"Attachment is NOT complete.",[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]:"No valid attachment.",[t.FRAMEBUFFER_UNSUPPORTED]:"Attachment types are not supported."}[i];throw n?new Error(`Framebuffer: ${n}`):new Error(`Framebuffer: Unknown reason (status: ${i})`)}return s}),"W"),Vn=Ot(((t,e,s)=>{t.useProgram(e);const i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const o=t.getActiveUniform(e,r);if(!o)throw new Error(`Cannot get GL active uniform ${r}.`);const{name:a,size:l,type:d}=o,h=t.getUniformLocation(e,a);if(!h)throw new Error(`Cannot get GL uniform location ${a}.`);i[a]={size:l,data:s[a],type:d,location:h}}return i}),"Y");function gn(t,e,s={}){let i=0;const n=jD();return Object.entries(e).forEach((([r,{location:o,type:a,data:l}])=>{let d=s[r]!==void 0?s[r]:l;(a===t.SAMPLER_2D||a===t.INT_SAMPLER_2D||a===t.UNSIGNED_INT_SAMPLER_2D)&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,d),d=i,i++),t[n[a]](o,d)}))}Ot(gn,"J");var d_=Ot(((t,e=!1)=>{const s=e?1<<Math.ceil(Math.log2(Math.sqrt(t))):Math.ceil(Math.sqrt(t));return{w:s,h:s}}),"ue"),ir=Ot(((t,e,{x:s,y:i,w:n})=>{const r=s+t%n;return(i+Math.floor(t/n))*e+r}),"Q"),tc=Ot((t=>{const e=new Map,s={nodes:[],edges:[]};return t.nodes.forEach(((i,n)=>{e.has(i.id)&&console.warn(`Duplicated ID ${i.id}@${n}`),s.nodes.push({...i,id:n}),e.set(i.id,n)})),t.edges.forEach((i=>{const n=e.get(i.source),r=e.get(i.target);return n===void 0?console.warn(`Missing source ${i.source}`):r===void 0?console.warn(`Missing target ${i.target}`):void s.edges.push({...i,source:Math.min(n,r),target:Math.max(n,r)})})),s.edges.sort(((i,n)=>i.source-n.source||i.target-n.target)),s}),"it"),XD=Ot((({nodes:t,edges:e},[s,i]=[0,0],n=.001)=>{const r=Math.PI*(3-Math.sqrt(5)),o=t.map((l=>(l.x=(l.x||0)-s,l.y=(l.y||0)-i,l))).map((l=>({n:l,key:l.pinned?0:.5+Math.floor(l.x/n)+Math.floor(l.y/n)/n}))).sort(((l,d)=>l.key-d.key));let a=0;return o.forEach((({n:l,key:d},h)=>{if(d*h==0||d!==o[h-1].key)return a=h;const u=Math.sqrt(h-a);l.x=o[a].n.x+u*Math.cos(r*(h-a)),l.y=o[a].n.y+u*Math.sin(r*(h-a))})),{nodes:t,edges:e}}),"at"),h_=Ot(((t,e)=>{const s={};return e.forEach(((i,n)=>(s[i]??(s[i]=new Set)).add(n))),[...Object.values(s)].map((i=>({nodes:[...i].map((n=>t.nodes[n])),edges:t.edges.filter((({source:n,target:r})=>i.has(n)&&i.has(r)))})))}),"st");function ec(t,e){const s=e.map((({nodes:y})=>({x:0,y:0,...d_(y.length,!0)}))),i=e.map((({edges:y})=>({x:0,y:0,...d_(2*y.length)}))),n=Rr(s.slice()),r=Rr(i.slice()),o=n.w*n.h,a=r.w*r.h,l=new Float32Array(4*o),d=new Uint32Array(3*o),h=new Uint32Array(2*a),u=new Float32Array(4*o),c=new Float32Array(a);e.forEach((({nodes:y,edges:b},v)=>{const A=y.length,S=b.length,w=s[v],I=i[v],M=new Uint32Array(S),N=new Uint32Array(S),D=new Uint32Array(A);for(let j=0;j<S;j++){const{source:ot,target:it}=b[j];M[j]=ot,N[j]=it,D[ot]++,D[it]++}const q=a_(A,(()=>[]));M.forEach(((j,ot)=>{q[j].push(N[ot]),q[N[ot]].push(j)}));const et=a_(A,(()=>[]));M.forEach(((j,ot)=>{if(b[ot].stiffness!==void 0)et[j].push(b[ot].stiffness),et[N[ot]].push(b[ot].stiffness);else{const it=D[j],ct=D[N[ot]],pt=it*ct/(Math.min(it,ct)*(it+ct));et[j].push(pt),et[N[ot]].push(pt)}}));for(let j=0;j<A;j++){const ot=4*ir(j,n.w,w);l[ot]=y[j].x||0,l[ot+1]=y[j].y||0}let O=0;for(let j=0;j<A;j++){const ot=3*ir(j,n.w,w);d[ot]=O%I.w,d[ot+1]=Math.floor(O/I.w),d[ot+2]=D[j],O+=D[j]}let K=0;for(let j=0;j<A;j++)for(const ot of q[j]){const it=2*ir(K,r.w,I);h[it]=ot%w.w,h[it+1]=Math.floor(ot/w.w),K++}for(let j=0;j<A;j++){const ot=4*ir(j,n.w,w);u[ot]=y[j].mass||D[j]+1,u[ot+1]=y[j].r||1,u[ot+2]=y[j].pinned?1:0}K=0;for(let j=0;j<A;j++)for(const ot of et[j]){const it=ir(K,r.w,I);c[it]=ot,K++}}));const g=Ts(t,{size:[n.w,n.h],data:l,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),m=Ts(t,{size:[n.w,n.h],data:u,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),f=Ts(t,{size:[n.w,n.h],data:d,type:t.UNSIGNED_INT,format:t.RGB_INTEGER,internalFormat:t.RGB32UI}),p=Ts(t,{size:[r.w,r.h],data:h,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI}),_=Ts(t,{size:[r.w,r.h],data:c,type:t.FLOAT,format:t.RED,internalFormat:t.R32F}),x=Ts(t,{size:[n.w,n.h],data:u,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F});return{items:e.map((({nodes:y,edges:b},v)=>({N:y.length,E:b.length,particlesPositionsSlot:s[v],particlesChargesSlot:s[v],adjacencyOffsetsSlot:s[v],adjacencyListsSlot:i[v],stiffnessSlot:i[v],nodesExtraPropertiesSlot:s[v]}))),texture:{particlesPositions:()=>g,particlesCharges:()=>m,adjacencyOffsets:()=>f,adjacencyLists:()=>p,stiffness:()=>_,nodesExtraProperties:()=>x}}}Ot(ec,"mt");var u_=Ot(((t,e)=>{t.deleteTexture(e.texture.particlesPositions().handle),t.deleteTexture(e.texture.particlesCharges().handle),t.deleteTexture(e.texture.adjacencyOffsets().handle),t.deleteTexture(e.texture.adjacencyLists().handle),t.deleteTexture(e.texture.stiffness().handle),t.deleteTexture(e.texture.nodesExtraProperties().handle)}),"ct"),Io=Ot((()=>({x:0,y:0,w:0,h:0})),"Z"),WD=`#version 300 es
precision highp float;precision highp int;vec2 c(vec2 c,vec2 e){return vec2(c.x*e.x-c.y*e.y,c.x*e.y+c.y*e.x);}vec2 c(vec2 c){return c.y=-c.y,c;}vec2 c(vec2 i[8],vec2 s,vec2 a){vec2 t,o=a-s,e=vec2(1,0);for(int s;s<8;++s)t+=c(i[s],e),e=c(e,o);return t;}vec2 c(vec2 e,vec4 c){return(e-c.xy)/c.zw;}uniform float m_x,m_y,m_z,m_10,m_11,m_12,m_u,m_v,m_w;uniform highp sampler2D m_13;uniform highp usampler2D m_14,m_15;uniform highp sampler2D m_16,m_17,m_7;uniform highp usampler2D m_18,m_19;uniform highp sampler2D m_1j,m_1k;flat in uvec4 m_2b,m_2c,m_2d,m_2e,m_2f,m_26,m_29,m_28,m_1y;flat in uint m_22,m_27,m_20;out vec4 outColor;void main(){uvec2 s=uvec2(gl_FragCoord.xy)-m_2b.xy;if(m_2b.z*s.y+s.x>=m_22)return;vec3 a=texelFetch(m_16,ivec2(m_2c.xy+s),0).xyz;if(a.z>0.)return;vec4 l=texelFetch(m_13,ivec2(m_2b.xy+s),0);vec2 i=l.xy,e=l.zw;ivec4 t=ivec4(texelFetch(m_14,ivec2(m_2e.xy+s),0));vec4 o=texelFetch(m_7,ivec2(m_26.xy),0);float r=float(1u<<m_27-1u);ivec2 u=ivec2(r*c(i,o));vec2 v=(vec2(u)+.5)/r;ivec2 p=u-ivec2(1);for(int c;c<9;++c){ivec2 t=p+ivec2(c%3,c/3);if(t>>m_27-1u!=ivec2(0))continue;uvec2 s=texelFetch(m_19,ivec2(m_28.xy)+t,0).xy;for(uint c=s.x;c<s.y;c++){uint l=texelFetch(m_18,ivec2(m_29.xy)+ivec2(c%m_29.z,c/m_29.z),0).x;ivec2 o=ivec2(l%m_2b.z,l/m_2b.z);vec2 t=texelFetch(m_13,ivec2(m_2b.xy)+o,0).xy-i;float u=dot(t,t)+1e-4;if(m_11>0.&&m_u<.5){float i=texelFetch(m_16,ivec2(m_2c.xy)+o,0).y,c=max(a.y+i+m_12,.01);if(u<c*c){float s=sqrt(u);e-=(c-s)*m_11*i/c*t/s;}}float r=texelFetch(m_16,ivec2(m_2c.xy)+o,0).x;e-=m_u*m_x*r*t/u;}}if(m_27>2u){vec2 t[8];ivec2 s=ivec2(m_1y.xy)+u;vec4 a=texelFetch(m_1j,s,0),l=texelFetch(m_1k,s,0);if(t[0]=a.xy,t[1]=a.zw,t[2]=l.xy,t[3]=l.zw,m_20>4u){vec4 c=texelFetch(m_1j,s,0);t[4]=c.xy,t[5]=c.zw;}if(m_20>6u){vec4 c=texelFetch(m_1k,s,0);t[6]=c.xy,t[7]=c.zw;}vec2 r=c(c(t,v,c(i,o))/o.z);e+=m_u*m_x*r;}ivec2 n;for(int s;s<t.z;s++){n=ivec2(texelFetch(m_15,ivec2(m_2d.xy)+t.xy,0).xy);float o=texelFetch(m_17,ivec2(m_2f.xy)+t.xy,0).x;vec2 c=texelFetch(m_13,ivec2(m_2b.xy)+n,0).xy-i;if(c*=1.-m_10/(length(c)+1e-4),e+=m_u*m_z*o*c/a.x,t.x+=1,t.x>=int(m_2d.z))t.x=0,t.y+=1;}e=m_v*(e-m_u*m_y*i);float x=dot(e,e);if(x>m_w)e*=sqrt(m_w/x);outColor=vec4(i+e,e);}`,$D=`#version 300 es
precision highp int;
precision highp float;

uniform uint m_c; 
uniform uvec2 m_1b;

in vec2 position; 
in uvec4 m_1c; 
in uvec4 m_1d; 
in uvec4 m_1e; 
in uvec4 m_1f; 
in uvec4 m_1g; 
in uvec4 m_s; 
in uvec4 m_1h; 
in uvec4 m_1i; 
in uvec4 m_e; 

in uint m_5; 
in uint m_t; 
in uint m_g; 

flat out uvec4 m_2b;
flat out uvec4 m_2c;
flat out uvec4 m_2d;
flat out uvec4 m_2e;
flat out uvec4 m_2f;
flat out uvec4 m_26;
flat out uvec4 m_29;
flat out uvec4 m_28;
flat out uvec4 m_1y;

flat out uint m_22;
flat out uint m_27;
flat out uint m_20;

void main() {
  m_2b = m_1c;
  m_2c = m_1d;
  m_2d = m_1e;
  m_2e = m_1f;
  m_2f = m_1g;
  m_26 = m_s;
  m_29 = m_1h;
  m_28 = m_1i;
  m_1y = m_e;

  m_22 = m_5;
  m_27 = m_t;
  m_20 = m_g;

  
  if(m_c != m_t - 1u) {
    gl_Position = vec4(0.f, 0.f, 0.f, 1.f);
    return;
  }

  
  vec2 posPx = (position + 1.f) * vec2(m_1c.zw) * .5f + vec2(m_1c.xy);
  gl_Position = vec4(posPx / vec2(m_1b) * 2.f - 1.f, 0.f, 1.f);
}`,ZD=Ot(((t,e,{charge:s,gravity:i,inertia:n,edgeStrength:r,edgeLength:o,elasticity:a,margin:l,maxDisplacement:d})=>{const h=cn(t,$D,WD),u=e.texture.particlesPositions(),c=Ts(t,{type:t.FLOAT,size:u.size,data:new Float32Array(u.data.buffer.slice(0)),format:t.RGBA,internalFormat:t.RGBA32F}),g=dn(u,c),m=hn(t,c.handle),f=hn(t,u.handle),p=dn(m,f),_=Vn(t,h,{m_u:1,m_v:n,m_w:d**2,m_x:s,m_y:i,m_z:r,m_10:o,m_11:a,m_12:l,m_13:u.handle,m_14:e.texture.adjacencyOffsets().handle,m_15:e.texture.adjacencyLists().handle,m_16:e.texture.nodesExtraProperties().handle,m_17:e.texture.stiffness().handle,m_c:2,m_7:e.texture.spatialBoundaries().handle,m_18:e.texture.spatialKeys().handle,m_19:e.texture.gridCells().handle,m_1a:null,m_1b:u.size});let x=u;const y=[],b=new Set;function v(S=1){t.viewport(0,0,u.size[0],u.size[1]),t.useProgram(h),t.bindFramebuffer(t.FRAMEBUFFER,p()[0]);const[w,I]=g();x=I,b.forEach((M=>{t.bindVertexArray(y[M]),gn(t,_,{m_u:S,m_13:w.handle,m_7:e.texture.spatialBoundaries().handle,m_18:e.texture.spatialKeys().handle,m_c:M,m_1j:e.texture.localExpansions(M,0)?.handle,m_1k:e.texture.localExpansions(M,1)?.handle,m_14:e.texture.adjacencyOffsets().handle,m_15:e.texture.adjacencyLists().handle,m_16:e.texture.nodesExtraProperties().handle,m_17:e.texture.stiffness().handle,m_19:e.texture.gridCells().handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}))}e.items.forEach((({depth:S})=>{b.add(S-1)})),b.forEach((S=>{y[S]=t.createVertexArray(),t.bindVertexArray(y[S]);const w=t.getAttribLocation(h,"position");t.enableVertexAttribArray(w),ee(t,ki),t.vertexAttribPointer(w,2,t.FLOAT,!1,0,0);const I=t.getAttribLocation(h,"m_1c");t.enableVertexAttribArray(I);const M=e.items.map((Nt=>Nt.particlesPositionsSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(M)),t.vertexAttribIPointer(I,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(I,1);const N=t.getAttribLocation(h,"m_1d");t.enableVertexAttribArray(N);const D=e.items.map((Nt=>Nt.nodesExtraPropertiesSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(D)),t.vertexAttribIPointer(N,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(N,1);const q=t.getAttribLocation(h,"m_1e");t.enableVertexAttribArray(q);const et=e.items.map((Nt=>Nt.adjacencyListsSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(et)),t.vertexAttribIPointer(q,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(q,1);const O=t.getAttribLocation(h,"m_1f");t.enableVertexAttribArray(O);const K=e.items.map((Nt=>Nt.adjacencyOffsetsSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(K)),t.vertexAttribIPointer(O,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(O,1);const j=t.getAttribLocation(h,"m_1g");t.enableVertexAttribArray(j);const ot=e.items.map((Nt=>Nt.stiffnessSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(ot)),t.vertexAttribIPointer(j,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(j,1);const it=t.getAttribLocation(h,"m_s");t.enableVertexAttribArray(it);const ct=e.items.map((Nt=>Nt.spatialBoundariesSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(ct)),t.vertexAttribIPointer(it,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(it,1);const pt=t.getAttribLocation(h,"m_1h");t.enableVertexAttribArray(pt);const Pt=e.items.map((Nt=>Nt.spatialKeysSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(Pt)),t.vertexAttribIPointer(pt,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(pt,1);const At=t.getAttribLocation(h,"m_1i");t.enableVertexAttribArray(At);const bt=e.items.map((Nt=>Nt.gridCellsSlot)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(bt)),t.vertexAttribIPointer(At,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(At,1);const It=t.getAttribLocation(h,"m_e");t.enableVertexAttribArray(It);const Ut=Io(),Gt=e.items.map((Nt=>Nt.localExpansionsSlot[S]||Ut)).map((({x:Nt,y:Ht,w:qt,h:Zt})=>[Nt,Ht,qt,Zt])).flat();ee(t,new Uint32Array(Gt)),t.vertexAttribIPointer(It,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(It,1);const Dt=t.getAttribLocation(h,"m_5");t.enableVertexAttribArray(Dt),ee(t,new Uint32Array(e.items.map((({N:Nt})=>Nt)))),t.vertexAttribIPointer(Dt,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(Dt,1);const Rt=t.getAttribLocation(h,"m_t");t.enableVertexAttribArray(Rt),ee(t,new Uint32Array(e.items.map((Nt=>Nt.depth)))),t.vertexAttribIPointer(Rt,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(Rt,1);const Tt=t.getAttribLocation(h,"m_g");t.enableVertexAttribArray(Tt),ee(t,new Uint32Array(e.items.map((Nt=>Nt.order)))),t.vertexAttribIPointer(Tt,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(Tt,1)})),Ot(v,"P");const A=Ot((()=>{t.deleteFramebuffer(m),t.deleteFramebuffer(f),t.deleteTexture(c.handle)}),"h");return{step:v,outputs:{items:e.items.map((S=>({N:S.N,pointsSlot:S.particlesPositionsSlot}))),texture:{points:()=>x}},destroy:A}}),"Fe"),KD=`#version 300 es
precision highp float;vec2 l(vec2 l,vec2 x){return vec2(l.x*x.x-l.y*x.y,l.x*x.y+l.y*x.x);}vec2 x(vec2 x,vec2 l){return vec2(dot(x,l),x.y*l.x-x.x*l.y)/dot(l,l);}uniform uint m_c;uniform highp sampler2D m_l,m_m,m_n,m_o,m_h,m_i,m_j,m_k;flat in uvec4 m_1y,m_1z;flat in uint m_20;layout(location=0)out vec4 l01;layout(location=1)out vec4 l23;layout(location=2)out vec4 l45;layout(location=3)out vec4 l67;void main(){float a=float(1u<<m_c);uvec2 i=uvec2(gl_FragCoord.xy)-m_1y.xy;vec2 r=(vec2(i)+.5)/a,e=texelFetch(m_h,ivec2(m_1y.xy+i),0).xy;if(e.x==0.)return;if(m_c>2u){uvec2 o=i>>1u;vec2 w=r-(vec2(i&65534u)+1.)/a,x=vec2(1,0);vec4 u=texelFetch(m_l,ivec2(m_1z.xy+o),0),y=m_20>2u?texelFetch(m_m,ivec2(m_1z.xy+o),0):vec4(0),e=m_20>4u?texelFetch(m_n,ivec2(m_1z.xy+o),0):vec4(0),z=m_20>6u?texelFetch(m_o,ivec2(m_1z.xy+o),0):vec4(0);switch(m_20){case 2u:l01.xy+=l(u.xy,1.*x),l01.zw+=l(u.zw,1.*x),x=l(x,w),l01.xy+=l(u.zw,1.*x);break;case 3u:case 4u:l01.xy+=l(u.xy,1.*x),l01.zw+=l(u.zw,1.*x),l23.xy+=l(y.xy,1.*x),l23.zw+=l(y.zw,1.*x),x=l(x,w),l01.xy+=l(u.zw,1.*x),l01.zw+=l(y.xy,2.*x),l23.xy+=l(y.zw,3.*x),x=l(x,w),l01.xy+=l(y.xy,1.*x),l01.zw+=l(y.zw,3.*x),x=l(x,w),l01.xy+=l(y.zw,1.*x);break;case 5u:case 6u:l01.xy+=l(u.xy,1.*x),l01.zw+=l(u.zw,1.*x),l23.xy+=l(y.xy,1.*x),l23.zw+=l(y.zw,1.*x),l45.xy+=l(e.xy,1.*x),l45.zw+=l(e.zw,1.*x),x=l(x,w),l01.xy+=l(u.zw,1.*x),l01.zw+=l(y.xy,2.*x),l23.xy+=l(y.zw,3.*x),l23.zw+=l(e.xy,4.*x),l45.xy+=l(e.zw,5.*x),x=l(x,w),l01.xy+=l(y.xy,1.*x),l01.zw+=l(y.zw,3.*x),l23.xy+=l(e.xy,6.*x),l23.zw+=l(e.zw,10.*x),x=l(x,w),l01.xy+=l(y.zw,1.*x),l01.zw+=l(e.xy,4.*x),l23.xy+=l(e.zw,10.*x),x=l(x,w),l01.xy+=l(e.xy,1.*x),l01.zw+=l(e.zw,5.*x),x=l(x,w),l01.xy+=l(e.zw,1.*x);break;case 7u:case 8u:l01.xy+=l(u.xy,1.*x),l01.zw+=l(u.zw,1.*x),l23.xy+=l(y.xy,1.*x),l23.zw+=l(y.zw,1.*x),l45.xy+=l(e.xy,1.*x),l45.zw+=l(e.zw,1.*x),l67.xy+=l(z.xy,1.*x),l67.zw+=l(z.zw,1.*x),x=l(x,w),l01.xy+=l(u.zw,1.*x),l01.zw+=l(y.xy,2.*x),l23.xy+=l(y.zw,3.*x),l23.zw+=l(e.xy,4.*x),l45.xy+=l(e.zw,5.*x),l45.zw+=l(z.xy,6.*x),l67.xy+=l(z.zw,7.*x),x=l(x,w),l01.xy+=l(y.xy,1.*x),l01.zw+=l(y.zw,3.*x),l23.xy+=l(e.xy,6.*x),l23.zw+=l(e.zw,10.*x),l45.xy+=l(z.xy,15.*x),l45.zw+=l(z.zw,21.*x),x=l(x,w),l01.xy+=l(y.zw,1.*x),l01.zw+=l(e.xy,4.*x),l23.xy+=l(e.zw,10.*x),l23.zw+=l(z.xy,20.*x),l45.xy+=l(z.zw,35.*x),x=l(x,w),l01.xy+=l(e.xy,1.*x),l01.zw+=l(e.zw,5.*x),l23.xy+=l(z.xy,15.*x),l23.zw+=l(z.zw,35.*x),x=l(x,w),l01.xy+=l(e.zw,1.*x),l01.zw+=l(z.xy,6.*x),l23.xy+=l(z.zw,21.*x),x=l(x,w),l01.xy+=l(z.xy,1.*x),l01.zw+=l(z.zw,7.*x),x=l(x,w),l01.xy+=l(z.zw,1.*x);break;}}ivec2 y=(ivec2(i)&65534)-2;for(uint n;n<36u;n++){ivec2 t=y+ivec2(int(n)%6,int(n)/6);vec4 w=texelFetch(m_h,ivec2(m_1y.xy)+t,0);if(w.x==0.)continue;vec2 s=vec2(t-ivec2(i));if(dot(s,s)<=2.||t>>ivec2(m_c)!=ivec2(0))continue;vec2 c=x(vec2(1,0),r-(vec2(t)+.5)/a),e=c;vec4 z=m_20>2u?texelFetch(m_i,ivec2(m_1y.xy)+t,0):vec4(0),u=m_20>4u?texelFetch(m_j,ivec2(m_1y.xy)+t,0):vec4(0),o=m_20>6u?texelFetch(m_k,ivec2(m_1y.xy)+t,0):vec4(0);if(l01.xy+=l(w.xy,e),e=l(e,c),l01.xy+=l(w.zw,1.*e),l01.zw+=l(w.xy,-e),e=l(e,c),m_20>=3u)l01.xy+=l(z.xy,1.*e),l23.xy+=l(w.xy,e);if(l01.zw+=l(w.zw,-2.*e),m_20<3u)continue;if(e=l(e,c),l01.xy+=l(z.zw,1.*e),l01.zw+=l(z.xy,-3.*e),l23.xy+=l(w.zw,3.*e),l23.zw+=l(w.xy,-e),e=l(e,c),m_20>=5u)l01.xy+=l(u.xy,1.*e);if(l01.zw+=l(z.zw,-4.*e),l23.xy+=l(z.xy,6.*e),l23.zw+=l(w.zw,-4.*e),m_20>=5u)l45.xy+=l(w.xy,e);if(e=l(e,c),l23.xy+=l(z.zw,10.*e),l23.zw+=l(z.xy,-10.*e),m_20>=5u)l01.xy+=l(u.zw,1.*e),l01.zw+=l(u.xy,-5.*e),l45.xy+=l(w.zw,5.*e),l45.zw+=l(w.xy,-e);if(e=l(e,c),l23.zw+=l(z.zw,-20.*e),m_20>=7u)l01.xy+=l(o.xy,1.*e),l67.xy+=l(w.xy,e);if(m_20>=5u)l01.zw+=l(u.zw,-6.*e),l23.xy+=l(u.xy,15.*e),l45.xy+=l(z.xy,15.*e),l45.zw+=l(w.zw,-6.*e);if(m_20<5u)continue;if(e=l(e,c),m_20>=7u)l67.zw+=l(w.xy,-e),l67.xy+=l(w.zw,7.*e),l01.zw+=l(o.xy,-7.*e),l01.xy+=l(o.zw,1.*e);if(l45.zw+=l(z.xy,-21.*e),l45.xy+=l(z.zw,35.*e),l23.zw+=l(u.xy,-35.*e),l23.xy+=l(u.zw,21.*e),e=l(e,c),m_20>=7u)l67.zw+=l(w.zw,-8.*e),l67.xy+=l(z.xy,28.*e),l23.xy+=l(o.xy,28.*e),l01.zw+=l(o.zw,-8.*e);if(l45.zw+=l(z.zw,-56.*e),l45.xy+=l(u.xy,70.*e),l23.zw+=l(u.zw,-56.*e),e=l(e,c),m_20>=7u)l67.zw+=l(z.xy,-36.*e),l67.xy+=l(z.zw,84.*e),l23.zw+=l(o.xy,-84.*e),l23.xy+=l(o.zw,36.*e);if(l45.zw+=l(u.xy,-126.*e),l45.xy+=l(u.zw,126.*e),e=l(e,c),m_20>=7u)l67.zw+=l(z.zw,-120.*e),l67.xy+=l(u.xy,210.*e),l45.xy+=l(o.xy,210.*e),l23.zw+=l(o.zw,-120.*e);if(l45.zw+=l(u.zw,-252.*e),m_20<7u)continue;e=l(e,c),l67.zw+=l(u.xy,-330.*e),l67.xy+=l(u.zw,462.*e),l45.zw+=l(o.xy,-462.*e),l45.xy+=l(o.zw,330.*e),e=l(e,c),l67.zw+=l(u.zw,-792.*e),l67.xy+=l(o.xy,924.*e),l45.zw+=l(o.zw,-792.*e),e=l(e,c),l67.zw+=l(o.xy,-1716.*e),l67.xy+=l(o.zw,1716.*e),e=l(e,c),l67.zw+=l(o.zw,-3432.*e);}}`,QD=`#version 300 es
precision mediump int;
precision highp float;

uniform uvec2 m_d;

in vec2 position; 
in uvec4 m_e; 
in uvec4 m_f; 
in uint m_g; 

flat out uvec4 m_1y;
flat out uvec4 m_1z;
flat out uint m_20;

void main() {
  m_1y = m_e;
  m_1z = m_f;
  m_20 = m_g;

  
  vec2 posPx = (position + 1.f) * vec2(m_e.zw) * .5f + vec2(m_e.xy);
  gl_Position = vec4(posPx / vec2(m_d) * 2.f - 1.f, 0.f, 1.f);
}`,JD=Ot(((t,e)=>{const s=cn(t,QD,KD),i=Math.max(...e.items.map((({depth:h})=>h))),n=[];e.items.forEach((({order:h,depth:u,multipolesSlot:c})=>{const g={};for(let m=i-1;m>=2;m--)g[m]=c[m];n.push({order:h,depth:u,localExpansionsSlot:g})}));const r=[];for(let h=i-1;h>=1;h--){r[h]=[];const[u,c]=h===1?[1,1]:e.texture.multipoles(h,0).size;for(let g=0;g<4;g++)r[h][g]=Ts(t,{size:[u,c],data:new Float32Array(4*u*c),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})}const o=r.map(((h,u)=>{const c=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,c),h.forEach(((g,m)=>{t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+m,t.TEXTURE_2D,g.handle,0)})),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2,t.COLOR_ATTACHMENT3]),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&console.error(`FBO incomplete for level ${u}`),c})),a=Vn(t,s,{m_c:2,m_d:[0,0]}),l=[];for(let h=i-1;h>=2;h--){l[h]=t.createVertexArray(),t.bindVertexArray(l[h]);const u=t.getAttribLocation(s,"position");t.enableVertexAttribArray(u),ee(t,ki),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0);const c=t.getAttribLocation(s,"m_e");t.enableVertexAttribArray(c);const g=n.map((({localExpansionsSlot:_})=>_[h])).map((({x:_,y:x,w:y,h:b})=>[_,x,y,b])).flat();ee(t,new Uint32Array(g)),t.vertexAttribIPointer(c,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(c,1);const m=t.getAttribLocation(s,"m_f");t.enableVertexAttribArray(m);const f=n.map((({localExpansionsSlot:_})=>h>=3?_[h-1]:Io())).map((({x:_,y:x,w:y,h:b})=>[_,x,y,b])).flat();ee(t,new Uint32Array(f)),t.vertexAttribIPointer(m,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(m,1);const p=t.getAttribLocation(s,"m_g");t.enableVertexAttribArray(p),ee(t,new Uint32Array(e.items.map((_=>_.order)))),t.vertexAttribIPointer(p,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(p,1)}function d(){t.useProgram(s);for(let h=2;h<i;h++){t.bindVertexArray(l[h]);const u=r[h-1],c=r[h];t.viewport(0,0,...c[0].size),t.bindFramebuffer(t.FRAMEBUFFER,o[h]),gn(t,a,{m_c:h,m_h:e.texture.multipoles(h,0).handle,m_i:e.texture.multipoles(h,1).handle,m_j:e.texture.multipoles(h,2).handle,m_k:e.texture.multipoles(h,3).handle,m_l:u[0].handle,m_m:u[1].handle,m_n:u[2].handle,m_o:u[3].handle,m_d:c[0].size}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}return Ot(d,"u"),{step:d,outputs:{items:n,texture:{localExpansions:(h,u)=>r[h]&&r[h][u]}},destroy:()=>{o.forEach((h=>t.deleteFramebuffer(h))),r.forEach((h=>h.forEach((({handle:u})=>t.deleteTexture(u))))),l.forEach((h=>t.deleteVertexArray(h)))}}}),"Ie"),tk=`#version 300 es
precision highp float;precision highp int;vec2 l(vec2 l,vec2 i){return vec2(l.x*i.x-l.y*i.y,l.x*i.y+l.y*i.x);}vec2 l(vec2 i,vec4 l){return(i-l.xy)/l.zw;}uniform highp sampler2D m_13,m_1n,m_7;uniform highp usampler2D m_18,m_19;uniform uint m_c;uniform highp sampler2D m_1s,m_1t,m_1u,m_1v;flat in uvec4 m_2g,m_2h,m_2b,m_26,m_29,m_28;flat in uint m_27,m_20;layout(location=0)out vec4 m01;layout(location=1)out vec4 m23;layout(location=2)out vec4 m45;layout(location=3)out vec4 m67;void main(){float s=float(1u<<m_c);uvec2 i=uvec2(gl_FragCoord.xy)-m_2g.xy;vec2 v=(vec2(i)+.5)/s;if(m_c==m_27-1u){vec4 e=texelFetch(m_7,ivec2(m_26.xy),0);uvec2 s=texelFetch(m_19,ivec2(m_28.xy+i),0).xy;for(uint t=s.x;t<s.y;t++){uint o=texelFetch(m_18,ivec2(m_29.xy)+ivec2(t%m_29.z,t/m_29.z),0).x;ivec2 c=ivec2(m_2b.xy)+ivec2(o%m_2b.w,o/m_2b.w);vec2 u=l(texelFetch(m_13,c,0).xy,e)-v;float x=texelFetch(m_1n,c,0).x;vec2 i=vec2(x,0.);if(m01.xy+=i,i=l(i,u),m01.zw+=i,m_20<3u)continue;if(i=l(i,u),m23.xy+=i,i=l(i,u),m23.zw+=i,m_20<5u)continue;if(i=l(i,u),m45.xy+=i,i=l(i,u),m45.zw+=i,m_20<7u)continue;i=l(i,u),m67.xy+=i,i=l(i,u),m67.zw+=i;}}else for(uint y;y<4u;++y){uvec2 x=2u*i+uvec2(y&1u,y>>1u);vec2 u=(vec2(x)+.5)/s/2.-v,e=vec2(1,0);vec4 t=texelFetch(m_1s,ivec2(m_2h.xy+x),0);if(m01.xy+=l(t.xy,1.*e),e=vec2(1,0),m01.zw+=l(t.zw,1.*e),e=l(e,u),m01.zw+=l(t.xy,1.*e),m_20<3u)continue;vec4 o=texelFetch(m_1t,ivec2(m_2h.xy+x),0);if(e=vec2(1,0),m23.xy+=l(o.xy,1.*e),e=l(e,u),m23.xy+=l(t.zw,2.*e),e=l(e,u),m23.xy+=l(t.xy,1.*e),e=vec2(1,0),m23.zw+=l(o.zw,1.*e),e=l(e,u),m23.zw+=l(o.xy,3.*e),e=l(e,u),m23.zw+=l(t.zw,3.*e),e=l(e,u),m23.zw+=l(t.xy,1.*e),m_20<5u)continue;vec4 c=texelFetch(m_1u,ivec2(m_2h.xy+x),0);if(e=vec2(1,0),m45.xy+=l(c.xy,1.*e),e=l(e,u),m45.xy+=l(o.zw,4.*e),e=l(e,u),m45.xy+=l(o.xy,6.*e),e=l(e,u),m45.xy+=l(t.zw,4.*e),e=l(e,u),m45.xy+=l(t.xy,1.*e),e=vec2(1,0),m45.zw+=l(c.zw,1.*e),e=l(e,u),m45.zw+=l(c.xy,5.*e),e=l(e,u),m45.zw+=l(o.zw,10.*e),e=l(e,u),m45.zw+=l(o.xy,10.*e),e=l(e,u),m45.zw+=l(t.zw,5.*e),e=l(e,u),m45.zw+=l(t.xy,1.*e),m_20<7u)continue;vec4 m=texelFetch(m_1v,ivec2(m_2h.xy+x),0);e=vec2(1,0),m67.xy+=l(m.xy,1.*e),e=l(e,u),m67.xy+=l(c.zw,6.*e),e=l(e,u),m67.xy+=l(c.xy,15.*e),e=l(e,u),m67.xy+=l(o.zw,20.*e),e=l(e,u),m67.xy+=l(o.xy,15.*e),e=l(e,u),m67.xy+=l(t.zw,6.*e),e=l(e,u),m67.xy+=l(t.xy,1.*e),e=vec2(1,0),m67.zw+=l(m.zw,1.*e),e=l(e,u),m67.zw+=l(m.xy,7.*e),e=l(e,u),m67.zw+=l(c.zw,21.*e),e=l(e,u),m67.zw+=l(c.xy,35.*e),e=l(e,u),m67.zw+=l(o.zw,35.*e),e=l(e,u),m67.zw+=l(o.xy,21.*e),e=l(e,u),m67.zw+=l(t.zw,7.*e),e=l(e,u),m67.zw+=l(t.xy,1.*e);}}`,ek=`#version 300 es
precision highp int;
precision highp float;

uniform uvec2 m_1p;

in vec2 position; 
in uvec4 m_1q; 
in uvec4 m_1r; 
in uvec4 m_1c; 

in uvec4 m_s; 
in uvec4 m_1h; 
in uvec4 m_1i; 
in uint m_t; 
in uint m_g; 

flat out uvec4 m_2g;
flat out uvec4 m_2h;
flat out uvec4 m_2b;

flat out uvec4 m_26;
flat out uvec4 m_29;
flat out uvec4 m_28;
flat out uint m_27;
flat out uint m_20;

void main() {
  m_2g = m_1q;
  m_2h = m_1r;
  m_2b = m_1c;
  
  m_26 = m_s;
  m_29 = m_1h;
  m_28 = m_1i;
  m_27 = m_t;
  m_20 = m_g;

  
  vec2 posPx = (position + 1.f) * vec2(m_1q.zw) * .5f + vec2(m_1q.xy);
  gl_Position = vec4(posPx / vec2(m_1p) * 2.f - 1.f, 0.f, 1.f);
}`,sk=Ot(((t,e)=>{const s=cn(t,ek,tk),i=Math.max(...e.items.map((({depth:h})=>h))),n=[];e.items.forEach((({order:h,depth:u})=>{const c={};for(let g=i-1;g>=2;g--)c[g]=g>=u?Io():{x:0,y:0,w:1<<g,h:1<<g};n.push({order:h,depth:u,multipolesSlot:c})}));const r=[];for(let h=i;h>=2;h--){r[h]=[];const{w:u,h:c}=Rr(n.map((({multipolesSlot:g})=>g[h]||Io())));for(let g=0;g<4;g++)r[h][g]=Ts(t,{size:[u,c],data:new Float32Array(4*u*c),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})}const o=r.map(((h,u)=>{const c=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,c),h.forEach(((g,m)=>{t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+m,t.TEXTURE_2D,g.handle,0)})),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2,t.COLOR_ATTACHMENT3]),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&console.error(`FBO incomplete for level ${u}`),c})),a=Vn(t,s,{m_c:i-1,m_13:e.texture.particlesPositions().handle,m_1n:e.texture.particlesCharges().handle,m_7:e.texture.spatialBoundaries().handle,m_18:e.texture.spatialKeys().handle,m_19:e.texture.gridCells().handle,m_1o:null,m_1p:[0,0]}),l=[];for(let h=i-1;h>=2;h--){l[h]=t.createVertexArray(),t.bindVertexArray(l[h]);const u=t.getAttribLocation(s,"position");t.enableVertexAttribArray(u),ee(t,ki),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0);const c=t.getAttribLocation(s,"m_1q");t.enableVertexAttribArray(c);const g=n.map((({multipolesSlot:M})=>M[h])).map((({x:M,y:N,w:D,h:q})=>[M,N,D,q])).flat();ee(t,new Uint32Array(g)),t.vertexAttribIPointer(c,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(c,1);const m=t.getAttribLocation(s,"m_1r");t.enableVertexAttribArray(m);const f=n.map((({multipolesSlot:M,depth:N})=>h>=N-1?Io():M[h+1])).map((({x:M,y:N,w:D,h:q})=>[M,N,D,q])).flat();ee(t,new Uint32Array(f)),t.vertexAttribIPointer(m,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(m,1);const p=t.getAttribLocation(s,"m_1c");t.enableVertexAttribArray(p);const _=e.items.map((M=>M.particlesPositionsSlot)).map((({x:M,y:N,w:D,h:q})=>[M,N,D,q])).flat();ee(t,new Uint32Array(_)),t.vertexAttribIPointer(p,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(p,1);const x=t.getAttribLocation(s,"m_s");t.enableVertexAttribArray(x);const y=e.items.map((M=>M.spatialBoundariesSlot)).map((({x:M,y:N,w:D,h:q})=>[M,N,D,q])).flat();ee(t,new Uint32Array(y)),t.vertexAttribIPointer(x,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(x,1);const b=t.getAttribLocation(s,"m_1h");t.enableVertexAttribArray(b);const v=e.items.map((M=>M.spatialKeysSlot)).map((({x:M,y:N,w:D,h:q})=>[M,N,D,q])).flat();ee(t,new Uint32Array(v)),t.vertexAttribIPointer(b,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(b,1);const A=t.getAttribLocation(s,"m_1i");t.enableVertexAttribArray(A);const S=e.items.map((M=>M.gridCellsSlot)).map((({x:M,y:N,w:D,h:q})=>[M,N,D,q])).flat();ee(t,new Uint32Array(S)),t.vertexAttribIPointer(A,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(A,1);const w=t.getAttribLocation(s,"m_t");t.enableVertexAttribArray(w),ee(t,new Uint32Array(e.items.map((M=>M.depth)))),t.vertexAttribIPointer(w,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(w,1);const I=t.getAttribLocation(s,"m_g");t.enableVertexAttribArray(I),ee(t,new Uint32Array(e.items.map((M=>M.order)))),t.vertexAttribIPointer(I,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(I,1)}function d(){t.useProgram(s);for(let h=i-1;h>=2;h--){t.bindVertexArray(l[h]);const u=r[h+1],c=r[h][0].size;t.viewport(0,0,...c),t.bindFramebuffer(t.FRAMEBUFFER,o[h]),gn(t,a,{m_13:e.texture.particlesPositions().handle,m_7:e.texture.spatialBoundaries().handle,m_1n:e.texture.particlesCharges().handle,m_18:e.texture.spatialKeys().handle,m_19:e.texture.gridCells().handle,m_c:h,m_1s:u[0].handle,m_1t:u[1].handle,m_1u:u[2].handle,m_1v:u[3].handle,m_1p:c}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}return Ot(d,"u"),{step:d,outputs:{items:n,texture:{multipoles:(h,u)=>r[h]&&r[h][u]}},destroy:()=>{o.forEach((h=>t.deleteFramebuffer(h))),r.forEach((h=>h.forEach((({handle:u})=>t.deleteTexture(u))))),l.forEach((h=>t.deleteVertexArray(h)))}}}),"Re"),ik=`#version 300 es
precision highp int;uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 i){return u(i.y)<<1|u(i.x);}uniform highp usampler2D m_18;flat in uvec4 m_28,m_29;flat in uint m_22;out uvec2 outColor;uint i(uint e){uint u,i=m_22;for(;u<i;){uint t=u+i>>1,l=texelFetch(m_18,ivec2(m_29.xy)+ivec2(t%m_29.z,t/m_29.z),0).y;l<e?u=t+1u:i=t;}return u;}void main(){uvec2 t=uvec2(gl_FragCoord.xy);uint e=u((t-m_28.xy)%m_28.z);outColor=uvec2(i(e),i(e+1u));}`,nk=`#version 300 es
precision highp int;
precision mediump float;

uniform uvec2 m_1m;

in vec2 position; 
in uvec4 m_1i; 
in uvec4 m_1h; 
in uint m_5; 

flat out uvec4 m_28;
flat out uvec4 m_29;
flat out uint m_22;

void main() {
  m_28 = m_1i;
  m_29 = m_1h;
  m_22 = m_5;

  
  vec2 posPx = (position + 1.f) * vec2(m_1i.zw) * .5f + vec2(m_1i.xy);
  gl_Position = vec4(posPx / vec2(m_1m) * 2.f - 1.f, 0.f, 1.f);
}`,rk=Ot(((t,e)=>{const s=cn(t,nk,ik),i=e.items.map((({depth:_})=>{const x=1<<_-1;return{x:0,y:0,w:x,h:x}})),n=Rr(i.slice()),r=Ts(t,{size:[n.w,n.h],data:new Uint32Array(2*n.w*n.h),type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI}),o=hn(t,r.handle),a=Vn(t,s,{m_18:e.texture.spatialKeys().handle,m_1m:r.size}),l=t.createVertexArray();t.bindVertexArray(l);const d=t.getAttribLocation(s,"position");t.enableVertexAttribArray(d),ee(t,ki),t.vertexAttribPointer(d,2,t.FLOAT,!1,0,0);const h=t.getAttribLocation(s,"m_1i");t.enableVertexAttribArray(h);const u=i.map((({x:_,y:x,w:y,h:b})=>[_,x,y,b])).flat();ee(t,new Uint32Array(u)),t.vertexAttribIPointer(h,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(h,1);const c=t.getAttribLocation(s,"m_1h");t.enableVertexAttribArray(c);const g=e.items.map((({spatialKeysSlot:_})=>_)).map((({x:_,y:x,w:y,h:b})=>[_,x,y,b])).flat();ee(t,new Uint32Array(g)),t.vertexAttribIPointer(c,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(c,1);const m=t.getAttribLocation(s,"m_5");function f(){t.viewport(0,0,r.size[0],r.size[1]),t.useProgram(s),t.bindVertexArray(l),t.bindFramebuffer(t.FRAMEBUFFER,o),gn(t,a,{m_18:e.texture.spatialKeys().handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}t.enableVertexAttribArray(m),ee(t,new Uint32Array(e.items.map((({N:_})=>_)))),t.vertexAttribIPointer(m,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(m,1),Ot(f,"d");const p=Ot((()=>{t.deleteFramebuffer(o),t.deleteTexture(r.handle)}),"N");return{step:f,outputs:{items:e.items.map((({N:_,depth:x},y)=>({N:_,depth:x,spatialBoundariesSlot:e.items[y].spatialBoundariesSlot,spatialKeysSlot:e.items[y].spatialKeysSlot,gridCellsSlot:i[y]}))),texture:{spatialBoundaries:e.texture.spatialBoundaries,spatialKeys:e.texture.spatialKeys,gridCells:()=>r}},destroy:p}}),"Me"),ok=`#version 300 es
precision highp int;uniform uint m_0,m_1;uniform highp usampler2D m_2;flat in uvec4 m_1w;flat in uint m_1x;out uvec2 outColor;uvec2 e(uvec2 e,uvec2 u,bool y){uvec2 t=e.x<4294967295u?texelFetch(m_2,ivec2(m_1w.xy)+ivec2(e.x%m_1w.z,e.x/m_1w.z),0).xy:e,o=u.x<4294967295u?texelFetch(m_2,ivec2(m_1w.xy)+ivec2(u.x%m_1w.z,u.x/m_1w.z),0).xy:u;if(y)return t.y<o.y?t:o;return t.y>o.y?t:o;}void main(){uvec2 u=uvec2(gl_FragCoord.xy);if(m_1x==1u){outColor=texelFetch(m_2,ivec2(u),0).xy;return;}uint t=uint(u.x-m_1w.x+m_1w.z*(u.y-m_1w.y)),s=texelFetch(m_2,ivec2(u),0).x,o=t^1u<<m_0-m_1,l=texelFetch(m_2,ivec2(m_1w.xy)+ivec2(o%m_1w.z,o/m_1w.z),0).x;bool y=(t>>m_0-m_1&1u)==0u;(t>>m_0&2u)==2u&&(y=!y),outColor=e(uvec2(t,s),uvec2(o,l),y);}`,ak=`#version 300 es
precision highp int;
precision highp float;

uniform uvec2 m_3;
uniform uint m_0;

in vec2 position; 
in uvec4 m_4; 
in uint m_5; 

flat out uvec4 m_1w;
flat out uint m_1x;

void main() {
  m_1w = m_4;
  m_1x = 0u;

  
  uint minN = 1u << m_0;
  if(minN >= m_5) {
    if(minN >= 2u * m_5) {
      gl_Position = vec4(0.f, 0.f, 0.f, 1.f);
      return;
    }
    
    m_1x = 1u;
  }

  
  vec2 posPx = (position + 1.f) * vec2(m_4.zw) * .5f + vec2(m_4.xy);
  gl_Position = vec4(posPx / vec2(m_3) * 2.f - 1.f, 0.f, 1.f);
}`,lk=Ot((t=>{for(let e=0;e<t.length/2;e++)t[2*e]=e,t[2*e+1]=4294967295;return t}),"je"),HE=Ot((t=>1<<Math.ceil(Math.log2(t))),"le"),dk=Ot((t=>{if(t<2)return[1,1];const e=32-Math.clz32(t-1);return[1<<(e>>>1)+(1&e),1<<(e>>>1)]}),"ke"),jE=Ot(((t,[e,s],i=lk(new Uint32Array(2*e*s)))=>Ts(t,{size:[e,s],data:i,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})),"fe"),c_=Ot(((t,[e,s],i=new Uint32Array(4*e*s))=>Ts(t,{size:[e,s],data:i,type:t.UNSIGNED_INT,format:t.RGBA_INTEGER,internalFormat:t.RGBA32UI})),"xe"),hk=Ot((t=>Math.max(0,Math.ceil(Math.log2(t)))),"He"),uk=Ot((t=>t*(t+1)/2),"Ke"),ck=Ot(((t,e)=>{const s=cn(t,ak,ok),i=e.texture.spatialKeys(),n=jE(t,i.size),r=dn(n,i),o=hn(t,i.handle),a=hn(t,n.handle),l=dn(o,a),d=Vn(t,s,{m_0:0,m_1:0,m_2:i.handle,m_3:i.size}),h=e.items.map((({N:v})=>hk(v))).reduce(((v,A)=>Math.max(v,A)),0),u=t.createVertexArray();t.bindVertexArray(u);const c=t.getAttribLocation(s,"position");t.enableVertexAttribArray(c),ee(t,ki),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0);const g=t.getAttribLocation(s,"m_4");t.enableVertexAttribArray(g);const m=e.items.map((({spatialKeysSlot:v})=>v)).map((({x:v,y:A,w:S,h:w})=>[v,A,S,w])).flat();ee(t,new Uint32Array(m)),t.vertexAttribIPointer(g,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(g,1);const f=t.getAttribLocation(s,"m_5");t.enableVertexAttribArray(f),ee(t,new Uint32Array(e.items.map((({N:v})=>v)))),t.vertexAttribIPointer(f,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(f,1);let p=0,_=0,x=i;function y(v=uk(h)){t.useProgram(s),t.bindVertexArray(u),t.viewport(0,0,n.size[0],n.size[1]);const A=e.texture.spatialKeys();x!==A&&(l(),r(),x=A);for(let S=0;S<v;S++){t.bindFramebuffer(t.FRAMEBUFFER,l()[0]);const[w,I]=r();x=I,gn(t,d,{m_0:p,m_1:_,m_2:w.handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length),_=(_+1)%(p+1),_===0&&(p=(p+1)%h)}}Ot(y,"E");const b=Ot((()=>{t.deleteFramebuffer(o),t.deleteFramebuffer(a),t.deleteTexture(n.handle)}),"P");return{step:y,outputs:{items:e.items,texture:{spatialKeys:()=>x}},destroy:b}}),"$e"),gk=`#version 300 es
precision highp int;uniform uint m_0,m_1;uniform highp usampler2D m_2,m_1l;flat in uvec4 m_1w,m_2a;flat in uint m_1x;layout(location=0)out uvec2 outKeys;layout(location=1)out uvec4 outIntervals;uint n(uint n,uint e,uint u,uint i){uint t=n<u?e+n:i-u+n;return texelFetch(m_2,ivec2(m_1w.xy)+ivec2(t%m_1w.z,t/m_1w.z),0).y;}void main(){ivec2 o=ivec2(gl_FragCoord.xy);if(m_1x==1u){outKeys=texelFetch(m_2,ivec2(o),0).xy;return;}uint i=m_2a.z*(uint(o.y)-m_2a.y)+(uint(o.x)-m_2a.x);uvec4 u;if(m_1==0u)u=uvec4(i&4294967294u,1u,(i&4294967294u)+1u,1u)<<m_0;else{uint n=i>>1u,t=m_2a.z==m_2a.w?m_2a.z:m_2a.z>>1u;u=texelFetch(m_1l,ivec2(m_2a.xy)+ivec2(n%t,n/t),0);}uint e=u.y+u.w>>1u,t=u.y<e?0u:u.y-e,y=u.y<e?u.y:e;for(;t<y;){uint i=t+(y-t>>1u);n(i,u.x,u.y,u.z)<n(i+e,u.x,u.y,u.z)?t=i+1u:y=i;}uvec4 l=(i&1u)==(i>>m_1+1u&1u)?uvec4(u.x,t,u.z+u.w-e+t,e-t):uvec4(u.x+t,u.y-t,u.z,u.w-e+t);if(m_0==m_1){uint n=l.y*l.x+l.w*l.z;outKeys=texelFetch(m_2,ivec2(m_1w.xy)+ivec2(n%m_1w.z,n/m_1w.z),0).xy;}else outIntervals=l;}`,mk=`#version 300 es
precision highp int;
precision highp float;

uniform uvec2 m_3;
uniform uint m_0;
uniform uint m_1;

in vec2 position; 
in uvec4 m_4; 
in uint m_5; 

flat out uvec4 m_1w;
flat out uvec4 m_2a;
flat out uint m_1x;

void main() {
  
  uint minN = 1u << m_0;
  if(minN >= m_5) {
    if(minN >= 2u * m_5) {
      gl_Position = vec4(0.f, 0.f, 0.f, 1.f);
      return;
    }
    
    m_1x = 1u;
  }

  
  uint delta = m_0 - m_1;
  uvec4 intervalSlot = m_4;
  if(intervalSlot.z == intervalSlot.w) {
    
    intervalSlot.z = intervalSlot.z >> (delta >> 1u);
    intervalSlot.w = intervalSlot.w >> ((delta + 1u) >> 1u);
  } else {
    
    intervalSlot.z = intervalSlot.z >> ((delta + 1u) >> 1u);
    intervalSlot.w = intervalSlot.w >> (delta >> 1u);
  }
  m_1w = m_4;
  m_2a = intervalSlot;

  
  vec2 posPx = (position + 1.f) * vec2(intervalSlot.zw) * .5f + vec2(intervalSlot.xy);
  gl_Position = vec4(posPx / vec2(m_3) * 2.f - 1.f, 0.f, 1.f);
}`,fk=Ot((t=>Math.max(0,Math.ceil(Math.log2(t)))),"qe"),hl=Ot(((t,e,s)=>{const i=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.handle,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT1,t.TEXTURE_2D,s.handle,0),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&console.error("FBO incomplete"),{handle:i,ca0:e,ca1:s}}),"te"),pk=Ot(((t,e)=>{const s=cn(t,mk,gk),i=t.getUniformLocation(s,"m_0"),n=t.getUniformLocation(s,"m_1"),r=t.getUniformLocation(s,"m_2"),o=t.getUniformLocation(s,"m_1l"),a=t.getUniformLocation(s,"m_3"),l=e.texture.spatialKeys(),d=jE(t,l.size),h=c_(t,l.size),u=c_(t,l.size),c=dn(hl(t,l,u),hl(t,l,h)),g=dn(hl(t,d,u),hl(t,d,h)),m=e.items.map((({N:A})=>fk(HE(A)))).reduce(((A,S)=>Math.max(A,S)),0),f=t.createVertexArray();t.bindVertexArray(f);const p=t.getAttribLocation(s,"position");t.enableVertexAttribArray(p),ee(t,ki),t.vertexAttribPointer(p,2,t.FLOAT,!1,0,0);const _=t.getAttribLocation(s,"m_4");t.enableVertexAttribArray(_);const x=e.items.map((({spatialKeysSlot:A})=>A)).map((({x:A,y:S,w,h:I})=>[A,S,w,I])).flat();ee(t,new Uint32Array(x)),t.vertexAttribIPointer(_,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(_,1);const y=t.getAttribLocation(s,"m_5");function b(){t.bindVertexArray(f),t.viewport(0,0,...l.size),t.useProgram(s),t.uniform2ui(a,...l.size),t.uniform1i(r,0),t.uniform1i(o,1);for(let A=0;A<m;A++){t.activeTexture(t.TEXTURE0);const S=(1&A?d:l).handle;t.bindTexture(t.TEXTURE_2D,S),t.uniform1ui(i,A);for(let w=0;w<=A;w++){const[I,M]=1&A?c():g();t.bindFramebuffer(t.FRAMEBUFFER,I.handle),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,M.ca1.handle),t.uniform1ui(n,w),A===w?t.drawBuffers([t.COLOR_ATTACHMENT0,t.NONE]):w<2&&t.drawBuffers([t.NONE,t.COLOR_ATTACHMENT1]),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}}t.enableVertexAttribArray(y),ee(t,new Uint32Array(e.items.map((({N:A})=>A)))),t.vertexAttribIPointer(y,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(y,1),Ot(b,"P");const v=Ot((()=>{t.deleteTexture(d.handle),t.deleteTexture(u.handle),t.deleteTexture(h.handle),g().forEach((A=>t.deleteFramebuffer(A.handle))),c().forEach((A=>t.deleteFramebuffer(A.handle)))}),"h");return{step:b,outputs:{items:e.items,texture:{spatialKeys:()=>m-1&1?l:d}},destroy:v}}),"Ye"),_k=`#version 300 es
precision highp float;precision highp int;uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 t){return u(t.y)<<1|u(t.x);}vec2 u(vec2 t,vec4 u){return(t-u.xy)/u.zw;}uniform highp sampler2D m_b,m_7;flat in uvec4 m_24,m_25,m_26;flat in uint m_22,m_27;out uvec2 outColor;void main(){uvec2 o=uvec2(gl_FragCoord.xy);uint t=o.x-m_24.x+(o.y-m_24.y)*m_24.z;if(t>=m_22){outColor=uvec2(t,4294967295u);return;}uvec2 e=uvec2(t%m_25.z,t/m_25.z)+m_25.xy;vec4 i=texelFetch(m_7,ivec2(m_26.xy),0);vec2 n=u(texelFetch(m_b,ivec2(e),0).xy,i);outColor=uvec2(t,u(uvec2(float(1u<<m_27-1u)*n)));}`,yk=`#version 300 es
precision highp int;
precision highp float;

uniform uvec2 m_p;

in vec2 position; 
in uvec4 m_q; 
in uvec4 m_r; 
in uvec4 m_s; 
in uint m_5; 
in uint m_t; 

flat out uvec4 m_24;
flat out uvec4 m_25;
flat out uvec4 m_26;
flat out uint m_22;
flat out uint m_27;

void main() {
  m_24 = m_q;
  m_25 = m_r;
  m_26 = m_s;
  m_22 = m_5;
  m_27 = m_t;

  
  vec2 posPx = (position + 1.f) * vec2(m_q.zw) * .5f + vec2(m_q.xy);
  gl_Position = vec4(posPx / vec2(m_p) * 2.f - 1.f, 0.f, 1.f);
}`,xk=Ot(((t,e)=>{const s=cn(t,yk,_k),i=e.items.map((({N:v})=>{const[A,S]=dk(HE(v));return{x:0,y:0,w:A,h:S}})),n=Rr(i.slice()),r=new Uint32Array(2*n.w*n.h);i.forEach((v=>{for(let A=0;A<v.w*v.h;A++){const S=2*ir(A,n.w,v);r[S]=A,r[S+1]=4294967295}}));const o=Ts(t,{size:[n.w,n.h],data:r,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI}),a=hn(t,o.handle),l=Vn(t,s,{m_b:e.texture.points().handle,m_7:e.texture.spatialBoundaries().handle,m_p:o.size}),d=t.createVertexArray();t.bindVertexArray(d);const h=t.getAttribLocation(s,"position");t.enableVertexAttribArray(h),ee(t,ki),t.vertexAttribPointer(h,2,t.FLOAT,!1,0,0);const u=t.getAttribLocation(s,"m_q");t.enableVertexAttribArray(u);const c=i.map((({x:v,y:A,w:S,h:w})=>[v,A,S,w])).flat();ee(t,new Uint32Array(c)),t.vertexAttribIPointer(u,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(u,1);const g=t.getAttribLocation(s,"m_r");t.enableVertexAttribArray(g);const m=e.items.map((({pointsSlot:v})=>v)).map((({x:v,y:A,w:S,h:w})=>[v,A,S,w])).flat();ee(t,new Uint32Array(m)),t.vertexAttribIPointer(g,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(g,1);const f=t.getAttribLocation(s,"m_s");t.enableVertexAttribArray(f);const p=e.items.map((({spatialBoundariesSlot:v})=>v)).map((({x:v,y:A,w:S,h:w})=>[v,A,S,w])).flat();ee(t,new Uint32Array(p)),t.vertexAttribIPointer(f,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(f,1);const _=t.getAttribLocation(s,"m_5");t.enableVertexAttribArray(_),ee(t,new Uint32Array(e.items.map((({N:v})=>v)))),t.vertexAttribIPointer(_,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(_,1);const x=t.getAttribLocation(s,"m_t");function y(){t.viewport(0,0,o.size[0],o.size[1]),t.useProgram(s),t.bindVertexArray(d),t.bindFramebuffer(t.FRAMEBUFFER,a),gn(t,l,{m_b:e.texture.points().handle,m_7:e.texture.spatialBoundaries().handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,i.length)}t.enableVertexAttribArray(x),ee(t,new Uint32Array(e.items.map((({depth:v})=>v)))),t.vertexAttribIPointer(x,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(x,1),Ot(y,"x");const b=Ot((()=>{t.deleteFramebuffer(a),t.deleteTexture(o.handle)}),"E");return{step:y,outputs:{items:e.items.map(((v,A)=>({N:e.items[A].N,spatialKeysSlot:i[A]}))),texture:{spatialKeys:()=>o}},destroy:b}}),"Ze"),bk=`#version 300 es
precision mediump float;uniform mediump sampler2D m_b,m_7;uniform uint m_8;flat in uvec4 m_21;flat in uint m_22,m_23;out vec4 outColor;void main(){uvec2 o=uvec2(gl_FragCoord.xy);uint u=o.x-m_21.x+(o.y-m_21.y)*m_21.z;if(outColor=vec4(1e9,1e9,-1e9,-1e9),u>=m_22)return;if(m_8>=m_23){outColor=texelFetch(m_7,ivec2(o),0);return;}if(m_8==0u)outColor.xy=outColor.zw=texelFetch(m_b,ivec2(o),0).xy;else for(uint u;u<4u;u++){uvec2 e=(o-m_21.xy<<1u)+uvec2(u&1u,u>>1u)+m_21.xy;vec4 t=texelFetch(m_7,ivec2(e),0);outColor=vec4(min(outColor.xy,t.xy),max(outColor.zw,t.zw));}if(m_8==m_23-1u){vec2 o=outColor.zw-outColor.xy;outColor=vec4(outColor.xy-1.,vec2(max(o.x,o.y))+2.);}}`,vk=`#version 300 es
precision mediump int;
precision mediump float;

uniform uvec2 m_6;
uniform uint m_8;

in vec2 position; 
in uvec4 m_9; 
in uint m_5; 
in uint m_a; 

flat out uvec4 m_21;
flat out uint m_22;
flat out uint m_23;

void main() {
  uvec4 slot = uvec4(m_9.xy, m_9.zw >> min(m_8, m_23));
  m_21 = slot;
  m_22 = m_5;
  m_23 = m_a;

  
  vec2 posPx = (position + 1.f) * vec2(slot.zw) * .5f + vec2(m_21.xy);
  gl_Position = vec4(posPx / vec2(m_6) * 2.f - 1.f, 0.f, 1.f);
}`,Ek=Ot((t=>Math.ceil(Math.log2(Math.sqrt(t)))+1),"tt"),Ak=Ot(((t,e)=>{const s=cn(t,vk,bk),i=e.texture.points(),n=Ts(t,{size:i.size,data:new Float32Array(i.data.buffer.slice(0)),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),r=Ts(t,{size:i.size,data:new Float32Array(i.data.buffer.slice(0)),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),o=dn(n,r),a=hn(t,r.handle),l=hn(t,n.handle),d=dn(a,l),h=Vn(t,s,{m_6:i.size,m_7:n.handle,m_8:0}),u=e.items.map((({N:A})=>Ek(A))),c=u.reduce(((A,S)=>Math.max(A,S)),0),g=t.createVertexArray();t.bindVertexArray(g);const m=t.getAttribLocation(s,"position");t.enableVertexAttribArray(m),ee(t,ki),t.vertexAttribPointer(m,2,t.FLOAT,!1,0,0);const f=t.getAttribLocation(s,"m_9");t.enableVertexAttribArray(f);const p=e.items.map((({pointsSlot:A})=>A)).map((({x:A,y:S,w,h:I})=>[A,S,w,I])).flat();ee(t,new Uint32Array(p)),t.vertexAttribIPointer(f,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(f,1);const _=t.getAttribLocation(s,"m_5");t.enableVertexAttribArray(_),ee(t,new Uint32Array(e.items.map((({N:A})=>A)))),t.vertexAttribIPointer(_,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(_,1);const x=t.getAttribLocation(s,"m_a");t.enableVertexAttribArray(x),ee(t,new Uint32Array(u)),t.vertexAttribIPointer(x,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(x,1);let y=n;function b(){t.viewport(0,0,...n.size),t.useProgram(s),t.bindVertexArray(g);for(let A=0;A<c;A++){t.bindFramebuffer(t.FRAMEBUFFER,d()[0]);const[S,w]=o();y=w,gn(t,h,{m_b:e.texture.points().handle,m_6:e.texture.points().size,m_7:S.handle,m_8:A}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}Ot(b,"E");const v=Ot((()=>{t.deleteFramebuffer(a),t.deleteFramebuffer(l),t.deleteTexture(r.handle),t.deleteTexture(n.handle)}),"P");return{step:b,outputs:{items:e.items.map((({pointsSlot:A})=>A)).map((({x:A,y:S})=>({spatialBoundariesSlot:{x:A,y:S,w:1,h:1}}))),texture:{spatialBoundaries:()=>y}},destroy:v}}),"rt"),Sk=Ot((t=>{let e;return()=>e||t().finally((()=>e=void 0))}),"nt"),wk=Ot(((t,e)=>Math.max(.1,1-(t/Math.max(1,e-20))**7.39)),"ye"),Tk=Ot(((t,e=25,s=24e3)=>{const i=(s-e)/(e-1);return Math.ceil(e*i*4/(i+t))}),"ve"),g_=Ot((t=>{const e=Math.max(1,Math.ceil(Math.log2(t)/2));return t>65535?e+1:e}),"_e"),m_={charge:10,edgeStrength:.5,edgeLength:30,elasticity:.9,margin:1,gravity:.01,inertia:.9,maxDisplacement:1e3,steps:200},Ck=Ot(((t,e)=>{let[s,i]=[0,0];const n=Ot((()=>{for(let o=0;o<t;o++,s++)if(!e(s))return!0}),"i"),r=Ot((o=>{n()?o(s):i=requestAnimationFrame((()=>r(o)))}),"a");return{start:Sk((()=>new Promise((o=>(s=0)||r(o))))),step:n,stop:()=>cancelAnimationFrame(i)}}),"Ae"),Sh=Ot(((t,e,s)=>{let i=e.texture.particlesPositions();const{steps:n,batch:r,sortingMethod:o}=s,a=s.order??4,l={items:e.items.map((({N:_,particlesPositionsSlot:x})=>({N:_,pointsSlot:x}))),texture:{points:()=>i}},d=Ak(t,l),h=xk(t,{items:e.items.map((({N:_},x)=>({depth:Math.max(1,s.depth??g_(_)),...l.items[x],...d.outputs.items[x]}))),texture:{...l.texture,...d.outputs.texture}}),u=(o==="ibr"?pk:ck)(t,h.outputs),c=rk(t,{items:e.items.map((({N:_},x)=>({depth:Math.max(1,s.depth??g_(_)),...d.outputs.items[x],...u.outputs.items[x]}))),texture:{...d.outputs.texture,...u.outputs.texture}}),g=sk(t,{items:e.items.map(((_,x)=>({order:a,..._,...c.outputs.items[x]}))),texture:{particlesPositions:()=>i,particlesCharges:e.texture.particlesCharges,...c.outputs.texture}}),m=JD(t,{items:g.outputs.items,texture:{...g.outputs.texture}}),f=ZD(t,{items:e.items.map(((_,x)=>({..._,...c.outputs.items[x],...m.outputs.items[x]}))),texture:{...e.texture,...c.outputs.texture,...m.outputs.texture}},s),p=e.items.reduce(((_,{N:x})=>Math.max(_,x)),0);return{...Ck(r??Tk(p),(_=>(i=f.outputs.texture.points(),d.step(),h.step(),u.step(),c.step(),g.step(),m.step(),f.step(wk(_,n)),_<n))),destroy:()=>{d.destroy(),h.destroy(),u.destroy(),c.destroy(),g.destroy(),m.destroy(),f.destroy()}}}),"_t"),f_=0,YE=typeof window>"u",Lk=typeof performance<"u"&&performance.now?performance:Date,Ik=YE?t=>{const e=Lk.now(),s=Math.max(0,16-(e-f_)),i=setTimeout((()=>t(e+s)),s);return f_=e+s,i}:window.requestAnimationFrame,Mk=YE?t=>clearTimeout(t):window.cancelAnimationFrame;function XE(t,e,s){for(let i=0;i<t.length;i++){const n=t[i];n.x=e[i],n.y=s[i]}}Ot(XE,"defaultUpdate");var Nk=Ot((()=>{}),"noop"),Rk=.001,wh={movementRatio:7e-8,surfaceRatio:.0025},Fk=.003,Pk=Ot(((t,e)=>Fk*t**2+(e+1)),"defaultMass"),sc=class{constructor(t={}){this.onUpdate=Ot((e=>{}),"onUpdate"),this.update=XE,this.nextTick=Ik,this.cancelTick=Mk,this.onEnd=Nk,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=wh,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in t?t.autoStop&&(typeof t.autoStop=="boolean"?t.autoStop=wh:t.autoStop={...t.autoStop,...wh}):t.steps;for(const e in t)t[e]===void 0&&e!=="order"&&e!=="depth"||(this[e]=t[e])}};Ot(sc,"Settings");var zk=Ot((({nodes:t,edges:e})=>{const s=t.length,i=e.length,n=new Uint32Array(s);for(let r=0;r<i;r++){const{source:o,target:a}=e[r];n[o]++,n[a]++}return n}),"degrees"),Dk=Ot(((t,e)=>({nodes:t.nodes.map(((s,i)=>{let n=(s.mass??1)*Pk(s.r||1,e[i]);return n=Math.max(n,Rk),{...s,mass:n}})),edges:t.edges.map((s=>{const i=s.weight||1,n=e[s.target]+1,r=e[s.source]+1,o=i*(n*r)/Math.min(n,r)/(n+r);return{...s,stiffness:o}}))})),"defaultSettings"),ul=Ot(((t,e)=>{const s=XD(tc(t),e);return Dk(s,zk(s))}),"cleanGraph"),p_=class{constructor(t){this.promise=new Promise(t)}then(t){return this.promise.then(t)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function Cl(t,e,s={}){let i,n;e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_lose_context")?.loseContext();let r=new sc({...m_,...s});const o=t.nodes.length,a=s.cx||t.nodes.reduce(((p,_)=>p+(_.x||0)),0)/o,l=s.cy||t.nodes.reduce(((p,_)=>p+(_.y||0)),0)/o,d=[a,l],h=Array.from({length:o},((p,_)=>_)),u=Ot((p=>{if(!i)throw new Error("No graph has been set");const{size:_}=i.texture.particlesPositions();if(_[0]*_[1]<=1)return{X:[0],Y:[0]};const x=[],y=[];let b=0;const v=new Float32Array(4*_[0]*_[1]);return e.readPixels(0,0,_[0],_[1],e.RGBA,e.FLOAT,v),i.items.forEach((({N:A,particlesPositionsSlot:S})=>{const{x:w,y:I,w:M}=S;for(let N=0;N<A;N++){const D=w+N%M,q=4*((I+Math.floor(N/M))*_[0]+D);x[h[b+N]]=v[q]+a,y[h[b+N]]=v[q+1]+l}b+=A})),p&&(c(),g()),{X:x,Y:y}}),"readLayoutData"),c=Ot((()=>{n&&(n.stop(),n.destroy(),n=void 0)}),"simulationCleanup"),g=Ot((()=>{i&&(u_(e,i),i=void 0)}),"graphLayoutCleanup"),m={setOptions:(p={})=>(r=new sc({...m_,...p}),i&&(c(),n=Sh(e,i,r)),m),setGraph:(p={nodes:[],edges:[]})=>{let _;if(i&&u_(e,i),s.groups){const x={};Object.entries(s.groups).forEach((([y,b])=>b.forEach((v=>x[v]=Number(y))))),_=h_(tc(p),Object.values(x)),_.map((({nodes:y})=>y)).flat().forEach(((y,b)=>h[b]=y.id)),_=_.map((y=>ul(y,d)))}else _=[ul(p,d)];return i=ec(e,_),r&&(c(),n=Sh(e,i,r)),m},start:()=>{if(!n)throw new Error("No graph has been set");return n.start().finally((()=>s.onEnd?.(1))).catch((p=>{throw new Error("Something went wrong during GPU layout: "+p)})),m},stop:()=>(n&&n.stop(),m),step:()=>{if(!n)throw new Error("No graph has been set");return n.step(),m},data:p=>u(p),iterations:()=>1};let f;if(s.groups){const p={};Object.entries(s.groups).forEach((([_,x])=>x.forEach((y=>p[y]=Number(_))))),f=h_(tc(t),Object.values(p)),f.map((({nodes:_})=>_)).flat().forEach(((_,x)=>h[x]=_.id)),f=f.map((_=>ul(_,d)))}else f=[ul(t,d)];return i=ec(e,f),n=Sh(e,i,r),m}function __(){var t=(()=>{var e=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,r=(P,B)=>e(P,"name",{value:B,configurable:!0}),o={};((P,B)=>{for(var k in B)e(P,k,{get:B[k],enumerable:!0})})(o,{IntegratorType:()=>ve,force:()=>Ie});var a=class{constructor(P){let B=l();this.c=1,this.s0=B(" "),this.s1=B(" "),this.s2=B(" "),this.s0-=B(String(P)),this.s0<0&&(this.s0+=1),this.s1-=B(String(P)),this.s1<0&&(this.s1+=1),this.s2-=B(P),this.s2<0&&(this.s2+=1),B=null}next(){return()=>{const P=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=P-(this.c=0|P)}}nextDouble(){const P=this.next();return()=>P()+11102230246251565e-32*(2097152*P()|0)}nextInt32(){const P=this.next();return()=>4294967296*P()|0}};function l(){let P=4022871197;return B=>{B=B.toString();for(let k=0;k<B.length;k++){P+=B.charCodeAt(k);let U=.02519603282416938*P;P=U>>>0,U-=P,U*=P,P=U>>>0,U-=P,P+=4294967296*U}return 23283064365386963e-26*(P>>>0)}}function d(P){return new a(P.toString()).next()}r(a,"Alea"),r(l,"Mash"),r(d,"impl");var h=d(42);function u(P){h=d(P)}function c(){return 1e-6*(h()-.5)}function g(P,B,k,{edgeStrength:U,edgeLength:Z}){const $=k.sources,G=k.targets,J=k.X,st=k.Y,lt=k.R,dt=k.fx,at=k.fy,ft=k.degrees,_t=k.masses,ht=k.weights;for(let ut=0;ut<B.length;ut++){const mt=B[ut],yt=$[mt],xt=G[mt],Et=1,vt=ft[yt]+Et,Ct=ft[xt]+Et,Mt=U*ht[mt];let kt=J[xt]+dt[xt]-J[yt]-dt[yt]||c(),jt=st[xt]+at[xt]-st[yt]-at[yt]||c();const re=kt*kt+jt*jt,he=Math.sqrt(re),de=Z+lt[yt]+lt[xt];if(he<=de)continue;const fe=de-he,pe=fe*(Ct*vt/Math.min(Ct,vt)/(Ct+vt)),Se=Math.min(1,P*Mt*fe/re*(pe*(Ct+vt)/(Ct*vt))),Oe=Ct*vt/(Ct+vt);kt*=Se,jt*=Se,dt[yt]+=kt*Oe/_t[yt],at[yt]+=jt*Oe/_t[yt],dt[xt]-=kt*Oe/_t[xt],at[xt]-=jt*Oe/_t[xt]}}r(u,"setSeed"),r(c,"randomize"),r(g,"attraction");var m=r(((P,B)=>{const k=B.sources,U=B.targets,Z=B.degrees,$=B.weights,G=B.edgeIds,J=B.nodeToGroup,st=B.hasGroups;for(let lt=0;lt<P.length;lt++){const{source:dt,target:at,weight:ft=1}=P[lt];k[lt]=dt,U[lt]=at,$[lt]=ft,Z[dt]++,Z[at]++,G[lt]=lt,$[lt]=ft===void 0?1:ft,st&&J[dt]!==J[at]&&($[lt]=0)}}),"initialize");function f(P,B,k,{gravity:U,cx:Z,cy:$}){const G=k.X,J=k.Y,st=k.fx,lt=k.fy,dt=k.nodeToGroup,at=k.cells,ft=k.hasGroups,_t=B.length;for(let ht=0;ht<_t;ht++){const ut=B[ht],mt=ft?at[dt[ht]].cx:Z,yt=ft?at[dt[ht]].cy:$,xt=mt-G[ut]||c(),Et=yt-J[ut]||c(),vt=U*P;st[ut]+=xt*vt,lt[ut]+=Et*vt}}g.initialize=m,r(f,"center");var p=r(((P,B,k)=>{const{X:U,Y:Z}=B;let $=k.cx,G=k.cy;const J=P.length;if($===void 0||G===void 0){$=G=0;for(let st=0;st<J;st++)$+=U[st],G+=Z[st];$/=J,G/=J}k.cx=$,k.cy=G}),"initialize");f.initialize=p;var _=class{constructor(P,B,k,U){this.left=null,this.right=null,this.data=null,this.code=P,this.data=B,this.left=k,this.right=U}};function x(P,B,k,U,Z){const $=new _(null,null,null,null),G=[$],J=[U,Z];for(;G.length!==0;){const st=J.pop(),lt=J.pop(),dt=G.pop();if(st-lt==0)dt.code=k[lt],dt.data=P[B[lt]];else{const at=v(B,k,lt,st);dt.code=at,lt<=at&&(dt.left=new _(null,null,null,null),G.push(dt.left),J.push(lt,at)),st>at&&(dt.right=new _(null,null,null,null),G.push(dt.right),J.push(at+1,st))}}return $}function y(P,B,k,U,Z,$){const G=new _(null,null,null,null),J=[G],st=[U,Z];for(;J.length!==0;){const lt=st.pop(),dt=st.pop(),at=J.pop();if(lt-dt<$){const ft=new Array(lt-dt+1);for(let _t=dt,ht=0;_t<=lt;_t++,ht++)ft[ht]=P[B[_t]];at.code=k[dt],at.data=ft}else{const ft=v(B,k,dt,lt);at.code=ft,dt<=ft&&(at.left=new _(null,null,null,null),J.push(at.left),st.push(dt,ft)),lt>ft&&(at.right=new _(null,null,null,null),J.push(at.right),st.push(ft+1,lt))}}return G}r(_,"Node"),r(x,"buildIterative"),r(y,"buildIterativeBuckets");var b=Math.clz32||r((function(B){let k=-2147483648;for(let U=0;U<31;U+=1){if(k&B)return U;k>>>=1}return 32}),"clz");function v(P,B,k,U){const Z=B[P[k]],$=B[P[U]];if(Z===$)return k;const G=b(Z^$);let J,st,lt,dt=k,at=U-k;do at=at+1>>1,J=dt+at,J<U&&(st=B[P[J]],lt=b(Z^st),lt>G&&(dt=J));while(at>1);return dt}function A(P,B){let k=P^B,U=65535^k,Z=65535^(P|B),$=P&(65535^B),G=k|U>>1,J=k>>1^k,st=Z>>1^U&$>>1^Z,lt=k&Z>>1^$>>1^$;k=G,U=J,Z=st,$=lt,G=k&k>>2^U&U>>2,J=k&U>>2^U&(k^U)>>2,st^=k&Z>>2^U&$>>2,lt^=U&Z>>2^(k^U)&$>>2,k=G,U=J,Z=st,$=lt,G=k&k>>4^U&U>>4,J=k&U>>4^U&(k^U)>>4,st^=k&Z>>4^U&$>>4,lt^=U&Z>>4^(k^U)&$>>4,k=G,U=J,Z=st,$=lt,st^=k&Z>>8^U&$>>8,lt^=U&Z>>8^(k^U)&$>>8,k=st^st>>1,U=lt^lt>>1;let dt=P^B,at=U|65535^(dt|k);return dt=16711935&(dt|dt<<8),dt=252645135&(dt|dt<<4),dt=858993459&(dt|dt<<2),dt=1431655765&(dt|dt<<1),at=16711935&(at|at<<8),at=252645135&(at|at<<4),at=858993459&(at|at<<2),at=1431655765&(at|at<<1),(at<<1|dt)>>>0}r(v,"findSplit"),r(A,"hilbert");var S=[0,1],w=[0,2];for(let P=4;P<65535;P<<=2)for(let B=0,k=S.length;B<k;B++)S.push(S[B]|P),w.push((S[B]|P)<<1);function I(P,B){return(w[255&B]|S[255&P])+65536*(w[B>>8&255]|S[P>>8&255])+4294967296*(w[B>>16&255]|S[P>>16&255])}r(I,"morton");var M=new Uint32Array(1024);function N(P,B){const k=new Uint32Array(B.length);for(let Z=0;Z<1024;Z++)M[Z]=0;const U=255;for(let Z=0;Z<B.length;Z++){const $=B[Z];M[$&U]++,M[256+($>>8&U)]++,M[512+($>>16&U)]++,M[768+($>>24&U)]++}for(let Z=0;Z<4;Z++){let $=0,G=0;const J=256*Z;for(let st=0;st<256;st++)$=M[st+J],M[st+J]=G,G+=$}for(let Z=0;Z<B.length;Z++){const $=B[Z];k[M[$&U]++]=Z}for(let Z=0;Z<B.length;Z++){const $=k[Z],G=B[$];P[M[256+(G>>8&U)]++]=$}for(let Z=0;Z<B.length;Z++){const $=P[Z],G=B[$];k[M[512+(G>>16&U)]++]=$}for(let Z=0;Z<B.length;Z++){const $=k[Z],G=B[$];P[M[768+(G>>24&U)]++]=$}}r(N,"radixSort");var D=class{constructor(P,{getX:B,getY:k,bucketSize:U=0,sfc:Z=1}={}){this.bucketSize=0,this._root=null;const $=P.length,G=new Uint32Array($);let J=1/0,st=1/0,lt=-1/0,dt=-1/0;this._x=B,this._y=k;const at=Z===1?A:I;this._project=at;const ft=new Uint32Array($);for(let ut=0;ut<$;ut++){const mt=P[ut],yt=B(mt),xt=k(mt);yt<J&&(J=yt),xt<st&&(st=xt),yt>lt&&(lt=yt),xt>dt&&(dt=xt),ft[ut]=ut}this._minX=J,this._minY=st,this._maxX=lt,this._maxY=dt;const _t=65535/Math.max(lt-J,1),ht=65535/Math.max(dt-st,1);this._hw=_t,this._hh=ht;for(let ut=0;ut<$;ut++){const mt=P[ut];G[ut]=at(_t*(B(mt)-J),ht*(k(mt)-st))}N(ft,G),this._root=U===0?x(P,ft,G,0,$-1):y(P,ft,G,0,$-1,U),this.bucketSize=U}get root(){return this._root}inOrder(P,B){let k=this._root;const U=[];let Z=!1;for(;!Z;)if(k)U.push(k),k=k.left;else if(U.length!==0){if(k=U.pop(),P.call(B,k))break;k=k.right}else Z=!0;return this}preOrder(P,B){const k=[this._root];for(;k.length!==0;){const U=k.pop();P.call(B,U)||(U.right&&k.push(U.right),U.left&&k.push(U.left))}return this}postOrder(P,B){const k=[];let U,Z=this._root;do{for(;Z;)Z.right&&k.push(Z.right),k.push(Z),Z=Z.left;Z=k.pop(),U=k.length-1,Z.right&&k[U]===Z.right?(k[U]=Z,Z=Z.right):(P.call(B,Z),Z=null)}while(k.length!==0);return this}map(P,B){const k=[];return this.inOrder((U=>{k.push(P.call(B,U))})),k}height(){return q(this._root)}toString(P=(B=>B.code.toString())){const B=[];return et(this._root,"",!0,(k=>B.push(k)),P),B.join("")}size(){let P=0;return this.preOrder((()=>{P++})),P}destroy(){return this._root=null,this}};function q(P){return P?1+Math.max(q(P.left),q(P.right)):0}function et(P,B,k,U,Z){if(P){U(B+(k?"^-- ":"|-- ")+Z(P)+`
`);const $=B+(k?"    ":"|   ");P.left&&et(P.left,$,!1,U,Z),P.right&&et(P.right,$,!0,U,Z)}}function O(P){for(let B=P.length-1;B>=0;B--){let k=Math.floor(Math.random()*(B+1));k=Math.max(Math.min(k,B),0);const U=P[B];P[B]=P[k],P[k]=U}return P}r(D,"BVH"),r(q,"treeHeight"),r(et,"row"),r(O,"shuffle");var K,j,ot,it,ct,pt,Pt,At,bt,It=r((P=>P.x),"getX"),Ut=r((P=>P.y),"getY"),Gt=r((P=>P.r),"getR");function Dt(P,B=It,k=Ut,U=Gt){const Z=O(P.slice()),$=Z.length;let G,J=[],st=0;for(;st<$;){const lt=Z[st];G&&Nt(G,B(lt),k(lt),U(lt))?st++:(J=Rt(J,lt,B,k,U),G=qt(J,B,k,U),st=0)}return G}function Rt(P,B,k,U,Z){const $=k(B),G=U(B),J=Z(B),st={x:$,y:G,r:J};if(Ht(st,P,k,U,Z))return[B];for(let lt=0;lt<P.length;++lt){const dt=P[lt],at=k(dt),ft=U(dt),_t=Z(dt);if(!Tt(st,at,ft,_t)&&Ht(Lt(at,ft,_t,$,G,J),P,k,U,Z))return[P[lt],B]}for(let lt=0;lt<P.length-1;lt++)for(let dt=lt+1;dt<P.length;dt++){const at=P[lt],ft=P[dt],_t=k(at),ht=U(at),ut=Z(at),mt=k(ft),yt=U(ft),xt=Z(ft);if(!Tt(Lt(_t,ht,ut,mt,yt,xt),$,G,J)&&!Tt(Lt(_t,ht,ut,$,G,J),mt,yt,xt)&&!Tt(Lt(mt,yt,xt,$,G,J),_t,ht,ut)&&Ht(Kt(_t,ht,ut,mt,yt,xt,$,G,J),P,k,U,Z))return[P[lt],P[dt],B]}throw new Error}function Tt(P,B,k,U){const Z=P.r-U,$=B-P.x,G=k-P.y;return Z>=0&&Z*Z>$*$+G*G}function Nt(P,B,k,U){const Z=P.r-U+1e-6,$=B-P.x,G=k-P.y;return Z>0&&Z*Z>$*$+G*G}function Ht(P,B,k,U,Z){for(let $=0;$<B.length;++$){const G=B[$];if(!Nt(P,k(G),U(G),Z(G)))return!1}return!0}function qt(P,B,k,U){return P.length===1?Zt(B(P[0]),k(P[0]),U(P[0])):P.length===2?Lt(B(P[0]),k(P[0]),U(P[0]),B(P[1]),k(P[1]),U(P[1])):Kt(B(P[0]),k(P[0]),U(P[0]),B(P[1]),k(P[1]),U(P[1]),B(P[2]),k(P[2]),U(P[2]))}function Zt(P,B,k){return{x:P,y:B,r:k}}function Lt(P,B,k,U,Z,$){const G=U-P,J=Z-B,st=$-k,lt=Math.sqrt(G*G+J*J);return{x:(P+U+G/lt*st)/2,y:(B+Z+J/lt*st)/2,r:(lt+k+$)/2}}function Kt(P,B,k,U,Z,$,G,J,st){const lt=(P+U+G)/3,dt=(B+Z+J)/3,at=P-lt,ft=B-dt,_t=U-lt,ht=Z-dt,ut=G-lt,mt=J-dt,yt=at-_t,xt=at-ut,Et=ft-ht,vt=ft-mt,Ct=$-k,Mt=st-k,kt=at*at+ft*ft-k*k,jt=kt-_t*_t-ht*ht+$*$,re=kt-ut*ut-mt*mt+st*st,he=xt*Et-yt*vt,de=(Et*re-vt*jt)/(2*he)-at,fe=(vt*Ct-Et*Mt)/he,pe=(xt*jt-yt*re)/(2*he)-ft,Se=(yt*Mt-xt*Ct)/he,Oe=fe*fe+Se*Se-1,qe=2*(k+de*fe+pe*Se),He=de*de+pe*pe-k*k,ns=-(Math.abs(Oe)>1e-6?(qe+Math.sqrt(qe*qe-4*Oe*He))/(2*Oe):He/qe);return{x:lt+at+de+fe*ns,y:dt+ft+pe+Se*ns,r:ns}}function ue(P,B,k,{X:U,Y:Z,R:$,fx:G,fy:J,bucketSize:st},{elasticity:lt}){if(lt===0)return k;k||(k=new D(B,{getX:K,getY:j,bucketSize:st})).postOrder(it);for(let dt=0;dt<B.length;dt++)pt=B[dt],Pt=U[pt]+G[pt],At=Z[pt]+J[pt],bt=$[pt],k.preOrder(ct);return k}r(Dt,"med"),r(Rt,"extend"),r(Tt,"contains"),r(Nt,"containsWeak"),r(Ht,"containsWeakAll"),r(qt,"enclose"),r(Zt,"from1"),r(Lt,"from2"),r(Kt,"from3"),r(ue,"collisionForce");var ne=r((P=>{const B=P.X,k=P.Y,U=P.R,Z=P.bucketSize;return $=>{let G,J,st,lt;const dt=$.data;if(dt!==null)if(Z!==0){const at=Dt(dt,K,j,ot);G=at.x,J=at.y,st=at.r}else{const at=dt;G=B[at],J=k[at],st=U[at]}else if($.left&&$.right){const at=$.left.cx,ft=$.left.cy,_t=$.right.cx,ht=$.right.cy,ut=$.left.r,mt=$.right.r,yt=_t-at,xt=ht-ft,Et=mt-ut,vt=Math.sqrt(yt*yt+xt*xt);G=(at+_t+yt/vt*Et)/2,J=(ft+ht+xt/vt*Et)/2,st=(vt+ut+mt)/2}else lt=$.left||$.right,lt&&(G=lt.cx,J=lt.cy,st=lt.r);$.cx=G,$.cy=J,$.r=st}}),"getMeasureBodies"),se=r(((P,{elasticity:B,margin:k})=>{const U=P.X,Z=P.Y,$=P.R,G=P.fx,J=P.fy,st=P.bucketSize,lt=P.nodeToGroup,dt=P.cellSize,at=P.hasGroups;return ft=>{const _t=ft.data;if(_t===null){const ht=ft.cx-Pt,ut=ft.cy-At,mt=ft.r+bt;return at?ht*ht+ut*ut>dt*dt:ht*ht+ut*ut>mt*mt}if(st!==0){const ht=_t;for(let ut=0;ut<ht.length;ut++){const mt=ht[ut];if(mt>pt){const yt=$[mt];let xt=Pt-U[mt]-G[mt],Et=At-Z[mt]-J[mt];const vt=bt+yt+k;let Ct=xt*xt+Et*Et;if(Ct<vt*vt){xt===0&&(xt=c(),Ct+=xt*xt),Et===0&&(Et=c(),Ct+=Et*Et);const Mt=Math.sqrt(Ct),kt=(vt-Mt)*B/Mt,jt=yt/vt;G[pt]+=xt*kt*jt,J[pt]+=Et*kt*jt,G[mt]-=xt*kt*(1-jt),J[mt]-=Et*kt*(1-jt)}}}}else{const ht=ft.data;if(at&&lt[pt]!==lt[ht])return;if(ht>pt){const ut=$[ht];let mt=Pt-U[ht],yt=At-Z[ht];const xt=bt+ut+k;let Et=mt*mt+yt*yt;if(Et<xt*xt){mt===0&&(mt=c(),Et+=mt*mt),yt===0&&(yt=c(),Et+=yt*yt);const vt=Math.sqrt(Et),Ct=(xt-vt)*B/vt,Mt=ut/xt;G[pt]+=mt*Ct*Mt,J[pt]+=yt*Ct*Mt,G[ht]-=mt*Ct*(1-Mt),J[ht]-=yt*Ct*(1-Mt)}}}}}),"getApplyForce"),le=r(((P,B,k)=>{const{X:U,Y:Z,R:$}=B;K=r((G=>U[G]),"getX"),j=r((G=>Z[G]),"getY"),ot=r((G=>$[G]),"getR"),it=ne(B),ct=se(B,k)}),"initialize");function ge(P,B,{masses:k,X:U,Y:Z,fx:$,fy:G},{charge:J}){const st=B.length;let lt,dt,at,ft,_t,ht,ut,mt,yt;for(let xt=0;xt<st;xt++){lt=B[xt];for(let Et=xt+1;Et<st;Et++)if(xt!==Et){if(dt=B[Et],lt===dt)continue;at=U[lt]-U[dt]||c(),ft=Z[lt]-Z[dt]||c(),_t=at*at+ft*ft,_t<1&&(_t=Math.sqrt(1*_t)),ht=J*k[dt],ut=P*ht/_t,mt=J*k[lt],yt=P*mt/_t,$[lt]+=at*ut,G[lt]+=ft*ut,$[dt]-=at*yt,G[dt]-=ft*yt}}}ue.initialize=le,r(ge,"repulsion"),ge.initialize=()=>{};var ve=(P=>(P[P.verlet=0]="verlet",P[P.euler=1]="euler",P))(ve||{}),Le=0,Ae=typeof window>"u",Xt=typeof performance<"u"&&performance.now?performance:Date,Wt=Ae?P=>{const B=Xt.now(),k=Math.max(0,16-(B-Le)),U=setTimeout((()=>P(B+k)),k);return Le=B+k,U}:window.requestAnimationFrame,is=Ae?P=>clearTimeout(P):window.cancelAnimationFrame;function Rs(P,B,k){for(let U=0;U<P.length;U++){const Z=P[U];Z.x=B[U],Z.y=k[U]}}r(Rs,"defaultUpdate");var ds,vs,Oi,Bs,Zs,Pe,Ke,Y,E,T,C,L=r((()=>{}),"noop"),R={movementRatio:7e-8,surfaceRatio:.0025},F=r(((P,B)=>.003*P**2+(B+1)),"defaultMass"),z=class{constructor(P={}){this.onUpdate=r((B=>{}),"onUpdate"),this.update=Rs,this.nextTick=Wt,this.cancelTick=is,this.onEnd=L,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=R,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in P?P.autoStop&&(typeof P.autoStop=="boolean"?P.autoStop=R:P.autoStop={...P.autoStop,...R}):P.steps;for(const B in P)P[B]===void 0&&B!=="order"&&B!=="depth"||(this[B]=P[B])}};r(z,"Settings");var V=0;function H(P,B,k,U){const Z=U.X,$=U.Y,G=U.R,J=U.masses,st=U.bucketSize;V=P,k===null&&(k=new D(B,{getX:Oi,getY:Bs,bucketSize:st})).postOrder(ds);const lt=B.length;for(let dt=0;dt<lt;dt++)Pe=B[dt],Ke=Z[Pe],Y=$[Pe],E=G[Pe],T=J[Pe],C=T,k.preOrder(vs);return k}r(H,"repulsion");var X=r(((P,{charge:B,theta:k})=>{const U=P.fx,Z=P.fy,$=P.X,G=P.Y,J=P.R,st=P.masses,lt=P.bucketSize,dt=P.cellSize;return at=>{let ft=0,_t=0,ht=Ke-at.cx||c(),ut=Y-at.cy||c(),mt=ht*ht+ut*ut,yt=E+at.r;const xt=at.data;if(xt!==null){if(xt===Pe)return!1;if(lt!==0){const Et=xt;for(let vt=0;vt<Et.length;vt++){const Ct=Et[vt];if(Ct===Pe)continue;ht=Ke-$[Ct]||c(),ut=Y-G[Ct]||c(),mt=ht*ht+ut*ut,yt=E+J[Ct],mt<1&&(mt=Math.sqrt(1*mt));const Mt=st[Ct];ft=B*Mt*C,_t=V*ft/mt,U[Pe]+=ht*_t/T,Z[Pe]+=ut*_t/T}}else{if(mt<1&&(mt=Math.sqrt(1*mt)),mt>(dt/2)**2)return!0;ft=B*at.mass*C,_t=V*ft/mt,U[Pe]+=ht*_t/T,Z[Pe]+=ut*_t/T}}else{const Et=yt/k;if(mt>Et*Et)return mt<1&&(mt=Math.sqrt(1*mt)),mt>(dt/2)**2||(ft=B*at.mass,ft=B*at.mass*C,_t=V*ft/mt,U[Pe]+=ht*_t/T,Z[Pe]+=ut*_t/T),!0}}}),"getApplyForce"),W=r((P=>{const B=P.X,k=P.Y,U=P.R,Z=P.masses,$=P.bucketSize;return G=>{let J,st,lt=0,dt=0,at=0,ft=0;const _t=G.data;if(_t!==null)if($!==0){const ht=_t,ut=Dt(ht,Oi,Bs,Zs);lt=ut.x,dt=ut.y,at=ut.r;for(let mt=0;mt<ht.length;mt++)ft+=Z[ht[mt]]}else st=_t,lt=B[st],dt=k[st],at=U[st],ft=Z[st];else if(G.left&&G.right){const ht=G.left.cx,ut=G.left.cy,mt=G.right.cx,yt=G.right.cy,xt=G.left.r,Et=G.right.r,vt=mt-ht,Ct=yt-ut,Mt=Et-xt,kt=Math.sqrt(vt*vt+Ct*Ct);lt=(ht+mt+vt/kt*Mt)/2,dt=(ut+yt+Ct/kt*Mt)/2,at=(kt+xt+Et)/2,ft=G.left.mass+G.right.mass}else J=G.left||G.right,lt=J.cx,dt=J.cy,at=J.r,ft=J.mass;G.cx=lt,G.cy=dt,G.r=at,G.mass=ft}}),"getAccumulateBodies"),Q=r(((P,B,k)=>{const U=P.length,Z=B.X,$=B.Y,G=B.R,J=B.degrees,st=B.pinned,lt=B.masses,dt=B.nodeIds,at=k.scaling,ft=k.defaultRadius,_t=k.bucketSize;B.bucketSize=_t===void 0?Math.floor(Math.log(U)):_t;let ht=1/0,ut=1/0,mt=-1/0,yt=-1/0;const xt=Math.PI*(3-Math.sqrt(5));let Et=0;for(let vt=0;vt<P.length;vt++){const Ct=P[vt];let{x:Mt,y:kt,r:jt}=Ct,{mass:re=1}=Ct;if(re=Math.max(re*F(jt||ft,J[vt]),.001),isNaN(Mt)||isNaN(kt)){const he=5*Math.sqrt(vt),de=vt*xt;Mt=he*Math.cos(de),kt=he*Math.sin(de)}jt=jt||ft,Z[vt]=Mt,$[vt]=kt,G[vt]=jt,st[vt]=Ct.pinned?1:0,lt[vt]=re*at,dt[vt]=vt,jt>Et&&(Et=jt),Mt<ht&&(ht=Mt),kt<ut&&(ut=kt),Mt>mt&&(mt=Mt),kt>yt&&(yt=kt)}if(P.length>1&&(mt-ht<2*Et||yt-ut<2*Et)){const vt=(ht+mt)/2,Ct=(ut+yt)/2;for(let Mt=0;Mt<U;Mt++)if(!st[Mt]){const kt=5*Math.sqrt(Mt),jt=Mt*xt,re=vt+kt*Math.cos(jt),he=Ct+kt*Math.sin(jt);Z[Mt]=re,$[Mt]=he,re<ht&&(ht=re),he<ut&&(ut=he),re>mt&&(mt=re),he>yt&&(yt=he)}}B.updateGroups(),Oi=r((vt=>Z[vt]),"getX"),Bs=r((vt=>$[vt]),"getY"),Zs=r((vt=>G[vt]),"getR"),ds=W(B),vs=X(B,k)}),"initialize");function rt(P,B,k,{maxDisplacement:U}){const{X:Z,Y:$,fx:G,fy:J,pinned:st,layer:lt,layers:dt,surfaces:at,movements:ft}=k;ft.fill(0);let _t=0;const ht=P.length;let ut=1/0,mt=1/0,yt=-1/0,xt=-1/0;const Et=U*U;for(let Mt=0;Mt<ht;Mt++){const kt=P[Mt],jt=G[kt]*=B,re=J[kt]*=B,he=lt[kt];let de=jt,fe=re;const pe=Z[kt],Se=$[kt];if(de*de+fe*fe>Et){const qe=Math.sqrt(de*de+fe*fe)/U;fe/=qe,de/=qe}st[kt]||(Z[kt]+=de,$[kt]+=fe);const Oe=Math.sqrt(de*de+fe*fe);st[kt]||(pe<ut&&(ut=pe),Se<mt&&(mt=Se),pe>ut&&(yt=pe),Se>mt&&(xt=Se),ft[he-1]+=Oe),_t+=he*Oe}const vt=Math.max(yt-ut,0),Ct=Math.max(xt-mt,0);for(let Mt=0;Mt<dt.length;Mt++){const kt=dt[Mt],jt=kt.length;let re=1/0,he=1/0,de=-1/0,fe=-1/0,pe=0;for(let Qe=0;Qe<jt;Qe++){const Is=kt[Qe];if(st[Is])continue;const Je=Z[Is],Ks=$[Is];Je<re&&(re=Je),Ks<he&&(he=Ks),Je>de&&(de=Je),Ks>fe&&(fe=Ks),pe++}const Se=de-re,Oe=fe-he,qe=Math.max(1,Math.sqrt(Se**2+Oe**2));at[Mt]=qe;const He=pe===0?0:ft[Mt]/pe,ns=vt*Ct||1;ft[Mt]=He>pe?He/ns:0}return k.updateGroups(),_t}function nt(P,B,k){tt(P,B,k),gt(k)}function tt(P,B,{sources:k,targets:U,degrees:Z,nodeIds:$,edgeIds:G}){const J={};for(let st=0;st<P.length;st++)J[st]=$[st]=st;for(let st=0;st<B.length;st++){const{source:lt,target:dt}=B[st],at=J[lt],ft=J[dt];G[st]=st,k[st]=at,U[st]=ft,Z[at]++,Z[ft]++}}function gt({nodeIds:P,edgeIds:B,sources:k,targets:U,degrees:Z,layer:$,layers:G,component:J,components:st,cluster:lt,parent:dt}){let at=0,ft=1;const _t=new Uint32Array(P.length);for(let Et=0;Et<P.length;Et++)_t[Et]=Z[Et];const ht=new Array(P.length);for(let Et=0;Et<B.length;Et++){const vt=B[Et],Ct=k[vt],Mt=U[vt];ht[Ct]=ht[Ct]||[],ht[Mt]=ht[Mt]||[],ht[Ct].push(Mt),ht[Mt].push(Ct)}const ut=new Uint8Array(P.length),mt=new Uint8Array(P.length);dt.fill(-1);let yt=0;for(let Et=0;Et<P.length;Et++)if(ut[Et]===0){const vt=[Et];for(;vt.length!==0;){const Ct=vt.pop();if(ut[Ct]===0&&ht[Ct]!==void 0){const Mt=ht[Ct];for(let kt=0;kt<Mt.length;kt++)vt.push(Mt[kt])}ut[Ct]=1,J[Ct]=yt}yt++}const xt=new Array(P.length);for(let Et=0;Et<P.length;Et++)$[Et]=0,xt[Et]=Et;for(;xt.length!==0;){const Et=[],vt=[];for(let Ct=0;Ct<xt.length;Ct++)_t[xt[Ct]]<=at&&(Et.push(Ct),vt.push(xt[Ct]));for(let Ct=0;Ct<vt.length;Ct++){const Mt=vt[Ct];mt[Mt]=at,$[Mt]=ft;const kt=ht[Mt];if(kt)for(let jt=0;jt<kt.length;jt++)_t[kt[jt]]--}for(let Ct=0;Ct<vt.length;Ct++){const Mt=vt[Ct],kt=ht[Mt];if(kt)for(let jt=0;jt<kt.length;jt++){const re=kt[jt],he=$[re];if(he===void 0||he>ft){dt[Mt]=re;break}}}Et.reverse();for(let Ct=0;Ct<Et.length;Ct++)xt.splice(Et[Ct],1);if(ft+=1,xt.length>0){let Ct=1/0;for(let Mt=0;Mt<xt.length;Mt++){const kt=_t[xt[Mt]];kt<Ct&&(Ct=kt)}Ct>=at+1&&(at=Ct,ft=1)}}ut.fill(0);for(let Et=0;Et<P.length;Et++){const vt=P[Et],Ct=$[vt];if(dt[vt]===-1||$[dt[vt]]===Ct){const Mt=[vt];for(ut.fill(0);Mt.length!==0;){const kt=Mt.pop();if(ut[kt])continue;if($[kt]>Ct){dt[vt]=kt;break}const jt=ht[kt];if(ut[kt]=1,jt)for(let re=0;re<jt.length;re++)Mt.push(jt[re])}}}for(let Et=0;Et<P.length;Et++){const vt=P[Et],Ct=J[vt];st[Ct]=st[Ct]||[],st[Ct].push(vt);const Mt=$[vt]-1;G[Mt]=G[Mt]||[],G[Mt].push(vt),lt[vt]=dt[vt]}}H.initialize=Q,r(rt,"velocityVerlet"),r(nt,"topology"),r(tt,"initTopology"),r(gt,"decomposition");var St=class{constructor(P,B=!0,k){this.bucketSize=0,this.cells=[];const U=P.nodes.length,Z=P.edges.length;if(u(U+Z),this.X=new Array(U),this.Y=new Array(U),this.R=new Array(U),this.fx=new Float32Array(U),this.fy=new Float32Array(U),this.vx=new Float32Array(U),this.vy=new Float32Array(U),this.pinned=new Uint8Array(U),this.masses=new Float32Array(U),this.weights=new Float32Array(Z),this.lengths=new Float32Array(Z),this.sources=new Uint32Array(Z),this.targets=new Uint32Array(Z),this.degrees=new Uint32Array(U),this.layer=new Uint32Array(U),this.parent=new Int32Array(U),this.cluster=new Int32Array(U),this.component=new Uint32Array(U),this.components=[],this.layers=[],this.nodeIds=new Array(U),this.edgeIds=new Array(Z),this.groups=k&&k.groups||[],this.maxR=new Float32Array(Math.max(this.groups.length,1)),this.cellSize=0,this.cells=[],this.hasGroups=this.groups.length>0,this.hasGroups){this.nodeToGroup=new Int32Array(U);for(let $=0;$<this.groups.length;$++){const G=this.groups[$];this.cells[$]={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,ox:0,oy:0,cx:0,cy:0},this.maxR[$]=0;for(let J=0;J<G.length;J++){const st=G[J];this.nodeToGroup[st]=$,this.maxR[$]=Math.max(this.maxR[$],P.nodes[st].r)}}}B&&nt(P.nodes,P.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)}updateGroups(){if(!this.hasGroups)return void(this.cellSize=1/0);const P=this.X,B=this.Y,k=this.groups,U=this.cells,Z=this.maxR;let $=0;k.forEach(((lt,dt)=>{const at=U[dt];at.minX=1/0,at.minY=1/0,at.maxX=-1/0,at.maxY=-1/0,lt.forEach((ut=>{const mt=P[ut],yt=B[ut];at.minX=Math.min(mt,at.minX),at.minY=Math.min(yt,at.minY),at.maxX=Math.max(mt,at.maxX),at.maxY=Math.max(yt,at.maxY)}));const ft=Z[dt];at.minX-=ft,at.minY-=ft,at.maxX+=ft,at.maxY+=ft;const _t=Math.abs(at.maxX-at.minX),ht=Math.abs(at.maxY-at.minY);$=Math.max($,_t,ht),at.cx=(at.maxX+at.minX)/2,at.cy=(at.maxY+at.minY)/2})),$=Math.ceil(2*$+1),this.cellSize=$;const G=Math.ceil(Math.sqrt(k.length)),J=G*$/2,st=$/2;for(let lt=0;lt<k.length;lt++){const dt=k[lt],at=lt%G,ft=Math.floor(lt/G),_t=U[lt],ht=(at+.5)*$-J,ut=(ft+.5)*$-J,mt=ht-_t.cx,yt=ut-_t.cy;_t.cx=ht,_t.cy=ut,_t.minX=ht-st,_t.minY=ut-st,_t.maxX=ht+st,_t.maxY=ut+st;for(const xt of dt)P[xt]+=mt,B[xt]+=yt}}};function zt(P,B){return P<B?P*B+Math.pow(B-P-1,2)/4:P*B+Math.pow(P-B-1,2)/4}function Bt(P,B){return(P+B)*(P+B+1)/2+B}function wt({edgeIds:P,sources:B,targets:k,pinned:U,degrees:Z,X:$,Y:G,R:J},st=0,lt=.5){const dt={},at={};for(const ft of P){const _t=B[ft],ht=k[ft];_t!==ht&&(dt[_t]=dt[_t]||{},dt[ht]=dt[ht]||{},dt[_t][ht]=!0,dt[ht][_t]=!0)}Object.keys(dt).forEach((ft=>{const _t=Number(ft),ht=Object.keys(dt[Number(_t)]);if(ht.length===2){const[ut,mt]=ht,yt=zt(Number(ut),Number(mt));yt in at||(at[yt]=[Number(mt),Number(ut)]),U[_t]||at[yt].push(_t)}})),Object.keys(at).forEach((ft=>{const[_t,ht,...ut]=at[Number(ft)];if(ut.length<3)return;const mt=$[_t],yt=G[_t],xt=$[ht],Et=G[ht],vt=Z[_t],Ct=.25+.5*vt/(vt+Z[ht]);let Mt=mt+(xt-mt)*Ct,kt=yt+(Et-yt)*Ct,jt=-(Et-yt),re=xt-mt;const he=Math.sqrt(Math.pow(mt-xt,2)+Math.pow(yt-Et,2));jt=-2*jt/he,re=-2*re/he;const de=Math.acos(jt/Math.sqrt(jt*jt+re*re));st>0&&(de<st||de>Math.PI-st&&de<=Math.PI?(jt=2*Math.cos(Math.PI-st),re=2*Math.sin(Math.PI-st)):(de>2*Math.PI-st||de>=Math.PI&&de<Math.PI+st)&&(jt=2*Math.cos(st),re=2*Math.sin(st)));let fe=0,pe=1;ut.sort(((ns,Qe)=>J[Qe]-J[ns]));let Se=0,Oe=0;const qe=Math.max(J[ut[0]],J[ut[1]])/2;ut.length%2==1&&(fe=1,Mt-=jt*qe,kt-=re*qe);const He=1+lt;for(let ns=0;ns<ut.length;ns++){const Qe=(fe+ns)%2,Is=ut[ns],Je=ns>=2?J[Is]:qe,Ks=(Qe?Se:Oe)+Je;$[Is]=Mt+jt*pe*Ks,G[Is]=kt+re*pe*Ks,Qe?Se+=Je*He:Oe+=Je*He,pe=-pe}}))}function Ft(P){let B=0,k=0;for(const G of P)B+=G.w*G.h,k=Math.max(k,G.w);P.sort(((G,J)=>J.h-G.h));const U=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(B/.95)),k),h:1/0}];let Z=0,$=0;for(const G of P)for(let J=U.length-1;J>=0;J--){const st=U[J];if(!(G.w>st.w||G.h>st.h)){if(G.x=st.x,G.y=st.y,$=Math.max($,G.y+G.h),Z=Math.max(Z,G.x+G.w),G.w===st.w&&G.h===st.h){const lt=U.pop();J<U.length&&(U[J]=lt)}else G.h===st.h?(st.x+=G.w,st.w-=G.w):G.w===st.w?(st.y+=G.h,st.h-=G.h):(U.push({x:st.x+G.w,y:st.y,w:st.w-G.w,h:G.h}),st.y+=G.h,st.h-=G.h);break}}}function Vt(P,B=1){return Ft(P.map((k=>(k.w+=k.maxr+B,k.h+=k.maxr+B,k))).sort(((k,U)=>k.w*k.h-U.w*U.h)))}r(St,"LayoutData"),r(zt,"unorderedPair"),r(Bt,"orderedPair"),r(wt,"alignSiblings"),r(Ft,"potpack"),r(Vt,"boxpack");var ie=class{constructor(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}add(P,B,k,U){this.ids.push(P),B-U<this.xmin&&(this.xmin=B-U),k-U<this.ymin&&(this.ymin=k-U),B+U>this.xmax&&(this.xmax=B+U),k+U>this.ymax&&(this.ymax=k+U),U>this.maxr&&(this.maxr=U),this.mx+=U*B,this.my+=U*k,this.m+=U}measure(P=0){return this.w=this.xmax-this.xmin+2*P,this.h=this.ymax-this.ymin+2*P,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this}};function Yt(P,B=20,k,U,Z){for(const ht of P){const{x:ut,y:mt,r:yt}=Dt(ht.ids,(xt=>k[xt]),(xt=>U[xt]),(xt=>Z[xt]));ht.cx=ut,ht.cy=mt,ht.radius=yt+B}const $=P.slice().sort(((ht,ut)=>ht.radius-ut.radius)),G=$.map((ht=>({x:ht.cx,y:ht.cy,r:ht.radius}))),J=$.pop();let st=3*Math.PI/2,lt=J.radius;const dt=2*Math.PI,{cx:at,cy:ft}=J,_t=[J];for(;$.length!==0;){const ht=$[$.length-1],ut=lt+ht.radius,mt=at+Math.cos(st)*ut,yt=ft+Math.sin(st)*ut;_t.some((xt=>{const Et=xt.cx-mt,vt=xt.cy-yt;return Math.sqrt(Et*Et+vt*vt)<xt.radius+ht.radius}))?lt+=1:(ht.x=mt-ht.w/2,ht.y=yt-ht.h/2,ht.cx=mt,ht.cy=yt,G[$.length-1].x=mt,G[$.length-1].y=yt,_t.push($.pop()),st+=(2*ht.radius+1)/ut*1%dt)}}function oe(P,B,k,U){let Z=0;const $=[];for(const G of U){const J=new ie;for(const st of G)J.add(st,P[st],B[st],k[st]);$.push(J.measure()),G.length>$[Z].ids.length&&(Z=$.length-1)}return{boxes:$,biggest:Z}}function Qt(P,B,{X:k,Y:U,R:Z,components:$,pinned:G,degrees:J,sources:st,targets:lt,edgeIds:dt},{update:at,onUpdate:ft,placement:_t,placementOffset:ht,alignSiblings:ut,siblingsMinAngle:mt,siblingsOffset:yt}){if(ut&&(wt({X:k,Y:U,R:Z,degrees:J,pinned:G,sources:st,targets:lt,edgeIds:dt},mt,yt),at(P,k,U)),_t){const{boxes:xt,biggest:Et}=oe(k,U,Z,$);if(_t==="spiral")Yt(xt,ht,k,U,Z);else{if(_t!=="box")return;Vt(xt,ht)}const vt=xt[Et].xmin-xt[Et].x,Ct=xt[Et].ymin-xt[Et].y;for(const Mt of xt){const{xmin:kt,ymin:jt,x:re,y:he,ids:de}=Mt,fe=kt-re-vt,pe=jt-he-Ct;for(const Se of de)k[Se]-=fe,U[Se]-=pe}at(P,k,U),ft()}}function $t(P,B,{X:k,Y:U,R:Z,degrees:$,nodeIds:G,edgeIds:J,layers:st,layer:lt,cluster:dt,masses:at,weights:ft,sources:_t,targets:ht},{cx:ut,cy:mt,nextTick:yt,cancelTick:xt,update:Et,onUpdate:vt,batch:Ct,maxIterations:Mt,steps:kt,minMovement:jt},re,he){const de=st.slice();Ct=Ct??1;let fe,pe=0;function Se(){xt(fe),Et(P,k,U),vt(),he(pe)}r(Se,"stop");const Oe={};for(let hs=0;hs<B.length;hs++)Oe[Number(B[hs].id)||hs]=hs;const qe=new Map;for(let hs=0;hs<J.length;hs++){const ai=J[hs];qe.set(Bt(_t[ai],ht[ai]),ai)}for(let hs=0;hs<st.length;hs++){const ai=st[hs],Bi=hs;for(let Qs=0;Qs<ai.length;Qs++){const ts=ai[Qs],We=dt[ts];We!==-1&&(at[We]+=at[ts])}for(let Qs=0;Qs<B.length;Qs++){const ts=B[Qs],We=Number(ts.id)||Qs,li=ts.source,fn=ts.target,fa=ft[Oe[We]];if(lt[li]===Bi&&lt[fn]===Bi){const Rg=dt[li],Fg=dt[fn];if(Rg!==Fg){const Pg=qe.get(Bt(Rg,Fg));Pg!==void 0&&(ft[Pg]+=fa)}}}}G.length=0,J.length=0;let He=1;const ns=1-Math.pow(.1,1/kt/2),Qe=(He-.1)/kt;let Is,Je,Ks=.5;function Gd(){He+=(0-He)*ns;const hs=re(He,G,J);let ai=He<=Ks||hs<jt;if(pe===0||ai){const Bi=de.pop();if(Bi){Is&&(Je=Is.reduce(((ts,We)=>Math.max(ts,ut-k[We],mt-U[We])),0)),G.push.apply(G,Bi);for(let ts=0;ts<Bi.length;ts++){const We=Bi[ts],li=dt[We];if(li!==-1){const fn=$[We]>1?2:1,fa=Z[li]+Z[We];at[li]-=at[We],k[We]=k[li]+fn*fa*(2*h()-1),U[We]=U[li]+fn*fa*(2*h()-1)}else Is&&(k[We]=ut+2*Je*(1-2*h()),U[We]=mt+2*Je*(1-2*h()))}Is=Bi;const Qs=G.reduce(((ts,We)=>(ts[We]=!0,ts)),{});J.length=0;for(let ts=0;ts<B.length;ts++){const{source:We,target:li,id:fn}=B[ts];Qs[We]&&Qs[li]&&J.push(Oe[Number(fn)])}ai=!1,de.length===0?(He=.2,Ks=.1):(He=.1+2*Qe,Ks=.1)}}pe%Ct==0&&(Et(P,k,U),vt()),++pe>=1/0||ai?Se():fe=yt(Gd)}return r(Gd,"simulationStep"),{done:!1,start(){return fe=setTimeout(Gd),this},stop(){return Se(),this},get iterations(){return pe}}}r(ie,"Component"),r(Yt,"spiralpack"),r(oe,"groupAndMeasure"),r(Qt,"postprocessing"),r($t,"multiLevel");var Jt,ce=class{constructor(P){this.promise=new Promise(P)}then(P){return this.promise.then(P)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function be(P,B,{X:k,Y:U,nodeIds:Z,edgeIds:$,layers:G,movements:J,movementsPrev:st,surfaces:lt,surfacesPrev:dt},at,ft,_t){const{nextTick:ht,cancelTick:ut,steps:mt,minMovement:yt,update:xt,onUpdate:Et,autoStop:vt}=at,Ct=at.batch??1;let Mt=0,kt=1,jt,re=1-Math.pow(.05,1/mt),he=!1;const de=r((()=>{he=!0,ut(jt),Et(),_t(Mt)}),"stop");let fe=!1;const pe=r((()=>{kt+=(.001-kt)*re;const Se=ft(kt,Z,$),Oe=G.length;let qe=!1,He=!1;if(vt){qe=He=!0;const{movementRatio:Qe,surfaceRatio:Is}=vt;for(let Je=0;Je<Oe;Je++)qe&&Math.abs(1-lt[Je]/dt[Je])>Is&&(qe=!1),He&&Math.abs(J[Je]-st[Je])>Qe&&(He=!1)}qe&&He&&!fe&&(re=1-Math.pow(.001,1/Math.max(10,Mt)),fe=!0);const ns=he||kt<.05||Se!==0&&Se<=yt;if(Mt%Ct==0&&(xt(P,k,U),Et()),++Mt>=mt||ns)return de();for(let Qe=0;Qe<Oe;Qe++)st[Qe]=J[Qe],dt[Qe]=lt[Qe];jt=ht(pe)}),"simulationStep");return{done:!1,start(){return jt=setTimeout(pe),this},stop(){return de(),this},get iterations(){return Mt}}}function Ie(P,B={}){let k,U;const Z=r(((ft={nodes:[],edges:[]})=>(k=ft.nodes,U=ft.edges,u(Bt(k.length,U.length)),new St(ft,!0,B))),"setGraph"),$=r(((ft={})=>new z(ft)),"setOptions");let G=Z(P),J=$(B);m(U,G),Q(k,G,J),le(k,G,J),p(k,G,J);const st=rt;let lt=null;const dt=r(((ft,_t,ht)=>(lt&&(lt.destroy(),lt=null),_t.length<=1?0:(J.barnesHutOptimization?lt=H(ft,_t,lt,G):ge(ft,_t,G,J),g(ft,ht,G,J),lt&&J.elasticity!==0&&ue(0,_t,lt,G,J),f(ft,_t,G,J),st(_t,J.inertia,G,J)))),"step");let at;return{setOptions:(ft={})=>(J=$(ft),this),setGraph:({nodes:ft,edges:_t})=>(G=Z(P),m(_t,G),Q(ft,G,J),le(ft,G,J),p(ft,G,J),this),start(){return at=(J.multilevel?$t:be)(k,U,G,J,dt,(ft=>{at.done||Qt(k,0,G,J),J.onEnd(ft);const _t=B.groups;if(_t)for(let ht=0;ht<_t.length;ht++){const ut=_t[ht],mt=ut.reduce(((yt,xt)=>(yt.x+=G.X[xt],yt.y+=G.Y[xt],yt)),{x:0,y:0});mt.x/=ut.length,mt.y/=ut.length,B.cx&&(mt.x-=B.cx),B.cy&&(mt.y-=B.cy);for(let yt=0;yt<ut.length;yt++)G.X[ut[yt]]-=mt.x,G.Y[ut[yt]]-=mt.y}at.done=!0})).start(),this},iterations:()=>at.iterations,data:()=>G,stop(){return at&&at.stop(),this},step(ft=1){return dt(ft,G.nodeIds,G.edgeIds),J.update(k,G.X,G.Y),this}}}return r(ce,"SimulationPromise"),r(be,"singleLevel"),r(Ie,"force"),Ie.run=(P,B)=>{let k;const U=new ce((Z=>{B.onEnd=Z,k=Ie(P,B).start()}));return U.simulation=k,U.stop=()=>(k.stop(),U),U},Jt=o,((P,B,k,U)=>{if(B&&typeof B=="object"||typeof B=="function")for(let Z of i(B))n.call(P,Z)||Z===k||e(P,Z,{get:()=>B[Z],enumerable:!(U=s(B,Z))||U.enumerable});return P})(e({},"__esModule",{value:!0}),Jt)})();return t.force.apply(this,arguments)}Ot(p_,"SimulationPromise"),Ot(Cl,"gpuLayout"),Cl.run=(t,e,s)=>{let i;const n=new p_((r=>{s.onEnd=r,i=Cl(t,e,s).start()}));return n.simulation=i,n.stop=()=>(i.stop(),n),n};var kk=2,Ok=1.25,y_=t=>{},x_={name:"force",imports:{force:__},configure(t,{graph:e,events:s}){const i=t.nodes._indexes,n=t.xs?t.xs:e.getNodeAttribute("x").getMultiple(i),r=t.ys?t.ys:e.getNodeAttribute("y").getMultiple(i),o=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(i),a=e.getNodeAttribute("layoutable").getMultiple(i),l=t.edges,d=[],h=[],u={},c=t.edgeWeight||y_,g=t.nodeMass?p=>t.nodeMass(t.nodes.get(p)):y_;t.edgeStrength===void 0&&(t.edgeStrength=.5),t.gpu&&(t.edgeStrength/=kk),t.gravity==null&&(t.gravity=.01),t.siblingsOffset==null&&(t.siblingsOffset=0),t.theta==null&&(t.theta=.62),t.autoStop=!!t.autoStop,t.alignSiblings=!!t.alignSiblings;const m=t.radiusRatio||Ok;for(let p=0;p<t.nodes._indexes.length;p++){const _=t.nodes._indexes[p];u[_]=p,d.push({id:p,x:n[p],y:r[p],r:o[p]*m,mass:g(p),pinned:!a[p]})}l.forEach((p=>{const _=u[p.getSource()._index],x=u[p.getTarget()._index];_!==x&&_!==void 0&&x!==void 0&&h.push({source:_,target:x,weight:c(p)})}));const f=cd({...t});return delete f.nodes,delete f.edges,{graph:{nodes:d,edges:h},options:f,indexes:t.nodes._indexes,done:!1,x:n,y:r,chunkPeriod:250}},update:function(t,e){if(!e.simulation&&t){let s;e.done=!1,e.graph=t.graph,e.options=t.options,e.indexes=t.indexes;let i=!1;if(t.options.gpu){const l=z0("webgl2",{},(()=>{tn("GPU layout: WebGL context not available. Falling back on CPU."),e.simulation=void 0,e.options.gpu=!1,e.cleanUp&&e.cleanUp(),this._update(t,e)}));l&&(s=l.context,e.cleanUp=l.cleanUp),i=!!s}let n=Date.now();i||(t.options.nextTick=l=>Date.now()-n<=e.chunkPeriod?l():(n=Date.now(),setTimeout(l,0))),t.options.update=(l,d,h)=>{e.x=d,e.y=h},t.options.onEnd=()=>{if(i&&s){const{X:l,Y:d}=e.simulation.data(!0);e.x=l,e.y=d}e.done=!0,e.simulation=void 0,e.cleanUp&&e.cleanUp()},t.options.bucketSize=0;const r=i&&s?Cl(t.graph,s,t.options).start():__(t.graph,t.options).start();e.simulation=r;const{X:o,Y:a}=i&&s?{X:new Float32Array(t.graph.nodes.length),Y:new Float32Array(t.graph.nodes.length)}:r.data();e.x=o,e.y=a}return{graph:e.graph,indexes:e.indexes,x:e.x,y:e.y}},context:function(){return{done:!1,graph:{nodes:[],edges:[]},x:null,y:null,indexes:null,chunkPeriod:250}},stop:function(t){t.done=!0,t.simulation&&(t.simulation.stop(),delete t.simulation)},isRunning:function(t){return!t.done||(t.done=!1,!1)},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}};function Bk(t,e,s,i,n){return{x:t+n*(s-t),y:e+n*(i-e)}}var Uk=10;function Gk(t,e,s){let i,n,r=1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o],d=e[(o+1)%a],h=og(t[0],t[1],l[0],l[1],d[0],d[1]);h<r&&(r=h,i=l,n=d)}return Vk(t[0],t[1],i[0],i[1],n[0],n[1],s)}function Vk(t,e,s,i,n,r,o){const a=W0(t,e,s,i,n,r);let l=-(i-r),d=s-n;const h=Math.sqrt(l*l+d*d);return l/=h,d/=h,[a.x-o*l,a.y-o*d]}function qk(t,e,s,i){for(let n=0;n<t.length;n++){const[r,o]=t[n],a=Math.abs(r-e),l=Math.abs(o-s);if(a+l<=i||!(a>i||l>i)&&a*a+l*l<=i*i)return!0}return!1}function Hk(t,e,s){const i=Y0(s.cx,s.cy,t,e,s.minX,s.minY,s.maxX,s.maxY);let n,r=1/0,o={x:s.maxX,y:e};for(const a of i)n=Ze(t,e,a.x,a.y),n<r&&(r=n,o=a);return o}function jk(t){const e=t.bottomLeft(),s=t.topRight();return[[e.x,e.y],[e.x,s.y],[s.x,s.y],[s.x,e.y]]}function Yk(t,e,s,i){const n=[],r=[],o=[];return t.forEach(((a,l)=>{i[l]&&(n.push(a),r.push(e[l]),o.push(s[l]))})),{ids:n,subgraphPositions:r,radii:o}}function Xk(t,e,s){const{duration:i=0,margin:n=5,referenceNodes:r,nodes:o}=e,{ids:a,subgraphPositions:l,radii:d}=Yk(o.getId(),s,o.getAttribute("radius"),o.getAttribute("layoutable")),h=t.getNodes(a);let u=r;!u||u instanceof Pi||(u=t.getNodes(u));const c=u||h.inverse(),g=c.getPosition().map((w=>[w.x,w.y])),m=h.getBoundingBox(),f=c.getBoundingBox();f.pad(f.maxScaledSize);const p={layoutName:"incremental",ids:h.getId(),positions:{before:l,current:l}};if(!h.size)return Promise.resolve(p);const _=ra(l.map((w=>w.x)),l.map((w=>w.y)),d),[x,y]=_,b=_[2]+f.maxScaledSize+n;let v,A=0,S=0;if(qk(g,x,y,b))if(c.size<=3){if(Uc(x,y,_[2],f.minX,f.minY,f.maxX,f.maxY)){const w=Hk(x,y,f);v=Ze(f.cx,f.cy,w.x,w.y);const I=Bk(f.cx,f.cy,w.x,w.y,(v+b)/v);A=I.x-x,S=I.y-y}}else{const w=Dc.from(g,(q=>q[0]),(q=>q[1])),I=No(w.triangles,g),M=g.length>3?No(w.hull,g):jk(f),N=Ox(c.getPosition(),Uk,b,I,M);let D=Gk([x,y],M,b);if(N.length>0){let q=Math.pow(x-D[0],2)+Math.pow(y-D[1],2);for(const et of N)A=x-et[0],S=y-et[1],v=A*A+S*S,v<q&&(q=v,D=et.slice(0,2));A=D[0]-x,S=D[1]-y}else A=D[0]-m.cx,S=D[1]-m.cy}if(A||S){const w=l.map((I=>(I.x+=A,I.y+=S,I)));if(e.locate){typeof e.locate=="boolean"&&(e.locate={});const I=t.modules.locate.layoutDataBoundingBox({x:[...g.map((N=>N[0])),...w.map((N=>N.x))],y:[...g.map((N=>N[1])),...w.map((N=>N.y))],indexes:t.getNodes()._indexes}),M=t.modules.locate.computeConfigForBounds(I,e.locate);t.modules.camera.setView(M,{duration:i,easing:e.locate.easing,ignoreZoomLimits:!0})}return p.positions.current=w,h.setAttributes(w,i).then((()=>p))}return h.setAttributes(l,i).then((()=>p))}function Wk(t,e,s){const i=ke(e);return i.duration=0,i.dryRun=!0,i.locate=!1,delete i.incremental,s(i).then((n=>Xk(t,e,n.positions.current)))}function $k(t,e,s){const{nodes:i,duration:n,centralNode:r}=e,o=i,a=o.reduce(((d,h)=>(d[h._index]=!0,d)),{}),l=t.getNodes();if(e.focusOnGroupShape)return s({nodes:o,duration:0}).then((()=>{const d=o.concat(r),h=d.getAttribute("layoutable");return d.setAttributes({layoutable:!1}),s({nodes:t.getNodes(),duration:n}).then((()=>d.setAttributes(h)))}));{const d=ke(e);return delete d.centralNode,d.incremental=!1,d.nodes=l,d.nodeMass=(h,u)=>(u+1)*(a[h._index]?1:2),s(d)}}function WE(t,e,s){const i=hE(e.modules.graph,t);if(typeof i.incremental!="boolean"&&"margin"in i.incremental&&!isFinite(i.incremental.margin))throw new Error("Incremental layout: margin has to be a positive number");const n=ke(i);return typeof i.incremental!="boolean"&&(n.margin=i.incremental.margin,n.referenceNodes=i.incremental.referenceNodes),n.centralNode&&!n.centralNode.getAttribute("layoutable")?$k(e,n,s):Wk(e,n,s)}var Zk=t=>(t.modules.layouts.register(x_),(e={})=>{if(e.incremental)return WE(e,t,t.layouts.force);if(e.edgeStrength!==void 0&&(!isFinite(e.edgeStrength)||e.edgeStrength<0))throw new Error("force layout: edgeStrength must be a positive number");if(e.steps!==void 0&&(!isFinite(e.steps)||e.steps<=0))throw new Error("force layout: 'steps' must be a positive integer");if(e.edgeLength!==void 0&&(!isFinite(e.edgeLength)||e.edgeLength<=0))throw new Error("force layout: 'edgeLength' must be positive");if(e.gravity!==void 0&&(!isFinite(e.gravity)||e.gravity<0||e.gravity>=1))throw new Error("force layout: 'gravity' must be between 0 and 1");if(e.charge!==void 0&&!isFinite(e.charge))throw new Error("force layout: 'charge' must be a number");if(e.radiusRatio!==void 0&&(!isFinite(e.radiusRatio)||e.radiusRatio<0))throw new Error("force layout: 'radiusRatio' must be a positive number");if(e.theta!==void 0&&(!isFinite(e.theta)||e.theta<0||e.theta>1))throw new Error("force layout: 'theta' must be between 0 and 1");if(!(e.cx===void 0&&e.cy===void 0||typeof e.cx=="number"&&typeof e.cy=="number"))throw new Error("force layout: both 'cx' and 'cy' must be numbers");if(e.siblingsOffset!==void 0&&!isFinite(e.siblingsOffset))throw new Error("force layout: 'siblingsOffset' must be a number");return e.gpu=!!e.gpu,e.gpu&&(e.useWebWorker=!1),t.modules.layouts.start(x_.name,e)}),b_={name:"forceLink",configure:function(t,{graph:e,camera:s,graphics:i}){const n=t.nodes._indexes,r=t.edges._indexes,o={},a={},l=n.length,d=r.length;let h;var u=e.getObjectList(!0),c=e.getObjectList(!1);(t.nodes||t.edges)&&(delete(t=ke(t)).nodes,delete t.edges);const g=e.getNodeAttribute("innerStroke.width").getMultiple(n),m=e.getNodeAttribute("outerStroke.width").getMultiple(n),f=e.degrees(n),p=t.xs?t.xs:e.getNodeAttribute("x").getMultiple(n),_=t.ys?t.ys:e.getNodeAttribute("y").getMultiple(n),x=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(n),y=e.nodeList(n).getAttribute("layoutable"),b=typeof t.nodeMass=="function"?t.nodeMass:function(O,K,j){return K+1};delete t.nodeMass;const v=typeof t.edgeWeight=="function"?t.edgeWeight:function(O){return 1};delete t.edgeWeight,isFinite(t.scalingRatio)||delete t.scalingRatio;const A=n.reduce(((O,K,j)=>(y[j]||(O[K]=!0),O)),{});let S=0,w=0,I=0;const M=s.getZoom();for(h=0;h<n.length;++h){const O=n[h],K=p[h],j=_[h],ot=x[h]+(g[h]+m[h])/M;o[O]={id:O,x:K,y:j,degree:f[h],size:ot,pinned:!!A[O],mass:b(u.get(O),f[h],h)},I=Math.max(ot,I)}if(l>1)for(h=0;h<l;h++){const O=o[n[h]];S+=O.x,w+=O.y}S/=l,w/=l;const N={x:S,y:w},D=e.edgeList(r),q=D.getSource()._indexes,et=D.getTarget()._indexes;for(h=0;h<d;h++){const O=r[h],K=q[h],j=et[h];o[K]&&o[j]&&(a[O]={source:K,target:j},a[O].weight=v(c.get(O)))}return{nodes:o,edges:a,maxSize:I,config:cd(t),barycentre:N}},context:function(){return{chunkPeriod:250}},update:function(t,e){let s;!e.W&&t?(s={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:!0,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!0,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}},e.W=s,(function(d,h){const u=(function(g,m){let f,p,_,x=g.nodes,y=g.edges,b=g.maxSize,v=Object.keys(g.nodes),A=Object.keys(g.edges),S=v.length*s.ppn,w=A.length*s.ppe,I={};const M=Math.pow(10,Math.log(Math.max(b,1))-6),N=M/2,D=Math.random,q=m.randomizeFactor||1;let et;et=m.randomize==="locally"?j=>j+D()*q:m.randomize==="globally"?j=>D()*q:j=>j+D()*M-N;const O=new Float32Array(S),K=new Float32Array(w);for(f=p=0,_=v.length;f<_;f++){const j=v[f],ot=x[j];let it=ot.x,ct=ot.y;ot.pinned||(it=et(it),ct=et(ct)),I[j]=p,O[p]=it,O[p+1]=ct,O[p+2]=0,O[p+3]=0,O[p+4]=0,O[p+5]=0,O[p+6]=ot.mass,O[p+7]=1,O[p+8]=ot.size,O[p+9]=ot.pinned||0,p+=s.ppn}for(f=p=0,_=A.length;f<_;f++){const j=y[A[f]];K[p]=I[j.source],K[p+1]=I[j.target],K[p+2]=j.weight||0,p+=s.ppe}return{nodes:O,edges:K}})(d,h);e.NodeMatrix=u.nodes,e.EdgeMatrix=u.edges,s.nodesLength=e.NodeMatrix.length,s.edgesLength=e.EdgeMatrix.length})(t,t.config),s.settings=(function(d,h){for(const u in d)h[u]=d[u];return h})(t.config,s.settings),e.nodes=t.nodes,e.edges=t.edges,e.barycentre=t.barycentre):s=e.W;let i,n=e.NodeMatrix,r=e.EdgeMatrix;function o(){let l,d,h,u,c,g,m,f,p,_,x,y,b,v,A,S,w;for(h=0;h<s.nodesLength;h+=s.ppn)n[h+4]=n[h+2],n[h+5]=n[h+3],n[h+2]=0,n[h+3]=0;if(s.settings.outboundAttractionDistribution){for(p=0,h=0;h<s.nodesLength;h+=s.ppn)p+=n[h+6];p/=s.nodesLength}if(s.settings.barnesHutOptimize){let et,O,K,j,ot=1/0,it=-1/0,ct=1/0,pt=-1/0;for(i=[],h=0;h<s.nodesLength;h+=s.ppn)ot=Math.min(ot,n[h+0]),it=Math.max(it,n[h+0]),ct=Math.min(ct,n[h+1]),pt=Math.max(pt,n[h+1]);const Pt=it-ot,At=pt-ct;for(Pt>At?(ct-=(Pt-At)/2,pt=ct+Pt):(ot-=(At-Pt)/2,it=ot+At),i[0]=-1,i[1]=(ot+it)/2,i[2]=(ct+pt)/2,i[3]=Math.max(it-ot,pt-ct),i[4]=-1,i[5]=-1,i[6]=0,i[7]=0,i[8]=0,l=1,h=0;h<s.nodesLength;h+=s.ppn)for(d=0,K=s.MAX_SUBDIVISION_RETRIES;;){if(!(i[d+5]>=0)){if(i[d+0]<0){i[d+0]=h;break}if(i[d+5]=l*s.ppr,m=i[d+3]/2,f=i[d+5],i[f+0]=-1,i[f+1]=i[d+1]-m,i[f+2]=i[d+2]-m,i[f+3]=m,i[f+4]=f+s.ppr,i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,f+=s.ppr,i[f+0]=-1,i[f+1]=i[d+1]-m,i[f+2]=i[d+2]+m,i[f+3]=m,i[f+4]=f+s.ppr,i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,f+=s.ppr,i[f+0]=-1,i[f+1]=i[d+1]+m,i[f+2]=i[d+2]-m,i[f+3]=m,i[f+4]=f+s.ppr,i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,f+=s.ppr,i[f+0]=-1,i[f+1]=i[d+1]+m,i[f+2]=i[d+2]+m,i[f+3]=m,i[f+4]=i[d+4],i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,l+=4,j=d+0,et=n[i[j]+0]<i[d+1]?n[i[j]+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[i[j]+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,i[d+6]=n[i[j]+6],i[d+7]=n[i[j]+0],i[d+8]=n[i[j]+1],i[et+0]=i[d+0],i[d+0]=-1,O=n[h+0]<i[d+1]?n[h+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[h+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,et===O){if(K--){d=et;continue}K=s.MAX_SUBDIVISION_RETRIES;break}i[O+0]=h;break}et=n[h+0]<i[d+1]?n[h+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[h+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,i[d+7]=(i[d+7]*i[d+6]+n[h+0]*n[h+6])/(i[d+6]+n[h+6]),i[d+8]=(i[d+8]*i[d+6]+n[h+1]*n[h+6])/(i[d+6]+n[h+6]),i[d+6]+=n[h+6],d=et}}if(s.settings.barnesHutOptimize)for(_=s.settings.scalingRatio,h=0;h<s.nodesLength;h+=s.ppn)for(d=0;;)if(i[d+5]>=0){if(S=Math.sqrt((n[h+0]-i[d+7])*(n[h+0]-i[d+7])+(n[h+1]-i[d+8])*(n[h+1]-i[d+8])),2*i[d+3]/S<s.settings.barnesHutTheta){if(x=n[h+0]-i[d+7],y=n[h+1]-i[d+8],s.settings.adjustSizes?S>0?(w=_*n[h+6]*i[d+6]/S/S,n[h+2]+=x*w,n[h+3]+=y*w):S<0&&(w=-_*n[h+6]*i[d+6]/S,n[h+2]+=x*w,n[h+3]+=y*w):S>0&&(w=_*n[h+6]*i[d+6]/S/S,n[h+2]+=x*w,n[h+3]+=y*w),i[d+4]<0)break;d=i[d+4];continue}d=i[d+5]}else{if(i[d+0]>=0&&i[d+0]!==h&&(x=n[h+0]-n[i[d+0]+0],y=n[h+1]-n[i[d+0]+1],S=Math.sqrt(x*x+y*y),s.settings.adjustSizes?S>0?(w=_*n[h+6]*n[i[d+0]+6]/S/S,n[h+2]+=x*w,n[h+3]+=y*w):S<0&&(w=-_*n[h+6]*n[i[d+0]+6]/S,n[h+2]+=x*w,n[h+3]+=y*w):S>0&&(w=_*n[h+6]*n[i[d+0]+6]/S/S,n[h+2]+=x*w,n[h+3]+=y*w)),i[d+4]<0)break;d=i[d+4]}else for(_=s.settings.scalingRatio,u=0;u<s.nodesLength;u+=s.ppn)for(c=0;c<u;c+=s.ppn)x=n[u+0]-n[c+0],y=n[u+1]-n[c+1],s.settings.adjustSizes?(S=Math.sqrt(x*x+y*y)-n[u+8]-n[c+8],S>0?(w=_*n[u+6]*n[c+6]/S/S,n[u+2]+=x*w,n[u+3]+=y*w,n[c+2]+=x*w,n[c+3]+=y*w):S<0&&(w=100*_*n[u+6]*n[c+6],n[u+2]+=x*w,n[u+3]+=y*w,n[c+2]-=x*w,n[c+3]-=y*w)):(S=Math.sqrt(x*x+y*y),S>0&&(w=_*n[u+6]*n[c+6]/S/S,n[u+2]+=x*w,n[u+3]+=y*w,n[c+2]-=x*w,n[c+3]-=y*w));for(f=s.settings.gravity/s.settings.scalingRatio,_=s.settings.scalingRatio,h=0;h<s.nodesLength;h+=s.ppn)w=0,x=n[h+0],y=n[h+1],S=Math.sqrt(x*x+y*y),s.settings.strongGravityMode?S>0&&(w=_*n[h+6]*f):S>0&&(w=_*n[h+6]*f/S),n[h+2]-=x*w,n[h+3]-=y*w;for(_=1*(s.settings.outboundAttractionDistribution?p:1),g=0;g<s.edgesLength;g+=s.ppe)u=r[g+0],c=r[g+1],m=r[g+2],A=Math.pow(m,s.settings.edgeWeightInfluence),x=n[u+0]-n[c+0],y=n[u+1]-n[c+1],s.settings.adjustSizes?(S=Math.sqrt(x*x+y*y)-n[u+8]-n[c+8],s.settings.linLogMode?s.settings.outboundAttractionDistribution?S>0&&(w=-_*A*Math.log(1+S)/S/n[u+6]):S>0&&(w=-_*A*Math.log(1+S)/S):s.settings.outboundAttractionDistribution?S>0&&(w=-_*A/n[u+6]):S>0&&(w=-_*A)):(S=Math.sqrt(x*x+y*y),s.settings.linLogMode?s.settings.outboundAttractionDistribution?S>0&&(w=-_*A*Math.log(1+S)/S/n[u+6]):S>0&&(w=-_*A*Math.log(1+S)/S):s.settings.outboundAttractionDistribution?(S=1,w=-_*A/n[u+6]):(S=1,w=-_*A)),S>0&&(n[u+2]+=x*w,n[u+3]+=y*w,n[c+2]-=x*w,n[c+3]-=y*w);let I,M,N,D,q=0;if(s.settings.adjustSizes)for(h=0;h<s.nodesLength;h+=s.ppn)n[h+9]||(I=Math.sqrt(n[h+2]*n[h+2]+n[h+3]*n[h+3]),I>s.maxForce&&(n[h+2]=n[h+2]*s.maxForce/I,n[h+3]=n[h+3]*s.maxForce/I),M=n[h+6]*Math.sqrt((n[h+4]-n[h+2])*(n[h+4]-n[h+2])+(n[h+5]-n[h+3])*(n[h+5]-n[h+3])),N=Math.sqrt((n[h+4]+n[h+2])*(n[h+4]+n[h+2])+(n[h+5]+n[h+3])*(n[h+5]+n[h+3]))/2,D=.1*Math.log(1+N)/(1+Math.sqrt(M)),b=n[h+0],v=n[h+1],n[h+0]=n[h+0]+n[h+2]*(D/s.settings.slowDown),n[h+1]=n[h+1]+n[h+3]*(D/s.settings.slowDown),x=n[h+0],y=n[h+1],S=Math.sqrt((x-b)*(x-b)+(y-v)*(y-v)),q+=S);else for(h=0;h<s.nodesLength;h+=s.ppn)n[h+9]||(M=n[h+6]*Math.sqrt((n[h+4]-n[h+2])*(n[h+4]-n[h+2])+(n[h+5]-n[h+3])*(n[h+5]-n[h+3])),N=Math.sqrt((n[h+4]+n[h+2])*(n[h+4]+n[h+2])+(n[h+5]+n[h+3])*(n[h+5]+n[h+3]))/2,D=n[h+7]*Math.log(1+N)/(1+Math.sqrt(M)),n[h+7]=Math.min(1,Math.sqrt(D*(n[h+2]*n[h+2]+n[h+3]*n[h+3])/(1+Math.sqrt(M)))),b=n[h+0],v=n[h+1],n[h+0]=n[h+0]+n[h+2]*(D/s.settings.slowDown),n[h+1]=n[h+1]+n[h+3]*(D/s.settings.slowDown),x=n[h+0],y=n[h+1],S=Math.sqrt((x-b)*(x-b)+(y-v)*(y-v)),q+=S);if(s.iterations++,s.settings.autoStop&&(s.converged=s.iterations>s.settings.maxIterations||q/s.nodesLength<s.settings.avgDistanceThreshold,s.converged&&s.settings.alignNodeSiblings)){let et,O,K={},j={};for(g=0;g<s.edgesLength;g+=s.ppe)u=r[g+0],c=r[g+1],u!==c&&(K[u]=K[u]||{},K[c]=K[c]||{},K[u][c]=!0,K[c][u]=!0);Object.keys(K).forEach((Zt=>{var Lt=~~Zt;O=Object.keys(K[Lt]),O.length==2&&(et=O[0]+";"+O[1],et in j||(et=O[1]+";"+O[0],j[et]||(j[et]=[~~O[1],~~O[0]])),j[et].push(Lt))}));let ot,it,ct,pt,Pt,At,bt,It,Ut,Gt,Dt,Rt,Tt,Nt,Ht,qt=s.settings.nodeSiblingsAngleMin;Object.keys(j).forEach((Zt=>{if(it=j[Zt].shift(),ct=j[Zt].shift(),ot=j[Zt].filter((ne=>!n[ne+9])),ot.length==1)return;if(At=n[it+0],bt=n[it+1],It=n[ct+0],Ut=n[ct+1],pt=Object.keys(K[it]).length,Pt=Object.keys(K[ct]).length,Gt=(function(se,le,ge,ve,Le){return(Le-ve)*(se-le)/(ge-le)+ve})(pt/(pt+Pt),0,1,1/4,3/4),Rt=(function(se,le,ge,ve,Le){return{x:se+(ge-se)*Le,y:le+(ve-le)*Le}})(At,bt,It,Ut,Gt),Tt=(function(se,le,ge,ve){return{xi:-(ve-le),yi:ge-se,xiPrime:ve-le,yiPrime:-(ge-se)}})(At,bt,It,Ut),Dt=(function(se,le,ge,ve){const Le=ge-se,Ae=ve-le;return Math.sqrt(Le*Le+Ae*Ae)})(At,bt,It,Ut),Nt=(function(se,le){return{x:(se.xiPrime-se.xi)/le,y:(se.yiPrime-se.yi)/le}})(Tt,Dt),Ht=(function(se){return Math.acos(se.x/Math.sqrt(se.x*se.x+se.y*se.y))})(Nt),2*qt>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");qt>0&&(Ht<qt||Ht>Math.PI-qt&&Ht<=Math.PI?Nt={x:2*Math.cos(Math.PI-qt),y:2*Math.sin(Math.PI-qt)}:(Ht>2*Math.PI-qt||Ht>=Math.PI&&Ht<Math.PI+qt)&&(Nt={x:2*Math.cos(qt),y:2*Math.sin(qt)}));let Lt=0,Kt=1,ue=1;ot.length%2==1&&(ue=0,Lt=1);for(let ne=0;ne<ot.length;ne++)n[ot[ne]+0]=Rt.x+Kt*Nt.x*ue*(Lt||ne>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),n[ot[ne]+1]=Rt.y+Kt*Nt.y*ue*(Lt||ne>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),Kt=-Kt,ue+=(ne+Lt)%2}))}}function a(l){const d=Object.keys(l),h={};for(let u=0;u<n.length;u+=s.ppn){const c=d[u/s.ppn];h[c]={id:c,x:n[u+0],y:n[u+1],pinned:n[u+9]}}return h}return(function(){if(s.settings.autoStop){const d=Date.now();for(;!(s.converged||Date.now()-d>=e.chunkPeriod);)o()}else{const d=s.iterations===0?s.settings.startingIterations:s.iterations+s.settings.iterationsPerRender;for(;s.iterations!==d;)o()}return{nodes:a(e.nodes),barycentre:e.barycentre}})()},isRunning:function(t){return!t.W.settings.autoStop||!t.W.converged||(t.W=void 0,!1)},stop:function(t){t.W&&(t.W.converged=!0)},onSync:function({nodes:t,barycentre:e},{graph:s}){const i=Object.keys(t),n=i.length;let r,o,a,l,d,h,u,c,g=0,m=0;const f=new Array(n),p=new Array(n),_=new Array(n),x=new Array(n),[y,b]=s.getAttributes(!0,["x","y"]);for(r=0;r<n;r++)o=i[r],a=t[o],c=parseInt(o),f[r]=c,x[r]=a.pinned,a.pinned?(l=y.get(c),d=b.get(c)):(l=a.x,d=a.y),p[r]=l,_[r]=d,g+=l,m+=d;for(h=g/n-e.x,u=m/n-e.y,r=0;r<n;r++)x[r]||(p[r]-=h,_[r]-=u);return{indexes:f,x:p,y:_}}},Kk=t=>(t.modules.layouts.register(b_),(e={})=>e.incremental?WE(e,t,t.layouts.forceLink):t.modules.layouts.start(b_.name,e)),v_={name:"grid",configure:function(t,{graph:e,camera:s}){function i(v){return v===void 0||typeof v=="number"&&isFinite(v)&&v>0}const n=t.sortBy,r=t,o=r.nodes,a=Array.from(o._indexes),l=a.length,{rows:d,cols:h,rowDistance:u,colDistance:c}=(function(A,S,w,I,M){if(!i(S))throw new TypeError('"rows" should be a positive integer');if(!i(w))throw new TypeError('"cols" should be a positive integer');if(!i(I))throw new TypeError('"rowDistance" should be a positive number');if(!i(M))throw new TypeError('"colDistance" should be a positive number');if(S)return{rows:S,cols:Math.ceil(A/S),rowDistance:I,colDistance:M};if(w)return{cols:w,rows:Math.ceil(A/w),rowDistance:I,colDistance:M};const N=Math.ceil(Math.sqrt(A));return{cols:N,rows:Math.ceil(A/N),rowDistance:I,colDistance:M}})(l,r.rows,r.cols,r.colDistance,r.rowDistance),g=(function(A,S,w,I,M){return typeof A!="string"?I.map(((N,D)=>D)):A==="radius"?S.getAttribute(!0,"radius").getMultiple(I):A==="degree"?w.getDegree():A==="random"?I.map((()=>Math.random())):w.getData(A).map((N=>N||M))})(n,e,o,a,t.sortFallbackValue),m=o.getAttribute("layoutable"),f=a.reduce(((v,A,S)=>(m[S]&&v.push({id:A,attr:g[S]}),v)),[]),p=o.getAttribute("x"),_=o.getAttribute("y"),x=o.getAttribute("radius");let y=1/0,b=1/0;for(let v=0;v<a.length;v++)y=Math.min(y,p[v]),b=Math.min(b,_[v]);return{sort:!!n,nodes:f,reverse:!!r.reverse,cols:h,rows:d,minX:y,minY:b,rs:x,rowDistance:u,colDistance:c}},update:function({sort:t,nodes:e,minX:s,rs:i,minY:n,reverse:r,cols:o,rowDistance:a,colDistance:l}){const d=e.map(((_,x)=>x));t&&d.sort(((_,x)=>e[_].attr-e[x].attr)),r&&d.reverse();let h=0;for(let _=0;_<e.length;_++){const x=_>0&&(_+1)%o==0,y=_%o==0,b=x?0:i[d[_+1]]||0,v=y?0:i[d[_+o-1]]||0,A=i[d[_+o]]||0,S=x?0:i[d[_+o+1]]||0,w=i[d[_]]||0;h=Math.max(h,w+b,w+v,w+A,w+S)}let u=h+5,c=h+5;const g=s,m=n;isFinite(u)||(u=0),isFinite(c)||(c=0),a!==void 0&&isFinite(a)&&(u=h+a),l!==void 0&&isFinite(l)&&(c=h+l);let f=0,p=0;return d.forEach((_=>{const x=e[_];x.x=g+f*u,x.y=m+p*c,f+=1,f===o&&(p+=1,f=0)})),e},onSync:function(t){return{indexes:t.map((({id:e})=>e)),x:t.map((({x:e})=>e)),y:t.map((({y:e})=>e))}}},Qk=t=>(t.modules.layouts.register(v_),(e={})=>t.modules.layouts.start(v_.name,e)),Cg={id:"__SENTINEL__",layer:-1,sink:!1,fixed:!1,siblingIndex:-1,parentIds:[],children:[],radius:0,ref:null},fo=t=>t.data===Cg||!1,ic=t=>!fo(t),Jk=[],tO=(t,e)=>({id:t,layer:e,data:Cg,children:Jk,ref:void 0,x:0,y:0}),$E=(t,e)=>({id:t,layer:-1,data:e,children:[],x:0,y:0}),E_=class{constructor(t,e,s){this.data=t,this.prev=e,this.next=s}toString(){return this.data}},ZE=t=>t.reduce(((e,s)=>(e[s]=!0,e)),{});function eO(t,e){const s=[t],i=ZE(s),n=[t];for(;s.length;){const r=s.shift();for(const o of e.get(r))i[o]||(i[o]=!0,n.push(o),s.push(o))}return n}function Lg(t){return t.reduce(((e,{source:s,target:i})=>(e.set(s,e.get(s)||[]),e.set(i,e.get(i)||[]),e.get(s).push(i),e.get(i).push(s),e)),new Map)}function sO(t){return t.reduce(((e,{source:s,target:i})=>(e[s]=e[s]||[],e[s].push(i),e)),{})}function iO(t,e,s){const i=s||Lg(e||[]);return t.filter((({id:n})=>!i.has(n)))}function nO(t,e){const s=ZE(e);return t.filter((i=>!(i in s)))}function Gs(t,e){t.forEach(((s,i)=>{s.forEach(((n,r,o)=>{e(n,r,o,i)}))}))}var A_=t=>{const e=Math.floor(t.length/2);return(t=[...t].sort(((s,i)=>s-i))).length%2!=0?t[e]:(t[e-1]+t[e])/2};function rO(t,e,s){const i=Lg(e);let n=Array.from(i.keys());const r=[];for(;n.length;){const o=eO(n[0],i);r.push(o),n=nO(n,o)}return s.skipSingletons?r:r.concat(iO(t,e,i).map((({id:o})=>[o])))}var Ll=({id:t,layer:e,sink:s,siblingIndex:i,radius:n,layoutable:r})=>({id:t,layer:e!==void 0?e:void 0,sink:s,siblingIndex:i||0,radius:n||0,fixed:r===!1,parentIds:[],children:[],ref:null});function oO(t){const e={x:0,y:0};let s=0;for(let i=0;i<t.length;i++){const n=t[i];for(let r=0;r<n.nodes.length;r++){const o=n.nodes[r];e.x+=o.x||0,e.y+=o.y||0,s++}}return e.x/=s,e.y/=s,e}function aO(t){const e={x:0,y:0};let s=0;for(const[,{x:i,y:n}]of t)e.x+=i||0,e.y+=n||0,s++;return e.x/=s,e.y/=s,e}function lO(t,e,s){const i=oO(s),n=t.x-i.x,r=t.y-i.y;for(let o=0;o<s.length;o++){const a=s[o];for(let l=0;l<a.nodes.length;l++){const d=a.nodes[l],h=e.get(d.id);!h||d.data&&d.data.fixed||(h.x=d.x+n,h.y=d.y+r)}}}function S_(t){return Math.ceil(Math.sqrt(t))}var w_=5,dO=class{constructor(t,e,s=0,i=!1){this.groupToSubNodes=new Map,this.nodeToGroup=new Map,this.lookup=new Map,this.shouldPackSiblings=!0,this.shouldSort=!1,this.shouldPackSiblings=t,this.packSiblingsFn=e||(()=>1),this.siblingsGap=s,this.shouldSort=i}packSiblings(t){if(!this.shouldPackSiblings)return;const e=this.groupToSubNodes,s=this.nodeToGroup,i=this.siblingsGap,n=this.packSiblingsFn,r=[],o=new Set,a=new Map,l=new Map,d=this.lookup;t.nodes.forEach((h=>{d.set(h.id,h)})),t.nodes.forEach((h=>{if(!h.children.length)return;const u=[];h.children.forEach((c=>{c.id===h.id||c.children.length||u.push(c)})),!(u.length<w_)&&l.set(h.id,u)})),l.forEach(((h,u)=>{const c=new Map;h.length<w_||(h.forEach((g=>{if(a.has(g.id))return;const m=n(g.data);if(m===void 0)return;const f=`${u}-${m}`;a.set(g.id,f),c.has(f)?c.get(f).push(g):c.set(f,[g])})),c.forEach(((g,m)=>{this.shouldSort&&g.sort(((y,b)=>y.data.siblingIndex-b.data.siblingIndex));const f=S_(g.length);let p=f*i;for(let y=0;y<f;y++){let b=0;for(let v=0;v<f;v++){const A=g[y*f+v];b=Math.max(b,A?2*A.data.radius:0)}p+=b}p/=2,e.set(m,g);const _=g[0].layer,x=$E(m,Ll({id:m,layer:_,radius:p}));x.layer=_,d.set(m,x),r.push(x),g.forEach((y=>{s.set(y.id,m),o.add(y.id)}))})))})),t.nodes=t.nodes.filter((h=>o.has(h.id)===!1)),r.forEach((h=>{t.nodes.push(h)})),t.nodes.forEach((h=>{const u=new Set;h.children=h.children.filter((c=>{if(!a.has(c.id))return!0;const g=a.get(c.id);return u.add(g),!1})),h.children.push(...Array.from(u).map((c=>d.get(c))))}))}unpackSiblings(t){if(!this.shouldPackSiblings)return;const e=this.siblingsGap,s=this.groupToSubNodes,i=new Set,n=[];t.nodes.forEach((r=>{if(!s.has(r.id))return;i.add(r.id);const o=s.get(r.id)||[],a=S_(o.length),l=new Array(a).fill(0);o.forEach(((h,u)=>{n.push(h);const c=Math.floor(u/a);l[c]=Math.max(l[c],2*h.data.radius)})),l[0]-=r.data.radius;for(let h=1;h<a;h++)l[h]+=l[h-1]+e;const d=2*r.data.radius/a;o.forEach(((h,u)=>{const c=Math.floor(u/a),g=u%a;h.y=r.y+l[c],h.x=r.x-r.data.radius+g*d}))})),t.nodes=t.nodes.filter((r=>!i.has(r.id))),n.forEach((r=>{t.nodes.push(r)}))}};function hO(t){let e=0,s=0;for(const o of t)e+=o.w*o.h,s=Math.max(s,o.w);t.sort(((o,a)=>a.h-o.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let n=0,r=0;for(const o of t)for(let a=i.length-1;a>=0;a--){const l=i[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,r=Math.max(r,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===l.w&&o.h===l.h){const d=i.pop();a<i.length&&(i[a]=d)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(i.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:n,h:r,fill:e/(n*r)||0}}var uO={down:()=>{},up:t=>t.y=-t.y,left:t=>{const e=t.x;t.x=-t.y,t.y=e},right:t=>{const e=t.x;t.x=t.y,t.y=-e}},Th=(t,e)=>isFinite(t)&&t>0?t:e;function cO(t){return{nodesSeparation:Th(t.nodesSeparation,0),componentsSeparation:Th(t.componentsSeparation,25),layerSeparation:Th(t.layerSeparation,50)}}function gO(t,{componentsSeparation:e,packing:s}){const i=[];for(let n=0;n<t.length;n++){const r=t[n],o=r.nodes;if(r.isFake&&r.w!==void 0&&r.h!==void 0){i.push({w:r.w,h:r.h,x:void 0,y:void 0,dag:r});continue}if(r.nodes.length===1){const c=2*o[0].data.radius;i.push({w:c+e/2,h:c+e/2,x:void 0,y:void 0,dag:r});continue}const{minX:a,maxX:l,minY:d,maxY:h}=o.reduce(((c,{x:g,y:m,data:f})=>{const p=f.radius||0;return c.minX=Math.min(c.minX,g-p),c.maxX=Math.max(c.maxX,g+p),c.minY=Math.min(c.minY,m-p),c.maxY=Math.max(c.maxY,m+p),c}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),u=(l+a)/2;o.forEach((c=>{c.x-=u})),i.push({w:Math.abs(l-a)+e/2,h:Math.abs(h-d)+e/2,minX:a,x:void 0,y:void 0,dag:r})}if(s!=="singleline")hO(i);else{let n=0;for(let r=0;r<i.length;r++){const o=i[r];o.x=n,o.y=0,n+=o.w}}return i}function mO(t,e={}){const{componentsSeparation:s}=cO(e);e.direction===void 0&&(e.direction="down");const i=gO(t,{componentsSeparation:s,packing:e.packing});for(let n=0;n<i.length;n++){const{x:r=0,y:o=0,dag:a}=i[n];for(const l of a.nodes)l.x+=r,l.y+=o,uO[e.direction](l)}}var fO=t=>t.reduce(((e,{radius:s})=>Math.max(e,2*s)),0);function pO(t,e){return{nodes:t.map((s=>({...s,data:s}))),isFake:!0,...e}}function _O(t,e,s){const i=Lg(e||[]),n=t.filter((({id:g})=>!i.has(g))).sort(((g,m)=>m.radius-g.radius)),r=Math.sqrt(n.length);let o=Math.floor(r),a=Math.ceil(r);o*a<n.length&&(o<a?o++:a++);const l=Math.max(1,fO(n)),d=Math.max(s.nodesGridSeparation||0,1),h=l*a+d*(a-1),u=l*o+d*Math.max(o-1,0),c=pO(n,{w:h,h:u});return c.nodes.forEach(((g,m)=>{const f=m%a,p=Math.floor(m/a);g.x=h*f/a,g.y=u*p/o})),c}function T_(t,e,s){const i=e.reduce(((o,a)=>(o.set(a.source,o.get(a.source)||[]),o.get(a.source).push(a),o)),new Map),{result:n}=t.reduce((function o(a,l){const{visited:d,stack:h,result:u}=a;if(d.has(l.id))return a;h.add(l.id),d.add(l.id);const c=i.get(l.id)||[];for(const g of c)h.has(g.target)?u.push(g):o(a,s.get(g.target));return h.delete(l.id),a}),{visited:new Set,stack:new Set,result:[]}),r=n.reduce(((o,{source:a,target:l})=>(o.set(a,o.get(a)||new Set),o.get(a).add(l),o)),new Map);return e.map((o=>{const{source:a,target:l,id:d}=o;return r.has(a)&&r.get(a).has(l)?{id:d,source:l,target:a}:o}))}function yO(t){if(!t||!t.length)throw Error("Cannot stratify empty data");for(const n of t){if(!n)throw Error('Node data is "null"');if(n.id==null)throw Error('Node id contains a "null" value')}const e=t.map((n=>$E(n.id,n))),s=e.reduce(((n,r)=>{if(n[r.id])throw Error(`The connected component contains id duplicates: ${r.id}`);return n[r.id]=r,n}),{}),i=[];for(let n=0;n<e.length;n++){const r=e[n];for(let o=0;o<r.data.parentIds.length;o++){const a=r.data.parentIds[o],l=s[a];if(!l)throw Error(`The node ${r.id} has a missing parent id ${a}`);l.children.push(r)}r.data.parentIds.length||i.push(r)}return{isFake:!1,nodes:xO(i)}}function xO(t){const e={},s=[];for(;t.length;){const i=t.pop();e[i.id]||(s.push(i),e[i.id]=!0,t.push(...i.children))}return s}var bO=t=>{const e=[];if(t.nodes.forEach((h=>{if(h&&!isNaN(h.layer)&&h.layer!==null){if(h.layer<0)throw new Error("Layer must be greater than or equal to 0");e.push([h.id,h.layer])}})),e.length===0)return t.edges;e.sort(((h,u)=>h[1]-u[1]));const s=new Set;for(let h=0;h<e.length;h++)e[h][1]!==0&&s.add(e[h][0]);const i=new Map;for(const h of t.nodes)i.set(h.id,[]);for(const h of t.edges)i.get(h.source)?.push(h.target),i.get(h.target)?.push(h.source);if(!e.map((([,h])=>h)).some((h=>h===0))){e.sort(((g,m)=>g[1]-m[1]));const h=new Set,u=[e[0]];let c;for(;u.length>0;){const[g,m]=u.shift();if(m===0){c=g;break}h.add(g);const f=i.get(g)||[];for(const p of f)s.has(p)||h.has(p)||u.push([p,m-1])}if(c)e.push([c,0]);else{const g=e[0][1];for(let m=0;m<e.length;m++)e[m][1]-=g}}const n=e.filter((([,h])=>h===0)).map((([h])=>h)),r=n.slice(),o=new Map,a=new Map,l=new Map;for(const h of n)o.set(h,0),a.set(h,[]);for(;r.length>0;){const h=r.shift(),u=o.get(h),c=i.get(h)||[];for(const g of c){const m=o.get(g);m===void 0?(o.set(g,u+1),a.set(g,[h]),r.push(g)):m===u+1&&a.get(g)?.push(h)}}for(const[h,u]of a.entries())for(const c of u)l.set(c,(l.get(c)||[]).concat(h));for(const[h,u]of e)if(o.get(h)!==u)if(u===0){const c=a.get(h)||[];a.set(h,[]),c.forEach((f=>{l.set(f,(l.get(f)||[]).filter((p=>p!==h)))}));const g=t.nodes.filter((f=>o.get(f.id)===0));o.clear(),g.forEach((f=>o.set(f.id,0)));const m=g.map((f=>f.id));for(;m.length>0;){const f=m.shift(),p=o.get(f),_=l.get(f)||[];for(const x of _)o.get(x)===void 0&&(o.set(x,p+1),m.push(x))}}else{const c=t.nodes.find((p=>o.get(p.id)===u-1&&p.id!==h));if(!c)continue;const g=a.get(h)||[];a.set(h,[c.id]),g.forEach((p=>{l.set(p,(l.get(p)||[]).filter((_=>_!==h)))})),l.set(c.id,(l.get(c.id)||[]).concat(h));const m=t.nodes.filter((p=>o.get(p.id)===0));o.clear(),m.forEach((p=>o.set(p.id,0)));const f=m.map((p=>p.id));for(;f.length>0;){const p=f.shift(),_=o.get(p),x=l.get(p)||[];for(const y of x)o.get(y)===void 0&&(o.set(y,_+1),f.push(y))}}const d=[];for(const[h,u]of a.entries())if(u.length>0)for(const c of u)d.push({id:`${c}-${h}`,source:c,target:h});return d},vO=class{constructor(){this.byId={},this.byIndex={},this.length=0}append(t,e){let s;return this.head?(s=new E_(t,this.tail),this.tail=this.tail.next=s):(s=new E_(t),this.tail=this.head=s),this.byId[e]=s,this.byIndex[this.length++]=s,s}find(t){let e=this.head;do{if(e.data===t)return e;e=e.next}while(e)}forEach(t){let e=this.head,s=0;do t(e,s),s++;while(e=e.next)}},Vs=-1,Ue=1e-5,Ch=[],EO=class{constructor(t,e,s){this.edges=[],this.nodeMap={},this.nodeIndexTopDown={},this.nodeToLayer={},this.longEdges={},this.virt={},this.height={},this.breadth={},this.first=[],this.totalW={},this.mDist={},this.X={},this.block={},this.nodeList=new vO,this.nodeDistance=e,this.layerDistance=s,this.layers=t;const{breadth:i,virt:n,height:r,nodeToLayer:o,nodeIndexTopDown:a,nodeMap:l,longEdges:d,edges:h}=this;let u=0;Gs(this.layers,((f,p,_,x)=>{if(a[f.id]=u++,l[f.id]=f,o[f.id]=x,this.nodeList.append(f,f.id),f.children.forEach((b=>{const v=fo(b)||fo(f);h.push({source:f.id,target:b.id,virtual:v,id:h.length})})),d[f.id])return;const y=[f.id];if(d[f.id]=y,!ic(f))for(let b=0;b<f.children.length;b++){const v=f.children[b];if(ic(v))continue;let A=v;for(;fo(A);)y.push(A.id),d[A.id]=y,A=A.children[0]}}));const c=this.adjacencyList=sO(h);this.N=t.reduce(((f,p)=>f+p.length),0),this.Y=new Float32Array(t.length),this.first=t.map((f=>f[0])),t.forEach(((f,p)=>r[p]=0)),Gs(this.layers,((f,p,_,x)=>{const y=c[f.id]?c[f.id].length:0;n[f.id]=fo(f)&&y===1,this.nodeToLayer[f.id]=x,n[f.id]?i[f.id]=0:(i[f.id]=2*f.data.radius,r[x]=Math.max(r[x]||0,2*f.data.radius))}));const g={},m={};h.forEach((f=>{const p=f.source,_=f.target;g[_]=g[_]||[],g[_].push(p),m[p]=m[p]||[],m[p].push(_)})),Object.values(g).forEach((f=>{f.sort(((p,_)=>this.nodeIndexTopDown[p]-this.nodeIndexTopDown[_]))})),Object.values(m).forEach((f=>{f.sort(((p,_)=>this.nodeIndexTopDown[p]-this.nodeIndexTopDown[_]))})),this.neighbours={prev:g,next:m}}computeMinNodeDistances(){const{layers:t,totalW:e}=this;Gs(t,(s=>{e[s.id]=0})),Gs(t,(s=>e[s.data.id]=0)),this.layers.forEach((s=>{e[s[0].id]=0,s.slice(1).forEach(((i,n)=>{const r=s[n],o=i.id;e[o]=e[r.id]+r.data.radius+i.data.radius+this.nodeDistance}))}))}decrossVirtualEdges(){this.layers.forEach((t=>{let e=-1;t.forEach((s=>{if(!this.virt[s.id])return;const i=this.neighbours.next[s.id][0];if(this.virt[i])if(e!==-1&&e>this.nodeIndexTopDown[i]){const n=this.longEdges[s.id];let r=0;for(r=0;r<n.length&&n[r]!==i;r++);const o=n.slice(r);o.forEach((l=>this.longEdges[l]=o));const a=n.slice(0,r);a.forEach((l=>this.longEdges[l]=a))}else e=this.nodeIndexTopDown[i]}))}))}placeLongEdges(){const{X:t,layers:e}=this;Gs(e,(s=>t[s.id]=0));for(let s=1;s>=-1;s-=2){const i={};let n=0;const r={};Gs(e,(d=>r[d.id]=0)),r[Cg.id]=0;const o=s;e.forEach((d=>{let h=o===1?d[0]:d[d.length-1];r[h.id]||(this.longEdges[h.id].forEach((g=>{r[g]=n})),n++);let u=o===1?0:d.length-1,c=u+o;for(;c>=0&&c<d.length;)h=d[c],r[h.id]||this.longEdges[h.id].forEach((g=>{r[g]=r[d[u].id]})),u=c,c+=o}));const a={};e.forEach((d=>{for(let h=o===1?0:d.length-1;o===1?h<d.length:h>=0;h+=o){const u=d[h],c=r[u.id];a[c]=a[c]||[],a[c].push(u.id)}}));const l={};this.nodeList.forEach((d=>l[d.data.id]=0));for(let d=0;d<n;d++){const h={done:!1,dist:0},u=a[d];for(let c=0;c<u.length;c++){const g=u[c];this.sortLongEdges(g,s,l,h,r,i)}if(!h.done){const c=this.layers[this.nodeToLayer[a[d][0]]],g=[];c.forEach((m=>{for(const f of this.neighbours.prev[m.id]||Ch){const p=Math.abs(l[f]-l[m.id]);g.push(p)}})),g.length!==0&&(h.dist=A_(g))}for(let c=0;c<u.length;c++)l[u[c]]-=s*h.dist}Gs(e,(d=>t[d.id]+=l[d.id]/2))}}sortLongEdges(t,e,s,i,n,r){if(r[t])return!1;let o=!1,a=0;const{nodeToLayer:l,totalW:d}=this,h=this.longEdges[t];h.forEach((u=>r[u]=!0)),h.forEach((u=>{const c=this.nodeList.byIndex[this.nodeIndexTopDown[u]-e];if(!c)return;const g=c.data.id,m=u,f=l[g]===l[m],p=n[g]===n[m];!f||!p||(this.sortLongEdges(g,e,s,i,n,r),(!o||e*(a-s[g])<e*(d[m]-d[g]))&&(o=!0,a=s[g]+d[m]-d[g]))})),h.forEach((u=>{s[u]=a;const c=this.nodeList.byId[u],g=e===1?c.next:c.prev;if(!g)return;const m=g.data.id,f=u,p=l[m]===l[f],_=n[m]!==n[f],x=e*(d[m]-d[f]-s[m]+s[f]);p&&_&&(!i.done||x>i.dist)&&(i.dist=x,i.done=!0)}))}placeNonVirtualNodes(){const t={};Gs(this.layers,(l=>t[l.id]=-1));const{X:e,totalW:s,virt:i,nodeIndexTopDown:n,mDist:r,nodeList:o}=this,a={};Gs(this.layers,((l,d,h,u)=>{if(!i[l.id])return void(a[l.id]=!1);let c=this.nodeList.byId[l.id].next;for(;c&&this.nodeToLayer[c.data.id]===u&&!i[c.data.id];)c=c.next;a[l.id]=this.nodeToLayer[c.data.id]===u&&e[c.data.id]-e[l.id]<s[c.data.id]-s[l.id]+Ue})),Gs(this.layers,(({id:l})=>{a[l]&&t[l]===-1&&this.longEdges[l].forEach((d=>{d!==l&&(t[d]=n[d]<n[l]?1:0)}))})),Gs(this.layers,(({id:l})=>r[l]=s[l]));for(let l=0;l<2;l++)for(let d=l?this.layers.length-1:0;d>=0&&d<this.layers.length;l?d--:d++){let h=Vs;const u=this.layers[d];if(u.forEach((({id:c},g,m)=>{if(i[c]){if(h===Vs){this.placeSequence(Vs,c,m[0].id,o.byId[c].prev.data.id,l);for(let f=0;f<g;f++){const p=m[f].id;r[p]=r[c]-e[c]+e[p]}}else if(t[h]!==1-l){a[h]||this.placeSequence(h,c,o.byId[h].next.data.id,o.byId[c].prev.data.id,l);const f=l===1?this.neighbours.prev:this.neighbours.next,p=f[h][0],_=f[c][0];if(i[p]&&i[_])for(let x=n[p]+1;x<n[_];x++)t[o.byIndex[x].data.id]=l}h=c}})),h===Vs)this.placeSequence(Vs,Vs,u[0].id,u[u.length-1].id,l),u.forEach((({id:c})=>r[c]=e[c]));else{this.placeSequence(h,Vs,o.byId[h].next.data.id,u[u.length-1].id,l);for(let c=u.length-1;c>=0;c--){const g=u[c].id;if(g===h)break;r[g]=r[h]-e[h]+e[g]}}}}placeSequence(t,e,s,i,n,r=0){if(r===2048)return;const o=this.nodeIndexTopDown[s],a=this.nodeIndexTopDown[i],{X:l,nodeIndexTopDown:d,mDist:h}=this;if(o===a)l[s]=this.placeNode(s,t,e,l[s],n);else if(o<a){const u=Math.floor((d[s]+d[i])/2),c=this.nodeList.byIndex[u],g=c.next.data.id,m=h[g]-h[c.data.id];this.placeSequence(t,e,s,c.data.id,n,r+1),this.placeSequence(t,e,g,i,n,r+1),this.combineSequences(t,e,s,i,g,c.data.id,n,m)}}calculateBends(t,e,s,i,n,r,o,a){let l=0;const d=[],{X:h,mDist:u,neighbours:c}=this,g=this.nodeIndexTopDown[s],m=this.nodeIndexTopDown[i];for(let f=this.nodeList.byId[r],p=this.nodeIndexTopDown[f.data.id];p>=g&&p<=m&&f;f=t===-1?f.prev:f.next,p=f&&this.nodeIndexTopDown[f.data.id]){const _=f.data.id,x=(e===0?c.prev[_]:c.next[_])||Ch;let y=0;for(let v=0;v<x.length;v++){const A=x[v];if(t*(h[A]-h[_])<Ue)y++;else{y--;const S=h[A]+u[r]-u[_];t*(h[r]-S)>-Ue?l++:(a===Vs||t*(S-h[a]+u[a]-u[r])<Ue)&&t*(S-h[n])<o-Ue&&d.push({value:2,key:S})}}const b=h[_]+u[r]-u[_];t*(h[r]-b)>-Ue?l+=y:(a===Vs||t*(b-h[a]+u[a]-u[r])<Ue)&&t*(b-h[n])<o-Ue&&d.push({value:y,key:b})}return a!==Vs&&d.push({value:this.edges.length,key:h[a]-u[a]+u[r]}),d.sort((({key:f},{key:p})=>f-p)),{res:l,bends:d.reduce(((f,p,_)=>{if(_<d.length-1){const x=d[_+1];Math.abs(p.key-x.key)>Ue?p.value>0&&f.push(p):p.value+=x.value}else p.value>0&&f.push(p);return f}),[])}}combineSequences(t,e,s,i,n,r,o,a){const{X:l,mDist:d,nodeIndexTopDown:h}=this;let{res:u,bends:c}=this.calculateBends(-1,o,s,i,n,r,a,t),{res:g,bends:m}=this.calculateBends(1,o,s,i,r,n,a,e);for(c.length>0&&c.reverse();l[n]-l[r]<a-Ue;){let _=0,x=0;if(u<g){const y=c.length;if(y>0){const b=c.pop();_=b.value,l[r]=b.key}(y===0||l[n]-l[r]>a+Ue)&&(l[r]=l[n]-a)}else if(u>g){const y=m.length;if(y>0){const b=m.pop();x=b.value,l[n]=b.key}(y===0||l[n]-l[r]>a+Ue)&&(l[n]=l[r]+a)}else{let y=(a-l[n]+l[r])/2;const b=c.length===0?y+1:l[r]-c[c.length-1].key,v=m.length===0?y+1:m[m.length-1].key-l[n];b<y+Ue&&b<v+Ue&&(_=c.pop().value),v<y+Ue&&v<b+Ue&&(x=m.pop().value),y=Math.min(y,b,v),l[r]-=y,l[n]+=y}u+=_,g+=x}let f,p=this.nodeList.byId[r].prev;for(;p&&h[f=p.data.id]>=h[s]&&l[r]-l[f]<d[r]-d[f];)l[f]=l[r]-d[r]+d[f],p=p.prev;for(p=this.nodeList.byId[n].next;p&&h[f=p.data.id]<=h[i]&&l[n]-l[f]>d[n]-d[f];)l[f]=l[n]-d[n]+d[f],p=p.next}placeNode(t,e,s,i,n){const{X:r,neighbours:o,mDist:a}=this,l=((n===0?o.prev:o.next)[t]||Ch).map((d=>r[d]));return l.length===0?r[t]:(i=A_(l),e!==Vs&&(i=Math.max(i,r[e]+a[t]-a[e])),s!==Vs&&(i=Math.min(i,r[s]+a[t]-a[s])),i)}moveLongEdge(t,e,s){const{X:i,virt:n,totalW:r,nodeList:o}=this,{id:a}=t.data;if(s[a]||!n[a])return;const l=this.longEdges[a];if(!l)return;l.forEach((f=>s[f]=!0));const d=l[0],h=l[l.length-1],u=[];e<0?u.push(i[d]<i[h]?i[d]:i[h],i[d]<i[h]?i[h]:i[d]):e>0?u.push(i[d]<i[h]?i[h]:i[d],i[d]<i[h]?i[d]:i[h]):u.push(i[d],i[h]);const c=u[0];let g,m=!1;for(;!m&&u.length!==0;)g=u.pop(),m=!0,l.forEach((f=>{const p=this.layers[this.nodeToLayer[f]];if(f!==p[0].id){const _=o.byId[f].prev.data;g-i[_.data.id]<r[f]-r[_.data.id]&&this.moveLongEdge(_,-1,s),m=m&&g-i[_.data.id]>=r[f]-r[_.data.id]-Ue}if(f!==p[p.length-1].id){const _=o.byId[f].next.data;g-i[_.data.id]>r[f]-r[_.data.id]&&this.moveLongEdge(_,1,s),m=m&&g-i[_.data.id]<=r[f]-r[_.data.id]+Ue}}));m||(g=c,l.forEach((f=>{const p=this.layers[this.nodeToLayer[f]];if(f!==p[0].id){const _=o.byId[f].prev.data;g=Math.max(g,i[_.data.id]+r[f]-r[_.data.id])}if(f!==p[p.length-1].id){const _=o.byId[f].next.data;g=Math.min(g,i[_.data.id]+r[f]-r[_.data.id])}}))),l.forEach((f=>i[f]=g))}moveLongEdges(){const t={};this.layers.forEach((e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.moveLongEdge(e[i],0,t);for(let i=s-1;i>=0;i--)this.moveLongEdge(e[i],0,t)}))}computeY(){const{Y:t,layers:e,height:s}=this;t[0]=0,e.slice(1).forEach(((i,n)=>{t[n+1]=t[n]+(s[n]+s[n+1])/2+this.layerDistance}))}straightenLongEdge(t,e){const{nodeList:s,longEdges:i,neighbours:n,X:r,Y:o,nodeToLayer:a,totalW:l}=this,d=i[t.id];if(e[t.id]||!n.prev[t.id]||n.prev[t.id].length!==1||!n.next[t.id]||n.next[t.id].length!==1||!(d&&d.length<2))return;e[t.id]=!0;const h=n.prev[t.id][0],u=n.next[t.id][0];if(a[u]===a[h])return;const c=r[h]+(r[u]-r[h])*(o[a[t.id]]-o[a[h]])/(o[a[u]]-o[a[h]]);if(t!==this.first[a[t.id]]){const m=s.byId[t.id].prev.data;if(c-r[m.id]<l[t.id]-l[m.id]-Ue&&this.straightenLongEdge(m,e),c-r[m.id]<l[t.id]-l[m.id]-Ue)return}const g=this.layers[a[t.id]];if(t!==g[g.length-1]){const m=s.byId[t.id].next.data;if(r[m.id]-c<l[m.id]-l[t.id]-Ue&&this.straightenLongEdge(m,e),r[m.id]-c<l[m.id]-l[t.id]-Ue)return}r[t.id]=c}straightenEdges(){const t={};this.layers.forEach((e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.straightenLongEdge(e[i],t);for(let i=s-1;i>=0;i--)this.straightenLongEdge(e[i],t)}))}run(){this.computeMinNodeDistances(),this.decrossVirtualEdges(),this.placeLongEdges(),this.placeNonVirtualNodes(),this.moveLongEdges(),this.computeY(),this.straightenEdges(),Gs(this.layers,((t,e,s,i)=>{t.x=this.X[t.id],t.y=this.Y[i]}))}},AO=(t,e=20,s=50)=>new EO(t,e,s).run();function SO(t){if(t.sort(((i,n)=>i-n)),t.length===0)return 0;const e=Math.floor(t.length/2),s=Math.floor(t.length/2);return(t[e]+t[s])/2}function nc(t,e,s){const i={};return e.forEach(((n,r)=>i[n.id]=r)),t.map((n=>(s[n.id]||[]).map((r=>i[r])).sort())).reduce(((n,r,o,a)=>{const l=r.length?r[r.length-1]:-1;for(let d=o+1;d<a.length;d++)n+=a[d].filter((h=>h<l)).length;return n}),0)}function wO(t,e,s,i,n){const r={};for(let o=0;o<t.length;o++)r[t[o].id]=SO((e[t[o].id]||[]).map((a=>s[a])))||0;n?t.sort(((o,a)=>{const l=r[o.id]-r[a.id],d=i[o.id]===i[a.id],h=o.data.siblingIndex,u=a.data.siblingIndex;return d&&h>-1&&u>-1?h-u:l===0?s[a.id]-s[o.id]:l})):t.sort(((o,a)=>{const l=r[o.id]-r[a.id];return l===0?s[a.id]-s[o.id]:l}))}function C_({layers:t,topDown:e,topDownAdj:s,bottomUpAdj:i,idToIndex:n,crossings:r,sortSiblings:o}){const a=e?s:i;for(let l=e?0:t.length-1;e?l<t.length:l>=0;e?l++:l--){wO(t[l],a[l]||{},n,i[l],o);const d=l>0?nc(t[l-1],t[l],s[l-1]):0,h=l<t.length-1?nc(t[l],t[l+1],s[l]):0;h+d<=(r[l]||0)+(r[l-1]||0)?(r[l]=h,l>0&&(r[l-1]=d),t[l].forEach(((u,c)=>n[u.id]=c))):t[l].sort(((u,c)=>n[u.id]-n[c.id]))}}var TO=(t,e,s)=>{if(!s&&!e)return;const i={},n=t.map((()=>({}))),r=t.map((()=>({})));if(t.forEach(((h,u)=>{h.forEach(((c,g)=>{i[c.id]=s?c.data.siblingIndex:g,c.children.forEach((m=>{const f=m.layer;f>u?(n[u][c.id]=n[u][c.id]||[],n[u][c.id].push(m.id),r[f][m.id]=r[f][m.id]||[],r[f][m.id].push(c.id)):(n[f][m.id]=n[f][m.id]||[],n[f][m.id].push(c.id),r[u][c.id]=r[u][c.id]||[],r[u][c.id].push(m.id))}))}))})),i[-1]=-1,s&&(t.forEach((h=>h.sort(((u,c)=>i[u.id]-i[c.id])))),!e))return;const o=t.slice(1).map(((h,u)=>nc(t[u],h,n[u]))),a=[[50,100],[100,10],[1e3,1],[5e3,0]],l=Math.max(...t.map((h=>h.length))),d=(a.find((([h])=>l<h))||a[a.length-1])[1];for(let h=0;h<d;h++)C_({layers:t,topDown:!0,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s}),C_({layers:t,topDown:!1,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s})};function CO(t){const e={},s={},i={};t.nodes.forEach((o=>{i[o.id]=o}));const n=o=>{if(e[o.id])return s[o.id];e[o.id]=!0;let a=1/0;for(const l of o.children)a=Math.min(a,n(i[l.id])-1);return a===1/0&&(a=0),s[o.id]=a,a};t.nodes.forEach((o=>{o.data.parentIds.length===0&&n(o)}));let r=1/0;t.nodes.forEach((o=>{r=Math.min(r,s[o.id])})),t.nodes.forEach((o=>{s[o.id]-=r,o.layer=s[o.id]})),t.nodes.forEach((o=>{typeof o.data.layer=="number"&&!isNaN(o.data.layer)&&(o.layer=o.data.layer)}))}function LO(t){const e=t.nodes.reduce(((s,i)=>i.data.fixed&&(s===null||s.layer>i.layer)?i:s),null);return e&&t.nodes.forEach((s=>s.ref=e.id)),t}function IO(t){if(t.nodes.every((e=>e.layer))){const e=t.nodes.reduce(((s,i)=>Math.min(s,i.layer)),1/0);t.nodes.forEach((s=>s.layer-=e))}}function MO(t){if(t.nodes.some((e=>e.data.sink))){const e=t.nodes.reduce(((s,i)=>Math.max(s,i.layer)),-1/0);t.nodes.forEach((s=>{s.data.sink&&(s.layer=e+1)}))}}function NO(t){const e=[];t.nodes.forEach((i=>e[i.layer]=0));const s=Array.from(e).reduce(((i,n,r)=>{if(r===0)return i.push(0),i;const o=i[r-1];return n!==void 0?(i.push(o),i):(i.push(o-1),i)}),[]);t.nodes.forEach((i=>i.layer+=s[i.layer]))}function RO(t){return CO(t),MO(t),IO(t),NO(t),t.nodes.forEach((e=>{const{below:s,above:i}=e.children.reduce(((n,r)=>(e.layer>r.layer?n.above.push(r):n.below.push(r),n)),{above:[],below:[]});i.forEach((n=>n.children.push(e))),e.children=s})),LO(t)}var FO=(t,{nodeDistance:e,layerDistance:s,nodeLookup:i,customSort:n,customLayering:r,sortSiblings:o,siblingsPacking:a,shouldDecross:l=!0})=>{RO(t),a.packSiblings(t),r&&r(t);const d=PO(t);return t.nodes.length>1?(TO(d,l,o),n&&d.forEach((h=>{h.sort(((u,c)=>n(i.get(u.id),i.get(c.id))))})),AO(d,e,s)):(t.nodes[0].x=0,t.nodes[0].y=0),a.unpackSiblings(t),zO(t),t};function PO(t){return t.nodes.reduce(((e,s)=>(e[s.layer]=e[s.layer]||[],e[s.layer].push(s),s.children=s.children.map((i=>{if(i.layer===s.layer+1)return i;let n=i;for(let r=i.layer-1;r>s.layer;r--){const o=tO(`${s.id}->${i.id}@${r}`,r);o.children=[n],e[r]=e[r]||[],e[r].push(o),n=o}return n})),e)),[])}function zO(t){t.nodes.forEach((e=>{e.data&&(e.children=e.children.filter(ic))}))}var DO=(t,e={})=>{const s=new Map,i=new Map;for(const d of t.nodes)s.set(d.id,d);const n=t.nodes.slice(),r=(t.edges||[]).filter((({source:d,target:h})=>d!==h)),o=T_(n,r,s).filter((d=>{const h=i.get(d.source);if(!h){const u=new Map;return u.set(d.target,!0),i.set(d.source,u),!0}return!h.get(d.target)&&(h.set(d.target,!0),!0)})),a=rO(n,o,{skipSingletons:e.packing==="grid"}),l=a.map((d=>{const h=d.map((c=>s.get(c))),u=o.filter((c=>d.includes(c.source)));return T_(h,bO({nodes:h,edges:u}),s)})).flat().reduce(((d,h)=>(d.has(h.source)||d.set(h.source,Ll(s.get(h.source))),d.has(h.target)||d.set(h.target,Ll(s.get(h.target))),d.get(h.target).children.push(h.source),d.get(h.target).parentIds.push(h.source),d)),new Map);return{components:a.map((d=>d.map((h=>l.get(h)||Ll(s.get(h)))))),lookup:s}};function kO(t,e,s,i){const n=[];for(const r of t){const o=yO(r);n.push(o),FO(o,{nodeDistance:i.nodesSeparation,layerDistance:i.layerSeparation,shouldDecross:i.shouldDecross,siblingsPacking:s,customSort:i.customSort,customLayering:i.customLayering,sortSiblings:!!i.sortSiblings,nodeLookup:e})}return n}var L_=(t,e={})=>{if(!t||!t.nodes)return t;const s={direction:"down",packing:"fit",nodesGridSeparation:1,...e,shouldDecross:e.shouldDecross!==!1},i=new dO(e.shouldPackSiblings,e.siblingPacking,e.siblingsGap,e.sortSiblings),{components:n,lookup:r}=DO(t,s),o=aO(r),a=kO(n,r,i,s);if(s.packing==="grid"){const l=_O(t.nodes,t.edges,s);a.push(l)}return mO(a,s),lO(o,r,a),t},Lh={direction:"TB",nodeDistance:5,levelDistance:50,componentDistance:50,gapWidth:1,arrangeComponents:"fit",gridDistance:50,layer:"layer",siblingIndex:""},rc={name:"hierarchical",imports:{sequential:L_},configure:function(t,{graph:e,data:s}){function i(y,b,v=y.getNodes()){return b?b instanceof Pi?b:y.getNodes(b):v}const n={...Lh,...t,nodeList:t.nodes};n.direction=t.direction||Lh.direction,n.layerSeparation=n.levelDistance,n.nodesSeparation=n.nodeDistance,n.componentsSeparation=n.componentDistance,n.gapDistance=n.gapWidth,n.packing=n.arrangeComponents;const r=t.decross!==!1,o={...n},a=n.edges,l=n.nodeList;if(["TB","BT","LR","RL"].indexOf(n.direction)===-1)throw new Error('direction should be one of the "TB", "BT", "LR", "RL"');if(["fit","grid","singleLine"].indexOf(n.packing)===-1)throw new Error('arrangeComponents should be one of the "fit", "grid", "singleLine"');n.nodesGridSeparation=t.gridDistance||Lh.gridDistance;const d=l.getId(),h=l.getAttribute("layoutable").reduce(((y,b,v)=>(y[d[v]]=b,y)),{}),u=l.getAttributes(["x","y"]).reduce(((y,b,v)=>(y[d[v]]=b,y)),{}),c=t.rs?t.rs:l.getAttribute("radius");if(typeof o.layer!="string")throw new Error("'layer' should be the valid data field name");if(o.siblingIndex===void 0&&(o.siblingIndex=""),typeof o.siblingIndex!="string")throw new Error("'siblingIndex' should be the valid data field name");const g=i(e,n.roots,e.nodeList()),m=s.getProperty(n.nodeList,o.layer),f=o.siblingIndex.length?s.getProperty(n.nodeList,o.siblingIndex):[],p=g.map((y=>{let b=-1;return n.nodeList.forEach(((v,A)=>{v===y&&(b=A)})),b}));for(const y of p)m[y]=0;const _=i(e,n.sinks,e.nodeList()).toArray().reduce(((y,b)=>(y[b.getId()]=!0,y)),{}),x=d.map((y=>_[y]));return{nodes:d,edges:a.map((y=>({id:y.getId(),source:y.getSource().getId(),target:y.getTarget().getId()}))),decross:r,options:cd(n),layoutable:h,radiuses:c,siblingIndexes:f,layers:m,sinks:x,coords:u}},context:ae,update:function({nodes:t,edges:e,options:s,layoutable:i,radiuses:n,layers:r,siblingIndexes:o,decross:a,sinks:l,coords:d}){const h=e.filter((({source:g,target:m})=>g in i&&m in i)),u={nodes:t.map(((g,m)=>({id:g,radius:n[m],layer:r[m],siblingIndex:o[m],sink:l[m],layoutable:i[g],x:d[g].x,y:d[g].y}))),edges:h},{nodes:c}=L_(u,{packing:{fit:"fit",singleLine:"singleline",grid:"grid"}[s.arrangeComponents],direction:{TB:"down",BT:"up",RL:"left",LR:"right"}[s.direction],layerSeparation:s.layerSeparation,nodesSeparation:s.nodesSeparation,shouldDecross:s.decross,sortSiblings:o.length>0,componentsSeparation:s.componentsSeparation,nodesGridSeparation:s.nodesGridSeparation,evenDistribution:s.evenDistribution});return{positions:c}},isRunning:function(){return!1},onSync:function({positions:t},{graph:e}){return{indexes:t.map((({id:s})=>(e.getNode(s)||{_index:-1})._index)),x:t.map((({x:s})=>s)),y:t.map((({y:s})=>s))}}},OO=t=>(t.modules.layouts.register(rc),(e={})=>(e.useWebWorker=!1,t.modules.layouts.start(rc.name,e))),oc=(t,e)=>t-e,I_={name:"radial",imports:{minHeap:yd,bellmanFord:Pc,dijkstra:zc,johnson:du,distance:Ze,circleCircleIntersection:Oc,circleSortCompare:Bc,weightedStress:zx,distanceStress:Dx,constrainedStress:au,stressMinimizationStep:lu,removeRadialOverlap:uu,linear:ed,calculateRadii:pm},configure(t,{graph:e}){let s=t.nodes;const i=s.size;function n(A,S){return A!=null&&isFinite(A)?A:S}if(t.centralNode===void 0)throw new Error('radial layout: missing parameter "centralNode"');const r=e.getNode(t.centralNode);if(r===void 0)throw new Error('radial layout: parameter "centralNode" is not valid');t.radiusRatio=n(t.radiusRatio,Math.SQRT2),t.radiusDelta=n(t.radiusDelta,0),t.nodeGap=n(t.nodeGap,10),t.repulsion=i*n(t.repulsion,1);const o=r.getPosition(),a=n(t.centerX,o.x),l=n(t.centerY,o.y),d=r._index;s.includes(r)||(s=s.concat(r.toList()));let h=s._indexes;const u=s.getAttribute("layoutable");h=h.filter(((A,S)=>u[S]||A===d)),h.sort(oc);const c=h.length,g=BO(h,e.getConnectedComponents(s,{internalIndexes:!0}),d),m=e.degrees(h),f=new Float32Array(t.xs?t.xs:e.getNodeAttribute("x").getMultiple(h)),p=new Float32Array(t.ys?t.ys:e.getNodeAttribute("y").getMultiple(h)),_=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(h),x=e.getEdges()._indexes,y=e.getEdgeAttribute("source").getMultiple(x),b=e.getEdgeAttribute("target").getMultiple(x),v=e.getAdjacencyList({internalIndexes:!0,weight:1,indexes:h});return{centerIndex:d,centerIndexPos:0,cx:a,cy:l,D:null,indexes:h,components:g,normIndexes:null,radii:null,rings:null,x:f,y:p,degree:m,size:c,attributes:{size:_,adjacency:v,weights:b.map((()=>1)),sources:y,targets:b},sortAttr:null,allowOverlap:!!t.allowOverlap,nodeGap:t.nodeGap,radiusRatio:t.radiusRatio,radiusDelta:t.radiusDelta,repulsion:t.repulsion,randomize:!("randomize"in t)||!!t.randomize,renderSteps:!!t.renderSteps,epsilon:n(t.epsilon,.001),maxSteps:n(t.maxIterations,100),iterationsPerRender:n(t.iterationsPerRender,20),step:-1,stress:Number.POSITIVE_INFINITY,prevStress:0,converged:!1,overlapRemoved:!1,done:!1}},context:()=>({data:null,gridPlacement(t,e,s=8){const i=t.length,n=new Float32Array(i),r=new Float32Array(i);let o=0;for(let c=0,g=t.length;c<g;c++){const m=e[t[c]];m>o&&(o=m)}const a=o*s,l=Math.ceil(Math.sqrt(i)),d=Math.ceil(i/l),h=-Math.floor((d-1)*a/2),u=-Math.floor((l-1)*a/2);for(let c=0;c<l;c++)for(let g=0;g<d;g++)n[c*d+g]=h+g*a,r[c*d+g]=u+c*a;return{x:n,y:r}},connectComponents(t,e,s,i,n,r){let o;function a(l,d){const h=new Uint32Array(l.length+1);return h.set(l),h[l.length]=d,h}for(let l=1;l<t.length;l++){const d=t[l];let h=0,u=0;d.forEach(((m,f)=>{const p=n.get(m);p!=null&&p>h&&(u=f,h=p)})),o=d[u];const c=e[r.get(o)];c.weights=c.weights||[],c.nodes=a(c.nodes,s),c.weights.push(i);const g=e[r.get(s)];g.weights=g.weights||[],g.nodes=a(g.nodes,o),g.weights.push(i)}},correctSubgraphsDistances(t,e,s,i,n){const r=Array.prototype.reduce.call(t[s],((a,l,d)=>(d!==s&&l<i&&l>a&&(a=l),a)),0),o=i-r-1;for(let a=1;a<e.length;a++){const l=e[a];for(let d=0,h=l.length;d<h;d++){const u=n.get(l[d]);u!=null&&(t[s][u]-=o,t[u][s]-=o)}}},initialize(t,e){t.data=e,e.step=0;const s=new Map,i=new Map;e.normIndexes=e.indexes.reduce(((d,h,u)=>(d[u]=u,s.set(h,u),i.set(h,e.degree[u]),t.data&&h===e.centerIndex&&(t.data.centerIndexPos=u),d)),new Uint32Array(e.indexes.length));const n=e.centerIndexPos,r=e.components[0].length;t.connectComponents(e.components,e.attributes.adjacency,e.centerIndex,r,i,s);const o=du({sources:e.attributes.sources,targets:e.attributes.targets,weights:e.attributes.weights,indexes:e.indexes,adjacency:e.attributes.adjacency,undirected:!0});t.correctSubgraphsDistances(o,e.components,n,r,s),e.D=o;const a=o[n],l={};for(let d=0,h=e.normIndexes.length;d<h;d++)if(d!==n){const u=a[d];l[u]=l[u]||[],l[u].push(e.normIndexes[d])}e.rings=l,e.radii=pm(n,e.rings,e.attributes.size,e.nodeGap,e.radiusRatio,e.radiusDelta)},removeOverlaps(t,e){if(!t.data)return;const s=t.data.centerIndexPos,i=e.attributes.size,{rings:n,radii:r}=e,o=e.x[s],a=e.y[s];for(const l in n){const d=n[l];for(let h=0;h<d.length;h++){const u=d[h],c=r[l];let g=e.x[u]-o,m=e.y[u]-a;g+m===0&&(g=Math.sin(u)*Math.random()*.001,m=Math.cos(u)*Math.random()*.001);const f=Math.sqrt(g*g+m*m),p=c;if(f-p<0){const _=p/f;e.x[u]=o+g*_,e.y[u]=a+m*_}}}for(const l in n){const d=n[l],h=Ze(o,a,e.x[d[0]],e.y[d[0]]);uu({X:e.x,Y:e.y,sizes:i,indexes:d,center:[o,a],R:h,gap:e.nodeGap,inPlace:!0})}}}),update(t,e){t||(t=e.data);const s=t.indexes,i=t.centerIndex;let n;t.x=t.x||new Float32Array(t.size),t.y=t.y||new Float32Array(t.size),t.step===-1&&e.initialize(e,t);const r=t.repulsion,o=a=>t.radii&&t.radii[a]||1;if(t.step===0&&t.randomize&&(n=e.gridPlacement(t.indexes,t.attributes.size),t.x=n.x,t.y=n.y),!t.converged){const a=t.maxSteps,l=t.iterationsPerRender;let d=t.step;const h=Math.min(d+l,a),{D:u,x:c,y:g,size:m,centerIndexPos:f,normIndexes:p}=t;for(;d<=h&&!t.converged;){const _=ed(Math.min(d,a)/a);t.step=d++,n=lu(u,c,g,m,f,r,_,p,o),t.x=n.x,t.y=n.y,t.prevStress=t.stress,t.stress=au(u,c,g,m,f,r,_,p),t.converged=t.converged||Math.abs(t.stress-t.prevStress)<=t.epsilon}}if(t.converged)if(t.overlapRemoved||t.allowOverlap){t.done=!0;const a=t.rings||{};t.rings=Object.keys(a).reduce(((l,d)=>(l[d]=a[d].map((h=>s[h])),l)),{})}else e.removeOverlaps(e,t,i),t.overlapRemoved=!0;return t},isRunning:({data:t})=>!(!t||t.converged&&(t.allowOverlap||t.done))||(t&&(t.step=-1),!1),onSync(t){if(t.renderSteps||t.done)return M_(t)},onEnd:t=>M_(t)};function M_(t){const e=t.x,s=t.y,i=t.indexes.length,n=e[t.centerIndexPos]-t.cx,r=s[t.centerIndexPos]-t.cy;for(let o=0;o<i;o++)e[o]-=n,s[o]-=r;return{indexes:t.indexes,x:e,y:s}}function BO(t,e,s){const i=t.slice().sort(oc),n=[];for(let r=0,o=e.length;r<o;r++){const a=[],l=e[r];let d=!1;for(let h=0,u=l.length;h<u;h++){const c=l[h];Sy(i,c)!==-1&&(c===s&&(d=!0),a.push(c))}a.length!==0&&n[d?"unshift":"push"](a.sort(oc))}return n}var UO=t=>(t.modules.layouts.register(I_),e=>{if(e.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');if(e.maxIterations=e.maxIterations&&isFinite(e.maxIterations)?Math.floor(e.maxIterations):100,e.maxIterations<1)throw new RangeError("maxIterations must be a positive integer");if(e.iterationsPerRender=e.iterationsPerRender&&isFinite(e.iterationsPerRender)?Math.floor(e.iterationsPerRender):20,e.iterationsPerRender<1)throw new RangeError("iterationsPerRender must be a positive integer");if(e.epsilon=e.epsilon&&isFinite(e.epsilon)?e.epsilon:.001,e.epsilon<=0)throw new RangeError("epsilon has to be a positive number");return t.modules.layouts.start(I_.name,e)}),N_={...rc,name:"sequential"},GO=t=>(t.modules.layouts.register(N_),(e={})=>{e.useWebWorker=!1;const s={...e,evenDistribution:!0};return t.modules.layouts.start(N_.name,s)}),VO=class extends Ce{constructor(t){super(t),this.stop=()=>this._ogma.modules.layouts.stop(),this.concentric=qD(t),this.radial=UO(t),this.force=Zk(t),this.forceLink=Kk(t),this.hierarchical=OO(t),this.sequential=GO(t),this.grid=Qk(t)}},qO=class extends Ce{constructor(){super(...arguments),this.move=t=>this._ogma.modules.virtualMouse.move(t),this.down=t=>this._ogma.modules.virtualMouse.down(t),this.up=t=>this._ogma.modules.virtualMouse.up(t),this.click=t=>this._ogma.modules.virtualMouse.click(t),this.rightClick=t=>this._ogma.modules.virtualMouse.rightClick(t),this.doubleclick=t=>this._ogma.modules.virtualMouse.doubleclick(t),this.drag=(t,e)=>this._ogma.modules.virtualMouse.drag(t,e),this.wheel=t=>this._ogma.modules.virtualMouse.wheel(t)}},HO=class extends Ce{constructor(){super(...arguments),this.map=t=>this._ogma.modules.rules.createMapping(t),this.slices=t=>this._ogma.modules.rules.createSlices(t),this.template=t=>this._ogma.modules.rules.createTemplate(t)}},jO=class extends Ce{constructor(){super(...arguments),this.watchNodeObjectProperty=t=>this._ogma.modules.watcher.watchNodeObjectProperty(t),this.watchEdgeObjectProperty=t=>this._ogma.modules.watcher.watchEdgeObjectProperty(t),this.watchNodeNonObjectProperty=t=>this._ogma.modules.watcher.watchNodeNonObjectProperty(t),this.watchEdgeNonObjectProperty=t=>this._ogma.modules.watcher.watchEdgeNonObjectProperty(t)}},YO=class{clearSelection(){return this.modules.selection.clear()}getSelectedNodes(){return this.modules.selection.getSelectedNodes()}getNonSelectedNodes(){return this.modules.selection.getNonSelectedNodes()}getSelectedEdges(){return this.modules.selection.getSelectedEdges()}getNonSelectedEdges(){return this.modules.selection.getNonSelectedEdges()}},XO=class{setOptions(t){return this.modules.settings.update(t)}getOptions(){return this.modules.settings.get()}},WO=class extends Ce{constructor(){super(...arguments),this.setNodesVisibility=t=>this._ogma.modules.graphics.setNodesVisibility(t),this.setEdgesVisibility=t=>this._ogma.modules.graphics.setEdgesVisibility(t),this.setNodeTextsVisibility=t=>this._ogma.modules.graphics.setNodeTextsVisibility(t),this.setEdgeTextsVisibility=t=>this._ogma.modules.graphics.setEdgeTextsVisibility(t),this.addRule=(t={})=>this._ogma.modules.styleRules.addRule(t),this.getRuleList=()=>this._ogma.modules.styleRules.getRuleList(),this.addNodeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({nodeAttributes:s,nodeSelector:i})},this.addEdgeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({edgeAttributes:s,edgeSelector:i})},this.getNodeRules=()=>this.getRuleList().filter((t=>t.getDefinition().edgeAttributes===void 0)),this.getEdgeRules=()=>this.getRuleList().filter((t=>t.getDefinition().nodeAttributes===void 0)),this.createClass=t=>this._ogma.modules.classes.createClass(t),this.getClass=t=>this._ogma.modules.classes.getClassByName(t),this.getClassList=()=>this._ogma.modules.classes.getClassList(),this.setHoveredNodeAttributes=(t,e)=>{this._ogma.modules.hover.updateNodeAttributes(t,e)},this.setHoveredEdgeAttributes=(t,e)=>{this._ogma.modules.hover.updateEdgeAttributes(t,e)},this.setHoveredEdgeExtremitiesAttributes=(t,e)=>this._ogma.modules.hover.setEdgeExtremitiesAttributes(t,!!e),this.setSelectedNodeAttributes=(t,e)=>this._ogma.modules.selection.setNodeAttributes(t,!!e),this.setSelectedEdgeAttributes=(t,e)=>this._ogma.modules.selection.setEdgeAttributes(t,!!e),this.setSelectedEdgeExtremitiesAttributes=(t,e)=>this._ogma.modules.selection.setEdgeExtremitiesAttributes(t,!!e),this.setTheme=({nodeAttributes:t,edgeAttributes:e,selectedNodeAttributes:s,selectedEdgeAttributes:i,selectedEdgeExtremitiesAttributes:n,hoveredNodeAttributes:r,hoveredEdgeAttributes:o,hoveredEdgeExtremitiesAttributes:a})=>{this._ogma.modules.pulses.setTheme(t&&t.pulse||{},e&&e.pulse||{}),this._ogma.modules.graphics.getAttributesManager().setDefaultAttributes(t||{},e||{}),this.setSelectedNodeAttributes(s||{}),this.setSelectedEdgeAttributes(i||{}),this.setHoveredNodeAttributes(r||{}),this.setHoveredEdgeAttributes(o||{}),this.setHoveredEdgeExtremitiesAttributes(a||{}),this.setSelectedEdgeExtremitiesAttributes(n||{})},this.fontSizeToBadgeScale=iv}},$O=class extends Ce{constructor(){super(...arguments),this.set=(t,e)=>this._ogma.modules.brand.set(t,e),this.remove=()=>{this._ogma.modules.brand.remove()}}},ZO=class extends Ce{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.connectNodes.enable(t),this),this.disable=()=>(this._ogma.modules.connectNodes.disable(),this),this.enabled=()=>this._ogma.modules.connectNodes.enabled()}},KO=class extends Ce{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.lasso.enable(t),this),this.disable=()=>(this._ogma.modules.lasso.disable(),this),this.enabled=()=>this._ogma.modules.lasso.enabled()}},QO=class extends Ce{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.legend.enable(t),this.disable=()=>this._ogma.modules.legend.disable(),this.enabled=()=>this._ogma.modules.legend.enabled(),this.getOptions=()=>this._ogma.modules.legend.getOptions(),this.export=t=>this._ogma.modules.legend.export(t)}},JO=class extends Ce{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rectangleSelect.enable(t)},this.disable=()=>{this._ogma.modules.rectangleSelect.disable()},this.enabled=()=>this._ogma.modules.rectangleSelect.enabled()}},tB=class extends Ce{constructor(){super(...arguments),this.enable=t=>{this._ogma.modules.resizing.enable(t)},this.disable=()=>{this._ogma.modules.resizing.disable()},this.enabled=()=>this._ogma.modules.resizing.enabled()}},eB=class extends Ce{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rewiring.enable(t)},this.disable=()=>{this._ogma.modules.rewiring.disable()},this.enabled=()=>this._ogma.modules.rewiring.enabled()}},sB=class extends Ce{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.snapping.enable(t)},this.disable=()=>{this._ogma.modules.snapping.disable()},this.enabled=()=>this._ogma.modules.snapping.enabled()}},iB=class extends Ce{constructor(){super(...arguments),this.onNodeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.node",t,e)},this.onNodeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.node",t,e)},this.onNodeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.node",t,e)},this.onNodeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.node",t,e)},this.onEdgeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.edge",t,e)},this.onEdgeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.edge",t,e)},this.onEdgeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.edge",t,e)},this.onEdgeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.edge",t,e)},this.onBackgroundClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.background",t,e)},this.onBackgroundRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.background",t,e)},this.onBackgroundDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.background",t,e)},this.refresh=()=>this._ogma.modules.tooltip.refresh(),this.isShown=()=>this._ogma.modules.tooltip.isShown(),this.hide=()=>{this._ogma.modules.tooltip.hide()},this.show=(t,e)=>this._ogma.modules.tooltip.show(t,e)}},nB=class extends Ce{constructor(t){super(t),this.lasso=new KO(t),this.connectNodes=new ZO(t),this.legend=new QO(t),this.rectangleSelect=new JO(t),this.resize=new tB(t),this.rewire=new eB(t),this.snapping=new sB(t),this.tooltip=new iB(t),this.brand=new $O(t)}},rB=class extends Ce{constructor(t){super(t),this.getList=()=>this._ogma.modules.transformations.api.getList(),this.clear=()=>this._ogma.modules.transformations.api.clear().then((()=>{})),this.getById=e=>this._ogma.modules.transformations.api.getById(e),this.afterNextUpdate=()=>this._ogma.modules.transformations.afterNextUpdate(),this.onGroupsUpdated=e=>{this._ogma.modules.transformations.onGroupsUpdated(e)},this.layoutGroups=(e,s,i=!1)=>this._ogma.modules.transformations.api.layoutGroups(e,s,i),this.triggerGroupUpdated=e=>this._ogma.modules.transformations.triggerGroupUpdated(e),this.triggerGroupsUpdated=()=>this._ogma.modules.transformations.api.triggerGroupsUpdated()}addNodeGrouping(t){return this._ogma.modules.transformations.api.addNodeGrouping(t)}addNodeClustering(t){return this._ogma.modules.transformations.api.addNodeClustering(t)}addEdgeGrouping(t){return this._ogma.modules.transformations.api.addEdgeGrouping(t)}addDrillDown(t){return this._ogma.modules.transformations.api.addDrilldown(t)}addNodeFilter(t){return this._ogma.modules.transformations.api.addNodeFilter(t)}addEdgeFilter(t){return this._ogma.modules.transformations.api.addEdgeFilter(t)}getNodeFilters(){return this._ogma.modules.transformations.getNodeFilters()}getEdgeFilters(){return this._ogma.modules.transformations.getEdgeFilters()}addNeighborGeneration(t){return this._ogma.modules.transformations.api.addNeighborGeneration(t)}addNeighborMerging(t){return this._ogma.modules.transformations.api.addNeighborMerging(t)}addNodeCollapsing(t){return this._ogma.modules.transformations.api.addNodeCollapsing(t)}addGeoClustering(t){return this._ogma.modules.transformations.api.addGeoClustering(t)}addVirtualProperties(t){return this._ogma.modules.transformations.api.addVirtualProperties(t)}getXYR(t){return this._ogma.modules.transformations.getXYR(t)}expandGroup({node:t,computeSubNodesPosition:e,onExpand:s}){return this._ogma.modules.transformations.api.fishEyeExpand(t,s,e)}collapseGroup({node:t,onCollapse:e}){return this._ogma.modules.transformations.api.fishEyeCollapse(t,e)}},oB=class extends Ce{constructor(){super(...arguments),this.setZoom=(t,e)=>this._ogma.modules.camera.setZoom(t,e),this.zoomIn=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomIn():this._ogma.modules.camera.zoomIn(t),this.zoomOut=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomOut():this._ogma.modules.camera.zoomOut(t),this.getZoom=()=>this._ogma.modules.camera.getZoom(),this.setCenter=(t,e)=>this._ogma.modules.camera.setCenter(t,e),this.move=(t,e)=>this._ogma.modules.camera.move(t,e),this.moveToBounds=(t,e)=>{if(!(t&&t instanceof Cs)){if(!as(t)||t.length!==4)throw new Error("ogma.view.zoomToBounds requires a BoundingBox as a parameter");{const[s,i,n,r]=t;t=Cs.from({minX:s,minY:i,maxX:n,maxY:r})}}return this._ogma.modules.camera.moveToBounds(t,e)},this.moveTo=(t,e)=>this._ogma.modules.camera.moveTo(t,e),this.getCenter=()=>this._ogma.modules.camera.getCenter(),this.setAngle=(t,e)=>this._ogma.modules.camera.setAngle(t,e),this.rotate=(t,e)=>this._ogma.modules.camera.rotate(t,e),this.getAngle=()=>this._ogma.modules.camera.getAngle(),this.set=(t,e)=>this._ogma.modules.camera.setView(t,e),this.get=()=>this._ogma.modules.camera.getView(),this.graphToScreenCoordinates=t=>this._ogma.modules.camera.graphToScreenCoordinates(t),this.screenToGraphCoordinates=t=>this._ogma.modules.camera.screenToGraphCoordinates(t),this.getImageData=()=>this._ogma.modules.graphics.getImageData(),this.getElementAt=t=>this._ogma.modules.captor.detectElementAt(t.x,t.y,!1,!0),this.getElementsInView=()=>{const{width:t,height:e}=this.get(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return this._ogma.modules.spatial.query(s.x,s.y,i.x,i.y)},this.getBounds=()=>{const{width:t,height:e}=this.getSize(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return{cx:(s.x+i.x)/2,cy:(s.y+i.y)/2,width:i.x-s.x,height:i.y-s.y,minX:s.x,minY:s.y,maxX:i.x,maxY:i.y}},this.getElementsInside=(t,e,s,i,n=!0)=>{const{spatial:r,camera:o}=this._ogma.modules;if(n){const a=o.graphToScreenCoordinates({x:t,y:e}),l=o.graphToScreenCoordinates({x:s,y:i});return r.queryProjected(a.x,a.y,l.x,l.y)}return r.queryProjected(t,e,s,i)},this.beforeNextFrame=()=>this._ogma.modules.dom.beforeNextFrame(),this.afterNextFrame=()=>this._ogma.modules.dom.afterNextFrame(),this.setFullScreen=t=>this._ogma.modules.dom.setFullScreen(t),this.isFullScreen=()=>this._ogma.modules.dom.isFullScreen(),this.forceResize=()=>this._ogma.modules.dom.forceResize(),this.getSize=()=>this._ogma.modules.dom.getDimensions(),this.setSize=t=>{if(!t||isNaN(t.width)||isNaN(t.height))throw new Error("Size must follow the format { width: number, height: number }");if(t.width<0)throw new Error("width must be positive");if(t.height<0)throw new Error("height must be positive");return this._ogma.modules.dom.setDimensions(t),Promise.resolve()},this.locateGraph=t=>this._ogma.modules.locate.locateGraph(t),this.locateRawGraph=(t,e)=>this._ogma.modules.locate.locateRawGraph(t,e),this.getGraphBoundingBox=({withTexts:t=!1}={})=>this._ogma.modules.locate.getGraphBoundingBox(t),this.animationInProgress=()=>this._ogma.modules.locate.isLocating()||this._ogma.modules.camera.animationInProgress(),this.getTextBoundingBox=t=>{if(!t)throw new Error("ogma.view.getTextBoundingBox: item must be a Node or an Edge");const e=t.getAttribute("text"),s=this._ogma.modules.labels;return e==null||e===""?null:t.isList?t.isNode?void s.getTextsBoundingBox(t):s.getTextsBoundingBox(void 0,t):t.isNode?s.getTextsBoundingBox(t.toList()):s.getTextsBoundingBox(void 0,t.toList())},this.getNodeBadgeAt=(t,e)=>{if(!t)throw new Error("ogma.view.getNodeBadgeAt: node is not defined");return $0(e,t._index,this._ogma.modules.graphics.getAttributesManager(),this._ogma.modules.camera,this._ogma.modules.graphics.getGraphicsEngine())}}},aB=class{constructor(t,e){this._ogma=t,this.settings=new IN(t),this.events=new TN(t),this.dom=new gT(t),this.animations=new cR(t),this.camera=new cN(t),this.graph=new zT(t),this.data=new pT(t),this.graphics=new xN(t),this.layers=new KP(t),this.individualAttributes=new LN(t),this.algorithms=new QP(t),this.position=new GP(t),this.touch=new eR(t),this.mouse=new JN(t),this.virtualMouse=new tF(t),this.spatial=new GN(t),this.captor=new zF(t),this.interactions=new CF(t),this.classes=new FN(t),this.cameraInteractions=new lN(t,!!e.debug),this.hover=new UP(t),this.keyboard=new eP(t),this.selection=new nR(t),this.styleRules=new rF(t),this.legend=new OP(t),this.sync=new rR(t),this.rules=new XP(t),this.transformations=new sR(t),this.locate=new $N(t),this.drag=new DF(t),this.pulses=new dR(t),this.curvatureManager=new IR(t),this.workers=new OR(t),this.layouts=new HR(t),this.watcher=new $R(t),this.rectangleSelect=new oF(t),this.labels=new TF(t,e),this.brand=new CR(t),this.lasso=new uE(t),this.rewiring=new OF(t),this.resizing=new BF(t),this.snapping=new eF(t),this.connectNodes=new GF(t),this.tooltip=new XF(t),this.geo=new LR(t),Object.keys(this).forEach((s=>{const i=this[s];i instanceof te&&(i._setModules(this),i.onMounted())})),t.onReady((()=>{Object.keys(this).forEach((s=>{const i=this[s];i instanceof te&&i.onReady(e)}))}))}destroy(){Object.keys(this).forEach((t=>{const e=this[t];e instanceof te&&e.destroy(this._ogma)}))}},lB=1,dB=[ez,tz,rz,c1,BD,YO,XO],ac={version:"5.3.8",commit:"aff4ac91d",buildTime:"Fri Dec 05 2025 16:07:05 GMT+0000 (Coordinated Universal Time)"},nr=class lc{constructor(e={}){this.node=s=>new si(s,this),this.edge=s=>new nn(s,this),this.nodeList=s=>new Pi(s||new Uint32Array(0),this),this.edgeList=s=>new Un(s||new Uint32Array(0),this),this._onReady=[],this.build=ac,this._init(e)}static{this.libraries=mx}static{this.geometry=Qv}static{this.parse=Ag}_init(e){this._initParameters=e,this._debug=!!e.debug,this._token=lB++,this.modules=new aB(this,e),this.styles=new WO(this),this.algorithms=new JP(this),this.export=new lD(this),this.keyboard=new GD(this),this.generate=new kD(this),this.layouts=new VO(this),this.parse=new UD(this),this.transformations=new rB(this),this.tools=new nB(this),this.view=new oB(this),this.mouse=new qO(this),this.events=new oz(this),this.schema=new jO(this),this.rules=new HO(this),this.geo=new OD(this),this.layers=new VD(this),this.debug=new nz(this),this._onReady.forEach((s=>s(this))),this.safelyBindToInstance(),this.modules.events.register(["destroy"]),this.build={version:"5.3.8",commit:"aff4ac91d",buildTime:"Fri Dec 05 2025 16:07:05 GMT+0000 (Coordinated Universal Time)"}}safelyBindToInstance(){for(const e of Object.getOwnPropertyNames(lc.prototype))typeof lc.prototype[e]=="function"&&(this[e]=this[e].bind(this))}onReady(e){this._onReady.push(e)}_destroy(){if(!this._token)throw new Error('"destroy" called twice on the same instance of Ogma');this._onReady=[],this.modules.destroy(),this.modules=null}destroy(){this.modules.events.fire("destroy",{}),this._destroy()}isDestroyed(){return!this.modules}reset(){const e=this._initParameters;this._destroy(),this._init(e)}isDebug(){return this._debug}static{this.build=ac}static{this.algorithms=Fc}static{this.utils=ug}};nr.algorithms=Fc,nr.utils=ug,nr.parse=Ag,nr.build=ac,QS(nr,dB);var Il=nr,bs=(t=>(t.NodeFilter="node-filter",t.EdgeFilter="edge-filter",t.NodeCollapsing="node-collapsing",t.VirtualProperties="virtual-properties",t.NeighborGeneration="neighbor-generation",t.NeighborMerging="neighbor-merging",t.NodeGrouping="node-grouping",t.EdgeGrouping="edge-grouping",t.NodeClustering="node-clustering",t.GeoClustering="geo-clustering",t.Unknown="unknown",t))(bs||{}),mn=class{constructor({id:t,duration:e,easing:s,ogma:i,module:n}){this.animation=s?{duration:e,easing:s}:e===void 0?0:e,this.destroyed=!1,this.id=t,this.ogma=i,this.context={},this.module=n,this.resetContext()}setOptions(t){var e;let s=typeof this.animation=="number"?this.animation:(e=this.animation)==null?void 0:e.duration,i=typeof this.animation=="object"?this.animation.easing:void 0;return typeof t.duration=="number"&&(s=t.duration),t.easing!==void 0&&(i=t.easing),this.animation=i?{duration:s,easing:i}:s===void 0?0:s,this.module.setOptions(this),this.module.afterNextUpdate()}enable(t){return this.animation=t===void 0?this.animation:t,this.module.enable(this)}disable(t){return this.animation=t===void 0?this.animation:t,this.module.disable(this)}isEnabled(){return this.module.isEnabled(this)}getId(){return this.id}whenApplied(){return this.module.afterNextUpdate().then((()=>this))}toggle(t){return this.animation=t===void 0?this.animation:t,this.isEnabled()?this.module.disable(this):this.module.enable(this)}run(t=!0){return Promise.resolve()}undo(t=!0){return Promise.resolve()}cleanup(){return this.resetContext(),Promise.resolve()}refresh(){return this.module.refreshTransformation(this),this.module.afterNextUpdate()}getIndex(){return this.module.getIndex(this)}setIndex(t){return this.module.setIndex(this,t),this.module.afterNextUpdate()}getAnimation(){return typeof this.animation=="number"?{duration:this.animation,easing:"linear"}:this.animation}getContext(){return this.context}setContent(t){this.context=t}resetContext(){this.context={}}getName(){return bs.Unknown}destroy(t){return t!==void 0&&(this.animation=t),this.module.remove(this)}},hB=class{constructor(t){this.xs=new Map,this.ys=new Map,this.rs=new Map,this.curvatures=new Map,this.hiddenNodes=new Set,this.hiddenEdges=new Set,this.animations=[],this.before=[],this.after=[],this.applying=!1,this._onNodesRemoved=e=>{const s=e.nodes._indexes;for(const i of s)this.xs.delete(i),this.ys.delete(i),this.rs.delete(i)},this.ogma=t,this.afterMod={nodesToHide:new Set,edgesToHide:new Set},this.layer=this.ogma.modules.graphics.addAttributeLayer({name:"ogma-transformations-animations",priority:5.99999,nodeOutput:{attributes:["radius"]},edgeOutput:{attributes:["curvature"]},nodeDependencies:void 0,edgeDependencies:void 0}),this.attributeLayerData=this.layer._attributesManager._getLayerById(this.layer._id),this.initEvents()}initEvents(){this.ogma.events.on("removeNodes",this._onNodesRemoved)}apply(t){const e=Array.from(this.xs.values()),s=Array.from(this.ys.values()),i=Array.from(this.rs.values()).map((u=>({radius:u}))),n=Array.from(this.curvatures.values()).map((u=>({curvature:u}))),r=this.ogma.nodeList(Array.from(this.hiddenNodes)),o=this.ogma.edgeList(Array.from(this.hiddenEdges)),a=e.map(((u,c)=>({x:u,y:s[c]}))),l=this.ogma.nodeList(Array.from(this.xs.keys())),d=this.ogma.nodeList(Array.from(this.rs.keys())),h=this.ogma.edgeList(Array.from(this.curvatures.keys()));return this.xs.clear(),this.ys.clear(),this.rs.clear(),this.curvatures.clear(),this.hiddenNodes.clear(),this.hiddenEdges.clear(),this.before.forEach((u=>u())),this.initCurvature(h._indexes),this.applying=a.length>0||i.length>0||n.length>0,Promise.all([a.length?l.setAttributes(a,t):Promise.resolve(),i.length?this.ogma.modules.graphics.animate(d,(()=>this.layer.setAttributeValues(d,i)),!1,t):Promise.resolve(),n.length?this.ogma.modules.graphics.animate(h,(()=>this.layer.setAttributeValues(h,n)),!1,t):Promise.resolve(),...this.animations.map((u=>u()))]).then((()=>(this.ogma.nodeList(Array.from(this.afterMod.nodesToHide)).setVisible(!1),this.ogma.edgeList(Array.from(this.afterMod.edgesToHide)).setVisible(!1),Promise.all(this.after.map((u=>u())))))).then((()=>{this.deleteCurvatures(h._indexes),r.setVisible(!1),o.setVisible(!1),this.animations=[],this.before=[],this.after=[],this.afterMod.nodesToHide.clear(),this.afterMod.edgesToHide.clear(),this.applying=!1}))}setXYR(t,e,s,i){if(typeof t=="number")this.xs.set(t,e),this.ys.set(t,s),i!==void 0&&this.rs.set(t,i);else for(const n of t)this.xs.set(n,e),this.ys.set(n,s),i!==void 0&&this.rs.set(n,i)}getOpenRadius(t){return this.attributeLayerData.nodes.outputFlexArrays.radius.get(t)}getInputFlexArrays(){return this.attributeLayerData.nodes.inputFlexArrays}getCloseRadius(t){return this.attributeLayerData.nodes.inputFlexArrays.radius.get(t)}deleteOpenRadius(t){this.layer.getFlexArrays().nodes.radius.set(t,void 0)}initCurvature(t){const e=this.attributeLayerData.edges.inputFlexArrays.curvature,s=this.attributeLayerData.edges.outputFlexArrays.curvature;for(let i=0;i<t.length;i++)s.set(t[i],e.get(t[i]))}deleteCurvatures(t){const e=this.layer.getFlexArrays().edges.curvature;for(let s=0;s<t.length;s++)e.set(t[s],void 0)}hideNode(t){this.hiddenNodes.add(t)}showNode(t){this.hiddenNodes.delete(t)}hideNodes(t){for(const e of t)this.hiddenNodes.add(e)}showNodes(t){for(const e of t)this.hiddenNodes.delete(e)}hideEdge(t){this.hiddenEdges.add(t)}showEdge(t){this.hiddenEdges.delete(t)}hideEdges(t){for(const e of t)this.hiddenEdges.add(e)}showEdges(t){for(const e of t)this.hiddenEdges.delete(e)}pushBefore(t){Array.isArray(t)?this.before.push(...t):this.before.push(t)}pushAfter(t){Array.isArray(t)?this.after.push(...t):this.after.push(t)}setXY(t,e,s){this.xs.set(t,e),this.ys.set(t,s)}getXYR(t){const e=this.xs,s=this.ys,i=this.rs,n=t.getAttributes(["x","y","radius"]);for(let r=0;r<t.size;r++){const o=t._indexes[r];e.has(o)&&(n[r].x=e.get(o)),s.has(o)&&(n[r].y=s.get(o)),i.has(o)&&(n[r].radius=i.get(o))}return n}getXs(t){return this.getMapValues(t,"x",this.xs)}getYs(t){return this.getMapValues(t,"y",this.ys)}getRs(t){return this.getMapValues(t,"radius",this.rs)}getMapValues(t,e,s){const i=this.ogma.modules.graphics.getAttributesManager()._layerController.nodes._currentFlexArrays[e],n=new Array(t.size);for(let r=0;r<t.size;r++){const o=t._indexes[r];s.has(o)?n[r]=s.get(o):n[r]=i.get(o)}return n}setR(t,e){this.rs.set(t,e)}setRs(t,e){for(let s=0;s<t.length;s++)e[s]!==void 0&&this.rs.set(t[s],e[s])}setCurvatures(t,e){for(let s=0;s<t.length;s++)this.curvatures.set(t[s],e[s])}setCurvature(t,e){this.curvatures.set(t,e)}hideNodesAfter(t){for(let e=0;e<t.length;e++)this.afterMod.nodesToHide.add(t[e])}hideEdgesAfter(t){for(let e=0;e<t.length;e++)this.afterMod.edgesToHide.add(t[e])}setOpenRadius(t,e){this.attributeLayerData.nodes.outputFlexArrays.radius.set(t,e)}push(t){Array.isArray(t)?this.animations.push(...t):this.animations.push(t)}getMaxAnimation(t,e){return(typeof t=="number"?t:t.duration)>(typeof e=="number"?e:e.duration)?t:e}isApplying(){return this.applying}};function Tn(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function uB(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Ogma transformations: Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}function cB(t,e){const s=t.get(0);return{data:s.getData(),attributes:s.getAttributes(e)}}function ad(t,e){return`gen_grp_${e}_${t}`}function gB(t){return t.map((({id:e,source:s,target:i})=>({id:e,source:s,target:i})))}function mB(t,e,s,i){let n=e,r=s;return!i&&n.toString()>r.toString()&&(n=s,r=e),`${t}[${n}-${r}]`}function fB(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`Ogma transformation: ${t} is not a valid id, expected string or number`);return t}function cl(t){return`data.${t}`}var pB=class{constructor(t){this.groupsByDepth=new Map,this.treeMap=new Map,this.dataMap=new Map,this.invalidEdges=new Map,this.edges=new Map,this.ogma=t.ogma,this.module=t.module,this.enabled=t.enabled===void 0||t.enabled,this.onGetSubgraph=t.onGetSubgraph,this.duration=t.duration||0,this.easing=t.easing||"quadraticOut",this.parentPath=t.parentPath||"parent",this.depthPath=t.depthPath||"depth",this.padding=t.padding||0,this.nodeGenerator=t.nodeGenerator||(()=>({})),this.showContents=t.showContents===void 0||t.showContents,this.onGroupUpdate=t.onGroupUpdate||(()=>{}),this.copyData=t.copyData===void 0||t.copyData,this.context={virtualEdges:this.ogma.edgeList()}}createGrouping(t){var e;const{ogma:s,groupsByDepth:i}=this,n=s.transformations.addNodeGrouping({selector:o=>o.getData(this.depthPath)===t,groupIdFunction:o=>o.getData(this.parentPath),showContents:o=>typeof this.showContents=="boolean"?this.showContents:this.showContents(o,t),onBeforeAddMetaEdges:(o,a)=>this.addEdges(o,a),onGroupUpdate:(o,a,l)=>this.onGroupUpdate(o,a,l,t),padding:o=>typeof this.padding=="number"?this.padding:this.padding(o,t),duration:this.duration,enabled:this.enabled,nodeGenerator:(o,a)=>{const l=this.nodeGenerator(o,a,n);return this.copyData&&(l.data||(l.data={}),l.data={...l.data,...this.dataMap.get(a)}),Tn(l,cl(this.parentPath),this.treeMap.get(a)),Tn(l,cl(this.depthPath),t-1),l.id=a,l}});if(!i.size)return i.set(t,n);const r=Array.from(i.keys()).reduce(((o,a)=>Math.max(o,a)));i.set(t,n),n.setIndex((e=i.get(r))==null?void 0:e.getIndex())}async drill(t){if(this.treeMap.has(t.getId()))return;const{ogma:e,groupsByDepth:s}=this;try{e.modules.graphics.pauseRendering();const i=t.getId(),n=this.getGroupId(i);this.treeMap.set(n,t.getData(this.parentPath)),this.dataMap.set(n,t.getData());const r=t.getData(this.depthPath)||0,o=t.getPosition(),a=await this.onGetSubgraph(t);this.edges.set(n,t.getAdjacentEdges().map((d=>{const h=d.getSource().getId(),u=d.getTarget().getId();return{source:h===i?n:h,target:u===i?n:u,data:{...d.getData()}}}))),a.nodes.forEach((d=>{Tn(d,cl(this.parentPath),n),Tn(d,cl(this.depthPath),r+1),d.attributes||(d.attributes={}),d.attributes.x=o.x,d.attributes.y=o.y})),this.module.pause(),e.removeEdges(t.getAdjacentEdges()),e.removeNode(t),await e.view.afterNextFrame(),await e.addNodes(a.nodes);const l=a.edges.filter((d=>{const h=d.source,u=d.target;if(e.getNode(h)&&e.getNode(u))return!0;const c=e.getNode(h)?u:h;return this.invalidEdges.has(c)?this.invalidEdges.get(c).push(d):this.invalidEdges.set(c,[d]),!1}));a.nodes.forEach((d=>{if(!this.invalidEdges.has(d.id))return;const{valid:h,invalid:u}=this.invalidEdges.get(d.id).reduce(((c,g)=>(e.getNode(g.source)&&e.getNode(g.target)?c.valid.push(g):c.invalid.push(g),c)),{valid:[],invalid:[]});e.addEdges(h),u.length?this.invalidEdges.set(d.id,u):this.invalidEdges.delete(d.id)})),await e.addEdges(l),s.has(r+1)||this.createGrouping(r+1),this.module.resume(),e.modules.graphics.resumeRendering(),await this.module.afterNextUpdate()}catch(i){throw e.modules.graphics.resumeRendering(),i}}async addEdges(t,e){e.forEach((s=>{const i=this.edges.get(s.getId());i&&this.ogma.addEdges(i,{virtual:!0}).then((n=>{this.context.virtualEdges=this.context.virtualEdges.concat(n)}))}))}getGroupId(t){return`ogma-group-${t}`}getMaxDepth(){return this.groupsByDepth.size}disable(t){return this.enabled=!1,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach((e=>e.disable(t))),this.module.animations.hideEdges(this.context.virtualEdges._indexes),this.context.virtualEdges.setSelected(!0),this.module.afterNextUpdate()}enable(t){return this.enabled=!0,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach((e=>e.enable(t))),this.module.animations.showEdges(this.context.virtualEdges._indexes),this.module.afterNextUpdate().then((()=>this.context.virtualEdges.setVisible(!0)))}toggle(t){return this.enabled?this.disable(t):this.enable(t)}setOptions(t){this.onGetSubgraph=t.onGetSubgraph?t.onGetSubgraph:this.onGetSubgraph,this.duration=t.duration!==void 0?t.duration:this.duration,this.easing=t.easing||this.easing,this.parentPath=t.parentPath||this.parentPath,this.depthPath=t.depthPath||this.depthPath,this.padding=t.padding!==void 0?t.padding:this.padding,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.showContents=t.showContents!==void 0?t.showContents:this.showContents,this.onGroupUpdate=t.onGroupUpdate||this.onGroupUpdate,this.copyData=t.copyData!==void 0?t.copyData:this.copyData;const e=this.enabled;return this.enabled=t.enabled!==void 0?t.enabled:this.enabled,this.enabled!==e&&this.groupsByDepth.forEach((s=>this.enabled?s.enable({duration:this.duration,easing:this.easing}):s.disable({duration:this.duration,easing:this.easing}))),this.groupsByDepth.forEach((s=>s.refresh())),this.module.afterNextUpdate()}onRemove(t){this.context.virtualEdges=this.context.virtualEdges.filter((e=>!t.has(e._index)))}},_B=class{constructor(t){this.drilldowns=[],this.module=t}addDrilldown(t){this.drilldowns.push(t)}removeDrilldown(t){this.drilldowns=this.drilldowns.filter((e=>e!==t))}onRemove(t,e){e||this.drilldowns.forEach((s=>s.onRemove(t)))}},KE=2;function yB(t){return typeof t.then=="function"}var xB=class{constructor(t,e){this.relayouted=new Set,this.shouldRelayout=new Set,this.layoutPerGroup=new Map,this.nextLayout=new Map,this.nextOnGroupUpdate=null,this.onGroupsUpdate=()=>null,this._onLayoutPrepare=s=>{if(!s.params.nodes)return;const i=s.params.nodes,n=Array.isArray(i)?this.ogma.getNode(i[0])._index:i._indexes[0],r=this.module.nodeToMeta.get(n);if(!r)return;const o={...s,params:{...s.params}};delete o.params.nodes,delete o.params.groups,this.layoutPerGroup.set(r._index,o)},this.ogma=t,this.module=e,this.ogma.events.on("layoutPrepare",this._onLayoutPrepare)}getNodesToRecompute(t){const e=Array.from(t),s=new Set,i=[];for(;e.length>0;){const n=e.shift();if(s.has(n))continue;i.push(n),s.add(n);const r=this.module.nodeToMeta.get(n);r&&e.push(r._index)}return this.ogma.nodeList(i)}getLayoutFunction(t,e,s,i){const n=this.getNextLayout(e._index),r=this.ogma.modules.graphics.getAttributesManager()._layerController.nodes._currentFlexArrays,o={x:r.x.get(e._index),y:r.y.get(e._index)};return()=>{const a=n?n(e,s,i):t(e,s,i);return this._runLayout(a,s,o)}}_runLayout(t,e,s){let i;if(!t)return Promise.resolve(null);if(yB(t))i=t;else{if(!t)return;{const o=this.module.animations.getXs(e),a=this.module.animations.getYs(e),l=this.module.animations.getRs(e);i=this.ogma.layouts[t.layout]({...t.params,nodes:e,dryRun:!0,xs:o,ys:a,rs:l}).then((d=>d.positions.current))}}const n=this.module.animations,r=e._indexes;return i.then((o=>{if(!o)throw new Error("Ogma tansformations, onGroupUpdated callback should return either a layout or a promise containing  positions");let a=0,l=0;if(s){let d=-1/0,h=-1/0,u=1/0,c=1/0;for(let g=0;g<r.length;g++){const m=o[g];m&&(d=Math.max(d,m.x),h=Math.max(h,m.y),u=Math.min(u,m.x),c=Math.min(c,m.y))}a=s.x-(d+u)/2,l=s.y-(h+c)/2}for(let d=0;d<r.length;d++){const h=o[d];h&&(n.xs.set(r[d],h.x+a),n.ys.set(r[d],h.y+l))}}))}handleLayoutFunctions(t){const e=!!this.ogma.modules.layouts.enableBatching;e&&this.ogma.modules.layouts.enableBatching();const s=t.map((n=>n())),i=e?this.ogma.modules.layouts.runBatch():Promise.resolve();return Promise.all(s).then((()=>i))}async handleGlobalLayout(t,e){const s=this.getNextOnGroupUpdate(),i=s?s(t,e):this.onGroupsUpdate(t,e);await this._runLayout(i,t)}async layoutGroups(t,e,s=!1){const i=new Map,n=this.ogma.getNodes(t.map((({groupId:a})=>a)));t.forEach(((a,l)=>{i.set(a.groupId,(()=>this._runLayout(a,this.module.metaToNodes.get(n.get(l)._index))))}));const r=this.getNodesToRecompute(n._indexes),o=new Map;r.forEach((a=>o.set(a._index,this.module.nodeToTransformation.get(a._index).getIndex()))),r.sort(((a,l)=>o.get(a._index)-o.get(l._index)));for(let a=0;a<r.size;a++){const l=o.get(r._indexes[a]);let d;for(d=a+1;d<r.size&&o.get(r._indexes[d])===l;d++);const h=r.slice(a,d);a=d-1,await Promise.all(h.map((u=>{this.relayouted.add(u._index);let c=Promise.resolve();if(i.has(u.getId()))c=i.get(u.getId())();else if(s&&this.layoutPerGroup.has(u._index)){const g=this.module.metaToNodes.get(u._index),m=this.layoutPerGroup.get(u._index);c=this.ogma.layouts[m.name]({...m.params,nodes:g})}return c.then((()=>{this.module.groupController.setGroupXYR(u)}))})))}return await this.module.groupController.onAfterLayouts(),this.module.animations.apply(e||0).finally((()=>{this.relayouted.clear()}))}setNextLayout(t,e){this.nextLayout.set(t,e)}getNextLayout(t){const e=this.nextLayout.get(t);return this.nextLayout.delete(t),e}setNextOnGroupUpdate(t){this.nextOnGroupUpdate=t}getNextOnGroupUpdate(){const t=this.nextOnGroupUpdate;return this.nextOnGroupUpdate=null,t}hasRelayouted(t){return this.relayouted.has(t)}clear(){this.relayouted.clear(),this.shouldRelayout.clear()}},gl=14,bB=class{constructor(t,e){this.subNodeOffsetX=new Map,this.subNodeOffsetY=new Map,this.openRadius=new Map,this.isExpanding=new Set,this.alreadyGrouped=new Set,this.openGroups=new Set,this.closeGroups=new Set,this.fadedGroups=new Set,this.nodeGroupinCount=0,this.destroyed=!1,this.nodeLayer=new Map,this.edgeLayer=new Map,this.savedNodeLayer=new Map,this.savedEdgeLayer=new Map,this.padding=new Map,this.geoRadius=new Map,this.collapsedGroups=new Set,this.hasUpdated=new Set,this.shouldRunGroupUpdate=!1,this.runningLayouts=!1,this.onSetMultipleAttributes=({elements:i,values:n,options:r,updatedAttributes:o,promises:a})=>{if(this.module.isRefreshing()||this.destroyed||this.runningLayouts||this.module.animations.isApplying())return;const l=new Set(o),d=n;if(!i.isNode||!l.has("x")&&!l.has("y")&&!l.has("radius"))return Promise.resolve();const h=i.toList();if(!h.size)return Promise.resolve();const u=[],c=new Set,g=Array.from(h._indexes);for(;g.length;){const f=g.shift(),p=this.module.nodeToMeta.get(f);if(!p||c.has(p._index))continue;const _=this.getGroupXYR(p,this.module.getSubNodes(p),h,d);_.isGeo?u.push(p.setAttribute("radius",_.radius,r)):(delete _.isGeo,this.closeGroups.has(p._index)||this.collapsedGroups.has(p._index)?(this.openRadius.set(p._index,_.radius),this.module.animations.setXY(p._index,_.x,_.y)):this.module.animations.setXYR(p._index,_.x,_.y,_.radius),c.add(p._index)),g.push(p._index)}const m=h.map(((f,p)=>{if(!this.openGroups.has(f._index))return null;const _=f.getPosition();return Array.isArray(d)&&d[p]?(d[p].x!==void 0&&(_.x=d[p].x),d[p].y!==void 0&&(_.y=d[p].y)):(d.x!==void 0&&(_.x=d.x),d.y!==void 0&&(_.y=d.y)),{group:f,position:_}})).filter((f=>f));m.length&&m.forEach((({group:f,position:p})=>this.animateChildren(f,p))),(c.size>0||m.length)&&u.push(this.module.animations.apply(r)),a.push(...u)},this.ogma=t,this.layoutController=new xB(t,e),this.groupLayer=this.ogma.modules.graphics.addAttributeLayer({name:"groups-layer",priority:5.98,edgeAttributes:{layer:i=>this.edgeLayer.get(i._index)},nodeAttributes:{layer:i=>this.nodeLayer.get(i._index)},nodeDependencies:void 0,edgeDependencies:void 0});const s=t.styles.getClass("_group-fading_");this.fadingClass=s||this.ogma.styles.createClass({name:"_group-fading_",nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this.module=e,t.events.on("setMultipleAttributes",this.onSetMultipleAttributes).on("beforeGeoCameraMove",(({zoom:i})=>{const n=this.ogma.nodeList(Array.from(this.geoRadius.keys())).filter((r=>r&&!this.collapsedGroups.has(r._index)&&this.openGroups.has(r._index)));n.forEach((r=>{const o=this.geoRadius.get(r._index)*2**i;this.module.animations.setOpenRadius(r._index,o)})),this.ogma.modules.geo._projection&&this.ogma.modules.geo._projection.updateElements(n)})).on(["geoEnabled","beforeGeoDisabled"],(()=>this._onToggleGeo())).on("geoNodesMoved",(({nodes:i})=>{const n=i._indexes;for(let r=0;r<n.length;r++){const o=this.module.getMetaNode(i.get(r));!o||!this.openGroups.has(o._index)||this.layoutController.shouldRelayout.add(o._index)}}))}setSubEltsLayer(t,e,s){const i=s?KE:-2;if(!this.isOpen(t))return;const n=this.module.getSubNodes(t);n.forEach((o=>{this.nodeLayer.set(o._index,e+i),this.setSubEltsLayer(o,e+i,s)}));const r=n.getAdjacentEdges({bothExtremities:!0});for(let o=0;o<r.size;o++)this.edgeLayer.set(r._indexes[o],e+i)}setNodeGroupingCount(t){this.nodeGroupinCount=t}getNodeGroupingCount(){return this.nodeGroupinCount}updateGroupLayer(t,e){this.groupLayer.updateElements(t||this.ogma.getNodes()),this.groupLayer.updateElements(e||this.ogma.getEdges())}closeGroup(t,e,s,i,n=!1){const r=[e],o=this.closeGroups.has(t._index)||this.collapsedGroups.has(t._index);this.openGroups.delete(t._index),this.closeGroups.add(t._index),n?this.fadedGroups.add(t._index):this.fadedGroups.delete(t._index),this.hasUpdated.add(t._index);const a=this.module.animations,l=n?0:a.getCloseRadius(t._index),d=a.getOpenRadius(t._index);if(d!==void 0&&!o&&this.openRadius.set(t._index,d),a.setXYR(t._index,s,i,l),n)return;for(;r.length;){const u=r.shift(),c=u._indexes,g=u.getAdjacentEdges({bothExtremities:!0}),m=new Set;for(let p=0;p<g._indexes.length;p++)m.add(g._indexes[p]);const f=u.getAdjacentEdges({bothExtremities:!1}).filter((p=>!m.has(p._index)));a.setXYR(c,s,i,l),a.hideNodesAfter(c),a.hideEdgesAfter(g._indexes),a.hideEdgesAfter(f._indexes),a.pushAfter((()=>{const p=[];a.deleteOpenRadius(t._index);for(let _=0;_<c.length;_++){const x=this.closeGroups.has(c[_]);p.push(x?l:this.openRadius.get(c[_]))}this.module.animations.setRs(u._indexes,p)}));for(let p=0;p<c.length;p++){if(!this.openGroups.has(c[p]))continue;const _=u.get(p);this.collapsedGroups.add(_._index);const x=this.module.getSubNodes(u.get(p));x.size&&r.push(x)}}const h=this.module.getMetaNode(t);h&&this.openGroups.has(h._index)&&this.layoutController.shouldRelayout.add(h._index)}setGroupXYR(t){const e=this.getGroupXYR(t,this.module.getSubNodes(t),void 0,void 0);e.isGeo?(this.setGeoLatLng(t,e.y,e.x),this.module.animations.setR(t._index,e.radius)):this.module.animations.setXYR(t._index,e.x,e.y,e.radius)}setGeoLatLng(t,e,s){this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.latitudePath,e,{virtual:!0}),this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.longitudePath,s,{virtual:!0})}expandGroup(t,e,s=!1){const i=this.module.animations,n=t.getPosition(),r=this.fadedGroups.has(t._index);s?this.fadedGroups.add(t._index):(this.fadedGroups.delete(t._index),this.openGroups.add(t._index),this.closeGroups.delete(t._index),this.collapsedGroups.delete(t._index)),this.isExpanding.add(t._index),this.hasUpdated.add(t._index);const o=[{subNodes:e,offset:this.getOffset(t._index),isClosed:!1,wasCollapsed:!r}];for(;o.length;){const{subNodes:l,offset:d,isClosed:h,wasCollapsed:u}=o.shift();if((h||u)&&i.pushBefore((()=>l.setAttributes(n,0))),h)continue;const c=l._indexes,g=l.getAdjacentEdges({bothExtremities:!0,filter:"all"});l.setVisible(!0),g.setVisible(!0);for(let m=0;m<c.length;m++){const f=this.closeGroups.has(c[m]);i.setXYR(c[m],n.x+d.x+this.subNodeOffsetX.get(c[m])||0,n.y+d.y+this.subNodeOffsetY.get(c[m])||0,f?this.module.animations.getCloseRadius(c[m]):this.openRadius.get(c[m])),this.collapsedGroups.delete(c[m]);const p=this.module.getSubNodes(l.get(m));p.size&&o.push({subNodes:p,isClosed:f,wasCollapsed:u||this.collapsedGroups.has(c[m]),offset:{x:d.x+this.subNodeOffsetX.get(c[m])||0,y:d.y+this.subNodeOffsetY.get(c[m])||0}})}}const a=this.module.getMetaNode(t);a&&this.openGroups.has(a._index)&&this.layoutController.shouldRelayout.add(a._index),i.setXYR(t._index,n.x,n.y,s?0:this.openRadius.get(t._index))}getOffset(t){return this.collapsedGroups.has(t)&&this.subNodeOffsetX.has(t)?{x:this.subNodeOffsetX.get(t),y:this.subNodeOffsetY.get(t)}:{x:0,y:0}}restorePositions(t,e){const s=t.getPosition(),i=(e=e.filter((o=>!o.isVirtual())))._indexes,n=this.getOffset(t._index),r=[];for(let o=0;o<i.length;o++)r.push({x:n.x+s.x+this.subNodeOffsetX.get(i[o])||0,y:n.x+s.y+this.subNodeOffsetY.get(i[o])||0});e.setAttributes(r,0)}animateChildren(t,e){const s=[{parent:t,position:e}];for(;s.length;){const{parent:i,position:n}=s.shift();if(!i.isNode)continue;const r=this.module.getSubNodes(i);r.size&&r.forEach((o=>{const a=this.subNodeOffsetX.get(o._index)||0,l=this.subNodeOffsetY.get(o._index)||0,d={x:n.x+a,y:n.y+l};this.module.animations.setXY(o._index,d.x,d.y),s.push({parent:o,position:d})}))}}addOpenGroup(t){this.openGroups.add(t._index),this.closeGroups.delete(t._index)}isOpen(t){return this.openGroups.has(t._index)}isClose(t){return this.closeGroups.has(t._index)}setPadding(t,e){const s=new Set,i=isNaN(+e),n=e;return t.forEach((r=>{const o=i?n(r):+e;this.padding.get(r._index)!==o&&s.add(r._index),this.padding.set(r._index,o)})),s}getGroupXYR(t,e,s,i){let n,r,o;const a=this.module.animations,l=this.ogma.geo.enabled();if(n=new Array(e.size).fill(0),r=new Array(e.size).fill(0),o=new Array(e.size).fill(0),l){const m=e.getData(this.ogma.modules.geo.latitudePath),f=e.getData(this.ogma.modules.geo.longitudePath);n=[],r=[],o=[];for(let p=0;p<m.length;p++){const{x:_,y:x}=this.ogma.geo.getMap().project({lat:m[p],lng:f[p]},gl);n.push(_),r.push(x),o.push(2**gl*this.geoRadius.get(e._indexes[p])||10)}}else{const m=this.ogma.modules.graphics.getAttributesManager()._layerController.nodes._currentFlexArrays,f=this.openGroups.has(t._index),p=this.isExpanding.has(t._index),_=f&&!p?m.radius:a.getInputFlexArrays().radius;for(let x=0;x<e.size;x++)n[x]=m.x.get(e._indexes[x]),r[x]=m.y.get(e._indexes[x]),o[x]=_.get(e._indexes[x])}if(s&&i&&s.isNode){const m=s._indexes,f=new Map,p=new Map,_=new Map;for(let y=0;y<m.length;y++){const b=Array.isArray(i)?i[y]:i;!isNaN(b.x)&&f.set(m[y],b.x),!isNaN(b.y)&&p.set(m[y],b.y),!isNaN(b.radius)&&_.set(m[y],b.radius)}const x=e._indexes;for(let y=0;y<x.length;y++)f.has(x[y])&&(n[y]=f.get(x[y])),p.has(x[y])&&(r[y]=p.get(x[y])),_.has(x[y])&&(o[y]=_.get(x[y]))}const d=e._indexes;for(let m=0;m<d.length;m++)!this.closeGroups.has(d[m])&&!this.collapsedGroups.has(d[m])&&this.openRadius.has(d[m])&&(o[m]=this.openRadius.get(d[m]));if(!l)for(let m=0;m<d.length;m++)a.xs.get(d[m])!==void 0&&(n[m]=a.xs.get(d[m])),a.ys.get(d[m])!==void 0&&(r[m]=a.ys.get(d[m])),a.rs.get(d[m])!==void 0&&(o[m]=a.rs.get(d[m]));let h=0,u=0,c=0;const g=Il.algorithms.minDisk(n,r,o);if(h=g[0],u=g[1],c=g[2],c+=this.padding.get(t._index)||0,l){const{lat:m,lng:f}=this.ogma.geo.getMap().unproject({x:h,y:u},gl);h=f,u=m,c/=2**gl,this.geoRadius.set(t._index,c),c*=2**this.ogma.geo.getZoom()}else this.openRadius.set(t._index,c),e.forEach(((m,f)=>{this.subNodeOffsetX.set(m._index,n[f]-h),this.subNodeOffsetY.set(m._index,r[f]-u)}));return{x:h,y:u,radius:c,isGeo:l}}async onAfterLayouts(){const t=this.module.animations,e=this.module.getList().filter((r=>r.getName()===bs.NodeGrouping&&r.isEnabled())),s=[];let i=!1;for(let r=e.length-1;r>=0;r--)e[r].getContext().metaNodes.forEach((o=>{if(o.getMetaNode())return;i||(i=this.hasUpdated.has(o._index)||this.layoutController.relayouted.has(o._index)||this.layoutController.shouldRelayout.has(o._index));const a=!this.collapsedGroups.has(o._index)&&!this.closeGroups.has(o._index);s.push({group:o,collapsed:!a})}));if(i||this.shouldRunGroupUpdate){this.shouldRunGroupUpdate=!1;const r=this.ogma.getNodes().filter((a=>{const l=this.module.getMetaNode(a);return!l||!this.module.nodeToTransformation.get(l._index).isEnabled()})),o=new Array(r.size);for(let a=0;a<r.size;a++)o[a]=this.openRadius.get(r._indexes[a])||this.module.animations.getCloseRadius(r._indexes[a])||0;await this.layoutController.handleGlobalLayout(r,o)}const n=new Set;for(;s.length;){const{group:r,collapsed:o}=s.shift();if(n.has(r._index))continue;n.add(r._index);const a=this.module.getSubNodes(r),l=a._indexes,d=t.xs.get(r._index),h=t.ys.get(r._index);if(d!==void 0&&h!==void 0){if(o){t.deleteOpenRadius(r._index);for(let u=0;u<l.length;u++)t.setXY(l[u],d,h)}else for(let u=0;u<l.length;u++)t.setXY(l[u],d+this.subNodeOffsetX.get(l[u])||0,h+this.subNodeOffsetY.get(l[u])||0);for(let u=0;u<l.length;u++)this.module.isVirtual(l[u],!0)&&s.push({group:a.get(u),collapsed:this.collapsedGroups.has(l[u])||this.closeGroups.has(l[u])||o})}}this.hasUpdated.clear(),this.layoutController.clear(),this.isExpanding.clear()}cleanup(t,e,s){let i=t._indexes;for(let n=0;n<i.length;n++)this.padding.delete(i[n]),this.openGroups.delete(i[n]),this.closeGroups.delete(i[n]),this.nodeLayer.delete(i[n]),this.savedNodeLayer.delete(i[n]),this.savedEdgeLayer.delete(i[n]);for(let n=0;n<e.size;n++)this.edgeLayer.delete(e._indexes[n]);if(s){i=s._indexes;for(let n=0;n<i.length;n++)this.subNodeOffsetX.delete(i[n]),this.subNodeOffsetY.delete(i[n])}}getPositions(t,e){const{x:s,y:i}=t.getPosition();return e.map((n=>({x:s+(this.subNodeOffsetX.get(n._index)||0),y:i+(this.subNodeOffsetY.get(n._index)||0)})))}hideSubNodes(t){const e=[t];for(;e.length;){const s=e.pop();s.setVisible(!1);for(let i=0;i<s._indexes.length;i++)this.collapsedGroups.add(s._indexes[i]),this.openGroups.has(s._indexes[i])&&e.push(this.module.getSubNodes(s.get(i)))}}onRemove(t,e){if(!e)return;const s=[],i=new Set;for(let n=0;n<t.length;n++){const r=this.module.nodeToMeta.get(t[n]);if(!r)continue;const o=r._index;this.openRadius.delete(o),this.isExpanding.delete(o),this.alreadyGrouped.delete(o),this.collapsedGroups.delete(o),this.closeGroups.delete(o),this.openGroups.delete(o),this.padding.delete(o),this.geoRadius.delete(o),this.hasUpdated.delete(o),this.subNodeOffsetX.delete(o),this.subNodeOffsetY.delete(o),this.nodeLayer.delete(o),this.edgeLayer.delete(o),this.savedNodeLayer.delete(o),this.savedEdgeLayer.delete(o),this.openGroups.has(o)&&(this.layoutController.shouldRelayout.add(o),s.push(o))}for(;s.length;){const n=s.shift();if(i.has(n))continue;i.add(n);const r=this.module.nodeToMeta.get(n);r&&this.openGroups.has(r._index)&&(this.layoutController.shouldRelayout.add(r._index),s.push(r._index))}}async fishEyeExpand(t,e,s){if(!t.isVirtual())throw new Error("Focus node is not virtual.");const i=this.module.nodeToMeta.get(t._index);if(i&&i.isVisible())throw new Error("Focus node is not at top level.");const n=this.module.animations,r=this.ogma,o=n.getCloseRadius(t._index);s&&(this.layoutController.setNextLayout(t._index,s),this.layoutController.shouldRelayout.add(t._index)),this.layoutController.setNextOnGroupUpdate((async a=>{const l=n.getXYR(t.toList())[0].radius-o,d=n.getXYR(a);return await r.algorithms.fishEyeExpand({nodes:a,focusNode:t,dryRun:!0,deltaRadius:l,xyr:d})})),await e(),await this.module.afterNextUpdate()}setNodeLayer(t,e){this.nodeLayer.set(t,e),this.savedNodeLayer.set(t,e)}setEdgeLayer(t,e){this.edgeLayer.set(t,e),this.savedEdgeLayer.set(t,e)}async fishEyeCollapse(t,e){if(!t.isVirtual())throw new Error("Focus node is not virtual.");const s=this.module.nodeToMeta.get(t._index);if(s&&s.isVisible())throw new Error("Focus node is not at top level.");const i=this.module.animations,n=this.ogma,r=t.getAttribute("radius");this.layoutController.setNextOnGroupUpdate((async o=>{const a=i.getXYR(t.toList())[0].radius-r,l=i.getXYR(o);return await n.algorithms.fishEyeExpand({nodes:o,focusNode:t,dryRun:!0,deltaRadius:a,xyr:l})})),await e(),await this.module.afterNextUpdate()}triggerGroupsUpdate(){this.shouldRunGroupUpdate=!0}layoutGroups(t,e,s=!1){return this.runningLayouts=!0,this.layoutController.layoutGroups(t,e,s).finally((()=>{this.runningLayouts=!1}))}_onToggleGeo(){this.geoRadius.clear();const t=this.module.getList().find((s=>s.getName()===bs.NodeGrouping));if(!t)return;const e=Array.from(this.openGroups.keys());for(let s=0;s<e.length;s++)this.layoutController.shouldRelayout.add(e[s]);t.refresh()}startRefresh(){this.alreadyGrouped.clear()}clear(){this.subNodeOffsetX.clear(),this.subNodeOffsetY.clear(),this.openRadius.clear(),this.isExpanding.clear(),this.layoutController.clear(),this.alreadyGrouped.clear(),this.openGroups.clear(),this.closeGroups.clear(),this.nodeLayer.clear(),this.edgeLayer.clear(),this.padding.clear(),this.geoRadius.clear(),this.collapsedGroups.clear(),this.hasUpdated.clear()}destroy(){this.destroyed||(this.destroyed=!0,this.ogma.events.off(this.onSetMultipleAttributes))}},vB=class{constructor(t){this.ogma=t}save(){this.selectedNodes=this.ogma.getSelectedNodes(),this.selectedEdges=this.ogma.getSelectedEdges(),this.ogma.modules.selection.disableEvents()}restore(){const t=this.selectedNodes.filter((n=>!this.ogma.getNode(n.getId()))),e=this.selectedEdges.filter((n=>!this.ogma.getEdge(n.getId()))),s=new Set,i=new Set;if(t.size){this.ogma.modules.events.fire("nodesUnselected",{nodes:t});for(let n=0;n<t.size;n++)s.add(t._indexes[n])}if(e.size){this.ogma.modules.events.fire("edgesUnselected",{edges:e});for(let n=0;n<e.size;n++)i.add(e._indexes[n])}this.selectedNodes.filter((n=>!n.isSelected()&&!s.has(n._index))).setSelected(!0),this.selectedEdges.filter((n=>!n.isSelected()&&!i.has(n._index))).setSelected(!0),this.ogma.modules.selection.enableEvents()}cleanup(){this.selectedNodes=void 0,this.selectedEdges=void 0,this.ogma.modules.selection.enableEvents&&this.ogma.modules.selection.enableEvents()}},EB={setData:!1,addElement:!0,removeElement:!0,setOptions:!1,refresh:!1},AB=class dc{constructor(){this.prev={},this.next={},this.prevorder=[],this.nextorder=[],this.shouldAnimate=!1,this.minRefreshIndex=0}addTransformation(e,s){this.next[e]=s,this.nextorder.push(e)}removeTransformation(e){delete this.next[e]}setIndex(e,s){const i=this.nextorder.indexOf(e);this.nextorder.splice(i,1),this.nextorder.splice(s,0,e),this.minRefreshIndex=Math.min(this.minRefreshIndex,i,s)}setEnabled(e,s){this.next[e]=s}isEnabled(e){return this.prev[e]||!1}static getDiff(e,s){const i=new Map;for(const n in e)s[n]!==void 0?s[n]!==e[n]&&i.set(+n,{shouldDo:s[n],shouldUndo:e[n]}):i.set(+n,{shouldDo:!1,shouldUndo:e[n],shouldCleanup:!0});for(const n in s)e[n]===void 0&&s[n]===!0&&i.set(+n,{shouldDo:!0,shouldUndo:!1});return i}getFirstChange(e){const{nextorder:s}=this;let i=s.length;for(let n=0;n<s.length;n++){const r=e.get(s[n]);if(r&&(r.shouldUndo||r.shouldDo)){i=n;break}}return i}refreshFrom(e,s){const{nextorder:i}=this;for(let n=s;n<this.nextorder.length;n++)e.set(i[n],{shouldUndo:this.prev[i[n]],shouldDo:this.prev[i[n]],...e.get(i[n])||{}});return e}isDirty(){const e=dc.getDiff(this.prev,this.next),s=Math.min(this.minRefreshIndex,this.getFirstChange(e));return(e.size>0||s<this.nextorder.length)&&{reason:e.size>0?"diff":"refresh",index:s}}invalidateFrom(e,s){this.shouldAnimate||(this.shouldAnimate=EB[s]),this.minRefreshIndex=Math.min(this.minRefreshIndex,e)}step(){const e=dc.getDiff(this.prev,this.next);this.prev={...this.next};const s=Math.min(this.minRefreshIndex,this.getFirstChange(e)),i=this.nextorder.reduce(((o,a,l)=>o.set(a,l)),new Map),n=this.prevorder.reduce(((o,a,l)=>o.set(a,l)),new Map);this.nextorder=this.nextorder.filter((o=>this.prev[o]!==void 0)),this.prevorder=[...this.nextorder],this.minRefreshIndex=this.nextorder.length;const r=this.shouldAnimate;return this.shouldAnimate=!1,{diff:this.refreshFrom(e,s),nextorder:i,prevorder:n,shouldAnimate:r}}done(){}},SB=class{constructor(t){this.transformations=[],this.addingGraph=!1,this.addingElements=!1,this.nodeToTransformation=new Map,this.edgeToTransformation=new Map,this.nodeVirtual=new Set,this.edgeVirtual=new Set,this.nodeToMeta=new Map,this.edgeToMeta=new Map,this.metaToNodes=new Map,this.metaToEdges=new Map,this._onDestroy=()=>{this.destroy()},this._onAddElements=({nodes:e,edges:s,virtual:i})=>{if(i){if(e)for(let n=0;n<e.size;n++)this.nodeVirtual.add(e._indexes[n]);if(s)for(let n=0;n<s.size;n++)this.edgeVirtual.add(s._indexes[n])}else this.addingGraph||this.addingElements||(this.state.invalidateFrom(0,"addElement"),this.invalidate())},this._onSetData=({elements:e,virtual:s})=>{if(s)return;const{isNode:i,_indexes:n}=e;let r=1/0;for(const o of n){const a=this.getTransformation(o,i);if(!a){r=0;break}r=Math.min(r,a.getIndex())}return this.state.invalidateFrom(r,"setData"),this.invalidate(),r},this._onRequestElementsToDelete=e=>{const{elementsToRemove:s}=e,i=s.isNode,n=s._indexes,r=this.getLeafElements(n,i);e.elementsToRemove=i?this.ogma.nodeList(r):this.ogma.edgeList(r)},this._onAfterRemoveElements=({nodes:e,edges:s})=>{if(!this.ogma.isDestroyed()){if(e)for(let i=0;i<e.size;i++)this.nodeVirtual.delete(e._indexes[i]);if(s)for(let i=0;i<s.size;i++)this.edgeVirtual.delete(s._indexes[i])}},this._onRemoveElements=({nodes:e,edges:s,virtual:i})=>{i||this.ogma.isDestroyed()||this._refreshPromise.then((()=>{const n=!!e,r=n?e._indexes:s._indexes,o=new Set(r);this.transformations.forEach((a=>a.onRemove(o,n))),this.groupController.onRemove(r,n),this.drilldownController.onRemove(o,n),n?(this.nodeToMeta.clear(),this.metaToNodes.clear(),this.nodeToTransformation.clear()):(this.edgeToMeta.clear(),this.metaToEdges.clear(),this.edgeToTransformation.clear()),this.state.invalidateFrom(0,"removeElement"),this.invalidate()}))},this._onClearGraph=()=>{this.transformations.forEach((e=>{e.cleanup()})),this.groupController.clear(),this.nodeToMeta.clear(),this.edgeToMeta.clear(),this.metaToNodes.clear(),this.metaToEdges.clear(),this.nodeToTransformation.clear(),this.edgeToTransformation.clear(),this.state.invalidateFrom(0,"removeElement"),this.invalidate()},this.ogma=t,this.state=new AB,this.animations=new hB(t),this._shouldRefresh=!1,this._refreshing=!1,this.isDestroyed=!1,this.isPaused=!1,this.selection=new vB(t),this._refreshPromise=Promise.resolve(),this.groupController=new bB(t,this),this.drilldownController=new _B(this),this.ogma.events.on("setData",this._onSetData).on("preAddGraph",(()=>{this.addingGraph=!0})).on("postAddGraph",(()=>{this.addingGraph=!1,this.state.invalidateFrom(0,"addElement"),this.invalidate()})).on("preAddElements",(({virtual:e})=>{e||this.addingGraph||(this.addingElements=!0)})).on("postAddElements",(({virtual:e})=>{e||this.addingGraph||(this.addingElements=!1,this.state.invalidateFrom(0,"addElement"),this.invalidate())})).on(["addNodes","addEdges"],this._onAddElements).on(["removeNodes","removeEdges"],this._onRemoveElements).on("clearGraph",this._onClearGraph).on(["afterRemoveNodes","afterRemoveEdges"],this._onAfterRemoveElements).on("requestElementsToDelete",this._onRequestElementsToDelete).on("destroy",this._onDestroy)}addTransformation(t,e=!0){this.state.addTransformation(t.getId(),e),this.transformations.push(t),this.invalidate()}removeTransformation(t){const e=this.transformations.indexOf(t);e!==-1&&this.transformations.splice(e,1),this.invalidate()}async step(t=0,e={fireEnabled:[],fireDisabled:[],fireRefresh:[],fireDestroy:[],fireSetIndex:[]}){var s;if(t>5)throw new Error("Ogma transformations: Transformations refresh in loop");const{diff:i,prevorder:n,nextorder:r}=this.state.step(),{fireEnabled:o,fireDisabled:a,fireRefresh:l,fireDestroy:d,fireSetIndex:h}=e,u=[],c=[],g=[];this.groupController.startRefresh();for(const f of this.transformations){const p=f.getId();if(!i.has(p))continue;const{shouldDo:_,shouldUndo:x,shouldCleanup:y}=i.get(p);_&&!x?o.push(f):x&&!_?a.push(f):_&&x&&l.push(f),n.has(p)&&n.get(p)!==r.get(p)&&h.push(f),x&&u.push(f),_&&c.push(f),y&&(d.push(f),g.push(f))}let m=0;u.sort(((f,p)=>n.get(p.getId())-n.get(f.getId())||0));for(const f of u){const p=!((s=i.get(f.getId()))!=null&&s.shouldDo);p&&(m=this.animations.getMaxAnimation(m,f.getAnimation())),await f.undo(p)}c.sort(((f,p)=>r.get(f.getId())-r.get(p.getId())||0)),this.ogma.modules.graphics.pauseRendering();for(let f=0;f<c.length;f++){const p=c[f],_=f===c.length-1;_&&(m=this.animations.getMaxAnimation(m,p.getAnimation())),await p.run(_)}for(const f of g)await f.cleanup();if((u.length||c.length||g.length)&&(this.groupController.updateGroupLayer(),await this.groupController.onAfterLayouts()),this.ogma.modules.graphics.resumeRendering(),await this.animations.apply(m),!this.isDestroyed)return this.state.isDirty()?this.step(t+1,e):e}refresh(){this.isDestroyed||this.ogma.isDestroyed()||!this._shouldRefresh||!this.transformations.length||this._refreshing||this.addingGraph||this.addingElements||this.isPaused||(this._shouldRefresh=!1,this._refreshing=!0,this._refreshPromise=this._refreshPromise.then((()=>(this.selection.save(),this.step().then((t=>{this._refreshing=!1;const{fireEnabled:e,fireDisabled:s,fireRefresh:i,fireDestroy:n,fireSetIndex:r}=t,o=this.ogma.modules.events;s.reverse().forEach((a=>o.fire("transformationDisabled",{target:a}))),e.forEach((a=>o.fire("transformationEnabled",{target:a}))),r.forEach((a=>o.fire("transformationSetIndex",{target:a}))),i.forEach((a=>o.fire("transformationRefresh",{target:a}))),n.forEach((a=>o.fire("transformationDestroyed",{target:a})))})).finally((()=>{this.selection.restore(),this.selection.cleanup(),this.ogma.modules.graphics.resumeRendering()}))))).catch((t=>{const e=this.state.isDirty();if(!e)throw new Error(`Ogma transformations, refresh failed.
${t.stack}`);const s=e.reason==="diff"?"You are constantly adding/removing/changing index of a transformation":"You are constantly adding/removing/updating nodes or edges while transformations refresh";throw new Error(`Ogma transformations, refresh failed.
${s}`)})).catch((t=>{if(!this.onRefreshError)throw t;this.onRefreshError(t)})).finally((()=>{})))}enable(t){return this.state.setEnabled(t.getId(),!0),this.invalidate(),this.afterNextUpdate()}disable(t){return this.state.setEnabled(t.getId(),!1),this.invalidate(),this.afterNextUpdate()}remove(t){return this.disable(t),this.state.removeTransformation(t.getId()),this.afterNextUpdate().then((()=>{this.transformations.splice(this.getIndex(t),1)}))}isEnabled(t){return this.state.isEnabled(t.getId())}getList(){return this.transformations.slice()}getIndex(t){for(let e=0;e<this.transformations.length;e++)if(this.transformations[e]===t)return e;return-1}setIndex(t,e){const s=this.getIndex(t);this.state.setIndex(t.getId(),e),this.transformations.splice(s,1),this.transformations.splice(e,0,t),this.invalidate()}setOptions(t){this.state.invalidateFrom(this.getIndex(t),"setOptions"),this.invalidate()}refreshTransformation(t){this.state.invalidateFrom(this.getIndex(t),"refresh"),this.invalidate()}clear(){return this.transformations.forEach((t=>t.destroy(0))),this.invalidate(),this.afterNextUpdate()}destroy(){this.transformations.forEach((t=>t.destroy(0))),this.groupController.destroy(),this._refreshPromise=Promise.resolve(),this.isDestroyed=!0}invalidate(){this.ogma.isDestroyed()||(this._shouldRefresh=!0,this.ogma.modules.dom.refresh(),this.ogma.modules.dom.onNextFrame().then((()=>{this.refresh()})))}afterNextUpdate(){return this.ogma.view.afterNextFrame().then((()=>this._refreshPromise))}getTransformation(t,e){return e?this.nodeToTransformation.get(t):this.edgeToTransformation.get(t)}setTransformation(t,e,s){s?this.nodeToTransformation.set(t,e):this.edgeToTransformation.set(t,e)}deleteTransformation(t){const e=t.isNode?this.nodeToTransformation:this.edgeToTransformation,s=t._indexes;for(const i of s)e.delete(i)}setMetaNode(t,e){this.nodeToMeta.set(t,e)}setSubNodes(t,e){this.metaToNodes.set(t,e)}setMetaElement(t,e,s){s?this.setMetaNode(t,e):this.setMetaEdge(t,e)}setSubElements(t,e,s){s?this.setSubNodes(t,e):this.setSubEdges(t,e)}removeMetaNodes(t){const e=t._indexes;for(const s of e){const i=this.metaToNodes.get(s);i&&i.forEach((n=>this.nodeToMeta.delete(n._index))),this.nodeToTransformation.delete(s),this.metaToNodes.delete(s)}}removeMetaEdges(t){const e=t._indexes;for(const s of e){const i=this.metaToEdges.get(s);i&&i.forEach((n=>this.edgeToMeta.delete(n._index))),this.edgeToTransformation.delete(s),this.metaToEdges.delete(s)}}clearSubNodes(t){this.metaToNodes.delete(t)}clearMetaNode(t){this.nodeToMeta.delete(t)}setMetaEdge(t,e){this.edgeToMeta.set(t,e)}setSubEdges(t,e){this.metaToEdges.set(t,e)}clearSubEdges(t){this.metaToEdges.delete(t)}clearMetaEdge(t){this.edgeToMeta.delete(t)}getMetaNode(t){return this.nodeToMeta.get(t._index)||null}getMetaEdge(t){return this.edgeToMeta.get(t._index)||null}getLeafElements(t,e){const s=[t],i=e?this.metaToNodes:this.metaToEdges,n=[];for(;s.length;){const r=s.pop();for(let o=0;o<r.length;o++){n.push(r[o]);const a=i.get(r[o]);a&&s.push(a._indexes)}}return n}getSubElements(t){const e=t.isNode?this.metaToNodes:this.metaToEdges,s=t.toList()._indexes;let i=0;for(let o=0;o<s.length;o++){const a=e.get(s[o]);a&&(i+=a.size)}const n=new Uint32Array(i);let r=0;for(let o=0;o<s.length;o++){const a=e.get(s[o]);if(a)for(let l=0;l<a.size;l++)n[r++]=a._indexes[l]}return t.isNode?this.ogma.nodeList(n):this.ogma.edgeList(n)}getSubNodes(t){return this.getSubElements(t)}getSubEdges(t){return this.getSubElements(t)}getById(t){return this.transformations.find((e=>e.getId()===t))}isIntraEdge(t){const e=t.getSource()._index;return this.nodeToMeta.has(e)&&this.nodeToMeta.get(e)===this.nodeToMeta.get(t.getTarget()._index)}isVirtual(t,e){return e?this.nodeVirtual.has(t):this.edgeVirtual.has(t)}isRefreshing(){return this._refreshing}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.refresh()}},As="_transparent",Fr=t=>!0,wB=()=>{};function QE(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach(((s,i)=>e.push(i))),e}function ld(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach((s=>e.push(s))),e}function R_(t){return!(!t||t.constructor!==Object&&t.constructor)}var Cn=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)i.hasOwnProperty(n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):R_(e[n])&&R_(i[n])?e[n]=Cn(e[n],i[n]):e[n]=i[n])}return e};function TB(t){return Array.isArray(t)?t:[t]}var hc=()=>!0,JE=()=>!1,CB=()=>null,LB=class extends mn{constructor(t){super(t),this.nodeSelector=t.criteria||Fr}setOptions(t){return this.nodeSelector=t.criteria||this.nodeSelector,super.setOptions(t)}getName(){return bs.NodeFilter}run(){const t=this.nodeSelector,e=this.ogma.getNodes().filter((a=>!t||!t(a))),s=e.getAdjacentEdges();this.module.animations.hideNodes(e._indexes),this.module.animations.hideEdges(s._indexes),e.setVisible(!1),s.setVisible(!1);const i=e.subtract(this.context.hiddenNodes),n=s.subtract(this.context.hiddenEdges),r=this.context.hiddenNodes.subtract(e),o=this.context.hiddenEdges.subtract(s);return this.module.animations.pushBefore((()=>{r.setVisible(!0),r.setVisible(!0),n.setVisible(!0),i.setVisible(!0),r.addClass(As),o.addClass(As)})),this.module.animations.push((()=>Promise.all([o.removeClass(As,this.animation),r.removeClass(As,this.animation),i.addClass(As,this.animation),n.addClass(As,this.animation)]))),this.context={...this.context,hiddenNodes:e,hiddenEdges:s},Promise.resolve()}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s}=this.context,i=t?this.animation:0;return e.setExcluded(!1),s.setExcluded(!1),t&&(e.addClass(As),s.addClass(As),this.module.animations.push((()=>Promise.all([e.removeClass(As,i),s.removeClass(As,i)]))),this.context.hiddenNodes=this.ogma.nodeList(),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e?this.context.hiddenNodes=this.context.hiddenNodes.filter((s=>!t.has(s._index))):this.context.hiddenEdges=this.context.hiddenEdges.filter((s=>!t.has(s._index)))}resetContext(){this.context={...this.context,hiddenEdges:this.ogma.edgeList(),hiddenNodes:this.ogma.nodeList()}}},IB=class extends mn{constructor(t){super(t),this.edgeSelector=t.criteria||Fr}setOptions(t){return this.edgeSelector=t.criteria||this.edgeSelector,super.setOptions(t)}getName(){return bs.EdgeFilter}run(){const t=this.edgeSelector,e=this.ogma.getEdges().filter((r=>!t||!t(r))),s=this.module.animations;e.setVisible(!1);const i=e.subtract(this.context.hiddenEdges),n=this.context.hiddenEdges.subtract(e);return this.module.animations.pushBefore((()=>{i.setVisible(!0),n.setVisible(!0),n.addClass(As)})),s.hideEdges(e._indexes),s.push((()=>Promise.all([n.removeClass(As,this.animation),i.addClass(As,this.animation)]))),this.context={...this.context,hiddenEdges:e},Promise.resolve()}undo(t=!0){super.undo(t);const{hiddenEdges:e}=this.context,s=t?this.animation:0;return e.setExcluded(!1),t&&(e.addClass(As),this.module.animations.push((()=>Promise.all([e.removeClass(As,s)]))),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e||(this.context.hiddenEdges=this.context.hiddenEdges.filter((s=>!t.has(s._index))))}resetContext(){this.context={...this.context,hiddenEdges:this.ogma.edgeList()}}},je="_faded",MB=class extends mn{constructor(t){super(t),this.selector=t.selector||JE,this.dataFunction=t.dataFunction||wB}getName(){return bs.NeighborMerging}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=[],r=new Map;for(let c=0;c<i.size;++c){const g=i.get(c),m=g.getAdjacentEdges(),f=this.dataFunction(g);for(let p=0;p<m.size;++p){const _=m.get(p),x=_.getSource(),y=_.getTarget();if(x!==y&&f!==void 0){const b=x===g?y:x;let v=r.get(b);v||(v=[],r.set(b,v)),v.push(f)}n.push(_)}}const o=e.getEdges(n),a=e.getNodes(QE(r)),l=ld(r),d=a.getData(),h=new Array(a.size);for(let c=0;c<h.length;++c){const g=l[c];let m=d[c];for(let f=0;f<g.length;++f)m=Cn(m,g[f]);h[c]=m}const u=this.module.animations;return u.hideNodes(i._indexes),u.hideEdges(o._indexes),u.push((()=>Promise.all([i.addClass(je,s),o.addClass(je,s)]).then((()=>{this.ogma.modules.data.setProperty(a,null,h,{dispatch:!0,virtual:!0})})))),this.context={...this.context,hiddenNodes:i,hiddenEdges:o,nodesWithDataChange:a,oldDataList:d},Promise.resolve()}resetContext(){super.resetContext(),this.context={...this.context,hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),nodesWithDataChange:this.ogma.nodeList(),oldDataList:[]}}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,nodesWithDataChange:i,oldDataList:n}=this.context,r=t?this.animation:0,o=this.module.animations;return this.context.hiddenEdges=this.ogma.edgeList(),this.context.hiddenNodes=this.ogma.nodeList(),this.context.nodesWithDataChange=this.ogma.nodeList(),this.context.oldDataList=[],e.setVisible(!0),s.setVisible(!0),o.pushBefore((()=>{e.addClass(je),s.addClass(je)})),o.push((()=>Promise.all([e.removeClass(je,r),s.removeClass(je,r)]).then((()=>{this.ogma.modules.data.setProperty(i,null,n,{dispatch:!0,virtual:!0})})))),Promise.resolve()}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter((s=>!t.has(s._index)))),this.context.hiddenEdges=this.context.hiddenEdges.filter((s=>!t.has(s._index)))}cleanup(){return Promise.resolve()}setOptions(t){return this.selector=t.selector||this.selector,this.dataFunction=t.dataFunction||this.dataFunction,super.setOptions(t)}};function NB(t){return t!=null}var RB=(t,e)=>({source:t.getId(),target:e.getId()}),FB=class extends mn{constructor(t){super(t);const{selector:e=hc,neighborIdFunction:s=CB,nodeGenerator:i=(()=>({})),edgeGenerator:n=RB}=t;this.neighborIdFunction=s,this.selector=e,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i,this.edgeGenerator=n}getName(){return bs.NeighborGeneration}run(t=!0){const{ogma:e,id:s}=this,i=t?this.animation:0,n=e.getNodes(),r=new Map;for(let c=0;c<n.size;++c){const g=n.get(c),m=(PB(this.generateIds(g))||[]).filter(NB);if(m)for(const f of m){let p=r.get(f);p||(p=[],r.set(f,p)),p.push(g)}}const o=new Array(r.size),a=[],l=QE(r),d=ld(r).map((c=>e.getNodes(c)));for(let c=0;c<o.length;++c){const g=l[c],m=d[c],f=this.nodeGenerator(g,m);f.id=`_gen_${s}_${g}`;const p=uB(m.getPosition());f.attributes=f.attributes||{},f.attributes.x=p.x,f.attributes.y=p.y,o[c]=f}let h,u;return e.addNodes(o.map((c=>({id:c.id,attributes:c.attributes}))),{virtual:!0}).then((()=>{h=e.getNodes(o.map((g=>g.id)));const c=h._indexes;this.context.virtualNodes&&this.module.removeMetaNodes(this.context.virtualNodes);for(let g=0;g<h.size;g++)this.module.setTransformation(c[g],this,!0),this.module.setSubNodes(c[g],this.ogma.createNodeList());h.replaceOriginalAttributes(o.map((g=>g.attributes)),["x","y"]),this.ogma.modules.data.setProperty(h,null,o.map((g=>g.data)),{dispatch:!0,virtual:!0});for(let g=0;g<h.size;++g){const m=h.get(g),f=d[g];for(let p=0;p<f.size;++p){const _=f.get(p),x=this.edgeGenerator(_,m);!x.source&&!x.target&&(x.source=_.getId(),x.target=m.getId()),x.id||(x.id=`${x.source}-${x.target}`),a.push(x)}}return e.addEdges(a,{virtual:!0})})).then((()=>{u=e.getEdges(a.map((g=>g.id)));const c=u._indexes;this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);for(let g=0;g<u.size;g++)this.module.setTransformation(c[g],this,!1),this.module.setSubEdges(c[g],this.ogma.createEdgeList());this.context={virtualEdges:u,virtualNodes:h},e.removeNodes(this.context.virtualNodes.subtract(h),{virtual:!0}),e.removeEdges(this.context.virtualEdges.subtract(u),{virtual:!0}),h.setVisible(!0),u.setVisible(!0),this.module.animations.pushBefore((()=>{h.addClass(je),u.addClass(je)})),this.module.animations.push((()=>Promise.all([h.removeClass(je,i),u.removeClass(je,i)])))}))}undo(t=!0){const{virtualNodes:e,virtualEdges:s}=this.context;if(!s||!e)return Promise.resolve(this.context);const i=t?this.animation:0,n=this.module.animations;t?(n.hideNodes(e._indexes),n.hideEdges(s._indexes),n.push((()=>Promise.all([e.addClass(je,i),s.addClass(je,i)])))):(e.setVisible(!1),s.setVisible(!1))}onRemove(){}cleanup(){const{virtualEdges:t,virtualNodes:e}=this.context;return t&&e&&(this.module.removeMetaNodes(e),this.module.removeMetaEdges(t),this.ogma.removeNodes(e,{virtual:!0}),this.ogma.removeEdges(t,{virtual:!0}),this.context.virtualEdges=this.ogma.edgeList(),this.context.virtualNodes=this.ogma.nodeList()),Promise.resolve()}setOptions(t){const{selector:e,neighborIdFunction:s,nodeGenerator:i,edgeGenerator:n}=t;return this.selector=e||this.selector,this.neighborIdFunction=s||this.neighborIdFunction,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i||this.nodeGenerator,this.edgeGenerator=n||this.edgeGenerator,super.setOptions(t)}resetContext(){super.resetContext(),this.context={...this.context,virtualNodes:this.ogma.nodeList(),virtualEdges:this.ogma.edgeList()}}};function PB(t){return Array.isArray(t)?t:t?[t]:null}function zB(t,e){return t.size===e.size&&t.filter((s=>e.includes(s))).size>0}var DB=class extends mn{constructor(t){super(t),this.selector=t.selector||JE,this.edgeGenerator=t.edgeGenerator||(()=>({}))}getName(){return bs.NodeCollapsing}resetContext(){this.context={hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),virtualEdges:this.ogma.edgeList()}}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=i.getAdjacentEdges(),r=[],o=i.map((l=>l.getAdjacentNodes().filter((d=>!this.selector(d)))));for(let l=0;l<i.size;l++)for(let d=l;d<i.size;d++){const h=i.get(l),u=i.get(d);if(this.ogma.modules.graph.getEdgesBetweenTwoNodes(h,u).size>0&&(o[l].size||o[d].size)&&!zB(o[l],o[d]))throw Error(`addNodeCollapsing: invalid connected nodes [${h.getId()}] and [${u.getId()}] to be collapsed. The addNodeCollapsing function supports only disconnected nodes.`)}const a=new Map;for(let l=0;l<i.size;++l){const d=i.get(l),h=o[l];for(let u=0;u<h.size-1;++u){const c=h.get(u),g=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,c);if(c!==d)for(let m=u+1;m<h.size;++m){const f=h.get(m),p=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,f),_=this.edgeGenerator(d,c,f,g,p);if(_){const x=TB(_);for(let y=0;y<x.length;++y)r.push(kB(e,x[y],y,d,c,f,g,p)),a.set(r[r.length-1].id,g.concat(p))}}}}return e.addEdges(r,{virtual:!0}).then((()=>{const l=this.ogma.getEdges(r.map((u=>u.id)));this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);const d=l._indexes;for(let u=0;u<l.size;u++){this.module.setTransformation(d[u],this,!1);const c=a.get(l.get(u).getId());this.module.setSubEdges(d[u],c);for(let g=0;g<c.size;g++)this.module.setMetaEdge(c._indexes[g],l.get(u))}e.removeEdges(this.context.virtualEdges.subtract(l),{virtual:!0});const h=this.module.animations;l.setVisible(!0),h.pushBefore((()=>l.addClass(je))),h.push((()=>Promise.all([l.removeClass(je,s),i.addClass(je,s),n.addClass(je,s)]))),h.hideNodes(i._indexes),h.hideEdges(n._indexes),this.context={hiddenEdges:n,hiddenNodes:i,virtualEdges:l}}))}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,virtualEdges:i}=this.context,n=t?this.animation:0,r=this.module.animations;return e.setVisible(!0),s.setVisible(!0),t?(r.hideEdges(i._indexes),r.pushBefore((()=>Promise.all([e.addClass(je),s.addClass(je)]))),r.push((()=>Promise.all([i.addClass(je,n),e.removeClass(je,n),s.removeClass(je,n)])))):i.setVisible(!1),Promise.resolve()}cleanup(){const t=this.context.virtualEdges||this.ogma.createEdgeList();return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then((()=>{this.resetContext()}))}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter((s=>!t.has(s._index)))),this.context.hiddenEdges=this.context.hiddenEdges.filter((s=>!t.has(s._index)))}setOptions(t){return this.selector=t.selector||this.selector,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,super.setOptions(t)}};function kB(t,e,s,i,n,r,o,a){let l,d;if(e.source!==void 0&&(l=t.getNode(e.source),l!==n&&l!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid source [${e.source}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(e.target!==void 0&&(d=t.getNode(e.target),d!==n&&d!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid target [${e.target}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(l&&d&&l===d)throw new Error(`addNodeCollapsing: edge generator produced RawEdge with same source and target [${l.getId()}]`);if(l&&!d)d=l===n?r:n;else if(d&&!l)l=d===n?r:n;else if(!l&&!d){let h=!0;for(let u=0;u<o.size;++u)o.get(u).getSource()===n&&(h=!1);for(let u=0;u<a.size;++u)a.get(u).getTarget()===r&&(h=!1);h?(l=r,d=n):(l=n,d=r)}return l&&d?{...e,id:`_gen_${i.getId()}_${l.getId()}_${d.getId()}_${s}`,source:l.getId(),target:d.getId()}:{}}var OB=class extends mn{constructor(t){super(t),this.nodeSelector=t.nodeSelector||hc,this.edgeSelector=t.edgeSelector||hc,this.nodeDataFunction=t.nodeDataFunction||null,this.edgeDataFunction=t.edgeDataFunction||null}getName(){return bs.VirtualProperties}resetContext(){this.context={nodes:this.ogma.nodeList(),oldNodesData:[],edges:this.ogma.edgeList(),oldEdgesData:[]}}run(){const{ogma:t,context:e}=this;return this.nodeDataFunction&&(e.nodes=t.getNodes().filter(this.nodeSelector),e.oldNodesData=F_(e.nodes,this.nodeDataFunction,this.ogma)),this.edgeDataFunction&&(e.edges=t.getEdges().filter(this.edgeSelector),e.oldEdgesData=F_(e.edges,this.edgeDataFunction,this.ogma)),Promise.resolve()}undo(){const{nodes:t,oldNodesData:e,edges:s,oldEdgesData:i}=this.context,n=this.ogma.modules.data;return t&&n.setProperty(t,null,e,{dispatch:!0,virtual:!0}),s&&n.setProperty(s,null,i,{dispatch:!0,virtual:!0}),Promise.resolve()}onRemove(t,e){e&&(this.context.nodes=this.context.nodes.filter((s=>!t.has(s._index)))),this.context.edges=this.context.edges.filter((s=>!t.has(s._index)))}cleanup(){return this.resetContext(),Promise.resolve()}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.nodeDataFunction=t.nodeDataFunction||this.nodeDataFunction,this.edgeDataFunction=t.edgeDataFunction||this.edgeDataFunction,super.setOptions(t)}};function F_(t,e,s){const i=[],n=[];for(let r=0;r<t.size;++r){const o=t.get(r),a=o.getData(),l=e(o);n.push(Cn(a,l)),i.push(a)}return s.modules.data.setProperty(t,null,n,{dispatch:!0,virtual:!0}),i}var Pr=()=>"";function Xo(){return{}}var tA=class extends mn{constructor(t){super(t),this.nodeSelector=t.nodeSelector||Fr,this.nodeGroupIdFunction=t.nodeGroupIdFunction||Pr,this.nodeGenerator=t.nodeGenerator||Xo,this.edgeSelector=t.edgeSelector||Fr,this.edgeGroupIdFunction=t.edgeGroupIdFunction||Pr,this.edgeGenerator=t.edgeGenerator||Xo,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0&&t.separateEdgesByDirection,this.groupSelfLoopEdges=!!t.groupSelfLoopEdges,this.groupEdges=t.groupEdges===void 0||t.groupEdges,this.ogma.events.on("updateNodeData",(({changes:e})=>this.checkChanges(e,!0))).on("updateEdgeData",(({changes:e})=>this.checkChanges(e,!1)))}computeNodeGroupId(t){if(this.nodeGroupIdFunction){if(!this.nodeSelector(t)||this.module.groupController.alreadyGrouped.has(t._index)||this.module.animations.hiddenNodes.has(t._index))return;const e=this.nodeGroupIdFunction(t);return e===void 0?void 0:e}}computeEdgeGroupId(t){if(this.edgeGroupIdFunction)return this.edgeSelector(t)&&!this.module.animations.hiddenEdges.has(t._index)?this.edgeGroupIdFunction(t):void 0}addMetaNodes(){const t=this.id,e=this.ogma,s=e.getNodes(),i=new Map;for(let h=0;h<s.size;++h){const u=s.get(h),c=this.computeNodeGroupId(u);if(c===void 0)continue;let g=i.get(c);g||(g={id:c,nodes:[]},i.set(c,g)),g.nodes.push(u)}const n=Array.from(i.values()),r=n.map((({nodes:h})=>e.getNodes(h))),o=[],a=[],l=new Set,{nodeDataUpdates:d}=this.context;for(let h=0;h<n.length;++h){const u=n[h].id,c=r[h],g=this.nodeGenerator(c,u,this);if(g){if(g.id===void 0&&(g.id=ad(u,t)),l.has(g.id))throw new Error(`Ogma transformations: NodeGrouping ${this.id} is trying to create two different metaNodes with the same id.`);l.add(g.id),a.push(g.id),o.push(g)}else n.splice(h,1),r.splice(h,1),h--}return e.addNodes(o.map((({id:h})=>({id:h}))),{virtual:!0}).then((h=>{const u=e.getNodes(a);e.modules.individualAttributes.replaceOriginalAttributes(u,o.map((({attributes:g})=>g)));const c=u.getData();for(let g=0;g<c.length;g++){const m=c[g],f=o[g];c[g]=Cn(Cn(m,f.data),d.get(a[g]))}return e.modules.data.setProperty(u,null,c,{dispatch:!0,virtual:!0}),u.setVisible(!0),this.context.metaNodes&&this.module.removeMetaNodes(this.context.metaNodes),this.assignMetaSubNodes(u,r),{metaNodes:u,newNodes:h}}))}assignMetaSubNodes(t,e){const s=t._indexes;for(let i=0;i<s.length;i++){const n=e[i]._indexes,r=s[i],o=t.get(i);for(let a=0;a<n.length;a++)this.module.setMetaNode(n[a],o),this.module.groupController.alreadyGrouped.add(n[a]);this.module.setSubNodes(r,e[i]),this.module.setTransformation(r,this,!0)}}addMetaEdges(t){const e=this.id,s=this.ogma;let i,n=!1;const r=new Set;t?(i=this.module.getSubNodes(t).getAdjacentElements({bothExtremities:!1}).edges,n=!0):i=s.getEdges();const o=new Map,a=this.ogma.modules.graphics.getAttributesManager().getUsedEdgeAttributes().filter((f=>f!=="curvature")),l=new Map;for(let f=0;f<i.size;++f){const p=i.get(f),_=this.computeEdgeGroupId(p);if(_==null)continue;let x=p.getSource(),y=p.getTarget();if(n){let A=this.module.nodeToMeta.get(x._index);A&&A.getTransformation().getId()!==this.getId()&&(A=x);let S=this.module.nodeToMeta.get(y._index);if(S&&S.getTransformation().getId()!==this.getId()&&(S=y),x=A||x,y=S||y,x&&x===y&&(l.has(x._index)?l.get(x._index).push(p._index):l.set(x._index,[p._index]),!this.groupSelfLoopEdges))continue}const b=this.groupEdges?mB(_,x.getId(),y.getId(),this.separateEdgesByDirection):`${p.getId()}:${x.getId()}->${y.getId()}`;let v=o.get(b);v||(v={id:b,source:x,target:y,edges:[]},o.set(b,v)),v.edges.push(p)}const d=Array.from(o.values()),h=d.map((({edges:f})=>s.getEdges(f))),u=[],{edgeDataUpdates:c}=this.context,g=[],m=[];r.clear();for(let f=0;f<d.length;++f){const p=d[f],_=p.id,x=h[f],y=this.groupEdges?this.edgeGenerator(x,_,p.source,p.target,this):cB(x,a);if(y){if(y.id===null)throw Error(`The id ${y.id} returned by the edgeGenerator function is not unique.`);if(y.id===void 0&&(y.id=ad(_,e)),r.has(y.id))throw new Error(`Ogma transformations: NodeGrouping ${this.id} is trying to create two different metaEdges with the same id.`);r.add(y.id),g.push(y.id),p.source===p.target&&m.push(y.id),y.source=p.source.getId(),y.target=p.target.getId(),u.push(y)}}return s.addEdges(gB(u),{virtual:!0}).then((()=>{const f=s.getEdges(g),p=s.getEdges(m);p.setVisible(!1),f.setVisible(!1),s.modules.individualAttributes.replaceOriginalAttributes(f,u.map((x=>x.attributes)));const _=f.getData();for(let x=0;x<_.length;x++){const y=u[x],b=_[x];_[x]=Cn(Cn(b,y.data),c.get(g[x]))}return s.modules.data.setProperty(f,null,_,{dispatch:!0,virtual:!0}),this.context.metaEdges&&this.module.removeMetaEdges(this.context.metaEdges),this.assignMetaSubEdges(f,h),{intraEdges:l,metaEdges:f,selfLoopEdges:p,subEdges:h}}))}assignMetaSubEdges(t,e){const s=t._indexes;for(let i=0;i<s.length;i++){const n=e[i]._indexes,r=s[i],o=t.get(i);for(let a=0;a<n.length;a++)this.module.setMetaEdge(n[a],o);this.module.setSubEdges(r,e[i]),this.module.setTransformation(r,this,!1)}}removeMetaEdges(t){t.forEach((e=>{const s=this.module.getSubEdges(e);if(!s)return;const i=s._indexes;for(let r=0;r<i.length;r++)this.module.clearMetaEdge(i[r]);this.module.clearSubEdges(e._index);const n=this.module.getMetaEdge(e);if(n){for(let r=0;r<i.length;r++)this.module.setMetaEdge(i[r],n);this.module.setSubEdges(n._index,this.module.getSubEdges(n).filter((r=>r!==e)).concat(s))}s.filter((r=>r.getTarget().isVisible()&&r.getSource().isVisible())).setVisible(!0)})),t.setVisible(!1)}removeMetaNodes(t){t.forEach((e=>{const s=this.module.getSubNodes(e);if(!s)return;const i=s._indexes;for(const n of i)this.module.clearMetaNode(n);this.module.clearSubNodes(e._index),s.setVisible(!0)})),t.setVisible(!1)}onRemove(t,e){}checkChanges(t,e){const s=e?this.context.nodeDataUpdates:this.context.edgeDataUpdates,i=this.module;for(let n=0;n<t.length;n++){const{property:r,newValues:o,virtual:a,nodes:l,edges:d}=t[n];if(a)continue;const h=e?l.filter((u=>i.getTransformation(u._index,e)===this)):d.filter((u=>i.getTransformation(u._index,e)===this));if(h.size)for(let u=0;u<h._indexes.length;u++){const c=h.get(u).getId();let g=s.get(c)||{};const m=o[u];r?Tn(g,r,m):g=m,s.set(c,g)}}}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.nodeGroupIdFunction=t.nodeGroupIdFunction||this.nodeGroupIdFunction,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.edgeGroupIdFunction=t.edgeGroupIdFunction||this.edgeGroupIdFunction,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0?!!t.separateEdgesByDirection:this.separateEdgesByDirection,this.groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this.groupSelfLoopEdges,this.groupEdges=t.groupEdges!==void 0?!!t.groupEdges:this.groupEdges,super.setOptions(t)}resetContext(){super.resetContext(),this.context={...this.context,nodeDataUpdates:new Map,edgeDataUpdates:new Map}}},eA=class extends tA{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,padding:o=2,onBeforeAddMetaEdges:a,selector:l=Fr,groupIdFunction:d=Pr,edgeGroupIdFunction:h=Pr,nodeGenerator:u=Xo,edgeGenerator:c=Xo,onGroupUpdate:g=(()=>{}),separateEdgesByDirection:m=!1,groupSelfLoopEdges:f=!1,groupEdges:p=!0,restorePositions:_=!0,showContents:x=!1}){super({id:s,ogma:i,module:n,nodeSelector:l,nodeGroupIdFunction:d,edgeGroupIdFunction:h,nodeGenerator:u,edgeSelector:y=>!(!this.module.getMetaNode(y.getSource())&&!this.module.getMetaNode(y.getTarget())),edgeGenerator:c,separateEdgesByDirection:m,groupEdges:p,groupSelfLoopEdges:f,duration:t,easing:e,enabled:r}),this.onBeforeAddMetaEdges=a||(()=>Promise.resolve()),this.onGroupUpdate=g,this._padding=o,this._showContents=typeof x!="function"?()=>x:x,this._restorePositions=_,this.module.groupController.setNodeGroupingCount(this.module.groupController.getNodeGroupingCount()+1)}getName(){return bs.NodeGrouping}get padding(){return this._padding}set padding(t){this._padding=t,this.refresh()}resetContext(){super.resetContext(),this.context={...this.context,metaNodes:this.ogma.nodeList(),metaEdges:this.ogma.edgeList(),subNodes:this.ogma.nodeList(),intraEdges:this.ogma.edgeList(),subNodesPerMetaNode:new Map,subEdges:this.ogma.edgeList()}}run(){let t,e;const s=this.ogma,i=this.module.animations,n=this.module.groupController,r=n.layoutController;let o=s.createNodeList(),a=s.createEdgeList();const l=[];let d=s.createEdgeList();const h=new Map,u=-(this.getIndex()+KE),c=new Set,g=[],m=[],f=[];let p;const _=s.geo.enabled();return this.addMetaNodes().then((({metaNodes:x,newNodes:y})=>{p=n.setPadding(x,this._padding),t=x;for(let b=0;b<y.size;b++)c.add(y._indexes[b]);for(let b=0;b<t.size;b++)n.setNodeLayer(t._indexes[b],u);return this.onBeforeAddMetaEdges(t,y).then((()=>this.addMetaEdges(t)))})).then((({intraEdges:x,metaEdges:y,selfLoopEdges:b})=>{e=y,a=this.module.getSubEdges(e),e.filter((S=>S.getExtremities().map((w=>w.isVisible())).every((w=>w)))).setVisible(!0);for(let S=0;S<e.size;S++)n.edgeLayer.set(e._indexes[S],u);a.setVisible(!1);const v=this.context.metaNodes.subtract(t),A=this.context.metaEdges.subtract(e);return this.module.removeMetaNodes(v),this.module.removeMetaEdges(A),n.cleanup(v,A),s.removeNodes(v,{virtual:!0}).then((()=>s.removeEdges(A,{virtual:!0}))).then((()=>({intraEdges:x,metaEdges:y,selfLoopEdges:b})))})).then((({intraEdges:x,selfLoopEdges:y})=>{const b=t._indexes,v=[],A=t.getPosition();for(let S=0;S<b.length;S++){const w=t.get(S),I=n.isClose(w),M=!I&&!n.isOpen(w),N=n.collapsedGroups.has(w._index),D=this._showContents(w),q=this.module.getSubNodes(w),et=A[S],O=q._indexes,K=new Set;if(M){const{x:pt,y:Pt}=n.getGroupXYR(w,this.module.getSubNodes(w),void 0,void 0);_?n.setGeoLatLng(w,Pt,pt):(m.push({x:pt,y:Pt}),f.push(w._index),et.x=pt,et.y=Pt)}h.set(b[S],K);const j=x.has(w._index)&&s.edgeList(x.get(w._index));j&&(d=d.concat(j),j.setVisible(D&&!N)),y.setVisible(!0),o=o.concat(q);for(let pt=0;pt<O.length;pt++)K.add(O[pt]);const ot=this.context.subNodesPerMetaNode.get(b[S]),it=p.has(w._index);let ct=!ot||r.shouldRelayout.has(w._index);if(!ct&&ot)for(const pt of ot.keys())ct||(ct=!K.has(pt));if(!ct&&ot)for(let pt=0;pt<O.length;pt++)ct||(ct=!ot.has(O[pt]));if(ct&&(r.shouldRelayout.add(w._index),v.push(n.layoutController.getLayoutFunction(this.onGroupUpdate,w,q,D))),D){if(I?n.expandGroup(w,q):n.addOpenGroup(w),ct||it||I){g.push(w);const pt=this.module.getMetaNode(w);pt&&r.shouldRelayout.add(pt._index)}}else n.closeGroup(w,q,et.x,et.y)}return f.length&&i.pushBefore((()=>{s.nodeList(f).setAttributes(m)})),n.layoutController.handleLayoutFunctions(v).then((()=>{g.forEach((S=>n.setGroupXYR(S))),_&&this.ogma.modules.geo._updateNodesCoordinates(t)}))})).then((()=>(this.context={metaNodes:t,metaEdges:e,subNodesPerMetaNode:h,subNodes:o,intraEdges:d,nodeDataUpdates:this.context.nodeDataUpdates,edgeDataUpdates:this.context.edgeDataUpdates,subEdges:a},l)))}undo(t=!0){super.undo(t);const{metaNodes:e,metaEdges:s,intraEdges:i,subNodes:n,subEdges:r}=this.context,o=this.module.animations,a=this.module.groupController;if(i.setVisible(!0),r.setVisible(!0),s.setVisible(!1),n.setVisible(!0),e.setVisible(!1),t){o.pushBefore((()=>{e.setVisible(!0),s.setVisible(!0)})),o.pushAfter((()=>{e.setVisible(!1),s.setVisible(!1)}));for(let l=0;l<s.size;l++)this.module.isVirtual(s._indexes[l],!1)||a.edgeLayer.delete(s._indexes[l]);for(let l=0;l<r.size;l++)this.module.isVirtual(r._indexes[l],!1)||a.edgeLayer.delete(r._indexes[l]);for(let l=0;l<i.size;l++)this.module.isVirtual(i._indexes[l],!1)||a.edgeLayer.delete(i._indexes[l]);for(let l=0;l<n.size;l++)this.module.isVirtual(n._indexes[l],!0)||a.nodeLayer.delete(n._indexes[l]);this.context.subNodesPerMetaNode.clear(),e.forEach((l=>{const d=this.module.getSubNodes(l);if(a.nodeLayer.delete(l._index),a.isClose(l))a.expandGroup(l,d,!0);else{const h=l.getPosition();a.closeGroup(l,d,h.x,h.y,!0)}}))}}onRemove(t,e){if(e){const s=this.context.metaNodes.size;this.context.metaNodes=this.context.metaNodes.filter((n=>!t.has(n._index)));const i=this.context.subNodes.size;this.context.subNodes=this.context.subNodes.filter((n=>!t.has(n._index))),(this.context.subNodes.size!==s||this.context.metaNodes.size!==i)&&this.context.subNodesPerMetaNode.clear()}else this.context.subEdges=this.context.subEdges.filter((s=>!t.has(s._index))),this.context.metaEdges=this.context.metaEdges.filter((s=>!t.has(s._index)))}cleanup(){const{ogma:t}=this,e=this.context,{metaNodes:s,metaEdges:i,subNodes:n}=e;return this.module.removeMetaNodes(s),this.module.removeMetaEdges(i),this.module.groupController.cleanup(s,i,n),this.module.groupController.setNodeGroupingCount(this.module.groupController.getNodeGroupingCount()-1),super.cleanup(),Promise.all([t.removeEdges(i,{virtual:!0}),t.removeNodes(s,{virtual:!0})]).then((()=>Promise.resolve()))}setOptions({duration:t,easing:e,enabled:s,padding:i,selector:n,groupIdFunction:r,nodeGenerator:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupSelfLoopEdges:h,groupEdges:u,restorePositions:c,showContents:g}){return this._padding=i!==void 0?i:this.padding,this._showContents=g!==void 0?typeof g!="function"?()=>g:g:this._showContents,this._restorePositions=c===void 0?this._restorePositions:c,super.setOptions({nodeSelector:n,nodeGroupIdFunction:r,nodeGenerator:o,edgeSelector:m=>!(!this.module.getMetaNode(m.getSource())&&!this.module.getMetaNode(m.getTarget())),edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:u,groupSelfLoopEdges:h,duration:t,easing:e,enabled:s})}},BB=class extends tA{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,selector:o=Fr,groupIdFunction:a=Pr,generator:l=Xo,separateEdgesByDirection:d=!1}){super({id:s,ogma:i,module:n,nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:!0,groupSelfLoopEdges:!0,duration:t,easing:e,enabled:r})}resetContext(){super.resetContext(),this.context={...this.context,metaEdges:this.ogma.edgeList(),subEdges:this.ogma.edgeList()}}getName(){return bs.EdgeGrouping}run(){let t,e;const s=this.module.animations,i=new Set(this.context.metaEdges.getId());return this.addMetaEdges().then((({metaEdges:n})=>{t=n,e=this.module.getSubEdges(t),t.setVisible(!0),e.setVisible(!1),s.hideEdges(e._indexes);const r=t.concat(this.context.metaEdges).getParallelEdges().dedupe().filter((d=>!i.has(d.getId()))),o=new Array(r.size),a=new Map;for(let d=0;d<r.size;d++)o[d]=this.ogma.modules.curvatureManager.computeCurvature(r.get(d),"visible"),a.set(r._indexes[d],o[d]);const l=this.module.getSubEdges(r);l.setVisible(!0),this.module.animations.setCurvatures(r._indexes,o);for(let d=0;d<l._indexes.length;d++)this.module.animations.setCurvature(e._indexes[d],a.get(this.module.getMetaEdge(e.get(d))._index)||0)})).then((()=>{this.context.metaEdges=t,this.context.subEdges=e}))}undo(t=!0){super.undo(t);const{metaEdges:e,subEdges:s}=this.context;if(s.setVisible(!0),e.setVisible(!1),!t)return Promise.resolve();const i=s.getParallelEdges().dedupe(),n=new Array(i.size),r=new Map;for(let o=0;o<i.size;o++)n[o]=this.ogma.modules.curvatureManager.computeCurvature(i.get(o),"visible"),r.set(i._indexes[o],n[o]);return this.module.animations.setCurvatures(i._indexes,n),Promise.resolve()}onRemove(t,e){e||(this.context.subEdges=this.context.subEdges.filter((s=>!t.has(s._index))))}_getCurvatures(t){return t.map((e=>this.ogma.modules.curvatureManager.computeCurvature(e,"visible",(()=>!0))))}cleanup(){const{metaEdges:t}=this.context;return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then((()=>(this.context.metaEdges=this.ogma.edgeList(),this.context.subEdges=this.ogma.edgeList(),Promise.resolve())))}setOptions({duration:t,easing:e,enabled:s,selector:i,groupIdFunction:n,generator:r,separateEdgesByDirection:o}){return super.setOptions({nodeSelector:void 0,nodeGroupIdFunction:void 0,nodeGenerator:void 0,edgeSelector:i,edgeGroupIdFunction:n,edgeGenerator:r,separateEdgesByDirection:o,groupEdges:!0,duration:t,easing:e,enabled:s})}},P_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ih=1,Wr=8,UB=class sA{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,i]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(n!==Ih)throw new Error(`Got v${n} data when expected v${Ih}.`);const r=P_[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new sA(a,o,r,e)}constructor(e,s=64,i=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=P_.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-a%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,Wr,e),this.coords=new this.ArrayType(this.data,Wr+a+l,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(Wr+o+a+l),this.ids=new this.IndexArrayType(this.data,Wr,e),this.coords=new this.ArrayType(this.data,Wr+a+l,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(Ih<<4)+r]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=s,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return uc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:a}=this,l=[0,r.length-1,0],d=[];for(;l.length;){const h=l.pop()||0,u=l.pop()||0,c=l.pop()||0;if(u-c<=a){for(let p=c;p<=u;p++){const _=o[2*p],x=o[2*p+1];_>=e&&_<=i&&x>=s&&x<=n&&d.push(r[p])}continue}const g=c+u>>1,m=o[2*g],f=o[2*g+1];m>=e&&m<=i&&f>=s&&f<=n&&d.push(r[g]),(h===0?e<=m:s<=f)&&(l.push(c),l.push(g-1),l.push(1-h)),(h===0?i>=m:n>=f)&&(l.push(g+1),l.push(u),l.push(1-h))}return d}within(e,s,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,a=[0,n.length-1,0],l=[],d=i*i;for(;a.length;){const h=a.pop()||0,u=a.pop()||0,c=a.pop()||0;if(u-c<=o){for(let p=c;p<=u;p++)z_(r[2*p],r[2*p+1],e,s)<=d&&l.push(n[p]);continue}const g=c+u>>1,m=r[2*g],f=r[2*g+1];z_(m,f,e,s)<=d&&l.push(n[g]),(h===0?e-i<=m:s-i<=f)&&(a.push(c),a.push(g-1),a.push(1-h)),(h===0?e+i>=m:s+i>=f)&&(a.push(g+1),a.push(u),a.push(1-h))}return l}};function uc(t,e,s,i,n,r){if(n-i<=s)return;const o=i+n>>1;iA(t,e,o,i,n,r),uc(t,e,s,i,o-1,1-r),uc(t,e,s,o+1,n,1-r)}function iA(t,e,s,i,n,r){for(;n>i;){if(n-i>600){const d=n-i+1,h=s-i+1,u=Math.log(d),c=.5*Math.exp(2*u/3),g=.5*Math.sqrt(u*c*(d-c)/d)*(h-d/2<0?-1:1);iA(t,e,s,Math.max(i,Math.floor(s-h*c/d+g)),Math.min(n,Math.floor(s+(d-h)*c/d+g)),r)}const o=e[2*s+r];let a=i,l=n;for($r(t,e,i,s),e[2*n+r]>o&&$r(t,e,i,n);a<l;){for($r(t,e,a,l),a++,l--;e[2*a+r]<o;)a++;for(;e[2*l+r]>o;)l--}e[2*i+r]===o?$r(t,e,i,l):(l++,$r(t,e,l,n)),l<=s&&(i=l+1),s<=l&&(n=l-1)}}function $r(t,e,s,i){Mh(t,s,i),Mh(e,2*s,2*i),Mh(e,2*s+1,2*i+1)}function Mh(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function z_(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}var GB=t=>t/360+.5,VB=t=>{const e=Math.sin(t*Math.PI/180),s=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return s<0?0:s>1?1:s},qB=t=>{const e=Math.PI-2*Math.PI*t;return 360/Math.PI*Math.atan(Math.exp(e))-90},HB=t=>360*(t-.5);function jB(t,e,s,i,n,r){let o=t._indexes.length;const a=t.getData(r.modules.geo.latitudePath),l=t.getData(r.modules.geo.longitudePath),d=new Float32Array(o),h=new Float32Array(o),u=new Uint32Array(o),c=new Uint32Array(o),g=new Map,m=new Map;let f,p=-1,_=!0;for(let A=0;A<a.length;A++){const S=a[A],w=l[A];m.set(t._indexes[A],e[A]);const I=VB(S),M=GB(w);d[A]=I,h[A]=M,u[A]=t._indexes[A],p=Math.max(p,t._indexes[A])}let x=p+1;const[y,b]=s,v=[];for(let A=0,S=b;A<20;A++,S=b-(b-y)*A/19){if(_){f=new UB(o,64,Float32Array);for(let O=0;O<o;O++)f.add(h[O],d[O]);f.finish()}_=!1;const w=i/(n*Math.pow(2,S)),I=[],M=new Set,N=new Set;for(let O=0;O<o;O++){if(M.has(u[O]))continue;const K=f.within(h[O],d[O],w);if(K.length===0&&K.push(O),K.length===1){const Gt=u[K[0]];if(M.add(Gt),g.has(Gt)){N.add(Gt);const Dt=g.get(Gt);I.push(Dt),g.set(Dt.id,Dt),m.set(Dt.id,Dt.groupId)}continue}const j=x++,ot=[];let it=0;const ct=m.get(u[O]);let pt=0,Pt=0;for(let Gt=0;Gt<K.length;Gt++){const Dt=K[Gt];if(!M.has(u[Dt])&&ct===m.get(u[Dt])){if(M.add(u[Dt]),N.add(u[Dt]),g.has(u[Dt])){const Rt=g.get(u[Dt]),Tt=Rt.subNodes.size;it+=Tt,pt+=Rt.mercatorLat*Tt,Pt+=Rt.mercatorLng*Tt}else it+=1,pt+=d[Dt],Pt+=h[Dt];ot.push(u[Dt])}}if(pt/=it,Pt/=it,it<2){N.delete(u[O]);continue}const At=new Uint32Array(it);let bt=0;for(let Gt=0;Gt<ot.length;Gt++){const Dt=ot[Gt];if(g.has(Dt)){const Rt=g.get(Dt);for(let Tt=0;Tt<Rt.subNodes.size;Tt++)At[bt++]=Rt.subNodes._indexes[Tt]}else At[bt++]=Dt}const It=r.nodeList(At);m.set(j,ct);const Ut={id:j,groupId:ct,zoom:S,lat:qB(pt),lng:HB(Pt),mercatorLat:pt,mercatorLng:Pt,subNodes:It};g.set(Ut.id,Ut),I.push(Ut),_=!0}let D=0,q=0;for(let O=0;O<o;O++)N.has(u[O])||(u[D]=u[O],d[D]=d[O],h[D]=h[O],c[q]=u[O],D++,q++);const et=new Uint32Array(q);for(let O=0;O<q;O++)et[O]=c[O];for(const O of I)u[D]=O.id,d[D]=O.mercatorLat,h[D]=O.mercatorLng,D++;o=q+I.length,(!(A>0)||I.length)&&v.push({zoom:S,clusters:I,unclusteredNodeIndexes:et})}return v}var YB=256,XB=class extends eA{constructor(t){super({...t,enabled:t.enabled&&t.ogma.geo.enabled(),showContents:!1,selector:e=>{const s=this.getPosition(e);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!t.selector||t.selector(e))},groupIdFunction:t.groupIdFunction,edgeGroupIdFunction:t.edgeGroupIdFunction,nodeGenerator:t.nodeGenerator}),this._clustersByZoom=[],this._nullZoomLevel={zoom:-1/0,nodes:this.ogma.nodeList(),edges:this.ogma.edgeList(),metaNodes:this.ogma.nodeList(),subNodes:[],subEdges:[],metaEdges:this.ogma.edgeList()},this._currentClusters=this._nullZoomLevel,this._zoomLevels=t.zoomLevels?t.zoomLevels:[0,22],this._groupingRadius=t.radius===void 0?60:t.radius,this._generateIdFunction=t.groupIdFunction||(()=>""),this._shouldEnable=t.enabled,this._shouldRefreshClusters=!0,this._selectedNodes=this.ogma.nodeList(),this._selectedEdges=this.ogma.edgeList(),this.ogma.events.on("beforeGeoCameraMove",(({zoom:e})=>{!this.isEnabled()||!this.ogma.geo.enabled()||Math.abs(this.getBestZoomLevel(e).zoom-this._currentClusters.zoom)<.01||(this._shouldRefreshClusters=!1,this.refresh())})).on("geoDisabled",(()=>{this.isEnabled()&&this.disable(0).then((()=>{this._shouldEnable=!0}))})).on("geoEnabled",(()=>{this._shouldEnable&&this.enable(0)}))}getPosition(t){return{x:t.getData(this.ogma.modules.geo.latitudePath),y:t.getData(this.ogma.modules.geo.longitudePath)}}getName(){return bs.GeoClustering}enable(t){return this.ogma&&!this.ogma.geo.enabled()?(this._shouldEnable=!0,Promise.resolve()):super.enable(t)}undo(t=!0){const{metaNodes:e,metaEdges:s}=this._currentClusters;return e.setVisible(!1),s.setVisible(!1),this._selectedNodes.setVisible(!0),this._selectedEdges.setVisible(!0),Promise.resolve()}disable(t){return this._shouldEnable=!1,super.disable(t)}async onePassCluster(){for(let n=0;n<this._clustersByZoom.length;n++){const r=this._clustersByZoom[n];this.module.removeMetaNodes(r.metaNodes),this.module.removeMetaEdges(r.metaEdges),await this.ogma.removeNodes(r.metaNodes,{virtual:!0}),await this.ogma.removeEdges(r.metaEdges,{virtual:!0})}const t=this.ogma.getNodes().filter((n=>this.nodeSelector(n)));this._selectedEdges=t.getAdjacentEdges({bothExtremities:!0});const e=[],s=t.map((n=>this._generateIdFunction(n))),i=jB(t,s,this._zoomLevels,this._groupingRadius,YB,this.ogma);for(let n=0;n<i.length;n++){const{clusters:r,zoom:o,unclusteredNodeIndexes:a}=i[n],l=r.map((({id:f,groupId:p,lat:_,lng:x,subNodes:y})=>{const b=this.nodeGenerator(y,p,this);return b.data||(b.data={}),Tn(b.data,this.ogma.modules.geo.latitudePath,_),Tn(b.data,this.ogma.modules.geo.longitudePath,x),b.id=`geo-cluster-${f}-${p}`,b}));await this.ogma.addNodes(l,{virtual:!0});const d=this.ogma.getNodes(r.map((f=>`geo-cluster-${f.id}-${f.groupId}`))),h=r.map((f=>f.subNodes));this.assignMetaSubNodes(d,h);const{metaEdges:u,subEdges:c}=await this.addMetaEdges(d),g=this.ogma.nodeList(a),m=g.getAdjacentEdges({bothExtremities:!0});this.module.removeMetaNodes(d),this.module.removeMetaEdges(u),d.setVisible(!1),u.setVisible(!1),e.push({nodes:g,edges:m,zoom:o,metaNodes:d,subNodes:h,subEdges:c,metaEdges:u})}this._clustersByZoom=e,this._selectedNodes=t}getBestZoomLevel(t){return this._clustersByZoom.reduce(((e,s)=>t<s.zoom?s:e),this._nullZoomLevel)}async run(){var t;this._shouldRefreshClusters&&await this.onePassCluster(),this._shouldRefreshClusters=!0;const e=this._currentClusters,s=((t=this.ogma.geo.getMap())==null?void 0:t.getZoom())||0,i=this.getBestZoomLevel(s);return this._currentClusters=i,e&&(this.module.removeMetaNodes(e.metaNodes),this.module.removeMetaEdges(e.metaEdges)),this._selectedEdges.setVisible(!1),this._selectedNodes.setVisible(!1),i.nodes.setVisible(!0),i.edges.setVisible(!0),i.metaNodes.setVisible(!0),i.metaEdges.setVisible(!0),this.assignMetaSubNodes(i.metaNodes,i.subNodes),this.assignMetaSubEdges(i.metaEdges,i.subEdges),this.ogma.modules.geo._updateNodesCoordinates(i.metaNodes),this.ogma.modules.geo.updateProjection(),[]}setOptions(t){const e=super.setOptions({...t,selector:s=>{const i=this.getPosition(s);return i&&!isNaN(i.x)&&!isNaN(i.y)&&(!t.selector||t.selector(s))},groupIdFunction:t.groupIdFunction,nodeGenerator:t.nodeGenerator,edgeGroupIdFunction:t.edgeGroupIdFunction});return this._groupingRadius=t.radius===void 0?this._groupingRadius:t.radius,this._generateIdFunction=t.groupIdFunction||this._generateIdFunction,this._shouldRefreshClusters=!0,this._shouldEnable=t.enabled,this._zoomLevels=t.zoomLevels!==void 0?t.zoomLevels:this._zoomLevels,e}},D_=()=>({}),WB=class extends mn{constructor(t){super(t),this._groupSelfLoopEdges=!1,this._isCleaningUp=!1,this._isRunning=!1,this.shouldDo=!0,this.enabled=!1,this._onBeforeAdd=e=>{if(this._isCleaningUp||!this.enabled||e.virtual)return;const{isNode:s,objects:i}=e;if(s){const n=i;k_(n,this._groupNodes(n))}else{const n=i;k_(n,this._groupEdges(n))}this._shouldSetVirtual=!0},this._onAfterAdd=e=>{this._shouldSetVirtual&&(this._shouldSetVirtual=!1,this._setVirtual(e.nodes||e.edges,!!e.nodes))},this._onRequestElementsToDelete=e=>{if(e.virtual)return;const{ogma:s,context:i}=this,n=e.elementsToRemove.isNode,r=n?s.getNodes:s.getEdges,o=n?i.metaNodesSet:i.metaEdgesSet,a=n?i.nodeGroups:i.edgeGroups,l=n?s.removeNodes:s.removeEdges,d=e.elementsToRemove.size,h=r(Array.from(o)),u=e.elementsToRemove.slice();if(e.elementsToRemove=e.elementsToRemove.subtract(h),e.elementsToRemove.size===d)return;const c=u.subtract(e.elementsToRemove);if(c.forEach((g=>{a.delete(g.getId())})),n){const g=c.getAdjacentEdges().filter((m=>m.isVirtual()));s.removeEdges(g)}l(c,{virtual:!0})},this._nodeToGroupId=t.groupIdFunction||Pr,this._groupSelfLoopEdges=!!t.groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||D_,this._edgeGenerator=t.edgeGenerator||D_,this._shouldSetVirtual=!1,this._selector=t.selector,this.shouldDo=t.enabled===void 0||!!t.enabled,this.ogma.events.on("preAddElements",this._onBeforeAdd).on("requestElementsToDelete",this._onRequestElementsToDelete).on(["postAddGraph","addNodes","addEdges"],this._onAfterAdd),this.shouldDo&&(this.enable(),this.shouldDo=!1)}getName(){return bs.NodeClustering}enable(){if(this.enabled)return Promise.resolve();this.enabled=!0,this.shouldDo=!0,this._isRunning=!0;const{ogma:t}=this;return t.getNodes().size?t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then((e=>(t.clearGraph(),t.setGraph(e)))).then((()=>(this._isRunning=!1,Promise.resolve()))):(this._isRunning=!1,Promise.resolve())}disable(){return this.enabled?(this.enabled=!1,this.shouldDo=!1,super.disable()):Promise.resolve()}destroy(){return this.disable(),super.destroy()}run(){const{ogma:t}=this;return this.enabled||!this.shouldDo?Promise.resolve():t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then((e=>(this._isCleaningUp=!0,t.clearGraph(),this._isCleaningUp=!1,t.setGraph(e))))}undo(){if(this._isRunning||this.enabled)return Promise.resolve();const{ogma:t,context:e}=this;this._isCleaningUp=!0;const s=t.getNodes(Array.from(e.metaNodesSet));this.module.removeMetaNodes(s);const i=t.getEdges(Array.from(e.metaEdgesSet));this.module.removeMetaEdges(i);const n=this._getSubNodes(),r=this._getSubEdges();return this.resetContext(),t.removeNodes(s,{virtual:!0}).then((()=>t.removeEdges(i,{virtual:!0}))).then((()=>t.addNodes(n))).then((()=>t.addEdges(r))).then((()=>{this._isCleaningUp=!1,Promise.resolve()}))}cleanup(){return this._isRunning||this.ogma.events.off(this._onBeforeAdd).off(this._onRequestElementsToDelete).off(this._onAfterAdd),Promise.resolve()}resetContext(){this._isRunning||(this.context={nodeGroups:new Map,edgeGroups:new Map,metaNodesSet:new Set,metaEdgesSet:new Set,virtualNodes:this.ogma.createNodeList(),virtualEdges:this.ogma.createEdgeList(),nodeToGroupId:new Map})}getSubNodes(t){const e=this.context.nodeGroups.get(t.getId());return e?e.nodes:[]}getSubEdges(t){const e=this.context.edgeGroups.get(t.getId());return e?e.edges:[]}_getSubNodes(){return Array.from(this.context.nodeGroups.values()).reduce(((t,{nodes:e})=>(t.push(...e),t)),[])}_getSubEdges(){return Array.from(this.context.edgeGroups.values()).reduce(((t,{edges:e})=>(t.push(...e),t)),[])}_setVirtual(t,e){if(!t)return;const{context:s}=this,i=e?s.metaNodesSet:s.metaEdgesSet,n=t.filter((r=>i.has(r.getId())));if(e)for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubNodes(n._indexes[r],null);else for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubEdges(n._indexes[r],null);e?s.virtualNodes=s.virtualNodes.concat(n):s.virtualEdges=s.virtualEdges.concat(n)}setContext(){}_computeEdgeGroupId(t,e){return t>e?`${e}:${t}`:`${t}:${e}`}_groupEdges(t){const{ogma:e,id:s,context:i}=this,n=s,r=new Map,o=i.nodeToGroupId;i.edgeGroups.forEach((h=>{h.newEdges=[],r.set(h.id,h)}));const a=[];for(let h=0;h<t.length;++h){const u=t[h];let c=i.nodeToGroupId.get(u.source),g=i.nodeToGroupId.get(u.target);if(!c&&!g){a.push(u);continue}c=c||u.source,g=g||u.target;const m=this._computeEdgeGroupId(c,g);if(m!==void 0){const f=o.get(u.source)||u.source,p=o.get(u.target)||u.target;let _=r.get(m);_||(_={id:m,source:f,target:p,edges:[],newEdges:[]},r.set(m,_)),_.edges.push(u),_.newEdges.push(u)}}const l=ld(r),d=l.map((({edges:h})=>h));for(let h=0;h<l.length;++h){const u=l[h];if(!u.newEdges.length)continue;const c=u.id,g=d[h],m=this._edgeGenerator(g,c);m.id===void 0&&(m.id=ad(c,n)),m.source=u.source,m.target=u.target,u.metaEdge=m,i.metaEdgesSet.add(m.id),i.edgeGroups.get(m.id)||i.edgeGroups.set(m.id,u),(this._groupSelfLoopEdges||m.source!==m.target)&&a.push(m)}return e.view.afterNextFrame().then((()=>{i.edgeGroups.forEach((({newEdges:h,metaEdge:u})=>{if(!(h.length&&u&&u.id&&u.attributes))return;const c=e.getEdge(u.id);c?.setAttributes(u.attributes)}))})),a}_groupNodes(t){const{id:e,context:s,ogma:i}=this,n=e,r=new Map;s.nodeGroups.forEach((u=>{u.newNodes=[],r.set(u.id,u)}));const o=[];for(let u=0;u<t.length;u++){const c=t[u];if(this._selector&&!this._selector(c)){o.push(c);continue}c.id=fB(c.id);const g=this._nodeToGroupId(c);if(g!==void 0){let m=r.get(g);m||(m={id:g,nodes:[],newNodes:[]},r.set(g,m)),m.nodes.push(c),m.newNodes.push(c)}else s.nodeToGroupId.set(c.id,c.id)}const a=ld(r),l=a.map((({nodes:u})=>u)),d=a.map((({newNodes:u})=>u)),h=[];for(let u=0;u<a.length;++u){if(!a[u].newNodes.length)continue;const c=a[u].id,g=l[u],m=this._nodeGenerator(g,c);a[u].metaNode=m,m.id===void 0&&(m.id=ad(c,n));for(const f of d[u])s.nodeToGroupId.set(f.id,m.id);s.metaNodesSet.add(m.id),s.nodeGroups.get(m.id)||s.nodeGroups.set(m.id,a[u]),h.push(m)}return h.push(...o),i.view.afterNextFrame().then((()=>{s.nodeGroups.forEach((({newNodes:u,metaNode:c})=>{if(!(u.length&&c&&c.id&&c.attributes))return;const g=i.getNode(c.id);g?.setAttributes(c.attributes)}))})),h}setOptions(t){return this._nodeToGroupId=t.groupIdFunction||this._nodeToGroupId,this._groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this._groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||this._nodeGenerator,this._edgeGenerator=t.edgeGenerator||this._edgeGenerator,this._selector=t.selector||this._selector,this.disable().then((()=>this.undo())).then((()=>this.ogma.view.afterNextFrame())).then((()=>this.enable()))}onRemove(){}};function k_(t,e){const s=e.length;return t.length=s,t.splice(0,s,...e),t}function vi(t){return t.enabled!==!1}var $B=class extends SB{_setOptions(t){const e=t;return e.ogma=this.ogma,e.module=this,e.id=this.transformations.length,e}addNodeGrouping(t={}){const e=new eA(this._setOptions(t));return this.addTransformation(e,vi(t)),e}addEdgeGrouping(t={}){const e=new BB(this._setOptions(t));return this.addTransformation(e,vi(t)),e}addGeoClustering(t={}){const e=new XB(this._setOptions(t));return this.addTransformation(e,t.enabled),e}addNodeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new LB(this._setOptions(e));return this.addTransformation(s,vi(e)),s}addEdgeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new IB(this._setOptions(e));return this.addTransformation(s,vi(e)),s}addNeighborMerging(t){const e=new MB(this._setOptions(t));return this.addTransformation(e,vi(t)),e}addNeighborGeneration(t){const e=new FB(this._setOptions(t));return this.addTransformation(e,vi(t)),e}addNodeCollapsing(t={}){const e=new DB(this._setOptions(t));return this.addTransformation(e,vi(t)),e}addVirtualProperties(t={}){const e=new OB(this._setOptions(t));return this.addTransformation(e,vi(t)),e}addNodeClustering(t={}){const e=new WB(this._setOptions(t));return this.addTransformation(e,vi(t)),e}addDrilldown(t={onGetSubgraph:()=>Promise.resolve({nodes:[],edges:[]})}){const e=new pB(this._setOptions(t));return this.drilldownController.addDrilldown(e),e}onGroupsUpdated(t){this.groupController.layoutController.onGroupsUpdate=t}triggerGroupsUpdated(){this.groupController.triggerGroupsUpdate()}layoutGroups(t,e,s=!1){return this.groupController.layoutGroups(t,e,s)}getXYR(t){return this.animations.getXYR(t)}fishEyeExpand(t,e,s){return this.groupController.fishEyeExpand(t,e,s)}fishEyeCollapse(t,e){return this.groupController.fishEyeCollapse(t,e)}};function ZB(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Nh={exports:{}},O_;function KB(){return O_||(O_=1,(function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}function r(l,d,h,u,c){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new n(h,u||l,c),m=s?s+d:d;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],g]:l._events[m].push(g):(l._events[m]=g,l._eventsCount++),l}function o(l,d){--l._eventsCount===0?l._events=new i:delete l._events[d]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(s?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},a.prototype.listeners=function(d){var h=s?s+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,g=u.length,m=new Array(g);c<g;c++)m[c]=u[c].fn;return m},a.prototype.listenerCount=function(d){var h=s?s+d:d,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(d,h,u,c,g,m){var f=s?s+d:d;if(!this._events[f])return!1;var p=this._events[f],_=arguments.length,x,y;if(p.fn){switch(p.once&&this.removeListener(d,p.fn,void 0,!0),_){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,h),!0;case 3:return p.fn.call(p.context,h,u),!0;case 4:return p.fn.call(p.context,h,u,c),!0;case 5:return p.fn.call(p.context,h,u,c,g),!0;case 6:return p.fn.call(p.context,h,u,c,g,m),!0}for(y=1,x=new Array(_-1);y<_;y++)x[y-1]=arguments[y];p.fn.apply(p.context,x)}else{var b=p.length,v;for(y=0;y<b;y++)switch(p[y].once&&this.removeListener(d,p[y].fn,void 0,!0),_){case 1:p[y].fn.call(p[y].context);break;case 2:p[y].fn.call(p[y].context,h);break;case 3:p[y].fn.call(p[y].context,h,u);break;case 4:p[y].fn.call(p[y].context,h,u,c);break;default:if(!x)for(v=1,x=new Array(_-1);v<_;v++)x[v-1]=arguments[v];p[y].fn.apply(p[y].context,x)}}return!0},a.prototype.on=function(d,h,u){return r(this,d,h,u,!1)},a.prototype.once=function(d,h,u){return r(this,d,h,u,!0)},a.prototype.removeListener=function(d,h,u,c){var g=s?s+d:d;if(!this._events[g])return this;if(!h)return o(this,g),this;var m=this._events[g];if(m.fn)m.fn===h&&(!c||m.once)&&(!u||m.context===u)&&o(this,g);else{for(var f=0,p=[],_=m.length;f<_;f++)(m[f].fn!==h||c&&!m[f].once||u&&m[f].context!==u)&&p.push(m[f]);p.length?this._events[g]=p.length===1?p[0]:p:o(this,g)}return this},a.prototype.removeAllListeners=function(d){var h;return d?(h=s?s+d:d,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,t.exports=a})(Nh)),Nh.exports}var QB=KB();const JB=ZB(QB),kd="dragging",cc="dragstart",tU="dragend",eU="select",sU="unselect",iU="remove",Rh="add",nU="cancelDrawing",nA="completeDrawing",rU="update",oU="link",aU="history",rA=5,lU=3,Ig={SHAPES:1,EDITOR:2,HANDLES:3},Hs="start",xn="end",Ge={default:"default",move:"move",pointer:"pointer",crosshair:"crosshair",grab:"grab",grabbing:"grabbing",ewResize:"ew-resize",nsResize:"ns-resize",nwResize:"nw-resize",neResize:"ne-resize",swResize:"sw-resize",seResize:"se-resize"},Wo="collapsed",oA="expanded",aA=1.2,dU=.2,$e={TEXT:"text",NODE:"node",COMMENT:"comment",POLYGON:"polygon"},lA=`<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`;let qn=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");const cs=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),ci=t=>Math.sqrt(t.x*t.x+t.y*t.y),dA=t=>({x:-t.x,y:-t.y}),gc=t=>{const e=ci(t);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}},$o=(t,e)=>({x:t.x+e.x,y:t.y+e.y}),Ln=(t,e)=>({x:t.x*e,y:t.y*e}),B_=(t,e)=>{const s=Math.sin(e),i=Math.cos(e);return{x:t.x*i-t.y*s,y:t.x*s+t.y*i}},yr=(t,e)=>t.x*e.x+t.y*e.y,hU=(t,e)=>t.x*e.y-t.y*e.x,ii=t=>t.properties.type==="arrow";function hA(t,e,s){const{start:i,end:n}=Mg(t),r=cs(e,i),o=t.properties.style.strokeWidth,a=cs(n,i),l=ci(a),d=yr(r,gc(a));return d>0&&d<l&&Math.abs(hU(r,gc(a)))<o/2+s}const Zo={strokeType:"plain",strokeColor:"#202020",strokeWidth:1,head:"none",tail:"none"};({...Zo});const mc=(t=0,e=0,s=0,i=0,n={...Zo})=>({id:qn(),type:"Feature",properties:{type:"arrow",style:{...Zo,...n}},geometry:{type:"LineString",coordinates:[[t,e],[s,i]]}}),ks=t=>t.properties.type==="box";function uU(t,e,s=0,i=1,n=0){const r=Er(t),{width:o,height:a}=_s(t),l=e.x-r.x,d=e.y-r.y,h=l*i-d*s,u=l*s+d*i;return h>-n&&h<o+n&&u>-n&&u<a+n}const Ko={background:"#f5f5f5",strokeWidth:0,borderRadius:8,padding:16,strokeType:"plain"};({...Ko});const U_=(t=0,e=0,s=100,i=50,n={...Ko})=>({id:qn(),type:"Feature",properties:{type:"box",width:s,height:i,style:{...Ko,...n}},geometry:{type:"Point",coordinates:[t+s/2,e+i/2]}}),ss=t=>t.properties.type==="text",ms={font:"sans-serif",fontSize:18,color:"#505050",background:"#f5f5f5",strokeWidth:0,borderRadius:8,padding:16,strokeType:"plain",fixedSize:!1};qn(),{...ms};const G_=(t=0,e=0,s=100,i=50,n="",r={...ms})=>({id:qn(),type:"Feature",properties:{type:"text",content:n,width:s,height:i,style:{...ms,...r}},geometry:{type:"Point",coordinates:[t+s/2,e+i/2],bbox:[t,e,t+s,e+i]}});function uA(t,e,s=0,i=0,n=1,r=1){const[o,a]=t.geometry.coordinates;let{width:l,height:d}=_s(t);t.properties.style?.fixedSize&&(l/=r,d/=r);const h=l/2,u=d/2,c=e.x-o,g=e.y-a,m=c*n-g*i,f=c*i+g*n;return m>-h-s&&m<h+s&&f>-u-s&&f<u+s}const os=t=>t.properties.type==="comment",bn={background:"#FFFACD",padding:8,borderRadius:4,strokeColor:"#DDD",strokeWidth:1,strokeType:"plain",iconColor:"#FFCB2F",iconSymbol:"💬",iconBorderColor:"#aaa",iconBorderWidth:2,minHeight:60,iconSize:32,color:"#333",font:"Arial, sans-serif",fontSize:12,showSendButton:!0,autoGrow:!0,fixedSize:!0},Fh={mode:"expanded",width:200,height:60};function cU(t,e,s,i){const n={type:"comment",content:s,mode:i?.mode??Fh.mode,width:i?.width??Fh.width,height:i?.height??Fh.height,author:i?.author,timestamp:i?.timestamp,style:{...bn,...i?.style}};return{id:qn(),type:"Feature",properties:n,geometry:{type:"Point",coordinates:[t,e]}}}function gU(t,e,s=0,i,n,r=1){if(t.properties.mode!==Wo)return uA(t,e,s,i,n,r);const o=t.properties,a={...bn,...o.style};let l=a.iconSize,d=a.iconSize;a.fixedSize&&(l/=r,d/=r);const h=l/2,u=d/2,c=e.x-t.geometry.coordinates[0],g=e.y-t.geometry.coordinates[1];return c>=-h-s&&c<=h+s&&g>=-u-s&&g<=u+s}const Pn=t=>t.properties.type==="polygon";function cA(t,e,s=0){const i=t.geometry.coordinates[0],n=t.geometry.bbox;if(n){const[o,a,l,d]=n;if(e.x<o-s||e.x>l+s||e.y<a-s||e.y>d+s)return!1}let r=!1;for(let o=0,a=i.length-1;o<i.length;a=o++){const l=i[o][0],d=i[o][1],h=i[a][0],u=i[a][1];d>e.y!=u>e.y&&e.x<(h-l)*(e.y-d)/(u-d)+l&&(r=!r)}if(r)return!0;if(s>0)for(let o=0;o<i.length-1;o++){const[a,l]=i[o],[d,h]=i[o+1];if(mU(e,{x:a,y:l},{x:d,y:h})<=s)return!0}return!1}function mU(t,e,s){const i=s.x-e.x,n=s.y-e.y,r=i*i+n*n;if(r===0){const u=t.x-e.x,c=t.y-e.y;return Math.sqrt(u*u+c*c)}let o=((t.x-e.x)*i+(t.y-e.y)*n)/r;o=Math.max(0,Math.min(1,o));const a=e.x+o*i,l=e.y+o*n,d=t.x-a,h=t.y-l;return Math.sqrt(d*d+h*h)}function fU(t,e){const s=t[0];s.length>0&&(s[0][0]!==s[s.length-1][0]||s[0][1]!==s[s.length-1][1])&&s.push([s[0][0],s[0][1]]);let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const[u,c]of s)u<i&&(i=u),u>r&&(r=u),c<n&&(n=c),c>o&&(o=c);const a=[i,n,r,o],{id:l,style:d,...h}=e||{};return{type:"Feature",id:l||qn(),geometry:{type:"Polygon",coordinates:t,bbox:a},properties:{type:"polygon",style:{...vn,...d},...h}}}const vn={...Ko,strokeColor:"#000000",strokeWidth:2,background:"transparent"};({...vn});const V_=t=>t.type==="FeatureCollection";function pU(t,e){const s=t[0]-e[0],i=t[1]-e[1];return s*s+i*i}function _U(t,e,s){let i=e[0],n=e[1],r=s[0]-i,o=s[1]-n;if(r!==0||o!==0){const a=((t[0]-i)*r+(t[1]-n)*o)/(r*r+o*o);a>1?(i=s[0],n=s[1]):a>0&&(i+=r*a,n+=o*a)}return r=t[0]-i,o=t[1]-n,r*r+o*o}function yU(t,e){let s=t[0];const i=[s];let n;for(let r=1,o=t.length;r<o;r++)n=t[r],pU(n,s)>e&&(i.push(n),s=n);return s!==n&&i.push(n),i}function fc(t,e,s,i,n){let r=i,o=0;for(let a=e+1;a<s;a++){const l=_U(t[a],t[e],t[s]);l>r&&(o=a,r=l)}r>i&&(o-e>1&&fc(t,e,o,i,n),n.push(t[o]),s-o>1&&fc(t,o,s,i,n))}function xU(t,e){const s=t.length-1,i=[t[0]];return fc(t,0,s,e,i),i.push(t[s]),i}function q_(t,e,s){if(t.length<=2)return t;const i=e!==void 0?e*e:1;return t=s?t:yU(t,i),t=xU(t,i),t}function H_(t){if(t.geometry.bbox)return t.geometry.bbox;const e=t.geometry.coordinates[0];let s=1/0,i=1/0,n=-1/0,r=-1/0;for(const[o,a]of e)o<s&&(s=o),o>n&&(n=o),a<i&&(i=a),a>r&&(r=a);return[s,i,n,r]}function bU(t){const e=t.geometry.coordinates[0];let s=0,i=0;const n=e.length-1;for(let r=0;r<n;r++)s+=e[r][0],i+=e[r][1];return{x:s/n,y:i/n}}function vU(t,e,s){const i=t.geometry.coordinates.map(o=>o.map(([a,l])=>[a+e,l+s])),n=t.geometry.bbox,r=n?[n[0]+e,n[1]+s,n[2]+e,n[3]+s]:void 0;return{...t,geometry:{...t.geometry,coordinates:i,bbox:r}}}function EU(t){const e=t.geometry.coordinates[0];let s=1/0,i=1/0,n=-1/0,r=-1/0;for(const[o,a]of e)o<s&&(s=o),o>n&&(n=o),a<i&&(i=a),a>r&&(r=a);t.geometry.bbox=[s,i,n,r]}const AU="http://www.w3.org/2000/svg";function Ee(t){return document.createElementNS(AU,t)}function Si(t){return t.geometry.bbox||Od(t),t.geometry.bbox}function _s(t){if("width"in t.properties&&"height"in t.properties)return{width:t.properties.width,height:t.properties.height};const e=Si(t);return{width:e[2]-e[0],height:e[3]-e[1]}}function Er(t,e=!1,s=1){if(t.geometry.type==="Point"&&"width"in t.properties&&"height"in t.properties){const[n,r]=t.geometry.coordinates;let o=t.properties.width,a=t.properties.height;return e&&(o/=s,a/=s),{x:n-o/2,y:r-a/2}}const i=Si(t);return{x:i[0],y:i[1]}}function Ps(t){if(t.geometry.type==="Point")return{x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]};const e=Si(t);return{x:(e[0]+e[2])/2,y:(e[1]+e[3])/2}}function Od(t){if(ii(t)){const[e,s]=t.geometry.coordinates[0],[i,n]=t.geometry.coordinates[1];t.geometry.bbox=[Math.min(e,i),Math.min(s,n),Math.max(e,i),Math.max(s,n)]}else if(t.geometry.type==="Point"&&"width"in t.properties&&"height"in t.properties){const[e,s]=t.geometry.coordinates,i=t.properties.width/2,n=t.properties.height/2;t.geometry.bbox=[e-i,s-n,e+i,s+n]}else if(t.geometry.type==="Polygon"){const e=t.geometry.coordinates[0];let s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const o of e){const a=o[0],l=o[1];a<s&&(s=a),l<i&&(i=l),a>n&&(n=a),l>r&&(r=l)}t.geometry.bbox=[s,i,n,r]}}function gA(t){const[e,s]=t.geometry.coordinates[0];return{x:e,y:s}}function Ph(t,e){const[s,i]=t.geometry.coordinates[e===Hs?0:1];return{x:s,y:i}}function mA(t){const[e,s]=t.geometry.coordinates[1];return{x:e,y:s}}function Mg(t){return{start:gA(t),end:mA(t)}}function SU(t){return Ml(t).reduce((e,s)=>(e[0]=Math.min(s[0],e[0]),e[1]=Math.min(s[1],e[1]),e[2]=Math.max(s[0],e[2]),e[3]=Math.max(s[1],e[3]),e),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY])}function Ml(t){let e=[];if(t.type=="Point")t.bbox?e=[[t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]]:e=[t.coordinates];else if(t.type=="LineString"||t.type=="MultiPoint")e=t.coordinates;else if(t.type=="Polygon"||t.type=="MultiLineString")e=t.coordinates.reduce(function(s,i){return s.concat(i)},[]);else if(t.type=="MultiPolygon")e=t.coordinates.reduce((s,i)=>s.concat(i.reduce((n,r)=>n.concat(r),[])),[]);else if(t.type=="Feature")if(ss(t)||ks(t)){const s=Si(t);e=[[s[0],s[1]],[s[2],s[3]]]}else e=Ml(t.geometry);else t.type=="GeometryCollection"?e=t.geometries.reduce((s,i)=>s.concat(Ml(i)),[]):t.type=="FeatureCollection"&&(e=t.features.reduce((s,i)=>s.concat(Ml(i)),[]));return e}function pc(t,e){if(!e)return{x:t.clientX,y:t.clientY};const s=e.getBoundingClientRect();return{x:t.clientX-s.left-e.clientLeft,y:t.clientY-s.top-e.clientTop}}function wU(t){return t.length===4?t.split("").map(e=>e+e).join(""):t}function j_(){return typeof window<"u"?window:void 0}function TU(t){if((ks(t)||ss(t))&&t.geometry.type==="Polygon"){const e=t.geometry.coordinates[0],s=e[0][0],i=e[0][1],n=e[2][0],r=e[2][1],o=n-s,a=r-i,l=s+o/2,d=i+a/2;return{...t,geometry:{type:"Point",coordinates:[l,d],bbox:[s,i,n,r]},properties:{...t.properties,width:o,height:a}}}return t}function CU(t,e){let s,i,n,r=1;const o=t.trim();if(o.startsWith("#")){const u=(o.length===4?wU(o):o).match(/#?(\w{2})(\w{2})(\w{2})/);if(!u)return t;s=parseInt(u[1],16),i=parseInt(u[2],16),n=parseInt(u[3],16)}else{const h=o.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([0-9.]+))?\)/);if(!h)return t;s=parseInt(h[1]),i=parseInt(h[2]),n=parseInt(h[3]),r=h[4]!==void 0?parseFloat(h[4]):1}const a=e*100,d=.299*s+.587*i+.114*n>186?-a/2:a;return s=Math.max(0,Math.min(255,s+Math.round(2.55*d))),i=Math.max(0,Math.min(255,i+Math.round(2.55*d))),n=Math.max(0,Math.min(255,n+Math.round(2.55*d))),`rgba(${s},${i},${n},${r})`}const Bd=t=>CU(t,dU);class Ud extends EventTarget{annotation=null;ogma;dragging=!1;dragStartPoint;hoveredHandle;ogmaPanningOption=!1;store;draggingWasEnabled=!0;constructor(e,s){super(),this.store=s,this.ogma=e,this.store.subscribe(i=>i.features,i=>{this.isActive()&&!i[this.annotation]&&this.stopEditing()})}handleMouseMove=e=>{if(!this.isActive())return;const s=this.store.getState();if(!this.dragging&&s.mousePressed&&s.mousePressPoint&&(this.detectHandle(e,this.ogma.view.getZoom()),this.hoveredHandle)){this.dragStartPoint=s.mousePressPoint,this.onDragStart(e),this.dispatchEvent(new Event(cc)),this.disablePanning();return}this.dragging?this.dragStartPoint&&this.onDrag(e):this.detectHandle(e,this.ogma.view.getZoom())};handleMouseDown=e=>{!this.isActive()||this.dragging||!this.hoveredHandle||(e.preventDefault(),e.stopPropagation(),this.dragStartPoint=this.clientToCanvas(e),this.onDragStart(e),this.dispatchEvent(new Event(cc)),this.disablePanning())};disablePanning=()=>{this.ogmaPanningOption=!!this.ogma.getOptions().interactions?.pan?.enabled,this.ogma.setOptions({interactions:{pan:{enabled:!1},drag:{enabled:!1}}})};restorePanning=()=>{this.ogma.setOptions({interactions:{pan:{enabled:!0},drag:{enabled:!0}}})};handleMouseUp=e=>{!this.isActive()||!this.dragging||(this.restorePanning(),this.onDragEnd(e),this.dispatchEvent(new Event(tU)))};cancelEdit(){!this.isActive()||this.annotation===null||this.clearDragState()}clearDragState(){this.dragging=!1,this.dragStartPoint=void 0,this.hoveredHandle=void 0,this.restorePanning(),this.setCursor(Ge.default)}commitChange(){this.store.getState().commitLiveUpdates()}onDrag(e){this.dispatchEvent(new Event(kd))}onDragStart(e){return this.isActive()?(this.dragging=!0,this.dragStartPoint=this.clientToCanvas(e),this.disablePanning(),!0):!1}onDragEnd(e){return this.isActive()?(this.restorePanning(),this.dragging=!1,!0):!1}clientToCanvas(e){const s=this.ogma,i=pc(e,s.getContainer());return s.view.screenToGraphCoordinates(i)}setAnnotation(e){if(this.annotation=e?e.id:null,this.annotation!==null){const s=this.ogma.getContainer();if(s){const r=j_()||s;r.addEventListener("mousemove",this.handleMouseMove),r.addEventListener("mouseup",this.handleMouseUp,!1),s.addEventListener("mousedown",this.handleMouseDown,!0)}const{x:i,y:n}=this.ogma.getPointerInformation();this.handleMouseMove({clientX:i,clientY:n})}else{const s=this.ogma.getContainer();if(s){const i=j_()||s;i.removeEventListener("mousemove",this.handleMouseMove),i.removeEventListener("mouseup",this.handleMouseUp),s.removeEventListener("mousedown",this.handleMouseDown)}this.clearDragState(),this.setCursor(Ge.default)}}getAnnotation(){return this.store.getState().getFeature(this.annotation)}setCursor(e){const s=this.ogma.getContainer()?.firstChild;s&&(s.style.cursor=e)}stopEditing(){this.isActive()&&this.setAnnotation(null)}cancelDrawing(){if(!this.isActive())return;const e=this.store.getState();e.drawingFeature===this.annotation&&e.removeFeature(this.annotation),this.stopEditing()}isActive(){return this.annotation!==null}}function LU(t){const e=t.properties.link;return e?e.start?.type===$e.COMMENT||e.end?.type===$e.COMMENT:!1}function IU(t){return t.properties.link?.start?.type!==$e.COMMENT}class MU extends Ud{snapping;links;snap=null;constructor(e,s,i,n){super(e,s),this.snapping=i,this.links=n}detectHandle(e){const s=this.getAnnotation(),i=this.clientToCanvas(e),n=rA,r=s.geometry.coordinates[0],o=s.geometry.coordinates[1],a=Math.sqrt(Math.pow(i.x-r[0],2)+Math.pow(i.y-r[1],2)),l=Math.sqrt(Math.pow(i.x-o[0],2)+Math.pow(i.y-o[1],2));a<n?this.grabHandle("start",r[0],r[1]):l<n?this.grabHandle("end",o[0],o[1]):hA(s,i,n)?(this.setCursor(Ge.grab),this.hoveredHandle={type:"body",point:i},this.store.setState({hoveredHandle:2})):(this.store.setState({hoveredHandle:-1}),this.hoveredHandle=void 0)}grabHandle(e,s,i){this.hoveredHandle={type:e,point:{x:s,y:i}},this.store.setState({hoveredHandle:e==="start"?0:1}),this.setCursor(Ge.move)}onDrag(e){if(!(this.dragStartPoint||!this.hoveredHandle)||!this.isActive())return;e.stopPropagation(),e.stopImmediatePropagation();const s=this.clientToCanvas(e),i=this.hoveredHandle,n=this.getAnnotation();this.snap=this.snapping.snap(s);const r=this.snap?.point||s,o=n.properties.link||{},a=[...n.geometry.coordinates];if(i.type==="start")a[0]=[r.x,r.y],this.snap&&(o.start={side:i.type,id:this.snap.id,type:this.snap.type,magnet:this.snap.magnet});else if(i.type==="end")a[1]=[r.x,r.y],this.snap&&(o.end={side:i.type,id:this.snap.id,type:this.snap.type,magnet:this.snap.magnet});else if(i.type==="body"){const l=r.x-i.point.x,d=r.y-i.point.y,h=n.geometry.coordinates[0],u=n.geometry.coordinates[1];a[0]=[h[0]+l,h[1]+d],a[1]=[u[0]+l,u[1]+d]}this.store.getState().applyLiveUpdate(n.id,{id:n.id,properties:{...n.properties,link:o},geometry:{type:n.geometry.type,coordinates:a}}),this.dispatchEvent(new CustomEvent(kd,{detail:{point:r,annotation:this.annotation,handle:i}}))}onDragStart(e){if(!super.onDragStart(e))return!1;const s=this.getAnnotation(),i=this.hoveredHandle;return i.type==="end"&&!1||i.type==="start"&&!IU(s)?(this.clearDragState(),!1):(this.store.getState().startLiveUpdate([this.annotation]),!0)}onDragEnd(e){if(!super.onDragEnd(e))return!1;if(this.snap&&this.hoveredHandle){const i=this.hoveredHandle;i.type!=="body"&&this.links.add(this.getAnnotation(),i.type,this.snap.id,this.snap.type,this.snap.magnet)}else if(this.snap===null&&this.hoveredHandle){const i=this.getAnnotation(),n=this.hoveredHandle.type;i.properties.link&&i.properties.link[n]&&(this.links.remove(i,n),this.store.getState().applyLiveUpdate(i.id,{properties:{...i.properties,link:{[n]:void 0}}}))}return this.store.getState().drawingFeature===this.annotation&&this.store.setState({drawingFeature:null}),this.commitChange(),this.clearDragState(),this.snap=null,!0}snapDrawingStart(e,s,i){const n=this.snapping.snap({x:s,y:i});n&&(e.geometry.coordinates[0]=[n.point.x,n.point.y],e.properties.link={start:{side:Hs,id:n.id,type:n.type,magnet:n.magnet}},this.links.add(e,"start",n.id,n.type,n.magnet))}startDrawing(e,s,i){this.annotation=e;const n=this.getAnnotation();this.snapDrawingStart(n,s,i);const{x:r,y:o}=this.clientToCanvas({clientX:s,clientY:i});this.grabHandle("end",r,o),this.dragging=!0,this.dragStartPoint={x:r,y:o},this.onDragStart({clientX:s,clientY:i})}}class NU extends Ud{links;isDrawingMode=!1;simplificationTolerance=5;constructor(e,s,i){super(e,s),this.links=i}startDrawing(e,s,i){this.annotation=e,this.isDrawingMode=!0;const n=this.store.getState();n.startLiveUpdate([e]),n.setDrawingPoints([]);const r=this.ogma.view.graphToScreenCoordinates({x:s,y:i});return this.dragStartPoint=r,this.disablePanning(),this.onDragStart({clientX:r.x,clientY:r.y}),this}cancelDrawing(){this.isDrawingMode&&(this.isDrawingMode=!1,this.annotation&&(this.store.getState().removeFeature(this.annotation),this.annotation=null)),this.restorePanning()}detectHandle(e,s=1){const i=this.getAnnotation();if(!i)return;const n=this.clientToCanvas(e),r=rA/s,o=i.geometry.coordinates[0];for(let a=0;a<o.length-1;a++){const[l,d]=o[a];if(Math.sqrt(Math.pow(n.x-l,2)+Math.pow(n.y-d,2))<r*2){this.grabHandle("vertex",l,d,a);return}}cA(i,n,r)?(this.setCursor(Ge.grab),this.hoveredHandle={type:"body",point:n},this.store.setState({hoveredHandle:-1})):(this.store.setState({hoveredHandle:-1}),this.hoveredHandle=void 0)}grabHandle(e,s,i,n){this.setCursor(e==="vertex"?Ge.pointer:Ge.grab),this.hoveredHandle={type:e,point:{x:s,y:i},vertexIndex:n},this.store.setState({hoveredHandle:n??0})}handleMouseDown=e=>{!this.isActive()||this.dragging||!this.hoveredHandle||(e.preventDefault(),e.stopPropagation(),this.dragStartPoint=this.clientToCanvas(e),this.onDragStart(e),this.dispatchEvent(new Event(cc)),this.disablePanning())};onDragStart(e){if(this.isDrawingMode){const s=this.clientToCanvas(e);this.dragging=!0;const i=this.getAnnotation();if(i){const n=[[s.x,s.y],[s.x,s.y]],r=this.store.getState();r.setDrawingPoints(n),r.applyLiveUpdate(i.id,{...i,geometry:{type:"Polygon",coordinates:[n],bbox:[s.x,s.y,s.x,s.y]}})}return this.dragStartPoint=s,!0}return this.hoveredHandle?(this.dragging=!0,this.setCursor(Ge.grabbing),this.store.getState().startLiveUpdate([this.annotation]),!0):!1}onDrag(e){if(this.isDrawingMode&&this.dragging){const o=this.clientToCanvas(e),a=this.store.getState(),l=this.getAnnotation();if(!l)return;const d=a.liveUpdates[this.annotation],h=d?{...l,...d}:l,c=a.drawingPoints.slice(0,-1),g=[...c,[o.x,o.y],c[0]];a.setDrawingPoints(g);const m=q_(g,this.simplificationTolerance,!1),f=[...m,m[0]];a.applyLiveUpdate(this.annotation,{...h,geometry:{type:"Polygon",coordinates:[f]}});return}if(!this.dragging||!this.dragStartPoint||!this.hoveredHandle)return;const s=this.clientToCanvas(e),i=s.x-this.dragStartPoint.x,n=s.y-this.dragStartPoint.y,r=this.getAnnotation();if(r){if(this.hoveredHandle.type==="body"){const o=vU(r,i,n);this.store.getState().applyLiveUpdate(r.id,o),this.links.updateLinkedArrowsDuringDrag(r.id,{x:i,y:n})}else if(this.hoveredHandle.type==="vertex"&&this.hoveredHandle.vertexIndex!==void 0){const o=r.geometry.coordinates[0].map((l,d)=>d===this.hoveredHandle.vertexIndex?[this.hoveredHandle.point.x+i,this.hoveredHandle.point.y+n]:d===r.geometry.coordinates[0].length-1&&this.hoveredHandle.vertexIndex===0?[this.hoveredHandle.point.x+i,this.hoveredHandle.point.y+n]:l),a={...r,geometry:{...r.geometry,coordinates:[o]}};EU(a),this.store.getState().applyLiveUpdate(r.id,a)}this.dispatchEvent(new Event(kd))}}onDragEnd(){if(this.isDrawingMode&&this.dragging){const s=this.store.getState(),i=this.getAnnotation();if(i){const n=s.drawingPoints;if(n.length<3)this.cancelDrawing();else{const r=q_(n.slice(1,-1),this.simplificationTolerance,!0),o={...i,geometry:{type:"Polygon",coordinates:[r]}};Od(o),this.store.getState().applyLiveUpdate(i.id,o),this.store.setState({drawingFeature:null}),this.commitChange(),this.isDrawingMode=!1,this.dragging=!1,this.restorePanning(),this.dispatchEvent(new CustomEvent(nA,{detail:o}))}}return!0}return!this.dragging||(this.dragging=!1,this.dragStartPoint=void 0,!this.getAnnotation())?!1:(this.commitChange(),this.setCursor(Ge.grab),!0)}getAnnotation(){if(this.annotation)return this.store.getState().getFeature(this.annotation)}}const Y_=[{x:-.5,y:-.5},{x:0,y:-.5},{x:.5,y:-.5},{x:-.5,y:0},{x:.5,y:0},{x:-.5,y:.5},{x:0,y:.5},{x:.5,y:.5}],RU=[[-.5,-.5,.5,-.5],[.5,-.5,.5,.5],[.5,.5,-.5,.5],[-.5,.5,-.5,-.5]];function X_(t,e,s,i,n,r,o,a,l){const d=t*n,h=e*r;return l?{x:s+(d*o-h*a),y:i+(d*a+h*o)}:{x:s+d,y:i+h}}class FU extends EventTarget{ogma;options;spatialIndex;hoveredNode=null;store;constructor(e,s,i,n){super(),this.ogma=e,this.options=s,this.spatialIndex=i,this.store=n}snap(e){const s=this.findMagnet(e);return s||null}findMagnet(e){const s=this.options.detectMargin,i={minX:e.x-s,minY:e.y-s,maxX:e.x+s,maxY:e.y+s},n=this.spatialIndex.search(i),r=n.filter(u=>ss(u)||ks(u)),o=n.filter(u=>Pn(u)),a=this.ogma.view.getElementsInside(i.minX,i.minY,i.maxX,i.maxY).nodes,l=this.snapToNodes(e,a);if(l)return l;const d=this.snapToText(e,r);if(d)return d;const h=this.snapToPolygon(e,o);return h||null}snapToText(e,s){const{zoom:i}=this.store.getState();for(const n of s){const r=this.snapToMagnetPoints(e,n,i)||this.snapToEdge(e,n,i);if(r)return r}return null}snapToPolygon(e,s){const i=this.options.magnetRadius,n=.5;for(const r of s){const a=r.geometry.coordinates[0].slice(0,-1);if(a.length<3)return this.snapToPolygonStraightEdges(e,r,i);for(let u=0;u<a.length;u++){const[c,g]=a[u];if(ci(cs({x:c,y:g},e))<i)return{point:{x:c,y:g},magnet:{x:c,y:g},type:$e.POLYGON,id:r.id}}const l=this.isPointInsidePolygon(e,a);let d=null,h=l?1/0:i;for(let u=0;u<a.length;u++){const c=a[(u-1+a.length)%a.length],g=a[u],m=a[(u+1)%a.length],f=a[(u+2)%a.length],p=g[0]+(m[0]-c[0])/6*n,_=g[1]+(m[1]-c[1])/6*n,x=m[0]-(f[0]-g[0])/6*n,y=m[1]-(f[1]-g[1])/6*n,b=this.findClosestPointOnBezierCurve(e,{x:g[0],y:g[1]},{x:p,y:_},{x,y},{x:m[0],y:m[1]});if(b){const v=b.distance;if(l)v<h&&(h=v,d=b.point);else if(v<i)return{point:b.point,magnet:b.point,type:$e.POLYGON,id:r.id}}}if(l&&d)return{point:d,magnet:d,type:$e.POLYGON,id:r.id}}return null}isPointInsidePolygon(e,s){let i=!1;for(let n=0,r=s.length-1;n<s.length;r=n++){const o=s[n][0],a=s[n][1],l=s[r][0],d=s[r][1];a>e.y!=d>e.y&&e.x<(l-o)*(e.y-a)/(d-a)+o&&(i=!i)}return i}snapToPolygonStraightEdges(e,s,i){const n=s.geometry.coordinates[0];for(let r=0;r<n.length-1;r++){const[o,a]=n[r];if(ci(cs({x:o,y:a},e))<i)return{point:{x:o,y:a},magnet:{x:o,y:a},type:$e.POLYGON,id:s.id}}for(let r=0;r<n.length-1;r++){const[o,a]=n[r],[l,d]=n[r+1],h={x:o,y:a},c=cs({x:l,y:d},h),g=ci(c),m={x:c.x/g,y:c.y/g},f={x:-m.y,y:m.x},p=cs(e,h),_=Math.abs(yr(f,p)),x=yr(m,p);if(x>=0&&x<=g&&_<i){const y={x:h.x+m.x*x,y:h.y+m.y*x};return{point:y,magnet:y,type:$e.POLYGON,id:s.id}}}return null}findClosestPointOnBezierCurve(e,s,i,n,r){let o=1/0,a=null;const l=20;for(let d=0;d<=l;d++){const h=d/l,u=this.bezierPoint(h,s,i,n,r),c=ci(cs(u,e));c<o&&(o=c,a=u)}return a?{point:a,distance:o}:null}bezierPoint(e,s,i,n,r){const o=e*e,a=o*e,l=1-e,d=l*l,h=d*l;return{x:h*s.x+3*d*e*i.x+3*l*o*n.x+a*r.x,y:h*s.y+3*d*e*i.y+3*l*o*n.y+a*r.y}}snapToMagnetPoints(e,s,i){const n=Ps(s);let{width:r,height:o}=_s(s);const{sin:a,cos:l}=this.store.getState();s.properties.style?.fixedSize&&(r/=i,o/=i);for(const d of Y_){let h=d.x*r,u=d.y*o;if(!ks(s)){const m=h*l-u*a,f=h*a+u*l;h=m,u=f}const c={x:n.x+h,y:n.y+u};if(!(ci(cs(c,e))>=this.options.magnetRadius))return{point:{x:c.x,y:c.y},type:$e.TEXT,magnet:d,id:s.id}}return null}snapToEdge(e,s,i){const{x:n,y:r}=Ps(s);let{width:o,height:a}=_s(s);const l=this.options.magnetRadius;s.properties.style?.fixedSize&&(o/=i,a/=i);const{sin:d,cos:h}=this.store.getState(),u=!ks(s);let c=null,g=1/0;for(let m=0;m<4;m++){const[f,p,_,x]=RU[m],y=X_(f,p,n,r,o,a,h,d,u),b=X_(_,x,n,r,o,a,h,d,u),v=cs(b,y),A=ci(v),S={x:v.x/A,y:v.y/A},w={x:-S.y,y:S.x},I=cs(e,y),M=yr(w,I),N=yr(S,I);if(N>=0&&N<=A){const D=Math.abs(M);if(D<l||D<g){const q=N/A,et={point:{x:y.x+S.x*N,y:y.y+S.y*N},magnet:{x:f+(_-f)*q,y:p+(x-p)*q},type:$e.TEXT,id:s.id};if(D<l)return et;D<g&&(g=D,c=et)}}}return c&&g<Math.max(o,a)?c:null}snapToNodes(e,s){const i=s.getAttributes(["x","y","radius"]);for(let n=0;n<i.length;n++){const r=i[n],o=cs({x:r.x,y:r.y},e),a=ci(o);if(a>=Number(r.radius)+Number(this.options.detectMargin))continue;const l=Ln(o,1/a),d=a<Number(r.radius)/2,h=d?{x:r.x,y:r.y}:$o({x:r.x,y:r.y},Ln(l,-Number(r.radius))),u=d?{x:0,y:0}:l;return{point:h,id:s.get(n).getId(),magnet:u,type:$e.NODE}}return null}getHoveredNode(){return this.hoveredNode}clearHoveredNode(){this.hoveredNode?.setSelected(!1),this.hoveredNode=null}getMagnets(){return Y_}}class PU{constructor(e,s,i,n=()=>{}){this.ogma=e,this.store=s,this.annotation=i,this.onSendHandler=n;const r=this.getPosition(),o=this.getSize(),a=this.getAnnotation(),l=this.store.getState(),d=l.options?.showSendButton??!0,h=l.options?.sendButtonIcon||"",u=l.options?.textPlaceholder||"Enter text";this.layer=this.ogma.layers.addOverlay({element:`<div class="ogma-annotation-text-editor">
          <textarea wrap="on" name="annotation-text--input" spellcheck="false" placeholder="${u}"></textarea>
          ${d?`<button class="ogma-send-button" type="button" title="Send">
            <span class="ogma-send-button-icon">${h}</span>
          </button>`:""}
        </div>`,position:r,size:o},Ig.EDITOR),this.textarea=this.layer.element.querySelector("textarea"),this.textarea.setAttribute("wrap","on"),this.textarea.setAttribute("spellcheck","false"),this.textarea.value=a.properties.content||"",d&&(this.sendButton=this.layer.element.querySelector(".ogma-send-button"),this.sendButton.addEventListener("click",this.onSendClick),this.updateSendButtonState()),this.isFocused=!1,this.textarea.addEventListener("focus",this.onFocus),this.textarea.addEventListener("blur",this.onBlur),this.textarea.addEventListener("input",this.onInput),this.textarea.addEventListener("keyup",this.onKeyup),this.textarea.addEventListener("keydown",this.onKeydown),this.updateStyle(),this.updatePosition(),this.textarea.focus(),this.unsubscribe=this.store.subscribe(c=>({rotation:c.rotation,zoom:c.zoom}),this.update,{equalityFn:(c,g)=>c.rotation===g.rotation&&c.zoom===g.zoom})}layer;textarea;sendButton=null;isFocused;unsubscribe;getAnnotation(){const e=this.store.getState();return e.liveUpdates[this.annotation]?e.liveUpdates[this.annotation]:(e.startLiveUpdate([this.annotation]),this.store.getState().getFeature(this.annotation))}getPosition(){const e=this.getAnnotation(),s=Er(e,e.properties.style?.fixedSize,this.store.getState().zoom),i=zh(e);return{x:s.x+i,y:s.y+i}}getSize(){const e=this.getAnnotation(),s=_s(e),i=zh(e),n=e.properties.style?.fixedSize||!1,r=this.store.getState().zoom,o=n?1/r:1;return{width:(s.width-i*2)*o,height:(s.height-i*2)*o}}updateStyle(){const e=this.getAnnotation();if(!e)return;const{font:s,fontSize:i=ms.fontSize,borderRadius:n,color:r,background:o,padding:a=0,fixedSize:l=ms.fixedSize}=e.properties.style||ms,d=this.textarea,h=this.store.getState().zoom,u=l?1/h:1,c=parseFloat(i.toString())*u,g=a*u,m=d.style;if(m.font=`${c} ${s}`,m.fontFamily=s||"sans-serif",m.fontSize=`${c}px`,m.padding=`${g}px`,m.lineHeight=`${c*aA}px`,m.boxSizing="border-box",m.color=r||"black",m.background=o||"transparent",m.borderRadius=`${n}px`,l&&(m.overflow="hidden",m.resize="none"),m.transformOrigin="center",m.transform=`rotate(${this.store.getState().rotation}rad)`,this.sendButton){const f=l?1/h:1;this.sendButton.style.transform=`scale(${f})`,this.sendButton.style.transformOrigin="bottom right"}}updatePosition(){this.layer.setPosition(this.getPosition())}onFocus=()=>{this.isFocused=!0};onBlur=()=>{this.getAnnotation()&&this.updateContent(),this.isFocused=!1};onKeyup=e=>{e.key==="Escape"&&this.textarea.blur(),e.stopPropagation()};onKeydown=e=>{e.stopPropagation()};updateContent(){const e=this.getAnnotation();let s=e.properties.height,i=e.geometry.coordinates;const n=e.properties.style?.fixedSize;if(n){const o=this.textarea.scrollHeight,a=zh(e),l=this.store.getState().zoom,d=(o+a*2/l)*l,h=e.properties.style?.minHeight||50;s=Math.max(h,d);const u=s-e.properties.height;if(Math.abs(u)>1){const[c,g]=e.geometry.coordinates;i=[c,g+u]}}const r={...e,properties:{...e.properties,content:this.textarea.value,height:s},geometry:{...e.geometry,coordinates:i}};n&&Math.abs(e.properties.height-s)>1&&(this.layer.setSize(this.getSize()),this.layer.setPosition(this.getPosition())),this.store.getState().applyLiveUpdate(this.annotation,r)}onInput=()=>{this.updateContent(),this.updateStyle(),this.updatePosition(),this.layer.setSize(this.getSize()),this.updateSendButtonState()};onSendClick=e=>{e.preventDefault(),e.stopPropagation(),!(!this.sendButton||this.sendButton.disabled)&&(this.updateContent(),this.textarea.blur(),this.onSendHandler())};updateSendButtonState(){if(!this.sendButton)return;const e=this.textarea.value.trim().length===0;this.sendButton.disabled=e}update=()=>{this.updateStyle(),this.updatePosition(),this.layer.setSize(this.getSize())};destroy(){this.store.getState().commitLiveUpdates(new Set([this.annotation])),this.unsubscribe(),this.sendButton&&this.sendButton.removeEventListener("click",this.onSendClick),this.layer.destroy()}}function zh(t){return t.properties.style?.strokeWidth||0}const W_={x:1,y:0},$_={x:0,y:1},zU=[["top",$_,-.5,-.5,.5,-.5],["right",W_,.5,-.5,.5,.5],["bottom",$_,-.5,.5,.5,.5],["left",W_,-.5,-.5,-.5,.5]],DU={top:[0,1],right:[1,2],bottom:[2,3],left:[3,0]},Z_=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]],kU=[Ge.nwResize,Ge.neResize,Ge.seResize,Ge.swResize];class Dh extends Ud{links;textEditor=null;constructor(e,s,i){super(e,s),this.links=i}detectHandle(e,s){const i=this.getAnnotation(),{x:n,y:r}=this.clientToCanvas(e);let{width:o,height:a}=_s(i);const l=5/s,d=Ps(i),h=this.store.getState();let{revSin:u,revCos:c}=h;(ks(i)||os(i))&&(u=0,c=1),this.hoveredHandle=void 0;const g=lU*(1/s),m=n-d.x,f=r-d.y,p=m*c-f*u,_=m*u+f*c,x=i.properties.style?.fixedSize===!0||os(i);if(x&&(o/=s,a/=s),!x){for(let y=0;y<Z_.length;y++){const[b,v]=Z_[y],A=o*b,S=a*v;if(p>=A-g-l&&p<=A+g+l&&_>=S-g-l&&_<=S+g+l){this.hoveredHandle={type:"corner",corner:y},this.store.setState({hoveredHandle:y}),this.setCursor(this.getCornerCursor(y));return}}for(const[y,b,v,A,S,w]of zU){const I=o*v,M=a*A,N=o*S,D=a*w,q=yr(b,{x:p-I,y:_-M});if(Math.abs(q)<l&&p>=I-l&&p<=N+l&&_>=M-l&&_<=D+l){this.hoveredHandle={type:"edge",edge:y,corner:-1},this.store.setState({hoveredHandle:DU[y][0]+4}),this.setCursor(this.getEdgeCursor(y));return}}}if(p>=-o/2-l&&p<=o/2+l&&_>=-a/2-l&&_<=a/2+l){this.store.setState({hoveredHandle:8}),this.hoveredHandle={type:"body",corner:-1},this.setCursor(Ge.grab);return}this.store.setState({hoveredHandle:-1}),this.setCursor(Ge.default)}onDrag(e){if(!this.dragStartPoint||!this.hoveredHandle||!this.isActive())return;e.stopPropagation(),e.stopImmediatePropagation();const s=this.getAnnotation(),i=this.clientToCanvas(e),n={x:i.x-this.dragStartPoint.x,y:i.y-this.dragStartPoint.y},r=this.hoveredHandle,o=this.getAnnotation();let a=null;if(r.type==="corner"?a=this.dragCorner(o,n,r.corner):r.type==="edge"&&r.edge?a=this.dragEdge(o,n,r):r.type==="body"&&(a=this.dragBody(o,n)),a){const l=a;this.store.getState().applyLiveUpdate(s.id,l);const d=cs(Ps(l),Ps(o));this.links.updateLinkedArrowsDuringDrag(s.id,d),this.textEditor&&this.textEditor.update()}this.dispatchEvent(new CustomEvent(kd,{detail:{point:i,annotation:this.annotation,handle:r}}))}dragBody(e,s){const i=Ps(e);return{...e,geometry:{type:e.geometry.type,coordinates:[i.x+s.x,i.y+s.y]}}}dragCorner(e,s,i){const n=i===0||i===1,r=i===0||i===3,o=i===1||i===2,a=i===2||i===3,{width:l,height:d}=_s(e),h=this.store.getState();let{revSin:u,revCos:c}=h;(ks(e)||os(e))&&(u=0,c=1);const g=s.x*c-s.y*u,m=s.x*u+s.y*c;let f=0,p=0;r?f=-g:o&&(f=g),n?p=-m:a&&(p=m);const _=Math.max(0,l+f),x=Math.max(0,d+p),y=Ps(e),b=y.x+s.x/2,v=y.y+s.y/2;return{...e,properties:{...e.properties,width:_,height:x},geometry:{type:e.geometry.type,coordinates:[b,v]}}}dragEdge(e,s,i){const{width:n,height:r}=_s(e),o=Ps(e),a=this.store.getState();let{revSin:l,revCos:d}=a;(ks(e)||os(e))&&(l=0,d=1);const h=s.x*d-s.y*l,u=s.x*l+s.y*d;let c=n,g=r,m=0,f=0;switch(i.edge){case"top":g=Math.max(0,r-u),f=u/2;break;case"bottom":g=Math.max(0,r+u),f=u/2;break;case"left":c=Math.max(0,n-h),m=h/2;break;case"right":c=Math.max(0,n+h),m=h/2;break}const p=m*d+f*l,_=-m*l+f*d;return{...e,properties:{...e.properties,width:c,height:g},geometry:{type:e.geometry.type,coordinates:[o.x+p,o.y+_]}}}onDragStart(e){return super.onDragStart(e)?(this.stopEditingText(),this.store.getState().startLiveUpdate([this.annotation]),!0):!1}onClick(e){this.startEditingText()}startEditingText(){this.textEditor===null&&(this.textEditor=new PU(this.ogma,this.store,this.annotation,this.stopEditingText))}onDragEnd(e){if(!super.onDragEnd(e))return!1;this.store.getState().drawingFeature===this.annotation&&this.store.setState({drawingFeature:null});const i=this.clientToCanvas(e),n=i.x-(this.dragStartPoint?.x||0),r=i.y-(this.dragStartPoint?.y||0);return Math.abs(n)<1&&Math.abs(r)<1?(this.clearDragState(),this.onClick({clientX:e.clientX,clientY:e.clientY})):this.commitChange(),this.hoveredHandle=void 0,this.dragStartPoint=void 0,this.dragging=!1,!0}getCornerCursor(e){return kU[e]}getEdgeCursor(e){switch(e){case"top":case"bottom":return Ge.nsResize;case"left":case"right":return Ge.ewResize;default:return Ge.default}}stopEditing(){super.stopEditing(),this.commitChange(),this.stopEditingText()}stopEditingText=()=>{this.textEditor&&(this.store.getState().drawingFeature===this.annotation&&this.store.setState({drawingFeature:null}),this.textEditor.destroy()),this.textEditor=null};startDrawing(e,s,i){this.annotation=e,this.hoveredHandle={type:"corner",corner:2},this.store.setState({hoveredHandle:2}),this.dragging=!0;const n=this.ogma.view.graphToScreenCoordinates({x:s,y:i});this.dragStartPoint=n,this.disablePanning(),this.onDragStart({clientX:n.x,clientY:n.y})}setAnnotation(e){super.setAnnotation(e),e&&os(e)&&e.properties.mode===Wo&&this.store.getState().updateFeature(e.id,{properties:{...e.properties,mode:oA}})}}class OU extends EventTarget{handlers=new Map;activeHandler;interaction;ogma;snapping;store;constructor(e,s,i,n,r){super(),this.ogma=e,this.store=s,this.interaction=r,this.snapping=new FU(e,{detectMargin:10,magnetRadius:10},i,s),this.handlers.set("box",new Dh(this.ogma,this.store,n)),this.handlers.set("text",new Dh(this.ogma,this.store,n)),this.handlers.set("comment",new Dh(this.ogma,this.store,n)),this.handlers.set("arrow",new MU(this.ogma,this.store,this.snapping,n)),this.handlers.set("polygon",new NU(this.ogma,this.store,n)),this.handlers.forEach(o=>{o.addEventListener("dragstart",()=>{this.dispatchEvent(new Event("dragstart")),this.store.setState({isDragging:!0}),this.interaction.setMode("edit")}),o.addEventListener("dragend",()=>{this.dispatchEvent(new Event("dragend")),this.store.setState({isDragging:!1}),this.interaction.suppressClicksTemporarily()})}),this.store.subscribe(o=>o.selectedFeatures,(o,a)=>{const l=Array.from(o.keys()).filter(h=>!a.has(h)),d=Array.from(a.keys()).filter(h=>!o.has(h));!l.length&&!d.length||(d.forEach(h=>this.stopEditingFeature(h)),l.forEach(h=>this.editFeature(h)))})}stopEditingFeature(e){const s=this.store.getState().features[e];if(!s)return;const i=s.properties.type,n=this.handlers.get(i);n&&n.stopEditing()}editFeature(e){const s=this.store.getState().features[e];s&&(this.setActiveHandler(s.properties.type),this.activeHandler?.setAnnotation(s))}getSnapping(){return this.snapping}getArrowHandler(){return this.handlers.get("arrow")}getActiveHandler(){return this.activeHandler}setActiveHandler(e){const s=this.handlers.get(e);if(!s)throw new Error(`Handler for type ${e} not found`);return this.activeHandler=s,this}destroy(){}}class BU extends Ud{links;snapping;arrowHandler;arrowStyle;offsetX;offsetY;comment;startX=0;startY=0;constructor(e,s,i,n,r,o,a){super(e,s),this.links=i,this.arrowHandler=r,this.snapping=n,this.offsetX=a?.offsetX??100,this.offsetY=a?.offsetY??-50,this.arrowStyle=a?.arrowStyle,this.comment=o}detectHandle(e,s){}startDrawing(e,s,i){this.startX=s,this.startY=i;const n=mc(s,i,s,i,{...Zo,head:"arrow",...this.arrowStyle?.style});this.store.getState().addFeature(n),this.store.setState({drawingFeature:n.id}),this.arrowHandler.addEventListener("dragend",this.onArrowComplete),this.store.getState().setSelectedFeatures([n.id]);const r=this.ogma.view.graphToScreenCoordinates({x:s,y:i});this.arrowHandler.startDrawing(n.id,r.x,r.y)}snapArrowStart(e,s,i){const n=this.snapping.snap({x:s,y:i});n&&(e.geometry.coordinates[0]=[n.point.x,n.point.y],e.properties.link={start:{side:Hs,id:n.id,type:n.type,magnet:n.magnet}},this.links.add(e,Hs,n.id,n.type,n.magnet))}onArrowComplete=()=>{this.arrowHandler.removeEventListener("dragend",this.onArrowComplete);const e=this.store.getState(),s=Array.from(e.selectedFeatures);if(s.length===0)return;const i=e.getFeature(s[0]);if(!i||!ii(i))return;const n=i.geometry.coordinates[0],r=i.geometry.coordinates[1],o=r[0]-this.startX,a=r[1]-this.startY,l=Math.sqrt(o*o+a*a);let d,h;l<5?(d=this.startX+this.offsetX,h=this.startY+this.offsetY):(d=r[0],h=r[1]);const u=this.comment;u.geometry.coordinates=[d,h],e.addFeature(u),this.store.setState({drawingFeature:u.id});const c=u.properties.height,g=d,m=h+c*.5;this.snapArrowStart(i,n[0],n[1]);const f=i.properties.link?.start;e.updateFeature(i.id,{...i,geometry:{...i.geometry,coordinates:[[g,m],n]},properties:{...i.properties,link:{start:{side:Hs,id:u.id,type:$e.COMMENT,magnet:{x:0,y:.5}},end:f?{side:xn,id:f.id,type:f.type,magnet:f.magnet}:void 0}}}),this.links.add(i,Hs,u.id,$e.COMMENT,{x:0,y:.5}),f&&f.magnet&&this.links.add(i,xn,f.id,f.type,f.magnet),e.setSelectedFeatures([u.id]),this.store.setState({drawingFeature:null})}}const UU=["x","y","radius"],GU=100;class VU{links=new Map;nodeToLink=new Map;annotationToLink=new Map;linksByArrowId=new Map;store;ogma;updatedItems=new Set;onLinkCreated;constructor(e,s,i){this.ogma=e,this.store=s,this.onLinkCreated=i,this.store.subscribe(n=>n.features,this.onAddArrow),this.store.subscribe(n=>({zoom:n.zoom,rotation:n.rotation}),this.refresh,{equalityFn:(n,r)=>n.zoom===r.zoom&&n.rotation===r.rotation}),this.ogma.events.on("setMultipleAttributes",this.onSetMultipleAttributes).on("viewChanged",this.refresh)}updateLinkedArrowsDuringDrag(e,s){const i=this.store.getState();if(!i.getFeature(e))return;const r=this.annotationToLink.get(e);if(r)for(const o of r){const a=this.links.get(o);if(!a)continue;const l=i.getFeature(a.arrow),d=Ph(l,a.side),h=$o(d,s),u={...l.geometry,coordinates:l.geometry.coordinates.map((c,g)=>a.side===Hs&&g===0||a.side===xn&&g===1?[h.x,h.y]:[...c])};i.applyLiveUpdate(l.id,{geometry:u}),this.updatedItems.add(l.id)}}add(e,s,i,n,r){const o=qn(),a=e.id;let l=r;if(n===$e.POLYGON){const c=this.store.getState().getFeature(i);if(c&&Pn(c)){const g=H_(c),m=g[2]-g[0],f=g[3]-g[1],p=r.x-g[0],_=r.y-g[1],x=m>0?p/m:.5,y=f>0?_/f:.5;l={x,y}}}const d={id:o,arrow:a,target:i,targetType:n,magnet:l,side:s};if(n===$e.NODE&&!this.ogma.getNode(i))return;this.remove(e,s),this.links.set(o,d);const h=n===$e.NODE?this.nodeToLink:this.annotationToLink;return h.has(i)||h.set(i,new Set),h.get(i).add(o),this.linksByArrowId.has(a)||this.linksByArrowId.set(a,{}),this.linksByArrowId.get(a)[s]=o,e.properties.link=e.properties.link||{},e.properties.link[s]={id:i,side:s,type:n,magnet:l},this.onLinkCreated&&this.onLinkCreated(e,d),this}remove(e,s){const i=e.id,n=this.linksByArrowId.get(i)?.[s];if(delete e.properties.link?.[s],!n)return this;const r=this.links.get(n);return r?(this.links.delete(n),this.nodeToLink.get(r.target)?.delete(n),this.annotationToLink.get(r.target)?.delete(n),this.linksByArrowId.has(i)&&(this.linksByArrowId.get(i)[s]=void 0),this):this}onSetMultipleAttributes=({elements:e,updatedAttributes:s})=>{const i=new Set(s);!e.isNode||!i.has("x")&&!i.has("y")&&!i.has("radius")||this.requestUpdateFromNodePositions(e.toList())};refresh=()=>{const e=this.store.getState(),s=new Map;this.annotationToLink.forEach((i,n)=>{const r=e.getFeature(n);if(!r)return;(ss(r)&&r.properties.style?.fixedSize||os(r))&&i.forEach(a=>{const l=this.links.get(a);if(!l)return;const d=l.arrow;s.set(d,this.linksByArrowId.get(d))})}),s.size>0&&this.update(s)};requestUpdateFromNodePositions(e){setTimeout(()=>this.updateFromNodePositions(e),1)}updateFromNodePositions(e){const s=e.getId(),i=new Map;s.forEach(o=>{const a=this.nodeToLink.get(o);a&&a.forEach(l=>{const d=this.links.get(l);if(!d)return;const h=d.arrow;i.set(h,this.linksByArrowId.get(h))})});const n=e.getAttributes(UU),r=this.store.getState();for(let o=0;o<s.length;o++){const a=s[o],l=this.nodeToLink.get(a);if(l)for(const d of l){const h=this.links.get(d);if(!h)continue;const u=h.arrow,c=this.store.getState().getFeature(u),g=c.geometry.coordinates.slice(),m=Ph(c,xn),f=Ph(c,Hs),p=n[o],_=this._getNodeSnapPoint(p,Ln(cs(m,f),-1),this._isLinkedToCenter(h));g[h.side===Hs?0:1]=_,r.applyLiveUpdate(u,{...c,geometry:{coordinates:g}}),this.updatedItems.add(u),h.magnet={x:_[0]-p.x,y:_[1]-p.y},Od(c)}}this.debouncedCommit()}debouncedCommit=(()=>{let e;return()=>{clearTimeout(e),e=setTimeout(()=>{this.store.getState().batchUpdate(()=>{this.store.getState().commitLiveUpdates(this.updatedItems)}),this.updatedItems.clear()},GU)}})();update(e=this.linksByArrowId){const s=this.store.getState(),i=Array.from(this.nodeToLink.keys()),n=new Map;i.forEach((a,l)=>n.set(a,l));const o=this.ogma.getNodes(i).getAttributes(["x","y","radius"]);e.forEach((a,l)=>{const d=this.links.get(a.start),h=this.links.get(a.end),u=s.getFeature(l);let c=u.geometry.coordinates[0],g=u.geometry.coordinates[1];const m=d?d.targetType===$e.NODE?o[n.get(d.target)]:this._getAnnotationCenter(s.getFeature(d.target)):{x:c[0],y:c[1]},f=h?h.targetType===$e.NODE?o[n.get(h.target)]:this._getAnnotationCenter(s.getFeature(h.target)):{x:g[0],y:g[1]},p=cs(f,m);if(d)if(d.targetType===$e.NODE)c=this._getNodeSnapPoint(m,p,this._isLinkedToCenter(d));else{const _=s.getFeature(d.target);c=this._getAnnotationSnapPoint(_,f,d,s.zoom)}if(h)if(h.targetType===$e.NODE)g=this._getNodeSnapPoint(f,Ln(p,-1),this._isLinkedToCenter(h));else{const _=s.getFeature(h.target);g=this._getAnnotationSnapPoint(_,m,h,s.zoom)}s.applyLiveUpdate(u.id,{geometry:{coordinates:[c,g]}}),this.updatedItems.add(u.id)}),this.debouncedCommit()}onAddArrow=(e,s)=>{const i=this.store.getState(),n=new Set(Object.keys(s)),r=Object.keys(e).filter(a=>!n.has(a)),o=Object.keys(s).filter(a=>!e[a]);r.forEach(a=>{const l=i.getFeature(a);if(!l||!ii(l))return;const d=l;if(d.properties.link?.start){const h=d.properties.link.start;h.type==="node"?this.add(d,Hs,h.id,h.type,h.magnet):this.add(d,Hs,h.id,h.type,h.magnet)}if(d.properties.link?.end){const h=d.properties.link.end;h.type==="node"?this.add(d,xn,h.id,h.type,h.magnet):this.add(d,xn,h.id,h.type,h.magnet)}}),o.forEach(a=>{const l=s[a];if(ii(l)){const d=l;this.remove(d,Hs),this.remove(d,xn)}else{const d=this.annotationToLink.get(a);if(d)for(const h of d){const u=this.links.get(h);if(!u)continue;const c=i.getFeature(u.arrow);c&&this.remove(c,u.side),this.linksByArrowId.delete(u.arrow),this.links.delete(h)}}})};_isLinkedToCenter(e){return e.magnet.x===0&&e.magnet.y===0}_getAnnotationCenter(e){return Pn(e)?bU(e):Ps(e)}_getAnnotationSnapPoint(e,s,i,n){if(Pn(e)){const r=H_(e),o=r[0]+i.magnet.x*(r[2]-r[0]),a=r[1]+i.magnet.y*(r[3]-r[1]);return[o,a]}return this._getBoxSnapPoint(e,s,i,n)}_getBoxSnapPoint(e,s,i,n){const r=Ps(e);let{width:o,height:a}=_s(e);(ss(e)&&e.properties.style?.fixedSize||os(e))&&(o/=n,a/=n);let d=i.magnet.x*o,h=i.magnet.y*a;if(ss(e)&&!ks(e)){const{sin:u,cos:c}=this.store.getState(),g=d*c-h*u,m=d*u+h*c;d=g,h=m}else if(os(e)){const c={...e.properties.style}.iconSize||32,g=c/16*.5;d=i.magnet.x*c*g,h=i.magnet.y*c*g}return[r.x+d,r.y+h]}_getNodeSnapPoint(e,s,i){if(i)return[e.x,e.y];const n=Math.sqrt(s.x*s.x+s.y*s.y),r=Ln(s,1/n),o=n<Number(e.radius)/2?{x:e.x,y:e.y}:$o({x:e.x,y:e.y},Ln(r,-Number(e.radius)));return[o.x,o.y]}destroy(){this.ogma.events.off(this.onSetMultipleAttributes)}}class qU{constructor(e,s,i){this.ogma=e,this.store=s,this.index=i;const n=this.ogma.getContainer();n&&(n.addEventListener("mousemove",this.onMouseMove,{passive:!0,capture:!0}),n.addEventListener("click",this.onMouseClick,{passive:!0,capture:!0}),n.addEventListener("mousedown",this.onMouseDown,{passive:!0,capture:!1}),n.addEventListener("mouseup",this.onMouseUp,{passive:!0,capture:!0}))}query={minX:1/0,minY:1/0,maxX:1/0,maxY:1/0};suppressClickUntil=0;mouseDownState=null;DRAG_THRESHOLD=3;detect(e,s,i){let n=null;const r=this.store.getState(),o=i??r.options.detectMargin;this.query.minX=e-o,this.query.minY=s-o,this.query.maxX=e+o,this.query.maxY=s+o;const a=this.index.query(this.query);if(a.length===0)return null;for(const l of a){const d=r.getFeature(l.id);if(ii(d)){if(hA(d,{x:e,y:s},o)){n=d;break}}else if(ks(d)){if(uU(d,{x:e,y:s},0,1,o)){n=d;break}}else if(Pn(d)){if(cA(d,{x:e,y:s},o)){n=d;break}}else if(os(d)){if(gU(d,{x:e,y:s},o,r.sin,r.cos,r.zoom)){n=d;break}}else if(ss(d)&&uA(d,{x:e,y:s},o,r.revSin,r.revCos,r.zoom)){n=d;break}}return n}onMouseMove=e=>{const s=pc(e,this.ogma.getContainer()),i=this.store.getState();if(this.mouseDownState&&!i.isDragging){const d=e.clientX-this.mouseDownState.screenX,h=e.clientY-this.mouseDownState.screenY;Math.sqrt(d*d+h*h)>this.DRAG_THRESHOLD&&(this.mouseDownState.hasMoved=!0)}if(i.isDragging)return;const{x:n,y:r}=this.ogma.view.screenToGraphCoordinates(s),a=this.detect(n,r)?.id??null,l=i.hoveredFeature;a!==l&&i.setHoveredFeature(a),this.setCursor(a===null?Ge.default:Ge.pointer)};onMouseClick=()=>{Date.now()<this.suppressClickUntil};onMouseDown=e=>{if(Date.now()<this.suppressClickUntil)return;const s=pc(e,this.ogma.getContainer()),{x:i,y:n}=this.ogma.view.screenToGraphCoordinates(s),r=this.detect(i,n);this.mouseDownState={annotation:r,screenX:e.clientX,screenY:e.clientY,hasMoved:!1};const o=this.store.getState();this.store.setState({mousePressed:!0,mousePressPoint:{x:i,y:n}}),r&&!o.selectedFeatures.has(r.id)&&(e.ctrlKey||e.metaKey?o.toggleSelection(r.id):o.setSelectedFeatures([r.id]))};onMouseUp=e=>{const s=this.store.getState();if(this.store.setState({mousePressed:!1,mousePressPoint:null}),this.mouseDownState&&!this.mouseDownState.hasMoved&&!s.isDragging){const i=this.mouseDownState.annotation;i?e.ctrlKey||e.metaKey?s.toggleSelection(i.id):s.selectedFeatures.has(i.id)||s.setSelectedFeatures([i.id]):!e.ctrlKey&&!e.metaKey&&s.clearSelection()}this.mouseDownState=null};setCursor(e){const s=this.ogma.getContainer()?.firstChild;s&&(s.style.cursor=e)}setMode(e){e==="default"?this.setCursor(this.ogma.getOptions().cursor?.default||"default"):e==="add"||e==="link"?this.setCursor(Ge.crosshair):e==="rotate"&&this.setCursor(Ge.alias)}suppressClicksTemporarily(e=100){this.suppressClickUntil=Date.now()+e}destroy(){const e=this.ogma.getContainer();e&&(e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("click",this.onMouseClick))}}function fA(t,e,s=0,i=t.length-1,n=HU){for(;i>s;){if(i-s>600){const l=i-s+1,d=e-s+1,h=Math.log(l),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(l-u)/l)*(d-l/2<0?-1:1),g=Math.max(s,Math.floor(e-d*u/l+c)),m=Math.min(i,Math.floor(e+(l-d)*u/l+c));fA(t,e,g,m,n)}const r=t[e];let o=s,a=i;for(Zr(t,s,e),n(t[i],r)>0&&Zr(t,s,i);o<a;){for(Zr(t,o,a),o++,a--;n(t[o],r)<0;)o++;for(;n(t[a],r)>0;)a--}n(t[s],r)===0?Zr(t,s,a):(a++,Zr(t,a,i)),a<=e&&(s=a+1),e<=a&&(i=a-1)}}function Zr(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function HU(t,e){return t<e?-1:t>e?1:0}class jU{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let s=this.data;const i=[];if(!fl(e,s))return i;const n=this.toBBox,r=[];for(;s;){for(let o=0;o<s.children.length;o++){const a=s.children[o],l=s.leaf?n(a):a;fl(e,l)&&(s.leaf?i.push(a):Oh(e,l)?this._all(a,i):r.push(a))}s=r.pop()}return i}collides(e){let s=this.data;if(!fl(e,s))return!1;const i=[];for(;s;){for(let n=0;n<s.children.length;n++){const r=s.children[n],o=s.leaf?this.toBBox(r):r;if(fl(e,o)){if(s.leaf||Oh(e,o))return!0;i.push(r)}}s=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let s=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=s;else if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){const i=this.data;this.data=s,s=i}this._insert(s,this.data.height-s.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=rr([]),this}remove(e,s){if(!e)return this;let i=this.data;const n=this.toBBox(e),r=[],o=[];let a,l,d;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),d=!0),i.leaf){const h=YU(e,i.children,s);if(h!==-1)return i.children.splice(h,1),r.push(i),this._condense(r),this}!d&&!i.leaf&&Oh(i,n)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],d=!1):i=null}return this}toBBox(e){return e}compareMinX(e,s){return e.minX-s.minX}compareMinY(e,s){return e.minY-s.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,s){const i=[];for(;e;)e.leaf?s.push(...e.children):i.push(...e.children),e=i.pop();return s}_build(e,s,i,n){const r=i-s+1;let o=this._maxEntries,a;if(r<=o)return a=rr(e.slice(s,i+1)),Qn(a,this.toBBox),a;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),a=rr([]),a.leaf=!1,a.height=n;const l=Math.ceil(r/o),d=l*Math.ceil(Math.sqrt(o));K_(e,s,i,d,this.compareMinX);for(let h=s;h<=i;h+=d){const u=Math.min(h+d-1,i);K_(e,h,u,l,this.compareMinY);for(let c=h;c<=u;c+=l){const g=Math.min(c+l-1,u);a.children.push(this._build(e,c,g,n-1))}}return Qn(a,this.toBBox),a}_chooseSubtree(e,s,i,n){for(;n.push(s),!(s.leaf||n.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<s.children.length;l++){const d=s.children[l],h=kh(d),u=$U(e,d)-h;u<o?(o=u,r=h<r?h:r,a=d):u===o&&h<r&&(r=h,a=d)}s=a||s.children[0]}return s}_insert(e,s,i){const n=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(n,this.data,s,r);for(o.children.push(e),_o(o,n);s>=0&&r[s].children.length>this._maxEntries;)this._split(r,s),s--;this._adjustParentBBoxes(n,r,s)}_split(e,s){const i=e[s],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),a=rr(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Qn(i,this.toBBox),Qn(a,this.toBBox),s?e[s-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,s){this.data=rr([e,s]),this.data.height=e.height+1,this.data.leaf=!1,Qn(this.data,this.toBBox)}_chooseSplitIndex(e,s,i){let n,r=1/0,o=1/0;for(let a=s;a<=i-s;a++){const l=po(e,0,a,this.toBBox),d=po(e,a,i,this.toBBox),h=ZU(l,d),u=kh(l)+kh(d);h<r?(r=h,n=a,o=u<o?u:o):h===r&&u<o&&(o=u,n=a)}return n||i-s}_chooseSplitAxis(e,s,i){const n=e.leaf?this.compareMinX:XU,r=e.leaf?this.compareMinY:WU,o=this._allDistMargin(e,s,i,n),a=this._allDistMargin(e,s,i,r);o<a&&e.children.sort(n)}_allDistMargin(e,s,i,n){e.children.sort(n);const r=this.toBBox,o=po(e,0,s,r),a=po(e,i-s,i,r);let l=ml(o)+ml(a);for(let d=s;d<i-s;d++){const h=e.children[d];_o(o,e.leaf?r(h):h),l+=ml(o)}for(let d=i-s-1;d>=s;d--){const h=e.children[d];_o(a,e.leaf?r(h):h),l+=ml(a)}return l}_adjustParentBBoxes(e,s,i){for(let n=i;n>=0;n--)_o(s[n],e)}_condense(e){for(let s=e.length-1,i;s>=0;s--)e[s].children.length===0?s>0?(i=e[s-1].children,i.splice(i.indexOf(e[s]),1)):this.clear():Qn(e[s],this.toBBox)}}function YU(t,e,s){if(!s)return e.indexOf(t);for(let i=0;i<e.length;i++)if(s(t,e[i]))return i;return-1}function Qn(t,e){po(t,0,t.children.length,e,t)}function po(t,e,s,i,n){n||(n=rr(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<s;r++){const o=t.children[r];_o(n,t.leaf?i(o):o)}return n}function _o(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function XU(t,e){return t.minX-e.minX}function WU(t,e){return t.minY-e.minY}function kh(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ml(t){return t.maxX-t.minX+(t.maxY-t.minY)}function $U(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function ZU(t,e){const s=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),r=Math.min(t.maxY,e.maxY);return Math.max(0,n-s)*Math.max(0,r-i)}function Oh(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function fl(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function rr(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function K_(t,e,s,i,n){const r=[e,s];for(;r.length;){if(s=r.pop(),e=r.pop(),s-e<=i)continue;const o=e+Math.ceil((s-e)/i/2)*i;fA(t,o,e,s,n),r.push(e,o,o,s)}}const Kr={minX:0,minY:0,maxX:0,maxY:0},Q_=(t,e)=>t.id===e.id;class KU extends jU{store;constructor(e){super(),this.store=e,this.store.subscribe(s=>s.features,s=>{this.clear(),Object.values(s).forEach(i=>{ss(i)||os(i)?this.updateRotatedText(i):this.insert(i)})}),this.store.subscribe(s=>({features:s.features,isDragging:s.isDragging,lastChangedFeatures:s.lastChangedFeatures,rotation:s.rotation}),(s,i)=>{i&&i.isDragging&&!s.isDragging&&s.lastChangedFeatures.length>0&&s.lastChangedFeatures.forEach(n=>{const r=s.features[n];r&&(Od(r),ss(r)||os(r)?this.updateRotatedText(r):(this.remove(r,Q_),this.insert(r)))})},{equalityFn:(s,i)=>s.isDragging===i.isDragging}),this.store.subscribe(s=>s.rotation,this.onRotationChange),this.store.subscribe(s=>s.zoom,this.onZoomChange)}onRotationChange=()=>{const e=this.store.getState().getAllFeatures().filter(s=>ss(s)||os(s));for(const s of e)this.updateRotatedText(s)};onZoomChange=()=>{const e=this.store.getState().getAllFeatures().filter(s=>(ss(s)||os(s))&&s.properties.style?.fixedSize);for(const s of e)this.updateRotatedText(s)};updateRotatedText(e){const s=this.store.getState();this.remove(e,Q_);const i=Ps(e);let{width:n,height:r}=_s(e);if(e.properties.style?.fixedSize===!0){const h=s.invZoom;n*=h,r*=h}const a=n/2,l=r/2,d=s.getRotatedBBox(i.x-a,i.y-l,i.x+a,i.y+l);this.insert({...e,geometry:{...e.geometry,bbox:d.slice()}})}compareMinX(e,s){return Si(e)[0]-Si(s)[0]}compareMinY(e,s){return Si(e)[1]-Si(s)[1]}toBBox(e){const s=Si(e);return Kr.minX=s[0],Kr.minY=s[1],Kr.maxX=s[2],Kr.maxY=s[3],Kr}query(e){return super.search(e)}}class pA{constructor(e,s){this.ogma=e,this.store=s}layer;destroy(){}}function QU(t,e,s,i,n,r){const o=Math.min(i/2,n/2),a=Math.min(r,o);t.beginPath(),t.moveTo(e+a,s),t.lineTo(e+i-a,s),t.quadraticCurveTo(e+i,s,e+i,s+a),t.lineTo(e+i,s+n-a),t.quadraticCurveTo(e+i,s+n,e+i-a,s+n),t.lineTo(e+a,s+n),t.quadraticCurveTo(e,s+n,e,s+n-a),t.lineTo(e,s+a),t.quadraticCurveTo(e,s,e+a,s),t.closePath()}const J_=[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]];class JU extends pA{handleFill="#fff";handleStroke="#1A70E5";handleStrokeWidth=1.5;handleRadius=3;handleMagnifier=1.5;constructor(e,s){super(e,s),this.layer=e.layers.addCanvasLayer(this.render,void 0,Ig.HANDLES),this.store.subscribe(i=>({selectedFeatures:i.selectedFeatures,liveUpdates:i.liveUpdates}),this.refresh),e.events.on("zoom",this.refresh)}refresh=()=>{this.layer.refresh()};render=e=>{const s=this.store.getState(),i=1/s.zoom,{hoveredHandle:n,rotation:r,liveUpdates:o,features:a}=s,l=this.handleRadius*i;e.fillStyle=this.handleFill,e.lineWidth=this.handleStrokeWidth*i,e.strokeStyle=this.handleStroke,Object.values(a).forEach(d=>{if(!s.isSelected(d.id))return;const h=o[d.id]?{...d,...o[d.id]}:d;if(ii(h))this.renderArrowHandles(h,e,l,n);else if(ks(h)||ss(h)){const u=ss(h)?r:0;this.renderOutline(h,e,u,n,s.zoom),this.renderBoxHandles(h,e,l,n,u)}else Pn(h)&&this.renderPolygonHandles(h,e,l,n,s.drawingFeature===h.id)})};renderOutline(e,s,i,n,r){const o=ss(e)&&e.properties.style?.fixedSize;let{width:a,height:l}=_s(e);o&&(a/=r,l/=r);const d=Er(e,o,r),h=a/2,u=l/2,c=d.x+h,g=d.y+u;s.save(),s.translate(c,g),s.rotate(i);const m=e.properties.style?.borderRadius;if(m&&m>0?(QU(s,-h,-u,a,l,m),s.stroke()):s.strokeRect(-h,-u,a,l),n>=4&&n<8){let f,p,_,x;const y=m&&m>0?m:this.handleRadius/r;switch(n){case 4:f=-h+y,p=-u,_=h-y,x=-u;break;case 5:f=h,p=-u+y,_=h,x=u-y;break;case 6:f=h-y,p=u,_=-h+y,x=u;break;case 7:f=-h,p=u-y,_=-h,x=-u+y;break}s.lineWidth=this.handleStrokeWidth*this.handleMagnifier/r,s.beginPath(),s.moveTo(f,p),s.lineTo(_,x),s.stroke(),s.lineWidth=this.handleStrokeWidth}s.restore()}renderArrowHandles(e,s,i,n){const r=gA(e),o=mA(e),a=+(n===0),l=+(n===1),d=i*(1+(this.handleMagnifier-1)*a),h=i*(1+(this.handleMagnifier-1)*l);s.beginPath(),s.moveTo(r.x,r.y),s.lineTo(o.x,o.y),s.closePath(),s.stroke(),s.beginPath(),s.moveTo(r.x-d,r.y-d),s.rect(r.x-d,r.y-d,d*2,d*2),s.moveTo(o.x-h,o.y-h),s.rect(o.x-h,o.y-h,h*2,h*2),s.closePath(),s.fill(),s.stroke()}renderBoxHandles(e,s,i,n,r){if(ss(e)&&e.properties.style?.fixedSize)return;const{width:o,height:a}=_s(e),l=Er(e),d=o/2,h=a/2,u=l.x+d,c=l.y+h;s.save(),s.translate(u,c),s.rotate(r),s.beginPath();for(let g=0;g<J_.length;g++){const[m,f]=J_[g],p=o*m,_=a*f,x=n===g?i*this.handleMagnifier:i;s.rect(p-x,_-x,x*2,x*2)}s.closePath(),s.fill(),s.stroke(),s.restore()}renderPolygonHandles(e,s,i,n,r){const o=e.geometry.coordinates[0];if(!r){o.length>2&&(s.save(),s.strokeStyle=this.handleStroke,s.lineWidth=this.handleStrokeWidth/this.store.getState().zoom,this.drawSmoothPolygon(s,o,.5),s.stroke(),s.restore()),s.beginPath();for(let a=0;a<o.length-1;a++){const[l,d]=o[a],h=n===a?i*this.handleMagnifier:i;s.moveTo(l+h,d),s.arc(l,d,h,0,2*Math.PI)}s.closePath(),s.fill(),s.stroke()}}drawSmoothPolygon(e,s,i){const n=s.slice(0,-1);if(n.length<3)return;e.beginPath();const r=n.length;for(let o=0;o<r;o++){const a=n[(o-1+r)%r],l=n[o],d=n[(o+1)%r],h=n[(o+2)%r],u=l[0]+(d[0]-a[0])/6*i,c=l[1]+(d[1]-a[1])/6*i,g=d[0]-(h[0]-l[0])/6*i,m=d[1]-(h[1]-l[1])/6*i;o===0&&e.moveTo(l[0],l[1]),e.bezierCurveTo(u,c,g,m,d[0],d[1])}e.closePath()}renderCenterPoint(e,s){const i=this.store.getState();if(ss(e)){const n=Er(e,e.properties.style?.fixedSize,i.zoom),r=_s(e);s.moveTo(n.x+r.width/2+5,n.y+r.height/2),s.arc(n.x+r.width/2,n.y+r.height/2,5,0,Math.PI*2,!0)}}destroy(){this.layer.destroy(),super.destroy()}}const tG=.5;function eG(t,e,s,i){const{start:n,end:r}=Mg(t),o=cs(r,n);return Math.min(i,Math.max(2*e,ci(o)*.01,s))}function ty(t,e,s,i){const n=Ln(dA(gc(e)),i);if(!s||s!=="arrow"&&s!=="arrow-plain")return"";const r=$o(t,B_(n,Math.PI/6)),o=$o(t,B_(n,-Math.PI/6)),a=`${t.x} ${t.y}`;return`M ${r.x} ${r.y} L ${a} ${o.x} ${o.y} ${s==="arrow"?"":`${r.x} ${r.y}`}`}function sG(t,e){if(!t){t=Ee("g");const s=Ee("path");t.classList.add("annotation-arrow"),t.setAttribute("data-annotation",`${e}`),t.setAttribute("data-annotation-type","arrow"),t.appendChild(s);const i=Ee("g");i.classList.add("annotation-arrow-endpoints"),t.appendChild(i)}return t}function iG(t,e,s,i,n,r){const{start:o,end:a}=Mg(e),l=e.properties.style||Zo,{tail:d,strokeWidth:h=0,head:u,strokeColor:c,strokeType:g}=l,m=cs(a,o),f=LU(e)?1/r.zoom:1,p=eG(e,h,s,i)*f,_=sG(n,e.id),x=_.firstChild,y=u==="arrow-plain"||d==="arrow",b=c||"none";x.setAttribute("stroke",b),x.setAttribute("stroke-width",`${f*h}`),x.setAttribute("fill",y?c||"":"none"),x.setAttribute("stroke-linecap","round"),x.setAttribute("stroke-linejoin","round");const v=ty(o,dA(m),d,p),A=ty(a,m,u,p),S=v+`M ${o.x} ${o.y} ${a.x} ${a.y}`+A;x.setAttribute("d",S);const w=_.children[1];return w.innerHTML="",g==="dashed"?x.setAttribute("stroke-dasharray","5,10"):x.removeAttribute("stroke-dasharray"),ey(w,o,b,d,h,f),ey(w,a,b,u,h,f),_.setAttribute("transform",`rotate(${-r.rotation*(180/Math.PI)})`),t.appendChild(_),_}function ey(t,e,s,i,n,r){i==="halo-dot"&&sy(t,e,nG(s),tG,n*r*4),(i==="dot"||i==="halo-dot")&&sy(t,e,s,1,n*r*2)}function nG(t){return t==="none"?"none":t}function sy(t,e,s,i,n){const r=Ee("circle");r.setAttribute("cx",`${e.x}`),r.setAttribute("cy",`${e.y}`),r.setAttribute("r",`${n}`),r.setAttribute("fill-opacity",`${i}`),r.setAttribute("fill",s),t.appendChild(r)}function rG(t,e,s="box"){if(!t){t=Ee("g"),t.setAttribute("data-annotation",`${e}`),t.setAttribute("data-annotation-type",s),t.classList.add(`annotation-${s}`);const i=Ee("rect");t.appendChild(i)}return t}function _A(t,e,s,i){const n=e.id,r=`class${n}`,o=_s(e),a=rG(s,n,e.properties.type),{strokeColor:l,strokeWidth:d,strokeType:h,background:u,borderRadius:c}=e.properties.style||Ko;a.classList.add("annotation-box"),a.setAttribute("fill",`${u||"transparent"}`);const g=a.firstChild;c&&(g.setAttribute("rx",`${c}`),g.setAttribute("ry",`${c}`)),h&&h!=="none"&&(g.setAttribute("stroke",l||"black"),g.setAttribute("stroke-width",`${d}`),h==="dashed"&&g.setAttribute("stroke-dasharray","5,5")),u&&u.length&&(i.hoveredFeature===e.id?g.setAttribute("fill",Bd(u)):g.setAttribute("fill",u));const m=Er(e);return g.setAttribute("width",`${o.width}`),g.setAttribute("height",`${o.height}`),g.setAttribute("x",`${m.x}`),g.setAttribute("y",`${m.y}`),a.appendChild(g),a.setAttribute("transform",i.getRotationTransform(0,0)),a.classList.add(r),a.setAttribute("data-annotation",`${e.id}`),a.setAttribute("data-annotation-type",e.properties.type),t.appendChild(a),a}const oG=/^((?:[a-z\d-]+\s+)*)([\d.]+(%|em|px)|(?:x+-)?large|(?:x+-)?small|medium)(?:\s*\/\s*(normal|[\d.]+(%|px|em)?))?(\s.+)?$/,aG=/\bsmall-caps\b/,lG=/\b(?:italic|oblique)\b/,dG=/\bbold(?:er)?\b/,yA=16,iy=13.3333333,hG=.01*yA,uG={"xx-small":9,"x-small":10,smaller:13.3333,small:13,medium:16,large:18,larger:19.2,"x-large":24,"xx-large":32},Bh=new Map;function cG(t){if(Bh.has(t))return Bh.get(t);const e=oG.exec(t);if(!e)return;const s={};s.family=(e[6]||"").trim();let i=uG[e[2]]||parseFloat(e[2]);if(e[3]==="%"?i*=hG:e[3]==="em"?i*=yA:e[3]==="pt"&&(i*=iy),s.size=i,e[4]==="normal"||e[4]==="inherit"||!e[4]?s.height=Math.round(i*(7/6)):!e[5]||e[5]==="em"?s.height=parseFloat(e[4]||"")*i:e[5]==="pt"?s.height=parseFloat(e[4]||"")*iy:e[5]==="%"?s.height=i*.01:s.height=parseFloat(e[4]||""),s.variant=aG.test(e[1])?"small-caps":"normal",s.style=lG.test(e[1])?"italic":"normal",dG.test(e[1]))s.weight=700;else{const n=/\b(\d+)\b/.exec(e[1]),r=n?parseInt(n[1],10):400;r>=100&&r!==400?s.weight=r:s.weight=400}return Bh.set(t,s),s}const gG="12px/14px sans-serif";class zs{constructor(e=gG){let s,i=14,n=12,r=400,o="normal",a="normal",l=0,d;if(typeof e=="string"){const h=cG(e);h&&(s=h.family,n=h.size,i=h.height||14,a=h.variant,o=h.style,r=h.weight)}else e instanceof zs&&(s=e.family,n=e.size,i=e.height,a=e.variant,r=e.weight,o=e.style,l=e.baseline,d=e.color);this.family=s||"sans-serif",this.size=n||n===0?n:12,this.height=i||i===0?i:this.size*(7/6),this.variant=a||"",this.style=o||"",this.weight=r||400,this.baseline=l||0,this.color=d||""}assign(e={}){const s=new zs(this);return e.bold&&(s.weight=700),e.weight&&(s.weight=e.weight),e.italic&&(s.style="italic"),e.family&&(s.family=e.family),e.style&&(s.style=e.style),e.color&&(s.color=e.color),typeof e.baseline=="number"&&(s.baseline=e.baseline),typeof e.size=="number"&&(s.size=e.size),s}toString(e){let s="";return this.style&&this.style!=="normal"&&(s+=this.style),this.variant&&this.variant!=="normal"&&(s+=(s?" ":"")+this.variant),this.weight&&this.weight!==400&&(s+=s?" ":"",this.weight===700?s+="bold":s+=this.weight),this.size&&(s+=(s?" ":"")+this.size+"px",this.height!==this.size&&(s+="/"+this.height+"px")),this.family&&(s+=(s?" ":"")+this.family),e&&(s+="::"+this.baseline),e&&(s+="::"+this.color),s}valueOf(){return this.toString(!0)}}const xA={"\n":.28,"\r":.28," ":.28," ":.28," ":.28,"᠎":0," ":.5," ":1," ":.5," ":1," ":.33," ":.25," ":.16," ":.56," ":.28," ":.2," ":.15,"​":0," ":.16," ":.22,"　":1,"\uFEFF":0},mG=new zs,ny={trim:!0,collapse:!0},Uh={};function _c(){return(t,e)=>{const s=new zs(e);let i=s.size;return/\bmonospace\b/.test(s.family)?i*=.6:(i*=.45,s.weight>400&&(i*=1.18)),t.length*i}}function yc(t){if(t&&t.getContext){const e=t.getContext("2d");if(e&&typeof e.measureText=="function")return(s,i)=>(e.font=String(i),e.measureText(s).width)}}function bA(){const t=typeof document<"u"?document:null;return typeof OffscreenCanvas<"u"&&new OffscreenCanvas(100,100)||t&&t.createElement&&t.createElement("canvas")||null}let Mo=yc(bA())||_c();function fG(t){if(t==null)Mo=yc(bA())||_c();else if(t)Mo=yc(t)||_c();else throw new Error("setMeasureCanvas argument is not a canvas or null")}function $i(t,e,s=ny){typeof e=="string"?e=new zs(e):e instanceof zs?e=mG.assign(e):e=new zs().assign(e);const i=Object.assign({},ny,s);let n=String(t);if(!n)return 0;if(n in xA){const o=e.valueOf()+"/"+n;return o in Uh||(Uh[o]=Mo(`_${n}_`,e)-Mo("__",e)),Uh[o]}!i.trim||!i.collapse?n=n.replace(/\n/g," "):i.trim?n=n.replace(/\n/g," ").trim():i.collapse&&(n=n.replace(/\s+/g," "));const r=typeof t=="string"?0:t.tracking||0;return Mo(n,e)+e.size*r}class Be{constructor(e=""){this.value=e,this.font=null,this.href="",this.sub=!1,this.sup=!1,this.width,this.line,this.tracking,this.whitespace}clone(){const e=new Be(this.value);return Object.assign(e,this)}valueOf(){return this.value}toString(){return this.value}}class Qo extends Be{}class Ds extends Be{}class In extends Be{}const pG=/[\r\n\xA0]+/g,ry=.7;function _G(t,e){t.sup&&(t.baseline=.45,t.size=ry),t.sub&&(t.baseline=-.3,t.size=ry);let s=e;return(t.style||t.weight||t.baseline||t.color||t.size||t.family)&&(s=e.assign(t)),s}function oy(t,e,s){let i=t.width,n,r;for(;i+s.width>e&&t.length;)n=t[t.length-1],r=n.width,n.width>s.width?(n.value=n.value.slice(0,-1),n.width=$i(n,n.font),i+=n.width):t.pop(),i-=r;t[t.length-1]instanceof In&&t.pop(),n=t[t.length-1]||n||{},s.font=s.font.assign(n),s.href=t.length?n.href:null,s.rel=t.length?n.rel:null,s.target=t.length?n.target:null,t.push(s)}function ay(t){return Object.assign([],{height:0,font:t,width:0,hasOverflow:!1,hasLineOverflow:!1})}function yG(t,e,s){if(!t.length)return ay(s);const i=e.height(),n=e.width(),r=e.overflowLine(),o=e.overflowWrap(),a=s.assign({bold:!0}),l=isFinite(i())?Math.floor(i()/s.height):1/0;if(!i()&&!n(0)||!l)return ay(s);let d=0,h=0,u=0;const c=[];let g=[],m=!1;for(;d<t.length&&h<l;){const v=t[d],A=_G(v,s);if(v.width=$i(v,A),v.font=A,v.line=h,v.whitespace=v.value in xA,v.value&&(v.value=v.value.replace(pG," ")),!(!u&&v.whitespace||m&&v.whitespace))if(v instanceof Ds)u=0,g=[],c.push(d+1),h++;else if(v instanceof Qo||v instanceof In)g.push({index:d,width:u});else if(v.whitespace||u+v.width<n(h))u+=v.width;else if(g.length){let S,w;do{w=!0,S=g.pop();const I=t[S.index];let M;I instanceof In&&(M=$i("-",I.font||s),S.width+M>n(h)&&(w=!g.length))}while(!w);c.push(S.index+1),u=0,h++,d=S.index,g=[]}else if(o==="break-word"){const S=n(h);if(u+v.width>S){const w=v.clone();do v.value=v.value.slice(0,-1),v.width=$i(v,v.font||s),u+=v.width;while(v.value&&v.width>S);w.value=w.value.slice(v.value.length),t.splice(d+1,0,new Qo,w)}c.push(d+1),u=0,h++}else u+=v.width;d++,m=v.whitespace}d!==c[c.length-1]&&c.push(d);let f=0,p=0;const _=c.map(v=>{let A=f,S;for(;(S=t[A])&&(S.whitespace||!S.value);)A++;let w=v,I=null;for(;w>A&&(S=t[w-1])&&(S.whitespace||!(S.value||S instanceof In));)S instanceof Ds&&(I=S),w--;S instanceof In&&(S.value="-",S.width=$i("-",S.font||s)),f=v;const M=Object.assign(t.slice(A,w).filter(N=>N.value),{width:0});return I&&M.push(I),M.width=M.reduce((N,D)=>N+D.width,0),M.width>p&&(p=M.width),M});let x=!1;if(r){const v=r==="ellipsis"?"…":r;_.forEach((A,S)=>{const w=n(S);if(A.width>w){const I=new Be(v);I.font=s,I.width=$i(v,a),oy(A,w,I),x=!0}})}let y=!1;const b=e.overflow()==="ellipsis"?"…":e.overflow();if(b&&d!==t.length){const v=n(_.length-1),A=_[_.length-1],S=new Be(b);S.font=s,S.width=$i(b,a),oy(A,v,S),y=!0}else y=!1;return Object.assign(_,{height:_.length*s.height,font:s,width:p,hasOverflow:y,hasLineOverflow:x})}function Jn(t){return Math.round(t*1e6)/1e6}const xG={center:"middle",right:"end"},bG={middle:.5,center:.5,bottom:1,end:1},Gh=(t,e)=>!t&&!e||t===e;function vG(t,e){const s=[],i=e.font(),n=i.size,r=i.family,o=e.align(),a=e.createElement();if(t.length){const l=i.height,d=e.valign(),h=e.height()(),u=e.width()(0),c=!isFinite(u)&&t.length===1,g=c?null:e.x(),m=Jn(l/n);let f=c?null:Jn(l/(n*1.15+(l-n)/2));if(bG[d]&&isFinite(h)){const w=d==="bottom"?1:.5;f=(f||0)+(h*w-l*t.length*w)/n}const _=o==="justify";let x=0;o==="right"?x=u:o==="center"&&(x=u/2);let y=[],b="tspan",v=null,A="";const S=()=>{if(A){const w=a(b,v,A);y.push(w)}b="tspan",v=null,A=""};for(let w=0,I=t.length;w<I;w++){let M="",N="",D=0;const q=t[w];if(!q.length){s.push(a("tspan",{x:g(w),dy:Jn(w?m:f)+"em"}," "));continue}y=[];let et=0,O=0,K;for(let j=0,ot=q.length;j<ot;j++){const it=q[j],ct=it.font;it.whitespace&&et++,O+=it.width,j&&!it.tracking&&!D&&Gh(ct.id,M)&&Gh(it.class,N)&&Gh(K,it.href)?A+=it.value:(S(),A=it.value,v={fontFamily:ct.family!==r?ct.family:null,fontSize:ct.size!==n?ct.size:null,fontWeight:ct.weight!==400&&ct.weight||null,fontStyle:ct.style!=="normal"&&ct.style||null,fontVariant:ct.variant!=="normal"&&ct.variant||null,fill:ct.color||null,baselineShift:ct.baseline?ct.baseline*100+"%":null,className:it.class||null,dx:0,href:null,rel:null,target:null},D&&(v.dx=Jn(D),D=0),it.tracking&&(D=ct.size*it.tracking),it.href&&!K?(K=it.href,b="a",v.href=K,v.rel=it.rel,v.target=it.target):K=null,M=ct.id,N=it.class)}if(S(),c)s.push(...y);else{let j=null;const ot=w===I-1||q[q.length-1]instanceof Ds;if(_&&q.length>1&&!ot){const it=u-O;j=Jn(it/et)}s.push(a("tspan",{wordSpacing:j,x:g(w)+x,dy:Jn(w?m:f)+"em"},...y))}}}return a("text",{fontFamily:r,fontSize:n,textAnchor:xG[o]||"start"},...s)}const EG={middle:.5,center:.5,bottom:1,end:1};function AG(t,e){return t.color?t.color:e.href?"#00C":"#000"}function SG(t,e,s){if(!t.length)return;s.textBaseline="middle";const i=e.font(),n=i.height,r=i.size,o=e.valign(),a=e.height()(),l=e.width()(0),d=e.align(),h=d==="justify";let u=n*.5;const c=EG[o];if(c&&isFinite(a)){const g=t.length*n;u+=a*c-g*c}t.forEach((g,m)=>{let f=e.x()(m);const p=m*n+u;let _=0,x=0;g.forEach(v=>{v.whitespace&&_++,x+=v.width});let y=0;const b=m===t.length-1||g[g.length-1]instanceof Ds;h&&g.length>1&&!b&&(y=(l-x)/_),g.forEach(v=>{s.font=v.font;const A=v.font,S=A.baseline?r*-A.baseline+r*.15:0;s.fillStyle=AG(A,v);let w=0;if(d==="right"?w+=l-x:d==="center"?w+=l/2-x/2:d==="justify"&&(v.whitespace||v instanceof Ds)&&(f+=y),s.fillText(v.value,f+w,p+S),v.href){s.beginPath(),s.strokeStyle=s.fillStyle;const I=Math.floor(p+r*.45)+.5;s.moveTo(f+w,I),s.lineTo(f+w+v.width,I),s.stroke()}f+=v.width})})}function vA(t){const e={};for(let s=0;s<t.length;s++){const i=t[s];typeof i=="number"||i==null||(typeof i=="string"?e.text=i:typeof i=="function"?e.fn=i:typeof i=="object"&&i._groups?e.d3=i:i&&i.nodeType&&i.getContext?e.ctx=i.getContext("2d"):i&&i.fillText&&i.beginPath?e.ctx=i:i&&(e.text=i))}return e}const wG=Object.prototype.hasOwnProperty,Vh={};function TG(t){return Vh[t]||(Vh[t]=t.replace(/([a-z])([A-Z])/g,(e,s,i)=>s+"-"+i.toLowerCase())),Vh[t]}function EA(t,e){if(Array.isArray(e))return e.forEach(s=>EA(t,s));typeof e=="string"&&(e=document.createTextNode(e)),t.appendChild(e)}function AA(t,e,...s){if(typeof document>"u")throw new Error("No document found, cannot create elements");const i=typeof t=="string"?document.createElementNS("http://www.w3.org/2000/svg",t):t;if(e&&i.setAttribute)for(const n in e)wG.call(e,n)&&e[n]!=null&&i.setAttribute(n==="className"?"class":TG(n),String(e[n]));return s!=null&&s.length&&s.forEach(n=>{EA(i,n)}),i}const ly=t=>typeof t=="function"?t:()=>t,CG={top:{vAnchor:-0},middle:{vAnchor:-.5},bottom:{vAnchor:-1},left:{hAnchor:-0},center:{hAnchor:-.5},right:{hAnchor:-1}};class Ng{static createElement=AA;constructor(e){if(this.props={width:()=>1/0,height:()=>1/0,rotation:0,vAnchor:0,hAnchor:0},e)for(const s in e)typeof this[s]=="function"&&this[s](e[s]);this.render=this.render.bind(this)}anchor(e){const{hAnchor:s,vAnchor:i,width:n,height:r}=this.props;if(!arguments.length)return[s*n(),i*r()];if(typeof e=="string"){const o=this.props;e.toLowerCase().trim().split(/\s+/).forEach(a=>Object.assign(o,CG[a]))}return this}width(e){return arguments.length?(this.props.width=ly(e),this):this.props.width}height(e){return arguments.length?(this.props.height=ly(e),this):this.props.height}rotate(e){return arguments.length?(this.props.rotation=e,this):this.props.rotation}createElement(e){return arguments.length?(this.props.createElement=e,this):this.props.createElement||Ng.createElement}canvas(e,s){const i=e.getContext?e.getContext("2d"):e;return i.save(),i.rotate(this.rotate()*Math.PI/180),i.translate(...this.anchor()),s(i),i.restore(),i}render(...e){const s=vA(e);if(s.d3)return s.d3.attr("transform",`rotate(${this.rotate()}) translate(${this.anchor()})`);if(s.ctx)return this.canvas(s.ctx,s.fn);if(s.text){const i=typeof s.text.render=="function"?s.text.render():s.text;return this.createElement()("g",{transform:`rotate(${this.rotate()}) translate(${this.anchor()})`},i)}}}const qh=/^[\n\r\t\x20\xA0\u2000-\u200B\u205F\u3000]/,LG=/^[^\n\r\t\u0020\u2000-\u200B\u205F\u3000]{2,}/,dy=/^[\xA0\u2011\u202F\u2060\uFEFF]/,IG=/^(?:[;\xAD%?…]|,(?!\d))/,MG=/^[´±°¢£¤$¥\u2212]/,NG="'“‘[「【﹝〔<‹«{『（(<《".split(""),RG="',，,！!?？”]」】》>’»﹞〕〗〉})）』。".split(""),hy=t=>{const e=t.charCodeAt(0);return e>=19968&&e<=40959};function dd(t,e){e!==!1&&(t=t.trim());const s=[];let i=t.charAt(0),n,r,o=0;for(let a=1,l=t.length;a<l;a++){n=t.charAt(a),r=t.charAt(a+1);const d=qh.test(i),h=qh.test(n);let u=h||d||hy(i)||hy(n),c;if((MG.test(n)&&!dy.test(i)||IG.test(i+r)&&!dy.test(n))&&(u=!0),u&&(RG.includes(n)||NG.includes(i))&&(u=!1),(i==="-"||i==="‐"||i==="–"||i==="—")&&(c=qh.test(t.charAt(a-2)),c&&!h&&(u=!1),!c&&LG.test(n+r)&&(u=!0)),u){const g=t.slice(o,a);/\u00AD$/.test(g)?(s.push(new Be(g.slice(0,-1))),s.push(new In)):(s.push(new Be(g)),s.push(new Qo)),o=a}i=n}return s.push(new Be(t.slice(o))),s}const uy={nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",fnof:"ƒ",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",bull:"•",hellip:"…",prime:"′",Prime:"″",oline:"‾",frasl:"⁄",weierp:"℘",image:"ℑ",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"⊥",or:"⊦",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",lang:"〈",rang:"〉",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",quot:'"',amp:"&",lt:"<",gt:">",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",permil:"‰",lsaquo:"‹",rsaquo:"›"},FG=/^[\n\r\x20\u2000-\u200B\u205F\u3000]/,PG=/^<\/([a-zA-Z0-9]+)([^>]*)>/,zG=/^<([a-zA-Z0-9]+)((?:\s[^=\s/]+(?:\s*=\s*(?:"[^"]+"|'[^']+'|[^>\\s]+))?)+)?\s*(\/?)>(\n*)/,DG=/^<!--(.+?)-->/,kG=/&(?:#(\d\d{2,})|#x([\da-fA-F]{2,})|([a-zA-Z][a-zA-Z1-4]{1,8}));/g,cy={b:t=>t.weight=700,strong:t=>t.weight=700,i:t=>t.style="italic",em:t=>t.style="italic",dfn:t=>t.style="italic",cite:t=>t.style="italic",code:t=>t.family="monospace",kbd:t=>t.family="monospace",samp:t=>t.family="monospace",var:t=>t.family="monospace",tt:t=>t.family="monospace",sub:t=>t.sub=!0,sup:t=>t.sup=!0},OG={div:1,li:1,blockquote:2,h1:2,h2:2,h3:2,h4:2,h5:2,h6:2,ul:2,ol:2,hr:2,p:2};function SA(t){return t.replace(kG,function(e,s,i,n){if(s||i){const r=s?10:16;return String.fromCharCode(parseInt(s||i,r))}else if(n in uy)return uy[n];return e})}function BG(t){return t&&t.length>1&&(t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'")?t.slice(1,-1):t}const UG=/^\s*([^=\s&]+)(?:\s*=\s*("[^"]+"|'[^']+'|[^>\s]+))?/;function GG(t){let e;const s={};if(t){do if(e=UG.exec(t),e){const i=SA(BG(e[2]||"")).replace(/[ \r\n\t]+/g," ").trim();if(s[e[1]]=i,t=t.slice(e[0].length),t.length&&/^\S/.test(t[0]))throw new Error("Attribute error")}while(e&&t.length);if(/\S/.test(t))throw new Error("Attribute error")}return s}function VG(t){t=String(t||"").trim();let e={weight:null,style:null,sub:!1,sup:!1,href:null,color:null,rel:null,target:null};const s=[],i=[];let n,r;const o=function(u){for(const c in e)e[c]&&(u[c]=e[c]);s.push(u)},a=()=>{i.push(e),e=Object.create(e)},l=()=>{i.length&&(e=i.pop())},d=u=>{const c=s.length;let g=OG[u];if(c&&g){let m=c-1;for(;s[m]&&(s[m]instanceof Qo||FG.test(s[m].value));)m--;for(;g&&s[m]&&s[m]instanceof Ds;)m--,g--;for(;g-- >0;)s.push(new Ds)}};for(;t.length;){if(n=/^[^<]+/.exec(t)){const u=SA(n[0]);dd(u,!1).forEach(o)}else if(!(n=DG.exec(t)))if(n=PG.exec(t))l(),d(n[1]);else if(n=zG.exec(t)){const u=n[1];d(u),a(),cy[u]&&cy[u](e);const c=GG(n[2]);u==="a"&&(c.href&&(e.href=c.href),c.rel&&(e.rel=c.rel),c.target&&(e.target=c.target)),c.class&&(e.class=e.class?e.class+" "+c.class:c.class),c.style&&(r=/(?:^|\s|;)color\s*:\s*([^;\s"']+)/.exec(c.style),r&&r[1]&&(e.color=r[1])),u==="br"&&s.push(new Ds)}else n=[t.slice(0,1)],o(new Be(n[0]));t=t.slice(n[0].length)}let h=s[s.length-1];for(;h instanceof Ds;)s.pop(),h=s[s.length-1];return s}const gy={copyright:"©",textcopyright:"©",dag:"†",textdagger:"†",ddag:"‡",textdaggerdbl:"‡",guillemotleft:"«",guillemotright:"»",guilsinglleft:"‹",guilsinglright:"›",ldots:"…",dots:"…",textellipsis:"…",lq:"‘",P:"¶",textparagraph:"¶",pounds:"£",textsterling:"£",quotedblbase:"„",quotesinglbase:"‚",rq:"’",S:"§",sim:"~",textasciicircum:"^",textasciitilde:"˜",texttildelow:"~",textasteriskcentered:"*",textbackslash:"'",textbar:"|",textbardbl:"╎",textbigcircle:"◯",textbraceleft:"{",textbraceright:"}",textbullet:"•",textdollar:"$",textemdash:"—",textendash:"—",texteuro:"€",eurosym:"€",euro:"€",textexclamdown:"¡",textgreater:">",textless:"<",textordfeminine:"ª",textordmasculine:"º",textperiodcentered:"·",cdot:"·",textquestiondown:"¿",textquotedblleft:"“",textquotedblright:"”",textquoteleft:"‘",textquoteright:"’",textquotestraightbase:"‚",textquotestraightdblbase:"„",textregistered:"®",textthreequartersemdash:"-",texttrademark:"™",texttwelveudash:"-",textunderscore:"_",textvisiblespace:"␣",gets:"←",textleftarrow:"←",to:"→",textrightarrow:"→",textdegree:"°",infty:"∞",triangle:"△",triangledown:"▽",blacktriangle:"▲",blacktriangledown:"▼",angle:"∠",sphericalangle:"∢",aleph:"ℵ",hbar:"ħ",imath:"𝚤",jmath:"𝚥",ell:"ℓ",wp:"℘",Re:"ℜ",Im:"ℑ",mho:"℧",prime:"′",emptyset:"∅",nabla:"∇",surd:"√",partial:"∂",top:"⟙",bot:"⟂",vdash:"⟝",dashv:"⟞",forall:"∀",exists:"∃",nexists:"∄",neg:"¬",lnot:"¬",flat:"♭",natural:"♮",sharp:"♯",backslash:"\\",Box:"□",Diamond:"♢",clubsuit:"♣",diamondsuit:"♦",heartsuit:"♥",spadesuit:"♠",Join:"⨝",blacksquare:"■",bigstar:"★",diagdown:"╲",diagup:"╱",blacklozenge:"⧫",rfloor:"⌋",lfloor:"⌊",rceil:"⌉",lceil:"⌈",rangle:"⟩",langle:"⟨",sum:"∑",int:"∫",oint:"∮",prod:"∏",coprod:"∏",bigcap:"∩",bigcup:"∪",bigsqcup:"⊔",bigvee:"∨",bigwedge:"∧",bigodot:"⊙",bigotimes:"⊗",bigoplus:"⊕",biguplus:"⊎",alpha:"α",beta:"β",chi:"χ",delta:"δ",epsilon:"ε",eta:"η",gamma:"γ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",omega:"ω",phi:"φ",pi:"π",psi:"ψ",rho:"ρ",sigma:"σ",tau:"τ",theta:"θ",upsilon:"υ",xi:"ξ",zeta:"ζ",Alpha:"Α",Beta:"Β",Chi:"Χ",Delta:"Δ",Epsilon:"Ε",Eta:"Η",Gamma:"Γ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Omega:"Ω",Phi:"Φ",Pi:"Π",Psi:"Ψ",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Theta:"Θ",Upsilon:"Υ",Xi:"Ξ",Zeta:"Ζ",aa:"å",AA:"Å",ae:"æ",AE:"Æ",dh:"ð",DH:"Ð",dj:"đ",DJ:"Đ",ij:"ĳ",IJ:"Ĳ",l:"ł",L:"Ł",ng:"ŋ",NG:"Ŋ",o:"ø",O:"Ø",oe:"œ",OE:"Œ",ss:"ß",SS:"SS",th:"þ",TH:"Þ"},qG=/^(\^|_|\\[^#$%&~_^\\{}()\s]+)(\{)?/,HG=/^%[^\n]+(?:\n|$)/,jG=/^[^#$%&~_^\\{}]+/,YG=/^\\([&{}$%#_])/,XG=/(?:\\[\\@,!:;-]|-{2,3}|[!?]`|``?|,,|''?|~|<<|>>)/g,WG={"---":"—","--":"–","!`":"¡","?`":"¿","``":"“",",,":"„","''":"”","`":"‘","'":"’","<<":"«",">>":"»","~":" ","\\-":"­","\\,":" ","\\;":" ","\\:":" ","\\!":" ","\\@":"\uFEFF","\\\\":"\\newline{}"},es={bf:t=>t.weight="bold",it:t=>t.style="italic",sl:t=>t.style="italic",color:(t,e)=>t.color=e,href:(t,e)=>t.href=e,"^":t=>t.sup=!0,_:t=>t.sub=!0,par:function(t){this.tokens.push(new Ds,new Ds)},newline:function(t){this.tokens.push(new Ds)},url:function(t,e){t=this.open_context(),t.href=e,this.add_token(new Be(e)),this.close_context()}};es.textsuperscript=es["^"];es.textsubscript=es._;es.textsl=es.sl;es.mathbf=es.bf;es.mathit=es.it;es.textbf=es.bf;es.textit=es.it;es.textcolor=es.color;function $G(t){t=String(t||"").trim();const e=[0];t=t.replace(/\\verb,(.*?),/,(h,u)=>(e.push(u),"\\verb,"+(e.length-1)+",")).replace(/\\\\\n/g,()=>"\\\\").replace(XG,(h,u,c)=>c.charAt(u-1)==="\\"?h:WG[h]).replace(/\n\s+/g,h=>/\n/.test(h.slice(1))?"\\par ":h).replace(/\\symbol\{(\d+)\}/,(h,u,c,g)=>g.charAt(c-1)==="\\"?h:String.fromCharCode(1*u)).replace(/(^|[^\\])(\^|_)(\d|[^{]\S*)/g,(h,u,c,g)=>u+c+"{"+g+"}").replace(/\\verb,(.*?),/,(h,u)=>`\\verb,${e[+u]},`);let s={weight:null,italic:null,variant:null,sub:!1,sup:!1,href:null};const i=[],n=[];let r;const o=function(h){for(const u in s)s[u]&&(h[u]=s[u]);return i.push(h),h},a=function(){n.push(s),s=Object.create(s)},l=function(){if(!n.length)throw new Error("Unexpected }");s=n.pop()},d={tokens:i,open_context:a,close_context:l,add_token:o};for(;t.length;){if(r=jG.exec(t))dd(r[0],!1).forEach(o);else if(r=YG.exec(t))o(new Be(r[1]));else if(!(r=HG.exec(t))){if(r=/^\{/.exec(t))a();else if(r=/^\}/.exec(t))l();else if(!(r=/^\$/.exec(t)))if(r=/^\\verb,([^,]+),/.exec(t))o(new Be(r[1]));else if(r=qG.exec(t)){const h=r[1].slice(1)||r[1];let u=!!r[2];if(/^(La)?TeX$/i.test(h)){a(),s.family="serif";let c;h==="LaTeX"&&(c=o(new Be("L")),c.tracking=-.25,c=o(new Be("A")),c.size=.7,c.baseline=.3,c.tracking=-.1),c=o(new Be("T")),c.tracking=-.17,c=o(new Be("E")),c.baseline=-.22,c.tracking=-.13,c=o(new Be("X")),l()}else if(h in gy)o(new Be(gy[h])),u&&a();else if(h in es){const c=[];let g=es[h].length-1,m;if(g){for(u=!1,t=t.slice(r[0].length-1);g--;)if(m=/^\{([^}]+)\}/.exec(t))c.push(m[1]),t=t.slice(m[0].length);else throw new Error(h+" is missing an argument");r[0]=/^\{/.exec(t)?"{":"",u=!!r[0]}u&&a(),es[h].apply(d,[s,...c])}else o(new Be(r[1])),u&&a()}else r=[t.slice(0,1)],o(new Be(r[0]))}t=t.slice(r[0].length)}return i}const ZG=new zs,Hh=t=>typeof t=="function"?t:()=>t,my={left:"left",start:"left",center:"center",middle:"center",right:"right",end:"right",justify:"justify"};class Ji{static createElement=AA;static textparser=dd;static defaultparser=dd;static htmlparser=VG;static latexparser=$G;static Token=Be;static Break=Qo;static LineBreak=Ds;static SoftHyphen=In;static Rotator=Ng;static Font=zs;static setMeasureCanvas=fG;static measureText=function(e,s,i){return $i(e,new zs(s),i)};constructor(e){this.props={overflow:"ellipsis",overflowWrap:null,overflowLine:"",align:"left",wordBreak:null,valign:"top",width:()=>1/0,height:()=>1/0,x:()=>0,font:ZG,parser:Ji.defaultparser},e&&(e.font&&this.font(e.font),e.overflow&&this.overflow(e.overflow),e.overflowLine&&this.overflowLine(e.overflowLine),e.overflowWrap&&this.overflowWrap(e.overflowWrap),e.valign&&this.valign(e.valign),e.align&&this.align(e.align),e.width&&this.width(e.width),e.height&&this.height(e.height),e.x&&this.x(e.x),e.parser&&this.parser(e.parser),e.createElement&&this.createElement(e.createElement))}linebreak(e){const s=this.props.parser(String(e)),i=yG(s,this,this.font()),n=r=>this.render(i,r);return Object.assign(i,{render:n,svg:n,draw:n})}font(e){return arguments.length?(this.props.font=new zs(e),this):this.props.font||new zs}overflow(e){return arguments.length?(this.props.overflow=String(e),this):this.props.overflow}overflowLine(e){return arguments.length?(this.props.overflowLine=String(e),this):this.props.overflowLine}valign(e){return arguments.length?(this.props.valign=e,this):this.props.valign}align(e){if(!arguments.length)return this.props.align;const s=String(e).toLowerCase();return s in my&&(this.props.align=my[s]),this}overflowWrap(e){if(!arguments.length)return this.props.overflowWrap||"normal";const s=String(e).toLowerCase();return s==="break-word"?this.props.overflowWrap="break-word":(s==="normal"||e==null)&&(this.props.overflowWrap=null),this}width(e){return arguments.length?(this.props.width=Hh(e),this):this.props.width}height(e){return arguments.length?(this.props.height=Hh(e),this):this.props.height}x(e){return arguments.length?(this.props.x=Hh(e),this):this.props.x}parser(e){if(!arguments.length)return this.props.parser;if(typeof e=="string"){const s=Ji[e]||Ji[e+"parser"];typeof s=="function"&&(e=s)}if(typeof e!="function")throw new Error("Unknown parser: "+e);return this.props.parser=e,this}createElement(e){return arguments.length?(this.props.createElement=e,this):this.props.createElement||Ji.createElement}render(e,s){const i=vA([e,s]);if(typeof i.text=="string"&&(i.text=this.linebreak(i.text)),i.ctx)SG(i.text,this,i.ctx);else return vG(i.text,this)}}function wA(t,e,s,i){const{width:n,height:r}=_s(e),{color:o=ms.color,strokeColor:a=ms.strokeColor,strokeWidth:l=ms.strokeWidth,strokeType:d=ms.strokeType,background:h=ms.background,borderRadius:u=ms.borderRadius,fixedSize:c=ms.fixedSize}=e.properties.style||ms,g=_A(t,e,s,i);g.setAttribute("data-annotation-type",e.properties.type),g.classList.add("annotation-text"),g.setAttribute("fill",`${o}`);let m=g.firstChild;for(;m;){const y=m.nextSibling;m.nodeType===1&&m.tagName!=="rect"&&g.removeChild(m),m=y}let f=g.firstChild;f||(f=Ee("rect"),g.appendChild(f));const p=-n/2,_=-r/2;u&&(f.setAttribute("rx",`${u}`),f.setAttribute("ry",`${u}`)),d&&d!=="none"&&(f.setAttribute("stroke",a||"black"),f.setAttribute("stroke-width",`${l}`),d==="dashed"&&f.setAttribute("stroke-dasharray","5,5")),h&&h.length&&(i.hoveredFeature===e.id?f.setAttribute("fill",Bd(h)):f.setAttribute("fill",h)),f.setAttribute("width",`${n}`),f.setAttribute("height",`${r}`);const x=Ps(e);return f.setAttribute("x",`${p}`),f.setAttribute("y",`${_}`),KG(e,g,p,_),g.setAttribute("transform",i.getScreenAlignedTransform(x.x,x.y,!c)),t.appendChild(g),g}const fy=t=>t.replace(/…$/,""),py=t=>t.children[0].innerHTML;function KG(t,e,s=0,i=0){const{width:n,height:r}=_s(t),{fontSize:o=ms.fontSize,font:a=ms.font,padding:l=0}=t.properties.style||{};if(n===r&&n===0)return;const d=parseFloat(o.toString())*aA,h=new Ji({font:`${o}px/${d}px ${a}`.replace(/(px)+/g,"px"),width:n-l*2,height:r-l,align:"left",valign:"top",x:0,overflow:"ellipsis",parser:Ji.htmlparser,createElement:Ji.createElement});h.overflowWrap("break-word");const u=t.properties.content||"";if(u.length===0)return;const g=h.linebreak(u.replaceAll(`
`,"<br>")).svg(),m=[...g.children],f=u.match(/(https?:\/\/.*)/gm);(f?f.map(_=>_.split(" ")[0]):[]).forEach(_=>{let x=_;const y=[];for(;x.length>0;){const b=m.find(A=>!!A.children[0]&&A.children[0].tagName==="tspan"&&x.startsWith(fy(py(A))));if(!b)break;y.push(b);const v=fy(b.children[0].innerHTML).length;if(!v)break;x=x.slice(v)}y.forEach(b=>{const v=document.createElementNS("http://www.w3.org/2000/svg","a");v.setAttribute("href",_),v.setAttribute("target","_blank"),v.innerHTML=py(b),b.children[0].innerHTML="",b.children[0].appendChild(v)})}),g.setAttribute("transform",`translate(${s+l}, ${i+l})`),e.appendChild(g)}function QG(t,e,s){const i={...bn,...e.properties.style},n=i.iconSize,{iconColor:r=bn.iconColor,iconSymbol:o=bn.iconSymbol,iconBorderColor:a=bn.iconBorderColor,iconBorderWidth:l=bn.iconBorderWidth}=i;let d=t.querySelector("circle");d||(d=Ee("circle"),d.setAttribute("cx","0"),d.setAttribute("cy","0"),t.appendChild(d)),d.setAttribute("r",`${n/2}`),s.hoveredFeature===e.id?d.setAttribute("fill",Bd(r)):d.setAttribute("fill",r),l&&l>0?(d.setAttribute("stroke",a||"#CCC"),d.setAttribute("stroke-width",`${l}`)):(d.removeAttribute("stroke"),d.removeAttribute("stroke-width"));let h=t.querySelector("text");h||(h=Ee("text"),h.setAttribute("x","0"),h.setAttribute("y","0"),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","central"),h.setAttribute("pointer-events","none"),t.appendChild(h)),h.setAttribute("font-size",`${n*.5}`),h.textContent=o}function JG(t,e,s){const i={...e,properties:{type:"text",content:e.properties.content,width:e.properties.width,height:e.properties.height,style:{...e.properties.style,fixedSize:!0}}},n=Ee("g"),r=wA(n,i,void 0,s);for(t.innerHTML="";r.firstChild;)t.appendChild(r.firstChild);t.setAttribute("filter","url(#softShadow)")}function t3(t,e,s,i){const n=e.properties.mode;let r=s;r||(r=Ee("g"),r.setAttribute("data-annotation",`${e.id}`),r.setAttribute("data-annotation-type","comment"));let o=r.querySelector(".comment-icon");o||(o=Ee("g"),o.classList.add("comment-icon"),r.appendChild(o));let a=r.querySelector(".comment-box");a||(a=Ee("g"),a.classList.add("comment-box"),r.appendChild(a)),QG(o,e,i),JG(a,e,i),n===Wo&&!r.classList.contains("comment-collapsed")?(r.classList.add("comment-collapsed"),r.classList.remove("comment-expanded")):n!==Wo&&r.classList.contains("comment-collapsed")&&(r.classList.add("comment-expanded"),r.classList.remove("comment-collapsed"));const l=Ps(e);return r.setAttribute("transform",i.getScreenAlignedTransform(l.x,l.y,!1)),(!r.parentNode||r.parentNode!==t)&&t.appendChild(r),r}function e3(t,e=.5,s=!1){if(t.length<2)return"";if(t.length<3)return t.map((o,a)=>`${a===0?"M":"L"}${o[0]},${o[1]}`).join(" ")+" Z";const i=t,n=i.length-1,r=[];for(let o=0;o<n;o++){const a=i[(o-1+n)%n],l=i[o],d=i[(o+1)%n],h=i[(o+2)%n],u=l[0]+(d[0]-a[0])/6*e,c=l[1]+(d[1]-a[1])/6*e,g=d[0]-(h[0]-l[0])/6*e,m=d[1]-(h[1]-l[1])/6*e;o===0&&r.push(`M${l[0]},${l[1]}`),s&&o===n-1?r.push(`L${d[0]},${d[1]}`):r.push(`C${u},${c} ${g},${m} ${d[0]},${d[1]}`)}return r.push("Z"),r.join(" ")}const s3=(t,e,s="box")=>(t||(t=Ee("g"),t.setAttribute("data-annotation",`${e}`),t.classList.add(`annotation-${s}`)),t);function i3(t,e,s,i){const n=s3(s,e.id.toString(),e.properties.type);n.setAttribute("data-annotation",String(e.id));let r=n.querySelector("path");r||(r=Ee("path"),n.appendChild(r));const{strokeColor:o=vn.strokeColor,strokeWidth:a=vn.strokeWidth,background:l=vn.background,strokeType:d=vn.strokeType}=e.properties.style||vn;o&&r.setAttribute("stroke",o),a!==void 0&&r.setAttribute("stroke-width",String(a)),l&&(i.hoveredFeature===e.id?r.setAttribute("fill",Bd(l)):r.setAttribute("fill",l)),d&&r.setAttribute("stroke-dasharray",d);const h=e.geometry.coordinates[0],u=e3(h,.5,i.drawingFeature===e.id);return r.setAttribute("d",u),n.setAttribute("transform",i.getRotationTransform(0,0)),t.appendChild(n),n}class n3 extends pA{features=new Map;arrowsRoot=null;shapesRoot=null;commentsRoot=null;annotationsRoot=null;constructor(e,s){super(e,s),this.layer=this.ogma.layers.addSVGLayer({draw:this.render},Ig.SHAPES),this.store.subscribe(i=>({features:i.features,liveUpdates:i.liveUpdates,hoveredFeature:i.hoveredFeature,selectedFeatures:i.selectedFeatures,rotation:i.rotation,zoom:i.zoom}),()=>this.layer.refresh(),{equalityFn:(i,n)=>i.features===n.features&&i.liveUpdates===n.liveUpdates&&i.hoveredFeature===n.hoveredFeature&&i.selectedFeatures===n.selectedFeatures&&i.rotation===n.rotation&&i.zoom===n.zoom})}render=e=>{const{features:s,hoveredFeature:i,selectedFeatures:n,liveUpdates:r}=this.store.getState();(!this.annotationsRoot||!e.contains(this.annotationsRoot))&&(e.innerHTML="",e.appendChild(this.getDefs()),this.arrowsRoot=Ee("g"),this.commentsRoot=Ee("g"),this.annotationsRoot=Ee("g"),this.shapesRoot=Ee("g"),this.annotationsRoot.appendChild(this.arrowsRoot),this.annotationsRoot.appendChild(this.shapesRoot),this.annotationsRoot.appendChild(this.commentsRoot),e.appendChild(this.annotationsRoot));const o=this.arrowsRoot,a=this.annotationsRoot,l=this.commentsRoot,d=this.shapesRoot,h=this.store.getState(),u=this.getViewportBounds(),c=new Set(Object.keys(s));this.removeFeatures(c);for(let g of Object.values(s)){if(r[g.id]&&(g={...g,...r[g.id]}),!this.isFeatureVisible(g,u))continue;let m=this.features.get(g.id);ks(g)?m=_A(d,g,m,h):ss(g)?m=wA(d,g,m,h):os(g)?m=t3(l,g,m,h):Pn(g)?m=i3(d,g,m,h):ii(g)&&(m=iG(o,g,h.options?.minArrowHeight,h.options?.maxArrowHeight,m,h)),m&&this.features.set(g.id,m)}this.applyStateClasses(a,i,n)};getViewportBounds(){const e=this.ogma,{width:s,height:i}=e.view.getSize(),n=1.5,r=e.view.screenToGraphCoordinates({x:0,y:0}),o=e.view.screenToGraphCoordinates({x:s*n,y:0}),a=e.view.screenToGraphCoordinates({x:0,y:i*n}),l=e.view.screenToGraphCoordinates({x:s*n,y:i*n});return[Math.min(r.x,o.x,a.x,l.x),Math.min(r.y,o.y,a.y,l.y),Math.max(r.x,o.x,a.x,l.x),Math.max(r.y,o.y,a.y,l.y)]}isFeatureVisible(e,s){const i=e.geometry.bbox;if(!i)return!0;const[n,r,o,a]=i;return!(o<s[0]||n>s[2]||a<s[1]||r>s[3])}getDefs(){const e=Ee("defs"),s=Ee("filter");s.setAttribute("id","softShadow"),s.setAttribute("x","-50%"),s.setAttribute("y","-50%"),s.setAttribute("width","200%"),s.setAttribute("height","200%");const i=Ee("feGaussianBlur");i.setAttribute("in","SourceAlpha"),i.setAttribute("stdDeviation","2"),i.setAttribute("result","blur");const n=Ee("feOffset");n.setAttribute("in","blur"),n.setAttribute("dx","0"),n.setAttribute("dy","1"),n.setAttribute("result","offsetBlur");const r=Ee("feComponentTransfer");r.setAttribute("in","offsetBlur"),r.setAttribute("result","shadow");const o=Ee("feFuncA");o.setAttribute("type","linear"),o.setAttribute("slope","0.25"),r.appendChild(o);const a=Ee("feMerge"),l=Ee("feMergeNode");l.setAttribute("in","shadow");const d=Ee("feMergeNode");return d.setAttribute("in","SourceGraphic"),a.appendChild(l),a.appendChild(d),s.appendChild(i),s.appendChild(n),s.appendChild(r),s.appendChild(a),e.appendChild(s),e}removeFeatures(e){for(const s of this.features.keys())if(!e.has(s)){const i=this.features.get(s);i&&i.parentNode&&i.parentNode.removeChild(i),this.features.delete(s)}}applyStateClasses(e,s,i){if(s!==null){const n=e.querySelector(`[data-annotation="${s}"]`);n&&n.classList.add("annotation-hovered")}i.forEach(n=>{const r=e.querySelector(`[data-annotation="${n}"]`);r&&r.classList.add("annotation-selected")})}refresh=()=>{this.layer.refresh()};destroy(){this.features.clear(),this.layer.destroy(),super.destroy()}}const _y=t=>{let e;const s=new Set,i=(d,h)=>{const u=typeof d=="function"?d(e):d;if(!Object.is(u,e)){const c=e;e=h??(typeof u!="object"||u===null)?u:Object.assign({},e,u),s.forEach(g=>g(e,c))}},n=()=>e,a={setState:i,getState:n,getInitialState:()=>l,subscribe:d=>(s.add(d),()=>s.delete(d))},l=e=t(i,n,a);return a},TA=t=>t?_y(t):_y;var yy=(t,e,s)=>(n,r)=>({pastStates:s?.pastStates||[],futureStates:s?.futureStates||[],undo:(o=1)=>{if(r().pastStates.length){const a=s?.partialize?.(e())||e(),l=r().pastStates.splice(-o,o),d=l.shift();t(d),n({pastStates:r().pastStates,futureStates:r().futureStates.concat(s?.diff?.(a,d)||a,l.reverse())})}},redo:(o=1)=>{if(r().futureStates.length){const a=s?.partialize?.(e())||e(),l=r().futureStates.splice(-o,o),d=l.shift();t(d),n({pastStates:r().pastStates.concat(s?.diff?.(a,d)||a,l.reverse()),futureStates:r().futureStates})}},clear:()=>n({pastStates:[],futureStates:[]}),isTracking:!0,pause:()=>n({isTracking:!1}),resume:()=>n({isTracking:!0}),setOnSave:o=>n({_onSave:o}),_onSave:s?.onSave,_handleSet:(o,a,l,d)=>{s?.limit&&r().pastStates.length>=s?.limit&&r().pastStates.shift(),r()._onSave?.(o,l),n({pastStates:r().pastStates.concat(d||o),futureStates:[]})}}),r3=(t,e)=>(i,n,r)=>{r.temporal=TA(e?.wrapTemporal?.(yy(i,n,e))||yy(i,n,e));const o=e?.handleSet?.(r.temporal.getState()._handleSet)||r.temporal.getState()._handleSet,a=d=>{if(!r.temporal.getState().isTracking)return;const h=e?.partialize?.(n())||n(),u=e?.diff?.(d,h);u===null||e?.equality?.(d,h)||o(d,void 0,h,u)},l=r.setState;return r.setState=(...d)=>{const h=e?.partialize?.(n())||n();l(...d),a(h)},t((...d)=>{const h=e?.partialize?.(n())||n();i(...d),a(h)},n,r)};const o3=t=>(e,s,i)=>{const n=i.subscribe;return i.subscribe=(o,a,l)=>{let d=o;if(a){const h=l?.equalityFn||Object.is;let u=o(i.getState());d=c=>{const g=o(c);if(!h(u,g)){const m=u;a(u=g,m)}},l?.fireImmediately&&a(u,u)}return n(d)},t(e,s,i)},a3=o3;function l3(t,e,s,i,n,r,o,a,l){const d=t-o,h=e-a,u=o+d*r-h*n,c=a+d*n+h*r,g=o+(d+s)*r-h*n,m=a+(d+s)*n+h*r,f=o+(d+s)*r-(h+i)*n,p=a+(d+s)*n+(h+i)*r,_=o+d*r-(h+i)*n,x=a+d*n+(h+i)*r;return l[0]=Math.min(u,g,f,_),l[1]=Math.min(c,m,p,x),l[2]=Math.max(u,g,f,_),l[3]=Math.max(c,m,p,x),l}const d3=[0,0,0,0];function h3(t,e){const s=Object.keys(t.features),i=Object.keys(e.features);if(s.length!==i.length)return!1;for(const n of s)if(!(n in e.features))return!1;for(const n of s){const r=t.features[n],o=e.features[n],a=r.geometry,l=o.geometry;if(a.coordinates!==l.coordinates||r.properties!==o.properties||r.properties.style!==o.properties.style||a!==l)return!1}return t.drawingFeature===e.drawingFeature}const u3=t=>{const e=TA()(a3(r3((s,i)=>({features:{},liveUpdates:{},isDragging:!1,hoveringHandle:!1,hoveredHandle:-1,hoveredFeature:null,selectedFeatures:new Set,lastChangedFeatures:[],drawingFeature:null,drawingPoints:null,mousePressed:!1,mousePressPoint:null,rotation:0,sin:0,cos:1,revRotation:0,revSin:0,revCos:1,zoom:1,invZoom:1,options:{showSendButton:t?.showSendButton??!0,sendButtonIcon:t?.sendButtonIcon??lA,minArrowHeight:t?.minArrowHeight??20,maxArrowHeight:t?.maxArrowHeight??30,detectMargin:t?.detectMargin??2,magnetRadius:t?.magnetRadius??10,magnetHandleRadius:t?.magnetHandleRadius??5,textPlaceholder:t?.textPlaceholder??"Type here"},setOptions:n=>s(r=>({options:{...r.options,...n}})),removeFeature:n=>s(r=>{const o=r.features[n];if(!o)return r;if(os(o)){const d=[];Object.values(r.features).forEach(u=>{ii(u)&&(u.properties.link?.end?.id===n||u.properties.link?.start?.id===n)&&d.push(u.id)});const h={...r.features};return d.forEach(u=>{delete h[u]}),delete h[n],{features:h}}if(ii(o)){const d=o.properties.link?.end?.type==="comment"?o.properties.link.end.id:o.properties.link?.start?.type==="comment"?o.properties.link.start.id:null;if(d){let h=0;if(Object.values(r.features).forEach(u=>{ii(u)&&u.id!==n&&(u.properties.link?.end?.id===d||u.properties.link?.start?.id===d)&&h++}),h===0)return console.error("Cannot delete last arrow attached to comment. Delete the comment instead."),r}}const{[n]:a,...l}=r.features;return{features:l}}),addFeature:n=>s(r=>({features:{...r.features,[n.id]:n}})),startLiveUpdate:n=>{s(r=>({liveUpdates:n.reduce((o,a)=>({...o,[a]:{...r.features[a]}}),{})}))},applyLiveUpdate:(n,r)=>{s(o=>({liveUpdates:{...o.liveUpdates,[n]:{...o.liveUpdates[n],...r}}}))},commitLiveUpdates:n=>{const{features:r,liveUpdates:o}=i(),a={...r},l=[],d=Object.keys(o);n||(n=new Set(d)),d.forEach(h=>{const u=o[h];a[h]&&Object.keys(u).length>0&&(a[h]={...a[h],...u},l.push(h))}),s({features:a,liveUpdates:{},isDragging:!1,lastChangedFeatures:l})},cancelLiveUpdates:()=>s({liveUpdates:{},isDragging:!1}),updateFeature:(n,r)=>s(o=>({features:{...o.features,[n]:{...o.features[n],...r}}})),updateFeatures:n=>s(r=>{const o={...r.features};return Object.entries(n).forEach(([a,l])=>{o[a]&&(o[a]={...o[a],...l})}),{features:o}}),batchUpdate:n=>{const r=e.temporal.getState();r.pause(),n(),r.resume()},getFeature:n=>i().features[n],getMergedFeature:n=>{const r=i().features[n],o=i().liveUpdates[n];if(r)return o?{...r,...o}:r},getAllFeatures:()=>{const{features:n,liveUpdates:r}=i();return Object.entries(n).map(([o,a])=>{const l=r[o];return l?{...a,...l}:a})},setHoveredFeature:n=>s({hoveredFeature:n}),setSelectedFeatures:n=>s({selectedFeatures:new Set(n)}),addToSelection:n=>{const{selectedFeatures:r}=i(),o=new Set(r);o.add(n),s({selectedFeatures:o})},removeFromSelection:n=>{const{selectedFeatures:r}=i(),o=new Set(r);o.delete(n),s({selectedFeatures:o})},toggleSelection:n=>{const{selectedFeatures:r}=i(),o=new Set(r);o.has(n)?o.delete(n):o.add(n),s({selectedFeatures:o})},clearSelection:()=>s({selectedFeatures:new Set}),isHovered:n=>i().hoveredFeature===n,isSelected:n=>i().selectedFeatures.has(n),setRotation:n=>{s({rotation:n,sin:Math.sin(n),cos:Math.cos(n),revRotation:-n,revSin:Math.sin(-n),revCos:Math.cos(-n)})},setZoom:n=>{s({zoom:n,invZoom:1/n})},getScreenAlignedTransform(n,r,o=!0){const a=this.revSin,l=this.revCos,d=n*l-r*a,h=n*a+r*l,u=o?1:this.invZoom;return`matrix(${u}, 0, 0, ${u}, ${d}, ${h})`},getRotationTransform(n,r){const o=this.revSin,a=this.revCos,l=n*a-r*o,d=n*o+r*a;return`matrix(${a}, ${o}, ${-o}, ${a}, ${-l}, ${-d})`},getRotatedBBox(n,r,o,a){return l3(n,r,o-n,a-r,this.sin,this.cos,n+(o-n)/2,r+(a-r)/2,d3)},setDrawingPoints:n=>s({drawingPoints:n})}),{limit:50,partialize:s=>({drawingFeature:s.drawingFeature,isDragging:s.isDragging,features:s.features,lastChangedFeatures:s.lastChangedFeatures}),equality:h3,handleSet:s=>i=>{i.drawingFeature===null&&s(i)}})));return e};function c3(t,e,s,i,n){const{width:r,height:o}=i.view.getSize(),a=8,l=16,d=a*l,h={width:150,height:50},u=h.width,c=h.height,g=Math.max(r,o),m=200,f={minX:0,minY:0,maxX:0,maxY:0},p=i.view.graphToScreenCoordinates({x:t,y:e});for(let _=0;_<d;_++){const x=_%a,y=Math.floor(_/a),b=2*Math.PI*(x/a),v=m+y/l*(g-m),A=Math.cos(b)*v,S=Math.sin(b)*v,w=p.x+A,I=p.y+S;if(f.minX=w,f.minY=I-c/2,f.maxX=w+u,f.maxY=I+c/2,A<0&&(f.minX-=u,f.maxX-=u),f.minX<0||f.maxX>r||f.minY<0||f.maxY>o)continue;const M=i.view.screenToGraphCoordinates({x:f.minX,y:f.minY}),N=i.view.screenToGraphCoordinates({x:f.maxX,y:f.maxY});if(f.minX=M.x,f.minY=M.y,f.maxX=N.x,f.maxY=N.y,!s.query(f).filter(q=>q.properties.type!=="arrow").length)return i.view.screenToGraphCoordinates({x:w,y:I})}return i.view.screenToGraphCoordinates({x:r/2,y:o/2})}const g3={detectMargin:2,magnetHandleRadius:5,magnetRadius:10,textPlaceholder:"Type here",showSendButton:!0,sendButtonIcon:lA,minArrowHeight:20,maxArrowHeight:30};class xy extends JB{ogma;store;renderers={};interactions;editor;links;index;pendingDrawingListener=null;constructor(e,s={}){super(),this.ogma=e;const i={...g3,...s};this.store=u3(i),this.index=new KU(this.store),this.links=new VU(this.ogma,this.store,(n,r)=>{this.emit(oU,{arrow:n,link:r})}),this.interactions=new qU(this.ogma,this.store,this.index),this.editor=new OU(this.ogma,this.store,this.index,this.links,this.interactions),this.initializeRenderers(),this.setupEvents()}initializeRenderers(){this.renderers.shapes=new n3(this.ogma,this.store),this.renderers.handles=new JU(this.ogma,this.store)}setupEvents(){this.ogma.events.on("rotate",this.onRotate).on("zoom",this.onZoom).on("layoutEnd",this.onLayout),this.store.temporal.subscribe(e=>{this.emit(aU,{canUndo:e.pastStates.length>0,canRedo:e.futureStates.length>0})}),this.store.subscribe(e=>e.selectedFeatures,(e,s)=>{const i=Array.from(e).filter(n=>!s?.has(n));if(i.length>0&&this.emit(eU,{ids:i}),s){const n=Array.from(s).filter(r=>!e.has(r));n.length>0&&this.emit(sU,{ids:n})}}),this.store.subscribe(e=>e.drawingFeature,(e,s)=>{e===null&&s!==null&&this.emit(nA,{id:s})}),this.store.subscribe(e=>e.features,(e,s)=>{if(s){for(const i of Object.keys(e))s[i]?s[i]!==e[i]&&this.emit(rU,e[i]):this.emit(Rh,{id:i});for(const i of Object.keys(s))e[i]||this.emit(iU,{id:i})}})}onRotate=()=>this.store.getState().setRotation(this.ogma.view.getAngle());onZoom=()=>{const e=this.ogma.view.getZoom();this.store.getState().setZoom(e),this.updateCommentModesForZoom(e)};onLayout=()=>{this.links.update()};updateCommentModesForZoom(e){const s=this.store.getState(),i=s.features;Object.values(i).forEach(n=>{if(os(n)){const r=n,o=this.getCommentZoomThreshold(r),a=e<o?Wo:oA;r.properties.mode!==a&&s.applyLiveUpdate(r.id,{properties:{...r.properties,mode:a}})}})}getCommentZoomThreshold(e){const s={...e.properties.style};if(s.collapseZoomThreshold!==void 0)return s.collapseZoomThreshold;const n=80/e.properties.width;return Math.max(.1,Math.min(1,n))}setOptions(e={}){return this.store.getState().setOptions(e),this.store.getState().options}add(e){if(V_(e))for(const s of e.features)this.add(s);else{const s=TU(e);this.store.getState().addFeature(s)}return this}remove(e){if(V_(e))for(const s of e.features)this.remove(s);else this.store.getState().removeFeature(e.id);return this}undo(){return this.canUndo()?(this.store.temporal.getState().undo(),this.links.refresh(),!0):!1}redo(){return this.canRedo()?(this.store.temporal.getState().redo(),this.links.refresh(),!0):!1}canUndo(){return this.store.temporal.getState().pastStates.length>0}canRedo(){return this.store.temporal.getState().futureStates.length>0}clearHistory(){this.store.temporal.getState().clear()}getAnnotations(){const e=this.store.getState().features;return{type:"FeatureCollection",features:Object.values(e)}}select(e){const s=Array.isArray(e)?e:[e];return this.store.getState().setSelectedFeatures(s),this}unselect(e){const s=Array.isArray(e)?e:[e];if(e===void 0)this.store.getState().setSelectedFeatures([]);else{const i=new Set(s),n=Array.from(this.store.getState().selectedFeatures).filter(r=>!i.has(r));this.store.getState().setSelectedFeatures(n)}return this}cancelDrawing(){return this.pendingDrawingListener&&(this.ogma.events.off(this.pendingDrawingListener),this.pendingDrawingListener=null),this.editor.getActiveHandler()?.cancelDrawing(),this.emit(nU),this}enableDrawingMode(e){this.unselect().cancelDrawing();const s=i=>{this.ogma.events.off(s),this.pendingDrawingListener=null;const{x:n,y:r}=this.ogma.view.screenToGraphCoordinates(i);e(n,r)};return this.pendingDrawingListener=s,this.ogma.events.once("mousedown",s),this}enableArrowDrawing(e){return this.enableDrawingMode((s,i)=>{const n=mc(s,i,s,i,e);this.startArrow(s,i,n)})}enableTextDrawing(e){return this.enableDrawingMode((s,i)=>{const n=G_(s,i,0,0,void 0,e);this.startText(s,i,n)})}enableBoxDrawing(e){return this.enableDrawingMode((s,i)=>{const n=U_(s,i,0,0,e);this.startBox(s,i,n)})}enablePolygonDrawing(e){return this.enableDrawingMode((s,i)=>{const n=fU([[[s,i]]],{style:e});this.startPolygon(s,i,n)})}enableCommentDrawing(e={}){return this.enableDrawingMode((s,i)=>{if(e.offsetX===void 0&&e.offsetY===void 0){const r=c3(s,i,this.index,this.ogma);e.offsetX=r.x,e.offsetY=r.y}const n=cU(s,i,"",e?.commentStyle);this.startComment(s,i,n,e)})}startComment(e,s,i,n){this.editor.getActiveHandler()&&this.editor.getActiveHandler().stopEditing(),this.cancelDrawing(),this.store.setState({drawingFeature:i.id}),this.interactions.suppressClicksTemporarily(200);const r=new BU(this.ogma,this.store,this.links,this.editor.getSnapping(),this.editor.getArrowHandler(),i,n),o=a=>{a.id===i.id&&(this.select(a.id),this.off(Rh,o),this.editor.getActiveHandler()?.startEditingText())};return this.on(Rh,o),r.startDrawing(i.id,e,s),this}startBox(e,s,i=U_(e,s)){return this.store.setState({drawingFeature:i.id}),this.add(i),this.interactions.suppressClicksTemporarily(200),this.select(i.id),this.editor.getActiveHandler().startDrawing(i.id,e,s)}startArrow(e,s,i=mc(e,s)){return this.editor.getActiveHandler()&&this.editor.getActiveHandler().stopEditing(),this.cancelDrawing(),this.store.setState({drawingFeature:i.id}),this.add(i),this.interactions.suppressClicksTemporarily(200),this.select(i.id),this.editor.getActiveHandler().startDrawing(i.id,e,s)}startText(e,s,i=G_(e,s)){return this.store.setState({drawingFeature:i.id}),this.add(i),this.interactions.suppressClicksTemporarily(200),this.select(i.id),this.editor.getActiveHandler().startDrawing(i.id,e,s)}startPolygon(e,s,i){return this.store.setState({drawingFeature:i.id}),this.add(i),this.interactions.suppressClicksTemporarily(200),this.select(i.id),this.editor.getActiveHandler().startDrawing(i.id,e,s),this}getSelectedAnnotations(){const e=this.store.getState();return{type:"FeatureCollection",features:Array.from(e.selectedFeatures).map(s=>e.features[s])}}getSelected(){const e=this.store.getState(),s=Array.from(e.selectedFeatures)[0];return s?e.features[s]:null}getAnnotation(e){return this.store.getState().getFeature(e)}setScale(e,s,i,n){const r=this.store.getState().getFeature(e);if(!r)return this;const o=this.store.getState();if(ii(r)){const a=r.geometry.coordinates.map(([l,d])=>{const h=l-i,u=d-n;return[i+h*s,n+u*s]});o.updateFeature(e,{geometry:{...r.geometry,coordinates:a}})}else if(ss(r)||ks(r)){const[a,l]=r.geometry.coordinates,d=a-i,h=l-n,u=i+d*s,c=n+h*s,g=r.properties.width*s,m=r.properties.height*s;o.updateFeature(e,{properties:{...r.properties,width:g,height:m},geometry:{...r.geometry,coordinates:[u,c]}})}return this}toggleComment(e){const s=this.store.getState().getFeature(e);if(!s||!os(s))return this;const i=s;return this.store.getState().updateFeature(e,{properties:{...i.properties,mode:i.properties.mode==="collapsed"?"expanded":"collapsed"}}),this}destroy(){this.ogma.events.off(this.onRotate).off(this.onZoom),this.links.destroy(),Object.values(this.renderers).forEach(e=>e.destroy()),this.interactions.destroy(),this.editor.destroy()}updateStyle(e,s){const i=this.store.getState().getFeature(e);return i?(this.store.getState().updateFeature(e,{id:e,properties:{...i.properties,style:{...i.properties.style,...s}}}),this):this}update(e){const s=this.store.getState(),i=s.getFeature(e.id);return i?(s.updateFeature(e.id,{...i,...e,properties:{...i.properties,...e.properties,style:{...i.properties.style,...e.properties?.style}},geometry:{...i.geometry,...e.geometry}}),this):this}}class m3{ogma;control;buttons;constructor(){this.ogma=new Il({container:"app"}),this.ogma.tools.brand.set(`<div class="brand">
        <a href="../api/">
          <code>@linkurious/ogma-annotations</code>
        </a>
      </div>`,{position:"bottom-right",horizontalMargin:10,verticalMargin:10,className:"brand"}),this.control=new xy(this.ogma),this.buttons={addArrow:document.getElementById("add-arrow"),addText:document.getElementById("add-text"),addBox:document.getElementById("add-box"),addPolygon:document.getElementById("add-polygon"),addComment:document.getElementById("add-comment"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),delete:document.getElementById("delete"),export:document.getElementById("export"),centerView:document.getElementById("center-view"),rotateCW:document.getElementById("rotate-cw"),rotateCCW:document.getElementById("rotate-ccw")}}async init(){this.setupStyles(),await this.setupGraph(),await this.loadAnnotations(),this.setupEventListeners(),this.setupControlListeners(),await this.fitView(0),this.exposeGlobals()}setupStyles(){this.ogma.styles.addRule({nodeAttributes:{color:"#5B97F8"},edgeAttributes:{color:"#c9c9c9"}})}async loadAnnotations(){const e=await fetch("annotations-test.json").then(s=>s.json());this.control.add(e),this.control.clearHistory()}async setupGraph(){const e=await Il.parse.jsonFromUrl("graph.json");await this.ogma.setGraph(e),this.fitView()}setupEventListeners(){this.setupDrawingTools(),this.setupHistoryControls(),this.setupDeleteControl(),this.setupExportControl(),this.setupViewControls(),this.setupKeyboardShortcuts()}setupControlListeners(){this.control.on("history",()=>this.updateUndoRedoButtons()),this.updateUndoRedoButtons(),this.control.on("select",e=>{this.buttons.delete.disabled=e.ids.length===0}),this.control.on("cancelDrawing",()=>{console.log("cancelDrawing")})}setupDrawingTools(){this.setupArrowTool(),this.setupTextTool(),this.setupBoxTool(),this.setupPolygonTool(),this.setupCommentTool()}setupArrowTool(){this.buttons.addArrow.addEventListener("click",()=>{if(this.buttons.addArrow.disabled)return;this.clearAllActiveButtons(),this.buttons.addArrow.disabled=!0,this.buttons.addArrow.classList.add("active"),this.control.enableArrowDrawing({strokeType:"plain",strokeColor:"#3A03CF",strokeWidth:2,head:"arrow"});const e=()=>{this.buttons.addArrow.disabled=!1,this.buttons.addArrow.classList.remove("active")};this.control.once("completeDrawing",e).once("cancelDrawing",e)})}setupTextTool(){this.buttons.addText.addEventListener("click",()=>{if(this.buttons.addText.disabled)return;this.clearAllActiveButtons(),this.buttons.addText.disabled=!0,this.buttons.addText.classList.add("active"),this.control.enableTextDrawing({font:"IBM Plex Sans",fontSize:24,color:"#3A03CF",background:"#EDE6FF",borderRadius:8,padding:12});const e=()=>{this.buttons.addText.disabled=!1,this.buttons.addText.classList.remove("active")};this.control.once("completeDrawing",e).once("cancelDrawing",e)})}setupBoxTool(){this.buttons.addBox.addEventListener("click",()=>{if(this.buttons.addBox.disabled)return;this.clearAllActiveButtons(),this.buttons.addBox.disabled=!0,this.buttons.addBox.classList.add("active"),this.control.enableBoxDrawing({background:"#EDE6FF",borderRadius:8,padding:12});const e=()=>{this.buttons.addBox.disabled=!1,this.buttons.addBox.classList.remove("active")};this.control.once("completeDrawing",e).once("cancelDrawing",e)})}setupPolygonTool(){this.buttons.addPolygon.addEventListener("click",()=>{if(this.buttons.addPolygon.disabled)return;this.clearAllActiveButtons(),this.buttons.addPolygon.disabled=!0,this.buttons.addPolygon.classList.add("active"),this.control.enablePolygonDrawing({strokeColor:"#3A03CF",strokeWidth:2,background:"rgba(58, 3, 207, 0.15)"});const e=()=>{this.buttons.addPolygon.disabled=!1,this.buttons.addPolygon.classList.remove("active")};this.control.once("completeDrawing",e).once("cancelDrawing",e)})}setupCommentTool(){this.buttons.addComment.addEventListener("click",()=>{if(this.buttons.addComment.disabled)return;this.clearAllActiveButtons(),this.buttons.addComment.disabled=!0,this.buttons.addComment.classList.add("active"),this.control.enableCommentDrawing({offsetX:200,offsetY:-150,commentStyle:{content:"",style:{color:"#3A03CF",background:"#EDE6FF",fontSize:16,font:"IBM Plex Sans"}},arrowStyle:{style:{strokeType:"plain",strokeColor:"#3A03CF",strokeWidth:2,head:"halo-dot"}}});const e=()=>{this.buttons.addComment.disabled=!1,this.buttons.addComment.classList.remove("active")};this.control.once("completeDrawing",e).once("cancelDrawing",e)})}setupHistoryControls(){this.buttons.undo.addEventListener("click",()=>{this.control.undo()}),this.buttons.redo.addEventListener("click",()=>{this.control.redo()})}setupDeleteControl(){this.buttons.delete.addEventListener("click",()=>{this.control.remove(this.control.getSelectedAnnotations())})}setupExportControl(){this.buttons.export.addEventListener("click",()=>{const e=this.control.getAnnotations(),s="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),i=document.createElement("a");document.body.appendChild(i),i.setAttribute("href",s),i.setAttribute("download","annotations.json"),i.click(),i.remove(),console.log("Exported annotations:",e)})}setupViewControls(){this.buttons.centerView.addEventListener("click",async()=>{await this.fitView()}),this.buttons.rotateCW.addEventListener("click",async()=>{await this.ogma.view.rotate(-Math.PI/8,{duration:200})}),this.buttons.rotateCCW.addEventListener("click",async()=>{await this.ogma.view.rotate(Math.PI/8,{duration:200})})}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{e.key==="Escape"?(console.log("draw arrow keydown Escape"),this.control.cancelDrawing()):(e.key==="Backspace"||e.key==="Delete")&&(console.log("delete keydown",e),this.control.remove(this.control.getSelectedAnnotations()))}),document.addEventListener("keyup",e=>{switch(e.key){case"1":console.log("draw arrow keyup",e);break;case"0":this.fitView();break}})}clearAllActiveButtons(){[this.buttons.addArrow,this.buttons.addText,this.buttons.addBox,this.buttons.addPolygon].forEach(e=>{e.disabled=!1,e.classList.remove("active")})}updateUndoRedoButtons(){this.buttons.undo.disabled=!this.control.canUndo(),this.buttons.redo.disabled=!this.control.canRedo()}async fitView(e=200){const s=this.ogma.view.getGraphBoundingBox();await this.ogma.view.moveToBounds(s.extend(SU(this.control.getAnnotations())),{duration:e})}exposeGlobals(){Object.assign(window,{Ogma:Il,Control:xy,control:this.control,ogma:this.ogma})}}const f3=new m3;await f3.init();
