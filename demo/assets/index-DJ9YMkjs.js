(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();var vE=Object.defineProperty,Ho=(t,e)=>{for(var s in e)vE(t,s,{get:e[s],enumerable:!0})},ce=class{constructor(t){this._ogma=t}};function Wr(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])>e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function AE(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])<e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function Ue(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Uh(t){return Array.isArray(t)?t:[t]}function uy(t){const e=[];for(let s=0;s<t.length;++s){const i=t[s];if(Array.isArray(i))for(let n=0;n<i.length;++n)e.push(i[n]);else e.push(i)}return e}function EE(...t){if(t.length===0)return[];const e=t[0].constructor;let s=0;for(const r of t)s+=r.length;const i=new e(s);let n=0;for(const r of t){for(let o=0;o<r.length;o++)i[n+o]=r[o];n+=r.length}return i}function SE(t,e){const s=t.indexOf(e);return s!==-1&&(t.splice(s,1),!0)}function cy(t,e){let s,i,n=0,r=t.length-1;for(;n<=r;)if(s=(n+r)/2|0,i=t[s],i<e)n=s+1;else{if(!(i>e))return s;r=s-1}return-1}var Co=(t,e)=>{const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=e[t[i]];return s};function wE(t){return typeof t=="number"&&t%1==0}function Gh(t){return Array.isArray(t)?t.join("."):t}function Tn(t){if(!t)return[];if(typeof t=="string")return t.split(".");if(Array.isArray(t)){for(let e=0;e<t.length;++e)if(typeof t[e]!="string")throw new TypeError(`${t[e]} is not a string`);return t.slice()}throw new TypeError(`invalid property path "${t}": expected string or array of strings`)}function No(t,e,s){let i,n,r;if(e===0)return function(){t.apply(s,arguments)};const o=function(){i=!1,n&&(r.apply(s,n),n=null)};return r=function(){let a;return i?n=arguments:(a=t.apply(s,arguments),setTimeout(o,e),i=!0),a},r}function gy(t,e){let s,i=!1;return function n(){s?i=!0:s=setTimeout(()=>{if(s=null,i)return n(),void(i=!1);i=!1,t()},e)}}function TE(t,e,s){let i,n,r,o,a;const l=e===0||e===void 0?100:e;function d(){const u=Date.now()-o;u<l&&u>=0?i=setTimeout(d,l-u):(i=null,s||(a=t.apply(r,n),r=n=null))}const h=function(){r=this,n=arguments,o=Date.now();const u=s&&!i;return i||(i=setTimeout(d,e)),u&&(a=t.apply(r,n),r=n=null),a};return h.clear=function(){i&&(clearTimeout(i),i=null)},h.flush=function(){i&&(a=t.apply(r,n),r=n=null,clearTimeout(i),i=null)},h}function my(t,e,s,i,n){s(t[e],e,t,i,n).then(r=>{e===t.length-1?i(r):my(t,e+1,s,i,n)}).catch(n)}function IE(t,e){return new Promise((s,i)=>my(t,0,e,s,i))}function pd(){return new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120}function fy(t){return t.reduce((e,s)=>e.then(s),Promise.resolve())}function Vh(t,e,s,i,n,r,o,a){return t+n+256*(e+r)+65536*(s+o)+16777216*(i+a)}function LE(t,e){return t<e?t*e+Math.pow(e-t-1,2)/4:t*e+Math.pow(t-e-1,2)/4}function In(t){return!(t===null||typeof t!="object"||Ue(t)||t instanceof RegExp||typeof HTMLElement<"u"&&t instanceof HTMLElement)}function _o(t){const e=Object.keys(t),s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=t[e[i]];return s}function ni(t,e,s){if(Array.isArray(t))return t.forEach(e,s);if(!In(t))throw new Error("forEach: invalid argument "+JSON.stringify(t));const i=Object.keys(t);if(s!==void 0)for(let n=0;n<i.length;++n){const r=i[n];e.call(s,t[r],r)}else for(let n=0;n<i.length;++n){const r=i[n];e(t[r],r)}}function be(t){if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;++n)i[n]=be(t[n]);return i}if(!Ne(t))return t;const e={},s=Object.keys(t);for(const i of s)e[i]=be(t[i]);return e}function CE(t,e){e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)})}function _i(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function ye(t,e){const s=Tn(e);if(!s.length)return t;if(t){for(let i=0;i<s.length-1;++i){const n=t[s[i]];if(!n)return;t=n}return t[s[s.length-1]]}}function Mo(t,e,s="."){e||(e=r=>!In(r));const i={},n=Object.keys(t);for(let r=0;r<n.length;++r){const o=n[r],a=t[o];if(e(a))i[o]=a;else{const l=Mo(a,e),d=Object.keys(l);for(let h=0;h<d.length;h++){const u=d[h];i[`${o}${s}${u}`]=l[u]}}}return i}function qh(t){const e={},s=Object.keys(t);for(let i=0;i<s.length;++i){const n=s[i];_i(e,n,t[n])}return e}function Ln(t,e,s=[]){const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=t[r],a=e?e+r:r;Ne(o)?Ln(o,a+".",s):s.push(a)}return s}var py=Object.prototype.hasOwnProperty;function _y(t,e){const s=[t];let i;for(;s.length>0;)if(i=s.pop(),i)if(Ne(i))for(const n in i)py.call(i,n)&&s.push(i[n]);else e(i)}function NE(t){const e={};return _y(t,s=>e[s.getName()]=s),e}function _d(t,e=[]){if(Ne(t)){const s=Object.keys(t);for(const i of s)_d(t[i],e)}else e.push(t);return e}function yd(t){for(const e in t)typeof t[e]=="function"&&delete t[e];return t}function fs(t,e){if(t===void 0)return be(e);if(!In(t))return t;const s={},i=Object.keys(e);for(const n of i){const r=e[n],o=t[n];In(r)?s[n]=fs(o,r):s[n]=o===void 0?be(r):o}return s}function Ne(t){return t&&(t.constructor===Object||!t.constructor)}function zl(t,e){if(!Ne(e)||!Ne(t))return e;const s=Object.assign({},t),i=Object.keys(e);for(const n of i)s[n]=zl(s[n],e[n]);return s}function jh(t,e){return e==null?t:e.reduce((s,i)=>(s[i]=t[i],s),{})}var Zn=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)py.call(i,n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):Ne(e[n])&&Ne(i[n])?e[n]=Zn(e[n],i[n]):e[n]=i[n])}return e},ME=typeof global=="object"&&global!==null&&global.it!==void 0,vi=typeof document<"u",ji=typeof window<"u",xd=ji&&!window.__OGMA_HEADLESS,bd=xd&&vi,RE=typeof navigator<"u"&&navigator.userAgent!==void 0?navigator.userAgent.toLowerCase():"",FE=ji&&/mac/.test(RE),yy=typeof performance<"u"&&performance.now?()=>0|performance.now():()=>Date.now(),PE=yy();function Xe(){return yy()-PE}function xy(){const t=new Date,e=t.getDate(),s=t.getMonth()+1;return`${t.getFullYear()}-${s<10?"0"+s:s}-${e<10?"0"+e:e}`}function by(){const t=new Date;return`[${ca((t.getUTCHours()-(t.getTimezoneOffset()/60|0))%24)}:${ca(t.getUTCMinutes())}:${ca(t.getUTCSeconds())}:${ca(t.getUTCMilliseconds(),3)}]`}function ca(t,e=2){let s=Math.pow(10,e-1),i=String(t);for(;s>1;)t<s&&(i="0"+i),s/=10;return i}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Xo={};function vd(t){if(t!==Xo)throw new Error("Bad secret")}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zE(t,e){if(!OE(t)||e+1!==t.length)throw new TypeError(`
    ############################## ERROR ##############################

    It looks like you are trying to call a template tag function (fn\`...\`)
    using the normal function syntax (fn(...)), which is not supported.

    The functions in the safevalues library are not designed to be called
    like normal functions, and doing so invalidates the security guarantees
    that safevalues provides.

    If you are stuck and not sure how to proceed, please reach out to us
    instead through:
     - https://github.com/google/safevalues/issues

    ############################## ERROR ##############################`)}function Zr(t){return Object.isFrozen(t)&&Object.isFrozen(t.raw)}function ga(t){return t.toString().indexOf("`")===-1}var zg=ga(t=>t``)||ga(t=>t`\0`)||ga(t=>t`\n`)||ga(t=>t`\u0000`),DE=Zr``&&Zr`\0`&&Zr`\n`&&Zr`\u0000`;function OE(t){return!(!Array.isArray(t)||!Array.isArray(t.raw))&&t.length===t.raw.length&&!(!zg&&t===t.raw)&&!!(zg&&!DE||Zr(t))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Yd,kE="google#safe",BE=kE,UE=globalThis.trustedTypes,Dg=UE;function GE(){let t=null;if(!Dg)return t;try{const e=s=>s;t=Dg.createPolicy(BE,{createHTML:e,createScript:e,createScriptURL:e})}catch(e){throw e}return t}function hc(){return Yd===void 0&&(Yd=GE()),Yd}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ma(t){return{valueOf:t}.valueOf()}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var vy=class{constructor(t,e){vd(t),this.privateDoNotAccessOrElseWrappedHtml=e}toString(){return this.privateDoNotAccessOrElseWrappedHtml+""}},VE=vy;function qE(t){return new VE(Xo,t)}function Ay(t){const e=t,s=hc();return qE(s?s.createHTML(e):e)}function jE(t){return t instanceof vy}function uc(t){if(jE(t))return t.privateDoNotAccessOrElseWrappedHtml;{let e="";throw e="Unexpected type when unwrapping SafeHtml",new Error(e)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ey=class{constructor(t,e){vd(t),this.privateDoNotAccessOrElseWrappedResourceUrl=e}toString(){return this.privateDoNotAccessOrElseWrappedResourceUrl+""}},YE=Ey;function HE(t){return new YE(Xo,t)}function XE(t){const e=t,s=hc();return HE(s?s.createScriptURL(e):e)}function $E(t){return t instanceof Ey}function Ir(t){if($E(t))return t.privateDoNotAccessOrElseWrappedResourceUrl;{let e="";throw e="Unexpected type when unwrapping TrustedResourceUrl",new Error(e)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Dl,Og,Sy=class{constructor(t,e){vd(t),this.privateDoNotAccessOrElseWrappedScript=e}toString(){return this.privateDoNotAccessOrElseWrappedScript+""}},WE=Sy;function ZE(t){return new WE(Xo,t)}function cc(t){const e=t,s=hc();return ZE(s?s.createScript(e):e)}function KE(t){return t instanceof Sy}function wy(t){if(KE(t))return t.privateDoNotAccessOrElseWrappedScript;{let e="";throw e="Unexpected type when unwrapping SafeScript",new Error(e)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function QE(t,e){e.appendChild(t);let s=new XMLSerializer().serializeToString(e);return s=s.slice(s.indexOf(">")+1,s.lastIndexOf("</")),Ay(s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function kg(t){try{return new URL(t,window.document.baseURI)}catch{return new URL("about:invalid")}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function JE(t){let e;try{e=new URL(t)}catch{return"https:"}return e.protocol}(function(t){t[t.STYLE_ELEMENT=0]="STYLE_ELEMENT",t[t.STYLE_ATTRIBUTE=1]="STYLE_ATTRIBUTE",t[t.HTML_ATTRIBUTE=2]="HTML_ATTRIBUTE"})(Dl||(Dl={})),function(t){t[t.AT_KEYWORD=0]="AT_KEYWORD",t[t.CDC=1]="CDC",t[t.CDO=2]="CDO",t[t.CLOSE_CURLY=3]="CLOSE_CURLY",t[t.CLOSE_PAREN=4]="CLOSE_PAREN",t[t.CLOSE_SQUARE=5]="CLOSE_SQUARE",t[t.COLON=6]="COLON",t[t.COMMA=7]="COMMA",t[t.DELIM=8]="DELIM",t[t.DIMENSION=9]="DIMENSION",t[t.EOF=10]="EOF",t[t.FUNCTION=11]="FUNCTION",t[t.HASH=12]="HASH",t[t.IDENT=13]="IDENT",t[t.NUMBER=14]="NUMBER",t[t.OPEN_CURLY=15]="OPEN_CURLY",t[t.OPEN_PAREN=16]="OPEN_PAREN",t[t.OPEN_SQUARE=17]="OPEN_SQUARE",t[t.PERCENTAGE=18]="PERCENTAGE",t[t.SEMICOLON=19]="SEMICOLON",t[t.STRING=20]="STRING",t[t.WHITESPACE=21]="WHITESPACE"}(Og||(Og={}));var tS=["data:","http:","https:","mailto:","ftp:"],eS=/^\s*(?!javascript:)(?:[\w+.-]+:|[^:/?#]*(?:[/?#]|$))/i;function sS(t){const e=!eS.test(t);return e&&console.error(`A URL with content '${t}' was sanitized away.`),e}function iS(t){if(!sS(t))return t}function $o(t){return iS(t)}function nS(t){const e=JE(t);return e!==void 0&&tS.indexOf(e.toLowerCase())!==-1?t:"about:invalid#zClosurez"}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var rS="display:inline-block;clip-path:inset(0);overflow:hidden;vertical-align:top;text-decoration:inherit",oS=`:host{${rS}}`;/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aS(t,e){return t.createContextualFragment(uc(e))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lS(t,e){if(e.defaultView)throw new Error("createInertFragment called with non-inert document");const s=e.createRange();return s.selectNode(e.body),aS(s,Ay(t))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Bg(t){const e=t.nodeName;return typeof e=="string"?e:"FORM"}function Ug(t){return t.nodeType===3}function Gg(t){const e=t.nodeType;return e===1||typeof e!="number"}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var de,Js=class{constructor(t,e,s,i,n){this.allowedElements=t,this.elementPolicies=e,this.allowedGlobalAttributes=s,this.globalAttributePolicies=i,this.globallyAllowedAttributePrefixes=n}isAllowedElement(t){return t!=="FORM"&&(this.allowedElements.has(t)||this.elementPolicies.has(t))}getAttributePolicy(t,e){const s=this.elementPolicies.get(e);return s?.has(t)?s.get(t):this.allowedGlobalAttributes.has(t)?{policyAction:de.KEEP}:this.globalAttributePolicies.get(t)||(this.globallyAllowedAttributePrefixes&&[...this.globallyAllowedAttributePrefixes].some(n=>t.indexOf(n)===0)?{policyAction:de.KEEP}:{policyAction:de.DROP})}};(function(t){t[t.DROP=0]="DROP",t[t.KEEP=1]="KEEP",t[t.KEEP_AND_SANITIZE_URL=2]="KEEP_AND_SANITIZE_URL",t[t.KEEP_AND_NORMALIZE=3]="KEEP_AND_NORMALIZE",t[t.KEEP_AND_SANITIZE_STYLE=4]="KEEP_AND_SANITIZE_STYLE",t[t.KEEP_AND_USE_RESOURCE_URL_POLICY=5]="KEEP_AND_USE_RESOURCE_URL_POLICY",t[t.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET=6]="KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET"})(de||(de={}));var dS=new Set(["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"]);function hS(t){return!dS.has(t.toUpperCase())&&/^[a-z][-_.a-z0-9]*-[-_.a-z0-9]*$/i.test(t)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var uS=["ARTICLE","SECTION","NAV","ASIDE","H1","H2","H3","H4","H5","H6","HEADER","FOOTER","ADDRESS","P","HR","PRE","BLOCKQUOTE","OL","UL","LH","LI","DL","DT","DD","FIGURE","FIGCAPTION","MAIN","DIV","EM","STRONG","SMALL","S","CITE","Q","DFN","ABBR","RUBY","RB","RT","RTC","RP","DATA","TIME","CODE","VAR","SAMP","KBD","SUB","SUP","I","B","U","MARK","BDI","BDO","SPAN","BR","WBR","NOBR","INS","DEL","PICTURE","PARAM","TRACK","MAP","TABLE","CAPTION","COLGROUP","COL","TBODY","THEAD","TFOOT","TR","TD","TH","SELECT","DATALIST","OPTGROUP","OPTION","OUTPUT","PROGRESS","METER","FIELDSET","LEGEND","DETAILS","SUMMARY","MENU","DIALOG","SLOT","CANVAS","FONT","CENTER","ACRONYM","BASEFONT","BIG","DIR","HGROUP","STRIKE","TT"],cS=[["A",new Map([["href",{policyAction:de.KEEP_AND_SANITIZE_URL}]])],["AREA",new Map([["href",{policyAction:de.KEEP_AND_SANITIZE_URL}]])],["LINK",new Map([["href",{policyAction:de.KEEP_AND_USE_RESOURCE_URL_POLICY,conditions:new Map([["rel",new Set(["alternate","author","bookmark","canonical","cite","help","icon","license","next","prefetch","dns-prefetch","prerender","preconnect","preload","prev","search","subresource"])]])}]])],["SOURCE",new Map([["src",{policyAction:de.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:de.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["IMG",new Map([["src",{policyAction:de.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:de.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["VIDEO",new Map([["src",{policyAction:de.KEEP_AND_USE_RESOURCE_URL_POLICY}]])],["AUDIO",new Map([["src",{policyAction:de.KEEP_AND_USE_RESOURCE_URL_POLICY}]])]],gS=["title","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-current","aria-disabled","aria-dropeffect","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","alt","align","autocapitalize","autocomplete","autocorrect","autofocus","autoplay","bgcolor","border","cellpadding","cellspacing","checked","cite","color","cols","colspan","controls","controlslist","datetime","disabled","download","draggable","enctype","face","formenctype","frameborder","height","hreflang","hidden","ismap","label","lang","loop","max","maxlength","media","minlength","min","multiple","muted","nonce","open","placeholder","poster","preload","rel","required","reversed","role","rows","rowspan","selected","shape","size","sizes","slot","span","spellcheck","start","step","summary","translate","type","valign","value","width","wrap","itemscope","itemtype","itemid","itemprop","itemref"],mS=[["dir",{policyAction:de.KEEP_AND_NORMALIZE,conditions:ma(()=>new Map([["dir",new Set(["auto","ltr","rtl"])]]))}],["async",{policyAction:de.KEEP_AND_NORMALIZE,conditions:ma(()=>new Map([["async",new Set(["async"])]]))}],["loading",{policyAction:de.KEEP_AND_NORMALIZE,conditions:ma(()=>new Map([["loading",new Set(["eager","lazy"])]]))}],["target",{policyAction:de.KEEP_AND_NORMALIZE,conditions:ma(()=>new Map([["target",new Set(["_self","_blank"])]]))}]],fS=new Js(new Set(uS),new Map(cS),new Set(gS),new Map(mS),void 0),pS=class{constructor(t,e,s,i,n,r){this.sanitizerTable=t,this.styleElementSanitizer=s,this.styleAttributeSanitizer=i,this.resourceUrlPolicy=n,this.openShadow=r,this.changes=[],vd(e)}sanitizeAssertUnchanged(t){this.changes=[];const e=this.sanitize(t);if(this.changes.length!==0)throw new Error(`Unexpected change to HTML value as a result of sanitization. Input: "${t}", sanitized output: "${e}"
List of changes:${this.changes.join(`
`)}`);return e}sanitize(t){const e=document.implementation.createHTMLDocument("");return QE(this.sanitizeToFragmentInternal(t,e),e.body)}sanitizeToFragment(t){const e=document.implementation.createHTMLDocument("");return this.styleElementSanitizer&&this.styleAttributeSanitizer?this.sanitizeWithCssToFragment(t,e):this.sanitizeToFragmentInternal(t,e)}sanitizeWithCssToFragment(t,e){const s=document.createElement("safevalues-with-css"),i=this.openShadow?"open":"closed",n=s.attachShadow({mode:i}),r=this.sanitizeToFragmentInternal(t,e),o=document.createElement("style");o.textContent=oS,o.id="safevalues-internal-style",n.appendChild(o),n.appendChild(r);const a=e.createDocumentFragment();return a.appendChild(s),a}sanitizeToFragmentInternal(t,e){const s=lS(t,e),i=document.createTreeWalker(s,5,a=>this.nodeFilter(a));let n=i.nextNode();const r=e.createDocumentFragment();let o=r;for(;n!==null;){let a;if(Ug(n))if(this.styleElementSanitizer&&o.nodeName==="STYLE"){const l=this.styleElementSanitizer(n.data);a=this.createTextNode(l)}else a=this.sanitizeTextNode(n);else{if(!Gg(n)){let l="";throw l="Node is not of type text or element",new Error(l)}a=this.sanitizeElementNode(n,e)}if(o.appendChild(a),n=i.firstChild(),n)o=a;else for(;!(n=i.nextSibling())&&(n=i.parentNode());)o=o.parentNode}return r}createTextNode(t){return document.createTextNode(t)}sanitizeTextNode(t){return this.createTextNode(t.data)}sanitizeElementNode(t,e){const s=Bg(t),i=e.createElement(s),n=t.attributes;for(const{name:r,value:o}of n){const a=this.sanitizerTable.getAttributePolicy(r,s);if(this.satisfiesAllConditions(a.conditions,n))switch(a.policyAction){case de.KEEP:li(i,r,o);break;case de.KEEP_AND_SANITIZE_URL:const l=nS(o);l!==o&&this.recordChange(`Url in attribute ${r} was modified during sanitization. Original url:"${o}" was sanitized to: "${l}"`),li(i,r,l);break;case de.KEEP_AND_NORMALIZE:li(i,r,o.toLowerCase());break;case de.KEEP_AND_SANITIZE_STYLE:this.styleAttributeSanitizer?li(i,r,this.styleAttributeSanitizer(o)):li(i,r,o);break;case de.KEEP_AND_USE_RESOURCE_URL_POLICY:if(this.resourceUrlPolicy){const d={type:Dl.HTML_ATTRIBUTE,attributeName:r,elementName:s},h=kg(o),u=this.resourceUrlPolicy(h,d);u&&li(i,r,u.toString())}else li(i,r,o);break;case de.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET:if(this.resourceUrlPolicy){const d={type:Dl.HTML_ATTRIBUTE,attributeName:r,elementName:s},h=_S(o),u={parts:[]};for(const c of h.parts){const g=kg(c.url),m=this.resourceUrlPolicy(g,d);m&&u.parts.push({url:m.toString(),descriptor:c.descriptor})}li(i,r,yS(u))}else li(i,r,o);break;case de.DROP:this.recordChange(`Attribute: ${r} was dropped`);break;default:xS(a.policyAction,"Unhandled AttributePolicyAction case")}else this.recordChange(`Not all conditions satisfied for attribute: ${r}.`)}return i}nodeFilter(t){if(Ug(t))return 1;if(!Gg(t))return 2;const e=Bg(t);return e===null?(this.recordChange(`Node name was null for node: ${t}`),2):this.sanitizerTable.isAllowedElement(e)?1:(this.recordChange(`Element: ${e} was dropped`),2)}recordChange(t){this.changes.push(t)}satisfiesAllConditions(t,e){var s;if(!t)return!0;for(const[i,n]of t){const r=(s=e.getNamedItem(i))===null||s===void 0?void 0:s.value;if(r&&!n.has(r))return!1}return!0}};function li(t,e,s){t.setAttribute(e,s)}function _S(t){const e=[];for(const s of t.split(",")){const[i,n]=s.trim().split(/\s+/,2);e.push({url:i,descriptor:n})}return{parts:e}}function yS(t){return t.parts.map(e=>{const{url:s,descriptor:i}=e;return`${s}${i?` ${i}`:""}`}).join(" , ")}function xS(t,e=`unexpected value ${t}!`){throw new Error(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var bS=class{constructor(){this.calledBuild=!1,this.sanitizerTable=fS}onlyAllowElements(t){const e=new Set,s=new Map;for(let i of t){if(i=i.toUpperCase(),!this.sanitizerTable.isAllowedElement(i))throw new Error(`Element: ${i}, is not allowed by html5_contract.textpb`);const n=this.sanitizerTable.elementPolicies.get(i);n!==void 0?s.set(i,n):e.add(i)}return this.sanitizerTable=new Js(e,s,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowCustomElement(t,e){const s=new Set(this.sanitizerTable.allowedElements),i=new Map(this.sanitizerTable.elementPolicies);if(!hS(t=t.toUpperCase()))throw new Error(`Element: ${t} is not a custom element`);if(e){const n=new Map;for(const r of e)n.set(r.toLowerCase(),{policyAction:de.KEEP});i.set(t,n)}else s.add(t);return this.sanitizerTable=new Js(s,i,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}onlyAllowAttributes(t){const e=new Set,s=new Map,i=new Map;for(const n of t)this.sanitizerTable.allowedGlobalAttributes.has(n)&&e.add(n),this.sanitizerTable.globalAttributePolicies.has(n)&&s.set(n,this.sanitizerTable.globalAttributePolicies.get(n));for(const[n,r]of this.sanitizerTable.elementPolicies.entries()){const o=new Map;for(const[a,l]of r.entries())t.has(a)&&o.set(a,l);i.set(n,o)}return this.sanitizerTable=new Js(this.sanitizerTable.allowedElements,i,e,s,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowDataAttributes(t){if(t===void 0){const s=new Set(this.sanitizerTable.globallyAllowedAttributePrefixes);return s.add("data-"),this.sanitizerTable=new Js(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,s),this}const e=new Set(this.sanitizerTable.allowedGlobalAttributes);for(const s of t){if(s.indexOf("data-")!==0)throw new Error(`data attribute: ${s} does not begin with the prefix "data-"`);e.add(s)}return this.sanitizerTable=new Js(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,e,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowStyleAttributes(){const t=new Map(this.sanitizerTable.globalAttributePolicies);return t.set("style",{policyAction:de.KEEP_AND_SANITIZE_STYLE}),this.sanitizerTable=new Js(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,this.sanitizerTable.allowedGlobalAttributes,t,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowClassAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("class"),this.sanitizerTable=new Js(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowIdAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("id"),this.sanitizerTable=new Js(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowIdReferenceAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("aria-activedescendant").add("aria-controls").add("aria-labelledby").add("aria-owns").add("for").add("list"),this.sanitizerTable=new Js(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}withResourceUrlPolicy(t){return this.resourceUrlPolicy=t,this}},vS=class extends bS{build(){if(this.calledBuild)throw new Error("this sanitizer has already called build");return this.calledBuild=!0,new pS(this.sanitizerTable,Xo,void 0,void 0,this.resourceUrlPolicy)}};/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function AS(t){const e=wy(t).toString(),s=new Blob([e],{type:"text/javascript"});return XE(URL.createObjectURL(s))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nr(t,...e){if(e.some(s=>s!==""))throw new Error("safeScript only allows empty string expressions to enable inline comments.");return zE(t,e.length),cc(t.join(""))}function ES(t){return cc(t.map(wy).join(""))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ty(t,e){const s=$o(e);s!==void 0&&(t.href=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SS(t,e){const s=$o(e);s!==void 0&&(t.href=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wS(t,e){t.href=Ir(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function TS(t,e){const s=$o(e);s!==void 0&&(t.formAction=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function IS(t,e){t.src=Ir(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function LS(t,e){const s=$o(e);s!==void 0&&(t.action=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CS(t,e){t.src=Ir(e).toString()}function NS(t,e){t.srcdoc=uc(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function MS(t,e){const s=$o(e);s!==void 0&&(t.formAction=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function RS(t,e){t.data=Ir(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function FS(t){return PS("script",t)}function PS(t,e=document){var s;const i=(s=e.querySelector)===null||s===void 0?void 0:s.call(e,`${t}[nonce]`);return i==null?"":i.nonce||i.getAttribute("nonce")||""}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zS(t){const e=FS(t.ownerDocument);e&&t.setAttribute("nonce",e)}function DS(t,e,s){t.src=Ir(e),zS(t)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Iy(t,e){kS(t)&&OS(t),t.innerHTML=uc(e)}function OS(t){let e="";const s=t.tagName;if(/^(script|style)$/i.test(s))throw e=s.toLowerCase()==="script"?"Use setScriptTextContent with a SafeScript.":"Use setStyleTextContent with a SafeStyleSheet.",new Error(e)}function kS(t){return t.nodeType===1}function BS(t,e,s){if(t.namespaceURI!=="http://www.w3.org/1999/xhtml")throw new Error(`Cannot set attribute '${e}' on '${t.tagName}'.Element is not in the HTML namespace`);switch(e=e.toLowerCase(),`${t.tagName} ${e}`){case"A href":return void Ty(t,s);case"AREA href":return void SS(t,s);case"BASE href":return void wS(t,s);case"BUTTON formaction":return void TS(t,s);case"EMBED src":return void IS(t,s);case"FORM action":return void LS(t,s);case"IFRAME src":return void CS(t,s);case"IFRAME srcdoc":return void NS(t,s);case"IFRAME sandbox":throw new Error("Can't set 'sandbox' on iframe tags. Use setIframeSrcWithIntent or setIframeSrcdocWithIntent instead");case"INPUT formaction":return void MS(t,s);case"LINK href":throw new Error("Can't set 'href' attribute on link tags. Use setLinkHrefAndRel instead");case"LINK rel":throw new Error("Can't set 'rel' attribute on link tags. Use setLinkHrefAndRel instead");case"OBJECT data":return void RS(t,s);case"SCRIPT src":return void DS(t,s);default:if(/^on./.test(e))throw new Error(`Attribute "${e}" looks like an event handler attribute. Please use a safe alternative like addEventListener instead.`);t.setAttribute(e,s)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function US(t,e){return new Worker(Ir(t),e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vi(t){!ME&&console.warn(by()+" "+t)}function GS(t,e){e.forEach(s=>{Object.getOwnPropertyNames(s.prototype).forEach(i=>{Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(s.prototype,i)||Object.create(null))})})}var Xt=()=>{},Ol=()=>!1,gc=()=>!0,kl=()=>null,qs=t=>t;function Ly(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];s(i.get(r),n,e)}}function Cy(t,e,s){const i=new Array(e.size),n=t.getObjectList(e.isNode);for(let r=0;r<e._indexes.length;++r){const o=e._indexes[r],a=n.get(o);i[r]=s(a,r,e)}return i}function Ny(t,e,s){s=s||gc;const i=e.isNode,n=t.acquireIndexList(i),r=t.getObjectList(i),o=t.getListFactory(i);for(let a=0;a<e._indexes.length;++a){const l=e._indexes[a],d=r.get(l);d&&s(d,a,e)&&n.push(l)}return o(n.sliceAndReset())}function My(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];if(!s(i.get(r),n,e))return!1}return!0}function Ry(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];if(s(i.get(r),n,e))return!0}return!1}function Fy(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n],o=i.get(r);if(s(o,n,e))return o}}function Py(t,e,s,i){const n=t.getListFactory(e.isNode);if(!s)return{valid:e,invalid:n()};const r=t.acquireIndexList(e.isNode),o=t.acquireIndexList(e.isNode),a=t.getObjectList(e.isNode);for(let l=0;l<e._indexes.length;l++){const d=e._indexes[l],h=a.get(d);h!==void 0&&(s(h,i)?r:o).pushUnchecked(d)}return{valid:n(r.sliceAndReset()),invalid:n(o.sliceAndReset())}}function zy(t,e,s,i){const n=t.getObjectList(e.isNode);let r=i;for(let o=0;o<e._indexes.length;++o){const a=e._indexes[o];r=s(r,n.get(a),o)}return r}function Dy(t,e){const s=e.isNode,i=t.topology.getDeduper(s),n=t.acquireIndexList(s),r=t.getListFactory(s);for(let o=0;o<e._indexes.length;o++){const a=e._indexes[o];i.get(a)===0&&(i.set(a,1),n.push(a))}return r(n.sliceAndReset())}function Oy(t,e,s){const i=e.isNode,n=s.topology.getDeduper(i),r=s.acquireIndexList(i),o=s.getListFactory(i);for(let a=0;a<e._indexes.length;a++){const l=e._indexes[a];n.set(l,1)}for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];n.get(l)===0&&r.push(l)}return o(r.sliceAndReset())}function ky(t,e){const s=e.isNode,i=t.storage.fetch(s),n=i.getFlexArray("excluded"),r=i.getMaxIndex(),o=t.topology.getDeduper(s),a=t.acquireIndexList(s),l=t.getListFactory(s);for(let d=0;d<e._indexes.length;d++)o.set(e._indexes[d],1);for(let d=1;d<=r;++d)o.get(d)===0&&n.get(d)===0&&a.push(d);return l(a.sliceAndReset())}function By(t,e,s){const i=t.getListFactory(e.isNode),n=new Uint32Array(e._indexes.length+s._indexes.length);return n.set(e._indexes),n.set(s._indexes,e._indexes.length),i(n)}function Uy(t,e){return t.getObjectList(e.isNode).getMultiple(e._indexes)}function Ad(t,e){const s=t.getStorage(e.isNode);if(e.isList){const i=new Array(e.size);for(let n=0;n<e._indexes.length;++n)i[n]=s.getId(e._indexes[n]);return i}return s.getId(e._index)}function Gy(t,e){return t.topology.getExtremity(!0,e)}function Vy(t,e){return t.topology.getExtremity(!1,e)}function qy(t,e,s){return t.getObjectList(e.isNode).get(e._indexes[s])}function jy(t,e,s){const i=t.getListFactory(e.isNode),n=t.getObjectList(e.isNode),r=e._indexes.slice();return r.sort((o,a)=>{const l=n.get(o),d=n.get(a);return s(l,d)}),i(r)}var VS=[];function Yy(t){typeof t=="object"&&t!==null||(t={});const e=typeof t.data=="function"?t.data:qs;return{attributes:Array.isArray(t.attributes)?t.attributes:t.attributes||VS,data:e}}function Ed(t,e){for(const s of t){const i=e;Object.keys(i).forEach(n=>{const r=i[n];s.prototype[n]=function(o,a){return Vi(`Deprecated method "${n}"; please use "${r}" instead.`),this[r](o,a)}})}}function Vg(t){const e=t.getFlexArray("removed"),s=t.getFlexArray("excluded"),i=t.getFlexArray("virtual");return{all:n=>e.get(n)===0,visible:n=>s.get(n)===0,excluded:n=>s.get(n)===1,raw:n=>i.get(n)===0&&e.get(n)===0,_all:n=>!0}}function qg(t,e,s){return{all:fa(s.all,t,e),visible:fa(s.visible,t,e),raw:fa(s.raw,t,e),_all:fa(s._all,t,e)}}function fa(t,e,s){let i=null;return{getList(){if(!i){const n=e(),r=s();r.reset();for(let o=1;o<=n;++o)t(o)&&r.push(o);i=r.sliceAndReset()}return i},invalidList(){i=null}}}function qS(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`${t} is not a valid id, expected string or number`);return t}var jg=new Uint32Array(1),Yi=class{constructor(t,e){this.size=1,this.isNode=!1,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return jg[0]=this._index,jg}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}hasParallelEdges(){return this._ogma.modules.graph.hasParallelEdges(this)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.filter(s=>s!==this).dedupe()}}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.modules.graph.edgeList(new Uint32Array([this._index]))}getId(){return Ad(this._ogma.modules.graph,this)}getSource(){return Gy(this._ogma.modules.graph,this)}getTarget(){return Vy(this._ogma.modules.graph,this)}getExtremities(){return this._ogma.modules.graph.nodeList(new Uint32Array([this.getSource()._index,this.getTarget()._index]))}setSource(t){this._ogma.modules.graph.setSource(this,t)}setTarget(t){this._ogma.modules.graph.setTarget(this,t)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Yy(t);return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(e),data:s(be(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdge(this)}getSubEdges(){return this._ogma.modules.transformations.getSubEdges(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};Ed([Yi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var Mn=class{constructor(t,e){this.isList=!0,this.isNode=!1,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.subtract(this).dedupe()}}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map(t=>this._ogma.modules.transformations.isElementVirtual(t))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Uy(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.edgeList(this._indexes.slice())}getId(){return Ad(this._ogma.modules.graph,this)}getSource(){return Gy(this._ogma.modules.graph,this)}getTarget(){return Vy(this._ogma.modules.graph,this)}getExtremities(){return this.getSource().concat(this.getTarget())}get(t){return qy(this._ogma.modules.graph,this,t)}forEach(t){Ly(this._ogma.modules.graph,this,t)}map(t){return Cy(this._ogma.modules.graph,this,t)}find(t){return Fy(this._ogma.modules.graph,this,t)}some(t){return Ry(this._ogma.modules.graph,this,t)}every(t){return My(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return Ny(this._ogma.modules.graph,this,t)}reduce(t,e){return zy(this._ogma.modules.graph,this,t,e)}concat(t){return By(this._ogma.modules.graph,this,t)}dedupe(){return Dy(this._ogma.modules.graph,this)}subtract(t){return Oy(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.edgeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof Yi?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}sort(t){return jy(this._ogma.modules.graph,this,t)}inverse(){return ky(this._ogma.modules.graph,this)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!Ue(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdges(this)}getSubEdges(){return this.map(this._ogma.modules.transformations.getSubEdges)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};Ed([Mn],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var ei="geo.latitude",si="geo.longitude",Yg="geo.prevLat",Hd="geo.prevLng",Yh=85.0511287798,jS=6378137,Bl=1,YS='Map data &copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap contributors</a>',gn={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:22,minZoomLevel:0,wrapCoordinates:!0,tileUrlTemplate:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:void 0,backgroundColor:"silver",opacity:1,duration:0,disableNodeDragging:!0,tileBuffer:1,sizeRatio:1,tiles:{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",subdomains:"abc",tms:!1,wms:!1},crs:void 0},HS={maxBoundsViscosity:1,worldCopyJump:!0,zoomControl:!1,attributionControl:!1},XS=(()=>{let t=0;return typeof requestAnimationFrame<"u"?requestAnimationFrame:function(e){const s=Date.now(),i=Math.min(16,Math.max(0,16-(s-t))),n=t=s+i;return setTimeout(()=>e(n),i)}})(),Hy=50,$S=typeof cancelAnimationFrame<"u"?cancelAnimationFrame:function(t){return clearTimeout(t)};function mc(t,e){return XS(s=>{t.call(e,s)})}function Xy(t){t&&$S(t)}var Xd,Cn,fc,$y,WS={},Wy=WS,_l={},Zy={},Hh=t=>null;if(typeof global=="object"&&(_l=global),typeof window=="object"&&(Zy=window),typeof module=="object"&&typeof module.require=="function"){const t=module.require.bind(module);Hh=e=>{try{return t(e)}catch{return null}}}else typeof _l.require=="function"&&(Hh=t=>{const e=_l.require;try{return e(t)}catch{return null}});function Ts(t,{throwOnError:e}={}){let s=null;if(!s&&t&&(s=Wy[t]),!s&&t&&(s=Hh(t)),!s&&t&&(s=Zy[t]),!s&&t&&(s=_l[t]),!s&&e){const i=[`unable to find module "${t}"; make sure one of these statements is true:`,`- Ogma.libraries['${t}'] is set to the right library`,`- require('${t}') returns the right library`,`- window['${t}'] is set to the right library`].join(`
`);throw new Error(i)}return s}var Ky=class Kr{constructor(){this.method=null,this.url=null,this.status=0,this.readyState=0,this.headers={},this.responseText=null,this.response=null,Kr.onCreate&&Kr.onCreate(this)}open(e,s){this.method=e,this.url=s,Kr.onSend&&Kr.onSend(this)}respond(e,s,i){this.readyState=4,this.status=e,this.headers=s,this.responseText=i,this.response=i,this.onreadystatechange()}send(){this.readyState=4}static{this.onCreate=Xt}static{this.onSend=Xt}},Qy=class Qr{constructor(){this.onload=Xt,Qr.onCreate&&Qr.onCreate(this)}static{this.onCreate=Xt}static{this.onRead=Xt}readAsDataURL(e){this._blob=e,Qr.onRead&&Qr.onRead(this)}load(e){this.result=typeof e=="function"?e(this._blob):e,this.onload&&this.onload()}};function Ai(){return Cn||{createElementNS:()=>null,createElement:()=>null,implementation:{createDocument(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}Xd=Ts("@xmldom/xmldom"),Cn=vi?document:Xd?new Xd.DOMImplementation().createDocument():null,fc=typeof XMLHttpRequest<"u"?XMLHttpRequest:Ky,$y=typeof FileReader<"u"?FileReader:Qy;var ZS=class{observe(){}unobserve(){}disconnect(){}},KS=typeof ResizeObserver>"u"?ZS:ResizeObserver,Jy=t=>new KS(t);function tx(t,e){if(document&&document.defaultView){let s=t.style[e];if((!s||s==="auto")&&Ai().defaultView){const i=document.defaultView.getComputedStyle(t,null);s=i?i[e]:null}return s==="auto"?null:s?s.toString():null}return null}var ex=class{constructor(){this.onmousewheel=Xt,this.__dummy=!0,this.style={},this.clientWidth=0,this.clientHeight=0,this.childNodes=[],this.style={width:"0px",height:"0px",top:void 0,left:void 0,position:"",backgroundColor:void 0}}get offsetWidth(){return parseFloat(this.style.width||"0")}get offsetHeight(){return parseFloat(this.style.height||"0")}get firstChild(){return null}get parentNode(){return null}get classList(){return{length:0,value:"",add(){},remove(){},contains:t=>!1,item:null}}get innerHTML(){return""}set innerHTML(t){}appendChild(t){return this.childNodes.push(t),t}removeChild(){}addEventListener(){}removeEventListener(){}insertBefore(){}contains(t){return!1}};function Ul(){return new ex}var gs=ji?()=>window.devicePixelRatio:()=>1;function sx(t){const e=";base64,";let s,i,n;if(t.indexOf(e)===-1)return s=t.split(","),i=s[0].split(":")[1],n=decodeURIComponent(s[1]),Ro(n,i);s=t.split(e),i=s[0].split(":")[1],n=window.atob(s[1]);const r=n.length,o=new Uint8Array(r);for(let a=0;a<r;++a)o[a]=n.charCodeAt(a);return Ro([o],i)}var ix=class{constructor(t,e){this.data=t,this.type=e}};function Ro(t,e){return typeof Blob<"u"?new Blob(t,{type:e}):new ix(t,e)}function QS(t){return typeof Blob<"u"&&t instanceof Blob||t instanceof ix}function JS(t,e,s="text/plain"){return e==="blob"?t:e==="dataURL"?sx(t):Ro([t],s||"text/xml")}function Qi(t,e,s="text",i="text/plain"){if(!xd)return t;let n=null,r=null,o=null;window.Blob?(n=JS(t,s,i),r=URL.createObjectURL(n)):o="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(t);const a=document.createElement("a");return Ty(a,r||o||""),a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a),r&&setTimeout(()=>window.URL.revokeObjectURL(r),0),t}function Gl(t,e,s,i=gs()){if(Nn(t,e+"px",s+"px"),t.tagName==="IMG"||t.tagName==="CANVAS"){const n=t;n.width=e*i,n.height=s*i}}function pc(t,e){ni(e,(s,i)=>{s!==void 0&&t.setAttribute(i,s)})}var _c="http://www.w3.org/2000/svg",Xh="http://www.w3.org/2000/xmlns/",nx="http://www.w3.org/1999/xlink",tw=1;function se(t,e){const s=Cn.createElementNS(_c,t);return s.style||(s.style={}),e&&pc(s,e),s}function $h(t){const e=Cn.createElement("div");if(e.innerHTML=t.trim().replace(/\s+/g," "),!e.firstChild||e.firstChild.nodeType!==tw)throw new Error(`Failed to create element from: "${t}". Expected an HTML string`);return e.firstChild}function yc(t){if(Cn)return Cn.createTextNode(t)}function rx(t){return typeof Image>"u"?Promise.resolve(null):new Promise(e=>{const s=new Image;s.src=t,s.onload=()=>e(s),s.onerror=()=>e(null)})}function ox(t){if(t.indexOf("http://")===0||t.indexOf("https://")===0)return t;const e=window.location.origin;if(window.location.protocol==="blob:")return t;const s=window.location.pathname,i=s.lastIndexOf("/");return i===-1?e+"/"+t:e+s.substring(0,i)+"/"+t}function Lr(t){return new Promise((e,s)=>{const i=new fc;i.open("GET",ox(t),!0),i.onreadystatechange=function(){if(i.readyState===4){const n=i.status;n===200?e(i.responseText):s(n!==0?new Error(`cannot retrieve file at url "${t}"; the server responded with status code ${n}.`):new Error(`cannot send XMLHttpRequest to url "${t}"; if you're using the local file protocol this is most likely the cause.`))}},i.onerror=function(){s(new Error(`cannot retrieve file at url "${t}"; the XMLHttpRequest failed.`))},i.send()})}function ax(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function Vl(t,e){t.style.cursor=e,t.style.cursor!==e&&(t.style.cursor=`-webkit-${e}`)}function lx(t){return new Promise((e,s)=>{const i=new fc;i.responseType="blob",i.open("GET",ox(t),!0),i.onreadystatechange=()=>{if(i.readyState===4){if(i.status===200)return e(i.response);s(i.status)}},i.onerror=n=>s(n),i.send()})}function dx(t){return lx(t).then(e=>new Promise((s,i)=>{const n=new $y;n.onerror=i,n.onload=()=>s(n.result),n.readAsDataURL(e)}))}function Kn(t,e=!0){const s=e?"&#13;":`
`;return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,s).replace(/[\r\n]/g,s)}var xc={0:"left",1:"middle",2:"right"};function hx(t){if(t.baseURI)return t.baseURI;const e=t.getElementsByTagName("base");return e.length>0?e[0].href:t.URL||(t.location?t.location.href:"")}function ux(t,e,s,i){return new Promise(n=>{let r=e;const o=Date.now(),a=(s-e)*Math.min(1,1/(i/16));(function l(){Date.now()-o<i?(r=Math.min(1,Math.max(0,r+a)),t.style.opacity=r.toString(),mc(l)):n()})()})}function Nn(t,e,s){t.style.width=e,t.style.height=s}var bc=new vS().allowClassAttributes().allowDataAttributes().allowIdAttributes().allowStyleAttributes().build();function Bi(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Is(t,e,s){return Math.max(e,Math.min(s,t))}function Wh(t,e,s){return t+(e-t)*s}function ne(t,e,s){return t*(1-s)+e*s}function Qn(t){if(!t.length)return-1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n>e&&(e=n)}return e}function mi(t){if(!t.length)return 1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n<e&&(e=n)}return e}var cx=(t,e)=>Math.log(t)/Math.log(e),ql=t=>t<-Math.PI?t+2*Math.PI:t>Math.PI?t-2*Math.PI:t,ew=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let s=0;for(let i=0;i<this._n&&i<32;i++){const n=e[i],r=t+n,o=Math.abs(t)<Math.abs(n)?t-(r-n):n-(r-t);o&&(e[s++]=o),t=r}return e[s]=t,this._n=s+1,this}valueOf(){const t=this._partials;let e,s,i,n=this._n,r=0;if(n>0){for(r=t[--n];n>0&&(e=r,s=t[--n],r=e+s,i=s-(r-e),!i););n>0&&(i<0&&t[n-1]<0||i>0&&t[n-1]>0)&&(s=2*i,e=r+s,s==e-r&&(r=e))}return r}};function*sw(t){for(const e of t)yield*e}function gx(t){return Array.from(sw(t))}var ue=1e-6,ee=Math.PI,Ss=ee/2,Hg=ee/4,js=2*ee,di=180/ee,ms=ee/180,we=Math.abs,iw=Math.atan,mr=Math.atan2,xe=Math.cos,pe=Math.sin,nw=Math.sign||function(t){return t>0?1:t<0?-1:0},Wo=Math.sqrt;function mx(t){return t>1?0:t<-1?ee:Math.acos(t)}function fr(t){return t>1?Ss:t<-1?-Ss:Math.asin(t)}function Jr(){}function jl(t,e){t&&$g.hasOwnProperty(t.type)&&$g[t.type](t,e)}var Xg={Feature:function(t,e){jl(t.geometry,e)},FeatureCollection:function(t,e){for(var s=t.features,i=-1,n=s.length;++i<n;)jl(s[i].geometry,e)}},$g={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)t=s[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){Zh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)Zh(s[i],e,0)},Polygon:function(t,e){Wg(t.coordinates,e)},MultiPolygon:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)Wg(s[i],e)},GeometryCollection:function(t,e){for(var s=t.geometries,i=-1,n=s.length;++i<n;)jl(s[i],e)}};function Zh(t,e,s){var i,n=-1,r=t.length-s;for(e.lineStart();++n<r;)i=t[n],e.point(i[0],i[1],i[2]);e.lineEnd()}function Wg(t,e){var s=-1,i=t.length;for(e.polygonStart();++s<i;)Zh(t[s],e,1);e.polygonEnd()}function rw(t,e){t&&Xg.hasOwnProperty(t.type)?Xg[t.type](t,e):jl(t,e)}function Kh(t){return[mr(t[1],t[0]),fr(t[2])]}function pr(t){var e=t[0],s=t[1],i=xe(s);return[i*xe(e),i*pe(e),pe(s)]}function pa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Yl(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function $d(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function _a(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Qh(t){var e=Wo(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Jh(t,e){function s(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(s.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),s}function tu(t,e){return we(t)>ee&&(t-=Math.round(t/js)*js),[t,e]}function ow(t,e,s){return(t%=js)?e||s?Jh(Kg(t),Qg(e,s)):Kg(t):e||s?Qg(e,s):tu}function Zg(t){return function(e,s){return we(e+=t)>ee&&(e-=Math.round(e/js)*js),[e,s]}}function Kg(t){var e=Zg(t);return e.invert=Zg(-t),e}function Qg(t,e){var s=xe(t),i=pe(t),n=xe(e),r=pe(e);function o(a,l){var d=xe(l),h=xe(a)*d,u=pe(a)*d,c=pe(l),g=c*s+h*i;return[mr(u*n-g*r,h*s-c*i),fr(g*n+u*r)]}return o.invert=function(a,l){var d=xe(l),h=xe(a)*d,u=pe(a)*d,c=pe(l),g=c*n-u*r;return[mr(u*n+c*r,h*s+g*i),fr(g*s-h*i)]},o}function aw(t,e,s,i,n,r){if(s){var o=xe(e),a=pe(e),l=i*s;n==null?(n=e+i*js,r=e-l/2):(n=Jg(o,n),r=Jg(o,r),(i>0?n<r:n>r)&&(n+=i*js));for(var d,h=n;i>0?h>r:h<r;h-=l)d=Kh([o,-a*xe(h),-a*pe(h)]),t.point(d[0],d[1])}}function Jg(t,e){(e=pr(e))[0]-=t,Qh(e);var s=mx(-e[1]);return((-e[2]<0?-s:s)+js-ue)%js}function fx(){var t,e=[];return{point:function(s,i,n){t.push([s,i,n])},lineStart:function(){e.push(t=[])},lineEnd:Jr,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var s=e;return e=[],t=null,s}}}function yl(t,e){return we(t[0]-e[0])<ue&&we(t[1]-e[1])<ue}function ya(t,e,s,i){this.x=t,this.z=e,this.o=s,this.e=i,this.v=!1,this.n=this.p=null}function px(t,e,s,i,n){var r,o,a=[],l=[];if(t.forEach(function(m){if(!((f=m.length-1)<=0)){var f,p,_=m[0],y=m[f];if(yl(_,y)){if(!_[2]&&!y[2]){for(n.lineStart(),r=0;r<f;++r)n.point((_=m[r])[0],_[1]);return void n.lineEnd()}y[0]+=2*ue}a.push(p=new ya(_,m,null,!0)),l.push(p.o=new ya(_,null,p,!1)),a.push(p=new ya(y,m,null,!1)),l.push(p.o=new ya(y,null,p,!0))}}),a.length){for(l.sort(e),tm(a),tm(l),r=0,o=l.length;r<o;++r)l[r].e=s=!s;for(var d,h,u=a[0];;){for(var c=u,g=!0;c.v;)if((c=c.n)===u)return;d=c.z,n.lineStart();do{if(c.v=c.o.v=!0,c.e){if(g)for(r=0,o=d.length;r<o;++r)n.point((h=d[r])[0],h[1]);else i(c.x,c.n.x,1,n);c=c.n}else{if(g)for(d=c.p.z,r=d.length-1;r>=0;--r)n.point((h=d[r])[0],h[1]);else i(c.x,c.p.x,-1,n);c=c.p}d=(c=c.o).z,g=!g}while(!c.v);n.lineEnd()}}}function tm(t){if(e=t.length){for(var e,s,i=0,n=t[0];++i<e;)n.n=s=t[i],s.p=n,n=s;n.n=s=t[0],s.p=n}}function Wd(t){return we(t[0])<=ee?t[0]:nw(t[0])*((we(t[0])+ee)%js-ee)}function lw(t,e){var s=Wd(e),i=e[1],n=pe(i),r=[pe(s),-xe(s),0],o=0,a=0,l=new ew;n===1?i=Ss+ue:n===-1&&(i=-Ss-ue);for(var d=0,h=t.length;d<h;++d)if(c=(u=t[d]).length)for(var u,c,g=u[c-1],m=Wd(g),f=g[1]/2+Hg,p=pe(f),_=xe(f),y=0;y<c;++y,m=b,p=A,_=E,g=x){var x=u[y],b=Wd(x),v=x[1]/2+Hg,A=pe(v),E=xe(v),S=b-m,w=S>=0?1:-1,T=w*S,L=T>ee,R=p*A;if(l.add(mr(R*w*pe(T),_*E+R*xe(T))),o+=L?S+w*js:S,L^m>=s^b>=s){var k=Yl(pr(g),pr(x));Qh(k);var j=Yl(r,k);Qh(j);var z=(L^S>=0?-1:1)*fr(j[2]);(i>z||i===z&&(k[0]||k[1]))&&(a+=L^S>=0?1:-1)}}return(o<-ue||o<ue&&l<-1e-12)^1&a}function _x(t,e,s,i){return function(n){var r,o,a,l=e(n),d=fx(),h=e(d),u=!1,c={point:g,lineStart:f,lineEnd:p,polygonStart:function(){c.point=_,c.lineStart=y,c.lineEnd=x,o=[],r=[]},polygonEnd:function(){c.point=g,c.lineStart=f,c.lineEnd=p,o=gx(o);var b=lw(r,i);o.length?(u||(n.polygonStart(),u=!0),px(o,hw,b,s,n)):b&&(u||(n.polygonStart(),u=!0),n.lineStart(),s(null,null,1,n),n.lineEnd()),u&&(n.polygonEnd(),u=!1),o=r=null},sphere:function(){n.polygonStart(),n.lineStart(),s(null,null,1,n),n.lineEnd(),n.polygonEnd()}};function g(b,v){t(b,v)&&n.point(b,v)}function m(b,v){l.point(b,v)}function f(){c.point=m,l.lineStart()}function p(){c.point=g,l.lineEnd()}function _(b,v){a.push([b,v]),h.point(b,v)}function y(){h.lineStart(),a=[]}function x(){_(a[0][0],a[0][1]),h.lineEnd();var b,v,A,E,S=h.clean(),w=d.result(),T=w.length;if(a.pop(),r.push(a),a=null,T)if(1&S){if((v=(A=w[0]).length-1)>0){for(u||(n.polygonStart(),u=!0),n.lineStart(),b=0;b<v;++b)n.point((E=A[b])[0],E[1]);n.lineEnd()}}else T>1&&2&S&&w.push(w.pop().concat(w.shift())),o.push(w.filter(dw))}return c}}function dw(t){return t.length>1}function hw(t,e){return((t=t.x)[0]<0?t[1]-Ss-ue:Ss-t[1])-((e=e.x)[0]<0?e[1]-Ss-ue:Ss-e[1])}tu.invert=tu;var em=_x(function(){return!0},uw,gw,[-ee,-Ss]);function uw(t){var e,s=NaN,i=NaN,n=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(r,o){var a=r>0?ee:-ee,l=we(r-s);we(l-ee)<ue?(t.point(s,i=(i+o)/2>0?Ss:-Ss),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(r,i),e=0):n!==a&&l>=ee&&(we(s-n)<ue&&(s-=n*ue),we(r-a)<ue&&(r-=a*ue),i=cw(s,i,r,o),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),e=0),t.point(s=r,i=o),n=a},lineEnd:function(){t.lineEnd(),s=i=NaN},clean:function(){return 2-e}}}function cw(t,e,s,i){var n,r,o=pe(t-s);return we(o)>ue?iw((pe(e)*(r=xe(i))*pe(s)-pe(i)*(n=xe(e))*pe(t))/(n*r*o)):(e+i)/2}function gw(t,e,s,i){var n;if(t==null)n=s*Ss,i.point(-ee,n),i.point(0,n),i.point(ee,n),i.point(ee,0),i.point(ee,-n),i.point(0,-n),i.point(-ee,-n),i.point(-ee,0),i.point(-ee,n);else if(we(t[0]-e[0])>ue){var r=t[0]<e[0]?ee:-ee;n=s*r/2,i.point(-r,n),i.point(0,n),i.point(r,n)}else i.point(e[0],e[1])}function mw(t){var e=xe(t),s=2*ms,i=e>0,n=we(e)>ue;function r(l,d){return xe(l)*xe(d)>e}function o(l,d,h){var u=[1,0,0],c=Yl(pr(l),pr(d)),g=pa(c,c),m=c[0],f=g-m*m;if(!f)return!h&&l;var p=e*g/f,_=-e*m/f,y=Yl(u,c),x=_a(u,p);$d(x,_a(c,_));var b=y,v=pa(x,b),A=pa(b,b),E=v*v-A*(pa(x,x)-1);if(!(E<0)){var S=Wo(E),w=_a(b,(-v-S)/A);if($d(w,x),w=Kh(w),!h)return w;var T,L=l[0],R=d[0],k=l[1],j=d[1];R<L&&(T=L,L=R,R=T);var z=R-L,q=we(z-ee)<ue;if(!q&&j<k&&(T=k,k=j,j=T),q||z<ue?q?k+j>0^w[1]<(we(w[0]-L)<ue?k:j):k<=w[1]&&w[1]<=j:z>ee^(L<=w[0]&&w[0]<=R)){var B=_a(b,(-v+S)/A);return $d(B,x),[w,Kh(B)]}}}function a(l,d){var h=i?t:ee-t,u=0;return l<-h?u|=1:l>h&&(u|=2),d<-h?u|=4:d>h&&(u|=8),u}return _x(r,function(d){var h,u,c,g,m;return{lineStart:function(){g=c=!1,m=1},point:function(f,p){var _,y=[f,p],x=r(f,p),b=i?x?0:a(f,p):x?a(f+(f<0?ee:-ee),p):0;if(!h&&(g=c=x)&&d.lineStart(),x!==c&&(!(_=o(h,y))||yl(h,_)||yl(y,_))&&(y[2]=1),x!==c)m=0,x?(d.lineStart(),_=o(y,h),d.point(_[0],_[1])):(_=o(h,y),d.point(_[0],_[1],2),d.lineEnd()),h=_;else if(n&&h&&i^x){var v;b&u||!(v=o(y,h,!0))||(m=0,i?(d.lineStart(),d.point(v[0][0],v[0][1]),d.point(v[1][0],v[1][1]),d.lineEnd()):(d.point(v[1][0],v[1][1]),d.lineEnd(),d.lineStart(),d.point(v[0][0],v[0][1],3)))}!x||h&&yl(h,y)||d.point(y[0],y[1]),h=y,c=x,u=b},lineEnd:function(){c&&d.lineEnd(),h=null},clean:function(){return m|(g&&c)<<1}}},function(d,h,u,c){aw(c,t,s,u,d,h)},i?[0,-t]:[-ee,t-ee])}function fw(t,e,s,i,n,r){var o,a=t[0],l=t[1],d=0,h=1,u=e[0]-a,c=e[1]-l;if(o=s-a,u||!(o>0)){if(o/=u,u<0){if(o<d)return;o<h&&(h=o)}else if(u>0){if(o>h)return;o>d&&(d=o)}if(o=n-a,u||!(o<0)){if(o/=u,u<0){if(o>h)return;o>d&&(d=o)}else if(u>0){if(o<d)return;o<h&&(h=o)}if(o=i-l,c||!(o>0)){if(o/=c,c<0){if(o<d)return;o<h&&(h=o)}else if(c>0){if(o>h)return;o>d&&(d=o)}if(o=r-l,c||!(o<0)){if(o/=c,c<0){if(o>h)return;o>d&&(d=o)}else if(c>0){if(o<d)return;o<h&&(h=o)}return d>0&&(t[0]=a+d*u,t[1]=l+d*c),h<1&&(e[0]=a+h*u,e[1]=l+h*c),!0}}}}}var to=1e9,xa=-to;function pw(t,e,s,i){function n(d,h){return t<=d&&d<=s&&e<=h&&h<=i}function r(d,h,u,c){var g=0,m=0;if(d==null||(g=o(d,u))!==(m=o(h,u))||l(d,h)<0^u>0)do c.point(g===0||g===3?t:s,g>1?i:e);while((g=(g+u+4)%4)!==m);else c.point(h[0],h[1])}function o(d,h){return we(d[0]-t)<ue?h>0?0:3:we(d[0]-s)<ue?h>0?2:1:we(d[1]-e)<ue?h>0?1:0:h>0?3:2}function a(d,h){return l(d.x,h.x)}function l(d,h){var u=o(d,1),c=o(h,1);return u!==c?u-c:u===0?h[1]-d[1]:u===1?d[0]-h[0]:u===2?d[1]-h[1]:h[0]-d[0]}return function(d){var h,u,c,g,m,f,p,_,y,x,b,v=d,A=fx(),E={point:S,lineStart:function(){E.point=w,u&&u.push(c=[]),x=!0,y=!1,p=_=NaN},lineEnd:function(){h&&(w(g,m),f&&y&&A.rejoin(),h.push(A.result())),E.point=S,y&&v.lineEnd()},polygonStart:function(){v=A,h=[],u=[],b=!0},polygonEnd:function(){var L=function(){for(var z=0,q=0,B=u.length;q<B;++q)for(var W,Z,it=u[q],dt=1,At=it.length,gt=it[0],ct=gt[0],yt=gt[1];dt<At;++dt)W=ct,Z=yt,ct=(gt=it[dt])[0],yt=gt[1],Z<=i?yt>i&&(ct-W)*(i-Z)>(yt-Z)*(t-W)&&++z:yt<=i&&(ct-W)*(i-Z)<(yt-Z)*(t-W)&&--z;return z}(),R=b&&L,k=(h=gx(h)).length;(R||k)&&(d.polygonStart(),R&&(d.lineStart(),r(null,null,1,d),d.lineEnd()),k&&px(h,a,L,r,d),d.polygonEnd()),v=d,h=u=c=null}};function S(T,L){n(T,L)&&v.point(T,L)}function w(T,L){var R=n(T,L);if(u&&c.push([T,L]),x)g=T,m=L,f=R,x=!1,R&&(v.lineStart(),v.point(T,L));else if(R&&y)v.point(T,L);else{var k=[p=Math.max(xa,Math.min(to,p)),_=Math.max(xa,Math.min(to,_))],j=[T=Math.max(xa,Math.min(to,T)),L=Math.max(xa,Math.min(to,L))];fw(k,j,t,e,s,i)?(y||(v.lineStart(),v.point(k[0],k[1])),v.point(j[0],j[1]),R||v.lineEnd(),b=!1):R&&(v.lineStart(),v.point(T,L),b=!1)}p=T,_=L,y=R}return E}}var sm=t=>t,_r=1/0,Hl=_r,Fo=-_r,Xl=Fo,_w={point:yw,lineStart:Jr,lineEnd:Jr,polygonStart:Jr,polygonEnd:Jr,result:function(){var t=[[_r,Hl],[Fo,Xl]];return Fo=Xl=-(Hl=_r=1/0),t}};function yw(t,e){t<_r&&(_r=t),t>Fo&&(Fo=t),e<Hl&&(Hl=e),e>Xl&&(Xl=e)}var im=_w;function vc(t){return function(e){var s=new eu;for(var i in t)s[i]=t[i];return s.stream=e,s}}function eu(){}function Ac(t,e,s){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),rw(s,t.stream(im)),e(im.result()),i!=null&&t.clipExtent(i),t}function yx(t,e,s){return Ac(t,function(i){var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(n/(i[1][0]-i[0][0]),r/(i[1][1]-i[0][1])),a=+e[0][0]+(n-o*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(r-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([a,l])},s)}function xw(t,e,s){return yx(t,[[0,0],e],s)}function bw(t,e,s){return Ac(t,function(i){var n=+e,r=n/(i[1][0]-i[0][0]),o=(n-r*(i[1][0]+i[0][0]))/2,a=-r*i[0][1];t.scale(150*r).translate([o,a])},s)}function vw(t,e,s){return Ac(t,function(i){var n=+e,r=n/(i[1][1]-i[0][1]),o=-r*i[0][0],a=(n-r*(i[1][1]+i[0][1]))/2;t.scale(150*r).translate([o,a])},s)}eu.prototype={constructor:eu,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var nm=16,Aw=xe(30*ms);function rm(t,e){return+e?Sw(t,e):Ew(t)}function Ew(t){return vc({point:function(e,s){e=t(e,s),this.stream.point(e[0],e[1])}})}function Sw(t,e){function s(i,n,r,o,a,l,d,h,u,c,g,m,f,p){var _=d-i,y=h-n,x=_*_+y*y;if(x>4*e&&f--){var b=o+c,v=a+g,A=l+m,E=Wo(b*b+v*v+A*A),S=fr(A/=E),w=we(we(A)-1)<ue||we(r-u)<ue?(r+u)/2:mr(v,b),T=t(w,S),L=T[0],R=T[1],k=L-i,j=R-n,z=y*k-_*j;(z*z/x>e||we((_*k+y*j)/x-.5)>.3||o*c+a*g+l*m<Aw)&&(s(i,n,r,o,a,l,L,R,w,b/=E,v/=E,A,f,p),p.point(L,R),s(L,R,w,b,v,A,d,h,u,c,g,m,f,p))}}return function(i){var n,r,o,a,l,d,h,u,c,g,m,f,p={point:_,lineStart:y,lineEnd:b,polygonStart:function(){i.polygonStart(),p.lineStart=v},polygonEnd:function(){i.polygonEnd(),p.lineStart=y}};function _(S,w){S=t(S,w),i.point(S[0],S[1])}function y(){u=NaN,p.point=x,i.lineStart()}function x(S,w){var T=pr([S,w]),L=t(S,w);s(u,c,h,g,m,f,u=L[0],c=L[1],h=S,g=T[0],m=T[1],f=T[2],nm,i),i.point(u,c)}function b(){p.point=_,i.lineEnd()}function v(){y(),p.point=A,p.lineEnd=E}function A(S,w){x(n=S,w),r=u,o=c,a=g,l=m,d=f,p.point=x}function E(){s(u,c,h,g,m,f,r,o,n,a,l,d,nm,i),p.lineEnd=b,b()}return p}}var ww=vc({point:function(t,e){this.stream.point(t*ms,e*ms)}});function Tw(t){return vc({point:function(e,s){var i=t(e,s);return this.stream.point(i[0],i[1])}})}function Iw(t,e,s,i,n){function r(o,a){return[e+t*(o*=i),s-t*(a*=n)]}return r.invert=function(o,a){return[(o-e)/t*i,(s-a)/t*n]},r}function om(t,e,s,i,n,r){if(!r)return Iw(t,e,s,i,n);var o=xe(r),a=pe(r),l=o*t,d=a*t,h=o/t,u=a/t,c=(a*s-o*e)/t,g=(a*e+o*s)/t;function m(f,p){return[l*(f*=i)-d*(p*=n)+e,s-d*f-l*p]}return m.invert=function(f,p){return[i*(h*f-u*p+c),n*(g-u*f-h*p)]},m}function Lw(t){return Cw(function(){return t})()}function Cw(t){var e,s,i,n,r,o,a,l,d,h,u=150,c=480,g=250,m=0,f=0,p=0,_=0,y=0,x=0,b=1,v=1,A=null,E=em,S=null,w=sm,T=.5;function L(z){return l(z[0]*ms,z[1]*ms)}function R(z){return(z=l.invert(z[0],z[1]))&&[z[0]*di,z[1]*di]}function k(){var z=om(u,0,0,b,v,x).apply(null,e(m,f)),q=om(u,c-z[0],g-z[1],b,v,x);return s=ow(p,_,y),a=Jh(e,q),l=Jh(s,a),o=rm(a,T),j()}function j(){return d=h=null,L}return L.stream=function(z){return d&&h===z?d:d=ww(Tw(s)(E(o(w(h=z)))))},L.preclip=function(z){return arguments.length?(E=z,A=void 0,j()):E},L.postclip=function(z){return arguments.length?(w=z,S=i=n=r=null,j()):w},L.clipAngle=function(z){return arguments.length?(E=+z?mw(A=z*ms):(A=null,em),j()):A*di},L.clipExtent=function(z){return arguments.length?(w=z==null?(S=i=n=r=null,sm):pw(S=+z[0][0],i=+z[0][1],n=+z[1][0],r=+z[1][1]),j()):S==null?null:[[S,i],[n,r]]},L.scale=function(z){return arguments.length?(u=+z,k()):u},L.translate=function(z){return arguments.length?(c=+z[0],g=+z[1],k()):[c,g]},L.center=function(z){return arguments.length?(m=z[0]%360*ms,f=z[1]%360*ms,k()):[m*di,f*di]},L.rotate=function(z){return arguments.length?(p=z[0]%360*ms,_=z[1]%360*ms,y=z.length>2?z[2]%360*ms:0,k()):[p*di,_*di,y*di]},L.angle=function(z){return arguments.length?(x=z%360*ms,k()):x*di},L.reflectX=function(z){return arguments.length?(b=z?-1:1,k()):b<0},L.reflectY=function(z){return arguments.length?(v=z?-1:1,k()):v<0},L.precision=function(z){return arguments.length?(o=rm(a,T=z*z),j()):Wo(T)},L.fitExtent=function(z,q){return yx(L,z,q)},L.fitSize=function(z,q){return xw(L,z,q)},L.fitWidth=function(z,q){return bw(L,z,q)},L.fitHeight=function(z,q){return vw(L,z,q)},function(){return e=t.apply(this,arguments),L.invert=e.invert&&R,k()}}function Nw(t){return function(e,s){var i=xe(e),n=xe(s),r=t(i*n);return r===1/0?[2,0]:[r*n*pe(e),r*pe(s)]}}function Mw(t){return function(e,s){var i=Wo(e*e+s*s),n=t(i),r=pe(n),o=xe(n);return[mr(e*r,i*o),fr(i&&s*r/i)]}}var xx=Nw(function(t){return(t=mx(t))&&t/pe(t)});function Rw(){return Lw(xx).scale(79.4188).clipAngle(179.999)}function am(t,e){t&&e!==void 0&&isFinite(e)&&t.setOpacity&&t.setOpacity(e)}function lm(){return ji||typeof global<"u"&&!global.process}function Zd(t){return Math.log2(t)+Bl}function Fw(t){return 2**(t-Bl)}function dm(t){return t!=null&&!isNaN(t)}function bx(t,e){return Ax(t,e,"longitude")}function vx(t,e){return Ax(t,e,"latitude")}function Ax(t,e,s){if(isNaN(e))throw new TypeError(`node ${t}: ${e} is not a valid ${s}`)}xx.invert=Mw(function(t){return t});var Pw=t=>Math.pow(2,Math.ceil(Math.log2(t)));function zw(t,e){return e==null&&t.url===gn.tiles.url?YS:null}function Dw(t={},e){const{tileUrlSubdomains:s,tileUrlTemplate:i,attribution:n,attributionOptions:r,latitudePath:o,longitudePath:a,sizeRatio:l,tiles:d}=t;if(i!=null&&typeof i!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a URL string");if(s!=null&&typeof s!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a string");if(d!=null){if(!(Ne(d)||d instanceof e.Layer))throw new TypeError("Geo mode: tiles must be a object or L.Layer instance");const h=d;if(h.url!=null&&typeof h.url!="string")throw new TypeError("Geo mode: tiles.url must be a string");if(h.subdomains!=null&&typeof h.subdomains!="string")throw new TypeError("Geo mode: tiles.subdomains must be a string");if(h.tms&&typeof h.tms!="boolean")throw new TypeError("Geo mode: tiles.tms must be a boolean");if(h.wms&&typeof h.wms!="boolean")throw new TypeError("Geo mode: tiles.wms must be a boolean")}if(n!=null&&typeof n!="string")throw new TypeError("Geo mode: Map attribution must be a string");if(r!=null&&!Ne(r))throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object");if(o!=null&&typeof o!="string"&&!Array.isArray(o))throw new TypeError("Geo mode: Latitude path must be a valid property path: a string or an array of strings.");if(a!=null&&typeof a!="string"&&!Array.isArray(a))throw new TypeError("Geo mode: Longitude path must be a valid property path: a string or an array of strings.");if(l!=null&&(!isFinite(l)||l<=0))throw new TypeError("Geo mode: sizeRatio must be a positive number.")}function Ow(t,e={}){if(e.tiles===void 0||e.tileUrlTemplate||e.tileUrlSubdomains){const s=gn.tiles;return{...e.tiles||{},...gn.tiles,url:e.tileUrlTemplate||s.url,subdomains:e.tileUrlSubdomains||s.subdomains}}return Ne(e.tiles)?{...t.tiles,...e.tiles}:e.tiles}function kw(t,e){return t.attribution!==e.attribution||t.tiles!==e.tiles}var Bw=Ai().createElement("div");function Uw(t){const e=Ai().createElement("div");e.className="ogma-geo-container",Nn(e,"100%","100%");const s=t||Bw;return s.insertBefore(e,s.firstChild),e}function Gw(t){const e=[[1/0,1/0],[-1/0,-1/0]];return t.getGeoCoordinates().reduce((s,{latitude:i,longitude:n})=>{const[r,o]=s;return r[0]=Math.min(r[0],i),r[1]=Math.min(r[1],n),o[0]=Math.max(o[0],i),o[1]=Math.max(o[1],n),s},e)}function Vw(t,e,s,i){const n=e._indexes;t.getNodeAttribute(ei).setMultiple(n,s),t.getNodeAttribute(si).setMultiple(n,i)}function qw(t,e,s){const{longitudePath:i,latitudePath:n,wrapCoordinates:r}=s,[o,a]=t.getAttributes(!0,[ei,si]),l=e._indexes,d=e.getId(),h=l.length,u=e.getData(n),c=e.getData(i);for(let g=0;g<h;g++){let m=c[g],f=u[g];const p=l[g],_=d[g];f!=null&&m!=null&&(bx(_,m),vx(_,f),r&&(m%=180,f=Is(+f,-Yh,Yh)),a.set(p,m),o.set(p,f))}}function jw(t,{longitudePath:e,latitudePath:s,wrapCoordinates:i},n){const r=t.getData(e),o=t.getData(s);return r!=null&&o!=null&&(!(!i&&!n)||Math.abs(o)<=Yh&&Math.abs(r)<=180)}function ba(t,e,s,i){Yw(t,!0,e,s,i)}function Yw(t,e,s,i,n){const r=t.getAttribute(e,i),o=t.getAttribute(e,n),a=s._indexes;o.setMultiple(a,r.getMultiple(a))}function Hw(t){return t.reduce((e,{nodes:s,newValues:i})=>{if(!s)return e;const n=s.filter((r,o)=>i[o]!=null);return e?e.concat(n):n},null)}function Xw(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","radius"]).forEach(({text:s,radius:i},n)=>{e[t.get(n).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:s.minVisibleSize,size:Math.max(1,Number(i))}}),e}function hm(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","minVisibleSize","width"]).forEach(({text:s,minVisibleSize:i,width:n},r)=>{e[t.get(r).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:i,size:Math.max(1,Number(n))}}),e}function $w(t,e,s){if(!e||!Object.keys(e).length)return Promise.resolve();const i=t.getId().filter(n=>e[n]).map(n=>{if(!e[n])return 0;const r=Number(e[n]["text.minVisibleSize"]),o=Number(e[n].minVisibleSize),a=Number(e[n]["text.size"]),l=Number(e[n]["text.scale"]),d=Number(e[n].size)*l*s;return d<=o||d<=r?0:a});return t.setAttribute("text.size",i)}function Ww(t,e){const s=t.getId().map(i=>{const n=e[i]||{};return Number(n["text.size"])});return t.setAttribute("text.size",s)}var Zw=t=>Rw().rotate([-t.longitude,-t.latitude]).scale(jS),um=new Uint32Array(1),Vs=class{constructor(t,e){this.size=1,this.isNode=!0,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return um[0]=this._index,um}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this._ogma.modules.camera.graphToScreenCoordinates(this.getPosition())}isInScreen(){const t=this.getPositionOnScreen(),e=this._ogma.modules.camera;return t.x>=0&&t.x<=e.width&&t.y>=0&&t.y<=e.height}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)[0]}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}getConnectedComponent(t){return this._ogma.modules.graph.getConnectedComponentByNode(this,t)[0]}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.nodeList(new Uint32Array([+this._index]))}getId(){return Ad(this._ogma.modules.graph,this)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Yy(t),i=this.getAttributes(e);return{id:this.getId(),attributes:i,data:s(be(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getGeoCoordinates(){const t=this._ogma.modules.graph,e=t.getNodeAttribute(ei).get(this._index),s=t.getNodeAttribute(si).get(this._index);return{latitude:dm(e)?e:void 0,longitude:dm(s)?s:void 0}}setGeoCoordinates(t){return this.toList().setGeoCoordinates([t]).then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNode(this)}getSubNodes(){return this._ogma.modules.transformations.getSubNodes(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};Ed([Vs],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var Ei=class{constructor(t,e){this.isList=!0,this.isNode=!0,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this.getPosition().map(t=>this._ogma.modules.camera.graphToScreenCoordinates(t))}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)}getConnectedComponents(t){return this._ogma.modules.graph.getConnectedComponents(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map(t=>this._ogma.modules.transformations.isElementVirtual(t))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Uy(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.nodeList(this._indexes.slice())}getId(){return Ad(this._ogma.modules.graph,this)}get(t){return qy(this._ogma.modules.graph,this,t)}forEach(t){Ly(this._ogma.modules.graph,this,t)}find(t){return Fy(this._ogma.modules.graph,this,t)}some(t){return Ry(this._ogma.modules.graph,this,t)}every(t){return My(this._ogma.modules.graph,this,t)}map(t){return Cy(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return Ny(this._ogma.modules.graph,this,t)}reduce(t,e){return zy(this._ogma.modules.graph,this,t,e)}concat(t){return By(this._ogma.modules.graph,this,t)}dedupe(){return Dy(this._ogma.modules.graph,this)}subtract(t){return Oy(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.nodeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof Vs?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}inverse(){return ky(this._ogma.modules.graph,this)}sort(t){return jy(this._ogma.modules.graph,this,t)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!Ue(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getGeoCoordinates(){const t=this._ogma.modules.graph,e=new Array(this._indexes.length),s=t.getNodeAttribute(ei).getMultiple(this._indexes),i=t.getNodeAttribute(si).getMultiple(this._indexes);for(let n=0,r=this._indexes.length;n<r;n++)e[n]={latitude:s[n],longitude:i[n]};return e}setGeoCoordinates(t){const e=this._ogma.modules.geo,s=this.getId(),i=this._indexes,n=new Array(i.length),r=new Array(i.length);if(t===null&&(t=new Array(i.length).fill(null)),t.length!==i.length)throw new RangeError("You must provide coordinates for each node in the NodeList");for(let l=0,d=i.length;l<d;l++){let{latitude:h,longitude:u}=t[l]||{latitude:void 0,longitude:void 0};const c=s[l];h==null&&u==null?h=u=void 0:(vx(c,h),bx(c,u)),n[l]=h,r[l]=u}this.setData(e.latitudePath,n),this.setData(e.longitudePath,r);const{dom:o,graph:a}=this._ogma.modules;return Vw(a,this,n,r),this._ogma.modules.geo.isEnabled()?o.afterNextFrame().then(()=>o.afterNextFrame()).then(()=>this):o.afterNextFrame().then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNodes(this)}getSubNodes(){return this.map(this._ogma.modules.transformations.getSubNodes)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};function Kw(t,e,s,i,n){return Zo(t,e,s,!0,[i],n)}function Qw(t,e,s,i,n){return Zo(t,e,s,!1,[i],n)}function Jw(t,e,s,i,n){return Zo(t,e,s,!0,i,n)}function tT(t,e,s,i,n){return Zo(t,e,s,!1,i,n)}async function Zo(t,e,s,i,n,r={}){Array.isArray(n)||n instanceof(i?Ei:Mn)||(n=[n]);const{virtual:o=!1}=r;!o&&e.isRefreshing()&&await new Promise(m=>{s.once("idle",m)});const a={elementsToRemove:t.getElements(i,n)};t.fireEvent("requestElementsToDelete",a);let{elementsToRemove:l}=a;if(!l.size)return Promise.resolve();l=l.dedupe();const d=t.storage.fetch(i),h=d.getFlexArray("removed");if(l=l.filter(m=>h.get(m._index)===0),i){const m=l.getAdjacentEdges({filter:"all"});Zo(t,e,s,!1,m,r)}const u=l._indexes,c=t.getCacheLists(i),g={virtual:o,[i?"nodes":"edges"]:l};if(t.fireEvent(i?"beforeRemoveNodes":"beforeRemoveEdges",g),c.visible.invalidList(),c.all.invalidList(),c.raw.invalidList(),t.setExcluded(l,!0),h.setMultiple(u,1),!i)for(let m=0;m<u.length;++m)t.topology.removeFromAdjacencyList(u[m]);return d.removeElements(u),t.fireEvent(i?"removeNodes":"removeEdges",g),t.fireEvent(i?"afterRemoveNodes":"afterRemoveEdges",g),Promise.resolve()}Ed([Ei],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var eT=class{addNodes(t,e){return this.modules.graph.addNodes(t,e)}addEdges(t,e){return this.modules.graph.addEdges(t,e)}addNode(t,e){return this.modules.graph.addNode(t,e)}addEdge(t,e){return this.modules.graph.addEdge(t,e)}removeNodes(t,e){return Jw(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}removeEdges(t,e){return tT(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}removeNode(t,e){return Kw(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}removeEdge(t,e){return Qw(this.modules.graph,this.modules.transformations,this.modules.events,t,e)}getNodes(t){return this.modules.graph.getNodes(t)}getEdges(t){return this.modules.graph.getEdges(t)}getNode(t){return this.modules.graph.getNode(t)}getEdge(t){return this.modules.graph.getEdge(t)}clearGraph(){this.modules.graph.clear()}setGraph(t,e){return this.modules.graph.clear(),this.addGraph(t,e)}addGraph(t,e){const s=this.modules.graph.getNodes().size===0,i=this.modules.graph.addGraph(t,e);return s?this.modules.locate.locateGraph({padding:30,ignoreZoomLimits:!0,duration:0}).then(()=>i):i}createNodeList(){return this.getNodes([])}createEdgeList(){return this.getEdges([])}getConnectedComponents(t={}){return this.modules.graph.getConnectedComponents(this.getNodes(t.filter),t)}getConnectedComponentByNode(t,e){const s=this.modules.graph.getNode(t);if(s===void 0)throw new Error(`getComponentByNode: cannot find node ${t}`);return this.modules.graph.getConnectedComponentByNode(s,e)[0]}},Ec={};function Ex(t,e,s,i,n,r){let o=0;for(let a=0;a<i;a++)for(let l=0;l<i;l++){const d=r[a],h=r[l];if(d!==h){const u=t[d][h]*n,c=1/(u*u);if(c){const g=e[d]-e[h],m=s[d]-s[h];o+=c*Math.pow(u-Math.sqrt(g*g+m*m),2)}}}return o}function Sx(t,e,s,i,n,r,o){let a=0;if(n===-1)return 0;for(let l=0;l<i;l++)for(let d=0;d<i;d++){const h=o[l],u=o[d];if(h!==u&&(h===n||u===n)){const c=t[h][u]*r,g=1/(c*c);if(g){const m=e[h]-e[u],f=s[h]-s[u];a+=g*Math.pow(c-Math.sqrt(m*m+f*f),2)}}}return a}function su(t,e,s,i,n,r,o,a){o=o||0;let l=0,d=0;for(let h=0;h<i;h++)for(let u=0;u<i;u++){const c=a[h],g=a[u];if(c!==g){const m=t[c][g]*r,f=1/(m*m);if(f){const p=e[c]-e[g],_=s[c]-s[g],y=f*Math.pow(m-Math.sqrt(p*p+_*_),2);l+=y,c!==n&&g!==n||(d+=y)}}}return(1-o)*l+o*d}function iu(t,e,s,i,n,r,o,a,l){o=o||0;const d=e,h=s;(n=n===void 0?-1:n)===-1&&(o=0);const u=e[n],c=s[n];for(let g=0;g<i;g++){const m=a[g],f=l(t[n][g]),p=o/(f*f);if(f===0)continue;let _=0,y=0,x=0;const b=e[m],v=s[m];for(let E=0;E<i;E++){const S=a[E];if(S!==m){const w=t[m][S]*r,T=1/(w*w),L=e[S],R=s[S];if(T!==0){const k=b-L,j=v-R,z=k*k+j*j,q=z<1e-12?0:1/Math.sqrt(z);y+=(1-o)*T*(L+w*(b-L)*q),x+=(1-o)*T*(R+w*(v-R)*q)}_+=T}}const A=(1-o)*_+p;if(A!==0){const E=b-u,S=v-c;let w=E*E+S*S;w=w<1e-12?0:1/Math.sqrt(w);const T=f===0?0:p*(f*w);d[m]=(y+T*e[m])/A,h[m]=(x+T*s[m])/A}}return{x:d,y:h}}function sT(t,e,s,i,n,r,o,a){o=o||0;const l=e,d=s;let h;(n=n===void 0?-1:n)===-1&&(o=0);for(let u=0;u<i;u++){const c=a[u];let g=0,m=0,f=0;const p=e[c],_=s[c];for(let y=0;y<i;y++){const x=a[y];let b=0;if(x!==c){let v=0;const A=t[c][x]*r,E=1/(A*A);c!==n&&x!==n||(v=E);const S=(1-o)*E+o*v;if(g+=S,E!==0){const w=e[x],T=s[x],L=p-w,R=_-T,k=L*L+R*R;k>1e-6&&(b=1/Math.sqrt(k)),m+=S*(w+A*(p-w)*b),f+=S*(T+A*(_-T)*b)}}}h=g,h!==0&&(l[c]=m/h,d[c]=f/h)}return{x:l,y:d}}function Sd(t=(n,r)=>n-r,e=[],s={},i=n=>n){let n=e.length;function r(a){for(;;){const l=2*a+1,d=l+1;let h=a;if(l<n&&t(e[l],e[h])<0&&(h=l),d<n&&t(e[d],e[h])<0&&(h=d),h===a)return a;const u=e[h];e[h]=e[a],e[a]=u,s[i(e[h])]=h,s[i(u)]=a,a=h}}return{get keys(){return s},get size(){return n},heapify:r,pop(){if(n<=0)return;if(n===1)return n--,e[0];const a=e[0];return e[0]=e[n-1],n--,r(0),a},decreaseKey(a,l){for(l!==void 0&&(e[a]=l,s[i(l)]=a);a>0;){const d=a-1>>1;if(!(t(e[d],e[a])>0))break;{const h=e[a];e[a]=e[d],e[d]=h,s[i(e[a])]=a,s[i(h)]=d,a=d}}return a},min:()=>e[0],remove(a){return this.decreaseKey(a,Number.NEGATIVE_INFINITY),this.pop()},push(a){n++;let l=n-1;for(e[l]=a;l>0;){const d=l-1>>1;if(!(t(e[d],e[l])>0))break;{const h=e[l];e[l]=e[d],e[d]=h,s[i(e[l])]=l,s[i(h)]=d,l=d}}return l},empty:()=>n<=0,toArray:()=>e.slice(0,n)}}function Sc({sources:t,targets:e,weights:s,source:i,target:n,undirected:r=!1,indexes:o,N:a}){if(!(a=o?o.length:a)||!isFinite(a)||a===0)throw new Error("Invalid number of nodes "+a);const l=new Float32Array(a),d=new Int32Array(a),h={},u=Number.POSITIVE_INFINITY;if(!s){s=[];for(let f=0;f<a;f++)s[f]=1}if(!o){o=new Uint32Array(a);for(let f=0;f<a;f++)o[f]=f+1}for(let f=0;f<a;f++)l[f]=u,d[f]=-1,h[o[f]]=f;l[h[i]]=0;let c=!1;for(let f=1;f<=a;f++){for(let p=0;p<s.length;p++){const _=t[p],y=e[p],x=h[_],b=h[y];if(x!==void 0&&b!==void 0){const v=s[p];let A=l[x]+v;l[x]!==u&&A<l[b]&&(l[b]=A,d[b]=_,c=!0),r&&(A=l[b]+v,l[b]!==u&&A<l[x]&&(l[x]=A,d[x]=y,c=!0))}}if(!c)break}if(c)for(let f=0;f<s.length;f++){const p=t[f],_=e[f],y=h[p],x=h[_];if(y!==void 0&&x!==void 0){const b=s[f];if(l[y]+b<l[x])return null}}let g=null,m=null;if(n!==void 0){const f=h[n];if(f!==void 0&&l[f]!==u){g=[];for(let p=n;p!==-1;p=d[h[p]])g.push(p);g=g.reverse(),m=l[f]}}return{distances:l,path:g,pathLength:m}}function wc(t,e,s,i,n,r,o){i=i||t.map((p,_)=>_+1);const a=i.length,l=new Float32Array(a),d=new Int32Array(a),h=new Uint32Array(a),u=Number.POSITIVE_INFINITY,c={};if(a===0)return{distances:l,path:null,pathLength:null};if(!n){n={};for(let p=0;p<a;p++)n[i[p]]=p}for(let p=0;p<a;p++)l[p]=u,d[p]=-1,h[p]=c[p]=p;const g=Sd((p,_)=>l[p]-l[_],h,c);for(l[n[e]]=0,g.decreaseKey(c[n[e]]);g.size!==0;){const p=g.pop(),_=l[p],y=t[p];if(_===u)break;for(let x=0,b=y.nodes.length;x<b;x++){const v=y.nodes[x],A=r?1:o?o(i[p],v):y.weights?y.weights[x]:1,E=n[v];if(E===void 0)continue;const S=_+A;S<l[E]&&(l[E]=S,d[E]=p,g.decreaseKey(c[E]))}}let m=null,f=null;if(s!==void 0){const p=n[s];if(l[p]!==u){m=[];for(let _=p;_!==-1;_=d[_])m.push(i[_]);m.reverse(),f=l[s]}}return{distances:l,path:m,pathLength:f}}function nu({sources:t,targets:e,weights:s,indexes:i,adjacency:n,undirected:r,ignoreWeights:o}){const a=Number.POSITIVE_INFINITY,l=i?i.length:n.length;if(!i){i=new Uint32Array(l);for(let f=0;f<l;f++)i[f]=f+1}const d=new Array(l),h={};for(let f=0;f<l;f++){d[f]=new Float32Array(l);for(let p=0;p<l;p++)d[f][p]=f===p?0:a;h[i[f]]=f}const u=l,c=s.length;t=t.slice(),e=e.slice(),s=s.slice();for(let f=0;f<l;f++)t[c+f]=u,e[c+f]=i[f],s[c+f]=0,o&&(s[f]=1);const g=Sc({sources:t,targets:e,weights:s,undirected:r,N:l+1,source:u});if(g===null)throw new Error("Graph has negative weight loops");const m=g.distances;for(let f=0;f<s.length;f++){const p=h[t[f]],_=h[e[f]];p!==void 0&&_!==void 0&&(s[f]=s[f]+m[p]-m[_])}t=t.slice(0,c),e=e.slice(0,c),s=s.slice(0,c);for(let f=0;f<l;f++){const p=i[f],{distances:_}=wc(n,p,void 0,i,h,!!o);for(let y=0;y<l;y++)d[f][y]=f===y?0:_[y]}return d}Ho(Ec,{CyclesFinder:()=>qx,Quadtree:()=>Ox,bellmanFord:()=>Sc,betweenness:()=>Yx,circlePack:()=>Mx,circleSpread:()=>wT,constrainedStress:()=>su,convexhull:()=>ET,detectCyclesDirected:()=>Gx,detectCyclesUndirected:()=>p1,detectCyclesUndirectedDFS:()=>_1,dijkstra:()=>wc,distanceStress:()=>Sx,fisheye:()=>Rx,johnson:()=>nu,kruskal:()=>jx,largestEmptyCircle:()=>Tx,minDisk:()=>Qo,minHeap:()=>Sd,removeRadialOverlap:()=>ou,stressMinimizationStep:()=>iu,stressMinimizationStepGeneral:()=>sT,weightedStress:()=>Ex});var yi=11102230246251565e-32,je=134217729,iT=(3+8*yi)*yi;function Kd(t,e,s,i,n){let r,o,a,l,d=e[0],h=i[0],u=0,c=0;h>d==h>-d?(r=d,d=e[++u]):(r=h,h=i[++c]);let g=0;if(u<t&&c<s)for(h>d==h>-d?(o=d+r,a=r-(o-d),d=e[++u]):(o=h+r,a=r-(o-h),h=i[++c]),r=o,a!==0&&(n[g++]=a);u<t&&c<s;)h>d==h>-d?(o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u]):(o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c]),r=o,a!==0&&(n[g++]=a);for(;u<t;)o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u],r=o,a!==0&&(n[g++]=a);for(;c<s;)o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c],r=o,a!==0&&(n[g++]=a);return r===0&&g!==0||(n[g++]=r),g}function nT(t,e){let s=e[0];for(let i=1;i<t;i++)s+=e[i];return s}function Ko(t){return new Float64Array(t)}var rT=(3+16*yi)*yi,oT=(2+12*yi)*yi,aT=(9+64*yi)*yi*yi,Pn=Ko(4),cm=Ko(8),gm=Ko(12),mm=Ko(16),Qe=Ko(4);function lT(t,e,s,i,n,r,o){let a,l,d,h,u,c,g,m,f,p,_,y,x,b,v,A,E,S;const w=t-n,T=s-n,L=e-r,R=i-r;b=w*R,c=je*w,g=c-(c-w),m=w-g,c=je*R,f=c-(c-R),p=R-f,v=m*p-(b-g*f-m*f-g*p),A=L*T,c=je*L,g=c-(c-L),m=L-g,c=je*T,f=c-(c-T),p=T-f,E=m*p-(A-g*f-m*f-g*p),_=v-E,u=v-_,Pn[0]=v-(_+u)+(u-E),y=b+_,u=y-b,x=b-(y-u)+(_-u),_=x-A,u=x-_,Pn[1]=x-(_+u)+(u-A),S=y+_,u=S-y,Pn[2]=y-(S-u)+(_-u),Pn[3]=S;let k=nT(4,Pn),j=oT*o;if(k>=j||-k>=j||(u=t-w,a=t-(w+u)+(u-n),u=s-T,d=s-(T+u)+(u-n),u=e-L,l=e-(L+u)+(u-r),u=i-R,h=i-(R+u)+(u-r),a===0&&l===0&&d===0&&h===0)||(j=aT*o+iT*Math.abs(k),k+=w*h+R*a-(L*d+T*l),k>=j||-k>=j))return k;b=a*R,c=je*a,g=c-(c-a),m=a-g,c=je*R,f=c-(c-R),p=R-f,v=m*p-(b-g*f-m*f-g*p),A=l*T,c=je*l,g=c-(c-l),m=l-g,c=je*T,f=c-(c-T),p=T-f,E=m*p-(A-g*f-m*f-g*p),_=v-E,u=v-_,Qe[0]=v-(_+u)+(u-E),y=b+_,u=y-b,x=b-(y-u)+(_-u),_=x-A,u=x-_,Qe[1]=x-(_+u)+(u-A),S=y+_,u=S-y,Qe[2]=y-(S-u)+(_-u),Qe[3]=S;const z=Kd(4,Pn,4,Qe,cm);b=w*h,c=je*w,g=c-(c-w),m=w-g,c=je*h,f=c-(c-h),p=h-f,v=m*p-(b-g*f-m*f-g*p),A=L*d,c=je*L,g=c-(c-L),m=L-g,c=je*d,f=c-(c-d),p=d-f,E=m*p-(A-g*f-m*f-g*p),_=v-E,u=v-_,Qe[0]=v-(_+u)+(u-E),y=b+_,u=y-b,x=b-(y-u)+(_-u),_=x-A,u=x-_,Qe[1]=x-(_+u)+(u-A),S=y+_,u=S-y,Qe[2]=y-(S-u)+(_-u),Qe[3]=S;const q=Kd(z,cm,4,Qe,gm);b=a*h,c=je*a,g=c-(c-a),m=a-g,c=je*h,f=c-(c-h),p=h-f,v=m*p-(b-g*f-m*f-g*p),A=l*d,c=je*l,g=c-(c-l),m=l-g,c=je*d,f=c-(c-d),p=d-f,E=m*p-(A-g*f-m*f-g*p),_=v-E,u=v-_,Qe[0]=v-(_+u)+(u-E),y=b+_,u=y-b,x=b-(y-u)+(_-u),_=x-A,u=x-_,Qe[1]=x-(_+u)+(u-A),S=y+_,u=S-y,Qe[2]=y-(S-u)+(_-u),Qe[3]=S;const B=Kd(q,gm,4,Qe,mm);return mm[B-1]}function va(t,e,s,i,n,r){const o=(e-r)*(s-n),a=(t-n)*(i-r),l=o-a,d=Math.abs(o+a);return Math.abs(l)>=rT*d?l:-lT(t,e,s,i,n,r,d)}var fm=Math.pow(2,-52),Aa=new Uint32Array(512),Tc=class wx{static from(e,s=gT,i=mT){const n=e.length,r=new Float64Array(2*n);for(let o=0;o<n;o++){const a=e[o];r[2*o]=s(a),r[2*o+1]=i(a)}return new wx(r)}constructor(e){const s=e.length>>1;if(s>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*s-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(s)),this._hullPrev=new Uint32Array(s),this._hullNext=new Uint32Array(s),this._hullTri=new Uint32Array(s),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(s),this._dists=new Float64Array(s),this.update()}update(){const{coords:e,_hullPrev:s,_hullNext:i,_hullTri:n,_hullHash:r}=this,o=e.length>>1;let a=1/0,l=1/0,d=-1/0,h=-1/0;for(let w=0;w<o;w++){const T=e[2*w],L=e[2*w+1];T<a&&(a=T),L<l&&(l=L),T>d&&(d=T),L>h&&(h=L),this._ids[w]=w}const u=(a+d)/2,c=(l+h)/2;let g,m,f;for(let w=0,T=1/0;w<o;w++){const L=Qd(u,c,e[2*w],e[2*w+1]);L<T&&(g=w,T=L)}const p=e[2*g],_=e[2*g+1];for(let w=0,T=1/0;w<o;w++){if(w===g)continue;const L=Qd(p,_,e[2*w],e[2*w+1]);L<T&&L>0&&(m=w,T=L)}let y=e[2*m],x=e[2*m+1],b=1/0;for(let w=0;w<o;w++){if(w===g||w===m)continue;const T=uT(p,_,y,x,e[2*w],e[2*w+1]);T<b&&(f=w,b=T)}let v=e[2*f],A=e[2*f+1];if(b===1/0){for(let L=0;L<o;L++)this._dists[L]=e[2*L]-e[0]||e[2*L+1]-e[1];Jn(this._ids,this._dists,0,o-1);const w=new Uint32Array(o);let T=0;for(let L=0,R=-1/0;L<o;L++){const k=this._ids[L],j=this._dists[k];j>R&&(w[T++]=k,R=j)}return this.hull=w.subarray(0,T),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(va(p,_,y,x,v,A)<0){const w=m,T=y,L=x;m=f,y=v,x=A,f=w,v=T,A=L}const E=cT(p,_,y,x,v,A);this._cx=E.x,this._cy=E.y;for(let w=0;w<o;w++)this._dists[w]=Qd(e[2*w],e[2*w+1],E.x,E.y);Jn(this._ids,this._dists,0,o-1),this._hullStart=g;let S=3;i[g]=s[f]=m,i[m]=s[g]=f,i[f]=s[m]=g,n[g]=0,n[m]=1,n[f]=2,r.fill(-1),r[this._hashKey(p,_)]=g,r[this._hashKey(y,x)]=m,r[this._hashKey(v,A)]=f,this.trianglesLen=0,this._addTriangle(g,m,f,-1,-1,-1);for(let w,T,L=0;L<this._ids.length;L++){const R=this._ids[L],k=e[2*R],j=e[2*R+1];if(L>0&&Math.abs(k-w)<=fm&&Math.abs(j-T)<=fm||(w=k,T=j,R===g||R===m||R===f))continue;let z=0;for(let it=0,dt=this._hashKey(k,j);it<this._hashSize&&(z=r[(dt+it)%this._hashSize],z===-1||z===i[z]);it++);z=s[z];let q,B=z;for(;q=i[B],va(k,j,e[2*B],e[2*B+1],e[2*q],e[2*q+1])>=0;)if(B=q,B===z){B=-1;break}if(B===-1)continue;let W=this._addTriangle(B,R,i[B],-1,-1,n[B]);n[R]=this._legalize(W+2),n[B]=W,S++;let Z=i[B];for(;q=i[Z],va(k,j,e[2*Z],e[2*Z+1],e[2*q],e[2*q+1])<0;)W=this._addTriangle(Z,R,q,n[R],-1,n[Z]),n[R]=this._legalize(W+2),i[Z]=Z,S--,Z=q;if(B===z)for(;q=s[B],va(k,j,e[2*q],e[2*q+1],e[2*B],e[2*B+1])<0;)W=this._addTriangle(q,R,B,-1,n[B],n[q]),this._legalize(W+2),n[q]=W,i[B]=B,S--,B=q;this._hullStart=s[R]=B,i[B]=s[Z]=R,i[R]=Z,r[this._hashKey(k,j)]=R,r[this._hashKey(e[2*B],e[2*B+1])]=B}this.hull=new Uint32Array(S);for(let w=0,T=this._hullStart;w<S;w++)this.hull[w]=T,T=i[T];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,s){return Math.floor(dT(e-this._cx,s-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:s,_halfedges:i,coords:n}=this;let r=0,o=0;for(;;){const a=i[e],l=e-e%3;if(o=l+(e+2)%3,a===-1){if(r===0)break;e=Aa[--r];continue}const d=a-a%3,h=l+(e+1)%3,u=d+(a+2)%3,c=s[o],g=s[e],m=s[h],f=s[u];if(hT(n[2*c],n[2*c+1],n[2*g],n[2*g+1],n[2*m],n[2*m+1],n[2*f],n[2*f+1])){s[e]=f,s[a]=c;const p=i[u];if(p===-1){let y=this._hullStart;do{if(this._hullTri[y]===u){this._hullTri[y]=e;break}y=this._hullPrev[y]}while(y!==this._hullStart)}this._link(e,p),this._link(a,i[o]),this._link(o,u);const _=d+(a+1)%3;r<Aa.length&&(Aa[r++]=_)}else{if(r===0)break;e=Aa[--r]}}return o}_link(e,s){this._halfedges[e]=s,s!==-1&&(this._halfedges[s]=e)}_addTriangle(e,s,i,n,r,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=s,this._triangles[a+2]=i,this._link(a,n),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}};function dT(t,e){const s=t/(Math.abs(t)+Math.abs(e));return(e>0?3-s:1+s)/4}function Qd(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function hT(t,e,s,i,n,r,o,a){const l=t-o,d=e-a,h=s-o,u=i-a,c=n-o,g=r-a,m=h*h+u*u,f=c*c+g*g;return l*(u*f-m*g)-d*(h*f-m*c)+(l*l+d*d)*(h*g-u*c)<0}function uT(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l),g=(d*h-a*u)*c,m=(o*u-l*h)*c;return g*g+m*m}function cT(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l);return{x:t+(d*h-a*u)*c,y:e+(o*u-l*h)*c}}function Jn(t,e,s,i){if(i-s<=20)for(let n=s+1;n<=i;n++){const r=t[n],o=e[r];let a=n-1;for(;a>=s&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let n=s+1,r=i;Mr(t,s+i>>1,n),e[t[s]]>e[t[i]]&&Mr(t,s,i),e[t[n]]>e[t[i]]&&Mr(t,n,i),e[t[s]]>e[t[n]]&&Mr(t,s,n);const o=t[n],a=e[o];for(;;){do n++;while(e[t[n]]<a);do r--;while(e[t[r]]>a);if(r<n)break;Mr(t,n,r)}t[s+1]=t[r],t[r]=o,i-n+1>=r-s?(Jn(t,e,n,i),Jn(t,e,s,r-1)):(Jn(t,e,s,r-1),Jn(t,e,n,i))}}function Mr(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function gT(t){return t[0]}function mT(t){return t[1]}function Tx(t,e=1,s=0,i,n){if(!i||!n){const u=t.map(g=>[g.x,g.y]),c=Tc.from(u,g=>g[0],g=>g[1]);i=Co(c.triangles,u),n=Co(c.hull,u)}if(!n)return[];const r=s*s,o=[],a={};for(let u=0;u<i.length;u+=3)if(fT(n,Ic(i[u],i[u+1],i[u+2]))){const c=_T(i[u],i[u+1],i[u+2]);c>r&&(o.push(u),a[u]=c)}if(o.length===0)return[];o.sort((u,c)=>a[u]-a[c]);let l=o[0],d=a[l];const h=[];for(let u=0;u<o.length;u++){const c=o[u],g=a[c];g>d&&g>r&&(l=c,d=g,h.push(l),h.length>e&&h.shift())}return h.map(u=>pT(i[u],i[u+1],i[u+2]))}function fT(t,e){const s=t.length,i=t[s-1],[n,r]=e;let[o,a]=i,l=!1;for(let d=0;d<s;d++){const h=t[d],[u,c]=h;c>r!=a>r&&n<(o-u)*(r-c)/(a-c)+u&&(l=!l),o=u,a=c}return l}function pT(t,e,s){const i=Ic(t,e,s);let n=0;for(let r=0;r<3;r++){const o=arguments[r],a=o[0]-i[0],l=o[1]-i[1],d=Math.sqrt(a*a+l*l);d>n&&(n=d)}return[i[0],i[1],n]}function _T(t,e,s){const[i,n]=Ic(t,e,s),[r,o]=t,a=i-r,l=n-o;return a*a+l*l}function Ic(t,e,s){const i=[(t[0]+e[0])/2,(t[1]+e[1])/2],n=[(e[0]+s[0])/2,(e[1]+s[1])/2],r=-1/((e[1]-t[1])/(e[0]-t[0])),o=-1/((s[1]-e[1])/(s[0]-e[0])),a=i[1]-r*i[0],l=(a-(n[1]-o*n[0]))/(o-r);return[l,r*l+a]}function Qo(t,e,s,i){let n;if(i)n=i;else{n=new Uint32Array(t.length);for(let x=0,b=t.length;x<b;x++)n[x]=x}let r=t[n[0]],o=r,a=e[n[0]],l=a;for(let x=1;x<n.length;x++){const b=n[x],v=t[b],A=e[b];v<r&&(r=v),v>o&&(o=v),A<a&&(a=A),A>l&&(l=A)}const d=(r+o)/2,h=(a+l)/2;for(let x=0;x<n.length;x++){const b=n[x];t[b]-=d,e[b]-=h}function u(x,b,v,A,E,S){const w=v-S+1e-9*Math.max(v,S,1),T=A-x,L=E-b;return w>0&&w*w>T*T+L*L}function c(x,b,v,A,E,S,w){for(let T=0;T<A.length;++T){const L=A[T];if(!u(x,b,v,E[L],S[L],w[L]))return!1}return!0}function g(x,b,v,A,E,S){const w=A-x,T=E-b,L=S-v,R=Math.sqrt(w*w+T*T);return[(x+A+w/R*L)/2,(b+E+T/R*L)/2,(R+v+S)/2]}function m(x,b,v,A,E,S,w,T,L){const R=(x+A+w)/3,k=(b+E+T)/3,j=x-R,z=b-k,q=A-R,B=E-k,W=w-R,Z=T-k,it=j-q,dt=j-W,At=z-B,gt=z-Z,ct=S-v,yt=L-v,Tt=j*j+z*z-v*v,Gt=Tt-q*q-B*B+S*S,Vt=Tt-W*W-Z*Z+L*L,St=dt*At-it*gt,ft=(At*Vt-gt*Gt)/(2*St)-j,pt=(gt*ct-At*yt)/St,It=(dt*Gt-it*Vt)/(2*St)-z,Lt=(it*yt-dt*ct)/St,zt=pt*pt+Lt*Lt-1,_t=2*(v+ft*pt+It*Lt),Dt=ft*ft+It*It-v*v,oe=-(Math.abs(zt)>1e-6?(_t+Math.sqrt(_t*_t-4*zt*Dt))/(2*zt):Dt/_t);return[R+j+ft+pt*oe,k+z+It+Lt*oe,oe]}function f(x,b,v,A){switch(x.length){case 1:const E=x[0];return function(j,z,q){return[j,z,q]}(b[E],v[E],A[E]);case 2:const[S,w]=x;return g(b[S],v[S],A[S],b[w],v[w],A[w]);case 3:const[T,L,R]=x;return m(b[T],v[T],A[T],b[L],v[L],A[L],b[R],v[R],A[R]);default:return null}}function p(x,b,v,A,E,S){const w=v-S,T=A-x,L=E-b;return w<0||w*w<T*T+L*L}function _(x,b,v,A,E){const S=v[b],w=A[b],T=E[b];if(c(S,w,T,x,v,A,E))return[b];for(let L=0;L<x.length;++L){const R=x[L],k=v[R],j=A[R],z=E[R];if(p(S,w,T,k,j,z)){const[q,B,W]=g(k,j,z,S,w,T);if(c(q,B,W,x,v,A,E))return[x[L],b]}}for(let L=0;L<x.length-1;++L)for(let R=L+1;R<x.length;++R){const k=x[L],j=x[R],z=v[k],q=A[k],B=E[k],W=v[j],Z=A[j],it=E[j],dt=g(z,q,B,W,Z,it);if(p(dt[0],dt[1],dt[2],S,w,T)){const At=g(z,q,B,S,w,T);if(p(At[0],At[1],At[2],W,Z,it)){const gt=g(W,Z,it,S,w,T);if(p(gt[0],gt[1],gt[2],z,q,B)){const ct=m(z,q,B,W,Z,it,S,w,T);if(c(ct[0],ct[1],ct[2],x,v,A,E))return[k,j,b]}}}}throw new Error}n=function(b){for(let v=b.length-1;v>=0;v--){let A=Math.floor(Math.random()*(v+1));A=Math.max(Math.min(A,v),0);const E=b[v];b[v]=b[A],b[A]=E}return b}(n),s=s||new Array(t.length).fill(0);const y=function(b,v,A,E,S){let w=null,T=[],L=0;for(;L<v;){const R=b[L];w&&u(w[0],w[1],w[2],A[R],E[R],S[R])?L++:(T=_(T,R,A,E,S),w=f(T,A,E,S),L=0)}return w}(n,n.length,t,e,s);y[0]+=d,y[1]+=h;for(let x=0;x<n.length;x++){const b=n[x];t[b]+=d,e[b]+=h}return y}var Ix=[1/0,1/0,-1/0,-1/0];function $l(t,e,s,i,n,r={x:0,y:0}){const o=Math.cos(n),a=Math.sin(n),l=t-s,d=e-i;return r.x=o*l-a*d+s,r.y=a*l+o*d+i,r}function yT(t,e,s=0,i={x:0,y:0}){return i.x=t.x+s*Math.sin(e),i.y=t.y+s*Math.cos(e),i}var Ce=(t,e,s,i)=>Math.hypot(t-s,e-i);function xl(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function Lx(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=e,t.y/=e,t}function ru(t){return 180*t/Math.PI}function xT(t){return t*Math.PI/180}function Cx(t,e){return t.minX-=e,t.minY-=e,t.maxX+=e,t.maxY+=e,t.width===void 0&&(t.width=t.maxX-t.minX),t.height===void 0&&(t.height=t.maxY-t.minY),t.width+=2*e,t.height+=2*e,t}function Lc(t,e,s,i,n,r){const o=i-t,a=n-e,l=Math.sqrt(o*o+a*a);if(l>s+r||l<Math.abs(s-r))return null;const d=(s*s-r*r+l*l)/(2*l),h=t+o*d/l,u=e+a*d/l,c=Math.sqrt(s*s-d*d),g=c/l*-a,m=o*(c/l);return[[h+g,u+m],[h-g,u-m]]}function Cc(t,e,s,i,n,r){if(t-n>=0&&s-n<0)return 1;if(t-n<0&&s-n>=0)return-1;if(t-n===0&&s-n===0)return e-i>=0||i-r>=0?e-i:i-e;const o=(t-n)*(i-r)-(s-n)*(e-r);return o<0?1:o>0?-1:(t-n)*(t-n)+(e-r)*(e-r)-((s-n)*(s-n)+(i-r)*(i-r))}function bT([t,e,s],i,n){const r=Math.abs(t-i),o=Math.abs(e-n);return r+o<=s||!(r>s||o>s)&&Math.sqrt(r*r+o*o)<s+1e-12}function vT(t,e,s,i){const n=t[0]-e,r=t[1]-s,o=t[2]-i;return n*n+r*r<o*o+1e-6}function Nc(t,e,s,i,n,r,o){const a=t-Math.max(i,Math.min(r,t)),l=e-Math.max(n,Math.min(o,e));return a*a+l*l<s*s}function Nx(t,e,s,i,n,r,o,a={x:0,y:0}){const l=a||{x:0,y:0};let d,h,u,c;if(s===t){const _=t-n,y=o*o-_*_;if(y<0)return null;const x=Math.sqrt(y);d=t,u=t,h=r+x,c=r-x}else{const _=(i-e)/(s-t),y=e-_*t,x=y-r,b=_*_+1,v=2*(_*x-n),A=v*v-4*b*(n*n+x*x-o*o);if(A<0)return null;const E=-v,S=Math.sqrt(A),w=2*b;d=(E+S)/w,u=(E-S)/w,h=_*d+y,c=_*u+y}const g=t-d,m=e-h,f=t-u,p=e-c;return g*g+m*m<f*f+p*p?(l.x=d,l.y=h):(l.x=u,l.y=c),l}function ou({X:t,Y:e,sizes:s,indexes:i,R:n,center:r,gap:o=0,epsilon:a=.001,maxLoops:l=5,inPlace:d=!0}){const h=i.length,u=r[0],c=r[1];let g=h;d||(t=t.slice(),e=e.slice());const m=Lc,f=Cc,p=i.slice().sort((T,L)=>f(t[T],e[T],t[L],e[L],u,c)),_=p[h-1],y=t[_],x=e[_];let b=!1;for(let T=0;T<g-1;T++){let L=T%h,R=(T+1)%h;T===-1&&(L=h-1,R=0),L=p[L],R=p[R];const k=t[L],j=e[L];let z=t[R],q=e[R];const B=s[L]+s[R]+o;let W=f(k,j,z,q,u,c);if(W===-1&&b&&(W=1),!(B>n)){if(W===1||B-Ce(k,j,z,q)>a){const Z=m(u,c,n,k,j,B);if(Z){const it=Z[0];b=z>u&&it[0]<u,z=t[R]=it[0],q=e[R]=it[1]}}else b=!1;if(T%h===h-2){const Z=p[h-1],it=p[0];if(e[Z]>c&&e[it]>c&&t[Z]-s[Z]<t[it]+s[Z]){let dt=0;for(g=Math.min(h*l,g+h);e[p[Z]]>c&&e[p[0]]>c&&t[p[Z]]<t[p[0]]&&++dt<h;){const At=p.pop();At&&p.unshift(At)}}}}}const v=y-u,A=x-c,E=t[_]-u,S=e[_]-c,w=v===E?0:Math.abs(Math.acos((v*E+A*S)/(Math.sqrt(v*v+A*A)*Math.sqrt(E*E+S*S))));if(w!==0){const T=Math.sin(-w),L=Math.cos(-w);let R;for(let k=0;k<h;k++){R=p[k];const j=t[R]-u,z=e[R]-c;t[R]=j*L-z*T+u,e[R]=j*T+z*L+c}}return{X:t,Y:e}}function pm(t,e,s,i,n,r){const o={},a=s[t];let l=a,d=0;const h=a*n;for(const u in e){const c=e[u];let g=0,m=0;for(let y=0,x=c.length;y<x;y++){const b=s[c[y]];m=Math.max(m,b),g+=2*b+i}const f=g/(2*Math.PI),p=m+l,_=r?d+Math.max(r,p):d*n;d=Math.max(p,d,f,h,_),o[u]=d,l=m}return o[0]=0,o[Number.POSITIVE_INFINITY]=d,o}function AT(t,e,s){return(e[0]-t[0])*(s[1]-t[1])-(e[1]-t[1])*(s[0]-t[0])}function _m(t){const e=t.length,s=[0,1];let i=2;for(let n=2;n<e;n++){for(;i>1&&AT(t[s[i-2]],t[s[i-1]],t[n])<=0;)--i;s[i++]=n}return s.slice(0,i)}function ET(t){const e=t.length;if(e<3)return null;const s=new Array(e),i=new Array(e);for(let u=0;u<e;u++)s[u]=[+t[u][0],+t[u][1],u];s.sort((u,c)=>u[0]-c[0]||u[1]-c[1]);for(let u=0;u<e;u++)i[u]=[s[u][0],-s[u][1]];const n=_m(s),r=_m(i),o=r[r.length-1],a=n[n.length-1],l=r[0]===n[0],d=o===a?1:0,h=[];for(let u=n.length-1;u>=0;--u)h.push(t[s[n[u]][2]]);for(let u=+l;u<r.length-d;u++)h.push(t[s[r[u]][2]]);return h}var ym=t=>--t*t*t+1,xm=(t,e,s)=>{const i=t-s[0],n=e-s[1];return i*i+n*n},ST=(t,e)=>{let s=1/0,i=-1/0;for(let n=0;n<t.length;n++){const r=t[n],o=e?e[r]:r;s=Math.min(o,s),i=Math.max(o,i)}return{min:s,max:i}};function wT({X:t,Y:e,R:s,center:i,maxSteps:n=1e3,padding:r=5,epsilon:o=1e-9,damping:a=2,pinned:l=-1,indexes:d,onUpdate:h,pushSmallerOut:u=!0}){const c=d?d.length:t.length;let g=d;if(g===void 0){g=new Uint32Array(c);for(let b=0;b<c;b++)g[b]=b}else g=d;if(l!==-1)i=[t[l],e[l]];else if(!i){let b=0,v=0;for(let A=0;A<c;A++)b+=t[g[A]],v+=e[g[A]];i=[b/c,v/c]}const{min:m,max:f}=ST(g,s);function p(b,v){let A=0;for(let T=0;T<c-1;T++)for(let L=T+1;L<c;L++){if(T===L)continue;const R=g[T],k=g[L],j=t[R],z=e[R],q=s[R],B=t[k],W=e[k],Z=s[k],it=B-j,dt=W-z,At=q+Z+r,gt=it*it+dt*dt;if(gt<At*At-b){const ct=(At-Math.sqrt(gt))*v,yt=1/gt,Tt=it*yt*ct,Gt=dt*yt*ct,Vt=Tt*Tt+Gt*Gt;if(k!==l){const St=q/m;A+=Vt*St,t[k]+=Tt*St,e[k]+=Gt*St}if(R!==l){const St=Z/m;A+=Vt*St,t[R]-=Tt*St,e[R]-=Gt*St}}}const E=b*a*(1-v),S=i[0],w=i[1];for(let T=0;T<c;T++){const L=g[T];if(L!==l){const R=t[L],k=e[L],j=s[L],z=u?E*(j/f):E,q=(R-S)*z,B=(k-w)*z;A+=q*q+B*B,t[L]-=q,e[L]-=B}}return A}g.sort((b,v)=>s[v]*xm(t[v],e[v],i)-s[b]*xm(t[b],e[b],i));let _=0,y=0;const x=ym(1/c);for(let b=0;b<n&&(_=p(x,ym((b+1)/n)),h&&setTimeout(()=>h(t,e)),!(Math.abs(_-y)<o));b++)y=_;return{X:t,Y:e}}var Ea=t=>({data:t,next:null,prev:null});function Mx(t,e=0,s=0){const i=t.length;if(i===0)return t;const n=t[0];if(n.x=e,n.y=s,i===1)return t;const r=t[1];if(n.x=e-r.radius,r.x=e+n.radius,r.y=s,i===2)return t;const o=t[2];bm(r,n,o);let a=Ea(n),l=Ea(r),d=Ea(o);a.next=d.prev=l,l.next=a.prev=d,d.next=l.prev=a;t:for(let h=3;h<i;h++){d=Ea(t[h]),bm(a.data,l.data,t[h]);let u=l.next,c=a.prev,g=l.data.radius,m=a.data.radius;do if(g<=m){if(vm(u.data,d.data)){l=u,a.next=l,l.prev=a,--h;continue t}g+=u.data.radius,u=u.next}else{if(vm(c.data,d.data)){a=c,a.next=l,l.prev=a,--h;continue t}m+=c.data.radius,c=c.prev}while(u!==c.next);d.prev=a,d.next=l,a.next=l.prev=l=d;let f=Am(a);for(;(d=d.next)!==l;){const p=Am(d);p<f&&(a=d,f=p)}l=a.next}return t}function bm(t,e,s){const i=t.x-e.x;let n,r;const o=t.y-e.y,a=i*i+o*o;let l,d;a?(r=e.radius+s.radius,r*=r,d=t.radius+s.radius,d*=d,r>d?(n=(a+d-r)/(2*a),l=Math.sqrt(Math.max(0,d/a-n*n)),s.x=t.x-n*i-l*o,s.y=t.y-n*o+l*i):(n=(a+r-d)/(2*a),l=Math.sqrt(Math.max(0,r/a-n*n)),s.x=e.x+n*i-l*o,s.y=e.y+n*o+l*i)):(s.x=e.x+s.radius,s.y=e.y)}var TT=1e-6;function vm(t,e){const s=t.radius+e.radius-TT,i=e.x-t.x,n=e.y-t.y;return s>0&&s*s>i*i+n*n}function Am(t){const e=t.data,s=t.next.data,i=e.radius+s.radius,n=(e.x*s.radius+s.x*e.radius)/i,r=(e.y*s.radius+s.y*e.radius)/i;return n*n+r*r}function IT(t,e,s,i,n){const r=t.get(e),o=t.get(s),a=n.get(r._index)||r.getAttributes(["x","y","r"]),l=n.get(o._index)||o.getAttributes(["x","y","r"]),d=Number(l.radius),h=Number(a.radius),u=Ce(a.x,a.y,l.x,l.y),c=u;return i.push({source:e,target:s,weight:c}),u<=h+d+20?1:0}function LT(t){return t%3==2?t-2:t+1}function CT(t,e,s){const i=[],{triangles:n,halfedges:r}=t;for(let o=0;o<n.length;o++)o>r[o]&&IT(e,n[o],n[LT(o)],i,s);return i}var NT=(t,e)=>t.weight-e.weight;function MT(t,e){const s=new Set,i=new Array(t.length),n=[];for(const o of e)i[o.source]||(i[o.source]=[]),i[o.source].push(o),i[o.target]||(i[o.target]=[]),i[o.target].push(o);s.add(0);const r=Sd(NT,i[0]);for(;r.size!==0;){const o=r.pop(),a=s.has(o.source)?s.has(o.target)?null:o.target:o.source;if(a){const l=o.source===a?o.target:o.source,d=a;n.push({source:l,target:d,weight:o.weight}),s.add(a);for(const h of i[a])r.push(h)}}return n}function Em(t,e,s){let i=t.x-e.x,n=t.y-e.y;const r=Math.sqrt(i*i+n*n);i/=r,n/=r;const o=s*i,a=s*n;t.x+=o,t.y+=a}function RT(t,e,s,i,n){const r=new Set;let o={x:0,y:0},a=-1;const l=n.map((d,h)=>(t===s.get(h)&&(a=h,o={index:h,...d}),{x:d.x,y:d.y,r:d.radius,index:h}));if(s.size<3)return l.map((d,h)=>{if(h===a)return d;const u=d.x-o.x,c=d.y-o.y,g=Math.sqrt(u*u+c*c),m=e*u/g,f=e*c/g;return{x:d.x+m,y:d.y+f,radius:d.r}});for(const d of i){const h=l[d.target],u=l[d.source],c=1;u.index===a||r.has(d.source)||(Em(u,o,c*e),r.add(d.source)),h.index===a||r.has(d.target)||(Em(h,o,c*e),r.add(d.target))}return l.map(d=>({x:d.x,y:d.y}))}function Rx(t,e,s,i){t.includes(e)||(t=t.concat(e.toList())),i||(i=t.getAttributes(["x","y","radius"]));const n=Tc.from(i||t.getPosition(),l=>l.x,l=>l.y),r=new Map;for(let l=0;l<t.size;l++)r.set(t._indexes[l],i[l]);const o=CT(n,t,r),a=MT(t.toArray(),o);return RT(e,s,t,a,i)}var FT=16,PT=class{constructor(t=Int32Array,e=FT,s=8){this._BIG_LIST=new Uint8Array([-1])[0],this._ArrayType=t,this._capacity=e,this._MAX_LIST_SIZE=s,this._freeIndex=-1,this.clear()}clear(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._idToIndex={},this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){let e;return this._freeIndex===-1?e=this._nextIndex++:(e=this._freeIndex,this._freeIndex=-1),this._idToIndex[t]=e,e>=this._capacity&&this._expand(e+1),this._sizes[e]=0,e}getItems(t){const e=this._idToIndex[t];if(e===void 0)return;const s=this._sizes[e],i=this._MAX_LIST_SIZE*e;if(s<=this._MAX_LIST_SIZE){this._constList.length=s;for(let n=0,r=s;n<r;++n)this._constList[n]=this._buffer[i+n];return this._constList}if(s===this._BIG_LIST){let n=this._buffer[i];return this._bigLists[n]}}removeEntry(t){const e=this._idToIndex[t];if(this._sizes[e]===this._BIG_LIST){const s=this._MAX_LIST_SIZE*e,i=this._buffer[s];this._bigLists[i].length=0}this._sizes[e]=0,this._freeIndex=e}size(t){const e=this._idToIndex[t];let s=this._sizes[e];return s<=this._MAX_LIST_SIZE?s:this._bigLists[this._buffer[e*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=this._idToIndex[t[a]],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._idToIndex[t],i=this._sizes[s],n=s*this._MAX_LIST_SIZE;if(i<this._MAX_LIST_SIZE)this._buffer[n+i]=e,this._sizes[s]=i+1;else if(i===this._BIG_LIST){let r=this._buffer[n];this._bigLists[r].push(e)}else{let r=new Array(this._MAX_LIST_SIZE);for(let o=0;o<this._MAX_LIST_SIZE;++o)r[o]=this._buffer[n+o];r.push(e),this._bigLists.push(r),this._sizes[s]=this._BIG_LIST,this._buffer[n]=this._bigLists.length-1}}removeFrom(t,e){this.removeFromAndGetSize(t,e)}removeFromAndGetSize(t,e){const s=this._idToIndex[t];let i=this._sizes[s],n=this._MAX_LIST_SIZE*s;if(i<=this._MAX_LIST_SIZE){for(let r=n,o=n+i;r<o;++r)if(this._buffer[r]===e)return i-=1,this._buffer[r]=this._buffer[o-1],this._sizes[s]=i,i}else if(i===this._BIG_LIST){let r=this._buffer[n],o=this._bigLists[r],a=o.indexOf(e);if(a!==-1)return o.splice(a,1),o.length}}reserve(t){this._capacity<t&&this._expand(t)}_expand(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=Sm(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=Sm(this._sizes,this._capacity)}has(t){const e=this._idToIndex[t];return!(e===void 0||e>=this._capacity)&&this._sizes[e]!==0}get averageSize(){let t=0;for(let e=0;e<this._capacity;e++)t+=this._sizes[e];return t/this._capacity}};function Sm(t,e){let s=new t.constructor(e);return s.set(t),s}var Rr,wm,Fr,zn,Pr,mn=[0,1],bl=[0,2];for(Fr=4;Fr<65535;Fr<<=2)for(Rr=0,wm=mn.length;Rr<wm;Rr++)mn.push(mn[Rr]|Fr),bl.push((mn[Rr]|Fr)<<1);function Ds(t,e){return(bl[255&e]|mn[255&t])+65536*(bl[e>>8&255]|mn[t>>8&255])+4294967296*(bl[e>>16&255]|mn[t>>16&255])}function Tm(t,e=[0,0]){if(t>0xffffffffffff)throw"Only morton codes up to 48 bits are supported.";if(!zn){zn={},Pr={};for(var s=0;s<256;s++)zn[Ds(s,0)]=s,Pr[Ds(0,s)]=s}var i=zn[21845&t],n=Pr[43690&t];return t>65535&&(i|=zn[21845&(t/=65536)]<<8,n|=Pr[43690&t]<<8,t>65535&&(i|=zn[21845&(t/=65536)]<<16,n|=Pr[43690&t]<<16)),e[0]=i,e[1]=n,e}Ds.code=function(e,s,i){if(e>24)throw"Morton codes are only supported up to Z=24";var n=1<<24-e;return Ds(s*n,i*n)},Ds.range=function(e,s,i){if(e>24)throw"Morton ranges are only supported up to Z=24";var n=1<<24-e,r=Ds(s*n,i*n);return[r,r+n*n-1]},Ds.reverse=Tm,Ds.decode=function(e,s){var i=Tm(s),n=1<<24-e;return[i[0]/n,i[1]/n]},Ds.min=function(e,s){var i=1431655765&e,n=1431655765&s,r=2863311530&e,o=2863311530&s;return Math.min(i,n)+Math.min(r,o)};var zT=1e-6,DT=1e-12;function Fx(){for(var t=arguments,e=t.length-1,s=e,i=[],n=0;n<=e&&Math.abs(t[n])<=DT;n++)e--;switch(e){case 1:OT(t[s],t[s-1],i);break;case 2:kT(t[s],t[s-1],t[s-2],i);break;case 3:BT(t[s],t[s-1],t[s-2],t[s-3],i)}return i}function OT(t,e,s=[]){return e!==0&&s.push(-t/e),s}function kT(t,e,s,i=[]){var n=e/s,r=n*n-4*(t/s);if(r>0){var o=Math.sqrt(r);i.push(.5*(-n+o)),i.push(.5*(-n-o))}else r===0&&i.push(.5*-n);return i}function BT(t,e,s,i,n=[]){var r,o,a=s/i,l=e/i,d=(3*l-a*a)/3,h=(2*a*a*a-9*l*a+27*(t/i))/27,u=a/3,c=h*h/4+d*d*d/27,g=h/2;if(Math.abs(c)<=zT&&(c=0),c>0){var m=Math.sqrt(c);o=(r=-g+m)>=0?Math.pow(r,1/3):-Math.pow(-r,1/3),(r=-g-m)>=0?o+=Math.pow(r,1/3):o-=Math.pow(-r,1/3),n.push(o-u)}else if(c<0){var f=Math.sqrt(-d/3),p=Math.atan2(Math.sqrt(-c),-g)/3,_=Math.cos(p),y=Math.sin(p),x=Math.sqrt(3);n.push(2*f*_-u),n.push(-f*(_+x*y)-u),n.push(-f*(_-x*y)-u)}else r=g>=0?-Math.pow(g,1/3):Math.pow(-g,1/3),n.push(2*r-u),n.push(-r-u);return n}function Ni(t,e,s,i,n,r,o,a,l,d,h){for(var u,c,g=Math.min(o,l),m=Math.min(a,d),f=Math.max(o,l),p=Math.max(a,d),_=Fx((u=a-d)*(t+-2*s+n)+(c=l-o)*(e+-2*i+r),u*(-2*t+2*s)+c*(-2*e+2*i),u*t+c*e+(o*d-l*a)),y=0;y<_.length;y++){var x=_[y];if(0<=x&&x<=1){var b=t+(s-t)*x,v=e+(i-e)*x,A=b+(s+(n-s)*x-b)*x,E=v+(i+(r-i)*x-v)*x;if(o===l){if(m<=E&&E<=p){if(!h)return 1;h.push(A,E)}}else if(a===d){if(g<=A&&A<=f){if(!h)return 1;h.push(A,E)}}else if(A>=g&&E>=m&&A<=f&&E<=p){if(!h)return 1;h.push(A,E)}}}return h?h.length/2:0}function Px(t,e,s,i,n,r,o,a,l,d,h){return h?(Ni(t,e,s,i,n,r,o,a,l,a,h),Ni(t,e,s,i,n,r,l,a,l,d,h),Ni(t,e,s,i,n,r,o,d,l,d,h),Ni(t,e,s,i,n,r,o,a,o,d,h),h.length/2):o<=t&&l>=t&&a<=e&&d>=e||o<=n&&l>=n&&a<=r&&d>=r||Ni(t,e,s,i,n,r,o,a,l,a)||Ni(t,e,s,i,n,r,l,a,l,d)||Ni(t,e,s,i,n,r,o,d,l,d)||Ni(t,e,s,i,n,r,o,a,o,d)?1:0}function Mi(t,e,s,i,n,r,o,a,l,d,h,u,c){for(var g,m,f=Math.min(l,h),p=Math.min(d,u),_=Math.max(l,h),y=Math.max(d,u),x=Fx((g=d-u)*(-1*t+3*s+-3*n+o)+(m=h-l)*(-1*e+3*i+-3*r+a),g*(3*t+-6*s+3*n)+m*(3*e+-6*i+3*r),g*(-3*t+3*s)+m*(-3*e+3*i),g*t+m*e+(l*u-h*d)),b=0;b<x.length;b++){var v=x[b];if(0<=v&&v<=1){var A=t+(s-t)*v,E=e+(i-e)*v,S=s+(n-s)*v,w=i+(r-i)*v,T=A+(S-A)*v,L=E+(w-E)*v,R=T+(S+(n+(o-n)*v-S)*v-T)*v,k=L+(w+(r+(a-r)*v-w)*v-L)*v;if(l===h){if(p<=k&&k<=y){if(!c)return 1;c.push(R,k)}}else if(d===u){if(f<=R&&R<=_){if(!c)return 1;c.push(R,k)}}else if(R>=f&&k>=p&&R<=_&&k<=y){if(!c)return 1;c.push(R,k)}}}return c?c.length/2:0}function au(t,e,s,i,n,r,o,a,l,d,h,u,c){return c?(Mi(t,e,s,i,n,r,o,a,l,d,h,d,c),Mi(t,e,s,i,n,r,o,a,h,d,h,u,c),Mi(t,e,s,i,n,r,o,a,l,u,h,u,c),Mi(t,e,s,i,n,r,o,a,l,d,l,u,c),c.length/2):l<=t&&h>=t&&d<=e&&u>=e||l<=o&&h>=o&&d<=a&&u>=a||Mi(t,e,s,i,n,r,o,a,l,d,h,d)||Mi(t,e,s,i,n,r,o,a,h,d,h,u)||Mi(t,e,s,i,n,r,o,a,l,u,h,u)||Mi(t,e,s,i,n,r,o,a,l,d,l,u)?1:0}var Im=typeof Map>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}set(e,s){e in this._values||this._size++,this._values[e]=s}get(e){return this._values[e]}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Map,UT=typeof Set>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}add(e){e in this._values||this._size++,this._values[e]=!0}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Set,zx=class{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(t){return this._getBounds=t,this}setIntersector(t){return this._intersects=t,this}},GT=65536,VT=16,qT=16,jT=class extends zx{constructor(t,e,s=qT,i=GT,n=Int32Array,r=VT){super(),this._occupied=0,this._idToCode=new Im,this._codeCache=[0,0,0],this.code=(o,a,l)=>l|Ds(o,a)<<this._bitsForZoom,this.decode=(o,a)=>(Ds.reverse(o>>this._bitsForZoom,a),a[2]=o&this._zoomMask,a),this._intersects=t,this._getBounds=e,this._cells=new PT(n),this._offset=i,this._maxLevels=r,this._mortonMax=(1<<this._maxLevels)-1,this._bitsForZoom=Math.log2(this._maxLevels),this._zoomMask=(1<<this._bitsForZoom)-1,this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._min=-i,this._max=i,this._resolution=this._mortonMax/(this._max-this._min),this._minCellSize=s*this._resolution,this._bounds=new Array(4*this._maxLevels);for(let o=0;o<this._maxLevels;o++)this._bounds[4*o]=1/0,this._bounds[4*o+1]=1/0,this._bounds[4*o+2]=-1/0,this._bounds[4*o+3]=-1/0}setMinCellSize(t){return this._minCellSize=t,this}setOffset(t){return this._offset=t,this._min=-t,this._max=t,this._resolution=this._mortonMax/(this._max-this._min),this}insert(t,e,s,i,n){e===void 0&&([e,s,i,n]=this._getBounds(t));const r=Math.max(i-e,n-s);let o,a=this._minCellSize;for(o=0;a<r&&o<this._maxLevels-1;o++)a*=2;const l=this._resolution,d=this._min,h=l*(.5*(i+e)-d)/a|0,u=l*(.5*(n+s)-d)/a|0,c=this.code(h,u,o);this._cells.has(c)||this._cells.addEntry(c),this._cells.addTo(c,t),this._objectsAtLevel[o]++,this._occupied|=1<<o;const g=4*o,m=this._bounds;return h<m[g]&&(m[g]=h),u<m[g+1]&&(m[g+1]=u),h>m[g+2]&&(m[g+2]=h),u>m[g+3]&&(m[g+3]=u),this._idToCode.set(t,c),c}has(t){return this._idToCode.has(t)}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n)}remove(t){const e=this._idToCode.get(t);this.decode(e,this._codeCache);const s=this._codeCache[2];return--this._objectsAtLevel[s]===0&&(this._occupied&=~(1<<s),this._bounds[4*s]=1/0,this._bounds[4*s+1]=1/0,this._bounds[4*s+2]=-1/0,this._bounds[4*s+3]=-1/0),this._cells.removeFrom(e,t),this._idToCode.delete(t),this}query(t,e,s,i){const n=this._cells,r=this._bounds,o=this._intersects,a=this._min,l=this._resolution;let d=this._minCellSize,h=this._occupied;const u=[];for(let c=0;c<this._maxLevels&&h!==0;d*=2,h>>=1,c++){if(!(1&h))continue;const g=1/d,m=4*c,f=Math.max(r[m],l*(t-a)*g-1|0),p=Math.max(r[m+1],l*(e-a)*g-1|0),_=Math.min(r[m+2],l*(s-a)*g+1|0),y=Math.min(r[m+3],l*(i-a)*g+1|0);for(let x=f;x<=_;x++)for(let b=p;b<=y;b++){const v=this.code(x,b,c),A=n.getItems(v);if(A!==void 0)for(let E=0;E<A.length;E++){const S=A[E];o(S,t,e,s,i)&&u.push(S)}}}return u}traverse(t,e,s,i,n){const r=this._cells,o=this._bounds,a=this._intersects,l=this._min,d=this._resolution;let h=this._minCellSize,u=this._occupied;const c=[];for(let g=0;g<this._maxLevels&&u!==0;h*=2,u>>=1,g++){if(!(1&u))continue;const m=1/h,f=4*g,p=Math.max(o[f],d*(t-l)*m-1|0),_=Math.max(o[f+1],d*(e-l)*m-1|0),y=Math.min(o[f+2],d*(s-l)*m+1|0),x=Math.min(o[f+3],d*(i-l)*m+1|0);for(let b=p;b<=y;b++)for(let v=_;v<=x;v++){const A=this.code(b,v,g),E=r.getItems(A);if(E!==void 0)for(let S=0;S<E.length;S++){const w=E[S];if(a(w,t,e,s,i)&&(c.push(w),n(w)))return c}}}return c}collisions(t,e=this._getBounds){if(typeof e!="function")throw new Error("getBounds function is required to get the object bounds");const s=Array.from(this._idToCode.keys()),i=this._min,n=this._resolution,r=this._cells,o=new Im,a=[];for(let l=0;l<s.length;l++){let d=0,h=this._minCellSize,u=this._occupied;const c=s[l];let[g,m,f,p]=e(c);const _=Math.max(f-g,p-m);for(d=0;h<_;d++)h*=2,u>>=1;g=n*(g-i),m=n*(m-i),f=n*(f-i),p=n*(p-i);for(let y=d;y<this._maxLevels&&u!==0;h*=2,u>>=1,y++){if(!(1&u))continue;const x=1/h,b=m*x-1|0,v=f*x+1|0,A=p*x+1|0;for(let E=g*x-1|0;E<=v;E++)for(let S=b;S<=A;S++){const w=this.code(E,S,y);if(o.get(w)===l)continue;o.set(w,l);const T=r.getItems(w);if(T!==void 0)for(let L=0;L<T.length;L++){const R=T[L],[k,j,z,q]=this._getBounds(R);R!==c&&t(c,k,j,z,q)&&a.push(c,R)}}}}return YT(a)}clear(){this._occupied=0,this._cells.clear(),this._idToCode.clear(),this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._bounds=new Array(4*this._maxLevels);for(let t=0;t<this._maxLevels;t++)this._bounds[4*t]=1/0,this._bounds[4*t+1]=1/0,this._bounds[4*t+2]=-1/0,this._bounds[4*t+3]=-1/0;return this}keyToBBox(t){const[e,s,i]=this.decode(t,[0,0,0]),n=this._minCellSize*(1<<i),r=this._min,o=this._resolution;return[e*n/o+r,s*n/o+r,(e+1)*n/o+r,(s+1)*n/o+r]}keys(){return Object.keys(this._cells._idToIndex)}get averageCellOccupancy(){return this._cells.averageSize}get size(){return this._idToCode.size}getBoxes(){return Array.from(this._idToCode.keys()).map(t=>this._getBounds(t))}};function YT(t){const e=new UT,s=[];for(let i=0;i<t.length;i+=2){const n=t[i],r=t[i+1],o=n<r?n*r+(r-n-1)*(r-n-1)/4:n*r+(n-r-1)*(n-r-1)/4;e.has(o)||(e.add(o),s.push(n,r))}return s}function HT(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function ci(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}var hi=(t,e,s,i,n,r)=>({minX:t,minY:e,maxX:s,maxY:i,leaf:!0,level:r,parent:n,objects:[],final:!1,children:null});function Dx(t){const{minX:e,minY:s,maxX:i,maxY:n}=t;return[e,s,i,n]}function eo(t,e,s,i,n,r,o,a){return t>=n&&s<=o&&e>=r&&i<=a}var XT=0,$T=1,WT=2,ZT=3;function Sa(t,e,s,i,n,r,o,a){const l=(r+a)/2,d=(e+i)/2;return(t+s)/2<=(n+o)/2?d<=l?XT:$T:d<=l?ZT:WT}var KT=t=>t,jn=class extends zx{constructor(t=KT,e=10,s,i=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=e,this._root=null,this._getBounds=t,this._rootLevel=i,this._maxLevel=i+30,this._idToCell={},s&&(this._root=hi(s[0],s[1],s[2],s[3],null,i))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(t,e,s,i,n,r=this._root){if(e||([e,s,i,n]=this._getBounds(t)),this._objects[t])return;if(this._objects[t]=!0,this._size++,!this._root){const g=Math.max(Math.abs(i-e),Math.abs(n-s));return this._root=hi(e,s,e+g,s+g,null,this._rootLevel),this._idToCell[t]=[this._root],this._root.objects=[t],t}let o,a=[r],l=!1;const d=this._nodeCapacity,h=this._idToCell,u=this._maxLevel;let c;for(;c=a.pop();){o=c;const{minX:g,minY:m,maxX:f,maxY:p}=o;ci(e,s,i,n,g,m,f,p)&&(o.leaf?o.objects&&(o.objects.length<d||o.final)?(o.objects.push(t),h[t]?h[t].push(o):h[t]=[o],l=!0,(o.level>=u||Math.abs(f-g)<=Math.abs(i-e)||Math.abs(p-m)<=Math.abs(n-s))&&(o.final=!0)):(this.splitNode(o),a.push(o)):a.push.apply(a,o.children))}if(!eo(e,s,i,n,(r=this._root).minX,r.minY,r.maxX,r.maxY)){let g=this._rootLevel;for(;!eo(e,s,i,n,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){r=this._root;const{minX:m,minY:f,maxX:p,maxY:_}=r;let y=m,x=f,b=p,v=_;const A=Math.abs(p-m),E=Math.abs(_-f);if(E===0&&A===0)break;const S=Math.max(A,E);e<m?(y-=S,s<f?x-=S:v+=S):(b+=S,s<f?x-=S:v+=S);const w=hi(y,x,b,v,null,--g);this.splitNode(w),w.children[Sa(m,f,p,_,y,x,b,v)]=r,this._root=r.parent=w}for(a=[this._root],this._root.level=this._rootLevel;c=a.shift();)if(o=c,!o.leaf)for(let m=0;m<4;m++){const f=o.children[m];f.level=o.level+1,a.push(f)}r=this._root;for(let m=0;m<4;m++){const f=r.children[m];f&&f.leaf&&f.objects&&(f.objects.push(t),h[t]?h[t].push(f):h[t]=[f])}}return l?t:void 0}removeById(t){if(!this._objects[t])return t;this._size--;const e=this._idToCell[t];for(let s=0;s<e.length;s++){const i=e[s].objects||[];for(let n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}}return delete this._objects[t],delete this._idToCell[t],t}remove(t){const[e,s,i,n]=this._getBounds(t),r=[this._root];let o,a;const l=[];for(;o=r.pop();)if(ci(e,s,i,n,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const d=o.objects||[];for(let h=0,u=d.length;h<u;h++)if(d[h]===t){d.splice(h,1),u===1&&l.push(o);break}}else r.push.apply(r,o.children);if(delete this._idToCell[t],delete this._objects[t],this._size--,l.length)for(;a=l.pop();){let d=a.parent,h=!0;for(;d&&h;){if(!d.leaf){for(let u=0;u<4;u++)if(o=d.children[u],!o.leaf||o.objects&&o.objects.length!==0){h=!1;break}h&&(d.leaf=!0,d.children=[],d.objects=[])}d=d.parent}}return t}splitNode(t){const{minX:e,minY:s,maxX:i,maxY:n}=t,r=(e+i)/2,o=(s+n)/2,a=t.level+1,l=this._idToCell,d=this._maxLevel,h=[hi(e,s,r,o,t,a),hi(e,o,r,n,t,a),hi(r,o,i,n,t,a),hi(r,s,i,o,t,a)];if(t.objects!==null){const u=t.objects,c=this._getBounds;for(let g=0,m=u.length;g<m;g++){const f=u[g],p=c(f);let _=l[f];for(let y=0;y<4;y++){const x=h[y],{minX:b,minY:v,maxX:A,maxY:E}=x;ci(p[0],p[1],p[2],p[3],b,v,A,E)&&(x.objects&&x.objects.push(f),(x.level>=d||Math.abs(A-b)<=Math.abs(p[2]-p[0])||Math.abs(E-v)<=Math.abs(p[3]-p[1]))&&(x.final=!0),_?_.push(x):_=[x])}_&&_.splice(_.indexOf(t),1)}}t.children=h,t.objects=null,t.leaf=!1}point(t,e,s){let i=[];const n=[this._root];let r,o,a;const l=this._getBounds;for(;r=n.pop();)if(t>=r.minX&&t<=r.maxX&&e>=r.minY&&e<=r.maxY){if(r.leaf){s&&r.objects&&(i=r.objects);const d=r.objects||[];for(let h=0,u=d.length;h<u;h++)a=d[h],o=l(a),t>=o[0]&&t<=o[2]&&e>=o[1]&&e<=o[3]&&i.push(a);break}n.push.apply(n,r.children)}return i.length?i:null}neigbours(t,e){let s,i=[];const n=[this._root];for(;s=n.pop();)if(t>=s.minX&&t<=s.maxX&&e>=s.minY&&e<=s.maxY){if(s.leaf){i=s.objects;break}n.push.apply(n,s.children)}return i}query(t,e,s,i){const n=[],r=[this._root];let o,a,l;const d=this._getBounds,h={},u=this._intersects;let c;for(;o=r.pop();)if(ci(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const g=o.objects||[];for(let m=0,f=g.length;m<f;m++)l=g[m],h[l]||(a=d(l),ci(t,e,s,i,a[0],a[1],a[2],a[3])&&(u&&!u(l,t,e,s,i)||n.push(l)),h[l]=!0)}else c=Sa(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY),r.push(o.children[(c+3)%4],o.children[(c+2)%4],o.children[(c+1)%4],o.children[c]);return n}traverse(t,e,s,i,n){const r=[],o=[this._root];let a,l,d;const h=this._getBounds,u={},c=this._intersects;let g;for(;a=o.pop();)if(ci(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY))if(a.leaf){const m=a.objects||[];for(let f=0,p=m.length;f<p;f++)if(d=m[f],!u[d]){if(l=h(d),ci(t,e,s,i,l[0],l[1],l[2],l[3])&&(!c||c(d,t,e,s,i))&&(r.push(d),n(d)))return r;u[d]=!0}}else g=Sa(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY),o.push(a.children[(g+3)%4],a.children[(g+2)%4],a.children[(g+1)%4],a.children[g]);return r}getOverlaps(){const t=[this._root];let e,s,i;const n=[],r=this._getBounds,o={};for(;e=t.pop();)if(e.leaf){const a=e.objects||[],l=a.length;for(let d=0;d<l;d++)for(let h=0;h<l;h++)if(s=a[d],i=a[h],d!==h&&!o[s+":"+i]&&!o[i+":"+s]){o[s+":"+i]=!0;const u=r(s),c=r(i);ci(u[0],u[1],u[2],u[3],c[0],c[1],c[2],c[3])&&n.push(s,i)}}else t.push.apply(t,e.children);return n}cover(t,e,s,i){if(this._root===null)return this._root=hi(t,e,s,i,null,0),this;let n=this._root;if(!eo(t,e,s,i,n.minX,n.minY,n.maxX,n.maxY)){let r=this._rootLevel;for(;!eo(t,e,s,i,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){n=this._root;const{minX:d,minY:h,maxX:u,maxY:c}=n;let g=d,m=h,f=u,p=c;const _=Math.abs(u-d),y=Math.abs(c-h);if(y===0&&_===0)break;const x=Math.max(_,y);t<d?(g-=x,e<h?m-=x:p+=x):(f+=x,e<h?m-=x:p+=x);const b=hi(g,m,f,p,null,--r);this.splitNode(b),b.children[Sa(d,h,u,c,g,m,f,p)]=n,this._root=n.parent=b}const o=[this._root];let a,l;for(this._root.level=this._rootLevel;a=o.shift();)if(l=a,!l.leaf)for(let d=0;d<4;d++){const h=l.children[d];h.level=l.level+1,o.push(h)}}return this}getAll(){return Object.keys(this._objects).map(t=>Number(t))}forEach(t,e){const s=[this._root];let i;for(;i=s.pop();)if(i.leaf&&i.objects)for(let n=0,r=i.objects.length;n<r;n++)t.call(e,i.objects[n]);else s.push.apply(s,i.children);return this}getLeafs(){const t=[this._root],e=[];let s;for(;s=t.pop();)s.leaf?e.push(s):t.push.apply(t,s.children);return e}traverseFromRoot(t,e){const s=[this._root];let i;for(;i=s.pop();)t.call(e,i,i.objects)||i.leaf||s.push.apply(s,i.children);return this}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n),this}getNodeBounds(t){return Dx(t)}};jn.flatAccessor=(t,e)=>s=>{const i=e*s;return t.slice(i,i+e)},jn.inside=eo,jn.intersects=HT,jn.overlaps=ci,jn.getNodeBBox=Dx;var Ox=jn;function QT(t){const e=+this._x.call(null,t),s=+this._y.call(null,t);return kx(this.cover(e,s),e,s,t)}function kx(t,e,s,i){if(isNaN(e)||isNaN(s))return t;var n,r,o,a,l,d,h,u,c,g=t._root,m={data:i},f=t._x0,p=t._y0,_=t._x1,y=t._y1;if(!g)return t._root=m,t;for(;g.length;)if((d=e>=(r=(f+_)/2))?f=r:_=r,(h=s>=(o=(p+y)/2))?p=o:y=o,n=g,!(g=g[u=h<<1|d]))return n[u]=m,t;if(a=+t._x.call(null,g.data),l=+t._y.call(null,g.data),e===a&&s===l)return m.next=g,n?n[u]=m:t._root=m,t;do n=n?n[u]=new Array(4):t._root=new Array(4),(d=e>=(r=(f+_)/2))?f=r:_=r,(h=s>=(o=(p+y)/2))?p=o:y=o;while((u=h<<1|d)==(c=(l>=o)<<1|a>=r));return n[c]=g,n[u]=m,t}function JT(t){var e,s,i,n,r=t.length,o=new Array(r),a=new Array(r),l=1/0,d=1/0,h=-1/0,u=-1/0;for(s=0;s<r;++s)isNaN(i=+this._x.call(null,e=t[s]))||isNaN(n=+this._y.call(null,e))||(o[s]=i,a[s]=n,i<l&&(l=i),i>h&&(h=i),n<d&&(d=n),n>u&&(u=n));if(l>h||d>u)return this;for(this.cover(l,d).cover(h,u),s=0;s<r;++s)kx(this,o[s],a[s],t[s]);return this}function t1(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var s=this._x0,i=this._y0,n=this._x1,r=this._y1;if(isNaN(s))n=(s=Math.floor(t))+1,r=(i=Math.floor(e))+1;else{for(var o,a,l=n-s||1,d=this._root;s>t||t>=n||i>e||e>=r;)switch(a=(e<i)<<1|t<s,(o=new Array(4))[a]=d,d=o,l*=2,a){case 0:n=s+l,r=i+l;break;case 1:s=n-l,r=i+l;break;case 2:n=s+l,i=r-l;break;case 3:s=n-l,i=r-l}this._root&&this._root.length&&(this._root=d)}return this._x0=s,this._y0=i,this._x1=n,this._y1=r,this}function e1(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function s1(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function ns(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n}function i1(t,e,s){var i,n,r,o,a,l,d,h=this._x0,u=this._y0,c=this._x1,g=this._y1,m=[],f=this._root;for(f&&m.push(new ns(f,h,u,c,g)),s==null?s=1/0:(h=t-s,u=e-s,c=t+s,g=e+s,s*=s);l=m.pop();)if(!(!(f=l.node)||(n=l.x0)>c||(r=l.y0)>g||(o=l.x1)<h||(a=l.y1)<u))if(f.length){var p=(n+o)/2,_=(r+a)/2;m.push(new ns(f[3],p,_,o,a),new ns(f[2],n,_,p,a),new ns(f[1],p,r,o,_),new ns(f[0],n,r,p,_)),(d=(e>=_)<<1|t>=p)&&(l=m[m.length-1],m[m.length-1]=m[m.length-1-d],m[m.length-1-d]=l)}else{var y=t-+this._x.call(null,f.data),x=e-+this._y.call(null,f.data),b=y*y+x*x;if(b<s){var v=Math.sqrt(s=b);h=t-v,u=e-v,c=t+v,g=e+v,i=f.data}}return i}function n1(t){if(isNaN(r=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,s,i,n,r,o,a,l,d,h,u,c,g=this._root,m=this._x0,f=this._y0,p=this._x1,_=this._y1;if(!g)return this;if(g.length)for(;;){if((d=r>=(a=(m+p)/2))?m=a:p=a,(h=o>=(l=(f+_)/2))?f=l:_=l,e=g,!(g=g[u=h<<1|d]))return this;if(!g.length)break;(e[u+1&3]||e[u+2&3]||e[u+3&3])&&(s=e,c=u)}for(;g.data!==t;)if(i=g,!(g=g.next))return this;return(n=g.next)&&delete g.next,i?(n?i.next=n:delete i.next,this):e?(n?e[u]=n:delete e[u],(g=e[0]||e[1]||e[2]||e[3])&&g===(e[3]||e[2]||e[1]||e[0])&&!g.length&&(s?s[c]=g:this._root=g),this):(this._root=n,this)}function r1(t){for(var e=0,s=t.length;e<s;++e)this.remove(t[e]);return this}function o1(){return this._root}function a1(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function l1(t){var e,s,i,n,r,o,a=[],l=this._root;for(l&&a.push(new ns(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,i=e.x0,n=e.y0,r=e.x1,o=e.y1)&&l.length){var d=(i+r)/2,h=(n+o)/2;(s=l[3])&&a.push(new ns(s,d,h,r,o)),(s=l[2])&&a.push(new ns(s,i,h,d,o)),(s=l[1])&&a.push(new ns(s,d,n,r,h)),(s=l[0])&&a.push(new ns(s,i,n,d,h))}return this}function d1(t){var e,s=[],i=[];for(this._root&&s.push(new ns(this._root,this._x0,this._y0,this._x1,this._y1));e=s.pop();){var n=e.node;if(n.length){var r,o=e.x0,a=e.y0,l=e.x1,d=e.y1,h=(o+l)/2,u=(a+d)/2;(r=n[0])&&s.push(new ns(r,o,a,h,u)),(r=n[1])&&s.push(new ns(r,h,a,l,u)),(r=n[2])&&s.push(new ns(r,o,u,h,d)),(r=n[3])&&s.push(new ns(r,h,u,l,d))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function h1(t){return t[0]}function u1(t){return arguments.length?(this._x=t,this):this._x}function c1(t){return t[1]}function g1(t){return arguments.length?(this._y=t,this):this._y}function Bx(t,e,s){var i=new Mc(e??h1,s??c1,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function Mc(t,e,s,i,n,r){this._x=t,this._y=e,this._x0=s,this._y0=i,this._x1=n,this._y1=r,this._root=void 0}function Lm(t){for(var e={data:t.data},s=e;t=t.next;)s=s.next={data:t.data};return e}var Je=Bx.prototype=Mc.prototype;Je.copy=function(){var t,e,s=new Mc(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return s;if(!i.length)return s._root=Lm(i),s;for(t=[{source:i,target:s._root=new Array(4)}];i=t.pop();)for(var n=0;n<4;++n)(e=i.source[n])&&(e.length?t.push({source:e,target:i.target[n]=new Array(4)}):i.target[n]=Lm(e));return s},Je.add=QT,Je.addAll=JT,Je.cover=t1,Je.data=e1,Je.extent=s1,Je.find=i1,Je.remove=n1,Je.removeAll=r1,Je.root=o1,Je.size=a1,Je.visit=l1,Je.visitAfter=d1,Je.x=u1,Je.y=g1;var zr=function(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n},m1=function(t){const e=[];let s,i,n,r,o,a,l,d=this._root;for(d&&e.push(new zr(d,this._x0,this._y0,this._x1,this._y1));(s=e.pop())&&(l=t(d=s.node,n=s.x0,r=s.y0,o=s.x1,a=s.y1),l!=="break");)if(!l&&d.length){const h=(n+o)/2,u=(r+a)/2;(i=d[3])&&e.push(new zr(i,h,u,o,a)),(i=d[2])&&e.push(new zr(i,n,u,h,a)),(i=d[1])&&e.push(new zr(i,h,r,o,u)),(i=d[0])&&e.push(new zr(i,n,r,h,u))}return this};function Rc(t,e,s,i,n){const r=new Array(t.length);for(let o=0;o<e.length;o++){const a=i[e[o]],l=i[s[o]];r[a]=r[a]||[],r[a].push(l),n&&(r[l]=r[l]||[],r[l].push(a))}return r}function Po(t,e){return t[e]===-1?e:Po(t,t[e])}function f1(t,e,s){const i=Po(t,e),n=Po(t,s);t[i]=n}function p1(t,e,s,i=!1){const n=new Int32Array(t.length),r={};for(let o=0;o<t.length;o++)n[o]=-1,r[t[o]]=o;for(let o=0;o<e.length;o++){const a=r[e[o]],l=r[s[o]];if(i&&a===l)return!0;const d=Po(n,a),h=Po(n,l);if(d===h)return!0;f1(n,d,h)}return!1}function Ux(t,e,s,i,n,r,o,a){if(i[t]=n,s[t])return!0;if(e[t])return!1;e[t]=1,s[t]=1;const l=r[t];if(l){for(const d of l)if(Ux(d,e,s,i,t,r,o,a))return o.push(a[d]),!0}return s[t]=0,!1}function Gx(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Uint8Array(i),o=new Int32Array(i),a={};for(let d=0;d<i;d++)a[t[d]]=d;const l=Rc(t,e,s,a,!1);for(let d=0;d<i;d++){const h=[];if(Ux(d,n,r,o,-1,l,h,t)&&h.length>1){const u=h[0];for(let c=1;c<h.length;c++)if(h[c]===u){h.length=c;break}return h.push(u),h.reverse()}}return!1}function Vx(t,e,s,i,n,r,o){e[t]=1,i[t]=s;const a=n[t];if(a){for(const l of a)if(e[l]){if(l!==s)return i[l]=t,r.push(o[l]),!0}else if(Vx(l,e,t,i,n,r,o))return r.push(o[l]),!0}return!1}function _1(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Int32Array(i),o={};for(let l=0;l<i;l++)o[t[l]]=l,r[l]=-1;const a=Rc(t,e,s,o,!0);for(let l=0;l<e.length;l++){const d=o[e[l]],h=o[s[l]];a[d]=a[d]||[],a[d].push(h)}for(let l=0;l<i;l++){const d=l,h=[];if(!n[d]&&Vx(d,n,-1,r,a,h,t))return!0}return!1}Bx.prototype.visit2=m1;var qx=class{constructor(t,e,s){this.cycles=[],this.visitedLength=0,this.visitedStack=[],this.stack=[],this.idToIndex={},this.removed={},this.nodes=t,this.visited=new Uint8Array(this.nodes.length);for(let i=0;i<t.length;i++)this.idToIndex[t[i]]=i;this.adjacency=Rc(t,e,s,this.idToIndex)}getCycles(){this.visited=new Uint8Array(this.nodes.length),this.visitedStack=[];for(let t=0;t<this.nodes.length;t++)for(this.backtrack(t,t);this.visitedLength!==0;){const e=this.visitedStack.pop();e!==void 0&&this.visited[e]&&(this.visited[e]=0,this.visitedLength--)}return this.cycles}backtrack(t,e){let s=!1;this.stack.push(e),this.visited[e]||(this.visited[e]=1,this.visitedLength++),this.visitedStack.push(e);const i=this.adjacency[e]||[];for(const n of i)if(this.removed[e]=this.removed[e]||{},!this.removed[e][n]){if(n<t)this.removed[e][n]=!0;else if(n===t){s=!0;const r=[];for(let o=0,a=!1;o<this.stack.length;o++){const l=this.stack[o];t===l&&(a=!0),a&&r.push(this.nodes[l])}this.cycles.push(r)}else if(!this.visited[n]){const r=this.backtrack(t,n);s=s||r}}if(s){let n;do n=this.visitedStack.pop(),this.visited[n]&&(this.visited[n]=0,this.visitedLength--);while(n!==e)}return this.stack.pop(),s}};function y1(){return{index:{},parent:[],count:0}}function x1(t,e){t.index[e]===void 0&&(t.count+=1,t.index[e]=t.parent.push(-t.count))}function Cm(t,e){let s=t.index[e];if(s===void 0)return-1;for(;s>=0;)e=s,s=t.parent[s];return e}function b1(t,e,s){t.parent[s]=e,t.count-=1}function v1(t){return t.count<=1}function jx(t,e,s,i,n){n&&e.sort((a,l)=>n(a)-n(l));const r=[],o=y1();t.forEach(a=>x1(o,a));for(let a=0;a<e.length&&!v1(o);a++){const l=Cm(o,s(e[a])),d=Cm(o,i(e[a]));l!==d&&l>0&&d>0&&(b1(o,l,d),r.push(e[a]))}return r}function Yx({adjacency:t,directed:e=!1,normalized:s=!0}){const i=[],n=[],r={},o={},a={},l={};let d;const h=new Array(t.length),u={},c={},g={};for(let y=0;y<t.length;y++){const x=t[y];g[x.id]=x.adj,u[x.id]=!0,c[x.id]=y,e||x.adj.forEach(b=>{u[b]=!0})}const m=Object.keys(u).map(y=>+y);for(let y=0;y<m.length;y++)h[y]=0;for(let y=0;y<m.length;y++)d=m[y],_(d),p();const f=s?m.length>2?1/((m.length-1)*(m.length-2)):0:e?0:.5;if(f)for(let y=0;y<h.length;y++)h[y]*=f;return h;function p(){for(let y=0;y<m.length;y++)l[m[y]]=0;for(;n.length;){const y=n.pop(),x=(1+l[y])/a[y],b=r[y];for(let v=0;v<b.length;++v){const A=b[v];l[A]+=a[A]*x}y!==d&&(h[c[y]]+=l[y])}}function _(y){for(let x=0;x<m.length;x++){const b=m[x];r[b]=[],o[b]=-1,a[b]=0}for(o[y]=0,a[y]=1,i.push(y);i.length;){const x=i.shift();n.push(x),g[x].forEach(b=>{o[b]===-1&&(o[b]=o[x]+1,i.push(b)),o[b]===o[x]+1&&(a[b]+=a[x],r[b].push(x))})}}}var Hx=class{constructor(t){this._heap=[],this._size=0,this._keyToValue=t,this._keyToIndex=new Int32Array(t.length),this._keyToIndex.fill(-1)}add(t){let e=this._keyToIndex[t];e===-1&&(e=this._size++,this._heap[e]=t),this._keyToIndex[t]=this._bubble(e)}removeMin(){if(this._size===0)return NaN;const t=this._heap[0];return this._heap[0]=this._heap[--this._size],this._bubble(0),t}isEmpty(){return this._size===0}has(t){return this._keyToIndex[t]!==-1}_bubble(t){const e=this._indexToValue(t),s=this._getParentIndex(t),i=this._indexToValue(s);let n=t;if(t!==0&&i>e)n=this._swap(t,s);else{const r=this._getLeftChildIndex(t),o=this._getRightChildIndex(t),a=this._indexToValue(r),l=this._indexToValue(o),d=Math.min(e,a,l);d===e||(n=d===a?this._swap(t,r):this._swap(t,o))}return n===t?t:this._bubble(n)}_indexToValue(t){return t>=this._size?1/0:this._keyToValue[this._heap[t]]}_getParentIndex(t){return(t-1)/2|0}_getLeftChildIndex(t){return 2*t+1}_getRightChildIndex(t){return 2*t+2}_swap(t,e){const s=this._heap[t],i=this._heap[e];return this._heap[t]=i,this._heap[e]=s,this._keyToIndex[s]=e,this._keyToIndex[i]=t,e}},Xx=ji&&!!window.PointerEvent,wd="pointerdown",Td="pointermove",Id="pointerup",Jo="pointercancel",yr={},Wl=0,$x=t=>t.pointerType==="mouse",Wx=t=>t.pointerType!=="mouse";function A1(){if(vi&&Wl===0&&Xx){const t=document.documentElement;t.addEventListener(wd,Zx,!0),t.addEventListener(Td,Kx,!0),t.addEventListener(Id,Zl,!0),t.addEventListener(Jo,Zl,!0)}Wl++}function E1(){if(Wl--,vi&&Wl===0){const t=document.documentElement;t.removeEventListener(wd,Zx,!0),t.removeEventListener(Td,Kx,!0),t.removeEventListener(Id,Zl,!0),t.removeEventListener(Jo,Zl,!0)}}function Zx(t){yr[t.pointerId]=t}function Kx(t){yr[t.pointerId]&&(yr[t.pointerId]=t)}function Zl(t){delete yr[t.pointerId]}function Ld(t,e){t.touches=[];for(const s in yr)t.touches.push(yr[s]);t.changedTouches=[t],e(t)}function S1(t,e,s){const i=n=>{$x(n)||(Wx(n)&&n.preventDefault(),Ld(n,s))};return t(e,wd,i,!1),i}function w1(t,e,s){const i=n=>{Wx(n)&&n.preventDefault(),Ld(n,s)};return t(e,Jo,i,!1),i}function T1(t,e,s){const i=n=>{$x(n)&&n.buttons===0||Ld(n,s)};return t(e,Td,i,!1),i}function I1(t,e,s){const i=n=>Ld(n,s);return t(e,Id,i,!1),t(e,Jo,i,!1),i}function Nm(t,e,s,i){return s==="touchstart"?t(e,wd,i,!1):s==="touchmove"?t(e,Td,i,!1):s==="touchend"?(t(e,Id,i,!1),t(e,Jo,i,!1)):void 0}var Ot=class{constructor(t){this._ogma=t}_setModules(t){this._modules=t}onMounted(){}onReady(t){}destroy(t){}},L1=["graphics","legend","brand"],Jd=300,th=300,C1=200,N1=class extends Ot{constructor(){super(...arguments),this._width=Jd,this._height=th,this._resizeObserver=Jy(()=>this._resize()),this._layers={},this._focus=!1,this._container=null,this._isFullScreen=!1,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],this._onNextFramePromises=[],this._refreshUntil=0,this._currentTime=Xe(),this._timeouts=[],this._isDestroyed=!1,this._onDetachDom=[],this._isRealBrowser=xd,this._isDocumentReady=bd,this._inFrame=!1,this._mustRefresh=!1,this._nextFrame=null,this._onWindowFocus=()=>this.refresh(),this._onFullscreenChange=()=>{this._isFullScreen=yo()},this._resize=t=>{if(!this._container&&!t)return;const e=this._width,s=this._height;let i=0,n=0;if(this._container){const r=this._modules.settings.get("minimumWidth"),o=this._modules.settings.get("minimumHeight"),a=this._container.clientWidth||1,l=this._container.clientHeight||1;i=Math.max(r,t?t.width:a),n=Math.max(o,t?t.height:l)}else t&&(i=t.width,n=t.height);i===e&&n===s||(this._width=i,this._height=n,ni(this._layers,({element:r,automaticResize:o})=>{o&&Gl(r,i,n)}),this._modules.events.fire("resize",{prevWidth:e,prevHeight:s,width:i,height:n,difWidth:i-e,difHeight:n-s}))}}onMounted(){this._modules.settings.register("minimumWidth",Jd,()=>this._resize(),!1),this._modules.settings.register("minimumHeight",th,()=>this._resize(),!1),this._modules.events.register(["beforeNewFrame","frame","afterNewFrame","setContainer","resize"]),this._onDetachDom=[],A1(),this.addWindowEventListener("focus",this._onWindowFocus)}onReady(t){t.container&&this.setContainer(t.container),t.options?.width||t.options?.height?this._resize({width:t.options.width||Jd,height:t.options.height||th}):this._resize()}addWindowEventListener(t,e,s){return this._isRealBrowser&&this.addElementEventListener(window,t,e,s),this}addDirectWindowEventListener(t,e,s){this._isRealBrowser&&window.addEventListener(t,e,s)}removeDirectWindowEventListener(t,e){this._isRealBrowser&&window.removeEventListener(t,e)}addDocumentEventListener(t,e,s){return this._isDocumentReady&&this.addElementEventListener(document.documentElement,t,e,s),e}removeDocumentEventListener(t,e){this._isDocumentReady&&document.documentElement.removeEventListener(t,e)}addMediaListener(t,e){if(this._isDocumentReady&&typeof window.matchMedia=="function"){const s=window.matchMedia(t);s.addListener(e),this._onDetachDom.push(()=>s.removeListener(e))}}addElementEventListener(t,e,s,i){return this._isDestroyed||(t.addEventListener(e,s,i),this._onDetachDom.push(()=>t.removeEventListener(e,s,i))),s}detachFromDom(){this._onDetachDom.forEach(t=>t()),this._onDetachDom=[],this._emptyContainer()}setTimeout(t,e=0){const s=setTimeout(()=>{this._timeouts.splice(this._timeouts.indexOf(s),1),t()},e);return this._timeouts.push(s),s}clearTimeout(t){return t&&(clearTimeout(t),this._timeouts.splice(this._timeouts.indexOf(t),1)),null}clearAllTimeouts(){this._timeouts.forEach(clearTimeout),this._timeouts=[]}stopFrames(){this._isDestroyed=!0,this._nextFrame&&(Xy(this._nextFrame),this._nextFrame=null)}isDestroyed(){return this._isDestroyed}getDimensions(){return{width:this._width,height:this._height}}setDimensions(t){this._resize(t)}setLayer(t,e,{automaticResize:s=!1}={}){e?(e._ogmaLayer=t,s&&(e.style.position="absolute",e.style.top="0px",e.style.left="0px",Gl(e,this._width,this._height,gs())),this._layers[t]={element:e,automaticResize:s}):e===null&&delete this._layers[t],this._updateContainerContent()}setContainer(t){let e;if(typeof t=="string"){if(e=document.getElementById(t),!e)throw new Error(`unable to find DOM element with id "${t}"`)}else e=t;if(e===this._container)return;e===null&&this._emptyContainer();const s=this._container;this._isFullScreen=!1,this._container&&this._resizeObserver.unobserve(this._container),this._container=e,this._container&&(["fullscreenchange","webkitfullscreenchange"].forEach(i=>{this.addElementEventListener(this._container,i,this._onFullscreenChange)}),this._resizeObserver.observe(this._container)),this._resize(),this._updateContainerContent(),this._modules.events.fire("setContainer",{element:e,prevElement:s})}getContainer(){return this._container}appendElement(t){this._container!==null&&this._container.appendChild(t)}focus(){this._focus=!0}blur(){this._focus=!1}hasFocus(){return this._focus}forceResize(){this._resize()}_beforeOrAfterNextFrame(t){const e=t===1?this._onNextFramePromises:t===2?this._afterNextFramePromises:this._beforeNextFramePromises,s=new Promise(i=>{e.push(()=>(i(void 0),s))});return this._refresh(),s}beforeNextFrame(){return this._beforeOrAfterNextFrame(0)}onNextFrame(){return this._beforeOrAfterNextFrame(1)}afterNextFrame(){return this._beforeOrAfterNextFrame(2)}refresh(t){t&&(this._refreshUntil=Math.max(this._refreshUntil,t)),this._refresh()}_emptyContainer(){if(this._container){const t=[];for(let e=0;e<this._container.childNodes.length;++e){const s=this._container.childNodes[e];s._ogmaLayer&&t.push(s)}for(let e=0;e<t.length;++e)this._container.removeChild(t[e])}}_fillContainer(){if(this._container){const t=tx(this._container,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(this._container.style.position="relative");const e=this._container.firstChild;L1.forEach(s=>{const i=this._layers[s];i&&i.element&&this._container&&this._container.insertBefore(i.element,e)})}}_updateContainerContent(){this._emptyContainer(),this._fillContainer()}_refresh(){this._inFrame?this._mustRefresh=!0:this._nextFrame||this._isDestroyed||(this._nextFrame=mc(()=>this._playFrame()))}_playFrame(){const t=Xe(),e={elapsed:t-this._currentTime},s=this._modules.events,i=uy([this._beforeNextFramePromises,()=>s.fire("beforeNewFrame",e),()=>s.fire("frame",e),this._onNextFramePromises,()=>s.fire("afterNewFrame",e),this._afterNextFramePromises,()=>{this._inFrame=!1,(this._mustRefresh||t<this._refreshUntil+17)&&(this._mustRefresh=!1,this._refresh())}]);this._inFrame=!0,this._nextFrame=null,this._mustRefresh=!1,this._currentTime=t,this._beforeNextFramePromises=[],this._onNextFramePromises=[],this._afterNextFramePromises=[],i.reduce((n,r)=>n.then(()=>{if(!this._isDestroyed)return r()}),Promise.resolve())}isPlayingFrame(){return this._inFrame||!!this._nextFrame}setFullScreen(t){let e=Promise.resolve();return t!==this._isFullScreen?(this._container&&(e=t?M1(this._container):R1()),e.then(()=>new Promise(s=>{this.setTimeout(()=>{this._isFullScreen=yo(),s(void 0)},C1)}))):e}isFullScreen(){return yo()}debounceBeforeFrame(t){let e=!1,s=[];const i=()=>{const n=s;e=!1,s=[],t(),n.forEach(r=>r())};return()=>new Promise(n=>{s.push(n),e||(e=!0,this.beforeNextFrame().then(i))})}destroy(){this._resizeObserver.disconnect(),E1(),this.detachFromDom(),this.clearAllTimeouts(),this.stopFrames()}};function yo(){return typeof document<"u"&&!!(document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}function M1(t){return yo()?Promise.resolve():t.requestFullscreen?t.requestFullscreen():t.requestFullScreen?t.requestFullScreen():t.webkitRequestFullScreen?Promise.resolve(t.webkitRequestFullScreen()):t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():Promise.resolve()}function R1(){return yo()?typeof document>"u"?Promise.resolve():document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?Promise.resolve(document.webkitCancelFullScreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve():Promise.resolve()}var F1=class extends Ot{constructor(){super(...arguments),this._nodeChanges=[],this._edgeChanges=[],this._shouldTriggerEvents=!1}onMounted(){this._nodeDataList=this._modules.graph.createAttribute(!0,{name:"data",storage:"any"},!1),this._edgeDataList=this._modules.graph.createAttribute(!1,{name:"data",storage:"any"},!1),this._nodeList=this._modules.graph.getNodeAttribute("object"),this._edgeList=this._modules.graph.getEdgeAttribute("object"),this._modules.events.register(["setData","updateNodeData","updateEdgeData"]),this._modules.events.on("addNodes",({nodes:t,objects:e})=>this._onAddElements(t,e)).on("addEdges",({edges:t,objects:e})=>this._onAddElements(t,e)).on("beforeNewFrame",()=>{this._shouldTriggerEvents&&(this._shouldTriggerEvents=!1,this._triggerEvents())})}_onAddElements(t,e){const{isNode:s,size:i,_indexes:n}=t,r=this[s?"_nodeDataList":"_edgeDataList"];for(let o=0;o<i;++o)r.set(n[o],e[o].data)}setProperty(t,e,s,{dispatch:i=!1,virtual:n=!1}={}){this._setDataProperty(t.isNode,t._indexes,e,s,i,n),this._modules.events.fire("setData",{elements:t,virtual:n})}getProperty(t,e){return this._getDataProperty(t.isNode,t._indexes,e)}_setDataProperty(t,e,s,i,n,r){n&&typeof i=="function"&&(n=!1);const o=Mm(s),a=typeof i=="function",l=t?this._nodeList:this._edgeList,d=t?this._nodeDataList:this._edgeDataList,h=P1(t?this._nodeChanges:this._edgeChanges,o);for(let u=0;u<e.length;++u){const c=e[u];let g=d.get(c);const m=l.get(c),f=n?i[u]:i;let p,_;if(o===null)p=g,_=a?f(m):f,d.set(c,_);else{g==null&&(g={},d.set(c,g));const y=o.length;for(let x=0;x<y;x++){const b=o[x];let v=g[b];x<y-1?(v==null&&(v={},g[b]=v),g=v):(p=v,_=a?f(m):f,g[b]=_)}}h.indexes.push(c),h.previousValues.push(p),h.newValues.push(_),h.virtual=r}this._scheduleEvents()}_getDataProperty(t,e,s,i){const n=Mm(s);i||(i=new Array(e.length));const r=t?this._nodeDataList:this._edgeDataList;for(let o=0;o<e.length;++o){const a=e[o];let l,d=r.get(a);if(n!==null&&n.length)if(d==null)l=void 0;else{const h=n.length;for(let u=0;u<h&&d;++u)l=d=d[n[u]]}else l=d;i[o]=l}return i}_scheduleEvents(){this._shouldTriggerEvents=!0,this._modules.dom.refresh()}_triggerEvents(){const t=this._prepareEvtPayload(!0),e=this._prepareEvtPayload(!1);this._modules.events.fire("updateNodeData",t),this._modules.events.fire("updateEdgeData",e)}_prepareEvtPayload(t){const e=t?this._modules.graph.nodeList:this._modules.graph.edgeList,s=t?"_nodeChanges":"_edgeChanges";let i=[];const n=this[s];this[s]=[];const r=[];for(let o=0;o<n.length;++o){const{indexes:a,property:l,newValues:d,previousValues:h,virtual:u}=n[o];i=i.concat(a||[]),t?r.push({property:l,newValues:d,previousValues:h,virtual:u,nodes:e(a)}):r.push({property:l,newValues:d,previousValues:h,virtual:u,edges:e(a)})}return t?{nodes:e(i).dedupe(),isNode:t,changes:r}:{edges:e(i).dedupe(),isNode:t,changes:r}}};function P1(t,e){for(let i=0;i<t.length;++i){const n=t[i],r=n.property;if(e===null&&r===null)return n;if(e&&r&&r.length===e.length){let o=!0;for(let a=0;a<r.length;++a)if(r[a]!==e[a]){o=!1;break}if(o)return n}}const s={property:e&&e.slice(),indexes:[],previousValues:[],newValues:[],nodes:null,virtual:!1,edges:null};return t.push(s),s}function Mm(t){return typeof t=="string"?t.split("."):Ue(t)?t:null}var Ri=()=>(t,e)=>t[e],Fi=()=>(t,e,s)=>{t[e]=s},Rm={1:eh(1),2:eh(2),4:eh(4),8:Ri(),16:Ri(),32:Ri(),int8:Ri(),int16:Ri(),int32:Ri(),float:Ri(),any:Ri()},Fm={1:sh(1),2:sh(2),4:sh(4),8:Fi(),16:Fi(),32:Fi(),int8:Fi(),int16:Fi(),int32:Fi(),float:Fi(),any:Fi()};function eh(t){const e=8/t,s=(1<<t)-1;return(i,n)=>i[n/e|0]>>n%e*t&s}function sh(t){const e=8/t,s=Math.pow(2,t)-1;return(i,n,r)=>{const o=n%e*t,a=n/e|0,l=r<<o,d=255-(s-r<<o);i[a]=i[a]&d|l}}function z1(t,e){return t===void 0&&e!=="any"&&e!=="resource"?0:t}var D1={get(t){return this._getArrayElt(this._buffer,t)},set(t,e){this._setArrayElt(this._buffer,t,e)}},O1={get(t){return this._byIndex[this._getArrayElt(this._buffer,t)]},set(t,e){let s=this._byName[e];s===void 0&&(s=this._nextIndex++,this._byIndex.push(e),this._getElementBitSize()>this._elementSize&&this.increaseElementSize(),this._byName[e]=s),this._setArrayElt(this._buffer,t,s)}},k1=0,Kl=class{constructor(t){this._id=k1++,this._initialized=!1;const e=t.name,s=t.storage,i=t.size||0,n=z1(t.default,s),r=Math.max(8,Pm(i+1)),o=s==="resource"?1:s;this._name=e,this._storage=s,this._getArrayElt=Rm[o],this._setArrayElt=Fm[o],this._elementSize=o,this._nbElements=r,this._fallback=null,this._byName=void 0,this._byIndex=void 0,this._nextIndex=void 0,this._defaultValue=n,this._BASE_VALUE=s==="any"?void 0:0,this._methods=D1,this._initialized=!1,this._buffer=null,s==="resource"&&(this._methods=O1,this._byName=Object.create(null),this._byIndex=[],this._nextIndex=1,this._byName[n]=0,this._byIndex.push(n))}getValues(){return Object.keys(this._byName||{})}getName(){return this._name||""}setDefaultValue(t){this._defaultValue=t,this._storage==="resource"&&(this._byName[t]=0,this._byIndex[0]=t)}get(t){return this._get(t)}set(t,e){this._set(t,e)}_get(t){return this._defaultValue}_set(t,e){e!==this._defaultValue&&(this._initialize(),this._set(t,e))}setFallback(t){this._fallback=t,this.get=this._getWithFallback}_getWithFallback(t){const e=this._get(t);return e===void 0&&this._fallback?this._fallback.get(t):e}_initialize(){this._initialized=!0,this._buffer=ih(this._nbElements,this._elementSize),this._get=this._methods.get,this._set=this._methods.set,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(0)}grow(t){const e=Pm(t+1);if(!(e<=this._nbElements)){if(this._initialized)if(this._elementSize==="any")for(let s=this._nbElements;s<e;++s)this._buffer.push(this._defaultValue);else{const s=ih(e,this._elementSize);s.set(this._buffer),this._buffer=s,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(this._nbElements)}this._nbElements=e}}increaseElementSize(){const t=this._elementSize;if(typeof t!="number"||t===32)throw new Error("FlexArray: cannot increase element size");const e=2*t,s=Rm[e],i=Fm[e];if(this._initialized){const n=this._nbElements,r=this._getArrayElt,o=this._buffer,a=ih(n,e);if(t>=8)a.set(o);else for(let l=0;l<n;++l)i(a,l,r(o,l));this._buffer=a}this._elementSize=e,this._getArrayElt=s,this._setArrayElt=i}buffer(){if(!this._buffer)throw new Error("FlexArray: buffer not instantiated");return this._buffer}elementBitSize(){return this._elementSize}capacity(){return this._nbElements}byteSize(){return this._nbElements*this._elementSize/8}isInitialized(){return this._initialized||this._fallback&&this._fallback.isInitialized()}getMultiple(t,e){const s=t.length;e===void 0&&(e=new Array(s));for(let i=0,n=s;i<n;++i)e[i]=this.get(t[i]);return e}fill(t,e){for(let s=0,i=t.length;s<i;++s)this.set(t[s],e)}setMultiple(t,e,s){if(s||!Array.isArray(e)&&!ArrayBuffer.isView(e))for(let i=0,n=t.length;i<n;++i)this.set(t[i],e);else for(let i=0,n=t.length;i<n;++i)this.set(t[i],e[i])}reset(){return this._initialized&&this._reset(0),this}_reset(t){const e=this._storage==="resource"?0:this._defaultValue;if(this._buffer)if(typeof this._elementSize!="number"||this._elementSize>=8)this._buffer.fill(e,t);else{const s=8/this._elementSize;let i=0;for(let n=0;n<s;++n)i<<=this._elementSize,i+=e;if(t===void 0)this._buffer.fill(i);else{const n=t+(8-t%8);for(let r=t;r<n;++r)this._setArrayElt(this._buffer,r,e);this._buffer.fill(i,n/8)}}}_getElementBitSize(){if(this._nextIndex)return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))}};function Pm(t){let e=2;for(;e<t;)e*=2;return e}function ih(t,e){return e==="any"?new Array(t):e==="float"?new Float32Array(t):e==="int8"?new Int8Array(t):e==="int16"?new Int16Array(t):e==="int32"?new Int32Array(t):e===32?new Uint32Array(t):e===16?new Uint16Array(t):new Uint8Array(Math.ceil(t/8*e))}var zm=4,Qx=class{constructor(){this._buffer=new Uint32Array(zm),this._capacity=zm,this._size=0,this._busy=!1}isBusy(){return this._busy}markBusy(){return this._busy=!0,this}sliceAndReset(){this._busy=!1;const t=this.slice(0,this._size);return this.reset(),t}reset(){return this._size=0,this}reserve(t){return t>this._capacity&&this._setCapacity(Bi(t)),this}_setCapacity(t){const e=new Uint32Array(t);e.set(this._buffer),this._buffer=e,this._capacity=t}push(t){return this._size===this._capacity&&this._setCapacity(2*this._capacity),this._buffer[this._size++]=t,this}pushUnchecked(t){return this._buffer[this._size++]=t,this}slice(t=0,e=this._size){return this._buffer.slice(t,e)}getBuffer(){return this._buffer}getLength(){return this._size}getCapacity(){return this._capacity}setLength(t){return this._size=t,this}isEmpty(){return this._size===0}},Dm=class{constructor(t){this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._flexArrays=[],this._defaultValues=[],this._flexArraysByName={},this._indexLists=[],this._name=t?"node":"edge",this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._idFlexArray=new Kl({storage:"int32"}),this._idFlexArray.get=e=>this._indexToId[e],this._idFlexArray.getMultiple=e=>{const s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=this._indexToId[e[i]];return s},this._flexArraysByName.id=this._idFlexArray}addElements(t){const e=[];for(let s=0,i=t.length;s<i;++s){const n=t[s];let r=this._idToIndex[n];r===void 0&&(r=this._getNextIndex(),this._idToIndex[n]=r,this._indexToId[r]=n),e.push(r)}for(const s of this._flexArrays)s.grow(this._nextIndex);for(const s of this._indexLists)s.reserve(this._nextIndex);return new Uint32Array(e)}removeElements(t){for(let e=0,s=t.length;e<s;++e){const i=t[e],n=this._indexToId[i];n!==void 0&&(delete this._idToIndex[n],this._removeIndex(i))}}clear(){this._idToIndex=Object.create(null),this._indexToId=[void 0],this._nextIndex=1,this._freeIndexes=[];for(const t of this._flexArrays)t.reset();for(const t of this._indexLists)t.reset()}has(t){return this._indexToId[t]!==void 0}getIndex(t,e=!1){const s=this._idToIndex[t];if(s===void 0&&e)throw new Error(`${this._name} id "${t}" not found`);return s}createFlexArray(t,e){const{name:s}=t;if(s&&e&&this._flexArraysByName[s])throw new Error(`${this._name} flexArray "${s}" already exists`);let i=t.default;i===void 0&&t.storage!=="any"&&t.storage!=="resource"&&(i=0);const n=this._nextIndex,r={storage:t.storage,size:n,name:s,default:i};let o;return o=(i===void 0&&t.storage!=="any"&&t.storage,new Kl(r)),this._flexArrays.push(o),this._defaultValues.push(t.default),s&&e&&(this._flexArraysByName[s]=o),o}getFlexArray(t){return this._flexArraysByName[t]}getAllFlexArrays(){return this._flexArraysByName}createIndexList(){const t=new Qx;return t.reserve(this._nextIndex),this._indexLists.push(t),t}getId(t){return this._indexToId[t]}getMaxIndex(){return this._nextIndex-1}_removeIndex(t){this._indexesToBeFreed.push(t)}_getNextIndex(){let t=this._freeIndexes.pop();return t===void 0&&(t=this._nextIndex++),t}freeIndexes(){for(const t of this._indexesToBeFreed)this._indexToId[t]=void 0,this._freeIndexes.push(t);for(let t=0;t<this._flexArrays.length;++t){const e=this._flexArrays[t],s=this._defaultValues[t];for(const i of this._indexesToBeFreed)e.set(i,s)}this._indexesToBeFreed=[]}};function Om(t,e,s={},i={}){const n=zo(t,e,[s],i);return t.fireEvent("postAddElements",{nodes:e?n:void 0,edges:e?void 0:n,virtual:i&&i.virtual}),n.get(0)}function B1(t,{nodes:e=[],edges:s=[]},i={}){if(t.fireEvent("preAddGraph",{name:"preAddGraph"}),!i.batchSize)return Promise.all([zo(t,!0,e,i),zo(t,!1,s,i)]).then(([r,o])=>(t.fireEvent("postAddElements",{nodes:r,edges:o,virtual:i&&i.virtual}),t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{nodes:r,edges:o}),{nodes:r,edges:o}));let n;return Ql(t,!0,e,i).then(r=>(n=r,Ql(t,!1,s,i))).then(r=>({nodes:n,edges:r})).then(r=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{name:"addGraph"}),r))}function Ql(t,e,s,i={}){if(i.batchSize){const n=[];for(let a=0;a<s.length;a+=i.batchSize)n.push(s.slice(a,a+i.batchSize));const r=(a,l)=>{let d;return a.then(h=>(d=h,t.getDom().afterNextFrame())).then(()=>zo(t,e,l,i)).then(h=>d.concat(h))},o=e?t.nodeList():t.edgeList();return n.reduce(r,Promise.resolve(o)).then(a=>(t.fireEvent("postAddElements",{nodes:e?a:void 0,edges:e?void 0:a,virtual:i&&i.virtual}),a))}return Promise.resolve(zo(t,e,s,i)).then(n=>(t.fireEvent("postAddElements",{nodes:e?n:void 0,edges:e?void 0:n,virtual:i&&i.virtual}),n))}function zo(t,e,s,i){const{virtual:n=!1}=i;t.fireEvent("preAddElements",{name:"preAddElements",objects:s,virtual:n,isNode:e});const r=!!i.ignoreInvalid,o=t.storage.fetch(e),a=[],l=[],d=[],h=[],u=new Set;for(const v of s){if(typeof v!="object"||v===null||Array.isArray(v)){if(r)continue;throw new Error(`${v} is not a valid ${e?"node":"edge"}`)}const A=qS(v.id);if(!o.getIndex(A,!1)&&!u.has(A)){if(!e){const E=v,S=t.getExtremityIndex(A,E.source,0,r),w=t.getExtremityIndex(A,E.target,1,r);if(r&&(!S||!w))continue;d.push(S),h.push(w)}l.push(A),a.push(v),u.add(A)}}const c=o.addElements(l);e?t.topology.allocateNodes(c):t.topology.allocateEdges(c,d,h);const g=o.getFlexArray("object"),m=o.getFlexArray("excluded"),f=o.getFlexArray("removed"),p=o.getFlexArray("virtual"),_=e?t.node:t.edge,y=e?t.nodeList:t.edgeList,x=t.getCacheLists(e),b=y(c);for(let v=0;v<c.length;v++){const A=c[v];g.set(A,_(A))}return m.setMultiple(c,0),f.setMultiple(c,0),p.setMultiple(c,n?1:0),x.visible.invalidList(),x.all.invalidList(),x._all.invalidList(),n||x.raw.invalidList(),b.size!==0&&(e?t.fireEvent("addNodes",{virtual:n,objects:a,nodes:b}):t.fireEvent("addEdges",{virtual:n,objects:a,edges:b})),b}var km=(t,e)=>(t+e)*(t+e+1)/2+e;function Dr(t,e){const s=t<e?t:e;return 67108864*s+(t+e-s)}var U1=8,lu=class{constructor(){this._BIG_LIST=255,this._MAX_LIST_SIZE=8,this._capacity=U1,this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){return t===void 0&&(t=this._nextIndex++),t>=this._capacity&&this._reserve(t+1),this._sizes[t]=0,t}get(t){const e=this._sizes[t],s=this._MAX_LIST_SIZE*t;if(e<=this._MAX_LIST_SIZE){this._constList.length=e;for(let i=0,n=e;i<n;++i)this._constList[i]=this._buffer[s+i];return this._constList}if(e===this._BIG_LIST){const i=this._buffer[s];return this._bigLists[i]}throw new Error(`Table: ${t} out of bounds (${e})`)}size(t){const e=this._sizes[t];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=t[a],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._sizes[t],i=t*this._MAX_LIST_SIZE;if(s<this._MAX_LIST_SIZE)this._buffer[i+s]=e,this._sizes[t]=s+1;else if(s===this._BIG_LIST){const n=this._buffer[i];this._bigLists[n].push(e)}else{const n=new Array(this._MAX_LIST_SIZE);for(let r=0;r<this._MAX_LIST_SIZE;++r)n[r]=this._buffer[i+r];n.push(e),this._bigLists.push(n),this._sizes[t]=this._BIG_LIST,this._buffer[i]=this._bigLists.length-1}return this}removeFrom(t,e){return this.removeFromAndGetSize(t,e),this}removeFromAndGetSize(t,e){const s=this._MAX_LIST_SIZE*t;let i=this._sizes[t];if(i<=this._MAX_LIST_SIZE){for(let n=s,r=s+i;n<r;++n)if(this._buffer[n]===e)return i-=1,this._buffer[n]=this._buffer[r-1],this._sizes[t]=i,i}else if(i===this._BIG_LIST){const n=this._buffer[s],r=this._bigLists[n],o=r.indexOf(e);if(o!==-1)return r.splice(o,1),r.length}throw new Error('topology: Table: "removeFrom" failed, should not happen')}reserve(t){return this._capacity<t&&this._reserve(t),this}_reserve(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=Bm(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=Bm(this._sizes,this._capacity)}};function Bm(t,e){const s=new t.constructor(e);return s.set(t),s}var G1=1,V1=2,q1=3,j1=4,Y1=5,H1=6,du="_visible",hu="_data",xo="_hovered",uu="_hoverExtremityHighlighted",me="_selected",cu="_selectionExtremityHighlighted",vl="_dragged",Jx="_rewirable",fn="_export",tb="_faded",eb="_transparent",X1="_visual_groups",ta=-1,wa="in",Ta="out",nh="both",Um=[me,vl,cu,xo,uu,Jx,fn,tb,eb,X1],sb=2,ib=3,$1=3,W1=4,nb=-1,Z1=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"],Dn=void 0,K1=class{constructor(t){this._neighborTable=new lu,this._parallelTable=new lu,this._parallelEdgesIndex=[],this._hasParallelEdges=new Set,this._fakeDeduper={get:()=>0,set:Xt,reset(){return this}},this._fakeInvertedDeduper={get:()=>1,set:Xt,reset(){return this}},this._graph=t,this.nodeDeduper=t.createNodeAttribute({storage:1},!1),this.edgeDeduper=t.createEdgeAttribute({storage:1},!1),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target")}getAdjacentDirections(t){return this._neighborTable.get(t)}getEdgeIndexesInDirection(t){return this._parallelTable.get(t)}allocateNodes(t){this._neighborTable.reserve(t.length);for(let e=0;e<t.length;++e)this._neighborTable.addEntry(t[e])}allocateEdges(t,e,s){this._parallelTable.reserve(Math.floor(t.length/2));for(let i=0;i<t.length;i++){const n=t[i],r=e[i],o=s[i];this._sourceList.set(n,r),this._targetList.set(n,o),this.addToAdjacencyList(n)}}getExtremity(t,e){const s=t?this._sourceList:this._targetList;if(e.isList){const i=this._graph.acquireIndexList(!0);for(let n=0;n<e._indexes.length;n++)i.push(s.get(e._indexes[n]));return this._graph.nodeList(i.sliceAndReset())}return this._graph.getObjectList(!0).get(s.get(e._index))}setExtremities(t,e,s){for(let i=0;i<t.length;++i)this.removeFromAdjacencyList(t[i]);e!==null&&this._sourceList.setMultiple(t,e),s!==null&&this._targetList.setMultiple(t,s);for(let i=0;i<t.length;++i)this.addToAdjacencyList(t[i])}addToAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Dr(e,s);let n=this._parallelEdgesIndex[i];if(n===Dn)n=this._parallelTable.addEntry(),this._parallelEdgesIndex[i]=n,this._neighborTable.addTo(e,n),e!==s&&this._neighborTable.addTo(s,n);else{this._hasParallelEdges.add(t);const r=this._parallelTable.get(+n);if(r)for(const o of r)this._hasParallelEdges.add(o)}this._parallelTable.addTo(n,t)}hasParallelEdges(t){return this._hasParallelEdges.has(t)}removeFromAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Dr(e,s),n=this._parallelEdgesIndex[i];n!==Dn&&this._parallelTable.removeFromAndGetSize(n,t)===0&&(this._neighborTable.removeFrom(e,n),e!==s&&this._neighborTable.removeFrom(s,n),this._parallelEdgesIndex[i]=Dn,this._hasParallelEdges.delete(t))}getParallelEdges(t,e={}){const s=e.filter||"visible",i=this._graph.acquireIndexList(!1),n=this._graph.getFilter(!1,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r],a=Dr(this._sourceList.get(o),this._targetList.get(o)),l=this._parallelEdgesIndex[a];if(l!==Dn){const d=this._parallelTable.get(+l);if(d)for(const h of d)n(h)&&i.push(h)}}return this._graph.edgeList(i.sliceAndReset())}fastGetNodesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=this._neighborTable.get(o);for(const l of a){const d=this._parallelTable.get(l),h=d[0],u=i.get(h),c=n.get(h);if(u!==0&&c!==0){e.push(u+c-o);for(const g of d)s.push(g)}}}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}fastGetEdgesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=i.get(o),l=n.get(o),d=Dr(a,l),h=this._parallelEdgesIndex[d];if(h!==Dn){const u=this._parallelTable.get(+h);if(u)for(const c of u)s.push(c)}e.push(a),e.push(l)}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}getDeduper(t){return(t?this.nodeDeduper:this.edgeDeduper).reset()}collectAdjacentEdges(t,e,s,i=!1,n=!1){const r=e===wa,o=!(e===Ta||r||n),a=this._graph.acquireIndexList(!1),l=this._graph.getFilter(!1,s),d=i?this.getDeduper(!1):this._fakeDeduper;let h=this._fakeInvertedDeduper;const u=this._sourceList,c=this._targetList;if(n){h=this.getDeduper(!0);for(let g=0;g<t.length;g++)h.set(t[g],1)}for(let g=0;g<t.length;g++){const m=t[g],f=this._neighborTable.get(m);for(const p of f){const _=this._parallelTable.get(p);if(o)for(const y of _)l(y)&&d.get(y)===0&&(a.push(y),d.set(y,1));else for(const y of _){const x=u.get(y),b=c.get(y),v=x+b-m;r!==(b===m)&&x!==b||!l(y)||d.get(y)!==0||h.get(v)!==1||(a.push(y),d.set(y,1))}}}return a.sliceAndReset()}collectAdjacentNodes(t,e,s,i=!1,n,r){const o=e!==wa,a=e!==Ta,l=this._graph.acquireIndexList(!0),d=this._graph.getFilter(!1,s),h=i?this.getDeduper(!0):this._fakeDeduper,u=this._sourceList,c=this._targetList;if(n)for(let g=0;g<n.length;g++){const m=n[g];l.push(m),h.set(m,1)}if(r)for(let g=0;g<r.length;g++){const m=r[g];h.set(m,1)}for(let g=0;g<t.length;g++){const m=t[g],f=this._neighborTable.get(m);for(const p of f){const _=this._parallelTable.get(p);for(const y of _)if(d(y)){const x=u.get(y),b=c.get(y),v=x+b-m;if((a&&m===b||o&&m===x)&&h.get(v)===0){l.push(v),h.set(v,1);break}}}}return l.sliceAndReset()}getAdjacentElements(t,e,s={}){const i=s.direction||nh,n=s.filter||"visible",r=s.policy||"union",o=!!s.bothExtremities;if(t){const a=r==="include-sources"?e:null,l=r==="exclude-sources"?e:null;return this.collectAdjacentNodes(e,i,n,!0,a,l)}return this.collectAdjacentEdges(e,i,n,!0,o)}getEdgesBetweenTwoNodes(t,e){const s=Dr(t,e),i=this._parallelEdgesIndex[s];if(i===Dn)return new Uint32Array;const n=this._parallelTable.get(+i);return new Uint32Array(n)}getConnectedComponents(t,{filter:e="visible",returnIds:s=!1,internalIndexes:i=!1}={}){const n=this._graph,r=[],o={},a=n.acquireIndexList(!0);let l;typeof e=="string"?l=n.getFilter(!0,e):(l=e,e="visible");for(let u=0;u<t.length;u++){const c=t[u];l(c)&&a.push(c)}const d=a.sliceAndReset(),h={filter:e};for(let u=0;u<d.length;u++){const c=d[u];if(!o[c]){const g=[c],m=[];for(;g.length!==0;){const f=g.pop();!o[f]&&l(f)&&(g.push.apply(g,this.getAdjacentElements(!0,new Uint32Array([f]),h)),o[f]=!0,m.push(f))}m.length>0&&r.push(m)}}if(s){const u=n.getNodeAttribute("id");for(let c=0;c<r.length;c++)r[c]=u.getMultiple(r[c])}else if(!i)for(let u=0;u<r.length;u++)r[u]=n.nodeList(new Uint32Array(r[u]));return r}getAdjacencyList({directed:t,ids:e,weight:s,nodes:i}){const n=t?Ta:nh,r=new Array(i.length),o=this._graph;for(let m=0;m<i.length;++m)r[m]=this.collectAdjacentEdges(new Uint32Array([i[m]]),n,"all");const a=o.getEdgeAttribute("source"),l=o.getEdgeAttribute("target"),d=o.getEdgeAttribute("width"),h=o.getNodeAttribute("id"),u=[],c=typeof s=="number",g=typeof s!="function"&&!c&&!!s;for(let m=0;m<r.length;m++){const f=r[m],p=i[m],_=f.length,y=e?new Array(_):new Uint32Array(_),x=new Array(_);for(let v=0;v<_;v++){const A=f[v],E=a.get(A),S=l.get(A);let w=t||p===E?S:E;if(e&&(w=h.get(w)),y[v]=w,s){if(c&&(x[v]=s),typeof s=="function"){const T=o.getNode(E),L=o.getNode(S);x[v]=s(T,L)}g&&(x[v]=d.get(A)||1)}}const b={nodes:y,id:e?h.get(p):p,...s&&{weights:x}};u.push(b)}return u}degrees(t,e){if(e!==wa&&e!==Ta)return this._neighborTable.sizes(t);const s=new Array(t.length),i=e===wa;for(let n=0,r=t.length;n<r;n++)s[n]=this._degree(t[n],i);return s}_degree(t,e){const s=this._neighborTable.get(t),i=this._sourceList,n=this._targetList;let r=0;for(let o=0;o<s.length;++o){const a=this._parallelTable.get(s[o]);for(let l=0;l<a.length;++l){const d=a[l],h=i.get(d),u=n.get(d);if(e&&u===t||!e&&h===t){r+=1;break}}}return r}getDegree(t,e){const{direction:s,filter:i}=this._getDegreeOptions(e),n=new Array(t.length),r=new Uint32Array(1);for(let o=0;o<t.length;++o)r[0]=t[o],n[o]=this.collectAdjacentNodes(r,s,i).length;return n}_getDegreeOptions(t){const e={direction:nh,filter:"visible"};return typeof t=="string"?e.direction=t:t&&(typeof t.direction=="string"&&(e.direction=t.direction),typeof t.filter=="string"&&(e.filter=t.filter)),e}},Q1=class extends Ot{constructor(){super(...arguments),this.storage={nodes:new Dm(!0),edges:new Dm(!1),fetch(t){return t?this.nodes:this.edges}},this._promisesToResolve=[],this._nodeIndexLists=[],this._edgeIndexLists=[],this._onNewFrame=()=>{this.storage.nodes.freeIndexes(),this.storage.edges.freeIndexes()}}onMounted(){this._modules.events.register(["preAddElements","postAddElements","addNodes","addEdges","preAddGraph","postAddGraph","addGraph","excludedStateChange","clearGraph","afterRemoveNodes","beforeRemoveNodes","requestElementsToDelete","removeNodes","beforeRemoveEdges","afterRemoveEdges","removeEdges"]),[{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}].forEach(t=>{this.createNodeAttribute(t,!0),this.createEdgeAttribute(t,!0)}),this.node=this._ogma.node,this.edge=this._ogma.edge,this.nodeList=this._ogma.nodeList,this.edgeList=this._ogma.edgeList,this._nodes=this.createAttribute(!0,{name:"object",storage:"any"},!0),this._edges=this.createAttribute(!1,{name:"object",storage:"any"},!0),this.createAttribute(!1,{name:"source",storage:32},!0),this.createAttribute(!1,{name:"target",storage:32},!0),this._nodeFilters=Vg(this.storage.nodes),this._edgeFilters=Vg(this.storage.edges),this._initialize(),this._modules.events.on("frame",this._onNewFrame)}onReady(t){if(t.graph){const{nodes:e,edges:s}=t.graph;e&&this.addNodes(e),s&&this.addEdges(s)}}createIndexList(t){return this.storage.fetch(t).createIndexList()}getDom(){return this._modules.dom}acquireIndexList(t){const e=t?this._nodeIndexLists:this._edgeIndexLists;let s=e.find(i=>!i.isBusy());return s||(s=this.createIndexList(t),e.push(s)),s.markBusy(),s}getObjectList(t){return t?this._nodes:this._edges}getListFactory(t){return t?this.nodeList:this.edgeList}getStorage(t){return t?this.storage.nodes:this.storage.edges}getFilter(t,e){const s=t?this._nodeFilters:this._edgeFilters;return s[e]||s.visible}fireEvent(t,e){this._modules.events.fire(t,e)}getCacheLists(t){return t?this._nodeCacheLists:this._edgeCacheLists}_resolvePromises(){const t=this._promisesToResolve;this._promisesToResolve=[],t.forEach(e=>e())}_initialize(){this._nodeCacheLists=qg(()=>this.getNodeMaxIndex(),()=>this.acquireIndexList(!0),this._nodeFilters),this._edgeCacheLists=qg(()=>this.getEdgeMaxIndex(),()=>this.acquireIndexList(!1),this._edgeFilters),this.topology=new K1(this),this._resolvePromises()}getNodeMaxIndex(){return this.storage.nodes.getMaxIndex()}getEdgeMaxIndex(){return this.storage.edges.getMaxIndex()}isExcluded(t){return this.storage.fetch(t.isNode).getFlexArray("excluded").getMultiple(t._indexes)}setExcluded(t,e){const s=e?1:0,i=t.isNode,n=this.storage.fetch(i),r=n.getFlexArray("excluded"),o=n.getFlexArray("removed"),a=this.acquireIndexList(i),l=this.getListFactory(i);for(let h=0;h<t._indexes.length;h++){const u=t._indexes[h],c=r.get(u),g=o.get(u);s!==c&&g===0&&a.push(u)}const d=a.sliceAndReset();if(d.length){this.getCacheLists(t.isNode).visible.invalidList();const h=l(d);r.setMultiple(d,s),this._modules.events.fire("excludedStateChange",{elements:h,value:e})}}addNode(t,e){return Om(this,!0,t,e)}addEdge(t,e){return Om(this,!1,t,e)}addNodes(t,e){return Ql(this,!0,t,e)}addEdges(t,e){return Ql(this,!1,t,e)}addGraph(t,e){return B1(this,t,e)}getExtremityIndex(t,e,s,i){if(e instanceof Vs)return e._index;{const n=this.storage.nodes.getIndex(e);if(!n&&!i)throw new Error(`addEdge(s): invalid ${s===0?"source":"target"} for edge "${t}"; node "${e}" does not exist`);return n}}getNodes(t){return this.getElements(!0,t)}getEdges(t){return this.getElements(!1,t)}getElements(t,e){const s=t?this.nodeList:this.edgeList,i=t?Ei:Mn,n=t?Vs:Yi;if(e&&typeof e!="string"){const r=this.acquireIndexList(t),o=this.storage.fetch(t);if(e instanceof n)r.push(e._index);else if(Ue(e)){const a=e;for(const l of a)if(l instanceof n)r.push(l._index);else{const d=o.getIndex(l);d&&r.push(d)}}else if(e instanceof i){const a=this.getFilter(t,"all"),l=e;for(let d=0;d<l._indexes.length;d++){const h=l._indexes[d];a(h)&&r.push(h)}}return s(r.sliceAndReset())}{const r=e||"visible",o=this.getCacheLists(t)[r];if(!o)throw new Error(`getNodes/getEdges: unexpected argument "${r}"`);return s(o.getList())}}getNode(t){return this._getElement(!0,t)}getEdge(t){return this._getElement(!1,t)}_getElement(t,e){if(e instanceof(t?Vs:Yi))return e;const s=this.getStorage(t),i=this.getObjectList(t),n=s.getIndex(e);return n?i.get(n):void 0}clear(){this._modules.events.fire("clearGraph",{nodes:this.getNodes("all"),edges:this.getEdges("all")}),this.storage.nodes.clear(),this.storage.edges.clear(),this._initialize()}createAttribute(t,e,s=!1){return this.storage.fetch(t).createFlexArray(e,s)}createNodeAttribute(t,e){return this.createAttribute(!0,t,e)}createEdgeAttribute(t,e){return this.createAttribute(!1,t,e)}getAttribute(t,e){return this.storage.fetch(t).getFlexArray(e)}getAttributes(t,e){return e.map(s=>this.getAttribute(t,s))}getNodeAttribute(t){return this.storage.nodes.getFlexArray(t)}getNodeAttributes(t){return this.getAttributes(!0,t)}getEdgeAttribute(t){return this.storage.edges.getFlexArray(t)}getEdgeAttributes(t){return this.getAttributes(!1,t)}getAllNodeAttributes(){return this.storage.nodes.getAllFlexArrays()}getAllEdgeAttributes(){return this.storage.edges.getAllFlexArrays()}setSource(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,s._indexes,null)}setTarget(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,null,s._indexes)}getParallelEdges(t,e={}){return this.topology.getParallelEdges(t,e)}hasParallelEdges(t){return this.topology.hasParallelEdges(t._index)}getEdgesBetweenTwoNodes(t,e){return this.edgeList(this.topology.getEdgesBetweenTwoNodes(t._index,e._index))}getAdjacentDirections(t){return this.topology.getAdjacentDirections(t)}getEdgeIndexesInDirection(t){return this.topology.getEdgeIndexesInDirection(t)}fastGetNodesAdjacentElements(t){const e=this._ogma.getNodes();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:e,edges:this._ogma.getEdges()}:this.topology.fastGetNodesAdjacentElements(t._indexes)}fastGetEdgesAdjacentElements(t){const e=this._ogma.getEdges();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:this._ogma.getNodes(),edges:e}:this.topology.fastGetEdgesAdjacentElements(t._indexes)}getAdjacentNodes(t,e){return this.nodeList(this.topology.getAdjacentElements(!0,t._indexes,e))}getAdjacentEdges(t,e){return this.edgeList(this.topology.getAdjacentElements(!1,t._indexes,e))}getDegree(t,e){return this.topology.getDegree(t._indexes,e)}degrees(t,e){return this.topology.degrees(t,e)}getAdjacencyList({directed:t=!1,internalIndexes:e=!1,weight:s=1,nodes:i,indexes:n}={}){return this.topology.getAdjacencyList({directed:t,weight:s,ids:!e,nodes:n||this.getNodes(i)._indexes})}getConnectedComponents(t,e){return this.topology.getConnectedComponents(t._indexes,e)}getConnectedComponentByNode(t,e){return this.topology.getConnectedComponents(t._indexes,e)}},Fc=512,Pc=128,rb=Math.round(Math.log2(Fc)),zc=Math.round(Math.log2(Pc)),J1=rb+zc,tr=255,t2=32767,ob=65535,Ia=16384,gu=15,er=3,Jl=15,Al=32,ki=128,mu=8,fu=1/16,pu=Math.round(Math.sqrt(Jl+1)),_u=ki*pu,He=16,Hi=1,Ps=256,e2=128,s2=128,td=1.5,ab=1,xr=56,i2=16,n2=2*xr+i2,El=6,lb=3,db=3,cs=41,Cd=5,ed=5,hb=.9721,Do=24,r2=1.4142,o2=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function Dc(t,e=[0,0,0,0]){const s=o2.exec(t);return s?(e[0]=parseInt(s[1])/255,e[1]=parseInt(s[2])/255,e[2]=parseInt(s[3])/255,e[3]=s[4]===void 0?1:parseFloat(s[4]),e):null}function Sl(t){return t<16?"0"+t.toString(16):t.toString(16)}function ub([t,e,s,i=1]){return`rgba(${256*t|0},${256*e|0},${256*s|0},${i})`}function Oc(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(s,i,n,r)=>i+i+n+n+r+r);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255,1]:null}var rh=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"],Or=[0,0,0,0],Oo=new Map;Oo.set(null,[0,0,0,0]),Oo.set("transparent",[0,0,0,0]);for(let t=0;t<rh.length;t+=2){const e=rh[t].toLowerCase(),s=rh[t+1];Oo.set(e,Oc(s))}var $e=t=>{let e=Oo.get(t);if(e===void 0){const s=t+"",i=s.charAt(0)==="#"?Oc(s):Dc(s);Oo.set(t,i),e=i}return e},yu=t=>{const e=$e(t);if(!e)return null;const[s,i,n]=e;return`#${Sl(255*s)}${Sl(255*i)}${Sl(255*n)}`},Yn=t=>{let e=1,s=t;return s&&Dc(t,Or)&&(s=`rgb(${255*+Or[0]},${255*+Or[1]},${255*+Or[2]})`,e=parseFloat(Or[3].toString())),{color:s,opacity:e}},ea=class{on(e,s){if(typeof e!="string")throw new TypeError("Event name must be string");if(typeof s!="function")throw new TypeError("Event handler must be function");const i=this._events=this._events||{};return(i[e]=i[e]||[]).push(s),this}off(e,s){if(typeof e!="string")throw new TypeError("Event name must be string");const i=this._events=this._events||{},n=i[e];if(Ue(n))if(typeof s!="function")i[e]=null;else{const r=n.indexOf(s);r!==-1&&n.splice(r,1),n.length===0&&(i[e]=null)}return this}fire(e,...s){if(typeof e!="string")throw new TypeError("Event name must be string");const i=(this._events=this._events||{})[e];if(Ue(i)){const n=s;for(let r=0;r<i.length;r++){const o=i[r];o&&o.apply(this,n)}}return this}once(e,s){const i=this,n=function(...r){s.apply(i,r),i.off(e,n)};return n.handler=s,this.on(e,n)}hasListener(e,s){if(!e||!s)return!1;const i=(this._events=this._events||{})[e];if(Ue(i))for(let n=0,r=i.length;n<r;n++){const o=i[n];if(o===s||o.handler===s)return!0}return!1}clearEvents(){this._events={}}getListeners(e){return(this._events=this._events||{})[e]}};function cb(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach((s,i)=>e.push(i)),e}function gb(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach(s=>e.push(s)),e}var mb=class{constructor(){this._map=new Map}reset(){this._map.clear()}set(t,e,s){this._map.set(km(t,e),s)}get(t,e){return this._map.get(km(t,e))}},a2=class{constructor({elementSize:t,sideElementSize:e,nbSideElementsPerMainElement:s,id:i,depth:n,elementType:r,animated:o,stencilUsage:a}){this._nbCellsAllocated=0,this._nbCellsFreed=0,this._isFullyAllocated=!1,this._isFullyFreed=!1,this._mustUpdate=!0,this._capacity=Fc,this.version=0,this._id=i,this.depth=n,this.type=r,this.animated=o,this.stencilUsage=a,this.elementSize=t,this._nbSideElementsPerMainElement=s,this._totalSideElementsSize=s*e,this._byteCapacity=this._capacity*this.elementSize,this._byteArray=new Uint8Array(this._byteCapacity),this._dataView=new DataView(this._byteArray.buffer),this._sideByteCapacity=this._capacity*this._totalSideElementsSize,this._sideByteArray=new Uint8Array(this._sideByteCapacity),this._sideDataView=new DataView(this._sideByteArray.buffer)}update(){this._mustUpdate&&(this.version+=1,this._mustUpdate=!1,this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated&&(this._isFullyFreed=!0))}allocate(t){let e=-1;return!this._isFullyAllocated&&this._nbCellsAllocated+t<=this._capacity?(e=this._nbCellsAllocated,this._nbCellsAllocated+=t,this._mustUpdate=!0):this._isFullyAllocated=!0,e}free(t,e){for(let s=0;s<e;s++){const i=(t+s)*this.elementSize;this._dataView.setUint16(i,0)}this._mustUpdate=!0,this._nbCellsFreed+=e}triggerUpdate(){this._mustUpdate=!0}isEmpty(){return this._nbCellsFreed===this._nbCellsAllocated}isFullyFreed(){return this._isFullyFreed}getId(){return this._id}getDataView(){return this._dataView}getByteArray(){return this._byteArray}getSize(){return this._nbCellsAllocated}getNbSideElementsPerMainElement(){return this._nbSideElementsPerMainElement}hasSideData(){return this._nbSideElementsPerMainElement>0}getSideDataView(){return this._sideDataView}getSideByteArray(){return this._sideByteArray}getTotalSideElementsSize(){return this._totalSideElementsSize}},Gm=8,l2=class{constructor(){this.version=0,this.version=0,this._blockInfo={buffer:null,offset:0,size:0,address:0},this._init_()}reset(){this._init_()}_init_(){this._buffersByDepth=new Array(100),this._buffersById=[],this._buffersByAscendingDepth=[],this._buffersByDescendingDepth=[],this._mustUpdate=!0}_fillBlockInfo(t,e,s,i){return this._blockInfo.buffer=t,this._blockInfo.offset=e,this._blockInfo.size=s,this._blockInfo.address=i,this._blockInfo}_createBuffer(t,e,s,i,n){const r=e?n2:xr,o=this._buffersById.length,a=new a2({elementSize:r,sideElementSize:El,nbSideElementsPerMainElement:i,id:o,depth:s,elementType:t,animated:e,stencilUsage:n});return this._buffersById.push(a),a}getBlockInfo(t){return this._fillBlockInfo(this._buffersById[t>>J1],(t>>zc)%Fc,t%Pc,t)}allocateBlock(t,e,s,i,n,r,o){const a=h2(r,Gm);this._mustUpdate=!0;let l=null,d=-1;if(t){const u=this.getBlockInfo(t),c=u.buffer,g=u.offset,m=u.size,f=u.size===n,p=c.depth===i,_=c.type===e,y=c.animated===s,x=c.getNbSideElementsPerMainElement()===a,b=c.stencilUsage===o;f&&p&&_&&y&&x&&b?(c.triggerUpdate(),l=c,d=g):c.free(g,m)}if(d===-1){const u=+s,c=a/Gm,g=this._buffersByDepth[i]||Array(2);this._buffersByDepth[i]=g;const m=g[u]||[];g[u]=m;const f=m[e]||Array(16);m[e]=f;const p=f[c]||Array(4);f[c]=p;const _=p[o]||[];p[o]=_;const y=_[_.length-1];y&&(l=y,d=y.allocate(n)),d===-1&&(l=this._createBuffer(e,s,i,a,o),d=l.allocate(n),_.push(l))}const h=d2(l.getId(),d,n);return this._fillBlockInfo(l,d,n,h)}freeBlock(t){if(t){this._mustUpdate=!0;const e=this.getBlockInfo(t);e.buffer.free(e.offset,e.size)}return 0}_sortBuffersByDepth(){const t=[];for(let e=0;e<this._buffersByDepth.length;e++){const s=this._buffersByDepth[e];if(s)for(let i=0;i<s.length;i++){const n=s[i];if(n)for(let r=0;r<n.length;r++){const o=n[r];if(o)for(let a=0;a<o.length;a++){const l=o[a];if(l)for(let d=0;d<l.length;d++){const h=l[d];if(h)for(let u=0;u<h.length;u++){const c=h[u];c.update(),c.isFullyFreed()?(this._buffersById[c.getId()]=void 0,h.splice(u,1),u-=1):t.push(c)}}}}}}this._buffersByAscendingDepth=t,this._buffersByDescendingDepth=t.slice().reverse()}update(){this._mustUpdate&&(this._sortBuffersByDepth(),this.version+=1,this._mustUpdate=!1)}getBuffers(){return this._buffersById}getBuffersByAscendingDepth(){return this._buffersByAscendingDepth}getBuffersByDescendingDepth(){return this._buffersByDescendingDepth}};function d2(t,e,s){return((t<<rb)+e<<zc)+s}function h2(t,e){let s=0;for(;s<t;)s+=e;return s}var Bs=1,vn=2,sd=3,We=1,qi=2,pn=3,sa=4,An=5,En=6,Xi=7,Ls=1,Nd=2,kc=3,Bc=4,hn=5,_n=6,hr=1,fb=2,pb=3;function Vm(){return{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:We,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,bentEnable:!1,bentVertical:!1}}function qm(t={}){return t.pieceId=0,t.shape="",t.x1=0,t.y1=0,t.x2=0,t.y2=0,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=0,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=0,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern=t.pattern||{type:We,attributes:{}},t.pattern.type=We,t.opacity=1,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1,t.isSelfLoop=!1,t.isText=!1,t.adjustTextAngle=!1,t.isBadge=!1,t.bentEnable=!1,t.bentVertical=!1,t}function u2(t={}){return t.duration=0,t.beginTime=-1,t.easing="linear",t}function Uc(){return{valid:!1,id:void 0,end:Vm(),start:Vm(),animation:{duration:0,beginTime:-1,easing:"linear"}}}function _b(t,e,s,i){t.width=e*i,t.height=s*i,Nn(t,`${e}px`,`${s}px`)}function c2(t){return 1/(1+Math.exp(-t))}var g2=class{constructor(){this._capacity=Pc,this._id=0,this.size=0,this.depth=0,this.animated=!1,this.stencilUsage=hr,this.type=Bs,this._list=Array(this._capacity);for(let t=0;t<this._capacity;++t)this._list[t]=Uc()}reset(t,e,s,i){return this.type=t,this.animated=e,this.depth=s,i!==void 0&&(this._id=i),this.stencilUsage=hr,this.size=0,this}next(){if(this.size>=this._capacity)throw new Error("internal error: block.next() was called on a full block");return this._list[this.size++]}nextAndReset(){const t=this.next();return t.end=qm(t.end),t.start=qm(t.start),t.animation=u2(t.animation),t}forEach(t){this._list.forEach(t)}getElement(t){return this._list[t]}getCurrentElement(){return this._list[this.size-1]}getElements(){return this._list}getId(){return this._id}setGlobalAnimation(t,e,s){for(let i=0;i<this.size;++i){const n=this._list[i].animation;n.duration=t,n.beginTime=e,n.easing=s}}},m2=class{constructor(){this._version=0,this._initialize()}reset(){this._initialize()}_initialize(){this._mustUpdate=!0,this.maxCoord=0,this.maxScaledSize=0,this.maxMinVisibleSize=0,this.maxSymbolicSize=0,this.maxDashLength=0,this.maxGapLength=0,this.maxPatternScale=0}set({maxCoord:t,maxScaledSize:e,maxMinVisibleSize:s,maxSymbolicSize:i,maxDashLength:n,maxGapLength:r,maxPatternScale:o}){const a=this.maxCoord<t||this.maxScaledSize<e||this.maxMinVisibleSize<s||this.maxSymbolicSize<i||this.maxDashLength<n||this.maxGapLength<r||this.maxPatternScale<o;return a&&(this.maxCoord=t,this.maxScaledSize=e,this.maxMinVisibleSize=s,this.maxSymbolicSize=i,this.maxDashLength=n,this.maxGapLength=r,this.maxPatternScale=o,this._mustUpdate=!0),a}update(){return this._mustUpdate&&(this._version+=1,this._mustUpdate=!1),this}getVersion(){return this._version}},f2={linear:[0,1,0,0],quadraticIn:[0,0,1,0],quadraticOut:[0,2,-1,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]},p2=class{constructor(){this._linearEasing=[0,1,0,0,0,1,0,0],this._nameToPolygon={},this._polygonToName={},this.add(f2)}add(t){Object.keys(t).forEach(e=>{const s=t[e].slice();s.length<8&&(s[4]=s[0],s[5]=s[1],s[6]=s[2],s[7]=s[3]);const i=Vh(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);this._nameToPolygon[e]=s,this._polygonToName[i]=e})}getCoefficients(t){return this._nameToPolygon[t]||this._linearEasing}getName(t,e,s,i,n,r,o,a){const l=Vh(t,e,s,i,n,r,o,a);return this._polygonToName[l]||"linear"}},Gc=new p2;function Md(t){return typeof t=="number"&&isFinite(t)}var _2=t=>{if(t===0)return 0;if(isNaN(t))return 32256;if(!isFinite(t))return t>0?31744:64512;const e=t<0?32768:0;if((t=Math.abs(t))<6103515625e-14)return e|Math.round(4096*t);if(t>65504)return 31744|e;let s=Math.floor(Math.log2(t)),i=Math.round(1024*(t/Math.pow(2,s)-1));return i===1024&&(i=0,s++),e|s+15<<10|i},jm=t=>{const e=32768&t?-1:1,s=t>>10&31,i=1023&t;return s===0?i===0?0*e:e*Math.pow(2,-14)*(i/1024):s===31?i?NaN:e*(1/0):e*Math.pow(2,s-15)*(1+i/1024)},y2=0,x2=1,b2=2,v2=3,A2=4,E2=5,S2=6,w2=7,T2=8,I2=9,Rd=10,L2=0,yb=1,xb=2,Vc=30,bb=0,C2=1,N2=2,qc=3,M2=4,R2=5,jc=6,Fd=1e-6,ws=Math.PI,bo=2*Math.PI,vb=ws*(5/4),Ab=ws*(7/4),Eb=ws*(3/4),Sb=ws*(1/4),Ym=1.1,Hm=.07,F2=1,Xm=1,$m=.17,P2=1,z2=-ws/2,D2=ws/2,O2={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}},k2={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0},B2={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0},On=8,U2=class{constructor(t,e,s,i,n){this._littleEndian=pd(),this._maxScaledSize=0,this._maxMinVisibleSize=0,this._maxSymbolicSize=0,this._maxDashLength=0,this._maxGapLength=0,this._maxPatternScale=0,this._actualScaledSizeToBytes=t2,this._actualMinVisibleSizeToBytes=gu,this._actualSymbolicSizeToBytes=tr,this._actualDashLengthToBytes=er,this._actualGapLengthToBytes=er,this._actualPatternScaleToBytes=tr,this._genericObject=Uc(),this._shapeManager=e,this._patternManager=t,this._textManager=s,this._bufferOffsetToId=i,this._colorParser=n}resizeBoundaries(t,e,s,i,n,r){this._maxScaledSize=t,this._maxMinVisibleSize=e,this._maxSymbolicSize=s,this._maxDashLength=i,this._maxGapLength=n,this._maxPatternScale=r,this._actualScaledSizeToBytes=ob/t,this._actualMinVisibleSizeToBytes=gu/e,this._actualSymbolicSizeToBytes=tr/s,this._actualDashLengthToBytes=er/i,this._actualGapLengthToBytes=er/n,this._actualPatternScaleToBytes=tr/r}storeGenericObject(t,e,s){const i=this._shapeManager.getIdFromName(s.shape),n=s.pieceId,r=this._dashLengthToBytes(s.dashLength),o=this._gapLengthToBytes(s.gapLength),a=+s.hasHead,l=+s.hasTail,d=+s.isBodyTriangle,h=+s.isSelfLoop,u=this._patternScaleToBytes(s.patternScale),c=this._offsetAngleToBytes(s.offsetAngle),g=+s.isText,m=+s.adjustTextAngle,f=+s.isBadge,p=+s.bentEnable,_=+s.bentVertical,y=this._opacityToBytes(s.opacity),x=this._minVisibleSizeToBytes(s.globalMinVisibleSize),b=this._minVisibleSizeToBytes(s.strokeMinVisibleSize),v=this._minVisibleSizeToBytes(s.patternMinVisibleSize),A=this._symbolicSizeToBytes(s.symbolicSize),E=this._curvatureToBytes(s.curvature),S=s.pattern.attributes.colors;S&&(s.pattern.attributes.colors=S.split(";").map(Lt=>La(this._colorToBytes(Lt.trim()))).join(";"));const w=this._patternManager.getIdFromDefinition(s.pattern),T=this._colorToBytes(s.fillColor),L=this._colorToBytes(s.strokeColor),R=this._colorToBytes(s.patternColor),{x1:k,y1:j,x2:z,y2:q}=s,B=this._fixedSizeToBytes(s.rectWidthOrSourceRadiusFixed),W=this._fixedSizeToBytes(s.rectHeightOrTargetRadiusFixed),Z=this._scaledSizeToBytes(s.thicknessOrFontSizeScaled),it=this._fixedSizeToBytes(s.thicknessOrFontSizeFixed),dt=this._scaledSizeToBytes(s.strokeWidthScaled),At=this._fixedSizeToBytes(s.strokeWidthFixed),gt=this._scaledSizeToBytes(s.offsetScaled),ct=this._fixedSizeToBytes(s.offsetFixed),yt=this._fixedSizeToBytes(s.pattern.attributes.paddingTop||0),Tt=this._fixedSizeToBytes(s.pattern.attributes.paddingLeft||0),Gt=i+(n<<4)+(r<<8)+(o<<10)+(a<<12)+(l<<13)+(d<<14)+(h<<15),Vt=u+(c<<8)+(g<<11)+(m<<12)+(f<<13)+(p<<14)+(_<<15),St=y+(x<<4)+(b<<8)+(v<<12),ft=A+(E<<8),pt=s.rectWidthOrSourceRadiusScaled/this._maxScaledSize*Ia,It=s.rectHeightOrTargetRadiusScaled/this._maxScaledSize*Ia;this._setUint16(t,e+0,Gt),this._setUint16(t,e+2,Vt),this._setUint16(t,e+4,St),this._setUint16(t,e+6,ft),this._setUint16(t,e+8,w),this._setUint16(t,e+10,T),this._setUint16(t,e+12,L),this._setUint16(t,e+14,R),this._setFloat32(t,e+16,k),this._setFloat32(t,e+20,j),this._setFloat32(t,e+24,z),this._setFloat32(t,e+28,q),this._setFloat16(t,e+32,pt),this._setUint16(t,e+34,B),this._setFloat16(t,e+36,It),this._setUint16(t,e+38,W),this._setUint16(t,e+40,Z),this._setUint16(t,e+42,it),this._setUint16(t,e+44,dt),this._setUint16(t,e+46,At),this._setUint16(t,e+48,gt),this._setInt16(t,e+50,ct),this._setInt16(t,e+52,yt),this._setInt16(t,e+54,Tt)}_setUint16(t,e,s){t.setUint16(e,s,this._littleEndian)}_setFloat16(t,e,s){t.setUint16(e,_2(s),this._littleEndian)}_setInt16(t,e,s){t.setUint16(e,this._signedToUnsignedInt16(s),this._littleEndian)}_setFloat32(t,e,s){t.setFloat32(e,s,this._littleEndian)}_colorToBytes(t){const e=this._colorParser(t);return Math.round(15*e[0])+(Math.round(15*e[1])<<4)+(Math.round(15*e[2])<<8)+(Math.round(15*e[3])<<12)}_scaledSizeToBytes(t){return Math.ceil(Math.min(t,this._maxScaledSize)*this._actualScaledSizeToBytes)}_fixedSizeToBytes(t){return t}_minVisibleSizeToBytes(t){return Math.round(Math.min(t,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)}_symbolicSizeToBytes(t){return Math.round(Math.min(t,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)}_dashLengthToBytes(t){return Math.round(Math.min(t,this._maxDashLength)*this._actualDashLengthToBytes)}_gapLengthToBytes(t){return Math.round(Math.min(t,this._maxGapLength)*this._actualGapLengthToBytes)}_patternScaleToBytes(t){return Math.round(Math.min(t,this._maxPatternScale)*this._actualPatternScaleToBytes)}_offsetAngleToBytes(t){return Math.round((t+bo)%bo*(8/bo))}_opacityToBytes(t){return Math.round(15*Math.min(t,1))}_curvatureToBytes(t){return this._signedToUnsignedByte(t)}_signedToUnsignedByte(t){return Is(t,-128,127)+128}_signedToUnsignedInt16(t){return Is(t,-32768,32767)+32768}storeAnimationInformation(t,e,{beginTime:s,duration:i},n){this._setAnimationBeginTime(t,e,s),this._setAnimationDuration(t,e,i),this._setAnimationEasing(t,e,n)}_setAnimationBeginTime(t,e,s){this._setFloat32(t,e,s)}_setAnimationDuration(t,e,s){this._setFloat32(t,e+4,s)}_setAnimationEasing(t,e,s){this._setUint16(t,e+8,(s[0]+128<<8)+(s[4]+128)),this._setUint16(t,e+10,(s[1]+128<<8)+(s[5]+128)),this._setUint16(t,e+12,(s[2]+128<<8)+(s[6]+128)),this._setUint16(t,e+14,(s[3]+128<<8)+(s[7]+128))}extractGenericElement(t,e,s){const i=t.type,n=t.animated,r=t.getDataView(),o=e*t.elementSize,a=this._genericObject;if(a.valid=!1,r.getUint16(o)&&(a.valid=!0,this._extractGenericObject(a.end,r,o,s),n&&(this._extractGenericObject(a.start,r,o+xr,s),this._extractAnimationInformation(a.animation,r,o+2*xr)),a.id=this._bufferOffsetToId.get(t.getId(),e),i===vn)){const l=t.getSideDataView(),d=e*t.getTotalSideElementsSize(),h=d+t.getTotalSideElementsSize();a.end.pattern=this._textManager.extractTextFromDataView(l,d,h)}return a}_extractGenericObject(t,e,s,{bytesToActualCoord:i,bytesToActualScaledSize:n,bytesToActualMinVisibleSize:r,bytesToActualPatternScale:o,bytesToActualSymbolicSize:a,bytesToActualDashLength:l,bytesToActualGapLength:d}){const h=e,u=s,c=this._littleEndian,g=h.getUint16(u,c),m=ge(g,0,4),f=ge(g,4,8),p=ge(g,8,10),_=ge(g,10,12),y=ge(g,12,13),x=ge(g,13,14),b=ge(g,14,15),v=ge(g,15,16),A=h.getUint16(u+2,c),E=ge(A,0,8),S=ge(A,8,11),w=ge(A,11,12),T=ge(A,12,13),L=ge(A,13,14),R=ge(A,14,15),k=ge(A,15,16),j=h.getUint16(u+4,c),z=ge(j,0,4),q=ge(j,4,8),B=ge(j,8,12),W=ge(j,12,16),Z=h.getUint16(u+6,c),it=ge(Z,0,8),dt=ge(Z,8,16),At=h.getUint16(u+8,c),gt=h.getUint16(u+10,c),ct=h.getUint16(u+12,c),yt=h.getUint16(u+14,c),Tt=h.getFloat32(u+16,c),Gt=h.getFloat32(u+20,c),Vt=h.getFloat32(u+24,c),St=h.getFloat32(u+28,c),ft=h.getUint16(u+32,c),pt=h.getUint16(u+34,c),It=h.getUint16(u+36,c),Lt=h.getUint16(u+38,c),zt=h.getUint16(u+40,c),_t=h.getUint16(u+42,c),Dt=h.getUint16(u+44,c),oe=h.getUint16(u+46,c),qt=h.getUint16(u+48,c),jt=oh(h.getUint16(u+50,c)),Zt=oh(h.getUint16(u+52,c)),ie=oh(h.getUint16(u+54,c));t.pieceId=f,t.shape=this._shapeManager.getNameFromId(m),t.x1=Ks(Tt,i),t.y1=Ks(Gt,i),t.x2=Ks(Vt,i),t.y2=Ks(St,i),t.rectWidthOrSourceRadiusScaled=jm(ft)*this._maxScaledSize/Ia,t.rectWidthOrSourceRadiusFixed=pt,t.rectHeightOrTargetRadiusScaled=jm(It)*this._maxScaledSize/Ia,t.rectHeightOrTargetRadiusFixed=Lt,t.thicknessOrFontSizeScaled=Ks(zt,n),t.thicknessOrFontSizeFixed=_t,t.strokeWidthScaled=Ks(Dt,n),t.strokeWidthFixed=oe,t.offsetScaled=Ks(qt,n),t.offsetFixed=jt,t.pattern=this._patternManager.getDefinitionFromId(At),t.pattern.attributes.paddingTop=Zt,t.pattern.attributes.paddingLeft=ie,t.opacity=z/15,t.fillColor=La(gt),t.strokeColor=La(ct),t.patternColor=La(yt),t.globalMinVisibleSize=Ks(q,r),t.strokeMinVisibleSize=Ks(B,r),t.patternMinVisibleSize=Ks(W,r),t.offsetAngle=S*(2*Math.PI/8),t.patternScale=E*o,t.symbolicSize=it*a,t.curvature=G2(dt),t.dashLength=p*l,t.gapLength=_*d,t.hasHead=!!y,t.hasTail=!!x,t.isBodyTriangle=!!b,t.isSelfLoop=!!v,t.isText=!!w,t.adjustTextAngle=!!T,t.isBadge=!!L,t.bentEnable=!!R,t.bentVertical=!!k}_extractAnimationInformation(t,e,s){const i=this._littleEndian,n=e.getFloat32(s,i),r=e.getFloat32(s+4,i),o=e.getUint16(s+8,i),a=e.getUint16(s+10,i),l=e.getUint16(s+12,i),d=e.getUint16(s+14,i),h=(o>>8)-128,u=(a>>8)-128,c=(l>>8)-128,g=(d>>8)-128,m=o%256-128,f=a%256-128,p=l%256-128,_=d%256-128;t.beginTime=n,t.duration=r,t.easing=Gc.getName(h,u,c,g,m,f,p,_)}};function ge(t,e,s){return t%(1<<s)>>e}function G2(t){return t-128}function oh(t){return t-32768}function Ks(t,e){return t*e}var Wm=new Array(65535);function La(t){let e=Wm[t];if(!e){const s=ge(t,0,4)/15,i=ge(t,4,8)/15,n=ge(t,8,12)/15,r=ge(t,12,16)/15;e=`rgba(${255*s|0}, ${255*i|0}, ${255*n|0}, ${r})`,s+i+n+r===0&&(e=null),Wm[t]=e}return e}var V2={[qi]:"image",[sa]:"piechart",[pn]:"text",[An]:"icon",[En]:"badge"},q2=class{constructor(){this._pixelRatio=1,this._nextPatternId=1,this._version=0,this._init_()}reset(){this._init_()}_init_(){this._mustUpdate=!0,this._nextPatternId=1,this._patterns=[null],this._patternsByHash={},this._pixelRatio=1,this._nullPattern={id:-1,type:We,attributes:{}}}_increaseNextId(){let t=this._nextPatternId++;for(t%256==255&&(t=this._nextPatternId++);this._patterns.length<=t;)this._patterns.push(void 0);return t}_createPattern({type:t,attributes:e}){const s={id:this._increaseNextId(),type:t,attributes:this._getAttributes(t,e)};return this._patterns[s.id]=s,this._mustUpdate=!0,s}_getAttributes(t,e){return t===qi?{image:e.image,scaled:e.scaled,duplicated:e.duplicated}:t===pn||t===An||t===En?{font:e.font,size:e.size,style:e.style,text:e.text,paddingLeft:e.paddingLeft,paddingTop:e.paddingTop,align:e.align||"center",offset:e.offset||0}:t===sa&&e.colors?{colors:e.colors,colorArray:e.colors.split(";").map(s=>s.trim())}:{}}getPatternList(){return this._patterns.filter(t=>t)}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}setPixelRatio(t){t!==this._pixelRatio&&(this._pixelRatio=t,this._mustUpdate=!0)}getPixelRatio(){return this._pixelRatio}notifyUpdate(){this._mustUpdate=!0}getIdFromDefinition(t){const{type:e,attributes:s}=t,i=e===pn||e===An||e===En;let n=0;return e&&e!==We&&e!==Xi&&(e!==qi||s.image)&&(!i||s.text&&s.font)&&(n=this._addPattern(t),e===pn&&s.style==="normal"&&(s.style="bold",this._addPattern(t))),n}_addPattern(t){const e=this._getPatternHash(t);let s=this._patternsByHash[e];return s||(this._nextPatternId>65500?Vi("maximum number of pattern exceeded"):(s=this._createPattern(t).id,this._patternsByHash[e]=s)),s}_getPatternHash({type:t,attributes:e}){const s=[V2[t]];return t===qi?s.push(e.scaled?"scaled":"non-scaled",e.duplicated?"duplicated":"non-duplicated",e.image.src||e.image.toDataURL()):t===pn?s.push(e.text,e.font,e.style,e.size,e.align||"center",e.offset||0):t===An||t===En?s.push(e.text,e.font,e.style,e.size,e.paddingLeft,e.paddingTop):s.push(e.colors),s.join("+")}getDefinitionFromId(t){if(t&&this._patterns[t]){const e=this._patterns[t];if(e)return e}return this._nullPattern}getVersion(){return this._version}};function Zm(t){return t.map(({x:e,y:s,r:i=0})=>({x:e,y:s,r:i}))}var j2=class{constructor(){this._version=0,this._mustUpdate=!0,this._byName={},this._byId=new Array(Jl+1)}register(t,{getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:i,hole:n,isSimple:r}){if(this._byName[t])return;let o=r?1:mu;const a=r?mu-1:Jl;for(;this._byId[o];)o+=1;if(o>a)throw new Error("max number of shape exceeded");const l={id:o,name:t,getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:Zm(i.slice()),hole:n?Zm(n.slice()):null,isSimple:!!r};return this._mustUpdate=!0,this._byId[o]=l,this._byName[t]=l,l}updateShape(t,e){const s=this._byName[t];s&&(delete this._byId[s.id],delete this._byName[t],this.register(t,e))}getIdFromName(t){return this._byName[t].id}getNameFromId(t){const e=this._byId[t];return e?e.name:""}getDefinitionFromName(t){return this._byName[t]}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}getVersion(){return this._version}getShapeList(){return this._byId.filter(t=>t)}},xu=300,bu=150,wb=class{constructor(){this.style={},this.width=xu,this.height=bu,this.__context=new Tb,this.style={},this.width=xu,this.height=bu}get __dummy(){return!0}get parentNode(){return null}getContext(t){return t==="2d"?this.__context:null}toDataURL(t="png"){return`data:image/${t};base64,`}addEventListener(){}removeEventListener(){}getBoundingClientRect(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}}},Tb=class{constructor(){this._fontSize=10}set font(t){const e=t.match(/\d+/);e&&(this._fontSize=parseFloat(e[0]))}set fillStyle(t){}set textBaseline(t){}set textAlign(t){}set strokeStyle(t){}set lineWidth(t){}fill(){}stroke(){}clearRect(){}fillRect(){}strokeRect(){}beginPath(){}closePath(){}moveTo(){}lineTo(){}rect(){}arc(){}save(){}restore(){}clip(){}translate(){}rotate(){}fillText(){}setLineDash(){}quadraticCurveTo(){}bezierCurveTo(){}drawImage(){}measureText(t){return{width:t.length*Math.ceil(.625*this._fontSize)}}getImageData(){return{width:0,height:0,data:new Uint8ClampedArray(0)}}},Ca=Ts("canvas")||Ts("canvas-prebuilt");function Ge(t=xu,e=bu){if(vi){const i=document.createElement("canvas");return i.width=t,i.height=e,i}if(Ca){let i=null;return i="createCanvas"in Ca?Ca.createCanvas(t,e):new Ca(t,e),i.style={},i}const s=new wb;return s.width=t,s.height=e,s}function vu(t,e,s=t.width,i=t.height){e.clearRect(0,0,s,i)}function $i(t,e,s,i=""){t.font=`${i} ${s}px ${e}`}function Ib(){return Yc(Ge(),{},"webgl")!==null}var Lb=t=>{const{canvas:e,width:s,height:i}={canvas:document.createElement("canvas"),width:window.innerWidth*devicePixelRatio,height:window.innerHeight*devicePixelRatio,...t};e.width=Math.ceil(s),e.height=Math.ceil(i),e.style.width=Math.ceil(s/devicePixelRatio)+"px",e.style.height=Math.ceil(i/devicePixelRatio)+"px";const n=e.getContext("webgl2",{antialias:!0});if(!n)throw new Error("WebGL 2.0 not supported");return n},Cb=(t,e,s)=>{const i=Lb();return i.canvas.addEventListener("webglcontextlost",s),{context:i,cleanUp:()=>{i.canvas.removeEventListener("webglcontextlost",s),i.getExtension("WEBGL_lose_context")?.loseContext()}}};function Yc(t,e,s){let i=t.getContext(s,e);return i||(i=t.getContext("experimental-webgl",e)),i||null}function Hc(t,e){if(e<2)return t;const s=t.split(`
`),i=[];for(let n=0;n<s.length;++n){const r=s[n];if(r.length<e)i.push(r);else{const o=Nb(s[n],e);for(let a=0;a<o.length;++a)i.push(o[a])}}return i.join(`
`)}function Nb(t,e){const s=[""],i=t.split(" ");for(let n=0;n<i.length;n++){const r=s[s.length-1],o=i[n];r.length+1+o.length<=e&&r.length?s[s.length-1]+=(r.length>0?" ":"")+o:s.push(o)}return s}function Mb(t,e){if(t===null)return null;const s=(t=t.toString()).split(`
`),i=[];let n=0;for(let r=0;r<s.length;r++){let o=s[r];if(!e||e<=1||o.length<e)i.push(o),n=Math.max(n,o.length);else{const a=Nb(s[r],e);for(let l=0;l<a.length;l++)o=a[l],i.push(o),n=Math.max(n,o.length)}}return{data:i,maxLength:n,lines:i.length}}function Rb(){const t=Ts("@mapbox/mapbox-gl-rtl-text")||Ts("mapbox-gl-rtl-text"),e=t?t.processBidirectionalText:ji?window.processBidirectionalText:null,s=t?t.applyArabicShaping:ji?window.applyArabicShaping:null;return{processBidirectionalText:e?n=>{if(n===null||n==null)return"";const r=[];let o=0,a="";const l=n.split(`
`);for(let d=0;d<l.length;d++){const h=l[d],u=l[d].length+o;u>0&&d<l.length-1&&r.push(u),a+=d>0?""+h:h,o+=h.length}return e(a,r).join(`
`)}:n=>n,applyArabicShaping:s?n=>n==null?null:typeof n=="number"?n.toString():s(n):n=>n==null?null:n.toString()}}var ah=pd(),Na=10,Y2=1<<17,H2=65536,X2=256,Km=128,$2=25,Fb=1e3,Au=2,W2=class{constructor(t){this._patternManager=t,this._canvas=Ge(),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0}),this._processBidirectionalText=Rb().processBidirectionalText,this._cornerRadius=0,this._version=0,this._textPattern={id:0,type:Xi,attributes:{text:"",font:"",size:0,style:"normal",align:"center"},dimensions:{width:0,height:0}},this._textDimensions={width:0,height:0},this._lineWidthList=new Array(64),this._init()}_init(){this._mustClear=!1,this._clear()}reset(){this._init()}clear(){this._mustClear=!0}_measureChar(t,e,s){return $i(this._ctx,e,Do,s),this._ctx.measureText(t).width/Do}_getAtlas(t,e,s,i){const n=s===ta?0:s,r=this._byFont[t]||(this._byFont[t]={none:void 0,bold:void 0,italic:void 0,normal:void 0}),o=r[i]||(r[i]={}),a=o[e]||(o[e]=new Array(50));return a[n]||(a[n]=new Array(256))}_getMeasurementAtlas(t,e){const s=this._widthAtlases[e];return s[t]||(s[t]=new Array(256))}measureText(t,e,s,i=1){if(!e||t===null)return this._textDimensions.width=0,this._textDimensions.height=0,this._textDimensions;const n=this._getMeasurementAtlas(e,s);let r=0,o=0,a=1;for(let l=0;l<t.length;++l){const d=t.charCodeAt(l);if(d===Na)o>r&&(r=o),o=0,a+=1;else{let h=n[d];h===void 0&&(h=this._measureChar(t[l],e,s),n[d]=h),o+=h}}return o>r&&(r=o),this._textDimensions.width=r*i,this._textDimensions.height=a*i,this._textDimensions}_getCharInfo(t,e,s,i,n,r){let o=t[e];if(!o){const a=String.fromCharCode(e);o={ratio:this._measureChar(a,s,i),patternId:0},o.patternId=this._patternManager.getIdFromDefinition({id:0,type:pn,attributes:{text:a,font:s,style:i,size:n,align:r}}),t[e]=o}return o}storeTextInDataView(t,e,s,i){let n=e;if(i&&i.type===Xi){const{font:r,style:o,size:a,align:l}=i.attributes,d=l==="center",h=this._getAtlas(r,o,a,l);let u=0,c=1,g=0,m=0;const f=this._lineWidthList,p=this._processBidirectionalText(i.attributes.text);for(let b=0;b<p.length;++b){const v=p.charCodeAt(b);v===Na?(g>u&&(u=g),f[m]=g,m++,g=0,c++):g+=this._getCharInfo(h,v,r,o,a,l).ratio}f[m]=g,g>u&&(u=g),m=0;let _=-(d?f[m]:u)/2,y=(1-c)/2,x=0;for(let b=0;b<p.length;++b){const v=p.charCodeAt(b),A=h[v];if(v===Na)m+=1,_=-(d?f[m]:u)/2,y+=b===0?.5:1,x=0;else{const E=A.ratio,S=A.patternId;_+=(E+x)/2,x=E;const w=(Is(_*Fb+H2,0,Y2-1)<<8)+Is(y*Au+Km,0,X2-1);t.setUint16(n,S,ah),t.setUint32(n+2,w,ah),n+=El}}}this._fillWithZeros(t,n,s)}extractTextFromDataView(t,e,s){const i=t,n=ah,r=i.getUint16(e,n),o=this._textPattern,a=this._patternManager.getDefinitionFromId(r),{font:l,style:d,size:h,align:u}=a.attributes,c=this._getAtlas(l,d,h,u),g=[];let m=0,f=0,p=0,_=null;for(let x=e;x<s;x+=El){const b=i.getUint16(x,n);if(!b)break;const v=(i.getUint8(x+2)-Km)/Au,A=this._patternManager.getDefinitionFromId(b);if(!A||!A.attributes||!A.attributes.text)break;const E=A.attributes.text.charCodeAt(0),S=c[E];_===null?_=v:v>_&&(m>f&&(f=m),m=0,p+=1,g.push(Na),_=v),g.push(E),S&&(m+=S.ratio)}m>f&&(f=m);const y=String.fromCharCode.apply(null,g);return o.attributes.style=d,o.attributes.font=l,o.attributes.size=h,o.attributes.align=u,o.attributes.text=this._processBidirectionalText(y),o.dimensions&&(o.dimensions.width=f,o.dimensions.height=p),o}_fillWithZeros(t,e,s){for(let i=e;i<s;i+=El)t.setUint16(i,0)}_clear(){this._byFont={},this._widthAtlases={normal:{},bold:{},italic:{}}}update(){this._mustClear&&(this._clear(),this._mustClear=!1)}getVersion(){return this._version}getCornerRadius(){return this._cornerRadius}setCornerRadius(t){t!==this._cornerRadius&&(this._cornerRadius=t,this._version++)}},Xc=()=>({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),rs=class Hn{constructor(e={}){const{xValues:s=[],yValues:i=[],scaledSizeValues:n=[],fixedSizeValues:r=[]}=e;this.minX=mi(s),this.minY=mi(i),this.maxX=Qn(s),this.maxY=Qn(i),this.minScaledSize=mi(n),this.maxScaledSize=Qn(n),this.minFixedSize=mi(r),this.maxFixedSize=Qn(r),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY}reset(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.minScaledSize=1/0,this.maxScaledSize=-1/0,this.minFixedSize=1/0,this.maxFixedSize=-1/0,this.width=0,this.height=0,this.cx=0,this.cy=0,this}addPoint(e,s,i,n){if(!isFinite(e)||!isFinite(s))return this;this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s),i!==void 0&&n!==void 0&&(n==="scaled"?(this.minScaledSize=Math.min(this.minScaledSize,i),this.maxScaledSize=Math.max(this.maxScaledSize,i)):(this.minFixedSize=Math.min(this.minFixedSize,i),this.maxFixedSize=Math.max(this.maxFixedSize,i)));const r=this.maxX-this.minX,o=this.maxY-this.minY;return this.cx=this.minX+r/2,this.cy=this.minY+o/2,this.width=r,this.height=o,this}computeForZoom(e){const s=Math.max(this.maxScaledSize,this.maxFixedSize/e);return Hn.from({minX:this.minX-s/2,minY:this.minY-s/2,maxX:this.maxX+s/2,maxY:this.maxY+s/2,width:this.width+s,height:this.height+s})}static from({minX:e,minY:s,maxX:i,maxY:n,width:r,height:o}={}){const a=new Hn;return e!=null&&(a.minX=e),s!=null&&(a.minY=s),i!=null&&(a.maxX=i),n!=null&&(a.maxY=n),i!=null&&e!=null&&(a.width=r||Math.abs(i-e),a.cx=(e+i)/2),n!=null&&s!=null&&(a.height=o||Math.abs(n-s),a.cy=(s+n)/2),a.maxScaledSize=a.minScaledSize=0,a}static fromValues(e,s,i){let n=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0;h<e.length;h++){const u=e[h],c=s[h],g=i[h];u-g<n&&(n=u-g),c-g<r&&(r=c-g),u+g>o&&(o=u+g),c+g>a&&(a=c+g),g>l&&(l=g)}const d=Hn.from({minX:n,minY:r,maxX:o,maxY:a});return d.maxScaledSize=l,d}pad(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,this.width+=2*e,this.height+=2*e,this}isValid(){return isFinite(this.width)&&isFinite(this.height)}extend(e){let s,i,n,r;return e instanceof Hn?(s=e.minX,i=e.minY,n=e.maxX,r=e.maxY):Array.isArray(e)&&(s=e[0],i=e[1],n=e[2],r=e[3]),this.addPoint(s,i).addPoint(n,r)}bottomLeft(){return{x:this.minX,y:this.minY}}topRight(){return{x:this.maxX,y:this.maxY}}center(){return{x:this.cx,y:this.cy}}clone(){const e=new Hn;return e.minX=this.minX,e.minY=this.minY,e.maxX=this.maxX,e.maxY=this.maxY,e.minScaledSize=this.minScaledSize,e.maxScaledSize=this.maxScaledSize,e.minFixedSize=this.minFixedSize,e.maxFixedSize=this.maxFixedSize,e.cx=this.cx,e.cy=this.cy,e.width=this.width,e.height=this.height,e}};function Qm(t,e,s,i,n){const r=1-n;return r*r*r*t+3*n*r*r*e+3*n*n*r*s+n*n*n*i}function sr(t,e,s,i){const n=1-i;return n*n*t+2*n*i*e+i*i*s}var Z2=(t,e)=>2/(1+Math.exp(-Math.abs(t*e))),K2=5,Jm=5;function Pd(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/Jm*s)*Jm,l=-n+Math.PI,d=-n+Math.PI/2;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function zd(t,e,s,i,n,r,o,a){const l=a||{x1:0,y1:0,x2:0,y2:0};if(r){const d=c2(n);if(o){const h=d*e+(1-d)*i;l.x1=t,l.y1=h,l.x2=s,l.y2=h}else{const h=d*t+(1-d)*s;l.x1=h,l.y1=e,l.x2=h,l.y2=i}}else l.x1=t,l.y1=e,l.x2=s,l.y2=i;return l}function Rn(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,m=-u*n/K2;return o.x=a+c*m,o.y=l+g*m,o}function Dd(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(1-t)*(1-t)*e+2*(1-t)*t*r+t*t*i,a.y=(1-t)*(1-t)*s+2*(1-t)*t*o+t*t*n,a}function $c(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(2*t-2)*e+(2*i-4*r)*t+2*r,a.y=(2*t-2)*s+(2*n-4*o)*t+2*o,Lx(a)}function Pb(t,e,s,i,n,r,o,a={x:0,y:0}){return $c(t,e,s,i,n,r,s,a),$l(a.x,a.y,0,0,Math.PI/2,a),a}function zb(t,e,s,i,n,r,o,a,l,d=0,h=!1){const u=s-2*o+n,c=i-2*a+r,g=-((s-t)*c-(i-e)*u)/((2*o-2*s)*c-(2*a-2*i)*u);if(g<0||g>1)return!1;let m=l/2;h&&(m*=1-g),m+=d;const f=sr(s,o,n,g),p=sr(i,a,r,g);return Ce(f,p,t,e)<=m}function Q2(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Rn(i.x,i.y,n.x,n.y,s);return Dd(e,i.x,i.y,n.x,n.y,r.x,r.y)}function J2(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Rn(i.x,i.y,n.x,n.y,s);return Pb(e,i.x,i.y,n.x,n.y,r.x,r.y)}function tI(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Rn(i.x,i.y,n.x,n.y,s);return $c(e,i.x,i.y,n.x,n.y,r.x,r.y)}function ko(t,e,s,i,n,r,o,a,l,d={x:0,y:0}){const h=(1-t)*(1-t)*(1-t),u=3*t*(1-t)*(1-t),c=3*t*t*(1-t),g=t*t*t;return d.x=h*e+u*r+c*a+g*i,d.y=h*s+u*o+c*l+g*n,d}function Eu(t,e,s,i,n,r,o,a,l,d,h,u){let c=.5,g=Ce(t,e,s,i)<Ce(t,e,n,r)?-.01:.01,m=100;const f=ko(c,s,i,n,r,o,a,l,d);let p,_=Ce(t,e,f.x,f.y);const y=h/2+u;for(;m-- >0&&c>=0&&c<=1&&_>y&&(g>.001||g<-.001);)p=_,ko(c,s,i,n,r,o,a,l,d,f),_=Ce(t,e,f.x,f.y),_>p?(g=-g/2,c+=g):c+g<0||c+g>1?(g/=2,_=p):c+=g;return _<y}function Wc(t,e,s,i,n,r,o=Xc()){const a=t+.6666666666666666*(s-t),l=e+2/3*(i-e);return Od(t,e,a,l,a+1/3*(n-t),l+1/3*(r-e),n,r,o)}function Od(t,e,s,i,n,r,o,a,l=Xc()){const{min:d,max:h,sqrt:u}=Math;let c,g,m,f,p;l.minX=d(t,o),l.maxX=h(t,o),l.minY=d(e,a),l.maxY=h(e,a);for(let _,y,x,b,v,A,E,S=0;S<2;++S)if(S===0?(g=t,m=s,f=n,p=o):(g=e,m=i,f=r,p=a),y=6*g-12*m+6*f,_=-3*g+9*m-9*f+3*p,x=3*m-3*g,y|=0,_|=0,x|=0,_!==0)v=y*y-4*x*_,v<0||(A=(-y+u(v))/(2*_),A>0&&A<1&&(c=lh(A,g,m,f,p),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))),E=(-y-u(v))/(2*_),E>0&&E<1&&(c=lh(E,g,m,f,p),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))));else{if(y===0)continue;b=-x/y,b>0&&b<1&&(c=lh(b,g,m,f,p),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c)))}return l}function lh(t,e,s,i,n){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*s+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*n}function eI(t,e,s,i,n,r){const o=t-2*s+n,a=e-2*i+r,l=2*s-2*t,d=2*i-2*e,h=4*(o*o+a*a),u=4*(o*l+a*d),c=l*l+d*d,g=2*Math.sqrt(h+u+c),m=Math.sqrt(h),f=2*h*m,p=2*Math.sqrt(c),_=u/m;return(f*g+m*u*(g-p)+(4*c*h-u*u)*Math.log((2*m+_+g)/(_+p)))/(4*f)}var xi=class Su extends ea{constructor({bufferList:e,patternManager:s,boundariesManager:i,shapeManager:n,textManager:r,memoryManager:o}){super(),this._firstFrame=!0,this._width=0,this._height=0,this._pixelRatio=0,this._viewX=0,this._viewY=0,this._viewZoom=0,this._viewAngle=0,this._viewAngleCos=0,this._viewAngleSin=0,this._currentTime=0,this._scales={bytesToActualCoord:0,bytesToActualScaledSize:0,bytesToActualMinVisibleSize:0,bytesToActualSymbolicSize:0,bytesToActualDashLength:0,bytesToActualGapLength:0,bytesToActualPatternScale:0},this._shapesVersion=0,this._patternsVersion=0,this._boundariesVersion=0,this._textsVersion=0,this._backgroundRgba=[1,1,1,0],this._renderBackground=!1,this._hideImages=!1,this._genericObject=Uc(),this._littleEndian=pd(),this._bufferList=e,this._shapeManager=n,this._patternManager=s,this._boundariesManager=i,this._textManager=r,this._memoryManager=o}static{this.edgeArrowSizeRatio=lb}static{this.minEdgeTipSize=db}static createInitData(){return null}static getName(){return null}static isAvailable(){return!0}static setEdgeArrowSizeRatio(e){Su.edgeArrowSizeRatio=e}static setMinEdgeTipSize(e){Su.minEdgeTipSize=e}getDomElement(){return null}_initCanvas(e){e.style.touchAction="none"}export(e){return Promise.resolve()}extractElement(e,s){return this._memoryManager.extractGenericElement(e,s,this._scales)}_compareDimensions(e,s,i){return(e!==this._width||s!==this._height||i!==this._pixelRatio)&&(this._width=e,this._height=s,this._pixelRatio=i,!0)}_compareView(e,s,i,n){return(e!==this._viewX||s!==this._viewY||i!==this._viewZoom||n!==this._viewAngle)&&(this._viewX=e,this._viewY=s,this._viewZoom=i,this._viewAngle=n,this._viewAngleCos=Math.cos(n),this._viewAngleSin=Math.sin(n),!0)}_compareCurrentTime(e){return e!==this._currentTime&&(this._currentTime=e,!0)}_compareBackgroundColor(e,s){return(e!==this._backgroundColor||s!==this._renderBackground)&&(this._renderBackground=s,this._backgroundColor=e,this._backgroundRgba=$e(this._backgroundColor),!0)}_compareShapes(){return this._shapesVersion!==this._shapeManager.getVersion()&&(this._shapesVersion=this._shapeManager.getVersion(),!0)}_comparePatterns(){return this._patternsVersion!==this._patternManager.getVersion()&&(this._patternsVersion=this._patternManager.getVersion(),!0)}_compareBoundaries(){return this._boundariesVersion!==this._boundariesManager.getVersion()&&(this._boundariesVersion=this._boundariesManager.getVersion(),!0)}_compareTexts(){return this._textsVersion!==this._textManager.getVersion()&&(this._textsVersion=this._textManager.getVersion(),!0)}_compareIsDisplayableBuffer(e){return this._isBufferDisplayable!==e&&(this._isBufferDisplayable=e,!0)}_compareHideImages(e){return this._hideImages!==e&&(this._hideImages=e,!0)}renderFrame({x:e,y:s,zoom:i,angle:n,width:r,height:o,pixelRatio:a,backgroundColor:l,currentTime:d,isBufferDisplayable:h,hideImages:u,renderBackground:c}){const g=this._compareShapes(),m=this._comparePatterns(),f=this._compareBoundaries(),p=this._compareTexts(),_=this._compareDimensions(r,o,a),y=this._compareView(e,s,i,n),x=this._compareCurrentTime(d),b=this._compareBackgroundColor(l,c),v=this._compareIsDisplayableBuffer(h),A=this._compareHideImages(u);if(f){const E=this._boundariesManager,S=this._scales;S.bytesToActualCoord=1,S.bytesToActualScaledSize=E.maxScaledSize/ob,S.bytesToActualMinVisibleSize=E.maxMinVisibleSize/gu,S.bytesToActualSymbolicSize=E.maxSymbolicSize/tr,S.bytesToActualDashLength=E.maxDashLength/er,S.bytesToActualGapLength=E.maxGapLength/er,S.bytesToActualPatternScale=E.maxPatternScale/tr}this._firstFrame&&this._beforeFirstFrame(),this._render({shapesChanged:g,patternsChanged:m,boundariesChanged:f,textsChanged:p,dimensionsChanged:_,viewChanged:y,currentTimeChanged:x,backgroundColorChanged:b,isBufferDisplayableChanged:v,isHideImagesChanged:A}),this._firstFrame&&(this._afterFirstFrame(),this._firstFrame=!1)}_render(e){}_beforeFirstFrame(){}_afterFirstFrame(){}destroy(){}ensureAnimationsReady(){}getImageData(){return null}setViewportClipping(e){}};function Db(t,e,s,i,n,r,o,a=0,l=!1){const d=Ce(s,i,n,r),h=(o/2*(l?Ce(t,e,n,r)/d:1)+a)/d,u=(n-s)*h,c=(r-i)*h,g=s+c,m=i-u,f=t-g,p=e-m,_=s-c-g,y=i+u-m,x=n+c-g,b=r-u-m,v=f*_+p*y,A=f*x+p*b;return v>0&&v<_*_+y*y&&A>0&&A<x*x+b*b}function sI(t,e,s,i,n=!1){if(n&&(Ma(t,s)||Ma(t,i)||Ma(e,s)||Ma(e,i)))return!1;let r=(t.y-s.y)*(i.x-s.x)-(t.x-s.x)*(i.y-s.y);const o=(e.x-t.x)*(i.y-s.y)-(e.y-t.y)*(i.x-s.x);if(o===0)return!1;const a=r/o;r=(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y);const l=r/o;return!(a<=0||a>=1||l<=0||l>=1)}function Ma(t,e){return t.x===e.x&&t.y===e.y}function br(t,e,s,i){return Math.atan2(i-e,s-t)}function iI(t,e,s){const i=br(t.x,t.y,e.x,e.y)-br(s.x,s.y,e.x,e.y);return i<0?i+2*Math.PI:i}function nI(t,e,s,i,n,r,o,a){const l=(a-r)*(s-t)-(o-n)*(i-e);if(l===0)return null;let d=e-r;return d=((o-n)*d-(a-r)*(t-n))/l,{x:t+d*(s-t),y:e+d*(i-e)}}function so(t,e,s,i,n,r,o,a){const l=t-s,d=e-i,h=n-o,u=r-a,c=l*u-h*d,g=(d*(t-n)-l*(e-r))/c;if(g<0||g>1)return null;const m=(h*(r-e)+u*(t-n))/c;return m>=0&&m<=1?{x:t-m*l,y:e-m*d}:null}function Ob(t,e,s,i,n,r,o,a){let l;const d=[];return l=so(t,e,s,i,n,r,n,a),l&&d.push(l),l=so(t,e,s,i,n,a,o,a),l&&d.push(l),l=so(t,e,s,i,o,a,o,r),l&&d.push(l),l=so(t,e,s,i,o,r,n,r),l&&d.push(l),d}function ir(t,e,s,i,n,r,o,a){const l=((o-n)*(e-r)-(a-r)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e)),d=((s-t)*(e-r)-(i-e)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e));return l>=0&&l<=1&&d>=0&&d<=1}function Zc(t,e,s,i,n,r,o,a){return t>=n&&e>=r&&t<=o&&e<=a||s>=n&&i>=r&&s<=o&&i<=a||!!ir(t,e,s,i,n,r,n,a)||!!ir(t,e,s,i,o,r,o,a)||!!ir(t,e,s,i,n,r,o,r)||!!ir(t,e,s,i,n,a,o,a)}function kb(t,e,s){return Math.sqrt(Kc(t.x,t.y,e.x,e.y,s.x,s.y))}function Kc(t,e,s,i,n,r){const o=xl(s,i,n,r);if(o===0)return xl(t,e,s,i);let a=((t-s)*(n-s)+(e-i)*(r-i))/o;return a=Math.max(0,Math.min(1,a)),xl(t,e,s+a*(n-s),i+a*(r-i))}function Bb(t,e,s,i,n,r){const o=n-s,a=r-i;if(o===0&&a===0)return{x:s,y:i};const l=((t-s)*o+(e-i)*a)/(o*o+a*a);return l<0?{x:s,y:i}:l>1?{x:n,y:r}:{x:s+l*o,y:i+l*a}}function rI(t,e,s,i,n,r){const o=n-s,a=r-i,l=((t-s)*o+(e-i)*a)/(o*o+a*a);return{x:s+o*l,y:i+a*l}}function kd(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,m=-u*n/Cd;return o.x=a+c*m,o.y=l+g*m,o}function Qc(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/ed*s)*ed,l=-n+ws,d=ws/2-n;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function oI(t,e,s,i){const n=Math.abs(t.x-e.x-s.x+i.x)+Math.abs(t.y-e.y-s.y+i.y)<.01,r=9*(e.x-t.x)**2,o=(-243*t.x+189*e.x+51*s.x+3*i.x)**2/1e4,a=(-48*t.x+24*e.x+21*s.x+3*i.x)**2/625,l=(-147*t.x+21*e.x+99*s.x+27*i.x)**2/1e4,d=(-27*t.x-9*e.x+24*s.x+12*i.x)**2/625,h=9/16*(s.x+i.x-t.x-e.x)**2,u=9*(e.y-t.y)**2,c=(-243*t.y+189*e.y+51*s.y+3*i.y)**2/1e4,g=(-48*t.y+24*e.y+21*s.y+3*i.y)**2/625,m=(-147*t.y+21*e.y+99*s.y+27*i.y)**2/1e4,f=(-27*t.y-9*e.y+24*s.y+12*i.y)**2/625,p=9/16*(s.y+i.y-t.y-e.y)**2,_=Math.sqrt(r+u),y=Math.sqrt(o+c),x=Math.sqrt(a+g),b=Math.sqrt(l+m),v=Math.sqrt(d+f),A=Math.sqrt(h+p);if(n)return 5/2993760*(32134*_+212600*y-97050*x+544800*b-521100*v+427368*A);const E=(-12*t.x-24*e.x+9*s.x+27*i.x)**2/625,S=(-27*t.x-99*e.x-21*s.x+147*i.x)**2/1e4,w=(-3*t.x-21*e.x-24*s.x+48*i.x)**2/625,T=(-3*t.x-51*e.x-189*s.x+243*i.x)**2/1e4,L=9*(i.x-s.x)**2,R=(-12*t.y-24*e.y+9*s.y+27*i.y)**2/625,k=(-27*t.y-99*e.y-21*s.y+147*i.y)**2/1e4,j=(-3*t.y-21*e.y-24*s.y+48*i.y)**2/625,z=(-3*t.y-51*e.y-189*s.y+243*i.y)**2/1e4,q=9*(i.y-s.y)**2,B=Math.sqrt(E+R),W=Math.sqrt(S+k),Z=Math.sqrt(w+j),it=Math.sqrt(T+z);return 5/2993760*(16067*(_+Math.sqrt(L+q))+106300*(y+it)-48525*(x+Z)+272400*(b+W)-260550*(v+B)+427368*A)}var aI={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}},lI=[{name:"topLeft",dx:-1,dy:-1,cornerIndex:2},{name:"topRight",dx:1,dy:-1,cornerIndex:3},{name:"bottomLeft",dx:-1,dy:1,cornerIndex:1},{name:"bottomRight",dx:1,dy:1,cornerIndex:0}],gi={x:0,y:0};function dI(t,e,s,i,n,r,o,a,l,d,h,u){r=r||o.getNodes()._indexes;const c=l.getZoom(),g=o.getObjectList(!0),m=a.getFlexArrays().nodes.current;let f=1/0,p=0,_=-1/0;a.update();for(let y=0;y<r.length;++y){const x=r[y];if(m.excluded.get(x)||!m.detectable.get(x)||h.has(x))continue;const b=m.x.get(x),v=m.y.get(x),A=m.layer.get(x);if(A<_)continue;gi.x=b,gi.y=v;const E=l.graphToScreenCoordinates(gi),S=E.x,w=E.y,T=m.shape.get(x),L=m.scalingMethod.get(x)==="scaled",R=m.radius.get(x)*(L?c:1),k=R+n,j=(t-S)/k,z=(e-w)/k;if(gi.x=t,gi.y=e,!(i&&Ub(gi,x,a,l,d)))if(d.checkShapeHit(T,j,z)){const q=o.getAttribute(!0,"virtual").get(x)!==0;if(k>f&&q)continue;f=k}else{if(!s)continue;{const q=u(m.text.content.get(x)||null),B=m.textHidden.get(x),W=m.text.minVisibleSize.get(x);if(B||!q||(L?2*R:1/0)<W)continue;const Z=Hc(q,m.text.maxLineLength.get(x)),it=m.innerStroke.width.get(x),dt=m.text.margin.get(x),At=m.text.padding.get(x),gt=m.text.size.get(x),ct=m.text.scale.get(x),yt=m.text.scaling.get(x),Tt=m.text.font.get(x),Gt=m.text.style.get(x),Vt=m.text.position.get(x),St=d.measureText(Z,Tt,Gt,1),ft=yt?ct*R*2:gt,pt=St.width*ft/2+At,It=St.height*ft/2+At,Lt=aI[Vt],zt=it+dt+R,_t=S+(zt+pt)*Lt.x,Dt=w+(zt+It)*Lt.y;if(t<=_t-pt||t>=_t+pt||e<=Dt-It||e>=Dt+It)continue}}p=x,_=A}return g.get(p)||null}function Ub(t,e,s,i,n){const r=s.getFlexArrays().nodes.current,o=i.getZoom(),a=r.scalingMethod.get(e)==="scaled",l=r.radius.get(e)*(a?o:1),d=r.x.get(e),h=r.y.get(e),u=r.radius.get(e);for(let c=0;c<4;c++){const{name:g,cornerIndex:m}=lI[c],f=(r.badges[g].stroke.width.get(e),r.badges[g].scalingMethod.get(e)==="fixed"),p=r.badges[g].scale.get(e),_=(r.badges[g].stroke.scalingMethod.get(e),f?Math.min(p*l,r.radius.get(e)*p):p*l);r.badges[g].scale.get(e);const y=r.badges[g].minVisibleSize.get(e)/2,x=r.badges[g].positionScale.get(e);if(!r.badges[g].text.content.get(e)&&!r.badges[g].image.url.get(e)||_<y)continue;const b=i.graphToScreenCoordinates({x:d+u*x*i.getCornerCos(m),y:h+u*x*i.getCornerSin(m)}),{x:v,y:A}=b,E=(t.x-v)/_,S=(t.y-A)/_;if(n.checkShapeHit("circle",E,S))return g}}function hI(t,e,s,i,n,r,o,a,l,d,h){n=n||r.getEdges()._indexes;const u=r.getObjectList(!1),c=l.getFlexArrays(),g=c.edges.current,m=c.nodes.current,f=o.getZoom(),p=o.getAngle(),_=Math.cos(p),y=Math.sin(p),x=i/f;gi.x=t,gi.y=e;const b=o.screenToGraphCoordinates(gi),v=b.x,A=b.y;let E=0;l.update();for(let S=0;S<n.length;++S){const w=n[S],T=g.source.get(w),L=g.target.get(w),R=g.excluded.get(w),k=g.detectable.get(w),j=a.has(T),z=a.has(L);if(R||!k||j||z)continue;const q=T===L,B=g.curvature.get(w),W=g.shape.body.get(w)==="triangle",Z=g.scalingMethod.get(w)==="scaled",it=g.width.get(w)/(Z?1:f),dt=m.x.get(T),At=m.y.get(T),gt=m.x.get(L),ct=m.y.get(L);if(q){const yt=m.scalingMethod.get(T)==="scaled",Tt=Qc(dt,At,B,m.radius.get(T)/(yt?1:f),0);if(!Eu(v,A,dt,At,dt,At,Tt.x1,Tt.y1,Tt.x2,Tt.y2,it,x))continue}else if(d){const yt=zd(dt*_-At*y,At*_+dt*y,gt*_-ct*y,ct*_+gt*y,B,d,h);if(!Eu(v,A,dt,At,gt,ct,yt.x1*_+yt.y1*y,yt.y1*_-yt.x1*y,yt.x2*_+yt.y2*y,yt.y2*_-yt.x2*y,it,x))continue}else if(B!==0){const yt=kd(dt,At,gt,ct,B);if(!zb(v,A,dt,At,gt,ct,yt.x,yt.y,it,x,W))continue}else if(!Db(v,A,dt,At,gt,ct,it,x,W))continue;E=w}return u.get(E)||null}function uI(t){const e=t.getNodeAttribute("radius"),s=t.getEdgeAttribute("width"),i=t.getNodes(),n=t.getEdges();let r=0,o=0;for(let a=0;a<i._indexes.length;a++){const l=i._indexes[a],d=e.get(l);d>r&&(r=d)}for(let a=0;a<n._indexes.length;a++){const l=n._indexes[a],d=s.get(l);d>o&&(o=d)}return Math.max(2*r,o)}function cI(t){return t===null?"none":t==="webgl"?"WebGL":t==="svg"?"SVG":t==="canvas"?"Canvas":t}function Gb(t,e,s,i){const n=(t-e)/s,r=n*n,o=r*n,a=Gc.getCoefficients(i),l=n<.5?0:4;return Is(a[l]+a[l+1]*n+a[l+2]*r+a[l+3]*o,0,1)}function io(t,e,s,i){if(t===e)return t;const[n,r,o,a]=$e(t),[l,d,h,u]=$e(e);return`rgba(${Math.round(255*ne(n,l,s))},${Math.round(255*ne(r,d,s))},${Math.round(255*ne(o,h,s))},${ne(a,u,i)})`}function gI(t,e){const[s,i,n,r]=$e(t);return`rgba(${255*s},${255*i},${255*n},${r*e})`}var tf=1/cs,Vb=class extends xi{constructor(t){super(t),this._cachePoints=[],this._nextCachePoint=0,this._tmp={x1:0,y1:0,x2:0,y2:0},this._ccp={x1:0,y1:0,x2:0,y2:0},this._pointCopies=Array(128),this._clipViewport=!0}_resetCachePoints(){this._nextCachePoint=0}_point(t,e){let s=this._cachePoints[this._nextCachePoint++];return s||(s={x:0,y:0},this._cachePoints.push(s)),s.x=t,s.y=e,s}setViewportClipping(t){this._clipViewport=t}_displayBuffer(t){const e=t.getSize(),s=t.animated;for(let i=0;i<e;++i){const n=this.extractElement(t,i);n.valid&&this._displayElement(n,s)}}_mixAttributes(t,e,s){const i=Gb(this._currentTime,s.beginTime,s.duration,s.easing);return t.dashLength=ne(e.dashLength,t.dashLength,i),t.gapLength=ne(e.gapLength,t.gapLength,i),t.offsetAngle=ne(e.offsetAngle,t.offsetAngle,i),t.opacity=ne(e.opacity,t.opacity,i),t.globalMinVisibleSize=ne(e.globalMinVisibleSize,t.globalMinVisibleSize,i),t.strokeMinVisibleSize=ne(e.strokeMinVisibleSize,t.strokeMinVisibleSize,i),t.patternMinVisibleSize=ne(e.patternMinVisibleSize,t.patternMinVisibleSize,i),t.symbolicSize=ne(e.symbolicSize,t.symbolicSize,i),t.curvature=ne(e.curvature,t.curvature,i),t.fillColor=io(e.fillColor,t.fillColor,i,i),t.strokeColor=io(e.strokeColor,t.strokeColor,i,i),t.patternColor=io(e.patternColor,t.patternColor,i,i),t.x1=ne(e.x1,t.x1,i),t.y1=ne(e.y1,t.y1,i),t.x2=ne(e.x2,t.x2,i),t.y2=ne(e.y2,t.y2,i),t.rectWidthOrSourceRadiusScaled=ne(e.rectWidthOrSourceRadiusScaled,t.rectWidthOrSourceRadiusScaled,i),t.rectWidthOrSourceRadiusFixed=ne(e.rectWidthOrSourceRadiusFixed,t.rectWidthOrSourceRadiusFixed,i),t.rectHeightOrTargetRadiusScaled=ne(e.rectHeightOrTargetRadiusScaled,t.rectHeightOrTargetRadiusScaled,i),t.rectHeightOrTargetRadiusFixed=ne(e.rectHeightOrTargetRadiusFixed,t.rectHeightOrTargetRadiusFixed,i),t.thicknessOrFontSizeScaled=ne(e.thicknessOrFontSizeScaled,t.thicknessOrFontSizeScaled,i),t.thicknessOrFontSizeFixed=ne(e.thicknessOrFontSizeFixed,t.thicknessOrFontSizeFixed,i),t.strokeWidthScaled=ne(e.strokeWidthScaled,t.strokeWidthScaled,i),t.strokeWidthFixed=ne(e.strokeWidthFixed,t.strokeWidthFixed,i),t.offsetScaled=ne(e.offsetScaled,t.offsetScaled,i),t.offsetFixed=ne(e.offsetFixed,t.offsetFixed,i),t}_computeRenderInfo(t){const e=this._viewZoom,s=this._point(t.x1,t.y1),i=this._point(t.x2,t.y2),n=t.isBadge,r=n&&t.rectWidthOrSourceRadiusScaled&&t.rectWidthOrSourceRadiusFixed,o=r?Math.min(t.rectWidthOrSourceRadiusScaled*e,t.rectWidthOrSourceRadiusFixed):t.rectWidthOrSourceRadiusScaled*e+t.rectWidthOrSourceRadiusFixed,a=r?o:t.rectHeightOrTargetRadiusScaled*e+t.rectHeightOrTargetRadiusFixed,l=t.symbolicSize===0?1/0:t.symbolicSize*e;return{shape:this._shapeManager.getDefinitionFromName(t.shape),pieceId:t.pieceId,dashLength:t.dashLength,gapLength:t.gapLength,hasHead:t.hasHead,hasTail:t.hasTail,isBodyTriangle:t.isBodyTriangle,isSelfLoop:t.isSelfLoop,patternScale:t.patternScale,offsetAngle:ql(t.offsetAngle),isText:t.isText,adjustTextAngle:t.adjustTextAngle,isBadge:n,bentEnable:t.bentEnable,bentVertical:t.bentVertical,opacity:t.opacity,globalMinVisibleSize:t.globalMinVisibleSize,strokeMinVisibleSize:t.strokeMinVisibleSize,patternMinVisibleSize:t.patternMinVisibleSize,symbolicSize:l,curvature:t.curvature,pattern:t.pattern,fillColor:t.fillColor,strokeColor:t.strokeColor,patternColor:t.patternColor,pos1OnGraph:s,pos2OnGraph:i,pos1:this._graphToScreenCoordinates(s),pos2:this._graphToScreenCoordinates(i),rectWidthOrSourceRadius:o,rectHeightOrTargetRadius:a,thicknessOrFontSize:t.thicknessOrFontSizeScaled*e+t.thicknessOrFontSizeFixed,strokeWidth:t.strokeWidthScaled*e+t.strokeWidthFixed,offset:t.offsetScaled*e+t.offsetFixed}}_applyBackgroundBlending(t){t.opacity!==1&&(t.fillColor=this._blendColor(t.fillColor,t.opacity),t.strokeColor=this._blendColor(t.strokeColor,t.opacity),t.textColor=this._blendColor(t.textColor,t.opacity))}_pointArray(t){let e=this._pointCopies[t];if(!e){e=new Array(t),this._pointCopies[t]=e;for(let s=0;s<t;++s)e[s]={x:0,y:0,r:0}}return e}_scalePoints(t,e,s,i){const n=t.shape.points.length,r=this._pointArray(n);for(let l=0;l<n;++l){const d=t.shape.points[l],h=r[l];h.x=e.x+d.x*s,h.y=e.y+d.y*i,h.r=d.r*s}const o=t.pos2OnGraph.x-t.pos1OnGraph.x,a=t.pos2OnGraph.y-t.pos1OnGraph.y;if(o!==0||a!==0){const l=Math.sqrt(o*o+a*a),d=o/l,h=a/l;for(const u of r){const c=u.x-e.x,g=u.y-e.y;u.x=e.x+d*c+h*g,u.y=e.y-h*c+d*g}}return r}_drawPoints(t,e=!1){t.length===1?this._drawCircle(t[0],t[0].r):this._drawPolygon(t,e)}_computeCenter(t){const e=Math.cos(t.offsetAngle),s=Math.sin(t.offsetAngle),i=(t.pos1.x+t.pos2.x)/2+e*t.offset,n=(t.pos1.y+t.pos2.y)/2+s*t.offset;return this._point(i,n)}_displayTextBox(t,e,s,i){const n=this._computeCenter(t),r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2;(e||i)&&this._drawRoundedRectangle(n,r,o,0,t.fillColor)}_displayNodeComponent(t,e,s,i){const n=this._computeCenter(t);if(t.pattern.type!==Xi){const r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2,a=this._scalePoints(t,n,r,o);if((e||i)&&this._drawPoints(a,!0),e&&this._fill(t.fillColor),i){if(this._startClip(),t.pattern.type===sa){let l=t.pattern.attributes.colorArray;t.opacity!==1&&(l=l.map(d=>this._blendColor(d,t.opacity))),this._displayPieChart(n,r,l)}else if(t.pattern.type===An||t.pattern.type===En){const d=Math.round(t.rectHeightOrTargetRadius*t.patternScale),h=t.pattern.attributes.text,u=this._blendColor(t.patternColor,t.opacity),c=t.pattern.attributes.font,g=t.pattern.attributes.style,m=t.pattern.attributes.align,f=t.rectWidthOrSourceRadius,p=t.pattern.attributes.paddingTop,_=t.pattern.attributes.paddingLeft;this._displayText(n,0,h,u,c,d,g,m,f,_,p,!0)}else if(t.pattern.type===qi){const l=t.pattern.attributes.image;if(l.isDummy||l.width&&l.height){const d=t.pattern.attributes.duplicated,h=d?1:t.patternScale,u=t.rectWidthOrSourceRadius*h,c=t.rectHeightOrTargetRadius*h,g=t.pattern.attributes.scaled,m=t.opacity;this._displayImage(n,u,c,l,g,d,m)}}this._endClip()}if(s){const l=t.strokeWidth/2,d=this._scalePoints(t,n,r+l,o+l);this._drawPoints(d),this._stroke(t.strokeColor,t.strokeWidth)}}else if(i){const o=t.thicknessOrFontSize,a=t.pattern.attributes.text,l=this._blendColor(t.patternColor,t.opacity),d=t.pattern.attributes.font,h=t.pattern.attributes.style,u=t.pattern.attributes.align,c=t.rectWidthOrSourceRadius;this._displayText(n,0,a,l,d,o,h,u,c,0,0,!1)}}_displayElement(t,e){if(!t.end||!t.end.shape||!t.end.pieceId||e&&(!t.start||!t.animation))return;this._resetCachePoints();const s=e?this._mixAttributes(t.end,t.start,t.animation):t.end,i=this._computeRenderInfo(s);if(i.symbolicSize<i.globalMinVisibleSize||i.opacity===0)return;this._applyBackgroundBlending(i);const n=!!(i.strokeColor&&i.strokeWidth>0&&i.symbolicSize>=i.strokeMinVisibleSize),r=i.pattern.type!==We&&i.symbolicSize>=i.patternMinVisibleSize,o=!!i.fillColor;if(i.pieceId===Ls)return this._displayNodeComponent(i,o,n,r);if(i.pieceId===_n)return this._displayTextBox(i,o,n,r);const a=i.pos2.x-i.pos1.x,l=i.pos2.y-i.pos1.y,d=Math.sqrt(a*a+l*l);let h,u=null,c=null;if(i.bentEnable&&!i.isSelfLoop)this._tmp.x1=i.pos1.x,this._tmp.y1=i.pos1.y,this._tmp.x2=i.pos2.x,this._tmp.y2=i.pos2.y,i.pos1.x=this._tmp.x1*this._viewAngleCos-this._tmp.y1*this._viewAngleSin,i.pos1.y=this._tmp.y1*this._viewAngleCos+this._tmp.x1*this._viewAngleSin,i.pos2.x=this._tmp.x2*this._viewAngleCos-this._tmp.y2*this._viewAngleSin,i.pos2.y=this._tmp.y2*this._viewAngleCos+this._tmp.x2*this._viewAngleSin,zd(i.pos1.x,i.pos1.y,i.pos2.x,i.pos2.y,i.curvature,i.bentEnable,i.bentVertical,this._ccp),i.pos1.x=this._tmp.x1,i.pos1.y=this._tmp.y1,i.pos2.x=this._tmp.x2,i.pos2.y=this._tmp.y2,this._tmp.x1=this._ccp.x1,this._tmp.y1=this._ccp.y1,this._tmp.x2=this._ccp.x2,this._tmp.y2=this._ccp.y2,this._ccp.x1=this._tmp.x1*this._viewAngleCos+this._tmp.y1*this._viewAngleSin,this._ccp.y1=this._tmp.y1*this._viewAngleCos-this._tmp.x1*this._viewAngleSin,this._ccp.x2=this._tmp.x2*this._viewAngleCos+this._tmp.y2*this._viewAngleSin,this._ccp.y2=this._tmp.y2*this._viewAngleCos-this._tmp.x2*this._viewAngleSin,u=this._point(this._ccp.x1,this._ccp.y1),c=this._point(this._ccp.x2,this._ccp.y2),h=oI(i.pos1,u,c,i.pos2);else if(i.isSelfLoop){const g=i.pieceId===hn||i.pieceId===hn+_n?i.strokeWidth/2:i.rectWidthOrSourceRadius,{x1:m,y1:f,x2:p,y2:_}=this._getSelfLoopControlPoints(i.pos1,i.curvature,g);u=this._point(m,f),c=this._point(p,_),h=fI(i.pos1,u,c,i.pos2,1)}else i.curvature?(u=this._getQuadraticCurveControlPoint(i),h=mI(i.curvature,d,1)):h=d;if(i.pieceId===hn||i.pieceId===hn+_n){const g=i.strokeWidth,m=this._getPointOnLine(i.pos1,u,c,i.pos2,.5),f=this._getTangentOnLine(i.pos1,u,c,i.pos2,.5);if(i.rectWidthOrSourceRadius>=h-g&&!i.isSelfLoop){if(!i.adjustTextAngle)return;f.x=1,f.y=0}let p=-Math.atan2(f.y,f.x);const _=ql(i.offsetAngle-p);(!i.isSelfLoop&&_<0||i.isSelfLoop&&i.offsetAngle<0)&&(f.x*=-1,f.y*=-1),(p>Math.PI/2||p<-Math.PI/2)&&(p+=Math.PI);const y=this._getOrthogonal(f),x=m.x+y.x*i.offset,b=m.y+y.y*i.offset;if(i.pieceId===hn+_n){if(!i.fillColor)return;const v=i.rectWidthOrSourceRadius/2,A=i.rectHeightOrTargetRadius/2;this._drawRoundedRectangle(this._point(x,b),v,A,_+Math.PI/2,i.fillColor)}else{const v=this._point(x,b),A=p,E=i.thicknessOrFontSize,S=i.pattern.attributes.text,w=this._blendColor(i.patternColor,i.opacity),T=i.pattern.attributes.font,L=i.pattern.attributes.style,R=i.pattern.attributes.align,k=i.rectWidthOrSourceRadius;this._displayText(v,A,S,w,T,E,L,R,k,0,0,!1)}}else{const g=i.pieceId===kc,m=i.pieceId===Bc,f=Math.cos(i.offsetAngle),p=Math.sin(i.offsetAngle);i.pos1.x+=f*i.offset,i.pos1.y+=p*i.offset,i.pos2.x+=f*i.offset,i.pos2.y+=p*i.offset;const _=i.shape.name==="line",y=i.thicknessOrFontSize,x=i.rectWidthOrSourceRadius,b=i.rectHeightOrTargetRadius,v=+i.hasHead,A=+i.hasTail,E=Math.max(xi.minEdgeTipSize,y*xi.edgeArrowSizeRatio),S=v*Math.min(5*x,E),w=A*Math.min(5*b,E),T=i.isSelfLoop?1/0:d-x-b,L=Math.min(0,T-S-w)/2,R=y/2;let k=x>R?x-Math.sqrt(x*x-R*R):R;const j=Math.max(x+w+A*L,0)-(1-v)*k;k=x>R?b-Math.sqrt(b*b-R*R):R;const z=Math.max(b+S+v*L,0)-(1-A)*k;if(g||m){const q=m?-1:1,B=(g?h-z:j)-q;let W=null,Z=null;if((i.bentEnable||i.isSelfLoop)&&u&&c){const it=this._getTFromLengthOnCubicCurve(i.pos1,u,c,i.pos2,(g?z:j)+1+i.strokeWidth/2,m);W=this._getPointOnCubicCurve(i.pos1,u,c,i.pos2,it),Z=this._getTangentOnCubicCurve(i.pos1,u,c,i.pos2,it)}else if(i.curvature&&u){const it=this._getTFromLengthOnQuadraticCurve(i.pos1,u,i.pos2,B-i.strokeWidth/2*q);W=this._getPointOnQuadraticCurve(i.pos1,u,i.pos2,it),Z=this._getTangentOnQuadraticCurve(i.pos1,u,i.pos2,it)}else{const it=B/h;W=this._mixPoints(i.pos1,i.pos2,it),Z=this._point(a/d,l/d)}if(Z.x*=q,Z.y*=q,o){if(i.shape.hole){const dt=this._makeEdgeExtremityPoints(W,Z,E,i.shape.hole);this._drawPoints(dt),this._startReverseClip()}const it=this._makeEdgeExtremityPoints(W,Z,E,i.shape.points);this._drawPoints(it),this._fill(i.fillColor),i.shape.hole&&this._endReverseClip()}if(n){if(i.shape.hole){const At=this._makeEdgeExtremityPoints(W,Z,E,i.shape.hole);this._drawPoints(At),this._stroke(i.strokeColor,i.strokeWidth)}const it=E+i.strokeWidth/2,dt=this._makeEdgeExtremityPoints(W,Z,it,i.shape.points);this._drawPoints(dt),this._stroke(i.strokeColor,i.strokeWidth)}}else{if(h-j-z<=0)return;if(_){const q=pI(h,y,j,z,i.dashLength,i.gapLength);n&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.strokeColor,y+2*i.strokeWidth,q)),o&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.fillColor,y,q))}else{const q=j,B=h-z;if(n){const W=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,q,B,y+i.strokeWidth/2,i.strokeWidth/2,h);this._drawPoints(W),this._stroke(i.strokeColor,i.strokeWidth)}if(o){const W=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,q,B,y,0,h);this._drawPoints(W),this._fill(i.fillColor)}}}}}_makeTriangleEdgeBody(t,e,s,i,n,r,o,a,l){return e?s?this._makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a,l):this._makeCurveTriangleEdge(t,e,i,n,r,o,a):this._makeStraightTriangleEdge(t,i,n,r,o,a)}_makeCurveTriangleEdge(t,e,s,i,n,r,o){const a=2*cs+2,l=this._pointArray(a),d=this._getTFromLengthOnQuadraticCurve(t,e,s,i),h=(this._getTFromLengthOnQuadraticCurve(t,e,s,n)-d)/cs,u=(o-r)/cs/2;let c=r/2,g=d;for(let m=0;m<=cs;++m){const f=this._getPointOnQuadraticCurve(t,e,s,g),p=this._getTangentOnQuadraticCurve(t,e,s,g),_=this._getOrthogonal(p),y=_.x*c,x=_.y*c,b=l[m],v=l[a-1-m];b.x=f.x+y,b.y=f.y+x,v.x=f.x-y,v.y=f.y-x,g+=h,c+=u}return l}_makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a,l){const d=2*cs+2,h=this._pointArray(d),u=this._getTFromLengthOnCubicCurve(t,e,s,i,n),c=(this._getTFromLengthOnCubicCurve(t,e,s,i,l-r,!1)-u)/cs,g=(a-o)/cs/2;let m=o/2,f=u;for(let p=0;p<=cs;++p){const _=this._getPointOnCubicCurve(t,e,s,i,f),y=this._getTangentOnCubicCurve(t,e,s,i,f),x=this._getOrthogonal(y),b=x.x*m,v=x.y*m,A=h[p],E=h[d-1-p];A.x=_.x+b,A.y=_.y+v,E.x=_.x-b,E.y=_.y-v,f+=c,m+=g}return h}_makeStraightTriangleEdge(t,e,s,i,n,r){const o=e.x-t.x,a=e.y-t.y,l=Math.sqrt(o*o+a*a),d=this._point(o/l,a/l),h=this._getOrthogonal(d),u=n/2,c=r/2,g=this._pointArray(4),m=g[0],f=g[1],p=g[2],_=g[3],y=t.x+d.x*s,x=t.y+d.y*s,b=t.x+d.x*i,v=t.y+d.y*i,A=h.x*u,E=h.y*u,S=h.x*c,w=h.y*c;return m.x=y+A,m.y=x+E,f.x=y-A,f.y=x-E,p.x=b-S,p.y=v-w,_.x=b+S,_.y=v+w,g}_makeEdgeExtremityPoints(t,e,s,i){const n=this._pointArray(i.length),r=s/2,o=t.x+e.x*r,a=t.y+e.y*r,l=e.x,d=e.y;for(let h=0;h<i.length;++h){const u=i[h],c=n[h],g=(l*u.x-d*u.y)*r,m=(d*u.x+l*u.y)*r;c.x=o+g,c.y=a+m,c.r=u.r*r}return n}_drawLine(t,e,s,i){e?s?this._drawCubicCurve(t,e,s,i):this._drawQuadraticCurve(t,e,i):this._drawStraightLine(t,i)}_getSelfLoopControlPoints(t,e,s){return Qc(t.x,t.y,e,s,this._viewAngle,this._tmp)}_getQuadraticCurveControlPoint(t){return kd(t.pos1.x,t.pos1.y,t.pos2.x,t.pos2.y,t.curvature,this._point(0,0))}_graphToScreenCoordinates(t){const e=this._width/2,s=this._height/2,i=(t.x-this._viewX)*this._viewZoom,n=(t.y-this._viewY)*this._viewZoom,r=this._viewAngleCos,o=this._viewAngleSin,a=r*i+o*n+e,l=-o*i+r*n+s;return this._point(a,l)}_blendColor(t,e){return t&&this._backgroundColor?io(this._backgroundColor,t,e,1):t?gI(t,e):null}_getTangentOnLine(t,e,s,i,n){return e?s?this._getTangentOnCubicCurve(t,e,s,i,n):this._getTangentOnQuadraticCurve(t,e,i,n):this._getTangentOnStraightLine(t,i)}_getTangentOnStraightLine(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.sqrt(s*s+i*i);return this._point(s/n,i/n)}_getTangentOnQuadraticCurve(t,e,s,i){const n=1-i,r=n*e.x+i*s.x-(n*t.x+i*e.x),o=n*e.y+i*s.y-(n*t.y+i*e.y),a=Math.sqrt(r*r+o*o);return this._point(r/a,o/a)}_getTangentOnCubicCurve(t,e,s,i,n){const r=1-n,o=r*r,a=n*n,l=o*(e.x-t.x)+2*r*n*(s.x-e.x)+a*(i.x-s.x),d=o*(e.y-t.y)+2*r*n*(s.y-e.y)+a*(i.y-s.y),h=Math.sqrt(l*l+d*d);return this._point(l/h,d/h)}_mixPoints(t,e,s){const i=ne(t.x,e.x,s),n=ne(t.y,e.y,s);return this._point(i,n)}_getOrthogonal(t){return this._point(-t.y,t.x)}_getPointOnLine(t,e,s,i,n){return e?s?this._getPointOnCubicCurve(t,e,s,i,n):this._getPointOnQuadraticCurve(t,e,i,n):this._mixPoints(t,i,n)}_getPointOnQuadraticCurve(t,e,s,i){const n=sr(t.x,e.x,s.x,i),r=sr(t.y,e.y,s.y,i);return this._point(n,r)}_getPointOnCubicCurve(t,e,s,i,n){const r=Qm(t.x,e.x,s.x,i.x,n),o=Qm(t.y,e.y,s.y,i.y,n);return this._point(r,o)}_getTFromLengthOnCubicCurve(t,e,s,i,n,r=!0){if(!r)return 1-this._getTFromLengthOnCubicCurve(i,s,e,t,n,!0);let o=0,a=1,l=0;for(let d=0;d<10;d++){const h=(o+a)/2,u=h,c=this._getPointOnCubicCurve(t,e,s,i,u),g=Math.hypot(t.x-c.x,t.y-c.y);if(Math.abs(g-n)<.01)return h;g<n?(o=h,l=h):a=h}return l}_getTFromLengthOnQuadraticCurve(t,e,s,i){let n=t.x,r=t.y,o=0,a=0;for(let l=0;l<cs;++l){o+=tf;const d=sr(t.x,e.x,s.x,o),h=sr(t.y,e.y,s.y,o),u=d-n,c=h-r,g=Math.sqrt(u*u+c*c),m=a+g;if(m>i)return o-tf*((m-i)/g);a=m,n=d,r=h}return 1}};function mI(t,e,s){const i=Math.abs(t)/Cd+Fd,n=i*i,r=s-.5,o=r*r,a=1/(16*n),l=Math.sqrt(o+a),d=.5/i*Math.sqrt(n+.25);return Math.abs(2*i)*(r*l+.5*d+a*Math.log(Math.abs((r+l)/(-.5+d))))*e}function fI(t,e,s,i,n){const r=(t.x+e.x+s.x)/3,o=(t.y+e.y+s.y)/3,a=r-e.x,l=o-e.y,d=e.x-s.x,h=e.y-s.y,u=a*a+l*l,c=(d*d+h*h)/4,g=Math.sqrt(u-c);return 2*hb*g*3.14159265359*n}function pI(t,e,s,i,n,r){const o=[];if(s&&o.push(0,s),n&&r){const a=n*e,l=r*e,d=a+l,h=t-i-s-d;let u=0;for(;u<h;)o.push(a,l),u+=d;const c=t-i-s-u,g=Math.min(a,c),m=Math.max(c-g,0);o.push(g,m)}else o.push(t-i-s,0);return i&&o.push(0,i),o}var nr=0,vo=1,Ao=2,un=3,ef=4,Jc=0,wu=1,_I={[nr]:{min:"NEAREST",mag:"NEAREST",mipmap:!1},[vo]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[Ao]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[un]:{min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:!0}},yI={[Jc]:"ALPHA",[wu]:"RGBA"};function vr(t){return Math.ceil((t+2*Hi)/He)*He}function xI(t,e,s,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r],l=a.x,d=a.y,h=l+i,u=d+n;let c=h<s&&u<s;if(c){for(let g=l;g<h;++g)if(e[g+d*s]===1){c=!1;break}}if(c){for(let g=d;g<u;++g)if(e[l+g*s]===1){c=!1;break}}if(c){for(let g=l;g<h;++g)for(let m=d;m<u;++m)e[g+m*s]=1;return t.splice(r,1),t.push({x:l,y:u},{x:h,y:d}),a}}return null}function sf(t,e,s,i,n,r,o){const a=4*t,l=e>>1<<7,d=e%2<<7;o[a]=s/He,o[a+1]=i/He,o[a+2]=l+n/He,o[a+3]=d+r/He}function bI(t,e,s,i,n,r,o){i|=0,n|=0,r|=0,o|=0,e|=0;for(let a=0;a<r;++a)for(let l=0;l<o;++l){const d=4*(i+a+(n+l)*e),h=4*(a+l*r);t[d]=s[h],t[d+1]=s[h+1],t[d+2]=s[h+2],t[d+3]=s[h+3]}}function vI(t,e){let s=0,i=4;for(let r=0;r<t.length;++r){const{width:o,height:a}=t[r],l=vr(o),d=vr(a);s+=l*d,i=Math.max(i,Math.max(l,d))}const n=Bi(Math.max(i,Math.sqrt(s)));return Math.min(n,e)}function nf(t,e){return Math.floor((e-t)/2)}function rf(t,e,s,i,n,r,o){const{min:a,mag:l,mipmap:d}=_I[r],h=t[yI[o]];if(o===Jc){const u=new Uint8Array(n*n);for(let c=0;c<u.length;++c)u[c]=i[4*c+3];i=u}t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,h,n,n,0,h,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[l]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[a]),d&&t.generateMipmap(t.TEXTURE_2D)}function qb(t,e,s,i,n){const r=new Uint8Array(s*s*4),o=Math.ceil(s/He),a=new Uint8Array(o*o),l=[{x:0,y:0}];for(let d=0;d<e.length;++d){const h=e[d],u=h.id,c=vr(h.width)/He,g=vr(h.height)/He,m=xI(l,a,o,c,g);if(m){const f=h.width,p=h.height,_=h.pixels,y=c*He,x=g*He,b=m.x*He+nf(f,y),v=m.y*He+nf(p,x);bI(r,s,_,b,v,f,p),sf(u,t,b,v,y,x,n)}else{if(s<i)return qb(t,e,2*s,i,n);Vi(`exceeded max WebGL texture size of ${i}; some texts/icons/images won't be displayed`),sf(u,t,0,0,0,0,n)}}return{texture:r,size:s}}function AI(t,e,s,i){const{getDistanceFromStrokeVertically:n,getDistanceFromStrokeHorizontally:r}=t,o=e*(1-s)/2,a=(e-1)/2;for(let l=0;l<e;++l)for(let d=0;d<e;++d){const h=4*(d*e+l),u=(l-a)/o,c=(d-a)/o,g=Is(n(u,c),-1,1),m=Is(r(u,c),-1,1);EI(i,h,of(g),of(m))}}function of(t){const e=(t+1)/2;return Math.floor(32768*e)}function EI(t,e,s,i){t[e]=s>>8,t[e+1]=s%256,t[e+2]=i>>8,t[e+3]=i%256}function jb(t,e){let s=-Math.PI/2;const i=2*Math.PI/t.length;for(const n of t){const r=s+i;e(n,s,r),s=r}}function Yb(t,e,s,i,n){jb(e,(r,o,a)=>{t.beginPath(),t.moveTo(s,i),t.arc(s,i,n,o,a),t.fillStyle=r,t.fill()})}var SI=!Ge().__dummy,wI=class extends Vb{constructor(t){super(t),this._canvas=Ge(),this._imgCanvas=Ge(),this._initCanvas(this._canvas),this._ctx=this._canvas.getContext("2d"),this._imgCtx=this._imgCanvas.getContext("2d")}static getName(){return"Canvas"}static isAvailable(){return SI}getDomElement(){return this._canvas}_render({dimensionsChanged:t}){t&&_b(this._canvas,this._width,this._height,this._pixelRatio);const e=this._ctx,s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;e.clearRect(0,0,s,i),this._backgroundColor&&this._renderBackground&&(e.fillStyle=this._backgroundColor,e.fillRect(0,0,s,i));const n=this._bufferList.getBuffersByAscendingDepth();for(const r of n)this._isBufferDisplayable(r)&&this._displayBuffer(r)}_drawRoundedRectangle(t,e,s,i,n){const r=this._ctx,o=this._pixelRatio,a=t.x*o,l=t.y*o;e*=o,s*=o;const d=this._textManager.getCornerRadius(),h=Math.min(d*o,s);e+=h/2,r.save(),r.translate(a,l),r.rotate(i),r.beginPath(),r.arc(e-h,s-h,h,0,Math.PI/2),r.arc(-e+h,s-h,h,Math.PI/2,Math.PI),r.arc(-e+h,-s+h,h,Math.PI,3*Math.PI/2),r.arc(e-h,-s+h,h,3*Math.PI/2,0),n&&(r.fillStyle=n,r.fill()),r.restore()}_drawCircle(t,e){const s=this._ctx,i=this._pixelRatio,n=t.x*i,r=t.y*i,o=e*i;s.beginPath(),s.arc(n,r,o,0,2*Math.PI)}_drawPolygon(t){const e=this._ctx,s=this._pixelRatio;e.beginPath();const i=t[0];e.moveTo(i.x*s,i.y*s);for(let n=1;n<t.length;++n){const r=t[n];e.lineTo(r.x*s,r.y*s)}e.closePath()}_drawStraightLine(t,e){const s=this._ctx,i=this._pixelRatio;s.beginPath(),s.moveTo(t.x*i,t.y*i),s.lineTo(e.x*i,e.y*i)}_drawQuadraticCurve(t,e,s){const i=this._ctx,n=this._pixelRatio;i.beginPath(),i.moveTo(t.x*n,t.y*n),i.quadraticCurveTo(e.x*n,e.y*n,s.x*n,s.y*n)}_drawCubicCurve(t,e,s,i){const n=this._ctx,r=this._pixelRatio;n.beginPath(),n.moveTo(t.x*r,t.y*r),n.bezierCurveTo(e.x*r,e.y*r,s.x*r,s.y*r,i.x*r,i.y*r)}_fill(t){const e=this._ctx;e.fillStyle=t,e.fill()}_stroke(t,e,s=[]){if(e===0)return;const i=this._ctx,n=this._pixelRatio;i.setLineDash(s.map(r=>r*this._pixelRatio)),i.lineWidth=e*n,i.strokeStyle=t,i.stroke()}_startClip(){this._ctx.save(),this._ctx.clip()}_endClip(){this._ctx.restore()}_startReverseClip(){this._ctx.save(),this._ctx.rect(0,0,this._canvas.width,this._canvas.height),this._ctx.clip("evenodd")}_endReverseClip(){this._ctx.restore()}_displayText(t,e,s,i,n,r,o,a,l,d,h){const u=this._ctx,c=this._pixelRatio,g=t.x*c,m=t.y*c,f=r*c,p=a==="center"?0:-l/2;if(h=h*this._viewZoom*c,d=d*this._viewZoom*c,u.save(),u.translate(g,m+c),u.rotate(-e),u.textBaseline="middle",u.textAlign=a,$i(u,n,f,o),u.fillStyle=i,s.indexOf(`
`)!==-1){const _=s.split(`
`),y=_.length;let x=(1-y)/2*f;for(let b=0;b<y;++b)u.fillText(_[b],d+p,h+x),x+=f}else u.fillText(s,d+p,h);u.restore()}_displayImage(t,e,s,i,n,r,o){if(this._hideImages||"isDummy"in i)return;let a=i;o!==1&&(a=this._blendImageOnBackground(i,o));const l=this._ctx,d=this._pixelRatio,h=t.x*d,u=t.y*d,c=e*d,g=s*d,m=a.width*d,f=a.height*d;if(n)l.drawImage(a,h-c/2,u-g/2,c,g);else if(r){const p=h-c/2,_=u-g/2,y=h+c/2,x=u+g/2;let b=h-m/2,v=u-f/2;for(;b>p;)b-=m;for(;v>_;)v-=f;const A=v;for(;b<y;){for(;v<x;)l.drawImage(a,b,v,m,f),v+=f;b+=m,v=A}}else l.drawImage(a,h-m/2,u-f/2,m,f)}_displayPieChart(t,e,s){const i=this._ctx,n=this._pixelRatio,r=t.x*n,o=t.y*n,a=e*n*2,l=2*a;s.length===1&&(i.fillStyle=s[0],i.fillRect(r-a,o-a,l,l)),s.length>1&&Yb(i,s,r,o,a)}_blendImageOnBackground(t,e){const s=this._backgroundRgba,i=`rgb(${Math.round(255*s[0])},${Math.round(255*s[1])},${Math.round(255*s[2])})`;return this._imgCanvas.width=t.width,this._imgCanvas.height=t.height,this._imgCtx.clearRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=1,this._imgCtx.fillStyle=i,this._imgCtx.fillRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=e,this._imgCtx.drawImage(t,0,0),this._imgCanvas}getImageData(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)}},Hb=!1;try{Hb=!!se("svg")}catch{}var kr="none",TI={left:"start",center:"middle",right:"end"},vs="data-element-id",af="data-text-component",II="node-text",LI="edge-text",CI="badge-text";function rr(t){return Math.round(1e3*t)/1e3}function lf(t,e,s,i,n,r){const o=se("image");return o.setAttribute("width",rr(i)),o.setAttribute("height",rr(n)),o.setAttribute("x",rr(e)),o.setAttribute("y",rr(s)),o.setAttribute("href",t),r&&r.appendChild(o),o}function NI(t,e,s,i,n,r=1,o){const a=se("rect");return a.setAttribute("x",t),a.setAttribute("y",e),a.setAttribute("width",s),a.setAttribute("height",i),a.setAttribute("fill",n),a.setAttribute("fill-opacity",r),o&&o.appendChild(a),a}var MI=class extends Vb{constructor(t){super(t),this._svg=se("svg"),this._defs=se("defs"),this._styles=se("g",{class:"styles"}),this._background=se("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"}),this._currentElementId="0",this._currentClipPathId=null,this._clipPathCounter=0,this._defs.appendChild(this._styles),this._svg.setAttribute("pointer-events","none"),this._svg.style.userSelect="none",this._svg.appendChild(this._defs),this._svg.appendChild(this._background),this._clear()}static getName(){return"SVG"}static isAvailable(){return Hb}getDomElement(){return this._svg}_render({dimensionsChanged:t}){if(t&&pc(this._svg,{width:this._width,height:this._height}),this._backgroundColor&&this._renderBackground){const s=Yn(this._backgroundColor);this._background.setAttribute("fill",s.color),this._background.setAttribute("fill-opacity",s.opacity)}const e=this._bufferList.getBuffersByAscendingDepth();this._clear(),this._svg.removeChild(this._container);for(let s=0;s<e.length;++s){const i=e[s];this._isBufferDisplayable(i)&&this._displayBuffer(i)}this._svg.appendChild(this._container)}_clear(){this._container&&this._svg.removeChild(this._container),this._container=se("g"),this._svg.appendChild(this._container),this._clipPaths&&this._defs.removeChild(this._clipPaths),this._clipPaths=se("g"),this._defs.appendChild(this._clipPaths),this._clipPaths.setAttribute("class","clip-paths"),this._filters&&this._defs.removeChild(this._filters),this._filters=se("g"),this._defs.appendChild(this._filters)}_displayElement(t,e){this._currentElementId=t.id>=0?`n${t.id}`:"e"+-t.id,super._displayElement(t,e)}_addBackgroundBlendingFilter(t){const e=$e(this._backgroundColor),s=t,i=1-t,n=[s,0,0,0,e[0]*i,0,s,0,0,e[1]*i,0,0,s,0,e[2]*i,0,0,0,1,0].join(" "),r=`filter-${this._currentElementId}`,o=se("filter",{id:r}),a=se("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:n});return o.appendChild(a),this._filters.appendChild(o),r}_drawRoundedRectangle(t,e,s,i,n){const r=t.x,o=t.y,a=Math.min(this._textManager.getCornerRadius(),s);e+=a/2;const l=se("path"),d=`M ${r+e-a} ${o+s}     A ${a} ${a} 0 0 0 ${r+e} ${o+s-a}     L ${r+e} ${o-s+a}     A ${a} ${a} 0 0 0 ${r+e-a} ${o-s}     L ${r-e+a} ${o-s}     A ${a} ${a} 0 0 0 ${r-e} ${o-s+a}     L ${r-e} ${o+s-a}     A ${a} ${a} 0 0 0 ${r-e+a} ${o+s}     L ${r+e-a} ${o+s}`;l.setAttribute("d",d),l.setAttribute("fill",kr),l.setAttribute("transform",`rotate(${ru(i)} ${t.x} ${t.y})`),l.setAttribute(vs,this._currentElementId),this._container.appendChild(l),this._element=l,n&&this._fill(n)}_drawCircle(t,e){const{x:s,y:i}=t,n=`M ${s-e}, ${i} a ${e},${e} 0 1,0 ${2*e},0 a ${e},${e} 0 1,0 -${2*e},0`,r=se("path");r.setAttribute("d",n),r.setAttribute("fill",kr),r.setAttribute(vs,this._currentElementId),this._container.appendChild(r),this._element=r}_drawPolygon(t,e){const s=se("path");let i="";for(let n=0;n<t.length;n++){const{x:r,y:o}=t[n];i+=`${n===0?"M":"L"}${r},${o} `}i+="Z",s.setAttribute("d",i),s.setAttribute(vs,this._currentElementId),s.setAttribute("fill",kr),e&&s.setAttribute(af,!0),this._container.appendChild(s),this._element=s}_drawStraightLine(t,e){const s=se("path"),i=`M ${t.x},${t.y} L${e.x},${e.y}`;s.setAttribute("d",i),s.setAttribute(vs,this._currentElementId),this._container.appendChild(s),this._element=s}_drawQuadraticCurve(t,e,s){const i=se("path"),n=`M ${t.x},${t.y} Q${e.x},${e.y} ${s.x},${s.y}`;i.setAttribute("d",n),i.setAttribute("fill",kr),i.setAttribute(vs,this._currentElementId),this._container.appendChild(i),this._element=i}_drawCubicCurve(t,e,s,i){const n=se("path"),r=`M ${t.x},${t.y} C${e.x},${e.y} ${s.x},${s.y} ${i.x},${i.y}`;n.setAttribute("d",r),n.setAttribute("fill",kr),n.setAttribute(vs,this._currentElementId),this._container.appendChild(n),this._element=n}_fill(t){const e=Yn(t);this._element.setAttribute("fill",e.color),this._element.setAttribute("fill-opacity",e.opacity),this._currentClipPathId&&this._element.setAttribute("clip-path",`url(#${this._currentClipPathId})`)}_stroke(t,e,s=[]){if(e===0)return;const i=this._element;i.setAttribute("stroke-width",e);const n=Yn(t);i.setAttribute("stroke",n.color),i.setAttribute("stroke-opacity",n.opacity),s.length>0&&i.setAttribute("stroke-dasharray",s.map(rr).toString())}_startClip(){const t=se("clipPath"),e=this._element.cloneNode(!1);this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endClip(){this._currentClipPathId=null}_startReverseClip(){const t=se("clipPath"),e=this._element.cloneNode(!1),s=e.getAttribute("d");e.setAttribute("clip-rule","evenodd"),e.setAttribute("d",`${s} M 0 0 L ${this._width} 0 L ${this._width} ${this._height} L 0 ${this._height}`),this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endReverseClip(){this._currentClipPathId=null}_displayText(t,e,s,i,n,r,o="normal",a,l,d,h,u){const c=se("g");c.setAttribute(vs,this._currentElementId),c.setAttribute(af,!0);let g=this._currentElementId[0]==="n"?II:LI;u&&(g+=" "+CI),c.setAttribute("class",g);const m=Yn(i),f=m.opacity,p=Yn(m.color),_=t.x+d*this._viewZoom,y=t.y+1+h*this._viewZoom,x=rr(_);c.setAttribute("font-family",n),c.setAttribute("font-size",r),o==="bold"?c.setAttribute("font-weight",o):c.setAttribute("font-style",o),c.setAttribute("fill",p.color),c.setAttribute("fill-opacity",f),e&&c.setAttribute("transform",`rotate(${ru(-e)} ${_}, ${y})`),c.setAttribute("text-anchor",TI[a]||"middle"),c.setAttribute("dominant-baseline","middle");const b=s.split(`
`),v=b.length,A=y-(v+1)/2*r,E=a==="center"?0:-l/2;for(let S=0;S<v;S++){const w=se("text");w.appendChild(yc(b[S])),w.setAttribute("x",x+E),w.setAttribute("y",A+(S+1)*r),c.appendChild(w)}this._currentClipPathId&&c.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(c)}_displayImage(t,e,s,i,n,r,o){const a=t.x,l=t.y;if(this._hideImages||!("isDummy"in i)&&(!i.width||!i.height))return;const d=e,h=s;let u,c=i.width,g=i.height;if(n&&(c=d,g=h),r){const m=a-d/2,f=l-h/2,p=a+d/2,_=l+h/2;let y=a-c/2,x=l-g/2;for(u=se("g"),u.setAttribute(vs,this._currentElementId);y>m;)y-=c;for(;x>f;)x-=g;const b=x;for(;y<p;){for(;x<_;)lf(i.src,y,x,c,g,u),x+=g;x=b,y+=c}}else u=lf(i.src,a-c/2,l-g/2,c,g),u.setAttribute(vs,this._currentElementId);if(this._currentClipPathId&&u.setAttribute("clip-path",`url(#${this._currentClipPathId})`),o!==1){const m=this._addBackgroundBlendingFilter(o);u.setAttribute("filter",`url(#${m})`)}this._container.appendChild(u)}_displayPieChart(t,e,s){const i=2*e,n=2*i,r=t.x,o=t.y;let a;const l=se("g");l.setAttribute(vs,this._currentElementId),s.length===1&&(a=NI(r-i,o-i,n,n,s[0],1,l)),s.length>1&&jb(s,(d,h,u)=>{const c=r+e*Math.cos(u),g=o+e*Math.sin(u),m=r+e*Math.cos(h),f=o+e*Math.sin(h),p=u-h<=Math.PI?0:1,_=`M ${c},${g} A ${e},${e} 0 ${p} 0 ${m},${f} L ${r},${o} L ${c},${g}`;a=se("path"),a.setAttribute("d",_),a.setAttribute("fill",d),a.setAttribute("stroke-width",0),l.appendChild(a)}),this._currentClipPathId&&l.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(l)}},RI=6,FI=class{constructor({gl:t,ext:e,staticProgram:s,animationProgram:i}){this._version=0,this._used=!1,this._dataBufferChanged=!1,this._gl=t,this._ext=e,this._staticProgram=s,this._animationProgram=i,this._glBuffer=this._gl.createBuffer()}setDataBuffer(t){this._dataBuffer!==t&&(this._program=t.animated?this._animationProgram:this._staticProgram,this._dataBuffer=t,this._dataBufferChanged=!0,t.hasSideData()&&!this._sideGlBuffer?this._sideGlBuffer=this._gl.createBuffer():!t.hasSideData()&&this._sideGlBuffer&&(this._gl.deleteBuffer(this._sideGlBuffer),delete this._sideGlBuffer))}setPrograms(t,e){this._staticProgram=t,this._animationProgram=e}markAsUnused(){return this._used=!1,this}getProgram(){return this._program}markAsUsed(){return this._used=!0,this}isUsed(){return this._used}draw(){const t=this._gl,e=this._dataBuffer.type,s=e===vn,i=s?this._dataBuffer.getNbSideElementsPerMainElement():1,n=e===sd?cs:1,r=this._dataBuffer.getSize(),o=this._dataBuffer.stencilUsage,a=this._dataBuffer.version,l=this._version!==a||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:l?this._dataBuffer.getByteArray():null,divisor:i}),this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:l&&s?this._dataBuffer.getSideByteArray():null,divisor:1}),this._program.setupStencil(o),l&&(this._version=a,this._dataBufferChanged=!1),this._ext.drawArraysInstancedANGLE(t.TRIANGLES,0,RI*n,r*i)}destroy(){this._gl.deleteBuffer(this._glBuffer),this._sideGlBuffer&&this._gl.deleteBuffer(this._sideGlBuffer)}},PI={byte:1,ubyte:1,short:2,ushort:2,ulong:4,float:4},zI={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",ulong:"UNSIGNED_LONG",float:"FLOAT"},df=class{constructor({gl:t,ext:e,specialGlBuffers:s,metaData:i,programWrapper:n}){this._stencilUsage=hr,this._gl=t,this._ext=e,this._specialGlBuffers=s,this._metaData=be(i),this._programWrapper=n}_finishInit(){const t=this._gl,e=this._ext,s=this._programWrapper.getError();if(s)throw new Error(`WebGL compilation at step "${s.step}:
${s.message}"`);const i=this._programWrapper.getProgram();this._program=i,t.useProgram(i),this._metaData.attributes.forEach(o=>{o.location=t.getAttribLocation(this._program,o.name),o.byteSize=o.size*PI[o.type],o.glType=zI[o.type]}),this._specialAttributes=this._createSpecialAttributesFunctions();const n=[],r=[];for(const o of this._metaData.attributes)o.location!==-1&&(o.name.startsWith("a_text")?r.push(o):n.push(o));this._baseAttributes=dh(n,t,e),this._textAttributes=dh(r,t,e),this._setupUniforms=OI(this._metaData.uniforms,t,i)}_createSpecialAttributesFunctions(){return dh([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3,type:"byte",name:"special"}],this._gl,this._ext)}startPass(t){this._program||this._finishInit(),this._gl.useProgram(this._program),this._resetStencil(),this._setupUniforms(this._gl,t),this._specialAttributes.enable(this._gl),this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)}_setupAttributes(t,{glBuffer:e,dataBuffer:s,divisor:i}){t.enabled&&!e?t.disable(this._gl):!t.enabled&&e&&t.enable(this._gl),e&&t.setup(e,s,i)}setupBaseAttributes(t){this._setupAttributes(this._baseAttributes,t)}setupTextAttributes(t){this._setupAttributes(this._textAttributes,t)}_resetStencil(){const t=this._gl;this._stencilUsage=hr,t.disable(t.STENCIL_TEST)}setupStencil(t){if(t!==this._stencilUsage){const e=this._gl;t!==hr?(e.enable(e.STENCIL_TEST),t===fb?(e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilFunc(e.ALWAYS,1,1)):t===pb&&(e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilFunc(e.EQUAL,0,1))):e.disable(e.STENCIL_TEST),this._stencilUsage=t}}endPass(){const t=this._gl;this._specialAttributes.disable(t),this._baseAttributes.disable(t),this._textAttributes.disable(t)}};function DI(t,e,s){return(i,n,r)=>{let o=0,a=0;for(let l=0;l<t.length;l++)a+=t[l].byteSize;e.bindBuffer(e.ARRAY_BUFFER,i),n&&e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);for(let l=0;l<t.length;l++){const{location:d,size:h,glType:u,byteSize:c}=t[l];e.vertexAttribPointer(d,h,e[u],!1,a,o),o+=c,s.vertexAttribDivisorANGLE(d,r)}}}function OI(t,e,s){const i={};for(let n=0;n<t.length;++n){const{id:r,name:o}=t[n],a=e.getUniformLocation(s,o);a&&(i[r]=a)}return(n,r)=>{for(let o=0;o<t.length;++o){const{id:a,type:l}=t[o],d=i[a],h=r[a];if(d)switch(l){case"int":case"sampler2D":n.uniform1i(d,h);break;case"float":n.uniform1f(d,h);break;case"vec2":n.uniform2f(d,h[0],h[1]);break;case"vec3":n.uniform3f(d,h[0],h[1],h[2]);break;case"vec4":n.uniform4f(d,h[0],h[1],h[2],h[3])}}}}function kI(t){return e=>{for(let s=0;s<t.length;s++){const i=t[s].location;e.enableVertexAttribArray(i)}}}function BI(t){return e=>{for(let s=0;s<t.length;++s){const i=t[s].location;e.disableVertexAttribArray(i)}}}function dh(t,e,s){const i=kI(t),n=BI(t);return{enable(r){i(r),this.enabled=!0},disable(r){n(r),this.enabled=!1},setup:DI(t,e,s),enabled:!1}}var hh=`#define D3D9_FIX 0
precision highp float;
precision mediump int;
uniform vec3 u_backgroundColor;
uniform sampler2D u_patternNearestTexture;
uniform sampler2D u_patternLinearTexture;
uniform sampler2D u_patternLinearSdfTexture;
uniform sampler2D u_patternMipmapTexture;
uniform sampler2D u_shapeTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying vec4 f;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SDF_GAMMA = 0.0;
const float EPSILON = 0.000000001;
const float SDF_BUFFER = (256.0 - 64.0) / 256.0; 
vec4 af(in vec4 ag, in vec4 ah) {
float ai = ah.a;
float aj = ag.a + EPSILON;
float ak = min(ai + aj, 1.0);
float r = ai / ak;
return vec4(mix(ag.rgb, ah.rgb, r), ak);
}
float al(in float am, in float an) {
float ao = (am * 256.0 + an) * 256.0;
float ap = ao / 32768.0;
return ap * 2.0 - 1.0;
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
float at(float au) {
float bh = 2.;
vec2 bi = abs(c.rg) - c.ba - vec2(bh) + vec2(au);
float bj = min(max(bi.x, bi.y), 0.0) + length(max(bi, 0.0)) - au;
return smoothstep(0.1, .5, (1. - bj) / 10.);
}
void main() {
#if D3D9_FIX
#else
float br = o.x;
float bs = o.y;
float bt = r.x;
float bu = r.y;
#endif
vec4 bx = texture2D(u_shapeTexture, d);
float by = al(bx.b, bx.a) * s.x;
float bz = al(bx.r, bx.g) * s.y;
float ch = float(f.z > EPSILON);
float ci = float(f.w > EPSILON);
float cj = 1. - smoothstep(
0.01,
0.25760,
distance(f.xy * f.z - vec2(0.0586), d * f.z)
);
cj = cj * 2.5 - 1.5;
cj *= 0.5;
cj *= s.x;
float ck = at(g) ;
vec4 cl = a;
vec4 cm = b;
if (u > -EPSILON) {
vec2 cq = e;
float dd =
step(m.x, cq.x) *
step(cq.x, n.x) *
step(m.y, cq.y) *
step(cq.y, n.y);
float de = dd;
vec4 dh;
if (aq(u, FILTER_NEAREST)) {
dh = texture2D(u_patternNearestTexture, cq);
} else if (aq(u, FILTER_LINEAR)) { 
dh = texture2D(u_patternLinearTexture, cq);
} else if (aq(u, FILTER_LINEAR_SDF)) { 
dh = texture2D(u_patternLinearSdfTexture, cq);
dh.a = smoothstep(SDF_BUFFER - t, SDF_BUFFER + t, dh.a);
} else if (aq(u, FILTER_MIPMAP)) { 
dh = texture2D(u_patternMipmapTexture, cq);
}
dh.rgb += c.rgb;
dh.a *= de;
cl = af(cl, dh);
}
float dw = (1. - ch) * min(by, bz)
+ ch * cj;
dw = (1. - ci) * dw + ci * ck;
float ek = clamp(dw, 0.0, 1.0);
float en = clamp(dw - l, 0.0, 1.0);
float eo = ek - en;
eo = 1.0 - clamp(dw - l, 0.0, 1.0);
cl.a *= en;
cm.a *= eo * step(EPSILON, l);
vec4 ew = af(cl, cm);
float ex = ek;
ew.rgb = mix(u_backgroundColor, ew.rgb, br);
if (q > EPSILON) {
float fk = fract(bu) * q;
float fl = clamp(min(fk, bt - fk), 0.0, 1.0);
ex *= fl;
}
if (p < 0.0 || p > 1.0 || ex < EPSILON) {
discard;
}
ew.a *= ex;
ew.rgb *= ew.a;
gl_FragColor = ew;
}
`,uh=`#define D3D9_FIX 0
#define ANIMATED 0
precision highp float;
precision mediump int;
attribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_final_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_prev_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*float*/ vec2 a_animationBeginTime_animationDuration; 
attribute /*ushort*/ vec4 a_animationEasing; 
attribute /*ushort*/ vec3 a_text_charId_charOffsetXY; 
attribute vec3 a_vertexInfo;
uniform float u_viewWidth;
uniform float u_viewHeight;
uniform float u_viewX;
uniform float u_viewY;
uniform float u_viewAngle;
uniform float u_viewZoom;
uniform float u_currentTime;
uniform float u_pixelRatio;
uniform sampler2D u_patternInfoTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
varying vec4 f;
const float EPSILON = 0.000001;
const float INFINITY = 10000000.0;
const float PI = 3.14159265359;
const float P2_17 = 131072.0;
const float P2_16 = 65536.0;
const float P2_14 = 32768.0;
const float P2_12 = 4096.0;
const float P2_8 = 256.0;
const float P2_7 = 128.0;
const float P2_6 = 64.0;
const float P2_5 = 32.0;
const float P2_4 = 16.0;
const float P2_3 = 8.0;
const float P2_2 = 4.0;
const float P2_1 = 2.0;
const float MAX_FLOAT16_OFFSET = 16384.0;
const float MAX_FLOAT16 = 65535.0;
const float MAX_PROGRESS = 1.0;
uniform float BYTES_TO_COORD;
uniform float BYTES_TO_SCALED_SIZE;
uniform float BYTES_TO_MIN_VISIBLE_SIZE;
uniform float BYTES_TO_SYMBOLIC_SIZE;
uniform float BYTES_TO_CURVATURE;
uniform float BYTES_TO_DASH_LENGTH;
uniform float BYTES_TO_GAP_LENGTH;
uniform float BYTES_TO_PATTERN_SCALE;
uniform float PATTERN_POSITION_UNIT_SIZE;
uniform float PATTERN_INFO_TEXTURE_SIZE;
uniform float PATTERN_NEAREST_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;
uniform float PATTERN_MIPMAP_TEXTURE_SIZE;
uniform float ROUNDED_BOX_RADIUS;
const float BYTES_TO_OFFSET_ANGLE = 0.0;
const float BYTES_TO_COLOR = 0.0;
const float SDF_FONT_SIZE = 0.0;
const float SDF_GAMMA = 0.0;
const float CURVATURE_RATIO = 0.0;
const float PATTERN_PADDING = 0.0;
const float TEXT_WIDTH_MULTIPLIER = 0.0;
const float TEXT_HEIGHT_MULTIPLIER = 0.0;
const float SELF_LOOP_CURVATURE_RATIO = 0.0;
const float EDGE_ARROW_SIZE_RATIO = 0.0;
const float EDGE_MIN_TIP_SIZE = 0.0;
const float CURVE_SUBDIVISIONS = 0.0;
const float PIECE_NODE_COMPONENT = 0.0;
const float PIECE_TEXT_BOX = 0.0;
const float PIECE_EDGE_BODY = 0.0;
const float PIECE_EDGE_HEAD = 0.0;
const float PIECE_EDGE_TAIL = 0.0;
const float PIECE_EDGE_TEXT = 0.0;
const float MAX_TEXT_SIZE = 0.0;
const float BYTES_TO_TEXT_OFFSET_X = 0.0;
const float BYTES_TO_TEXT_OFFSET_Y = 0.0;
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SHAPE_TEXTURE_SIZE = 0.0;
const float SIMPLE_SHAPE_SAMPLING_SIZE = 0.0;
const float COMPLEX_SHAPE_SAMPLING_SIZE = 0.0;
const float SHAPE_SAMPLING_BUFFER_RATIO = 0.0;
const float MAX_SHAPES = 0.0;
const float FIRST_COMPLEX_SHAPE_ID = 0.0;
const float SELF_LOOP_TO_CIRCLE_APPROX = 0.0;
const float NB_SHAPES_BY_SIDE = SHAPE_TEXTURE_SIZE / COMPLEX_SHAPE_SAMPLING_SIZE;
const float SHAPE_FILL_PERCENT = 1.0 - SHAPE_SAMPLING_BUFFER_RATIO;
const float T_STEP_PER_CURVE_PIECE = 1.0 / CURVE_SUBDIVISIONS;
const float HEAD_TAIL_PX_ADJUST = 1.5;
const float SDF_SMOOTH_FACTOR = 2.0;
struct pv {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
};
struct qe {
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
};
struct qm {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
float dc;
float qn;
float qo;
float qp;
float qq;
float qr;
float qs;
vec4 cl;
vec4 cm;
vec4 dh;
float qt;
float qu;
float qv;
float qw;
float qx;
float qy;
float qz;
float ra;
float rb;
float rc;
float rd;
float re;
float rf;
float rg;
float rh;
float ri;
float rj;
float rk;
float rl;
};
struct rm {
float eu;
vec2 rn;
vec4 cl;
vec4 cm;
float dc;
float ro;
float rp;
float py;
float rq;
vec2 rr;
float rs;
vec2 cq;
vec2 rt;
vec2 ru;
float rv;
float rw;
vec4 dh;
vec2 bd;
float rx;
float or;
vec2 ry;
vec2 rz;
vec2 sa;
};
float sb(float nq, float sc, float sd) {
float se = mod(nq, pow(2.0, sd));
return floor(se / pow(2.0, sc));
}
pv sf(float nq) {
pv sg;
sg.pw = sb(nq, 0.0, 4.0);
sg.px = sb(nq, 4.0, 8.0);
sg.py = sb(nq, 8.0, 10.0);
sg.pz = sb(nq, 10.0, 12.0);
sg.qa = sb(nq, 12.0, 13.0);
sg.qb = sb(nq, 13.0, 14.0);
sg.qc = sb(nq, 14.0, 15.0);
sg.qd = sb(nq, 15.0, 16.0);
return sg;
}
qe sh(float nq) {
qe sg;
sg.qf = sb(nq, 0.0, 8.0);
sg.qg = sb(nq, 8.0, 11.0);
sg.qh = sb(nq, 11.0, 12.0);
sg.qi = sb(nq, 12.0, 13.0);
sg.qj = sb(nq, 13.0, 14.0);
sg.qk = sb(nq, 14.0, 15.0);
sg.ql = sb(nq, 15.0, 16.0);
return sg;
}
float si(float ll) {
float sj = mod(floor(ll / 32768.0), 2.0) == 1.0 ? -1.0 : 1.0; 
float sl = mod(floor(ll / 1024.0), 32.0); 
float sn = mod(ll, 1024.0); 
float sq = float(sl == 0.0 || sl == 31.0);
return (1. - sq)
* sj * pow(2.0, sl - 15.0) * (1.0 + sn / 1024.0);
}
vec4 sr(in float nq) {
return vec4(
sb(nq, 0.0, 4.0),
sb(nq, 4.0, 8.0),
sb(nq, 8.0, 12.0),
sb(nq, 12.0, 16.0)
);
}
vec2 ss(in float nq) {
return vec2(mod(nq, 256.0), floor(nq / 256.0));
}
vec2 st(in float nq) {
float su = floor(nq / P2_6);
float sv = nq - (su * P2_6);
return vec2(su, sv);
}
vec2 sw(in float nq) {
float sx = floor(nq / P2_7);
float sy = nq - (sx * P2_7);
return vec2(sx, sy);
}
vec2 sz(in vec2 ta, in float tb) {
float tc = cos(tb);
float td = sin(tb);
return vec2(tc * ta.x + td * ta.y, -td * ta.x + tc * ta.y);
}
vec4 te(in vec4 tf) {
return floor(tf / 256.0) - 128.0;
}
vec4 tg(in vec4 tf) {
return mod(tf, 256.0) - 128.0;
}
float th(float nq) {
return nq - 128.0;
}
vec2 th(vec2 nq) {
return nq - 128.0;
}
vec2 ti(vec2 tj) {
return vec2(-tj.y, tj.x);
}
vec2 tk(vec2 tl, vec2 ih, vec2 tm, float t) {
float tn = 1.0 - t;
return (tn * tn * tl) + (2.0 * tn * t * ih) + (t * t * tm);
}
vec2 to(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
float tn = 1.0 - t;
float tr = tn * tn;
float ts = tr * tn;
float tt = t * t;
float tu = tt * t;
return (ts * tl) + (3.0 * tr * t * tp) + (3.0 * tn * tt * tq) + (tu * tm);
}
vec2 tv(vec2 tl, vec2 ih, vec2 tm, float t) {
float tn = (1.0 - t);
vec2 ta = (tn * ih + t * tm) - (tn * tl + t * ih);
return normalize(ta);
}
vec2 tw(vec2 tl, vec2 ih, vec2 tm, float t) {
return ti(tv(tl, ih, tm, t));
}
vec2 tx(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
float tn = 1.0 - t;
float tr = tn * tn;
float tt = t * t;
vec2 ta = tr * (tp - tl) + 2.0 * tn * t * (tq - tp) + tt * (tm - tq);
return normalize(ta);
}
vec2 ty(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
return ti(tx(tl, tp, tq, tm, t));
}
float uj(float qr, float uk, float t) {
float y = abs(qr) / CURVATURE_RATIO + EPSILON;
float qw = y * y;
float tn = t - 0.5;
float tr = tn * tn;
float ul = 1.0 / (16.0 * qw);
float um = sqrt(tr + ul);
float un = (0.5 / y) * sqrt(qw + 0.25);
float uo = (abs(2.0 * y)) * ((tn * um) + (0.5 * un) + (ul * log(abs((tn + um) / (-0.5 + un)))));
return uo * uk;
}
float uz(vec2 va, vec2 vb, vec2 vc, vec2 vd) {
bool vk = abs(va.x - vb.x - vc.x + vd.x) + abs(va.y - vb.y - vc.y + vd.y) < EPSILON;
float vl = 9.0 * pow(vb.x - va.x, 2.0); 
float vo = pow(-243.0 * va.x + 189.0 * vb.x + 51.0 * vc.x + 3.0 * vd.x, 2.0) / 10000.0; 
float vp = pow(-48.0 * va.x + 24.0 * vb.x + 21.0 * vc.x + 3.0 * vd.x, 2.0) / 625.0; 
float vq = pow(-147.0 * va.x + 21.0 * vb.x + 99.0 * vc.x + 27.0 * vd.x, 2.0) / 10000.0; 
float vr = pow(-27.0 * va.x - 9.0 * vb.x + 24.0 * vc.x + 12.0 * vd.x, 2.0) / 625.0; 
float vs = (9.0 / 16.0) * pow(vc.x + vd.x - va.x - vb.x, 2.0); 
float vt = 9.0 * pow(vb.y - va.y, 2.0); 
float vv = pow(-243.0 * va.y + 189.0 * vb.y + 51.0 * vc.y + 3.0 * vd.y, 2.0) / 10000.0; 
float vw = pow(-48.0 * va.y + 24.0 * vb.y + 21.0 * vc.y + 3.0 * vd.y, 2.0) / 625.0; 
float vx = pow(-147.0 * va.y + 21.0 * vb.y + 99.0 * vc.y + 27.0 * vd.y, 2.0) / 10000.0; 
float vy = pow(-27.0 * va.y - 9.0 * vb.y + 24.0 * vc.y + 12.0 * vd.y, 2.0) / 625.0; 
float vz = (9.0 / 16.0) * pow(vc.y + vd.y - va.y - vb.y, 2.0); 
float wa = sqrt(vl + vt); 
float wc = sqrt(vo + vv); 
float wd = sqrt(vp + vw); 
float we = sqrt(vq + vx); 
float wf = sqrt(vr + vy); 
float wg = sqrt(vs + vz); 
if(vk)
return (5.0 / 2993760.0) *
(32134.0 * wa +
212600.0 * wc -
97050.0 * wd +
544800.0 * we -
521100.0 * wf +
427368.0 * wg);
float wh = pow(-12.0 * va.x - 24.0 * vb.x + 9.0 * vc.x + 27.0 * vd.x, 2.0) / 625.0; 
float wi = pow(-27.0 * va.x - 99.0 * vb.x - 21.0 * vc.x + 147.0 * vd.x, 2.0) / 10000.0; 
float wj = pow(-3.0 * va.x - 21.0 * vb.x - 24.0 * vc.x + 48.0 * vd.x, 2.0) / 625.0; 
float wk = pow(-3.0 * va.x - 51.0 * vb.x - 189.0 * vc.x + 243.0 * vd.x, 2.0) / 10000.0; 
float wl = 9.0 * pow(vd.x - vc.x, 2.0); 
float wm = pow(-12.0 * va.y - 24.0 * vb.y + 9.0 * vc.y + 27.0 * vd.y, 2.0) / 625.0; 
float wn = pow(-27.0 * va.y - 99.0 * vb.y - 21.0 * vc.y + 147.0 * vd.y, 2.0) / 10000.0; 
float wo = pow(-3.0 * va.y - 21.0 * vb.y - 24.0 * vc.y + 48.0 * vd.y, 2.0) / 625.0; 
float wp = pow(-3.0 * va.y - 51.0 * vb.y - 189.0 * vc.y + 243.0 * vd.y, 2.0) / 10000.0; 
float wq = 9.0 * pow(vd.y - vc.y, 2.0); 
float wr = sqrt(wh + wm); 
float ws = sqrt(wi + wn); 
float wt = sqrt(wj + wo); 
float wu = sqrt(wk + wp); 
float wv = sqrt(wl + wq); 
return (5.0 / 2993760.0) *
(16067.0 * (wa + wv) +
106300.0 * (wc + wu) -
48525.0 * (wd + wt) +
272400.0 * (we + ws) -
260550.0 * (wf + wr) +
427368.0 * wg);
}
float ww(float nq) {
return nq - 32.0;
}
float wx(float nq) {
return nq - 512.0;
}
float wy(float nq) {
return nq - P2_14;
}
void wz() {
gl_Position = vec4(-10.0, -10.0, 1.0, 1.0);
}
vec4 xa(vec2 xb) {
return vec4(((vec2(xb.x, u_viewHeight - xb.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);
}
float xf(float ar, float as) {
return step(ar - EPSILON, as) * step(as, ar + EPSILON);
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
bool xg(float nq) {
return nq > 0.5;
}
vec2 xh(vec2 xi) {
return sz((xi - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;
}
float xj(float or) {
return max(EDGE_MIN_TIP_SIZE, or * EDGE_ARROW_SIZE_RATIO);
}
float xk(float xl, float xm) {
return xl * BYTES_TO_SCALED_SIZE * u_viewZoom + xm;
}
float xn(float xl, float xm) {
return xl * BYTES_TO_SCALED_SIZE * MAX_FLOAT16 / MAX_FLOAT16_OFFSET * u_viewZoom + xm;
}
float xo(float xl, float xm) {
return min(xl * BYTES_TO_SCALED_SIZE * MAX_FLOAT16 / MAX_FLOAT16_OFFSET * u_viewZoom, xm);
}
float xu(float ro, float xs, float xt) {
float xv = xt - xs;
float a = 1.0 / xv;
float b = -xs / xv;
return ro * a + b;
}
struct xw {
vec2 vb;
vec2 vc;
};
xw xx(vec2 xy, float au, float qr) {
xw ns;
float xz = (au + au / SELF_LOOP_CURVATURE_RATIO * qr) * SELF_LOOP_CURVATURE_RATIO;
float ya = -u_viewAngle + PI;
float yb = -u_viewAngle + PI / 2.0;
ns.vb = xy + vec2(cos(ya), sin(ya)) * xz;
ns.vc = xy + vec2(cos(yb), sin(yb)) * xz;
return ns;
}
float yc(vec2 yd, vec2 ye, vec2 yf, vec2 yg, float yh) {
const int MAX_ITERATIONS = 10; 
const float EPSILON = 0.01; 
float yo = 0.0;
float cf = 1.0;
float yp = 0.0;
for (int yq = 0; yq < MAX_ITERATIONS; yq++) {
float yr = (yo + cf) * 0.5;
vec2 ys = to(yd, ye, yf, yg, yr);
float yt = distance(yd, ys);
if (abs(yt - yh) < EPSILON) {
return yr;
}
if (yt < yh) {
yo = yr;
yp = yr;
} else {
cf = yr;
}
}
return yp;
}
float za(vec2 yd, vec2 ye, vec2 yf, vec2 yg, float yh, bool zb) {
if (!zb) {
return 1.0 - yc(yg, yf, ye, yd, yh);
}
return yc(yd, ye, yf, yg, yh);
}
qm ze(
vec4 zf,
vec4 zg,
vec4 zh,
vec4 zi,
vec4 zj,
vec4 zk,
vec3 zl
) {
qm a;
pv bx = sf(zf.x);
qe zm = sh(zf.y);
vec4 zn = sr(zf.z);
vec2 zo = ss(zf.w);
a.pw = bx.pw;
a.px = bx.px;
a.py = bx.py;
a.pz = bx.pz;
a.qa = bx.qa;
a.qb = bx.qb;
a.qc = bx.qc;
a.qd = bx.qd;
a.qf = zm.qf;
a.qg = zm.qg;
a.qh = zm.qh;
a.qi = zm.qi;
a.qj = zm.qj;
a.qk = zm.qk;
a.ql = zm.ql;
a.dc = zn.x;
a.qn = zn.y;
a.qo = zn.z;
a.qp = zn.w;
a.qq = zo.x;
a.qr = zo.y;
a.qs = zg.x;
a.cl = sr(zg.y);
a.cm = sr(zg.z);
a.dh = sr(zg.w);
a.qt = zh.x;
a.qu = zh.y;
a.qv = zh.z;
a.qw = zh.w;
a.qx = si(zi.x);
a.qy = zi.y;
a.qz = si(zi.z);
a.ra = zi.w;
a.rb = zj.x;
a.rc = zj.y;
a.rd = zj.z;
a.re = zj.w;
a.rf = zk.x;
a.rg = wy(zk.y);
a.rk = wy(zk.z);
a.rl = wy(zk.w);
a.rh = zl.x;
float x = zl.y;
float y = mod(x, P2_8);
if (zl.z > 0.0) x += zl.z * P2_16;
a.ri = ((x - y) / P2_8) - P2_16;
a.rj = (y - P2_7) * BYTES_TO_TEXT_OFFSET_Y;
return a;
}
bool aar(const in qm a, out rm ns) {
float pw = a.pw;
float px = a.px;
float py = a.py * BYTES_TO_DASH_LENGTH;
float pz = a.pz * BYTES_TO_GAP_LENGTH;
float qa = a.qa;
float qb = a.qb;
float qc = a.qc;
float qd = a.qd;
float qf = a.qf * BYTES_TO_PATTERN_SCALE;
float qg = a.qg * BYTES_TO_OFFSET_ANGLE;
float qh = a.qh;
float qi = a.qi;
float qj = a.qj;
float qk = a.qk;
float ql = a.ql;
float dc = a.dc * BYTES_TO_COLOR;
float qn = a.qn * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qo = a.qo * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qp = a.qp * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qr = th(a.qr);
float qs = a.qs;
vec4 cl = a.cl * BYTES_TO_COLOR;
vec4 cm = a.cm * BYTES_TO_COLOR;
vec4 dh = a.dh * BYTES_TO_COLOR;
vec2 aas = vec2(a.qt, a.qu) * BYTES_TO_COORD;
vec2 aat = vec2(a.qv, a.qw) * BYTES_TO_COORD;
vec2 yd = xh(aas);
vec2 yg = xh(aat);
float aax = float(
qj > EPSILON &&
a.qy > EPSILON &&
a.ra > EPSILON
);
float aay = 1. - aax;
float aaz = aax * xo(
a.qx,
a.qy
) + aay * xn(
a.qx,
a.qy
);
float aba = aax * xo(
a.qz,
a.ra
) + aay * xn(
a.qz,
a.ra
);
float qq = a.qq * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom +
step(a.qq, EPSILON) * INFINITY;
float abb = xk(a.rb, a.rc);
float eu = xk(a.rd, a.re);
float zt = xk(a.rf, a.rg);
vec2 abc = a_vertexInfo.xy;
vec2 abd = vec2(0.0, 0.0);
float abe = aaz;
float abf = aba;
float abg = aba * qf;
if (qh > EPSILON || dc< EPSILON) {
if (a.rh < EPSILON || dc< EPSILON) return false;
abg = abb;
qs = a.rh;
aaz = abg * TEXT_WIDTH_MULTIPLIER * u_pixelRatio;
aba = abg * TEXT_HEIGHT_MULTIPLIER * u_pixelRatio;
}
bool aca = abs(qr) > EPSILON && xf(px, PIECE_EDGE_BODY) < EPSILON;
bool acb = aca && a_vertexInfo.z > EPSILON;
if (pw < EPSILON || px < EPSILON || qq < qn || acb) {
return false;
}
eu *= step(qo, qq);
float aco = 0.0;
float acp = 1.0;
float acl = 0.0;
float acn = 1.0;
float acq = 0.0;
float ada = 1.0;
float adc = 1.0;
float adm = 0.0;
float adn = 0.0;
vec2 bd;
vec2 ry;
vec2 rz;
vec2 sa;
float or;
float rx;
float aee = 0.0;
float aef = 1.0;
bool ci = xf(px, PIECE_TEXT_BOX) > EPSILON;
if (xf(px, PIECE_NODE_COMPONENT) > EPSILON || ci) {
bd = ceil((yd + yg) / 2.0);
if(length(aat - aas) > EPSILON){
ry = normalize(aat - aas) * vec2(1.,-1.);
}else{
ry = vec2(1.0, 0.0);
}
rz = ti(ry);
sa = rz;
or = aaz;
rx = aba;
} else {
adc = 0.0;
float aev = distance(yd, yg);
vec2 aew = normalize(yg - yd);
vec2 aex = (yd + yg) / 2.0;
vec2 aey = ti(aew);
vec2 ye;
vec2 yf;
if (qk > EPSILON) {
vec2 afe = sz(yd, -u_viewAngle);
vec2 aff = sz(yg, -u_viewAngle);
float afi = 1. / (1. + exp(-qr));
if (ql > EPSILON) {
float afj = afi * afe.y + (1. - afi) * aff.y;
ye = vec2(afe.x, afj);
yf = vec2(aff.x, afj);
} else {
float afk = afi * afe.x + (1. - afi) * aff.x;
ye = vec2(afk, afe.y);
yf = vec2(afk, aff.y);
}
ye = sz(ye, u_viewAngle);
yf = sz(yf, u_viewAngle);
}
vec2 afl = aex + (aey * aev * -qr / CURVATURE_RATIO);
if (xf(px, PIECE_EDGE_TEXT) > 0.0
|| xf(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0
) {
ci = xf(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0;
float afm;
float afn = eu;
eu = 0.0;
if (qd > EPSILON) {
xw ih = xx(yd, afn / 2.0, qr);
bd = to(yd, ih.vb, ih.vc, yg, 0.5);
ry = tx(yd, ih.vb, ih.vc, yg, 0.5);
rz = ti(ry);
sa = rz;
afm = .5 * uz(yd, ih.vb, ih.vc, yg);
} else if (qk > EPSILON) {
bd = to(yd, ye, yf, yg, 0.5);
ry = tx(yd, ye, yf, yg, 0.5);
rz = ti(ry);
sa = rz;
afm = uz(yd, ye, yf, yg);
} else if (abs(qr) > EPSILON) {
bd = tk(yd, afl, yg, 0.5);
ry = tv(yd, afl, yg, 0.5);
rz = ti(ry);
sa = rz;
afm = uj(qr, aev, 1.0);
} else {
bd = aex;
ry = aew;
rz = aey;
sa = aey;
afm = aev;
}
or = aaz;
rx = aba;
if(abe > afm - afn && qd < EPSILON){
if(qi > EPSILON){
ry = vec2(1.0, 0.0);
rz = vec2(0.0, 1.0);
sa = vec2(0.0, 1.0);
} else {
ry = vec2(0,0);
rz = vec2(0.0, 0.0);
sa = vec2(0.0, 0.0);
}
} else {
float tb = -atan(ry.y, ry.x);
aee = tb;
qg -= tb;
if ((tb > PI / 2.0 || tb < -PI / 2.0)) {
qg += (1.0 - qd) * PI;
aef = -1.0;
ry *= -1.0;
rz *= -1.0;
sa *= -1.0;
}
}
} else {
float afu = aaz;
float afv = aba;
float afw = xj(abb);
float afx = qa
* min(5. * afu, afw);
float afy = qb
* min(5. * afv, afw);
float afz = xf(px, PIECE_EDGE_HEAD);
float aga = xf(px, PIECE_EDGE_TAIL);
float agb = INFINITY * qd + aev - afu - afv;
float agk = min(0., agb - afx - afy)/2.;
float agp = abb / 2.;
float agq =
afu > agp
? afu - sqrt(afu * afu - agp * agp)
: agp;
float agr = max( afu +
afy
+ qb * agk,
0.) - (1. - qa) * agq;
agq =
afv > agp
? afv - sqrt(afv * afv - agp * agp)
: agp;
float ags = max( afv +
afx
+ qa * agk
, 0.) - (1. - qb) * agq;
if(qk > EPSILON && qd < EPSILON) {
agr = afu + afy / 2.;
ags = afv + afx / 2.;
}
if (afz > EPSILON || aga > EPSILON) {
vec2 agx = afz * yg + aga * yd;
float zt = afz * ags + aga * agr + (HEAD_TAIL_PX_ADJUST - 0.5);
float agy = afz * afx + aga * afy;
vec2 agz;
if (qk > EPSILON && qd < EPSILON) {
float yh = afz > EPSILON ? ags : agr;
float t = za(yd, ye, yf, yg, yh, aga > EPSILON);
agz = to(yd, ye, yf, yg, t);
ry = normalize(agz - to(yd, ye, yf, yg, t - 0.01));
if(aga > EPSILON) ry *= -1.;
bd = agz;
} else {
if (qd > EPSILON) {
xw ih = xx(yd, afu, qr);
float yh = afz * ags + aga * agr;
float t = za(yd, ih.vb, ih.vc, yg, yh, aga > EPSILON);
agz = to(yd, ih.vb, ih.vc, yg, t);
} else {
float afm = uj(qr, aev, 1.0);
float t = (afz * (afm - ags) + aga * agr) / afm;
agz = tk(yd, afl, yg, t);
}
ry = normalize(agx - agz);
bd = agx - ry * (zt - agy / 2.0);
}
rz = ti(ry);
sa = rz;
or = agy;
rx = agy;
py = 0.0;
pz = 0.0;
} else {
float ahd;
float ahe;
float ahf;
if(qk > EPSILON && qd < EPSILON) {
float ahg = za(yd, ye, yf, yg, agr, true);
float ahh = za(yd, ye, yf, yg, ags, false);
float ahi = ahh - ahg;
float ahj = a_vertexInfo.z;
float ahk = (ahg + ahi * ahj * T_STEP_PER_CURVE_PIECE);
float tt = (ahg + ahi * (ahj + 1.) * T_STEP_PER_CURVE_PIECE);
vec2 ahl = to(yd, ye, yf, yg, ahk);
vec2 ahm = to(yd, ye, yf, yg, tt);
bd = (ahl + ahm) / 2.0;
ry = normalize(ahm - ahl);
rz = ty(yd, ye, yf, yg, ahk);
sa = ty(yd, ye, yf, yg, tt);
or = distance(ahl, ahm);
ahd = uz(yd, ye, yf, yg);
ahe = ahd * ahk;
ahf = ahd * tt;
} else {
if (abs(qr) < EPSILON) {
bd = aex;
ry = aew;
rz = aey;
sa = rz;
or = aev;
ahd = aev;
ahe = 0.0;
ahf = aev;
} else {
float ahj = a_vertexInfo.z;
float ahk = ahj * T_STEP_PER_CURVE_PIECE;
float tt = ahk + T_STEP_PER_CURVE_PIECE;
if (qd < EPSILON) {
vec2 ahl = tk(yd, afl, yg, ahk);
vec2 ahm = tk(yd, afl, yg, tt);
bd = (ahl + ahm) / 2.0;
ry = normalize(ahm - ahl);
rz = tw(yd, afl, yg, ahk);
sa = tw(yd, afl, yg, tt);
or = distance(ahl, ahm);
ahd = uj(qr, aev, 1.0);
ahe = uj(qr, aev, ahk);
ahf = uj(qr, aev, tt);
} else {
xw ih = xx(yd, afu, qr);
vec2 ye = ih.vb;
vec2 yf = ih.vc;
vec2 ahl = to(yd, ye, yf, yg, ahk);
vec2 ahm = to(yd, ye, yf, yg, tt);
bd = (ahl + ahm) / 2.0;
ry = normalize(ahm - ahl);
rz = ty(yd, ye, yf, yg, ahk);
sa = ty(yd, ye, yf, yg, tt);
or = distance(ahl, ahm);
ahd = uz(yd, ye, yf, yg);
ahe = ahk * ahd;
ahf = tt * ahd;
}
}
}
rx = abb;
if(qd > EPSILON) {
xw ih = xx(yd, afu, qr);
float ahq = za(yd, ih.vb, ih.vc, yg, agr, true);
float ahh = za(yd, ih.vb, ih.vc, yg, ags, false);
acl = ahq;
acn = ahh;
} else if(qk < EPSILON) {
acl = (agr - 1.0) / ahd;
acn = MAX_PROGRESS - (ags - HEAD_TAIL_PX_ADJUST) / ahd;
}
aco = ahe / ahd;
acp = ahf / ahd;
acq = ahd;
if (abb < EPSILON)
cl.a = 0.; 
if (qc > 0.0 && agb > 5.0) {
float ahu = (ahd * rx) / (ahd - agr);
float ahv = ahd;
float qt = agr;
float qv = ahd - ags;
float a = -ahu / ahv;
float b = ahu;
float qu = a * qt + b;
float qw = a * qv + b;
float ahw = qu / (qt - qv);
float bi = -ahw * qv;
rx = min(min(bi, afu), afv);;
adn = ahw * ahv + bi + 1.0;
}
}
}
}
vec2 cq = vec2(0.0, 0.0);
vec2 rt = vec2(EPSILON, EPSILON);
vec2 ru = vec2(-EPSILON, -EPSILON);
float rv = -1.0;
float rw = 0.0;
bool ahy = false;
vec2 ahz = vec2(0,0);
vec2 aia = vec2(0,0);
vec2 aib = vec2(0,0);
if (qs > EPSILON && qq > qp) {
float aie = floor(qs / PATTERN_INFO_TEXTURE_SIZE);
float aif = qs - (aie * PATTERN_INFO_TEXTURE_SIZE);
vec4 aig = texture2D(u_patternInfoTexture, vec2(aif, aie) / 255.0) * 255.0;
vec2 aih = sw(aig.z);
vec2 aii = sw(aig.w);
rv = aih.x * 2.0 + aii.x;
float aij = 0.0;
if (aq(rv, FILTER_NEAREST)) { 
aij = PATTERN_NEAREST_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR)) { 
aij = PATTERN_LINEAR_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR_SDF)) { 
aij = PATTERN_LINEAR_SDF_TEXTURE_SIZE;
ahy = true;
} else if (aq(rv, FILTER_MIPMAP)) { 
aij = PATTERN_MIPMAP_TEXTURE_SIZE;
}
float aim = 1.0 / aij;
vec2 ain = (vec2(aih.y, aii.y) * PATTERN_POSITION_UNIT_SIZE) * aim / 2.0;
aia += (aig.xy * PATTERN_POSITION_UNIT_SIZE * aim) + ain;
ain -= PATTERN_PADDING * aim * 2.0;
vec2 aio = vec2(or / 2.0, rx / 2.0) * aim;
vec2 aip = vec2(eu, eu) * aim;
float air = 1.0 * u_pixelRatio;
float ais = SDF_SMOOTH_FACTOR;
if (qf > EPSILON) {
if (ahy) { 
if (a.qj > EPSILON) {
ais = SDF_SMOOTH_FACTOR * u_pixelRatio / SDF_GAMMA;
ahz = vec2(-a.rl,-a.rk);
}
rw = ais * SDF_GAMMA / abg / u_pixelRatio;
air = SDF_FONT_SIZE / abg;
} else { 
air = (ain.y / aio.y) / qf;
}
}
aib = (aio + aip) * air;
ain += PATTERN_PADDING * aim;
rt = aia - ain;
ru = aia + ain;
}
if (qh > EPSILON) {
abd.y = (a.rj) * abg;
ada = 0.0;
adc = 0.0;
abd.x = a.ri * abg * BYTES_TO_TEXT_OFFSET_X;
abd = sz(abd, aee);
abd *= aef;
}
vec2 aix = vec2(cos(qg), sin(qg)) * zt;
vec2 aiy = bd + aix + abd;
float aiz = eu * 2.0;
float aja = or + adc * (aiz + 1.0);
float ajb = rx + ada * (aiz + 1.0);
vec2 ajc = ry * aja / 2.0;
vec2 ajd = rz * ajb / 2.0;
vec2 aje = sa * ajb / 2.0;
float ajf = (acp - aco);
float ajg = abc.x / 2.0 + 0.5;
float ro = aco + ajf * ajg;
float rs = adm + (adn - adm) * ro / 2.0;
float ajh = step(pw, FIRST_COMPLEX_SHAPE_ID - EPSILON);
float aji = ajh * SIMPLE_SHAPE_SAMPLING_SIZE + (1.0 - ajh) * COMPLEX_SHAPE_SAMPLING_SIZE;
float ajj = aji / COMPLEX_SHAPE_SAMPLING_SIZE;
float ajk = ajj * SHAPE_SAMPLING_BUFFER_RATIO / 2.0;
float ajl = ajj * (1.0 - SHAPE_SAMPLING_BUFFER_RATIO);
vec2 ajs = vec2(
mod(pw, NB_SHAPES_BY_SIDE),
floor(pw / NB_SHAPES_BY_SIDE)
);
vec2 ajt = ajs + vec2(ajk) +
vec2(aco * ajl, 0.0);
vec2 ajw = vec2(ajf, 1.0) * ajl;
vec2 rn = (ajt + ajw * (abc / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE;
vec2 rr = vec2(aja / ajf, ajb) / 2.0;
float akc = py * abb;
float akd = pz * abb;
float rp = akc + akd;
float rq = (ro * acq) / rp;
cq = aia
+ aib
* (abc + ahz / rr * u_viewZoom);
ns.rn = rn;
float ch = float(pw == 1.);
f = vec4(
(ajt + ajw * (vec2(0.5,0.5) / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE,
NB_SHAPES_BY_SIDE * (1. - qh) * ch,
float(ci)
);
ns.rr = rr;
ns.eu = eu;
ns.cl = cl;
ns.cm = cm;
ns.dc = dc;
ns.ro = xu(ro, acl, acn);
ns.rp = rp;
ns.py = akc;
ns.rq = rq;
ns.rs = rs;
ns.cq = cq;
ns.rt = rt;
ns.ru = ru;
ns.rv = rv;
ns.rw = rw;
ns.dh = dh;
ns.bd = aiy;
ns.or = aja + ch;
ns.rx = ajb + ch;
ns.ry = ry;
ns.rz = rz;
ns.sa = sa;
return true;
}
float aki(float akj, float akk, vec4 akl) {
float akm = clamp(((u_currentTime - akj) / akk), 0.0, 1.0);
float r = akm;
float akn = r * r;
float ako = akn * r;
vec4 akp = akm < 0.5 ? te(akl) : tg(akl);
float akq = akp.x;
float akr = akp.y;
float aks = akp.z;
float akt = akp.w;
float aku = akq + akr * r + aks * akn + akt * ako;
return aku;
}
void main() {
qm a_final = ze(
a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_final_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_final_x1_y1_x2_y2,
a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
#if ANIMATED
float akj = a_animationBeginTime_animationDuration.x;
float akk = a_animationBeginTime_animationDuration.y;
vec4 akl = a_animationEasing;
float aaq = aki(akj, akk, akl);
qm a_prev = ze(
a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_prev_x1_y1_x2_y2,
a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
const float ONE = 1.0;
a_final.pw = mix(a_prev.pw, a_final.pw, ONE);
a_final.py = mix(a_prev.py, a_final.py, aaq);
a_final.pz = mix(a_prev.pz, a_final.pz, aaq);
a_final.qa = mix(a_prev.qa, a_final.qa, ONE);
a_final.qb = mix(a_prev.qb, a_final.qb, ONE);
a_final.px = mix(a_prev.px, a_final.px, ONE);
a_final.qf = mix(a_prev.qf, a_final.qf, ONE);
a_final.qh = mix(a_prev.qh, a_final.qh, ONE);
a_final.qi = mix(a_prev.qi, a_final.qi, ONE);
a_final.qj = mix(a_prev.qj, a_final.qj, ONE);
a_final.qk = mix(a_prev.qk, a_final.qk, ONE);
a_final.qd = mix(a_prev.qd, a_final.qd, ONE);
a_final.qg = mix(a_prev.qg, a_final.qg, aaq);
a_final.dc = mix(a_prev.dc, a_final.dc, aaq);
a_final.qn = mix(a_prev.qn, a_final.qn, aaq);
a_final.qo = mix(a_prev.qo, a_final.qo, aaq);
a_final.qp = mix(a_prev.qp, a_final.qp, aaq);
a_final.qq =mix(a_prev.qq, a_final.qq, aaq);
a_final.qr = mix(a_prev.qr, a_final.qr, aaq);
a_final.qs = mix(a_prev.qs, a_final.qs, ONE);
a_final.cl = mix(a_prev.cl, a_final.cl, aaq);
a_final.cm = mix(a_prev.cm, a_final.cm, aaq);
a_final.dh = mix(a_prev.dh, a_final.dh, aaq);
a_final.qt = mix(a_prev.qt, a_final.qt, aaq);
a_final.qu = mix(a_prev.qu, a_final.qu, aaq);
a_final.qv = mix(a_prev.qv, a_final.qv, aaq);
a_final.qw = mix(a_prev.qw, a_final.qw, aaq);
a_final.qx = mix(a_prev.qx, a_final.qx, aaq);
a_final.qy = mix(a_prev.qy, a_final.qy, aaq);
a_final.qz = mix(a_prev.qz, a_final.qz, aaq);
a_final.ra = mix(a_prev.ra, a_final.ra, aaq);
a_final.rb = mix(a_prev.rb, a_final.rb, aaq);
a_final.rc = mix(a_prev.rc, a_final.rc, aaq);
a_final.rd = mix(a_prev.rd, a_final.rd, aaq);
a_final.re = mix(a_prev.re, a_final.re, aaq);
a_final.rf = mix(a_prev.rf, a_final.rf, aaq);
a_final.rg = mix(a_prev.rg, a_final.rg, aaq);
a_final.rh = mix(a_prev.rh, a_final.rh, ONE);
a_final.ri = mix(a_prev.ri, a_final.ri, ONE);
a_final.rj = mix(a_prev.rj, a_final.rj, ONE);
#endif
rm ns;
bool aky = aar(a_final, ns);
if (!aky) {
wz();
return;
}
vec2 abc = a_vertexInfo.xy;
a = ns.cl;
b = ns.cm;
c = ns.dh;
d = ns.rn;
e = ns.cq;
#if D3D9_FIX
#else
l = ns.eu;
m = ns.rt;
n = ns.ru;
o = vec2(ns.dc, ns.rs);
p = ns.ro;
q = ns.rp;
r = vec2(ns.py, ns.rq);
s = ns.rr;
t = ns.rw;
u = ns.rv;
#endif
float alb = step(abc.x, 0.0);
float alc = 1.0 - alb;
g = min(ns.rx, ROUNDED_BOX_RADIUS * 2.) * u_pixelRatio;
vec2 xb = ns.bd
+ ns.ry * (ns.or / 2.0) * abc.x
+ (alb * ns.rz + alc * ns.sa) * ns.rx / 2.0 * abc.y;
c = c * (1. - f.w)
+ vec4(
abc.x * ns.or,
abc.y * ns.rx,
ns.or,
ns.rx
) * u_pixelRatio * f.w;
gl_Position = xa(xb);
}
`,Eo=1e20,UI=class{constructor({fontSize:t=24,buffer:e=8,radius:s=6,cutoff:i=.25}={}){this._maxDimension=1,this._gridSize=1,this._fontSize=t,this._buffer=e,this._radius=s,this._cutoff=i,this._height=Math.ceil(this._fontSize+2*this._buffer*td),this._canvas=Ge(),this._canvas.height=this._height,this._canvas.width=1;const n=this._canvas.getContext("2d",{willReadFrequently:!0});this._ctx=n,n.textBaseline="middle",n.textAlign="center",n.fillStyle="black"}setOptions({fontSize:t=24,buffer:e=8,cutoff:s=.25,radius:i=6}){this._fontSize=t,this._buffer=e,this._cutoff=s,this._radius=i,this._height=Math.ceil(this._fontSize+2*this._buffer*td)}draw(t,e,s){$i(this._ctx,e,this._fontSize,s);const i=GI(this._ctx.measureText(t).width+2*this._buffer)-2*Hi,n=this._height,r=i*n,o=Math.max(i,n);this._canvas.width<i&&(this._canvas.width=i,$i(this._ctx,e,this._fontSize,s),this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="black"),r>this._gridSize&&(this._gridOuter=new Float64Array(r),this._gridInner=new Float64Array(r),this._gridSize=r),o>this._maxDimension&&(this._f=new Float64Array(o),this._d=new Float64Array(o),this._z=new Float64Array(o+1),this._v=new Int16Array(o),this._maxDimension=o),this._ctx.clearRect(0,0,i,n),this._ctx.fillText(t,i/2,n/2);const a=this._ctx.getImageData(0,0,i,n),l=new Uint8ClampedArray(r);for(let d=0;d<r;d++){const h=a.data[4*d+3]/255;this._gridOuter[d]=h===1?0:h===0?Eo:Math.pow(Math.max(0,.5-h),2),this._gridInner[d]=h===1?Eo:h===0?0:Math.pow(Math.max(0,h-.5),2)}hf(this._gridOuter,i,n,this._f,this._d,this._v,this._z),hf(this._gridInner,i,n,this._f,this._d,this._v,this._z);for(let d=0;d<r;d++){const h=this._gridOuter[d]-this._gridInner[d];l[d]=Math.max(0,Math.min(255,Math.round(255-255*(h/this._radius+this._cutoff))))}return{height:n,width:i,distance:l}}};function hf(t,e,s,i,n,r,o){for(let a=0;a<e;a++){for(let l=0;l<s;l++)i[l]=t[l*e+a];uf(i,n,r,o,s);for(let l=0;l<s;l++)t[l*e+a]=n[l]}for(let a=0;a<s;a++){for(let l=0;l<e;l++)i[l]=t[a*e+l];uf(i,n,r,o,e);for(let l=0;l<e;l++)t[a*e+l]=Math.sqrt(n[l])}}function uf(t,e,s,i,n){s[0]=0,i[0]=-Eo,i[1]=+Eo;for(let r=1,o=0;r<n;r++){let a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);for(;a<=i[o];)o--,a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);o++,s[o]=r,i[o]=a,i[o+1]=+Eo}for(let r=0,o=0;r<n;r++){for(;i[o+1]<r;)o++;e[r]=(r-s[o])*(r-s[o])+t[s[o]]}}function GI(t){return Math.ceil((t+2*Hi)/He)*He}var Ra=256,VI=.275,qI=.25,jI=6,YI=s2-2*Hi,HI=e2-2*Hi,cf={fontSize:Do,cutoff:VI,radius:jI},XI={fontSize:Do,cutoff:qI,radius:8},$I=class{constructor(t,e){this._patternIdToInfoTexture=new Uint8Array(Ra*Ra*4),this._glTextures=[],this._textureSizes=[],this._pixelRatio=1,this._gl=t,this._glUnit=e;const s=Ge(Ps,Ps),i=s.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Pattern: could not get 2d context");this._imageCanvasContext=i,this._imageCanvas=s,this._canvasForDuplicatedImage,this._sdfGenerator=new UI(cf),this._maxTextureSize=Math.min(4096,t.getParameter(t.MAX_TEXTURE_SIZE))}refresh(t){this._pixelRatio=t.getPixelRatio();const e=this._gl,s=this._getPatternsByFilter(t.getPatternList());for(let r=0;r<s.length;++r){const o=r,a=s[r],l=vI(a,this._maxTextureSize),{texture:d,size:h}=qb(o,a,l,this._maxTextureSize,this._patternIdToInfoTexture),u=this._glTextures[o]||(this._glTextures[o]=e.createTexture()),c=o===nr?Jc:wu;rf(e,u,this._glUnit+1+o,d,h,o,c),this._textureSizes[o]=h}const i=this._glTextureInfo||(this._glTextureInfo=e.createTexture()),n=this._patternIdToInfoTexture;rf(e,i,this._glUnit,n,Ra,nr,wu)}bindMetaDataTexture(){const t=this._gl;t.activeTexture(t.TEXTURE0+this._glUnit),t.bindTexture(t.TEXTURE_2D,this._glTextureInfo)}getInfoTextureUnit(){return this._glUnit}getNearestTextureUnit(){return this._glUnit+1+nr}getLinearTextureUnit(){return this._glUnit+1+vo}getLinearSdfTextureUnit(){return this._glUnit+1+Ao}getMipmapTextureUnit(){return this._glUnit+1+un}getInfoTextureSize(){return Ra}getNearestTextureSize(){return this._textureSizes[nr]}getLinearTextureSize(){return this._textureSizes[vo]}getLinearSdfTextureSize(){return this._textureSizes[Ao]}getMipmapTextureSize(){return this._textureSizes[un]}_getPatternsByFilter(t){const e=new Array(ef);for(let s=0;s<ef;++s)e[s]=[];for(let s=0;s<t.length;++s){const i=this._getPatternPixels(t[s]);e[i.filter].push(i)}return e}_getPatternPixels({id:t,type:e,attributes:s}){let i;const{text:n,font:r,style:o,image:a,scaled:l,duplicated:d,colorArray:h}=s;switch(e){case qi:i=d?this._getDuplicatedImagePixels(a):l?this._getScaledImagePixels(a):this._getNonScaledImagePixels(a);break;case pn:i=this._getSdfTextPixels(n,r,o);break;case An:i=this._getIconPixels(n,r,o);break;case En:i=this._getBadgeIconPixels(n,r,o);break;case sa:i=this._getPieChartPixels(h);break;default:throw new Error(`pattern type "${e}" does not exist`)}return i.id=t,i}_getScaledImagePixels(t){let e=t.width,s=t.height;if(e>0){const i=Ps/Math.max(t.width,t.height);e*=i,s*=i}return e&&s&&(e=vr(e),s=vr(s)),e-=2*Hi,s-=2*Hi,this._getImagePixels(t,e,s)}_getNonScaledImagePixels(t){return this._getImagePixels(t,t.width,t.height)}_getDuplicatedImagePixels(t){if(t.width===0||t.height===0)return this._getImagePixels(t,0,0);this._canvasForDuplicatedImage||(this._canvasForDuplicatedImage=Ge(Ps,Ps));const e=this._canvasForDuplicatedImage,s=e.getContext("2d"),i=t.width,n=t.height;let r=(Ps-i)/2,o=(Ps-n)/2;for(;r>0;)r-=i;for(;o>0;)o-=n;for(let a=r;a<Ps;a+=i)for(let l=o;l<Ps;l+=n)s.drawImage(t,a,l);return this._getImagePixels(e,Ps,Ps)}_getImagePixels(t,e,s){let i;if(e===0||s===0)i=new Uint8Array(0);else{(this._imageCanvas.width<e||this._imageCanvas.height<s)&&(this._imageCanvas.width=e,this._imageCanvas.height=s);const n=this._imageCanvasContext;vu(this._imageCanvas,n,e,s);try{n.drawImage(t,0,0,e,s)}catch{}i=n.getImageData(0,0,e,s).data}return{width:e,height:s,pixels:i,filter:un}}_getPieChartPixels(t){const e=HI,s=this._imageCanvasContext,i=e/2,n=e/2;return vu(this._imageCanvas,s,e,e),s.save(),s.rect(0,0,e,e),s.clip(),Yb(s,t,i,n,e),s.restore(),{width:e,height:e,pixels:s.getImageData(0,0,e,e).data,filter:vo}}_getTextPixels(t,e,s,i,n,r){const o=this._imageCanvasContext,a=n*this._pixelRatio;$i(o,s,a,i);let l=Math.ceil(o.measureText(e).width);l===0&&(l=a);let d=0,h=0;t===un||(d=2*Math.ceil(a*td/2),h=2*Math.ceil(l*ab/2));const u=Math.ceil(l+h),c=Math.ceil(a+d),g=this._imageCanvas.height<c||this._imageCanvas.width<u;return this._imageCanvas.height<c&&(this._imageCanvas.height=c),this._imageCanvas.width<u&&(this._imageCanvas.width=u),g&&$i(o,s,a,i),o.clearRect(0,0,u,c),o.fillStyle="black",o.textBaseline="middle",o.textAlign="left",o.fillText(e,r+h/2,c/2),{width:u,height:c,pixels:o.getImageData(0,0,u,c).data,filter:t}}_getIconPixels(t,e,s){return this._getTextPixels(un,t,e,s,YI,0)}_getBadgeIconPixels(t,e,s){return this._sdfGenerator.setOptions(XI),this._getSdfPixels(t,e,s)}_getSdfTextPixels(t,e,s){return this._sdfGenerator.setOptions(cf),this._getSdfPixels(t,e,s)}_getSdfPixels(t,e,s){const{width:i,height:n,distance:r}=this._sdfGenerator.draw(t,e,s),o=new Uint8Array(i*n*4);for(let a=0;a<r.length;++a)o[4*a+3]=r[a];return{width:i,height:n,pixels:o,filter:Ao}}},WI=class{constructor(t,e){this._gl=t,this._glTextureUnit=e,this._simpleShapePixels=new Uint8Array(Al*Al*4),this._complexShapePixels=new Uint8Array(ki*ki*4),this._shapesWritten=new Set}refresh(t){const e=t.getShapeList();for(const s of e)if(!this._shapesWritten.has(s.id)){const i=s.isSimple?Al:ki,n=s.isSimple?this._simpleShapePixels:this._complexShapePixels;AI(s,i,fu,n),this._loadShapeInGpu(s.id,i,n),this._shapesWritten.add(s.id)}}_loadShapeInGpu(t,e,s){const i=this._gl,n=_u,r=t%pu*ki,o=Math.floor(t/pu)*ki;if(this._texture)i.bindTexture(i.TEXTURE_2D,this._texture);else{const a=new Uint8Array(n*n*4);this._texture=i.createTexture(),i.activeTexture(i.TEXTURE0+this._glTextureUnit),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,n,0,i.RGBA,i.UNSIGNED_BYTE,a)}i.texSubImage2D(i.TEXTURE_2D,0,r,o,e,e,i.RGBA,i.UNSIGNED_BYTE,s)}getTextureSize(){return _u}getSamplingSize(){return ki}getBufferRatio(){return fu}getTextureUnit(){return this._glTextureUnit}rewriteShape(t){this._shapesWritten.delete(t)}},gf=class{constructor(t,{vertex:e,fragment:s,constants:i,macros:n}){this._state=0,this._gl=t,this._vertexSource=e,this._fragmentSource=s,this._constants=be(i||{}),this._macros=be(n||{})}setConstant(t,e){this._constants[t]=e}setMacro(t,e){this._macros[t]=e}getState(){return this._state}getProgram(){return this._program}compile(){const t=this._gl,e=mf(this._vertexSource,this._macros,this._constants),s=mf(this._fragmentSource,this._macros,this._constants);this._program&&(t.deleteProgram(this._program),t.deleteShader(this._vertexShader),t.deleteShader(this._fragmentShader));const i=t.createProgram(),n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);if(!(i&&n&&r))throw new Error("Error instantiating WebGL program");this._program=i,this._vertexShader=n,this._fragmentShader=r,t.shaderSource(this._vertexShader,e),t.compileShader(this._vertexShader),t.attachShader(this._program,this._vertexShader),t.shaderSource(this._fragmentShader,s),t.compileShader(this._fragmentShader),t.attachShader(this._program,this._fragmentShader),t.linkProgram(this._program),this._state=1}getError(){const t=this._gl;if(!t.getShaderParameter(this._vertexShader,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(this._vertexShader)||"";let s=e;const i=e.match(/ERROR: (\d+):(\d+):(.*)\n/g);if(i&&i.length){const n=this._vertexSource.split(`
`);s=i.map(r=>{const o=r.match(/ERROR: (\d+):(\d+):(.*)\n/);if(!o)return r;const[a,l]=o.slice(2);return`${n[+a]}
${n[+a+1]}
~~~~~~~~~~~
${n[+a+2]}
 -> ${l}`}).join(`
`)}return{step:"vertex",message:s}}return t.getShaderParameter(this._fragmentShader,t.COMPILE_STATUS)?t.getProgramParameter(this._program,t.LINK_STATUS)?(this._state=2,null):{step:"link",message:t.getProgramInfoLog(this._program)||""}:{step:"fragment",message:t.getShaderInfoLog(this._fragmentShader)||""}}};function mf(t,e,s){const i=Object.keys(e),n=Object.keys(s);for(let r=0;r<i.length;++r){const o=i[r],a=e[o];t=t.replace(`#define ${o} 0`,`#define ${o} ${a}`)}for(let r=0;r<n.length;++r){const o=n[r],a=s[o],l=a+(a%1==0?".0":"");t=t.replace(`const float ${o} = 0.0;`,`const float ${o} = ${l};`)}return t}function ZI(){return typeof window<"u"&&!!window.FORCE_WEBGL}/** @preserve instance id */var ff=Ib(),KI={stencil:!0,antialias:!1,alpha:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!ZI()},QI=0,JI=1,tL={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'},Xb=class extends Error{};function ch(t,e){if(!t&&e){const s=new Xb(tL[e]);throw s.code=e,s}}var eL=class $b extends xi{constructor(e){super(e),this._2dcanvas=Ge(),this._ctx=this._2dcanvas.getContext("2d"),this._bufferDrawers=[],this._mustResize=!1,this._error=null,this._onContextLost=l=>{l.preventDefault(),this._error=new Xb("WebGL context lost"),this.fire("error",this._error)};const s=$b.createInitData(),{canvas:i,gl:n,ext:r,staticProgramWrapper:o,animationProgramWrapper:a}=s;ch(n,"NO_WEBGL"),ch(r,"NO_ANGLE_INSTANCED_ARRAYS"),this._glCanvas=i,this._gl=n,this._ext=r,this._staticProgramWrapper=o,this._animationProgramWrapper=a,this._shapeTexture=new WI(this._gl,QI),this._patternTexture=new $I(this._gl,JI),this._initCanvas(this._glCanvas),this._computeShaderInfo(),this._initSpecialGlBuffers(),this._initGlPrograms(),this._initGl()}_initCanvas(e){super._initCanvas(e),e.addEventListener("webglcontextlost",this._onContextLost,!1)}static isAvailable(){return ff||ch(null,"NO_WEBGL"),ff}static createInitData(){const e=Ge(),s=Yc(e,KI,"webgl"),i=s&&typeof s.getExtension=="function"?s.getExtension("ANGLE_instanced_arrays"):null,n=nL(),r=new gf(s,{vertex:uh,fragment:hh,constants:n,macros:{ANIMATED:0}}),o=new gf(s,{vertex:uh,fragment:hh,constants:n,macros:{ANIMATED:1}});return s&&i&&(r.compile(),s.flush()),{canvas:e,gl:s,ext:i,staticProgramWrapper:r,animationProgramWrapper:o}}static getName(){return"WebGL"}_beforeFirstFrame(){this._animationProgramWrapper.getState()===0&&this._animationProgramWrapper.compile()}ensureAnimationsReady(){const e=this._animationProgramWrapper.getState();e!==2&&(e===0&&this._animationProgramWrapper.compile(),this._animationProgramWrapper.getError())}getDomElement(){return this._glCanvas}_initGl(){const e=this._gl;e.clearColor(0,0,0,0),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}_computeShaderInfo(){this._shaderMetadata=sL(uh,hh)}_initGlPrograms(){this._staticProgram=new df({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._staticProgramWrapper}),this._animationProgram=new df({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._animationProgramWrapper})}_initSpecialGlBuffers(){const e=this._gl,s=e.createBuffer(),i=new Int8Array(18*cs);for(let n=0;n<cs;++n){const r=[-1,-1,n,1,-1,n,1,1,n,-1,-1,n,-1,1,n,1,1,n],o=n*r.length;for(let a=0;a<r.length;a++)i[a+o]=r[a]}e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this._specialGlBuffers={vertexInfo:s}}_computeUniforms(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._scales.bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._scales.bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._scales.bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._scales.bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._scales.bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._scales.bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._scales.bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_UNIT_SIZE:He,ROUNDED_BOX_RADIUS:this._textManager.getCornerRadius(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}}_render({shapesChanged:e,patternsChanged:s,dimensionsChanged:i,backgroundColorChanged:n}){const r=this._gl;if(this._error)throw this._error;if(e&&(this._shapeTexture.refresh(this._shapeManager),this._patternTexture.bindMetaDataTexture()),s&&this._patternTexture.refresh(this._patternManager),i&&(this._mustResize=!0),n){const[l,d,h,u]=this._renderBackground?this._backgroundRgba:[0,0,0,0];r.clearColor(l*u,d*u,h*u,u)}const o=this._computeUniforms(),a=this._getSortedBufferList();this._mustResize&&a.length&&(Gl(this._glCanvas,this._width,this._height,this._pixelRatio),r.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),this._mustResize=!1),r.clear(r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT);for(let l=0;l<a.length;++l)this._displayBuffer(a[l],o);this._endFrame()}_displayBuffer(e,s){const i=e.getProgram();i!==this._currentProgram&&(this._currentProgram&&this._currentProgram.endPass(),this._currentProgram=i,this._currentProgram.startPass(s)),e.markAsUsed(),e.draw()}_getSortedBufferList(){const e=this._bufferList.getBuffersByAscendingDepth(),s=[];for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&n.markAsUnused()}for(let i=0;i<e.length;++i){const n=e[i],r=this._getBufferDrawer(n);r.markAsUsed(),!n.isEmpty()&&this._isBufferDisplayable(n)&&s.push(r)}for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&!n.isUsed()&&(n.destroy(),this._bufferDrawers[i]=void 0)}return s}_endFrame(){this._currentProgram&&(this._currentProgram.endPass(),this._currentProgram=null)}_getBufferDrawer(e){const s=e.getId();let i=this._bufferDrawers[s];if(!i){for(;this._bufferDrawers.length<=s;)this._bufferDrawers.push(void 0);i=new FI({gl:this._gl,ext:this._ext,staticProgram:this._staticProgram,animationProgram:this._animationProgram}),this._bufferDrawers[s]=i}return i.setDataBuffer(e),i}destroy(){this._glCanvas&&this._glCanvas.removeEventListener("webglcontextlost",this._onContextLost);const e=this._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}getImageData(){const e=this._glCanvas.width,s=this._glCanvas.height;return(this._2dcanvas.width<e||this._2dcanvas.height<s)&&(this._2dcanvas.width=e,this._2dcanvas.height=s),this._ctx.clearRect(0,0,e,s),this._ctx.drawImage(this._glCanvas,0,0),this._ctx.getImageData(0,0,e,s)}_getImageDataFlippedYAxis(){const e=this._gl,s=this._glCanvas.width,i=this._glCanvas.height,n=this._ctx.createImageData(s,i),r=new Uint8Array(n.data.buffer);return e.readPixels(0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,r),n}setConstant(e,s){this._staticProgramWrapper.setConstant(e,s),this._animationProgramWrapper.setConstant(e,s),this._staticProgramWrapper.compile(),this._animationProgramWrapper.compile(),this._initGlPrograms(),this._bufferDrawers.forEach(i=>{i?.destroy()}),this._bufferDrawers=[]}getShapeTexture(){return this._shapeTexture}};function sL(t,e){const s={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};return pf(s,t),pf(s,e),s}var iL={float:1,vec2:2,vec3:3,vec4:4};function pf(t,e){const s=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g,i=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g,n=[];let r=s.exec(e);for(;r;){const o=r[0];o==="#endif"?n.pop():o.startsWith("#if")?n.push(r[4]):t.attributes.push({name:r[3],size:iL[r[2]],type:r[1],tags:n.slice(),location:null,byteSize:0,glType:null}),r=s.exec(e)}for(r=i.exec(e);r;){if(!t.uniforms.some(({id:o})=>o===r[1])){const o=r[1],a=r[2],l=a.replace("u_","");t.uniforms.push({id:l,name:a,type:o})}r=i.exec(e)}}function nL(){return{BYTES_TO_OFFSET_ANGLE:2*Math.PI/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:Do,CURVATURE_RATIO:Cd,PATTERN_PADDING:Hi,TEXT_WIDTH_MULTIPLIER:ab,TEXT_HEIGHT_MULTIPLIER:td,SELF_LOOP_CURVATURE_RATIO:ed,EDGE_ARROW_SIZE_RATIO:xi.edgeArrowSizeRatio,EDGE_MIN_TIP_SIZE:xi.minEdgeTipSize,CURVE_SUBDIVISIONS:cs,PIECE_NODE_COMPONENT:Ls,PIECE_TEXT_BOX:_n,PIECE_EDGE_BODY:Nd,PIECE_EDGE_HEAD:kc,PIECE_EDGE_TAIL:Bc,PIECE_EDGE_TEXT:hn,MAX_TEXT_SIZE:$2,BYTES_TO_TEXT_OFFSET_X:1/Fb,BYTES_TO_TEXT_OFFSET_Y:1/Au,FILTER_NEAREST:nr,FILTER_LINEAR:vo,FILTER_LINEAR_SDF:Ao,FILTER_MIPMAP:un,SHAPE_TEXTURE_SIZE:_u,SIMPLE_SHAPE_SAMPLING_SIZE:Al,COMPLEX_SHAPE_SAMPLING_SIZE:ki,SHAPE_SAMPLING_BUFFER_RATIO:fu,MAX_SHAPES:Jl.toString(),FIRST_COMPLEX_SHAPE_ID:mu,SELF_LOOP_TO_CIRCLE_APPROX:hb,SDF_GAMMA:r2}}var rL={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,isBufferDisplayable:gc,hideImages:!1,renderBackground:!1,bentEnable:!1,bentVertical:!1},Fa={webgl:eL,canvas:wI,svg:MI},_f=[0,0,0,0],gh={webgl:null,svg:null,canvas:null},mh=class extends ea{constructor(t){super(),this._view=be(rL),this._domWrapper=vi?document.createElement("div"):Ul(),this._domElement=this._domWrapper.appendChild(vi?document.createElement("div"):Ul()),this._currentElementSize=0,this._currentBlockOffset=0,this._currentByteOffset=0,this._blockIdToAddress=new Uint32Array(0),this._renderersByType={},this._switchMainRenderer=!0,this._refreshTexts=!1,this._backgroundColor=null,this._initData=t||{},this._patternManager=new q2,this._shapeManager=new j2,this._boundariesManager=new m2,this._textManager=new W2(this._patternManager),this._bufferOffsetToId=new mb,this._memoryManager=new U2(this._patternManager,this._shapeManager,this._textManager,this._bufferOffsetToId,e=>this.parseColor(e)||_f),this._bufferList=new l2}static createInitData(){const t={};for(const e in Fa)t[e]=Fa[e].createInitData();return t}static cacheInitData(t){gh=t}static getCachedInitData(){return gh}static clearCachedInitData(){gh={webgl:null,svg:null,canvas:null}}freeBlock(t){this._checkBlockId(t);const e=this._blockIdToAddress[t],s=this._bufferList.freeBlock(e);return this._blockIdToAddress[t]=s,s}_ensureDomElementsFitParent(){const t=this._domElement.parentNode;!t||t.offsetWidth===this._view.width&&t.offsetHeight===this._view.height||Nn(t,`${this._view.width}px`,`${this._view.height}px`)}_ensureCorrectBackgroundColor(){const t=this._domElement.parentNode;this._backgroundColor!==this._view.backgroundColor&&t&&(t.style.backgroundColor=this._view.backgroundColor||"",this._backgroundColor=this._view.backgroundColor)}createGroup(){return new g2}parseColor(t){return $e(t)}clear(){this._blockIdToAddress.fill(0),this._patternManager.reset(),this._boundariesManager.reset(),this._textManager.reset(),this._bufferList.reset(),this._bufferOffsetToId.reset()}notifyFontsReloaded(){this._patternManager.notifyUpdate(),this._textManager.clear(),this._refreshTexts=!0}notifyPatternUpdate(){this._patternManager.notifyUpdate()}getShapePoints(t){return this._shapeManager.getDefinitionFromName(t).points}checkShapeHit(t,e,s){const{getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:n}=this._shapeManager.getDefinitionFromName(t);return Math.min(i(e,s),n(e,s))>=0}setGlobalBoundaries(t){const{maxBlockId:e=0,maxScaledSize:s,maxMinVisibleSize:i,maxSymbolicSize:n,maxDashLength:r,maxGapLength:o,maxPatternScale:a}=t;return e>this._blockIdToAddress.length&&this._resizeBlockArray(e),!!this._boundariesManager.set(t)&&(this._memoryManager.resizeBoundaries(s,i,n,r,o,a),!0)}_resizeBlockArray(t){const e=new Uint32Array(t);e.set(this._blockIdToAddress),this._blockIdToAddress=e}registerShape(t,e){this._shapeManager.register(t,e)}updateShape(t,e){this._shapeManager.updateShape(t,e);const s=this._renderersByType.webgl?.getShapeTexture();s&&s.rewriteShape(this._shapeManager.getIdFromName(t))}_bindBlock(t,e,s,i,n,r,o){this._checkBlockId(t);const a=this._blockIdToAddress[t],l=this._bufferList.allocateBlock(a,e,s,i,n,r,o);return this._blockIdToAddress[t]=l.address,this._currentDataView=l.buffer.getDataView(),this._currentElementSize=l.buffer.elementSize,this._currentBlockOffset=l.offset,this._currentByteOffset=this._currentBlockOffset*this._currentElementSize,this._currentSideDataView=l.buffer.getSideDataView(),this._currentSideElementSize=l.buffer.getTotalSideElementsSize(),this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize,l}_setItemIndex(t){const e=this._currentBlockOffset+t;this._currentByteOffset=e*this._currentElementSize,this._currentSideByteOffset=e*this._currentSideElementSize}_checkBlockId(t){t>=this._blockIdToAddress.length&&this._resizeBlockArray(Bi(t+1))}_setTextCharacters(t){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,t)}_storeElement(t,e){this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset,t.end),e&&(this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset+xr,t.start),this._memoryManager.storeAnimationInformation(this._currentDataView,this._currentByteOffset+2*xr,t.animation,Gc.getCoefficients(t.animation.easing)))}storeGroup(t,e){if(!e||e.size===0)return this.freeBlock(t);const s=e.type,i=e.depth,n=e.size,r=e.getElements(),o=e.animated,a=e.stencilUsage,l=e.getId();let d=0;if(s===vn)for(let u=0;u<n;++u){const c=r[u],{start:g,end:m}=c;if(m.pattern.type===Xi){const f=m.pattern.attributes.text;d=Math.max(d,f.length)}if(o&&g.pattern.type===Xi){const f=g.pattern.attributes.text;d=Math.max(d,f.length)}}const h=this._bindBlock(t,s,o,i,n,d,a);for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._storeElement(c,o),this._bufferOffsetToId.set(h.buffer.getId(),h.offset+u,l)}if(s===vn)for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._setTextCharacters(c.end.pattern)}return h.address}_refreshTextElements(){const t=this._bufferList.getBuffers();for(const e of t)if(e&&e.type===vn){const s=e.getSideDataView(),i=e.getTotalSideElementsSize(),n=e.getSize();let r=0,o=i;for(let a=0;a<n;++a){const l=this._textManager.extractTextFromDataView(s,r,o);this._textManager.storeTextInDataView(s,r,o,l),r=o,o+=i}e.triggerUpdate()}}extractElement(t,e=0){if(!t)return null;const s=this._bufferList.getBlockInfo(t);return this._renderer.extractElement(s.buffer,s.offset+e)}getDomElement(){return this._domElement}getDomWrapper(){return this._domWrapper}measureText(t,e,s,i=1){return this._textManager.measureText(t,e,s,i)}setRenderType(t){this._renderType!==t&&(this._renderType=t,this._switchMainRenderer=!0)}setEdgeArrowSizeRatio(t){xi.setEdgeArrowSizeRatio(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_ARROW_SIZE_RATIO",t)}setEdgeMinTipSize(t){xi.setMinEdgeTipSize(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_MIN_TIP_SIZE",t)}setBentEdges(t,e){this._view.bentEnable=t,this._view.bentVertical=e}getBentEdges(){return{bentEnable:this._view.bentEnable,bentVertical:this._view.bentVertical}}_ensureMainRendererReady(){if(this._switchMainRenderer){this._renderType===null&&(this._renderType="canvas");const t=Fa[this._renderType];t&&t.isAvailable()||(this._renderType="canvas"),this._renderer=this._renderersByType[this._renderType],this._renderer||(this._renderer=this._instanciateRenderer(this._renderType),this._renderer.on("error",e=>this.fire("error",e)),this._renderersByType[this._renderType]=this._renderer),this._updateDomElement()}}_updateDomElement(){const t=this._renderer&&this._renderer.getDomElement(),e=this._domElement;for(;e&&e.firstChild;)e.removeChild(e.firstChild);t&&this._appendDomChild(t)}_appendDomChild(t){t.style.position="absolute",t.style.left="0",t.style.top="0",this._domElement.appendChild(t)}_instanciateRenderer(t){return new(t===null?xi:Fa[t])({initData:t===null?null:this._initData[t],bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,memoryManager:this._memoryManager})}setView(t){this._view={...this._view,...t}}getTextManager(){return this._textManager}_updateManagers(){this._patternManager.setPixelRatio(this._view.pixelRatio),this._shapeManager.update(),this._patternManager.update(),this._textManager.update(),this._boundariesManager.update(),this._bufferList.update(),this._refreshTexts&&(this._refreshTexts=!1,this._refreshTextElements())}_resizeCanvas(t){_b(t,this._view.width,this._view.height,this._view.pixelRatio)}render(){this._ensureMainRendererReady(),this._ensureDomElementsFitParent(),this._ensureCorrectBackgroundColor(),this._updateManagers(),this._renderer.renderFrame(this._view)}ensureAnimationsReady(){this._ensureMainRendererReady(),this._renderer.ensureAnimationsReady()}export(t,e,s){const i=this._instanciateRenderer(t),n={...this._view,...e};return"setViewportClipping"in i&&i.setViewportClipping(!1),this._updateManagers(),i.renderFrame(n),i.export(s).then(()=>i.getDomElement())}getCurrentTime(){return Xe()}getImageData(){return this._renderer&&this._renderer.getImageData()}destroy(){for(const t of Object.keys(this._renderersByType)){const e=this._renderersByType[t];e&&e.destroy()}}transparentify(t){const e=this.parseColor(t)||_f;return`rgba(${Math.round(255*e[0])},${Math.round(255*e[1])},${Math.round(255*e[2])},0)`}initDebugRenderingLoop({triggerKey:t="r",start:e=!0}={}){let s=e;document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s)});const i=n=>{(s||n)&&(this.setView({currentTime:Xe()}),this.render()),window.requestAnimationFrame(()=>{i()})};window.requestAnimationFrame(()=>{document.body.appendChild(this.getDomElement()),i(!0)})}},oL=bd&&document.fonts,aL=200,fh="/qwerty/ [HELLO] ",yf="serif",lL=16,dL=class{constructor(){this._fontFaceSet=oL?document.fonts:null,this._canvas=Ge(),this._ctx=this._canvas.getContext("2d")}_measureText(t,e){return this._ctx.font=`12px ${e}`,this._ctx.measureText(t).width}check(t){if(t===yf)return!0;const e=this._measureText(fh,yf);return this._measureText(fh,t)!==e}load(t){return this._fontFaceSet&&this._fontFaceSet.load?this._fontFaceSet.load(`12px ${t}`):(this._ctx.font=`12px ${t}`,this._ctx.fillText(fh,10,50),Promise.resolve())}},hL=class{constructor(t,e){this._fontLoaderCounter=0,this._loaded=!1,this._value=null,this._timeout=0,this._fontFaceSet=t,this._fontName=e,this._loaded=!1,this._value=null,this._timeout=0,bd&&!this._fontFaceSet.check(this._fontName)||this._setLoaded()}_setLoaded(){this._loaded=!0,this._value=this._fontName}getValue(){return this._value}isLoaded(){return this._loaded}destroy(){clearTimeout(this._timeout)}load(){return this._tryLoad(aL).then(()=>this._setLoaded())}_tryLoad(t){return this._fontFaceSet.load(this._fontName).then(()=>{if(!this._fontFaceSet.check(this._fontName)&&this._fontLoaderCounter<lL)return new Promise(e=>{t<6e4&&(this._timeout=setTimeout(e,t))}).then(()=>(this._fontLoaderCounter++,this._tryLoad(1.5*t)))})}},uL=class{constructor(){this._fontFaceSet=new dL,this._fonts={},this._onFontLoaded=[],this._hideUntilFontsLoaded=!0}setHideUntilFontsLoaded(t){this._hideUntilFontsLoaded=t}getFont(t){let e=this._fonts[t];return e||(e=new hL(this._fontFaceSet,t),this._fonts[t]=e,e.isLoaded()||e.load().then(()=>this._triggerFontLoaded(t))),!this._hideUntilFontsLoaded&&t||e.getValue()}onFontLoaded(t){this._onFontLoaded.push(t)}destroy(){this._onFontLoaded=[],Object.keys(this._fonts).forEach(t=>this._fonts[t].destroy())}_triggerFontLoaded(t){this._onFontLoaded.forEach(e=>e(t))}};function cL(t,e,s,i){tg(t,e,s,i),t.thicknessOrFontSizeScaled=e.widthScaled,t.thicknessOrFontSizeFixed=e.widthFixed,t.strokeWidthScaled=e.stroke.widthScaled,t.strokeWidthFixed=e.stroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.color,t.strokeColor=e.stroke.color,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=e.stroke.minVisibleSize,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function tg(t,e,s,i){t.pieceId=s,t.shape=i,t.x1=e.sourceX,t.y1=e.sourceY,t.x2=e.targetX,t.y2=e.targetY,t.rectWidthOrSourceRadiusScaled=e.sourceRadiusScaled,t.rectWidthOrSourceRadiusFixed=e.sourceRadiusFixed,t.rectHeightOrTargetRadiusScaled=e.targetRadiusScaled,t.rectHeightOrTargetRadiusFixed=e.targetRadiusFixed,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=We,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.widthScaled,t.curvature=e.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=e.isSelfLoop,t.isText=!1}function gL(t,e,s){const i=e.widthScaled+2*e.halo.widthScaled,n=e.widthFixed+2*e.halo.widthFixed;tg(t,e,s,"line"),t.thicknessOrFontSizeScaled=i,t.thicknessOrFontSizeFixed=n,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.halo.color,t.strokeColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1}function mL(t,e,s,i){tg(t,e,s,i);const n=e.widthFixed*$m+P2;t.thicknessOrFontSizeScaled=e.widthScaled*Xm,t.thicknessOrFontSizeFixed=e.widthFixed*Xm,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=e.widthScaled*$m,t.offsetFixed=n,t.fillColor=e.outline.color,t.strokeColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,e.outline.minVisibleSize),t.strokeMinVisibleSize=0,t.offsetAngle=Math.PI/2,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function fL(t,e,s){Wb(t,e,s),t.pattern.type=Xi,t.pattern.attributes.text=e.content,t.pattern.attributes.size=ta,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternColor=e.color,t.patternScale=1,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function pL(t,e,s){Wb(t,e,s),t.pieceId+=_n,t.fillColor=e.backgroundColor,t.shape="square"}function Wb(t,e,s){const i=e.position==="centered"?0:(s.widthScaled+e.heightScaled)/2+s.stroke.widthScaled,n=e.position==="centered"?0:(s.widthFixed+e.heightFixed)/2+s.stroke.widthFixed+e.padding+e.margin;if(t.pieceId=hn,t.shape="square",t.x1=s.sourceX,t.y1=s.sourceY,t.x2=s.targetX,t.y2=s.targetY,!s.isSelfLoop&&s.curvature===0){const r=Math.atan2(t.y2-t.y1,t.x2-t.x1),o=s.sourceRadiusScaled-s.targetRadiusScaled,a=Math.cos(r),l=Math.sin(r);t.x1+=a*o,t.y1+=l*o}t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding+1,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=s.sourceRadiusScaled+s.targetRadiusScaled,t.strokeWidthFixed=s.sourceRadiusFixed+s.targetRadiusFixed,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=We,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,s.minVisibleSize),t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.offsetAngle,t.patternScale=0,t.symbolicSize=s.widthScaled,t.curvature=s.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=s.isSelfLoop,t.isText=!1,t.adjustTextAngle=e.adjustAngle}var _L=t=>!!t||t===0;function Ys(t,e,s=0){return t==="inherit"?Array.isArray(e)?e[((s/(2*Math.PI)*e.length|0)+1)%e.length]:e:t}function yL(t,e,s){return t==="source"?Array.isArray(e)?e[0]:e:t==="target"?Array.isArray(s)?s[0]:s:t}function xL(t){const e=t.depth;return e===xb||e===yb||(e-Vc)%jc>=qc}function Zb(t){const e=(t.depth-Vc)%jc;return e>=0&&e!==bb&&e!==qc}var ia="shifted",bL="centered";/**
 * Ogma Parsers
 * @description Parsers for Ogma
 * @version 0.0.27 (built on Thu Apr 10 2025 15:39:50 GMT+0000 (Coordinated Universal Time))
 * @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
 * @license (c) Linkurious 2025. All rights reserved.
 * @preserve
 */function Pi(t,e,s){s=s||e,e in t&&(t.attributes[s]=t[e])}function Kb(t,e=s=>s){const s=e(JSON.parse(t)),i=s.nodes||[],n=s.edges||[];for(let r=0;r<i.length;r++){const o=i[r];o.attributes||(o.attributes={}),typeof o.size=="string"&&(o.size=+o.size),typeof o.x=="string"&&(o.x=+o.x),typeof o.y=="string"&&(o.y=+o.y),Pi(o,"x"),Pi(o,"y"),Pi(o,"size","radius"),Pi(o,"color"),Pi(o,"text")}for(let r=0;r<n.length;r++){const o=n[r];o.attributes||(o.attributes={}),typeof o.size=="string"&&(o.size=+o.size),Pi(o,"size","width"),Pi(o,"color"),Pi(o,"text")}return{nodes:i,edges:n}}function vL(t){return t.type==="vertex"||t._type==="vertex"||t.inE||t.outE||t._inE||t._outE}function AL(t){return t.type==="edge"||t._type==="edge"||t.inV||t.outV||t._outV||t._inV}function no(t,e,s){if(t&&typeof t=="object"){if(Array.isArray(t))return t.forEach(i=>no(i,e,s));if(vL(t)){const i={};t.properties&&Object.keys(t.properties).forEach(r=>{i[r]=t.properties[r][0].value});const n=Tu(t);e.push({id:n,data:{id:t.id+"",categories:[t.label],properties:i}});for(const r in t)r!=="properties"&&no(t[r],e,s);return}if(AL(t)){const i=Tu(t);s.push({id:i,source:xf(t,["inV","_inV"]),target:xf(t,["outV","_outV"]),data:{id:i,type:t.label,properties:t.properties||{}}});for(const n in t)n!=="properties"&&no(t[n],e,s);return}Object.keys(t).forEach(i=>no(t[i],e,s))}}function xf(t,e){for(const s of e)if(t[s])return Tu(t[s])}function Tu(t){if(typeof t=="string"||isFinite(t))return String(t);const e=t;return String(e.id||e._id)}function EL(t){const e=[],s=[];return no(typeof t=="string"?JSON.parse(t):t,e,s),{nodes:e,edges:s}}var os=t=>t.charCodeAt(0),SL=os(" "),bf=os("<"),wl=os(">"),vf=os('"'),wL=os(`
`),TL=os("\r"),Tl=os("/"),IL=os("\\"),LL=os("a"),CL=os("z"),NL=os("A"),ML=os("Z"),RL=os("0"),FL=os("9"),PL=os(":"),Qb=-1,Iu=-2,Jb=-3,t0=-4;function zL(t){const e=new Int32Array(t.length);for(let s=0,i=t.length;s<i;++s)e[s]=t.charCodeAt(s);return e}function DL(t,e,s,i){const n=i.length;if(s-e!==n)return!1;for(let r=0;r<n;++r)if(t[e+r]!==i[r])return!1;return!0}function OL(t,e,s,i){return e0(t.tags,e,s,i)}function kL(t,e,s,i){return e0(t.attributes,e,s,i)}function e0(t,e,s,i){const n=t.length;for(let r=0;r<n;++r)if(DL(e,s,i,t[r]))return r;return t.push(e.slice(s,i)),n}function BL(t,e,s){let i=Il(e,s),n=e[i];if(n===wl||n===Tl)return i;let r=i;i=i0(e,i);const o=kL(t,e,r,i);for(;e[i]!==vf;)++i;for(++i,r=i;(n=e[i])!==vf;)n===IL&&++i,++i;return t.tokens.push(Jb,o,r,i),i+1}function UL(t,e){let s,i;const n={tags:[],attributes:[],tokens:[]},r=n.tokens;let o=Il(t,e);for(;o<t.length;){let a=t[o];if(a===bf){if(o=Il(t,++o),t[o]===Tl)for(r.push(Iu);t[++o]!==wl;);else{s=o,o=i0(t,s);const l=OL(n,t,s,o);for(r.push(Qb,l),a=t[o];a!==wl&&a!==Tl;)o=BL(n,t,o),a=t[o];if(a===Tl)for(r.push(Iu);t[++o]!==wl;);}o+=1}else{for(s=o;t[++o]!==bf;);for(i=o-1;s0(t[i]);)--i;r.push(t0,s,i+1)}o=Il(t,o)}return n}function s0(t){return t===SL||t===wL||t===TL}function Il(t,e){for(;s0(t[e]);)++e;return e}function GL(t){return t>=LL&&t<=CL||t>=NL&&t<=ML||t===PL||t>=RL&&t<=FL}function i0(t,e){for(;GL(t[e]);)++e;return e}function Af(t,e){const s=Object.keys(e),i={};if(s.length>0)for(let n=0;n<s.length;++n){const r=e[s[n]],o=r.title;i[o]=r.default!==void 0?JSON.stringify(r.default):void 0}return t?()=>({id:void 0,attributes:{text:void 0,color:void 0,radius:void 0,x:void 0,y:void 0},data:{...i}}):()=>({id:void 0,source:void 0,target:void 0,attributes:{color:void 0,text:void 0,width:void 0},data:{...i}})}function Ef(t){return t.indexOf("\\")===-1||(t=t.replace(/\\"/g,'"')),t}function n0(t){if(t.indexOf("<gexf")===-1)throw new Error("not a GEXF file");const e=zL(t),s=UL(e,t.indexOf("<gexf ")),i={},n={};s.tags.forEach((ae,Ft)=>{const Pt=String.fromCharCode.apply(null,ae);i[Pt]=Ft}),s.attributes.forEach((ae,Ft)=>{const Pt=String.fromCharCode.apply(null,ae);n[Pt]=Ft});const r=i.attributes,o=i.attribute,a=i.node,l=i.edge,d=i.default,h=i["viz:position"],u=i["viz:size"],c=i["viz:color"],g=i.attvalue,m=n.class,f=n.id,p=n.type,_=n.title,y=n.label,x=n.source,b=n.target,v=n.x,A=n.y,E=n.r,S=n.g,w=n.b,T=n.a,L=n.value,R=n.for,k=n.weight,j={float:1,double:1,integer:2,boolean:3,string:4,"list-string":5};let z=0;const q=s.tokens,B=q.length,W=new Array(16);let Z=0,it=0,dt=0,At=!0;const gt={},ct={};let yt,Tt,Gt="",Vt="",St="",ft={attributes:{}},pt=0,It=0,Lt=0,zt=1,_t="",Dt=!1,oe=!0,qt=null,jt=null;const Zt=[],ie=[];let he=0,Yt={};for(;z<B;){const ae=q[z];if(ae===Qb)it=Z,Z=q[z+1],W[dt]=Z,dt+=1,Z===a?(qt||(qt=Af(!0,gt)),ft=qt(),oe=!0,Yt=gt):Z===l&&(jt||(jt=Af(!1,ct)),ft=jt(),oe=!1,Yt=ct),z+=2;else if(ae===Iu){if(Gt&&Z===o){Yt=At?gt:ct;const Ft=j[Vt];let Pt=yt;Pt&&(Ft===1?Pt=+Pt:Ft===2?Pt=0|+Pt:Ft===3?Pt=Pt==="true":Ft===5&&(Pt=Pt.split(" ").filter(Ee=>Ee))),Yt[Gt]={title:St||Gt,default:Pt,type:Ft},Gt="",St="",Vt="",yt=void 0}else if(Z===a&&dt===4)Dt&&ft.attributes&&(ft.attributes.color=`rgba(${pt}, ${It}, ${Lt}, ${zt})`,pt=0,It=0,Lt=0,zt=1,Dt=!1),ft.id||(ft.id=++he),Zt.push(ft);else if(Z===l&&dt===4)ft.id||(ft.id=++he),ie.push(ft);else if(Z===g&&dt===6&&_t){const Ft=(oe?gt:ct)[_t];if(Ft){if(Tt===void 0)Tt=Ft.default;else{const Ee=Ft.type;Ee&&(Ee===1?Tt=+Tt:Ee===2?Tt=0|+Tt:Ee===3?Tt=Tt==="true":Ee===5?Tt=Tt.split(" ").filter(ps=>ps).map(ps=>Ef(ps)):typeof e=="string"&&(Tt=Ef(Tt)))}ft.data||(ft.data={});const Pt=Yt;ft.data[Pt[_t].title]=Tt}_t="",Tt=null}dt-=1,Z=it,it=W[dt-2],z+=1}else if(ae===Jb){const Ft=q[z+1],Pt=t.substring(q[z+2],q[z+3]);if(Z===r)Ft===m&&(At=Pt!=="edge"&&Pt!=="edges");else if(Z===o)Ft===f?Gt=Pt:Ft===p?Vt=Pt:Ft===_&&(St=Pt);else if(Z!==a&&Z!==l||dt!==4)if(Z===h&&dt===5){if(Ft===v)ft.attributes.x=parseFloat(Pt);else if(Ft===A){const Ee=parseFloat(Pt);ft.attributes.y=Ee===0?Ee:-Ee}}else Z===c&&dt===5?(Dt=!0,Ft===E?pt=parseInt(Pt):Ft===S?It=parseInt(Pt):Ft===w?Lt=parseInt(Pt):Ft===T&&(zt=parseFloat(Pt))):Z===u&&dt===5?Ft===L&&(oe?ft.attributes.radius=+Pt:ft.attributes.width=+Pt):Z===g&&dt===6&&(Ft===R||Ft===f?_t=Pt:Ft===L&&(Tt=Pt));else Ft===f?ft.id=Pt:Ft===y?ft.attributes.text=Pt:Ft===x?ft.source=Pt:Ft===b?ft.target=Pt:Ft===k&&(ft.attributes.width=+Pt);z+=4}else{if(ae!==t0)throw new Error(`at index ${z}: token ${ae}`);{const Ft=t.substring(q[z+1],q[z+2]);Z===d&&(yt=Ft),z+=3}}}return{nodes:Zt,edges:ie}}function VL(t){for(let e=0;e<64;++e)t[e]^=1;for(let e=0;e<64&&!(t[e]^=1);++e);}function qL(t,e,s){for(let i=0;i<32;++i)s[i]=+!!(t&1<<i);for(let i=0;i<32;++i)s[i+32]=+!!(e&1<<i);return s}function Sf(t,e){let s=0;for(let i=0;i<20;++i){const n=s+t[i]+e[i];s=+(n>=10),t[i]=n%10}}var jL=class{constructor(){this._decimalPowerOfTwo=new Uint8Array(20),this._binaryNumber=new Uint8Array(64),this._decimalNumber=new Uint8Array(20)}int64ToString({low:t,high:e}){if(t===0&&e===0)return"0";qL(t,e,this._binaryNumber),this._decimalNumber.fill(0),this._decimalPowerOfTwo.fill(0),this._decimalPowerOfTwo[0]=1;const s=this._binaryNumber[63]===1;s&&VL(this._binaryNumber);for(let r=0;r<64;++r)this._binaryNumber[r]&&Sf(this._decimalNumber,this._decimalPowerOfTwo),Sf(this._decimalPowerOfTwo,this._decimalPowerOfTwo);const i=[];let n=this._decimalNumber.length-1;for(s&&i.push("-");!this._decimalNumber[n];)n-=1;for(let r=n;r>=0;--r)i.push(String(this._decimalNumber[r]));return i.join("")}},YL=new jL;function Pa(t){return YL.int64ToString(t)}function za(t){return typeof t=="object"&&"high"in t&&"low"in t}function HL(t){return"start"in t&&"end"in t}function XL(t){if(typeof t!="object"||t===null)throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. Please make sure that your Cypher query returns nodes and edges, not values.");const e=Object.keys(t.properties);for(const s of e){const i=t.properties[s];za(i)&&(t.properties[s]=Pa(i))}if(t.identity!==void 0){if(za(t.identity)&&(t.identity=Pa(t.identity)),HL(t)){const s=t.start.identity||t.start,i=t.end.identity||t.end;za(s)&&(t.start=Pa(s)),za(i)&&(t.end=Pa(i))}}else t.id&&(t.identity=t.id)}var $L=t=>"start"in t&&"end"in t&&"type"in t,WL=t=>"segments"in t;function ZL(t,e,s,i){e.segments.forEach(n=>{So(t,n.start,s,i),So(t,n.end,s,i),So(t,n.relationship,s,i)})}function So(t,e,s,i){if(e)if(Array.isArray(e))e.forEach(n=>So(t,n,s,i));else if(WL(e))ZL(t,e,s,i);else if(XL(e),$L(e))i.has(e.identity)||(i.add(e.identity),t.edges.push({id:e.identity,source:e.start,target:e.end,data:{neo4jType:e.type,neo4jProperties:e.properties}}));else{const n=e;s.has(n.identity)||(s.add(n.identity),t.nodes.push({id:n.identity,attributes:{},data:{neo4jLabels:n.labels,neo4jProperties:n.properties}}))}}var KL=t=>"queryKeys"in t&&"values"in t;function QL(t){const e=[];return t.values.forEach(s=>{const{nodes:i=[],relationships:n=[],segments:r=[]}=s.adapted,o=[{segments:r,properties:{}}];e.push({_fields:[...i,...n,...o]})}),{records:e}}function JL(t){let e=typeof t=="string"?JSON.parse(t):t;const s={nodes:[],edges:[]},i=new Set,n=new Set;return KL(e)&&(e=QL(e)),e.records.forEach(({_fields:r})=>r.forEach(o=>So(s,o,i,n))),s}var tC={boolean:t=>t.toLowerCase()==="true",int:parseFloat,long:parseFloat,float:parseFloat,double:parseFloat,string:t=>t};function eC(t){const e={graph:{},node:{},edge:{}},s={graph:{},node:{},edge:{}};for(let i=0;i<t.length;i++){const n=t[i],r=n.getAttribute("for")||"node",o=n.getAttribute("id"),a=n.getAttribute("attr.name"),l=n.getAttribute("attr.type")||"string",d=n.getElementsByTagName("default"),h=d.length!==0?d[0].textContent:void 0;e[r][o]={name:a,parse:tC[l]},typeof h<"u"&&(s[r][a]=h)}return{definitions:e,defaults:s}}function wf(t,e,s){const i=t.getElementsByTagName("data"),n={};for(let r=0;r<i.length;r++){const o=i[r],a=o.getAttribute("key");if(a===null)continue;const l=e[a];typeof l>"u"?n[a]=o.textContent:o.textContent&&o.textContent.length!==0&&(n[l.name]=l.parse(o.textContent))}for(const r in s)r in n||(n[r]=s[r]);return n}function ph(t){return t.color?t.color:t.r&&t.g&&t.b?`rgb(${t.r}, ${t.g}, ${t.b})`:void 0}var sC=new Set(["x","y","size","color","r","g","b","label"]);function Tf(t){const e={};for(const s in t)sC.has(s)||t[s]===void 0||(e[s]=t[s]);return e}function r0(t,e){if(!e){if(typeof DOMParser>"u")throw new Error("DOMParser is not available. You need to provide a DOMParser instance as second argument, if you are not in the browser environment");e=new DOMParser}const s=e.parseFromString(t,"application/xml"),i=s.getElementsByTagName("key"),n=s.getElementsByTagName("node"),r=s.getElementsByTagName("edge"),{definitions:o,defaults:a}=eC(i),l=[],d=new Set;for(let u=0;u<n.length;u++){const c=n[u],g=c.getAttribute("id"),m=c.getAttribute("href")||void 0,f=wf(c,o.node,a.node);d.add(g);const p={id:g,attributes:{x:f.x,y:f.y,radius:f.size,color:ph(f),text:f.label},data:Tf(f)};f.x!==void 0&&(p.attributes.x=f.x),f.y!==void 0&&(p.attributes.y=f.y),f.size!==void 0&&(p.attributes.radius=f.size),f.label!==void 0&&(p.attributes.text=f.label);const _=ph(f);_!==void 0&&(p.attributes.color=_),m!==void 0&&(p.data.href=m),l.push(p)}const h=[];for(let u=0;u<r.length;u++){const c=r[u],g=c.getAttribute("id")||u,m=c.getAttribute("source"),f=c.getAttribute("target"),p=c.getAttribute("xlink:href")||void 0;if(!d.has(m)||!d.has(f))throw new Error(`Invalid edge: ${m} -> ${f}`);const _=wf(c,o.edge,a.edge),y={id:g,source:m,target:f,attributes:{},data:Tf(_)},x=ph(_);x!==void 0&&(y.attributes.color=x),p!==void 0&&(y.data.href=p),h.push(y)}return{nodes:l,edges:h}}var o0=t=>{const e=t.split(`
`).filter(n=>!n.startsWith("%")),[s]=e[0].split(" ").map(Number),i=e.slice(1).map(n=>n.split(" ").slice(0,2).map(Number)).filter(n=>n.length===2);return{nodes:Array.from({length:Number(s)},(n,r)=>({id:r})),edges:i.map(([n,r])=>({source:n%s,target:r%s}))}};function If(t,e,s,i,n,r){iC(t,e,s,i,n,r),Lf(t,e,s,i.text,n.texts.primary,r.texts.primary,r),Lf(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r)}function iC(t,e,s,i,n,r){if(_h(n.body,r,cL),n.halo.body){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),_h(n.halo,r,gL)}n.outline.body&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),_h(n.outline,r,mL))}function _h(t,e,s){s(t.body,e,Nd,e.shape.body),t.head&&s(t.head,e,kc,e.shape.head),t.tail&&s(t.tail,e,Bc,e.shape.tail)}function Lf(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=Ys(a.color.get(s),o.color),r.position=a.position?a.position.get(s):ia,r.style=a.style.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=Hc(r.content,r.maxLineLength),r.adjustAngle=a.adjustAngle.get(s),r.align=a.align.get(s),l){const h=a.scale.get(s);r.sizeScaled=o.widthScaled*h,r.sizeFixed=o.widthFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.offsetAngle=r===o.texts.primary?z2:D2,fL(n.text,r,o),n.background&&pL(n.background,r,o)}}function Cf(t,e){yh(t.body,e,!0,!0),yh(t.outline,e,e.outline.enabled,!0),yh(t.halo,e,!!e.halo.color,!1),Nf(t.texts.primary,e.texts.primary),Nf(t.texts.secondary,e.texts.secondary)}function yh(t,e,s,i){t.body=s,t.head=s&&i&&!!e.shape.head,t.tail=s&&i&&!!e.shape.tail}function Nf(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor}function Mf(t,e,s,i,n,r){nC(t,e,s,i,n,r),Rf(t,e.texts.primary,s.text,i,e),Rf(t,e.texts.secondary,s.text.secondary,i,e)}function nC(t,e,s,i,n,r){const o=n.source,a=n.target,l=s.source.get(i),d=s.target.get(i),h=o.x.get(l),u=o.y.get(l),c=o.radius.get(l),g=o.innerStroke.width.get(l),m=+(o.innerStroke.color.get(l)!==null),f=+(o.innerStroke.scalingMethod.get(l)==="scaled"),p=o.outerStroke.width.get(l),_=+(o.outerStroke.color.get(l)!==null),y=+(o.outerStroke.scalingMethod.get(l)==="scaled"),x=o.color.get(l),b=+(o.scalingMethod.get(l)==="scaled"),v=a.x.get(d),A=a.y.get(d),E=a.radius.get(d),S=a.innerStroke.width.get(d),w=+(a.innerStroke.color.get(d)!==null),T=+(a.innerStroke.scalingMethod.get(d)==="scaled"),L=a.outerStroke.width.get(d),R=+(a.outerStroke.color.get(d)!==null),k=+(a.outerStroke.scalingMethod.get(d)==="scaled"),j=a.color.get(d),z=+(a.scalingMethod.get(d)==="scaled"),q=yL(s.color.get(i),x,j),B=s.width.get(i),W=s.scalingMethod.get(i)==="scaled"?1:0,Z=s.stroke.width.get(i),it=s.stroke.scalingMethod.get(i)==="scaled"?1:0,dt=O2[s.shape.style.get(i)],At=s.adjustAnchors.get(i);if(e.source=l,e.target=d,e.sourceX=h,e.sourceY=u,e.targetX=v,e.targetY=A,e.sourceRadiusScaled=g*m*f+p*_*y+c*b,e.sourceRadiusFixed=g*m*(1-f)+p*_*(1-y)+c*(1-b),e.targetRadiusScaled=S*w*T+L*R*k+E*z,e.targetRadiusFixed=S*w*(1-T)+L*R*(1-k)+E*(1-z),e.widthScaled=B*W,e.widthFixed=B*(1-W),e.curvature=s.curvature.get(i),e.isSelfLoop=l===d,e.color=q,e.opacity=s.opacity.get(i),e.minVisibleSize=s.minVisibleSize.get(i),e.shape.body=s.shape.body.get(i),e.shape.head=s.shape.head.get(i),e.shape.tail=s.shape.tail.get(i),e.shape.dashLength=dt.dash,e.shape.gapLength=dt.gap,e.shape.isBodyTriangle=e.shape.body==="triangle",e.stroke.color=Ys(s.stroke.color.get(i),q),e.stroke.widthScaled=Z*it,e.stroke.widthFixed=Z*(1-it),e.stroke.minVisibleSize=s.stroke.minVisibleSize.get(i),e.halo.color=s.halo.color.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1,At&&(e.shape.head||e.shape.tail||e.shape.body==="triangle")){const gt=e,ct=gt.curvature,yt=gt.sourceX,Tt=gt.sourceY,Gt=gt.targetX,Vt=gt.targetY;let St=1,ft=1;if(ct){if(!gt.isSelfLoop){const pt=kd(yt,Tt,Gt,Vt,ct/2);St=Da(gt,r,o,l,yt,Tt,pt.x,pt.y),ft=Da(gt,r,a,d,Gt,Vt,pt.x,pt.y)}}else St=Da(gt,r,o,l,yt,Tt,Gt,Vt),ft=Da(gt,r,a,d,Gt,Vt,yt,Tt);e.sourceRadiusScaled*=St,e.sourceRadiusFixed*=St,e.targetRadiusScaled*=ft,e.targetRadiusFixed*=ft}}function Rf(t,e,s,i,n){e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=Ys(s.backgroundColor.get(i),n.color)}function Da(t,e,s,i,n,r,o,a){const l=e.angle||0;let d,h=Math.atan2(a-r,o-n)-l,u=1,c=0;h<-ws?h+=bo:h>ws&&(h-=bo),h<-ws/2?(c=vb,d=s.badges.topLeft):h<0?(c=Ab,d=s.badges.topRight):h<ws/2?(c=Sb,d=s.badges.bottomRight):(c=Eb,d=s.badges.bottomLeft),c+=l;const g=d.text.content&&d.text.content.get(i),m=d.image.url&&d.image.url.get(i);if(_L(g)||m){const f=d.positionScale.get(i),p=d.scale.get(i),_=Nx(o,a,n,r,n+Math.cos(c)*f,r+Math.sin(c)*f,p);if(_){const y=_.x-n,x=_.y-r,b=Math.sqrt(y*y+x*x);u=Math.max(u,b)}}if(s.shape.get(i)==="square"){const f=Math.abs(Math.cos(h)),p=Math.abs(Math.sin(h)),_=1/Math.max(f,p);u=Math.max(u,_)}return u}function Ff(){return{source:0,target:0,sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:!1,color:"",opacity:0,minVisibleSize:0,shape:{body:"line",head:null,tail:null,dashLength:0,gapLength:0,isBodyTriangle:!1},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:!1,color:"",minVisibleSize:0},textHidden:!1,texts:{primary:Pf(),secondary:Pf()}}}function Pf(){return{align:"left",hidden:!1,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",minVisibleSize:0,margin:0,padding:0,position:ia,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:!1,offsetAngle:0}}function rC(t){return t===null?t:void 0}function Be(t){return typeof t=="boolean"||t===0||t===1?t:void 0}function Sn(t){return typeof t=="number"&&isFinite(t)?t:void 0}function fe(t){return typeof t=="number"&&isFinite(t)&&t>=0?t:void 0}var a0=-100,oC=400,l0=t=>typeof t=="number"&&isFinite(t)&&t>=a0&&t<=oC?t:void 0;function fi(t){return t===null||typeof t=="string"||typeof t=="number"?t:void 0}function pi(t){return t==="fixed"||t==="scaled"?t:void 0}function Ui(t){return $e(t)?t:void 0}function aC(t){return t===bL||t===ia?t:void 0}function Ye(t){return t==="inherit"||$e(t)?t:void 0}function lC(t){return t==="source"||t==="target"||$e(t)?t:void 0}function ur(t){return t===null?null:typeof t=="string"?t.split(",").map(e=>{const s=e.trim(),i=s.indexOf(" ")!==-1,n=s[0];return i&&n!=='"'&&n!=="'"?`"${s}"`:s}).join(","):void 0}function cr(t){return t==="none"?"normal":t==="normal"||t==="italic"||t==="bold"||t==="italic bold"||t==="bold italic"?t:void 0}function id(t){return t==="left"||t==="center"?t:void 0}function dC(t){return t==="equilateral"?"pentagon":t==="triangle"?"triangleUp":t==="triangleRight"?"triangle":t==="circle"||t==="square"||t==="cross"||t==="diamond"||t==="pentagon"||t==="hexagon"||t==="star"||t==="triangleUp"||t==="triangleDown"||t==="triangleLeft"||t==="triangle"?t:void 0}var hC=new Set(["line","tapered","arrow","dashed","dotted"]);function uC(t){return hC.has(t)?t:void 0}function cC(t){return t==="line"||t==="triangle"?t:void 0}function zf(t){return t===null||t==="arrow"||t==="circle-hole-arrow"||t==="triangle-hole-arrow"||t==="short-arrow"||t==="sharp-arrow"||t==="circle"||t==="square"?t:void 0}function gC(t){return t==="plain"||t==="dashed"||t==="dotted"?t:void 0}function mC(t){return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="center"?t:void 0}function fC(t){if($e(t))return t;if(Array.isArray(t)){if(t.length<1)return;for(let e=0;e<t.length;++e)if(!$e(t[e]))return;return t}}function re(t){return function(e){if(typeof e=="number")return isFinite(e)&&e>=0?e:void 0;if(typeof e!="string"||e.charAt(e.length-1)!=="%")return;const s=parseFloat(e);return isNaN(s)?void 0:t*s/100}}function eg(){return{edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}}function Bo(t,e=eg()){const s=(t-a0)*jc+Vc;return e.edgeHalo=L2,e.nodeHaloStroke=yb,e.nodeHalo=xb,e.edgeBody=s+bb,e.edgeTextBackground=s+C2,e.edgeText=s+N2,e.nodeBody=s+qc,e.nodeTextBackground=s+M2,e.nodeText=s+R2,e}var pC=(t,e)=>{e.halo.body=e.halo.body||t.halo.body,e.halo.head=e.halo.head||t.halo.head,e.halo.tail=e.halo.tail||t.halo.tail,e.outline.body=e.outline.body||t.outline.body,e.outline.head=e.outline.head||t.outline.head,e.outline.tail=e.outline.tail||t.outline.tail,e.body.body=e.body.body||t.body.body,e.body.head=e.body.head||t.body.head,e.body.tail=e.body.tail||t.body.tail;const s=e.texts,i=t.texts;s.primary.text=s.primary.text||i.primary.text,s.primary.background=s.primary.background||i.primary.background,s.secondary.text=s.secondary.text||i.secondary.text,s.secondary.background=s.secondary.background||i.secondary.background},d0=t=>(e,s)=>{s.halo.body=e.halo.body[t],s.halo.head=e.halo.head[t],s.halo.tail=e.halo.tail[t],s.outline.body=e.outline.body[t],s.outline.head=e.outline.head[t],s.outline.tail=e.outline.tail[t],s.body.body=e.body.body[t],s.body.head=e.body.head[t],s.body.tail=e.body.tail[t],s.texts.primary.text=e.texts.primary.text[t],s.texts.primary.background=e.texts.primary.background[t],s.texts.secondary.text=e.texts.secondary.text[t],s.texts.secondary.background=e.texts.secondary.background[t]},_C=d0("start"),yC=d0("end"),xC=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,view:n,attributes:r,attributesPrev:o,nodeAttributes:a,nodeAttributesPrev:l}){this._fullComponents=Br(),this._startComponents=Br(),this._endComponents=Br(),this._startFlags=Br(),this._endFlags=Br(),this._startInput=Ff(),this._endInput=Ff(),this._depthInfo=eg(),this._nullElt={id:-1,valid:!0},this._engine=t,this._view=n,this._helper={imageManager:e,fontManager:s,formatText:i},this._attributes=r,this._attributesPrev=o,this._nodeAttributes=a,this._nodeAttributesPrev=l,this._layers=Df(()=>t.createGroup()),this._blockIds=Df(()=>0)}drawEdge(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=-t,n=this._attributes,{bentEnable:r,bentVertical:o}=e.getBentEdges(),a=Bo(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),l=n.source.get(t),d=n.target.get(t),h=n.curvature.get(t),u=this._attributesPrev.curvature.get(t),c=n.animationDuration.get(t),g=n.animationStart.get(t),m=n.animationEasing.get(t),f=c>0,p=h!==0||f&&u!==0||this._engine.getBentEdges().bentEnable;this._prepareBlocks(f,a,i,p);const _=this._extremitiesAttributes={source:this._nodeAttributes,target:this._nodeAttributes};if(Mf(s,this._endInput,n,t,_,this._view),Cf(this._endFlags,this._endInput),f){const y=this._nodeAttributes.animationDuration.get(l)>0,x=this._nodeAttributes.animationDuration.get(d)>0;_.source=y?this._nodeAttributesPrev:this._nodeAttributes,_.target=x?this._nodeAttributesPrev:this._nodeAttributes,Mf(s,this._startInput,this._attributesPrev,t,_,this._view),Cf(this._startFlags,this._startInput),pC(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._layers),yC(this._fullComponents,this._endComponents),this._endComponents.body.body.bentEnable=r,this._endComponents.body.body.bentVertical=o,this._endComponents.body.head&&(this._endComponents.body.head.bentEnable=r,this._endComponents.body.head.bentVertical=o),this._endComponents.body.tail&&(this._endComponents.body.tail.bentEnable=r,this._endComponents.body.tail.bentVertical=o),If(e,s,t,this._attributes,this._endComponents,this._endInput),this._endComponents.texts.primary.text&&(this._endComponents.texts.primary.background&&(this._endComponents.texts.primary.background.bentEnable=r,this._endComponents.texts.primary.background.bentVertical=o),this._endComponents.texts.primary.text.bentEnable=r,this._endComponents.texts.primary.text.bentVertical=o),this._endComponents.texts.secondary.text&&(this._endComponents.texts.secondary.background&&(this._endComponents.texts.secondary.background.bentEnable=r,this._endComponents.texts.secondary.background.bentVertical=o),this._endComponents.texts.secondary.text.bentEnable=r,this._endComponents.texts.secondary.text.bentVertical=o),f&&(_C(this._fullComponents,this._startComponents),If(e,s,t,this._attributesPrev,this._startComponents,this._startInput),this._setBlocksAnimation(c,g,m)),this._setupHaloMasking(l,d),this._storeBlocks()}_setupHaloMasking(t,e){const s=this._nodeAttributes.halo,i=this._layers,n=s.color.get(t)&&s.hideNonAdjacentEdges.get(t),r=s.color.get(e)&&s.hideNonAdjacentEdges.get(e),o=!n&&!r?pb:hr;i.body.stencilUsage=i.text.stencilUsage=i.textBg.stencilUsage=o}_computeBlockIds(t){const e=t*Rd,s=this._blockIds;s.body=e+E2,s.halo=e+T2,s.text=e+S2,s.textBg=e+w2}_prepareBlocks(t,e,s,i){const n=this._layers;n.body.reset(i?sd:Bs,t,e.edgeBody,s),n.halo.reset(i?sd:Bs,t,e.edgeHalo,s),n.text.reset(vn,t,e.edgeText,s),n.textBg.reset(Bs,t,e.edgeTextBackground,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.halo,e.halo),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.halo),t.freeBlock(e.text),t.freeBlock(e.textBg)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._initEdgeComponents(t.halo,e.halo,s.halo),this._initEdgeComponents(t.outline,e.outline,s.body),this._initEdgeComponents(t.body,e.body,s.body),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initEdgeComponents(t,e,s){t.head=this._nextElement(e.head,s),t.tail=this._nextElement(e.tail,s),t.body=this._nextElement(e.body,s)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}};function Df(t){return{body:t(),halo:t(),text:t(),textBg:t()}}function Br(){return{halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}}}function bC(t,e,s){h0(t,e,s),e.imageContent!==null?(t.pattern.type=qi,t.pattern.attributes.image=e.imageContent,t.pattern.attributes.scaled=!0,t.pattern.attributes.duplicated=!1,t.patternScale=e.imageScale,t.patternMinVisibleSize=0,t.patternColor=null):(t.fillColor=null,t.strokeColor=null)}function vC(t,e,s){h0(t,e,s),e.textContent&&(t.pattern.type=En,t.pattern.attributes.text=e.textContent,t.pattern.attributes.font=e.textFont,t.pattern.attributes.style=e.textStyle,t.pattern.attributes.paddingLeft=e.scale*e.textPaddingLeft*2,t.pattern.attributes.paddingTop=e.scale*e.textPaddingTop*2,t.pattern.attributes.size=ta,t.patternMinVisibleSize=0,t.patternColor=e.textColor,t.patternScale=e.textScale,t.isBadge=!0),!e.imageUrl&&e.textContent||(t.fillColor=null,t.strokeColor=null)}function h0(t,e,s){const i=e.scalingMethod==="fixed",n=s.diameterScaled*e.scale;let r=0;const o=s.diameterScaled;i&&(r=s.diameterScaled*e.scale);const a=s.diameterScaled*e.positionScale/2,l=s.diameterFixed*e.positionScale/2;t.pieceId=Ls,t.shape="circle",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=n,t.rectWidthOrSourceRadiusFixed=r,t.rectHeightOrTargetRadiusScaled=n,t.rectHeightOrTargetRadiusFixed=r,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.strokeWidthScaled,t.strokeWidthFixed=e.strokeWidthFixed,t.offsetScaled=a,t.offsetFixed=l,t.pattern.type=We,t.opacity=s.opacity,t.fillColor=e.color,t.strokeColor=e.strokeColor,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.angle,t.patternScale=0,t.symbolicSize=o,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1,t.isBadge=!0}function AC(t,e,s){Bd(t,e),t.fillColor=Array.isArray(e.color)?null:e.color,t.strokeColor=e.innerStroke.color,t.strokeMinVisibleSize=e.innerStroke.minVisibleSize,t.strokeWidthScaled=e.innerStroke.widthScaled,t.strokeWidthFixed=e.innerStroke.widthFixed,s&&(t.pattern.type=We)}function Bd(t,e){t.pieceId=Ls,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=e.diameterScaled,t.rectWidthOrSourceRadiusFixed=e.diameterFixed,t.rectHeightOrTargetRadiusScaled=e.diameterScaled,t.rectHeightOrTargetRadiusFixed=e.diameterFixed,t.shape=e.shape,t.opacity=e.opacity,t.symbolicSize=e.diameterScaled,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=null,t.strokeColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function EC(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=Ls,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=We,t.opacity=e.opacity,t.fillColor=e.halo.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function SC(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=Ls,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.halo.strokeWidthScaled,t.strokeWidthFixed=e.halo.strokeWidthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=We,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.halo.strokeColor,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function wC(t,e){Bd(t,e),t.pattern.type=An,t.pattern.attributes.text=e.icon.content,t.pattern.attributes.font=e.icon.font,t.pattern.attributes.style=e.icon.style,t.pattern.attributes.size=ta,t.patternMinVisibleSize=e.icon.minVisibleSize,t.patternColor=e.icon.color,t.patternScale=e.icon.scale}function TC(t,e){const s=e.image.fit&&!e.image.tile;Bd(t,e),t.pattern.type=qi,t.pattern.attributes.image=e.image.content,t.pattern.attributes.scaled=s,t.pattern.attributes.duplicated=e.image.tile,t.patternScale=s?e.image.scale:0,t.patternMinVisibleSize=e.image.minVisibleSize,t.patternColor=null}function IC(t,e){const s=e.diameterScaled+2*e.innerStroke.widthScaled,i=e.diameterFixed+2*e.innerStroke.widthFixed;t.pieceId=Ls,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.outerStroke.widthScaled,t.strokeWidthFixed=e.outerStroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=We,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.outerStroke.color,t.patternColor=null,t.globalMinVisibleSize=e.outerStroke.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function LC(t,e){const s=e.diameterScaled*Ym,i=e.diameterFixed*Ym;let n=e.diameterScaled*Hm,r=e.diameterFixed*Hm+F2;e.outerStroke.color&&(n+=e.outerStroke.widthScaled/2,r+=e.outerStroke.widthFixed/2),t.pieceId=Ls,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=We,t.opacity=e.opacity,t.fillColor=e.outline.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.outline.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=1.5707963267948966,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function CC(t,e){Bd(t,e),Array.isArray(e.color)&&(t.pattern.type=sa,t.pattern.attributes.colors=e.color.join(";"),t.patternScale=1,t.patternMinVisibleSize=0,t.patternColor=null)}function NC(t,e,s){u0(t,e,s),t.pattern.type=Xi,t.pattern.attributes.text=e.content,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternMinVisibleSize=0,t.patternColor=e.color,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function MC(t,e,s){u0(t,e,s),t.fillColor=e.backgroundColor,t.pieceId=_n,t.shape="square"}function RC(t,e,s){const i=Math.ceil(e.margin/2),n=s.diameterScaled/2,r=s.diameterFixed/2+i,o=B2[e.position],a=Math.cos(o),l=Math.sin(o),d=e.margin<12?1:e.margin<30?1-(e.margin-12)/18*.7:.25;t.pieceId=Ls,t.shape="triangle",t.x1=s.x-a,t.y1=s.y-l,t.x2=s.x+a,t.y2=s.y+l,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=e.margin,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=e.margin*d,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=We,t.opacity=s.opacity,t.fillColor=e.backgroundColor,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1}function u0(t,e,s){let i=0,n=0;if(e.isPositionCenter||(i+=s.diameterScaled/2,n+=s.diameterFixed/2+e.margin+e.padding),e.isPositionVertical){if(i+=e.heightScaled/2,n+=e.heightFixed/2,e===s.texts.secondary&&s.texts.primary.position==="bottom"){const o=s.texts.primary;i+=o.heightScaled,n+=o.heightFixed+o.margin+2*o.padding}}else e.isPositionHorizontal&&(i+=e.widthScaled/2,n+=e.widthFixed/2);const r=ta;t.pieceId=Ls,t.shape="square",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=We,t.pattern.attributes.size=r,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=1,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function Of(t,e,s,i,n,r){const o=n.badges,a=i.badges,l=r.badges;FC(t,e,s,i,n,r),kf(t,e,s,i.text,n.texts.primary,r.texts.primary,r),kf(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r),Oa(t,e,s,a.topLeft,o.topLeft,l.topLeft,r),Oa(t,e,s,a.topRight,o.topRight,l.topRight,r),Oa(t,e,s,a.bottomLeft,o.bottomLeft,l.bottomLeft,r),Oa(t,e,s,a.bottomRight,o.bottomRight,l.bottomRight,r)}function FC(t,e,s,i,n,r){if(n.halo){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),EC(n.halo,r),n.haloStroke&&(r.halo.strokeWidthScaled=0,r.halo.strokeWidthFixed=i.halo.strokeWidth.get(s),SC(n.haloStroke,r))}if(n.outline&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),LC(n.outline,r)),n.outerStroke&&(r.outerStroke.minVisibleSize=i.outerStroke.minVisibleSize.get(s),IC(n.outerStroke,r)),n.pieChart&&CC(n.pieChart,r),n.image&&(r.image.content=e.imageManager.getImage(r.image.url),r.image.fit=i.image.fit.get(s),r.image.tile=i.image.tile.get(s),r.image.scale=i.image.scale.get(s),r.image.minVisibleSize=i.image.minVisibleSize.get(s),TC(n.image,r)),n.icon&&(r.icon.font=e.fontManager.getFont(i.icon.font.get(s)),r.icon.style=i.icon.style.get(s),r.icon.color=i.icon.color.get(s),r.icon.scale=i.icon.scale.get(s),r.icon.minVisibleSize=i.icon.minVisibleSize.get(s),wC(n.icon,r)),n.body){const o=!n.pieChart&&!n.image&&!n.icon;AC(n.body,r,o)}}function Oa(t,e,s,i,n,r,o){if(n.image||n.text){const a=i.stroke.width.get(s),l=+(i.stroke.scalingMethod.get(s)==="scaled");r.color=Ys(i.color.get(s),o.color,r.angle),r.strokeColor=i.stroke.color.get(s),r.strokeWidthScaled=a*l,r.strokeWidthFixed=a*(1-l),r.minVisibleSize=i.minVisibleSize.get(s),r.positionScale=i.positionScale.get(s),r.scale=i.scale.get(s)}if(n.image&&(r.imageContent=e.imageManager.getImage(r.imageUrl),r.imageScale=i.image.scale.get(s),bC(n.image,r,o)),n.text){if(r.textFont=e.fontManager.getFont(i.text.font.get(s)),r.textStyle=i.text.style.get(s),r.textColor=Ys(i.text.color.get(s),o.color),r.textScale=i.text.scale.get(s),r.textPaddingTop=i.text.paddingTop.get(s),r.textPaddingLeft=i.text.paddingLeft.get(s),t.measureText(r.textContent,r.textFont,r.textStyle,r.textScale).width>1){let a=0,l=0;for(;l<r.textContent.length&&a<1;)a+=t.measureText(r.textContent[l],r.textFont,r.textStyle,r.textScale).width,l+=1;l!==r.textContent.length&&(r.textContent=r.textContent.substring(0,l-1)+"")}vC(n.text,r,o)}}function kf(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=Ys(a.color.get(s),o.color),r.style=a.style.get(s),r.align=a.align.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=Hc(r.content,r.maxLineLength),l){const h=a.scale.get(s);r.sizeScaled=o.diameterScaled*h,r.sizeFixed=o.diameterFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.positionAngle=k2[r.position],r.isPositionCenter=r.position==="center",r.isPositionVertical=r.position==="top"||r.position==="bottom",r.isPositionHorizontal=r.position==="left"||r.position==="right",NC(n.text,r,o),n.background&&(MC(n.background,r,o),n.tip&&RC(n.tip,r,o))}}function Bf(t,e){PC(t,e),Uf(t.texts.primary,e.texts.primary),Uf(t.texts.secondary,e.texts.secondary),ka(t.badges.topLeft,e.badges.topLeft),ka(t.badges.topRight,e.badges.topRight),ka(t.badges.bottomLeft,e.badges.bottomLeft),ka(t.badges.bottomRight,e.badges.bottomRight)}function PC(t,e){t.body=!0,t.icon=!!e.icon.content,t.image=!!e.image.url,t.pieChart=Array.isArray(e.color),t.outerStroke=!!e.outerStroke.color,t.outline=!!e.outline.enabled,t.halo=!!e.halo.color,t.haloStroke=t.halo&&!!e.halo.strokeColor}function Uf(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor,t.tip=t.background&&e.tip&&e.position!=="center"}function ka(t,e){t.text=!!e.textContent,t.image=!!e.imageUrl}function Gf(t,e,s,i){zC(t,e,s,i),Vf(t,e.texts.primary,s.text,i,e),Vf(t,e.texts.secondary,s.text.secondary,i,e),Ba(t,e.badges.topLeft,s.badges.topLeft,i),Ba(t,e.badges.topRight,s.badges.topRight,i),Ba(t,e.badges.bottomLeft,s.badges.bottomLeft,i),Ba(t,e.badges.bottomRight,s.badges.bottomRight,i)}function zC(t,e,s,i){const n=+(s.scalingMethod.get(i)==="scaled"),r=2*s.radius.get(i),o=s.innerStroke.width.get(i),a=+(s.innerStroke.scalingMethod.get(i)==="scaled"),l=s.outerStroke.width.get(i),d=+(s.outerStroke.scalingMethod.get(i)==="scaled");e.x=s.x.get(i),e.y=s.y.get(i),e.shape=s.shape.get(i),e.color=s.color.get(i),e.opacity=s.opacity.get(i),e.diameterScaled=r*n,e.diameterFixed=r*(1-n),e.innerStroke.color=Ys(s.innerStroke.color.get(i),e.color),e.innerStroke.widthScaled=o*a,e.innerStroke.widthFixed=o*(1-a),e.innerStroke.minVisibleSize=s.innerStroke.minVisibleSize.get(i),e.outerStroke.color=Ys(s.outerStroke.color.get(i),e.color),e.outerStroke.widthScaled=l*d,e.outerStroke.widthFixed=l*(1-d),e.halo.color=s.halo.color.get(i),e.halo.strokeColor=s.halo.strokeColor.get(i),e.icon.content=t.formatText(s.icon.content.get(i)),e.image.url=s.image.url.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1}function Vf(t,e,s,i,n){if(e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=Ys(s.backgroundColor.get(i),n.color),e===n.texts.primary){const r=s;e.tip=r.tip.get(i),e.position=r.position.get(i)}else e.position="bottom"}function Ba(t,e,s,i){const n=s.text.content.get(i);e.textContent=t.formatText(n),e.imageUrl=s.image.url.get(i),e.scalingMethod=s.scalingMethod.get(i)}var Ua=t=>({angle:t,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,scalingMethod:"scaled",textContent:"",textFont:"",textColor:"",textScale:0,textStyle:"none",imageUrl:"",imageContent:null,imageScale:0,textPaddingLeft:0,textPaddingTop:0}),qf=()=>({hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1}),jf=()=>({x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,style:"none",minVisibleSize:0},image:{url:"",content:null,scale:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:!1,color:"",minVisibleSize:0},badges:{topLeft:Ua(vb),topRight:Ua(Ab),bottomLeft:Ua(Eb),bottomRight:Ua(Sb)},textHidden:!1,texts:{primary:qf(),secondary:qf()}}),DC=(t,e)=>{e.haloStroke=e.haloStroke||t.haloStroke,e.halo=e.halo||t.halo,e.outline=e.outline||t.outline,e.outerStroke=e.outerStroke||t.outerStroke,e.body=e.body||t.body,e.pieChart=e.pieChart||t.pieChart,e.image=e.image||t.image,e.icon=e.icon||t.icon;const s=t.badges,i=e.badges;i.topLeft.text=i.topLeft.text||s.topLeft.text,i.topLeft.image=i.topLeft.image||s.topLeft.image,i.topRight.text=i.topRight.text||s.topRight.text,i.topRight.image=i.topRight.image||s.topRight.image,i.bottomLeft.text=i.bottomLeft.text||s.bottomLeft.text,i.bottomLeft.image=i.bottomLeft.image||s.bottomLeft.image,i.bottomRight.text=i.bottomRight.text||s.bottomRight.text,i.bottomRight.image=i.bottomRight.image||s.bottomRight.image;const n=t.texts,r=e.texts;r.primary.text=r.primary.text||n.primary.text,r.primary.background=r.primary.background||n.primary.background,r.primary.tip=r.primary.tip||n.primary.tip,r.secondary.text=r.secondary.text||n.secondary.text,r.secondary.background=r.secondary.background||n.secondary.background,r.secondary.tip=r.secondary.tip||n.secondary.tip},c0=t=>(e,s)=>{s.haloStroke=e.haloStroke[t],s.halo=e.halo[t],s.outline=e.outline[t],s.outerStroke=e.outerStroke[t],s.body=e.body[t],s.pieChart=e.pieChart[t],s.image=e.image[t],s.icon=e.icon[t];const i=e.badges,n=s.badges;n.topLeft.text=i.topLeft.text[t],n.topLeft.image=i.topLeft.image[t],n.topRight.text=i.topRight.text[t],n.topRight.image=i.topRight.image[t],n.bottomLeft.text=i.bottomLeft.text[t],n.bottomLeft.image=i.bottomLeft.image[t],n.bottomRight.text=i.bottomRight.text[t],n.bottomRight.image=i.bottomRight.image[t];const r=e.texts,o=s.texts;o.primary.text=r.primary.text[t],o.primary.background=r.primary.background[t],o.primary.tip=r.primary.tip[t],o.secondary.text=r.secondary.text[t],o.secondary.background=r.secondary.background[t],o.secondary.tip=r.secondary.tip[t]},OC=c0("start"),kC=c0("end"),BC=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,attributes:n,attributesPrev:r}){this._fullComponents=Ur(),this._startComponents=Ur(),this._endComponents=Ur(),this._startFlags=Ur(),this._endFlags=Ur(),this._startInput=jf(),this._endInput=jf(),this._depthInfo=eg(),this._nodePatternAssigned=!1,this._nullElt={id:-1,valid:!0},this._engine=t,this._attributes=n,this._attributesPrev=r,this._helper={imageManager:e,fontManager:s,formatText:i},this._layers=Yf(()=>t.createGroup()),this._blockIds=Yf(()=>0)}drawNode(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=t,n=this._attributes,r=Bo(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),o=n.animationDuration.get(t),a=o>0;if(this._prepareBlocks(a,r,i),Gf(s,this._endInput,n,t),Bf(this._endFlags,this._endInput),a&&(Gf(s,this._startInput,this._attributesPrev,t),Bf(this._startFlags,this._startInput),DC(this._endFlags,this._startFlags)),this._initComponents(this._fullComponents,this._endFlags,this._layers),kC(this._fullComponents,this._endComponents),Of(e,s,t,n,this._endComponents,this._endInput),a&&(OC(this._fullComponents,this._startComponents),Of(e,s,t,this._attributesPrev,this._startComponents,this._startInput)),a){const l=this._attributes.animationStart.get(t),d=this._attributes.animationEasing.get(t);this._setBlocksAnimation(o,l,d)}this._endFlags.halo&&this._attributes.halo.hideNonAdjacentEdges.get(t)&&(this._layers.halo.stencilUsage=this._layers.haloStroke.stencilUsage=fb),this._storeBlocks()}_computeBlockIds(t){const e=t*Rd,s=this._blockIds;s.body=e+y2,s.text=e+x2,s.textBg=e+b2,s.halo=e+v2,s.haloStroke=e+A2}_prepareBlocks(t,e,s){const i=this._layers;i.body.reset(Bs,t,e.nodeBody,s),i.text.reset(vn,t,e.nodeText,s),i.textBg.reset(Bs,t,e.nodeTextBackground,s),i.halo.reset(Bs,t,e.nodeHalo,s),i.haloStroke.reset(Bs,t,e.nodeHaloStroke,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg),t.storeGroup(s.halo,e.halo),t.storeGroup(s.haloStroke,e.haloStroke)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.text),t.freeBlock(e.textBg),t.freeBlock(e.halo),t.freeBlock(e.haloStroke)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.haloStroke.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._nodePatternAssigned=!1,this._initBaseComponents(t,e,s),this._initBadgeComponents(t.badges.topLeft,e.badges.topLeft,s),this._initBadgeComponents(t.badges.topRight,e.badges.topRight,s),this._initBadgeComponents(t.badges.bottomLeft,e.badges.bottomLeft,s),this._initBadgeComponents(t.badges.bottomRight,e.badges.bottomRight,s),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initBaseComponents(t,e,s){t.haloStroke=this._nextElement(e.haloStroke,s.haloStroke),t.halo=this._nextElement(e.halo,s.halo),t.outline=this._nextElement(e.outline,s.body),t.outerStroke=this._nextElement(e.outerStroke,s.body),t.body=this._nextElement(e.body,s.body),t.pieChart=this._getNodePatternElement(e.pieChart,s),t.image=this._getNodePatternElement(e.image,s),t.icon=this._getNodePatternElement(e.icon,s)}_initBadgeComponents(t,e,s){t.image=this._nextElement(e.image,s.body),t.text=this._nextElement(e.text,s.body)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.tip=this._nextElement(e.tip,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}_getNodePatternElement(t,e){return t?this._nodePatternAssigned?e.body.next():(this._nodePatternAssigned=!0,e.body.getCurrentElement()):this._nullElt}};function Yf(t){return{body:t(),text:t(),textBg:t(),halo:t(),haloStroke:t()}}function Ur(){return{haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}}}function UC({graph:t,elements:e,engine:s,imageManager:i,fontManager:n,view:r,attributes:o,boundaries:a,formatText:l}){const{nodeAttributes:d,nodeAttributesPrev:h,edgeAttributes:u,edgeAttributesPrev:c}=GC(o),{nodes:g,edges:m}=e,{maxSize:f,maxMinVisibleSize:p}=a;if(!g.size&&!m.size)return;const _=(Math.max(t.getNodeMaxIndex(),t.getEdgeMaxIndex())+1)*Rd,y=f<1024?8*f:2*f,x=s.setGlobalBoundaries({maxBlockId:Bi(_),maxScaledSize:Bi(y),maxMinVisibleSize:Bi(p),maxSymbolicSize:Bi(f),maxDashLength:3,maxGapLength:1,maxPatternScale:2,maxCoord:-1/0}),b=(x?t.getNodes("_all"):g)._indexes,v=(x?t.getEdges("_all"):m)._indexes;if(b.length){const A=new BC({engine:s,imageManager:i,fontManager:n,formatText:l,attributes:d,attributesPrev:h});for(let E=0;E<b.length;++E)A.drawNode(b[E])}if(v.length){const A=new xC({engine:s,imageManager:i,fontManager:n,formatText:l,view:r,attributes:u,attributesPrev:c,nodeAttributes:d,nodeAttributesPrev:h});for(let E=0;E<v.length;++E)A.drawEdge(v[E])}}function GC(t){const e=Zn(t.nodes.current,{text:{secondary:{scaling:t.nodes.current.text.scaling,maxLineLength:t.nodes.current.text.maxLineLength}}});return{nodeAttributes:e,nodeAttributesPrev:Zn(t.nodes.previous,{textHidden:e.textHidden,text:{secondary:{scaling:t.nodes.previous.text.scaling,maxLineLength:t.nodes.previous.text.maxLineLength}}}),edgeAttributes:Zn(t.edges.current,{text:{secondary:{scaling:t.edges.current.text.scaling,maxLineLength:t.edges.current.text.maxLineLength,adjustAngle:t.edges.current.text.adjustAngle}}}),edgeAttributesPrev:Zn(t.edges.previous,{source:t.edges.current.source,target:t.edges.current.target,textHidden:t.edges.current.textHidden,text:{secondary:{scaling:t.edges.previous.text.scaling,maxLineLength:t.edges.previous.text.maxLineLength,adjustAngle:t.edges.previous.text.adjustAngle}}})}}function Uo(t,e,s){const i=s.length;let n=i-1,r=!1;for(let o=0;o<i;++o)(s[o].y<e&&s[n].y>=e||s[n].y<e&&s[o].y>=e)&&(s[o].x<=t||s[n].x<=t)&&(r=r!==s[o].x+(e-s[o].y)/(s[n].y-s[o].y)*(s[n].x-s[o].x)<t),n=o;return r}function Ga(t){const e=t.x*t.x+t.y*t.y;return{x:t.x/e,y:t.y/e}}function Hf(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=o.x*e.x+o.y*e.y;a<s&&(s=a),a>i&&(i=a)}return{x:s,y:i}}function VC(t,e){let s=t[1],i=t[0],n=Ga({x:s.x-i.x,y:s.y-i.y}),r=n.x;n.x=-n.y,n.y=r;const o=n;s=t[2],i=t[1],n=Ga({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const a=n;s=e[1],i=e[0],n=Ga({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const l=n;return s=e[2],i=e[1],n=Ga({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r,[o,a,l,n]}function g0(t,e){const s=VC(t,e);for(let i=0,n=s.length;i<n;i++){const r=s[i],o=Hf(t,r),a=Hf(e,r);if((o.x<=a.y&&o.y>=a.x?Math.min(o.y,a.y)-Math.max(o.x,a.x):0)===0)return!1}return!0}function qC(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}var m0=na(4),f0=na(5),p0=na(10,.4),Gi=1/3,jC=[{x:-1,y:-Gi},{x:0,y:-Gi},{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:0,y:Gi},{x:-1,y:Gi}],_0=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],YC=[{x:-1,y:-Gi},{x:-.55,y:-Gi},{x:-1,y:-1},{x:1,y:0},{x:-1,y:1},{x:-.55,y:Gi},{x:-1,y:Gi}],Xf=[{x:-.6,y:-.3},{x:.1,y:0},{x:-.6,y:.3}],y0=[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}],Di={circle:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>1-Math.sqrt(t*t+e*e),points:[{x:0,y:0,r:1}],isSimple:!0},square:{getDistanceFromStrokeVertically:(t,e)=>.996-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>.996-Math.abs(t),points:_0,isSimple:!0},line:{getDistanceFromStrokeVertically:(t,e)=>1-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:0},{x:1,y:0}],isSimple:!0},triangle:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},arrow:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},"circle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>Math.min(Math.sqrt((t+.4)*(t+.4)+e*e)-.27,(1-t)/2-Math.abs(e)),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:[{x:-.4,y:0,r:.3}],isSimple:!0},"triangle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>{const s=Math.min((1-t)/2-Math.abs(e),1-Math.abs(t)),i=-x0(t,e,Xf);return Math.min(s,i)},getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:Xf,isSimple:!0},"short-arrow":es(jC,!1),"sharp-arrow":es(YC,!1),cross:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>{const s=Math.abs(t),i=Math.abs(e),n=.31-Math.min(s,i),r=1-Math.max(s,i);return Math.min(n,r)},points:y0,isSimple:!1},diamond:es(m0),pentagon:es(f0),star:es(p0),triangleUp:es([{x:-1,y:1},{x:1,y:1},{x:0,y:-1}],!0),triangleDown:es([{x:-1,y:-1},{x:1,y:-1},{x:0,y:1}],!0),triangleLeft:es([{x:1,y:-1},{x:1,y:1},{x:-1,y:0}],!0),hexagon:es(na(6,1,-Math.PI/2+Fd),!1)},HC=["circle","square","triangle","line","triangleUp","triangleDown","triangleLeft"],XC=["cross","diamond","pentagon","star","hexagon"],$C=["arrow","triangle-hole-arrow","circle-hole-arrow","short-arrow","sharp-arrow"];function $f(t,e){for(const r of HC)xh(t,r);const s=e.nodes.current.shape.getValues(),i=e.edges.current.shape.head.getValues(),n=e.edges.current.shape.tail.getValues();for(const r of XC)s.includes(r)&&xh(t,r);for(const r of $C)r&&(i.includes(r)||n.includes(r))&&xh(t,r)}function xh(t,e){t.registerShape(e,Di[e])}function WC(t,e){Di.star=es(kn(p0,e,On)),Di.pentagon=es(kn(f0,e,On)),Di.hexagon=es(kn(na(6,1,-Math.PI/2+Fd),e,On)),Di.square=es(kn(_0,e,On)),Di.cross=es(kn(y0,e,On)),Di.diamond=es(kn(m0,e,On)),["star","pentagon","hexagon","square","cross","diamond"].forEach(s=>t.updateShape(s,Di[s]))}function x0(t,e,s){let i=1/0;const n={x:t,y:e};for(let r=0;r<s.length;++r){const o=s[r],a=s[(r+1)%s.length];i=Math.min(i,kb(n,o,a))}return i*(Uo(t,e,s)?1:-1)}function na(t,e=1,s=-Math.PI/2+Fd){const i=[],n=2*Math.PI/t;let r=s;for(let o=0;o<t;++o){const a=o%2==1?e:1;i.push({x:Math.cos(r)*a,y:Math.sin(r)*a}),r+=n}return i}function es(t,e=!1){return{getDistanceFromStrokeVertically:()=>1,getDistanceFromStrokeHorizontally:(s,i)=>x0(s,i,t),points:t,isSimple:e}}function kn(t,e,s=5){if(e===0)return t;const i=[],n=t.length;for(let r=0;r<n;r++){const o=t[(r+n-1)%n],a=t[r%n],l=t[(r+1)%n],d=o.x-a.x,h=o.y-a.y,u=Math.sqrt(d*d+h*h),c=d/u,g=h/u,m=Math.atan2(g,c),f=l.x-a.x,p=l.y-a.y,_=Math.sqrt(f*f+p*p),y=f/_,x=p/_,b=Math.atan2(x,y),v=c*x-g*y,A=c*y-g*-x;let E=Math.asin(v<-1?-1:v>1?1:v),S=1,w=!1;A<0?E<0?E=Math.PI+E:(E=Math.PI-E,S=-1,w=!0):E>0&&(S=-1,w=!0);const T=E/2;let L=Math.abs(Math.cos(T)*e/Math.sin(T)),R=e;L>Math.min(u/2,_/2)&&(L=Math.min(u/2,_/2),R=Math.abs(L*Math.sin(T)/Math.cos(T)));let k=a.x+y*L,j=a.y+x*L;k+=-x*R*S,j+=y*R*S;const z=m+Math.PI/2*S;let q=b-Math.PI/2*S-z;q=w?q>0?q-2*Math.PI:q:q<0?q+2*Math.PI:q;for(let B=0;B<s;B++){const W=z+q*(B/(s-1)),Z=k+R*Math.cos(W),it=j+R*Math.sin(W);i.push({x:Z,y:it})}}return i}var ZC=class extends ea{constructor(t,e){super(),this.isDummy=!0,this.width=0,this.height=0,this.namespaceURI="http://www.w3.org/1999/xhtml"}setAttribute(t,e){t==="src"&&(this.src=e),t==="crossOrigin"&&(this.crossOrigin=e)}set src(t){t&&(this._src=t,setTimeout(()=>{this.onload&&this.onload.call(this),this.width=1,this.height=1,this.fire("load")},10))}get src(){return this._src}addEventListener(t,e){this.on(t,e)}};function KC(t,e){return new(typeof Image<"u"?Image:ZC)(t,e)}var QC=class{constructor(){this._images={},this._crossOrigin="anonymous",this._whenReady=[],this._onFetch=[],this._nbLoaded=0,this._nbToLoad=0}setImgCrossOrigin(t){this._crossOrigin=t}clear(){this._images={},this._nbLoaded=0,this._nbToLoad=0}getImage(t){let e=this._images[t];return e===void 0&&(this._nbToLoad+=1,e=KC(),e.crossOrigin=this._crossOrigin,e.addEventListener("load",()=>this._onImgLoad(t)),e.addEventListener("error",()=>{this._onImgLoad(t),this._images[t]=null}),BS(e,"src",t),this._images[t]=e),e}_onImgLoad(t){this._nbLoaded+=1,this._onFetch.forEach(e=>e(t)),this._nbLoaded===this._nbToLoad&&(this._whenReady.forEach(e=>e()),this._whenReady=[])}onFetch(t){this._onFetch.push(t)}whenReady(){return this._nbLoaded===this._nbToLoad?Promise.resolve():new Promise(t=>this._whenReady.push(t))}destroy(){this._whenReady=[],this._onFetch=[]}},sg={};Ho(sg,{BUTTON_MAPPING:()=>xc,BoundingBox:()=>rs,DummyCanvas:()=>wb,DummyCanvasRenderingContext2D:()=>Tb,DummyDomElement:()=>ex,DummyFileReader:()=>Qy,DummyTextNode:()=>tv,DummyXHR:()=>Ky,ElementSet:()=>ra,EventTarget:()=>ea,FlexArray:()=>Kl,IndexList:()=>Qx,MOUSE_WHEEL_THROTTLE:()=>Hy,Map2:()=>mb,PathMap:()=>W0,PrioritySet:()=>Hx,SVG_NS:()=>_c,Table:()=>lu,XLINK:()=>nx,XML_NS:()=>Xh,applyCursorStyle:()=>Vl,baseURI:()=>hx,binaryIndexOf:()=>cy,cancelAnimFrame:()=>Xy,clamp:()=>Is,clearCanvas:()=>vu,componentsToRGBA:()=>ub,computeMax:()=>Qn,computeMin:()=>mi,concatenateArrays:()=>EE,createBlob:()=>Ro,createCanvas:()=>Ge,createDummyDomElement:()=>Ul,createDummyXmlDocument:()=>sv,createElement:()=>$h,createSvgElement:()=>se,createTextNode:()=>yc,createWebGL2Context:()=>Lb,createWorker:()=>Q0,createXmlDocument:()=>iv,dataUrlToBlob:()=>sx,debounce:()=>TE,deepCopy:()=>be,displayPixelsOnScreen:()=>pN,ensureTransferable:()=>yd,escapeDOMAttribute:()=>Kn,extendList:()=>CE,fadeElement:()=>ux,fetch:()=>Lr,fetchBinary:()=>lx,fetchBinaryAsBase64:()=>dx,flatten:()=>Mo,flattenArray:()=>uy,fontSizeToBadgeScale:()=>$0,forEach:()=>ni,formatAngle:()=>ql,formatHex:()=>Sl,formatWorkerMessage:()=>K0,getBaseLog:()=>cx,getCurrentTime:()=>Xe,getDate:()=>xy,getDocument:()=>Ai,getDocumentFontRules:()=>Y0,getEmbeddedFontRules:()=>H0,getFlattenedKeys:()=>Ln,getGlContext:()=>Cb,getImage:()=>rx,getLeafValues:()=>_d,getOptions:()=>fs,getPixelRatio:()=>gs,getProperty:()=>ye,getResizeObserver:()=>Jy,getStyle:()=>tx,getTime:()=>by,getValues:()=>_o,getWebglContext:()=>Yc,hash8:()=>Vh,htmlSanitizer:()=>bc,indexArrayToArray:()=>Co,indexByName:()=>NE,insertSortAsc:()=>Wr,insertSortDesc:()=>AE,isArray:()=>Ue,isBlob:()=>QS,isHTMLElement:()=>ax,isInteger:()=>wE,isLittleEndian:()=>pd,isObject:()=>Ne,isRawObject:()=>In,isWebGLSupported:()=>Ib,lerp:()=>ne,lightDebounce:()=>gy,mapKeys:()=>cb,mapValues:()=>gb,merge:()=>Zn,mergeValues:()=>zl,mix:()=>Wh,nextPowerOfTwo:()=>Bi,objToValueList:()=>Ud,parseColor:()=>$e,parseColorHex:()=>Oc,parseColorRgba:()=>Dc,pick:()=>jh,processQueue:()=>IE,promiseQueue:()=>fy,promptDownload:()=>Qi,propertyPathToString:()=>Gh,removeFromArray:()=>SE,requestAnimFrame:()=>mc,resizeElement:()=>Gl,resolvePath:()=>X0,rgbaToRgb:()=>Yn,serializeXMLDocument:()=>dg,setAttributes:()=>pc,setCtxFont:()=>$i,setElementSize:()=>Nn,setKeys:()=>uN,setProperty:()=>_i,setValues:()=>lo,smartRequire:()=>Ts,throttle:()=>No,toArray:()=>Uh,toHexa:()=>yu,toPropertyPath:()=>Tn,traverse:()=>_y,unflatten:()=>qh,unorderedHash:()=>LE,workerIsAvailable:()=>Z0});var ss="Arial",Wi="black",nd="rgba(255,255,255,0)",Ar=12,Go=3,ig=7,JC=!0,ng=10,tN=5,b0=.08,v0="rgba(255,255,255,0)",A0="normal",E0="center",S0=!1,w0=0,Lu="red",T0="rgb(220, 220, 220)",I0="red",L0="rgb(220, 220, 220)",C0="grey",N0="white",rg=2,M0=null,og=5,Cu=0,R0="rgba(0, 0, 0, 0.36)",eN=1,sN="circle",Nu=12,ro="white",or=40,oo="black",ar=2,ao="black",ag=40,F0=null,P0=null,lg=1,z0="black",D0=1e3,O0=800,k0=1,B0=2,U0="rgba(0, 0, 0, 0.0)",G0="rgba(0, 0, 0, 0.6)",V0=50,iN=.1,Bn=12,Va=24,Vo=1,Mu=Vo/2,Wf=.45,Zf=.7,nN=10,q0=nN/2,j0=5;function rN(t){let e="";for(let s=0;s<t.length;s++)e+=t[s].cssText+`
`;return e}function Y0(){const t=Ai(),e=t.styleSheets||[],s=hx(t),i=[],n=[];for(let o=0;o<e.length;o++){const a=e[o];a.href==null?i.push({href:s,content:rN(a.cssRules)}):n.push(a.href)}const r=/@font-face\s*\{[^}]+\}/g;return Promise.all(n.map(o=>Lr(o).then(a=>({href:o,content:a})).catch(kl))).then(o=>o.concat(i)).then(o=>{const a=[];for(let l=0;l<o.length;l++){const d=o[l];if(d!==null){const{href:h,content:u}=d,c=u.match(r);if(c){const g=aN(c,h);a.push.apply(a,g)}}}return a})}function H0(t,e){return Promise.all(t.map(({formats:s,originalRule:i})=>Promise.all(s.map(({format:n,url:r})=>e?dx(r).then(o=>({format:n,src:o})).catch(kl):{format:n,src:r})).then(n=>{const r=[];for(const o of n)o!==null&&r.push(`url('${o.src}') format('${o.format}')`);if(r.length!==0){const o=`src: ${r.join(",")}`;return i.replace(/@font-face\s*{([^}]*);?}/,`@font-face{$1;${o}}`).replace(/\s+/," ").replace(/;+/,";")}return i})))}var oN={"embedded-opentype":!0,svg:!0};function aN(t,e){const s=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g,i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/,n=[];for(let r=0;r<t.length;r++){const o=t[r],a=o.match(i);if(a){const l=a[1],d=[];let h;for(;h=s.exec(o);){const u=h[1],c=h[2];oN[c.toLowerCase()]||d.push({format:c,url:X0(u,e)})}n.push({name:l,formats:d,originalRule:o})}}return n}function X0(t,e){if(/^http(s)?:/.test(t))return t;if(t[0]==="/"){const n=e.match(/((\w+:\/\/)([^/]+))/);return n?n[1]+t:t}const s=t.split("/"),i=e.split("/");for(e[e.length-1]!=="/"&&i.pop();s[0]==="..";)s.shift(),i.pop();return i.concat(s).join("/").replace(/[\w](\/{2,})/g,n=>n[0]+"/")}function $0(t,e,s=Mu){return t/s/(2*e)}function lN(t){return t instanceof RegExp||t instanceof Date}var dN=typeof HTMLElement>"u"?t=>!1:t=>t instanceof HTMLElement,hN=function(t){return typeof t!="object"||t===null||Ue(t)||lN(t)};function Ud(t,e=[],s=[]){if(!dN(t)){if(hN(t))e.push({path:s.slice(),value:t});else{const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=s.slice();o.push(r),Ud(t[r],e,o)}}return e}}var W0=class{constructor(){this._keys=[],this._values=[],this._size=0,this._cachedPath=[],this._cachedIndex=-1}get size(){return this._size}set(t,e){const s=this._getIndex(t);s!==-1?this._values[s]=e:(bh(this._cachedPath,t)&&(this._cachedIndex=this._keys.length),this._keys.push(t),this._values.push(e),this._size+=1)}get(t){const e=this._getIndex(t);if(e!==-1)return this._values[e]}has(t){return this._getIndex(t)!==-1}keys(){return this._keys.slice()}_getIndex(t){if(bh(t,this._cachedPath))return this._cachedIndex;this._cachedPath=t.slice();const e=this._keys;for(let s=0;s<e.length;++s)if(bh(e[s],t))return this._cachedIndex=s,s;return this._cachedIndex=-1,-1}};function bh(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}var Ru,uN=function(e){return Array.from(e.keys())},lo=function(e){return Array.from(e.values())},qo=Ts("web-worker"),Z0=!!qo||typeof Worker<"u"&&typeof Blob<"u";function K0(t){return qo?Fu(t):t}function Fu(t){if(ArrayBuffer.isView(t))return Array.from(t);if(Array.isArray(t)){for(let e=0;e<t.length;e++)t[e]=Fu(t[e]);return t}if(Ne(t)){const e=Object.keys(t);for(const s of e)t[s]=Fu(t[s]);return t}return t}function Q0(t){return qo?gN(t.toString()):cN(t)}function cN(t){return US(AS(t))}function gN(t){if(qo)return new qo("data:application/javascript,"+t.replace(/\n/g,""))}var Kf=Ts("@xmldom/xmldom");Ru=typeof XMLSerializer<"u"?XMLSerializer:Kf?Kf.XMLSerializer:null;var mN=class J0{constructor(e){this._attributes={},this._children=[],this._name=e}setAttribute(e,s){this._attributes[e]=s}appendChild(e){this._children.push(e)}get tagName(){return this._name}get children(){return this._children}get childNodes(){return this._children}get firstChild(){return this._children[0]||null}serialize(){const e=this._name,s=this._attributes,i=this._children,n=Object.keys(s).filter(o=>s[o]!==void 0).map(o=>` ${o}="${""+s[o]}"`).join(""),r=i.map(o=>o.serialize()).join("");return r.length?`<${e}${n}>${r}</${e}>`:`<${e}${n}/>`}cloneNode(e){const s=new J0(this._name),i=Object.keys(this._attributes);for(const n of i)s.setAttribute(n,this._attributes[n]);if(e)for(let n=0;n<this._children.length;n++)s.appendChild(this._children[n].cloneNode(e));return s}},tv=class ev{constructor(e){this._text=e}serialize(){return this._text}cloneNode(){return new ev(this._text)}},fN=class{constructor(){this._children=[],this._meta=[],this._children=[],this._meta=[]}appendChild(t){this._children.push(t)}serialize(){return this._meta.concat(this._children.map(t=>t.serialize())).join("")}createElement(t){return new mN(t)}createTextNode(t){return new tv(t)}},sv=()=>new fN;function dg(t){if(Ru)return new Ru().serializeToString(t)}var iv=()=>Ai().implementation.createDocument("","",null),ra=class{constructor(t,e){this._graph=t,this._nodes={elementList:t.nodeList,flexArray:t.createNodeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!0)},this._edges={elementList:t.edgeList,flexArray:t.createEdgeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!1)}}_get(t){return t.isNode?this._nodes:this._edges}addOrRemoveElements(t,e){return e?this.addElements(t):this.removeElements(t)}addElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength();for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];s.get(o)!==1&&(s.set(o,1),i.pushUnchecked(o))}return e(i.slice(n))}removeElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength(),r=i.getBuffer();if(n>r.length)return this.clear(),this.addElements(t),t;let o=0;for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];s.get(l)!==0&&(s.set(l,0),o+=1)}if(o===n)return e(i.sliceAndReset());if(o===0)return e();{const a=this._graph.acquireIndexList(t.isNode);let l=0;for(let d=0;d<n;++d){const h=r[d];s.get(h)===0?(l+=1,a.pushUnchecked(h)):r[d-l]=h}return i.setLength(n-o),e(a.sliceAndReset())}}hasElement(t){return!!this._get(t).flexArray.get(t._index)}clear(){this._nodes.indexList.isEmpty()||(this._nodes.indexList.reset(),this._nodes.flexArray.reset()),this._edges.indexList.isEmpty()||(this._edges.indexList.reset(),this._edges.flexArray.reset())}isEmpty(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()}getElements(){return{nodes:this._nodes.elementList(this._nodes.indexList.slice()),edges:this._edges.elementList(this._edges.indexList.slice())}}};function pN(t,e,s,i=0){e===void 0&&(e=s=Math.sqrt(t.length/4)),s===void 0&&(s=e);const n=document.createElement("canvas"),r=n.getContext("2d");if(r){const o=r.createImageData(e,s);n.style.imageRendering="pixelated",n.style.border="1px solid black",n.style.margin="2px",n.style.position="absolute",n.style.top=n.style.left="0px",n.width=e,n.height=s,o.data.set(t),r.putImageData(o,0,0);const a=document.getElementById("graph-container");a&&(a.style.position="static"),setTimeout(()=>document.body.appendChild(n),i)}}var _N=class{constructor(t,e){this._attributesManager=t,this._id=e}getDefinition(){return this._attributesManager.getAttributeLayerDefinition(this._id)}update(t){this._attributesManager.updateAttributeLayer(this._id,t)}destroy(){this._attributesManager.destroyAttributeLayer(this._id)}updateElements(t){this._attributesManager.updateElementsForAttributeLayer(this._id,t)}updateAll(){this._attributesManager.updateAllForAttributeLayer(this._id)}setAttributeValues(t,e,s){this._attributesManager.setAttributeLayerValues(this._id,t,e,s)}getUsedAttributeNames(t){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,t)}getFlexArrays(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)}},hg={};Ho(hg,{cubicIn:()=>vN,cubicInOut:()=>EN,cubicOut:()=>AN,linear:()=>rd,quadraticIn:()=>yN,quadraticInOut:()=>bN,quadraticOut:()=>xN});var rd=t=>t,yN=t=>t*t,xN=t=>t*(2-t),bN=t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1),vN=t=>t*t*t,AN=t=>--t*t*t+1,EN=t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2),SN={name:"animationStart",storage:32,default:0},wN={name:"animationDuration",storage:16,default:0},TN={name:"animationEasing",storage:"resource",default:"linear"},IN={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentNodes:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},LN={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},extremities:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},parallelEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},CN={x:1,y:1,radius:1,"halo.hideNonAdjacentEdges":1};function wo(t){return typeof t=="string"}var Pu=1,nv="scaled",rv="grey",ov=1,av=0,lv=0,dv=!0,hv=0,uv=!0,cv="line",gv=null,mv=null,fv="plain",pv="inherit",zu=0,_v="fixed",yv=0,xv=null,Du=10,bv="fixed",vv=1e3,Av=800,Ev="rgba(0, 0, 0, 0.6)",Sv="rgba(0, 0, 0, 0)",wv=10,Tv=1,Iv=2,Lv="rgba(0, 0, 0, 0.36)",Cv=0,NN=1,Nv="normal",Mv="center",Rv=2,Ou=2,Fv=ia,Pv=4,zv=!0,Dv=4,ku=2,Bu=12,Ov=2;function MN(t,e,s){let i,n,r,o;s==="line"?(i="line",n="plain",r=null,o=null):s==="arrow"?(i="line",n="plain",r="arrow",o=null):s==="tapered"?(i="triangle",n="plain",r=null,o=null):s==="dashed"?(i="line",n="dashed",r=null,o=null):s==="dotted"&&(i="line",n="dotted",r=null,o=null),t.shape.body.set(e,i),t.shape.style.set(e,n),t.shape.head.set(e,r),t.shape.tail.set(e,o)}var kv={width:{_flexArray:Pu,_check:re(Pu)},scalingMethod:{_flexArray:nv,_check:pi},color:{_flexArray:rv,_check:lC},opacity:{_flexArray:ov,_check:fe},minVisibleSize:{_flexArray:av,_check:fe},layer:{_flexArray:lv,_check:l0},detectable:{_flexArray:dv,_check:Be},curvature:{_flexArray:hv,_check:Sn},adjustAnchors:{_flexArray:uv,_check:Be},shape:{_check:uC,_set:MN,type:"shape.head",body:{_flexArray:cv,_check:cC},head:{_flexArray:gv,_check:zf},tail:{_flexArray:mv,_check:zf},style:{_flexArray:fv,_check:gC}},stroke:{color:{_flexArray:pv,_check:Ye},width:{_flexArray:zu,_check:re(zu)},scalingMethod:{_flexArray:_v,_check:pi},minVisibleSize:{_flexArray:yv,_check:fe}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:xv,_check:Ui},width:{_flexArray:Du,_check:re(Du)},scalingMethod:{_flexArray:bv,_check:pi},size:"halo.width"},pulse:{enabled:{_flexArray:!1,_check:Be},duration:{_flexArray:vv,_check:fe},interval:{_flexArray:Av,_check:fe},startColor:{_flexArray:Ev,_check:Ye},endColor:{_flexArray:Sv,_check:Ye},width:{_flexArray:wv,_check:fe},startRatio:{_flexArray:Tv,_check:fe},endRatio:{_flexArray:Iv,_check:fe}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:Be},color:{_flexArray:Lv,_check:Ui},minVisibleSize:{_flexArray:Cv,_check:fe}},text:{_alias:"text.content",content:{_flexArray:null,_check:fi},font:{_flexArray:ss,_check:ur},color:{_flexArray:Wi,_check:Ui},size:{_flexArray:Ar,_check:re(Ar)},scale:{_flexArray:1,_check:fe},style:{_flexArray:Nv,_check:cr},align:{_flexArray:Mv,_check:id},margin:{_flexArray:Rv,_check:Sn},padding:{_flexArray:Ou,_check:re(Ou)},backgroundColor:{_flexArray:nd,_check:Ye},minVisibleSize:{_flexArray:Pv,_check:fe},position:{_flexArray:Fv,_check:aC},adjustAngle:{_flexArray:zv,_check:Be},scaling:{_flexArray:S0,_check:Be},maxLineLength:{_flexArray:w0,_check:fe},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:fi},font:{_flexArray:ss,_check:ur},color:{_flexArray:Wi,_check:Ui},size:{_flexArray:Bu,_check:re(Bu)},scale:{_flexArray:b0,_check:fe},style:{_flexArray:A0,_check:cr},align:{_flexArray:E0,_check:id},margin:{_flexArray:Ov,_check:Sn},padding:{_flexArray:ku,_check:re(ku)},backgroundColor:{_flexArray:v0,_check:Ye},minVisibleSize:{_flexArray:Dv,_check:fe}}}},RN=re(j0),FN=re(Ar),PN=re(ng),zN=re(rg),DN=re(og),ON=re(ig),Qf=re(Go),kN=re(q0),BN=re(ag),UN=re(lg);function qa(t){return{_check:fi,_set:(e,s,i)=>{e.badges[t].text.content.set(s,i),i==null&&e.badges[t].image.url.set(s,i)},_get:(e,s)=>e.badges[t].text.content.get(s),color:{_flexArray:ro,_check:Ye},scale:{_flexArray:Wf,_check:re(Wf)},positionScale:{_flexArray:1,_check:fe},minVisibleSize:{_flexArray:or,_check:re(or)},scalingMethod:{_flexArray:"scaled",_check:pi},image:{_alias:`badges.${t}.image.url`,url:{_flexArray:null,_check:fi},scale:{_flexArray:Vo,_check:re(Vo)}},stroke:{color:{_flexArray:oo,_check:Ye},width:{_flexArray:ar,_check:re(ar)},scalingMethod:{_flexArray:"fixed",_check:pi}},text:{_alias:`badges.${t}.text.content`,content:{_flexArray:null,_check:fi},color:{_flexArray:ao,_check:Ye},font:{_flexArray:ss,_check:ur},style:{_flexArray:"normal",_check:cr},scale:{_flexArray:Mu,_check:re(Mu)},paddingLeft:{_flexArray:0,_check:Sn},paddingTop:{_flexArray:0,_check:Sn}}}}var Bv={x:{_flexArray:0,_check:Sn,_disableMemoryOptimization:!0},y:{_flexArray:0,_check:Sn,_disableMemoryOptimization:!0},radius:{_flexArray:j0,_check:RN},scalingMethod:{_flexArray:"scaled",_check:pi},color:{_flexArray:C0,_check:fC},opacity:{_flexArray:1,_check:fe},shape:{_flexArray:"circle",_check:dC},layer:{_flexArray:0,_check:l0},detectable:{_flexArray:!0,_check:Be},draggable:{_flexArray:!0,_check:Be},layoutable:{_flexArray:!0,_check:Be},innerStroke:{_alias:"innerStroke.color",width:{_flexArray:rg,_check:zN},scalingMethod:{_flexArray:"fixed",_check:pi},color:{_flexArray:N0,_check:Ye},minVisibleSize:{_flexArray:Nu,_check:re(Nu)}},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:og,_check:DN},scalingMethod:{_flexArray:"fixed",_check:pi},color:{_flexArray:M0,_check:Ye},minVisibleSize:{_flexArray:Cu,_check:re(Cu)}},badges:{_check:rC,_set(t,e,s){t.badges.topLeft.text.content.set(e,s),t.badges.topLeft.image.url.set(e,s),t.badges.topRight.text.content.set(e,s),t.badges.topRight.image.url.set(e,s),t.badges.bottomLeft.text.content.set(e,s),t.badges.bottomLeft.image.url.set(e,s),t.badges.bottomRight.text.content.set(e,s),t.badges.bottomRight.image.url.set(e,s)},topLeft:qa("topLeft"),topRight:qa("topRight"),bottomLeft:qa("bottomLeft"),bottomRight:qa("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:F0,_check:Ui},width:{_flexArray:ag,_check:BN},scalingMethod:{_flexArray:"fixed",_check:pi},strokeColor:{_flexArray:P0,_check:Ui},strokeWidth:{_flexArray:lg,_check:UN},clustering:{_flexArray:!1,_check:Be},hideNonAdjacentEdges:{_flexArray:!1,_check:Be}},pulse:{enabled:{_flexArray:!1,_check:Be},duration:{_flexArray:D0,_check:fe},interval:{_flexArray:O0,_check:fe},startColor:{_flexArray:G0,_check:Ye},endColor:{_flexArray:U0,_check:Ye},width:{_flexArray:V0,_check:fe},startRatio:{_flexArray:k0,_check:fe},endRatio:{_flexArray:B0,_check:fe}},icon:{_alias:"icon.content",content:{_flexArray:null,_check:fi},font:{_flexArray:ss,_check:ur},color:{_flexArray:z0,_check:Ui},scale:{_flexArray:Zf,_check:re(Zf)},style:{_flexArray:"normal",_check:cr},minVisibleSize:{_flexArray:Bn,_check:re(Bn)}},image:{_alias:"image.url",url:{_flexArray:null,_check:fi},scale:{_flexArray:Vo,_check:re(Vo)},fit:{_flexArray:!0,_check:Be},tile:{_flexArray:!1,_check:Be},minVisibleSize:{_flexArray:Bn,_check:re(Bn)}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:Be},color:{_flexArray:R0,_check:Ui},minVisibleSize:{_flexArray:Bn,_check:re(Bn)}},text:{_alias:"text.content",content:{_flexArray:null,_check:fi},font:{_flexArray:ss,_check:ur},color:{_flexArray:Wi,_check:Ye},size:{_flexArray:Ar,_check:FN},scale:{_flexArray:iN,_check:fe},style:{_flexArray:"normal",_check:cr},align:{_flexArray:"center",_check:id},margin:{_flexArray:ig,_check:ON},padding:{_flexArray:Go,_check:Qf},backgroundColor:{_flexArray:null,_check:Ye},tip:{_flexArray:!0,_check:Be},minVisibleSize:{_flexArray:Va,_check:re(Va)},scaling:{_flexArray:!1,_check:Be},position:{_flexArray:"bottom",_check:mC},maxLineLength:{_flexArray:0,_check:fe},truncateLength:{_flexArray:0,_check:fe},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:fi},font:{_flexArray:ss,_check:ur},color:{_flexArray:Wi,_check:Ye},size:{_flexArray:ng,_check:PN},scale:{_flexArray:.08,_check:fe},style:{_flexArray:"normal",_check:cr},align:{_flexArray:"center",_check:id},margin:{_flexArray:q0,_check:kN},padding:{_flexArray:Go,_check:Qf},backgroundColor:{_flexArray:null,_check:Ye},minVisibleSize:{_flexArray:Va,_check:re(Va)}}}},GN=t=>(e,s)=>e[t].get(s),VN=(t,e)=>(s,i)=>s[t][e].get(i),qN=(t,e,s)=>(i,n)=>i[t][e][s].get(n),jN=(t,e,s,i)=>(n,r)=>n[t][e][s][i].get(r),YN=t=>(e,s,i)=>e[t].set(s,i),HN=(t,e)=>(s,i,n)=>s[t][e].set(i,n),XN=(t,e,s)=>(i,n,r)=>i[t][e][s].set(n,r),$N=(t,e,s,i)=>(n,r,o)=>n[t][e][s][i].set(r,o),WN=[GN,VN,qN,jN],ZN=[YN,HN,XN,$N];function Jf(t,e){if(!t._check)throw new Error(`error somewhere for ${e}`);const s=e.split("."),i=s.length-1,n=WN[i].apply(null,s),r=ZN[i].apply(null,s);return{check:t._check,set:r,get:n,nested:{}}}function od(t,e){const s=e?Bv:kv,i=typeof t=="string"?[t]:Ln(t,"",[]);let n=!1;const r=[];for(let o=0;o<i.length;o++){const a=i[o].split(".");let l=s[a[0]];for(let h=1;h<a.length;h++)l=l[a[h]];l.type&&(i[o]=l.type),l._alias&&(i[o]=l._alias),i[o]==="badges"&&(i[o]="badges.topLeft.text.content",n=!0);const d=a[a.length-1];d!=="topLeft"&&d!=="topRight"&&d!=="bottomLeft"&&d!=="bottomRight"||(i[o]=`badges.${d}.text.content`,r.push(`badges.${d}.image.url`)),i[o]==="strokeWidth"&&(i[o]="stroke.width")}return n&&(i.push("badges.topLeft.image.url"),i.push("badges.topRight.text.content"),i.push("badges.topRight.image.url"),i.push("badges.bottomLeft.text.content"),i.push("badges.bottomLeft.image.url"),i.push("badges.bottomRight.text.content"),i.push("badges.bottomRight.image.url")),i.push(...r),i}var ja=t=>(e,s)=>({url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)}),Ya=t=>(e,s)=>({color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)}),Ha=t=>(e,s)=>({content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}),Xa=t=>(e,s)=>({color:e.badges[t].color.get(s),scale:e.badges[t].scale.get(s),positionScale:e.badges[t].positionScale.get(s),minVisibleSize:e.badges[t].minVisibleSize.get(s),image:{url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)},stroke:{color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)},text:{content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}}),zi={topLeft:Xa("topLeft"),topRight:Xa("topRight"),bottomLeft:Xa("bottomLeft"),bottomRight:Xa("bottomRight")},zs={stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),innerStroke:(t,e)=>({width:t.innerStroke.width.get(e),scalingMethod:t.innerStroke.scalingMethod.get(e),color:t.innerStroke.color.get(e),minVisibleSize:t.innerStroke.minVisibleSize.get(e)}),outerStroke:(t,e)=>({width:t.outerStroke.width.get(e),scalingMethod:t.outerStroke.scalingMethod.get(e),color:t.outerStroke.color.get(e),minVisibleSize:t.outerStroke.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e),strokeColor:t.halo.strokeColor.get(e),strokeWidth:t.halo.strokeWidth.get(e),clustering:t.halo.clustering.get(e),hideNonAdjacentEdges:t.halo.hideNonAdjacentEdges.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),backgroundColor:t.text.backgroundColor.get(e),tip:t.text.tip.get(e),minVisibleSize:t.text.minVisibleSize.get(e),scaling:t.text.scaling.get(e),position:t.text.position.get(e),maxLineLength:t.text.maxLineLength.get(e),truncateLength:t.text.truncateLength.get(e),secondary:zs["text.secondary"](t,e)}),image:(t,e)=>({url:t.image.url.get(e),scale:t.image.scale.get(e),fit:t.image.fit.get(e),tile:t.image.tile.get(e),minVisibleSize:t.image.minVisibleSize.get(e)}),icon:(t,e)=>({content:t.icon.content.get(e),font:t.icon.font.get(e),color:t.icon.color.get(e),scale:t.icon.scale.get(e),style:t.icon.style.get(e),minVisibleSize:t.icon.minVisibleSize.get(e)}),badges:(t,e)=>({topLeft:zi.topLeft(t,e),topRight:zi.topRight(t,e),bottomLeft:zi.bottomLeft(t,e),bottomRight:zi.bottomRight(t,e)}),"badges.topLeft":zi.topLeft,"badges.topRight":zi.topRight,"badges.bottomLeft":zi.bottomLeft,"badges.bottomRight":zi.bottomRight,"badges.topLeft.image":ja("topLeft"),"badges.topLeft.stroke":Ya("topLeft"),"badges.topLeft.text":Ha("topLeft"),"badges.topRight.image":ja("topRight"),"badges.topRight.stroke":Ya("topRight"),"badges.topRight.text":Ha("topRight"),"badges.bottomLeft.image":ja("bottomLeft"),"badges.bottomLeft.stroke":Ya("bottomLeft"),"badges.bottomLeft.text":Ha("bottomLeft"),"badges.bottomRight.image":ja("bottomRight"),"badges.bottomRight.stroke":Ya("bottomRight"),"badges.bottomRight.text":Ha("bottomRight"),all:(t,e)=>({x:t.x.get(e),y:t.y.get(e),radius:t.radius.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),shape:t.shape.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),draggable:t.draggable.get(e),layoutable:t.layoutable.get(e),innerStroke:zs.innerStroke(t,e),outerStroke:zs.outerStroke(t,e),badges:zs.badges(t,e),halo:zs.halo(t,e),pulse:zs.pulse(t,e),icon:zs.icon(t,e),image:zs.image(t,e),outline:zs.outline(t,e),text:zs.text(t,e)})},Oi={shape:(t,e)=>({body:t.shape.body.get(e),head:t.shape.head.get(e),tail:t.shape.tail.get(e),style:t.shape.style.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),position:t.text.position.get(e),backgroundColor:t.text.backgroundColor.get(e),minVisibleSize:t.text.minVisibleSize.get(e),adjustAngle:t.text.adjustAngle.get(e),scaling:t.text.scaling.get(e),maxLineLength:t.text.maxLineLength.get(e),secondary:Oi["text.secondary"](t,e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e)}),all:(t,e)=>({width:t.width.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),minVisibleSize:t.minVisibleSize.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),curvature:t.curvature.get(e),adjustAnchors:t.adjustAnchors.get(e),shape:Oi.shape(t,e),stroke:Oi.stroke(t,e),halo:Oi.halo(t,e),pulse:Oi.pulse(t,e),outline:Oi.outline(t,e),text:Oi.text(t,e)})};function ug(t,e,s,i=!0){if((e=e||t)._flexArray!==void 0)return Jf(e,s);let n={check:qs,get:Xt,set:Xt,nested:{}};if(wo(e)||e._alias){const r=wo(e)?e:e._alias;n=Jf(ye(t,r),r)}else{if(e._set?(n.set=e._set,n.check=e._check):(n.set=Xt,n.check=Xt),e._get)n.get=e._get;else{const r=i?zs:Oi;n.get=r[s||"all"]}n.nested={}}if(!wo(e)){const r=Object.keys(e);for(const o of r){const a=e[o];o.startsWith("_")||(n.nested[o]=ug(t,a,s?s+"."+o:o,i))}}return n}var KN=ug(Bv,void 0,void 0,!0),QN=ug(kv,void 0,void 0,!1),JN=[];function tp(t){let e=JN;return t.output===void 0?(typeof t.attributes=="function"&&(e="all"),Ne(t.attributes)&&(e=Ln(t.attributes))):t.output&&(e=t.output.attributes),cg(e,t.allAttributePaths)}function tM(t,e,s,i){if(i>s){for(const n of e.attributes)for(const r of t.attributes)if(r===n)return!0}for(const n of e.tags)for(const r of t.tags)if(n===r)return!0;return!1}function Qs(t,e,s,i,n,r){tM(s,i,n,r)&&t.push(e)}function eM(t){let e=t.dependencies;e===void 0?e=IN:Ne(e)||(e={});const s=_d(t.attributes).some(o=>typeof o=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);let r=e.adjacentEdges;return!r&&e.adjacentNodes&&(r=!0),{self:ii(e.self,n,t.allAttributePaths),adjacentNodes:ii(e.adjacentNodes,n,t.allAttributePaths),adjacentEdges:ii(r,n,t.allAttributePaths),allNodes:ii(e.allNodes,n,t.allAttributePaths),allEdges:ii(e.allEdges,n,t.allAttributePaths)}}function sM(t){let e=t.dependencies;e===void 0?e=LN:Ne(e)||(e={});const s=_d(t.attributes).some(r=>typeof r=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);return{self:ii(e.self,n,t.allAttributePaths),extremities:ii(e.extremities,n,t.allAttributePaths),parallelEdges:ii(e.parallelEdges,n,t.allAttributePaths),allNodes:ii(e.allNodes,n,t.allAttributePaths),allEdges:ii(e.allEdges,n,t.allAttributePaths)}}function ii(t,e,s){if(!e)return{attributes:[],tags:[]};if(t===!0)return{attributes:[],tags:[du]};const i={attributes:cg((t=t||{}).attributes,s),tags:rM(t.tags)};return t.data&&i.tags.push(hu),t.selection&&i.tags.push(me),t.hover&&i.tags.push(xo),i}function iM(t){return Array.isArray(t)?t.join("."):t}function nM(t){return t.map(iM).filter(wo)}function cg(t,e){if(t==="all")return e.slice();if(!Array.isArray(t))return[];const s=nM(t);return e?e.filter(i=>s.some(n=>i.startsWith(n))):s}function rM(t){return Array.isArray(t)?t.filter(wo):[]}var ep={storage:1,default:0},ad=class{constructor({graph:t,isNode:e,includeRemovedElements:s}){this._all=!1,this._isNode=e,this._graph=t,this._includeRemovedElements=s,this._eltList=e?this._graph.nodeList:this._graph.edgeList,this._flexArray=e?t.createNodeAttribute(ep,!1):t.createEdgeAttribute(ep,!1),this._all=!1,this._indexList=t.createIndexList(e)}_getAllIndexes(){const t=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex(),e=new Uint32Array(t);for(let s=1;s<=t;++s)e[s-1]=s;return e}addAll(){this._all=!0}add(t){if(!this._all)for(let e=0;e<t._indexes.length;e++){const s=t._indexes[e];this.addIndex(s)}}addIndex(t){this._flexArray.get(t)===0&&(this._flexArray.set(t,1),this._indexList.push(t))}isEmpty(){return!this._all&&this._indexList.isEmpty()}isFull(){return this._all}getListAndClear(){const t=this.getList();return this.clear(),t}getList(){let t;if(this._all&&!this._includeRemovedElements)t=this._isNode?this._graph.getNodes("all"):this._graph.getEdges("all");else{const e=this._all?this._getAllIndexes():this._indexList.slice();t=this._eltList(e)}return t}clear(){this._all=!1,this._indexList.isEmpty()||(this._indexList.reset(),this._flexArray.reset())}addSet(t){if(t._all)this.addAll();else{const e=t._indexList.getBuffer(),s=t._indexList.getLength();for(let i=0;i<s;++i)this.addIndex(e[i])}}};function Uv(t,e=[],s=""){return t.constructor===Kl?t.isInitialized()&&e.push(s):t.constructor===Object&&Object.keys(t).forEach(i=>{Uv(t[i],e,s?s+"."+i:i)}),e}var sp=class{constructor(t,e,s){this._updatedAttributes=new Set,this._updatedAttributesTmp=new Set,this._allUsedAttributes=new Set,this._graph=t,this._eltName=e?"node":"edge",this._accessors=e?KN:QN,this._createFlexArrays=s;const i=this._createFlexArrays(t,{original:!0,useDefaultValues:!0});this._finalFlexArrays=i;const n=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._prevFlexArrays=n;const r=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._defaultFlexArrays=r,this._currentFlexArrays=this._defaultFlexArrays,this.setLastFlexArrays(this._defaultFlexArrays),this._elementsToRedraw=new ad({graph:t,isNode:e,includeRemovedElements:!0}),this._elementsUpdated=new ad({graph:t,isNode:e,includeRemovedElements:!1}),this._finalFlexArraysWrapped={...this._finalFlexArrays,excluded:t.getAttribute(e,"excluded"),textHidden:t.getAttribute(e,"textHidden"),animationStart:t.createAttribute(e,SN),animationDuration:t.createAttribute(e,wN),animationEasing:t.createAttribute(e,TN),id:this._graph.getAttribute(e,"id"),...!e&&{source:t.getEdgeAttribute("source"),target:t.getEdgeAttribute("target")}}}clear(){this._elementsToRedraw.clear(),this._elementsUpdated.clear(),this._updatedAttributes.clear(),this._updatedAttributesTmp.clear()}getAttributeFlexArrays(){return this._finalFlexArraysWrapped}getPrevAttributeFlexArrays(){return this._prevFlexArrays}getAnimationInformation(t){const e=t._indexes,s=Array(e.length),i=this._finalFlexArraysWrapped;for(let n=0;n<e.length;n++){const r=e[n];s[n]={duration:i.animationDuration.get(r),start:i.animationStart.get(r),easing:i.animationEasing.get(r)}}return s}setDefaultAttributes(t){Ln(t).forEach(e=>{const s=ye(this._currentFlexArrays,e),i=ye(this._prevFlexArrays,e),n=ye(this._defaultFlexArrays,e),r=ye(this._finalFlexArrays,e);if(!s)return;const o=ye(t,e);s.setDefaultValue(o),n.setDefaultValue(o),i.setDefaultValue(o),r.setDefaultValue(o)}),this.redrawAll()}startUpdate(){}prepareFlexArraysUpdate(t){this._currentFlexArrays=t.inputFlexArrays}setLastFlexArrays(t){this._lastFlexArrays=t}updateFlexArrays(t){const{attributes:e,selector:s,context:i,outputFlexArrays:n,toUpdate:r,formattedOutput:o}=t;this._elementsUpdated.addSet(r),this._elementsToRedraw.addSet(r);const a=r.getListAndClear();if(e&&a.size){const{valid:l,invalid:d}=Py(this._graph,a,s,i);for(const h of o.attributes){const u=ye(n,h);for(let c=0;c<d._indexes.length;c++){const g=d._indexes[c];u.set(g,void 0)}}this._assignAttributesToFlexArrays(this._accessors,n,l,e,i),this._addUpdatedAttributes(t)}}endUpdate(){const t=this._elementsUpdated.getList(),e=lo(this._updatedAttributesTmp);for(const s of e){const i=ye(this._lastFlexArrays,s),n=ye(this._finalFlexArrays,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];n.set(o,i.get(o))}}this._updatedAttributesTmp.clear(),this._currentFlexArrays=this._finalFlexArrays}setAttributeValues(t,e,s,i,n){const r=t.outputFlexArrays,o=this._accessors;this._assignAttributesToFlexArrays(o,r,e,s,null),this._addUpdatedAttributes(t,i),this._elementsUpdated.add(e),this._elementsToRedraw.add(e)}notifyLayerDestroyed(t){this._addUpdatedAttributes(t)}_addUpdatedAttributes(t,e){const{outputFlexArrays:s,formattedOutput:i}=t,n=Array.isArray(e)?cg(e):i.attributes;for(const r of n)ye(s,r).isInitialized()&&(this._updatedAttributes.add(r),this._updatedAttributesTmp.add(r),this._allUsedAttributes.add(r))}addUpdatedAttribute(t){this._updatedAttributes.add(t),this._updatedAttributesTmp.add(t),this._allUsedAttributes.add(t)}getUsedAttributeNames(t){return Uv(t.outputFlexArrays)}redrawElements(t){this._elementsToRedraw.add(t)}redrawAll(){this._elementsToRedraw.addAll()}getAndResetElementsToRedraw(){return this._elementsToRedraw.getListAndClear()}getAndResetElementsUpdated(){return this._elementsUpdated.getListAndClear()}getAndResetAttributesUpdated(){const t=lo(this._updatedAttributes);return this._updatedAttributes.clear(),t}getUpdatedAttributes(){return this._updatedAttributes}getUpdatedElementsList(){return this._elementsUpdated.getList()}getUpdatedAttributesSet(){return new Set(this._updatedAttributes)}createFlexArrays(){return this._createFlexArrays(this._graph,{original:!1,useDefaultValues:!1})}getAttributeValues(t,e,s,i){const n=i?this._prevFlexArrays:this._currentFlexArrays;return s?this._getMultipleAttributeValues(t,e,n):this._getSingleAttributeValues(t,e,n)}_getAccessor(t=""){let e=this._accessors;const s=Tn(t);for(const i of s)if(e=e.nested[i],!e)throw new Error(`${this._eltName} attribute "${s.join("")}" does not exist`);return e}_getSingleAttributeValues(t,e,s){const i=this._getAccessor(e),n=t._indexes,r=Array(n.length);for(let o=0;o<n.length;o++)r[o]=i.get(s,n[o]);return r}_getMultipleAttributeValues(t,e,s){if(!e||e==="all")return this._getSingleAttributeValues(t,"",s);const i=Array(t.size);for(let n=0;n<i.length;++n)i[n]={};for(let n=0;n<e.length;n++){const r=e[n],o=this._getSingleAttributeValues(t,r,s);for(let a=0;a<i.length;++a)_i(i[a],r,o[a])}return i}setAnimationAttributes(t,{duration:e,startTime:s,easing:i}){const n=t._indexes,r=this._finalFlexArraysWrapped,o=r.animationDuration,a=r.animationStart,l=r.animationEasing,d=lo(this._allUsedAttributes);if(e){let h=!1;for(const u of d){if(u==="x"||u==="y"){h=!0;continue}const c=ye(this._finalFlexArrays,u),g=ye(this._prevFlexArrays,u);for(let m=0;m<n.length;m++){const f=n[m];g.set(f,c.get(f))}}if(h){const u=Xe(),c=this._finalFlexArrays.x,g=this._finalFlexArrays.y,m=this._prevFlexArrays.x,f=this._prevFlexArrays.y;for(let p=0;p<n.length;p++){const _=n[p],y=o.get(_);if(y){const x=a.get(_),b=l.get(_),v=(hg[b]||rd)(Math.min((u-x)/y,1)),A=Wh(m.get(_),c.get(_),v),E=Wh(f.get(_),g.get(_),v);m.set(_,A),f.set(_,E)}else m.set(_,c.get(_)),f.set(_,g.get(_))}}}o.fill(n,e),a.fill(n,s),l.fill(n,i)}resetAnimationAttributes(t){this._finalFlexArraysWrapped.animationDuration.fill(t._indexes,0)}getUsedAttributes(){return lo(this._allUsedAttributes)}getDefaultFlexArrays(){return this._defaultFlexArrays}_assignAttributesToFlexArrays(t,e,s,i,n,r=[]){if(typeof i=="function"){const o=r.join(".");for(let a=0;a<s.size;++a){const l=s.get(a);if(l){const d=i(l,n,o);this._assignSingleValueToFlexArray(e,l,t,d,r)}}}else if(Ne(i)){const o=Object.keys(i);for(let a=0;a<o.length;++a){const l=o[a];r.push(l);const d=this._getNestedAccessor(t,l,r),h=i[l];this._assignAttributesToFlexArrays(d,e,s,h,n,r),r.pop()}}else if((Array.isArray(i)||ArrayBuffer.isView(i))&&r[0]!=="color")if(r.length===0)for(let o=0;o<s.size;++o)this._assignSingleValueToFlexArray(e,s.get(o),t,i[o],r);else for(let o=0;o<s.size;++o){const a=s._indexes[o],l=t.check(i[o]);t.set(e,a,l)}else{const o=t.check(i);for(let a=0;a<s.size;++a){const l=s.get(a);t.set(e,l._index,o)}}}_getNestedAccessor(t,e,s){const i=t.nested[e];if(!i)throw new Error(`${this._eltName} attribute "${s.join(".")}" does not exist`);return i}_assignSingleValueToFlexArray(t,e,s,i,n){if(Ne(i)){const r=Object.keys(i);for(const o of r){n.push(o);const a=i[o],l=this._getNestedAccessor(s,o,n);this._assignSingleValueToFlexArray(t,e,l,a,n),n.pop()}}else{const r=s.check(i);s.set(t,e._index,r)}}};function oM(t,{original:e,useDefaultValues:s}){const i="resource";return{width:t.createAttribute(!1,{storage:i,default:s?Pu:void 0,name:"width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?nv:void 0,name:"scalingMethod"},e),color:t.createAttribute(!1,{storage:i,default:s?rv:void 0,name:"color"},e),opacity:t.createAttribute(!1,{storage:i,default:s?ov:void 0,name:"opacity"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?av:void 0,name:"minVisibleSize"},e),layer:t.createAttribute(!1,{storage:i,default:s?lv:void 0,name:"layer"},e),detectable:t.createAttribute(!1,{storage:i,default:s?dv:void 0,name:"detectable"},e),curvature:t.createAttribute(!1,{storage:i,default:s?hv:void 0,name:"curvature"},e),adjustAnchors:t.createAttribute(!1,{storage:i,default:s?uv:void 0,name:"adjustAnchors"},e),shape:{body:t.createAttribute(!1,{storage:i,default:s?cv:void 0,name:"shape.body"},e),head:t.createAttribute(!1,{storage:i,default:s?gv:void 0,name:"shape.head"},e),tail:t.createAttribute(!1,{storage:i,default:s?mv:void 0,name:"shape.tail"},e),style:t.createAttribute(!1,{storage:i,default:s?fv:void 0,name:"shape.style"},e)},stroke:{color:t.createAttribute(!1,{storage:i,default:s?pv:void 0,name:"stroke.color"},e),width:t.createAttribute(!1,{storage:i,default:s?zu:void 0,name:"stroke.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?_v:void 0,name:"stroke.scalingMethod"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?yv:void 0,name:"stroke.minVisibleSize"},e)},halo:{color:t.createAttribute(!1,{storage:i,default:s?xv:void 0,name:"halo.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Du:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?bv:void 0,name:"halo.scalingMethod"},e)},pulse:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!1,{storage:i,default:s?vv:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!1,{storage:i,default:s?Av:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!1,{storage:i,default:s?Ev:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!1,{storage:i,default:s?Sv:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!1,{storage:i,default:s?wv:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!1,{storage:i,default:s?Tv:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!1,{storage:i,default:s?Iv:void 0,name:"pulse.endRatio"},e)},outline:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!1,{storage:i,default:s?Lv:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Cv:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!1,{storage:i,default:s?ss:void 0,name:"text.font"},e),color:t.createAttribute(!1,{storage:i,default:s?Wi:void 0,name:"text.color"},e),size:t.createAttribute(!1,{storage:i,default:s?Ar:void 0,name:"text.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?NN:void 0,name:"text.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?Nv:void 0,name:"text.style"},e),align:t.createAttribute(!1,{storage:i,default:s?Mv:void 0,name:"text.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Rv:void 0,name:"text.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?Ou:void 0,name:"text.padding"},e),position:t.createAttribute(!1,{storage:i,default:s?Fv:void 0,name:"text.position"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?nd:void 0,name:"text.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Pv:void 0,name:"text.minVisibleSize"},e),adjustAngle:t.createAttribute(!1,{storage:i,default:s?zv:void 0,name:"text.adjustAngle"},e),scaling:t.createAttribute(!1,{storage:i,default:s?S0:void 0,name:"text.scaling"},e),maxLineLength:t.createAttribute(!1,{storage:i,default:s?w0:void 0,name:"text.maxLineLength"},e),secondary:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!1,{storage:i,default:s?ss:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!1,{storage:i,default:s?Wi:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!1,{storage:i,default:s?Bu:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?b0:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?A0:void 0,name:"text.secondary.style"},e),align:t.createAttribute(!1,{storage:i,default:s?E0:void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Ov:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?ku:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?v0:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Dv:void 0,name:"text.secondary.minVisibleSize"},e)}}}}function aM(t,{original:e,useDefaultValues:s}){const i="resource";return{x:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"x"},e),y:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"y"},e),radius:t.createAttribute(!0,{storage:i,default:s?5:void 0,name:"radius"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?C0:void 0,name:"color"},e),opacity:t.createAttribute(!0,{storage:i,default:s?eN:void 0,name:"opacity"},e),shape:t.createAttribute(!0,{storage:i,default:s?sN:void 0,name:"shape"},e),layer:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"layer"},e),detectable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"detectable"},e),draggable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"draggable"},e),layoutable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"layoutable"},e),innerStroke:{width:t.createAttribute(!0,{storage:i,default:s?rg:void 0,name:"innerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"innerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?N0:void 0,name:"innerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Nu:void 0,name:"innerStroke.minVisibleSize"},e)},outerStroke:{width:t.createAttribute(!0,{storage:i,default:s?og:void 0,name:"outerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"outerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?M0:void 0,name:"outerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Cu:void 0,name:"outerStroke.minVisibleSize"},e)},badges:{topLeft:{color:t.createAttribute(!0,{storage:i,default:s?ro:void 0,name:"badges.topLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?or:void 0,name:"badges.topLeft.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.topLeft.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?oo:void 0,name:"badges.topLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?ar:void 0,name:"badges.topLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topLeft.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?ao:void 0,name:"badges.topLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ss:void 0,name:"badges.topLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.top"},e)}},topRight:{color:t.createAttribute(!0,{storage:i,default:s?ro:void 0,name:"badges.topRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?or:void 0,name:"badges.topRight.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.topRight.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?oo:void 0,name:"badges.topRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?ar:void 0,name:"badges.topRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topRight.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?ao:void 0,name:"badges.topRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ss:void 0,name:"badges.topRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topRight.text.scale"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.left"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.top"},e)}},bottomLeft:{color:t.createAttribute(!0,{storage:i,default:s?ro:void 0,name:"badges.bottomLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?or:void 0,name:"badges.bottomLeft.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.bottomLeft.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?oo:void 0,name:"badges.bottomLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?ar:void 0,name:"badges.bottomLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomLeft.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?ao:void 0,name:"badges.bottomLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ss:void 0,name:"badges.bottomLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.top"},e)}},bottomRight:{color:t.createAttribute(!0,{storage:i,default:s?ro:void 0,name:"badges.bottomRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?or:void 0,name:"badges.bottomRight.minVisibleSize"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"badges.bottomRight.scalingMethod"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?oo:void 0,name:"badges.bottomRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?ar:void 0,name:"badges.bottomRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomRight.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?ao:void 0,name:"badges.bottomRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?ss:void 0,name:"badges.bottomRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomRight.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.top"},e)}}},halo:{color:t.createAttribute(!0,{storage:i,default:s?F0:void 0,name:"halo.color"},e),width:t.createAttribute(!0,{storage:i,default:s?ag:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"halo.scalingMethod"},e),strokeColor:t.createAttribute(!0,{storage:i,default:s?P0:void 0,name:"halo.strokeColor"},e),strokeWidth:t.createAttribute(!0,{storage:i,default:s?lg:void 0,name:"halo.strokeWidth"},e),clustering:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.clustering"},e),hideNonAdjacentEdges:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.hideNonAdjacentEdges"},e)},pulse:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!0,{storage:i,default:s?D0:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!0,{storage:i,default:s?O0:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!0,{storage:i,default:s?G0:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!0,{storage:i,default:s?U0:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!0,{storage:i,default:s?V0:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!0,{storage:i,default:s?k0:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!0,{storage:i,default:s?B0:void 0,name:"pulse.endRatio"},e)},icon:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"icon.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ss:void 0,name:"icon.font"},e),color:t.createAttribute(!0,{storage:i,default:s?z0:void 0,name:"icon.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.7:void 0,name:"icon.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"icon.style"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"icon.minVisibleSize"},e)},image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"image.scale"},e),fit:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"image.fit"},e),tile:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"image.tile"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"image.minVisibleSize"},e)},outline:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!0,{storage:i,default:s?R0:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ss:void 0,name:"text.font"},e),color:t.createAttribute(!0,{storage:i,default:s?Wi:void 0,name:"text.color"},e),size:t.createAttribute(!0,{storage:i,default:s?Ar:void 0,name:"text.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.1:void 0,name:"text.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?ig:void 0,name:"text.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?Go:void 0,name:"text.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?nd:void 0,name:"text.backgroundColor"},e),tip:t.createAttribute(!0,{storage:i,default:s?JC:void 0,name:"text.tip"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.minVisibleSize"},e),scaling:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"text.scaling"},e),position:t.createAttribute(!0,{storage:i,default:s?"bottom":void 0,name:"text.position"},e),maxLineLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.maxLineLength"},e),truncateLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.truncateLength"},e),secondary:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!0,{storage:i,default:s?ss:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!0,{storage:i,default:s?Wi:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!0,{storage:i,default:s?ng:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.08:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.secondary.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?tN:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?Go:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?nd:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.secondary.minVisibleSize"},e)}}}}var lM=class{constructor(t){this.nodes=new sp(t,!0,aM),this.edges=new sp(t,!1,oM)}setNodeDefaultAttributes(t){this.nodes.setDefaultAttributes(t)}setEdgeDefaultAttributes(t){this.edges.setDefaultAttributes(t)}getFlexArrays(){return{nodes:{current:this.nodes.getAttributeFlexArrays(),previous:this.nodes.getPrevAttributeFlexArrays()},edges:{current:this.edges.getAttributeFlexArrays(),previous:this.edges.getPrevAttributeFlexArrays()}}}redrawAll(){this.nodes.redrawAll(),this.edges.redrawAll()}clear(){this.nodes.clear(),this.edges.clear()}redrawElements(t){this._fetch(t).redrawElements(t)}getAnimationInformation(t){return this._fetch(t).getAnimationInformation(t)}redrawNodes(t){this.nodes.redrawElements(t)}getUsedAttributes(t,e){return this._fetch(e).getUsedAttributeNames(e.isNode?t.nodes:t.edges)}startUpdate(){this.nodes.startUpdate(),this.edges.startUpdate()}notifyDestroyed(t){this.nodes.notifyLayerDestroyed(t.nodes),this.edges.notifyLayerDestroyed(t.edges)}prepareUpdate(t){this.nodes.prepareFlexArraysUpdate(t.nodes),this.edges.prepareFlexArraysUpdate(t.edges)}onUpdate(t){this.nodes.updateFlexArrays(t.nodes),this.edges.updateFlexArrays(t.edges)}afterLayersUpdate(){this.nodes.endUpdate(),this.edges.endUpdate()}getAndResetElementsToRedraw(){return{nodes:this.nodes.getAndResetElementsToRedraw(),edges:this.edges.getAndResetElementsToRedraw()}}getAndResetElementsUpdated(){const t=this.nodes,e=this.edges;return{nodes:t.getAndResetElementsUpdated(),edges:e.getAndResetElementsUpdated(),nodeAttributesSet:t.getUpdatedAttributesSet(),nodeAttributes:t.getAndResetAttributesUpdated(),edgeAttributes:e.getAndResetAttributesUpdated()}}setAnimationAttributes({nodes:t,edges:e},s){this.nodes.setAnimationAttributes(t,s),this.edges.setAnimationAttributes(e,s)}resetAnimationAttributes({nodes:t,edges:e}){this.nodes.resetAnimationAttributes(t),this.edges.resetAnimationAttributes(e)}setLastOutput(t,e){this.nodes.setLastFlexArrays(t),this.edges.setLastFlexArrays(e)}getCurrentInput(){const t=be(this.nodes.getDefaultFlexArrays()),e=be(this.edges.getDefaultFlexArrays());return{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:Ln(t),allEdgeAttributePaths:Ln(e)}}initializeLayer(t,e,s){t.nodes.allAttributePaths=e,t.edges.allAttributePaths=s,t.nodes.formattedDependencies=eM(t.nodes),t.edges.formattedDependencies=sM(t.edges),t.nodes.formattedOutput={attributes:tp(t.nodes),tags:t.tag?[t.tag]:[]},t.edges.formattedOutput={attributes:tp(t.edges),tags:t.tag?[t.tag]:[]},t.nodes.redrawAdjacentEdges=t.nodes.formattedOutput.attributes.some(i=>CN[i]),t.initialized=!0}connectLayerInputOutput(t,e,s){const i=t.nodes.formattedOutput,n=t.edges.formattedOutput;for(const r of i.attributes){const o=ye(e,r),a=ye(t.nodes.outputFlexArrays,r);a.setFallback(o),_i(e,r,a)}for(const r of n.attributes){const o=ye(s,r),a=ye(t.edges.outputFlexArrays,r);a.setFallback(o),_i(s,r,a)}}setupLayerDependencies(t,e){if(t===e)return;const s=t.priority,i=e.priority,n=t.nodes.formattedOutput,r=t.edges.formattedOutput,o=e.nodes.formattedDependencies,a=e.edges.formattedDependencies;Qs(t.depsNodeSelf,e,n,o.self,s,i),Qs(t.depsNodeAdjacentNodes,e,n,o.adjacentNodes,s,i),Qs(t.depsNodeAdjacentEdges,e,r,a.extremities,s,i),Qs(t.depsNodeAllNodes,e,n,o.allNodes,s,i),Qs(t.depsNodeAllEdges,e,r,a.allNodes,s,i),Qs(t.depsEdgeSelf,e,r,a.self,s,i),Qs(t.depsEdgeExtremities,e,n,o.adjacentEdges,s,i),Qs(t.depsEdgeParallelEdges,e,r,a.parallelEdges,s,i),Qs(t.depsEdgeAllNodes,e,n,o.allEdges,s,i),Qs(t.depsEdgeAllEdges,e,r,a.allEdges,s,i)}createAttributeLayerData(t,e,s,{tag:i,onBeforeUpdate:n,standaloneSelectors:r}){const o=!!r;return{index:-1,id:e,name:t,tag:i||null,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:!1,onBeforeUpdate:n,nodes:{type:"node",name:t,standaloneSelector:o,toUpdate:new ad({graph:s,isNode:!0,includeRemovedElements:!1}),outputFlexArrays:this.nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{type:"edge",name:t,standaloneSelector:o,toUpdate:new ad({graph:s,isNode:!1,includeRemovedElements:!1}),outputFlexArrays:this.edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}}}setAttributeValues(t,e,s,i,n){this._fetch(e).setAttributeValues(t,e,s,i,n)}getAttributeValues(t,e,s,i){return this._fetch(t).getAttributeValues(t,e,s,i)}_fetch(t){return t.isNode?this.nodes:this.edges}},dM=(t,e)=>new _N(t,e),hM=class{constructor(t,{graph:e,dom:s}){this._layerIdCounter=0,this._layers=[],this._destroyedLayers=[],this._layersNeedUpdate=!1,this._updateOngoing=!1,this._needUpdate=!1,this._ogma=t,this._graph=e,this._dom=s,this._emptySubgraph={nodes:t.nodeList(),edges:t.edgeList()},this._textHiddenSet=new ra(this._graph,"textHidden"),this._layerController=new lM(this._graph)}_getLayerById(t){for(let e=0;e<this._layers.length;++e){const s=this._layers[e];if(s.id===t)return s.index=e,s}throw new Error("usage of a destroyed style rule or class")}setDefaultAttributes(t,e){this._layerController.setNodeDefaultAttributes(t),this._layerController.setEdgeDefaultAttributes(e)}getFlexArrays(){return this._layerController.getFlexArrays()}clear(){this._updateOngoing=!1,this._needUpdate=!1,this._destroyedLayers=[],this._layerController.clear(),this.updateAllForAllAttributeLayers()}redrawElements(t){t.size&&(this._layerController.redrawElements(t),this._dom.refresh())}redrawAll(){this._layerController.redrawAll(),this._dom.refresh()}_triggerUpdate(){this._needUpdate=!0,this._dom.refresh()}_reconstructAttributeLayersIfNecessary(){return!!this._layersNeedUpdate&&(this._reconstructAttributeLayers(),this._layersNeedUpdate=!1,this._dom.refresh(),!0)}getAnimationInformation(t){return this._layerController.getAnimationInformation(t)}update(){if(!this._needUpdate||this._updateOngoing||!this._ogma._token)return!1;this._reconstructAttributeLayersIfNecessary(),this._updateOngoing=!0,this._layerController.startUpdate();for(const t of this._destroyedLayers)t.initialized&&this._layerController.notifyDestroyed(t);for(const t of this._layers)this._layerController.prepareUpdate(t),typeof t.onBeforeUpdate=="function"&&t.onBeforeUpdate(t,this,this._layerController),this._layerController.onUpdate(t);return this._layerController.afterLayersUpdate(),this._updateOngoing=!1,this._needUpdate=!1,!0}setAttributeLayerValues(t,e,s,i){const n=this._getLayerById(t),r=e.isNode?n.nodes:n.edges;this._reconstructAttributeLayersIfNecessary(),this._layerController.setAttributeValues(r,e,s,i,n),this._updateElementsForAttributeLayers([n],e)}getAttributeLayerFlexArrays(t){const e=this._getLayerById(t);return{nodes:e.nodes.outputFlexArrays,edges:e.edges.outputFlexArrays}}getUsedAttributeLayerAttributes(t,e){const s=this._getLayerById(t);return this._layerController.getUsedAttributes(s,e)}getUpdatedElements(){return{elementsToRedraw:this._layerController.getAndResetElementsToRedraw(),elementsUpdated:this._layerController.getAndResetElementsUpdated()}}addAttributeLayer(t){const{name:e,layerFactory:s=dM}=t;if(!e)throw new Error("Attribute layer must have a name");if(e&&this._layers.find(n=>n.name===e))throw new Error(`attribute layer with name "${t.name}" already exists`);const i=this._layerController.createAttributeLayerData(e,++this._layerIdCounter,this._graph,t);return this._layers.push(i),this._updateLayer(i,t),s(this,this._layerIdCounter)}_reconstructAttributeLayers(){this._layers.sort((n,r)=>n.priority-r.priority);const{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:s,allEdgeAttributePaths:i}=this._layerController.getCurrentInput();for(const n of this._layers)this._layerController.initializeLayer(n,s,i);for(const n of this._layers){n.nodes.inputFlexArrays=be(t),n.edges.inputFlexArrays=be(e),n.depsNodeSelf=[],n.depsNodeAdjacentNodes=[],n.depsNodeAdjacentEdges=[],n.depsNodeAllNodes=[],n.depsNodeAllEdges=[],n.depsEdgeSelf=[],n.depsEdgeExtremities=[],n.depsEdgeParallelEdges=[],n.depsEdgeAllNodes=[],n.depsEdgeAllEdges=[],n.nodes.toUpdate.addAll(),n.edges.toUpdate.addAll(),this._layerController.connectLayerInputOutput(n,t,e);for(const r of this._layers)this._layerController.setupLayerDependencies(n,r)}this._layerController.setLastOutput(t,e);for(const n of this._layers)n.nodes.needAdjacentElements=n.nodes.redrawAdjacentEdges||n.depsNodeAdjacentNodes.length>0||n.depsNodeAdjacentEdges.length>0,n.edges.needAdjacentElements=n.depsEdgeExtremities.length>0||n.depsEdgeParallelEdges.length>0}_updateLayer(t,{priority:e,fullOverwrite:s,nodeAttributes:i,nodeSelector:n,nodeContext:r,nodeDependencies:o,nodeOutput:a,edgeAttributes:l,edgeSelector:d,edgeContext:h,edgeDependencies:u,edgeOutput:c}={}){i!==void 0&&(t.nodes.attributes=s?i:zl(t.nodes.attributes,i)),n!==void 0&&(t.nodes.selector=n),r!==void 0&&(t.nodes.context=r),o!==void 0&&(t.nodes.dependencies=o),a!==void 0&&(t.nodes.output=a),l!==void 0&&(t.edges.attributes=s?l:zl(t.edges.attributes,l)),d!==void 0&&(t.edges.selector=d),h!==void 0&&(t.edges.context=h),u!==void 0&&(t.edges.dependencies=u),c!==void 0&&(t.edges.output=c),e!==void 0&&(t.priority=e),this._triggerLayerUpdate()}_triggerLayerUpdate(){this._layersNeedUpdate=!0,this._triggerUpdate()}updateAllForAttributeLayer(t){const e=this._getLayerById(t);this._updateAllForAttributeLayer(e)}updateAllForAllAttributeLayers(){for(const t of this._layers)this._updateAllForAttributeLayer(t)}_updateAllForAttributeLayer(t,e=!0,s=!0){if(e&&!t.nodes.toUpdate.isFull()){t.nodes.toUpdate.addAll();for(const i of t.depsNodeSelf)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsNodeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}if(s&&!t.edges.toUpdate.isFull()){t.edges.toUpdate.addAll();for(const i of t.depsEdgeSelf)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeExtremities)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeParallelEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}this._triggerUpdate()}updateElementsForAttributeLayer(t,e){const s=this._getLayerById(t);this._updateElementsForAttributeLayers([s],e)}updateForAllAttributeLayers(t){this._updateElementsForAttributeLayers(this._layers,t)}_updateElementsForAttributeLayers(t,e){let s=this._emptySubgraph;if(e.isNode){for(const i of t)if(!i.nodes.toUpdate.isFull()){i.nodes.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.nodes.toUpdate.add(e);for(const n of i.depsNodeSelf)n.nodes.toUpdate.add(e);for(const n of i.depsNodeAdjacentNodes)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsNodeAdjacentEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsNodeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsNodeAllEdges)this._updateAllForAttributeLayer(n,!1,!0);i.nodes.redrawAdjacentEdges&&this._layerController.redrawElements(s.edges)}}else for(const i of t)if(!i.edges.toUpdate.isFull()){i.edges.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.edges.toUpdate.add(e);for(const n of i.depsEdgeSelf)n.edges.toUpdate.add(e);for(const n of i.depsEdgeExtremities)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsEdgeParallelEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsEdgeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsEdgeAllEdges)this._updateAllForAttributeLayer(n,!1,!0)}this._triggerUpdate()}destroyAttributeLayer(t){const e=this._getLayerById(t);this._destroyedLayers.push(e),this._layers.splice(e.index,1),this._triggerLayerUpdate()}updateAttributeLayer(t,e){const s=this._getLayerById(t);this._updateLayer(s,e)}getAttributeLayerDefinition(t){const e=this._getLayerById(t),{priority:s,nodes:i,edges:n}=e;return{priority:s,nodeAttributes:i.attributes,nodeSelector:i.selector,nodeContext:i.context,nodeDependencies:i.dependencies,nodeOutput:i.output,edgeAttributes:n.attributes,edgeSelector:n.selector,edgeContext:n.context,edgeDependencies:n.dependencies,edgeOutput:n.output}}getAttributeValues(t,e,s,i){return this.update(),this._layerController.getAttributeValues(t,e,s,i)}setAnimationAttributes(t,e){return this._layerController.setAnimationAttributes(t,e)}resetAnimationAttributes(t){return this._layerController.resetAnimationAttributes(t)}setTextHidden(t,e){const s=this._textHiddenSet.addOrRemoveElements(t,e);this.redrawElements(s)}resetTextHidden(){const{nodes:t,edges:e}=this._textHiddenSet.getElements();this._textHiddenSet.clear(),this._layerController.redrawElements(t),this._layerController.redrawElements(e)}getUsedNodeAttributes(){return this._layerController.nodes.getUsedAttributes()}getUsedEdgeAttributes(){return this._layerController.edges.getUsedAttributes()}interpolateAttributes(t){const e=Xe(),s=this._ogma.modules.graphics.getAttributesManager(),i=this._layerController,n=t.isNode?s.getUsedNodeAttributes():s.getUsedEdgeAttributes(),{animationDuration:r,animationEasing:o,animationStart:a}=i.getFlexArrays().nodes.current,l=r.getMultiple(t._indexes),d=o.getMultiple(t._indexes),h=a.getMultiple(t._indexes),u=[];for(let c=0;c<t.size;c++){const g={};n.forEach(m=>{const f=typeof m=="string"?m:m.join("."),p=ye(i.getFlexArrays().nodes.previous,m),_=ye(i.getFlexArrays().nodes.current,m);if(!_)return;const y=Gb(e,h[c],l[c],d[c]);isNaN(y)?g[f]=_.get(t._indexes[c]):f.match(/color/gi)?g[f]=io(p.get(t._indexes[c]),_.get(t._indexes[c]),y,y):g[f]=ne(p.get(t._indexes[c]),_.get(t._indexes[c]),y)}),u.push(g)}return u}},uM=1e-12;function ip(t){return((t=Math.exp(t))+1/t)/2}function cM(t){return((t=Math.exp(t))-1/t)/2}function gM(t){return((t=Math.exp(2*t))-1)/(t+1)}var mM=function t(e,s,i){function n(r,o){var a,l,d=r[0],h=r[1],u=r[2],c=o[0],g=o[1],m=o[2],f=c-d,p=g-h,_=f*f+p*p;if(_<uM)l=Math.log(m/u)/e,a=function(E){return[d+E*f,h+E*p,u*Math.exp(e*E*l)]};else{var y=Math.sqrt(_),x=(m*m-u*u+i*_)/(2*u*s*y),b=(m*m-u*u-i*_)/(2*m*s*y),v=Math.log(Math.sqrt(x*x+1)-x),A=Math.log(Math.sqrt(b*b+1)-b);l=(A-v)/e,a=function(E){var S=E*l,w=ip(v),T=u/(s*y)*(w*gM(e*S+v)-cM(v));return[d+T*f,h+T*p,u*w/ip(e*S+v)]}}return a.duration=1e3*l*e/Math.SQRT2,a}return n.rho=function(r){var o=Math.max(.001,+r),a=o*o;return t(o,a,a*a)},n}(Math.SQRT2,2,4),fM="cubicOut",pM=({graphWidth:t,graphHeight:e,viewWidth:s,viewHeight:i})=>.2*Math.min(s/t,i/e),_M=({smallestNodeSize:t,viewWidth:e,viewHeight:s})=>t===1/0?1/0:Math.min(e,s)/t*.5;function yM(t,e,s){return e===void 0?xM(t):e==="alt"?t.altKey:e==="shift"?t.shiftKey:e==="space"?s.isPressed("space"):void 0}function xM(t){return!t.altKey&&(FE?t.metaKey:t.ctrlKey)&&!t.shiftKey}var Uu=Math.SQRT2,np=.15,bM=class extends Ot{constructor(t,e){super(t),this._zooming=!1,this.debug=!1,this._smoothZoom=No((s,i,n)=>{const r=this._modules.settings,o=r.get("interactions.zoom.duration"),a=r.get("interactions.zoom.easing"),l=this._modules.camera.getZoom(),d={duration:o,easing:a};this._zooming||(this._zooming=!0,this._updateVisibility("zoom",!0));const h=r.get("interactions.zoom.speed")||np;let u=Z2(s,h);s<0&&u!==0&&(u=1/u);const c=l*u;this._modules.camera.setZoom(c,d,{x:i,y:n}).then(()=>{this._zooming&&(this._zooming=!1,this._updateVisibility("zoom",!1))})},Hy),this.debug=e}onMounted(){const t=this._modules.settings;t.register("interactions.zoom.enabled",!0),t.register("interactions.zoom.onDoubleClick",!1),t.register("interactions.zoom.duration",150),t.register("interactions.zoom.modifier",Uu),t.register("interactions.zoom.speed",np),t.register("interactions.zoom.easing",fM),t.register("interactions.zoom.minValue",this.debug?null:pM),t.register("interactions.zoom.maxValue",this.debug?null:_M),t.register("interactions.zoom.hideNodes",!1),t.register("interactions.zoom.hideEdges",!1),t.register("interactions.zoom.hideNodeTexts",!1),t.register("interactions.zoom.hideEdgeTexts",!1),t.register("interactions.zoom.scrollToPan",!1),t.register("interactions.zoom.metaKey",void 0),t.register("interactions.pan.enabled",!0),t.register("interactions.pan.hideNodes",!1),t.register("interactions.pan.hideEdges",!1),t.register("interactions.pan.hideNodeTexts",!1),t.register("interactions.pan.hideEdgeTexts",!1),t.register("interactions.rotation.enabled",!0),t.register("interactions.rotation.hideNodes",!1),t.register("interactions.rotation.hideEdges",!1),t.register("interactions.rotation.hideNodeTexts",!1),t.register("interactions.rotation.hideEdgeTexts",!1),t.register("interactions.gesture.enabled",!0),t.register("interactions.gesture.hideNodes",!1),t.register("interactions.gesture.hideEdges",!1),t.register("interactions.gesture.hideNodeTexts",!1),t.register("interactions.gesture.hideEdgeTexts",!1),this._setupInteractions()}_setupInteractions(){this._modules.interactions.onMouseWheel({priority:"zoom",check:()=>!!this._modules.settings.get("interactions.zoom.enabled"),handler:({x:t,y:e,delta:s,dx:i,dy:n,domEvent:r})=>{const o=i%1!=0||n%1!=0,a=this._modules.settings;!a.get("interactions.zoom.scrollToPan")||yM(r,a.get("interactions.zoom.metaKey"),this._modules.keyboard)||o?this._smoothZoom(s,t,e):this._modules.camera.move({x:i,y:n})}}),this._modules.interactions.onDoubleClick({priority:"zoom",check:()=>{const t=this._modules.settings.get("interactions.zoom.enabled"),e=this._modules.settings.get("interactions.zoom.onDoubleClick");return!(!t||!e)},handler:({x:t,y:e})=>this._smoothZoom(1,t,e)}),this._modules.interactions.onDrag({priority:"panning",disableDetection:!0,check:({button:t})=>{const e=!!this._modules.settings.get("interactions.pan.enabled");return t==="left"&&e},onStart:()=>this._updateVisibility("pan",!0),onProgress:({dx:t,dy:e})=>this._modules.camera.move({x:-t,y:-e}),onStop:()=>this._updateVisibility("pan",!1)}),this._modules.interactions.onDrag({priority:"rotation",disableDetection:!0,check:({button:t,domEvent:e})=>(t==="right"||e&&e.buttons===2)&&!!this._modules.settings.get("interactions.rotation.enabled"),onStart:({x:t,y:e})=>{this._rotationStart={x:t,y:e},this._updateVisibility("rotation",!0)},onProgress:({x:t,y:e})=>this._rotate({x:t,y:e}),onStop:()=>this._updateVisibility("rotation",!1)}),this._modules.interactions.onGesture({priority:"gesture",disableDetection:!0,check:()=>!!this._modules.settings.get("interactions.gesture.enabled"),onStart:()=>this._updateVisibility("gesture",!0),onProgress:({dx:t,dy:e,rotation:s,scale:i,x:n,y:r})=>{this._modules.settings.get("interactions.rotation.enabled")&&this._modules.camera.rotate(-s),this._modules.camera.zoomIn({modifier:i},{x:n,y:r}),this._modules.camera.move({x:-t,y:-e})},onStop:()=>this._updateVisibility("gesture",!0)})}_rotate({x:t,y:e}){const{width:s,height:i}=this._modules.camera.getSize(),n=s/2,r=i/2,o=this._rotationStart.x-n,a=this._rotationStart.y-r,l=t-n,d=e-r,h=Math.atan2(a,o)-Math.atan2(d,l);this._rotationStart.x=t,this._rotationStart.y=e,this._modules.camera.rotate(h)}_updateVisibility(t,e){const s=!e,i=this._modules.settings,n=i.get(`interactions.${t}.hideNodes`),r=i.get(`interactions.${t}.hideEdges`),o=i.get(`interactions.${t}.hideNodeTexts`),a=i.get(`interactions.${t}.hideEdgeTexts`);n&&this._modules.graphics.setNodesVisibility(s),o&&this._modules.graphics.setNodeTextsVisibility(s),r&&this._modules.graphics.setEdgesVisibility(s),a&&this._modules.graphics.setEdgeTextsVisibility(s)}},rp=1e-8,op=1e8,vh={duration:0,startAfter:0,ignoreZoomLimits:!1,callback:Xt,easing:"quadraticOut"};function $a(t){return Math.abs(t)<1e-9}var vM=80,AM=class Gv extends Ot{constructor(){super(...arguments),this._minZoom=rp,this._maxZoom=op,this._timeout=0,this._cornerCosSin=new Float32Array([0,0,0,0,0,0,0,0])}onMounted(){this._reset(),this._modules.settings.register("minZoom",rp,e=>{this._minZoom=e,this._zoom<e&&(this._zoom=e,this._modules.events.fire("move"))}),this._modules.settings.register("maxZoom",op,e=>{this._maxZoom=e,this._zoom>e&&(this._zoom=e,this._modules.events.fire("move"))}),this._modules.events.on("setContainer",()=>{this._reset(),this._modules.events.fire("move")}).on("resize",()=>{this._reloadDimensions(),this._modules.events.fire("move")})}get x(){return this._x}get y(){return this._y}get zoom(){return this._zoom}get angle(){return this._angle}get width(){return this._dimensions.width}get height(){return this._dimensions.height}moveEnd(e){this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>{this._modules.events.fire("viewChanged",{type:e})},vM)}getSize(){return{width:this._dimensions.width,height:this._dimensions.height}}getCenter(){return{x:this._x,y:this._y}}setCenter({x:e,y:s},i){const n=this._x,r=this._y,o=e-this._x,a=s-this._y;return $a(o)&&$a(a)?Promise.resolve():new Promise(l=>{this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const d=this._modules.animations.play(h=>{this._x=n+o*h,this._y=r+a*h,this._modules.events.fire("move").fire("pan")},{...vh,...i,callback:()=>this.moveEnd("pan"),resolve:l});d&&(this._moveAnimation=d)})}move({x:e,y:s},i){const n=ap({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle);return this.setCenter({x:this._x+n.x,y:this._y+n.y},i)}getZoom(){return this._zoom}setZoom(e,s,i={x:void 0,y:void 0}){const{x:n,y:r}=i;let o=Is(e,this._minZoom,this._maxZoom);return s&&s.ignoreZoomLimits||(o=this._applyZoomLimits(o)),$a(this._zoom-o)?Promise.resolve():new Promise(a=>{const l={...vh,...s,callback:()=>this.moveEnd("zoom"),resolve:a},d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._zoom,c=d/u-d/o;if(n!==void 0&&r!==void 0){const m=(n-d)/u-(n-d)/o,f=(r-h)/u-(r-h)/o,p=this._cosAngle,_=this._sinAngle,y=p*m-_*f,x=_*m+p*f;this.setCenter({x:this._x+y,y:this._y+x},s)}this._zoomAnimation&&this._modules.animations.cancel(this._zoomAnimation),this._modules.dom.afterNextFrame().then(()=>{this._modules.events.fire("zoomStart",{duration:l.duration,easing:l.easing,startZoom:u,endZoom:o})});const g=this._modules.animations.play(m=>{this._zoom=d/(d/u-c*m),this._modules.events.fire("move").fire("zoom")},l);g&&(this._zoomAnimation=g)})}_applyZoomLimits(e){const s=this._modules.settings.get("interactions.zoom.minValue"),i=this._modules.settings.get("interactions.zoom.maxValue"),{minScaledSize:n,maxScaledSize:r,width:o,height:a,cx:l}=this._modules.locate.getGraphBoundingBox(),d=this._zoom,h=this.getSize();let u=e;if(!isNaN(l)){const c={smallestNodeSize:n,biggestNodeSize:r,graphWidth:o+r,graphHeight:a+r,viewWidth:h.width,viewHeight:h.height},g=s&&s(c),m=i&&i(c);lp(g)&&u<g?u<d&&(u=Math.min(d,g)):lp(m)&&u>m&&u>d&&(u=Math.max(d,m))}return u}zoomIn(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||Uu:e.modifier,this.setZoom(this._zoom*i,e,s)}moveToBounds(e,s={}){const i=this._modules.locate.computeConfigForBounds(e,{ignoreZoomLimits:!0});return this.moveTo(i,s)}moveTo(e,s={}){const i=this.getZoom(),n=this.getCenter(),r=e.zoom||this._zoom;return s.duration===0?this.setView(e):new Promise(o=>{const a=Math.min(this.width,this.height),l=mM([n.x,n.y,a/i],[e.x,e.y,a/r]),d=l.duration,h=s.duration||d;this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const u=this._modules.animations.play(c=>{const[g,m,f]=l(c);this._x=g,this._y=m,this._zoom=a/f,this._modules.events.fire("move"),this._modules.events.fire("pan")},{duration:h,easing:s.easing,callback:()=>this.moveEnd("pan"),resolve:o});u&&(this._moveAnimation=u)})}zoomOut(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||Uu:e.modifier,this.setZoom(this._zoom/i,e,s)}getAngle(){return this._angle}setAngle(e,s){const i=this._angle,n=e-i;return $a(n)?Promise.resolve():new Promise(r=>{this._rotateAnimation&&this._modules.animations.cancel(this._rotateAnimation);const o=this._modules.animations.play(a=>{for(this._angle=i+n*a,this.calculateBoxCornerAngles();this._angle>Math.PI;)this._angle-=2*Math.PI;for(;this._angle<-Math.PI;)this._angle+=2*Math.PI;this._sinAngle=Math.sin(this._angle),this._cosAngle=Math.cos(this._angle),this._modules.events.fire("move").fire("rotate")},{...vh,...s,callback:()=>this.moveEnd("rotate"),resolve:r});o&&(this._rotateAnimation=o)})}rotate(e,s){return this.setAngle(this._angle+e,s)}getScreenCenter(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}}graphToScreenCoordinates({x:e,y:s},i={x:0,y:0}){const n=this._dimensions.width/2,r=this._dimensions.height/2;return $l((e-this._x)*this._zoom+n,(s-this._y)*this._zoom+r,n,r,-this._angle,i)}screenToGraphCoordinates({x:e,y:s},i={x:0,y:0}){return $l(this._x+(e-this._dimensions.width/2)/this._zoom,this._y+(s-this._dimensions.height/2)/this._zoom,this._x,this._y,this._angle,i)}projectBounds(e,s=e){const i=e[0],n=e[1],r=e[2],o=e[3],a=this._x,l=this._y,d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._sinAngle,c=this._cosAngle,g=1/this._zoom;let m=1/0,f=1/0,p=-1/0,_=-1/0;const y=[i,n,i,o,r,o,r,n];for(let x=0;x<y.length;x+=2){let b=y[x],v=y[x+1];b=a+(b-d)*g,v=l+(v-h)*g;const A=b-a,E=v-l;b=c*A-u*E+a,v=u*A+c*E+l,b<m&&(m=b),b>p&&(p=b),v<f&&(f=v),v>_&&(_=v)}return s[0]=m,s[1]=f,s[2]=p,s[3]=_,s}screenToGraphVector({x:e,y:s}){return ap({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle)}getView(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}}setView(e,s){const{x:i,y:n,zoom:r,angle:o}={x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,...e};return Promise.all([this.setCenter({x:i,y:n},s),this.setZoom(r,s),this.setAngle(o,s)]).then(Xt)}_reloadDimensions(){this._dimensions=this._modules.dom.getDimensions()}animationInProgress(){const e=this._moveAnimation,s=this._zoomAnimation,i=this._rotateAnimation;return!!(e&&!e.done||s&&!s.done||i&&!i.done)}getProjectedScreenBounds(e=0){const{width:s,height:i}=this._dimensions,n=Math.max(s,i)*e;return this.projectBounds([0-n,0-n,s+n,i+n])}calculateBoxCornerAngles(){const e=this._angle;this._cornerCosSin[0]=Math.cos(e+Math.PI/4),this._cornerCosSin[1]=Math.sin(e+Math.PI/4),this._cornerCosSin[2]=Math.cos(e+3*Math.PI/4),this._cornerCosSin[3]=Math.sin(e+3*Math.PI/4),this._cornerCosSin[4]=Math.cos(e-3*Math.PI/4),this._cornerCosSin[5]=Math.sin(e-3*Math.PI/4),this._cornerCosSin[6]=Math.cos(e-Math.PI/4),this._cornerCosSin[7]=Math.sin(e-Math.PI/4)}getCornerCos(e){return this._cornerCosSin[2*e]}getCornerSin(e){return this._cornerCosSin[2*e+1]}_reset(){this._zoom=1,this._x=0,this._y=0,this._angle=0,this.calculateBoxCornerAngles(),this._sinAngle=0,this._cosAngle=1,this._dimensions=this._modules.dom.getDimensions()}clone(e){const s=new Gv(this._ogma);return s._zoom=e.zoom||this._zoom,s._x=e.x||this._x,s._y=e.y||this._y,s._angle=e.angle||this._angle,s._sinAngle=Math.sin(s._angle),s._cosAngle=Math.cos(s._angle),s.calculateBoxCornerAngles(),s._dimensions={width:e.width||this._dimensions.width,height:e.height||this._dimensions.height},s}};function ap({x:t,y:e},s,i,n){return{x:n*(t/=s)-i*(e/=s),y:i*t+n*e}}function lp(t){return typeof t=="number"&&isFinite(t)}function EM(t){const e=t.filter(s=>isFinite(s)&&s>0);return e.length?mi(e):1}var SM="anonymous",wM="white",TM="default",IM={maxBlockId:1024,maxCoord:-1/0,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1,maxSymbolicSize:0,maxPatternScale:0},LM=xd?"webgl":null,dp=5,CM=class extends Ot{constructor(){super(...arguments),this._debug=!1,this._initDone=!1,this._boundaries={maxSize:10,maxMinVisibleSize:64},this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0},this._nextAnimationId=1,this._animations=[],this._rendererState={type:null,code:null,state:"ok",message:""},this._cursorStyle=[],this._fontsNewlyLoaded=[],this._nextGeIndex=1,this._availableGeIndexes=[],this._renderOnNewFrame=!0,this._isBufferDisplayable=t=>{const e=xL(t),s=Zb(t),i=e?this._visibility.nodes:this._visibility.edges,n=e?this._visibility.nodeTexts:this._visibility.edgeTexts;return i===0&&(!s||n===0)},this._onRendererChange=t=>{this._updateRendererState({type:t,state:"requested",code:null,message:void 0}),this._engine.setRenderType(t),this._modules.dom.refresh()},this._onNewFrame=()=>{this._processAnimations(),this._loadGraphInGraphicsEngine(),this._renderOnNewFrame&&this._render()},this._applyCursorStyle=()=>{const t=this._cursorStyle[this._cursorStyle.length-1]||this._modules.settings.get("cursor.default");Vl(this._domWrapper,t)},this._updateImageCrossOrigin=()=>{this._imageManager.setImgCrossOrigin(this._modules.settings.get("imgCrossOrigin")||null)}}onMounted(){this._debug=this._ogma.isDebug(),this._renderOnNewFrame=!0,this._formatText=Rb().applyArabicShaping,this._attributesManager=new hM(this._ogma,this._modules),this._imageManager=new QC,this._fontManager=new uL,this._engine=new mh(mh.getCachedInitData()),this._domWrapper=this._engine.getDomWrapper(),this._engine.on("error",this._onNewFrame),this._nodeAnimationMap=new Map,this._edgeAnimationMap=new Map,this._movingNodes=new Set,this._movingEdges=new Set,this._modules.events.register(["reloadFonts","rendererStateChange","beforeUpdateAttributes","updateAttributes","animate","move","pan","zoom","rotate","viewExportStart","viewExportEnd","afterImageExport","viewChanged","zoomStart"]),this._modules.settings.register("renderer",LM,this._onRendererChange),this._modules.settings.register("edgeTipRatio",lb,t=>{this._engine.setEdgeArrowSizeRatio(t),this._modules.dom.refresh()}),this._modules.settings.register("nodeCornerRadius",0,t=>{WC(this._engine,t),this._modules.dom.refresh()}),this._modules.settings.register("edgeMinTipSize",db,t=>{this._engine.setEdgeMinTipSize(t),this._modules.dom.refresh()}),this._modules.settings.register("backgroundColor",wM,t=>{this._engine.parseColor(t)?this._modules.dom.refresh():(Vi(`Invalid background color "${t}" specified; will default to black.`),this._modules.settings.set("backgroundColor","black"))}),this._modules.settings.register("texts.hideUntilFontsLoaded",!0,t=>{this._fontManager.setHideUntilFontsLoaded(!!t)}),this._modules.settings.register("texts.cornerRadius",dp,t=>{this._engine.getTextManager().setCornerRadius(typeof t=="number"?t:dp),this._modules.dom.refresh()}),this._modules.settings.register("imgCrossOrigin",SM,this._updateImageCrossOrigin),this._modules.settings.register("cursor.default",TM,this._applyCursorStyle),this._modules.dom.setLayer("graphics",this._domWrapper),this._engine.setGlobalBoundaries(IM),this._modules.dom.beforeNextFrame().then(()=>{this._initDone=!0,this._fireRendererStateChangeEvent()}),this._imageManager.onFetch(()=>{this._engine.notifyPatternUpdate(),this._modules.dom.refresh()}),this._fontManager.onFontLoaded(t=>{this._fontsNewlyLoaded.push(t),this._engine.notifyPatternUpdate(),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}),this._modules.dom.addMediaListener("(min-resolution: 2dppx)",()=>this._modules.dom.refresh()),this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${du})`,tag:du,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${hu})`,tag:hu,nodeDependencies:void 0,edgeDependencies:void 0}),$f(this._engine,this._attributesManager.getFlexArrays()),this._modules.events.on("move",()=>this._modules.dom.refresh()).on("frame",this._onNewFrame).on("viewExportStart",()=>{this._renderOnNewFrame=!1}).on("viewExportEnd",()=>{this._renderOnNewFrame=!0}).on("clearGraph",()=>{this._nextGeIndex=1,this._availableGeIndexes=[],this._engine.clear(),this._attributesManager.clear(),this._modules.dom.refresh(),this._animations=[],this._nodeAnimationMap.clear(),this._edgeAnimationMap.clear()}).on("viewChanged",({type:t})=>{if(t==="rotate"){const e=this._modules.graph.getEdges().filter(s=>s.getAttribute("adjustAnchors"));this._attributesManager.redrawElements(e)}}).on("addNodes",t=>{this._attributesManager.updateForAllAttributeLayers(t.nodes)}).on("addEdges",t=>{this._attributesManager.updateForAllAttributeLayers(t.edges)}).on("excludedStateChange",t=>{this._visibleAttributeLayer.updateElements(t.elements)}).on("setData",t=>{this._dataAttributeLayer.updateElements(t.elements)}),mh.clearCachedInitData(),this._modules.dom.addWindowEventListener("unload",()=>this.destroy())}onReady(t){t.renderer!==void 0&&this._ogma.setOptions({renderer:t.renderer}),t.imgCrossOrigin!==void 0&&this._ogma.setOptions({imgCrossOrigin:t.imgCrossOrigin})}getTransparentBackgroundColor(){const t=this._modules.settings.get("backgroundColor");return t?this._engine.transparentify(t):null}pauseRendering(){this._renderOnNewFrame=!1}resumeRendering(){this._renderOnNewFrame=!0}_render(){const t=this._modules.dom.getDimensions(),e=this._modules.camera.getView(),s=gs(),i=Xe(),n=this._modules.settings.get("backgroundColor"),r=this._isBufferDisplayable;this._engine.setView({x:e.x,y:e.y,zoom:e.zoom,angle:e.angle,width:t.width,height:t.height,pixelRatio:s,currentTime:i,backgroundColor:n,isBufferDisplayable:r});try{this._engine.render(),this._rendererState.state==="requested"&&this._updateRendererState({state:"ok"})}catch(o){if(this._debug)throw o;const{message:a,code:l="OTHER"}=o,d=this._rendererState.type,h=cI(d);let u=this._rendererState.state==="requested"?`Error while initializing the ${h} renderer`:`The ${h} renderer encountered an unexpected runtime error`,c=null;d==="webgl"&&(u+="; fallbacking on canvas renderer",c="canvas"),Vi(a||""),Vi(u),this._updateRendererState({state:"error",code:l,message:a}),this._modules.settings.set("renderer",c)}}_fireRendererStateChangeEvent(){const t=this._rendererState;this._modules.events.fire("rendererStateChange",{type:t.type,state:t.state,code:t.code,message:t.message})}_updateRendererState({type:t,state:e,code:s,message:i}){let n=!1;t!==void 0&&this._rendererState.type!==t&&(this._rendererState.type=t,n=!0),e!==void 0&&this._rendererState.state!==e&&(this._rendererState.state=e,n=!0),s!==void 0&&this._rendererState.code!==s&&(this._rendererState.code=s,n=!0),i!==void 0&&this._rendererState.message!==i&&(this._rendererState.message=i,n=!0),n&&this._initDone&&this._fireRendererStateChangeEvent()}getImageData(){return this._modules.dom.afterNextFrame().then(()=>this._engine.getImageData())}getNodeAttributes(){return this._attributesManager.getFlexArrays().nodes.current}getEdgeAttributes(){return this._attributesManager.getFlexArrays().edges.current}getGraphicsEngine(){return this._engine}getImageManager(){return this._imageManager}getFontManager(){return this._fontManager}allocateGraphicsEngineBlockId(){return this._availableGeIndexes.length?this._availableGeIndexes.pop():this._nextGeIndex++*Rd+I2}releaseGraphicsEngineBlockId(t){this._engine.freeBlock(t),this._availableGeIndexes.push(t),this._modules.dom.refresh()}addCursorStyle(t){t&&(this._cursorStyle.push(t),this._applyCursorStyle())}removeCursorStyle(t){if(!t)return;const e=this._cursorStyle.lastIndexOf(t);e!==-1&&(this._cursorStyle.splice(e,1),this._applyCursorStyle())}reloadFonts(){this._modules.events.fire("reloadFonts"),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}getDomElement(){return this._domWrapper}setTextHidden(t,e){this._attributesManager.setTextHidden(t,e)}resetTextHidden(){this._attributesManager.resetTextHidden(),this._modules.dom.refresh()}getAttributesManager(){return this._attributesManager}_checkFontsNewlyLoaded(){return!!this._fontsNewlyLoaded.length&&(this._fontsNewlyLoaded=[],!0)}_loadGraphInGraphicsEngine(){this._attributesManager.update(),this._checkFontsNewlyLoaded()&&this._attributesManager.redrawAll(),this._modules.events.fire("beforeUpdateAttributes");const{elementsToRedraw:t,elementsUpdated:e}=this._attributesManager.getUpdatedElements(),s=e.nodes.size>0||e.edges.size>0;(e.nodeAttributesSet.has("radius")||e.edgeAttributes.includes("width"))&&(this._boundaries.maxSize=uI(this._modules.graph)),(e.nodeAttributesSet.has("shape")||e.edgeAttributes.includes("shape.head")||e.edgeAttributes.includes("shape.tail"))&&$f(this._engine,this._attributesManager.getFlexArrays()),UC({graph:this._modules.graph,elements:t,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._modules.camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText}),s&&this._modules.events.fire("updateAttributes",e)}_forceCompleteGraphRefresh(){this._attributesManager.redrawAll(),this._loadGraphInGraphicsEngine()}export(t,e,s,i){let n;return Promise.all([this._modules.graph.getNodes().addClass(fn),this._modules.graph.getEdges().addClass(fn)]).then(()=>this.resolveAtNextFrame()).then(()=>this._imageManager.whenReady()).then(()=>{s==="all"?(n=RM(this._modules.graph),this._forceCompleteGraphRefresh()):this._loadGraphInGraphicsEngine();const r=this._modules.camera.clone({...e});return this._modules.events.fire("viewExportStart",{preventOverlap:i.preventOverlap,camera:r,view:r.getView()}),this._ogma.view.afterNextFrame().then(()=>this._engine.export(t,e,i))}).then(r=>Promise.all([this._modules.graph.getNodes().removeClass(fn),this._modules.graph.getEdges().removeClass(fn)]).then(()=>r)).then(r=>(s==="all"&&(FM(n),this._forceCompleteGraphRefresh()),this._modules.events.fire("viewExportEnd"),r))}addAttributeLayer(t){return this._attributesManager.addAttributeLayer(t)}getAttributeValues(t,e,s,i){return this._attributesManager.getAttributeValues(t,e,s,i)}forceAttributesComputation(){this._attributesManager.update()}resolveAtNextFrame(t){return this._modules.dom.afterNextFrame().then(()=>t)}isMoving(t){return(t.isNode?this._movingNodes:this._movingEdges).has(t._index)}animate(t,e,s,i){const n=NM(i);return n.duration&&this._engine.ensureAnimationsReady(),this._animate(t,e,s,n)}isAnimating(){return this._animations.length>0}getAnimationInformation(t){return this._attributesManager.getAnimationInformation(t)}_toSubGraph(t){if(t instanceof Ei||t instanceof Vs)return{nodes:t.toList(),edges:t.getAdjacentEdges()};if(t instanceof Mn||t instanceof Yi)return{nodes:this._modules.graph.nodeList(),edges:t.toList()};const e=t,s={nodes:e.nodes||this._modules.graph.nodeList(),edges:e.edges||this._modules.graph.edgeList()};return s.nodes.size&&(s.edges.size?s.edges=s.edges.concat(s.nodes.getAdjacentEdges()).dedupe():s.edges=s.nodes.getAdjacentEdges()),s}_animate(t,e,s,{duration:i,easing:n}){if((!this._animations.length||s)&&!i)return e(t),Promise.resolve(t);const r=this._toSubGraph(t),o=r.nodes,a=r.edges;if(o.size===0&&a.size===0)return e(t),Promise.resolve(t);if(o.size){if(s)for(let c=0;c<o._indexes.length;c++)this._movingNodes.add(o._indexes[c]);this._modules.events.fire("animate",{elements:o,duration:i,updatesPositions:s,easing:n})}if(a.size){if(s)for(let c=0;c<a._indexes.length;c++)this._movingEdges.add(a._indexes[c]);this._modules.events.fire("animate",{elements:a,duration:i,updatesPositions:s,easing:n})}const l={id:this._nextAnimationId++,startTime:Xe(),finished:!1,func:()=>e(t),duration:i,easing:n,nodes:o,edges:a,started:!1,updatesPositions:s,resolve:Xt};let d=l;const h=new Set;if(d=this._getLongestAnimation(d,l.nodes,h),d=this._getLongestAnimation(d,l.edges,h),d.updatesPositions){for(let c=0;c<o._indexes.length;c++)this._nodeAnimationMap.set(o._indexes[c],d);for(let c=0;c<a._indexes.length;c++)this._edgeAnimationMap.set(a._indexes[c],d);l.duration=d.duration,l.startTime=d.startTime}if(l.duration===0&&d.id===l.id)return e(t),Promise.resolve(t);const u=new Promise(c=>l.resolve=()=>c(t));return this._animations.push(l),this._modules.dom.refresh(),i||this._processAnimations(),u}_removeFinishedAnimations(){this._animations=this._animations.filter(t=>!t.finished)}_getAnimationElements(t){return{nodes:t.nodes,edges:t.edges}}_resetAnimationAttributes({nodes:t,edges:e}){this._attributesManager.resetAnimationAttributes({nodes:t,edges:e});for(let s=0;s<t._indexes.length;s++)this._nodeAnimationMap.delete(t._indexes[s]),this._movingNodes.delete(t._indexes[s]);for(let s=0;s<e._indexes.length;s++)this._edgeAnimationMap.delete(e._indexes[s]),this._movingEdges.delete(t._indexes[s])}_getLongestAnimation(t,e,s){const i=e.isNode?this._nodeAnimationMap:this._edgeAnimationMap;for(let n=0;n<e._indexes.length;n++){const r=i.get(e._indexes[n]);r&&!s.has(r.id)&&(s.add(r.id),(t.updatesPositions||!r.updatesPositions)&&r.duration+r.startTime<t.duration+t.startTime||(t=r))}return t}_processAnimations(){if(!this._animations.length)return;const t=Xe(),e=[];this._attributesManager.update();for(const s of this._animations)s.started||(s.started=!0,e.push(s.func),this._attributesManager.setAnimationAttributes(this._getAnimationElements(s),s));for(const s of e)s();for(const s of this._animations)t>=s.startTime+s.duration&&(this._resetAnimationAttributes(this._getAnimationElements(s)),s.resolve(s.elements),s.finished=!0);this._removeFinishedAnimations(),this._animations.length&&this._modules.dom.refresh()}hideTexts(){this.setNodeTextsVisibility(!1),this.setEdgeTextsVisibility(!1)}showTexts(){this.setNodeTextsVisibility(!0),this.setEdgeTextsVisibility(!0)}setNodesVisibility(t){return this._updateVisibilityCounter("nodes",t)}setNodeTextsVisibility(t){return this._updateVisibilityCounter("nodeTexts",t)}setEdgesVisibility(t){return this._updateVisibilityCounter("edges",t)}setEdgeTextsVisibility(t){return this._updateVisibilityCounter("edgeTexts",t)}_updateVisibilityCounter(t,e){this._visibility[t]+=e?-1:1,this._modules.dom.refresh()}detectNode(t,e,s,i,n,r){return dI(t,e,s,i,n,r,this._modules.graph,this._attributesManager,this._modules.camera,this._engine,this._movingNodes,this._formatText)}detectEdge(t,e,s,i,n){const{bentEnable:r,bentVertical:o}=this._modules.graphics.getGraphicsEngine().getBentEdges();return hI(t,e,s,i,n,this._modules.graph,this._modules.camera,this._movingNodes,this._attributesManager,r,o)}getVisibilityCounters(){return this._visibility}destroy(){this.getGraphicsEngine().destroy(),this.getImageManager().destroy(),this.getFontManager().destroy()}};function NM(t){return typeof t=="number"?t={duration:t}:typeof t=="object"&&t!==null||(t={duration:0}),{duration:MM(t.duration),easing:t.easing||"linear",chain:!!t.chain}}function MM(t){return typeof t!="number"||!isFinite(t)||t<0?0:t}function hp(t,e){const s=e?t.getNodeAttribute("excluded"):t.getEdgeAttribute("excluded"),i=(e?t.getNodes("all"):t.getEdges("all"))._indexes,n=s.getMultiple(i);return s.fill(i,0),{excludedList:s,indexes:i,values:n}}function up({excludedList:t,indexes:e,values:s}){t.setMultiple(e,s)}function RM(t){return{nodes:hp(t,!0),edges:hp(t,!1)}}function FM({nodes:t,edges:e}){up(t),up(e)}var PM=180,zM=50,DM=class extends Ot{constructor(){super(...arguments),this._onAnyEvents=[],this._registeredEvents={},this.onIdle=No(()=>this.fire("idle"),zM),this.fireIdle=gy(this.onIdle,PM)}onMounted(){this._registeredEvents={},this.register(["idle"]),this._ogma.onReady(()=>{this.on(["viewChanged","layoutEnd","addNodes","addEdges","removeNodes","removeEdges","animate","setMultipleAttributes","transformationRefresh"],this.fireIdle)})}isRegistered(t){return!!this._registeredEvents[t]}register(t,e=[]){t.forEach(s=>{this._registeredEvents[s]||(this._registeredEvents[s]=new OM(!1,s))})}onAnyEvent(t){this._onAnyEvents.push(t)}on(t,e){return Array.isArray(t)?(t.forEach(s=>this.on(s,e)),this):this._registeredEvents[t]?(this._registeredEvents[t].on(e),this):this}off(t){return Object.values(this._registeredEvents).forEach(e=>{e.off(t)}),this}fire(t,e=null){const s=this._getEvent(t);return this._onAnyEvents.forEach(i=>i(e,t)),s.trigger(e),this}once(t,e){const s=this,i=function(){e.apply(null,arguments),s.off(i)};return this.on(t,i)}_getEvent(t){if(!(t in this._registeredEvents))throw new Error(`Event ${t} does not exist`);return this._registeredEvents[t]}destroy(){Object.values(this._registeredEvents).forEach(t=>{t.destroy()})}},OM=class{constructor(t,e){this._subscribers=[],this._handlers=[],this._reverseOrder=t,this._name=e}trigger(t){for(const e of this._handlers)e(t,this._name);return this}on(t){if(typeof t!="function")throw new Error("handler is not a function");const e=this._reverseOrder?0:this._subscribers.length;return this._handlers.splice(e,0,t),this._subscribers.splice(e,0,t),this}off(t){let e;for(;(e=this._subscribers.indexOf(t))!==-1;)this._subscribers.splice(e,1),this._handlers.splice(e,1);return this}destroy(){this._subscribers=[],this._handlers=[]}},kM=class extends Ot{onMounted(){this._graphics=this._modules.graphics,this._modules.events.register(["setMultipleAttributes"]),this._modules.events.on(["addNodes","addEdges"],({nodes:t,edges:e,objects:s})=>{this._onAddElements(t||e,s)}),this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:G1,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:j1,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0})}_onAddElements(t,e){const s=e.map(i=>i.attributes);this._originalAttributesLayer.setAttributeValues(t,s)}getOriginalAttributes(){return this._originalAttributesLayer.getFlexArrays()}getIndividualAttributes(){return this._individualAttributesLayer.getFlexArrays()}setMultipleAttributes(t,e,s){const i=Array.isArray(e)?e.length&&e[0]?od(e[0],t.isNode):[]:od(e,t.isNode),n=i.includes("x")||i.includes("y"),r=[];return this._modules.events.fire("setMultipleAttributes",{elements:t,values:e,updatedAttributes:i,options:s,promises:r}),this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,e)},n,s).then(o=>Promise.all(r).then(()=>o))}setSingleAttribute(t,e,s,i){const n={};return _i(n,e,s),this.setMultipleAttributes(t,n,i)}resetMultipleAttributes(t,e,s){const i=e||this._individualAttributesLayer.getUsedAttributeNames(t),n=i&&(i.includes("x")||i.includes("y")),r={};for(const o of i)_i(r,o,void 0);return this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,r)},n,s)}getMultipleAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!1)}getSingleAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!1)}replaceOriginalAttributes(t,e,s=[]){const i={},n=this._originalAttributesLayer.getUsedAttributeNames(t).filter(r=>!s.includes(r));for(let r=0;r<n.length;++r)_i(i,n[r],void 0);this._originalAttributesLayer.setAttributeValues(t,i),this._originalAttributesLayer.setAttributeValues(t,e)}getSinglePreviousAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!0)}getMultiplePreviousAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!0)}},BM=class extends Ot{constructor(){super(...arguments),this._currentValue={},this._onChange={},this._defaultValues={},this._keys=[]}onReady(t){t.renderer&&this.update({renderer:t.renderer}),t.options&&this.update(t.options)}register(t,e,s,i){return i===void 0&&(i=!0),this._keys.push(t),this._currentValue[t]=e,this._defaultValues[t]=e,this._onChange[t]=s||Xt,s&&i&&s(e),this}update(t){t=Mo(t);const e=this._keys,s={},i=this._currentValue;for(let r=0;r<e.length;++r){const o=e[r];if(o in t){let a=t[o];a===void 0&&(a=this._defaultValues[o]),s[o]=i[o],i[o]=a}}const n=Object.keys(s);for(let r=0;r<n.length;++r){const o=n[r],a=this._currentValue[o],l=s[o];a!==l&&this._onChange[o](a,l)}return qh(s)}get(t){return arguments.length===0?qh(this._currentValue):this._currentValue[t]}set(t,e){const s=this._currentValue[t],i=this._onChange[t];this._currentValue[t]=e,i&&i(e,s)}},UM=class{constructor(t,e){this._classes=t,this._name=e}getName(){return this._name}getIndex(){return this._classes.getIndex(this._name)}setIndex(t){return this._classes.setIndex(this._name,t)}update(t){return this._classes.update(this._name,t),this}getDefinition(){return this._classes.getDefinition(this._name)}getNodes(t){return this._classes.getElementsByClass(this._name,t).nodes}getEdges(t){return this._classes.getElementsByClass(this._name,t).edges}clearNodes(t){this.getNodes(t).removeClass(this._name)}clearEdges(t){this.getEdges(t).removeClass(this._name)}add(t){t.addClass(this._name)}remove(t){t.removeClass(this._name)}destroy(){const t=this._classes.getElementsByClass(this._name);return Promise.all([t.nodes.removeClass(this._name),t.edges.removeClass(this._name)]).then(()=>this._classes.removeClass(this._name))}},GM=1e3,VM=.5/GM,qM=class extends Ot{constructor(){super(...arguments),this._builtinClasses=[],this._userClasses=[],this._classesByName={},this._onExcludedStateChange=({elements:t,value:e})=>{if(e){const s=this._builtinClasses.map(i=>i.name);this._addOrRemoveClassesToElements(s,t,!1)}},this._onClearGraph=()=>{this._builtinClasses.concat(this._userClasses).forEach(t=>t.elementSet.clear())},this._onRemoveElements=({nodes:t,edges:e})=>{const s=t||e;this._builtinClasses.concat(this._userClasses).forEach(i=>i.elementSet.removeElements(s))}}onMounted(){this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on("clearGraph",this._onClearGraph).on("removeEdges",this._onRemoveElements).on("removeNodes",this._onRemoveElements)}_getClassList(t){return t?this._builtinClasses:this._userClasses}createClass({name:t,isBuiltin:e=!1,after:s,nodeAttributes:i,nodeDependencies:n,nodeOutput:r,edgeAttributes:o,edgeDependencies:a,edgeOutput:l}={}){if(typeof t!="string")throw new Error('the "name" argument should be a string');const d=this._getClassList(e),h=s?jM(d,s)+1:d.length;if(h===-1)throw new Error(`createClass: class specified as \`after\` parameter "${s}" does not exist`);if(e&&!t.startsWith("_"))throw new Error(`invalid builtin class name "${t}": builtin classes should start with '_'`);const u=new ra(this._modules.graph),c=new UM(this,t),g={name:t,elementSet:u,attributeLayer:this._modules.graphics.addAttributeLayer({name:`class(${t})`,tag:t,standaloneSelectors:!0,nodeAttributes:i||void 0,edgeAttributes:o||void 0,nodeSelector:(m,f)=>f.hasElement(m),edgeSelector:(m,f)=>f.hasElement(m),nodeContext:u,edgeContext:u,nodeOutput:r,edgeOutput:l,nodeDependencies:n,edgeDependencies:a}),isBuiltin:e,wrapper:c};return d.splice(h,0,g),e&&d.sort((m,f)=>Um.indexOf(m.name)-Um.indexOf(f.name)),this._updatePriorities(e),this._classesByName[t]=g,this._modules.events.register([Un(t,!0,!0),Un(t,!0,!1),Un(t,!1,!0),Un(t,!1,!1)]),c}removeClass(t){const e=this._get(t),s=this._getClassList(e.isBuiltin),i=s.indexOf(e);return i!==-1&&(s.splice(i,1),e.attributeLayer.destroy(),delete this._classesByName[t],this._updatePriorities(e.isBuiltin)),Promise.resolve(void 0)}_updatePriorities(t){const e=this._getClassList(t),s=Y1+(t?.5:0);for(let i=0;i<e.length;++i){const n=e[i],r=s+VM*i;n.attributeLayer.update({priority:r})}}_get(t){const e=this._classesByName[t];if(!e)throw new Error(`class "${t}" does not exist`);return e}getIndex(t){const e=this._get(t);return this._getClassList(e.isBuiltin).indexOf(e)}setIndex(t,e){const s=this._get(t),i=this._getClassList(s.isBuiltin),n=i.indexOf(s),r=Is(e,0,i.length-1);i.splice(n,1),i.splice(r,0,s),this._updatePriorities(s.isBuiltin)}update(t,{nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a}={}){this._get(t).attributeLayer.update({nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a})}getDefinition(t){const e=this._get(t),{nodeAttributes:s,nodeDependencies:i,nodeOutput:n,edgeAttributes:r,edgeDependencies:o,edgeOutput:a}=e.attributeLayer.getDefinition();return{nodeAttributes:s||void 0,edgeAttributes:r||void 0,nodeDependencies:i,edgeDependencies:o,nodeOutput:n,edgeOutput:a}}_addOrRemoveClassesToElements(t,e,s){const i=e.isNode;for(let n=0;n<t.length;++n){const r=t[n],{elementSet:o,attributeLayer:a}=this._get(r),l=o.addOrRemoveElements(e,s),d=Un(r,i,s);l.size&&(a.updateElements(l),this._modules.events.fire(d,i?{nodes:l}:{edges:l}))}}_animatedAttributesUpdatePositions(t,e){for(let s=0;s<t.length;++s){const i=t[s],n=this.getDefinition(i);if(e.isNode&&n.nodeAttributes&&(n.nodeAttributes.x||n.nodeAttributes.y))return!0}return!1}_getAnimatedAtrributes(t,e){return t.reduce((s,i)=>{const n=this.getDefinition(i);return e.isNode&&n.nodeAttributes&&s.push(...od(n.nodeAttributes,!0)),!e.isNode&&n.edgeAttributes&&s.push(...od(n.edgeAttributes,!1)),s},[])}addClassesToElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!0)},n,s)}removeClassesFromElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!1)},n,s)}hasSingleElementClass(t,e){return!!this._classesByName[t]&&this._get(t).elementSet.hasElement(e)}getElementsClassList(t,e={}){const{includeBuiltinClasses:s=!1}=e,i=new Array(t.size);for(let n=0;n<i.length;++n)i[n]=[];return this._addClassNamesToList(i,t,this._userClasses),s&&this._addClassNamesToList(i,t,this._builtinClasses),i}_addClassNamesToList(t,e,s){const i=e.toList();for(let n=0;n<s.length;++n){const{name:r,elementSet:o}=s[n];for(let a=0;a<i.size;++a){const l=i.get(a);o.hasElement(l)&&t[a].push(r)}}}getClassByName(t,e=!1){const s=this._classesByName[t]||null;if(e&&!s)throw new Error(`class "${t}" does not exist`);return s&&s.wrapper}getClassList(){return this._userClasses.map(t=>t.wrapper)}getElementsByClass(t,e="visible"){const{elementSet:s}=this._get(t),i=s.getElements();let n=i.nodes,r=i.edges;return e==="visible"?(n=n.filter(o=>o.isVisible()),r=r.filter(o=>o.isVisible())):e==="raw"&&(n=n.filter(o=>!o.isVirtual()),r=r.filter(o=>!o.isVirtual())),{nodes:n,edges:r}}_onClassEvent(t,e,s,i){const n=Un(t,s,i);this._modules.events.on(n,e)}onNodeClassAdded(t,e){this._onClassEvent(t,e,!0,!0)}onNodeClassRemoved(t,e){this._onClassEvent(t,e,!0,!1)}onEdgeClassAdded(t,e){this._onClassEvent(t,e,!1,!0)}onEdgeClassRemoved(t,e){this._onClassEvent(t,e,!1,!1)}};function Un(t,e,s){return`${e?"node":"edge"}Class${s?"Added":"Removed"}_${t}`}function jM(t,e){for(let s=0;s<t.length;++s)if(t[s].name===e)return s;return-1}var Vv=()=>({x:0,y:0,x1:0,y1:0,x2:0,y2:0});function cp(t,e,s,{cells:i=!0,boxes:n=!0,query:r=!0}={}){const o=e.keys().map(l=>e.keyToBBox(Number(l))),a=e.getBoxes();if(i&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#707070",o.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.stroke()),n&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#ff7070",a.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.closePath(),t.stroke()),r&&s){const l=s;t.beginPath(),t.lineWidth=2,t.strokeStyle="#3030ff",t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1]),t.closePath(),t.stroke()}}function YM(t){const[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o]=t.getEdgeAttributes(["source","target","curvature"]),a=Vv(),l=Xc();return d=>{if(d<0){d=-d;const h=n.get(d),u=r.get(d),c=o.get(d),g=e.get(h),m=s.get(h),f=e.get(u),p=s.get(u);h===u?(Pd(g,m,c,i.get(h),0,a),Od(g,m,a.x1,a.y1,a.x2,a.y2,f,p,l)):c===0?(l.minX=Math.min(g,f),l.minY=Math.min(m,p),l.maxX=Math.max(g,f),l.maxY=Math.max(m,p)):(Rn(g,m,f,p,c,a),Wc(g,m,a.x,a.y,f,p,l))}else{const h=e.get(d),u=s.get(d),c=i.get(d);l.minX=h-c,l.minY=u-c,l.maxX=h+c,l.maxY=u+c}return[l.minX,l.minY,l.maxX,l.maxY]}}var HM=["x","y","radius"],XM=["width","curvature"],$M=.5,WM=class extends Ot{constructor(){super(...arguments),this._minCellSize=8,this._clear=()=>{this._index.clear(),this._elementsToUpdate.clear()},this._onGraphUpdate=t=>{if(t.nodes&&(!t.nodeAttributes||t.nodeAttributes.some(e=>HM.includes(e)))){const e=t.nodes.fastGetAdjacentElements().edges;this._elementsToUpdate.addElements(t.nodes),this._elementsToUpdate.addElements(e)}t.edges&&(t.edgeAttributes&&!t.edgeAttributes.some(e=>XM.includes(e))||this._elementsToUpdate.addElements(t.edges))}}onMounted(){this._index=new jT(this._getIntersector(),YM(this._modules.graph),this._minCellSize,1e6),this._elementsToUpdate=new ra(this._modules.graph),this._removedNodes=this._modules.graph.getNodeAttribute("removed"),this._removedEdges=this._modules.graph.getEdgeAttribute("removed"),this._excludedNodes=this._modules.graph.getNodeAttribute("excluded"),this._excludedEdges=this._modules.graph.getEdgeAttribute("excluded"),this._queryResult={edges:[],nodes:[]},this._queryBounds=[0,0,0,0],this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges","updateAttributes"],this._onGraphUpdate).on("excludedStateChange",({elements:t})=>{this._elementsToUpdate.addElements(t)}).on("clearGraph",this._clear)}_getIntersector(){const t=this._modules.graph,[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o,a]=t.getEdgeAttributes(["source","target","width","curvature"]),l=Vv(),d=this._modules.camera.getAngle(),h=Math.cos(d),u=Math.sin(d);return(c,g,m,f,p)=>{const{bentEnable:_,bentVertical:y}=this._modules.graphics.getGraphicsEngine().getBentEdges();if(c<0){c=-c;const x=n.get(c),b=r.get(c),v=a.get(c),A=o.get(c)/2,E=e.get(x),S=s.get(x),w=e.get(b),T=s.get(b);return _?(zd(E*h-S*u,S*h+E*u,w*h-T*u,T*h+w*u,v,_,y,l),au(E,S,l.x1*h+l.y1*u,l.y1*h-l.x1*u,l.x2*h+l.y2*u,l.y2*h-l.x2*u,w,T,g-A,m-A,f+A,p+A)):x===b?(Pd(E,S,v,i.get(x),0,l),au(E,S,l.x1,l.y1,l.x2,l.y2,w,T,g-A,m-A,f+A,p+A)):v===0?Zc(E,S,w,T,g-A,m-A,f+A,p+A):(Rn(E,S,w,T,v,l),Px(E,S,l.x,l.y,w,T,g-A,m-A,f+A,p+A))}return Nc(e.get(c),s.get(c),i.get(c),g,m,f,p)}}reindex(){this._modules.graphics.forceAttributesComputation(),this._index.clear(),this._elementsToUpdate.clear(),this._updateItems(this._modules.graph.getNodes("all")._indexes,this._modules.graph.getEdges("all")._indexes)}getSize(){return this._index.size}_updateIndex(){if(!this._elementsToUpdate.isEmpty()){const{nodes:t,edges:e}=this._elementsToUpdate.getElements();if(t._indexes.length/this._modules.graph.getNodes("all").size>$M)return void this.reindex();this._updateItems(t._indexes,e._indexes),this._elementsToUpdate.clear()}}_updateItems(t,e){const s=this._index,i=this._removedNodes,n=this._removedEdges,r=this._excludedNodes,o=this._excludedEdges,a=[],l=[];if(i&&r)for(let d=0;d<t.length;d++){const h=t[d];i.get(h)!==0||r.get(h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}if(n&&o)for(let d=0;d<e.length;d++){const h=-e[d];n.get(-h)!==0||o.get(-h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}for(const d of a)s.remove(d);for(const d of l)s.insert(d)}getNodesInScreenByDistance(t){const{x:e,y:s}=t.getPositionOnScreen();return this._modules.graph.getNodes().filter(i=>i.isInScreen()&&i!==t).sort((i,n)=>{const r=i.getPositionOnScreen(),o=n.getPositionOnScreen();return Ce(r.x,r.y,e,s)-Ce(o.x,o.y,e,s)})}getNearestNodesForNode(t,e=240,s){const{x:i,y:n}=t.getPosition();return this.getNearestNodes(i,n,e,s,t)}getNearestNodes(t,e,s,i,n){if(this._updateIndex(),i){const r=this._modules.camera.screenToGraphVector({x:s,y:s});s=Ce(0,0,r.x,r.y)}return this._getNearestNodes(t,e,s,n)}_getNearestNodes(t,e,s,i){const n=[],r=s*s,o=i?i._index:0,a=this._modules.graph.getNodes()._indexes,[l,d]=this._modules.graph.getNodeAttributes(["x","y"]);for(let h=0,u=a.length;h<u;h++){const c=a[h];if(c===o)continue;const g=t-l.get(c),m=e-d.get(c);g*g+m*m<=r&&n.push(c)}return this._modules.graph.nodeList(new Uint32Array(n))}queryRaw(t,e,s,i){this._updateIndex();const n=this._queryBounds;n[0]=t,n[1]=e,n[2]=s,n[3]=i;const r=this._index.query(t,e,s,i),{nodes:o,edges:a}=this._queryResult;o.length=a.length=0;for(let l=0;l<r.length;l++){const d=r[l];d<0?a.push(-d):o.push(d)}return this._queryResult}queryRawProjected(t,e,s,i){const n=this._queryBounds;n[0]=t,n[1]=e,n[2]=s,n[3]=i,this._modules.camera.projectBounds(n);const r=this.queryRaw(n[0],n[1],n[2],n[3]);return this._modules.labels.query(n[0],n[1],n[2],n[3],r),r}query(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRaw(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r.slice())),edges:n.edgeList(new Uint32Array(o.slice()))}}queryProjected(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRawProjected(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r)),edges:n.edgeList(new Uint32Array(o))}}getNodesByBoundingBox(t,e,s,i,n){if(this._updateIndex(),n){let u;u=this._modules.camera.screenToGraphVector({x:t,y:e}),t=u.x,e=u.y,u=this._modules.camera.screenToGraphVector({x:s,y:i}),s=u.x,i=u.y}const r=this._modules.graph,o=r.getNodes()._indexes,a=[],l=r.getNodeAttribute("excluded"),[d,h]=r.getNodeAttributes(["x","y"]);for(let u=0,c=o.length;u<c;u++){const g=o[u];if(l&&l.get(g))continue;const m=d&&d.get(g),f=h&&h.get(g);m>=t&&m<=s&&f>=e&&f<=i&&a.push(g)}return r.nodeList(new Uint32Array(a))}toggleDebug(t){t?(this._layer=this._modules.layers.addCanvasLayer(e=>{cp(e,this._index,this._queryBounds)},{isStatic:!1,noClear:!1}),this._layer.moveToTop()):this._layer&&(this._layer.destroy(),this._layer=null)}renderDebug(t){if(!this._layer)return this.toggleDebug(!0);this._layer.refresh(e=>{cp(e,this._index,this._queryBounds,t)})}},lr={};function Gd(t,e,s,i,n=0,r=Math.sin(n),o=Math.cos(n),a=[0,0,0,0]){const l=s/2,d=i/2,h=t+l,u=e+d;if(n===0)return a[0]=t,a[1]=e,a[2]=t+s,a[3]=e+i,a;let c,g,m,f,p,_,y,x;return m=-l,f=-d,c=h+m*o-f*r,g=u+m*r+f*o,p=y=c,_=x=g,m=-l,f=d,c=h+m*o-f*r,g=u+m*r+f*o,c<p?p=c:c>y&&(y=c),g<_?_=g:g>x&&(x=g),m=l,f=d,c=h+m*o-f*r,g=u+m*r+f*o,c<p?p=c:c>y&&(y=c),g<_?_=g:g>x&&(x=g),m=l,f=-d,c=h+m*o-f*r,g=u+m*r+f*o,c<p?p=c:c>y&&(y=c),g<_?_=g:g>x&&(x=g),a[0]=p,a[1]=_,a[2]=y,a[3]=x,a}function oa(t,e,s,i,n=0){const r=s/2,o=i/2,a=t+r,l=e+o;if(n===0)return[{x:t,y:e},{x:t+s,y:e},{x:t+s,y:e+i},{x:t,y:e+i}];const d=Math.sin(n),h=Math.cos(n);let u,c,g,m;g=-r,m=-o,u=a+g*h-m*d,c=l+g*d+m*h;const f={x:u,y:c};g=-r,m=o,u=a+g*h-m*d,c=l+g*d+m*h;const p={x:u,y:c};g=r,m=o,u=a+g*h-m*d,c=l+g*d+m*h;const _={x:u,y:c};return g=r,m=-o,u=a+g*h-m*d,c=l+g*d+m*h,[f,p,_,{x:u,y:c}]}function Gu(t,e=0,s=1,i=Ix.slice()){const n=s*Math.sin(e),r=s*Math.cos(e);return i[0]=t[0]+n,i[1]=t[1]+r,i[2]=t[2]+n,i[3]=t[3]+r,i}function ZM(t,e){return Cx(t,e)}function KM(t,e){return qv(t[0],t[1],t[2],t[3],e[0],e[1],e[2],e[3])}function QM(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function qv(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}Ho(lr,{angle:()=>iI,circleCircleIntersection:()=>Lc,circleContainsCircle:()=>vT,circleContainsPoint:()=>bT,circleIntersectsBox:()=>Nc,circleLineIntersection:()=>Nx,circleSortCompare:()=>Cc,computeCentroid:()=>qC,cubicBezierAABB:()=>au,defaultAABB:()=>Ix,degreesToRadians:()=>xT,distToSegmentSquared:()=>Kc,distance:()=>Ce,distancePointSegment:()=>kb,extendBounds:()=>Cx,getAABB:()=>Gd,getBentEdgesControlPoints:()=>zd,getBezierCurveBoundingBox:()=>Od,getClosestPointOnLine:()=>rI,getClosestPointOnSegment:()=>Bb,getNormalOnEdge:()=>J2,getNormalOnQuadraticCurve:()=>Pb,getOBBPoints:()=>oa,getPointOnBezierCurve:()=>ko,getPointOnEdge:()=>Q2,getPointOnQuadraticCurve:()=>Dd,getQuadraticBezierCurveLength:()=>eI,getQuadraticCurveBoundingBox:()=>Wc,getQuadraticCurveControlPoint:()=>Rn,getSelfLoopControlPoints:()=>Pd,getTangentOnEdge:()=>tI,getTangentOnQuadraticCurve:()=>$c,intersects:()=>QM,isPointInLine:()=>Db,isPointInPolygon:()=>Uo,isPointOnBezierCurve:()=>Eu,isPointOnQuadraticCurve:()=>zb,lineAABB:()=>Zc,lineAngle:()=>br,lineIntersection:()=>nI,lineLine:()=>ir,minDisk:()=>Qo,move:()=>yT,moveAABB:()=>Gu,normalize:()=>Lx,overlaps:()=>qv,overlapsAABB:()=>KM,padBounds:()=>ZM,polygonsIntersect:()=>g0,quadBezierAABB:()=>Px,radiansToDegrees:()=>ru,rotate:()=>$l,segmentIntersection:()=>so,segmentRectangleIntersection:()=>Ob,squaredDistance:()=>xl,twoSegmentsIntersect:()=>sI});var Wa=40;function jv(t,e){const s=t.getAttribute("curvature"),i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen();if(i===n){const f=(s+i.getAttribute("radius"))*ed*e,p=r.x,_=r.y,y=p-f,x=_,b=p,v=_+f;return[r,...[.2,.4,.6,.8].map(A=>ko(A,p,_,p,_,y,x,b,v)),r]}const o=n.getPositionOnScreen();if(s===0)return[r,o];const a=o.x-r.x,l=o.y-r.y,d=Math.sqrt(a*a+l*l),h=(r.x+o.x)/2,u=(r.y+o.y)/2,c=s*(d/Cd)*2,g=h+l/d*c,m=u+-a/d*c;return[r,...[.25,.5,.75].map(f=>Dd(f,r.x,r.y,o.x,o.y,g,m)),o]}function JM(t,e,s){const i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen(),o=n.getPositionOnScreen();if(Uo(r.x,r.y,e)||Uo(o.x,o.y,e))return!0;const a=jv(t,s);for(let l=0;l<a.length-1;++l){const d=a[l],h=a[l+1];for(let u=0;u<e.length-1;++u){const c=e[u],g=e[u+1];if(ir(d.x,d.y,h.x,h.y,c.x,c.y,g.x,g.y))return!0}}return!1}function tR(t,e,s){const i=t.getPositionOnScreen(),n=Number(t.getAttribute("radius"))*s;return Yv(i.x,i.y,n,e)}function Yv(t,e,s,i){const n=t-s,r=e-s,o=e+s;return t+s>=i.minX&&n<=i.maxX&&o>=i.minY&&r<=i.maxY}function eR(t,e,s){const i=jv(t,s);for(let n=0;n<i.length-1;++n){const r=i[n],o=i[n+1];if(Zc(r.x,r.y,o.x,o.y,e.minX,e.minY,e.maxX,e.maxY))return!0}return!1}function gp(t,e,s,i){typeof s=="number"&&(s={left:s,right:s,top:s,bottom:s});const n=s.left===void 0?Wa:s.left,r=s.right===void 0?Wa:s.right,o=s.top===void 0?Wa:s.top,a=s.bottom===void 0?Wa:s.bottom,l=n+r,d=o+a,h=t.width===0?t.maxFixedSize:t.width,u=t.height===0?t.maxFixedSize:t.height,c=EM([(e.width-l)/(h+t.maxScaledSize),(e.height-d)/(u+t.maxScaledSize),(e.width-l-t.maxFixedSize)/h,(e.height-d-t.maxFixedSize)/u,i/t.maxScaledSize||NaN]);return{x:t.cx+(r-n)/(2*c),y:t.cy+(a-o)/(2*c),zoom:c}}var sR="cubicOut",mp=200,iR=class extends Ot{constructor(){super(...arguments),this._isLocating=!1,this._cacheValid=!0,this._cachedGraphBoundingBox=new rs,this._onLocateStart=()=>{this._isLocating=!0},this._onLocated=()=>{this._isLocating=!1,this._modules.events.fire("locate")},this._invalidCache=()=>{this._cacheValid=!1}}onMounted(){this._modules.events.register(["locate"]),this._modules.events.on(["addNodes","removeNodes","addEdges","removeEdges","excludedStateChange","clearGraph","updateAttributes"],this._invalidCache)}onReady(){this.locateGraph({},!0)}locateGraph(t,e=!1){return this._onLocateStart(),e?this._locateGraph(t):this._modules.transformations.whenApplied().then(()=>this._locateGraph(t))}_locateGraph(t){return this._locateBoundingBox(this.getGraphBoundingBox(),t).then(this._onLocated)}locateElements(t,e){return this._modules.transformations.whenApplied().then(()=>this._locateBoundingBox(this.getBoundingBox(t),e)).then(this._onLocated)}locateRawGraph(t,e){return this._onLocateStart(),this._locateBoundingBox(this.getRawGraphBoundingBox(t),e).then(this._onLocated)}isLocating(){return this._isLocating}getGraphBoundingBox(t=!1){if(t){const e=this.getBoundingBox(this._ogma.getNodes(),!0,t),s=this.getBoundingBox(this._ogma.getEdges(),!1,t);return e.extend(s)}return this._cacheValid||this._updateCache(),this._cachedGraphBoundingBox.clone()}forceInvalidCache(){this._invalidCache()}_updateCache(){this._cacheValid=!0,this._cachedGraphBoundingBox=this.getBoundingBox(this._modules.graph.getNodes()).extend(this.getBoundingBox(this._modules.graph.getEdges()))}getBoundingBox(t,e=!1,s=!1,i){let n;if(n=t.isNode?this._getNodesBoundingBox(t.toList(),e):this._getEdgesBoundingBox(t.toList(),i),s){const r=this._ogma.modules.labels.getTextsBoundingBox(t.isNode?t.toList():null,t.isNode?null:t.toList());n=n.extend(r)}return n}_getNodesBoundingBox(t,e=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getNodeAttributes(),i=[],n=[],r=[],o=[];for(let a=0;a<t.size;++a){const l=t._indexes[a];if(s.excluded.get(l)===0){const d=s.x.get(l),h=s.y.get(l),u=s.radius.get(l),c=2*u;s.scalingMethod.get(l)==="scaled"?r.push(c):o.push(c),e?(i.push(d-u,d+u),n.push(h-u,h+u)):(i.push(d),n.push(h))}}return new rs({xValues:i,yValues:n,scaledSizeValues:r,fixedSizeValues:o})}_getEdgesBoundingBox(t,e=!1){return this._getEdgesBoundingBoxInternal(t._indexes,e)}_getEdgesBoundingBoxInternal(t,e=!1,s,i){this._modules.graphics.forceAttributesComputation();const n=this._modules.graphics.getEdgeAttributes(),r=this._modules.graphics.getNodeAttributes(),o={x1:0,y1:0,x2:0,y2:0},a={x:0,y:0},l={minX:0,minY:0,maxX:0,maxY:0},d=[],h=[],u=[],c=[],g=s||r.x,m=i||r.y;for(let f=0;f<t.length;++f){const p=t[f],_=n.source.get(p),y=n.target.get(p),x=n.curvature.get(p),b=g.get(_),v=m.get(_),A=r.scalingMethod.get(_)==="scaled",E=2*r.radius.get(_),S=g.get(y),w=m.get(y),T=r.scalingMethod.get(y)==="scaled",L=2*r.radius.get(y);A?u.push(E):c.push(E),T?u.push(L):c.push(L),e||x===0?(d.push(b,S),h.push(v,w)):_===y?(Qc(b,v,x,E/2,0,o),Od(b,v,o.x1,o.y1,o.x2,o.y2,S,w,l),d.push(l.minX,l.maxX),h.push(l.minY,l.maxY)):(kd(b,v,S,w,x,a),Wc(b,v,a.x,a.y,S,w,l),d.push(l.minX,l.maxX),h.push(l.minY,l.maxY))}return new rs({xValues:d,yValues:h,scaledSizeValues:u,fixedSizeValues:c})}getRawGraphBoundingBox(t){const e=t.nodes.length,s=new Array(e),i=new Array(e),n=new Array(e);for(let r=0;r<e;r++){const o=t.nodes[r].attributes||{};s[r]=o.x||0,i[r]=o.y||0,n[r]=o.radius||5}return new rs({xValues:s,yValues:i,scaledSizeValues:n})}_locateBoundingBox(t,e={}){if(isNaN(t.cx))return Promise.resolve();const{padding:s={},easing:i=sR,duration:n=0,maxNodeSizeOnScreen:r=mp,ignoreZoomLimits:o=!1}=e,a=gp(t,this._modules.dom.getDimensions(),s,r),l=a.x,d=a.y,h=a.zoom,u=h/this._modules.camera.getZoom();return this._moveCamera(l,d,h,n,i,u,o)}_moveCamera(t,e,s,i,n,r,o){const a={duration:i,easing:n,ignoreZoomLimits:o},l=this._modules.camera.setCenter({x:t,y:e},a);return r>1.01||r<.99?this._modules.camera.setZoom(s,a):l}computeConfigForBounds(t,e={}){const{padding:s={},maxNodeSizeOnScreen:i=mp}=e;return gp(t,this._modules.dom.getDimensions(),s,i)}layoutDataBoundingBox({x:t,y:e,indexes:s}){const i=this._modules.graphics.getNodeAttributes(),n=[],r=[],o=[],a=[],l=new Map,d=new Map;for(let c=0;c<s.length;++c){const g=s[c],m=t[c],f=e[c];l.set(g,m),d.set(g,f);const p=2*i.radius.get(g),_=i.scalingMethod.get(g)==="scaled";n.push(m),r.push(f),_?o.push(p):a.push(p)}const h=this._modules.graph.topology.getAdjacentElements(!1,s,{bothExtremities:!0}),u=this._getEdgesBoundingBoxInternal(h,!1,l,d);return new rs({xValues:n,yValues:r,scaledSizeValues:o,fixedSizeValues:a}).extend(u)}isEdgeInPolygon(t,e){return JM(t,e,this._modules.camera.getZoom())}isElementInView(t,{margin:e=0}={}){const{width:s,height:i}=this._modules.camera.getSize(),n={minX:-e,minY:-e,maxX:s+e,maxY:i+e};return t.isNode?this.isNodeInRectangle(t,n):this.isEdgeInRectangle(t,n)}isNodeInRectangle(t,e){if(this._modules.geo.isEnabled()){const s=this._modules.geo.getContainerCoord(t);return Yv(s.x,s.y,Number(t.getAttribute("radius")),e)}return tR(t,e,this._modules.camera.getZoom())}isNodeInPolygon(t,e){const s=t.getPositionOnScreen();return Uo(s.x,s.y,e)}isEdgeInRectangle(t,e){return eR(t,e,this._modules.camera.getZoom())}},nR=ji&&typeof navigator<"u"&&"msLaunchUri"in navigator&&vi&&!("documentMode"in document);function rR(t){return nR?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/gs():t.deltaY&&t.deltaMode===1?20*-t.deltaY:t.deltaY&&t.deltaMode===2?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}var oR=6,aR=class extends Ot{constructor(){super(...arguments),this._px=0,this._py=0,this._pressX=0,this._pressY=0,this._left=!1,this._middle=!1,this._right=!1,this._clickCounter={left:0,middle:0,right:0},this._buttons={left:!1,middle:!1,right:!1},this._skipNextMove=!1,this._onMouseWheel=t=>{this._isEnabled()&&this._isWheelEnabled()&&(!this._disableWheelUntilMouseDown()||this._modules.dom.hasFocus())&&(t.preventDefault(),t.stopPropagation(),this._applyMouseWheelZoom(t))},this._onMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=e-this._px,n=s-this._py;i===0&&n===0||(this._skipNextMove?this._skipNextMove=!1:Ce(e,s,this._pressX,this._pressY)>=oR&&(this._resetClickCounter(),this._modules.events.fire("mousemoveInternal",{x:e,y:s,dx:i,dy:n,domEvent:this._evt})))},this._onDocumentMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._bounds,n=e-this._px,r=s-this._py;(e<0||e>i.width||s<0||s>i.height)&&this._modules.events.fire("documentMouseMove",{x:e,y:s,dx:n,dy:r,domEvent:this._evt})},this._onMouseUp=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._evt;this._buttons[i]=!1,this._clickCounter[this._button]===1?this._modules.events.fire("clickInternal",{button:i,x:e,y:s,domEvent:n}):this._clickCounter[i]>1&&(this._modules.events.fire("doubleclickInternal",{button:i,x:e,y:s,domEvent:n}),this._resetClickCounter(i)),this._modules.events.fire("mouseupInternal",{button:i,x:e,y:s,domEvent:n})},this._onDocumentMouseup=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button;this._buttons[i]=!1;const n=this._modules.dom;this._modules.events.fire("documentMouseUp",{button:i,x:e,y:s,domEvent:this._evt}),n.removeDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.removeDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onMouseDown=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._modules.dom;this._skipNextMove=!0,this._pressX=e,this._pressY=s,this._lastMouseDownTarget=t.target,n.focus(),this._buttons[i]=!0,this._clickCounter[i]+=1;const r=i;this._dbclickTimer=n.setTimeout(()=>{this._resetClickCounter(r,0)},this._getDoubleClickTimer()),this._modules.events.fire("mousedownInternal",{button:i,x:e,y:s,domEvent:this._evt}),n.addDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.addDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onDrop=t=>{if(!this._isEnabled()||!this._setXY(t))return;t.preventDefault();const{x:e,y:s}=this._modules.camera.screenToGraphCoordinates(this._modules.position);this._modules.events.fire("drop",{domEvent:this._evt,x:e,y:s})}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("mouse.enabled",!0),this._modules.settings.register("mouse.wheelEnabled",!0),this._modules.settings.register("mouse.disableWheelUntilMouseDown",!1),this._modules.settings.register("mouse.doubleClickTimer",500),this._modules.events.register(["mousedownInternal","mouseupInternal","mousemoveInternal","mousewheelInternal","clickInternal","doubleclickInternal","mouseoverInternal","mouseoutInternal","documentMouseUp","documentMouseMove","drop"]),this._modules.dom.afterNextFrame().then(()=>this._initializeListeners())}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get left(){return this._left}get right(){return this._right}get middle(){return this._middle}_isEnabled(){return this._modules.settings.get("mouse.enabled")}_isWheelEnabled(){return this._modules.settings.get("mouse.wheelEnabled")}_disableWheelUntilMouseDown(){return this._modules.settings.get("mouse.disableWheelUntilMouseDown")}_getDoubleClickTimer(){return this._modules.settings.get("mouse.doubleClickTimer")}_resetClickCounter(t,e=0){t?this._clickCounter[t]=e:(this._clickCounter.left=e,this._clickCounter.middle=e,this._clickCounter.right=e),this._modules.dom.clearTimeout(this._dbclickTimer),this._lastMouseDownTarget=null}_setXY(t){const e=this._domElt.getBoundingClientRect();return this._bounds=e,!!e&&(this._evt=t,this._button=xc[t.button],this._px=this._modules.position.x,this._py=this._modules.position.y,this._modules.position.x=t.clientX-e.left,this._modules.position.y=t.clientY-e.top,this._left=this._buttons.left,this._right=this._buttons.right,this._middle=this._buttons.middle,!0)}_applyMouseWheelZoom(t){this._setXY(t)&&this._modules.events.fire("mousewheelInternal",{delta:rR(t),dx:t.deltaX,dy:t.deltaY,x:this._modules.position.x,y:this._modules.position.y,domEvent:this._evt})}_initializeListeners(){const t=this._domElt,e=this._modules.dom;bd&&this._modules.dom.addElementEventListener(document,"contextmenu",i=>{this._lastMouseDownTarget&&i.target!==this._lastMouseDownTarget&&i.preventDefault()}),e.addElementEventListener(t,"contextmenu",i=>{this._setXY(i),this._modules.dom.hasFocus()&&this._modules.settings.get("mouse.enabled")&&i.preventDefault()},!1);const s="onwheel"in t?"wheel":t.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";e.addElementEventListener(t,s,this._onMouseWheel,{passive:!1}),e.addElementEventListener(t,"mousemove",this._onMouseMove),e.addElementEventListener(t,"mouseleave",i=>{if(!this._isEnabled())return;this._modules.dom.blur();const n=t.getBoundingClientRect();i.clientX>=n.left+1&&i.clientX<=n.right-1&&i.clientY>=n.top+1&&i.clientY<=n.bottom-1||this._modules.events.fire("mouseout",{domEvent:this._evt})}),e.addElementEventListener(t,"mousedown",this._onMouseDown),e.addElementEventListener(t,"mouseup",this._onMouseUp),e.addElementEventListener(t,"dragover",i=>{i.preventDefault()}),e.addElementEventListener(t,"drop",this._onDrop)}},lR={doubleTapTimer:500},dR=class extends Ot{constructor(){super(...arguments),this._pressed=!1,this._addEvent=(t,e,s,i)=>{this._modules.dom.addElementEventListener(t,e,s,i)},this._addWinEvent=(t,e,s,i)=>{this._modules.dom.addDirectWindowEventListener(e,s,i)},this._removeWinEvent=(t,e,s)=>{this._modules.dom.removeDirectWindowEventListener(e,s)}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("touch.enabled",!0),this._modules.events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]),this._modules.dom.afterNextFrame().then(()=>{this._initialize(this)})}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get pressed(){return this._pressed}_listen(t,e,s){if(Xx){if(e==="touchstart")return S1(this._addEvent,t,s);if(e==="touchmove")return T1(this._addWinEvent,t,s);if(e==="touchend")return I1(this._addWinEvent,t,s);if(e==="touchcancel")return w1(this._addWinEvent,t,s)}return this._modules.dom.addElementEventListener(t,e,s)}_initialize(t){let e=0,s=0,i=0,n=0,r=!1,o="left",a=0,l=!1,d=!1,h=0,u=1,c=null,g=null;const m=()=>{this._modules.position.x=e,this._modules.position.y=s,this._pressed=r},f=(v,A)=>{const E=this._domElt.getBoundingClientRect();if(!E||v.touches==null)return null;const[S,w]=v.touches,T=S.clientX-E.left,L=S.clientY-E.top,R=w.clientX-E.left,k=w.clientY-E.top,j=(T+R)/2,z=(L+k)/2,q=j-e,B=z-s,W=Ce(T,L,R,k),Z=W/u,it=br(T,L,R,k),dt={dx:q,dy:B,rotation:it-h,scale:Z};return((At,gt,ct,yt)=>{u=At,h=gt,e=ct,s=yt,m()})(W,it,j,z),dt},p=v=>{if(v.touches&&v.touches.length===2&&d){const A=f(v);if(A){const{dx:E,dy:S,rotation:w,scale:T}=A;this._modules.events.fire("touchProgressGesture",{dx:E,dy:S,rotation:w,scale:T,x:e,y:s,domEvent:c,button:o})}}},_=v=>{if(o=xc[v.button],!v.touches)return!1;if(v.touches.length!==1)return r=!1,v.touches.length>1&&this._modules.events.fire("touchUp",{x:e,y:s,domEvent:c,button:o}),!1;const A=this._domElt.getBoundingClientRect();return A&&(i=e,n=s,e=v.touches[0].clientX-A.left|0,s=v.touches[0].clientY-A.top|0,r=!0,c=v,m()),!0},y=()=>{a=0,this._modules.dom.clearTimeout(g)},x=v=>{if(v.preventDefault(),!v.touches)return;if(v.touches.length!==2&&d&&(d=!1,this._modules.events.fire("touchEndGesture",{domEvent:c})),_(v),v.touches.length===0){const E={x:e,y:s,domEvent:c,button:o};a===1&&this._modules.events.fire("touchTap",E),a>1&&(this._modules.events.fire("touchDoubleTap",E),y()),this._modules.events.fire("touchUp",E)}const A=Ai().documentElement;Nm(this._removeWinEvent,A,"touchmove",this._onMove),Nm(this._removeWinEvent,A,"touchend",this._onEnd)},b=v=>{p(v),l?l=!1:(y(),_(v)&&this._modules.events.fire("touchMove",{x:e,y:s,dx:e-i,dy:s-n,domEvent:c,button:o}))};this._listen(this._domElt,"touchstart",v=>{if(!v.touches)return;v.touches.length!==2||d||(u=1,f(v)&&(d=!0,this._modules.events.fire("touchStartGesture",{domEvent:c}))),_(v)&&(this._modules.dom.focus(),this._modules.events.fire("touchDown",{x:e,y:s,domEvent:c,button:o}),a+=1,g=this._modules.dom.setTimeout(y,lR.doubleTapTimer),l=!0);const A=Ai().documentElement;this._onMove=this._listen(A,"touchmove",b),this._onEnd=this._listen(A,"touchend",x)})}},hR=class{getHoveredElement(){return this.modules.captor.getPointedElement()}getPointerInformation(){return this.modules.captor.getCursorInformation()}},uR=class{getNodesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getNodes(e)}getEdgesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getEdges(e)}},gg={};Ho(gg,{gexf:()=>Hv,gexfFromUrl:()=>mg,graphml:()=>Zv,graphmlFromUrl:()=>Kv,janus:()=>Xv,json:()=>$v,jsonFromUrl:()=>fg,mtx:()=>cR,mtxFromUrl:()=>gR,neo4j:()=>Wv});var Hv=t=>Promise.resolve(n0(t)),mg=t=>Lr(t).then(e=>n0(e)),Xv=t=>Promise.resolve(EL(t)),$v=(t,e)=>Promise.resolve(Kb(t,e)),fg=(t,e)=>Lr(t).then(s=>Kb(s,e)),Wv=t=>Promise.resolve(JL(t)),Zv=(t,e)=>Promise.resolve(r0(t,e)),Kv=(t,e)=>Lr(t).then(s=>r0(s,e)),cR=t=>Promise.resolve(o0(t)),gR=t=>Lr(t).then(e=>o0(e)),mR=class extends ce{constructor(){super(...arguments),this.wait=t=>new Promise(e=>setTimeout(e,t)),this.initRandomGraph=t=>this._ogma.generate.random(t).then(this._ogma.setGraph).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.initGrid=t=>{const e=Math.ceil(Math.sqrt(t));return this._ogma.generate.grid({rows:e,columns:e}).then(s=>this._ogma.setGraph(s)).then(()=>this._ogma.view.locateGraph())},this.initLine=t=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:t?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]}),this._ogma.view.locateGraph()),this.initSingleNode=()=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}],edges:[]}),this._ogma.view.locateGraph()),this.initContinuousRenderLoop=({triggerKey:t="r",start:e=!0}={})=>{let s=e;const i=()=>{s&&this._ogma.modules.dom.beforeNextFrame().then(i)};document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s,i())}),i()},this.appendToBody=()=>{const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.bottom="0",t.style.right="0",document.body.appendChild(t),this._ogma.setContainer(t)},this.loadFile=t=>(t.endsWith(".gexf")?mg(t):fg(t)).then(e=>this._ogma.setGraph(e)).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.enableLasso=t=>{this._ogma.events.on("dragStart",()=>{this._ogma.keyboard.isKeyPressed("ctrl")&&this._ogma.tools.lasso.enable(t)})},this.randomizeGraph=({minX:t=0,minY:e=0,maxX:s=500,maxY:i=500}={})=>this._ogma.getNodes().setAttributes(this._ogma.getNodes().map(()=>({x:t+Math.random()*(s-t),y:e+Math.random()*(i-e)})))}},fR=class{setContainer(t){this.modules.dom.setContainer(t)}getContainer(){return this.modules.dom.getContainer()}},pR=class extends ce{constructor(){super(...arguments),this.once=(t,e)=>(this._ogma.modules.events.once(t,e),this),this.removeListener=t=>{this._ogma.modules.events.off(t)},this.onNodesAdded=t=>(this._ogma.events.on("addNodes",t),this._ogma),this.onBeforeNodesRemoved=t=>(this._ogma.events.on("beforeRemoveNodes",t),this._ogma),this.onNodesRemoved=t=>(this._ogma.events.on("removeNodes",t),this._ogma),this.onEdgesAdded=t=>(this._ogma.events.on("addEdges",t),this._ogma),this.onBeforeEdgesRemoved=t=>(this._ogma.events.on("beforeRemoveEdges",t),this._ogma),this.onEdgesRemoved=t=>(this._ogma.events.on("removeEdges",t),this._ogma),this.onGraphCleared=t=>(this._ogma.events.on("clearGraph",t),this._ogma),this.onNodesClassAdded=(t,e)=>(this._ogma.modules.classes.onNodeClassAdded(t,e),this._ogma),this.onNodesClassRemoved=(t,e)=>(this._ogma.modules.classes.onNodeClassRemoved(t,e),this._ogma),this.onEdgesClassAdded=(t,e)=>(this._ogma.modules.classes.onEdgeClassAdded(t,e),this._ogma),this.onEdgesClassRemoved=(t,e)=>(this._ogma.modules.classes.onEdgeClassRemoved(t,e),this._ogma),this.onNodeDragStart=t=>(this._ogma.events.on("nodesDragStart",t),this._ogma),this.onNodeDragProgress=t=>(this._ogma.events.on("nodesDragProgress",t),this._ogma),this.onNodeDragEnd=t=>(this._ogma.events.on("nodesDragEnd",t),this._ogma),this.onDrop=t=>(this._ogma.events.on("drop",t),this._ogma),this.onNodesSelected=t=>this.onNodesClassAdded(me,t),this.onNodesUnselected=t=>this.onNodesClassRemoved(me,t),this.onEdgesSelected=t=>this.onEdgesClassAdded(me,t),this.onEdgesUnselected=t=>this.onEdgesClassRemoved(me,t),this.onNodeDataChange=t=>(this._ogma.events.on("updateNodeData",t),this._ogma),this.onEdgeDataChange=t=>(this._ogma.events.on("updateEdgeData",t),this._ogma),this.onAnimate=t=>(this._ogma.events.on("animate",t),this._ogma),this.onMouseMove=t=>(this._ogma.events.on("mousemove",t),this._ogma),this.onMouseButtonDown=t=>(this._ogma.events.on("mousedown",t),this._ogma),this.onMouseButtonUp=t=>(this._ogma.events.on("mouseup",t),this._ogma),this.onClick=t=>(this._ogma.events.on("click",t),this._ogma),this.onDoubleClick=t=>(this._ogma.events.on("doubleclick",t),this._ogma),this.onMouseWheel=t=>(this._ogma.events.on("mousewheel",t),this._ogma),this.onHover=t=>(this._ogma.events.on("mouseover",t),this._ogma),this.onUnhover=t=>(this._ogma.events.on("mouseout",t),this._ogma),this.onDragStart=t=>(this._ogma.events.on("dragStart",t),this._ogma),this.onDragProgress=t=>(this._ogma.events.on("dragProgress",t),this._ogma),this.onDragEnd=t=>(this._ogma.events.on("dragEnd",t),this._ogma),this.onGestureStart=t=>(this._ogma.events.on("gestureStart",t),this._ogma),this.onGestureProgress=t=>(this._ogma.events.on("gestureProgress",t),this._ogma),this.onGestureEnd=t=>(this._ogma.events.on("gestureEnd",t),this._ogma),this.onRendererStateChange=t=>(this._ogma.events.on("rendererStateChange",t),this._ogma),this.onZoomProgress=t=>(this._ogma.events.on("zoom",t),this._ogma),this.onViewChanged=t=>(this._ogma.events.on("viewChanged",t),this._ogma),this.onNodesConnected=t=>(this._ogma.events.on("connectNodes",t),this._ogma),this.onGeoModeEnabled=t=>(this._ogma.events.on("geoEnabled",t),this._ogma),this.onGeoModeDisabled=t=>(this._ogma.events.on("geoDisabled",t),this._ogma),this.onGeoModeLoaded=t=>(this._ogma.events.on("geoLoaded",t),this._ogma),this.onLayoutStart=t=>(this._ogma.events.on("layoutStart",t),this._ogma),this.onLayoutComplete=t=>(this._ogma.events.on("layoutEnd",t),this._ogma),this.onLayoutComputed=t=>(this._ogma.events.on("layoutComputed",t),this._ogma),this.onTooltipShown=t=>(this._ogma.events.on("tooltipShow",t),this._ogma),this.onTooltipHidden=t=>(this._ogma.events.on("tooltipHide",t),this._ogma),this.onTransformationEnabled=t=>(this._ogma.events.on("transformationEnabled",t),this._ogma),this.onTransformationDisabled=t=>(this._ogma.events.on("transformationDisabled",t),this._ogma),this.onTransformationSetIndex=t=>(this._ogma.events.on("transformationSetIndex",t),this._ogma),this.onTransformationDestroyed=t=>(this._ogma.modules.events.on("transformationDestroyed",t),this._ogma),this.onTransformationRefreshed=t=>(this._ogma.events.on("transformationRefresh",t),this._ogma)}on(t,e){return this._ogma.modules.events.on(t,e),this}off(t){return this._ogma.modules.events.off(t),this}onKeyPress(t,e){return this._ogma.modules.keyboard.onKeyPress(t,e),this._ogma}};function ld(t,e,s){if(t!=null)return Array.isArray(t)?t[0]:t}function Vu(t){return t==null?null:typeof t=="string"||typeof t=="number"?`${t}`:t&&Vu(t.content)}function _R(t){if(t!=null)return typeof t=="string"?t:t.style||"line"}var yR=["color","radius","shape","text.content","x","y"],xR=["color","width","shape.body","text.content"];function bR(t){return t!=="all"?{nodes:["x","y"],edges:[]}:{nodes:yR,edges:xR}}function vR(t,{nodes:e,edges:s}){const i=t.getOriginalAttributes();return{nodes:e.reduce((n,r)=>(n[r.getId()]={x:i.nodes.x.get(r._index),y:i.nodes.y.get(r._index),color:ld(i.nodes.color.get(r._index)),radius:i.nodes.radius.get(r._index),shape:i.nodes.shape.get(r._index),text:{content:i.nodes.text.content.get(r._index)}},n),{}),edges:s.reduce((n,r)=>(n[r.getId()]={color:ld(i.edges.color.get(r._index)),width:i.edges.width.get(r._index),shape:{type:i.edges.shape.body.get(r._index)},text:{content:i.edges.text&&i.edges.text.content&&i.edges.text.content.get(r._index)}},n),{})}}function AR(t){return{nodes:t.nodes.map(({id:e,attributes:s={},data:i})=>{const{color:n,radius:r,shape:o,text:a,x:l,y:d}=s;return{id:e,x:l,y:d,color:ld(n),size:r,shape:o,text:Vu(a),data:i}}),edges:t.edges.map(({id:e,source:s,target:i,attributes:n={},data:r})=>{const{color:o,width:a,text:l,shape:d}=n;return{id:e,source:s,target:i,color:ld(o),size:a,shape:_R(d),text:Vu(l),data:r}})}}function fp(t){return t instanceof Vs?t.getId():t}function pp(t){return t instanceof Yi?t.getId():t}function _p(t){return t instanceof Ei?t.getId():t instanceof Vs?[t.getId()]:Ue(t)?t.map(fp):[fp(t)]}function yp(t){return t instanceof Mn?t.getId():t instanceof Yi?[t.getId()]:Ue(t)?t.map(pp):[pp(t)]}var pg="visible";function ER(t,e){return t?_p(t):typeof e=="object"?_p(e.nodes):e||pg}function SR(t,e){return t?yp(t):typeof e=="object"?yp(e.edges):e||pg}function Qv(t,e,s,i){const n=ER(e,i),r=SR(s,i);return{nodes:t.getNodes(n),edges:t.getEdges(r)}}function Jv(t,{nodeAttributes:e,edgeAttributes:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const l=Qv(t,i,n,r);return{nodes:l.nodes.toJSON({attributes:e,data:o}),edges:l.edges.toJSON({attributes:s,data:a})}}function Vd(t,e,{styles:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const{nodes:l,edges:d}=bR(s),h=Jv(t,{nodeAttributes:l,edgeAttributes:d,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a});if(s==="original"){const u=vR(e,Qv(t,i,n,r));for(const c of h.nodes)c.id!=null&&(c.attributes=u[c.id]);for(const c of h.edges)c.id!=null&&(c.attributes=u[c.id])}return s==="all"&&h.edges.forEach(({source:u,target:c,attributes:g})=>{if(g){const m=t.getNode(u);if(g.color==="source"&&m){const p=m.getAttribute("color");g.color=Array.isArray(p)?p[0]:p}const f=t.getNode(c);if(g.color==="target"&&f){const p=f.getAttribute("color");g.color=Array.isArray(p)?p[0]:p}}}),AR(h)}function wR(t,e){for(let s=0;s<e.length;++s){if(t==null)return;t=t[e[s]]}return t}function TR(t,e,s){for(let i=0;i<e.length-1;++i){const n=e[i];let r=t[n];r===void 0&&(r={},t[n]=r),t=r}t[e[e.length-1]]=s}function IR(t){const e={...t[0]};for(const s of t)for(const i of Object.keys(s))i in e||(e[i]=void 0);return Object.keys(e)}function xp(t,e){return t==null||Array.isArray(t)&&!t.length?e:t}function LR(t){return typeof t=="string"}function CR(t,e,s,i,n){const r=e==="edges",o={};return t.forEach((a,l)=>{const d=n.get(l),h=Uh(xp(s(d),e));if(!h.every(LR))throw Error(`The tab ${e} function returned an invalid value.`);const u=Uh(i(a.data,h));h.forEach((c,g)=>{const m=xp(u[g],{}),f=Ud({internal___id:a.id,...r?{internal___source:a.source,internal___target:a.target}:{},...m}).reduce((p,{path:_,value:y})=>(p[_.join(".")]=y,p),{});o[c]=o[c]||[],o[c].push(f)})}),o}function NR(t){if(!t.length)return[];const e=IR(t),s=[e];for(const i of t)s.push(e.map(n=>i[n]));return s[0]=s[0].map(i=>i.replace("internal___","")),s}function MR(t,e,s){const i=new W0;let n=e?1:3;const r=[];for(let a=0;a<t.length;++a){const l=t[a],d=new Array(n);let h=l.data;if(s){const c={};s.forEach(g=>{const m=Tn(g),f=wR(h,m);TR(c,m,f)}),h=c}const u=Ud(h);d[0]=l.id,e||(d[1]=l.source,d[2]=l.target);for(let c=0;c<u.length;++c){const{path:g,value:m}=u[c];g.length&&(i.has(g)?d[i.get(g)]=m:(i.set(g,n),d[n]=m,n++))}r.push(d)}const o=[];return o.push("id"),e||(o.push("source"),o.push("target")),i.keys().forEach(a=>o.push(a[a.length-1])),r.unshift(o),r.forEach(a=>a.length=n),r}var RR=/[=+\-@|%]/,FR=t=>t.length>0&&RR.test(t[0])?`'${t=t.replace("|","|")}`:t;function tA(t){return t===void 0?"":t instanceof Date?t.toISOString():FR(""+t)}var PR={what:void 0,dataProperties:void 0,separator:",",textSeparator:'"',download:!0,filename:"graph.csv",filter:"visible",nodes:void 0,edges:void 0,nodeData:qs,edgeData:qs,styles:"none"};function zR(t,e){const{what:s,dataProperties:i,nodes:n,edges:r,separator:o,textSeparator:a,download:l,nodeData:d,edgeData:h,filename:u,filter:c}=fs(typeof e=="string"?{what:e}:e,PR),g=Vd(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:n,edges:r,filter:c,nodeData:d,edgeData:h});try{const m=DR(g,{what:s,separator:o,textSeparator:a,dataProperties:i});return l&&Qi(m,u,"text","text/csv"),Promise.resolve(m)}catch(m){return Promise.reject(m)}}function DR(t,{what:e,separator:s,textSeparator:i,dataProperties:n}){const r=new RegExp(i,"g");if(i&&i!=='"'&&i!=="'")throw new TypeError(`Invalid argument :"textSeparator" is not single-quote or double-quote, was ${i}`);if(e!=="nodes"&&e!=="edges")throw new TypeError('missing argument: "what": should have value "nodes" or "edges"');const o=e==="nodes";return MR(o?t.nodes:t.edges,o,n).map(a=>a.map(l=>function(h){return i+tA(h).replace(r,`${i}${i}`).replace(/\n/g,"\\n").replace(/\r/g,"")+i}(l))).map(a=>a.join(s)).join(`
`)}var Gn=t=>Math.round(255*t);function bp(t,e){if(e==="integer"&&typeof t=="number"){if(t%1!=0)return"float"}else if(typeof t!="number")return typeof t=="boolean"?"boolean":"string";return e}var qu=t=>typeof t=="object"&&t!==null&&t.constructor===Object;function ju(t,e={}){return ni(t,(s,i)=>{qu(s)?ju(s,e):e[i]=s}),e}var OR={creator:void 0,description:void 0,styles:"all",download:!0,filename:"graph.gexf",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function kR(t,e={}){const{styles:s,nodes:i,edges:n,download:r,filename:o,creator:a,description:l,filter:d,nodeData:h,edgeData:u}=fs(e,OR),c=BR(Vd(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{creator:a,description:l});return r&&Qi(c,o,"text","text/xml"),Promise.resolve(c)}function BR(t,e){const s=sv(),i={},n={};let r,o=0,a=0;const l=s.createElement("gexf");l.setAttribute("xmlns","http://www.gexf.net/1.2draft"),l.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),l.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),l.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),l.setAttribute("version","1.2");const d=s.createElement("meta");if(d.setAttribute("lastmodifieddate",xy()),e.creator){const f=s.createElement("creator");r=s.createTextNode(""+e.creator),f.appendChild(r),d.appendChild(f)}if(e.description){const f=s.createElement("description");r=s.createTextNode(""+e.description),f.appendChild(r),d.appendChild(f)}const h=s.createElement("graph");h.setAttribute("mode","static");const u=s.createElement("nodes");t.nodes.forEach(f=>{const p=s.createElement("node");if(p.setAttribute("id",String(f.id)),f.text&&p.setAttribute("label",Kn(f.text)),qu(f.data)){const y=ju(f.data),x=s.createElement("attvalues");Object.keys(y).forEach(b=>{b in i||(i[b]={id:o,type:"integer"},o++);const v=y[b];i[b].type=bp(v,i[b].type);const A=s.createElement("attvalue");A.setAttribute("for",i[b].id),A.setAttribute("value",Kn(v)),x.appendChild(A)}),p.appendChild(x)}if(f.color){const y=$e(f.color);if(y){const x=s.createElement("viz:color");x.setAttribute("r",Gn(y[0])),x.setAttribute("g",Gn(y[1])),x.setAttribute("b",Gn(y[2])),x.setAttribute("a",y[3]),p.appendChild(x)}}const _=s.createElement("viz:position");if(_.setAttribute("x",f.x),_.setAttribute("y",-f.y),p.appendChild(_),f.size){const y=s.createElement("viz:size");y.setAttribute("value",f.size),p.appendChild(y)}u.appendChild(p)});const c=s.createElement("attributes");c.setAttribute("class","node"),Object.keys(i).forEach(f=>{const p=s.createElement("attribute");p.setAttribute("id",i[f].id),p.setAttribute("title",f),p.setAttribute("type",i[f].type),c.appendChild(p)});const g=s.createElement("edges");t.edges.forEach(f=>{const p=s.createElement("edge");if(p.setAttribute("id",f.id.toString()),p.setAttribute("source",f.source),p.setAttribute("target",f.target),f.size&&p.setAttribute("weight",f.size),f.text&&p.setAttribute("label",Kn(f.text)),qu(f.data)){const _=ju(f.data),y=s.createElement("attvalues");Object.keys(_).forEach(x=>{x in n||(n[x]={id:a,type:"integer"},a++);const b=_[x];n[x].type=bp(b,n[x].type);const v=s.createElement("attvalue");v.setAttribute("for",n[x].id),v.setAttribute("value",Kn(b)),y.appendChild(v)}),p.appendChild(y)}if(f.color){const _=$e(f.color);if(_){const y=s.createElement("viz:color");y.setAttribute("r",Gn(_[0])),y.setAttribute("g",Gn(_[1])),y.setAttribute("b",Gn(_[2])),y.setAttribute("a",_[3]),p.appendChild(y)}}if(f.size){const _=s.createElement("viz:size");_.setAttribute("value",f.size),p.appendChild(_)}g.appendChild(p)});const m=s.createElement("attributes");return m.setAttribute("class","edge"),Object.keys(n).forEach(f=>{const p=s.createElement("attribute");p.setAttribute("id",n[f].id),p.setAttribute("title",f),p.setAttribute("type",n[f].type),m.appendChild(p)}),h.appendChild(c),h.appendChild(m),h.appendChild(u),h.appendChild(g),l.appendChild(d),l.appendChild(h),s.appendChild(l),`<?xml version="1.0" encoding="UTF-8"?>${s.serialize()}`}var UR={graphId:"G",directedEdges:!0,styles:"all",download:!0,filename:"graph.graphml",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function GR(t,e){const{styles:s,nodes:i,edges:n,download:r,filename:o,graphId:a,directedEdges:l,filter:d,nodeData:h,edgeData:u}=fs(e,UR),c=VR(Vd(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{graphId:a,directedEdges:l,noStyles:s==="none"});return r&&Qi(c,o,"text","text/xml"),Promise.resolve(c)}function VR(t,e){const s=iv();function i(c,g,m,f,p){m=m||{};const _=s.createElement(g);for(const y in m){if(!Object.prototype.hasOwnProperty.call(m,y))continue;const x=m[y];x!==void 0&&_.setAttribute(y,x)}return(f!==void 0||p)&&(Object.prototype.toString.call(f)==="[object Object]"&&(f=JSON.stringify(f)),_.appendChild(s.createTextNode(f))),c.appendChild(_),_}const n=["id","source","target"],r=["size","x","y","shape","text","color"],o={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}};e.noStyles&&(delete o.color,delete o.r,delete o.g,delete o.b,delete o.a,delete o.shape,r.pop());const a=[],l=[];function d(c,g){const m={id:c.id};r.forEach(f=>{let p=c[f];f==="y"&&p&&(p=-parseFloat(p)),p!==void 0&&(m[(g==="edge"?"edge_":"")+f]=p,f==="color"&&function(y,x){const b=$e(x);b&&(y.r=b[0],y.g=b[1],y.b=b[2])}(m,p))}),ni(c.data||{},(f,p)=>{r.indexOf(p)===-1&&n.indexOf(p)===-1&&(o[p]?o[p].for!==g&&(o[p].for="all"):o[p]={for:g,type:"string"},m[p]=f)}),g==="edge"?(m.source=c.source,m.target=c.target,l.push(m)):a.push(m)}t.nodes.forEach(c=>d(c,"node")),t.edges.forEach(c=>d(c,"edge"));const h=i(s,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});ni(o,(c,g)=>{c.for!=="node"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"node",id:g}),c.for!=="edge"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"edge",id:"edge_"+g})}),i(h,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"}),i(h,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});const u=i(h,"graph",{edgedefault:e.directedEdges||e.directedEdges===void 0?"directed":"undirected",id:e.graphId?e.graphId:"G","parse.nodes":t.nodes.length,"parse.edges":t.edges.length,"parse.order":"nodesfirst"});return a.forEach(c=>{const g=i(u,"node",{id:c.id});(function(f,p){const _=i(f,"data",{key:"nodegraphics"}),y=i(_,"y:ShapeNode");i(y,"y:Geometry",{x:p.x,y:p.y,width:p.size,height:p.size}),e.noStyles||i(y,"y:Fill",{color:yu(p.color),transparent:!1}),i(y,"y:NodeLabel",null,p.text||""),i(y,"y:Shape",{type:p.shape})})(g,c),ni(c,(m,f)=>{n.indexOf(f)===-1&&i(g,"data",{key:f},m,!0)})}),l.forEach(c=>{const g=i(u,"edge",{id:c.id,source:c.source,target:c.target});(function(f,p){const _=i(f,"data",{key:"edgegraphics"}),y=i(_,"y:PolyLineEdge");i(y,"y:LineStyle",{type:p.edge_type,color:e.noStyles?void 0:yu(p.edge_color),width:p.edge_size}),i(y,"y:EdgeLabel",null,p.edge_label)})(g,c),ni(c,(m,f)=>{n.indexOf(f)===-1&&i(g,"data",{key:f},m,!0)})}),`<?xml version="1.0" encoding="UTF-8"?>
${dg(s)}`}var qR={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:qs,edgeData:qs,filter:"visible",pretty:!1,download:!0,filename:"graph.json",anonymize:!1};function jR(t,e={}){e.anonymize&&(e={nodeAttributes:"all",edgeAttributes:"all",nodeData:kl,edgeData:kl,filter:e.filter||"all",download:e.download,pretty:e.pretty,filename:e.filename});const{nodeAttributes:s,edgeAttributes:i,nodeData:n,edgeData:r,filter:o,pretty:a,download:l,filename:d}=fs(e,qR),h=Jv(t.modules.graph,{nodeAttributes:s,edgeAttributes:i,filter:o,nodeData:n,edgeData:r}),u=a?JSON.stringify(h,null," "):JSON.stringify(h);return l&&Qi(u,d,"text","application/json"),Promise.resolve(h)}function YR(t,e){return t.getBoundingBox().computeForZoom(e).extend(rs.fromValues(t.getAttribute("x"),t.getAttribute("y"),t.map(s=>s.getAttribute("radius")+s.getAttribute("innerStroke.width")+s.getAttribute("outerStroke.width"))))}function HR(t,e,s){const i=e.view.graphToScreenCoordinates(s.bottomLeft()),n=e.view.graphToScreenCoordinates(s.topRight()),r=Math.abs(n.x-i.x),o=Math.abs(n.y-i.y),a=Math.min(t.width/r,t.height/o);t.width=r*a,t.height=o*a}function eA(t,e={}){const s=t.view.get(),i=typeof e.margin=="number"?e.margin:0,n={pixelRatio:e.pixelRatio||gs(),angle:0,backgroundColor:null,zoom:0,x:0,y:0,width:0,height:0,hideImages:!1,renderBackground:!0,isBufferDisplayable:Ol};if(e.width&&e.height?(n.width=e.width,n.height=e.height):(n.width=s.width,n.height=s.height),e.clip)n.zoom=s.zoom,n.x=s.x,n.y=s.y;else{const r=YR(t.getNodes(e.filter),s.zoom);if(e.texts){const o=t.modules.labels.getTextsBoundingBox();o.isValid()&&r.extend(o)}e.width!=null&&isFinite(e.width)&&e.height!=null&&isFinite(e.height)||HR(n,t,r),n.width=Math.max(n.width,2*i),n.height=Math.max(n.height,2*i),n.x=r.cx,n.y=r.cy,n.zoom=Math.min((n.width-2*i)/r.width,(n.height-2*i)/r.height)}return t.modules.geo.isEnabled()?n.backgroundColor=null:e.background!==void 0&&(n.backgroundColor=e.background),n}function Yu(t,e,s,i,n=!1){const r={...s,hideImages:n,angle:s.angle||0,currentTime:Xe(),isBufferDisplayable:l=>e.texts||!Zb(l),bentEnable:!1,bentVertical:!1},o={};if(e.badges===!1){const l={text:null,image:null};o.badges={topLeft:l,topRight:l,bottomRight:l,bottomLeft:l}}const a=t.styles.getClass(fn);return a&&a.update({nodeAttributes:o}),t.modules.graphics.export(i,r,e.filter||pg,e)}var Za=t=>({download:!0,filter:"visible",filename:`graph.${t}`,clip:!1,margin:10,width:void 0,height:void 0,background:null,badges:!0,legend:void 0,texts:!0,preventOverlap:!0,images:!0,textWatermark:{content:"",fontFamily:"Arial",fontSize:48,fontStyle:void 0,fontColor:"red",repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageWatermark:{url:void 0,width:void 0,height:void 0,repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageCrossOrigin:void 0,layers:!0,pixelRatio:void 0}),XR={png:Za("png"),jpg:Za("jpg"),tiff:Za("tiff"),gif:Za("gif")};function $R(t){const{canvas:e,parameters:s}=t;return s.textWatermark.content&&vp(e,s.textWatermark,sF,iF),s.imageWatermark.url?rx(s.imageWatermark.url).then(i=>(i&&(s.imageWatermark.content=i,vp(e,s.imageWatermark,rF,nF)),t)):t}function WR(t){const{ogma:e,canvas:s,parameters:i}=t,n=e.modules.legend;let r=null;return i.legend===void 0&&(r=!!n.enabled()&&n.getCurrentOptions()),i.legend===!0&&(r={}),r&&n.exportOnCanvas(s,r,t.parameters.pixelRatio),t}function ZR(t){const{canvas:e,parameters:s,view:i}=t;if(!i.renderBackground)return t;i.renderBackground=!1;const n=e.getContext("2d");return n.fillStyle=s.background,n.fillRect(0,0,e.width,e.height),t}function KR(t){const{ogma:e,view:s}=t;return e.modules.geo.isEnabled()?e.modules.geo.exportBackground(s).then(i=>{const n=s.width*s.pixelRatio,r=s.height*s.pixelRatio,o=Ge(n,r),a=o.getContext("2d");return a.drawImage(i,(n-i.width)/2,(r-i.height)/2),a.drawImage(t.canvas,0,0),t.canvas=o,t}):t}function QR(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,canvas:i,below:!0}).then(()=>t):t}function JR(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,below:!1,canvas:i}).then(()=>t):t}function tF(t){const{ogma:e,parameters:s,canvas:i,view:n}=t,r=i.getContext("2d");return Yu(e,s,n,"canvas",!s.images).then(o=>{try{const a=o.getContext("2d");if(!a)throw new Error("Failed to render graph");return a.getImageData(0,0,1,1),r.drawImage(o,0,0,i.width,i.height),t}catch(a){return Vi(a),Yu(e,s,n,"canvas",!0).then(l=>(r.drawImage(l,0,0,i.width,i.height),t))}})}function eF({canvas:t,parameters:e,type:s}){const i=t.toDataURL("image/"+s);return e.download&&Qi(i,e.filename,"dataURL","image/"+s),i}function Ka(t,e,s){const i=fs(e,XR[s]);i.filename.endsWith(s)||(i.filename+="."+s),i.background===null&&(i.background=t.modules.graphics.getTransparentBackgroundColor());const n=eA(t,i);i.pixelRatio=n.pixelRatio;const r=Ge(n.width*n.pixelRatio,n.height*n.pixelRatio),o={ogma:t,parameters:i,canvas:r,view:n,type:s};return Promise.resolve().then(()=>o).then(ZR).then(KR).then(QR).then(tF).then(JR).then($R).then(WR).then(eF).then(a=>(t.modules.events.fire("afterImageExport"),a))}function sF(t,e,s,i){t.textAlign="center",t.textBaseline="middle",t.fillText(e,s,i)}function iF(t,e,s){return{width:t.measureText(e).width,height:s}}function nF(t,e,s,i,n){return{width:i===void 0?e.width:i,height:n===void 0?e.height:n}}function rF(t,e,s,i,n,r){t.drawImage(e,s-n/2,i-r/2,n,r)}function vp(t,e,s,i){if(!e)return;if(typeof e!="object")e={content:e};else if(!e.content)return;const{fontFamily:n,fontSize:r,fontStyle:o,fontColor:a,repeat:l,alpha:d,space:h,content:u}=e;let c=e.angle;const g=t.getContext("2d"),m=t.width,f=t.height,p=e.x===void 0?m/2:e.x,_=e.y===void 0?f/2:e.y,y=e.height,x=e.width;c=c/180*Math.PI,$i(g,n,r,o),g.fillStyle=a,g.globalAlpha=d;const b=i(g,u,r,x,y);if(l){const v=b.width+h,A=b.height+h,E=Math.sqrt(m*m+f*f);g.save(),g.translate(0,0),g.rotate(c);for(let S=0;S<E;S+=v)for(let w=0;w<E;w+=A)s(g,u,S,w,b.width,b.height),w!==0&&s(g,u,S,-w,b.width,b.height);g.restore()}else g.save(),g.translate(p,_),g.rotate(c),s(g,u,0,0,b.width,b.height),g.restore()}var oF={download:!0,filename:"graph.svg",width:void 0,height:void 0,background:null,texts:!0,preventOverlap:!0,groupSemantically:!0,images:!0,badges:!0,embedFonts:!1,layers:!0,clip:!1,margin:10,prefix:"ogma"};function aF(t,e){const s=fs(e,oF),{background:i,filename:n,download:r,layers:o}=s,a=t.modules.graphics;i===null&&(s.background=a.getTransparentBackgroundColor());const l=eA(t,s);return Yu(t,s,l,"svg",!s.images).then(d=>(d.removeAttribute("pointer-events"),d.setAttribute("version","1.1"),d.setAttributeNS(Xh,"xmlns",_c),d.setAttributeNS(Xh,"xmlns:xlink",nx),d)).then(d=>s.groupSemantically?dF(t,d,s):d).then(d=>uF(d,s)).then(d=>lF(t,l,d)).then(d=>Ap(t,l,d,o,!0)).then(d=>Ap(t,l,d,o,!1)).then(d=>(t.modules.events.fire("afterImageExport"),d)).then(d=>{const h=`<?xml version="1.0" encoding="utf-8"?>${dg(d)}`;return r&&Qi(h,n,"text","image/svg+xml"),h})}function lF(t,e,s){return t.modules.geo.isEnabled()?t.modules.geo.exportBackground({...e,pixelRatio:1}).then(i=>{const n=se("image",{width:i.width,height:i.height,x:0,y:0,href:i.toDataURL()});return s.insertBefore(n,s.children[0]),s}):Promise.resolve(s)}function Ap(t,e,s,i,n=!1){return i?t.modules.layers.export({view:e,svg:s,below:n}).then(()=>s):Promise.resolve(s)}function dF(t,e,s){const i=e.childNodes[2],n=i.childNodes,r={},o=s.prefix;for(let g=0;g<n.length;g++){const m=n[g],f=m.getAttribute(vs);f!=null&&(r[f]=r[f]||[],r[f].push(m))}const a=Object.keys(r),l=t.modules.graph,d=l.getNodeAttribute("id"),h=l.getEdgeAttribute("id"),u=se("g",{class:`${o}-edges`}),c=se("g",{class:`${o}-nodes`});for(let g=0;g<a.length;g++){const m=a[g],f=m.charAt(0)==="n",p=parseInt(m.substring(1)),_=r[m],y=Kn((f?d:h).get(p).toString()),x=se("g");x.setAttribute(`data-${f?"node":"edge"}-id`,y),x.setAttribute("class",`${o}-${f?"node":"edge"}`);for(let b=0;b<_.length;b++){const v=_[b];x.appendChild(v),v.removeAttribute(vs)}(f?c:u).appendChild(x)}return i.appendChild(u),i.appendChild(c),e}function hF(t){const e=[].concat(Array.prototype.slice.call(t.getElementsByTagName("text")||[])),s=[],i={};for(let n=0;n<e.length;n++){const r=e[n].parentNode.getAttribute("font-family");if(typeof r=="string"){const o=r.split(",");for(let a=0;a<o.length;a++){const l=o[a].replace(/['"]/g,"");l===""||i[l]||(i[l]=!0,s.push(l))}}}return{list:s,map:i}}function uF(t,e){const s=hF(t).map;return Y0().then(i=>i.filter(n=>s[n.name])).then(i=>H0(i,!!e.embedFonts)).then(i=>{if(i.length!==0){const n=se("style");for(let r=0;r<i.length;r++)n.appendChild(yc(i[r]));t.childNodes[0].appendChild(n)}return t})}var cF={what:void 0,dataProperties:void 0,filter:"visible",nodes:void 0,edges:void 0,download:!0,filename:"graph.xlsx",tab:void 0,nodeData:void 0,edgeData:void 0};function gF(t,e={}){typeof e=="string"&&(e={what:e});const{what:s,nodes:i,edges:n,tab:r={nodes:()=>"nodes",edges:()=>"edges"},download:o,filename:a,dataProperties:l,filter:d,nodeData:h,edgeData:u}=fs(e,cF);r.nodes||(r.nodes=()=>"nodes"),r.edges||(r.edges=()=>"edges");const c=Vd(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:i,edges:n,filter:d,nodeData:m=>m,edgeData:m=>m}),g=mF(c,{what:s,tabFunctions:r,tabContentFunctions:{nodes:h||(m=>jh(Mo(m||{}),l)),edges:u||(m=>jh(Mo(m||{}),l))}},{nodes:t.modules.graph.getNodes(c.nodes.map(({id:m})=>m)),edges:t.modules.graph.getEdges(c.edges.map(({id:m})=>m))});return o&&Qi(g,a,"blob","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),Promise.resolve(g)}function mF(t,{what:e,tabFunctions:s,tabContentFunctions:i},n){const r=Ts("XLSX")||Ts("xlsx",{throwOnError:!0});if(!r)throw Error('The xlsx exports requires the "xlsx" peer dependency to be associated');const o=new pF;if(e){if(e!=="nodes"&&e!=="edges")throw new TypeError(`Invalid argument: "what" is not "nodes" or "edges", was ${e}`);e==="nodes"&&(t.edges=[]),e==="edges"&&(t.nodes=[])}const a={};for(const l of["nodes","edges"]){const d=CR(t[l],l,s[l],i[l],n[l]);for(const h of Object.keys(d))a[h]=[...a[h]||[],...d[h]]}for(const l of Object.keys(a))o.SheetNames.push(l),o.Sheets[l]=fF(r,NR(a[l]));return o.SheetNames.length===0&&(o.SheetNames=["nodes","edges"],o.Sheets.nodes={},o.Sheets.edges={}),Ro([_F(r.write(o,{bookType:"xlsx",bookSST:!1,type:"binary"}))],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")}function fF(t,e){const s={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let n=0;n!==e.length;++n){const r=e[n];for(let o=0;o!==r.length;++o){const a=r[o];i.s.r>n&&(i.s.r=n),i.s.c>o&&(i.s.c=o),i.e.r<n&&(i.e.r=n),i.e.c<o&&(i.e.c=o);const l={v:tA(a)};s[t.utils.encode_cell({c:o,r:n})]=l}}return i.s.c<1e7&&(s["!ref"]=t.utils.encode_range(i)),s}var pF=class{constructor(){this.SheetNames=[],this.Sheets={}}};function _F(t){const e=new ArrayBuffer(t.length),s=new Uint8Array(e);for(let i=0;i!==t.length;++i)s[i]=255&t.charCodeAt(i);return e}var yF=class extends ce{constructor(t){super(t),this.csv=e=>zR(this._ogma,e),this.xlsx=e=>(e&&e.dataProperties&&void 0,gF(this._ogma,e)),this.gexf=e=>kR(this._ogma,e),this.graphml=(e={})=>GR(this._ogma,e),this.json=(e={})=>jR(this._ogma,e),this.svg=(e={})=>aF(this._ogma,e),this.png=(e={})=>Ka(this._ogma,e,"png"),this.jpg=(e={})=>Ka(this._ogma,e,"jpg"),this.tiff=(e={})=>Ka(this._ogma,e,"tiff"),this.gif=(e={})=>Ka(this._ogma,e,"gif"),t.styles.createClass({name:fn,isBuiltin:!0})}};/**
 * Ogma Generators
 * @description Graphs Generators for Ogma
 * @version 0.0.18 (built on Wed Aug 06 2025 13:07:32 GMT+0000 (Coordinated Universal Time))
 * @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
 * @license (c) Linkurious 2025. All rights reserved.
 * @preserve
 */function xF(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ep,Sp={exports:{}};function bF(){return Ep||(Ep=1,Sp.exports=function(){return t.importState=function(s){var i=new t;return i.importState(s),i},t;function t(){return function(s){var i=0,n=0,r=0,o=1;s.length==0&&(s=[+new Date]);var a=e();i=a(" "),n=a(" "),r=a(" ");for(var l=0;l<s.length;l++)(i-=a(s[l]))<0&&(i+=1),(n-=a(s[l]))<0&&(n+=1),(r-=a(s[l]))<0&&(r+=1);a=null;var d=function(){var h=2091639*i+23283064365386963e-26*o;return i=n,n=r,r=h-(o=0|h)};return d.next=d,d.uint32=function(){return 4294967296*d()},d.fract53=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.version="Alea 0.9",d.args=s,d.exportState=function(){return[i,n,r,o]},d.importState=function(h){i=+h[0]||0,n=+h[1]||0,r=+h[2]||0,o=+h[3]||0},d}(Array.prototype.slice.call(arguments))}function e(){var s=4022871197,i=function(n){n=n.toString();for(var r=0;r<n.length;r++){var o=.02519603282416938*(s+=n.charCodeAt(r));o-=s=o>>>0,s=(o*=s)>>>0,s+=4294967296*(o-=s)}return 23283064365386963e-26*(s>>>0)};return i.version="Mash 0.9",i}}()),Sp.exports}var vF=bF(),AF=xF(vF),EF=AF(42),Le=()=>EF.next(),SF=({nodes:t=10,edges:e=10,texts:s=!1,scale:i=100}={})=>({nodes:t,edges:e,texts:s,scale:i});function wF({nodes:t,scale:e,texts:s,edges:i}){const n=[],r=[];for(let o=0;o<t;o++)n.push({id:o,attributes:{x:Le()*e,y:Le()*e,text:s?`Node ${o}`:void 0}});for(let o=0;o<i;o++)r.push({id:o,source:Le()*t|0,target:Le()*t|0,attributes:{text:s?`Edge ${o}`:void 0}});return{nodes:n,edges:r}}var wp=Object.freeze(Object.defineProperty({__proto__:null,configure:SF,generate:wF},Symbol.toStringTag,{value:"Module"})),TF=({rows:t=4,columns:e=4,columnDistance:s=20,rowDistance:i=20,xmin:n=0,ymin:r=0}={})=>({rows:t,columns:e,columnDistance:s,rowDistance:i,xmin:n,ymin:r});function IF({rows:t,columns:e,columnDistance:s,rowDistance:i,xmin:n,ymin:r}){const o={nodes:[],edges:[]};let a=0;for(let l=0;l<t;++l)for(let d=0;d<e;++d){const h=l*e+d;o.nodes.push({id:h,attributes:{x:n+d*s,y:r+l*i}}),d!==e-1&&(o.edges.push({id:a,source:h,target:l*e+d+1}),a++),l!==t-1&&(o.edges.push({id:a,source:h,target:(l+1)*e+d}),a++)}return o}var Tp=Object.freeze(Object.defineProperty({__proto__:null,configure:TF,generate:IF},Symbol.toStringTag,{value:"Module"})),LF=({length:t=5,scale:e=100}={})=>({length:t,scale:e});function CF({length:t,scale:e}){const s={nodes:[],edges:[]};if(t<=0)return s;s.nodes.push({id:0,attributes:{x:Le()*e,y:Le()*e}});for(let i=1;i<t;++i)s.nodes.push({id:i,attributes:{x:Le()*e,y:Le()*e}}),s.edges.push({id:i-1,source:i-1,target:i});return s}var Ip=Object.freeze(Object.defineProperty({__proto__:null,configure:LF,generate:CF},Symbol.toStringTag,{value:"Module"}));function NF(t){return typeof t=="number"&&isFinite(t)&&t>=0?t:void 0}function MF(t){return typeof t=="number"&&isFinite(t)&&t>0?t:void 0}function ho(t){return typeof t=="number"&&isFinite(t)?t:void 0}function RF({children:t=2,height:e=3}={}){if(!MF(t))throw new TypeError('Invalid argument: "children" is not a positive number, was '+t);if(!NF(e))throw new TypeError('Invalid argument: "height" is not a positive number, was '+e);return{children:t,height:e}}function FF({children:t,height:e}){e+=1;const s=Math.pow(t,e),i=[],n=[];let r=1,o=0,a=0;for(let l=0;l<e;++l){const d=s/(r+1)/1.5;for(let h=0;h<r;++h){const u=o++;if(i.push({id:u,attributes:{x:(h+1)*d*10,y:20*l}}),l!==e-1)for(let c=0;c<t;++c)n.push({id:a,source:u,target:u*t+c+1}),a+=1}r*=t}return{nodes:i,edges:n}}var Lp=Object.freeze(Object.defineProperty({__proto__:null,configure:RF,generate:FF},Symbol.toStringTag,{value:"Module"}));function PF({nodes:t=20,edges:e,p:s,scale:i=100}={}){if(!ho(t)||t<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t);if(e!==void 0&&s!==void 0)throw new TypeError("Invalid argument: choose between options.edges and options.p");return e===void 0&&s===void 0&&(s=.1),s===void 0&&(s=-1),e===void 0&&(e=-1),{nodes:t,p:s,edges:e,scale:i}}function zF(t){const e={nodes:[],edges:[]},s=t.nodes,i=t.p,n=t.scale;if(i>=0){let r=0;for(let o=0;o<s;o++){e.nodes.push({id:o,attributes:{x:Le()*n,y:Le()*n}});for(let a=0;a<o;a++)Le()<i&&e.edges.push({id:r++,source:o,target:a})}}else{const r=[],o=t.edges;for(let l=0;l<s;l++){e.nodes.push({id:l,attributes:{x:100*Le(),y:100*Le()}});for(let d=l+1;d<s;d++)r.push({source:l,target:d})}let a=r.length-1;for(let l=0;l<o;l++){const d=r.splice(Math.floor(Le()*a),1)[0];d.id=l,e.edges.push(d),a--}}return e}var Cp=Object.freeze(Object.defineProperty({__proto__:null,configure:PF,generate:zF},Symbol.toStringTag,{value:"Module"}));function DF({nodes:t=40,m0:e=5,m:s=1,scale:i=100}={}){if(!ho(t)||t<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t);if(!ho(e)||e>=t)throw new TypeError(`Invalid argument: options.m0 is not a number < ${t}, was ${e}`);if(!ho(e)||s>=e)throw new TypeError(`Invalid argument: options.m is not a number <= ${e}, was ${s}`);if(!ho(i)||i<0)throw new TypeError("Invalid argument: options.scale is not a number or is less than 0");return{nodes:t,m0:e,m:s,scale:i}}function OF({scale:t,nodes:e,m0:s,m:i}){const n={nodes:[],edges:[]},r={},o=[],a=t/10;let l=0;for(let d=0;d<s;d++)n.nodes.push({id:d,attributes:{x:Le()*a,y:Le()*a}}),o[d]=0;for(let d=0;d<s;d++)for(let h=d+1;h<s;h++){const u={id:l++,source:d,target:h};r[u.source+"-"+u.target]=u,n.edges.push(u),o[d]++,o[h]++}for(let d=s;d<e;d++){n.nodes.push({id:d,attributes:{x:Le()*t,y:Le()*t}}),o[d]=0;let h=0;for(let c=0;c<d;c++)h+=o[c];let u=0;for(let c=0;c<i;c++){const g=Le();let m=0;for(let f=0;f<d;f++)if(!r[`${d}-${f}`]&&!r[`${f}-${d}`]&&(m=d===1?1:m+o[f]/h+u/(d-c),g<=m)){u+=o[f]/h;const p={id:l++,source:d,target:f};r[`${p.source}-${p.target}`]=p,n.edges.push(p),o[d]++,o[f]++;break}}}return n}var Np=Object.freeze(Object.defineProperty({__proto__:null,configure:DF,generate:OF},Symbol.toStringTag,{value:"Module"}));function kF({nodes:t=50,width:e=100,height:s=100,x:i=0,y:n=0}={}){if(!isFinite(t)||t<1)throw new RangeError("Tree generator: number of nodes must be a positive integer");return{nodes:t,width:e,height:s,x:i,y:n}}function BF({nodes:t,x:e,y:s,width:i,height:n}){const r=e-i/2,o=s-n/2;return{nodes:new Array(t).fill(0).map((a,l)=>({id:l,attributes:{x:r+Le()*i,y:o+Le()*n}})),edges:new Array(t-1).fill(0).map((a,l)=>({id:l,source:Math.floor(Math.sqrt(l)),target:l+1}))}}var Mp=Object.freeze(Object.defineProperty({__proto__:null,configure:kF,generate:BF},Symbol.toStringTag,{value:"Module"})),UF=5,GF=10,VF=10,qF=2.7,jF=.2;function YF({depth:t=3,breadth:e=3,nodes:s}){return s!==void 0?(e=5,t=Math.ceil(Math.log(s)/Math.log(5))):s=-1,{depth:t,breadth:e,nodes:s}}function HF({depth:t,breadth:e,nodes:s}){const i={id:0,attributes:{x:0,y:0,radius:iA(t+1)}},n={nodes:[i],edges:[]};return nA(n,e,t,i,1),s!==void 0&&s>=0&&(n.nodes=n.nodes.slice(0,s),n.edges=n.edges.slice(0,Math.max(s-1,0))),n}function sA(t){return Math.pow(qF,t)*GF}function iA(t){return UF+sA(t)/VF}function nA(t,e,s,i,n){if(s===0)return n;const r=sA(s),o=iA(s),a=o*jF;let l=-Math.PI;const d=2*Math.PI/e,h=i.attributes.x||0,u=i.attributes.y||0;for(let c=0;c<e;++c){const g={id:n,attributes:{x:h+r*Math.cos(l),y:u+r*Math.sin(l),radius:o}},m={id:n,source:i.id,target:n,attributes:{width:a}};t.nodes.push(g),t.edges.push(m),n=nA(t,e,s-1,g,n+1),l+=d}return n}var Rp=Object.freeze(Object.defineProperty({__proto__:null,configure:YF,generate:HF},Symbol.toStringTag,{value:"Module"})),XF=class extends ce{constructor(){super(...arguments),this.balancedTree=t=>Promise.resolve(Lp.generate(Lp.configure(t))),this.barabasiAlbert=t=>Promise.resolve(Np.generate(Np.configure(t))),this.erdosRenyi=t=>Promise.resolve(Cp.generate(Cp.configure(t))),this.flower=t=>Promise.resolve(Rp.generate(Rp.configure(t))),this.grid=t=>Promise.resolve(Tp.generate(Tp.configure(t))),this.path=t=>Promise.resolve(Ip.generate(Ip.configure(t))),this.random=t=>Promise.resolve(wp.generate(wp.configure(t))),this.randomTree=t=>Promise.resolve(Mp.generate(Mp.configure(t)))}},$F=class extends ce{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.geo.enable(t),this.disable=t=>this._ogma.modules.geo.disable(t),this.setOptions=t=>this._ogma.modules.geo.setOptions(t),this.getOptions=()=>this._ogma.modules.geo.getOptions(),this.getMap=()=>this._ogma.modules.geo.getMap(),this.enabled=()=>this._ogma.modules.geo.isEnabled(),this.getCenter=()=>this._ogma.modules.geo.getCenter(),this.getView=()=>this._ogma.modules.geo.getView(),this.getZoom=()=>this._ogma.modules.geo.getZoom(),this.setZoom=t=>this._ogma.modules.geo.setZoom(t),this.setView=(t,e,s)=>this._ogma.modules.geo.setView(t,e,s),this.setCenter=(t,e)=>this._ogma.modules.geo.setCenter(t,e),this.toggle=t=>this._ogma.modules.geo.toggle(t),this.resetCoordinates=()=>this._ogma.modules.geo.resetCoordinates(),this.getUnprojectedCoordinates=t=>this._ogma.modules.geo.getUnprojectedCoordinates(this._ogma.getNodes(t)),this.runLayout=async({type:t,nodes:e,latitudePath:s=ei,longitudePath:i=si,options:n,center:r})=>{if(t===void 0||n===void 0)throw new Error("Ogma.geo.runLayout: Both layout type and options are required");if(e=this._ogma.getNodes(e),r===void 0){let o=0;if(r=e.reduce((a,l)=>{const d=l.getData(s),h=l.getData(i);return isNaN(d)||isNaN(h)||(a.latitude+=d,a.longitude+=h,o++),a},{latitude:0,longitude:0}),isNaN(r.latitude)||isNaN(r.longitude))throw new Error("Ogma.geo.runLayout: No valid center coordinates found");r.latitude/=o,r.longitude/=o}return this._ogma.modules.geo.runLayout({center:r,nodes:e,type:t,options:n,latitudePath:s,longitudePath:i})}}},WF=class{reloadFonts(){this.modules.graphics.reloadFonts()}},ZF=class extends ce{constructor(){super(...arguments),this.gexf=t=>Hv(t),this.gexfFromUrl=t=>mg(t),this.janus=t=>Xv(t),this.json=(t,e)=>$v(t,e),this.jsonFromUrl=(t,e)=>fg(t,e),this.neo4j=t=>Wv(t),this.graphml=(t,e)=>Zv(t,e),this.graphmlFromUrl=(t,e)=>Kv(t,e)}},KF=class extends ce{constructor(){super(...arguments),this.isKeyPressed=t=>this._ogma.modules.keyboard.isPressed(t),this.resetKeys=()=>{this._ogma.modules.keyboard.resetKeys()}}},QF=class extends ce{addLayer(t,e){return this._ogma.modules.layers.addLayer(t,"layer",e)}addCanvasLayer(t,e,s){return this._ogma.modules.layers.addCanvasLayer(t,e,s)}addOverlay(t,e){if(!t.position)throw new Error("options.position argument is required");return this._ogma.modules.layers.addOverlay(t,e)}addSVGLayer(t,e){return t.element||(t.element=document.createElementNS("http://www.w3.org/2000/svg","svg")),t.draw||(t.draw=()=>{}),this._ogma.modules.layers.addSVGLayer(t,e)}},Fp={name:"concentric",configure:function(t,{graph:e,data:s}){if(t.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');const i={...t,centralNode:function(b,v){return v instanceof Vs?v:b.getNode(v)}(e,t.centralNode)},{centralNode:n,nodes:r}=i,o=e.getNode(n);if(o===void 0)throw new Error('concentric layout: "centralNode" parameter is not valid');const a=o._index,{x:l,y:d}=o.getPosition(),h=r.getAttribute("layoutable"),u=e.getNodes(r)._indexes,c=Array.from(u.filter((x,b)=>h[b]));c.indexOf(a)===-1&&c.push(a);const g=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(u),m=function(b,v,A,E){if(v)return v==="random"?"random":v==="radius"?E.slice():v==="degree"?A.getDegree():b.getProperty(A,v)}(s,i.sortBy,r,g),f=c.reduce((x,b,v)=>(x[b]=v,x),{}),p=c.map((x,b)=>b),_=new Set(t.edges.getExtremities()._indexes),y=c.map(x=>e.topology.getAdjacentElements(!0,new Uint32Array([x])).filter(b=>_.has(b)).map(b=>f[b]));return{sourceNodeIndex:c.indexOf(a),centerX:typeof i.centerX=="number"?i.centerX:l,centerY:typeof i.centerY=="number"?i.centerY:d,list:c,indexes:p,size:c.length,totalSize:c.length,attributes:{adjacentNodes:y,size:g},sortAttr:m,clockwise:i.clockwise===void 0||i.clockwise,circleHopRatio:i.circleHopRatio||5,allowOverlap:!!i.allowOverlap}},context:function(){return{dijkstra:function(t,e,s,i,n){const r=Math.pow(2,31)-1,o=new Int32Array(i),a=new Int32Array(i),l=new Int8Array(i);o.fill(r),a.fill(-1);for(let h=0;h<i;++h){const u=e[h];u!==void 0&&(o[u]=r,a[u]=-1)}o[n]=0;let d=0;for(;d!==-1;){let h=r;d=-1;for(let u=0;u<s;++u){const c=e[u],g=o[c];!l[c]&&g<h&&(h=g,d=c,l[c]=1)}if(d>-1){const u=t[d],c=h+1;u.forEach(g=>{const m=o[g];c<m&&(o[g]=c,a[g]=d)})}}return o},determinePropertyType:function(t,e,s){return e.some(i=>t[i]!=="number")?"string":"number"}}},update:function(t,e){const{attributes:s,indexes:i,size:n}=t,{sourceNodeIndex:r,centerX:o,centerY:a,sortAttr:l}=t,d=s.adjacentNodes,h=s.size,u=new Array(t.totalSize),c=new Array(t.totalSize),g=e.dijkstra(d,i,t.size,t.totalSize,r);let m=0;const f={};for(let A=0;A<n;A++){const E=h[i[A]];E>m&&(m=E)}const p=m*t.circleHopRatio;let _=0,y=0;const x=Math.PI/9;for(let A=0;A<n;A++){const E=i[A],S=g[E];let w=f[S];w||(w=[],f[S]=w),w.push(E)}const b=function(E,S,w){if(E==="random")return function(){return Math.random()-.5};if(E)return w.determinePropertyType(E,S,S.length)==="number"?function(T,L){return E[T]-E[L]}:function(T,L){return E[T]<E[L]?-1:1}}(l,i,e),v=l==="random"||l;return Object.keys(f).sort((A,E)=>parseInt(A)-parseInt(E)).forEach((A,E)=>{const S=f[A],w=S.length;let T=0,L=y;const R=2*Math.PI/w;if(E!==0&&!t.allowOverlap){const k=2*Math.PI*_;let j=0;T+=S.reduce((z,q)=>z+h[q],0),j=2*T*Math.SQRT2,j>k&&(_+=j/(2*Math.PI)-_)}v&&(S.sort(b),t.clockwise||S.reverse());for(let k=0;k<w;k++){const j=S[k];u[j]=Math.cos(L)*_+o,c[j]=Math.sin(L)*_+a;const z=h[j];L+=R*(t.allowOverlap?1:z/T*w)}_+=p,y+=x}),{x:u,y:c,indexes:t.list}},isRunning:function(){return!1},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}},JF=t=>(t.modules.layouts.register(Fp),e=>t.modules.layouts.start(Fp.name,e)),tP=Object.defineProperty,bt=(t,e)=>tP(t,"name",{value:e,configurable:!0});function Er(t){let e=0,s=0;for(const o of t)e+=o.w*o.h,s=Math.max(s,o.w);t.sort((o,a)=>a.h-o.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let n=0,r=0;for(const o of t)for(let a=i.length-1;a>=0;a--){const l=i[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,r=Math.max(r,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===l.w&&o.h===l.h){const d=i.pop();a<i.length&&(i[a]=d)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(i.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:n,h:r,fill:e/(n*r)||0}}bt(Er,"Z");var Pp=bt((t,e)=>Array.from({length:t},(s,i)=>e(i)),"me"),Si=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),eP=bt(()=>({[WebGL2RenderingContext.FLOAT]:"uniform1f",[WebGL2RenderingContext.FLOAT_VEC2]:"uniform2fv",[WebGL2RenderingContext.FLOAT_VEC3]:"uniform3fv",[WebGL2RenderingContext.FLOAT_VEC4]:"uniform4fv",[WebGL2RenderingContext.INT]:"uniform1i",[WebGL2RenderingContext.INT_VEC2]:"uniform2iv",[WebGL2RenderingContext.INT_VEC3]:"uniform3iv",[WebGL2RenderingContext.INT_VEC4]:"uniform4iv",[WebGL2RenderingContext.UNSIGNED_INT]:"uniform1ui",[WebGL2RenderingContext.UNSIGNED_INT_VEC2]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC3]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC4]:"uniform2uiv",[WebGL2RenderingContext.FLOAT_MAT2]:"uniformMatrix2fv",[WebGL2RenderingContext.FLOAT_MAT3]:"uniformMatrix3fv",[WebGL2RenderingContext.FLOAT_MAT4]:"uniformMatrix4fv",[WebGL2RenderingContext.SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.SAMPLER_CUBE]:"uniform1i"}),"he"),Qa=new Map,Ah=new Map,sP=bt((t,e,s,i)=>{Qa.has(t)||Qa.set(t,Qa.size);const n=`${Qa.get(t)}:${e}:${s}`;return Ah.has(n)||Ah.set(n,i()),Ah.get(n)},"ze"),Zi=bt((t,e)=>()=>([t,e]=[e,t],[t,e]),"$"),Bt=bt((t,e=Si)=>{const s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),s},"b"),zp=bt((t,e,s)=>{const i=t.createShader(e);if(i===null)throw new Error("Cannot create WebGL shader.");return t.shaderSource(i,s),t.compileShader(i),i},"ce"),Ji=bt((t,e,s)=>sP(t,e,s,()=>{const i=t.createProgram();if(t.attachShader(i,zp(t,t.VERTEX_SHADER,e)),t.attachShader(i,zp(t,t.FRAGMENT_SHADER,s)),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const n=t.getProgramInfoLog(i);throw t.deleteProgram(i),new Error(`Could not link WebGL program: 
${n}`)}return i}),"X"),is=bt((t,{size:e,data:s,type:i,internalFormat:n=t.RGBA32F,format:r=t.RGBA})=>{const o=t.createTexture(),[a,l]=e.map(d=>Math.max(1,d));return s instanceof Float32Array&&s.byteLength===0?s=new Float32Array(a*l*4):s instanceof Uint32Array&&s.byteLength===0&&(s=new Uint32Array(a*l*4)),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,a,l,0,r,i,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{size:e,data:s,type:i,format:r,handle:o}},"j"),Ki=bt((t,e)=>{const s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i!==t.FRAMEBUFFER_COMPLETE){const n={[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]:"Attachment is NOT complete.",[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]:"No valid attachment.",[t.FRAMEBUFFER_UNSUPPORTED]:"Attachment types are not supported."}[i];throw n?new Error(`Framebuffer: ${n}`):new Error(`Framebuffer: Unknown reason (status: ${i})`)}return s},"W"),Fn=bt((t,e,s)=>{t.useProgram(e);const i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const o=t.getActiveUniform(e,r);if(!o)throw new Error(`Cannot get GL active uniform ${r}.`);const{name:a,size:l,type:d}=o,h=t.getUniformLocation(e,a);if(!h)throw new Error(`Cannot get GL uniform location ${a}.`);i[a]={size:l,data:s[a],type:d,location:h}}return i},"Y");function tn(t,e,s={}){let i=0;const n=eP();return Object.entries(e).forEach(([r,{location:o,type:a,data:l}])=>{let d=s[r]!==void 0?s[r]:l;(a===t.SAMPLER_2D||a===t.INT_SAMPLER_2D||a===t.UNSIGNED_INT_SAMPLER_2D)&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,d),d=i,i++),t[n[a]](o,d)})}bt(tn,"J");var Dp=bt((t,e=!1)=>{const s=e?1<<Math.ceil(Math.log2(Math.sqrt(t))):Math.ceil(Math.sqrt(t));return{w:s,h:s}},"ue"),Xn=bt((t,e,{x:s,y:i,w:n})=>{const r=s+t%n;return(i+Math.floor(t/n))*e+r},"Q"),Hu=bt(t=>{const e=new Map,s={nodes:[],edges:[]};return t.nodes.forEach((i,n)=>{e.has(i.id)&&console.warn(`Duplicated ID ${i.id}@${n}`),s.nodes.push({...i,id:n}),e.set(i.id,n)}),t.edges.forEach(i=>{const n=e.get(i.source),r=e.get(i.target);return n===void 0?console.warn(`Missing source ${i.source}`):r===void 0?console.warn(`Missing target ${i.target}`):void s.edges.push({...i,source:Math.min(n,r),target:Math.max(n,r)})}),s.edges.sort((i,n)=>i.source-n.source||i.target-n.target),s},"ot"),iP=bt(({nodes:t,edges:e},[s,i]=[0,0])=>{const n=Math.PI*(3-Math.sqrt(5)),r=t.map(a=>(a.x=(a.x||0)-s,a.y=(a.y||0)-i,a)).map(a=>({n:a,key:a.pinned?0:1+1e6*a.y+a.x})).sort((a,l)=>a.key-l.key);let o=0;return r.forEach(({n:a,key:l},d)=>{if(l*d===0||l!==r[d-1].key)return o=d;const h=Math.sqrt(d-o);a.x=r[o].n.x+h*Math.cos(n*(d-o)),a.y=r[o].n.y+h*Math.sin(n*(d-o))}),{nodes:t,edges:e}},"at"),Op=bt((t,e)=>{const s={};return e.forEach((i,n)=>(s[i]??(s[i]=new Set)).add(n)),[...Object.values(s)].map(i=>({nodes:[...i].map(n=>t.nodes[n]),edges:t.edges.filter(({source:n,target:r})=>i.has(n)&&i.has(r))}))},"st");function Xu(t,e){const s=e.map(({nodes:x})=>({x:0,y:0,...Dp(x.length,!0)})),i=e.map(({edges:x})=>({x:0,y:0,...Dp(2*x.length)})),n=Er(s.slice()),r=Er(i.slice()),o=n.w*n.h,a=r.w*r.h,l=new Float32Array(4*o),d=new Uint32Array(3*o),h=new Uint32Array(2*a),u=new Float32Array(4*o),c=new Float32Array(a);e.forEach(({nodes:x,edges:b},v)=>{const A=x.length,E=b.length,S=s[v],w=i[v],T=new Uint32Array(E),L=new Uint32Array(E),R=new Uint32Array(A);for(let B=0;B<E;B++){const{source:W,target:Z}=b[B];T[B]=W,L[B]=Z,R[W]++,R[Z]++}const k=Pp(A,()=>[]);T.forEach((B,W)=>{k[B].push(L[W]),k[L[W]].push(B)});const j=Pp(A,()=>[]);T.forEach((B,W)=>{if(b[W].stiffness!==void 0)j[B].push(b[W].stiffness),j[L[W]].push(b[W].stiffness);else{const Z=R[B],it=R[L[W]],dt=Z*it/(Math.min(Z,it)*(Z+it));j[B].push(dt),j[L[W]].push(dt)}});for(let B=0;B<A;B++){const W=4*Xn(B,n.w,S);l[W]=x[B].x||0,l[W+1]=x[B].y||0}let z=0;for(let B=0;B<A;B++){const W=3*Xn(B,n.w,S);d[W]=z%w.w,d[W+1]=Math.floor(z/w.w),d[W+2]=R[B],z+=R[B]}let q=0;for(let B=0;B<A;B++)for(const W of k[B]){const Z=2*Xn(q,r.w,w);h[Z]=W%S.w,h[Z+1]=Math.floor(W/S.w),q++}for(let B=0;B<A;B++){const W=4*Xn(B,n.w,S);u[W]=x[B].mass||R[B]+1,u[W+1]=x[B].r||1,u[W+2]=x[B].pinned?1:0}q=0;for(let B=0;B<A;B++)for(const W of j[B]){const Z=Xn(q,r.w,w);c[Z]=W,q++}});const g=is(t,{size:[n.w,n.h],data:l,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),m=is(t,{size:[n.w,n.h],data:u,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),f=is(t,{size:[n.w,n.h],data:d,type:t.UNSIGNED_INT,format:t.RGB_INTEGER,internalFormat:t.RGB32UI}),p=is(t,{size:[r.w,r.h],data:h,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI}),_=is(t,{size:[r.w,r.h],data:c,type:t.FLOAT,format:t.RED,internalFormat:t.R32F}),y=is(t,{size:[n.w,n.h],data:u,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F});return{items:e.map(({nodes:x,edges:b},v)=>({N:x.length,E:b.length,particlesPositionsSlot:s[v],particlesChargesSlot:s[v],adjacencyOffsetsSlot:s[v],adjacencyListsSlot:i[v],stiffnessSlot:i[v],nodesExtraPropertiesSlot:s[v]})),texture:{particlesPositions:()=>g,particlesCharges:()=>m,adjacencyOffsets:()=>f,adjacencyLists:()=>p,stiffness:()=>_,nodesExtraProperties:()=>y}}}bt(Xu,"mt");var kp=bt((t,e)=>{t.deleteTexture(e.texture.particlesPositions().handle),t.deleteTexture(e.texture.particlesCharges().handle),t.deleteTexture(e.texture.adjacencyOffsets().handle),t.deleteTexture(e.texture.adjacencyLists().handle),t.deleteTexture(e.texture.stiffness().handle),t.deleteTexture(e.texture.nodesExtraProperties().handle)},"ct"),dd=bt(()=>({x:0,y:0,w:0,h:0}),"te"),nP=`#version 300 es
precision lowp float;vec2 o(vec2 o,vec2 e){return vec2(o.x*e.x-o.y*e.y,o.x*e.y+o.y*e.x);}vec2 o(vec2 o){return o.y=-o.y,o;}vec2 o(vec2 i[8],vec2 s,vec2 a){vec2 t,c=a-s,e=vec2(1,0);for(int s;s<8;++s)t+=o(i[s],e),e=o(e,c);return t;}vec2 o(vec2 e,vec4 o){return(e-o.xy)/o.zw;}uniform float m_12,m_13,m_14,m_15,m_16,m_17,m_z,m_10,m_11;uniform lowp sampler2D m_f;uniform lowp usampler2D m_18,m_19;uniform lowp sampler2D m_1a,m_1b,m_8;uniform lowp usampler2D m_h,m_i;uniform lowp sampler2D m_1j,m_1k;flat in uvec4 m_26,m_2c,m_2d,m_2e,m_2f,m_21,m_27,m_28,m_2g;flat in uint m_22,m_23,m_29;out vec4 outColor;void main(){uvec2 s=uvec2(gl_FragCoord.xy)-m_26.xy;if(m_26.z*s.y+s.x>=m_22)return;vec3 c=texelFetch(m_1a,ivec2(m_2c.xy+s),0).xyz;if(c.z>0.)return;vec4 l=texelFetch(m_f,ivec2(m_26.xy+s),0);vec2 i=l.xy,e=l.zw;ivec4 t=ivec4(texelFetch(m_18,ivec2(m_2e.xy+s),0));vec4 u=texelFetch(m_8,ivec2(m_21.xy),0);float r=float(1u<<m_23-1u);ivec2 a=ivec2(r*o(i,u));vec2 v=(vec2(a)+.5)/r;ivec2 p=a-ivec2(1);for(int o;o<9;++o){ivec2 t=p+ivec2(o%3,o/3);if(t>>m_23-1u!=ivec2(0))continue;uvec2 s=texelFetch(m_i,ivec2(m_28.xy)+t,0).xy;for(uint o=s.x;o<s.y;o++){uint l=texelFetch(m_h,ivec2(m_27.xy)+ivec2(o%m_27.z,o/m_27.z),0).x;ivec2 a=ivec2(l%m_26.z,l/m_26.z);vec2 t=texelFetch(m_f,ivec2(m_26.xy)+a,0).xy-i;float u=dot(t,t)+1e-4;if(m_16>0.&&m_z<.5){float i=texelFetch(m_1a,ivec2(m_2c.xy)+a,0).y,o=max(c.y+i+m_17,.01);if(u<o*o){float s=sqrt(u);e-=(o-s)*m_16*i/o*t/s;}}float r=texelFetch(m_1a,ivec2(m_2c.xy)+a,0).x;e-=m_z*m_12*r*t/u;}}if(m_23>2u){vec2 t[8];vec4 s=texelFetch(m_1j,ivec2(m_2g.xy)+a,0),c=texelFetch(m_1k,ivec2(m_2g.xy)+a,0);t[0]=s.xy,t[1]=s.zw,t[2]=c.xy,t[3]=c.zw;vec2 l=o(o(t,v,o(i,u))/u.z);e+=m_z*m_12*l;}ivec2 n;for(int s;s<t.z;s++){n=ivec2(texelFetch(m_19,ivec2(m_2d.xy)+t.xy,0).xy);float a=texelFetch(m_1b,ivec2(m_2f.xy)+t.xy,0).x;vec2 o=texelFetch(m_f,ivec2(m_26.xy)+n,0).xy-i;if(o*=1.-m_15/(length(o)+1e-4),e+=m_z*m_14*a*o/c.x,t.x+=1,t.x>=int(m_2d.z))t.x=0,t.y+=1;}e=m_10*(e-m_z*m_13*i);float x=dot(e,e);if(x>m_11)e*=sqrt(m_11/x);outColor=vec4(i+e,e);}`,rP=`#version 300 es
precision highp float;
precision highp int;

uniform uint m_e; 
uniform uvec2 m_1d;

in vec2 position; 
in uvec4 m_n; 
in uvec4 m_1e; 
in uvec4 m_1f; 
in uvec4 m_1g; 
in uvec4 m_1h; 
in uvec4 m_c; 
in uvec4 m_o; 
in uvec4 m_p; 
in uvec4 m_1i; 

in uint m_6; 
in uint m_d; 
in uint m_q; 

flat out uvec4 m_26;
flat out uvec4 m_2c;
flat out uvec4 m_2d;
flat out uvec4 m_2e;
flat out uvec4 m_2f;
flat out uvec4 m_21;
flat out uvec4 m_27;
flat out uvec4 m_28;
flat out uvec4 m_2g;

flat out uint m_22;
flat out uint m_23;
flat out uint m_29;

void main() {
  m_26 = m_n;
  m_2c = m_1e;
  m_2d = m_1f;
  m_2e = m_1g;
  m_2f = m_1h;
  m_21 = m_c;
  m_27 = m_o;
  m_28 = m_p;
  m_2g = m_1i;

  m_22 = m_6;
  m_23 = m_d;
  m_29 = m_q;

  
  if(m_e != m_d - 1u) {
    gl_Position = vec4(0.f, 0.f, 0.f, 1.f);
    return;
  }

  
  vec2 posPx = (position + 1.f) * vec2(m_n.zw) * .5f + vec2(m_n.xy);
  gl_Position = vec4(posPx / vec2(m_1d) * 2.f - 1.f, 0.f, 1.f);
}`,oP=bt((t,e,{charge:s,gravity:i,inertia:n,edgeStrength:r,edgeLength:o,elasticity:a,margin:l,maxDisplacement:d})=>{const h=Ji(t,rP,nP),u=e.texture.particlesPositions(),c=is(t,{type:t.FLOAT,size:u.size,data:new Float32Array(u.data.buffer.slice(0)),format:t.RGBA,internalFormat:t.RGBA32F}),g=Zi(u,c),m=Ki(t,c.handle),f=Ki(t,u.handle),p=Zi(m,f),_=Fn(t,h,{m_z:1,m_10:n,m_11:d**2,m_12:s,m_13:i,m_14:r,m_15:o,m_16:a,m_17:l,m_f:u.handle,m_18:e.texture.adjacencyOffsets().handle,m_19:e.texture.adjacencyLists().handle,m_1a:e.texture.nodesExtraProperties().handle,m_1b:e.texture.stiffness().handle,m_e:2,m_8:e.texture.spatialBoundaries().handle,m_h:e.texture.spatialKeys().handle,m_i:e.texture.gridCells().handle,m_1c:null,m_1d:u.size});let y=u;const x=[],b=new Set;function v(E=1){t.viewport(0,0,u.size[0],u.size[1]),t.useProgram(h),t.bindFramebuffer(t.FRAMEBUFFER,p()[0]);const[S,w]=g();y=w,b.forEach(T=>{t.bindVertexArray(x[T]),tn(t,_,{m_z:E,m_f:S.handle,m_8:e.texture.spatialBoundaries().handle,m_h:e.texture.spatialKeys().handle,m_e:T,m_1j:e.texture.localExpansions(T,0)?.handle,m_1k:e.texture.localExpansions(T,1)?.handle,m_18:e.texture.adjacencyOffsets().handle,m_19:e.texture.adjacencyLists().handle,m_1a:e.texture.nodesExtraProperties().handle,m_1b:e.texture.stiffness().handle,m_i:e.texture.gridCells().handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)})}e.items.forEach(({depth:E})=>{b.add(E-1)}),b.forEach(E=>{x[E]=t.createVertexArray(),t.bindVertexArray(x[E]);const S=t.getAttribLocation(h,"position");t.enableVertexAttribArray(S),Bt(t,Si),t.vertexAttribPointer(S,2,t.FLOAT,!1,0,0);const w=t.getAttribLocation(h,"m_n");t.enableVertexAttribArray(w);const T=e.items.map(pt=>pt.particlesPositionsSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(T)),t.vertexAttribIPointer(w,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(w,1);const L=t.getAttribLocation(h,"m_1e");t.enableVertexAttribArray(L);const R=e.items.map(pt=>pt.nodesExtraPropertiesSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(R)),t.vertexAttribIPointer(L,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(L,1);const k=t.getAttribLocation(h,"m_1f");t.enableVertexAttribArray(k);const j=e.items.map(pt=>pt.adjacencyListsSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(j)),t.vertexAttribIPointer(k,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(k,1);const z=t.getAttribLocation(h,"m_1g");t.enableVertexAttribArray(z);const q=e.items.map(pt=>pt.adjacencyOffsetsSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(q)),t.vertexAttribIPointer(z,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(z,1);const B=t.getAttribLocation(h,"m_1h");t.enableVertexAttribArray(B);const W=e.items.map(pt=>pt.stiffnessSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(W)),t.vertexAttribIPointer(B,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(B,1);const Z=t.getAttribLocation(h,"m_c");t.enableVertexAttribArray(Z);const it=e.items.map(pt=>pt.spatialBoundariesSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(it)),t.vertexAttribIPointer(Z,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(Z,1);const dt=t.getAttribLocation(h,"m_o");t.enableVertexAttribArray(dt);const At=e.items.map(pt=>pt.spatialKeysSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(At)),t.vertexAttribIPointer(dt,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(dt,1);const gt=t.getAttribLocation(h,"m_p");t.enableVertexAttribArray(gt);const ct=e.items.map(pt=>pt.gridCellsSlot).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(ct)),t.vertexAttribIPointer(gt,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(gt,1);const yt=t.getAttribLocation(h,"m_1i");t.enableVertexAttribArray(yt);const Tt=dd(),Gt=e.items.map(pt=>pt.localExpansionsSlot[E]||Tt).map(({x:pt,y:It,w:Lt,h:zt})=>[pt,It,Lt,zt]).flat();Bt(t,new Uint32Array(Gt)),t.vertexAttribIPointer(yt,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(yt,1);const Vt=t.getAttribLocation(h,"m_6");t.enableVertexAttribArray(Vt),Bt(t,new Uint32Array(e.items.map(({N:pt})=>pt))),t.vertexAttribIPointer(Vt,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(Vt,1);const St=t.getAttribLocation(h,"m_d");t.enableVertexAttribArray(St),Bt(t,new Uint32Array(e.items.map(pt=>pt.depth))),t.vertexAttribIPointer(St,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(St,1);const ft=t.getAttribLocation(h,"m_q");t.enableVertexAttribArray(ft),Bt(t,new Uint32Array(e.items.map(pt=>pt.order))),t.vertexAttribIPointer(ft,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(ft,1)}),bt(v,"P");const A=bt(()=>{t.deleteFramebuffer(m),t.deleteFramebuffer(f),t.deleteTexture(c.handle)},"w");return{step:v,outputs:{items:e.items.map(E=>({N:E.N,pointsSlot:E.particlesPositionsSlot})),texture:{points:()=>y}},destroy:A}},"Fe"),aP=`#version 300 es
precision highp float;vec2 l(vec2 l,vec2 x){return vec2(l.x*x.x-l.y*x.y,l.x*x.y+l.y*x.x);}vec2 x(vec2 x,vec2 l){return vec2(dot(x,l),x.y*l.x-x.x*l.y)/dot(l,l);}uniform uint m_e;uniform lowp sampler2D m_1s,m_1t,m_1u,m_1v,m_1o,m_1p,m_1q,m_1r;flat in uvec4 m_2g,m_2h;flat in uint m_29;layout(location=0)out vec4 l01;layout(location=1)out vec4 l23;layout(location=2)out vec4 l45;layout(location=3)out vec4 l67;void main(){float r=float(1u<<m_e);uvec2 i=uvec2(gl_FragCoord.xy)-m_2g.xy;vec2 a=(vec2(i)+.5)/r,y=texelFetch(m_1o,ivec2(m_2g.xy+i),0).xy;if(y.x==0.)return;if(m_e>2u){uvec2 u=i>>1u;vec2 w=a-(vec2(i&65534u)+1.)/r,x=vec2(1,0);vec4 o=texelFetch(m_1s,ivec2(m_2h.xy+u),0),e=m_29>2u?texelFetch(m_1t,ivec2(m_2h.xy+u),0):vec4(0),y=m_29>4u?texelFetch(m_1u,ivec2(m_2h.xy+u),0):vec4(0),z=m_29>6u?texelFetch(m_1v,ivec2(m_2h.xy+u),0):vec4(0);l01.xy+=m_29<3u?l01.xy+=l(o.xy,1.*x),l01.zw+=l(o.zw,1.*x),x=l(x,w),l(o.zw,1.*x):m_29<5u?l01.xy+=l(o.xy,1.*x),l01.zw+=l(o.zw,1.*x),l23.xy+=l(e.xy,1.*x),l23.zw+=l(e.zw,1.*x),x=l(x,w),l01.xy+=l(o.zw,1.*x),l01.zw+=l(e.xy,2.*x),l23.xy+=l(e.zw,3.*x),x=l(x,w),l01.xy+=l(e.xy,1.*x),l01.zw+=l(e.zw,3.*x),x=l(x,w),l(e.zw,1.*x):m_29<7u?l01.xy+=l(o.xy,1.*x),l01.zw+=l(o.zw,1.*x),l23.xy+=l(e.xy,1.*x),l23.zw+=l(e.zw,1.*x),l45.xy+=l(y.xy,1.*x),l45.zw+=l(y.zw,1.*x),x=l(x,w),l01.xy+=l(o.zw,1.*x),l01.zw+=l(e.xy,2.*x),l23.xy+=l(e.zw,3.*x),l23.zw+=l(y.xy,4.*x),l45.xy+=l(y.zw,5.*x),x=l(x,w),l01.xy+=l(e.xy,1.*x),l01.zw+=l(e.zw,3.*x),l23.xy+=l(y.xy,6.*x),l23.zw+=l(y.zw,10.*x),x=l(x,w),l01.xy+=l(e.zw,1.*x),l01.zw+=l(y.xy,4.*x),l23.xy+=l(y.zw,10.*x),x=l(x,w),l01.xy+=l(y.xy,1.*x),l01.zw+=l(y.zw,5.*x),x=l(x,w),l(y.zw,1.*x):(l01.xy+=l(o.xy,1.*x),l01.zw+=l(o.zw,1.*x),l23.xy+=l(e.xy,1.*x),l23.zw+=l(e.zw,1.*x),l45.xy+=l(y.xy,1.*x),l45.zw+=l(y.zw,1.*x),l67.xy+=l(z.xy,1.*x),l67.zw+=l(z.zw,1.*x),x=l(x,w),l01.xy+=l(o.zw,1.*x),l01.zw+=l(e.xy,2.*x),l23.xy+=l(e.zw,3.*x),l23.zw+=l(y.xy,4.*x),l45.xy+=l(y.zw,5.*x),l45.zw+=l(z.xy,6.*x),l67.xy+=l(z.zw,7.*x),x=l(x,w),l01.xy+=l(e.xy,1.*x),l01.zw+=l(e.zw,3.*x),l23.xy+=l(y.xy,6.*x),l23.zw+=l(y.zw,10.*x),l45.xy+=l(z.xy,15.*x),l45.zw+=l(z.zw,21.*x),x=l(x,w),l01.xy+=l(e.zw,1.*x),l01.zw+=l(y.xy,4.*x),l23.xy+=l(y.zw,10.*x),l23.zw+=l(z.xy,20.*x),l45.xy+=l(z.zw,35.*x),x=l(x,w),l01.xy+=l(y.xy,1.*x),l01.zw+=l(y.zw,5.*x),l23.xy+=l(z.xy,15.*x),l23.zw+=l(z.zw,35.*x),x=l(x,w),l01.xy+=l(y.zw,1.*x),l01.zw+=l(z.xy,6.*x),l23.xy+=l(z.zw,21.*x),x=l(x,w),l01.xy+=l(z.xy,1.*x),l01.zw+=l(z.zw,7.*x),x=l(x,w),l(z.zw,1.*x));}ivec2 e=(ivec2(i)&65534)-2;for(uint n;n<36u;n++){ivec2 t=e+ivec2(int(n)%6,int(n)/6);vec4 w=texelFetch(m_1o,ivec2(m_2g.xy)+t,0);if(w.x==0.)continue;vec2 v=vec2(t-ivec2(i));if(dot(v,v)<=2.||t>>ivec2(m_e)!=ivec2(0))continue;vec2 c=x(vec2(1,0),a-(vec2(t)+.5)/r),y=c;vec4 z=m_29>2u?texelFetch(m_1p,ivec2(m_2g.xy)+t,0):vec4(0),o=m_29>4u?texelFetch(m_1q,ivec2(m_2g.xy)+t,0):vec4(0),u=m_29>6u?texelFetch(m_1r,ivec2(m_2g.xy)+t,0):vec4(0);if(l01.xy+=l(w.xy,y),y=l(y,c),l01.xy+=l(w.zw,1.*y),l01.zw+=l(w.xy,-y),y=l(y,c),m_29>=3u)l01.xy+=l(z.xy,1.*y),l23.xy+=l(w.xy,y);if(l01.zw+=l(w.zw,-2.*y),m_29<3u)continue;if(y=l(y,c),l01.xy+=l(z.zw,1.*y),l01.zw+=l(z.xy,-3.*y),l23.xy+=l(w.zw,3.*y),l23.zw+=l(w.xy,-y),y=l(y,c),m_29>=5u)l01.xy+=l(o.xy,1.*y);if(l01.zw+=l(z.zw,-4.*y),l23.xy+=l(z.xy,6.*y),l23.zw+=l(w.zw,-4.*y),m_29>=5u)l45.xy+=l(w.xy,y);if(y=l(y,c),l23.xy+=l(z.zw,10.*y),l23.zw+=l(z.xy,-10.*y),m_29>=5u)l01.xy+=l(o.zw,1.*y),l01.zw+=l(o.xy,-5.*y),l45.xy+=l(w.zw,5.*y),l45.zw+=l(w.xy,-y);if(y=l(y,c),l23.zw+=l(z.zw,-20.*y),m_29>=7u)l01.xy+=l(u.xy,1.*y),l67.xy+=l(w.xy,y);if(m_29>=5u)l01.zw+=l(o.zw,-6.*y),l23.xy+=l(o.xy,15.*y),l45.xy+=l(z.xy,15.*y),l45.zw+=l(w.zw,-6.*y);if(m_29<5u)continue;if(y=l(y,c),m_29>=7u)l67.zw+=l(w.xy,-y),l67.xy+=l(w.zw,7.*y),l01.zw+=l(u.xy,-7.*y),l01.xy+=l(u.zw,1.*y);if(l45.zw+=l(z.xy,-21.*y),l45.xy+=l(z.zw,35.*y),l23.zw+=l(o.xy,-35.*y),l23.xy+=l(o.zw,21.*y),y=l(y,c),m_29>=7u)l67.zw+=l(w.zw,-8.*y),l67.xy+=l(z.xy,28.*y),l23.xy+=l(u.xy,28.*y),l01.zw+=l(u.zw,-8.*y);if(l45.zw+=l(z.zw,-56.*y),l45.xy+=l(o.xy,70.*y),l23.zw+=l(o.zw,-56.*y),y=l(y,c),m_29>=7u)l67.zw+=l(z.xy,-36.*y),l67.xy+=l(z.zw,84.*y),l23.zw+=l(u.xy,-84.*y),l23.xy+=l(u.zw,36.*y);if(l45.zw+=l(o.xy,-126.*y),l45.xy+=l(o.zw,126.*y),y=l(y,c),m_29>=7u)l67.zw+=l(z.zw,-120.*y),l67.xy+=l(o.xy,210.*y),l45.xy+=l(u.xy,210.*y),l23.zw+=l(u.zw,-120.*y);if(l45.zw+=l(o.zw,-252.*y),m_29<7u)continue;y=l(y,c),l67.zw+=l(o.xy,-330.*y),l67.xy+=l(o.zw,462.*y),l45.zw+=l(u.xy,-462.*y),l45.xy+=l(u.zw,330.*y),y=l(y,c),l67.zw+=l(o.zw,-792.*y),l67.xy+=l(u.xy,924.*y),l45.zw+=l(u.zw,-792.*y),y=l(y,c),l67.zw+=l(u.xy,-1716.*y),l67.xy+=l(u.zw,1716.*y),y=l(y,c),l67.zw+=l(u.zw,-3432.*y);}}`,lP=`#version 300 es
precision highp float;
precision highp int;

uniform uvec2 m_1m;

in vec2 position; 
in uvec4 m_1i; 
in uvec4 m_1n; 
in uint m_q; 

flat out uvec4 m_2g;
flat out uvec4 m_2h;
flat out uint m_29;

void main() {
  m_2g = m_1i;
  m_2h = m_1n;
  m_29 = m_q;

  
  vec2 posPx = (position + 1.f) * vec2(m_1i.zw) * .5f + vec2(m_1i.xy);
  gl_Position = vec4(posPx / vec2(m_1m) * 2.f - 1.f, 0.f, 1.f);
}`,dP=bt((t,e)=>{const s=Ji(t,lP,aP),i=Math.max(...e.items.map(({depth:h})=>h)),n=[];e.items.forEach(({order:h,depth:u,multipolesSlot:c})=>{const g={};for(let m=i-1;m>=2;m--)g[m]=c[m];n.push({order:h,depth:u,localExpansionsSlot:g})});const r=[];for(let h=i-1;h>=2;h--){r[h]=[];const[u,c]=e.texture.multipoles(h,0).size;for(let g=0;g<4;g++)r[h][g]=is(t,{size:[u,c],data:new Float32Array(4*u*c),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})}const o=r.map((h,u)=>{const c=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,c),h.forEach((g,m)=>{t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+m,t.TEXTURE_2D,g.handle,0)}),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2,t.COLOR_ATTACHMENT3]),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&console.error(`FBO incomplete for level ${u}`),c}),a=Fn(t,s,{m_e:2,m_1l:null,m_1m:[0,0]}),l=[];for(let h=i-1;h>=2;h--){l[h]=t.createVertexArray(),t.bindVertexArray(l[h]);const u=t.getAttribLocation(s,"position");t.enableVertexAttribArray(u),Bt(t,Si),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0);const c=t.getAttribLocation(s,"m_1i");t.enableVertexAttribArray(c);const g=n.map(({localExpansionsSlot:_})=>_[h]).map(({x:_,y,w:x,h:b})=>[_,y,x,b]).flat();Bt(t,new Uint32Array(g)),t.vertexAttribIPointer(c,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(c,1);const m=t.getAttribLocation(s,"m_1n");t.enableVertexAttribArray(m);const f=n.map(({localExpansionsSlot:_})=>h>=3?_[h-1]:dd()).map(({x:_,y,w:x,h:b})=>[_,y,x,b]).flat();Bt(t,new Uint32Array(f)),t.vertexAttribIPointer(m,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(m,1);const p=t.getAttribLocation(s,"m_q");t.enableVertexAttribArray(p),Bt(t,new Uint32Array(e.items.map(_=>_.order))),t.vertexAttribIPointer(p,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(p,1)}function d(){t.useProgram(s);for(let h=2;h<i;h++){t.bindVertexArray(l[h]);const u=r[h-1],c=r[h];t.viewport(0,0,...c[0].size),t.bindFramebuffer(t.FRAMEBUFFER,o[h]),tn(t,a,{m_e:h,m_1o:e.texture.multipoles(h,0).handle,m_1p:e.texture.multipoles(h,1).handle,m_1q:e.texture.multipoles(h,2).handle,m_1r:e.texture.multipoles(h,3).handle,m_1s:u&&u[0].handle,m_1t:u&&u[1].handle,m_1u:u&&u[2].handle,m_1v:u&&u[3].handle,m_1m:c[0].size}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}return bt(d,"c"),{step:d,outputs:{items:n,texture:{localExpansions:(h,u)=>r[h]&&r[h][u]}},destroy:()=>{o.forEach(h=>t.deleteFramebuffer(h)),r.forEach(h=>h.forEach(({handle:u})=>t.deleteTexture(u)))}}},"Ie"),hP=`#version 300 es
precision lowp float;vec2 l(vec2 l,vec2 t){return vec2(l.x*t.x-l.y*t.y,l.x*t.y+l.y*t.x);}vec2 l(vec2 t,vec4 l){return(t-l.xy)/l.zw;}uniform lowp sampler2D m_f,m_g,m_8;uniform lowp usampler2D m_h,m_i;uniform uint m_e;uniform lowp sampler2D m_r,m_s,m_t,m_u;flat in uvec4 m_24,m_25,m_26,m_21,m_27,m_28;flat in uint m_23,m_29;layout(location=0)out vec4 m01;layout(location=1)out vec4 m23;layout(location=2)out vec4 m45;layout(location=3)out vec4 m67;void main(){float s=float(1u<<m_e);uvec2 t=uvec2(gl_FragCoord.xy)-m_24.xy;vec2 v=(vec2(t)+.5)/s;if(m_e==m_23-1u){vec4 e=texelFetch(m_8,ivec2(m_21.xy),0);uvec2 s=texelFetch(m_i,ivec2(m_28.xy+t),0).xy;for(uint i=s.x;i<s.y;i++){uint o=texelFetch(m_h,ivec2(m_27.xy)+ivec2(i%m_27.z,i/m_27.z),0).x;ivec2 c=ivec2(m_26.xy)+ivec2(o%m_26.w,o/m_26.w);vec2 u=l(texelFetch(m_f,c,0).xy,e)-v;float x=texelFetch(m_g,c,0).x;vec2 t=vec2(x,0.);if(m01.xy+=t,t=l(t,u),m01.zw+=t,m_29<3u)continue;if(t=l(t,u),m23.xy+=t,t=l(t,u),m23.zw+=t,m_29<5u)continue;if(t=l(t,u),m45.xy+=t,t=l(t,u),m45.zw+=t,m_29<7u)continue;t=l(t,u),m67.xy+=t,t=l(t,u),m67.zw+=t;}}else for(uint y;y<4u;++y){uvec2 x=2u*t+uvec2(y&1u,y>>1u);vec2 u=(vec2(x)+.5)/s/2.-v,e=vec2(1,0);vec4 i=texelFetch(m_r,ivec2(m_25.xy+x),0);if(m01.xy+=l(i.xy,1.*e),e=vec2(1,0),m01.zw+=l(i.zw,1.*e),e=l(e,u),m01.zw+=l(i.xy,1.*e),m_29<3u)continue;vec4 o=texelFetch(m_s,ivec2(m_25.xy+x),0);if(e=vec2(1,0),m23.xy+=l(o.xy,1.*e),e=l(e,u),m23.xy+=l(i.zw,2.*e),e=l(e,u),m23.xy+=l(i.xy,1.*e),e=vec2(1,0),m23.zw+=l(o.zw,1.*e),e=l(e,u),m23.zw+=l(o.xy,3.*e),e=l(e,u),m23.zw+=l(i.zw,3.*e),e=l(e,u),m23.zw+=l(i.xy,1.*e),m_29<5u)continue;vec4 c=texelFetch(m_t,ivec2(m_25.xy+x),0);if(e=vec2(1,0),m45.xy+=l(c.xy,1.*e),e=l(e,u),m45.xy+=l(o.zw,4.*e),e=l(e,u),m45.xy+=l(o.xy,6.*e),e=l(e,u),m45.xy+=l(i.zw,4.*e),e=l(e,u),m45.xy+=l(i.xy,1.*e),e=vec2(1,0),m45.zw+=l(c.zw,1.*e),e=l(e,u),m45.zw+=l(c.xy,5.*e),e=l(e,u),m45.zw+=l(o.zw,10.*e),e=l(e,u),m45.zw+=l(o.xy,10.*e),e=l(e,u),m45.zw+=l(i.zw,5.*e),e=l(e,u),m45.zw+=l(i.xy,1.*e),m_29<7u)continue;vec4 m=texelFetch(m_u,ivec2(m_25.xy+x),0);e=vec2(1,0),m67.xy+=l(m.xy,1.*e),e=l(e,u),m67.xy+=l(c.zw,6.*e),e=l(e,u),m67.xy+=l(c.xy,15.*e),e=l(e,u),m67.xy+=l(o.zw,20.*e),e=l(e,u),m67.xy+=l(o.xy,15.*e),e=l(e,u),m67.xy+=l(i.zw,6.*e),e=l(e,u),m67.xy+=l(i.xy,1.*e),e=vec2(1,0),m67.zw+=l(m.zw,1.*e),e=l(e,u),m67.zw+=l(m.xy,7.*e),e=l(e,u),m67.zw+=l(c.zw,21.*e),e=l(e,u),m67.zw+=l(c.xy,35.*e),e=l(e,u),m67.zw+=l(o.zw,35.*e),e=l(e,u),m67.zw+=l(o.xy,21.*e),e=l(e,u),m67.zw+=l(i.zw,7.*e),e=l(e,u),m67.zw+=l(i.xy,1.*e);}}`,uP=`#version 300 es
precision highp float;
precision highp int;

uniform uvec2 m_k;

in vec2 position; 
in uvec4 m_l; 
in uvec4 m_m; 
in uvec4 m_n; 

in uvec4 m_c; 
in uvec4 m_o; 
in uvec4 m_p; 
in uint m_d; 
in uint m_q; 

flat out uvec4 m_24;
flat out uvec4 m_25;
flat out uvec4 m_26;

flat out uvec4 m_21;
flat out uvec4 m_27;
flat out uvec4 m_28;
flat out uint m_23;
flat out uint m_29;

void main() {
  m_24 = m_l;
  m_25 = m_m;
  m_26 = m_n;
  
  m_21 = m_c;
  m_27 = m_o;
  m_28 = m_p;
  m_23 = m_d;
  m_29 = m_q;

  
  vec2 posPx = (position + 1.f) * vec2(m_l.zw) * .5f + vec2(m_l.xy);
  gl_Position = vec4(posPx / vec2(m_k) * 2.f - 1.f, 0.f, 1.f);
}`,cP=bt((t,e)=>{const s=Ji(t,uP,hP),i=Math.max(...e.items.map(({depth:h})=>h)),n=[];e.items.forEach(({order:h,depth:u})=>{const c={};for(let g=i-1;g>=2;g--)c[g]=g>=u?dd():{x:0,y:0,w:1<<g,h:1<<g};n.push({order:h,depth:u,multipolesSlot:c})});const r=[];for(let h=i-1;h>=2;h--){r[h]=[];const{w:u,h:c}=Er(n.map(({multipolesSlot:g})=>g[h]));for(let g=0;g<4;g++)r[h][g]=is(t,{size:[u,c],data:new Float32Array(4*u*c),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})}const o=r.map((h,u)=>{const c=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,c),h.forEach((g,m)=>{t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+m,t.TEXTURE_2D,g.handle,0)}),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2,t.COLOR_ATTACHMENT3]),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&console.error(`FBO incomplete for level ${u}`),c}),a=Fn(t,s,{m_e:i-1,m_f:e.texture.particlesPositions().handle,m_g:e.texture.particlesCharges().handle,m_8:e.texture.spatialBoundaries().handle,m_h:e.texture.spatialKeys().handle,m_i:e.texture.gridCells().handle,m_j:null,m_k:[0,0]}),l=[];for(let h=i-1;h>=2;h--){l[h]=t.createVertexArray(),t.bindVertexArray(l[h]);const u=t.getAttribLocation(s,"position");t.enableVertexAttribArray(u),Bt(t,Si),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0);const c=t.getAttribLocation(s,"m_l");t.enableVertexAttribArray(c);const g=n.map(({multipolesSlot:T})=>T[h]).map(({x:T,y:L,w:R,h:k})=>[T,L,R,k]).flat();Bt(t,new Uint32Array(g)),t.vertexAttribIPointer(c,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(c,1);const m=t.getAttribLocation(s,"m_m");t.enableVertexAttribArray(m);const f=n.map(({multipolesSlot:T,depth:L})=>h>=L-1?dd():T[h+1]).map(({x:T,y:L,w:R,h:k})=>[T,L,R,k]).flat();Bt(t,new Uint32Array(f)),t.vertexAttribIPointer(m,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(m,1);const p=t.getAttribLocation(s,"m_n");t.enableVertexAttribArray(p);const _=e.items.map(T=>T.particlesPositionsSlot).map(({x:T,y:L,w:R,h:k})=>[T,L,R,k]).flat();Bt(t,new Uint32Array(_)),t.vertexAttribIPointer(p,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(p,1);const y=t.getAttribLocation(s,"m_c");t.enableVertexAttribArray(y);const x=e.items.map(T=>T.spatialBoundariesSlot).map(({x:T,y:L,w:R,h:k})=>[T,L,R,k]).flat();Bt(t,new Uint32Array(x)),t.vertexAttribIPointer(y,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(y,1);const b=t.getAttribLocation(s,"m_o");t.enableVertexAttribArray(b);const v=e.items.map(T=>T.spatialKeysSlot).map(({x:T,y:L,w:R,h:k})=>[T,L,R,k]).flat();Bt(t,new Uint32Array(v)),t.vertexAttribIPointer(b,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(b,1);const A=t.getAttribLocation(s,"m_p");t.enableVertexAttribArray(A);const E=e.items.map(T=>T.gridCellsSlot).map(({x:T,y:L,w:R,h:k})=>[T,L,R,k]).flat();Bt(t,new Uint32Array(E)),t.vertexAttribIPointer(A,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(A,1);const S=t.getAttribLocation(s,"m_d");t.enableVertexAttribArray(S),Bt(t,new Uint32Array(e.items.map(T=>T.depth))),t.vertexAttribIPointer(S,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(S,1);const w=t.getAttribLocation(s,"m_q");t.enableVertexAttribArray(w),Bt(t,new Uint32Array(e.items.map(T=>T.order))),t.vertexAttribIPointer(w,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(w,1)}function d(){t.useProgram(s);for(let h=i-1;h>=2;h--){t.bindVertexArray(l[h]);const u=h+1===i?null:r[h+1],c=r[h][0].size;t.viewport(0,0,...c),t.bindFramebuffer(t.FRAMEBUFFER,o[h]),tn(t,a,{m_f:e.texture.particlesPositions().handle,m_8:e.texture.spatialBoundaries().handle,m_h:e.texture.spatialKeys().handle,m_e:h,m_r:u&&u[0].handle,m_s:u&&u[1].handle,m_t:u&&u[2].handle,m_u:u&&u[3].handle,m_k:c,m_g:e.texture.particlesCharges().handle,m_i:e.texture.gridCells().handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}return bt(d,"c"),{step:d,outputs:{items:n,texture:{multipoles:(h,u)=>r[h]&&r[h][u]}},destroy:()=>{o.forEach(h=>t.deleteFramebuffer(h)),r.forEach(h=>h.forEach(({handle:u})=>t.deleteTexture(u)))}}},"Re"),gP=`#version 300 es
uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 i){return u(i.y)<<1|u(i.x);}uniform lowp usampler2D m_h;flat in uvec4 m_28,m_27;flat in uint m_22;out uvec2 outColor;uint i(uint e){uint u,i=m_22;for(;u<i;){uint t=u+i>>1,l=texelFetch(m_h,ivec2(m_27.xy)+ivec2(t%m_27.z,t/m_27.z),0).y;l<e?u=t+1u:i=t;}return u;}void main(){uvec2 t=uvec2(gl_FragCoord.xy);uint e=u((t-m_28.xy)%m_28.z);outColor=uvec2(i(e),i(e+1u));}`,mP=`#version 300 es
precision highp float;
precision highp int;

uniform uvec2 m_v;

in vec2 position; 
in uvec4 m_p; 
in uvec4 m_o; 
in uint m_6; 

flat out uvec4 m_28;
flat out uvec4 m_27;
flat out uint m_22;

void main() {
  m_28 = m_p;
  m_27 = m_o;
  m_22 = m_6;

  
  vec2 posPx = (position + 1.f) * vec2(m_p.zw) * .5f + vec2(m_p.xy);
  gl_Position = vec4(posPx / vec2(m_v) * 2.f - 1.f, 0.f, 1.f);
}`,fP=bt((t,e)=>{const s=Ji(t,mP,gP),i=e.items.map(({depth:y})=>{const x=1<<y-1;return{x:0,y:0,w:x,h:x}}),n=Er(i.slice()),r=is(t,{size:[n.w,n.h],data:new Uint32Array(2*n.w*n.h),type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI}),o=Ki(t,r.handle),a=Fn(t,s,{m_h:e.texture.spatialKeys().handle,m_v:r.size}),l=t.createVertexArray();t.bindVertexArray(l);const d=t.getAttribLocation(s,"position");t.enableVertexAttribArray(d),Bt(t,Si),t.vertexAttribPointer(d,2,t.FLOAT,!1,0,0);const h=t.getAttribLocation(s,"m_p");t.enableVertexAttribArray(h);const u=i.map(({x:y,y:x,w:b,h:v})=>[y,x,b,v]).flat();Bt(t,new Uint32Array(u)),t.vertexAttribIPointer(h,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(h,1);const c=t.getAttribLocation(s,"m_o");t.enableVertexAttribArray(c);const g=e.items.map(({spatialKeysSlot:y})=>y).map(({x:y,y:x,w:b,h:v})=>[y,x,b,v]).flat();Bt(t,new Uint32Array(g)),t.vertexAttribIPointer(c,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(c,1);const m=t.getAttribLocation(s,"m_6");function f(){t.viewport(0,0,r.size[0],r.size[1]),t.useProgram(s),t.bindVertexArray(l),t.bindFramebuffer(t.FRAMEBUFFER,o),tn(t,a,{m_h:e.texture.spatialKeys().handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}t.enableVertexAttribArray(m),Bt(t,new Uint32Array(e.items.map(({N:y})=>y))),t.vertexAttribIPointer(m,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(m,1),bt(f,"d");const p=bt(()=>{t.deleteFramebuffer(o),t.deleteTexture(r.handle)},"S"),_={items:e.items.map(({N:y,depth:x},b)=>({N:y,depth:x,spatialBoundariesSlot:e.items[b].spatialBoundariesSlot,spatialKeysSlot:e.items[b].spatialKeysSlot,gridCellsSlot:i[b]})),texture:{spatialBoundaries:e.texture.spatialBoundaries,spatialKeys:e.texture.spatialKeys,gridCells:()=>r}};return{step:f,outputs:_,destroy:p}},"Me"),pP=bt(t=>{for(let e=0;e<t.length/2;e++)t[2*e]=e,t[2*e+1]=4294967295;return t},"Oe"),rA=bt(t=>1<<Math.ceil(Math.log2(t)),"le"),_P=bt(t=>{if(t<2)return[1,1];const e=32-Math.clz32(t-1);return[1<<(e>>>1)+(1&e),1<<(e>>>1)]},"Ve"),oA=bt((t,[e,s],i=pP(new Uint32Array(2*e*s)))=>is(t,{size:[e,s],data:i,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI}),"ye"),Bp=bt((t,[e,s],i=new Uint32Array(4*e*s))=>is(t,{size:[e,s],data:i,type:t.UNSIGNED_INT,format:t.RGBA_INTEGER,internalFormat:t.RGBA32UI}),"xe"),yP=`#version 300 es
precision highp int;uniform uint m_0,m_1;uniform highp usampler2D m_2;flat in uvec4 m_1w;flat in uint m_1y;out uvec2 outColor;uvec2 e(uvec2 e,uvec2 u,bool y){uvec2 t=e.x<4294967295u?texelFetch(m_2,ivec2(m_1w.xy)+ivec2(e.x%m_1w.z,e.x/m_1w.z),0).xy:e,o=u.x<4294967295u?texelFetch(m_2,ivec2(m_1w.xy)+ivec2(u.x%m_1w.z,u.x/m_1w.z),0).xy:u;if(y)return t.y<o.y?t:o;return t.y>o.y?t:o;}void main(){uvec2 u=uvec2(gl_FragCoord.xy);if(m_1y==1u){outColor=texelFetch(m_2,ivec2(u),0).xy;return;}uint t=uint(u.x-m_1w.x+m_1w.z*(u.y-m_1w.y)),s=texelFetch(m_2,ivec2(u),0).x,o=t^1u<<m_0-m_1,l=texelFetch(m_2,ivec2(m_1w.xy)+ivec2(o%m_1w.z,o/m_1w.z),0).x;bool y=(t>>m_0-m_1&1u)==0u;(t>>m_0&2u)==2u&&(y=!y),outColor=e(uvec2(t,s),uvec2(o,l),y);}`,xP=`#version 300 es
precision highp float;
precision highp int;

uniform uvec2 m_4;
uniform uint m_0;

in vec2 position; 
in uvec4 m_5; 
in uint m_6; 

flat out uvec4 m_1w;
flat out uint m_1y;

void main() {
  m_1w = m_5;
  m_1y = 0u;

  
  uint minN = 1u << m_0;
  if(minN >= m_6) {
    if(minN >= 2u * m_6) {
      gl_Position = vec4(0.f, 0.f, 0.f, 1.f);
      return;
    }
    
    m_1y = 1u;
  }

  
  vec2 posPx = (position + 1.f) * vec2(m_5.zw) * .5f + vec2(m_5.xy);
  gl_Position = vec4(posPx / vec2(m_4) * 2.f - 1.f, 0.f, 1.f);
}`,bP=bt(t=>Math.max(0,Math.ceil(Math.log2(t))),"ke"),vP=bt(t=>t*(t+1)/2,"Ke"),AP=bt((t,e)=>{const s=Ji(t,xP,yP),i=e.texture.spatialKeys(),n=oA(t,i.size),r=Zi(n,i),o=Ki(t,i.handle),a=Ki(t,n.handle),l=Zi(o,a),d=Fn(t,s,{m_0:0,m_1:0,m_2:i.handle,m_4:i.size}),h=e.items.map(({N:v})=>bP(v)).reduce((v,A)=>Math.max(v,A),0),u=t.createVertexArray();t.bindVertexArray(u);const c=t.getAttribLocation(s,"position");t.enableVertexAttribArray(c),Bt(t,Si),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0);const g=t.getAttribLocation(s,"m_5");t.enableVertexAttribArray(g);const m=e.items.map(({spatialKeysSlot:v})=>v).map(({x:v,y:A,w:E,h:S})=>[v,A,E,S]).flat();Bt(t,new Uint32Array(m)),t.vertexAttribIPointer(g,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(g,1);const f=t.getAttribLocation(s,"m_6");t.enableVertexAttribArray(f),Bt(t,new Uint32Array(e.items.map(({N:v})=>v))),t.vertexAttribIPointer(f,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(f,1);let p=0,_=0,y=i;function x(v=vP(h)){t.useProgram(s),t.bindVertexArray(u),t.viewport(0,0,n.size[0],n.size[1]);const A=e.texture.spatialKeys();y!==A&&(l(),r(),y=A);for(let E=0;E<v;E++){t.bindFramebuffer(t.FRAMEBUFFER,l()[0]);const[S,w]=r();y=w,tn(t,d,{m_0:p,m_1:_,m_2:S.handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length),_=(_+1)%(p+1),_===0&&(p=(p+1)%h)}}bt(x,"E");const b=bt(()=>{t.deleteFramebuffer(o),t.deleteFramebuffer(a),t.deleteTexture(n.handle)},"P");return{step:x,outputs:{items:e.items,texture:{spatialKeys:()=>y}},destroy:b}},"$e"),EP=`#version 300 es
precision highp int;uniform uint m_0,m_1;uniform highp usampler2D m_2,m_3;flat in uvec4 m_1w,m_1x;flat in uint m_1y;layout(location=0)out uvec2 outKeys;layout(location=1)out uvec4 outIntervals;uint n(uint n,uint e,uint u,uint i){uint t=n<u?e+n:i-u+n;return texelFetch(m_2,ivec2(m_1w.xy)+ivec2(t%m_1w.z,t/m_1w.z),0).y;}void main(){ivec2 o=ivec2(gl_FragCoord.xy);if(m_1y==1u){outKeys=texelFetch(m_2,ivec2(o),0).xy;return;}uint i=m_1x.z*(uint(o.y)-m_1x.y)+(uint(o.x)-m_1x.x);uvec4 u;if(m_1==0u)u=uvec4(i&4294967294u,1u,(i&4294967294u)+1u,1u)<<m_0;else{uint n=i>>1u,t=m_1x.z==m_1x.w?m_1x.z:m_1x.z>>1u;u=texelFetch(m_3,ivec2(m_1x.xy)+ivec2(n%t,n/t),0);}uint e=u.y+u.w>>1u,t=u.y<e?0u:u.y-e,y=u.y<e?u.y:e;for(;t<y;){uint i=t+(y-t>>1u);n(i,u.x,u.y,u.z)<n(i+e,u.x,u.y,u.z)?t=i+1u:y=i;}uvec4 l=(i&1u)==(i>>m_1+1u&1u)?uvec4(u.x,t,u.z+u.w-e+t,e-t):uvec4(u.x+t,u.y-t,u.z,u.w-e+t);if(m_0==m_1){uint n=l.y*l.x+l.w*l.z;outKeys=texelFetch(m_2,ivec2(m_1w.xy)+ivec2(n%m_1w.z,n/m_1w.z),0).xy;}else outIntervals=l;}`,SP=`#version 300 es
precision highp float;
precision highp int;

uniform uvec2 m_4;
uniform uint m_0;
uniform uint m_1;

in vec2 position; 
in uvec4 m_5; 
in uint m_6; 

flat out uvec4 m_1w;
flat out uvec4 m_1x;
flat out uint m_1y;

void main() {
  
  uint minN = 1u << m_0;
  if(minN >= m_6) {
    if(minN >= 2u * m_6) {
      gl_Position = vec4(0.f, 0.f, 0.f, 1.f);
      return;
    }
    
    m_1y = 1u;
  }

  
  uint delta = m_0 - m_1;
  uvec4 intervalSlot = m_5;
  if(intervalSlot.z == intervalSlot.w) {
    
    intervalSlot.z = intervalSlot.z >> (delta >> 1u);
    intervalSlot.w = intervalSlot.w >> ((delta + 1u) >> 1u);
  } else {
    
    intervalSlot.z = intervalSlot.z >> ((delta + 1u) >> 1u);
    intervalSlot.w = intervalSlot.w >> (delta >> 1u);
  }
  m_1w = m_5;
  m_1x = intervalSlot;

  
  vec2 posPx = (position + 1.f) * vec2(intervalSlot.zw) * .5f + vec2(intervalSlot.xy);
  gl_Position = vec4(posPx / vec2(m_4) * 2.f - 1.f, 0.f, 1.f);
}`,wP=bt(t=>Math.max(0,Math.ceil(Math.log2(t))),"Xe"),Ja=bt((t,e,s)=>{const i=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.handle,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT1,t.TEXTURE_2D,s.handle,0),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE&&console.error("FBO incomplete"),{handle:i,ca0:e,ca1:s}},"ee"),TP=bt((t,e)=>{const s=Ji(t,SP,EP),i=t.getUniformLocation(s,"m_0"),n=t.getUniformLocation(s,"m_1"),r=t.getUniformLocation(s,"m_2"),o=t.getUniformLocation(s,"m_3"),a=t.getUniformLocation(s,"m_4"),l=e.texture.spatialKeys(),d=oA(t,l.size),h=Bp(t,l.size),u=Bp(t,l.size),c=Zi(Ja(t,l,u),Ja(t,l,h)),g=Zi(Ja(t,d,u),Ja(t,d,h)),m=e.items.map(({N:A})=>wP(rA(A))).reduce((A,E)=>Math.max(A,E),0),f=t.createVertexArray();t.bindVertexArray(f);const p=t.getAttribLocation(s,"position");t.enableVertexAttribArray(p),Bt(t,Si),t.vertexAttribPointer(p,2,t.FLOAT,!1,0,0);const _=t.getAttribLocation(s,"m_5");t.enableVertexAttribArray(_);const y=e.items.map(({spatialKeysSlot:A})=>A).map(({x:A,y:E,w:S,h:w})=>[A,E,S,w]).flat();Bt(t,new Uint32Array(y)),t.vertexAttribIPointer(_,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(_,1);const x=t.getAttribLocation(s,"m_6");function b(){t.bindVertexArray(f),t.viewport(0,0,...l.size),t.useProgram(s),t.uniform2ui(a,...l.size),t.uniform1i(r,0),t.uniform1i(o,1);for(let A=0;A<m;A++){t.activeTexture(t.TEXTURE0);const E=(1&A?d:l).handle;t.bindTexture(t.TEXTURE_2D,E),t.uniform1ui(i,A);for(let S=0;S<=A;S++){const[w,T]=1&A?c():g();t.bindFramebuffer(t.FRAMEBUFFER,w.handle),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,T.ca1.handle),t.uniform1ui(n,S),A===S?t.drawBuffers([t.COLOR_ATTACHMENT0,t.NONE]):S<2&&t.drawBuffers([t.NONE,t.COLOR_ATTACHMENT1]),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}}t.enableVertexAttribArray(x),Bt(t,new Uint32Array(e.items.map(({N:A})=>A))),t.vertexAttribIPointer(x,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(x,1),bt(b,"P");const v=bt(()=>{t.deleteTexture(d.handle),t.deleteTexture(u.handle),t.deleteTexture(h.handle),g().forEach(A=>t.deleteFramebuffer(A.handle)),c().forEach(A=>t.deleteFramebuffer(A.handle))},"w");return{step:b,outputs:{items:e.items,texture:{spatialKeys:()=>m-1&1?l:d}},destroy:v}},"Ye"),IP=`#version 300 es
precision lowp float;uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 t){return u(t.y)<<1|u(t.x);}vec2 u(vec2 t,vec4 u){return(t-u.xy)/u.zw;}uniform lowp sampler2D m_7,m_8;flat in uvec4 m_1z,m_20,m_21;flat in uint m_22,m_23;out uvec2 outColor;void main(){uvec2 o=uvec2(gl_FragCoord.xy);uint t=o.x-m_1z.x+(o.y-m_1z.y)*m_1z.z;if(t>=m_22){outColor=uvec2(t,4294967295u);return;}uvec2 e=uvec2(t%m_20.z,t/m_20.z)+m_20.xy;vec4 i=texelFetch(m_8,ivec2(m_21.xy),0);vec2 n=u(texelFetch(m_7,ivec2(e),0).xy,i);outColor=uvec2(t,u(uvec2(float(1u<<m_23-1u)*n)));}`,LP=`#version 300 es
precision highp float;
precision highp int;

uniform uvec2 m_9;

in vec2 position; 
in uvec4 m_a; 
in uvec4 m_b; 
in uvec4 m_c; 
in uint m_6; 
in uint m_d; 

flat out uvec4 m_1z;
flat out uvec4 m_20;
flat out uvec4 m_21;
flat out uint m_22;
flat out uint m_23;

void main() {
  m_1z = m_a;
  m_20 = m_b;
  m_21 = m_c;
  m_22 = m_6;
  m_23 = m_d;

  
  vec2 posPx = (position + 1.f) * vec2(m_a.zw) * .5f + vec2(m_a.xy);
  gl_Position = vec4(posPx / vec2(m_9) * 2.f - 1.f, 0.f, 1.f);
}`,CP=bt((t,e)=>{const s=Ji(t,LP,IP),i=e.items.map(({N:v})=>{const[A,E]=_P(rA(v));return{x:0,y:0,w:A,h:E}}),n=Er(i.slice()),r=new Uint32Array(2*n.w*n.h);i.forEach(v=>{for(let A=0;A<v.w*v.h;A++){const E=2*Xn(A,n.w,v);r[E]=A,r[E+1]=4294967295}});const o=is(t,{size:[n.w,n.h],data:r,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI}),a=Ki(t,o.handle),l=Fn(t,s,{m_7:e.texture.points().handle,m_8:e.texture.spatialBoundaries().handle,m_9:o.size}),d=t.createVertexArray();t.bindVertexArray(d);const h=t.getAttribLocation(s,"position");t.enableVertexAttribArray(h),Bt(t,Si),t.vertexAttribPointer(h,2,t.FLOAT,!1,0,0);const u=t.getAttribLocation(s,"m_a");t.enableVertexAttribArray(u);const c=i.map(({x:v,y:A,w:E,h:S})=>[v,A,E,S]).flat();Bt(t,new Uint32Array(c)),t.vertexAttribIPointer(u,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(u,1);const g=t.getAttribLocation(s,"m_b");t.enableVertexAttribArray(g);const m=e.items.map(({pointsSlot:v})=>v).map(({x:v,y:A,w:E,h:S})=>[v,A,E,S]).flat();Bt(t,new Uint32Array(m)),t.vertexAttribIPointer(g,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(g,1);const f=t.getAttribLocation(s,"m_c");t.enableVertexAttribArray(f);const p=e.items.map(({spatialBoundariesSlot:v})=>v).map(({x:v,y:A,w:E,h:S})=>[v,A,E,S]).flat();Bt(t,new Uint32Array(p)),t.vertexAttribIPointer(f,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(f,1);const _=t.getAttribLocation(s,"m_6");t.enableVertexAttribArray(_),Bt(t,new Uint32Array(e.items.map(({N:v})=>v))),t.vertexAttribIPointer(_,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(_,1);const y=t.getAttribLocation(s,"m_d");function x(){t.viewport(0,0,o.size[0],o.size[1]),t.useProgram(s),t.bindVertexArray(d),t.bindFramebuffer(t.FRAMEBUFFER,a),tn(t,l,{m_7:e.texture.points().handle,m_8:e.texture.spatialBoundaries().handle}),t.drawArraysInstanced(t.TRIANGLES,0,6,i.length)}t.enableVertexAttribArray(y),Bt(t,new Uint32Array(e.items.map(({depth:v})=>v))),t.vertexAttribIPointer(y,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(y,1),bt(x,"x");const b=bt(()=>{t.deleteFramebuffer(a),t.deleteTexture(o.handle)},"E");return{step:x,outputs:{items:e.items.map((v,A)=>({N:e.items[A].N,spatialKeysSlot:i[A]})),texture:{spatialKeys:()=>o}},destroy:b}},"Ze"),NP=`#version 300 es
precision highp float;precision highp int;uniform lowp sampler2D m_7,m_8;uniform uint m_w;flat in uvec4 m_2a;flat in uint m_22,m_2b;out vec4 outColor;void main(){uvec2 o=uvec2(gl_FragCoord.xy);uint u=o.x-m_2a.x+(o.y-m_2a.y)*m_2a.z;if(outColor=vec4(1e9,1e9,-1e9,-1e9),u>=m_22)return;if(m_w>=m_2b){outColor=texelFetch(m_8,ivec2(o),0);return;}if(m_w==0u)outColor.xy=outColor.zw=texelFetch(m_7,ivec2(o),0).xy;else for(uint u;u<4u;u++){uvec2 e=(o-m_2a.xy<<1u)+uvec2(u&1u,u>>1u)+m_2a.xy;vec4 t=texelFetch(m_8,ivec2(e),0);outColor=vec4(min(outColor.xy,t.xy),max(outColor.zw,t.zw));}if(m_w==m_2b-1u){vec2 o=outColor.zw-outColor.xy;outColor=vec4(outColor.xy-1.,vec2(max(o.x,o.y))+2.);}}`,MP=`#version 300 es
precision highp float;
precision highp int;

uniform sampler2D m_7;
uniform uint m_w;

in vec2 position; 
in uvec4 m_x; 
in uint m_6; 
in uint m_y; 

flat out uvec4 m_2a;
flat out uint m_22;
flat out uint m_2b;

void main() {
  uvec4 slot = uvec4(m_x.xy, m_x.zw >> min(m_w, m_2b));
  m_2a = slot;
  m_22 = m_6;
  m_2b = m_y;

  
  vec2 posPx = (position + 1.f) * vec2(slot.zw) * .5f + vec2(m_2a.xy);
  vec2 texSize = vec2(textureSize(m_7, 0));
  gl_Position = vec4(posPx / texSize * 2.f - 1.f, 0.f, 1.f);
}`,RP=bt(t=>Math.ceil(Math.log2(Math.sqrt(t)))+1,"tt"),FP=bt((t,e)=>{const s=Ji(t,MP,NP),i=e.texture.points(),n=is(t,{size:i.size,data:new Float32Array(i.data.buffer.slice(0)),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),r=is(t,{size:i.size,data:new Float32Array(i.data.buffer.slice(0)),type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F}),o=Zi(n,r),a=Ki(t,r.handle),l=Ki(t,n.handle),d=Zi(a,l),h=Fn(t,s,{m_7:i.handle,m_8:n.handle,m_w:0}),u=e.items.map(({N:A})=>RP(A)),c=u.reduce((A,E)=>Math.max(A,E),0),g=t.createVertexArray();t.bindVertexArray(g);const m=t.getAttribLocation(s,"position");t.enableVertexAttribArray(m),Bt(t,Si),t.vertexAttribPointer(m,2,t.FLOAT,!1,0,0);const f=t.getAttribLocation(s,"m_x");t.enableVertexAttribArray(f);const p=e.items.map(({pointsSlot:A})=>A).map(({x:A,y:E,w:S,h:w})=>[A,E,S,w]).flat();Bt(t,new Uint32Array(p)),t.vertexAttribIPointer(f,4,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(f,1);const _=t.getAttribLocation(s,"m_6");t.enableVertexAttribArray(_),Bt(t,new Uint32Array(e.items.map(({N:A})=>A))),t.vertexAttribIPointer(_,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(_,1);const y=t.getAttribLocation(s,"m_y");t.enableVertexAttribArray(y),Bt(t,new Uint32Array(u)),t.vertexAttribIPointer(y,1,t.UNSIGNED_INT,0,0),t.vertexAttribDivisor(y,1);let x=n;function b(){t.viewport(0,0,...n.size),t.useProgram(s),t.bindVertexArray(g);for(let A=0;A<c;A++){t.bindFramebuffer(t.FRAMEBUFFER,d()[0]);const[E,S]=o();x=S,tn(t,h,{m_7:e.texture.points().handle,m_8:E.handle,m_w:A}),t.drawArraysInstanced(t.TRIANGLES,0,6,e.items.length)}}bt(b,"E");const v=bt(()=>{t.deleteFramebuffer(a),t.deleteFramebuffer(l),t.deleteTexture(r.handle),t.deleteTexture(n.handle)},"P");return{step:b,outputs:{items:e.items.map(({pointsSlot:A})=>A).map(({x:A,y:E})=>({spatialBoundariesSlot:{x:A,y:E,w:1,h:1}})),texture:{spatialBoundaries:()=>x}},destroy:v}},"rt"),PP=bt(t=>{let e;return()=>e||t().finally(()=>e=void 0)},"nt"),zP=bt((t,e)=>Math.max(.1,1-(t/Math.max(1,e-20))**7.39),"fe"),DP=bt((t,e=25,s=24e3)=>{const i=(s-e)/(e-1);return Math.ceil(e*i*4/(i+t))},"ve"),Up=bt(t=>{const e=Math.max(1,Math.ceil(Math.log2(t)/2));return t>65535?e+1:e},"_e"),Gp={charge:10,edgeStrength:.5,edgeLength:30,elasticity:.9,margin:1,gravity:.01,inertia:.9,maxDisplacement:1e3,steps:200},OP=bt((t,e)=>{let[s,i]=[0,0];const n=bt(()=>{for(let o=0;o<t;o++,s++)if(!e(s))return!0},"o"),r=bt(o=>{n()?o(s):i=requestAnimationFrame(()=>r(o))},"s");return{start:PP(()=>new Promise(o=>(s=0)||r(o))),step:n,stop:()=>cancelAnimationFrame(i)}},"Ae"),Eh=bt((t,e,s)=>{let i=e.texture.particlesPositions();const{steps:n,batch:r,sortingMethod:o}=s,a=s.order??4,l={items:e.items.map(({N:_,particlesPositionsSlot:y})=>({N:_,pointsSlot:y})),texture:{points:()=>i}},d=FP(t,l),h=CP(t,{items:e.items.map(({N:_},y)=>({depth:Math.max(1,s.depth??Up(_)),...l.items[y],...d.outputs.items[y]})),texture:{...l.texture,...d.outputs.texture}}),u=(o==="ibr"?TP:AP)(t,h.outputs),c=fP(t,{items:e.items.map(({N:_},y)=>({depth:Math.max(1,s.depth??Up(_)),...d.outputs.items[y],...u.outputs.items[y]})),texture:{...d.outputs.texture,...u.outputs.texture}}),g=cP(t,{items:e.items.map((_,y)=>({order:a,..._,...c.outputs.items[y]})),texture:{particlesPositions:()=>i,particlesCharges:e.texture.particlesCharges,...c.outputs.texture}}),m=dP(t,{items:g.outputs.items,texture:{...g.outputs.texture}}),f=oP(t,{items:e.items.map((_,y)=>({..._,...c.outputs.items[y],...m.outputs.items[y]})),texture:{...e.texture,...c.outputs.texture,...m.outputs.texture}},s),p=e.items.reduce((_,{N:y})=>Math.max(_,y),0);return{...OP(r??DP(p),_=>(i=f.outputs.texture.points(),d.step(),h.step(),u.step(),c.step(),g.step(),m.step(),f.step(zP(_,n)),_<n)),destroy:()=>{d.destroy(),h.destroy(),u.destroy(),c.destroy(),g.destroy(),m.destroy(),f.destroy()}}},"_t"),Vp=0,aA=typeof window>"u",kP=typeof performance<"u"&&performance.now?performance:Date,BP=aA?t=>{const e=kP.now(),s=Math.max(0,16-(e-Vp)),i=setTimeout(()=>t(e+s),s);return Vp=e+s,i}:window.requestAnimationFrame,UP=aA?t=>clearTimeout(t):window.cancelAnimationFrame;function lA(t,e,s){for(let i=0;i<t.length;i++){const n=t[i];n.x=e[i],n.y=s[i]}}bt(lA,"defaultUpdate");var GP=bt(()=>{},"noop"),VP=.001,Sh={movementRatio:7e-8,surfaceRatio:.0025},qP=.003,jP=bt((t,e)=>qP*t**2+(e+1),"defaultMass"),$u=class{constructor(t={}){this.onUpdate=bt(e=>{},"onUpdate"),this.update=lA,this.nextTick=BP,this.cancelTick=UP,this.onEnd=GP,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=Sh,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in t?t.autoStop&&(typeof t.autoStop=="boolean"?t.autoStop=Sh:t.autoStop={...t.autoStop,...Sh}):t.steps;for(const e in t)t[e]===void 0&&e!=="order"&&e!=="depth"||(this[e]=t[e])}};bt($u,"Settings");var YP=bt(({nodes:t,edges:e})=>{const s=t.length,i=e.length,n=new Uint32Array(s);for(let r=0;r<i;r++){const{source:o,target:a}=e[r];n[o]++,n[a]++}return n},"degrees"),HP=bt((t,e)=>({nodes:t.nodes.map((s,i)=>{let n=(s.mass??1)*jP(s.r||1,e[i]);return n=Math.max(n,VP),{...s,mass:n}}),edges:t.edges.map(s=>{const i=s.weight||1,n=e[s.target]+1,r=e[s.source]+1,o=i*(n*r)/Math.min(n,r)/(n+r);return{...s,stiffness:o}})}),"defaultSettings"),tl=bt((t,e)=>{const s=iP(Hu(t),e);return HP(s,YP(s))},"cleanGraph"),qp=class{constructor(t){this.promise=new Promise(t)}then(t){return this.promise.then(t)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function Ll(t,e,s={}){let i,n;e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_lose_context")?.loseContext();let r=new $u({...Gp,...s});const o=t.nodes.length,a=s.cx||t.nodes.reduce((p,_)=>p+(_.x||0),0)/o,l=s.cy||t.nodes.reduce((p,_)=>p+(_.y||0),0)/o,d=[a,l],h=Array.from({length:o},(p,_)=>_),u=bt(p=>{if(!i)throw new Error("No graph has been set");const{size:_}=i.texture.particlesPositions();if(_[0]*_[1]<=1)return{X:[0],Y:[0]};const y=[],x=[];let b=0;const v=new Float32Array(4*_[0]*_[1]);return e.readPixels(0,0,_[0],_[1],e.RGBA,e.FLOAT,v),i.items.forEach(({N:A,particlesPositionsSlot:E})=>{const{x:S,y:w,w:T}=E;for(let L=0;L<A;L++){const R=S+L%T,k=4*((w+Math.floor(L/T))*_[0]+R);y[h[b+L]]=v[k]+a,x[h[b+L]]=v[k+1]+l}b+=A}),p&&(c(),g()),{X:y,Y:x}},"readLayoutData"),c=bt(()=>{n&&(n.stop(),n.destroy(),n=void 0)},"simulationCleanup"),g=bt(()=>{i&&(kp(e,i),i=void 0)},"graphLayoutCleanup"),m={setOptions:(p={})=>(r=new $u({...Gp,...p}),i&&(c(),n=Eh(e,i,r)),m),setGraph:(p={nodes:[],edges:[]})=>{let _;if(i&&kp(e,i),s.groups){const y={};Object.entries(s.groups).forEach(([x,b])=>b.forEach(v=>y[v]=Number(x))),_=Op(Hu(p),Object.values(y)),_.map(({nodes:x})=>x).flat().forEach((x,b)=>h[b]=x.id),_=_.map(x=>tl(x,d))}else _=[tl(p,d)];return i=Xu(e,_),r&&(c(),n=Eh(e,i,r)),m},start:()=>{if(!n)throw new Error("No graph has been set");return n.start().finally(()=>s.onEnd?.(1)).catch(p=>{throw new Error("Something went wrong during GPU layout: "+p)}),m},stop:()=>(n&&n.stop(),m),step:()=>{if(!n)throw new Error("No graph has been set");return n.step(),m},data:p=>u(p),iterations:()=>1};let f;if(s.groups){const p={};Object.entries(s.groups).forEach(([_,y])=>y.forEach(x=>p[x]=Number(_))),f=Op(Hu(t),Object.values(p)),f.map(({nodes:_})=>_).flat().forEach((_,y)=>h[y]=_.id),f=f.map(_=>tl(_,d))}else f=[tl(t,d)];return i=Xu(e,f),n=Eh(e,i,r),m}/**
* @preserve
* @linkurious/force-layout@1.0.7
* Ogma general-purpose force-directed layout
*/function jp(){var t=(()=>{var e=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,r=(I,F)=>e(I,"name",{value:F,configurable:!0}),o={};((I,F)=>{for(var C in F)e(I,C,{get:F[C],enumerable:!0})})(o,{IntegratorType:()=>he,force:()=>Wt});var a=class{constructor(I){let F=l();this.c=1,this.s0=F(" "),this.s1=F(" "),this.s2=F(" "),this.s0-=F(String(I)),this.s0<0&&(this.s0+=1),this.s1-=F(String(I)),this.s1<0&&(this.s1+=1),this.s2-=F(I),this.s2<0&&(this.s2+=1),F=null}next(){return()=>{const I=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=I-(this.c=0|I)}}nextDouble(){const I=this.next();return()=>I()+11102230246251565e-32*(2097152*I()|0)}nextInt32(){const I=this.next();return()=>4294967296*I()|0}};function l(){let I=4022871197;return F=>{F=F.toString();for(let C=0;C<F.length;C++){I+=F.charCodeAt(C);let M=.02519603282416938*I;I=M>>>0,M-=I,M*=I,I=M>>>0,M-=I,I+=4294967296*M}return 23283064365386963e-26*(I>>>0)}}function d(I){return new a(I.toString()).next()}r(a,"Alea"),r(l,"Mash"),r(d,"impl");var h=d(42);function u(I){h=d(I)}function c(){return 1e-6*(h()-.5)}function g(I,F,C,{edgeStrength:M,edgeLength:G}){const U=C.sources,O=C.targets,$=C.X,Y=C.Y,H=C.R,K=C.fx,X=C.fy,J=C.degrees,nt=C.masses,Q=C.weights;for(let et=0;et<F.length;et++){const st=F[et],lt=U[st],rt=O[st],ot=1,ht=J[lt]+ot,at=J[rt]+ot,ut=M*Q[st];let xt=$[rt]+K[rt]-$[lt]-K[lt]||c(),wt=Y[rt]+X[rt]-Y[lt]-X[lt]||c();const Mt=xt*xt+wt*wt,Rt=Math.sqrt(Mt),kt=G+H[lt]+H[rt];if(Rt<=kt)continue;const Ht=kt-Rt,Jt=Ht*(at*ht/Math.min(at,ht)/(at+ht)),te=Math.min(1,I*ut*Ht/Mt*(Jt*(at+ht)/(at*ht))),le=at*ht/(at+ht);xt*=te,wt*=te,K[lt]+=xt*le/nt[lt],X[lt]+=wt*le/nt[lt],K[rt]-=xt*le/nt[rt],X[rt]-=wt*le/nt[rt]}}r(u,"setSeed"),r(c,"randomize"),r(g,"attraction");var m=r((I,F)=>{const C=F.sources,M=F.targets,G=F.degrees,U=F.weights,O=F.edgeIds,$=F.nodeToGroup,Y=F.hasGroups;for(let H=0;H<I.length;H++){const{source:K,target:X,weight:J=1}=I[H];C[H]=K,M[H]=X,U[H]=J,G[K]++,G[X]++,O[H]=H,U[H]=J===void 0?1:J,Y&&$[K]!==$[X]&&(U[H]=0)}},"initialize");function f(I,F,C,{gravity:M,cx:G,cy:U}){const O=C.X,$=C.Y,Y=C.fx,H=C.fy,K=C.nodeToGroup,X=C.cells,J=C.hasGroups,nt=F.length;for(let Q=0;Q<nt;Q++){const et=F[Q],st=J?X[K[Q]].cx:G,lt=J?X[K[Q]].cy:U,rt=st-O[et]||c(),ot=lt-$[et]||c(),ht=M*I;Y[et]+=rt*ht,H[et]+=ot*ht}}g.initialize=m,r(f,"center");var p=r((I,F,C)=>{const{X:M,Y:G}=F;let U=C.cx,O=C.cy;const $=I.length;if(U===void 0||O===void 0){U=O=0;for(let Y=0;Y<$;Y++)U+=M[Y],O+=G[Y];U/=$,O/=$}C.cx=U,C.cy=O},"initialize");f.initialize=p;var _=class{constructor(I,F,C,M){this.left=null,this.right=null,this.data=null,this.code=I,this.data=F,this.left=C,this.right=M}};function y(I,F,C,M,G){const U=new _(null,null,null,null),O=[U],$=[M,G];for(;O.length!==0;){const Y=$.pop(),H=$.pop(),K=O.pop();if(Y-H===0)K.code=C[H],K.data=I[F[H]];else{const X=v(F,C,H,Y);K.code=X,H<=X&&(K.left=new _(null,null,null,null),O.push(K.left),$.push(H,X)),Y>X&&(K.right=new _(null,null,null,null),O.push(K.right),$.push(X+1,Y))}}return U}function x(I,F,C,M,G,U){const O=new _(null,null,null,null),$=[O],Y=[M,G];for(;$.length!==0;){const H=Y.pop(),K=Y.pop(),X=$.pop();if(H-K<U){const J=new Array(H-K+1);for(let nt=K,Q=0;nt<=H;nt++,Q++)J[Q]=I[F[nt]];X.code=C[K],X.data=J}else{const J=v(F,C,K,H);X.code=J,K<=J&&(X.left=new _(null,null,null,null),$.push(X.left),Y.push(K,J)),H>J&&(X.right=new _(null,null,null,null),$.push(X.right),Y.push(J+1,H))}}return O}r(_,"Node"),r(y,"buildIterative"),r(x,"buildIterativeBuckets");var b=Math.clz32||r(function(F){let C=-2147483648;for(let M=0;M<31;M+=1){if(C&F)return M;C>>>=1}return 32},"clz");function v(I,F,C,M){const G=F[I[C]],U=F[I[M]];if(G===U)return C;const O=b(G^U);let $,Y,H,K=C,X=M-C;do X=X+1>>1,$=K+X,$<M&&(Y=F[I[$]],H=b(G^Y),H>O&&(K=$));while(X>1);return K}function A(I,F){let C=I^F,M=65535^C,G=65535^(I|F),U=I&(65535^F),O=C|M>>1,$=C>>1^C,Y=G>>1^M&U>>1^G,H=C&G>>1^U>>1^U;C=O,M=$,G=Y,U=H,O=C&C>>2^M&M>>2,$=C&M>>2^M&(C^M)>>2,Y^=C&G>>2^M&U>>2,H^=M&G>>2^(C^M)&U>>2,C=O,M=$,G=Y,U=H,O=C&C>>4^M&M>>4,$=C&M>>4^M&(C^M)>>4,Y^=C&G>>4^M&U>>4,H^=M&G>>4^(C^M)&U>>4,C=O,M=$,G=Y,U=H,Y^=C&G>>8^M&U>>8,H^=M&G>>8^(C^M)&U>>8,C=Y^Y>>1,M=H^H>>1;let K=I^F,X=M|65535^(K|C);return K=16711935&(K|K<<8),K=252645135&(K|K<<4),K=858993459&(K|K<<2),K=1431655765&(K|K<<1),X=16711935&(X|X<<8),X=252645135&(X|X<<4),X=858993459&(X|X<<2),X=1431655765&(X|X<<1),(X<<1|K)>>>0}r(v,"findSplit"),r(A,"hilbert");var E=[0,1],S=[0,2];for(let I=4;I<65535;I<<=2)for(let F=0,C=E.length;F<C;F++)E.push(E[F]|I),S.push((E[F]|I)<<1);function w(I,F){return(S[255&F]|E[255&I])+65536*(S[F>>8&255]|E[I>>8&255])+4294967296*(S[F>>16&255]|E[I>>16&255])}r(w,"morton");var T=new Uint32Array(1024);function L(I,F){const C=new Uint32Array(F.length);for(let G=0;G<1024;G++)T[G]=0;const M=255;for(let G=0;G<F.length;G++){const U=F[G];T[U&M]++,T[256+(U>>8&M)]++,T[512+(U>>16&M)]++,T[768+(U>>24&M)]++}for(let G=0;G<4;G++){let U=0,O=0;const $=256*G;for(let Y=0;Y<256;Y++)U=T[Y+$],T[Y+$]=O,O+=U}for(let G=0;G<F.length;G++){const U=F[G];C[T[U&M]++]=G}for(let G=0;G<F.length;G++){const U=C[G],O=F[U];I[T[256+(O>>8&M)]++]=U}for(let G=0;G<F.length;G++){const U=I[G],O=F[U];C[T[512+(O>>16&M)]++]=U}for(let G=0;G<F.length;G++){const U=C[G],O=F[U];I[T[768+(O>>24&M)]++]=U}}r(L,"radixSort");var R=class{constructor(I,{getX:F,getY:C,bucketSize:M=0,sfc:G=1}={}){this.bucketSize=0,this._root=null;const U=I.length,O=new Uint32Array(U);let $=1/0,Y=1/0,H=-1/0,K=-1/0;this._x=F,this._y=C;const X=G===1?A:w;this._project=X;const J=new Uint32Array(U);for(let et=0;et<U;et++){const st=I[et],lt=F(st),rt=C(st);lt<$&&($=lt),rt<Y&&(Y=rt),lt>H&&(H=lt),rt>K&&(K=rt),J[et]=et}this._minX=$,this._minY=Y,this._maxX=H,this._maxY=K;const nt=65535/Math.max(H-$,1),Q=65535/Math.max(K-Y,1);this._hw=nt,this._hh=Q;for(let et=0;et<U;et++){const st=I[et];O[et]=X(nt*(F(st)-$),Q*(C(st)-Y))}L(J,O),this._root=M===0?y(I,J,O,0,U-1):x(I,J,O,0,U-1,M),this.bucketSize=M}get root(){return this._root}inOrder(I,F){let C=this._root;const M=[];let G=!1;for(;!G;)if(C)M.push(C),C=C.left;else if(M.length!==0){if(C=M.pop(),I.call(F,C))break;C=C.right}else G=!0;return this}preOrder(I,F){const C=[this._root];for(;C.length!==0;){const M=C.pop();I.call(F,M)||(M.right&&C.push(M.right),M.left&&C.push(M.left))}return this}postOrder(I,F){const C=[];let M,G=this._root;do{for(;G;)G.right&&C.push(G.right),C.push(G),G=G.left;G=C.pop(),M=C.length-1,G.right&&C[M]===G.right?(C[M]=G,G=G.right):(I.call(F,G),G=null)}while(C.length!==0);return this}map(I,F){const C=[];return this.inOrder(M=>{C.push(I.call(F,M))}),C}height(){return k(this._root)}toString(I=F=>F.code.toString()){const F=[];return j(this._root,"",!0,C=>F.push(C),I),F.join("")}size(){let I=0;return this.preOrder(()=>{I++}),I}destroy(){return this._root=null,this}};function k(I){return I?1+Math.max(k(I.left),k(I.right)):0}function j(I,F,C,M,G){if(I){M(F+(C?"^-- ":"|-- ")+G(I)+`
`);const U=F+(C?"    ":"|   ");I.left&&j(I.left,U,!1,M,G),I.right&&j(I.right,U,!0,M,G)}}function z(I){for(let F=I.length-1;F>=0;F--){let C=Math.floor(Math.random()*(F+1));C=Math.max(Math.min(C,F),0);const M=I[F];I[F]=I[C],I[C]=M}return I}r(R,"BVH"),r(k,"treeHeight"),r(j,"row"),r(z,"shuffle");var q,B,W,Z,it,dt,At,gt,ct,yt=r(I=>I.x,"getX"),Tt=r(I=>I.y,"getY"),Gt=r(I=>I.r,"getR");function Vt(I,F=yt,C=Tt,M=Gt){const G=z(I.slice()),U=G.length;let O,$=[],Y=0;for(;Y<U;){const H=G[Y];O&&pt(O,F(H),C(H),M(H))?Y++:($=St($,H,F,C,M),O=Lt($,F,C,M),Y=0)}return O}function St(I,F,C,M,G){const U=C(F),O=M(F),$=G(F),Y={x:U,y:O,r:$};if(It(Y,I,C,M,G))return[F];for(let H=0;H<I.length;++H){const K=I[H],X=C(K),J=M(K),nt=G(K);if(!ft(Y,X,J,nt)&&It(_t(X,J,nt,U,O,$),I,C,M,G))return[I[H],F]}for(let H=0;H<I.length-1;H++)for(let K=H+1;K<I.length;K++){const X=I[H],J=I[K],nt=C(X),Q=M(X),et=G(X),st=C(J),lt=M(J),rt=G(J);if(!ft(_t(nt,Q,et,st,lt,rt),U,O,$)&&!ft(_t(nt,Q,et,U,O,$),st,lt,rt)&&!ft(_t(st,lt,rt,U,O,$),nt,Q,et)&&It(Dt(nt,Q,et,st,lt,rt,U,O,$),I,C,M,G))return[I[H],I[K],F]}throw new Error}function ft(I,F,C,M){const G=I.r-M,U=F-I.x,O=C-I.y;return G>=0&&G*G>U*U+O*O}function pt(I,F,C,M){const G=I.r-M+1e-6,U=F-I.x,O=C-I.y;return G>0&&G*G>U*U+O*O}function It(I,F,C,M,G){for(let U=0;U<F.length;++U){const O=F[U];if(!pt(I,C(O),M(O),G(O)))return!1}return!0}function Lt(I,F,C,M){return I.length===1?zt(F(I[0]),C(I[0]),M(I[0])):I.length===2?_t(F(I[0]),C(I[0]),M(I[0]),F(I[1]),C(I[1]),M(I[1])):Dt(F(I[0]),C(I[0]),M(I[0]),F(I[1]),C(I[1]),M(I[1]),F(I[2]),C(I[2]),M(I[2]))}function zt(I,F,C){return{x:I,y:F,r:C}}function _t(I,F,C,M,G,U){const O=M-I,$=G-F,Y=U-C,H=Math.sqrt(O*O+$*$);return{x:(I+M+O/H*Y)/2,y:(F+G+$/H*Y)/2,r:(H+C+U)/2}}function Dt(I,F,C,M,G,U,O,$,Y){const H=(I+M+O)/3,K=(F+G+$)/3,X=I-H,J=F-K,nt=M-H,Q=G-K,et=O-H,st=$-K,lt=X-nt,rt=X-et,ot=J-Q,ht=J-st,at=U-C,ut=Y-C,xt=X*X+J*J-C*C,wt=xt-nt*nt-Q*Q+U*U,Mt=xt-et*et-st*st+Y*Y,Rt=rt*ot-lt*ht,kt=(ot*Mt-ht*wt)/(2*Rt)-X,Ht=(ht*at-ot*ut)/Rt,Jt=(rt*wt-lt*Mt)/(2*Rt)-J,te=(lt*ut-rt*at)/Rt,le=Ht*Ht+te*te-1,Ae=2*(C+kt*Ht+Jt*te),Te=kt*kt+Jt*Jt-C*C,ke=-(Math.abs(le)>1e-6?(Ae+Math.sqrt(Ae*Ae-4*le*Te))/(2*le):Te/Ae);return{x:H+X+kt+Ht*ke,y:K+J+Jt+te*ke,r:ke}}function oe(I,F,C,{X:M,Y:G,R:U,fx:O,fy:$,bucketSize:Y},{elasticity:H}){if(H===0)return C;C||(C=new R(F,{getX:q,getY:B,bucketSize:Y})).postOrder(Z);for(let K=0;K<F.length;K++)dt=F[K],At=M[dt]+O[dt],gt=G[dt]+$[dt],ct=U[dt],C.preOrder(it);return C}r(Vt,"med"),r(St,"extend"),r(ft,"contains"),r(pt,"containsWeak"),r(It,"containsWeakAll"),r(Lt,"enclose"),r(zt,"from1"),r(_t,"from2"),r(Dt,"from3"),r(oe,"collisionForce");var qt=r(I=>{const F=I.X,C=I.Y,M=I.R,G=I.bucketSize;return U=>{let O,$,Y,H;const K=U.data;if(K!==null)if(G!==0){const X=Vt(K,q,B,W);O=X.x,$=X.y,Y=X.r}else{const X=K;O=F[X],$=C[X],Y=M[X]}else if(U.left&&U.right){const X=U.left.cx,J=U.left.cy,nt=U.right.cx,Q=U.right.cy,et=U.left.r,st=U.right.r,lt=nt-X,rt=Q-J,ot=st-et,ht=Math.sqrt(lt*lt+rt*rt);O=(X+nt+lt/ht*ot)/2,$=(J+Q+rt/ht*ot)/2,Y=(ht+et+st)/2}else H=U.left||U.right,H&&(O=H.cx,$=H.cy,Y=H.r);U.cx=O,U.cy=$,U.r=Y}},"getMeasureBodies"),jt=r((I,{elasticity:F,margin:C})=>{const M=I.X,G=I.Y,U=I.R,O=I.fx,$=I.fy,Y=I.bucketSize,H=I.nodeToGroup,K=I.cellSize,X=I.hasGroups;return J=>{const nt=J.data;if(nt===null){const Q=J.cx-At,et=J.cy-gt,st=J.r+ct;return X?Q*Q+et*et>K*K:Q*Q+et*et>st*st}if(Y!==0){const Q=nt;for(let et=0;et<Q.length;et++){const st=Q[et];if(st>dt){const lt=U[st];let rt=At-M[st]-O[st],ot=gt-G[st]-$[st];const ht=ct+lt+C;let at=rt*rt+ot*ot;if(at<ht*ht){rt===0&&(rt=c(),at+=rt*rt),ot===0&&(ot=c(),at+=ot*ot);const ut=Math.sqrt(at),xt=(ht-ut)*F/ut,wt=lt/ht;O[dt]+=rt*xt*wt,$[dt]+=ot*xt*wt,O[st]-=rt*xt*(1-wt),$[st]-=ot*xt*(1-wt)}}}}else{const Q=J.data;if(X&&H[dt]!==H[Q])return;if(Q>dt){const et=U[Q];let st=At-M[Q],lt=gt-G[Q];const rt=ct+et+C;let ot=st*st+lt*lt;if(ot<rt*rt){st===0&&(st=c(),ot+=st*st),lt===0&&(lt=c(),ot+=lt*lt);const ht=Math.sqrt(ot),at=(rt-ht)*F/ht,ut=et/rt;O[dt]+=st*at*ut,$[dt]+=lt*at*ut,O[Q]-=st*at*(1-ut),$[Q]-=lt*at*(1-ut)}}}}},"getApplyForce"),Zt=r((I,F,C)=>{const{X:M,Y:G,R:U}=F;q=r(O=>M[O],"getX"),B=r(O=>G[O],"getY"),W=r(O=>U[O],"getR"),Z=qt(F),it=jt(F,C)},"initialize");function ie(I,F,{masses:C,X:M,Y:G,fx:U,fy:O},{charge:$}){const Y=F.length;let H,K,X,J,nt,Q,et,st,lt;for(let rt=0;rt<Y;rt++){H=F[rt];for(let ot=rt+1;ot<Y;ot++)if(rt!==ot){if(K=F[ot],H===K)continue;X=M[H]-M[K]||c(),J=G[H]-G[K]||c(),nt=X*X+J*J,nt<1&&(nt=Math.sqrt(1*nt)),Q=$*C[K],et=I*Q/nt,st=$*C[H],lt=I*st/nt,U[H]+=X*et,O[H]+=J*et,U[K]-=X*lt,O[K]-=J*lt}}}oe.initialize=Zt,r(ie,"repulsion"),ie.initialize=()=>{};var he=(I=>(I[I.verlet=0]="verlet",I[I.euler=1]="euler",I))(he||{}),Yt=0,ae=typeof window>"u",Ft=typeof performance<"u"&&performance.now?performance:Date,Pt=ae?I=>{const F=Ft.now(),C=Math.max(0,16-(F-Yt)),M=setTimeout(()=>I(F+C),C);return Yt=F+C,M}:window.requestAnimationFrame,Ee=ae?I=>clearTimeout(I):window.cancelAnimationFrame;function ps(I,F,C){for(let M=0;M<I.length;M++){const G=I[M];G.x=F[M],G.y=C[M]}}r(ps,"defaultUpdate");var Hs,sn,nn,Xs,Ii,_e,ls,Ke,ds,De,ri,hs=r(()=>{},"noop"),Cs={movementRatio:7e-8,surfaceRatio:.0025},Ve=r((I,F)=>.003*I**2+(F+1),"defaultMass"),Ns=class{constructor(I={}){this.onUpdate=r(F=>{},"onUpdate"),this.update=ps,this.nextTick=Pt,this.cancelTick=Ee,this.onEnd=hs,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=Cs,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in I?I.autoStop&&(typeof I.autoStop=="boolean"?I.autoStop=Cs:I.autoStop={...I.autoStop,...Cs}):I.steps;for(const F in I)I[F]===void 0&&F!=="order"&&F!=="depth"||(this[F]=I[F])}};r(Ns,"Settings");var Ms=0;function Li(I,F,C,M){const G=M.X,U=M.Y,O=M.R,$=M.masses,Y=M.bucketSize;Ms=I,C===null&&(C=new R(F,{getX:nn,getY:Xs,bucketSize:Y})).postOrder(Hs);const H=F.length;for(let K=0;K<H;K++)_e=F[K],ls=G[_e],Ke=U[_e],ds=O[_e],De=$[_e],ri=De,C.preOrder(sn);return C}r(Li,"repulsion");var oi=r((I,{charge:F,theta:C})=>{const M=I.fx,G=I.fy,U=I.X,O=I.Y,$=I.R,Y=I.masses,H=I.bucketSize,K=I.cellSize;return X=>{let J=0,nt=0,Q=ls-X.cx||c(),et=Ke-X.cy||c(),st=Q*Q+et*et,lt=ds+X.r;const rt=X.data;if(rt!==null){if(rt===_e)return!1;if(H!==0){const ot=rt;for(let ht=0;ht<ot.length;ht++){const at=ot[ht];if(at===_e)continue;Q=ls-U[at]||c(),et=Ke-O[at]||c(),st=Q*Q+et*et,lt=ds+$[at],st<1&&(st=Math.sqrt(1*st));const ut=Y[at];J=F*ut*ri,nt=Ms*J/st,M[_e]+=Q*nt/De,G[_e]+=et*nt/De}}else{if(st<1&&(st=Math.sqrt(1*st)),st>(K/2)**2)return!0;J=F*X.mass*ri,nt=Ms*J/st,M[_e]+=Q*nt/De,G[_e]+=et*nt/De}}else{const ot=lt/C;if(st>ot*ot)return st<1&&(st=Math.sqrt(1*st)),st>(K/2)**2||(J=F*X.mass,J=F*X.mass*ri,nt=Ms*J/st,M[_e]+=Q*nt/De,G[_e]+=et*nt/De),!0}}},"getApplyForce"),rn=r(I=>{const F=I.X,C=I.Y,M=I.R,G=I.masses,U=I.bucketSize;return O=>{let $,Y,H=0,K=0,X=0,J=0;const nt=O.data;if(nt!==null)if(U!==0){const Q=nt,et=Vt(Q,nn,Xs,Ii);H=et.x,K=et.y,X=et.r;for(let st=0;st<Q.length;st++)J+=G[Q[st]]}else Y=nt,H=F[Y],K=C[Y],X=M[Y],J=G[Y];else if(O.left&&O.right){const Q=O.left.cx,et=O.left.cy,st=O.right.cx,lt=O.right.cy,rt=O.left.r,ot=O.right.r,ht=st-Q,at=lt-et,ut=ot-rt,xt=Math.sqrt(ht*ht+at*at);H=(Q+st+ht/xt*ut)/2,K=(et+lt+at/xt*ut)/2,X=(xt+rt+ot)/2,J=O.left.mass+O.right.mass}else $=O.left||O.right,H=$.cx,K=$.cy,X=$.r,J=$.mass;O.cx=H,O.cy=K,O.r=X,O.mass=J}},"getAccumulateBodies"),$s=r((I,F,C)=>{const M=I.length,G=F.X,U=F.Y,O=F.R,$=F.degrees,Y=F.pinned,H=F.masses,K=F.nodeIds,X=C.scaling,J=C.defaultRadius,nt=C.bucketSize;F.bucketSize=nt===void 0?Math.floor(Math.log(M)):nt;let Q=1/0,et=1/0,st=-1/0,lt=-1/0;const rt=Math.PI*(3-Math.sqrt(5));let ot=0;for(let ht=0;ht<I.length;ht++){const at=I[ht];let{x:ut,y:xt,r:wt}=at,{mass:Mt=1}=at;if(Mt=Math.max(Mt*Ve(wt||J,$[ht]),.001),isNaN(ut)||isNaN(xt)){const Rt=5*Math.sqrt(ht),kt=ht*rt;ut=Rt*Math.cos(kt),xt=Rt*Math.sin(kt)}wt=wt||J,G[ht]=ut,U[ht]=xt,O[ht]=wt,Y[ht]=at.pinned?1:0,H[ht]=Mt*X,K[ht]=ht,wt>ot&&(ot=wt),ut<Q&&(Q=ut),xt<et&&(et=xt),ut>st&&(st=ut),xt>lt&&(lt=xt)}if(I.length>1&&(st-Q<2*ot||lt-et<2*ot)){const ht=(Q+st)/2,at=(et+lt)/2;for(let ut=0;ut<M;ut++)if(!Y[ut]){const xt=5*Math.sqrt(ut),wt=ut*rt,Mt=ht+xt*Math.cos(wt),Rt=at+xt*Math.sin(wt);G[ut]=Mt,U[ut]=Rt,Mt<Q&&(Q=Mt),Rt<et&&(et=Rt),Mt>st&&(st=Mt),Rt>lt&&(lt=Rt)}}F.updateGroups(),nn=r(ht=>G[ht],"getX"),Xs=r(ht=>U[ht],"getY"),Ii=r(ht=>O[ht],"getR"),Hs=rn(F),sn=oi(F,C)},"initialize");function _s(I,F,C,{maxDisplacement:M}){const{X:G,Y:U,fx:O,fy:$,pinned:Y,layer:H,layers:K,surfaces:X,movements:J}=C;J.fill(0);let nt=0;const Q=I.length;let et=1/0,st=1/0,lt=-1/0,rt=-1/0;const ot=M*M;for(let ut=0;ut<Q;ut++){const xt=I[ut],wt=O[xt]*=F,Mt=$[xt]*=F,Rt=H[xt];let kt=wt,Ht=Mt;const Jt=G[xt],te=U[xt];if(kt*kt+Ht*Ht>ot){const Ae=Math.sqrt(kt*kt+Ht*Ht)/M;Ht/=Ae,kt/=Ae}Y[xt]||(G[xt]+=kt,U[xt]+=Ht);const le=Math.sqrt(kt*kt+Ht*Ht);Y[xt]||(Jt<et&&(et=Jt),te<st&&(st=te),Jt>et&&(lt=Jt),te>st&&(rt=te),J[Rt-1]+=le),nt+=Rt*le}const ht=Math.max(lt-et,0),at=Math.max(rt-st,0);for(let ut=0;ut<K.length;ut++){const xt=K[ut],wt=xt.length;let Mt=1/0,Rt=1/0,kt=-1/0,Ht=-1/0,Jt=0;for(let Re=0;Re<wt;Re++){const us=xt[Re];if(Y[us])continue;const Fe=G[us],Rs=U[us];Fe<Mt&&(Mt=Fe),Rs<Rt&&(Rt=Rs),Fe>kt&&(kt=Fe),Rs>Ht&&(Ht=Rs),Jt++}const te=kt-Mt,le=Ht-Rt,Ae=Math.max(1,Math.sqrt(te**2+le**2));X[ut]=Ae;const Te=Jt===0?0:J[ut]/Jt,ke=ht*at||1;J[ut]=Te>Jt?Te/ke:0}return C.updateGroups(),nt}function on(I,F,C){ai(I,F,C),Oe(C)}function ai(I,F,{sources:C,targets:M,degrees:G,nodeIds:U,edgeIds:O}){const $={};for(let Y=0;Y<I.length;Y++)$[Y]=U[Y]=Y;for(let Y=0;Y<F.length;Y++){const{source:H,target:K}=F[Y],X=$[H],J=$[K];O[Y]=Y,C[Y]=X,M[Y]=J,G[X]++,G[J]++}}function Oe({nodeIds:I,edgeIds:F,sources:C,targets:M,degrees:G,layer:U,layers:O,component:$,components:Y,cluster:H,parent:K}){let X=0,J=1;const nt=new Uint32Array(I.length);for(let ot=0;ot<I.length;ot++)nt[ot]=G[ot];const Q=new Array(I.length);for(let ot=0;ot<F.length;ot++){const ht=F[ot],at=C[ht],ut=M[ht];Q[at]=Q[at]||[],Q[ut]=Q[ut]||[],Q[at].push(ut),Q[ut].push(at)}const et=new Uint8Array(I.length),st=new Uint8Array(I.length);K.fill(-1);let lt=0;for(let ot=0;ot<I.length;ot++)if(et[ot]===0){const ht=[ot];for(;ht.length!==0;){const at=ht.pop();if(et[at]===0&&Q[at]!==void 0){const ut=Q[at];for(let xt=0;xt<ut.length;xt++)ht.push(ut[xt])}et[at]=1,$[at]=lt}lt++}const rt=new Array(I.length);for(let ot=0;ot<I.length;ot++)U[ot]=0,rt[ot]=ot;for(;rt.length!==0;){const ot=[],ht=[];for(let at=0;at<rt.length;at++)nt[rt[at]]<=X&&(ot.push(at),ht.push(rt[at]));for(let at=0;at<ht.length;at++){const ut=ht[at];st[ut]=X,U[ut]=J;const xt=Q[ut];if(xt)for(let wt=0;wt<xt.length;wt++)nt[xt[wt]]--}for(let at=0;at<ht.length;at++){const ut=ht[at],xt=Q[ut];if(xt)for(let wt=0;wt<xt.length;wt++){const Mt=xt[wt],Rt=U[Mt];if(Rt===void 0||Rt>J){K[ut]=Mt;break}}}ot.reverse();for(let at=0;at<ot.length;at++)rt.splice(ot[at],1);if(J+=1,rt.length>0){let at=1/0;for(let ut=0;ut<rt.length;ut++){const xt=nt[rt[ut]];xt<at&&(at=xt)}at>=X+1&&(X=at,J=1)}}et.fill(0);for(let ot=0;ot<I.length;ot++){const ht=I[ot],at=U[ht];if(K[ht]===-1||U[K[ht]]===at){const ut=[ht];for(et.fill(0);ut.length!==0;){const xt=ut.pop();if(et[xt])continue;if(U[xt]>at){K[ht]=xt;break}const wt=Q[xt];if(et[xt]=1,wt)for(let Mt=0;Mt<wt.length;Mt++)ut.push(wt[Mt])}}}for(let ot=0;ot<I.length;ot++){const ht=I[ot],at=$[ht];Y[at]=Y[at]||[],Y[at].push(ht);const ut=U[ht]-1;O[ut]=O[ut]||[],O[ut].push(ht),H[ht]=K[ht]}}Li.initialize=$s,r(_s,"velocityVerlet"),r(on,"topology"),r(ai,"initTopology"),r(Oe,"decomposition");var an=class{constructor(I,F=!0,C){this.bucketSize=0,this.cells=[];const M=I.nodes.length,G=I.edges.length;if(u(M+G),this.X=new Array(M),this.Y=new Array(M),this.R=new Array(M),this.fx=new Float32Array(M),this.fy=new Float32Array(M),this.vx=new Float32Array(M),this.vy=new Float32Array(M),this.pinned=new Uint8Array(M),this.masses=new Float32Array(M),this.weights=new Float32Array(G),this.lengths=new Float32Array(G),this.sources=new Uint32Array(G),this.targets=new Uint32Array(G),this.degrees=new Uint32Array(M),this.layer=new Uint32Array(M),this.parent=new Int32Array(M),this.cluster=new Int32Array(M),this.component=new Uint32Array(M),this.components=[],this.layers=[],this.nodeIds=new Array(M),this.edgeIds=new Array(G),this.groups=C&&C.groups||[],this.maxR=new Float32Array(Math.max(this.groups.length,1)),this.cellSize=0,this.cells=[],this.hasGroups=this.groups.length>0,this.hasGroups){this.nodeToGroup=new Int32Array(M);for(let U=0;U<this.groups.length;U++){const O=this.groups[U];this.cells[U]={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,ox:0,oy:0,cx:0,cy:0},this.maxR[U]=0;for(let $=0;$<O.length;$++){const Y=O[$];this.nodeToGroup[Y]=U,this.maxR[U]=Math.max(this.maxR[U],I.nodes[Y].r)}}}F&&on(I.nodes,I.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)}updateGroups(){if(!this.hasGroups)return void(this.cellSize=1/0);const I=this.X,F=this.Y,C=this.groups,M=this.cells,G=this.maxR;let U=0;C.forEach((H,K)=>{const X=M[K];X.minX=1/0,X.minY=1/0,X.maxX=-1/0,X.maxY=-1/0,H.forEach(et=>{const st=I[et],lt=F[et];X.minX=Math.min(st,X.minX),X.minY=Math.min(lt,X.minY),X.maxX=Math.max(st,X.maxX),X.maxY=Math.max(lt,X.maxY)});const J=G[K];X.minX-=J,X.minY-=J,X.maxX+=J,X.maxY+=J;const nt=Math.abs(X.maxX-X.minX),Q=Math.abs(X.maxY-X.minY);U=Math.max(U,nt,Q),X.cx=(X.maxX+X.minX)/2,X.cy=(X.maxY+X.minY)/2}),U=Math.ceil(2*U+1),this.cellSize=U;const O=Math.ceil(Math.sqrt(C.length)),$=O*U/2,Y=U/2;for(let H=0;H<C.length;H++){const K=C[H],X=H%O,J=Math.floor(H/O),nt=M[H],Q=(X+.5)*U-$,et=(J+.5)*U-$,st=Q-nt.cx,lt=et-nt.cy;nt.cx=Q,nt.cy=et,nt.minX=Q-Y,nt.minY=et-Y,nt.maxX=Q+Y,nt.maxY=et+Y;for(const rt of K)I[rt]+=st,F[rt]+=lt}}};function N(I,F){return I<F?I*F+Math.pow(F-I-1,2)/4:I*F+Math.pow(I-F-1,2)/4}function P(I,F){return(I+F)*(I+F+1)/2+F}function V({edgeIds:I,sources:F,targets:C,pinned:M,degrees:G,X:U,Y:O,R:$},Y=0,H=.5){const K={},X={};for(const J of I){const nt=F[J],Q=C[J];nt!==Q&&(K[nt]=K[nt]||{},K[Q]=K[Q]||{},K[nt][Q]=!0,K[Q][nt]=!0)}Object.keys(K).forEach(J=>{const nt=Number(J),Q=Object.keys(K[Number(nt)]);if(Q.length===2){const[et,st]=Q,lt=N(Number(et),Number(st));lt in X||(X[lt]=[Number(st),Number(et)]),M[nt]||X[lt].push(nt)}}),Object.keys(X).forEach(J=>{const[nt,Q,...et]=X[Number(J)];if(et.length<3)return;const st=U[nt],lt=O[nt],rt=U[Q],ot=O[Q],ht=G[nt],at=.25+.5*ht/(ht+G[Q]);let ut=st+(rt-st)*at,xt=lt+(ot-lt)*at,wt=-(ot-lt),Mt=rt-st;const Rt=Math.sqrt(Math.pow(st-rt,2)+Math.pow(lt-ot,2));wt=-2*wt/Rt,Mt=-2*Mt/Rt;const kt=Math.acos(wt/Math.sqrt(wt*wt+Mt*Mt));Y>0&&(kt<Y||kt>Math.PI-Y&&kt<=Math.PI?(wt=2*Math.cos(Math.PI-Y),Mt=2*Math.sin(Math.PI-Y)):(kt>2*Math.PI-Y||kt>=Math.PI&&kt<Math.PI+Y)&&(wt=2*Math.cos(Y),Mt=2*Math.sin(Y)));let Ht=0,Jt=1;et.sort((ke,Re)=>$[Re]-$[ke]);let te=0,le=0;const Ae=Math.max($[et[0]],$[et[1]])/2;et.length%2==1&&(Ht=1,ut-=wt*Ae,xt-=Mt*Ae);const Te=1+H;for(let ke=0;ke<et.length;ke++){const Re=(Ht+ke)%2,us=et[ke],Fe=ke>=2?$[us]:Ae,Rs=(Re?te:le)+Fe;U[us]=ut+wt*Jt*Rs,O[us]=xt+Mt*Jt*Rs,Re?te+=Fe*Te:le+=Fe*Te,Jt=-Jt}})}function D(I){let F=0,C=0;for(const O of I)F+=O.w*O.h,C=Math.max(C,O.w);I.sort((O,$)=>$.h-O.h);const M=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(F/.95)),C),h:1/0}];let G=0,U=0;for(const O of I)for(let $=M.length-1;$>=0;$--){const Y=M[$];if(!(O.w>Y.w||O.h>Y.h)){if(O.x=Y.x,O.y=Y.y,U=Math.max(U,O.y+O.h),G=Math.max(G,O.x+O.w),O.w===Y.w&&O.h===Y.h){const H=M.pop();$<M.length&&(M[$]=H)}else O.h===Y.h?(Y.x+=O.w,Y.w-=O.w):O.w===Y.w?(Y.y+=O.h,Y.h-=O.h):(M.push({x:Y.x+O.w,y:Y.y,w:Y.w-O.w,h:O.h}),Y.y+=O.h,Y.h-=O.h);break}}}function tt(I,F=1){return D(I.map(C=>(C.w+=C.maxr+F,C.h+=C.maxr+F,C)).sort((C,M)=>C.w*C.h-M.w*M.h))}r(an,"LayoutData"),r(N,"unorderedPair"),r(P,"orderedPair"),r(V,"alignSiblings"),r(D,"potpack"),r(tt,"boxpack");var mt=class{constructor(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}add(I,F,C,M){this.ids.push(I),F-M<this.xmin&&(this.xmin=F-M),C-M<this.ymin&&(this.ymin=C-M),F+M>this.xmax&&(this.xmax=F+M),C+M>this.ymax&&(this.ymax=C+M),M>this.maxr&&(this.maxr=M),this.mx+=M*F,this.my+=M*C,this.m+=M}measure(I=0){return this.w=this.xmax-this.xmin+2*I,this.h=this.ymax-this.ymin+2*I,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this}};function Et(I,F=20,C,M,G){for(const Q of I){const{x:et,y:st,r:lt}=Vt(Q.ids,rt=>C[rt],rt=>M[rt],rt=>G[rt]);Q.cx=et,Q.cy=st,Q.radius=lt+F}const U=I.slice().sort((Q,et)=>Q.radius-et.radius),O=U.map(Q=>({x:Q.cx,y:Q.cy,r:Q.radius})),$=U.pop();let Y=3*Math.PI/2,H=$.radius;const K=2*Math.PI,{cx:X,cy:J}=$,nt=[$];for(;U.length!==0;){const Q=U[U.length-1],et=H+Q.radius,st=X+Math.cos(Y)*et,lt=J+Math.sin(Y)*et;nt.some(rt=>{const ot=rt.cx-st,ht=rt.cy-lt;return Math.sqrt(ot*ot+ht*ht)<rt.radius+Q.radius})?H+=1:(Q.x=st-Q.w/2,Q.y=lt-Q.h/2,Q.cx=st,Q.cy=lt,O[U.length-1].x=st,O[U.length-1].y=lt,nt.push(U.pop()),Y+=(2*Q.radius+1)/et*1%K)}}function vt(I,F,C,M){let G=0;const U=[];for(const O of M){const $=new mt;for(const Y of O)$.add(Y,I[Y],F[Y],C[Y]);U.push($.measure()),O.length>U[G].ids.length&&(G=U.length-1)}return{boxes:U,biggest:G}}function Ct(I,F,{X:C,Y:M,R:G,components:U,pinned:O,degrees:$,sources:Y,targets:H,edgeIds:K},{update:X,onUpdate:J,placement:nt,placementOffset:Q,alignSiblings:et,siblingsMinAngle:st,siblingsOffset:lt}){if(et&&(V({X:C,Y:M,R:G,degrees:$,pinned:O,sources:Y,targets:H,edgeIds:K},st,lt),X(I,C,M)),nt){const{boxes:rt,biggest:ot}=vt(C,M,G,U);if(nt==="spiral")Et(rt,Q,C,M,G);else{if(nt!=="box")return;tt(rt,Q)}const ht=rt[ot].xmin-rt[ot].x,at=rt[ot].ymin-rt[ot].y;for(const ut of rt){const{xmin:xt,ymin:wt,x:Mt,y:Rt,ids:kt}=ut,Ht=xt-Mt-ht,Jt=wt-Rt-at;for(const te of kt)C[te]-=Ht,M[te]-=Jt}X(I,C,M),J()}}function Nt(I,F,{X:C,Y:M,R:G,degrees:U,nodeIds:O,edgeIds:$,layers:Y,layer:H,cluster:K,masses:X,weights:J,sources:nt,targets:Q},{cx:et,cy:st,nextTick:lt,cancelTick:rt,update:ot,onUpdate:ht,batch:at,maxIterations:ut,steps:xt,minMovement:wt},Mt,Rt){const kt=Y.slice();at=at??1;let Ht,Jt=0;function te(){rt(Ht),ot(I,C,M),ht(),Rt(Jt)}r(te,"stop");const le={};for(let qe=0;qe<F.length;qe++)le[Number(F[qe].id)||qe]=qe;const Ae=new Map;for(let qe=0;qe<$.length;qe++){const Ws=$[qe];Ae.set(P(nt[Ws],Q[Ws]),Ws)}for(let qe=0;qe<Y.length;qe++){const Ws=Y[qe],Ci=qe;for(let Fs=0;Fs<Ws.length;Fs++){const Pe=Ws[Fs],Me=K[Pe];Me!==-1&&(X[Me]+=X[Pe])}for(let Fs=0;Fs<F.length;Fs++){const Pe=F[Fs],Me=Number(Pe.id)||Fs,Zs=Pe.source,ln=Pe.target,ua=J[le[Me]];if(H[Zs]===Ci&&H[ln]===Ci){const Rg=K[Zs],Fg=K[ln];if(Rg!==Fg){const Pg=Ae.get(P(Rg,Fg));Pg!==void 0&&(J[Pg]+=ua)}}}}O.length=0,$.length=0,ut=1/0;let Te=1;const ke=1-Math.pow(.1,1/xt/2),Re=(Te-.1)/xt;let us,Fe,Rs=.5;function jd(){Te+=(0-Te)*ke;const qe=Mt(Te,O,$);let Ws=Te<=Rs||qe<wt;if(Jt===0||Ws){const Ci=kt.pop();if(Ci){us&&(Fe=us.reduce((Pe,Me)=>Math.max(Pe,et-C[Me],st-M[Me]),0)),O.push.apply(O,Ci);for(let Pe=0;Pe<Ci.length;Pe++){const Me=Ci[Pe],Zs=K[Me];if(Zs!==-1){const ln=U[Me]>1?2:1,ua=G[Zs]+G[Me];X[Zs]-=X[Me],C[Me]=C[Zs]+ln*ua*(2*h()-1),M[Me]=M[Zs]+ln*ua*(2*h()-1)}else us&&(C[Me]=et+2*Fe*(1-2*h()),M[Me]=st+2*Fe*(1-2*h()))}us=Ci;const Fs=O.reduce((Pe,Me)=>(Pe[Me]=!0,Pe),{});$.length=0;for(let Pe=0;Pe<F.length;Pe++){const{source:Me,target:Zs,id:ln}=F[Pe];Fs[Me]&&Fs[Zs]&&$.push(le[Number(ln)])}Ws=!1,kt.length===0?(Te=.2,Rs=.1):(Te=.1+2*Re,Rs=.1)}}Jt%at===0&&(ot(I,C,M),ht()),++Jt>=ut||Ws?te():Ht=lt(jd)}return r(jd,"simulationStep"),{done:!1,start(){return Ht=setTimeout(jd),this},stop(){return te(),this},get iterations(){return Jt}}}r(mt,"Component"),r(Et,"spiralpack"),r(vt,"groupAndMeasure"),r(Ct,"postprocessing"),r(Nt,"multiLevel");var $t,Kt=class{constructor(I){this.promise=new Promise(I)}then(I){return this.promise.then(I)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function Ut(I,F,{X:C,Y:M,nodeIds:G,edgeIds:U,layers:O,movements:$,movementsPrev:Y,surfaces:H,surfacesPrev:K},X,J,nt){const{nextTick:Q,cancelTick:et,steps:st,minMovement:lt,update:rt,onUpdate:ot,autoStop:ht}=X,at=X.batch??1;let ut=0,xt=1,wt,Mt=1-Math.pow(.05,1/st),Rt=!1;const kt=r(()=>{Rt=!0,et(wt),ot(),nt(ut)},"stop");let Ht=!1;const Jt=r(()=>{xt+=(.001-xt)*Mt;const te=J(xt,G,U),le=O.length;let Ae=!1,Te=!1;if(ht){Ae=Te=!0;const{movementRatio:Re,surfaceRatio:us}=ht;for(let Fe=0;Fe<le;Fe++)Ae&&Math.abs(1-H[Fe]/K[Fe])>us&&(Ae=!1),Te&&Math.abs($[Fe]-Y[Fe])>Re&&(Te=!1)}Ae&&Te&&!Ht&&(Mt=1-Math.pow(.001,1/Math.max(10,ut)),Ht=!0);const ke=Rt||xt<.05||te!==0&&te<=lt;if(ut%at===0&&(rt(I,C,M),ot()),++ut>=st||ke)return kt();for(let Re=0;Re<le;Re++)Y[Re]=$[Re],K[Re]=H[Re];wt=Q(Jt)},"simulationStep");return{done:!1,start(){return wt=setTimeout(Jt),this},stop(){return kt(),this},get iterations(){return ut}}}function Wt(I,F={}){let C,M;const G=r((J={nodes:[],edges:[]})=>(C=J.nodes,M=J.edges,u(P(C.length,M.length)),new an(J,!0,F)),"setGraph"),U=r((J={})=>new Ns(J),"setOptions");let O=G(I),$=U(F);m(M,O),$s(C,O,$),Zt(C,O,$),p(C,O,$);const Y=_s;let H=null;const K=r((J,nt,Q)=>(H&&(H.destroy(),H=null),nt.length<=1?0:($.barnesHutOptimization?H=Li(J,nt,H,O):ie(J,nt,O,$),g(J,Q,O,$),H&&$.elasticity!==0&&oe(0,nt,H,O,$),f(J,nt,O,$),Y(nt,$.inertia,O,$))),"step");let X;return{setOptions:(J={})=>($=U(J),this),setGraph:({nodes:J,edges:nt})=>(O=G(I),m(nt,O),$s(J,O,$),Zt(J,O,$),p(J,O,$),this),start(){return X=($.multilevel?Nt:Ut)(C,M,O,$,K,J=>{X.done||Ct(C,0,O,$),$.onEnd(J);const nt=F.groups;if(nt)for(let Q=0;Q<nt.length;Q++){const et=nt[Q],st=et.reduce((lt,rt)=>(lt.x+=O.X[rt],lt.y+=O.Y[rt],lt),{x:0,y:0});st.x/=et.length,st.y/=et.length,F.cx&&(st.x-=F.cx),F.cy&&(st.y-=F.cy);for(let lt=0;lt<et.length;lt++)O.X[et[lt]]-=st.x,O.Y[et[lt]]-=st.y}X.done=!0}).start(),this},iterations:()=>X.iterations,data:()=>O,stop(){return X&&X.stop(),this},step(J=1){return K(J,O.nodeIds,O.edgeIds),$.update(C,O.X,O.Y),this}}}return r(Kt,"SimulationPromise"),r(Ut,"singleLevel"),r(Wt,"force"),Wt.run=(I,F)=>{let C;const M=new Kt(G=>{F.onEnd=G,C=Wt(I,F).start()});return M.simulation=C,M.stop=()=>(C.stop(),M),M},$t=o,((I,F,C,M)=>{if(F&&typeof F=="object"||typeof F=="function")for(let G of i(F))n.call(I,G)||G===C||e(I,G,{get:()=>F[G],enumerable:!(M=s(F,G))||M.enumerable});return I})(e({},"__esModule",{value:!0}),$t)})();return t.force.apply(this,arguments)}bt(qp,"SimulationPromise"),bt(Ll,"gpuLayout"),Ll.run=(t,e,s)=>{let i;const n=new qp(r=>{s.onEnd=r,i=Ll(t,e,s).start()});return n.simulation=i,n.stop=()=>(i.stop(),n),n};var XP=2,$P=1.25,Yp=t=>{},Hp={name:"force",imports:{force:jp},configure(t,{graph:e,events:s}){const i=t.nodes._indexes,n=t.xs?t.xs:e.getNodeAttribute("x").getMultiple(i),r=t.ys?t.ys:e.getNodeAttribute("y").getMultiple(i),o=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(i),a=e.getNodeAttribute("layoutable").getMultiple(i),l=t.edges,d=[],h=[],u={},c=t.edgeWeight||Yp,g=t.nodeMass?p=>t.nodeMass(t.nodes.get(p)):Yp;t.edgeStrength===void 0&&(t.edgeStrength=.5),t.gpu&&(t.edgeStrength/=XP),t.gravity==null&&(t.gravity=.01),t.siblingsOffset==null&&(t.siblingsOffset=0),t.theta==null&&(t.theta=.62),t.autoStop=!!t.autoStop,t.alignSiblings=!!t.alignSiblings;const m=t.radiusRatio||$P;for(let p=0;p<t.nodes._indexes.length;p++){const _=t.nodes._indexes[p];u[_]=p,d.push({id:p,x:n[p],y:r[p],r:o[p]*m,mass:g(p),pinned:!a[p]})}l.forEach(p=>{const _=u[p.getSource()._index],y=u[p.getTarget()._index];_!==y&&_!==void 0&&y!==void 0&&h.push({source:_,target:y,weight:c(p)})});const f=yd({...t});return delete f.nodes,delete f.edges,{graph:{nodes:d,edges:h},options:f,indexes:t.nodes._indexes,done:!1,x:n,y:r,chunkPeriod:250}},update:function(t,e){if(!e.simulation&&t){let s;e.done=!1,e.graph=t.graph,e.options=t.options,e.indexes=t.indexes;let i=!1;if(t.options.gpu){const l=Cb("webgl2",{},()=>{Vi("GPU layout: WebGL context not available. Falling back on CPU."),e.simulation=void 0,e.options.gpu=!1,e.cleanUp&&e.cleanUp(),this._update(t,e)});l&&(s=l.context,e.cleanUp=l.cleanUp),i=!!s}let n=Date.now();i||(t.options.nextTick=l=>Date.now()-n<=e.chunkPeriod?l():(n=Date.now(),setTimeout(l,0))),t.options.update=(l,d,h)=>{e.x=d,e.y=h},t.options.onEnd=()=>{if(i&&s){const{X:l,Y:d}=e.simulation.data(!0);e.x=l,e.y=d}e.done=!0,e.simulation=void 0,e.cleanUp&&e.cleanUp()},t.options.bucketSize=0;const r=i&&s?Ll(t.graph,s,t.options).start():jp(t.graph,t.options).start();e.simulation=r;const{X:o,Y:a}=i&&s?{X:new Float32Array(t.graph.nodes.length),Y:new Float32Array(t.graph.nodes.length)}:r.data();e.x=o,e.y=a}return{graph:e.graph,indexes:e.indexes,x:e.x,y:e.y}},context:function(){return{done:!1,graph:{nodes:[],edges:[]},x:null,y:null,indexes:null,chunkPeriod:250}},stop:function(t){t.done=!0,t.simulation&&(t.simulation.stop(),delete t.simulation)},isRunning:function(t){return!t.done||(t.done=!1,!1)},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}};function WP(t,e,s,i=t.getNodes()){if(!e)return s?t.nodeList():i.filter(n=>n.getMetaNode()===null);if(!(e instanceof Ei)){if(Array.isArray(e)&&e.length>0)return t.getNodes(e);throw Error("[Layout]: 'nodes' must be a NodeList or an NodeId[]")}return e}function ZP(t,e,s=t.getEdges()){if(!e)return s;if(!(e instanceof Mn)){if(Array.isArray(e)&&e.length>0)return t.getEdges(e);throw Error("[Layout]: 'edges' must be a EdgeList or a valid EdgeId[]")}return e}function KP(t){if(!t.size)return;const e=new Set(t.getId());return t.getAdjacentEdges().filter(s=>s.getExtremities().getId().every(i=>e.has(i)))}function dA(t,e={},s=!0){s||(e.edges=void 0);const i=WP(t,e.nodes,e.edges),n=ZP(t,e.edges,KP(i));return{...e,nodes:i.concat(n.getExtremities()).dedupe(),edges:n}}function QP(t,e,s,i,n){return{x:t+n*(s-t),y:e+n*(i-e)}}var JP=10;function tz(t,e,s){let i,n,r=1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o],d=e[(o+1)%a],h=Kc(t[0],t[1],l[0],l[1],d[0],d[1]);h<r&&(r=h,i=l,n=d)}return ez(t[0],t[1],i[0],i[1],n[0],n[1],s)}function ez(t,e,s,i,n,r,o){const a=Bb(t,e,s,i,n,r);let l=-(i-r),d=s-n;const h=Math.sqrt(l*l+d*d);return l/=h,d/=h,[a.x-o*l,a.y-o*d]}function sz(t,e,s,i){for(let n=0;n<t.length;n++){const[r,o]=t[n],a=Math.abs(r-e),l=Math.abs(o-s);if(a+l<=i||!(a>i||l>i)&&a*a+l*l<=i*i)return!0}return!1}function iz(t,e,s){const i=Ob(s.cx,s.cy,t,e,s.minX,s.minY,s.maxX,s.maxY);let n,r=1/0,o={x:s.maxX,y:e};for(const a of i)n=Ce(t,e,a.x,a.y),n<r&&(r=n,o=a);return o}function nz(t){const e=t.bottomLeft(),s=t.topRight();return[[e.x,e.y],[e.x,s.y],[s.x,s.y],[s.x,e.y]]}function rz(t,e,s,i){const n=[],r=[],o=[];return t.forEach((a,l)=>{i[l]&&(n.push(a),r.push(e[l]),o.push(s[l]))}),{ids:n,subgraphPositions:r,radii:o}}function oz(t,e,s){const{duration:i=0,margin:n=5,referenceNodes:r,nodes:o}=e,{ids:a,subgraphPositions:l,radii:d}=rz(o.getId(),s,o.getAttribute("radius"),o.getAttribute("layoutable")),h=t.getNodes(a);let u=r;!u||u instanceof Ei||(u=t.getNodes(u));const c=u||h.inverse(),g=c.getPosition().map(S=>[S.x,S.y]),m=h.getBoundingBox(),f=c.getBoundingBox();f.pad(f.maxScaledSize);const p={layoutName:"incremental",ids:h.getId(),positions:{before:l,current:l}};if(!h.size)return Promise.resolve(p);const _=Qo(l.map(S=>S.x),l.map(S=>S.y),d),[y,x]=_,b=_[2]+f.maxScaledSize+n;let v,A=0,E=0;if(sz(g,y,x,b))if(c.size<=3){if(Nc(y,x,_[2],f.minX,f.minY,f.maxX,f.maxY)){const S=iz(y,x,f);v=Ce(f.cx,f.cy,S.x,S.y);const w=QP(f.cx,f.cy,S.x,S.y,(v+b)/v);A=w.x-y,E=w.y-x}}else{const S=Tc.from(g,k=>k[0],k=>k[1]),w=Co(S.triangles,g),T=g.length>3?Co(S.hull,g):nz(f),L=Tx(c.getPosition(),JP,b,w,T);let R=tz([y,x],T,b);if(L.length>0){let k=Math.pow(y-R[0],2)+Math.pow(x-R[1],2);for(const j of L)A=y-j[0],E=x-j[1],v=A*A+E*E,v<k&&(k=v,R=j.slice(0,2));A=R[0]-y,E=R[1]-x}else A=R[0]-m.cx,E=R[1]-m.cy}if(A||E){const S=l.map(w=>(w.x+=A,w.y+=E,w));if(e.locate){typeof e.locate=="boolean"&&(e.locate={});const w=t.modules.locate.layoutDataBoundingBox({x:[...g.map(L=>L[0]),...S.map(L=>L.x)],y:[...g.map(L=>L[1]),...S.map(L=>L.y)],indexes:t.getNodes()._indexes}),T=t.modules.locate.computeConfigForBounds(w,e.locate);t.modules.camera.setView(T,{duration:i,easing:e.locate.easing,ignoreZoomLimits:!0})}return p.positions.current=S,h.setAttributes(S,i).then(()=>p)}return h.setAttributes(l,i).then(()=>p)}function az(t,e,s){const i=be(e);return i.duration=0,i.dryRun=!0,i.locate=!1,delete i.incremental,s(i).then(n=>oz(t,e,n.positions.current))}function lz(t,e,s){const{nodes:i,duration:n,centralNode:r}=e,o=i,a=o.reduce((d,h)=>(d[h._index]=!0,d),{}),l=t.getNodes();if(e.focusOnGroupShape)return s({nodes:o,duration:0}).then(()=>{const d=o.concat(r),h=d.getAttribute("layoutable");return d.setAttributes({layoutable:!1}),s({nodes:t.getNodes(),duration:n}).then(()=>d.setAttributes(h))});{const d=be(e);return delete d.centralNode,d.incremental=!1,d.nodes=l,d.nodeMass=(h,u)=>(u+1)*(a[h._index]?1:2),s(d)}}function hA(t,e,s){const i=dA(e.modules.graph,t);if(typeof i.incremental!="boolean"&&"margin"in i.incremental&&!isFinite(i.incremental.margin))throw new Error("Incremental layout: margin has to be a positive number");const n=be(i);return typeof i.incremental!="boolean"&&(n.margin=i.incremental.margin,n.referenceNodes=i.incremental.referenceNodes),n.centralNode&&!n.centralNode.getAttribute("layoutable")?lz(e,n,s):az(e,n,s)}var dz=t=>(t.modules.layouts.register(Hp),(e={})=>{if(e.incremental)return hA(e,t,t.layouts.force);if(e.edgeStrength!==void 0&&(!isFinite(e.edgeStrength)||e.edgeStrength<0))throw new Error("force layout: edgeStrength must be a positive number");if(e.steps!==void 0&&(!isFinite(e.steps)||e.steps<=0))throw new Error("force layout: 'steps' must be a positive integer");if(e.edgeLength!==void 0&&(!isFinite(e.edgeLength)||e.edgeLength<=0))throw new Error("force layout: 'edgeLength' must be positive");if(e.gravity!==void 0&&(!isFinite(e.gravity)||e.gravity<0||e.gravity>=1))throw new Error("force layout: 'gravity' must be between 0 and 1");if(e.charge!==void 0&&!isFinite(e.charge))throw new Error("force layout: 'charge' must be a number");if(e.radiusRatio!==void 0&&(!isFinite(e.radiusRatio)||e.radiusRatio<0))throw new Error("force layout: 'radiusRatio' must be a positive number");if(e.theta!==void 0&&(!isFinite(e.theta)||e.theta<0||e.theta>1))throw new Error("force layout: 'theta' must be between 0 and 1");if(!(e.cx===void 0&&e.cy===void 0||typeof e.cx=="number"&&typeof e.cy=="number"))throw new Error("force layout: both 'cx' and 'cy' must be numbers");if(e.siblingsOffset!==void 0&&!isFinite(e.siblingsOffset))throw new Error("force layout: 'siblingsOffset' must be a number");return e.gpu=!!e.gpu,e.gpu&&(e.useWebWorker=!1),t.modules.layouts.start(Hp.name,e)}),Xp={name:"forceLink",configure:function(t,{graph:e,camera:s,graphics:i}){const n=t.nodes._indexes,r=t.edges._indexes,o={},a={},l=n.length,d=r.length;let h;var u=e.getObjectList(!0),c=e.getObjectList(!1);(t.nodes||t.edges)&&(delete(t=be(t)).nodes,delete t.edges);const g=e.getNodeAttribute("innerStroke.width").getMultiple(n),m=e.getNodeAttribute("outerStroke.width").getMultiple(n),f=e.degrees(n),p=t.xs?t.xs:e.getNodeAttribute("x").getMultiple(n),_=t.ys?t.ys:e.getNodeAttribute("y").getMultiple(n),y=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(n),x=e.nodeList(n).getAttribute("layoutable"),b=typeof t.nodeMass=="function"?t.nodeMass:function(z,q,B){return q+1};delete t.nodeMass;const v=typeof t.edgeWeight=="function"?t.edgeWeight:function(z){return 1};delete t.edgeWeight,isFinite(t.scalingRatio)||delete t.scalingRatio;const A=n.reduce((z,q,B)=>(x[B]||(z[q]=!0),z),{});let E=0,S=0,w=0;const T=s.getZoom();for(h=0;h<n.length;++h){const z=n[h],q=p[h],B=_[h],W=y[h]+(g[h]+m[h])/T;o[z]={id:z,x:q,y:B,degree:f[h],size:W,pinned:!!A[z],mass:b(u.get(z),f[h],h)},w=Math.max(W,w)}if(l>1)for(h=0;h<l;h++){const z=o[n[h]];E+=z.x,S+=z.y}E/=l,S/=l;const L={x:E,y:S},R=e.edgeList(r),k=R.getSource()._indexes,j=R.getTarget()._indexes;for(h=0;h<d;h++){const z=r[h],q=k[h],B=j[h];o[q]&&o[B]&&(a[z]={source:q,target:B},a[z].weight=v(c.get(z)))}return{nodes:o,edges:a,maxSize:w,config:yd(t),barycentre:L}},context:function(){return{chunkPeriod:250}},update:function(t,e){let s;!e.W&&t?(s={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:!0,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!0,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}},e.W=s,function(d,h){const u=function(g,m){let f,p,_,y=g.nodes,x=g.edges,b=g.maxSize,v=Object.keys(g.nodes),A=Object.keys(g.edges),E=v.length*s.ppn,S=A.length*s.ppe,w={};const T=Math.pow(10,Math.log(Math.max(b,1))-6),L=T/2,R=Math.random,k=m.randomizeFactor||1;let j;j=m.randomize==="locally"?B=>B+R()*k:m.randomize==="globally"?B=>R()*k:B=>B+R()*T-L;const z=new Float32Array(E),q=new Float32Array(S);for(f=p=0,_=v.length;f<_;f++){const B=v[f],W=y[B];let Z=W.x,it=W.y;W.pinned||(Z=j(Z),it=j(it)),w[B]=p,z[p]=Z,z[p+1]=it,z[p+2]=0,z[p+3]=0,z[p+4]=0,z[p+5]=0,z[p+6]=W.mass,z[p+7]=1,z[p+8]=W.size,z[p+9]=W.pinned||0,p+=s.ppn}for(f=p=0,_=A.length;f<_;f++){const B=x[A[f]];q[p]=w[B.source],q[p+1]=w[B.target],q[p+2]=B.weight||0,p+=s.ppe}return{nodes:z,edges:q}}(d,h);e.NodeMatrix=u.nodes,e.EdgeMatrix=u.edges,s.nodesLength=e.NodeMatrix.length,s.edgesLength=e.EdgeMatrix.length}(t,t.config),s.settings=function(d,h){for(const u in d)h[u]=d[u];return h}(t.config,s.settings),e.nodes=t.nodes,e.edges=t.edges,e.barycentre=t.barycentre):s=e.W;let i,n=e.NodeMatrix,r=e.EdgeMatrix;function o(){let l,d,h,u,c,g,m,f,p,_,y,x,b,v,A,E,S;for(h=0;h<s.nodesLength;h+=s.ppn)n[h+4]=n[h+2],n[h+5]=n[h+3],n[h+2]=0,n[h+3]=0;if(s.settings.outboundAttractionDistribution){for(p=0,h=0;h<s.nodesLength;h+=s.ppn)p+=n[h+6];p/=s.nodesLength}if(s.settings.barnesHutOptimize){let j,z,q,B,W=1/0,Z=-1/0,it=1/0,dt=-1/0;for(i=[],h=0;h<s.nodesLength;h+=s.ppn)W=Math.min(W,n[h+0]),Z=Math.max(Z,n[h+0]),it=Math.min(it,n[h+1]),dt=Math.max(dt,n[h+1]);const At=Z-W,gt=dt-it;for(At>gt?(it-=(At-gt)/2,dt=it+At):(W-=(gt-At)/2,Z=W+gt),i[0]=-1,i[1]=(W+Z)/2,i[2]=(it+dt)/2,i[3]=Math.max(Z-W,dt-it),i[4]=-1,i[5]=-1,i[6]=0,i[7]=0,i[8]=0,l=1,h=0;h<s.nodesLength;h+=s.ppn)for(d=0,q=s.MAX_SUBDIVISION_RETRIES;;){if(!(i[d+5]>=0)){if(i[d+0]<0){i[d+0]=h;break}if(i[d+5]=l*s.ppr,m=i[d+3]/2,f=i[d+5],i[f+0]=-1,i[f+1]=i[d+1]-m,i[f+2]=i[d+2]-m,i[f+3]=m,i[f+4]=f+s.ppr,i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,f+=s.ppr,i[f+0]=-1,i[f+1]=i[d+1]-m,i[f+2]=i[d+2]+m,i[f+3]=m,i[f+4]=f+s.ppr,i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,f+=s.ppr,i[f+0]=-1,i[f+1]=i[d+1]+m,i[f+2]=i[d+2]-m,i[f+3]=m,i[f+4]=f+s.ppr,i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,f+=s.ppr,i[f+0]=-1,i[f+1]=i[d+1]+m,i[f+2]=i[d+2]+m,i[f+3]=m,i[f+4]=i[d+4],i[f+5]=-1,i[f+6]=0,i[f+7]=0,i[f+8]=0,l+=4,B=d+0,j=n[i[B]+0]<i[d+1]?n[i[B]+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[i[B]+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,i[d+6]=n[i[B]+6],i[d+7]=n[i[B]+0],i[d+8]=n[i[B]+1],i[j+0]=i[d+0],i[d+0]=-1,z=n[h+0]<i[d+1]?n[h+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[h+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,j===z){if(q--){d=j;continue}q=s.MAX_SUBDIVISION_RETRIES;break}i[z+0]=h;break}j=n[h+0]<i[d+1]?n[h+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[h+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,i[d+7]=(i[d+7]*i[d+6]+n[h+0]*n[h+6])/(i[d+6]+n[h+6]),i[d+8]=(i[d+8]*i[d+6]+n[h+1]*n[h+6])/(i[d+6]+n[h+6]),i[d+6]+=n[h+6],d=j}}if(s.settings.barnesHutOptimize)for(_=s.settings.scalingRatio,h=0;h<s.nodesLength;h+=s.ppn)for(d=0;;)if(i[d+5]>=0){if(E=Math.sqrt((n[h+0]-i[d+7])*(n[h+0]-i[d+7])+(n[h+1]-i[d+8])*(n[h+1]-i[d+8])),2*i[d+3]/E<s.settings.barnesHutTheta){if(y=n[h+0]-i[d+7],x=n[h+1]-i[d+8],s.settings.adjustSizes?E>0?(S=_*n[h+6]*i[d+6]/E/E,n[h+2]+=y*S,n[h+3]+=x*S):E<0&&(S=-_*n[h+6]*i[d+6]/E,n[h+2]+=y*S,n[h+3]+=x*S):E>0&&(S=_*n[h+6]*i[d+6]/E/E,n[h+2]+=y*S,n[h+3]+=x*S),i[d+4]<0)break;d=i[d+4];continue}d=i[d+5]}else{if(i[d+0]>=0&&i[d+0]!==h&&(y=n[h+0]-n[i[d+0]+0],x=n[h+1]-n[i[d+0]+1],E=Math.sqrt(y*y+x*x),s.settings.adjustSizes?E>0?(S=_*n[h+6]*n[i[d+0]+6]/E/E,n[h+2]+=y*S,n[h+3]+=x*S):E<0&&(S=-_*n[h+6]*n[i[d+0]+6]/E,n[h+2]+=y*S,n[h+3]+=x*S):E>0&&(S=_*n[h+6]*n[i[d+0]+6]/E/E,n[h+2]+=y*S,n[h+3]+=x*S)),i[d+4]<0)break;d=i[d+4]}else for(_=s.settings.scalingRatio,u=0;u<s.nodesLength;u+=s.ppn)for(c=0;c<u;c+=s.ppn)y=n[u+0]-n[c+0],x=n[u+1]-n[c+1],s.settings.adjustSizes?(E=Math.sqrt(y*y+x*x)-n[u+8]-n[c+8],E>0?(S=_*n[u+6]*n[c+6]/E/E,n[u+2]+=y*S,n[u+3]+=x*S,n[c+2]+=y*S,n[c+3]+=x*S):E<0&&(S=100*_*n[u+6]*n[c+6],n[u+2]+=y*S,n[u+3]+=x*S,n[c+2]-=y*S,n[c+3]-=x*S)):(E=Math.sqrt(y*y+x*x),E>0&&(S=_*n[u+6]*n[c+6]/E/E,n[u+2]+=y*S,n[u+3]+=x*S,n[c+2]-=y*S,n[c+3]-=x*S));for(f=s.settings.gravity/s.settings.scalingRatio,_=s.settings.scalingRatio,h=0;h<s.nodesLength;h+=s.ppn)S=0,y=n[h+0],x=n[h+1],E=Math.sqrt(y*y+x*x),s.settings.strongGravityMode?E>0&&(S=_*n[h+6]*f):E>0&&(S=_*n[h+6]*f/E),n[h+2]-=y*S,n[h+3]-=x*S;for(_=1*(s.settings.outboundAttractionDistribution?p:1),g=0;g<s.edgesLength;g+=s.ppe)u=r[g+0],c=r[g+1],m=r[g+2],A=Math.pow(m,s.settings.edgeWeightInfluence),y=n[u+0]-n[c+0],x=n[u+1]-n[c+1],s.settings.adjustSizes?(E=Math.sqrt(y*y+x*x)-n[u+8]-n[c+8],s.settings.linLogMode?s.settings.outboundAttractionDistribution?E>0&&(S=-_*A*Math.log(1+E)/E/n[u+6]):E>0&&(S=-_*A*Math.log(1+E)/E):s.settings.outboundAttractionDistribution?E>0&&(S=-_*A/n[u+6]):E>0&&(S=-_*A)):(E=Math.sqrt(y*y+x*x),s.settings.linLogMode?s.settings.outboundAttractionDistribution?E>0&&(S=-_*A*Math.log(1+E)/E/n[u+6]):E>0&&(S=-_*A*Math.log(1+E)/E):s.settings.outboundAttractionDistribution?(E=1,S=-_*A/n[u+6]):(E=1,S=-_*A)),E>0&&(n[u+2]+=y*S,n[u+3]+=x*S,n[c+2]-=y*S,n[c+3]-=x*S);let w,T,L,R,k=0;if(s.settings.adjustSizes)for(h=0;h<s.nodesLength;h+=s.ppn)n[h+9]||(w=Math.sqrt(n[h+2]*n[h+2]+n[h+3]*n[h+3]),w>s.maxForce&&(n[h+2]=n[h+2]*s.maxForce/w,n[h+3]=n[h+3]*s.maxForce/w),T=n[h+6]*Math.sqrt((n[h+4]-n[h+2])*(n[h+4]-n[h+2])+(n[h+5]-n[h+3])*(n[h+5]-n[h+3])),L=Math.sqrt((n[h+4]+n[h+2])*(n[h+4]+n[h+2])+(n[h+5]+n[h+3])*(n[h+5]+n[h+3]))/2,R=.1*Math.log(1+L)/(1+Math.sqrt(T)),b=n[h+0],v=n[h+1],n[h+0]=n[h+0]+n[h+2]*(R/s.settings.slowDown),n[h+1]=n[h+1]+n[h+3]*(R/s.settings.slowDown),y=n[h+0],x=n[h+1],E=Math.sqrt((y-b)*(y-b)+(x-v)*(x-v)),k+=E);else for(h=0;h<s.nodesLength;h+=s.ppn)n[h+9]||(T=n[h+6]*Math.sqrt((n[h+4]-n[h+2])*(n[h+4]-n[h+2])+(n[h+5]-n[h+3])*(n[h+5]-n[h+3])),L=Math.sqrt((n[h+4]+n[h+2])*(n[h+4]+n[h+2])+(n[h+5]+n[h+3])*(n[h+5]+n[h+3]))/2,R=n[h+7]*Math.log(1+L)/(1+Math.sqrt(T)),n[h+7]=Math.min(1,Math.sqrt(R*(n[h+2]*n[h+2]+n[h+3]*n[h+3])/(1+Math.sqrt(T)))),b=n[h+0],v=n[h+1],n[h+0]=n[h+0]+n[h+2]*(R/s.settings.slowDown),n[h+1]=n[h+1]+n[h+3]*(R/s.settings.slowDown),y=n[h+0],x=n[h+1],E=Math.sqrt((y-b)*(y-b)+(x-v)*(x-v)),k+=E);if(s.iterations++,s.settings.autoStop&&(s.converged=s.iterations>s.settings.maxIterations||k/s.nodesLength<s.settings.avgDistanceThreshold,s.converged&&s.settings.alignNodeSiblings)){let j,z,q={},B={};for(g=0;g<s.edgesLength;g+=s.ppe)u=r[g+0],c=r[g+1],u!==c&&(q[u]=q[u]||{},q[c]=q[c]||{},q[u][c]=!0,q[c][u]=!0);Object.keys(q).forEach(zt=>{var _t=~~zt;z=Object.keys(q[_t]),z.length==2&&(j=z[0]+";"+z[1],j in B||(j=z[1]+";"+z[0],B[j]||(B[j]=[~~z[1],~~z[0]])),B[j].push(_t))});let W,Z,it,dt,At,gt,ct,yt,Tt,Gt,Vt,St,ft,pt,It,Lt=s.settings.nodeSiblingsAngleMin;Object.keys(B).forEach(zt=>{if(Z=B[zt].shift(),it=B[zt].shift(),W=B[zt].filter(qt=>!n[qt+9]),W.length==1)return;if(gt=n[Z+0],ct=n[Z+1],yt=n[it+0],Tt=n[it+1],dt=Object.keys(q[Z]).length,At=Object.keys(q[it]).length,Gt=function(jt,Zt,ie,he,Yt){return(Yt-he)*(jt-Zt)/(ie-Zt)+he}(dt/(dt+At),0,1,1/4,3/4),St=function(jt,Zt,ie,he,Yt){return{x:jt+(ie-jt)*Yt,y:Zt+(he-Zt)*Yt}}(gt,ct,yt,Tt,Gt),ft=function(jt,Zt,ie,he){return{xi:-(he-Zt),yi:ie-jt,xiPrime:he-Zt,yiPrime:-(ie-jt)}}(gt,ct,yt,Tt),Vt=function(jt,Zt,ie,he){const Yt=ie-jt,ae=he-Zt;return Math.sqrt(Yt*Yt+ae*ae)}(gt,ct,yt,Tt),pt=function(jt,Zt){return{x:(jt.xiPrime-jt.xi)/Zt,y:(jt.yiPrime-jt.yi)/Zt}}(ft,Vt),It=function(jt){return Math.acos(jt.x/Math.sqrt(jt.x*jt.x+jt.y*jt.y))}(pt),2*Lt>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");Lt>0&&(It<Lt||It>Math.PI-Lt&&It<=Math.PI?pt={x:2*Math.cos(Math.PI-Lt),y:2*Math.sin(Math.PI-Lt)}:(It>2*Math.PI-Lt||It>=Math.PI&&It<Math.PI+Lt)&&(pt={x:2*Math.cos(Lt),y:2*Math.sin(Lt)}));let _t=0,Dt=1,oe=1;W.length%2==1&&(oe=0,_t=1);for(let qt=0;qt<W.length;qt++)n[W[qt]+0]=St.x+Dt*pt.x*oe*(_t||qt>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),n[W[qt]+1]=St.y+Dt*pt.y*oe*(_t||qt>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),Dt=-Dt,oe+=(qt+_t)%2})}}function a(l){const d=Object.keys(l),h={};for(let u=0;u<n.length;u+=s.ppn){const c=d[u/s.ppn];h[c]={id:c,x:n[u+0],y:n[u+1],pinned:n[u+9]}}return h}return function(){if(s.settings.autoStop){const d=Date.now();for(;!(s.converged||Date.now()-d>=e.chunkPeriod);)o()}else{const d=s.iterations===0?s.settings.startingIterations:s.iterations+s.settings.iterationsPerRender;for(;s.iterations!==d;)o()}return{nodes:a(e.nodes),barycentre:e.barycentre}}()},isRunning:function(t){return!t.W.settings.autoStop||!t.W.converged||(t.W=void 0,!1)},stop:function(t){t.W&&(t.W.converged=!0)},onSync:function({nodes:t,barycentre:e},{graph:s}){const i=Object.keys(t),n=i.length;let r,o,a,l,d,h,u,c,g=0,m=0;const f=new Array(n),p=new Array(n),_=new Array(n),y=new Array(n),[x,b]=s.getAttributes(!0,["x","y"]);for(r=0;r<n;r++)o=i[r],a=t[o],c=parseInt(o),f[r]=c,y[r]=a.pinned,a.pinned?(l=x.get(c),d=b.get(c)):(l=a.x,d=a.y),p[r]=l,_[r]=d,g+=l,m+=d;for(h=g/n-e.x,u=m/n-e.y,r=0;r<n;r++)y[r]||(p[r]-=h,_[r]-=u);return{indexes:f,x:p,y:_}}},hz=t=>(t.modules.layouts.register(Xp),(e={})=>e.incremental?hA(e,t,t.layouts.forceLink):t.modules.layouts.start(Xp.name,e)),$p={name:"grid",configure:function(t,{graph:e,camera:s}){function i(v){return v===void 0||typeof v=="number"&&isFinite(v)&&v>0}const n=t.sortBy,r=t,o=r.nodes,a=Array.from(o._indexes),l=a.length,{rows:d,cols:h,rowDistance:u,colDistance:c}=function(A,E,S,w,T){if(!i(E))throw new TypeError('"rows" should be a positive integer');if(!i(S))throw new TypeError('"cols" should be a positive integer');if(!i(w))throw new TypeError('"rowDistance" should be a positive number');if(!i(T))throw new TypeError('"colDistance" should be a positive number');if(E)return{rows:E,cols:Math.ceil(A/E),rowDistance:w,colDistance:T};if(S)return{cols:S,rows:Math.ceil(A/S),rowDistance:w,colDistance:T};const L=Math.ceil(Math.sqrt(A));return{cols:L,rows:Math.ceil(A/L),rowDistance:w,colDistance:T}}(l,r.rows,r.cols,r.colDistance,r.rowDistance),g=function(A,E,S,w,T){return typeof A!="string"?w.map((L,R)=>R):A==="radius"?E.getAttribute(!0,"radius").getMultiple(w):A==="degree"?S.getDegree():A==="random"?w.map(()=>Math.random()):S.getData(A).map(L=>L||T)}(n,e,o,a,t.sortFallbackValue),m=o.getAttribute("layoutable"),f=a.reduce((v,A,E)=>(m[E]&&v.push({id:A,attr:g[E]}),v),[]),p=o.getAttribute("x"),_=o.getAttribute("y"),y=o.getAttribute("radius");let x=1/0,b=1/0;for(let v=0;v<a.length;v++)x=Math.min(x,p[v]),b=Math.min(b,_[v]);return{sort:!!n,nodes:f,reverse:!!r.reverse,cols:h,rows:d,minX:x,minY:b,rs:y,rowDistance:u,colDistance:c}},update:function({sort:t,nodes:e,minX:s,rs:i,minY:n,reverse:r,cols:o,rowDistance:a,colDistance:l}){const d=e.map((_,y)=>y);t&&d.sort((_,y)=>e[_].attr-e[y].attr),r&&d.reverse();let h=0;for(let _=0;_<e.length;_++){const y=_>0&&(_+1)%o===0,x=_%o===0,b=y?0:i[d[_+1]]||0,v=x?0:i[d[_+o-1]]||0,A=i[d[_+o]]||0,E=y?0:i[d[_+o+1]]||0,S=i[d[_]]||0;h=Math.max(h,S+b,S+v,S+A,S+E)}let u=h+5,c=h+5;const g=s,m=n;isFinite(u)||(u=0),isFinite(c)||(c=0),a!==void 0&&isFinite(a)&&(u=h+a),l!==void 0&&isFinite(l)&&(c=h+l);let f=0,p=0;return d.forEach(_=>{const y=e[_];y.x=g+f*u,y.y=m+p*c,f+=1,f===o&&(p+=1,f=0)}),e},onSync:function(t){return{indexes:t.map(({id:e})=>e),x:t.map(({x:e})=>e),y:t.map(({y:e})=>e)}}},uz=t=>(t.modules.layouts.register($p),(e={})=>t.modules.layouts.start($p.name,e)),_g={id:"__SENTINEL__",layer:-1,sink:!1,fixed:!1,siblingIndex:-1,parentIds:[],children:[],radius:0,ref:null},uo=t=>t.data===_g||!1,Wu=t=>!uo(t),cz=[],gz=(t,e)=>({id:t,layer:e,data:_g,children:cz,ref:void 0,x:0,y:0}),uA=(t,e)=>({id:t,layer:-1,data:e,children:[],x:0,y:0}),Wp=class{constructor(t,e,s){this.data=t,this.prev=e,this.next=s}toString(){return this.data}},cA=t=>t.reduce((e,s)=>(e[s]=!0,e),{});function mz(t,e){const s=[t],i=cA(s),n=[t];for(;s.length;){const r=s.shift();for(const o of e.get(r))i[o]||(i[o]=!0,n.push(o),s.push(o))}return n}function yg(t){return t.reduce((e,{source:s,target:i})=>(e.set(s,e.get(s)||[]),e.set(i,e.get(i)||[]),e.get(s).push(i),e.get(i).push(s),e),new Map)}function fz(t){return t.reduce((e,{source:s,target:i})=>(e[s]=e[s]||[],e[s].push(i),e),{})}function pz(t,e,s){const i=s||yg(e||[]);return t.filter(({id:n})=>!i.has(n))}function _z(t,e){const s=cA(e);return t.filter(i=>!(i in s))}function ys(t,e){t.forEach((s,i)=>{s.forEach((n,r,o)=>{e(n,r,o,i)})})}var Zp=t=>{const e=Math.floor(t.length/2);return t=[...t].sort((s,i)=>s-i),t.length%2!=0?t[e]:(t[e-1]+t[e])/2};function yz(t,e,s){const i=yg(e);let n=Array.from(i.keys());const r=[];for(;n.length;){const o=mz(n[0],i);r.push(o),n=_z(n,o)}return s.skipSingletons?r:r.concat(pz(t,e,i).map(({id:o})=>[o]))}var Cl=({id:t,layer:e,sink:s,siblingIndex:i,radius:n,layoutable:r})=>({id:t,layer:e!==void 0?e:void 0,sink:s,siblingIndex:i||0,radius:n||0,fixed:r===!1,parentIds:[],children:[],ref:null});function xz(t){const e={x:0,y:0};let s=0;for(let i=0;i<t.length;i++){const n=t[i];for(let r=0;r<n.nodes.length;r++){const o=n.nodes[r];e.x+=o.x||0,e.y+=o.y||0,s++}}return e.x/=s,e.y/=s,e}function bz(t){const e={x:0,y:0};let s=0;for(const[i,{x:n,y:r}]of t)e.x+=n||0,e.y+=r||0,s++;return e.x/=s,e.y/=s,e}function vz(t,e,s){const i=xz(s),n=t.x-i.x,r=t.y-i.y;for(let o=0;o<s.length;o++){const a=s[o];for(let l=0;l<a.nodes.length;l++){const d=a.nodes[l],h=e.get(d.id);!h||d.data&&d.data.fixed||(h.x=d.x+n,h.y=d.y+r)}}}function Kp(t){return Math.ceil(Math.sqrt(t))}var Qp=5,Az=class{constructor(t,e,s=0){this.groupToSubNodes=new Map,this.nodeToGroup=new Map,this.lookup=new Map,this.shouldPackSiblings=!0,this.shouldPackSiblings=t,this.packSiblingsFn=e||(i=>1),this.siblingsGap=s}packSiblings(t){if(!this.shouldPackSiblings)return;const e=this.groupToSubNodes,s=this.nodeToGroup,i=this.siblingsGap,n=this.packSiblingsFn,r=[],o=new Set,a=new Map,l=new Map,d=this.lookup;t.nodes.forEach(h=>{d.set(h.id,h)}),t.nodes.forEach(h=>{if(!h.children.length)return;const u=[];h.children.forEach(c=>{c.id===h.id||c.children.length||u.push(c)}),!(u.length<Qp)&&l.set(h.id,u)}),l.forEach((h,u)=>{const c=new Map;h.length<Qp||(h.forEach(g=>{if(a.has(g.id))return;const m=n(g.data);if(m===void 0)return;const f=`${u}-${m}`;a.set(g.id,f),c.has(f)?c.get(f).push(g):c.set(f,[g])}),c.forEach((g,m)=>{const f=Kp(g.length);let p=f*i;for(let x=0;x<f;x++){let b=0;for(let v=0;v<f;v++){const A=g[x*f+v];b=Math.max(b,A?2*A.data.radius:0)}p+=b}p/=2,e.set(m,g);const _=g[0].layer,y=uA(m,Cl({id:m,layer:_,radius:p}));y.layer=_,d.set(m,y),r.push(y),g.forEach(x=>{s.set(x.id,m),o.add(x.id)})}))}),t.nodes=t.nodes.filter(h=>o.has(h.id)===!1),r.forEach(h=>{t.nodes.push(h)}),t.nodes.forEach(h=>{const u=new Set;h.children=h.children.filter(c=>{if(!a.has(c.id))return!0;const g=a.get(c.id);return u.add(g),!1}),h.children.push(...Array.from(u).map(c=>d.get(c)))})}unpackSiblings(t){if(!this.shouldPackSiblings)return;const e=this.siblingsGap,s=this.groupToSubNodes,i=new Set,n=[];t.nodes.forEach(r=>{if(!s.has(r.id))return;i.add(r.id);const o=s.get(r.id)||[],a=Kp(o.length),l=new Array(a).fill(0);o.forEach((h,u)=>{n.push(h);const c=Math.floor(u/a);l[c]=Math.max(l[c],2*h.data.radius)}),l[0]-=r.data.radius;for(let h=1;h<a;h++)l[h]+=l[h-1]+e;const d=2*r.data.radius/a;o.forEach((h,u)=>{const c=Math.floor(u/a),g=u%a;h.y=r.y+l[c],h.x=r.x-r.data.radius+g*d})}),t.nodes=t.nodes.filter(r=>!i.has(r.id)),n.forEach(r=>{t.nodes.push(r)})}};function Ez(t){let e=0,s=0;for(const o of t)e+=o.w*o.h,s=Math.max(s,o.w);t.sort((o,a)=>a.h-o.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let n=0,r=0;for(const o of t)for(let a=i.length-1;a>=0;a--){const l=i[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,r=Math.max(r,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===l.w&&o.h===l.h){const d=i.pop();a<i.length&&(i[a]=d)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(i.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:n,h:r,fill:e/(n*r)||0}}var Sz={down:()=>{},up:t=>t.y=-t.y,left:t=>{const e=t.x;t.x=-t.y,t.y=e},right:t=>{const e=t.x;t.x=t.y,t.y=-e}},wh=(t,e)=>isFinite(t)&&t>0?t:e;function wz(t){return{nodesSeparation:wh(t.nodesSeparation,0),componentsSeparation:wh(t.componentsSeparation,25),layerSeparation:wh(t.layerSeparation,50)}}function Tz(t,{componentsSeparation:e,packing:s}){const i=[];for(let n=0;n<t.length;n++){const r=t[n],o=r.nodes;if(r.isFake&&r.w!==void 0&&r.h!==void 0){i.push({w:r.w,h:r.h,x:void 0,y:void 0,dag:r});continue}if(r.nodes.length===1){const c=2*o[0].data.radius;i.push({w:c+e/2,h:c+e/2,x:void 0,y:void 0,dag:r});continue}const{minX:a,maxX:l,minY:d,maxY:h}=o.reduce((c,{x:g,y:m,data:f})=>{const p=f.radius||0;return c.minX=Math.min(c.minX,g-p),c.maxX=Math.max(c.maxX,g+p),c.minY=Math.min(c.minY,m-p),c.maxY=Math.max(c.maxY,m+p),c},{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),u=(l+a)/2;o.forEach(c=>{c.x-=u}),i.push({w:Math.abs(l-a)+e/2,h:Math.abs(h-d)+e/2,minX:a,x:void 0,y:void 0,dag:r})}if(s!=="singleline")Ez(i);else{let n=0;for(let r=0;r<i.length;r++){const o=i[r];o.x=n,o.y=0,n+=o.w}}return i}function Iz(t,e={}){const{componentsSeparation:s}=wz(e);e.direction===void 0&&(e.direction="down");const i=Tz(t,{componentsSeparation:s,packing:e.packing});for(let n=0;n<i.length;n++){const{x:r=0,y:o=0,dag:a}=i[n];for(const l of a.nodes)l.x+=r,l.y+=o,Sz[e.direction](l)}}var Lz=t=>t.reduce((e,{radius:s})=>Math.max(e,2*s),0);function Cz(t,e){return{nodes:t.map(s=>({...s,data:s})),isFake:!0,...e}}function Nz(t,e,s){const i=yg(e||[]),n=t.filter(({id:g})=>!i.has(g)).sort((g,m)=>m.radius-g.radius),r=Math.sqrt(n.length);let o=Math.floor(r),a=Math.ceil(r);o*a<n.length&&(o<a?o++:a++);const l=Math.max(1,Lz(n)),d=Math.max(s.nodesGridSeparation||0,1),h=l*a+d*(a-1),u=l*o+d*Math.max(o-1,0),c=Cz(n,{w:h,h:u});return c.nodes.forEach((g,m)=>{const f=m%a,p=Math.floor(m/a);g.x=h*f/a,g.y=u*p/o}),c}function Jp(t,e,s){const i=e.reduce((o,a)=>(o.set(a.source,o.get(a.source)||[]),o.get(a.source).push(a),o),new Map),{result:n}=t.reduce(function o(a,l){const{visited:d,stack:h,result:u}=a;if(d.has(l.id))return a;h.add(l.id),d.add(l.id);const c=i.get(l.id)||[];for(const g of c)h.has(g.target)?u.push(g):o(a,s.get(g.target));return h.delete(l.id),a},{visited:new Set,stack:new Set,result:[]}),r=n.reduce((o,{source:a,target:l})=>(o.set(a,o.get(a)||new Set),o.get(a).add(l),o),new Map);return e.map(o=>{const{source:a,target:l,id:d}=o;return r.has(a)&&r.get(a).has(l)?{id:d,source:l,target:a}:o})}function Mz(t){if(!t||!t.length)throw Error("Cannot stratify empty data");for(const n of t){if(!n)throw Error('Node data is "null"');if(n.id==null)throw Error('Node id contains a "null" value')}const e=t.map(n=>uA(n.id,n)),s=e.reduce((n,r)=>{if(n[r.id])throw Error(`The connected component contains id duplicates: ${r.id}`);return n[r.id]=r,n},{}),i=[];for(let n=0;n<e.length;n++){const r=e[n];for(let o=0;o<r.data.parentIds.length;o++){const a=r.data.parentIds[o],l=s[a];if(!l)throw Error(`The node ${r.id} has a missing parent id ${a}`);l.children.push(r)}r.data.parentIds.length||i.push(r)}return{isFake:!1,nodes:Rz(i)}}function Rz(t){const e={},s=[];for(;t.length;){const i=t.pop();e[i.id]||(s.push(i),e[i.id]=!0,t.push(...i.children))}return s}var Fz=t=>{var e,s,i;const n=[];if(t.nodes.forEach(g=>{if(g&&!isNaN(g.layer)&&g.layer!==null){if(g.layer<0)throw new Error("Layer must be greater than or equal to 0");n.push([g.id,g.layer])}}),n.length===0)return t.edges;n.sort((g,m)=>g[1]-m[1]);const r=new Set;for(let g=0;g<n.length;g++)n[g][1]!==0&&r.add(n[g][0]);const o=new Map;for(const g of t.nodes)o.set(g.id,[]);for(const g of t.edges)(e=o.get(g.source))==null||e.push(g.target),(s=o.get(g.target))==null||s.push(g.source);if(!n.map(([g,m])=>m).some(g=>g===0)){n.sort((p,_)=>p[1]-_[1]);const g=new Set,m=[n[0]];let f;for(;m.length>0;){const[p,_]=m.shift();if(_===0){f=p;break}g.add(p);const y=o.get(p)||[];for(const x of y)r.has(x)||g.has(x)||m.push([x,_-1])}if(f)n.push([f,0]);else{const p=n[0][1];for(let _=0;_<n.length;_++)n[_][1]-=p}}const a=n.filter(([g,m])=>m===0).map(([g])=>g),l=a.slice(),d=new Map,h=new Map,u=new Map;for(const g of a)d.set(g,0),h.set(g,[]);for(;l.length>0;){const g=l.shift(),m=d.get(g),f=o.get(g)||[];for(const p of f){const _=d.get(p);_===void 0?(d.set(p,m+1),h.set(p,[g]),l.push(p)):_===m+1&&((i=h.get(p))==null||i.push(g))}}for(const[g,m]of h.entries())for(const f of m)u.set(f,(u.get(f)||[]).concat(g));for(const[g,m]of n)if(d.get(g)!==m)if(m===0){const f=h.get(g)||[];h.set(g,[]),f.forEach(y=>{u.set(y,(u.get(y)||[]).filter(x=>x!==g))});const p=t.nodes.filter(y=>d.get(y.id)===0);d.clear(),p.forEach(y=>d.set(y.id,0));const _=p.map(y=>y.id);for(;_.length>0;){const y=_.shift(),x=d.get(y),b=u.get(y)||[];for(const v of b)d.get(v)===void 0&&(d.set(v,x+1),_.push(v))}}else{const f=t.nodes.find(x=>d.get(x.id)===m-1&&x.id!==g);if(!f)continue;const p=h.get(g)||[];h.set(g,[f.id]),p.forEach(x=>{u.set(x,(u.get(x)||[]).filter(b=>b!==g))}),u.set(f.id,(u.get(f.id)||[]).concat(g));const _=t.nodes.filter(x=>d.get(x.id)===0);d.clear(),_.forEach(x=>d.set(x.id,0));const y=_.map(x=>x.id);for(;y.length>0;){const x=y.shift(),b=d.get(x),v=u.get(x)||[];for(const A of v)d.get(A)===void 0&&(d.set(A,b+1),y.push(A))}}const c=[];for(const[g,m]of h.entries())if(m.length>0)for(const f of m)c.push({id:`${f}-${g}`,source:f,target:g});return c},Pz=class{constructor(){this.byId={},this.byIndex={},this.length=0}append(t,e){let s;return this.head?(s=new Wp(t,this.tail),this.tail=this.tail.next=s):(s=new Wp(t),this.tail=this.head=s),this.byId[e]=s,this.byIndex[this.length++]=s,s}find(t){let e=this.head;do{if(e.data===t)return e;e=e.next}while(e)}forEach(t){let e=this.head,s=0;do t(e,s),s++;while(e=e.next)}},xs=-1,Se=1e-5,Th=[],zz=class{constructor(t,e,s){this.edges=[],this.nodeMap={},this.nodeIndexTopDown={},this.nodeToLayer={},this.longEdges={},this.virt={},this.height={},this.breadth={},this.first=[],this.totalW={},this.mDist={},this.X={},this.block={},this.nodeList=new Pz,this.nodeDistance=e,this.layerDistance=s,this.layers=t;const{breadth:i,virt:n,height:r,nodeToLayer:o,nodeIndexTopDown:a,nodeMap:l,longEdges:d,edges:h}=this;let u=0;ys(this.layers,(f,p,_,y)=>{if(a[f.id]=u++,l[f.id]=f,o[f.id]=y,this.nodeList.append(f,f.id),f.children.forEach(b=>{const v=uo(b)||uo(f);h.push({source:f.id,target:b.id,virtual:v,id:h.length})}),d[f.id])return;const x=[f.id];if(d[f.id]=x,!Wu(f))for(let b=0;b<f.children.length;b++){const v=f.children[b];if(Wu(v))continue;let A=v;for(;uo(A);)x.push(A.id),d[A.id]=x,A=A.children[0]}});const c=this.adjacencyList=fz(h);this.N=t.reduce((f,p)=>f+p.length,0),this.Y=new Float32Array(t.length),this.first=t.map(f=>f[0]),t.forEach((f,p)=>r[p]=0),ys(this.layers,(f,p,_,y)=>{const x=c[f.id]?c[f.id].length:0;n[f.id]=uo(f)&&x===1,this.nodeToLayer[f.id]=y,n[f.id]?i[f.id]=0:(i[f.id]=2*f.data.radius,r[y]=Math.max(r[y]||0,2*f.data.radius))});const g={},m={};h.forEach(f=>{const p=f.source,_=f.target;g[_]=g[_]||[],g[_].push(p),m[p]=m[p]||[],m[p].push(_)}),Object.values(g).forEach(f=>{f.sort((p,_)=>this.nodeIndexTopDown[p]-this.nodeIndexTopDown[_])}),Object.values(m).forEach(f=>{f.sort((p,_)=>this.nodeIndexTopDown[p]-this.nodeIndexTopDown[_])}),this.neighbours={prev:g,next:m}}computeMinNodeDistances(){const{layers:t,totalW:e}=this;ys(t,s=>{e[s.id]=0}),ys(t,s=>e[s.data.id]=0),this.layers.forEach(s=>{e[s[0].id]=0,s.slice(1).forEach((i,n)=>{const r=s[n],o=i.id;e[o]=e[r.id]+r.data.radius+i.data.radius+this.nodeDistance})})}decrossVirtualEdges(){this.layers.forEach(t=>{let e=-1;t.forEach(s=>{if(!this.virt[s.id])return;const i=this.neighbours.next[s.id][0];if(this.virt[i])if(e!==-1&&e>this.nodeIndexTopDown[i]){const n=this.longEdges[s.id];let r=0;for(r=0;r<n.length&&n[r]!==i;r++);const o=n.slice(r);o.forEach(l=>this.longEdges[l]=o);const a=n.slice(0,r);a.forEach(l=>this.longEdges[l]=a)}else e=this.nodeIndexTopDown[i]})})}placeLongEdges(){const{X:t,layers:e}=this;ys(e,s=>t[s.id]=0);for(let s=1;s>=-1;s-=2){const i={};let n=0;const r={};ys(e,d=>r[d.id]=0),r[_g.id]=0;const o=s;e.forEach(d=>{let h=o===1?d[0]:d[d.length-1];r[h.id]||(this.longEdges[h.id].forEach(g=>{r[g]=n}),n++);let u=o===1?0:d.length-1,c=u+o;for(;c>=0&&c<d.length;)h=d[c],r[h.id]||this.longEdges[h.id].forEach(g=>{r[g]=r[d[u].id]}),u=c,c+=o});const a={};e.forEach(d=>{for(let h=o===1?0:d.length-1;o===1?h<d.length:h>=0;h+=o){const u=d[h],c=r[u.id];a[c]=a[c]||[],a[c].push(u.id)}});const l={};this.nodeList.forEach(d=>l[d.data.id]=0);for(let d=0;d<n;d++){const h={done:!1,dist:0},u=a[d];for(let c=0;c<u.length;c++){const g=u[c];this.sortLongEdges(g,s,l,h,r,i)}if(!h.done){const c=this.layers[this.nodeToLayer[a[d][0]]],g=[];c.forEach(m=>{for(const f of this.neighbours.prev[m.id]||Th){const p=Math.abs(l[f]-l[m.id]);g.push(p)}}),g.length!==0&&(h.dist=Zp(g))}for(let c=0;c<u.length;c++)l[u[c]]-=s*h.dist}ys(e,d=>t[d.id]+=l[d.id]/2)}}sortLongEdges(t,e,s,i,n,r){if(r[t])return!1;let o=!1,a=0;const{nodeToLayer:l,totalW:d}=this,h=this.longEdges[t];h.forEach(u=>r[u]=!0),h.forEach(u=>{const c=this.nodeList.byIndex[this.nodeIndexTopDown[u]-e];if(!c)return;const g=c.data.id,m=u,f=l[g]===l[m],p=n[g]===n[m];!f||!p||(this.sortLongEdges(g,e,s,i,n,r),(!o||e*(a-s[g])<e*(d[m]-d[g]))&&(o=!0,a=s[g]+d[m]-d[g]))}),h.forEach(u=>{s[u]=a;const c=this.nodeList.byId[u],g=e===1?c.next:c.prev;if(!g)return;const m=g.data.id,f=u,p=l[m]===l[f],_=n[m]!==n[f],y=e*(d[m]-d[f]-s[m]+s[f]);p&&_&&(!i.done||y>i.dist)&&(i.dist=y,i.done=!0)})}placeNonVirtualNodes(){const t={};ys(this.layers,l=>t[l.id]=-1);const{X:e,totalW:s,virt:i,nodeIndexTopDown:n,mDist:r,nodeList:o}=this,a={};ys(this.layers,(l,d,h,u)=>{if(!i[l.id])return void(a[l.id]=!1);let c=this.nodeList.byId[l.id].next;for(;c&&this.nodeToLayer[c.data.id]===u&&!i[c.data.id];)c=c.next;a[l.id]=this.nodeToLayer[c.data.id]===u&&e[c.data.id]-e[l.id]<s[c.data.id]-s[l.id]+Se}),ys(this.layers,({id:l})=>{a[l]&&t[l]===-1&&this.longEdges[l].forEach(d=>{d!==l&&(t[d]=n[d]<n[l]?1:0)})}),ys(this.layers,({id:l})=>r[l]=s[l]);for(let l=0;l<2;l++)for(let d=l?this.layers.length-1:0;d>=0&&d<this.layers.length;l?d--:d++){let h=xs;const u=this.layers[d];if(u.forEach(({id:c},g,m)=>{if(i[c]){if(h===xs){this.placeSequence(xs,c,m[0].id,o.byId[c].prev.data.id,l);for(let f=0;f<g;f++){const p=m[f].id;r[p]=r[c]-e[c]+e[p]}}else if(t[h]!==1-l){a[h]||this.placeSequence(h,c,o.byId[h].next.data.id,o.byId[c].prev.data.id,l);const f=l===1?this.neighbours.prev:this.neighbours.next,p=f[h][0],_=f[c][0];if(i[p]&&i[_])for(let y=n[p]+1;y<n[_];y++)t[o.byIndex[y].data.id]=l}h=c}}),h===xs)this.placeSequence(xs,xs,u[0].id,u[u.length-1].id,l),u.forEach(({id:c})=>r[c]=e[c]);else{this.placeSequence(h,xs,o.byId[h].next.data.id,u[u.length-1].id,l);for(let c=u.length-1;c>=0;c--){const g=u[c].id;if(g===h)break;r[g]=r[h]-e[h]+e[g]}}}}placeSequence(t,e,s,i,n,r=0){if(r===2048)return;const o=this.nodeIndexTopDown[s],a=this.nodeIndexTopDown[i],{X:l,nodeIndexTopDown:d,mDist:h}=this;if(o===a)l[s]=this.placeNode(s,t,e,l[s],n);else if(o<a){const u=Math.floor((d[s]+d[i])/2),c=this.nodeList.byIndex[u],g=c.next.data.id,m=h[g]-h[c.data.id];this.placeSequence(t,e,s,c.data.id,n,r+1),this.placeSequence(t,e,g,i,n,r+1),this.combineSequences(t,e,s,i,g,c.data.id,n,m)}}calculateBends(t,e,s,i,n,r,o,a){let l=0;const d=[],{X:h,mDist:u,neighbours:c}=this,g=this.nodeIndexTopDown[s],m=this.nodeIndexTopDown[i];for(let f=this.nodeList.byId[r],p=this.nodeIndexTopDown[f.data.id];p>=g&&p<=m&&f;f=t===-1?f.prev:f.next,p=f&&this.nodeIndexTopDown[f.data.id]){const _=f.data.id,y=(e===0?c.prev[_]:c.next[_])||Th;let x=0;for(let v=0;v<y.length;v++){const A=y[v];if(t*(h[A]-h[_])<Se)x++;else{x--;const E=h[A]+u[r]-u[_];t*(h[r]-E)>-Se?l++:(a===xs||t*(E-h[a]+u[a]-u[r])<Se)&&t*(E-h[n])<o-Se&&d.push({value:2,key:E})}}const b=h[_]+u[r]-u[_];t*(h[r]-b)>-Se?l+=x:(a===xs||t*(b-h[a]+u[a]-u[r])<Se)&&t*(b-h[n])<o-Se&&d.push({value:x,key:b})}return a!==xs&&d.push({value:this.edges.length,key:h[a]-u[a]+u[r]}),d.sort(({key:f},{key:p})=>f-p),{res:l,bends:d.reduce((f,p,_)=>{if(_<d.length-1){const y=d[_+1];Math.abs(p.key-y.key)>Se?p.value>0&&f.push(p):p.value+=y.value}else p.value>0&&f.push(p);return f},[])}}combineSequences(t,e,s,i,n,r,o,a){const{X:l,mDist:d,nodeIndexTopDown:h}=this;let{res:u,bends:c}=this.calculateBends(-1,o,s,i,n,r,a,t),{res:g,bends:m}=this.calculateBends(1,o,s,i,r,n,a,e);for(c.length>0&&c.reverse();l[n]-l[r]<a-Se;){let _=0,y=0;if(u<g){const x=c.length;if(x>0){const b=c.pop();_=b.value,l[r]=b.key}(x===0||l[n]-l[r]>a+Se)&&(l[r]=l[n]-a)}else if(u>g){const x=m.length;if(x>0){const b=m.pop();y=b.value,l[n]=b.key}(x===0||l[n]-l[r]>a+Se)&&(l[n]=l[r]+a)}else{let x=(a-l[n]+l[r])/2;const b=c.length===0?x+1:l[r]-c[c.length-1].key,v=m.length===0?x+1:m[m.length-1].key-l[n];b<x+Se&&b<v+Se&&(_=c.pop().value),v<x+Se&&v<b+Se&&(y=m.pop().value),x=Math.min(x,b,v),l[r]-=x,l[n]+=x}u+=_,g+=y}let f,p=this.nodeList.byId[r].prev;for(;p&&h[f=p.data.id]>=h[s]&&l[r]-l[f]<d[r]-d[f];)l[f]=l[r]-d[r]+d[f],p=p.prev;for(p=this.nodeList.byId[n].next;p&&h[f=p.data.id]<=h[i]&&l[n]-l[f]>d[n]-d[f];)l[f]=l[n]-d[n]+d[f],p=p.next}placeNode(t,e,s,i,n){const{X:r,neighbours:o,mDist:a}=this,l=((n===0?o.prev:o.next)[t]||Th).map(d=>r[d]);return l.length===0?r[t]:(i=Zp(l),e!==xs&&(i=Math.max(i,r[e]+a[t]-a[e])),s!==xs&&(i=Math.min(i,r[s]+a[t]-a[s])),i)}moveLongEdge(t,e,s){const{X:i,virt:n,totalW:r,nodeList:o}=this,{id:a}=t.data;if(s[a]||!n[a])return;const l=this.longEdges[a];if(!l)return;l.forEach(f=>s[f]=!0);const d=l[0],h=l[l.length-1],u=[];e<0?u.push(i[d]<i[h]?i[d]:i[h],i[d]<i[h]?i[h]:i[d]):e>0?u.push(i[d]<i[h]?i[h]:i[d],i[d]<i[h]?i[d]:i[h]):u.push(i[d],i[h]);const c=u[0];let g,m=!1;for(;!m&&u.length!==0;)g=u.pop(),m=!0,l.forEach(f=>{const p=this.layers[this.nodeToLayer[f]];if(f!==p[0].id){const _=o.byId[f].prev.data;g-i[_.data.id]<r[f]-r[_.data.id]&&this.moveLongEdge(_,-1,s),m=m&&g-i[_.data.id]>=r[f]-r[_.data.id]-Se}if(f!==p[p.length-1].id){const _=o.byId[f].next.data;g-i[_.data.id]>r[f]-r[_.data.id]&&this.moveLongEdge(_,1,s),m=m&&g-i[_.data.id]<=r[f]-r[_.data.id]+Se}});m||(g=c,l.forEach(f=>{const p=this.layers[this.nodeToLayer[f]];if(f!==p[0].id){const _=o.byId[f].prev.data;g=Math.max(g,i[_.data.id]+r[f]-r[_.data.id])}if(f!==p[p.length-1].id){const _=o.byId[f].next.data;g=Math.min(g,i[_.data.id]+r[f]-r[_.data.id])}})),l.forEach(f=>i[f]=g)}moveLongEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.moveLongEdge(e[i],0,t);for(let i=s-1;i>=0;i--)this.moveLongEdge(e[i],0,t)})}computeY(){const{Y:t,layers:e,height:s}=this;t[0]=0,e.slice(1).forEach((i,n)=>{t[n+1]=t[n]+(s[n]+s[n+1])/2+this.layerDistance})}straightenLongEdge(t,e){const{nodeList:s,longEdges:i,neighbours:n,X:r,Y:o,nodeToLayer:a,totalW:l}=this,d=i[t.id];if(e[t.id]||!n.prev[t.id]||n.prev[t.id].length!==1||!n.next[t.id]||n.next[t.id].length!==1||!(d&&d.length<2))return;e[t.id]=!0;const h=n.prev[t.id][0],u=n.next[t.id][0];if(a[u]===a[h])return;const c=r[h]+(r[u]-r[h])*(o[a[t.id]]-o[a[h]])/(o[a[u]]-o[a[h]]);if(t!==this.first[a[t.id]]){const m=s.byId[t.id].prev.data;if(c-r[m.id]<l[t.id]-l[m.id]-Se&&this.straightenLongEdge(m,e),c-r[m.id]<l[t.id]-l[m.id]-Se)return}const g=this.layers[a[t.id]];if(t!==g[g.length-1]){const m=s.byId[t.id].next.data;if(r[m.id]-c<l[m.id]-l[t.id]-Se&&this.straightenLongEdge(m,e),r[m.id]-c<l[m.id]-l[t.id]-Se)return}r[t.id]=c}straightenEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.straightenLongEdge(e[i],t);for(let i=s-1;i>=0;i--)this.straightenLongEdge(e[i],t)})}run(){this.computeMinNodeDistances(),this.decrossVirtualEdges(),this.placeLongEdges(),this.placeNonVirtualNodes(),this.moveLongEdges(),this.computeY(),this.straightenEdges(),ys(this.layers,(t,e,s,i)=>{t.x=this.X[t.id],t.y=this.Y[i]})}},Dz=(t,e=20,s=50)=>new zz(t,e,s).run();function Oz(t){if(t.sort((i,n)=>i-n),t.length===0)return 0;const e=Math.floor(t.length/2),s=Math.floor(t.length/2);return(t[e]+t[s])/2}function Zu(t,e,s){const i={};return e.forEach((n,r)=>i[n.id]=r),t.map(n=>(s[n.id]||[]).map(r=>i[r]).sort()).reduce((n,r,o,a)=>{const l=r.length?r[r.length-1]:-1;for(let d=o+1;d<a.length;d++)n+=a[d].filter(h=>h<l).length;return n},0)}function kz(t,e,s,i,n){const r={};for(let o=0;o<t.length;o++)r[t[o].id]=Oz((e[t[o].id]||[]).map(a=>s[a]))||0;n?t.sort((o,a)=>{const l=r[o.id]-r[a.id],d=i[o.id]===i[a.id],h=o.data.siblingIndex,u=a.data.siblingIndex;return d&&h>-1&&u>-1?h-u:l===0?s[a.id]-s[o.id]:l}):t.sort((o,a)=>{const l=r[o.id]-r[a.id];return l===0?s[a.id]-s[o.id]:l})}function t_({layers:t,topDown:e,topDownAdj:s,bottomUpAdj:i,idToIndex:n,crossings:r,sortSiblings:o}){const a=e?s:i;for(let l=e?0:t.length-1;e?l<t.length:l>=0;e?l++:l--){kz(t[l],a[l]||{},n,i[l],o);const d=l>0?Zu(t[l-1],t[l],s[l-1]):0,h=l<t.length-1?Zu(t[l],t[l+1],s[l]):0;h+d<(r[l]||0)+(r[l-1]||0)?(r[l]=h,l>0&&(r[l-1]=d),t[l].forEach((u,c)=>n[u.id]=c)):t[l].sort((u,c)=>n[u.id]-n[c.id])}}var Bz=(t,e,s)=>{if(!s&&!e)return;const i={},n=t.map(()=>({})),r=t.map(()=>({}));t.forEach((h,u)=>{h.forEach((c,g)=>{i[c.id]=s?c.data.siblingIndex:g,c.children.forEach(m=>{const f=m.layer;f>u?(n[u][c.id]=n[u][c.id]||[],n[u][c.id].push(m.id),r[f][m.id]=r[f][m.id]||[],r[f][m.id].push(c.id)):(n[f][m.id]=n[f][m.id]||[],n[f][m.id].push(c.id),r[u][c.id]=r[u][c.id]||[],r[u][c.id].push(m.id))})})}),i[-1]=-1,s&&t.forEach(h=>h.sort((u,c)=>i[u.id]-i[c.id]));const o=t.slice(1).map((h,u)=>Zu(t[u],h,n[u])),a=[[50,100],[100,10],[1e3,1],[5e3,0]],l=Math.max(...t.map(h=>h.length)),d=(a.find(([h])=>l<h)||a[a.length-1])[1];for(let h=0;h<d;h++)t_({layers:t,topDown:!0,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s}),t_({layers:t,topDown:!1,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s})};function Uz(t){const e={},s={},i={};t.nodes.forEach(o=>{i[o.id]=o});const n=o=>{if(e[o.id])return s[o.id];e[o.id]=!0;let a=1/0;for(const l of o.children)a=Math.min(a,n(i[l.id])-1);return a===1/0&&(a=0),s[o.id]=a,a};t.nodes.forEach(o=>{o.data.parentIds.length===0&&n(o)});let r=1/0;t.nodes.forEach(o=>{r=Math.min(r,s[o.id])}),t.nodes.forEach(o=>{s[o.id]-=r,o.layer=s[o.id]}),t.nodes.forEach(o=>{typeof o.data.layer=="number"&&!isNaN(o.data.layer)&&(o.layer=o.data.layer)})}function Gz(t){const e=t.nodes.reduce((s,i)=>i.data.fixed&&(s===null||s.layer>i.layer)?i:s,null);return e&&t.nodes.forEach(s=>s.ref=e.id),t}function Vz(t){if(t.nodes.every(e=>e.layer)){const e=t.nodes.reduce((s,i)=>Math.min(s,i.layer),1/0);t.nodes.forEach(s=>s.layer-=e)}}function qz(t){if(t.nodes.some(e=>e.data.sink)){const e=t.nodes.reduce((s,i)=>Math.max(s,i.layer),-1/0);t.nodes.forEach(s=>{s.data.sink&&(s.layer=e+1)})}}function jz(t){const e=[];t.nodes.forEach(i=>e[i.layer]=0);const s=Array.from(e).reduce((i,n,r)=>{if(r===0)return i.push(0),i;const o=i[r-1];return n!==void 0?(i.push(o),i):(i.push(o-1),i)},[]);t.nodes.forEach(i=>i.layer+=s[i.layer])}function Yz(t){return Uz(t),qz(t),Vz(t),jz(t),t.nodes.forEach(e=>{const{below:s,above:i}=e.children.reduce((n,r)=>(e.layer>r.layer?n.above.push(r):n.below.push(r),n),{above:[],below:[]});i.forEach(n=>n.children.push(e)),e.children=s}),Gz(t)}var Hz=(t,{nodeDistance:e,layerDistance:s,nodeLookup:i,customSort:n,customLayering:r,sortSiblings:o,siblingsPacking:a,shouldDecross:l=!0})=>{Yz(t),a.packSiblings(t),r&&r(t);const d=Xz(t);return t.nodes.length>1?(Bz(d,l,o),n&&d.forEach(h=>{h.sort((u,c)=>n(i.get(u.id),i.get(c.id)))}),Dz(d,e,s)):(t.nodes[0].x=0,t.nodes[0].y=0),a.unpackSiblings(t),$z(t),t};function Xz(t){return t.nodes.reduce((e,s)=>(e[s.layer]=e[s.layer]||[],e[s.layer].push(s),s.children=s.children.map(i=>{if(i.layer===s.layer+1)return i;let n=i;for(let r=i.layer-1;r>s.layer;r--){const o=gz(`${s.id}->${i.id}@${r}`,r);o.children=[n],e[r]=e[r]||[],e[r].push(o),n=o}return n}),e),[])}function $z(t){t.nodes.forEach(e=>{e.data&&(e.children=e.children.filter(Wu))})}var Wz=(t,e={})=>{const s=new Map,i=new Map;for(const d of t.nodes)s.set(d.id,d);const n=t.nodes.slice(),r=(t.edges||[]).filter(({source:d,target:h})=>d!==h),o=Jp(n,r,s).filter(d=>{const h=i.get(d.source);if(!h){const u=new Map;return u.set(d.target,!0),i.set(d.source,u),!0}return!h.get(d.target)&&(h.set(d.target,!0),!0)}),a=yz(n,o,{skipSingletons:e.packing==="grid"}),l=a.map(d=>{const h=d.map(c=>s.get(c)),u=o.filter(c=>d.includes(c.source));return Jp(h,Fz({nodes:h,edges:u}),s)}).flat().reduce((d,h)=>(d.has(h.source)||d.set(h.source,Cl(s.get(h.source))),d.has(h.target)||d.set(h.target,Cl(s.get(h.target))),d.get(h.target).children.push(h.source),d.get(h.target).parentIds.push(h.source),d),new Map);return{components:a.map(d=>d.map(h=>l.get(h)||Cl(s.get(h)))),lookup:s}};function Zz(t,e,s,i){const n=[];for(const r of t){const o=Mz(r);n.push(o),Hz(o,{nodeDistance:i.nodesSeparation,layerDistance:i.layerSeparation,shouldDecross:i.shouldDecross,siblingsPacking:s,customSort:i.customSort,customLayering:i.customLayering,sortSiblings:!!i.sortSiblings,nodeLookup:e})}return n}var e_=(t,e={})=>{if(!t||!t.nodes)return t;const s={direction:"down",packing:"fit",nodesGridSeparation:1,...e,shouldDecross:e.shouldDecross!==!1},i=new Az(e.shouldPackSiblings,e.siblingPacking,e.siblingsGap),{components:n,lookup:r}=Wz(t,s),o=bz(r),a=Zz(n,r,i,s);if(s.packing==="grid"){const l=Nz(t.nodes,t.edges,s);a.push(l)}return Iz(a,s),vz(o,r,a),t},Ih={direction:"TB",nodeDistance:5,levelDistance:50,componentDistance:50,gapWidth:1,arrangeComponents:"fit",gridDistance:50,layer:"layer",siblingIndex:""},Ku={name:"hierarchical",imports:{sequential:e_},configure:function(t,{graph:e,data:s}){function i(y,x,b=y.getNodes()){return x?x instanceof Ei?x:y.getNodes(x):b}const n={...Ih,...t,nodeList:t.nodes};n.direction=t.direction||Ih.direction,n.layerSeparation=n.levelDistance,n.nodesSeparation=n.nodeDistance,n.componentsSeparation=n.componentDistance,n.gapDistance=n.gapWidth,n.packing=n.arrangeComponents;const r={...n},o=n.edges,a=n.nodeList;if(["TB","BT","LR","RL"].indexOf(n.direction)===-1)throw new Error('direction should be one of the "TB", "BT", "LR", "RL"');if(["fit","grid","singleLine"].indexOf(n.packing)===-1)throw new Error('arrangeComponents should be one of the "fit", "grid", "singleLine"');n.nodesGridSeparation=t.gridDistance||Ih.gridDistance;const l=a.getId(),d=a.getAttribute("layoutable").reduce((y,x,b)=>(y[l[b]]=x,y),{}),h=a.getAttributes(["x","y"]).reduce((y,x,b)=>(y[l[b]]=x,y),{}),u=t.rs?t.rs:a.getAttribute("radius");if(typeof r.layer!="string")throw new Error("'layer' should be the valid data field name");if(r.siblingIndex===void 0&&(r.siblingIndex=""),typeof r.siblingIndex!="string")throw new Error("'siblingIndex' should be the valid data field name");const c=i(e,n.roots,e.nodeList()),g=s.getProperty(n.nodeList,r.layer),m=r.siblingIndex.length?s.getProperty(n.nodeList,r.siblingIndex):[],f=c.map(y=>{let x=-1;return n.nodeList.forEach((b,v)=>{b===y&&(x=v)}),x});for(const y of f)g[y]=0;const p=i(e,n.sinks,e.nodeList()).toArray().reduce((y,x)=>(y[x.getId()]=!0,y),{}),_=l.map(y=>p[y]);return{nodes:l,edges:o.map(y=>({id:y.getId(),source:y.getSource().getId(),target:y.getTarget().getId()})),options:yd(n),layoutable:d,radiuses:u,siblingIndexes:m,layers:g,sinks:_,coords:h}},context:Xt,update:function({nodes:t,edges:e,options:s,layoutable:i,radiuses:n,layers:r,siblingIndexes:o,sinks:a,coords:l}){const d=e.filter(({source:c,target:g})=>c in i&&g in i),h={nodes:t.map((c,g)=>({id:c,radius:n[g],layer:r[g],siblingIndex:o[g],sink:a[g],layoutable:i[c],x:l[c].x,y:l[c].y})),edges:d},{nodes:u}=e_(h,{packing:{fit:"fit",singleLine:"singleline",grid:"grid"}[s.arrangeComponents],direction:{TB:"down",BT:"up",RL:"left",LR:"right"}[s.direction],layerSeparation:s.layerSeparation,nodesSeparation:s.nodesSeparation,sortSiblings:o.length>0,componentsSeparation:s.componentsSeparation,nodesGridSeparation:s.nodesGridSeparation,evenDistribution:s.evenDistribution});return{positions:u}},isRunning:function(){return!1},onSync:function({positions:t},{graph:e}){return{indexes:t.map(({id:s})=>(e.getNode(s)||{_index:-1})._index),x:t.map(({x:s})=>s),y:t.map(({y:s})=>s)}}},Kz=t=>(t.modules.layouts.register(Ku),(e={})=>(e.useWebWorker=!1,t.modules.layouts.start(Ku.name,e))),Qu=(t,e)=>t-e,s_={name:"radial",imports:{minHeap:Sd,bellmanFord:Sc,dijkstra:wc,johnson:nu,distance:Ce,circleCircleIntersection:Lc,circleSortCompare:Cc,weightedStress:Ex,distanceStress:Sx,constrainedStress:su,stressMinimizationStep:iu,removeRadialOverlap:ou,linear:rd,calculateRadii:pm},configure(t,{graph:e}){let s=t.nodes;const i=s.size;function n(A,E){return A!=null&&isFinite(A)?A:E}if(t.centralNode===void 0)throw new Error('radial layout: missing parameter "centralNode"');const r=e.getNode(t.centralNode);if(r===void 0)throw new Error('radial layout: parameter "centralNode" is not valid');t.radiusRatio=n(t.radiusRatio,Math.SQRT2),t.radiusDelta=n(t.radiusDelta,0),t.nodeGap=n(t.nodeGap,10),t.repulsion=i*n(t.repulsion,1);const o=r.getPosition(),a=n(t.centerX,o.x),l=n(t.centerY,o.y),d=r._index;s.includes(r)||(s=s.concat(r.toList()));let h=s._indexes;const u=s.getAttribute("layoutable");h=h.filter((A,E)=>u[E]||A===d),h.sort(Qu);const c=h.length,g=Qz(h,e.getConnectedComponents(s,{internalIndexes:!0}),d),m=e.degrees(h),f=new Float32Array(t.xs?t.xs:e.getNodeAttribute("x").getMultiple(h)),p=new Float32Array(t.ys?t.ys:e.getNodeAttribute("y").getMultiple(h)),_=t.rs?t.rs:e.getNodeAttribute("radius").getMultiple(h),y=e.getEdges()._indexes,x=e.getEdgeAttribute("source").getMultiple(y),b=e.getEdgeAttribute("target").getMultiple(y),v=e.getAdjacencyList({internalIndexes:!0,weight:1,indexes:h});return{centerIndex:d,centerIndexPos:0,cx:a,cy:l,D:null,indexes:h,components:g,normIndexes:null,radii:null,rings:null,x:f,y:p,degree:m,size:c,attributes:{size:_,adjacency:v,weights:b.map(()=>1),sources:x,targets:b},sortAttr:null,allowOverlap:!!t.allowOverlap,nodeGap:t.nodeGap,radiusRatio:t.radiusRatio,radiusDelta:t.radiusDelta,repulsion:t.repulsion,randomize:!("randomize"in t)||!!t.randomize,renderSteps:!!t.renderSteps,epsilon:n(t.epsilon,.001),maxSteps:n(t.maxIterations,100),iterationsPerRender:n(t.iterationsPerRender,20),step:-1,stress:Number.POSITIVE_INFINITY,prevStress:0,converged:!1,overlapRemoved:!1,done:!1}},context:()=>({data:null,gridPlacement(t,e,s=8){const i=t.length,n=new Float32Array(i),r=new Float32Array(i);let o=0;for(let c=0,g=t.length;c<g;c++){const m=e[t[c]];m>o&&(o=m)}const a=o*s,l=Math.ceil(Math.sqrt(i)),d=Math.ceil(i/l),h=-Math.floor((d-1)*a/2),u=-Math.floor((l-1)*a/2);for(let c=0;c<l;c++)for(let g=0;g<d;g++)n[c*d+g]=h+g*a,r[c*d+g]=u+c*a;return{x:n,y:r}},connectComponents(t,e,s,i,n,r){let o;function a(l,d){const h=new Uint32Array(l.length+1);return h.set(l),h[l.length]=d,h}for(let l=1;l<t.length;l++){const d=t[l];let h=0,u=0;d.forEach((m,f)=>{const p=n.get(m);p!=null&&p>h&&(u=f,h=p)}),o=d[u];const c=e[r.get(o)];c.weights=c.weights||[],c.nodes=a(c.nodes,s),c.weights.push(i);const g=e[r.get(s)];g.weights=g.weights||[],g.nodes=a(g.nodes,o),g.weights.push(i)}},correctSubgraphsDistances(t,e,s,i,n){const r=Array.prototype.reduce.call(t[s],(a,l,d)=>(d!==s&&l<i&&l>a&&(a=l),a),0),o=i-r-1;for(let a=1;a<e.length;a++){const l=e[a];for(let d=0,h=l.length;d<h;d++){const u=n.get(l[d]);u!=null&&(t[s][u]-=o,t[u][s]-=o)}}},initialize(t,e){t.data=e,e.step=0;const s=new Map,i=new Map;e.normIndexes=e.indexes.reduce((d,h,u)=>(d[u]=u,s.set(h,u),i.set(h,e.degree[u]),t.data&&h===e.centerIndex&&(t.data.centerIndexPos=u),d),new Uint32Array(e.indexes.length));const n=e.centerIndexPos,r=e.components[0].length;t.connectComponents(e.components,e.attributes.adjacency,e.centerIndex,r,i,s);const o=nu({sources:e.attributes.sources,targets:e.attributes.targets,weights:e.attributes.weights,indexes:e.indexes,adjacency:e.attributes.adjacency,undirected:!0});t.correctSubgraphsDistances(o,e.components,n,r,s),e.D=o;const a=o[n],l={};for(let d=0,h=e.normIndexes.length;d<h;d++)if(d!==n){const u=a[d];l[u]=l[u]||[],l[u].push(e.normIndexes[d])}e.rings=l,e.radii=pm(n,e.rings,e.attributes.size,e.nodeGap,e.radiusRatio,e.radiusDelta)},removeOverlaps(t,e){if(!t.data)return;const s=t.data.centerIndexPos,i=e.attributes.size,{rings:n,radii:r}=e,o=e.x[s],a=e.y[s];for(const l in n){const d=n[l];for(let h=0;h<d.length;h++){const u=d[h],c=r[l];let g=e.x[u]-o,m=e.y[u]-a;g+m===0&&(g=Math.sin(u)*Math.random()*.001,m=Math.cos(u)*Math.random()*.001);const f=Math.sqrt(g*g+m*m);if(f-c<0){const p=c/f;e.x[u]=o+g*p,e.y[u]=a+m*p}}}for(const l in n){const d=n[l],h=Ce(o,a,e.x[d[0]],e.y[d[0]]);ou({X:e.x,Y:e.y,sizes:i,indexes:d,center:[o,a],R:h,gap:e.nodeGap,inPlace:!0})}}}),update(t,e){t||(t=e.data);const s=t.indexes,i=t.centerIndex;let n;t.x=t.x||new Float32Array(t.size),t.y=t.y||new Float32Array(t.size),t.step===-1&&e.initialize(e,t);const r=t.repulsion,o=a=>t.radii&&t.radii[a]||1;if(t.step===0&&t.randomize&&(n=e.gridPlacement(t.indexes,t.attributes.size),t.x=n.x,t.y=n.y),!t.converged){const a=t.maxSteps,l=t.iterationsPerRender;let d=t.step;const h=Math.min(d+l,a),{D:u,x:c,y:g,size:m,centerIndexPos:f,normIndexes:p}=t;for(;d<=h&&!t.converged;){const _=rd(Math.min(d,a)/a);t.step=d++,n=iu(u,c,g,m,f,r,_,p,o),t.x=n.x,t.y=n.y,t.prevStress=t.stress,t.stress=su(u,c,g,m,f,r,_,p),t.converged=t.converged||Math.abs(t.stress-t.prevStress)<=t.epsilon}}if(t.converged)if(t.overlapRemoved||t.allowOverlap){t.done=!0;const a=t.rings||{};t.rings=Object.keys(a).reduce((l,d)=>(l[d]=a[d].map(h=>s[h]),l),{})}else e.removeOverlaps(e,t,i),t.overlapRemoved=!0;return t},isRunning:({data:t})=>!(!t||t.converged&&(t.allowOverlap||t.done))||(t&&(t.step=-1),!1),onSync(t){if(t.renderSteps||t.done)return i_(t)},onEnd:t=>i_(t)};function i_(t){const e=t.x,s=t.y,i=t.indexes.length,n=e[t.centerIndexPos]-t.cx,r=s[t.centerIndexPos]-t.cy;for(let o=0;o<i;o++)e[o]-=n,s[o]-=r;return{indexes:t.indexes,x:e,y:s}}function Qz(t,e,s){const i=t.slice().sort(Qu),n=[];for(let r=0,o=e.length;r<o;r++){const a=[],l=e[r];let d=!1;for(let h=0,u=l.length;h<u;h++){const c=l[h];cy(i,c)!==-1&&(c===s&&(d=!0),a.push(c))}a.length!==0&&n[d?"unshift":"push"](a.sort(Qu))}return n}var Jz=t=>(t.modules.layouts.register(s_),e=>{if(e.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');if(e.maxIterations=e.maxIterations&&isFinite(e.maxIterations)?Math.floor(e.maxIterations):100,e.maxIterations<1)throw new RangeError("maxIterations must be a positive integer");if(e.iterationsPerRender=e.iterationsPerRender&&isFinite(e.iterationsPerRender)?Math.floor(e.iterationsPerRender):20,e.iterationsPerRender<1)throw new RangeError("iterationsPerRender must be a positive integer");if(e.epsilon=e.epsilon&&isFinite(e.epsilon)?e.epsilon:.001,e.epsilon<=0)throw new RangeError("epsilon has to be a positive number");return t.modules.layouts.start(s_.name,e)}),n_={...Ku,name:"sequential"},tD=t=>(t.modules.layouts.register(n_),(e={})=>{e.useWebWorker=!1;const s={...e,evenDistribution:!0};return t.modules.layouts.start(n_.name,s)}),eD=class extends ce{constructor(t){super(t),this.stop=()=>this._ogma.modules.layouts.stop(),this.concentric=JF(t),this.radial=Jz(t),this.force=dz(t),this.forceLink=hz(t),this.hierarchical=Kz(t),this.sequential=tD(t),this.grid=uz(t)}},sD=class extends ce{constructor(){super(...arguments),this.move=t=>this._ogma.modules.virtualMouse.move(t),this.down=t=>this._ogma.modules.virtualMouse.down(t),this.up=t=>this._ogma.modules.virtualMouse.up(t),this.click=t=>this._ogma.modules.virtualMouse.click(t),this.rightClick=t=>this._ogma.modules.virtualMouse.rightClick(t),this.doubleclick=t=>this._ogma.modules.virtualMouse.doubleclick(t),this.drag=(t,e)=>this._ogma.modules.virtualMouse.drag(t,e),this.wheel=t=>this._ogma.modules.virtualMouse.wheel(t)}},iD=class extends ce{constructor(){super(...arguments),this.map=t=>this._ogma.modules.rules.createMapping(t),this.slices=t=>this._ogma.modules.rules.createSlices(t),this.template=t=>this._ogma.modules.rules.createTemplate(t)}},nD=class extends ce{constructor(){super(...arguments),this.watchNodeObjectProperty=t=>this._ogma.modules.watcher.watchNodeObjectProperty(t),this.watchEdgeObjectProperty=t=>this._ogma.modules.watcher.watchEdgeObjectProperty(t),this.watchNodeNonObjectProperty=t=>this._ogma.modules.watcher.watchNodeNonObjectProperty(t),this.watchEdgeNonObjectProperty=t=>this._ogma.modules.watcher.watchEdgeNonObjectProperty(t)}},rD=class{clearSelection(){return this.modules.selection.clear()}getSelectedNodes(){return this.modules.selection.getSelectedNodes()}getNonSelectedNodes(){return this.modules.selection.getNonSelectedNodes()}getSelectedEdges(){return this.modules.selection.getSelectedEdges()}getNonSelectedEdges(){return this.modules.selection.getNonSelectedEdges()}},oD=class{setOptions(t){return this.modules.settings.update(t)}getOptions(){return this.modules.settings.get()}},aD=class extends ce{constructor(){super(...arguments),this.setNodesVisibility=t=>this._ogma.modules.graphics.setNodesVisibility(t),this.setEdgesVisibility=t=>this._ogma.modules.graphics.setEdgesVisibility(t),this.setNodeTextsVisibility=t=>this._ogma.modules.graphics.setNodeTextsVisibility(t),this.setEdgeTextsVisibility=t=>this._ogma.modules.graphics.setEdgeTextsVisibility(t),this.addRule=(t={})=>this._ogma.modules.styleRules.addRule(t),this.getRuleList=()=>this._ogma.modules.styleRules.getRuleList(),this.addNodeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({nodeAttributes:s,nodeSelector:i})},this.addEdgeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({edgeAttributes:s,edgeSelector:i})},this.getNodeRules=()=>this.getRuleList().filter(t=>t.getDefinition().edgeAttributes===void 0),this.getEdgeRules=()=>this.getRuleList().filter(t=>t.getDefinition().nodeAttributes===void 0),this.createClass=t=>this._ogma.modules.classes.createClass(t),this.getClass=t=>this._ogma.modules.classes.getClassByName(t),this.getClassList=()=>this._ogma.modules.classes.getClassList(),this.setHoveredNodeAttributes=(t,e)=>{this._ogma.modules.hover.updateNodeAttributes(t,e)},this.setHoveredEdgeAttributes=(t,e)=>{this._ogma.modules.hover.updateEdgeAttributes(t,e)},this.setHoveredEdgeExtremitiesAttributes=(t,e)=>this._ogma.modules.hover.setEdgeExtremitiesAttributes(t,!!e),this.setSelectedNodeAttributes=(t,e)=>this._ogma.modules.selection.setNodeAttributes(t,!!e),this.setSelectedEdgeAttributes=(t,e)=>this._ogma.modules.selection.setEdgeAttributes(t,!!e),this.setSelectedEdgeExtremitiesAttributes=(t,e)=>this._ogma.modules.selection.setEdgeExtremitiesAttributes(t,!!e),this.setTheme=({nodeAttributes:t,edgeAttributes:e,selectedNodeAttributes:s,selectedEdgeAttributes:i,selectedEdgeExtremitiesAttributes:n,hoveredNodeAttributes:r,hoveredEdgeAttributes:o,hoveredEdgeExtremitiesAttributes:a})=>{this._ogma.modules.pulses.setTheme(t&&t.pulse||{},e&&e.pulse||{}),this._ogma.modules.graphics.getAttributesManager().setDefaultAttributes(t||{},e||{}),this.setSelectedNodeAttributes(s||{}),this.setSelectedEdgeAttributes(i||{}),this.setHoveredNodeAttributes(r||{}),this.setHoveredEdgeAttributes(o||{}),this.setHoveredEdgeExtremitiesAttributes(a||{}),this.setSelectedEdgeExtremitiesAttributes(n||{})},this.fontSizeToBadgeScale=$0}},lD=class extends ce{constructor(){super(...arguments),this.set=(t,e)=>this._ogma.modules.brand.set(t,e),this.remove=()=>{this._ogma.modules.brand.remove()}}},dD=class extends ce{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.connectNodes.enable(t),this),this.disable=()=>(this._ogma.modules.connectNodes.disable(),this),this.enabled=()=>this._ogma.modules.connectNodes.enabled()}},r_={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t})=>t.setSelected(!0),bothExtremities:!1},gA=class extends Ot{constructor(){super(...arguments),this._enabled=!1,this._points=[],this._bbox=new rs,this._onStart=({x:t,y:e})=>{this._bbox.reset(),this.savePoint(t,e,!1)},this._onStop=()=>{const{minX:t,minY:e,maxX:s,maxY:i}=this._bbox,{nodes:n,edges:r}=this._modules.spatial.queryProjected(t,e,s,i),o={},a=n.filter(h=>{const u=h.isVisible(),c=h.getAttribute("detectable"),g=u&&c&&this._modules.locate.isNodeInPolygon(h,this._points);return o[h._index]=g,g});let l=r.filter(h=>{const u=h.isVisible(),c=h.getAttribute("detectable");return u&&c&&this._modules.locate.isEdgeInPolygon(h,this._points)});this._options.bothExtremities&&(l=this.filterByExtremities(l,o)),this._layer.clear();const d=this._points.slice();this._points=[],this.disable(),this._options.callback({nodes:a,edges:l,points:d})}}onMounted(){this._options=be(r_),this._cachedCursor="",this._modules.events.isRegistered("lassoEnabled")||this._modules.events.register(["lassoEnabled","lassoDisabled"]),this._interaction=this._modules.interactions.onDrag({priority:"lasso",check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this.savePoint(t,e,!0),onStop:this._onStop})}enable(t={}){return this._enabled||(this._enabled=!0,this._modules.captor.setDetectionEnabled(!1),this._options=fs(t,r_),this._layer=this._modules.layers.addCanvasLayer(Xt,{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._cachedCursor=this._layer.element.parentElement?.style.cursor||"",Vl(this._layer.element.parentElement,this._options.cursorStyle),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorPosition()),this._modules.events.fire("lassoEnabled")),this}disable(){return this._enabled?(this._enabled=!1,this._modules.captor.setDetectionEnabled(!0),Vl(this._layer.element.parentElement,this._cachedCursor),this._layer.destroy(),this._modules.events.fire("lassoDisabled"),this):this}enabled(){return this._enabled}savePoint(t,e,s){const i=gs(),n=this._options,r=this._points;if(this._bbox.addPoint(t,e),r.push({x:t,y:e}),s){const o=r[0];this._layer.refresh(a=>{a.lineWidth=n.strokeWidth,a.lineJoin="bevel",a.strokeStyle=n.strokeColor,a.fillStyle=n.fillColor,a.beginPath(),a.moveTo(o.x*i,o.y*i);for(let l=1;l<r.length;++l){const d=r[l];a.lineTo(d.x*i,d.y*i)}a.stroke(),n.fillColor&&a.fill()})}}filterByExtremities(t,e){const s=this._modules.graph.getEdgeAttribute("source"),i=this._modules.graph.getEdgeAttribute("target");return t.filter(n=>{const r=n._index,o=s.get(r),a=i.get(r);return e[o]&&e[a]})}},hD=class extends ce{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.lasso.enable(t),this),this.disable=()=>(this._ogma.modules.lasso.disable(),this),this.enabled=()=>this._ogma.modules.lasso.enabled()}},uD=class extends ce{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.legend.enable(t),this.disable=()=>this._ogma.modules.legend.disable(),this.enabled=()=>this._ogma.modules.legend.enabled(),this.getOptions=()=>this._ogma.modules.legend.getOptions(),this.export=t=>this._ogma.modules.legend.export(t)}},o_={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t,edges:e})=>{t.size?t.setSelected(!0):e.setSelected(!0)},bothExtremities:!1},cD=class extends gA{constructor(){super(...arguments),this._onStart=({x:t,y:e})=>{this._rectangle.reset(),this._start={x:t,y:e},this._layer?.refresh(s=>{s.fillStyle=this._options.fillColor,s.strokeStyle=this._options.strokeColor,s.lineWidth=this._options.strokeWidth})},this._onStop=()=>{const t=this._modules.captor.getCursorPosition(),e=this._formatRectangle(t),{nodes:s,edges:i}=this._modules.spatial.queryProjected(e.minX,e.minY,e.maxX,e.maxY),n={},r=s.filter(a=>{const l=a.isVisible(),d=a.getAttribute("detectable"),h=l&&d&&this._modules.locate.isNodeInRectangle(a,e);return n[a._index]=h,h});let o=i.filter(a=>{const l=a.isVisible(),d=a.getAttribute("detectable");return l&&d&&this._modules.locate.isEdgeInRectangle(a,e)});this._options.bothExtremities&&(o=this.filterByExtremities(o,n)),this._layer?.clear(),this.disable(),this._options.callback({nodes:r,edges:o,rectangle:{minX:e.minX,minY:e.minY,maxX:e.maxX,maxY:e.maxY,width:e.width,height:e.height,cx:e.cx,cy:e.cy}})}}onMounted(){this._options=be(o_),this._enabled=!1,this._rectangle=new rs,this._interaction=this._modules.interactions.onDrag({priority:"lasso",disableDetection:!0,check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this._refreshRectangle({x:t,y:e}),onStop:this._onStop})}enable(t){return super.enable(fs(t,o_))}_formatRectangle(t){const e=this._start.x,s=this._start.y,i=t.x,n=t.y,r=Math.abs(e-i),o=Math.abs(s-n),a=e<i?e:i,l=s<n?s:n;return this._rectangle.reset().addPoint(a,l).addPoint(a+r,l+o)}_refreshRectangle(t){const{minX:e,minY:s,width:i,height:n}=this._formatRectangle(t),r=gs();this._layer?.refresh(o=>{o.strokeRect(e*r,s*r,i*r,n*r),this._options.fillColor&&o.fillRect(e*r,s*r,i*r,n*r)})}},gD=class extends ce{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rectangleSelect.enable(t)},this.disable=()=>{this._ogma.modules.rectangleSelect.disable()},this.enabled=()=>this._ogma.modules.rectangleSelect.enabled()}},mD=class extends ce{constructor(){super(...arguments),this.enable=t=>{this._ogma.modules.resizing.enable(t)},this.disable=()=>{this._ogma.modules.resizing.disable()},this.enabled=()=>this._ogma.modules.resizing.enabled()}},fD=class extends ce{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rewiring.enable(t)},this.disable=()=>{this._ogma.modules.rewiring.disable()},this.enabled=()=>this._ogma.modules.rewiring.enabled()}},pD=class extends ce{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.snapping.enable(t)},this.disable=()=>{this._ogma.modules.snapping.disable()},this.enabled=()=>this._ogma.modules.snapping.enabled()}},_D=class extends ce{constructor(){super(...arguments),this.onNodeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.node",t,e)},this.onNodeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.node",t,e)},this.onNodeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.node",t,e)},this.onNodeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.node",t,e)},this.onEdgeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.edge",t,e)},this.onEdgeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.edge",t,e)},this.onEdgeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.edge",t,e)},this.onEdgeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.edge",t,e)},this.onBackgroundClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.background",t,e)},this.onBackgroundRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.background",t,e)},this.onBackgroundDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.background",t,e)},this.refresh=()=>this._ogma.modules.tooltip.refresh(),this.isShown=()=>this._ogma.modules.tooltip.isShown(),this.hide=()=>{this._ogma.modules.tooltip.hide()},this.show=(t,e)=>this._ogma.modules.tooltip.show(t,e)}},yD=class extends ce{constructor(t){super(t),this.lasso=new hD(t),this.connectNodes=new dD(t),this.legend=new uD(t),this.rectangleSelect=new gD(t),this.resize=new mD(t),this.rewire=new fD(t),this.snapping=new pD(t),this.tooltip=new _D(t),this.brand=new lD(t)}},xD=class extends ce{constructor(t){super(t),this.getList=()=>this._ogma.modules.transformations.api.getList(),this.clear=()=>this._ogma.modules.transformations.api.clear().then(()=>{}),this.getById=e=>this._ogma.modules.transformations.api.getById(e),this.afterNextUpdate=()=>this._ogma.modules.transformations.afterNextUpdate(),this.onGroupsUpdated=e=>{this._ogma.modules.transformations.onGroupsUpdated(e)},this.layoutGroups=(e,s,i=!1)=>this._ogma.modules.transformations.api.layoutGroups(e,s,i),this.triggerGroupUpdated=e=>this._ogma.modules.transformations.triggerGroupUpdated(e),this.triggerGroupsUpdated=()=>this._ogma.modules.transformations.api.triggerGroupsUpdated()}addNodeGrouping(t){return this._ogma.modules.transformations.api.addNodeGrouping(t)}addNodeClustering(t){return this._ogma.modules.transformations.api.addNodeClustering(t)}addEdgeGrouping(t){return this._ogma.modules.transformations.api.addEdgeGrouping(t)}addDrillDown(t){return this._ogma.modules.transformations.api.addDrilldown(t)}addNodeFilter(t){return this._ogma.modules.transformations.api.addNodeFilter(t)}addEdgeFilter(t){return this._ogma.modules.transformations.api.addEdgeFilter(t)}getNodeFilters(){return this._ogma.modules.transformations.getNodeFilters()}getEdgeFilters(){return this._ogma.modules.transformations.getEdgeFilters()}addNeighborGeneration(t){return this._ogma.modules.transformations.api.addNeighborGeneration(t)}addNeighborMerging(t){return this._ogma.modules.transformations.api.addNeighborMerging(t)}addNodeCollapsing(t){return this._ogma.modules.transformations.api.addNodeCollapsing(t)}addGeoClustering(t){return this._ogma.modules.transformations.api.addGeoClustering(t)}addVirtualProperties(t){return this._ogma.modules.transformations.api.addVirtualProperties(t)}getXYR(t){return this._ogma.modules.transformations.getXYR(t)}expandGroup({node:t,computeSubNodesPosition:e,onExpand:s}){return this._ogma.modules.transformations.api.fishEyeExpand(t,s,e)}collapseGroup({node:t,onCollapse:e}){return this._ogma.modules.transformations.api.fishEyeCollapse(t,e)}},bD=class extends ce{constructor(){super(...arguments),this.setZoom=(t,e)=>this._ogma.modules.camera.setZoom(t,e),this.zoomIn=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomIn():this._ogma.modules.camera.zoomIn(t),this.zoomOut=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomOut():this._ogma.modules.camera.zoomOut(t),this.getZoom=()=>this._ogma.modules.camera.getZoom(),this.setCenter=(t,e)=>this._ogma.modules.camera.setCenter(t,e),this.move=(t,e)=>this._ogma.modules.camera.move(t,e),this.moveToBounds=(t,e)=>{if(!(t&&t instanceof rs)){if(!Ue(t)||t.length!==4)throw new Error("ogma.view.zoomToBounds requires a BoundingBox as a parameter");{const[s,i,n,r]=t;t=rs.from({minX:s,minY:i,maxX:n,maxY:r})}}return this._ogma.modules.camera.moveToBounds(t,e)},this.moveTo=(t,e)=>this._ogma.modules.camera.moveTo(t,e),this.getCenter=()=>this._ogma.modules.camera.getCenter(),this.setAngle=(t,e)=>this._ogma.modules.camera.setAngle(t,e),this.rotate=(t,e)=>this._ogma.modules.camera.rotate(t,e),this.getAngle=()=>this._ogma.modules.camera.getAngle(),this.set=(t,e)=>this._ogma.modules.camera.setView(t,e),this.get=()=>this._ogma.modules.camera.getView(),this.graphToScreenCoordinates=t=>this._ogma.modules.camera.graphToScreenCoordinates(t),this.screenToGraphCoordinates=t=>this._ogma.modules.camera.screenToGraphCoordinates(t),this.getImageData=()=>this._ogma.modules.graphics.getImageData(),this.getElementAt=t=>this._ogma.modules.captor.detectElementAt(t.x,t.y,!1,!0),this.getElementsInView=()=>{const{width:t,height:e}=this.get(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return this._ogma.modules.spatial.query(s.x,s.y,i.x,i.y)},this.getBounds=()=>{const{width:t,height:e}=this.getSize(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return{cx:(s.x+i.x)/2,cy:(s.y+i.y)/2,width:i.x-s.x,height:i.y-s.y,minX:s.x,minY:s.y,maxX:i.x,maxY:i.y}},this.getElementsInside=(t,e,s,i,n=!0)=>{const{spatial:r,camera:o}=this._ogma.modules;if(n){const a=o.graphToScreenCoordinates({x:t,y:e}),l=o.graphToScreenCoordinates({x:s,y:i});return r.queryProjected(a.x,a.y,l.x,l.y)}return r.queryProjected(t,e,s,i)},this.beforeNextFrame=()=>this._ogma.modules.dom.beforeNextFrame(),this.afterNextFrame=()=>this._ogma.modules.dom.afterNextFrame(),this.setFullScreen=t=>this._ogma.modules.dom.setFullScreen(t),this.isFullScreen=()=>this._ogma.modules.dom.isFullScreen(),this.forceResize=()=>this._ogma.modules.dom.forceResize(),this.getSize=()=>this._ogma.modules.dom.getDimensions(),this.setSize=t=>{if(!t||isNaN(t.width)||isNaN(t.height))throw new Error("Size must follow the format { width: number, height: number }");if(t.width<0)throw new Error("width must be positive");if(t.height<0)throw new Error("height must be positive");return this._ogma.modules.dom.setDimensions(t),Promise.resolve()},this.locateGraph=t=>this._ogma.modules.locate.locateGraph(t),this.locateRawGraph=(t,e)=>this._ogma.modules.locate.locateRawGraph(t,e),this.getGraphBoundingBox=({withTexts:t=!1}={})=>this._ogma.modules.locate.getGraphBoundingBox(t),this.animationInProgress=()=>this._ogma.modules.locate.isLocating()||this._ogma.modules.camera.animationInProgress(),this.getTextBoundingBox=t=>{if(!t)throw new Error("ogma.view.getTextBoundingBox: item must be a Node or an Edge");const e=t.getAttribute("text");return e==null||e===""?null:t.isList?this._ogma.modules.labels.getTextsBoundingBox(t):this._ogma.modules.labels.getTextsBoundingBox(t.toList())},this.getNodeBadgeAt=(t,e)=>{if(!t)throw new Error("ogma.view.getNodeBadgeAt: node is not defined");return Ub(e,t._index,this._ogma.modules.graphics.getAttributesManager(),this._ogma.modules.camera,this._ogma.modules.graphics.getGraphicsEngine())}}},vD=class{constructor(t,e){this._ogma=t,this.settings=new BM(t),this.events=new DM(t),this.dom=new N1(t),this.animations=new yO(t),this.camera=new AM(t),this.graph=new Q1(t),this.data=new F1(t),this.graphics=new CM(t),this.layers=new HB(t),this.individualAttributes=new kM(t),this.algorithms=new XB(t),this.position=new DB(t),this.touch=new dR(t),this.mouse=new aR(t),this.virtualMouse=new ik(t),this.spatial=new WM(t),this.captor=new Dk(t),this.interactions=new Lk(t),this.classes=new qM(t),this.cameraInteractions=new bM(t,!!e.debug),this.hover=new zB(t),this.keyboard=new Zk(t),this.selection=new hO(t),this.styleRules=new lk(t),this.legend=new FB(t),this.sync=new uO(t),this.rules=new VB(t),this.transformations=new lO(t),this.locate=new iR(t),this.drag=new Ok(t),this.pulses=new fO(t),this.curvatureManager=new zO(t),this.workers=new jO(t),this.layouts=new XO(t),this.watcher=new QO(t),this.rectangleSelect=new cD(t),this.labels=new Ik(t,e),this.brand=new FO(t),this.lasso=new gA(t),this.rewiring=new Bk(t),this.resizing=new Uk(t),this.snapping=new nk(t),this.connectNodes=new Vk(t),this.tooltip=new $k(t),this.geo=new PO(t),Object.keys(this).forEach(s=>{const i=this[s];i instanceof Ot&&(i._setModules(this),i.onMounted())}),t.onReady(()=>{Object.keys(this).forEach(s=>{const i=this[s];i instanceof Ot&&i.onReady(e)})})}destroy(){Object.keys(this).forEach(t=>{const e=this[t];e instanceof Ot&&e.destroy(this._ogma)})}},AD=1,ED=[uR,hR,fR,eT,WF,rD,oD],Ju={version:"5.3.3",commit:"2db0f5e37",buildTime:"Thu Aug 07 2025 08:32:23 GMT+0000 (Coordinated Universal Time)"},$n=class tc{constructor(e={}){this.node=s=>new Vs(s,this),this.edge=s=>new Yi(s,this),this.nodeList=s=>new Ei(s||new Uint32Array(0),this),this.edgeList=s=>new Mn(s||new Uint32Array(0),this),this._onReady=[],this.build=Ju,this._init(e)}static{this.libraries=Wy}static{this.geometry=lr}static{this.parse=gg}_init(e){this._initParameters=e,this._debug=!!e.debug,this._token=AD++,this.modules=new vD(this,e),this.styles=new aD(this),this.algorithms=new $B(this),this.export=new yF(this),this.keyboard=new KF(this),this.generate=new XF(this),this.layouts=new eD(this),this.parse=new ZF(this),this.transformations=new xD(this),this.tools=new yD(this),this.view=new bD(this),this.mouse=new sD(this),this.events=new pR(this),this.schema=new nD(this),this.rules=new iD(this),this.geo=new $F(this),this.layers=new QF(this),this.debug=new mR(this),this._onReady.forEach(s=>s(this)),this.safelyBindToInstance(),this.modules.events.register(["destroy"]),this.build={version:"5.3.3",commit:"2db0f5e37",buildTime:"Thu Aug 07 2025 08:32:23 GMT+0000 (Coordinated Universal Time)"}}safelyBindToInstance(){for(const e of Object.getOwnPropertyNames(tc.prototype))typeof tc.prototype[e]=="function"&&(this[e]=this[e].bind(this))}onReady(e){this._onReady.push(e)}_destroy(){if(!this._token)throw new Error('"destroy" called twice on the same instance of Ogma');this._onReady=[],this.modules.destroy(),this.modules=null}destroy(){this.modules.events.fire("destroy",{}),this._destroy()}isDestroyed(){return!this.modules}reset(){const e=this._initParameters;this._destroy(),this._init(e)}isDebug(){return this._debug}static{this.build=Ju}static{this.algorithms=Ec}static{this.utils=sg}};$n.algorithms=Ec,$n.utils=sg,$n.parse=gg,$n.build=Ju,GS($n,ED);var mA=$n,Ze=(t=>(t.NodeFilter="node-filter",t.EdgeFilter="edge-filter",t.NodeCollapsing="node-collapsing",t.VirtualProperties="virtual-properties",t.NeighborGeneration="neighbor-generation",t.NeighborMerging="neighbor-merging",t.NodeGrouping="node-grouping",t.EdgeGrouping="edge-grouping",t.NodeClustering="node-clustering",t.GeoClustering="geo-clustering",t.Unknown="unknown",t))(Ze||{}),en=class{constructor({id:t,duration:e,easing:s,ogma:i,module:n}){this.animation=s?{duration:e,easing:s}:e===void 0?0:e,this.destroyed=!1,this.id=t,this.ogma=i,this.context={},this.module=n,this.resetContext()}setOptions(t){var e;let s=typeof this.animation=="number"?this.animation:(e=this.animation)==null?void 0:e.duration,i=typeof this.animation=="object"?this.animation.easing:void 0;return typeof t.duration=="number"&&(s=t.duration),t.easing!==void 0&&(i=t.easing),this.animation=i?{duration:s,easing:i}:s===void 0?0:s,this.module.setOptions(this),this.module.afterNextUpdate()}enable(t){return this.animation=t===void 0?this.animation:t,this.module.enable(this)}disable(t){return this.animation=t===void 0?this.animation:t,this.module.disable(this)}isEnabled(){return this.module.isEnabled(this)}getId(){return this.id}whenApplied(){return this.module.afterNextUpdate().then(()=>this)}toggle(t){return this.animation=t===void 0?this.animation:t,this.isEnabled()?this.module.disable(this):this.module.enable(this)}run(t=!0){return Promise.resolve()}undo(t=!0){return Promise.resolve()}cleanup(){return this.resetContext(),Promise.resolve()}refresh(){return this.module.refreshTransformation(this),this.module.afterNextUpdate()}getIndex(){return this.module.getIndex(this)}setIndex(t){return this.module.setIndex(this,t),this.module.afterNextUpdate()}getAnimation(){return typeof this.animation=="number"?{duration:this.animation,easing:"linear"}:this.animation}getContext(){return this.context}setContent(t){this.context=t}resetContext(){this.context={}}getName(){return Ze.Unknown}destroy(t){return t!==void 0&&(this.animation=t),this.module.remove(this)}},SD=class{constructor(t){this.xs=new Map,this.ys=new Map,this.rs=new Map,this.curvatures=new Map,this.hiddenNodes=new Set,this.hiddenEdges=new Set,this.animations=[],this.before=[],this.after=[],this.applying=!1,this._onNodesRemoved=e=>{const s=e.nodes._indexes;for(const i of s)this.xs.delete(i),this.ys.delete(i),this.rs.delete(i)},this.ogma=t,this.afterMod={nodesToHide:new Set,edgesToHide:new Set},this.layer=this.ogma.modules.graphics.addAttributeLayer({name:"ogma-transformations-animations",priority:5.99999,nodeOutput:{attributes:["radius"]},edgeOutput:{attributes:["curvature"]},nodeDependencies:void 0,edgeDependencies:void 0}),this.attributeLayerData=this.layer._attributesManager._getLayerById(this.layer._id),this.initEvents()}initEvents(){this.ogma.events.on("removeNodes",this._onNodesRemoved)}apply(t){const e=Array.from(this.xs.values()),s=Array.from(this.ys.values()),i=Array.from(this.rs.values()).map(u=>({radius:u})),n=Array.from(this.curvatures.values()).map(u=>({curvature:u})),r=this.ogma.nodeList(Array.from(this.hiddenNodes)),o=this.ogma.edgeList(Array.from(this.hiddenEdges)),a=e.map((u,c)=>({x:u,y:s[c]})),l=this.ogma.nodeList(Array.from(this.xs.keys())),d=this.ogma.nodeList(Array.from(this.rs.keys())),h=this.ogma.edgeList(Array.from(this.curvatures.keys()));return this.xs.clear(),this.ys.clear(),this.rs.clear(),this.curvatures.clear(),this.hiddenNodes.clear(),this.hiddenEdges.clear(),this.before.forEach(u=>u()),this.initCurvature(h._indexes),this.applying=a.length>0||i.length>0||n.length>0,Promise.all([a.length?l.setAttributes(a,t):Promise.resolve(),i.length?this.ogma.modules.graphics.animate(d,()=>this.layer.setAttributeValues(d,i),!1,t):Promise.resolve(),n.length?this.ogma.modules.graphics.animate(h,()=>this.layer.setAttributeValues(h,n),!1,t):Promise.resolve(),...this.animations.map(u=>u())]).then(()=>(this.ogma.nodeList(Array.from(this.afterMod.nodesToHide)).setVisible(!1),this.ogma.edgeList(Array.from(this.afterMod.edgesToHide)).setVisible(!1),Promise.all(this.after.map(u=>u())))).then(()=>{this.deleteCurvatures(h._indexes),r.setVisible(!1),o.setVisible(!1),this.animations=[],this.before=[],this.after=[],this.afterMod.nodesToHide.clear(),this.afterMod.edgesToHide.clear(),this.applying=!1})}setXYR(t,e,s,i){if(typeof t=="number")this.xs.set(t,e),this.ys.set(t,s),i!==void 0&&this.rs.set(t,i);else for(const n of t)this.xs.set(n,e),this.ys.set(n,s),i!==void 0&&this.rs.set(n,i)}getOpenRadius(t){return this.attributeLayerData.nodes.outputFlexArrays.radius.get(t)}getInputFlexArrays(){return this.attributeLayerData.nodes.inputFlexArrays}getCloseRadius(t){return this.attributeLayerData.nodes.inputFlexArrays.radius.get(t)}deleteOpenRadius(t){this.layer.getFlexArrays().nodes.radius.set(t,void 0)}initCurvature(t){const e=this.attributeLayerData.edges.inputFlexArrays.curvature,s=this.attributeLayerData.edges.outputFlexArrays.curvature;for(let i=0;i<t.length;i++)s.set(t[i],e.get(t[i]))}deleteCurvatures(t){const e=this.layer.getFlexArrays().edges.curvature;for(let s=0;s<t.length;s++)e.set(t[s],void 0)}hideNode(t){this.hiddenNodes.add(t)}showNode(t){this.hiddenNodes.delete(t)}hideNodes(t){for(const e of t)this.hiddenNodes.add(e)}showNodes(t){for(const e of t)this.hiddenNodes.delete(e)}hideEdge(t){this.hiddenEdges.add(t)}showEdge(t){this.hiddenEdges.delete(t)}hideEdges(t){for(const e of t)this.hiddenEdges.add(e)}showEdges(t){for(const e of t)this.hiddenEdges.delete(e)}pushBefore(t){Array.isArray(t)?this.before.push(...t):this.before.push(t)}pushAfter(t){Array.isArray(t)?this.after.push(...t):this.after.push(t)}setXY(t,e,s){this.xs.set(t,e),this.ys.set(t,s)}getXYR(t){const e=this.xs,s=this.ys,i=this.rs,n=t.getAttributes(["x","y","radius"]);for(let r=0;r<t.size;r++){const o=t._indexes[r];e.has(o)&&(n[r].x=e.get(o)),s.has(o)&&(n[r].y=s.get(o)),i.has(o)&&(n[r].radius=i.get(o))}return n}getXs(t){return this.getMapValues(t,"x",this.xs)}getYs(t){return this.getMapValues(t,"y",this.ys)}getRs(t){return this.getMapValues(t,"radius",this.rs)}getMapValues(t,e,s){const i=this.ogma.modules.graphics.getAttributesManager()._layerController.nodes._currentFlexArrays[e],n=new Array(t.size);for(let r=0;r<t.size;r++){const o=t._indexes[r];s.has(o)?n[r]=s.get(o):n[r]=i.get(o)}return n}setR(t,e){this.rs.set(t,e)}setRs(t,e){for(let s=0;s<t.length;s++)e[s]!==void 0&&this.rs.set(t[s],e[s])}setCurvatures(t,e){for(let s=0;s<t.length;s++)this.curvatures.set(t[s],e[s])}setCurvature(t,e){this.curvatures.set(t,e)}hideNodesAfter(t){for(let e=0;e<t.length;e++)this.afterMod.nodesToHide.add(t[e])}hideEdgesAfter(t){for(let e=0;e<t.length;e++)this.afterMod.edgesToHide.add(t[e])}setOpenRadius(t,e){this.attributeLayerData.nodes.outputFlexArrays.radius.set(t,e)}push(t){Array.isArray(t)?this.animations.push(...t):this.animations.push(t)}getMaxAnimation(t,e){return(typeof t=="number"?t:t.duration)>(typeof e=="number"?e:e.duration)?t:e}isApplying(){return this.applying}},ec=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)i.hasOwnProperty(n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):a_(e[n])&&a_(i[n])?e[n]=ec(e[n],i[n]):e[n]=i[n])}return e};function co(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function wD(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Ogma transformations: Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}function TD(t,e){const s=t.get(0);return{data:s.getData(),attributes:s.getAttributes(e)}}function hd(t,e){return`gen_grp_${e}_${t}`}function a_(t){return!(!t||t.constructor!==Object&&t.constructor)}function ID(t){return t.map(({id:e,source:s,target:i})=>({id:e,source:s,target:i}))}function LD(t,e,s,i){let n=e,r=s;return!i&&n.toString()>r.toString()&&(n=s,r=e),`${t}[${n}-${r}]`}function CD(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`Ogma transformation: ${t} is not a valid id, expected string or number`);return t}function el(t){return`data.${t}`}var ND=class{constructor(t){this.groupsByDepth=new Map,this.treeMap=new Map,this.dataMap=new Map,this.invalidEdges=new Map,this.edges=new Map,this.ogma=t.ogma,this.module=t.module,this.enabled=t.enabled===void 0||t.enabled,this.onGetSubgraph=t.onGetSubgraph,this.duration=t.duration||0,this.easing=t.easing||"quadraticOut",this.parentPath=t.parentPath||"parent",this.depthPath=t.depthPath||"depth",this.padding=t.padding||0,this.nodeGenerator=t.nodeGenerator||(()=>({})),this.showContents=t.showContents===void 0||t.showContents,this.onGroupUpdate=t.onGroupUpdate||(()=>{}),this.copyData=t.copyData===void 0||t.copyData,this.context={virtualEdges:this.ogma.edgeList()}}createGrouping(t){var e;const{ogma:s,groupsByDepth:i}=this,n=s.transformations.addNodeGrouping({selector:o=>o.getData(this.depthPath)===t,groupIdFunction:o=>o.getData(this.parentPath),showContents:o=>typeof this.showContents=="boolean"?this.showContents:this.showContents(o,t),onBeforeAddMetaEdges:(o,a)=>this.addEdges(o,a),onGroupUpdate:(o,a,l)=>this.onGroupUpdate(o,a,l,t),padding:o=>typeof this.padding=="number"?this.padding:this.padding(o,t),duration:this.duration,enabled:this.enabled,nodeGenerator:(o,a)=>{const l=this.nodeGenerator(o,a,n);return this.copyData&&(l.data||(l.data={}),l.data={...l.data,...this.dataMap.get(a)}),co(l,el(this.parentPath),this.treeMap.get(a)),co(l,el(this.depthPath),t-1),l.id=a,l}});if(!i.size)return i.set(t,n);const r=Array.from(i.keys()).reduce((o,a)=>Math.max(o,a));i.set(t,n),n.setIndex((e=i.get(r))==null?void 0:e.getIndex())}async drill(t){if(this.treeMap.has(t.getId()))return;const{ogma:e,groupsByDepth:s}=this;try{e.modules.graphics.pauseRendering();const i=t.getId(),n=this.getGroupId(i);this.treeMap.set(n,t.getData(this.parentPath)),this.dataMap.set(n,t.getData());const r=t.getData(this.depthPath)||0,o=t.getPosition(),a=await this.onGetSubgraph(t);this.edges.set(n,t.getAdjacentEdges().map(d=>{const h=d.getSource().getId(),u=d.getTarget().getId();return{source:h===i?n:h,target:u===i?n:u,data:{...d.getData()}}})),a.nodes.forEach(d=>{co(d,el(this.parentPath),n),co(d,el(this.depthPath),r+1),d.attributes||(d.attributes={}),d.attributes.x=o.x,d.attributes.y=o.y}),this.module.pause(),e.removeEdges(t.getAdjacentEdges()),e.removeNode(t),await e.view.afterNextFrame(),await e.addNodes(a.nodes);const l=a.edges.filter(d=>{const h=d.source,u=d.target;if(e.getNode(h)&&e.getNode(u))return!0;const c=e.getNode(h)?u:h;return this.invalidEdges.has(c)?this.invalidEdges.get(c).push(d):this.invalidEdges.set(c,[d]),!1});a.nodes.forEach(d=>{if(!this.invalidEdges.has(d.id))return;const{valid:h,invalid:u}=this.invalidEdges.get(d.id).reduce((c,g)=>(e.getNode(g.source)&&e.getNode(g.target)?c.valid.push(g):c.invalid.push(g),c),{valid:[],invalid:[]});e.addEdges(h),u.length?this.invalidEdges.set(d.id,u):this.invalidEdges.delete(d.id)}),await e.addEdges(l),s.has(r+1)||this.createGrouping(r+1),this.module.resume(),e.modules.graphics.resumeRendering(),await this.module.afterNextUpdate()}catch(i){throw e.modules.graphics.resumeRendering(),i}}async addEdges(t,e){e.forEach(s=>{const i=this.edges.get(s.getId());i&&this.ogma.addEdges(i,{virtual:!0}).then(n=>{this.context.virtualEdges=this.context.virtualEdges.concat(n)})})}getGroupId(t){return`ogma-group-${t}`}getMaxDepth(){return this.groupsByDepth.size}disable(t){return this.enabled=!1,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach(e=>e.disable(t)),this.module.animations.hideEdges(this.context.virtualEdges._indexes),this.context.virtualEdges.setSelected(!0),this.module.afterNextUpdate()}enable(t){return this.enabled=!0,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach(e=>e.enable(t)),this.module.animations.showEdges(this.context.virtualEdges._indexes),this.module.afterNextUpdate().then(()=>this.context.virtualEdges.setVisible(!0))}toggle(t){return this.enabled?this.disable(t):this.enable(t)}setOptions(t){this.onGetSubgraph=t.onGetSubgraph?t.onGetSubgraph:this.onGetSubgraph,this.duration=t.duration!==void 0?t.duration:this.duration,this.easing=t.easing||this.easing,this.parentPath=t.parentPath||this.parentPath,this.depthPath=t.depthPath||this.depthPath,this.padding=t.padding!==void 0?t.padding:this.padding,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.showContents=t.showContents!==void 0?t.showContents:this.showContents,this.onGroupUpdate=t.onGroupUpdate||this.onGroupUpdate,this.copyData=t.copyData!==void 0?t.copyData:this.copyData;const e=this.enabled;return this.enabled=t.enabled!==void 0?t.enabled:this.enabled,this.enabled!==e&&this.groupsByDepth.forEach(s=>this.enabled?s.enable({duration:this.duration,easing:this.easing}):s.disable({duration:this.duration,easing:this.easing})),this.groupsByDepth.forEach(s=>s.refresh()),this.module.afterNextUpdate()}onRemove(t){this.context.virtualEdges=this.context.virtualEdges.filter(e=>!t.has(e._index))}},MD=class{constructor(t){this.drilldowns=[],this.module=t}addDrilldown(t){this.drilldowns.push(t)}removeDrilldown(t){this.drilldowns=this.drilldowns.filter(e=>e!==t)}onRemove(t,e){e||this.drilldowns.forEach(s=>s.onRemove(t))}},To=2;function RD(t){return typeof t.then=="function"}var FD=class{constructor(t,e){this.relayouted=new Set,this.shouldRelayout=new Set,this.layoutPerGroup=new Map,this.nextLayout=new Map,this.nextOnGroupUpdate=null,this.onGroupsUpdate=()=>null,this._onLayoutPrepare=s=>{if(!s.params.nodes)return;const i=s.params.nodes,n=Array.isArray(i)?this.ogma.getNode(i[0])._index:i._indexes[0],r=this.module.nodeToMeta.get(n);if(!r)return;const o={...s,params:{...s.params}};delete o.params.nodes,delete o.params.groups,this.layoutPerGroup.set(r._index,o)},this.ogma=t,this.module=e,this.ogma.events.on("layoutPrepare",this._onLayoutPrepare)}getNodesToRecompute(t){const e=Array.from(t),s=new Set,i=[];for(;e.length>0;){const n=e.shift();if(s.has(n))continue;i.push(n),s.add(n);const r=this.module.nodeToMeta.get(n);r&&e.push(r._index)}return this.ogma.nodeList(i)}getLayoutFunction(t,e,s,i){const n=this.getNextLayout(e._index),r=this.ogma.modules.graphics.getAttributesManager()._layerController.nodes._currentFlexArrays,o={x:r.x.get(e._index),y:r.y.get(e._index)};return()=>{const a=n?n(e,s,i):t(e,s,i);return this._runLayout(a,s,o)}}_runLayout(t,e,s){let i;if(!t)return Promise.resolve(null);if(RD(t))i=t;else{if(!t)return;{const o=this.module.animations.getXs(e),a=this.module.animations.getYs(e),l=this.module.animations.getRs(e);i=this.ogma.layouts[t.layout]({...t.params,nodes:e,dryRun:!0,xs:o,ys:a,rs:l}).then(d=>d.positions.current)}}const n=this.module.animations,r=e._indexes;return i.then(o=>{if(!o)throw new Error("Ogma tansformations, onGroupUpdated callback should return either a layout or a promise containing  positions");let a=0,l=0;if(s){let d=-1/0,h=-1/0,u=1/0,c=1/0;for(let g=0;g<r.length;g++){const m=o[g];m&&(d=Math.max(d,m.x),h=Math.max(h,m.y),u=Math.min(u,m.x),c=Math.min(c,m.y))}a=s.x-(d+u)/2,l=s.y-(h+c)/2}for(let d=0;d<r.length;d++){const h=o[d];h&&(n.xs.set(r[d],h.x+a),n.ys.set(r[d],h.y+l))}})}handleLayoutFunctions(t){const e=!!this.ogma.modules.layouts.enableBatching;e&&this.ogma.modules.layouts.enableBatching();const s=t.map(n=>n()),i=e?this.ogma.modules.layouts.runBatch():Promise.resolve();return Promise.all(s).then(()=>i)}async handleGlobalLayout(t,e){const s=this.getNextOnGroupUpdate(),i=s?s(t,e):this.onGroupsUpdate(t,e);await this._runLayout(i,t)}async layoutGroups(t,e,s=!1){const i=new Map,n=this.ogma.getNodes(t.map(({groupId:a})=>a));t.forEach((a,l)=>{i.set(a.groupId,()=>this._runLayout(a,this.module.metaToNodes.get(n.get(l)._index)))});const r=this.getNodesToRecompute(n._indexes),o=new Map;r.forEach(a=>o.set(a._index,this.module.nodeToTransformation.get(a._index).getIndex())),r.sort((a,l)=>o.get(a._index)-o.get(l._index));for(let a=0;a<r.size;a++){const l=o.get(r._indexes[a]);let d;for(d=a+1;d<r.size&&o.get(r._indexes[d])===l;d++);const h=r.slice(a,d);a=d-1,await Promise.all(h.map(u=>{this.relayouted.add(u._index);let c=Promise.resolve();if(i.has(u.getId()))c=i.get(u.getId())();else if(s&&this.layoutPerGroup.has(u._index)){const g=this.module.metaToNodes.get(u._index),m=this.layoutPerGroup.get(u._index);c=this.ogma.layouts[m.name]({...m.params,nodes:g})}return c.then(()=>{this.module.groupController.setGroupXYR(u)})}))}return await this.module.groupController.onAfterLayouts(),this.module.animations.apply(e||0).finally(()=>{this.relayouted.clear()})}setNextLayout(t,e){this.nextLayout.set(t,e)}getNextLayout(t){const e=this.nextLayout.get(t);return this.nextLayout.delete(t),e}setNextOnGroupUpdate(t){this.nextOnGroupUpdate=t}getNextOnGroupUpdate(){const t=this.nextOnGroupUpdate;return this.nextOnGroupUpdate=null,t}hasRelayouted(t){return this.relayouted.has(t)}clear(){this.relayouted.clear(),this.shouldRelayout.clear()}},sl=14,PD=class{constructor(t,e){this.subNodeOffsetX=new Map,this.subNodeOffsetY=new Map,this.openRadius=new Map,this.isExpanding=new Set,this.alreadyGrouped=new Set,this.openGroups=new Set,this.closeGroups=new Set,this.fadedGroups=new Set,this.nodeGroupinCount=0,this.destroyed=!1,this.nodeLayer=new Map,this.edgeLayer=new Map,this.savedNodeLayer=new Map,this.savedEdgeLayer=new Map,this.padding=new Map,this.geoRadius=new Map,this.collapsedGroups=new Set,this.hasUpdated=new Set,this.shouldRunGroupUpdate=!1,this.runningLayouts=!1,this.onSetMultipleAttributes=({elements:i,values:n,options:r,updatedAttributes:o,promises:a})=>{if(this.module.isRefreshing()||this.destroyed||this.runningLayouts||this.module.animations.isApplying())return;const l=new Set(o),d=n;if(!i.isNode||!l.has("x")&&!l.has("y")&&!l.has("radius"))return Promise.resolve();const h=i.toList();if(!h.size)return Promise.resolve();const u=[],c=new Set,g=Array.from(h._indexes);for(;g.length;){const f=g.shift(),p=this.module.nodeToMeta.get(f);if(!p||c.has(p._index))continue;const _=this.getGroupXYR(p,this.module.getSubNodes(p),h,d);_.isGeo?u.push(p.setAttribute("radius",_.radius,r)):(delete _.isGeo,this.closeGroups.has(p._index)||this.collapsedGroups.has(p._index)?(this.openRadius.set(p._index,_.radius),this.module.animations.setXY(p._index,_.x,_.y)):this.module.animations.setXYR(p._index,_.x,_.y,_.radius),c.add(p._index)),g.push(p._index)}const m=h.map((f,p)=>{if(!this.openGroups.has(f._index))return null;const _=f.getPosition();return Array.isArray(d)&&d[p]?(d[p].x!==void 0&&(_.x=d[p].x),d[p].y!==void 0&&(_.y=d[p].y)):(d.x!==void 0&&(_.x=d.x),d.y!==void 0&&(_.y=d.y)),{group:f,position:_}}).filter(f=>f);m.length&&m.forEach(({group:f,position:p})=>this.animateChildren(f,p)),(c.size>0||m.length)&&u.push(this.module.animations.apply(r)),a.push(...u)},this.ogma=t,this.layoutController=new FD(t,e),this.groupLayer=this.ogma.modules.graphics.addAttributeLayer({name:"groups-layer",priority:5.98,edgeAttributes:{layer:i=>this.edgeLayer.get(i._index)},nodeAttributes:{layer:i=>this.nodeLayer.get(i._index)},nodeDependencies:void 0,edgeDependencies:void 0});const s=t.styles.getClass("_group-fading_");this.fadingClass=s||this.ogma.styles.createClass({name:"_group-fading_",nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this.module=e,t.events.on("setMultipleAttributes",this.onSetMultipleAttributes).on("beforeGeoCameraMove",({zoom:i})=>{const n=this.ogma.nodeList(Array.from(this.geoRadius.keys())).filter(r=>r&&!this.collapsedGroups.has(r._index)&&this.openGroups.has(r._index));n.forEach(r=>{const o=this.geoRadius.get(r._index)*2**i;this.module.animations.setOpenRadius(r._index,o)}),this.ogma.modules.geo._projection&&this.ogma.modules.geo._projection.updateElements(n)}).on(["geoEnabled","beforeGeoDisabled"],()=>this._onToggleGeo()).on("geoNodesMoved",({nodes:i})=>{const n=i._indexes;for(let r=0;r<n.length;r++){const o=this.module.getMetaNode(i.get(r));!o||!this.openGroups.has(o._index)||this.layoutController.shouldRelayout.add(o._index)}})}setSubEltsLayer(t,e,s){const i=s?To:-2;if(!this.isOpen(t))return;const n=this.module.getSubNodes(t);n.forEach(o=>{this.nodeLayer.set(o._index,e+i),this.setSubEltsLayer(o,e+i,s)});const r=n.getAdjacentEdges({bothExtremities:!0});for(let o=0;o<r.size;o++)this.edgeLayer.set(r._indexes[o],e+i)}setNodeGroupingCount(t){this.nodeGroupinCount=t}getNodeGroupingCount(){return this.nodeGroupinCount}updateGroupLayer(t,e){this.groupLayer.updateElements(t||this.ogma.getNodes()),this.groupLayer.updateElements(e||this.ogma.getEdges())}closeGroup(t,e,s,i,n=!1){const r=[e],o=this.closeGroups.has(t._index)||this.collapsedGroups.has(t._index);this.openGroups.delete(t._index),this.closeGroups.add(t._index),n?this.fadedGroups.add(t._index):this.fadedGroups.delete(t._index),this.hasUpdated.add(t._index);const a=this.module.animations,l=n?0:a.getCloseRadius(t._index),d=a.getOpenRadius(t._index);if(d!==void 0&&!o&&this.openRadius.set(t._index,d),a.setXYR(t._index,s,i,l),n)return;for(;r.length;){const u=r.shift(),c=u._indexes,g=u.getAdjacentEdges({bothExtremities:!0}),m=new Set;for(let p=0;p<g._indexes.length;p++)m.add(g._indexes[p]);const f=u.getAdjacentEdges({bothExtremities:!1}).filter(p=>!m.has(p._index));a.setXYR(c,s,i,l),a.hideNodesAfter(c),a.hideEdgesAfter(g._indexes),a.hideEdgesAfter(f._indexes),a.pushAfter(()=>{const p=[];a.deleteOpenRadius(t._index);for(let _=0;_<c.length;_++){const y=this.closeGroups.has(c[_]);p.push(y?l:this.openRadius.get(c[_]))}this.module.animations.setRs(u._indexes,p)});for(let p=0;p<c.length;p++){if(!this.openGroups.has(c[p]))continue;const _=u.get(p);this.collapsedGroups.add(_._index);const y=this.module.getSubNodes(u.get(p));y.size&&r.push(y)}}const h=this.module.getMetaNode(t);h&&this.openGroups.has(h._index)&&this.layoutController.shouldRelayout.add(h._index)}setGroupXYR(t){const e=this.getGroupXYR(t,this.module.getSubNodes(t),void 0,void 0);e.isGeo?(this.setGeoLatLng(t,e.y,e.x),this.module.animations.setR(t._index,e.radius)):this.module.animations.setXYR(t._index,e.x,e.y,e.radius)}setGeoLatLng(t,e,s){this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.latitudePath,e,{virtual:!0}),this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.longitudePath,s,{virtual:!0})}expandGroup(t,e,s=!1){const i=this.module.animations,n=t.getPosition(),r=this.fadedGroups.has(t._index);s?this.fadedGroups.add(t._index):(this.fadedGroups.delete(t._index),this.openGroups.add(t._index),this.closeGroups.delete(t._index),this.collapsedGroups.delete(t._index)),this.isExpanding.add(t._index),this.hasUpdated.add(t._index);const o=[{subNodes:e,offset:this.getOffset(t._index),isClosed:!1,wasCollapsed:!r}];for(;o.length;){const{subNodes:l,offset:d,isClosed:h,wasCollapsed:u}=o.shift();if((h||u)&&i.pushBefore(()=>l.setAttributes(n,0)),h)continue;const c=l._indexes,g=l.getAdjacentEdges({bothExtremities:!0,filter:"all"});l.setVisible(!0),g.setVisible(!0);for(let m=0;m<c.length;m++){const f=this.closeGroups.has(c[m]);i.setXYR(c[m],n.x+d.x+this.subNodeOffsetX.get(c[m])||0,n.y+d.y+this.subNodeOffsetY.get(c[m])||0,f?this.module.animations.getCloseRadius(c[m]):this.openRadius.get(c[m])),this.collapsedGroups.delete(c[m]);const p=this.module.getSubNodes(l.get(m));p.size&&o.push({subNodes:p,isClosed:f,wasCollapsed:u||this.collapsedGroups.has(c[m]),offset:{x:d.x+this.subNodeOffsetX.get(c[m])||0,y:d.y+this.subNodeOffsetY.get(c[m])||0}})}}const a=this.module.getMetaNode(t);a&&this.openGroups.has(a._index)&&this.layoutController.shouldRelayout.add(a._index),i.setXYR(t._index,n.x,n.y,s?0:this.openRadius.get(t._index))}getOffset(t){return this.collapsedGroups.has(t)&&this.subNodeOffsetX.has(t)?{x:this.subNodeOffsetX.get(t),y:this.subNodeOffsetY.get(t)}:{x:0,y:0}}restorePositions(t,e){const s=t.getPosition(),i=(e=e.filter(o=>!o.isVirtual()))._indexes,n=this.getOffset(t._index),r=[];for(let o=0;o<i.length;o++)r.push({x:n.x+s.x+this.subNodeOffsetX.get(i[o])||0,y:n.x+s.y+this.subNodeOffsetY.get(i[o])||0});e.setAttributes(r,0)}animateChildren(t,e){const s=[{parent:t,position:e}];for(;s.length;){const{parent:i,position:n}=s.shift();if(!i.isNode)continue;const r=this.module.getSubNodes(i);r.size&&r.forEach(o=>{const a=this.subNodeOffsetX.get(o._index)||0,l=this.subNodeOffsetY.get(o._index)||0,d={x:n.x+a,y:n.y+l};this.module.animations.setXY(o._index,d.x,d.y),s.push({parent:o,position:d})})}}addOpenGroup(t){this.openGroups.add(t._index),this.closeGroups.delete(t._index)}isOpen(t){return this.openGroups.has(t._index)}isClose(t){return this.closeGroups.has(t._index)}setPadding(t,e){const s=new Set,i=isNaN(+e),n=e;return t.forEach(r=>{const o=i?n(r):+e;this.padding.get(r._index)!==o&&s.add(r._index),this.padding.set(r._index,o)}),s}getGroupXYR(t,e,s,i){let n,r,o;const a=this.module.animations,l=this.ogma.geo.enabled();if(n=new Array(e.size).fill(0),r=new Array(e.size).fill(0),o=new Array(e.size).fill(0),l){const m=e.getData(this.ogma.modules.geo.latitudePath),f=e.getData(this.ogma.modules.geo.longitudePath);n=[],r=[],o=[];for(let p=0;p<m.length;p++){const{x:_,y}=this.ogma.geo.getMap().project({lat:m[p],lng:f[p]},sl);n.push(_),r.push(y),o.push(2**sl*this.geoRadius.get(e._indexes[p])||10)}}else{const m=this.ogma.modules.graphics.getAttributesManager()._layerController.nodes._currentFlexArrays,f=this.openGroups.has(t._index),p=this.isExpanding.has(t._index),_=f&&!p?m.radius:a.getInputFlexArrays().radius;for(let y=0;y<e.size;y++)n[y]=m.x.get(e._indexes[y]),r[y]=m.y.get(e._indexes[y]),o[y]=_.get(e._indexes[y])}if(s&&i&&s.isNode){const m=s._indexes,f=new Map,p=new Map,_=new Map;for(let x=0;x<m.length;x++){const b=Array.isArray(i)?i[x]:i;!isNaN(b.x)&&f.set(m[x],b.x),!isNaN(b.y)&&p.set(m[x],b.y),!isNaN(b.radius)&&_.set(m[x],b.radius)}const y=e._indexes;for(let x=0;x<y.length;x++)f.has(y[x])&&(n[x]=f.get(y[x])),p.has(y[x])&&(r[x]=p.get(y[x])),_.has(y[x])&&(o[x]=_.get(y[x]))}const d=e._indexes;for(let m=0;m<d.length;m++)!this.closeGroups.has(d[m])&&!this.collapsedGroups.has(d[m])&&this.openRadius.has(d[m])&&(o[m]=this.openRadius.get(d[m]));if(!l)for(let m=0;m<d.length;m++)a.xs.get(d[m])!==void 0&&(n[m]=a.xs.get(d[m])),a.ys.get(d[m])!==void 0&&(r[m]=a.ys.get(d[m])),a.rs.get(d[m])!==void 0&&(o[m]=a.rs.get(d[m]));let h=0,u=0,c=0;const g=mA.algorithms.minDisk(n,r,o);if(h=g[0],u=g[1],c=g[2],c+=this.padding.get(t._index)||0,l){const{lat:m,lng:f}=this.ogma.geo.getMap().unproject({x:h,y:u},sl);h=f,u=m,c/=2**sl,this.geoRadius.set(t._index,c),c*=2**this.ogma.geo.getZoom()}else this.openRadius.set(t._index,c),e.forEach((m,f)=>{this.subNodeOffsetX.set(m._index,n[f]-h),this.subNodeOffsetY.set(m._index,r[f]-u)});return{x:h,y:u,radius:c,isGeo:l}}async onAfterLayouts(){const t=this.module.animations,e=this.module.getList().filter(r=>r.getName()===Ze.NodeGrouping&&r.isEnabled()),s=[];let i=!1;for(let r=e.length-1;r>=0;r--)e[r].getContext().metaNodes.forEach(o=>{if(o.getMetaNode())return;i||(i=this.hasUpdated.has(o._index)||this.layoutController.relayouted.has(o._index)||this.layoutController.shouldRelayout.has(o._index));const a=!this.collapsedGroups.has(o._index)&&!this.closeGroups.has(o._index);s.push({group:o,collapsed:!a})});if(i||this.shouldRunGroupUpdate){this.shouldRunGroupUpdate=!1;const r=this.ogma.getNodes().filter(a=>{const l=this.module.getMetaNode(a);return!l||!this.module.nodeToTransformation.get(l._index).isEnabled()}),o=new Array(r.size);for(let a=0;a<r.size;a++)o[a]=this.openRadius.get(r._indexes[a])||this.module.animations.getCloseRadius(r._indexes[a])||0;await this.layoutController.handleGlobalLayout(r,o)}const n=new Set;for(;s.length;){const{group:r,collapsed:o}=s.shift();if(n.has(r._index))continue;n.add(r._index);const a=this.module.getSubNodes(r),l=a._indexes,d=t.xs.get(r._index),h=t.ys.get(r._index);if(d!==void 0&&h!==void 0){if(o){t.deleteOpenRadius(r._index);for(let u=0;u<l.length;u++)t.setXY(l[u],d,h)}else for(let u=0;u<l.length;u++)t.setXY(l[u],d+this.subNodeOffsetX.get(l[u])||0,h+this.subNodeOffsetY.get(l[u])||0);for(let u=0;u<l.length;u++)this.module.isVirtual(l[u],!0)&&s.push({group:a.get(u),collapsed:this.collapsedGroups.has(l[u])||this.closeGroups.has(l[u])||o})}}this.hasUpdated.clear(),this.layoutController.clear(),this.isExpanding.clear()}cleanup(t,e,s){let i=t._indexes;for(let n=0;n<i.length;n++)this.padding.delete(i[n]),this.openGroups.delete(i[n]),this.closeGroups.delete(i[n]),this.nodeLayer.delete(i[n]),this.savedNodeLayer.delete(i[n]),this.savedEdgeLayer.delete(i[n]);for(let n=0;n<e.size;n++)this.edgeLayer.delete(e._indexes[n]);if(s){i=s._indexes;for(let n=0;n<i.length;n++)this.subNodeOffsetX.delete(i[n]),this.subNodeOffsetY.delete(i[n])}}getPositions(t,e){const{x:s,y:i}=t.getPosition();return e.map(n=>({x:s+(this.subNodeOffsetX.get(n._index)||0),y:i+(this.subNodeOffsetY.get(n._index)||0)}))}hideSubNodes(t){const e=[t];for(;e.length;){const s=e.pop();s.setVisible(!1);for(let i=0;i<s._indexes.length;i++)this.collapsedGroups.add(s._indexes[i]),this.openGroups.has(s._indexes[i])&&e.push(this.module.getSubNodes(s.get(i)))}}onRemove(t,e){if(!e)return;const s=[],i=new Set;for(let n=0;n<t.length;n++){const r=this.module.nodeToMeta.get(t[n]);if(!r)continue;const o=r._index;this.openRadius.delete(o),this.isExpanding.delete(o),this.alreadyGrouped.delete(o),this.collapsedGroups.delete(o),this.closeGroups.delete(o),this.openGroups.delete(o),this.padding.delete(o),this.geoRadius.delete(o),this.hasUpdated.delete(o),this.subNodeOffsetX.delete(o),this.subNodeOffsetY.delete(o),this.nodeLayer.delete(o),this.edgeLayer.delete(o),this.savedNodeLayer.delete(o),this.savedEdgeLayer.delete(o),this.openGroups.has(o)&&(this.layoutController.shouldRelayout.add(o),s.push(o))}for(;s.length;){const n=s.shift();if(i.has(n))continue;i.add(n);const r=this.module.nodeToMeta.get(n);r&&this.openGroups.has(r._index)&&(this.layoutController.shouldRelayout.add(r._index),s.push(r._index))}}async fishEyeExpand(t,e,s){if(!t.isVirtual())throw new Error("Focus node is not virtual.");const i=this.module.nodeToMeta.get(t._index);if(i&&i.isVisible())throw new Error("Focus node is not at top level.");const n=this.module.animations,r=this.ogma,o=n.getCloseRadius(t._index);s&&(this.layoutController.setNextLayout(t._index,s),this.layoutController.shouldRelayout.add(t._index)),this.layoutController.setNextOnGroupUpdate(async a=>{const l=n.getXYR(t.toList())[0].radius-o,d=n.getXYR(a);return await r.algorithms.fishEyeExpand({nodes:a,focusNode:t,dryRun:!0,deltaRadius:l,xyr:d})}),await e(),await this.module.afterNextUpdate()}setNodeLayer(t,e){this.nodeLayer.set(t,e),this.savedNodeLayer.set(t,e)}setEdgeLayer(t,e){this.edgeLayer.set(t,e),this.savedEdgeLayer.set(t,e)}async fishEyeCollapse(t,e){if(!t.isVirtual())throw new Error("Focus node is not virtual.");const s=this.module.nodeToMeta.get(t._index);if(s&&s.isVisible())throw new Error("Focus node is not at top level.");const i=this.module.animations,n=this.ogma,r=t.getAttribute("radius");this.layoutController.setNextOnGroupUpdate(async o=>{const a=i.getXYR(t.toList())[0].radius-r,l=i.getXYR(o);return await n.algorithms.fishEyeExpand({nodes:o,focusNode:t,dryRun:!0,deltaRadius:a,xyr:l})}),await e(),await this.module.afterNextUpdate()}triggerGroupsUpdate(){this.shouldRunGroupUpdate=!0}layoutGroups(t,e,s=!1){return this.runningLayouts=!0,this.layoutController.layoutGroups(t,e,s).finally(()=>{this.runningLayouts=!1})}_onToggleGeo(){this.geoRadius.clear();const t=this.module.getList().find(s=>s.getName()===Ze.NodeGrouping);if(!t)return;const e=Array.from(this.openGroups.keys());for(let s=0;s<e.length;s++)this.layoutController.shouldRelayout.add(e[s]);t.refresh()}startRefresh(){this.alreadyGrouped.clear()}clear(){this.subNodeOffsetX.clear(),this.subNodeOffsetY.clear(),this.openRadius.clear(),this.isExpanding.clear(),this.layoutController.clear(),this.alreadyGrouped.clear(),this.openGroups.clear(),this.closeGroups.clear(),this.nodeLayer.clear(),this.edgeLayer.clear(),this.padding.clear(),this.geoRadius.clear(),this.collapsedGroups.clear(),this.hasUpdated.clear()}destroy(){this.destroyed||(this.destroyed=!0,this.ogma.events.off(this.onSetMultipleAttributes))}},zD=class{constructor(t){this.ogma=t}save(){this.selectedNodes=this.ogma.getSelectedNodes(),this.selectedEdges=this.ogma.getSelectedEdges(),this.ogma.modules.selection.disableEvents()}restore(){const t=this.selectedNodes.filter(n=>!this.ogma.getNode(n.getId())),e=this.selectedEdges.filter(n=>!this.ogma.getEdge(n.getId())),s=new Set,i=new Set;if(t.size){this.ogma.modules.events.fire("nodesUnselected",{nodes:t});for(let n=0;n<t.size;n++)s.add(t._indexes[n])}if(e.size){this.ogma.modules.events.fire("edgesUnselected",{edges:e});for(let n=0;n<e.size;n++)i.add(e._indexes[n])}this.selectedNodes.filter(n=>!n.isSelected()&&!s.has(n._index)).setSelected(!0),this.selectedEdges.filter(n=>!n.isSelected()&&!i.has(n._index)).setSelected(!0),this.ogma.modules.selection.enableEvents()}cleanup(){this.selectedNodes=void 0,this.selectedEdges=void 0,this.ogma.modules.selection.enableEvents&&this.ogma.modules.selection.enableEvents()}},DD={setData:!1,addElement:!0,removeElement:!0,setOptions:!1,refresh:!1},OD=class sc{constructor(){this.prev={},this.next={},this.prevorder=[],this.nextorder=[],this.shouldAnimate=!1,this.minRefreshIndex=0}addTransformation(e,s){this.next[e]=s,this.nextorder.push(e)}removeTransformation(e){delete this.next[e]}setIndex(e,s){const i=this.nextorder.indexOf(e);this.nextorder.splice(i,1),this.nextorder.splice(s,0,e),this.minRefreshIndex=Math.min(this.minRefreshIndex,i,s)}setEnabled(e,s){this.next[e]=s}isEnabled(e){return this.prev[e]||!1}static getDiff(e,s){const i=new Map;for(const n in e)s[n]!==void 0?s[n]!==e[n]&&i.set(+n,{shouldDo:s[n],shouldUndo:e[n]}):i.set(+n,{shouldDo:!1,shouldUndo:e[n],shouldCleanup:!0});for(const n in s)e[n]===void 0&&s[n]===!0&&i.set(+n,{shouldDo:!0,shouldUndo:!1});return i}getFirstChange(e){const{nextorder:s}=this;let i=s.length;for(let n=0;n<s.length;n++){const r=e.get(s[n]);if(r&&(r.shouldUndo||r.shouldDo)){i=n;break}}return i}refreshFrom(e,s){const{nextorder:i}=this;for(let n=s;n<this.nextorder.length;n++)e.set(i[n],{shouldUndo:this.prev[i[n]],shouldDo:this.prev[i[n]],...e.get(i[n])||{}});return e}isDirty(){const e=sc.getDiff(this.prev,this.next),s=Math.min(this.minRefreshIndex,this.getFirstChange(e));return(e.size>0||s<this.nextorder.length)&&{reason:e.size>0?"diff":"refresh",index:s}}invalidateFrom(e,s){this.shouldAnimate||(this.shouldAnimate=DD[s]),this.minRefreshIndex=Math.min(this.minRefreshIndex,e)}step(){const e=sc.getDiff(this.prev,this.next);this.prev={...this.next};const s=Math.min(this.minRefreshIndex,this.getFirstChange(e)),i=this.nextorder.reduce((o,a,l)=>o.set(a,l),new Map),n=this.prevorder.reduce((o,a,l)=>o.set(a,l),new Map);this.nextorder=this.nextorder.filter(o=>this.prev[o]!==void 0),this.prevorder=[...this.nextorder],this.minRefreshIndex=this.nextorder.length;const r=this.shouldAnimate;return this.shouldAnimate=!1,{diff:this.refreshFrom(e,s),nextorder:i,prevorder:n,shouldAnimate:r}}done(){}},kD=class{constructor(t){this.transformations=[],this.addingGraph=!1,this.addingElements=!1,this.nodeToTransformation=new Map,this.edgeToTransformation=new Map,this.nodeVirtual=new Set,this.edgeVirtual=new Set,this.nodeToMeta=new Map,this.edgeToMeta=new Map,this.metaToNodes=new Map,this.metaToEdges=new Map,this._onDestroy=()=>{this.destroy()},this._onAddElements=({nodes:e,edges:s,virtual:i})=>{if(i){if(e)for(let n=0;n<e.size;n++)this.nodeVirtual.add(e._indexes[n]);if(s)for(let n=0;n<s.size;n++)this.edgeVirtual.add(s._indexes[n])}else this.addingGraph||this.addingElements||(this.state.invalidateFrom(0,"addElement"),this.invalidate())},this._onSetData=({elements:e,virtual:s})=>{if(s)return;const{isNode:i,_indexes:n}=e;let r=1/0;for(const o of n){const a=this.getTransformation(o,i);if(!a){r=0;break}r=Math.min(r,a.getIndex())}return this.state.invalidateFrom(r,"setData"),this.invalidate(),r},this._onRequestElementsToDelete=e=>{const{elementsToRemove:s}=e,i=s.isNode,n=s._indexes,r=this.getLeafElements(n,i);e.elementsToRemove=i?this.ogma.nodeList(r):this.ogma.edgeList(r)},this._onAfterRemoveElements=({nodes:e,edges:s})=>{if(!this.ogma.isDestroyed()){if(e)for(let i=0;i<e.size;i++)this.nodeVirtual.delete(e._indexes[i]);if(s)for(let i=0;i<s.size;i++)this.edgeVirtual.delete(s._indexes[i])}},this._onRemoveElements=({nodes:e,edges:s,virtual:i})=>{i||this.ogma.isDestroyed()||this._refreshPromise.then(()=>{const n=!!e,r=n?e._indexes:s._indexes,o=new Set(r);this.transformations.forEach(a=>a.onRemove(o,n)),this.groupController.onRemove(r,n),this.drilldownController.onRemove(o,n),n?(this.nodeToMeta.clear(),this.metaToNodes.clear(),this.nodeToTransformation.clear()):(this.edgeToMeta.clear(),this.metaToEdges.clear(),this.edgeToTransformation.clear()),this.state.invalidateFrom(0,"removeElement"),this.invalidate()})},this._onClearGraph=()=>{this.transformations.forEach(e=>{e.cleanup()}),this.groupController.clear(),this.nodeToMeta.clear(),this.edgeToMeta.clear(),this.metaToNodes.clear(),this.metaToEdges.clear(),this.nodeToTransformation.clear(),this.edgeToTransformation.clear(),this.state.invalidateFrom(0,"removeElement"),this.invalidate()},this.ogma=t,this.state=new OD,this.animations=new SD(t),this._shouldRefresh=!1,this._refreshing=!1,this.isDestroyed=!1,this.isPaused=!1,this.selection=new zD(t),this._refreshPromise=Promise.resolve(),this.groupController=new PD(t,this),this.drilldownController=new MD(this),this.ogma.events.on("setData",this._onSetData).on("preAddGraph",()=>{this.addingGraph=!0}).on("postAddGraph",()=>{this.addingGraph=!1,this.state.invalidateFrom(0,"addElement"),this.invalidate()}).on("preAddElements",({virtual:e})=>{e||this.addingGraph||(this.addingElements=!0)}).on("postAddElements",({virtual:e})=>{e||this.addingGraph||(this.addingElements=!1,this.state.invalidateFrom(0,"addElement"),this.invalidate())}).on(["addNodes","addEdges"],this._onAddElements).on(["removeNodes","removeEdges"],this._onRemoveElements).on("clearGraph",this._onClearGraph).on(["afterRemoveNodes","afterRemoveEdges"],this._onAfterRemoveElements).on("requestElementsToDelete",this._onRequestElementsToDelete).on("destroy",this._onDestroy)}addTransformation(t,e=!0){this.state.addTransformation(t.getId(),e),this.transformations.push(t),this.invalidate()}removeTransformation(t){const e=this.transformations.indexOf(t);e!==-1&&this.transformations.splice(e,1),this.invalidate()}async step(t=0,e={fireEnabled:[],fireDisabled:[],fireRefresh:[],fireDestroy:[],fireSetIndex:[]}){var s;if(t>5)throw new Error("Ogma transformations: Transformations refresh in loop");const{diff:i,prevorder:n,nextorder:r}=this.state.step(),{fireEnabled:o,fireDisabled:a,fireRefresh:l,fireDestroy:d,fireSetIndex:h}=e,u=[],c=[],g=[];this.groupController.startRefresh();for(const f of this.transformations){const p=f.getId();if(!i.has(p))continue;const{shouldDo:_,shouldUndo:y,shouldCleanup:x}=i.get(p);_&&!y?o.push(f):y&&!_?a.push(f):_&&y&&l.push(f),n.has(p)&&n.get(p)!==r.get(p)&&h.push(f),y&&u.push(f),_&&c.push(f),x&&(d.push(f),g.push(f))}let m=0;u.sort((f,p)=>n.get(p.getId())-n.get(f.getId())||0);for(const f of u){const p=!((s=i.get(f.getId()))!=null&&s.shouldDo);p&&(m=this.animations.getMaxAnimation(m,f.getAnimation())),await f.undo(p)}c.sort((f,p)=>r.get(f.getId())-r.get(p.getId())||0),this.ogma.modules.graphics.pauseRendering();for(let f=0;f<c.length;f++){const p=c[f],_=f===c.length-1;_&&(m=this.animations.getMaxAnimation(m,p.getAnimation())),await p.run(_)}for(const f of g)await f.cleanup();if((u.length||c.length||g.length)&&(this.groupController.updateGroupLayer(),await this.groupController.onAfterLayouts()),this.ogma.modules.graphics.resumeRendering(),await this.animations.apply(m),!this.isDestroyed)return this.state.isDirty()?this.step(t+1,e):e}refresh(){this.isDestroyed||this.ogma.isDestroyed()||!this._shouldRefresh||!this.transformations.length||this._refreshing||this.addingGraph||this.addingElements||this.isPaused||(this._shouldRefresh=!1,this._refreshing=!0,this._refreshPromise=this._refreshPromise.then(()=>(this.selection.save(),this.step().then(t=>{this._refreshing=!1;const{fireEnabled:e,fireDisabled:s,fireRefresh:i,fireDestroy:n,fireSetIndex:r}=t,o=this.ogma.modules.events;s.reverse().forEach(a=>o.fire("transformationDisabled",{target:a})),e.forEach(a=>o.fire("transformationEnabled",{target:a})),r.forEach(a=>o.fire("transformationSetIndex",{target:a})),i.forEach(a=>o.fire("transformationRefresh",{target:a})),n.forEach(a=>o.fire("transformationDestroyed",{target:a}))}).finally(()=>{this.selection.restore(),this.selection.cleanup(),this.ogma.modules.graphics.resumeRendering()}))).catch(t=>{const e=this.state.isDirty();if(!e)throw new Error(`Ogma transformations, refresh failed.
${t.stack}`);const s=e.reason==="diff"?"You are constantly adding/removing/changing index of a transformation":"You are constantly adding/removing/updating nodes or edges while transformations refresh";throw new Error(`Ogma transformations, refresh failed.
${s}`)}).catch(t=>{if(!this.onRefreshError)throw t;this.onRefreshError(t)}).finally(()=>{}))}enable(t){return this.state.setEnabled(t.getId(),!0),this.invalidate(),this.afterNextUpdate()}disable(t){return this.state.setEnabled(t.getId(),!1),this.invalidate(),this.afterNextUpdate()}remove(t){return this.disable(t),this.state.removeTransformation(t.getId()),this.afterNextUpdate().then(()=>{this.transformations.splice(this.getIndex(t),1)})}isEnabled(t){return this.state.isEnabled(t.getId())}getList(){return this.transformations.slice()}getIndex(t){for(let e=0;e<this.transformations.length;e++)if(this.transformations[e]===t)return e;return-1}setIndex(t,e){const s=this.getIndex(t);this.state.setIndex(t.getId(),e),this.transformations.splice(s,1),this.transformations.splice(e,0,t),this.invalidate()}setOptions(t){this.state.invalidateFrom(this.getIndex(t),"setOptions"),this.invalidate()}refreshTransformation(t){this.state.invalidateFrom(this.getIndex(t),"refresh"),this.invalidate()}clear(){return this.transformations.forEach(t=>t.destroy(0)),this.invalidate(),this.afterNextUpdate()}destroy(){this.transformations.forEach(t=>t.destroy(0)),this.groupController.destroy(),this._refreshPromise=Promise.resolve(),this.isDestroyed=!0}invalidate(){this.ogma.isDestroyed()||(this._shouldRefresh=!0,this.ogma.modules.dom.refresh(),this.ogma.modules.dom.onNextFrame().then(()=>{this.refresh()}))}afterNextUpdate(){return this.ogma.view.afterNextFrame().then(()=>this._refreshPromise)}getTransformation(t,e){return e?this.nodeToTransformation.get(t):this.edgeToTransformation.get(t)}setTransformation(t,e,s){s?this.nodeToTransformation.set(t,e):this.edgeToTransformation.set(t,e)}deleteTransformation(t){const e=t.isNode?this.nodeToTransformation:this.edgeToTransformation,s=t._indexes;for(const i of s)e.delete(i)}setMetaNode(t,e){this.nodeToMeta.set(t,e)}setSubNodes(t,e){this.metaToNodes.set(t,e)}removeMetaNodes(t){const e=t._indexes;for(const s of e){const i=this.metaToNodes.get(s);i&&i.forEach(n=>this.nodeToMeta.delete(n._index)),this.nodeToTransformation.delete(s),this.metaToNodes.delete(s)}}removeMetaEdges(t){const e=t._indexes;for(const s of e){const i=this.metaToEdges.get(s);i&&i.forEach(n=>this.edgeToMeta.delete(n._index)),this.edgeToTransformation.delete(s),this.metaToEdges.delete(s)}}clearSubNodes(t){this.metaToNodes.delete(t)}clearMetaNode(t){this.nodeToMeta.delete(t)}setMetaEdge(t,e){this.edgeToMeta.set(t,e)}setSubEdges(t,e){this.metaToEdges.set(t,e)}clearSubEdges(t){this.metaToEdges.delete(t)}clearMetaEdge(t){this.edgeToMeta.delete(t)}getMetaNode(t){return this.nodeToMeta.get(t._index)||null}getMetaEdge(t){return this.edgeToMeta.get(t._index)||null}getLeafElements(t,e){const s=[t],i=e?this.metaToNodes:this.metaToEdges,n=[];for(;s.length;){const r=s.pop();for(let o=0;o<r.length;o++){n.push(r[o]);const a=i.get(r[o]);a&&s.push(a._indexes)}}return n}getSubElements(t){const e=t.isNode?this.metaToNodes:this.metaToEdges,s=t.toList()._indexes;let i=0;for(let o=0;o<s.length;o++){const a=e.get(s[o]);a&&(i+=a.size)}const n=new Uint32Array(i);let r=0;for(let o=0;o<s.length;o++){const a=e.get(s[o]);if(a)for(let l=0;l<a.size;l++)n[r++]=a._indexes[l]}return t.isNode?this.ogma.nodeList(n):this.ogma.edgeList(n)}getSubNodes(t){return this.getSubElements(t)}getSubEdges(t){return this.getSubElements(t)}getById(t){return this.transformations.find(e=>e.getId()===t)}isIntraEdge(t){const e=t.getSource()._index;return this.nodeToMeta.has(e)&&this.nodeToMeta.get(e)===this.nodeToMeta.get(t.getTarget()._index)}isVirtual(t,e){return e?this.nodeVirtual.has(t):this.edgeVirtual.has(t)}isRefreshing(){return this._refreshing}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.refresh()}},ts="_transparent",Sr=t=>!0,BD=()=>{};function fA(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach((s,i)=>e.push(i)),e}function ud(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach(s=>e.push(s)),e}function l_(t){return!(!t||t.constructor!==Object&&t.constructor)}var yn=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)i.hasOwnProperty(n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):l_(e[n])&&l_(i[n])?e[n]=yn(e[n],i[n]):e[n]=i[n])}return e};function UD(t){return Array.isArray(t)?t:[t]}var ic=()=>!0,pA=()=>!1,GD=()=>null,VD=class extends en{constructor(t){super(t),this.nodeSelector=t.criteria||Sr}setOptions(t){return this.nodeSelector=t.criteria||this.nodeSelector,super.setOptions(t)}getName(){return Ze.NodeFilter}run(){const t=this.nodeSelector,e=this.ogma.getNodes().filter(a=>!t||!t(a)),s=e.getAdjacentEdges();this.module.animations.hideNodes(e._indexes),this.module.animations.hideEdges(s._indexes),e.setVisible(!1),s.setVisible(!1);const i=e.subtract(this.context.hiddenNodes),n=s.subtract(this.context.hiddenEdges),r=this.context.hiddenNodes.subtract(e),o=this.context.hiddenEdges.subtract(s);return this.module.animations.pushBefore(()=>{r.setVisible(!0),r.setVisible(!0),n.setVisible(!0),i.setVisible(!0),r.addClass(ts),o.addClass(ts)}),this.module.animations.push(()=>Promise.all([o.removeClass(ts,this.animation),r.removeClass(ts,this.animation),i.addClass(ts,this.animation),n.addClass(ts,this.animation)])),this.context={...this.context,hiddenNodes:e,hiddenEdges:s},Promise.resolve()}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s}=this.context,i=t?this.animation:0;return e.setExcluded(!1),s.setExcluded(!1),t&&(e.addClass(ts),s.addClass(ts),this.module.animations.push(()=>Promise.all([e.removeClass(ts,i),s.removeClass(ts,i)])),this.context.hiddenNodes=this.ogma.nodeList(),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e?this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index)):this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}resetContext(){this.context={...this.context,hiddenEdges:this.ogma.edgeList(),hiddenNodes:this.ogma.nodeList()}}},qD=class extends en{constructor(t){super(t),this.edgeSelector=t.criteria||Sr}setOptions(t){return this.edgeSelector=t.criteria||this.edgeSelector,super.setOptions(t)}getName(){return Ze.EdgeFilter}run(){const t=this.edgeSelector,e=this.ogma.getEdges().filter(r=>!t||!t(r)),s=this.module.animations;e.setVisible(!1);const i=e.subtract(this.context.hiddenEdges),n=this.context.hiddenEdges.subtract(e);return this.module.animations.pushBefore(()=>{i.setVisible(!0),n.setVisible(!0),n.addClass(ts)}),s.hideEdges(e._indexes),s.push(()=>Promise.all([n.removeClass(ts,this.animation),i.addClass(ts,this.animation)])),this.context={...this.context,hiddenEdges:e},Promise.resolve()}undo(t=!0){super.undo(t);const{hiddenEdges:e}=this.context,s=t?this.animation:0;return e.setExcluded(!1),t&&(e.addClass(ts),this.module.animations.push(()=>Promise.all([e.removeClass(ts,s)])),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e||(this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index)))}resetContext(){this.context={...this.context,hiddenEdges:this.ogma.edgeList()}}},Ie="_faded",jD=class extends en{constructor(t){super(t),this.selector=t.selector||pA,this.dataFunction=t.dataFunction||BD}getName(){return Ze.NeighborMerging}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=[],r=new Map;for(let c=0;c<i.size;++c){const g=i.get(c),m=g.getAdjacentEdges(),f=this.dataFunction(g);for(let p=0;p<m.size;++p){const _=m.get(p),y=_.getSource(),x=_.getTarget();if(y!==x&&f!==void 0){const b=y===g?x:y;let v=r.get(b);v||(v=[],r.set(b,v)),v.push(f)}n.push(_)}}const o=e.getEdges(n),a=e.getNodes(fA(r)),l=ud(r),d=a.getData(),h=new Array(a.size);for(let c=0;c<h.length;++c){const g=l[c];let m=d[c];for(let f=0;f<g.length;++f)m=yn(m,g[f]);h[c]=m}const u=this.module.animations;return u.hideNodes(i._indexes),u.hideEdges(o._indexes),u.push(()=>Promise.all([i.addClass(Ie,s),o.addClass(Ie,s)]).then(()=>{this.ogma.modules.data.setProperty(a,null,h,{dispatch:!0,virtual:!0})})),this.context={...this.context,hiddenNodes:i,hiddenEdges:o,nodesWithDataChange:a,oldDataList:d},Promise.resolve()}resetContext(){super.resetContext(),this.context={...this.context,hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),nodesWithDataChange:this.ogma.nodeList(),oldDataList:[]}}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,nodesWithDataChange:i,oldDataList:n}=this.context,r=t?this.animation:0,o=this.module.animations;return this.context.hiddenEdges=this.ogma.edgeList(),this.context.hiddenNodes=this.ogma.nodeList(),this.context.nodesWithDataChange=this.ogma.nodeList(),this.context.oldDataList=[],e.setVisible(!0),s.setVisible(!0),o.pushBefore(()=>{e.addClass(Ie),s.addClass(Ie)}),o.push(()=>Promise.all([e.removeClass(Ie,r),s.removeClass(Ie,r)]).then(()=>{this.ogma.modules.data.setProperty(i,null,n,{dispatch:!0,virtual:!0})})),Promise.resolve()}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index))),this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}cleanup(){return Promise.resolve()}setOptions(t){return this.selector=t.selector||this.selector,this.dataFunction=t.dataFunction||this.dataFunction,super.setOptions(t)}};function YD(t){return t!=null}var HD=(t,e)=>({source:t.getId(),target:e.getId()}),XD=class extends en{constructor(t){super(t);const{selector:e=ic,neighborIdFunction:s=GD,nodeGenerator:i=()=>({}),edgeGenerator:n=HD}=t;this.neighborIdFunction=s,this.selector=e,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i,this.edgeGenerator=n}getName(){return Ze.NeighborGeneration}run(t=!0){const{ogma:e,id:s}=this,i=t?this.animation:0,n=e.getNodes(),r=new Map;for(let c=0;c<n.size;++c){const g=n.get(c),m=($D(this.generateIds(g))||[]).filter(YD);if(m)for(const f of m){let p=r.get(f);p||(p=[],r.set(f,p)),p.push(g)}}const o=new Array(r.size),a=[],l=fA(r),d=ud(r).map(c=>e.getNodes(c));for(let c=0;c<o.length;++c){const g=l[c],m=d[c],f=this.nodeGenerator(g,m);f.id=`_gen_${s}_${g}`;const p=wD(m.getPosition());f.attributes=f.attributes||{},f.attributes.x=p.x,f.attributes.y=p.y,o[c]=f}let h,u;return e.addNodes(o.map(c=>({id:c.id,attributes:c.attributes})),{virtual:!0}).then(()=>{h=e.getNodes(o.map(g=>g.id));const c=h._indexes;this.context.virtualNodes&&this.module.removeMetaNodes(this.context.virtualNodes);for(let g=0;g<h.size;g++)this.module.setTransformation(c[g],this,!0),this.module.setSubNodes(c[g],this.ogma.createNodeList());h.replaceOriginalAttributes(o.map(g=>g.attributes),["x","y"]),this.ogma.modules.data.setProperty(h,null,o.map(g=>g.data),{dispatch:!0,virtual:!0});for(let g=0;g<h.size;++g){const m=h.get(g),f=d[g];for(let p=0;p<f.size;++p){const _=f.get(p),y=this.edgeGenerator(_,m);!y.source&&!y.target&&(y.source=_.getId(),y.target=m.getId()),y.id||(y.id=`${y.source}-${y.target}`),a.push(y)}}return e.addEdges(a,{virtual:!0})}).then(()=>{u=e.getEdges(a.map(g=>g.id));const c=u._indexes;this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);for(let g=0;g<u.size;g++)this.module.setTransformation(c[g],this,!1),this.module.setSubEdges(c[g],this.ogma.createEdgeList());this.context={virtualEdges:u,virtualNodes:h},e.removeNodes(this.context.virtualNodes.subtract(h),{virtual:!0}),e.removeEdges(this.context.virtualEdges.subtract(u),{virtual:!0}),h.setVisible(!0),u.setVisible(!0),this.module.animations.pushBefore(()=>{h.addClass(Ie),u.addClass(Ie)}),this.module.animations.push(()=>Promise.all([h.removeClass(Ie,i),u.removeClass(Ie,i)]))})}undo(t=!0){const{virtualNodes:e,virtualEdges:s}=this.context;if(!s||!e)return Promise.resolve(this.context);const i=t?this.animation:0,n=this.module.animations;t?(n.hideNodes(e._indexes),n.hideEdges(s._indexes),n.push(()=>Promise.all([e.addClass(Ie,i),s.addClass(Ie,i)]))):(e.setVisible(!1),s.setVisible(!1))}onRemove(){}cleanup(){const{virtualEdges:t,virtualNodes:e}=this.context;return t&&e&&(this.module.removeMetaNodes(e),this.module.removeMetaEdges(t),this.ogma.removeNodes(e,{virtual:!0}),this.ogma.removeEdges(t,{virtual:!0}),this.context.virtualEdges=this.ogma.edgeList(),this.context.virtualNodes=this.ogma.nodeList()),Promise.resolve()}setOptions(t){const{selector:e,neighborIdFunction:s,nodeGenerator:i,edgeGenerator:n}=t;return this.selector=e||this.selector,this.neighborIdFunction=s||this.neighborIdFunction,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i||this.nodeGenerator,this.edgeGenerator=n||this.edgeGenerator,super.setOptions(t)}resetContext(){super.resetContext(),this.context={...this.context,virtualNodes:this.ogma.nodeList(),virtualEdges:this.ogma.edgeList()}}};function $D(t){return Array.isArray(t)?t:t?[t]:null}function WD(t,e){return t.size===e.size&&t.filter(s=>e.includes(s)).size>0}var ZD=class extends en{constructor(t){super(t),this.selector=t.selector||pA,this.edgeGenerator=t.edgeGenerator||(()=>({}))}getName(){return Ze.NodeCollapsing}resetContext(){this.context={hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),virtualEdges:this.ogma.edgeList()}}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=i.getAdjacentEdges(),r=[],o=i.map(l=>l.getAdjacentNodes().filter(d=>!this.selector(d)));for(let l=0;l<i.size;l++)for(let d=l;d<i.size;d++){const h=i.get(l),u=i.get(d);if(this.ogma.modules.graph.getEdgesBetweenTwoNodes(h,u).size>0&&(o[l].size||o[d].size)&&!WD(o[l],o[d]))throw Error(`addNodeCollapsing: invalid connected nodes [${h.getId()}] and [${u.getId()}] to be collapsed. The addNodeCollapsing function supports only disconnected nodes.`)}const a=new Map;for(let l=0;l<i.size;++l){const d=i.get(l),h=o[l];for(let u=0;u<h.size-1;++u){const c=h.get(u),g=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,c);if(c!==d)for(let m=u+1;m<h.size;++m){const f=h.get(m),p=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,f),_=this.edgeGenerator(d,c,f,g,p);if(_){const y=UD(_);for(let x=0;x<y.length;++x)r.push(KD(e,y[x],x,d,c,f,g,p)),a.set(r[r.length-1].id,g.concat(p))}}}}return e.addEdges(r,{virtual:!0}).then(()=>{const l=this.ogma.getEdges(r.map(u=>u.id));this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);const d=l._indexes;for(let u=0;u<l.size;u++){this.module.setTransformation(d[u],this,!1);const c=a.get(l.get(u).getId());this.module.setSubEdges(d[u],c);for(let g=0;g<c.size;g++)this.module.setMetaEdge(c._indexes[g],l.get(u))}e.removeEdges(this.context.virtualEdges.subtract(l),{virtual:!0});const h=this.module.animations;l.setVisible(!0),h.pushBefore(()=>l.addClass(Ie)),h.push(()=>Promise.all([l.removeClass(Ie,s),i.addClass(Ie,s),n.addClass(Ie,s)])),h.hideNodes(i._indexes),h.hideEdges(n._indexes),this.context={hiddenEdges:n,hiddenNodes:i,virtualEdges:l}})}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,virtualEdges:i}=this.context,n=t?this.animation:0,r=this.module.animations;return e.setVisible(!0),s.setVisible(!0),t?(r.hideEdges(i._indexes),r.pushBefore(()=>Promise.all([e.addClass(Ie),s.addClass(Ie)])),r.push(()=>Promise.all([i.addClass(Ie,n),e.removeClass(Ie,n),s.removeClass(Ie,n)]))):i.setVisible(!1),Promise.resolve()}cleanup(){const t=this.context.virtualEdges||this.ogma.createEdgeList();return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then(()=>{this.resetContext()})}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index))),this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}setOptions(t){return this.selector=t.selector||this.selector,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,super.setOptions(t)}};function KD(t,e,s,i,n,r,o,a){let l,d;if(e.source!==void 0&&(l=t.getNode(e.source),l!==n&&l!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid source [${e.source}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(e.target!==void 0&&(d=t.getNode(e.target),d!==n&&d!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid target [${e.target}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(l&&d&&l===d)throw new Error(`addNodeCollapsing: edge generator produced RawEdge with same source and target [${l.getId()}]`);if(l&&!d)d=l===n?r:n;else if(d&&!l)l=d===n?r:n;else if(!l&&!d){let h=!0;for(let u=0;u<o.size;++u)o.get(u).getSource()===n&&(h=!1);for(let u=0;u<a.size;++u)a.get(u).getTarget()===r&&(h=!1);h?(l=r,d=n):(l=n,d=r)}return l&&d?{...e,id:`_gen_${i.getId()}_${l.getId()}_${d.getId()}_${s}`,source:l.getId(),target:d.getId()}:{}}var QD=class extends en{constructor(t){super(t),this.nodeSelector=t.nodeSelector||ic,this.edgeSelector=t.edgeSelector||ic,this.nodeDataFunction=t.nodeDataFunction||null,this.edgeDataFunction=t.edgeDataFunction||null}getName(){return Ze.VirtualProperties}resetContext(){this.context={nodes:this.ogma.nodeList(),oldNodesData:[],edges:this.ogma.edgeList(),oldEdgesData:[]}}run(){const{ogma:t,context:e}=this;return this.nodeDataFunction&&(e.nodes=t.getNodes().filter(this.nodeSelector),e.oldNodesData=d_(e.nodes,this.nodeDataFunction,this.ogma)),this.edgeDataFunction&&(e.edges=t.getEdges().filter(this.edgeSelector),e.oldEdgesData=d_(e.edges,this.edgeDataFunction,this.ogma)),Promise.resolve()}undo(){const{nodes:t,oldNodesData:e,edges:s,oldEdgesData:i}=this.context,n=this.ogma.modules.data;return t&&n.setProperty(t,null,e,{dispatch:!0,virtual:!0}),s&&n.setProperty(s,null,i,{dispatch:!0,virtual:!0}),Promise.resolve()}onRemove(t,e){e&&(this.context.nodes=this.context.nodes.filter(s=>!t.has(s._index))),this.context.edges=this.context.edges.filter(s=>!t.has(s._index))}cleanup(){return this.resetContext(),Promise.resolve()}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.nodeDataFunction=t.nodeDataFunction||this.nodeDataFunction,this.edgeDataFunction=t.edgeDataFunction||this.edgeDataFunction,super.setOptions(t)}};function d_(t,e,s){const i=[],n=[];for(let r=0;r<t.size;++r){const o=t.get(r),a=o.getData(),l=e(o);n.push(yn(a,l)),i.push(a)}return s.modules.data.setProperty(t,null,n,{dispatch:!0,virtual:!0}),i}var wr=()=>"";function jo(){return{}}var _A=class extends en{constructor(t){super(t),this.nodeSelector=t.nodeSelector||Sr,this.nodeGroupIdFunction=t.nodeGroupIdFunction||wr,this.nodeGenerator=t.nodeGenerator||jo,this.edgeSelector=t.edgeSelector||Sr,this.edgeGroupIdFunction=t.edgeGroupIdFunction||wr,this.edgeGenerator=t.edgeGenerator||jo,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0&&t.separateEdgesByDirection,this.groupSelfLoopEdges=!!t.groupSelfLoopEdges,this.groupEdges=t.groupEdges===void 0||t.groupEdges,this.ogma.events.on("updateNodeData",({changes:e})=>this.checkChanges(e,!0)).on("updateEdgeData",({changes:e})=>this.checkChanges(e,!1))}computeNodeGroupId(t){if(this.nodeGroupIdFunction){if(!this.nodeSelector(t)||this.module.groupController.alreadyGrouped.has(t._index)||this.module.animations.hiddenNodes.has(t._index))return;const e=this.nodeGroupIdFunction(t);return e===void 0?void 0:e}}computeEdgeGroupId(t){if(this.edgeGroupIdFunction)return this.edgeSelector(t)&&!this.module.animations.hiddenEdges.has(t._index)?this.edgeGroupIdFunction(t):void 0}addMetaNodes(){const t=this.id,e=this.ogma,s=e.getNodes(),i=new Map;for(let h=0;h<s.size;++h){const u=s.get(h),c=this.computeNodeGroupId(u);if(c===void 0)continue;let g=i.get(c);g||(g={id:c,nodes:[]},i.set(c,g)),g.nodes.push(u)}const n=Array.from(i.values()),r=n.map(({nodes:h})=>e.getNodes(h)),o=[],a=[],l=new Set,{nodeDataUpdates:d}=this.context;for(let h=0;h<n.length;++h){const u=n[h].id,c=r[h],g=this.nodeGenerator(c,u,this);if(g){if(g.id===void 0&&(g.id=hd(u,t)),l.has(g.id))throw new Error(`Ogma transformations: NodeGrouping ${this.id} is trying to create two different metaNodes with the same id.`);l.add(g.id),a.push(g.id),o.push(g)}else n.splice(h,1),r.splice(h,1),h--}return e.addNodes(o.map(({id:h})=>({id:h})),{virtual:!0}).then(h=>{const u=e.getNodes(a);e.modules.individualAttributes.replaceOriginalAttributes(u,o.map(({attributes:m})=>m));const c=u.getData();for(let m=0;m<c.length;m++){const f=c[m],p=o[m];c[m]=yn(yn(f,p.data),d.get(a[m]))}e.modules.data.setProperty(u,null,c,{dispatch:!0,virtual:!0}),u.setVisible(!0);const g=u._indexes;this.context.metaNodes&&this.module.removeMetaNodes(this.context.metaNodes);for(let m=0;m<g.length;m++){const f=g[m],p=r[m];this.module.setSubNodes(f,p),this.module.setTransformation(f,this,!0);for(let _=0;_<p._indexes.length;_++)this.module.groupController.alreadyGrouped.add(p._indexes[_]),this.module.setMetaNode(p._indexes[_],u.get(m))}return{metaNodes:u,newNodes:h}})}addMetaEdges(t){const e=this.id,s=this.ogma;let i,n=!1;const r=new Set;t?(i=this.module.getSubNodes(t).getAdjacentElements({bothExtremities:!1}).edges,n=!0):i=s.getEdges();const o=new Map,a=this.ogma.modules.graphics.getAttributesManager().getUsedEdgeAttributes().filter(m=>m!=="curvature"),l=new Map;for(let m=0;m<i.size;++m){const f=i.get(m),p=this.computeEdgeGroupId(f);if(p==null)continue;let _=f.getSource(),y=f.getTarget();if(n){let v=this.module.nodeToMeta.get(_._index);v&&v.getTransformation().getId()!==this.getId()&&(v=_);let A=this.module.nodeToMeta.get(y._index);if(A&&A.getTransformation().getId()!==this.getId()&&(A=y),_=v||_,y=A||y,_&&_===y){l.has(_._index)?l.get(_._index).push(f._index):l.set(_._index,[f._index]);continue}}const x=this.groupEdges?LD(p,_.getId(),y.getId(),this.separateEdgesByDirection):`${f.getId()}:${_.getId()}->${y.getId()}`;let b=o.get(x);b||(b={id:x,source:_,target:y,edges:[]},o.set(x,b)),b.edges.push(f)}const d=Array.from(o.values()),h=d.map(({edges:m})=>s.getEdges(m)),u=[],{edgeDataUpdates:c}=this.context,g=[];r.clear();for(let m=0;m<d.length;++m){const f=d[m],p=f.id,_=h[m],y=this.groupEdges?this.edgeGenerator(_,p,f.source,f.target,this):TD(_,a);if(y){if(y.id===null)throw Error(`The id ${y.id} returned by the edgeGenerator function is not unique.`);if(y.id===void 0&&(y.id=hd(p,e)),r.has(y.id))throw new Error(`Ogma transformations: NodeGrouping ${this.id} is trying to create two different metaEdges with the same id.`);r.add(y.id),g.push(y.id),y.source=f.source.getId(),y.target=f.target.getId(),u.push(y)}}return s.addEdges(ID(u),{virtual:!0}).then(()=>{const m=s.getEdges(g);m.setVisible(!1),s.modules.individualAttributes.replaceOriginalAttributes(m,u.map(_=>_.attributes));const f=m.getData();for(let _=0;_<f.length;_++){const y=u[_],x=f[_];f[_]=yn(yn(x,y.data),c.get(g[_]))}s.modules.data.setProperty(m,null,f,{dispatch:!0,virtual:!0}),this.context.metaEdges&&this.module.removeMetaEdges(this.context.metaEdges);const p=m._indexes;for(let _=0;_<p.length;_++){const y=h[_]._indexes,x=p[_];for(let b=0;b<y.length;b++)this.module.setMetaEdge(y[b],m.get(_));this.module.setSubEdges(x,h[_]),this.module.setTransformation(x,this,!1)}return{intraEdges:l,metaEdges:m}})}removeMetaEdges(t){t.forEach(e=>{const s=this.module.getSubEdges(e);if(!s)return;const i=s._indexes;for(let r=0;r<i.length;r++)this.module.clearMetaEdge(i[r]);this.module.clearSubEdges(e._index);const n=this.module.getMetaEdge(e);if(n){for(let r=0;r<i.length;r++)this.module.setMetaEdge(i[r],n);this.module.setSubEdges(n._index,this.module.getSubEdges(n).filter(r=>r!==e).concat(s))}s.filter(r=>r.getTarget().isVisible()&&r.getSource().isVisible()).setVisible(!0)}),t.setVisible(!1)}removeMetaNodes(t){t.forEach(e=>{const s=this.module.getSubNodes(e);if(!s)return;const i=s._indexes;for(const n of i)this.module.clearMetaNode(n);this.module.clearSubNodes(e._index),s.setVisible(!0)}),t.setVisible(!1)}onRemove(t,e){}checkChanges(t,e){const s=e?this.context.nodeDataUpdates:this.context.edgeDataUpdates,i=this.module;for(let n=0;n<t.length;n++){const{property:r,newValues:o,virtual:a,nodes:l,edges:d}=t[n];if(a)continue;const h=e?l.filter(u=>i.getTransformation(u._index,e)===this):d.filter(u=>i.getTransformation(u._index,e)===this);if(h.size)for(let u=0;u<h._indexes.length;u++){const c=h.get(u).getId();let g=s.get(c)||{};const m=o[u];r?co(g,r,m):g=m,s.set(c,g)}}}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.nodeGroupIdFunction=t.nodeGroupIdFunction||this.nodeGroupIdFunction,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.edgeGroupIdFunction=t.edgeGroupIdFunction||this.edgeGroupIdFunction,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0?!!t.separateEdgesByDirection:this.separateEdgesByDirection,this.groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this.groupSelfLoopEdges,this.groupEdges=t.groupEdges!==void 0?!!t.groupEdges:this.groupEdges,super.setOptions(t)}resetContext(){super.resetContext(),this.context={...this.context,nodeDataUpdates:new Map,edgeDataUpdates:new Map}}},yA=class extends _A{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,padding:o=2,onBeforeAddMetaEdges:a,selector:l=Sr,groupIdFunction:d=wr,edgeGroupIdFunction:h=wr,nodeGenerator:u=jo,edgeGenerator:c=jo,onGroupUpdate:g=()=>{},separateEdgesByDirection:m=!1,groupSelfLoopEdges:f=!1,groupEdges:p=!0,restorePositions:_=!0,showContents:y=!1}){super({id:s,ogma:i,module:n,nodeSelector:l,nodeGroupIdFunction:d,edgeGroupIdFunction:h,nodeGenerator:u,edgeSelector:x=>!(!this.module.getMetaNode(x.getSource())&&!this.module.getMetaNode(x.getTarget())),edgeGenerator:c,separateEdgesByDirection:m,groupEdges:p,groupSelfLoopEdges:f,duration:t,easing:e,enabled:r}),this.onBeforeAddMetaEdges=a||(()=>Promise.resolve()),this.onGroupUpdate=g,this._padding=o,this._showContents=typeof y!="function"?()=>y:y,this._restorePositions=_,this.module.groupController.setNodeGroupingCount(this.module.groupController.getNodeGroupingCount()+1)}getName(){return Ze.NodeGrouping}get padding(){return this._padding}set padding(t){this._padding=t,this.refresh()}resetContext(){super.resetContext(),this.context={...this.context,metaNodes:this.ogma.nodeList(),metaEdges:this.ogma.edgeList(),subNodes:this.ogma.nodeList(),intraEdges:this.ogma.edgeList(),subNodesPerMetaNode:new Map,subEdges:this.ogma.edgeList()}}run(){let t,e;const s=this.ogma,i=this.module.animations,n=this.module.groupController,r=n.layoutController;let o=s.createNodeList(),a=s.createEdgeList();const l=[];let d=s.createEdgeList();const h=new Map,u=-(this.getIndex()+To),c=new Set,g=[],m=[],f=[];let p;const _=s.geo.enabled();return this.addMetaNodes().then(({metaNodes:y,newNodes:x})=>{p=n.setPadding(y,this._padding),t=y;for(let b=0;b<x.size;b++)c.add(x._indexes[b]);for(let b=0;b<t.size;b++)n.setNodeLayer(t._indexes[b],u);return this.onBeforeAddMetaEdges(t,x).then(()=>this.addMetaEdges(t))}).then(({intraEdges:y,metaEdges:x})=>{e=x,a=this.module.getSubEdges(e),e.filter(A=>A.getExtremities().map(E=>E.isVisible()).every(E=>E)).setVisible(!0);for(let A=0;A<e.size;A++)n.edgeLayer.set(e._indexes[A],u);a.setVisible(!1);const b=this.context.metaNodes.subtract(t),v=this.context.metaEdges.subtract(e);return this.module.removeMetaNodes(b),this.module.removeMetaEdges(v),n.cleanup(b,v),s.removeNodes(b,{virtual:!0}).then(()=>s.removeEdges(v,{virtual:!0})).then(()=>({intraEdges:y,metaEdges:x}))}).then(({intraEdges:y})=>{const x=t._indexes,b=[],v=t.getPosition();for(let A=0;A<x.length;A++){const E=t.get(A),S=n.isClose(E),w=!S&&!n.isOpen(E),T=n.collapsedGroups.has(E._index),L=this._showContents(E),R=this.module.getSubNodes(E),k=v[A],j=R._indexes,z=new Set;if(w){const{x:it,y:dt}=n.getGroupXYR(E,this.module.getSubNodes(E),void 0,void 0);_?n.setGeoLatLng(E,dt,it):(m.push({x:it,y:dt}),f.push(E._index),k.x=it,k.y=dt)}h.set(x[A],z);const q=y.has(E._index)&&s.edgeList(y.get(E._index));q&&(d=d.concat(q),q.setVisible(L&&!T)),o=o.concat(R);for(let it=0;it<j.length;it++)z.add(j[it]);const B=this.context.subNodesPerMetaNode.get(x[A]),W=p.has(E._index);let Z=!B||r.shouldRelayout.has(E._index);if(!Z&&B)for(const it of B.keys())Z||(Z=!z.has(it));if(!Z&&B)for(let it=0;it<j.length;it++)Z||(Z=!B.has(j[it]));if(Z&&(r.shouldRelayout.add(E._index),b.push(n.layoutController.getLayoutFunction(this.onGroupUpdate,E,R,L))),L){if(S?n.expandGroup(E,R):n.addOpenGroup(E),Z||W||S){g.push(E);const it=this.module.getMetaNode(E);it&&r.shouldRelayout.add(it._index)}}else n.closeGroup(E,R,k.x,k.y)}return f.length&&i.pushBefore(()=>{s.nodeList(f).setAttributes(m)}),n.layoutController.handleLayoutFunctions(b).then(()=>{g.forEach(A=>n.setGroupXYR(A)),_&&this.ogma.modules.geo._updateNodesCoordinates(t)})}).then(()=>(this.context={metaNodes:t,metaEdges:e,subNodesPerMetaNode:h,subNodes:o,intraEdges:d,nodeDataUpdates:this.context.nodeDataUpdates,edgeDataUpdates:this.context.edgeDataUpdates,subEdges:a},l))}undo(t=!0){super.undo(t);const{metaNodes:e,metaEdges:s,intraEdges:i,subNodes:n,subEdges:r}=this.context,o=this.module.animations,a=this.module.groupController;if(i.setVisible(!0),r.setVisible(!0),s.setVisible(!1),n.setVisible(!0),e.setVisible(!1),t){o.pushBefore(()=>{e.setVisible(!0),s.setVisible(!0)}),o.pushAfter(()=>{e.setVisible(!1),s.setVisible(!1)});for(let l=0;l<s.size;l++)this.module.isVirtual(s._indexes[l],!1)||a.edgeLayer.delete(s._indexes[l]);for(let l=0;l<r.size;l++)this.module.isVirtual(r._indexes[l],!1)||a.edgeLayer.delete(r._indexes[l]);for(let l=0;l<i.size;l++)this.module.isVirtual(i._indexes[l],!1)||a.edgeLayer.delete(i._indexes[l]);for(let l=0;l<n.size;l++)this.module.isVirtual(n._indexes[l],!0)||a.nodeLayer.delete(n._indexes[l]);this.context.subNodesPerMetaNode.clear(),e.forEach(l=>{const d=this.module.getSubNodes(l);if(a.nodeLayer.delete(l._index),a.isClose(l))a.expandGroup(l,d,!0);else{const h=l.getPosition();a.closeGroup(l,d,h.x,h.y,!0)}})}}onRemove(t,e){if(e){const s=this.context.metaNodes.size;this.context.metaNodes=this.context.metaNodes.filter(n=>!t.has(n._index));const i=this.context.subNodes.size;this.context.subNodes=this.context.subNodes.filter(n=>!t.has(n._index)),(this.context.subNodes.size!==s||this.context.metaNodes.size!==i)&&this.context.subNodesPerMetaNode.clear()}else this.context.subEdges=this.context.subEdges.filter(s=>!t.has(s._index)),this.context.metaEdges=this.context.metaEdges.filter(s=>!t.has(s._index))}cleanup(){const{ogma:t}=this,e=this.context,{metaNodes:s,metaEdges:i,subNodes:n}=e;return this.module.removeMetaNodes(s),this.module.removeMetaEdges(i),this.module.groupController.cleanup(s,i,n),this.module.groupController.setNodeGroupingCount(this.module.groupController.getNodeGroupingCount()-1),super.cleanup(),Promise.all([t.removeEdges(i,{virtual:!0}),t.removeNodes(s,{virtual:!0})]).then(()=>Promise.resolve())}setOptions({duration:t,easing:e,enabled:s,padding:i,selector:n,groupIdFunction:r,nodeGenerator:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupSelfLoopEdges:h,groupEdges:u,restorePositions:c,showContents:g}){return this._padding=i!==void 0?i:this.padding,this._showContents=g!==void 0?typeof g!="function"?()=>g:g:this._showContents,this._restorePositions=c===void 0?this._restorePositions:c,super.setOptions({nodeSelector:n,nodeGroupIdFunction:r,nodeGenerator:o,edgeSelector:m=>!(!this.module.getMetaNode(m.getSource())&&!this.module.getMetaNode(m.getTarget())),edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:u,groupSelfLoopEdges:h,duration:t,easing:e,enabled:s})}},JD=class extends _A{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,selector:o=Sr,groupIdFunction:a=wr,generator:l=jo,separateEdgesByDirection:d=!1}){super({id:s,ogma:i,module:n,nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:!0,groupSelfLoopEdges:!0,duration:t,easing:e,enabled:r})}resetContext(){super.resetContext(),this.context={...this.context,metaEdges:this.ogma.edgeList(),subEdges:this.ogma.edgeList()}}getName(){return Ze.EdgeGrouping}run(){let t,e;const s=this.module.animations,i=new Set(this.context.metaEdges.getId());return this.addMetaEdges().then(({metaEdges:n})=>{t=n,e=this.module.getSubEdges(t),t.setVisible(!0),e.setVisible(!1),s.hideEdges(e._indexes);const r=t.concat(this.context.metaEdges).getParallelEdges().dedupe().filter(d=>!i.has(d.getId())),o=new Array(r.size),a=new Map;for(let d=0;d<r.size;d++)o[d]=this.ogma.modules.curvatureManager.computeCurvature(r.get(d),"visible"),a.set(r._indexes[d],o[d]);const l=this.module.getSubEdges(r);l.setVisible(!0),this.module.animations.setCurvatures(r._indexes,o);for(let d=0;d<l._indexes.length;d++)this.module.animations.setCurvature(e._indexes[d],a.get(this.module.getMetaEdge(e.get(d))._index)||0)}).then(()=>{this.context.metaEdges=t,this.context.subEdges=e})}undo(t=!0){super.undo(t);const{metaEdges:e,subEdges:s}=this.context;if(s.setVisible(!0),e.setVisible(!1),!t)return Promise.resolve();const i=s.getParallelEdges().dedupe(),n=new Array(i.size),r=new Map;for(let o=0;o<i.size;o++)n[o]=this.ogma.modules.curvatureManager.computeCurvature(i.get(o),"visible"),r.set(i._indexes[o],n[o]);return this.module.animations.setCurvatures(i._indexes,n),Promise.resolve()}onRemove(t,e){e||(this.context.subEdges=this.context.subEdges.filter(s=>!t.has(s._index)))}_getCurvatures(t){return t.map(e=>this.ogma.modules.curvatureManager.computeCurvature(e,"visible",()=>!0))}cleanup(){const{metaEdges:t}=this.context;return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then(()=>(this.context.metaEdges=this.ogma.edgeList(),this.context.subEdges=this.ogma.edgeList(),Promise.resolve()))}setOptions({duration:t,easing:e,enabled:s,selector:i,groupIdFunction:n,generator:r,separateEdgesByDirection:o}){return super.setOptions({nodeSelector:void 0,nodeGroupIdFunction:void 0,nodeGenerator:void 0,edgeSelector:i,edgeGroupIdFunction:n,edgeGenerator:r,separateEdgesByDirection:o,groupEdges:!0,duration:t,easing:e,enabled:s})}},h_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Lh=1,Gr=8,tO=class xA{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,i]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(n!==Lh)throw new Error(`Got v${n} data when expected v${Lh}.`);const r=h_[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new xA(a,o,r,e)}constructor(e,s=64,i=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=h_.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-a%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,Gr,e),this.coords=new this.ArrayType(this.data,Gr+a+l,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(Gr+o+a+l),this.ids=new this.IndexArrayType(this.data,Gr,e),this.coords=new this.ArrayType(this.data,Gr+a+l,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(Lh<<4)+r]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=s,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return nc(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:a}=this,l=[0,r.length-1,0],d=[];for(;l.length;){const h=l.pop()||0,u=l.pop()||0,c=l.pop()||0;if(u-c<=a){for(let p=c;p<=u;p++){const _=o[2*p],y=o[2*p+1];_>=e&&_<=i&&y>=s&&y<=n&&d.push(r[p])}continue}const g=c+u>>1,m=o[2*g],f=o[2*g+1];m>=e&&m<=i&&f>=s&&f<=n&&d.push(r[g]),(h===0?e<=m:s<=f)&&(l.push(c),l.push(g-1),l.push(1-h)),(h===0?i>=m:n>=f)&&(l.push(g+1),l.push(u),l.push(1-h))}return d}within(e,s,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,a=[0,n.length-1,0],l=[],d=i*i;for(;a.length;){const h=a.pop()||0,u=a.pop()||0,c=a.pop()||0;if(u-c<=o){for(let p=c;p<=u;p++)u_(r[2*p],r[2*p+1],e,s)<=d&&l.push(n[p]);continue}const g=c+u>>1,m=r[2*g],f=r[2*g+1];u_(m,f,e,s)<=d&&l.push(n[g]),(h===0?e-i<=m:s-i<=f)&&(a.push(c),a.push(g-1),a.push(1-h)),(h===0?e+i>=m:s+i>=f)&&(a.push(g+1),a.push(u),a.push(1-h))}return l}};function nc(t,e,s,i,n,r){if(n-i<=s)return;const o=i+n>>1;bA(t,e,o,i,n,r),nc(t,e,s,i,o-1,1-r),nc(t,e,s,o+1,n,1-r)}function bA(t,e,s,i,n,r){for(;n>i;){if(n-i>600){const d=n-i+1,h=s-i+1,u=Math.log(d),c=.5*Math.exp(2*u/3),g=.5*Math.sqrt(u*c*(d-c)/d)*(h-d/2<0?-1:1);bA(t,e,s,Math.max(i,Math.floor(s-h*c/d+g)),Math.min(n,Math.floor(s+(d-h)*c/d+g)),r)}const o=e[2*s+r];let a=i,l=n;for(Vr(t,e,i,s),e[2*n+r]>o&&Vr(t,e,i,n);a<l;){for(Vr(t,e,a,l),a++,l--;e[2*a+r]<o;)a++;for(;e[2*l+r]>o;)l--}e[2*i+r]===o?Vr(t,e,i,l):(l++,Vr(t,e,l,n)),l<=s&&(i=l+1),s<=l&&(n=l-1)}}function Vr(t,e,s,i){Ch(t,s,i),Ch(e,2*s,2*i),Ch(e,2*s+1,2*i+1)}function Ch(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function u_(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}var eO=t=>t/360+.5,sO=t=>{const e=Math.sin(t*Math.PI/180);return(t=.5-.25*Math.log((1+e)/(1-e))/Math.PI)<0?0:t>1?1:t},iO=[],nO=256,rO=class extends yA{constructor(t){super({...t,enabled:t.enabled&&t.ogma.geo.enabled(),showContents:!1,selector:e=>{const s=this.getPosition(e);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!t.selector||t.selector(e))},groupIdFunction:e=>{let s=t.groupIdFunction?t.groupIdFunction(e):"geo-cluster";return s||(s="geo-cluster"),`${s}-${this.getNodeId(e)}`},edgeGroupIdFunction:e=>{let s=t.edgeGroupIdFunction?t.edgeGroupIdFunction(e):"";return s||(s=""),`${s}-${this.getNodeId(e.getSource())}-${this.getNodeId(e.getTarget())}`},nodeGenerator:(e,s,i)=>{let n=t.nodeGenerator?t.nodeGenerator(e,s,i):{};n||(n={});const r=this.getCoords(e.get(0));return n.data?n.data=ec(n.data,r):n.data=r,n}}),this._zoomLevels=t.zoomLevels?t.zoomLevels:[0,22],this._groupingRadius=t.radius===void 0?60:t.radius,this._generateIdFunction=t.groupIdFunction||(()=>""),this._shouldEnable=t.enabled,this._shouldRefreshClusters=!0,this.ogma.events.on("beforeGeoCameraMove",({zoom:e})=>{!this.isEnabled()||!this.ogma.geo.enabled()||this.getClosestZoomLevel(e).zoom===this._currentClusters.zoom||(this._shouldRefreshClusters=!1,this.refresh())}).on("geoDisabled",()=>{this.isEnabled()&&this.disable(0).then(()=>{this._shouldEnable=!0})}).on("geoEnabled",()=>{this._shouldEnable&&this.enable(0)})}getPosition(t){return{x:t.getData(this.ogma.modules.geo.latitudePath),y:t.getData(this.ogma.modules.geo.longitudePath)}}getMercatorPosition(t){return{x:eO(t.getData(this.ogma.modules.geo.longitudePath)),y:sO(t.getData(this.ogma.modules.geo.latitudePath))}}getNodeId(t){var e;return((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.id)||""}getName(){return Ze.GeoClustering}enable(t){return this.ogma&&!this.ogma.geo.enabled()?(this._shouldEnable=!0,Promise.resolve()):super.enable(t)}undo(t=!0){const{metaNodes:e,metaEdges:s,intraEdges:i,subNodes:n,subEdges:r}=this.context,o=-(this.getIndex()+To);return t?(i.setVisible(!0),r.setVisible(!0),s.setVisible(!1),n.setVisible(!0),n.setAttribute("layer",o+To),this.module.animations.push(()=>{s.filter(a=>a).setVisible(!1),e.filter(a=>a).setVisible(!1)}),Promise.resolve()):(e.setVisible(!1),s.setVisible(!1),n.setVisible(!0),r.setVisible(!0),i.setVisible(!0),Promise.resolve())}disable(t){return this._shouldEnable=!1,super.disable(t)}getCoords(t){var e;const s=((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.center)||{x:0,y:0},i={};return this.setToPropertyPath(i,this.ogma.modules.geo.latitudePath,s.x),this.setToPropertyPath(i,this.ogma.modules.geo.longitudePath,s.y),i}setToPropertyPath(t,e,s){if(typeof e=="string")return this.setToPropertyPath(t,e.split("."),s);{let i=t;e.forEach((n,r)=>{r===e.length-1?i[n]=s:i[n]||(i[n]={}),i=i[n]})}}nodeToElement(t){return{nodeId:t._index,generatedId:this._generateIdFunction(t),nodes:this.ogma.nodeList(new Uint32Array([t._index])),radius:t.getAttribute("radius"),center:this.getPosition(t),mercatorCenter:this.getMercatorPosition(t),zoom:1/0}}getCluster(t){const e=t.reduce((n,r)=>({x:n.x+r.center.x/t.length,y:n.y+r.center.y/t.length}),{x:0,y:0}),s=t.reduce((n,r)=>({x:n.x+r.mercatorCenter.x/t.length,y:n.y+r.mercatorCenter.y/t.length}),{x:0,y:0}),i=t.reduce((n,r)=>{const o=e.x-r.center.x,a=e.y-r.center.y,l=r.radius+Math.sqrt(o*o+a*a);return Math.max(l,n)},0);return{nodes:this.ogma.nodeList(new Uint32Array(t.map(({nodeId:n})=>n))),generatedId:t[0].generatedId,center:e,mercatorCenter:s,radius:i}}onePassCluster(t){const e=t.map(r=>this.nodeToElement(r)),[s,i]=this._zoomLevels,n=[];for(let r=i;Math.abs(r-s)>.01;r-=1*(i-s)/19){const o=[],a=new tO(e.length);e.forEach(l=>{a.add(l.mercatorCenter.x,l.mercatorCenter.y)}),a.finish(),e.forEach(l=>{if(l.zoom<=r)return;const d=this._groupingRadius/(nO*Math.pow(2,l.zoom-1));let h=a.within(l.mercatorCenter.x,l.mercatorCenter.y,d).map(u=>e[u]).filter(u=>u.zoom>r&&u&&u.generatedId===l.generatedId);h.length||(h=[l]),h.forEach(u=>u.zoom=r),o.push({...this.getCluster(h),zoom:r,id:`${r.toFixed(2)}-${o.length}`})}),n.push({zoom:r,clusters:o})}return n.map(({zoom:r,clusters:o})=>{const a=new Map;return o.forEach(l=>{l.nodes.forEach(({_index:d})=>a.set(d,l))}),{zoom:r,idToCluster:a}})}getClosestZoomLevel(t){return this._clustersByZoom.reduce((e,s)=>Math.abs(t-s.zoom)<Math.abs(t-e.zoom)?s:e)}run(){var t;this._shouldRefreshClusters&&(this._clustersByZoom=this.onePassCluster(this.ogma.getNodes().filter(u=>this.nodeSelector(u)))),this._shouldRefreshClusters=!0;const e=((t=this.ogma.geo.getMap())==null?void 0:t.getZoom())||0;let s,i;this._currentClusters=this.getClosestZoomLevel(e);const n=this.ogma,r=this.module.groupController;let o=n.createNodeList(),a=n.createEdgeList(),l=n.createEdgeList();const d=-(this.getIndex()+To),h=new Set;return this.addMetaNodes().then(({metaNodes:u,newNodes:c})=>{s=u;for(let g=0;g<c.size;g++)h.add(c._indexes[g]);for(let g=0;g<s.size;g++)r.nodeLayer.set(s._indexes[g],d);return this.addMetaEdges(s)}).then(({intraEdges:u,metaEdges:c})=>{i=c,a=this.module.getSubEdges(i),i.filter(f=>f.getExtremities().map(p=>p.isVisible()).every(p=>p)).setVisible(!0);for(let f=0;f<i.size;f++)r.edgeLayer.set(i._indexes[f],d);a.setVisible(!1);const g=this.context.metaNodes.subtract(s),m=this.context.metaEdges.subtract(i);return this.module.removeMetaNodes(g),this.module.removeMetaEdges(m),r.cleanup(g,m),n.removeNodes(g,{virtual:!0}).then(()=>n.removeEdges(m,{virtual:!0})).then(()=>({intraEdges:u,metaEdges:c}))}).then(({intraEdges:u})=>{const c=s._indexes;for(let g=0;g<c.length;g++){const m=s.get(g),f=this.module.getSubNodes(m),p=u.has(m._index)&&n.edgeList(u.get(m._index));p&&(l=l.concat(p),p.setVisible(!1)),o=o.concat(f),f.setVisible(!1)}return this.ogma.modules.geo._updateNodesCoordinates(s),this.ogma.modules.geo.updateProjection(),this.context={metaNodes:s,metaEdges:i,subNodes:o,intraEdges:l,subNodesPerMetaNode:new Map,nodeDataUpdates:this.context.nodeDataUpdates,edgeDataUpdates:this.context.edgeDataUpdates,subEdges:a},iO})}setOptions(t){const e=super.setOptions({...t,selector:s=>{const i=this.getPosition(s);return i&&!isNaN(i.x)&&!isNaN(i.y)&&(!t.selector||t.selector(s))},groupIdFunction:s=>{let i=t.groupIdFunction?t.groupIdFunction(s):"geo-cluster";return i||(i="geo-cluster"),`${i}-${this.getNodeId(s)}`},nodeGenerator:(s,i,n)=>{let r=t.nodeGenerator?t.nodeGenerator(s,i,n):{};r||(r={});const o=this.getCoords(s.get(0));return r.data?r.data=ec(r.data,o):r.data=o,r},edgeGroupIdFunction:s=>{let i=t.edgeGroupIdFunction?t.edgeGroupIdFunction(s):"";return i||(i=""),`${i}-${this.getNodeId(s.getSource())}-${this.getNodeId(s.getTarget())}`}});return this._groupingRadius=t.radius===void 0?this._groupingRadius:t.radius,this._generateIdFunction=t.groupIdFunction||this._generateIdFunction,this._shouldRefreshClusters=!0,this._shouldEnable=t.enabled,e}},c_=()=>({}),oO=class extends en{constructor(t){super(t),this._groupSelfLoopEdges=!1,this._isCleaningUp=!1,this._isRunning=!1,this.shouldDo=!0,this.enabled=!1,this._onBeforeAdd=e=>{if(this._isCleaningUp||!this.enabled||e.virtual)return;const{isNode:s,objects:i}=e;if(s){const n=i;g_(n,this._groupNodes(n))}else{const n=i;g_(n,this._groupEdges(n))}this._shouldSetVirtual=!0},this._onAfterAdd=e=>{this._shouldSetVirtual&&(this._shouldSetVirtual=!1,this._setVirtual(e.nodes||e.edges,!!e.nodes))},this._onRequestElementsToDelete=e=>{if(e.virtual)return;const{ogma:s,context:i}=this,n=e.elementsToRemove.isNode,r=n?s.getNodes:s.getEdges,o=n?i.metaNodesSet:i.metaEdgesSet,a=n?i.nodeGroups:i.edgeGroups,l=n?s.removeNodes:s.removeEdges,d=e.elementsToRemove.size,h=r(Array.from(o)),u=e.elementsToRemove.slice();if(e.elementsToRemove=e.elementsToRemove.subtract(h),e.elementsToRemove.size===d)return;const c=u.subtract(e.elementsToRemove);if(c.forEach(g=>{a.delete(g.getId())}),n){const g=c.getAdjacentEdges().filter(m=>m.isVirtual());s.removeEdges(g)}l(c,{virtual:!0})},this._nodeToGroupId=t.groupIdFunction||wr,this._groupSelfLoopEdges=!!t.groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||c_,this._edgeGenerator=t.edgeGenerator||c_,this._shouldSetVirtual=!1,this._selector=t.selector,this.shouldDo=t.enabled===void 0||!!t.enabled,this.ogma.events.on("preAddElements",this._onBeforeAdd).on("requestElementsToDelete",this._onRequestElementsToDelete).on(["postAddGraph","addNodes","addEdges"],this._onAfterAdd),this.shouldDo&&(this.enable(),this.shouldDo=!1)}getName(){return Ze.NodeClustering}enable(){if(this.enabled)return Promise.resolve();this.enabled=!0,this.shouldDo=!0,this._isRunning=!0;const{ogma:t}=this;return t.getNodes().size?t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(e=>(t.clearGraph(),t.setGraph(e))).then(()=>(this._isRunning=!1,Promise.resolve())):(this._isRunning=!1,Promise.resolve())}disable(){return this.enabled?(this.enabled=!1,this.shouldDo=!1,super.disable()):Promise.resolve()}destroy(){return this.disable(),super.destroy()}run(){const{ogma:t}=this;return this.enabled||!this.shouldDo?Promise.resolve():t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(e=>(this._isCleaningUp=!0,t.clearGraph(),this._isCleaningUp=!1,t.setGraph(e)))}undo(){if(this._isRunning||this.enabled)return Promise.resolve();const{ogma:t,context:e}=this;this._isCleaningUp=!0;const s=t.getNodes(Array.from(e.metaNodesSet));this.module.removeMetaNodes(s);const i=t.getEdges(Array.from(e.metaEdgesSet));this.module.removeMetaEdges(i);const n=this._getSubNodes(),r=this._getSubEdges();return this.resetContext(),t.removeNodes(s,{virtual:!0}).then(()=>t.removeEdges(i,{virtual:!0})).then(()=>t.addNodes(n)).then(()=>t.addEdges(r)).then(()=>{this._isCleaningUp=!1,Promise.resolve()})}cleanup(){return this._isRunning||this.ogma.events.off(this._onBeforeAdd).off(this._onRequestElementsToDelete).off(this._onAfterAdd),Promise.resolve()}resetContext(){this._isRunning||(this.context={nodeGroups:new Map,edgeGroups:new Map,metaNodesSet:new Set,metaEdgesSet:new Set,virtualNodes:this.ogma.createNodeList(),virtualEdges:this.ogma.createEdgeList(),nodeToGroupId:new Map})}getSubNodes(t){const e=this.context.nodeGroups.get(t.getId());return e?e.nodes:[]}getSubEdges(t){const e=this.context.edgeGroups.get(t.getId());return e?e.edges:[]}_getSubNodes(){return Array.from(this.context.nodeGroups.values()).reduce((t,{nodes:e})=>(t.push(...e),t),[])}_getSubEdges(){return Array.from(this.context.edgeGroups.values()).reduce((t,{edges:e})=>(t.push(...e),t),[])}_setVirtual(t,e){if(!t)return;const{context:s}=this,i=e?s.metaNodesSet:s.metaEdgesSet,n=t.filter(r=>i.has(r.getId()));if(e)for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubNodes(n._indexes[r],null);else for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubEdges(n._indexes[r],null);e?s.virtualNodes=s.virtualNodes.concat(n):s.virtualEdges=s.virtualEdges.concat(n)}setContext(){}_computeEdgeGroupId(t,e){return t>e?`${e}:${t}`:`${t}:${e}`}_groupEdges(t){const{ogma:e,id:s,context:i}=this,n=s,r=new Map,o=i.nodeToGroupId;i.edgeGroups.forEach(h=>{h.newEdges=[],r.set(h.id,h)});const a=[];for(let h=0;h<t.length;++h){const u=t[h];let c=i.nodeToGroupId.get(u.source),g=i.nodeToGroupId.get(u.target);if(!c&&!g){a.push(u);continue}c=c||u.source,g=g||u.target;const m=this._computeEdgeGroupId(c,g);if(m!==void 0){const f=o.get(u.source)||u.source,p=o.get(u.target)||u.target;let _=r.get(m);_||(_={id:m,source:f,target:p,edges:[],newEdges:[]},r.set(m,_)),_.edges.push(u),_.newEdges.push(u)}}const l=ud(r),d=l.map(({edges:h})=>h);for(let h=0;h<l.length;++h){const u=l[h];if(!u.newEdges.length)continue;const c=u.id,g=d[h],m=this._edgeGenerator(g,c);m.id===void 0&&(m.id=hd(c,n)),m.source=u.source,m.target=u.target,u.metaEdge=m,i.metaEdgesSet.add(m.id),i.edgeGroups.get(m.id)||i.edgeGroups.set(m.id,u),(this._groupSelfLoopEdges||m.source!==m.target)&&a.push(m)}return e.view.afterNextFrame().then(()=>{i.edgeGroups.forEach(({newEdges:h,metaEdge:u})=>{if(!(h.length&&u&&u.id&&u.attributes))return;const c=e.getEdge(u.id);c?.setAttributes(u.attributes)})}),a}_groupNodes(t){const{id:e,context:s,ogma:i}=this,n=e,r=new Map;s.nodeGroups.forEach(u=>{u.newNodes=[],r.set(u.id,u)});const o=[];for(let u=0;u<t.length;u++){const c=t[u];if(this._selector&&!this._selector(c)){o.push(c);continue}c.id=CD(c.id);const g=this._nodeToGroupId(c);if(g!==void 0){let m=r.get(g);m||(m={id:g,nodes:[],newNodes:[]},r.set(g,m)),m.nodes.push(c),m.newNodes.push(c)}else s.nodeToGroupId.set(c.id,c.id)}const a=ud(r),l=a.map(({nodes:u})=>u),d=a.map(({newNodes:u})=>u),h=[];for(let u=0;u<a.length;++u){if(!a[u].newNodes.length)continue;const c=a[u].id,g=l[u],m=this._nodeGenerator(g,c);a[u].metaNode=m,m.id===void 0&&(m.id=hd(c,n));for(const f of d[u])s.nodeToGroupId.set(f.id,m.id);s.metaNodesSet.add(m.id),s.nodeGroups.get(m.id)||s.nodeGroups.set(m.id,a[u]),h.push(m)}return h.push(...o),i.view.afterNextFrame().then(()=>{s.nodeGroups.forEach(({newNodes:u,metaNode:c})=>{if(!(u.length&&c&&c.id&&c.attributes))return;const g=i.getNode(c.id);g?.setAttributes(c.attributes)})}),h}setOptions(t){return this._nodeToGroupId=t.groupIdFunction||this._nodeToGroupId,this._groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this._groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||this._nodeGenerator,this._edgeGenerator=t.edgeGenerator||this._edgeGenerator,this._selector=t.selector||this._selector,this.disable().then(()=>this.undo()).then(()=>this.ogma.view.afterNextFrame()).then(()=>this.enable())}onRemove(){}};function g_(t,e){const s=e.length;return t.length=s,t.splice(0,s,...e),t}function ui(t){return t.enabled!==!1}var aO=class extends kD{_setOptions(t){const e=t;return e.ogma=this.ogma,e.module=this,e.id=this.transformations.length,e}addNodeGrouping(t={}){const e=new yA(this._setOptions(t));return this.addTransformation(e,ui(t)),e}addEdgeGrouping(t={}){const e=new JD(this._setOptions(t));return this.addTransformation(e,ui(t)),e}addGeoClustering(t={}){const e=new rO(this._setOptions(t));return this.addTransformation(e,t.enabled),e}addNodeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new VD(this._setOptions(e));return this.addTransformation(s,ui(e)),s}addEdgeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new qD(this._setOptions(e));return this.addTransformation(s,ui(e)),s}addNeighborMerging(t){const e=new jD(this._setOptions(t));return this.addTransformation(e,ui(t)),e}addNeighborGeneration(t){const e=new XD(this._setOptions(t));return this.addTransformation(e,ui(t)),e}addNodeCollapsing(t={}){const e=new ZD(this._setOptions(t));return this.addTransformation(e,ui(t)),e}addVirtualProperties(t={}){const e=new QD(this._setOptions(t));return this.addTransformation(e,ui(t)),e}addNodeClustering(t={}){const e=new oO(this._setOptions(t));return this.addTransformation(e,ui(t)),e}addDrilldown(t={onGetSubgraph:()=>Promise.resolve({nodes:[],edges:[]})}){const e=new ND(this._setOptions(t));return this.drilldownController.addDrilldown(e),e}onGroupsUpdated(t){this.groupController.layoutController.onGroupsUpdate=t}triggerGroupsUpdated(){this.groupController.triggerGroupsUpdate()}layoutGroups(t,e,s=!1){return this.groupController.layoutGroups(t,e,s)}getXYR(t){return this.animations.getXYR(t)}fishEyeExpand(t,e,s){return this.groupController.fishEyeExpand(t,e,s)}fishEyeCollapse(t,e){return this.groupController.fishEyeCollapse(t,e)}},lO=class extends Ot{constructor(t){super(t),this.getSubElements=e=>this.api.getSubElements(e),this.getSubNodes=e=>this.api.getSubNodes(e),this.getSubEdges=e=>this.api.getSubEdges(e),this.getXYR=e=>this.api.getXYR(e),this.onGroupsUpdated=e=>this.api.onGroupsUpdated(e)}onMounted(){this._modules.classes.createClass({name:tb,isBuiltin:!0,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this._modules.classes.createClass({name:eb,isBuiltin:!0,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}}),this._modules.settings.register("transformations.updateOnDataChange",!0),this._modules.events.register(["transformationEnabled","transformationDisabled","transformationSetIndex","transformationDestroyed","transformationRefresh"])}onReady(t){this.api=new aO(this._ogma)}destroy(){}isElementVirtual(t){return this.api.isVirtual(t._index,t.isNode)}getElementTransformation(t){return this.api.getTransformation(t._index,t.isNode)}getMetaElements(t){return t.map(e=>this.getMetaElement(e))}getMetaElement(t){const e=t.isNode?this.api.getMetaNode(t):this.api.getMetaEdge(t);return e&&this.api.getTransformation(e._index,e.isNode)?.isEnabled()?e:null}getMetaEdge(t){return this.getMetaElement(t)}getMetaNode(t){return this.getMetaElement(t)}getMetaNodes(t){return this.getMetaElements(t)}getMetaEdges(t){return this.getMetaElements(t)}getNodeFilters(){return this.api.getList().filter(t=>t.getName()===Ze.NodeFilter)}getEdgeFilters(){return this.api.getList().filter(t=>t.getName()===Ze.EdgeFilter)}whenApplied(){return this.api.afterNextUpdate()}afterNextUpdate(){return this.api.afterNextUpdate()}isRefreshing(){return this.api.isRefreshing()}triggerGroupUpdated(t){const e=t._indexes,s=this._ogma.modules.transformations.api.groupController.layoutController.shouldRelayout;for(let i=0;i<t.size;i++)s.add(e[i])}},m_={layer:sb,outline:!0,outerStroke:{color:Lu,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:T0,minVisibleSize:0}},dO={layer:sb,color:Lu,text:{backgroundColor:T0,minVisibleSize:0},stroke:{color:Lu,width:0}},hO=class extends Ot{onMounted(){this.shouldTriggerEvents=!0,this._modules.events.register(["nodesSelected","nodesUnselected","edgesSelected","edgesUnselected"]),this._selectionExtremityHighlightedClass=this._modules.classes.createClass({name:cu,isBuiltin:!0,nodeAttributes:m_}),this._selectedClass=this._modules.classes.createClass({name:me,isBuiltin:!0,nodeAttributes:m_,edgeAttributes:dO}),this._modules.events.on(`nodeClassAdded_${me}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("nodesSelected",e)}),this._modules.events.on(`edgeClassAdded_${me}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("edgesSelected",e)}),this._modules.events.on(`nodeClassRemoved_${me}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("nodesUnselected",e)}),this._modules.events.on(`edgeClassRemoved_${me}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("edgesUnselected",e)}),this._modules.settings.register("interactions.selection.enabled",!0),this._modules.settings.register("interactions.selection.multiSelectionKey","ctrl"),this._modules.interactions.onClick({priority:"selection",check:({button:e})=>{const s=!!this._modules.settings.get("interactions.selection.enabled");return e==="left"&&s},handler:({target:e})=>{if(e){const s=this._modules.settings.get("interactions.selection.multiSelectionKey"),i=s&&this._modules.keyboard.isPressed(s);e.isNode?this._selectedClass.clearEdges():this._selectedClass.clearNodes(),i?e.hasClass(me)?e.removeClass(me):e.addClass(me):((e.isNode?this._selectedClass.getNodes():this._selectedClass.getEdges()).filter(n=>n!==e).removeClass(me),e.hasClass(me)||e.addClass(me))}else this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}});const t=()=>{this._selectionExtremityHighlightedClass.clearNodes(),this._selectedClass.getEdges().getExtremities().addClass(cu)};this._modules.events.on("beforeRemoveEdges",({edges:e})=>e.setSelected(!1)).on("excludedStateChange",({elements:e,value:s})=>{s||e.setSelected(!1)}).on(`edgeClassAdded_${me}`,t).on(`edgeClassRemoved_${me}`,t)}setNodeAttributes(t,e){this._selectedClass.update({nodeAttributes:t,fullOverwrite:e}),this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}setEdgeAttributes(t,e){this._selectedClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}setEdgeExtremitiesAttributes(t,e){this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e})}_updateExtremityHighlightLayer(){const t=this._selectedClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}setActive(t,e){if(Ue(e)){const s=[],i=[];t.toList().forEach((n,r)=>{(e[r]?s:i).push(n.getId())}),s.length!==0&&this._modules.graph.getElements(t.isNode,s).addClass(me),i.length!==0&&this._modules.graph.getElements(t.isNode,i).removeClass(me)}else t.size&&t[e?"addClass":"removeClass"](me)}areActive(t){return t.hasClass(me)}getSelectedNodes(){return this._selectedClass.getNodes()}getSelectedEdges(){return this._selectedClass.getEdges()}getNonSelectedNodes(){return this._modules.graph.getNodes().filter(t=>!t.hasClass(me))}getNonSelectedEdges(){return this._modules.graph.getEdges().filter(t=>!t.hasClass(me))}disableEvents(){this.shouldTriggerEvents=!1}enableEvents(){this.shouldTriggerEvents=!0}clear(){this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}},uO=class extends Ot{onMounted(){this._delayedCalls=[],this._idIdle=()=>!this._modules.captor.isAnyButtonPressed()&&!this._modules.dom.isPlayingFrame(),this._modules.events.on(["mousedown","mouseup","beforeNewFrame","frame"],()=>{this._delayedCalls.forEach(t=>t.reset())})}_nextTimeIdle(t){const e=new cO(this._modules.dom,this._idIdle,t);return this._delayedCalls.push(e),e.whenDone().then(()=>{this._delayedCalls.splice(this._delayedCalls.indexOf(e),1)})}debounceIdle(t,e=0){let s=!1,i=[];const n=()=>{const r=i;s=!1,i=[],t(),r.forEach(o=>o())};return()=>new Promise(r=>{i.push(r),s||(s=!0,this._nextTimeIdle(e).then(n))})}},cO=class{constructor(t,e,s){this._timeout=null,this._done=!1,this._dom=t,this._promise=new Promise(i=>this._resolve=i),this._isIdle=e,this._delay=s,this._startTimeout()}_startTimeout(){this._timeout=this._dom.setTimeout(()=>{this._isIdle()?(this._done=!0,this._resolve()):this._startTimeout()},this._delay)}reset(){this._done||(this._dom.clearTimeout(this._timeout),this._startTimeout())}whenDone(){return this._promise}},il=-2,gO={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2,enabled:!1},mO={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2,enabled:!1},fO=class extends Ot{constructor(){super(...arguments),this._nodePromiseMap=new Map,this._edgePromiseMap=new Map,this._onAttributeChange=({nodes:t,edges:e,nodeAttributes:s,edgeAttributes:i})=>{this._onElementsAttributeChange(t,s),this._onElementsAttributeChange(e,i,!1)},this._refreshPulses=()=>{const{nodes:t,edges:e}=this._hasPulses.getElements();if(t.size!==0||e.size!==0){const s=this._engine.getCurrentTime();this._refreshElementsPulses(t,s),this._refreshElementsPulses(e,s),this._modules.dom.refresh()}}}onMounted(){this._modules.events.on("updateAttributes",this._onAttributeChange).on("frame",this._refreshPulses).on("beforeRemoveEdges",({edges:t})=>{this._removePulses(t)}).on("beforeRemoveNodes",({nodes:t})=>{this._removePulses(t)}).on("excludedStateChange",({elements:t,value:e})=>{e&&(this._hasPulses.removeElements(t),this._removePulses(t))}).on("clearGraph",()=>this._hasPulses.clear()),this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._nodePulses=this._modules.graph.createNodeAttribute({storage:"any"},!1),this._edgePulses=this._modules.graph.createEdgeAttribute({storage:"any"},!1),this._nodeNbPulsesRemaining=this._modules.graph.createNodeAttribute({storage:"int16",default:-1},!1),this._edgeNbPulsesRemaining=this._modules.graph.createEdgeAttribute({storage:"int16",default:-1},!1),this._nodeFlexArrays=this._modules.graphics.getNodeAttributes(),this._edgeFlexArrays=this._modules.graphics.getEdgeAttributes(),this._edgeSourceList=this._modules.graph.getEdgeAttribute("source"),this._edgeTargetList=this._modules.graph.getEdgeAttribute("target"),this._hasPulses=new ra(this._modules.graph)}_onElementsAttributeChange(t,e,s=!0){if(!e.includes("pulse.enabled"))return;const{valid:i,invalid:n}=Py(this._modules.graph,t,o=>o.getAttribute("pulse.enabled")&&o.isVisible());this._hasPulses.removeElements(n),this._hasPulses.addElements(i);const r=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let o=0;o<i.size;o++)r.get(i._indexes[o])>0||r.set(i._indexes[o],il);this._removePulses(n)}_removePulses(t){const e=t.isNode?this._nodePulses:this._edgePulses,s=t.isNode?this._nodePromiseMap:this._edgePromiseMap;for(let i=0;i<t._indexes.length;i++){const n=t._indexes[i],r=e.get(n);if(r){for(let a=0;a<r.length;a++){const l=r[a];this._modules.graphics.releaseGraphicsEngineBlockId(l.blockId)}e.set(n,null);const o=s.get(n);o&&(o.resolve(),s.delete(n))}}}_refreshElementsPulses(t,e){const s=t.isNode,i=s?this._nodePulses:this._edgePulses,n=s?this._nodeFlexArrays.pulse.duration:this._edgeFlexArrays.pulse.duration,r=s?"_createNodePulseBlock":"_createEdgePulseBlock",o=s?this._nodeFlexArrays.pulse.interval:this._edgeFlexArrays.pulse.interval,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let l=0;l<t._indexes.length;l++){const d=t._indexes[l];let h=i.get(d);h||(h=[],i.set(d,h));for(let f=0;f<h.length;f++){const{startTime:p,duration:_,blockId:y}=h[f];e>=p+_&&(this._modules.graphics.releaseGraphicsEngineBlockId(y),h.splice(f--,1))}const u=h[h.length-1];if(u&&e<u.startTime+o.get(d))continue;const c=n.get(d),g=a.get(d);if(g<1&&g!==il)continue;h.push({blockId:this[r](d,e,c),startTime:e,duration:c});const m=g===il?il:g-1;a.set(d,m)}}_createNodePulseBlock(t,e,s){const i=this._nodeFlexArrays,n=i.color.get(t),r=i.layer.get(t),o=i.x.get(t),a=i.y.get(t),l=i.radius.get(t),d=i.scalingMethod.get(t)==="scaled",h=i.pulse.startRatio.get(t),u=i.pulse.endRatio.get(t),c=i.pulse.width.get(t),g=2*l*h,m=2*l*u,f=Bo(r).nodeBody,p=i.pulse.startColor.get(t),_=i.pulse.endColor.get(t),y=this._modules.graphics.allocateGraphicsEngineBlockId(),x=this._group.reset(Bs,!0,f),b=x.nextAndReset(),v=Ys(p,n),A=Ys(_,n);return b.end.shape="circle",b.end.pieceId=Ls,b.end.x1=o,b.end.y1=a,b.end.x2=o,b.end.y2=a,b.end.rectWidthOrSourceRadiusScaled=d?m:0,b.end.rectHeightOrTargetRadiusScaled=d?m:0,b.end.rectWidthOrSourceRadiusFixed=d?0:m,b.end.rectHeightOrTargetRadiusFixed=d?0:m,b.end.strokeWidthFixed=c,b.end.strokeColor=A,b.start.shape="circle",b.start.pieceId=Ls,b.start.x1=o,b.start.y1=a,b.start.x2=o,b.start.y2=a,b.start.rectWidthOrSourceRadiusScaled=d?g:0,b.start.rectHeightOrTargetRadiusScaled=d?g:0,b.start.rectWidthOrSourceRadiusFixed=d?0:g,b.start.rectHeightOrTargetRadiusFixed=d?0:g,b.start.strokeWidthFixed=c,b.start.strokeColor=v,b.animation.duration=s,b.animation.beginTime=e,this._engine.storeGroup(y,x),y}_createEdgePulseBlock(t,e,s){const i=this._edgeFlexArrays,n=this._nodeFlexArrays,r=i.pulse.startRatio.get(t),o=i.pulse.endRatio.get(t),a=i.pulse.startColor.get(t),l=i.pulse.endColor.get(t),d=Bo(i.layer.get(t)).edgeBody,h=this._edgeSourceList.get(t),u=this._edgeTargetList.get(t),c=i.curvature.get(t),g=c!==0,m=this._modules.graphics.allocateGraphicsEngineBlockId(),f=this._group.reset(g?sd:Bs,!0,d),p=f.nextAndReset(),_={isSelfLoop:h===u,curvature:c,sourceX:n.x.get(h),sourceY:n.y.get(h),targetX:n.x.get(u),targetY:n.y.get(u),sourceRadius:n.radius.get(h),targetRadius:n.radius.get(u),isSourceRadiusScaled:n.scalingMethod.get(h)==="scaled",isTargetRadiusScaled:n.scalingMethod.get(u)==="scaled",width:i.width.get(t),isWidthScaled:i.scalingMethod.get(t)==="scaled",strokeWidth:i.pulse.width.get(t)};return f_(p.start,_),f_(p.end,_),p.start.strokeColor=a,p.end.strokeColor=l,p.start.thicknessOrFontSizeScaled*=r,p.start.thicknessOrFontSizeFixed*=r,p.end.thicknessOrFontSizeScaled*=o,p.end.thicknessOrFontSizeFixed*=o,p.animation.duration=s,p.animation.beginTime=e,this._engine.storeGroup(m,f),m}pulse(t,e){const s=t.isNode,i={...s?gO:mO,...s?this._nodePulseTheme:this._edgePulseTheme,...e},n=i.number,r=i.interval,o=i.duration,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining,l=(n-1)*r+o;let d;i.enabled=!0,delete i.number,t.setAttributes({pulse:i}),a.setMultiple(t._indexes,n),this._modules.dom.setTimeout(()=>{t.isList?t.filter(qs).setAttribute("pulse.enabled",!1):t.setAttribute("pulse.enabled",!1),a.setMultiple(t._indexes,-1)},l);const h=new Promise(c=>{d=()=>c(t)}),u=t.isNode?this._nodePromiseMap:this._edgePromiseMap;return t.isList?t._indexes.forEach(c=>{this._setPromise(c,u,h,d)}):this._setPromise(t._index,u,h,d),h}_setPromise(t,e,s,i){e.has(t)&&e.get(t).resolve(),e.set(t,{promise:s,resolve:i})}setTheme(t,e){this._nodePulseTheme=t,this._edgePulseTheme=e}};function f_(t,{sourceX:e,sourceY:s,targetX:i,targetY:n,isSourceRadiusScaled:r,isTargetRadiusScaled:o,targetRadius:a,sourceRadius:l,isWidthScaled:d,width:h,strokeWidth:u,curvature:c,isSelfLoop:g}){t.pieceId=Nd,t.shape="line",t.x1=e,t.y1=s,t.x2=i,t.y2=n,t.rectWidthOrSourceRadiusScaled=r?l:0,t.rectWidthOrSourceRadiusFixed=r?0:l,t.rectHeightOrTargetRadiusScaled=o?a:0,t.rectHeightOrTargetRadiusFixed=o?0:a,t.thicknessOrFontSizeScaled=d?h:0,t.thicknessOrFontSizeFixed=d?0:h,t.strokeWidthFixed=u,t.curvature=c,t.isSelfLoop=g}var pO={duration:0,easing:"linear",callback:Xt,resolve:Xt,startAfter:0},_O=0,yO=class extends Ot{constructor(){super(...arguments),this._animationList=[],this._update=()=>{if(this._animationList.length===0)return;const t=Xe(),e=[];for(let s=0;s<this._animationList.length;++s){const i=this._animationList[s],n=(t-i.creationDate)/i.duration,r=i.startAfter;let o=i.easing(n);n>=1?(i.func(1),i.done=!0,i.resolve(void 0),this._animationList.splice(s,1),s-=1,e.push(i.callback)):o>=r&&(o=(o-r)*(1/(1-r)),i.func(o))}for(let s=0;s<e.length;s++)e[s](!1);this._modules.dom.refresh()}}onMounted(){this._modules.events.on("beforeNewFrame",this._update)}play(t,e){const{duration:s,easing:i,callback:n,startAfter:r,resolve:o}=fs(e,pO);if(s<=0)return t(1),n(),o(void 0),null;const a={func:t,easing:typeof i=="function"?i:hg[i],duration:s,callback:n,resolve:o,startAfter:r,creationDate:Xe(),done:!1,id:++_O};return this._animationList.push(a),this._modules.dom.refresh(),a}cancel(t){const e=this._animationList.indexOf(t);e!==-1&&(t.func(1),this._animationList.splice(e,1),t.done=!0,t.resolve(void 0))}},xg=t=>typeof t.export=="function",xO=(t,e,s,i)=>{const n=s._getMapPanePos(),r=t.getMapboxMap(),o=t.getCanvas(),a=t.getSize().round(),l=i.DomUtil.getPosition(t.getContainer()),d=l.x+n.x,h=l.y+n.y;return new Promise(u=>{function c(){e.drawImage(o,d,h,a.x,a.y),u()}if(r.loaded())return c();r.once("idle",c)})},bO=(t,e,s,i,n)=>{if(xg(t))return t.export(e);const r=s._getMapPanePos(),o=t.getContainer();if(!o)throw new Error(`Trying to access the container of ${t} but it does not exist.`);const a=i.DomUtil.getPosition(o);s.removeLayer(t),t.options.crossOrigin="anonymous";const l=[],d=[];return t.on("tileload",({tile:h})=>{const{x:u,y:c}=i.DomUtil.getPosition(h);l.push(h),d.push({x:u-a.x+r.x,y:c-a.y+r.y})}),s.addLayer(t),new Promise(h=>{t.once("load",()=>{const u=t.getTileSize();l.forEach((c,g)=>{const{x:m,y:f}=d[g];e.drawImage(c,m,f,u.x,u.y)}),h()})})},vO=(t,e,s,i,n,r)=>new Promise(o=>{const a=t.options.renderer;s.removeLayer(t),t.options.renderer=r,s.addLayer(t),r._updatePaths();const l=s._getMapPanePos(),d=r._container,h=i.DomUtil.getPosition(d);e.drawImage(r._container,h.x+l.x,h.y+l.y,d.width/n,d.height/n),s.removeLayer(t),t.options.renderer=a,s.addLayer(t),o()}),AO=(t,e,s,i,n)=>new Promise(r=>{if(xg(t))return t.export(e).then(r);const o=s.getPixelBounds().min,a=s.project(t.getLatLng(),s.getZoom());if(!t._icon||t._icon.tagName!=="IMG")return r();const l=/^data:/.test(t._icon.src),d=l?t._icon.src:vA(t._icon.src),h=new Image,u=t.options.icon;if(u){const c=u.options;let g=c.iconSize||[24,24];const m=a.subtract(o);let f=c.iconAnchor||[0,0];Array.isArray(g)||(g=[g.x,g.y]),Array.isArray(f)||(f=[f.x,f.y]);const p=Math.round(m.x-(g[0]-f[0])*n),_=Math.round(m.y-f[1]*n);h.crossOrigin="";const y=()=>{e.drawImage(h,p,_,g[0]*n,g[1]*n),r()};h.onload=y,h.src=d,l&&y()}});function EO(t){if(t.options.pane==="overlayPane"&&"getElement"in t){const e=t.getElement();return e&&e.tagName.toLowerCase()==="canvas"}return!1}var SO=(t,e,s,i,n)=>new Promise(r=>{const o=t.getElement(),a=o.width,l=o.height;e.drawImage(o,0,0,a,l),r()}),wO=(t,e,s,i,n)=>new Promise(r=>{s.removeLayer(t),t.setUrl(vA(t.getUrl())),t.options.crossOrigin="anonymous",t.once("load",()=>{const o=t.getBounds(),a=s.latLngToContainerPoint(o.getNorthWest()),l=s.latLngToContainerPoint(o.getSouthEast()),d=l.x-a.x,h=l.y-a.y;e.drawImage(t._image,a.x,a.y,d,h),r()}),s.addLayer(t)});function vA(t){return t+(t.indexOf("?")===-1?"?":"&")+"noCache="+Date.now()}var TO={tileLayers:bO,imageOverlays:wO,canvasOverlays:SO,vectorLayers:vO,markers:AO,vectorMap:xO};function IO(t,e){return t instanceof e.TileLayer||t.options.pane==="tilePane"&&xg(t)?"tileLayers":EO(t)?"canvasOverlays":t instanceof e.ImageOverlay?"imageOverlays":t instanceof e.Path?"vectorLayers":t instanceof e.Marker?"markers":"MapboxGL"in e&&t instanceof e.MapboxGL?"vectorMap":void 0}function LO(t,e,s,i,n,r){const o={vectorMap:[],tileLayers:[],vectorLayers:[],canvasOverlays:[],imageOverlays:[],markers:[]};return e.eachLayer(a=>{if(a!==t){const l=IO(a,i);if(l&&l in o){const d=TO[l];o[l].push(()=>d(a,s,e,i,n,r))}}}),o}function CO(t){t.TileLayer.prototype.getUrl=function(){return this._url},t.ImageOverlay.prototype.getUrl=function(){return this._url};const e="leaflet-zoom-animated";t.OgmaOverlay||(t.OgmaOverlay=t.Layer.extend({options:{pane:"overlayPane",padding:0,onUpdate:()=>{}},initialize:function(s){const{container:i}=s;t.Util.setOptions(this,s),this._container=i},setLocked:function(s){return this._locked=s,this},onAdd:function(s){this._map=s,this.getPane().appendChild(this._container),this._wgsOrigin=t.latLng([0,0]),this._wgsInitialShift=s.project(this._wgsOrigin,this._initialZoom),t.DomUtil.addClass(this._container,"leaflet-layer"),this._zoomAnimated&&(t.DomUtil.addClass(this._container,e),this._container.style.position="absolute",this._container.style.zIndex=9999),this._initialZoom=(this._map.getMaxZoom()+this._map.getMinZoom())/2,this._mapInitialZoom=this._map.getZoom(),this._updateBounds(),this._update({})},_updateBounds(){const s=this.options.padding,i=this._map.getSize(),n=this._map.containerPointToLayerPoint(i.multiplyBy(-s));this._bounds=new t.Bounds(n,n.add(i.multiplyBy(1+2*s))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_update(s){this._updateBounds(),this._redraw(this._bounds.min,s),this._positionTimer=t.Util.requestAnimFrame(()=>{this._container&&t.DomUtil.setPosition(this._container,this._bounds.min)})},_redraw(s,i){this.options.onUpdate()},_updateTransform(s,i){if(this._locked)return;const n=this._map.getZoomScale(i,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,i),a=r.multiplyBy(-n).add(o).subtract(this._map._getNewPixelOrigin(s,i));t.Browser.any3d?t.DomUtil.setTransform(this._container,a,n):t.DomUtil.setPosition(this._container,a)},_onZoom(s){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveEnd(s){this._update(s)},_onAnimZoom({center:s,zoom:i}){this._updateTransform(s,i)},bringToFront(){t.DomUtil.toFront(this._container)},getEvents(){return{zoom:this._onZoom,moveend:this._onMoveEnd,zoomanim:this._onAnimZoom,layeradd:this.bringToFront,zoomend:this.options.onUpdate}},onRemove:function(){t.DomUtil.removeClass(this._container,e);const s=this._container;["transform","webkitTransform","OTransform","MozTransform","msTransform","zIndex","position"].forEach(i=>s.style[i]=null),t.Util.cancelAnimFrame(this._positionTimer),this._container=null}}))}function NO(t,e,s,i){const n=t.filter(A=>A.isVisible()),r=n.size===0,{mapX:o,mapY:a}=n.reduce((A,E)=>{const{latitude:S,longitude:w}=E.getGeoCoordinates(),{x:T,y:L}=i(S,w);return A.mapX.push(T),A.mapY.push(L),A},{mapX:[],mapY:[]}),l=n.getAttribute("x"),d=n.getAttribute("y"),h=n.getAttribute("radius").map(Number),u=new rs({xValues:l,yValues:d,scaledSizeValues:h}),c=new rs({xValues:o,yValues:a});r&&(u.cx=u.cy=0,u.width=u.height=0),isFinite(c.width)&&isFinite(c.height)||(c.cx=c.cy=0,c.width=c.height=0);let g=c.cx-u.cx,m=c.cy-u.cy;const f=r?1:Math.max(c.width,c.height)/Math.max(u.width,u.height),[p,_]=h.reduce((A,E)=>(A[0]=Math.min(A[0],E*f),A[1]=Math.max(A[1],E*f),A),[1/0,0]);c.pad(_),c.minScaledSize=p,c.maxScaledSize=_;const y=s.computeConfigForBounds(c),x=e.zoom/Pw(y.zoom);g+=(u.cx-e.x)*x,m+=(u.cy-e.y)*x;const b=u.cx+g,v=u.cy+m;return{offsetChanges:{name:"graph-to-geo",nodeAttributes:{radius:A=>Number(A.getAttribute("radius"))*x,x:A=>(A.getAttribute("x")+g-b)*x+b,y:A=>(A.getAttribute("y")+m-v)*x+v},edgeAttributes:{width:A=>Number(A.getAttribute("width"))*x}},camera:{zoom:e.zoom/x,x:(e.x+g-b)*x+b,y:(e.y+m-v)*x+v,angle:0,...e.getSize()}}}function MO(t,e,s,i){const n=t.getAttributes(["x","y","radius"]),r=t.getBoundingBox(),o=t.size===0,a=t.reduce((b,{_index:v},A)=>(b[v]=A,b),{});i();const l=t.getAttribute("x"),d=t.getAttribute("y"),h=t.getAttribute("radius"),u=new rs({xValues:l,yValues:d,scaledSizeValues:h.map(b=>2*b)});o&&(r.reset(),u.reset());let c=u.cx-r.cx,g=u.cy-r.cy,m=0,f=0;const p=s.computeConfigForBounds(u),_=e.zoom/p.zoom;let y,x;return isNaN(r.cx)||isNaN(r.cy)?(r.cx=e.x,r.cy=e.y,y=p.x,x=p.y):(c+=(r.cx-e.x)*_,g+=(r.cy-e.y)*_,m=r.cx+c,f=r.cy+g,y=(e.x+c-m)*_+m,x=(e.y+g-f)*_+f),{offsetChanges:{name:"geo-to-graph",nodeAttributes:{x:b=>(n[a[b._index]].x+c-m)*_+m,y:b=>(n[a[b._index]].y+g-f)*_+f}},camera:{zoom:p.zoom,x:y,y:x,angle:0,...e.getSize()}}}var AA={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"},RO={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"},p_={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:void 0},FO=class extends Ot{onMounted(){this._brand=null}set(t,e){let{position:s,horizontalMargin:i,verticalMargin:n,className:r}={...p_,...e};AA[s]||(s=p_.position),this.remove();const o=document.createElement("div");return Iy(o,bc.sanitize(t)),o.style.position="absolute",EA(o,s,i,n),o.style.zIndex="10",r&&o.setAttribute("class",r),this._brand=o,this._modules.dom.setLayer("brand",this._brand),o}remove(){this._modules.dom.setLayer("brand",null),this._brand=null}};function EA(t,e,s,i){const n=s===void 0?"":s+"px",r=i===void 0?"":i+"px";t.style[AA[e]]=n,t.style[RO[e]]=r}var __={},PO=class extends Ot{constructor(){super(...arguments),this._enabled=!1,this._settings={...gn},this._edgesOriginalTextStyle={},this._nodesOriginalTextStyle={},this._nodeDraggingSetting=!1,this._transition=!1,this._attribution=null,this._updating=!1,this._updateRate=50,this._x=0,this._y=0,this._onCameraUpdate=t=>{if(this.L&&this._enabled&&this._map&&this._map._loaded){const e=this._x-this._modules.camera.x,s=this._y-this._modules.camera.y;(e||s)&&this._syncMapWithCamera()}},this._syncMapWithCamera=()=>{if(!this._map)return;this._updating||(this._updating=!0,this._layer.setLocked(!0),this._map._moveStart(!0,!1));const t=this._fromPointToLatLng(this._modules.camera.x,this._modules.camera.y),e=Zd(this._modules.camera.zoom),s=this.L.latLng(t.latitude,t.longitude);this._map._move(s,e,{pinch:!0,round:!1}),clearTimeout(this._updateRequest),this._updateRequest=this._modules.dom.setTimeout(()=>{this._updating=!1,this._layer.setLocked(!1),this._map&&this._map._move(s,e,{pinch:!0})._moveEnd(!0)},this._updateRate)},this._onNodesDragStart=()=>{this._enabled&&(this._setMapDragging(!1),this._nodeDragOffsetX=this._nodeDragOffsetY=0)},this._onNodesDragged=({nodes:t,dx:e,dy:s})=>{if(this._enabled){const i=t.map(n=>{const{x:r,y:o}=n.getAttributes(["x","y"]);return this._fromPointToLatLng(r+e-this._nodeDragOffsetX,o+s-this._nodeDragOffsetY)});return this._nodeDragOffsetX=e,this._nodeDragOffsetY=s,t.setGeoCoordinates(i)}return Promise.resolve(this._modules.graph.nodeList())},this._onMapUpdate=()=>{if(!this._map)return Promise.resolve(void 0);const{lat:t,lng:e}=this._map.getCenter(),s=this._fromLatLngToPoint(t,e);this._x=s.x,this._y=s.y;const i=Fw(this._map.getZoom());return this._modules.events.fire("beforeGeoCameraMove",{zoom:this._map.getZoom()}),this._modules.camera.setView({zoom:i,x:s.x,y:s.y},{ignoreZoomLimits:!0}).then(()=>this._adjustMinvisibleSizes())},this.runLayout=async({type:t,nodes:e,latitudePath:s=ei,longitudePath:i=si,options:n,center:r})=>{const o=Zw(r),a=o([r.longitude,r.latitude]),l=e.getPosition(),d=[];return e.setAttributes(e.map(h=>{const u=h.getData(s),c=h.getData(i);if(isNaN(u)||isNaN(c))return{x:a[0],y:a[1]};const g=o([c,u]);return{x:g[0],y:g[1]}})).then(()=>this._ogma.layouts[t]({...n,nodes:e,dryRun:!0})).then(h=>{const u=h.positions.current,c=new Array(u.length),g=new Array(u.length),m=new Array(u.length).fill(10);u.forEach((y,x)=>{const b=o.invert([y.x,y.y]);c[x]=b[1],g[x]=b[0],d.push({latitude:b[1],longitude:b[0]})});const f=Qo(g,c,m),p=f[0]-r.longitude,_=f[1]-r.latitude;for(let y=0;y<d.length;y++)c[y]-=_,g[y]-=p,d[y].latitude-=_,d[y].longitude-=p;return e.setData(s,c),e.setData(i,g),e.setAttributes(l)}).then(()=>this._ogma.modules.geo._updateNodesCoordinates(e)).then(()=>d)}}onMounted(){this._modules.events.register(["geoEnabled","beforeGeoDisabled","geoDisabled","geoNodesMoved","geoLoaded","geoReady"]),lm()&&(this.L=Ts("L")||Ts("leaflet"),this.L&&CO(this.L)),this._modules.graph.createNodeAttribute({name:"geo.prevLat",storage:"float"},!0),this._modules.graph.createNodeAttribute({name:Hd,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:ei,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:si,storage:"float"},!0),this._modules.events.register(["beforeGeoCameraMove"]),this._modules.events.on("addNodes",t=>{t.virtual||this._refreshOrAddNodes(t.nodes,!0)}).on("updateNodeData",t=>{this._onDataChange(t.changes)}).on("nodesDragProgress",this._onNodesDragged).on(["nodesDragStart","lassoEnabled"],this._onNodesDragStart).on(["nodesDragEnd","lassoDisabled"],()=>this._setMapDragging(!0)).on("viewChanged",this._onCameraUpdate)}_onDataChange(t){const e=Gh(this.latitudePath),s=Gh(this.longitudePath),i=t.filter(({virtual:r,property:o,newValues:a})=>!(r||!a.length)&&(o&&typeof o!="string"?o.find(l=>e.startsWith(l)||s.startsWith(l)):o===null||e.startsWith(o)||s.startsWith(o)));if(!i.length)return;const n=Hw(i);n&&(this._modules.events.fire("geoNodesMoved",{nodes:n}),this._refreshOrAddNodes(n,!1))}_refreshOrAddNodes(t,e){e&&this._updatePrevNodesCoordinates(t),this._updateNodesCoordinates(t),this._enabled&&(this._cacheOriginalTextStyles(t,null),this._filter.refresh())}_updatePrevNodesCoordinates(t){ba(this._modules.graph,t,ei,Yg),ba(this._modules.graph,t,si,Hd)}_restorePrevNodesCoordinates(t){ba(this._modules.graph,t,Yg,ei),ba(this._modules.graph,t,Hd,si)}_updateNodesCoordinates(t){qw(this._modules.graph,t,this._settings)}_createMapTileLayer(t,e,s){if(t&&!Ne(t))return t;const i=t,n=i.wms?this.L.tileLayer.wms:this.L.tileLayer,r=zw(i,e)||"";return n(i.url,{attribution:r,maxZoom:s,...t})}_setupTileLayer(t,e,s,i){const n=this._createMapTileLayer(t,e,i);return n.once("load",()=>{this._modules.events.fire("geoLoaded")}),n.addTo(this._map),am(n,s),n}_onSettingsChanged(t,e){const s=t.wrapCoordinates!==e.wrapCoordinates,i=t.latitudePath!==e.latitudePath||t.longitudePath!==e.longitudePath;if(s||i){let n=Promise.resolve();this._enabled&&this._filter&&(n=n.then(()=>this._filter.refresh())),n.then(()=>this._updateNodesCoordinates(this._modules.graph.getNodes("all")))}this._enabled&&(kw(t,e)&&this._map&&(this._map.removeLayer(this._tileLayer),this._tileLayer=this._setupTileLayer(e.tiles,e.attribution,e.opacity,e.maxZoomLevel)),t.sizeRatio!==e.sizeRatio&&this._updateSizes(),t.maxZoomLevel!==e.maxZoomLevel&&(this._modules.settings.update({minZoom:1,maxZoom:Math.pow(2,e.maxZoomLevel)}),this._map?.setMaxZoom(e.maxZoomLevel),this._tileLayer&&this._tileLayer.options&&(this._tileLayer.options.maxZoom=e.maxZoomLevel)),t.disableNodeDragging!==e.disableNodeDragging&&this._setDragging(!e.disableNodeDragging),t.attributionOptions!==e.attributionOptions&&this._setAttributionOptions(e.attributionOptions,e.attribution),am(this._tileLayer,e.opacity))}_setMapDragging(t){if(this._map){const e=t?"enable":"disable";this._map.dragging[e]()}}_fromLatLngToPoint(t,e){return this._map.options.crs.latLngToPoint(this.L.latLng(t,e),Bl)}_fromPointToLatLng(t,e){const{lat:s,lng:i}=this._map.options.crs.pointToLatLng(this.L.point({x:t,y:e}),Bl);return{latitude:s,longitude:i}}_updateSizes(){this._enabled&&this._projection&&this._projection.updateAll()}enable(t){return this.setEnabled(!0,t)}getMap(){return this._enabled?this._map:null}getOptions(){return this._enabled?{...this._settings,tiles:Ne(this._settings.tiles)?{...this._settings.tiles}:this._settings.tiles}:{...gn}}setOptions(t){if(!this._enabled||this._transition)return;Dw(t,this.L);const e=this._settings;this._settings={...gn,...e,...t,tiles:Ow(gn,t)},this._onSettingsChanged(e,this._settings)}disable(t){return this.setEnabled(!1,t)}isEnabled(){return this._enabled}toggle(t={}){return this.setEnabled(!this._enabled,t)}getContainerCoords(t){return t.getGeoCoordinates().map(({latitude:e,longitude:s})=>this._map.latLngToContainerPoint([e,s]))}getContainerCoord(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return this._map.latLngToContainerPoint([e||0,s||0])}setEnabled(t,e){if(!lm())throw new Error("Ogma Geo cannot be used outside a browser");if(!this.L)throw new Error("You are trying to use Geo mode but Leaflet has not been found. Please follow our migration guide: https://bit.ly/2SYkF8A");if(this._transition||t===this._enabled)return Promise.resolve();const s=this._modules.settings;this._enabled||(this._prevSettings=s.get(),this._nodeDraggingSetting=!!s.get("interactions.drag.enabled")),this._enabled=t,this.setOptions(e),this._transition=!0;const i=this._settings;return t?this._show().then(()=>(this._registerTextStyle(this._modules.graph.getNodes(),this._modules.graph.getEdges()),this._setDragging(!i.disableNodeDragging),this._transition=!1,this._updating=!1,this._modules.events.fire("geoEnabled").fire("geoReady"),this._adjustMinvisibleSizes())):this._restoreTextStyle().then(()=>this._hide()).then(()=>{this._transition=!1,this._modules.events.fire("geoDisabled"),this._setDragging(this._nodeDraggingSetting,!0)}).then(()=>this._ogma.view.afterNextFrame())}destroy(){return this._enabled&&this._destroyMapSync(),Promise.resolve()}_cacheOriginalTextStyles(t,e){e&&(this._edgesOriginalTextStyle=hm(e,this._edgesOriginalTextStyle)),t&&(this._nodesOriginalTextStyle=Xw(t,this._nodesOriginalTextStyle))}_registerTextStyle(t,e){this._cacheOriginalTextStyles(t,e);const{nodeAttributes:s,edgeAttributes:i}=this._modules.hover.getHoverClassDefinition();this._hoverEdgesOriginalTextStyle=i||null,this._hoverNodesOriginalTextStyle=s||null,this._modules.hover.updateEdgeAttributes({text:{size:n=>(this._edgesOriginalTextStyle[n.getId()]||__)["text.size"]}}),this._modules.hover.updateNodeAttributes({text:{size:n=>(this._nodesOriginalTextStyle[n.getId()]||__)["text.size"]}})}_restoreTextStyle(){return this._modules.hover.updateEdgeAttributes(this._hoverEdgesOriginalTextStyle,!0),this._modules.hover.updateNodeAttributes(this._hoverNodesOriginalTextStyle,!0),Promise.all([Ww(this._modules.graph.getEdges(),this._edgesOriginalTextStyle)]).then(()=>(this._edgesOriginalTextStyle=hm(this._modules.graph.edgeList(),{}),this._nodesOriginalTextStyle={},this._edgesOriginalTextStyle={},Promise.resolve()))}_setDragging(t,e=!1){this._modules.settings.update({interactions:{drag:{enabled:t,applyResult:e}}})}_setAttributionOptions(t,e){if(this._map){if(this._attribution&&(this._attribution.remove(),this._attribution=null),this._attribution=this.L.control.attribution({prefix:!1}).addTo(this._map),Ne(t)){this._attribution.setPrefix(""),t.position=t.position||"bottom-right";const s=t.position.replace("-","");this._attribution.setPosition(s);const i=this._attribution.getContainer();i&&(t.className&&this.L.DomUtil.addClass(i,t.className),EA(i,t.position||"bottom-right",t.horizontalMargin,t.verticalMargin))}e!=null&&this._attribution.addAttribution(e)}}_nodeIsVisible(t){return jw(t,this._settings,this._hasCustomProjection())}_updateSettingsForMap(){const t=this._modules.graphics.getGraphicsEngine().parseColor(this._settings.backgroundColor);t[3]=0,this._modules.settings.update({backgroundColor:ub(t),minZoom:1e-6,interactions:{rotation:{enabled:!1},drag:{enabled:!1},pan:{enabled:!1},zoom:{enabled:!1,onDoubleClick:!1}},mouse:{wheelEnabled:!1}})}getGraphPosition(t){const e=this.L.latLngBounds(Gw(t));return{center:t.size>0?e.getCenter():this.L.latLng([0,0]),zoom:this._clampZoom(this._map.getBoundsZoom(e))}}_initMap(){this._updateSettingsForMap(),this._mapContainer=Uw(this._modules.dom.getContainer());const t={...HS,minZoom:this._settings.minZoomLevel,maxZoom:this._settings.maxZoomLevel};this._hasCustomProjection()&&(t.crs=this._settings.crs,t.worldCopyJump=!1,t.maxBoundsViscosity=0),this._map=new this.L.Map(this._mapContainer,t),this._map.on("movestart zoomstart",()=>{this._updating=!0}).on("moveend zoomend",()=>{this._updating=!1}),this._setAttributionOptions(this._settings.attributionOptions,this._settings.attribution),this._setupLayers()}_clampZoom(t){let e=this._tileLayer.options.maxZoom;return e===void 0&&(e=1/0),Math.min(t,e)}_show(){let t;return this._initMap(),this._filter?t=this.filter.enable(0):(this._filter=this._modules.transformations.api.addNodeFilter({criteria:e=>this._nodeIsVisible(e)}),this._filter.setIndex(0),t=this._filter.whenApplied()),t.then(()=>{const e=this._map,s=this._modules.graph.getNodes(),i=this._modules.graph.getEdges(),{center:n,zoom:r}=this.getGraphPosition(s),{offset:o,newCameraView:a}=this._transformToGeo();return this._modules.camera.setView(a,{ignoreZoomLimits:!0}).then(()=>(this._updatePrevNodesCoordinates(s),e.setView(n,r,{animate:!1}),this._modules.graphics.animate({nodes:s,edges:i},()=>{this._projection=this._createFinalPositionLayer()},!0,this._settings.duration))).then(()=>o.destroy())})}updateProjection(){this._projection?.update()}_hasCustomProjection(){return this._settings.crs!=null}_setupLayers(){this._settings.tiles&&(this._tileLayer=this._setupTileLayer(this._settings.tiles,this._settings.attribution,this._settings.opacity,this._settings.maxZoomLevel)),this._layer=new this.L.OgmaOverlay({container:this._modules.graphics.getDomElement(),mapContainer:this._mapContainer,onUpdate:()=>this._onMapUpdate()}),this._layer.addTo(this._map)}_adjustMinvisibleSizes(){return Promise.all([$w(this._modules.graph.getEdges(),this._edgesOriginalTextStyle,this._map.getZoom())])}_hide(){if(!this._map)return Promise.resolve();this._modules.settings.update(this._prevSettings);const t=this._map;t.removeLayer(this._layer);const e=this._modules.dom.getContainer(),s=this._modules.graphics.getDomElement();e&&e.appendChild(s),t.getContainer().style.zIndex="0";const i=this._modules.graph.getNodes("all"),n=this._modules.graph.getEdges("all"),{offset:r,newCameraView:o}=this._transformToGraph();return this._modules.camera.setView(o||{}).then(()=>(this._modules.events.fire("beforeGeoDisabled"),Promise.all([ux(t.getContainer(),1,0,this._settings.duration/2).then(()=>this._destroyMapSync()),this._modules.graphics.animate({nodes:i,edges:n},()=>r&&r.destroy(),!0,this._settings.duration)]))).then(()=>(this._map=null,this._filter.disable(0).then(()=>{})))}_destroyMapSync(){if(this._map){this._layer&&this._layer._map&&this._map.removeLayer(this._layer),this._map.remove(),this._map._animatingZoom=!1,this._map=null;const t=this._mapContainer.parentNode;t&&t.removeChild(this._mapContainer)}}_transformToGeo(){const t=this._modules.graph.getNodes(),{offsetChanges:e,camera:s}=NO(t,this._modules.camera,this._modules.locate,(i,n)=>this._fromLatLngToPoint(i,n));return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}_addGraphAttributesLayer(t){return this._modules.graphics.addAttributeLayer({priority:H1,nodeSelector:e=>e.isVisible(),edgeSelector:e=>e.isVisible(),...t})}_transformToGraph(){const t=this._modules.graph.getNodes("all"),{offsetChanges:e,camera:s}=MO(t,this._modules.camera,this._modules.locate,()=>{this._projection&&(this._projection.destroy(),this._projection=null)});return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}getPointFromLatLng(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return e==null?t.getAttributes(["x","y"]):this._fromLatLngToPoint(e,s)}_createFinalPositionLayer(){return this._addGraphAttributesLayer({name:"graph-2-geo-animation",nodeAttributes:{scalingMethod:"fixed",radius:t=>Number(t.getAttribute("radius"))*this._settings.sizeRatio,x:t=>this.getPointFromLatLng(t).x,y:t=>this.getPointFromLatLng(t).y},edgeAttributes:{scalingMethod:"fixed",width:t=>Number(t.getAttribute("width"))*this._settings.sizeRatio}})}setCenter(t,e){return this._enabled?this.setView(t,e,Zd(this._modules.camera.getZoom())):Promise.resolve()}setZoom(t){return this._enabled&&this._map?(t=this._clampZoom(t),this._map.setZoom(t),new Promise(e=>{const s=this._map;if(s.getZoom()===t)return e(void 0);s.once("moveend zoomend",e)}).then(this._onMapUpdate)):Promise.resolve()}zoomIn(){return this.setZoom(this.getZoom()+1)}zoomOut(){return this.setZoom(this.getZoom()-1)}setView(t,e,s){if(!this._enabled||!this._map)return Promise.resolve();const i=this._map;s=this._clampZoom(s);const n=this.L.latLng([t,e]);return i.setView(n,s,{animate:!1,reset:!0}),new Promise(r=>{if(i.getZoom()===s&&i.getCenter().equals(n))return r(void 0);i.once("moveend zoomend",r)}).then(this._onMapUpdate)}getView(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{zoom:this._map.getZoom(),latitude:t.lat,longitude:t.lng}}getCenter(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{latitude:t.lat,longitude:t.lng}}getZoom(){if(this._enabled&&this._map)return this._map.getZoom()}resetCoordinates(){if(!this._enabled||!this._projection)return;const t=this._modules.graph.getNodes();this._restorePrevNodesCoordinates(this._modules.graph.getNodes());const e=this._modules.graph.getNodeAttribute(ei).getMultiple(t._indexes),s=this._modules.graph.getNodeAttribute(si).getMultiple(t._indexes);t.setData(this._settings.latitudePath,e),t.setData(this._settings.longitudePath,s),this._projection.update()}getUnprojectedCoordinates(t){this._projection&&this._projection.destroy();const e=t.getPosition();return this._projection=this._createFinalPositionLayer(),e}get latitudePath(){return this._settings.latitudePath}get longitudePath(){return this._settings.longitudePath}get filter(){return this._filter}exportBackground(t){if(!this._map)return Promise.reject("Map is not ready");const{pixelRatio:e,width:s,height:i,zoom:n,x:r,y:o}=t,a=s*e,l=i*e,d=Ge(a,l),h=d.getContext("2d"),u=this._map;if(!h)throw new Error(`Unable to get 2d context from  ${d}`);const c=this.getView(),g={zoom:Math.round(Zd(n*e)),...this._fromPointToLatLng(r,o)},m=new this.L.Canvas;u.addLayer(m);const{vectorMap:f,tileLayers:p,vectorLayers:_,canvasOverlays:y,imageOverlays:x,markers:b}=LO(this._layer,u,h,this.L,e,m),v=u.options.zoomSnap;return Promise.resolve().then(()=>(Nn(this._mapContainer,a+"px",l+"px"),u.invalidateSize({animate:!1}),this.setView(g.latitude,g.longitude,g.zoom))).then(()=>fy([...f,...p,...y,...x,..._,...b])).then(()=>{Nn(this._mapContainer,"100%","100%"),u.invalidateSize({animate:!1}),u.options.zoomSnap=v,this.setView(c.latitude,c.longitude,c.zoom)}).then(()=>new Promise(A=>this.L.Util.requestAnimFrame(A))).then(()=>u.removeLayer(m)).then(()=>d)}},zO=class extends Ot{constructor(){super(...arguments),this._context={edgesAlwaysCurvy:!1,edgesRoutingStyle:"none",directedEdges:!1}}onMounted(){this._attributeLayer=this._addAttributeLayer(),this._modules.settings.register("edgesAlwaysCurvy",!1,t=>{this._context.edgesAlwaysCurvy=t,this._attributeLayer.updateAll()}),this._modules.settings.register("directedEdges",!1,t=>{this._context.directedEdges=t,this._attributeLayer.updateAll()}),this._modules.settings.register("edgesRoutingStyle","none",t=>{const e=t&&t!=="none",s=t==="vertical",i=this._ogma.modules?.graphics.getGraphicsEngine();i&&i.setBentEdges(e,s),this._attributeLayer.updateAll()})}computeCurvature(t,e="visible",s){const{edgesAlwaysCurvy:i,directedEdges:n}=this._context,r=t.getSource()===t.getTarget();if(!i&&t.hasParallelEdges()===!1&&!r)return 0;let o=t.getParallelEdges({filter:e});s&&(o=o.filter(d=>s(d)));const a=o.indexOf(t);if(a===-1)return 0;let l;if(r)l=(a+1)*Math.max(+t.getAttribute("width")||0,1);else{const d=t.getSource(),h=o.size;if(h===1&&!i)return 0;if(n){let u=0;for(let c=0;c<a;++c)o.get(c).getSource()===d&&(u+=1);l=u+1}else{const u=d!==o.get(0).getSource();l=h%2!=1||i?(1+(a/2|0))*(a%2==0?1:-1)*(u?-1:1):a===0?0:((a+1)/2|0)*(a%2==0?1:-1)*(u?-1:1)}}return l}_addAttributeLayer(){return this._modules.graphics.addAttributeLayer({name:"curvature",priority:V1,edgeDependencies:{parallelEdges:!0},edgeContext:this._context,edgeAttributes:{curvature:t=>this.computeCurvature(t)}})}};/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function DO(t){if(typeof t!="string"||t.trim()===""){let e="Calls to uncheckedconversion functions must go through security review.";throw e+=" A justification must be provided to capture what security assumptions are being made.",new Error(e)}}function qr(t,e){return DO(e.justification),cc(t)}var SA="worker_start",wA="worker_configure",cd="worker_stop",Yo="worker_update",OO=0,TA=class extends ea{constructor(t,e){super(),this._complete=!1,this._busy=!1,this._destroyed=!1,this._data=null,this._onStart=Xt,this._onStop=Xt,this._setIdle=Xt,this._onPause=Xt,this.timer={start:0,steps:0},this._modules=e,this._busy=!1,this.id=++OO,this.configure(t)}configure({configure:t=qs,update:e=Xt,context:s=Xt,stop:i=Xt,isRunning:n=Ol,onStart:r=Xt,onStop:o=Xt,onPause:a=Xt,setIdle:l=Xt}){this._configure=t,this._update=e,this._createContext=s,this._isRunning=n,this._stop=i,this._onStart=r,this._onStop=o,this._setIdle=l,this._onPause=a}setData(t){this._data=t}getData(){return this._data}start(t){this.promise=new Promise((s,i)=>{this.resolve=s,this.reject=i}),this._complete=!1,this._busy=!0,this._onStart(),this.fire(SA,{target:this});const e=this._configure(t,this._modules);return this.fire(wA,e),this.send(e),this}stop(t=!0){return this._complete?Promise.resolve():(this._onStop(),t&&this.send({type:cd}),this.promise.then(()=>{this.fire(cd,{target:this}),this.clearEvents(),this._complete=!0}))}pause(){this._onPause()}setIdle(t){this._setIdle(t)}isBusy(){return!this._complete||this._busy}setBusy(t){this._busy=t}getPromise(){return this.promise}destroy(){this._destroyed||(this._destroyed=!0,this._modules&&(this._busy&&this.stop(),delete this._modules))}},IA=/^function\s*\(/,LA=/^\(|^\w+\s?=>/,kO="Layout control code for the worker",jr={justification:kO};function nl(t){const e=t.toString();return e.indexOf("function")===0||LA.test(e)?e:`function ${e}`}var BO=class extends TA{constructor(t,e){super(t,e);const s=ES([qr(UO(t.imports),jr),Nr`\nconst __CONTEXT = (`,qr(nl(this._createContext),jr),Nr`)();\nconst __UPDATE_FUNC = `,qr(nl(this._update),jr),Nr`\nconst __IS_RUNNING_FUNC = `,qr(nl(this._isRunning),jr),Nr`\nconst __STOP_FN = `,qr(nl(this._stop),jr),Nr`\nlet result;
      self.addEventListener("message", function (evt) {
        if (evt.data && evt.data.type === 'worker_stop') {
          __STOP_FN(__CONTEXT);
          return self.postMessage({ result, isRunning: false, stopped: true });
        }
        result = __UPDATE_FUNC(evt.data, __CONTEXT);
        const isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);
        self.postMessage({ result, isRunning });
      });
    `]);this._worker=Q0(s),this._worker.addEventListener("message",i=>{e.dom.isDestroyed()||this.onWorkerMessage(i)})}onWorkerMessage(t){const e=t.data.isRunning,s=t.data.stopped,i={data:void 0},n={worker:this,workerMessage:t.data.result,modules:this._modules,data:i,isRunning:e};if(!s)return e?(this.fire(Yo,n),this.send(i.data)):(this.fire(Yo,n),this.stop());this.resolve()}destroy(){super.destroy(),this._worker.terminate()}send(t){return this._complete||this._worker.postMessage(K0(t)),this}};function UO(t={}){const e=Object.keys(t),s=[];for(let i=0,n=e.length;i<n;i++){const r=e[i],o=t[r];if(typeof o!="function")throw new Error(`Asynchronous worker: dependency "${r}" is not found`);{const a=GO(o);a?(s.push(y_(o,r)),a!==r&&s.push(`var ${r} = ${a};`)):s.push(`var ${r} = ${y_(o,r)};`)}}return s.join(`
`)}function y_(t,e){const s=t.toString();return IA.test(s)?`function ${t.name||e} ${s.substring(s.indexOf("("))}`:LA.test(s)?`const ${t.name||e} = ${s.toString()}`:s}function GO(t){const e=t.toString();return t.name?t.name:IA.test(e)?null:e.substring(9,e.indexOf("(")).trim()}var VO=class extends TA{constructor(t,e){super(t,e),this._context=this._createContext()}sync(t){if(t&&t.type===cd)return this._stop(this._context),void this.resolve();const e=this._update(t,this._context),s=this._isRunning(this._context,t),i={data:void 0},n={worker:this,workerMessage:e,modules:this._modules,data:i,isRunning:s};return s?(this.fire(Yo,n),this.send(i.data)):(this.fire(Yo,n),this.stop())}send(t){return this._complete||this._modules.dom.setTimeout(()=>{this.sync(t)},0),this}},qO=3,jO=class extends Ot{constructor(){super(...arguments),this._pool={}}create(t,e){const s=e&&Z0,i=this._modules,n=`${t.name||"worker"}-${s?"async":"sync"}`;let r=this._pool[n];r||(r=this._pool[n]=[]);let o=r.find(a=>!a.isBusy());return o?o.configure(t):(o=s?new BO(t,i):new VO(t,i),this._pool[n].push(o)),o.on(cd,()=>{this._pool[n].length<=qO||(o.destroy(),this._pool[n]=this._pool[n].filter(a=>a!==o))}),o}start(t,e){return t.start(e)}run(t,e,s){const i=this.create(t,s);return this.start(i,e)}destroy(){for(const t in this._pool)this._pool[t].forEach(e=>e.destroy()),delete this._pool[t]}},YO=16,x_="cubicOut",b_={duration:300,locate:!1},HO=new Set(["force"]),XO=class extends Ot{constructor(){super(...arguments),this.resolves=new Map,this._batchMode=!1,this._batchStarted=!1,this._batches=new Map,this._running=[],this._textsHidden=!1,this.onInteractionStart=()=>{this.setWorkersIdle(!0)},this.onViewChanged=()=>{this.setWorkersIdle(!1)},this.onVisibilityChange=()=>{Ai().hidden?this.setWorkersIdle(!0):this.setWorkersIdle(!1)},this._onWorkerUpdate=(t,e,s,i,n)=>{const{duration:r,onSync:o,onUpdate:a,dryRun:l,locate:d}=i,h=n.workerMessage,u=n.isRunning;if(o&&this._modules.dom.setTimeout(()=>o(h,this._modules,u),r),s){const c=s(h,this._modules,u);this._modules.events.fire("layoutComputed",{type:"layoutComputed",name:e,positions:c}),a&&a(h,c,u),this._assignNodePositions(c,r,l,i.easing).then(()=>{u||this._onWorkerComplete(t,c,h,this._layouts[e],i,t.getData())}),u||d&&c&&this._animateCamera(c,d,i.duration)}else u||t.fire("taskComplete",h)},this._onWorkerComplete=(t,e,s,i,n,r)=>{for(let c=0;c<this._running.length;c++)if(this._running[c]===t){this._running.splice(c,1);break}i.onStop&&e&&i.onStop(n,e,this._modules);const o=this._batchMode&&this._batchStarted&&this._batches.get(i.name);if(o){const c=this._batches.get(i.name),g=c.subGraphs,m=c.resolves;let f=0;for(let p=0;p<g.length;p++){const _=m[p],y=g[p].length,x=f,b=new Uint32Array(r.indexes.slice(f,f+y)),v=this._modules.graph.nodeList(b),A=n.dryRun&&e?e:this.collectNodesData(v),E=v.getId(),S={before:Yr({...r,indexes:b},x),current:Yr({...A,indexes:b},x)};this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:S,ids:E}),_({name:i.name,positions:S,ids:E}),f+=y}}const a=this._modules.graph.nodeList(new Uint32Array(r.indexes)),l=n.dryRun&&e?e:this.collectNodesData(a),d=a.getId(),h={before:Yr(r),current:Yr(l)};if(o||this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:h,ids:d}),n.onEnd&&n.onEnd(s),n.skipTextDrawing&&this._textsHidden&&(this._modules.graphics.showTexts(),this._textsHidden=!1),!this.resolves.has(t))throw new Error("Worker not found");const u=this.resolves.get(t);this.resolves.delete(t),u({name:i.name,positions:h,ids:d}),t.setBusy(!1)},this._onWorkerStart=(t,e,s)=>{e.skipTextDrawing&&!this._textsHidden&&(this._modules.graphics.hideTexts(),this._textsHidden=!0);const i=this._modules.graph.getNodes(e.nodes),n=this.collectNodesData(i),r=n.ids;s.setData(n),this._modules.events.fire("layoutStart",{type:"layoutStart",name:t.name,ids:r,worker:s})}}onMounted(){this._layouts={},this.timers=new Map,this.resolves=new Map,this._modules.events.register(["layoutGetData","layoutPrepare","layoutStart","layoutEnd","layoutComputed"]),this._modules.events.on("clearGraph",()=>this.stop()).on(["dragStart","zoomStart"],this.onInteractionStart).on(["dragEnd","viewChanged"],this.onViewChanged),this._modules.dom.addDocumentEventListener("visibilitychange",this.onVisibilityChange)}setWorkersIdle(t){this._running.forEach(e=>e.setIdle(t))}register(t){if(this._layouts[t.name])throw new Error(`Layout ${t.name} already exists`);this._layouts[t.name]=t}getAvailableLayouts(){return Object.keys(this._layouts)}enableBatching(){this._batchMode||(this._batches.clear(),this._batchMode=!0,this._batchStarted=!1)}runBatch(){const t=Array.from(this._batches.keys());return this._batchStarted=!0,Promise.all(t.map(e=>{const s=this._batches.get(e);return s.options.groups=s.subGraphs,this.start(e,s.options)})).finally(()=>{this._batchStarted=!1,this._batches.clear(),this._batchMode=!1})}_addToBatch(t,e,s){e.nodes.isList||(e.nodes=this._modules.graph.getNodes(e.nodes));const i=e.nodes.size;if(e.edges.isList||(e.edges=this._modules.graph.getEdges(e.edges)),!this._batches.has(t))return this._batches.set(t,{resolves:[s],subGraphs:[Array.from({length:i}).map((o,a)=>a)],options:e});const n=this._batches.get(t);n.resolves.push(s);const r=n.options.nodes.size;n.options.nodes=n.options.nodes.concat(e.nodes),n.options.edges=n.options.edges.concat(e.edges),n.options.xs&&e.xs&&(n.options.xs=n.options.xs.concat(e.xs)),n.options.ys&&e.ys&&(n.options.ys=n.options.ys.concat(e.ys)),n.options.rs&&e.rs&&(n.options.rs=n.options.rs.concat(e.rs)),n.subGraphs.push(Array.from({length:i}).map((o,a)=>a+r))}start(t,e={}){const s=this._layouts[t];this._modules.events.fire("layoutPrepare",{name:t,params:e});const i=dA(this._modules.graph,e,["radial","grid"].indexOf(t)===-1);return new Promise(n=>{if(!s)throw new Error(`layout ${t} does not exist`);if(this._batchMode&&!this._batchStarted&&HO.has(t))return this._addToBatch(t,i,n);i.duration=typeof i.duration=="number"?i.duration:b_.duration;const r=s.onSync;i.skipTextDrawing=i.skipTextDrawing===void 0?!0:!!i.skipTextDrawing;let o=i.locate||b_.locate;o&&typeof o=="boolean"&&(o={}),i.locate=o;const a={name:t,update:s.update,isRunning:s.isRunning,configure:s.configure,context:s.context,imports:s.imports,stop:s.stop,setIdle:s.setIdle};this._modules.graphics.forceAttributesComputation();const l=i.useWebWorker===void 0?!0:!!i.useWebWorker,d=this._modules.workers.create(a,l);this.resolves.set(d,n),d.on(SA,()=>{s.onStart&&s.onStart(e),this._onWorkerStart(s,i,d)}).on(wA,h=>{this._modules.events.fire("layoutGetData",{name:t,data:h})}).on(Yo,h=>{const u=h.workerMessage,c=u.lastUpdate||-1/0,g=h.isRunning,m=Xe();g&&(!i.continuous||m-c<YO)||(u.lastUpdate=m,this._onWorkerUpdate(d,t,r,i,h))}),this._modules.workers.start(d,i),this._running.push(d)})}_animateCamera(t,e,s){if(t.indexes.length===0)return Promise.resolve();const i=this._modules.locate.layoutDataBoundingBox(t),n=this._modules.locate.computeConfigForBounds(i,e);return this._modules.camera.setView(n,{duration:s,easing:e.easing||x_,ignoreZoomLimits:!0})}stop(){for(;this._running.length!==0;){const t=this._running.pop();t.stop(),t.fire("taskComplete",null)}return Promise.resolve()}isRunning(){return this._running.length!==0}_assignNodePositions(t,e,s,i=x_){if(!t||s){const d=t?new Uint32Array(t.indexes):void 0,h=this._modules.graph.nodeList(d);return Promise.resolve(h)}const{indexes:n,x:r,y:o}=t,a=this._modules.graph.nodeList(new Uint32Array(n)),l=Yr(t);for(let d=0;d<l.length;d++)l[d]={x:r[d],y:o[d]};return a.setAttributes(l,{duration:e,easing:i})}collectNodesData(t){const e=t._indexes,s=this._modules.graph.getNodeAttribute("x").getMultiple(e),i=this._modules.graph.getNodeAttribute("y").getMultiple(e);return{ids:t.getId(),indexes:e,x:s,y:i}}};function Yr({x:t,y:e,indexes:s},i=0){const n=s.length,r=new Array(n);for(let o=0;o<n;o++)r[o]={x:t[o+i],y:e[o+i]};return r}function v_(t){return typeof t=="number"&&isNaN(t)}var A_=class{constructor(){this._keys=[],this._values=[]}set(t,e){const s=this._getIndex(t);return s===-1?(this._keys.push(t.slice()),this._values.push(e),!0):(this._values[s]=e,!1)}get(t){const e=this._getIndex(t);return e===-1?void 0:this._values[e]}has(t){return this._getIndex(t)!==-1}delete(t){const e=this._getIndex(t);return e!==-1&&(this._keys.splice(e,1),this._values.splice(e,1),!0)}keys(){return this._keys.map(t=>t.slice())}values(){return this._values.slice()}_getIndex(t){for(let e=0;e<this._keys.length;e++){const s=this._keys[e];if(s.length===t.length){let i=!0;for(let n=0;n<t.length;n++){const r=s[n],o=t[n];if(!(r===o||v_(r)&&v_(o))){i=!1;break}}if(i)return e}}return-1}get size(){return this._keys.length}},$O=class{constructor(){this._map=new Map,this._arrays=new A_}clear(){return this._arrays=new A_,this._map.clear()}delete(t){return Ue(t)?this._arrays.delete(t):this._map.delete(t)}get(t){return Ue(t)?this._arrays.get(t):this._map.get(t)}set(t,e){return Ue(t)?this._arrays.set(t,e):this._map.set(t,e),this}keys(){return[...cb(this._map),...this._arrays.keys()]}values(){return[...gb(this._map),...this._arrays.values()]}get size(){return this._map.size+this._arrays.size}},WO=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s||[],this._filter=i,this._unwindArrays=n,this._onUpdateHandlers=[],this._triggerUpdate=r=>{for(let o=0;o<this._onUpdateHandlers.length;++o)this._onUpdateHandlers[o](r)},this._info=t.watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}onUpdate(t){this._onUpdateHandlers.push(t)}getPropertyInfo(){return this._info}getPath(){return this._path.slice()}destroy(){this._module.unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}},ZO=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s,this._filter=i,this._unwindArrays=n,this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[]}get path(){return this._path}onPropertyAdded(t){return this._onAddHandlers.push(t),this}onPropertyRemoved(t){return this._onRemoveHandlers.push(t),this}onPropertyUpdated(t){return this._onUpdateHandlers.push(t),this}getPath(){return this._path.slice()}getProperties(){return this._propertyList.slice()}getPropertyInfo(t){const e=this._properties[t];return e?e.info:null}destroy(){ni(this._properties,({handler:e},s)=>{const i=this._path.concat([s]);this._module.unwatchPropertyInformation(this._isNode,i,e,this._filter,this._unwindArrays)}),this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[];const t=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(t,1)}updateSubPropertiesToWatch(t,e){if(t!==this._isNode)return;const s=e.getData(this._path);for(let i=0;i<s.length;i++){const n=s[i];if(In(n)){const r=Object.keys(n);for(let o=0;o<r.length;o++)this._addSubPropertyToWatch(r[o])}}}_addSubPropertyToWatch(t){if(!this._properties[t]){const e=this._path.concat([t]),s=()=>this._triggerPropertyUpdate(t),i=this._unwindArrays,n=this._isNode,r=this._filter,o=this._module.watchPropertyInformation(n,e,s,r,i);this._properties[t]={handler:s,info:o},this._triggerPropertyUpdate(t)}}_triggerPropertyUpdate(t){const{info:e}=this._properties[t],s=this._propertyList.indexOf(t),i=s!==-1,n=e.getType()!=="undefined";!i&&n?(this._propertyList.push(t),this._triggerHandlers("_onAddHandlers",t,e),this._triggerHandlers("_onUpdateHandlers",t,e)):i&&!n?(this._propertyList.splice(s,1),this._triggerHandlers("_onUpdateHandlers",t,e),this._triggerHandlers("_onRemoveHandlers",t,e)):i&&n&&this._triggerHandlers("_onUpdateHandlers",t,e)}_triggerHandlers(t,e,s){const i=this[t];for(let n=0,r=i.length;n<r;n++)i[n](e,s)}},KO=class{constructor(){}setWatcher(t){this._watcher=t}isNode(){return this._watcher.isNode}getPath(){return this._watcher.property.slice()}getBoundaries(){const t=this._watcher.boundaries;return t?{min:t.min,max:t.max}:null}getValues(){return this._watcher.values.keys()}getValueCount(t){return this._watcher.values.get(t)||0}getCount(){return this._watcher.total}getType(){return this._watcher.any>0?"any":this._watcher.numbers>0?"number":"undefined"}},QO=class extends Ot{constructor(){super(...arguments),this._onExcludedStateChange=({elements:t,value:e})=>{const s=!e;for(let i=0,n=this._propertyWatchers.length;i<n;i++){const r=this._propertyWatchers[i];r.isNode===t.isNode&&r.filter==="visible"&&(s?go(r,t.getData(r.property)):Nl(r,t.getData(r.property)),rl(r))}},this._onDataChange=({isNode:t,changes:e})=>{for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.property,r=i.filter==="all";if(i.isNode===t)for(let o=0;o<e.length;++o){const a=e[o],l=ek(a.property||[],n);if(l){const d=a.nodes||a.edges,h=[],u=[];if(d)for(let c=0;c<d.size;++c){const g=d.get(c);(r||g.isVisible())&&(h.push(ye(a.newValues[c],l)),u.push(ye(a.previousValues[c],l)))}h.length&&(go(i,h),Nl(i,u),rl(i))}}}for(let s=0,i=this._objectPropertyWatchers.length;s<i;s++){const n=this._objectPropertyWatchers[s],r=n.path;for(let o=0;o<e.length;++o){const{property:a,nodes:l,edges:d}=e[o],h=l||d;if(h){const u=h.isNode;(!a||a.length<=r.length+1&&r.every((c,g)=>c===a[g]))&&n.updateSubPropertiesToWatch(u,h)}}}},this._onElementsAdded=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s];if(i.isNode===e.isNode){const n=e.getData(i.property);n.length&&(go(i,n),rl(i))}}for(let s=0;s<this._objectPropertyWatchers.length;s++)this._objectPropertyWatchers[s].updateSubPropertiesToWatch(e.isNode,e)},this._onElementsRemoved=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.filter==="all";if(i.isNode===e.isNode&&n){const r=e.getData(i.property);r.length&&(Nl(i,r),rl(i))}}},this._onGraphClear=()=>{this._propertyWatchers.forEach(t=>{t.numbers=0,t.any=0,t.total=0,t.boundaries=null,t.values.clear()})}}onMounted(){this._propertyWatchers=[],this._objectPropertyWatchers=[],this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on(["updateNodeData","updateEdgeData"],this._onDataChange).on(["addNodes","addEdges"],this._onElementsAdded).on(["removeNodes","removeEdges"],this._onElementsRemoved).on("clearGraph",this._onGraphClear)}watchNodeObjectProperty(t){return this._watchObjectProperty(!0,ol(t))}watchEdgeObjectProperty(t){return this._watchObjectProperty(!1,ol(t))}watchNodeNonObjectProperty(t){return this._watchNonObjectProperty(!0,ol(t))}watchEdgeNonObjectProperty(t){return this._watchNonObjectProperty(!1,ol(t))}watchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n)||this._createWatcher(t,e,i,n);return s&&r.onChange.push(s),r.info}unwatchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n);if(!r)return;const o=r.onChange,a=o.indexOf(s);if(a!==-1&&(o.splice(a,1),o.length===0)){const l=this._propertyWatchers.indexOf(r);this._propertyWatchers.splice(l,1)}}_watchObjectProperty(t,e){const s=new ZO(this,t,e);return this._objectPropertyWatchers.push(s),s.updateSubPropertiesToWatch(t,this._modules.graph[t?"getNodes":"getEdges"](e.filter)),s}_watchNonObjectProperty(t,e){return new WO(this,t,e)}_findWatcher(t,e,s,i){for(let n=0;n<this._propertyWatchers.length;++n){const r=this._propertyWatchers[n];if(r.isNode===t&&r.filter===s&&r.unwindArrays===i&&tk(r.property,e))return r}return null}_createWatcher(t,e,s,i){const n={isNode:t,property:e,numbers:0,any:0,total:0,values:new $O,boundaries:null,onChange:[],filter:s,unwindArrays:i,info:new KO};return n.info.setWatcher(n),go(n,this._modules.graph[t?"getNodes":"getEdges"](s).getData(e)),this._propertyWatchers.push(n),n}};function E_(t){return t==null?[]:Tn(t)}function JO(t){return t==="all"?"all":"visible"}function rl(t){for(let e=0;e<t.onChange.length;++e)t.onChange[e](t.info)}function tk(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}function ek(t,e){if(t.length>e.length)return null;let s=0;for(;s<t.length;++s)if(t[s]!==e[s])return null;return e.slice(s)}function go(t,e,s){const i=t.values,n=!s&&t.unwindArrays;for(let r=0;r<e.length;++r){const o=e[r];if(s||o===void 0||(t.total+=1),n&&Array.isArray(o))go(t,o,!0);else{const a=i.get(o);a?i.set(o,a+1):(i.set(o,1),Md(o)?(t.boundaries?o<t.boundaries.min?t.boundaries.min=o:o>t.boundaries.max&&(t.boundaries.max=o):t.boundaries={min:o,max:o},t.numbers+=1):o!==void 0&&(t.any+=1))}}}function Nl(t,e,s){const i=t.values,n=!s&&t.unwindArrays,r=t.boundaries;let o=!1;for(let a=0;a<e.length;++a){const l=e[a];if(s||l===void 0||(t.total-=1),n&&Array.isArray(l))o=o||Nl(t,l,!0);else{const d=i.get(l);d>1?i.set(l,d-1):(i.delete(l),Md(l)?(t.numbers-=1,!r||r.min!==l&&r.max!==l||(o=!0)):l!==void 0&&(t.any-=1))}}return!s&&o&&(t.boundaries=sk(i.keys())),o}function sk(t){let e=null,s=null;for(let i=0;i<t.length;++i){const n=t[i];Md(n)&&((e==null||n<e)&&(e=n),(s==null||n>s)&&(s=n))}return e==null||s==null?null:{min:e,max:s}}function ol(t){return typeof t!="object"||t===null||Array.isArray(t)?{path:E_(t),filter:"visible",unwindArrays:!1}:{path:E_(t.path),filter:JO(t.filter||"visible"),unwindArrays:!!t.unwindArrays}}var ik=class extends Ot{onMounted(){this._modules.events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])}get x(){return this._modules.position.x||0}get y(){return this._modules.position.y||0}_later(){return this._modules.dom.afterNextFrame()}move({x:t,y:e}){if(t!==void 0&&e!==void 0){const s=t-this.x,i=e-this.y;this._modules.events.fire("virtualMove",{x:t,y:e,dx:s,dy:i})}return Promise.resolve()}down({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDown",{x:this.x,y:this.y,button:s}),this._modules.events.fire("virtualMove",{x:this.x,y:this.y,dx:0,dy:0,button:s})})}up({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualUp",{x:t,y:e,button:s})})}click({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}rightClick({x:t,y:e,button:s="right"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}doubleclick({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDoubleClick",{x:t,y:e,button:s})})}drag(t,e){return this.down(t).then(()=>this.move(e)).then(()=>this.up(e))}wheel({x:t,y:e,dx:s,dy:i,delta:n,metaKey:r,ctrlKey:o}){return this.move({x:t,y:e}).then(()=>(this._modules.events.fire("virtualWheel",{x:t,y:e,dx:s,dy:i,delta:n,domEvent:{metaKey:r,ctrlKey:o}}),this._later()))}};function bs(t,e,s,i,n,r){const o=gs(),a=r.graphToScreenCoordinates(t),l=r.graphToScreenCoordinates(e);n.beginPath(),n.moveTo(a.x*o,a.y*o),n.lineTo(l.x*o,l.y*o),n.strokeStyle=i,n.lineWidth=s,n.stroke()}function S_(t,e,s,i){let n,r,o,a=0,l=t.length-1;for(;a<l&&a>-1;)if(n=(a+l)/2|0,r=Math.abs(e[t[n]]-s),o=Math.abs(e[t[n+1]]-s),o<r)a=n+1;else if(o>r)l=n;else{const d=Math.abs(e[t[a]]-s),h=Math.abs(e[t[l]]-s);if(d<h)l=n;else{if(!(d>h))return l;a=n+1}}return i?l:t[l]}function w_(t,e,s,i,n,r,o){let a,l,d,h,u,c;for(let g=0,m=t.length;g<m;g++)for(let f=0;f<m;f++){if(g===f)continue;let p=t[g],_=t[f];f<g&&(h=_,_=p,p=h);const y=e[p],x=e[_],b=r.get(p),v=r.get(_);if(y+b<i-n&&x-v>i+n&&Math.abs(Math.abs(y+b-(i-n))-Math.abs(x-v-(i+n)))<=o)return a=p,l=s,d=_,c=y+b+Math.abs(x-v-(y+b))/2,u=[y+b,c-n,c+n,x-v],{a,b:l,c:d,current:s,target:c,points:u};if(y+b<i-n&&x+v<i-n&&Math.abs(Math.abs(y+b-(x-v))-Math.abs(Math.max(y+b,x+v)-(i-n)))<=o)return a=p,l=_,d=s,c=x+b+Math.abs(Math.abs(y+b-(x-v)))+n,u=[y+b,x-v,x+v,c-n],{a,b:l,c:d,current:s,target:c,points:u};if(y-b>i+n&&x-v>i+n&&Math.abs(Math.abs(y+b-(x-v))-Math.abs(Math.min(y-b,x-v)-(i+n)))<=o)return a=s,l=p,d=_,c=y-b-Math.abs(Math.abs(y+b-(x-v)))-n,u=[c+n,y-b,y+b,x-v],{a,b:l,c:d,current:s,target:c,points:u}}return null}var Nh={enabled:!1,tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:!0,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:!0,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}},nk=class extends Ot{constructor(){super(...arguments),this._options=be(Nh),this._enabled=!1,this._ysnap=0,this._xsnap=0,this._node=null,this._nodes=null,this._r=0,this._vguideline={start:{x:0,y:0},end:{x:0,y:0}},this._hguideline={start:{x:0,y:0},end:{x:0,y:0}},this._gridResolution=0,this._onNodeDragStart=({nodes:e})=>{e.size===1&&(this._node=e.get(0),this._cacheViewportData(),this._r=Number(this._node.getAttribute("radius")))},this._onNodeDragEnd=()=>{this._node=null,this._layer.refresh()}}onMounted(){this._options=be(Nh),this._enabled=!1}enable(e){this._enabled||(this._options=fs(e,Nh),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(s=>{s.clearRect(0,0,s.canvas.width,s.canvas.height)},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._modules.events.on("nodesDragStart",this._onNodeDragStart).on("nodesDragEnd",this._onNodeDragEnd),this._modules.settings.update({"interactions.drag.onBeforeDrag":(s,i,n,r)=>this._onBeforeDrag(i,n,r)}))}disable(){this._enabled&&(this._modules.events.off(this._onNodeDragStart).off(this._onNodeDragEnd),this._layer.destroy(),this._modules.settings.update({"interactions.drag.onBeforeDrag":null}),this._enabled=!1)}enabled(){return this._enabled}_onBeforeDrag(e,s,i){if(this._node){const n=i[0];this._layer.refresh(r=>{this._scan(r,n)}),this._node.setAttributes(n)}}_cacheViewportData(){const e=this._modules.camera,s=e.screenToGraphCoordinates({x:0,y:0}),i=e.screenToGraphCoordinates({x:e.width,y:e.height});if(this._nodes=this._modules.spatial.getNodesByBoundingBox(s.x,s.y,i.x,i.y),this._node==null)return;const n=this._node._index,r=Array.from(this._nodes._indexes);r.splice(r.indexOf(n),1);const o=this._modules.graph.getNodeAttribute("radius"),a=this._modules.graph.getNodeAttribute("x"),l=this._modules.graph.getNodeAttribute("y"),d=a.buffer(),h=l.buffer(),u=Wr(r.slice(),a),c=Wr(r.slice(),l),g={},m={};this._gridResolution=Number(this._node.getAttribute("radius"));const f=this._gridResolution;for(let p=0,_=r.length;p<_;p++){const y=u[p],x=c[p],b=d[y]/f|0,v=h[x]/f|0;g[b]||(g[b]=[]),m[v]||(m[v]=[]),g[b].push(y),m[v].push(x)}this._nodesByX=u,this._nodesByY=c,this._xGrid=g,this._yGrid=m,this._xList=a,this._yList=l,this._X=d,this._Y=h,this._R=o}_scan(e,s){if(this._node==null)return;const i=this._node._index,n=s.x,r=s.y,o=this._r,a=this._options,l=this._xList,d=this._yList,h=this._R,u=this._X,c=this._Y,g=this._modules.camera.zoom,m=Math.min(o,this._options.tolerance/g),f=2*o*a.sideSnapDistanceFactor,p=a.guidelineWidth,_=a.guidelineColor;let y,x,b,v,A,E,S,w,T=i,L=i,R=null,k=!1,j=!1;if(T=S_(this._nodesByX,u,n),L=S_(this._nodesByY,c,r),Math.abs(u[T]-n)>a.centerSnapDistance&&(T=i),Math.abs(c[L]-r)>a.centerSnapDistance&&(L=i),this._xsnap=0,T!==i){y=this._vguideline.start,x=this._vguideline.end,w=T,b=u[w],v=c[w],R=h.get(w),S=Math.abs(n-b);const z=Math.abs(n-o-(b-R)),q=Math.abs(n+o-(b+R));if(S<Math.max(o,R)){v<r?(y.y=v-R,x.y=r+o):(y.y=v+R,x.y=r-o);const B=Math.min(z,S,q);B===S?(y.x=x.x=b,x.y=r,y.y=v,this._xsnap=1):Math.abs(r-v)<R+o+f&&(B===z?(y.x=x.x=b-R,this._xsnap=2):(y.x=x.x=b+R,this._xsnap=3)),B<m&&(k=!0)}this._xsnap!==0&&bs(y,x,p,_,e,this._modules.camera)}if(this._ysnap=0,L!==i){y=this._hguideline.start,x=this._hguideline.end,w=L,b=u[w],v=c[w],R=h.get(w),S=Math.abs(r-v);const z=Math.abs(r-o-(v-R)),q=Math.abs(r+o-(v+R));if(S<Math.max(o,R)){b<n?(y.x=b-R,x.x=n+o):(y.x=b+R,x.x=n-o);const B=Math.min(z,S,q);B===S?(y.y=x.y=v,x.x=n,y.x=b,this._ysnap=1):Math.abs(n-b)<R+o+f&&(B===z?(y.y=x.y=v-R,this._ysnap=4):(y.y=x.y=v+R,this._ysnap=5)),B<m&&(j=!0)}this._ysnap!==0&&bs(y,x,p,_,e,this._modules.camera)}if(R!=null&&a.preferredDistance.enabled){const z=a.preferredDistance.ratio,q=Math.min(a.preferredDistance.tolerance/g,o),B=Math.max(o,R);if(T===i||this._xsnap!==0&&k){if(L!==i&&(this._ysnap===0||!j)&&(w=L,b=u[w],v=c[w],R=h.get(w),E=Math.abs(r-v)-(o+R)*(1+z),E<=q&&E>=-q)){const W=r<v?-1:1;y=this._hguideline.start,x=this._hguideline.end,y.x=b-B,x.x=b+B,y.y=x.y=v,bs(y,x,p,_,e,this._modules.camera),y.x=n-B,x.x=n+B,y.y=x.y=v+W*(1+z)*(o+R),bs(y,x,p,_,e,this._modules.camera),this._ysnap=1,j=!0}}else if(w=T,b=u[w],v=c[w],R=h.get(w),A=Math.abs(n-b)-(o+R)*(1+z),A<=q&&A>=-q){const W=n<b?-1:1;y=this._vguideline.start,x=this._vguideline.end,y.x=x.x=b+W*(1+z)*(o+R),y.y=v-B,x.y=v+B,y.x=x.x=b,bs(y,x,p,_,e,this._modules.camera),y.y=r-B,x.y=r+B,y.x=x.x=b+W*(1+z)*(o+R),bs(y,x,p,_,e,this._modules.camera),this._xsnap=1,k=!0}}if(a.neighbours.enabled){const z=this._gridResolution,q=n/z|0,B=r/z|0,W=this._xGrid,Z=this._yGrid,it=[],dt=[].concat(Z[B-1]||it,Z[B]||it,Z[B+1]||it),At=[].concat(W[q-1]||it,W[q]||it,W[q+1]||it);let gt;dt.length>1&&(Wr(dt,l),gt=w_(dt,u,i,n,o,h,m),gt&&(this._drawNeighbourGuidelines(e,gt,s,!1),k=!1)),At.length>1&&!gt&&(Wr(At,d),gt=w_(At,c,i,r,o,h,m),gt&&(this._drawNeighbourGuidelines(e,gt,s,!0),j=!1))}(k||j)&&this._snap(s,!k,!j)}_drawNeighbourGuidelines(e,{a:s,b:i,c:n,points:r,target:o},a,l){const d={x:0,y:0},h={x:0,y:0},u=this._R,c=this._X,g=this._Y;let[m,f,p]=u.getMultiple([s,i,n]);const{offset:_,lineWidth:y,lineColor:x}=this._options.neighbours;let b,v;l?(a.y=o,m=-m,f=-f,p=-p,b=h.x=d.x=Math.min(c[s]+m,c[i]+f,c[n]+p)-_,v=c):(a.x=o,b=h.y=d.y=Math.max(g[s]+m,g[i]+f,g[n]+p)+_,v=g);const A=l?"y":"x",E=l?"x":"y";d[A]=r[0],h[A]=r[1],bs(d,h,y,x,e,this._modules.camera),d[A]=r[2],h[A]=r[3],bs(d,h,y,x,e,this._modules.camera),d[A]=r[0],d[E]=b-_/2,h[A]=r[0],d[E]=v[s]+m,bs(d,h,y,x,e,this._modules.camera),d[A]=r[1],d[E]=b-_/2,h[A]=r[1],d[E]=v[i]+f,bs(d,h,y,x,e,this._modules.camera),d[A]=r[2],d[E]=b-_/2,h[A]=r[2],d[E]=v[i]+f,bs(d,h,y,x,e,this._modules.camera),d[A]=r[3],d[E]=b-_/2,h[A]=r[3],d[E]=v[n]+p,bs(d,h,y,x,e,this._modules.camera)}_snap(e,s,i){const n=this._xsnap,r=this._ysnap;let o;s||n===0||(o=this._vguideline.end,e.x=n===2?o.x+this._r:n===3?o.x-this._r:o.x),i||r===0||(o=this._hguideline.end,e.y=r===4?o.y+this._r:r===5?o.y-this._r:o.y)}},rk=class{constructor(t,e,s){this._module=t,this._id=e,this._whenApplied=s.then(()=>this)}getId(){return this._id}whenApplied(){return this._whenApplied}refresh(){return this._module.refreshRule(this._id)}getIndex(){return this._module.getRuleIndex(this._id)}setIndex(t){return this._module.setRuleIndex(this._id,t)}update(t){return this._module.updateRule(this._id,t)}getDefinition(){return this._module.getRuleDefinition(this._id)}destroy(){return this._module.destroyRule(this._id)}},ok=1e3,ak=1/ok,lk=class extends Ot{constructor(){super(...arguments),this._idCounter=1,this._rules=[]}onMounted(){this._rules=[],this._modules.events.register(["addStyleRule","removeStyleRule","updateStyleRule","refreshStyleRule"])}_get(t){for(let e=0;e<this._rules.length;++e){const s=this._rules[e];if(s.id===t)return s.index=e,s}throw new Error("calling a method on a destroyed style rule")}_updatePriorities(){for(let t=0;t<this._rules.length;++t){const e=this._rules[t],s=q1+t*ak;e.attributeLayer.update({priority:s})}}addRule(t={}){const e=this._idCounter++,s=this._modules.graphics.addAttributeLayer({name:`rule(${e})`,...T_(t)}),i=this._modules.dom.afterNextFrame(),n=new rk(this,e,i),r={id:e,attributeLayer:s,wrapper:n};return this._rules.push(r),this._updatePriorities(),this._modules.events.fire("addStyleRule",{rule:r,options:t,id:r.id}),n}getRuleIndex(t){const e=this._get(t);return e.index==null?null:e.index}setRuleIndex(t,e){const s=this._get(t),i=Is(e,0,this._rules.length-1);return this._rules.splice(s.index,1),this._rules.splice(i,0,s),this._updatePriorities(),this._modules.dom.afterNextFrame()}updateRule(t,e){const s=this._get(t),i=Object.assign({fullOverwrite:e.fullOverwrite},e);return s.attributeLayer.update(i),this._modules.events.fire("updateStyleRule",{rule:s,options:e}),this._modules.dom.afterNextFrame()}getRuleDefinition(t){return T_(this._get(t).attributeLayer.getDefinition())}destroyRule(t){const e=this._get(t);return this._modules.events.fire("removeStyleRule",{rule:e,id:e.id}),e.attributeLayer.destroy(),this._rules.splice(e.index,1),this._modules.dom.afterNextFrame()}refreshRule(t){const e=this._get(t);return e.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:e,id:t}),this._modules.dom.afterNextFrame()}refreshAllRules(){for(const t of this._rules)t.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:t,id:t.id});return this._modules.dom.afterNextFrame()}getRuleList(){return this._rules.map(t=>t.wrapper)}};function T_(t){return{nodeAttributes:t.nodeAttributes,edgeAttributes:t.edgeAttributes,nodeSelector:t.nodeSelector,edgeSelector:t.edgeSelector,nodeDependencies:t.nodeDependencies,edgeDependencies:t.edgeDependencies,nodeOutput:t.nodeOutput,edgeOutput:t.edgeOutput}}var rc,ti=6,CA=5,Io=1,NA=0,MA=0,oc=-1;function RA(t,e,s,i){NA=t,rc=s,MA=e?1:0,oc=i}var I_=(t,e,s,i)=>n=>{const{rects:r,bboxes:o,intersects:a,indexToLayer:l,indexToRemoveNodeText:d,indexToRemoveEdgeText:h}=i;if(o[n*ti+5]===NA&&o[n*ti+4]===s)return!1;const u=n*CA,c=oa(r[u],r[u+1],r[u+2],r[u+3],r[u+4]);if(g0(rc,c)){if(i.realIntersection=!0,oc<=0&&a.push(rc,c),!(l[o[n*ti+5]]<oc))return!0;t.remove(n),i.realIntersection=!1,o[n*ti+4]===MA?d[o[n*ti+5]]=!0:h[o[n*ti+5]]=!0}return!1};function L_(t,e,s="#22ff00"){return ac([[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]].map(i=>({x:i[0],y:i[1]})),e,s)}function ac(t,e,s="#ff0000"){e.strokeStyle=s,e.beginPath();for(let i=0,n=t.length;i<n;i++)i===0?e.moveTo(t[i].x,t[i].y):e.lineTo(t[i].x,t[i].y);e.closePath(),e.stroke()}function dk(t,e,s,i,n){for(let a=0,l=e.length;a<l;a+=ti)L_(e.slice(a,a+4),t,"#aaaaaa");for(let a=0;a<s.length;a+=CA)ac(oa(s[a],s[a+1],s[a+2],s[a+3],s[a+4]),t,"green");const r=[n.root];let o=n.root;for(;o=r.pop();)o.leaf||r.push.apply(r,o.children),L_(n.getNodeBounds(o),t,"rgba(0,0,0,0.2)"),o=r.pop();i.forEach(a=>ac(a,t,"red"))}var Hr={x1:0,y1:0,x2:0,y2:0},Mh={x:0,y:0},Vn={x:0,y:0},hk=Math.PI/2,uk=0;function ck(t,e,s,i,n,r,o,a,l,d,h){const u=a.remove.nodes,c=a.remove.edges,g=a.redraw.edges,m=s.angle,f=s.zoom,p=n.x,_=n.y,y=n.radius,x=Math.PI,{source:b,target:v,scalingMethod:A}=i,E=i.width,S=i.curvature,w=i.layer,T=i.text.content,L=i.text.scaling,R=i.text.size,k=i.text.font,j=i.text.style,z=i.text.scale,q=i.text.maxLineLength,B=i.text.margin,W=i.text.minVisibleSize,Z=i.text.padding,it=i.animationDuration,dt=i.text.adjustAngle,At=i.text.position;a.indexToLayer={},a.indexToQuadIndex={},a.indexToRemoveNodeText={},a.indexToRemoveEdgeText={},a.indexToRedrawEdgeText={},a.byLayer=[];const{byLayer:gt,indexToLayer:ct,indexToQuadIndex:yt,indexToRedrawEdgeText:Tt,indexToRemoveNodeText:Gt,indexToRemoveEdgeText:Vt}=a;for(let _t=0;_t<t.length;_t++){const Dt=t[_t],oe=w.get(Dt)-nb;for(let qt=1;qt<=oe;qt++)(gt[qt]=gt[qt]||[]).push(Dt);ct[Dt]=oe}if(l!==null){const _t=gt.length;for(let Dt=ct[l]+1;Dt<=_t;Dt++)(gt[Dt]=gt[Dt]||[]).unshift(l);ct[l]=_t}const St=[0,0,0,0],ft=[0,0,0,0,0],{bboxes:pt,rects:It}=a,Lt=(_t,Dt=-1)=>{const oe=it.get(_t);let qt=T?T.get(_t):"";if(qt===null||qt===""||oe)return!1;const jt=b.get(_t),Zt=v.get(_t);let ie=E.get(_t);const he=S.get(_t),Yt=W.get(_t);if(ie*f<Yt)return Vt[_t]=!0,!1;A.get(_t)==="fixed"&&(ie/=f);let ae=(p.get(jt)+p.get(Zt))/2,Ft=(_.get(jt)+_.get(Zt))/2;qt=qt?qt.toString():"";const Pt=!L.get(_t),Ee=z.get(_t)*(Pt?1:f),ps=k.get(_t),Hs=(Pt?R.get(_t):Ee*ie)*Io,sn=j.get(_t),nn=q.get(_t),Xs=At.get(_t)===ia;let Ii=+Xs*B.get(_t)+i.text.padding.get(_t);const _e=p.get(jt),ls=_.get(jt),Ke=p.get(Zt),ds=_.get(Zt),De=y.get(jt),ri=y.get(Zt);if(he===0){const Oe=br(_e,ls,Ke,ds)-m,an=De-ri;ae+=an*Math.cos(Oe)/2,Ft+=an*Math.sin(Oe)/2}let hs;const Cs=jt===Zt;if(Cs)hs=x/4-m,Pd(_e,ls,he,De,0,Hr),ko(.5,_e,ls,Ke,ds,Hr.x1,Hr.y1,Hr.x2,Hr.y2,Vn),ae=Vn.x,Ft=Vn.y,Ii/=-f;else{if(_e===Ke&&ls===ds)return!1;hs=br(_e,ls,Ke,ds)-m,he!==0&&(Rn(_e,ls,Ke,ds,he,Mh),Dd(.5,_e,ls,Ke,ds,Mh.x,Mh.y,Vn),ae=Vn.x,Ft=Vn.y)}const Ve=Ii+uk,Ns=Mb(qt,nn);if(!Ns)return!1;const{lines:Ms,data:Li}=Ns;let oi=r(Li[0],ps,sn,Hs).width*Io;for(let Oe=1;Oe<Ms;Oe++)oi=Math.max(oi,r(Li[Oe],ps,sn,Hs).width*Io);const rn=Ms*Hs,$s=oi/f/2,_s=rn/f/2,on=Math.abs(ql(hs))<hk?1:-1;let ai=Xs?Cs?rn/f+ie/2+Ii:on*(Ve/f+ie/2+_s):0;if(!Cs&&he===0&&dt.get(_t)){const Oe=Z.get(_t);Ce(_e,ls,Ke,ds)*f-(De+ri)*(h?1:f)<oi+2*Oe+1&&(ai*=on,hs=0)}if(ft[0]=ae-$s,ft[1]=Ft-_s,ft[2]=ae+$s,ft[3]=Ft+_s,ft[4]=hs+m,Gu(ft,-(hs+m),-ai,ft),ft[2]=ft[2]-ft[0],ft[3]=ft[3]-ft[1],hs=x-hs-m,Gd(ae-$s,Ft-_s,2*$s,2*_s,hs,void 0,void 0,St),Gu(St,hs,ai,St),a.realIntersection=!1,RA(_t,!1,oa(ft[0],ft[1],ft[2],ft[3],ft[4]),Dt),e.traverse(St[0],St[1],St[2],St[3],d),a.realIntersection&&!o)return Vt[_t]=!0,!1;if(Tt[_t]=!0,Gt[_t]=!1,Dt<=0){const Oe=pt.length/ti;yt[_t]=Oe,pt.push(St[0],St[1],St[2],St[3],0,_t),e.insert(Oe,St[0],St[1],St[2],St[3]),It.push(ft[0],ft[1],ft[2],ft[3],ft[4])}else e.insert(yt[_t],St[0],St[1],St[2],St[3])};for(const _t of t)Lt(_t);let zt=!0;for(let _t=0;_t<gt.length;_t++){const Dt=gt[_t];if(Dt)if(zt)zt=!1;else for(const oe of Dt)Lt(oe,_t)}for(let _t=0;_t<t.length;_t++){const Dt=t[_t];Gt[Dt]?u.push(Dt):Tt[Dt]&&g.push(Dt),Vt[Dt]&&c.push(Dt)}return a}var gk={left:-1,right:1,top:0,bottom:0,center:0},mk={left:0,right:0,top:-1,bottom:1,center:0},fk={left:-1,right:0,top:-.5,bottom:-.5,center:-.5},pk={left:-.5,right:-.5,top:-1,bottom:0,center:-.5},_k=(t,e,s)=>Mb(e,s.get(t))||{lines:0,data:[" "],maxLength:1},yk=(t,e,s,i,n,r,o)=>{const{lines:a,data:l}=_k(t,e,i);let d=s(l[0],n,r,o).width;for(let h=1;h<a;h++)d=Math.max(d,s(l[h],n,r,o).width);return[d,a*o*Io]},xk=(t,e,s)=>{const i=e.text.content,n=e.radius,r=e.text.scaling,o=e.text.position,a=e.text.padding,l=e.text.scale,d=e.text.size,h=e.text.style,u=e.text.font,c=e.text.maxLineLength,g=e.text.margin,m=i.get(t),f=n.get(t),p=!r.get(t),_=o.get(t),y=a.get(t),x=l.get(t),b=(p?d.get(t):x*f*2)*Io,v=h.get(t),A=u.get(t),E=y+g.get(t),S=gk[_],w=mk[_],[T,L]=yk(t,`${m}`,s,c,A,v,b),R=T/2,k=L/2;return[fk[_]*T,pk[_]*L,S*E,w*E,S*f,w*f,T,L,R,k]};function bk(t,e,s,i,n,r,o,a,l){const d=o.remove.nodes,h=o.remove.edges,u=o.redraw.nodes,c=s.angle,g=s.zoom,m=s.sin,f=s.cos,p=i.x,_=i.y,y=i.radius,x=i.layer,b=i.scalingMethod,v=i.text.content,A=i.text.scaling,E=i.text.minVisibleSize,S=i.animationDuration,w=i.textHidden,T=i.excluded;o.indexToLayer={},o.indexToQuadIndex={},o.indexToRemoveNodeText={},o.indexToRemoveEdgeText={},o.indexToRedrawNodeText={},o.byLayer=[];const{indexToLayer:L,indexToRedrawNodeText:R,indexToRemoveNodeText:k,indexToRemoveEdgeText:j,indexToQuadIndex:z,byLayer:q}=o;for(let ct=0;ct<t.length;ct++){const yt=t[ct],Tt=x.get(yt)-nb;(q[Tt]=q[Tt]||[]).push(yt),L[yt]=Tt}if(a!==null){const ct=q.length;for(let yt=L[a]+1;yt<=ct;yt++)(q[yt]=q[yt]||[]).unshift(a);L[a]=ct}let B;const W=[0,0,0,0],Z=[0,0,0,0,0],{bboxes:it,rects:dt}=o,At=(ct,yt=-1)=>{const Tt=S.get(ct);let Gt=v.get(ct);if(Gt===null||Gt===""||Tt!==0)return!1;let Vt=y.get(ct);const St=E.get(ct);if(T.get(ct)===1)return k[ct]=!0,!1;if(2*Vt*g<St)return w.get(ct)===0&&(k[ct]=!0),!1;b.get(ct)==="fixed"&&(Vt/=g);const ft=p.get(ct),pt=_.get(ct);typeof Gt=="number"&&(Gt=Gt.toString());let[It,Lt,zt,_t,Dt,oe,qt,jt,Zt,ie]=n(ct);const he=!A.get(ct),Yt=he?g:1,ae=b.get(ct)==="fixed"?g:1;he?(zt+=Zt,_t+=ie,Zt/=g,ie/=g,qt/=g,jt/=g):(zt+=Zt*g,_t+=ie*g),It=It/Yt+zt/g+Dt/ae,Lt=Lt/Yt+_t/g+oe/ae,Gd(ft-Zt,pt-ie,qt,jt,-c,m,-f,W),Z[0]=ft-Zt,Z[1]=pt-ie,Z[2]=qt,Z[3]=jt,Z[4]=c;const Ft=f*It-m*Lt,Pt=m*It+f*Lt;if(W[0]+=Ft,W[1]+=Pt,W[2]+=Ft,W[3]+=Pt,Z[0]+=Ft,Z[1]+=Pt,o.realIntersection=!1,RA(ct,!0,oa(Z[0],Z[1],Z[2],Z[3],Z[4]),yt),e.traverse(W[0],W[1],W[2],W[3],l),o.realIntersection&&!r)return k[ct]=!0,!1;R[ct]=!0,k[ct]=!1,yt<=0?(B=it.length/ti,z[ct]=B,it.push(W[0],W[1],W[2],W[3],1,ct),e.insert(B,W[0],W[1],W[2],W[3]),dt.push(Z[0],Z[1],Z[2],Z[3],Z[4])):e.insert(z[ct],W[0],W[1],W[2],W[3])};for(const ct of t)At(ct);let gt=!0;for(let ct=0;ct<q.length;ct++){const yt=q[ct];if(yt)if(gt)gt=!1;else for(const Tt of yt)At(Tt,ct)}for(let ct=0;ct<t.length;ct++){const yt=t[ct];k[yt]?d.push(yt):R[yt]&&u.push(yt),j[yt]&&h.push(yt)}return o}var vk=1,Ak="topDown",Ek="bottomUp",Sk=.15,wk=200,C_=80,Tk=["x","y","radius","width","layer","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"].reduce((t,e)=>(t.add(e),t),new Set),Ik=class extends Ot{constructor(t,e){super(t),this._textBBoxes=[],this._rects=[],this._enabled=!1,this._geoEnabled=!1,this._intersects=[],this._textDisplacement={},this._textDisplacementUpdate={},this._skipFrames=!1,this._output={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]},rects:this._rects,bboxes:this._textBBoxes,intersects:this._intersects,realIntersection:!1,indexToLayer:{},byLayer:[],indexToRedrawEdgeText:{},indexToRemoveEdgeText:{},indexToRedrawNodeText:{},indexToRemoveNodeText:{},indexToQuadIndex:{}},this._onZoomStart=No(({startZoom:s,endZoom:i})=>{this._enabled&&i<s&&this._updateLabels(this._modules.camera.clone({zoom:i}))},C_),this._onLayoutEnd=No(()=>{this._enabled&&this._updateLabels()},C_),this._onAttributesChanged=s=>{if([...s.edgeAttributes,...s.nodeAttributes].some(i=>Tk.has(i))){const i=s.nodes._indexes;for(let n=0;n<i.length;n++)this._textDisplacementUpdate[i[n]]=!0;this._update()}},this._onToggle=s=>(s?this._update():this._reset(),this),this._update=()=>{(this._enabled||this._forceEnabled)&&this._updateDebounced()},this._toggleDebug=s=>{s?this._modules.layers.whenReady(()=>{this._layer=this._modules.layers.addCanvasLayer(i=>{i.lineWidth=1/this._modules.camera.getZoom(),dk(i,this._textBBoxes,this._rects,this._intersects,this._quadtree)},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._canvas=this._layer.element,this._ctx=this._canvas.getContext("2d"),this._update()}):this._canvas&&(this._layer.destroy(),this._canvas=this._ctx=null)},this._measureText=(s,i,n,r)=>this._engine.measureText(s,i,n,r),this._textDisplacement={},this._textDisplacementUpdate={},this._quadtree=new Ox(s=>{const i=ti,n=i*s;return this._textBBoxes.slice(n,n+i)},vk),e.forceEnableTextOverlapRemoval&&this.forceEnable()}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.events.register(["labelCollisionsRemoved"]),this.setRate(wk),this._modules.settings.register("texts.preventOverlap",!0,this._onToggle),this._modules.settings.register("texts.debug",!1,this._toggleDebug),this._modules.settings.register("texts.removalStrategy",Ak);const t=this._output;this._nodeTraversal=I_(this._quadtree,!1,1,t),this._edgeTraversal=I_(this._quadtree,!1,0,t),this._modules.events.on(["layoutEnd","locate"],this._onLayoutEnd).on(["viewChanged","mouseover","mouseout"],this._update).on("updateAttributes",this._onAttributesChanged).on("setContainer",({element:e})=>{if(e)return this._enable();this._disable()}).on("zoomStart",this._onZoomStart).on("viewExportStart",({preventOverlap:e,camera:s})=>{e&&this.forceUpdate(s)}).on("viewExportEnd",()=>{this.forceUpdate()}).on("geoEnabled",()=>this._geoEnabled=!0).on("geoDisabled",()=>this._geoEnabled=!1)}getTextsBoundingBox(t,e){if(this._skipFrames=!0,t||e?this._updateLabels(this._modules.camera,t?Array.from(t._indexes):[],e?Array.from(e._indexes):[]):this._updateLabels(),this._skipFrames=!1,this._rects===void 0)throw new Error("this._rects is undefined");const s=this._rects,i=new rs;for(let n=0;n<s.length;n+=5){const r=s[n],o=s[n+1],a=s[n+2],l=s[n+3],d=s[n+4],[h,u,c,g]=Gd(r,o,a,l,d);i.addPoint(h,u).addPoint(c,g)}return i}setRate(t){this._updateDebounced=this._modules.sync.debounceIdle(e=>this._updateLabels(e),t)}forceEnable(){this._forceEnabled=!0}update(){this._update()}forceUpdate(t=this._modules.camera){this._updateLabels(t)}query(t,e,s,i,n){const r=this._quadtree.query(t,e,s,i);for(let o=0;o<r.length;o++){const a=this._textBBoxes[6*r[o]+4],l=this._textBBoxes[6*r[o]+5];a?n.nodes.push(l):n.edges.push(l)}}_enable(){this._enabled=!0,this._update()}_disable(){this._textBBoxes=[],this._rects=[],this._intersects=[],this._enabled=!1}_onCameraMove(){this._update()}_updateLabels(t=this._modules.camera,e,s){if(!this._modules.settings.get("texts.preventOverlap"))return;const i=this._modules.graphics.getNodeAttributes(),n=this._modules.graphics.getEdgeAttributes();this._intersects=[],this._textBBoxes=[],this._rects=[];const r=t.getAngle(),o=t.getProjectedScreenBounds(Sk),a=this._modules.settings.get("texts.removalStrategy")===Ek,l={angle:r,zoom:t.zoom,sin:Math.sin(r),cos:Math.cos(r)};this._resetOutput();const d=this._output;if(!e||!s){const m=this._modules.spatial.queryRaw(o[0],o[1],o[2],o[3]);e=m.nodes,s=m.edges}const h=this._quadtree.clear().cover(o[0],o[1],o[2],o[3]);if(e.length+s.length===0)return;const u=this._modules.captor.getPointedElement();let c=null,g=null;u!==null&&(u.isNode?c=u._index:g=u._index);for(const m of e)!this._textDisplacementUpdate[m]&&this._textDisplacement[m]||(this._textDisplacement[m]=xk(m,i,this._measureText),this._textDisplacementUpdate[m]=!1);bk(e,h,l,i,m=>this._textDisplacement[m],a,d,c,this._nodeTraversal),ck(s,h,l,n,i,this._measureText,a,d,g,this._edgeTraversal,this._geoEnabled),this._skipFrames||this._clearOverlaps(this._output),this._modules.settings.get("texts.debug")&&this._layer.refresh()}_clearOverlaps(t){const e=this._modules.graph.nodeList,s=this._modules.graph.edgeList,i=this._modules.graphics,n=e(new Uint32Array(t.remove.nodes)),r=s(new Uint32Array(t.remove.edges)),o=e(new Uint32Array(t.redraw.nodes)),a=s(new Uint32Array(t.redraw.edges));i.setTextHidden(n,!0),i.setTextHidden(r,!0),i.setTextHidden(o,!1),i.setTextHidden(a,!1),this._modules.events.fire("labelCollisionsRemoved",t)}_resetOutput(){const t=this._output;t.remove.nodes=[],t.remove.edges=[],t.redraw.nodes=[],t.redraw.edges=[],t.rects=this._rects,t.bboxes=this._textBBoxes,t.intersects=this._intersects,t.realIntersection=!1,t.indexToLayer={},t.byLayer=[],t.indexToRedrawEdgeText={},t.indexToRemoveEdgeText={},t.indexToRedrawNodeText={},t.indexToRemoveNodeText={},t.indexToQuadIndex={}}_reset(){this._modules.graphics.resetTextHidden(),this._textDisplacement={},this._textDisplacementUpdate={}}},Lk=class extends Ot{constructor(){super(...arguments),this._onStartInteractionEvent=(t,e)=>{if(this._current)return;const s=this._interactionsByStartEvent[e];let i;for(const n of s)n.check(t)&&(!i||n.priority>=i.priority)&&(i=n);i&&this._startInteraction(i,t)},this._onProgressInteractionEvent=(t,e)=>{this._current&&this._current.progressEventName===e&&this._current.onProgress&&this._current.onProgress(t)},this._onStopInteractionEvent=(t,e)=>{this._current&&this._current.stopEventName===e&&this._stopCurrentInteraction(null)}}onMounted(){this._interactionsByStartEvent={},this._boundProgressEvents={},this._boundStopEvents={}}_startInteraction(t,e){t.onStart&&t.onStart(e),t.onStop&&(this._current=t,t.disableDetection&&this._modules.captor.setDetectionEnabled(!1))}_stopCurrentInteraction(t){this._current&&this._current.disableDetection&&this._modules.captor.setDetectionEnabled(!0),this._current&&this._current.onStop&&this._current.onStop(t),this._current=void 0}_forceStartInteraction(t,e){this._current&&this._stopCurrentInteraction(e),this._startInteraction(t,e)}_createWrapper(t){return{start:e=>this._forceStartInteraction(t,e)}}_addInteraction(t,e){const s=this._interactionsByStartEvent[t];return s?s.push(e):(this._interactionsByStartEvent[t]=[e],this._modules.events.on(t,this._onStartInteractionEvent)),this._createWrapper(e)}_createProgressiveInteraction(t,e,s,i){const n={priority:N_(i.priority),check:i.check||Ol,onStart:i.onStart||Xt,onProgress:i.onProgress||Xt,onStop:i.onStop||Xt,disableDetection:!!i.disableDetection,progressEventName:e,stopEventName:s};return this._boundProgressEvents[e]||(this._boundProgressEvents[e]=!0,this._modules.events.on(e,this._onProgressInteractionEvent)),this._boundStopEvents[s]||(this._boundStopEvents[s]=!0,this._modules.events.on(s,this._onStopInteractionEvent)),this._addInteraction(t,n)}_createNonProgressiveInteraction(t,e){return this._addInteraction(t,{priority:N_(e.priority),check:e.check||Ol,onStart:e.handler||Xt,onProgress:void 0,onStop:void 0,disableDetection:!1,progressEventName:void 0,stopEventName:void 0})}onDrag(t){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",t)}onGesture(t){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",t)}onClick(t){return this._createNonProgressiveInteraction("click",t)}onDoubleClick(t){return this._createNonProgressiveInteraction("doubleclick",t)}onHover(t){return this._createNonProgressiveInteraction("mouseover",t)}onUnhover(t){return this._createNonProgressiveInteraction("mouseout",t)}onMouseWheel(t){return this._createNonProgressiveInteraction("mousewheel",t)}onMouseDown(t){return this._createNonProgressiveInteraction("mousedown",t)}onMouseUp(t){return this._createNonProgressiveInteraction("mouseup",t)}onMouseMove(t){return this._createNonProgressiveInteraction("mousemove",t)}};function N_(t){return typeof t=="string"?Z1.indexOf(t):typeof t!="number"||isNaN(t)?0:t}var Ck=["virtualUp","mouseupInternal","touchUp"],Nk=["virtualDown","mousedownInternal","touchDown"],Mk=["virtualMove","mousemoveInternal","touchMove"],Rk=["virtualClick","clickInternal","touchTap"],Fk=["virtualDoubleClick","doubleclickInternal","touchDoubleTap"],Pk=["virtualWheel","mousewheelInternal"],zk=100,Dk=class extends Ot{constructor(){super(...arguments),this.spatialIndexMarginRatio=5,this._elt=null,this._hoveredElt=null,this._draggedElt=null,this._hover=!1,this._disabledCounter=0,this._accDx=0,this._accDy=0,this._prevX=0,this._prevY=0,this._buttons={left:{isPressed:!1,isDragging:!1},middle:{isPressed:!1,isDragging:!1},right:{isPressed:!1,isDragging:!1}},this._onGraphChanged=()=>{this._resetCurrent(this._modules.position.x,this._modules.position.y),this._onMove({x:this._modules.position.x,y:this._modules.position.y,source:null,domEvent:null})}}onMounted(){this._modules.events.register(["mousemove","mousedown","mouseup","click","doubleclick","mousewheel","mouseout","mouseover","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]),this._modules.settings.register("detect.nodes",!0).register("detect.edges",!0).register("detect.nodeTexts",!0).register("detect.nodeBadges",!0).register("detect.edgeTexts",!0).register("detect.nodeErrorMargin",5).register("detect.edgeErrorMargin",2).register("detect.enableSpatialIndex",!0),this._modules.events.on(["removeNodes","removeEdges","clearGraph"],this._onGraphChanged).on(Mk,(t,e)=>{this._onMove({...t,source:dn(e)})}).on(Nk,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDown({domEvent:t,x:e,y:s,button:i,source:dn(n)})}).on(Ck,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onUp({domEvent:t,x:e,y:s,button:i,source:dn(n)})}).on(Rk,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onClick({domEvent:t,x:e,y:s,button:i,source:dn(n)})}).on(Fk,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDoubleClick({domEvent:t,x:e,y:s,button:i,source:dn(n)})}).on(Pk,({domEvent:t,x:e,y:s,delta:i,dx:n,dy:r})=>this._onWheel({domEvent:t,x:e,y:s,delta:i,source:"mouse",dx:n,dy:r})).on("touchStartGesture",t=>this._modules.events.fire("gestureStart",t)).on("touchProgressGesture",t=>this._modules.events.fire("gestureProgress",t)).on("touchEndGesture",t=>this._modules.events.fire("gestureEnd",t)).on("documentMouseMove",({domEvent:t,x:e,y:s},i)=>{this._onDocumentMove({domEvent:t,x:e,y:s,source:dn(i)})}).on("documentMouseUp",({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDocumentUp({domEvent:t,x:e,y:s,source:dn(n),button:i})})}triggerUnhover(){this._hover=!1,this._hoveredElt=null}triggerDetection(){this._detectElement(this._modules.position.x,this._modules.position.y,!1,!1),this._elt&&(this._hoveredElt=this._elt,this._hover=!0)}getPointedElement(){return this._hoveredElt}getDraggedElement(){return this._draggedElt}isAnyButtonPressed(){return this._buttons.left.isPressed||this._buttons.right.isPressed||this._buttons.middle.isPressed}isAnyButtonDragging(){return this._buttons.left.isDragging||this._buttons.right.isDragging||this._buttons.middle.isDragging}isButtonPressed(t){return this._buttons[t].isPressed}isLeftPressed(){return this.isButtonPressed("left")}getCursorPosition(){return{x:this._modules.position.x,y:this._modules.position.y}}getCursorInformation(){return{x:this._modules.position.x,y:this._modules.position.y,target:this._hoveredElt}}setDetectionEnabled(t){this._disabledCounter=Math.max(0,this._disabledCounter+(t?-1:1))}_resetCurrent(t,e){for(const s in this._buttons){const i=this._buttons[s];i.isDragging&&this._modules.events.fire("dragEnd",{domEvent:null,x:t,y:e,button:s,target:this._draggedElt}),i.isPressed=!1,i.isDragging=!1}this._hover&&this._hoveredElt&&this._modules.events.fire("mouseout",{domEvent:null,x:t,y:e,target:this._hoveredElt}),this._hover=!1,this._hoveredElt=null,this._draggedElt=null}_onMove({domEvent:t,x:e,y:s,source:i}){let{dx:n,dy:r}=this._setPointerPosition(e,s);this._modules.events.fire("mousemove",{domEvent:t,x:e,y:s,dx:n,dy:r,source:i});for(const o in this._buttons){const a=this._buttons[o];if(a.isPressed)if(a.isDragging){const l=this._getStoredDXY();n+=l.dx,r+=l.dy,this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:n,dy:r,button:o,source:i,target:this._draggedElt})}else a.isDragging=!0,this._hoveredElt&&this._hover&&(this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt}),this._hover=!1),this._draggedElt||(this._draggedElt=this._hoveredElt),this._storeDXY(n,r),this._modules.events.fire("dragStart",{domEvent:t,x:e,y:s,button:o,source:i,target:this._draggedElt})}t&&!this._modules.graphics.getDomElement().contains(t.target)||this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&(this._hoveredElt&&this._hover&&(this._hover=!0,this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})),this._hoveredElt=this._elt,this._elt&&(this._hover=!0,this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})))}_onDocumentMove({domEvent:t,x:e,y:s,source:i}){for(const n in this._buttons){const{isDragging:r}=this._buttons[n];if(r){const{dx:o,dy:a}=this._setPointerPosition(e,s);this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:o,dy:a,button:n,source:i,target:this._draggedElt})}}}_onDocumentUp({domEvent:t,x:e,y:s,source:i,button:n}){if(n!=null&&this._buttons[n].isDragging){this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:n,source:i,target:this._draggedElt});const r=this._buttons[n];r.isDragging=!1,r.isPressed=!1,this.isAnyButtonDragging()||(this._draggedElt=null)}}_onDown({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&this._resetCurrent(e,s);const r=this._buttons[i];this._hoveredElt=this._elt,r.isPressed=!0,this._elt&&t&&(t.stopPropagation(),t.preventDefault()),this._modules.events.fire("mousedown",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onDoubleClick({domEvent:t,x:e,y:s,button:i,source:n}){i!=null&&(R_(t,"doubleclick")||this._modules.events.fire("doubleclick",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt}))}_onUp({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;const r=this._buttons[i];r.isPressed&&(r.isDragging&&(this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:i,source:n,target:this._draggedElt}),r.isDragging=!1,this.isAnyButtonDragging()||(this._draggedElt=null)),r.isPressed=!1,this._detectElement(e,s,!1,!1),this._modules.events.fire("mouseup",{domEvent:t,x:e,y:s,button:i,source:n,target:this._elt}),this.isAnyButtonPressed()||this._hover||n==="touch"||(this._hoveredElt=this._elt,this._hoveredElt&&(this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:n,target:this._hoveredElt}),this._hover=!0)))}_onClick({domEvent:t,x:e,y:s,button:i,source:n}){R_(t,"click")||this._modules.events.fire("click",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onWheel({domEvent:t,x:e,y:s,delta:i,source:n,dx:r,dy:o}){this._modules.position.x=e,this._modules.position.y=s,this._modules.events.fire("mousewheel",{domEvent:t,x:e,y:s,dx:r,dy:o,delta:i,source:n,target:this._hoveredElt})}_storeDXY(t,e){this._accDx=t,this._accDy=e}_getStoredDXY(){const t=this._accDx,e=this._accDy;return this._accDx=0,this._accDy=0,{dx:t,dy:e}}_setPointerPosition(t,e){const s=t-this._prevX,i=e-this._prevY;return this._modules.position.x=t,this._modules.position.y=e,this._prevX=t,this._prevY=e,this._accDx=0,this._accDy=0,{dx:s,dy:i}}_detectElement(t,e,s,i){this._elt=this.detectElementAt(t,e,s,i)}detectElementAt(t,e,s,i){if(this._disabledCounter!==0)return null;const n=this._modules.settings,r=n.get("detect.enableSpatialIndex"),o=n.get("detect.nodeErrorMargin")||0,a=n.get("detect.edgeErrorMargin")||0;let l=n.get("detect.nodes"),d=n.get("detect.edges");i&&(l=!0,d=!0);let h=null,u=[],c=[];if(!s&&r&&(l||d)){const f=this.spatialIndexMarginRatio,p=Math.max(o*f,a*f),_=this._modules.spatial.queryRawProjected(t-p,e-p,t+p,e+p);u=_.nodes,c=_.edges}let g=null,m=null;if(l&&(g=this._modules.graphics.detectNode(t,e,!!n.get("detect.nodeTexts"),!!n.get("detect.nodeBadges"),o,u)),d&&(c.length<zk||!g)&&(m=this._modules.graphics.detectEdge(t,e,!!n.get("detect.edgeTexts"),a,c)),g&&m){const f=this._modules.graphics.getAttributesManager().getFlexArrays();h=f.nodes.current.layer.get(g._index)>=f.edges.current.layer.get(m._index)?g:m}else g?h=g:m&&(h=m);return h}};function dn(t){return t.indexOf("touch")===0?"touch":"mouse"}var Rh=!1,M_={down:{trigger:"pointerdown",duplicate:"mousedown"},click:{trigger:"pointerdown",duplicate:"mouseup"},doubleclick:{trigger:"pointerdown",duplicate:"mouseup"}};function R_(t,e){if(t)return t.type===M_[e].trigger&&(Rh=!0),t.type===M_[e].duplicate&&Rh?(Rh=!1,!0):void 0}var Ok=class extends Ot{constructor(){super(...arguments),this._dragged=null,this._start=[],this._end=[],this._shouldDrag=({target:t,button:e})=>{const s=e==="left",i=this._modules.settings.get("interactions.drag.enabled"),n=t!==null&&t.isNode&&t.getAttribute("draggable")===!0;return!!(s&&i&&n)},this._onDragStart=({x:t,y:e,target:s})=>{s&&(s.isSelected()?this._dragged=this._modules.selection.getSelectedNodes().filter(i=>i.getAttribute("draggable")):this._dragged=s.toList()),this._dragged&&(this._start=this._dragged.getPosition(),this._end=be(this._start),this._onBeforeDrag=this._modules.settings.get("interactions.drag.onBeforeDrag"),this._startDrag=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._dragged.addClass(vl),this._modules.events.fire("nodesDragStart",{nodes:this._dragged}),this._modules.graphics.addCursorStyle(this._modules.settings.get("interactions.drag.cursor")))},this._onDrag=()=>{if(!this._dragged||!this._startDrag)return;const{x:t,y:e}=this._modules.captor.getCursorInformation(),s=this._dragged._indexes,i=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),n=i.x-this._startDrag.x,r=i.y-this._startDrag.y;for(let o=0;o<s.length;++o){const a=this._start[o],l=this._end[o];l.x=a.x+n,l.y=a.y+r}this._onBeforeDrag&&this._onBeforeDrag(this._dragged,t,e,this._end),this._modules.settings.get("interactions.drag.applyResult")&&this._modules.individualAttributes.setMultipleAttributes(this._dragged,this._end),this._modules.events.fire("nodesDragProgress",{nodes:this._dragged,dx:n,dy:r})},this._onDragEnd=()=>{this._dragged&&(this._dragged.removeClass(vl),this._modules.graphics.removeCursorStyle(this._modules.settings.get("interactions.drag.cursor")),this._modules.events.fire("nodesDragEnd",{nodes:this._dragged,start:this._start,end:this._end}),this._dragged=null,this._start=[],this._end=[])}}onMounted(){this._modules.classes.createClass({name:vl,isBuiltin:!0,nodeAttributes:{layer:$1}}),this._modules.events.register(["nodesDragStart","nodesDragProgress","nodesDragEnd"]),this._modules.settings.register("interactions.drag.enabled",!0).register("interactions.drag.cursor","move").register("interactions.drag.onBeforeDrag",void 0),this._modules.settings.register("interactions.drag.applyResult",!0),this._modules.interactions.onDrag({priority:"drag",disableDetection:!0,check:this._shouldDrag,onStart:this._onDragStart,onProgress:this._onDrag,onStop:this._onDragEnd})}},kk={color:"#00C3FF",radius:4,cursorOnHover:"grab",cursorOnDrag:"grabbing"},Bk=class extends Ot{constructor(){super(...arguments),this._hoverHandle=!1,this._grabHandle=!1,this._x=0,this._y=0,this._enabled=!1,this._onMouseUp=()=>this._grabHandle=!1,this._onMouseDown=()=>{this._hoverHandle&&(this._grabHandle=!0)},this._onDragProgress=()=>{this._grabHandle&&this._refreshCanvas()},this._onDragStart=()=>{if(!this._movedEdges)return;this._nodesToHighlight=this._nodesToHighlight.filter(e=>e!==this._startNode&&!e.isVirtual()),this._movedEdges.setExcluded(!0);const t=this._options.cursorOnDrag;this._prevSettings=this._modules.settings.update({edgeHover:!1,cursor:{default:t,node:t,edge:t}})},this._onDragEnd=()=>{if(!this._movedEdges)return;this._restoreSettings();const t=this._getPointedNode();t&&this._movedEdges.forEach(e=>{e.getTarget()===this._startNode?e.setTarget(t):e.setSource(t)}),this._movedEdges.setExcluded(!1),this._movedEdges.setSelected(!0),this._movedEdges=null,this._refreshHandles()},this._refreshHandles=()=>{if(!this._enabled||this._movedEdges)return;const t=this._modules.selection.getSelectedEdges();this._nodesToHighlight=t.getExtremities().dedupe().filter(e=>!e.isVirtual()),this._rewirableClass.clearEdges(),this._rewirableClass.add(t),this._refreshCanvas()},this._shouldInteractionStart=({target:t})=>{if(!this._enabled||!t||!t.isNode||!this._hoverHandle||t.isVirtual())return!1;const e=t.getAdjacentEdges().filter(s=>s.isSelected());return!!e.size&&(this._movedEdges=e,this._edgeColors=this._movedEdges.getAttribute("color"),this._startNode=t,!0)},this._refreshCanvas=()=>{this._enabled&&this._layer.refresh()},this._checkForHover=()=>{if(!this._enabled||!this._nodesToHighlight)return;const t=this._options.radius,e=this._nodesToHighlight.getPosition(),s=this._modules.camera.screenToGraphCoordinates(this._modules.captor.getCursorPosition());for(let i=0;i<e.length;i++){const{x:n,y:r}=e[i];if(Ce(n,r,s.x,s.y)<t)return void this._enableCursorOnHover()}this._disableCursorOnHover()}}onMounted(){this._rewirableClass=this._modules.classes.createClass({name:Jx,isBuiltin:!0,edgeAttributes:{layer:W1}})}enable(t){this._enabled||(this._modules.events.on("move",this._checkForHover).on("mousemove",this._checkForHover).on("dragProgress",this._onDragProgress).on("nodesDragProgress",this._refreshCanvas).on("mousedown",this._onMouseDown).on("mouseup",this._onMouseUp).on("edgesSelected",this._refreshHandles).on("edgesUnselected",this._refreshHandles),this._interaction=this._modules.interactions.onDrag({priority:"rewiring",check:this._shouldInteractionStart,onStart:this._onDragStart,onProgress:({x:e,y:s})=>{this._x=e,this._y=s},onStop:this._onDragEnd}),this._options={...kk,...t},this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(e=>{if(!this._enabled||!this._nodesToHighlight)return;const s=this._modules.captor.getCursorPosition(),i=this._getPointedNode(),n=this._options.color,r=this._options.radius,o=2*r;if(this._displayMovedEdges(e),e.fillStyle=n,e.strokeStyle=n,this._nodesToHighlight.forEach(a=>{const{x:l,y:d}=a.getPosition();e.fillRect(l-r,d-r,o,o)}),this._movedEdges){const a=i?i.getPosition():s;e.fillRect(a.x-r,a.y-r,o,o)}},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._refreshHandles())}disable(){this._enabled&&(this._interaction&&this._interaction.stop&&this._interaction.stop(),this._interaction=void 0,this._modules.graphics.removeCursorStyle(this._options.cursorOnDrag),this._disableCursorOnHover(),this._restoreSettings(),this._layer.destroy(),this._rewirableClass.clearEdges(),this._enabled=!1,[this._checkForHover,this._onDragProgress,this._refreshCanvas,this._onMouseDown,this._onMouseUp,this._refreshHandles].forEach(t=>this._ogma.events.off(t)))}enabled(){return this._enabled}_restoreSettings(){this._prevSettings&&(this._modules.settings.update(this._prevSettings),this._prevSettings=void 0)}_disableCursorOnHover(){this._hoverHandle&&!this._grabHandle&&(this._hoverHandle=!1,this._modules.graphics.removeCursorStyle(this._options.cursorOnHover))}_enableCursorOnHover(){this._hoverHandle||(this._hoverHandle=!0,this._modules.graphics.addCursorStyle(this._options.cursorOnHover))}_displayMovedEdges(t){if(!this._movedEdges)return;const e=this._x,s=this._y,i=this._modules.camera.screenToGraphCoordinates({x:e,y:s});this._movedEdges.forEach((n,r)=>{const o=this._edgeColors[r],a=n.getSource(),l=n.getTarget(),d=this._getPointedNode(),h=l===this._startNode?a:l,u=Number(n.getAttribute("width")),c=h.getPosition(),g=d?d.getPosition():i;t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(g.x,g.y),t.strokeStyle=o,t.lineWidth=u,t.stroke()})}_getPointedNode(){const t=this._modules.captor.getPointedElement();return t&&t.isNode&&!t.isVirtual()?t:null}},F_={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1},Uk=class extends Ot{constructor(){super(...arguments),this._enabled=!1,this._nodesToHighlight=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[],this._onSelectionChange=()=>{this._enabled&&(this._nodesToHighlight=this._modules.selection.getSelectedNodes(),this._displayHandles())},this._displayHandlesHandler=()=>this._displayHandles(),this._moveHandler=({x:t,y:e})=>{this._modules.dom.setTimeout(()=>this._detectBoundingBoxes(t,e),0)}}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.interactions.onDrag({priority:"resizing",disableDetection:!0,check:()=>!(!this._enabled||!this._pointedNode),onStart:({x:t,y:e})=>{this._x=t,this._y=e,this._nodeBeingResized=this._pointedNode},onProgress:({x:t,y:e})=>{this._x=t,this._y=e,this._displayHandles()},onStop:()=>{if(this._nodesToHighlight){const t=this._modules.camera.zoom,e=this._nodesToHighlight.getAttributes(["x","y","radius"]).map(({x:s,y:i,radius:n},r)=>{const o=this._additionalRadiuses[r]/t;return{radius:+n+o,x:s+o,y:i-o}});this._nodesToHighlight.setAttributes(e)}this._pointedNode=null,this._nodeBeingResized=null,this._displayHandles()}})}onReady(){this._modules.events.on(["nodesSelected","nodesUnselected"],this._onSelectionChange)}_enableCursor(){this._cursorEnabled||(this._modules.graphics.addCursorStyle(this._options.cursor),this._cursorEnabled=!0)}_disableCursor(){this._cursorEnabled&&(this._modules.graphics.removeCursorStyle(this._options.cursor),this._cursorEnabled=!1)}_detectBoundingBoxes(t,e){if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight)return;const s=this._options.handleSize/2,i=this._options.detectionMargin;return this._pointedNode=null,this._forEachNodeToHighlight((n,r,o)=>{const a=r.x+o-s-i,l=r.x+o+s+i,d=r.y-o-s-i,h=r.y-o+s+i;t>=a&&t<=l&&e>=d&&e<=h&&(this._pointedNode=n)}),this._pointedNode?this._enableCursor():this._disableCursor()}_forEachNodeToHighlight(t){this._nodesToHighlight&&this._nodesToHighlight.forEach(e=>{const s=e.getPositionOnScreen(),i=this._getTotalRadius(e);t(e,s,i)})}_displayHandles(){this._enabled&&this._nodesToHighlight&&this._layer.refresh()}_displayNodePreview(t,e,s,i,n,r){if(n*=1/this._modules.camera.getZoom(),t.beginPath(),r.length===1)t.arc(s,i,n,0,2*Math.PI);else for(let o=0;o<r.length;++o){const a=r[o],l=s+a.x*n,d=i+a.y*n;o===0?t.moveTo(l,d):t.lineTo(l,d)}t.fillStyle=this._options.previewColor,t.fill()}_getTotalRadius(t,e=!0){return Number(t.getAttribute("radius"))*(this._modules.camera.zoom*(e?1:0))+Number(t.getAttribute("innerStroke.width"))+Number(t.getAttribute("outerStroke.width"))+this._options.lineWidth/2}_snap(t,e,s){const i=this._modules.spatial.getNodesInScreenByDistance(e).filter(u=>!u.isSelected()).slice(0,this._options.nbNodesToSnapTo),n=this._getTotalRadius(e),r=n+s,o=this._options.snappingRatio,a=r/n,l=Math.round(cx(a,o));let d=n*Math.pow(o,l),h=null;if(i.forEach(u=>{const c=this._getTotalRadius(u);Math.abs(c-r)<=Math.abs(d-r)&&(d=c,h=u)}),h){t.save(),t.strokeStyle=this._options.sizeIndicatorColor,t.lineWidth=this._options.sizeIndicatorThickness/this._modules.camera.getZoom();const u=h.getAttribute("radius");this._displaySizeIndicator(t,e,d),i.filter(c=>c.getAttribute("radius")===u).forEach(c=>this._displaySizeIndicator(t,c)),t.restore()}return d-n}_displaySizeIndicator(t,e,s){s=s||void 0;const i=this._modules.camera.getZoom(),n=e.getPosition(),r=this._getTotalRadius(e),o=(s||r)/i,a=(s?s-r:0)/i,l=a+(-this._options.sizeIndicatorOffset-(s?Number(e.getAttribute("innerStroke.width"))+Number(e.getAttribute("outerStroke.width")):0))/i,d=n.x-o+l|0,h=n.y-o-a|0,u=n.y+o-a|0,c=this._options.sizeIndicatorWidth/i;t.beginPath(),t.moveTo(d-c,h),t.lineTo(d+c,h),t.moveTo(d,h),t.lineTo(d,u),t.moveTo(d-c,u),t.lineTo(d+c,u),t.stroke()}enable(t={}){this._enabled||(this._options={...F_,...t},this._layer=this._modules.layers.addCanvasLayer(e=>{const s=gs(),i=this._modules.camera.getZoom(),{color:n,lineWidth:r}=this._options;let o=this._options.handleSize,a=0;if(this._nodeBeingResized){const l=this._getTotalRadius(this._nodeBeingResized),d=this._nodeBeingResized.getPositionOnScreen();a=Math.max(this._x-(d.x+l),-(this._y-(d.y-l)))/2}this._additionalRadiuses=[],this._nodesToHighlight&&this._nodesToHighlight.forEach(l=>{const d=l.getPosition();let h=this._getTotalRadius(l),u=0;if(this._nodeBeingResized){u=a;const c=-h+Number(l.getAttribute("innerStroke.width"))+Number(l.getAttribute("outerStroke.width"))+r/2+1;u=u<c?c:this._snap(e,l,u),this._additionalRadiuses.push(u);const g=l.getAttribute("shape"),m=this._engine.getShapePoints(g),f=d.x+u/i,p=d.y-u/i,_=h+u;this._displayNodePreview(e,s,f,p,_,m)}e.strokeStyle=n,e.fillStyle=n,e.lineWidth=r/i,h/=i,u/=i,o/=i*s,e.strokeRect(d.x-h,d.y-h-2*u,2*(u+h),2*(u+h)),e.fillRect(d.x+h+2*u-o/2,d.y-h-2*u-o/2,o,o)})},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._modules.events.on(["mousemove","mousedown"],this._moveHandler),this._enabled=!0)}disable(){this._enabled&&(this._modules.events.off(this._displayHandlesHandler).off(this._moveHandler),this._layer.destroy(),this._disableCursor(),this._reset())}_reset(){this._enabled=!1,this._nodesToHighlight=null,this._options={...F_},this._nodeBeingResized=null,this._pointedNode=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[]}enabled(){return this._enabled}},Gk={strokeColor:"black",strokeWidth:5,dashed:!0,cursorStyle:"cell",createNodes:!0,condition:gc,onNodeCreated:Xt,onEdgeCreated:Xt,createNode:qs,createEdge:qs,onComplete:Xt},Vk=class extends Ot{constructor(){super(...arguments),this._enabled=!1,this._blockId=0,this._cursorEnabled=!1}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._depth=Bo(0).edgeBody,this._modules.events.register(["connectNodes"]),this._interaction=this._modules.interactions.onDrag({priority:"connectNodes",check:({target:t,button:e="left"})=>this._enabled&&e==="left"&&t&&t.isNode&&!t.isVirtual(),onStart:({target:t})=>this._onStart(t),onProgress:({x:t,y:e})=>this._onMove(t,e),onStop:()=>this._onStop()}),this._modules.events.on("clearGraph",()=>this.disable())}_onStart(t){t&&(this._cursorEnabled=!0,this._startNode=t,this._startPos=t.getPosition(),this._modules.graphics.addCursorStyle(this._options.cursorStyle),this._blockId=this._modules.graphics.allocateGraphicsEngineBlockId())}_onMove(t,e){this._startNode!==null&&(this._endPos=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._drawLine())}_onStop(){if(this._startNode===null)return;const{condition:t,onNodeCreated:e,onEdgeCreated:s,createEdge:i,createNode:n,onComplete:r,createNodes:o}=this._options;let a=this._modules.captor.getPointedElement(),l=null,d=null;if(this._modules.graphics.releaseGraphicsEngineBlockId(this._blockId),!a&&o){const h=n({attributes:{x:this._endPos.x,y:this._endPos.y}});a=this._modules.graph.addNode(h),d=a,e&&e(d)}if(a&&!a.isVirtual()&&(d||!t||t(this._startNode,a))){const h=i({source:this._startNode.getId(),target:a.getId()});l=this._modules.graph.addEdge(h),s&&s(l)}r&&(this._modules.events.fire("connectNodes",{source:this._startNode,target:a,edge:l}),r(this._startNode,a,l||void 0)),this.disable()}_drawLine(){this._group.reset(Bs,!1,this._depth);const t=this._group.nextAndReset().end;t.pieceId=Nd,t.shape="line",t.x1=this._startPos.x,t.y1=this._startPos.y,t.x2=this._endPos.x,t.y2=this._endPos.y,t.fillColor=this._options.strokeColor,t.thicknessOrFontSizeFixed=this._options.strokeWidth,this._options.dashed&&(t.dashLength=3,t.gapLength=1),this._engine.storeGroup(this._blockId,this._group),this._modules.dom.refresh()}enable(t={}){return this._enabled||(this._options={...Gk,...t},this._enabled=!0,this._cursorEnabled=!1,this._startNode=null,this._prevSettings=this._modules.settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":!1}),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorInformation())),this}disable(){return this._enabled?(this._enabled=!1,this._modules.settings.update(this._prevSettings),this._cursorEnabled&&this._modules.graphics.removeCursorStyle(this._options.cursorStyle),this):this}enabled(){return this._enabled}},qk=["top","bottom","left","right","cssDefined"],jk=1e4,Yk={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},Hk={position:"top",autoAdjust:!0,delay:100},Xk={hover:{node:({target:t})=>t&&t.isNode,edge:({target:t})=>t&&!t.isNode},click:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}},doubleclick:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}}},$k=class extends Ot{constructor(){super(...arguments),this._x=0,this._y=0}onMounted(){this._handlers={},this._currentHandlerName=null,this._tooltip=null,this._isHover=!1,this._modules.events.register(["tooltipShow","tooltipHide"]),this._modules.events.on(["mouseup","dragStart"],()=>{this._isHover||this._hideTooltip(!1)}).on("mouseout",()=>{this._isHover&&this._hideTooltip(!1)}).on("clearGraph",()=>this._hideTooltip(!1)),this._modules.interactions.onHover(this._createInteraction("hover",!0)),this._modules.interactions.onClick(this._createInteraction("click")),this._modules.interactions.onDoubleClick(this._createInteraction("doubleclick"))}hide(){this._hideTooltip(!0)}isShown(){return!!this._tooltip}refresh(){this._refreshTooltip()}show(t,{position:e="top",autoAdjust:s=!0,className:i,x:n=0,y:r=0}={}){this._showTooltip(t,{position:e,autoAdjust:s,className:i},{x:n,y:r})}setHandler(t,e,s){const i={...Hk,...s};i.position&&qk.indexOf(i.position)===-1&&(i.position="top"),this._handlers[t]={handler:e,condition:ye(Xk,t),settings:i}}_hideTooltip(t){if(this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null),t&&(this._currentHandlerName=null),this._tooltip){const e=this._tooltip;this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null,this._modules.events.fire("tooltipHide",{tooltip:e})}}_createInteraction(t,e=!1){return{priority:"tooltip",check:s=>{const i=P_(t,s),n=this._handlers[i];return(!e||!this._modules.connectNodes.enabled())&&(!(!n||!n.condition(s))||!(e||!this._currentHandlerName||this._isHover)&&this._tooltip!==null)},handler:s=>{const{target:i,x:n,y:r}=s;this._hideTooltip(!1),this._isHover=e,this._elt=i,this._x=n,this._y=r,this._currentHandlerName=P_(t,s),this._refreshTooltip()}}}_refreshTooltip(){if(!this._currentHandlerName)return void this._hideTooltip(!1);const t=this._handlers[this._currentHandlerName];if(!t)return;const{settings:e,handler:s}=t,i=this._elt;if(i){const r=i.isNode?"node":"edge";if(this._currentHandlerName.indexOf(r)===-1)return}const n=s(i);Promise.resolve(n).then(r=>{this._schedule(()=>this._showTooltip(r,e),e.delay)})}_schedule(t,e){this._timeout&&this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>{this._timeout=null,t()},e)}_showTooltip(t,e,s){this._hideTooltip(!1);const{position:i,className:n,autoAdjust:r}=e;let o=this._x,a=this._y,l=this._elt;const d=this._modules.dom.getDimensions();let h=0,u=0;if(s&&(o=s.x,a=s.y,l=null),typeof t=="string")this._tooltip=Wk("div"),Iy(this._tooltip,bc.sanitize(t));else{if(!ax(t))throw new Error(`invalid tooltip ${t}, expected HTML string or HTML element`);this._tooltip=t}const c=this._tooltip;if(n&&this._tooltip.classList.add(n),i!=="cssDefined"&&(c.style.position="absolute"),c.style.zIndex=jk.toString(),this._modules.dom.appendElement(c),l&&l.isNode){const f=l,p=f.getPositionOnScreen(),_=Number(f.getAttribute("radius"))*(f.getAttribute("scalingMethod")==="fixed"?1:this._modules.camera.getZoom())+Number(f.getAttribute("innerStroke.width"))+Number(f.getAttribute("outerStroke.width"));o=p.x,a=p.y,h=_,u=_}const g=c.offsetWidth/2,m=c.offsetHeight/2;if(h+=g,u+=m,i&&i!=="cssDefined"){const f=Yk[i];let p=f.x,_=f.y;if(r){const y=o+h*f.x,x=a+u*f.y;(y-g<0||y+g>=d.width)&&(i==="left"||i==="right"?p*=-1:p=y-g<0?(g-y+1)/h:(d.width-(y+g)-1)/h),(x-m<0||x+m>=d.height)&&(i==="top"||i==="bottom"?_*=-1:_=x-m<0?(m-x+1)/u:(d.height-(x+m)-1)/u)}c.style.left=o+h*p-g+"px",c.style.top=a+u*_-m+"px"}this._modules.events.fire("tooltipShow",{tooltip:c})}};function P_(t,{button:e,target:s}){return`${t}${e?`.${e}`:""}.${s!==null?s.isNode?"node":"edge":"background"}`}function Wk(t){return vi?document.createElement(t):Ul()}var Lo={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"},z_=Object.keys(Lo).reduce((t,e)=>{const s=Lo[e];return t[s]||(t[s]=[]),t[s].push(e),t},{}),Zk=class extends Ot{constructor(){super(...arguments),this._onBlur=()=>this.resetKeys(),this._onKeyUp=t=>{const e=t.keyCode||t.which;this._pressed[e]=!1,this._modules.events.fire("keyup",{domEvent:t,key:Lo[e],code:e})},this._onKeyDown=t=>{const e=t.keyCode||t.which,s=this._binds[e];if(!this._pressed[e]){if(this._pressed[e]=!0,s)for(const i of s)i.keys.every(n=>n.some(r=>this._pressed[r]))&&i.handler({domEvent:t});this._modules.events.fire("keydown",{domEvent:t,key:Lo[e],code:e})}}}onMounted(){this._modules.events.register(["keyup","keydown"]),this._binds=[],this._pressed=[],this._modules.dom.addWindowEventListener("keydown",this._onKeyDown).addWindowEventListener("keyup",this._onKeyUp).addWindowEventListener("visibilitychange",this._onBlur).addWindowEventListener("blur",this._onBlur,!1),this._idleTimeout=4e3,this._prevEventTimeStamp=Xe(),this._modules.events.onAnyEvent(()=>{const t=Xe();t-this._prevEventTimeStamp>this._idleTimeout&&this.resetKeys(),this._prevEventTimeStamp=t})}setIdleTimeout(t){if(!isFinite(t)||t<=1)throw new TypeError("Idle timeout must be a positive number > 1");this._idleTimeout=t}resetKeys(){for(let t=0;t<this._pressed.length;t++)this._pressed[t]&&(this._pressed[t]=!1,this._modules.events.fire("keyup",{key:Lo[t],code:t}))}onKeyPress(t,e){let s=[];if(typeof t=="number")s=[t];else if(typeof t=="string")s=t.split(" ");else{if(!Array.isArray(t))throw new TypeError(`${t} is not a number, string or array`);s=t}if(s.length===0)throw new Error("the array should contain at least one element");const i=s.map(o=>{if(typeof o=="number")return[o];if(typeof o=="string"){const a=z_[o];if(!a)throw new Error(`${o} is not a valid key identifier`);return a}throw new TypeError(`${o} is not a valid key identifier`)}),n=i.pop(),r={keys:i,handler:e};n&&n.forEach(o=>{this._binds[o]||(this._binds[o]=[]),this._binds[o].push(r)})}isPressed(t){if(typeof t=="number")return this._pressed[t];if(typeof t=="string"){const e=z_[t];if(e)return e.some(s=>this._pressed[s])}return!1}},Kk=[{name:"color",isNode:!0},{name:"shape",isNode:!0},{name:"radius",isNode:!0},{name:"icon.content",isNode:!0},{name:"image.url",isNode:!0},{name:"image",isNode:!0},{name:"color",isNode:!1},{name:"shape",isNode:!1},{name:"width",isNode:!1}],wi=Math.PI,Ti=2*Math.PI,FA=Math.cos(wi/2-Ti/5),PA=Math.cos(wi/2-Ti/5*2),zA=Math.cos(wi/2-Ti/5*3),DA=Math.cos(wi/2-Ti/5*4),OA=Math.sin(-wi/2+Ti/5),kA=Math.sin(-wi/2+Ti/5*2),BA=Math.sin(-wi/2+Ti/5*3),UA=Math.sin(-wi/2+Ti/5*4),gd=1.6,GA=3,Qk=.9,al=.31,Fh=1/3,Jk=[8,3],tB=[3,3],ll={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:t=>t[t.length-1]},eB=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];function VA(t){return Array.isArray(t)?t.reduce((e,s)=>e&&VA(s),!0):t==="undefined"||!isNaN(Number(t))}function qA(t){return Array.isArray(t)?t.reduce((e,s)=>Math.min(e,qA(s)),1/0):typeof(t=Number(t))=="number"?isNaN(t)?1/0:+t:1/0}function jA(t){return Array.isArray(t)?t.reduce((e,s)=>Math.max(e,jA(s)),-1/0):typeof(t=Number(t))=="number"?isNaN(t)?-1/0:+t:-1/0}function bi(t){const e=["K","M","B","T","P","E","Z","Y"];if(t>9999){let s=0;for(;s<e.length&&t>999;)t/=1e3,s++;return(D_(t,3)+e[s-1]).toString()}return D_(t,4).toString()}function D_(t,e=3){const s=e===4?10:1;return t<10?Math.round(100*t*s)/(100*s):t<100?Math.round(10*t*s)/(10*s):t<1e3?Math.round(t*s)/s:Math.round(t)}function YA(t){return t.innerMargin+(t.titleFontSize+t.fontSize)*gd}var sB=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.title<=e.title?-1:1,iB=(t,e)=>t.height-e.height,nB=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:e.height-t.height,rB=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.content[0].title<=e.content[0].title?-1:1;function oB(t,e,s){const i=e.getContext("2d"),{x:n,y:r,height:o,isNode:a,styleProperty:l,title:d,mapping:h,iconFont:u,iconFontStyle:c}=s;dB(i,t,n,r,o),hB(i,t,d,n,r);const g=t.fontSize*gd,m=t.fontSize/2*gd*Qk,f=t.fontSize*GA,p=t.fontSize,_=lB(t,a);let y=r+YA(t);const x=n+t.innerMargin+_/2,b=n+2*t.innerMargin+_,v=_o(h),A=VA(v),E=t.fontColor,S=t.shapeColor,w=Object.keys(h);if(A&&(w.sort((T,L)=>mi(h[L])-mi(h[T])),l==="radius"||l==="width")){const T=qA(v),L=jA(v);return(a?wB:TB)(t,i,n,y,T,(T+L)/2,L,S)}w.forEach(T=>{const L=h[T];l==="color"&&(a?HA(i,x,y,m,T):cB(i,x,y,f,p,T)),l==="shape"&&(a?xB(i,x,y,m,T,S):EB(i,x,y,f,p,T,S)),l==="icon.content"&&gB(i,x,y,T,u,m,E,c),l!=="image"&&l!=="image.url"||mB(i,x,y,m,T),uB(i,t,b,y,L,A),y+=g})}function aB(t,e,s,i,n,r){t.beginPath(),t.arc(e,s,i,0,Ti),t.strokeStyle=n,t.lineWidth=r,t.stroke()}function aa(t,e,s,i,n="left",r="normal"){t.textAlign=n,t.textBaseline="middle",t.fillStyle=i,t.font=`${r} ${s}px "${e}"`}function lB(t,e){const s=e?1:GA;return t.fontSize*s}function dB(t,e,s,i,n){return SB(t,s,i,e.widgetWidth,n,e.borderRadius,e.backgroundColor,e.borderColor,e.borderWidth)}function hB(t,e,s,i,n){aa(t,e.fontFamily,e.titleFontSize,e.titleFontColor,e.titleTextAlign);const r=e.titleTextAlign==="center",o=e.widgetWidth-2*e.innerMargin,a=t.measureText(s).width,l=i+(r?e.widgetWidth/2:e.innerMargin),d=n+e.titleFontSize/2+e.innerMargin;if(a>o){const h=o/a,u=(s.length*h|0)-2;s=s.substr(0,u)+""}t.fillText(s,l,d)}function uB(t,e,s,i,n,r){let o=n.join();if(r)if(n.length===1)o=bi(n[0]);else{const a=mi(n),l=Qn(n);o=`${bi(a)} - ${bi(l)}`}aa(t,e.fontFamily,e.fontSize,e.fontColor),t.fillText(o,s,i)}function HA(t,e,s,i,n){t.beginPath(),t.arc(e,s,i,0,2*wi),t.fillStyle=n,t.fill()}function cB(t,e,s,i,n,r){t.fillStyle=r,t.fillRect(e-i/2,s-n/2,i,n)}function gB(t,e,s,i,n,r,o,a){aa(t,n,2*r,o,"center",a),t.fillText(i,e,s)}function mB(t,e,s,i,n){if(typeof Image>"u")return;t._imgStore||(t._imgStore={});let r=t._imgStore[n];if(r)return t.drawImage(r,e-i,s-i,2*i,2*i);r=new Image,r.src=n,r.onload=()=>{t.drawImage(r,e-i,s-i,2*i,2*i)},t._imgStore[n]=r}function fB(t,e,s,i){t.fillRect(e-i,s-i*al,2*i,2*i*al),t.fillRect(e-i*al,s-i,2*i*al,2*i)}function pB(t,e,s,i){return t.beginPath(),t.moveTo(e-i,s),t.lineTo(e,s-i),t.lineTo(e+i,s),t.lineTo(e,s+i),t.fill()}function _B(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+FA*i,s+OA*i),t.lineTo(e+PA*i,s+kA*i),t.lineTo(e+zA*i,s+BA*i),t.lineTo(e+DA*i,s+UA*i),t.fill()}function yB(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+PA*i,s+kA*i),t.lineTo(e+DA*i,s+UA*i),t.lineTo(e+FA*i,s+OA*i),t.lineTo(e+zA*i,s+BA*i),t.fill()}function xB(t,e,s,i,n,r){switch(t.fillStyle=r,n){case"square":return t.fillRect(e-i,s-i,2*i,2*i);case"circle":return HA(t,e,s,i,r);case"cross":return fB(t,e,s,i);case"diamond":return pB(t,e,s,i);case"equilateral":return _B(t,e,s,i);case"star":return yB(t,e,s,i)}}function bB(t,e,s,i,n){t.fillRect(e-i/2,s-n/4,i*(1-Fh),n/2),t.beginPath(),t.moveTo(e+i*(1-Fh-.5),s-n/2),t.lineTo(e+i*(1-Fh-.5),s+n/2),t.lineTo(e+i/2,s),t.fill()}function vB(t,e,s,i,n,r,o){t.beginPath(),t.moveTo(e-i/2,s),t.lineTo(e+i/2,s),t.strokeStyle=r,t.lineWidth=n/2,t.setLineDash(o==="dashed"?Jk:tB),t.stroke()}function AB(t,e,s,i,n){t.beginPath(),t.moveTo(e-i/2,s-n/2),t.lineTo(e-i/2,s+n/2),t.lineTo(e+i/2,s),t.fill()}function EB(t,e,s,i,n,r,o){return t.fillStyle=o,r==="line"&&t.fillRect(e-i/2,s-n/4,i,n/2),r==="arrow"?bB(t,e,s,i,n):r==="dashed"||r==="dotted"?vB(t,e,s,i,n,o,r):r==="tapered"?AB(t,e,s,i,n):void 0}function SB(t,e,s,i,n,r,o,a,l){t.setLineDash([]),t.beginPath(),t.moveTo(e+r,s),t.lineTo(e+i-r,s),t.quadraticCurveTo(e+i,s,e+i,s+r),t.lineTo(e+i,s+n-r),t.quadraticCurveTo(e+i,s+n,e+i-r,s+n),t.lineTo(e+r,s+n),t.quadraticCurveTo(e,s+n,e,s+n-r),t.lineTo(e,s+r),t.quadraticCurveTo(e,s,e+r,s),t.closePath(),t.fillStyle=o,t.fill(),t.strokeStyle=a,t.lineWidth=l,t.stroke()}function wB(t,e,s,i,n,r,o,a){const l=.7*t.fontSize,d=3*l,h=(l+d)/2,u=s+t.innerMargin+d,c=u+d+t.innerMargin,g=i+2*d-.5*t.innerMargin,m=t.circleStrokeWidth;for(const f of[l,h,d])aB(e,u,g-f,f,a,m);aa(e,t.fontFamily,t.fontSize,t.fontColor,"left"),e.fillText(bi(n),c,g+l-2*l),e.fillText(bi(r),c,g+l-2*h),e.fillText(bi(o),c,g+l-2*d)}function TB(t,e,s,i,n,r,o,a){const l=(t.widgetWidth-2*t.innerMargin)/3,d=t.fontSize,h=i-t.innerMargin/2,u=h+2*d,c=s+t.innerMargin;e.fillStyle=a,e.fillRect(c,h-d/2,l+1,d),e.fillRect(c+l,h-d/3,l+1,d/1.5),e.fillRect(c+2*l,h-d/6,l,d/3),aa(e,t.fontFamily,t.fontSize,t.fontColor,"center"),e.fillText(bi(o),c+.5*l,u),e.fillText(bi(r),c+1.5*l,u),e.fillText(bi(n),c+2.5*l,u)}function IB(t,e,s,i){const n=i.outerMargin+YA(i),r=i.fontSize*gd,o=n-.8*i.innerMargin;return e==="radius"||e==="width"?o+r*(s?3:2):o+Object.keys(t).length*r}function LB(t,e,s){const i={width:e.width,height:e.height};let n=!1;return!!(i.width&&i.height&&s)&&(n=t.position==="top"||t.position==="bottom"?RB(i,t,s,t.position==="bottom"):CB(i,t,s,t.position==="left"),n&&s.forEach(r=>oB(t,e,r)),n)}function CB(t,e,s,i){const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height;let a=e.outerMargin,l=i?e.outerMargin:t.width-n,d=1;s=s.slice().sort(sB);for(let h=0;h<s.length;++h){const u=s[h];if(a+u.height>o){if(a===e.outerMargin)return!1;a=e.outerMargin,d+=1,i?l+=n:l-=n}u.x=l,u.y=a,a+=u.height}return d<=r}function NB(t,e,s){let i=null;for(let n=0;n<e.length;++n){const r=e[n];r.isNode!==t.isNode&&e.length!==1||!(i===null||r.height<e[i].height)||(i=n)}if(i!=null){const n=e[i];n.content.push(t),n.height+=t.height+s.outerMargin}}function MB(t){let e=0;for(let s=1;s<t.length;++s)t[s].height>t[e].height&&(e=s);return e}function RB(t,e,s,i){s=s.slice();const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height-e.outerMargin,a=new Array(Math.min(r,s.length)),l=s.length;let d=0,h=0,u=0,c=0;for(let x=0;x<l;++x){const b=s[x];b.isNode?(d+=1,h+=b.height):(u+=1,c+=b.height)}const g=h+c,m=h/g,f=c/g;let p=Math.round(m*r);const _=Math.round(f*r);if(p>d?p=d:_>u&&(p=r-u),r===0)return!1;for(let x=0;x<a.length;x++)a[x]={content:[],height:0,isNode:x<p};for(let x=0;x<l;++x){const b=MB(s);NB(s[b],a,e),s.splice(b,1)}a.every(({content:x})=>x.length===1)?a.sort(rB):a.sort(nB);let y=e.outerMargin;for(let x=0;x<a.length;++x){const b=a[x];if(b.height>o)return!1;b.content.sort(iB);let v=0;for(let A=0;A<b.content.length;++A){const E=b.content[A];E.x=y,E.y=i?t.height-v-E.height-e.outerMargin:v+e.outerMargin,v+=E.height+e.outerMargin}y+=n}return!0}var FB=class extends Ot{constructor(){super(...arguments),this._enabled=!1,this._mustRefresh=!1,this._promises=[]}onMounted(){this._modules.events.on("frame",()=>{this._enabled&&this._mustRefresh&&this._layer.refresh()}).on(["resize","reloadFonts"],()=>{this._mustRefresh=!0})}enable(t={}){const e=this._settings;return this._settings={...ll,...t},this._mustRefresh=!this._enabled||!this._sameOptions(e,this._settings),this._enabled?Promise.resolve():(this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(s=>{this._drawOnCanvas(this._settings,s.canvas,gs());const i=this._promises;this._promises=[],i.forEach(n=>n()),this._mustRefresh=!1},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this.refresh())}_afterNextUpdate(){return new Promise(t=>this._promises.push(t))}_formatSettings(t,e){const s={...ll,...t};return eB.forEach(i=>s[i]*=e),s}disable(){return this._enabled&&(this._enabled=!1,this._layer.destroy()),Promise.resolve()}enabled(){return this._enabled}refresh(){return this._mustRefresh=!0,this._modules.dom.refresh(),this._afterNextUpdate()}destroy(){this._enabled=!1,this._mustRefresh=!1,this._settings={...ll},this._promises=[]}getOptions(){return this._enabled?{...this._settings}:{...ll}}getCurrentOptions(){return this._settings}_sameOptions(t,e){return t===e||Object.keys(t).reduce((s,i)=>s&&t[i]===e[i],!0)}_drawOnCanvas(t,e,s){const i=this._formatSettings(t,s);LB(i,e,this._computeWidgetList(i))}exportOnCanvas(t,e,s){return this._drawOnCanvas(e,t,s)}export(t={}){const{width:e,height:s}={...this._modules.camera.getSize(),...t},i=gs(),n=Ge(e*i,s*i);return this._drawOnCanvas(t,n,i),Promise.resolve().then(()=>n)}_computeWidgetList(t){const e=[];return Kk.forEach(({name:s,isNode:i})=>{const n=this._computeWidget(t,s,i);n&&e.push(n)}),e}_computeWidget(t,e,s){const i=this._computePropertyMapping(t,e,s);if(i){if(e!=="icon.content")return i;const n=this._getRulesForAttribute(s,"icon.font"),r=this._getRulesForAttribute(s,"icon.style");let o=null,a=null;if(n.length||(o="Arial",a="normal"),typeof n[0]=="string"&&(o=n[0],a=r[0]),o&&a)return i.iconFont=o,i.iconFontStyle=a,i}return null}_computePropertyMapping(t,e,s){const[i]=this._getRulesForAttribute(s,e),n=i&&i.mapping,r=n&&n.getValues(s);if(n&&r){const o=n.getField(),a={};return ni(r,(l,d)=>{l!==void 0&&d!=="undefined"&&(a[l]=a[l]||[],a[l].push(d))}),Object.keys(a).length===0?null:{isNode:s,title:t.titleFunction(o,e),styleProperty:e,dataProperty:o,mapping:a,height:IB(a,e,s,t)}}return null}_getRulesForAttribute(t,e){return this._modules.styleRules.getRuleList().map(s=>{const i=s.getDefinition();return ye(t?i.nodeAttributes:i.edgeAttributes,e)}).filter(qs).sort((s,i)=>s.mapping&&i.mapping?0:s.mapping?-1:1)}},O_={layer:ib,outerStroke:{color:I0,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:L0,minVisibleSize:0}},PB={layer:ib,color:I0,text:{backgroundColor:L0,minVisibleSize:0}},k_={duration:150,easing:"quadradicOut"},zB=class extends Ot{constructor(){super(...arguments),this._delay=16,this._manualTriggerDetection=!1,this._hovered=null,this._hoveredTextHidden=!1,this._onAnimate=({updatesPositions:t})=>{t&&this._hovered&&this._modules.graphics.isMoving(this._hovered)&&(this._manualTriggerDetection=!0,this._resetHover())},this._onBeforeNewFrame=()=>{if(this._manualTriggerDetection){this._manualTriggerDetection=!1,this._modules.captor.triggerDetection();const t=this._modules.captor.getPointedElement();t&&this._hover(t)}},this._onClear=()=>{this._hovered=null,this._timeout&&this._modules.dom.clearTimeout(this._timeout)},this._resetHover=()=>{this._hovered&&(this._unhover(this._hovered),this._modules.captor.triggerUnhover()),this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}}_setAnimationOptions(t){this._animationOptions={duration:t?.duration!==void 0?t.duration:k_.duration,easing:t?.easing!==void 0?t.easing:k_.easing},delete t?.duration,delete t?.easing}setRate(t){return this._delay=t,this}replaceNullColor(t,e){t&&ye(t,e)===null&&_i(t,e,this._modules.settings.get("backgroundColor"))}updateNodeAttributes(t,e){this._setAnimationOptions(t),this.replaceNullColor(t,"text.backgroundColor"),this._hoverClass.update({nodeAttributes:t,fullOverwrite:e}),this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}updateEdgeAttributes(t,e){this.replaceNullColor(t,"text.backgroundColor"),this.replaceNullColor(t,"text.secondary.backgroundColor"),this._setAnimationOptions(t),this._hoverClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}getHoverClassDefinition(){return this._hoverClass.getDefinition()}onMounted(){this._registerSettings(),this._setAnimationOptions(null),this._hoverExtremityHighlightedClass=this._modules.classes.createClass({name:uu,isBuiltin:!0,nodeAttributes:O_}),this._hoverClass=this._modules.classes.createClass({name:xo,isBuiltin:!0,nodeAttributes:O_,edgeAttributes:PB}),this._modules.events.on("mouseover",({target:t})=>t&&this._hover(t)).on("mouseout",({target:t})=>t&&this._unhover(t)).on("animate",this._onAnimate).on("beforeNewFrame",this._onBeforeNewFrame).on("mouseout",this._resetHover).on("clearGraph",this._onClear)}_registerSettings(){this._modules.settings.register("cursor.node","pointer",(t,e)=>{this._hovered&&this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("cursor.edge","pointer",(t,e)=>{this._hovered&&!this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("nodeHover",!0,t=>{!t&&this._hovered&&this._hovered.isNode&&this._unhover(this._hovered)}),this._modules.settings.register("edgeHover",!0,t=>{t||!this._hovered||this._hovered.isNode||this._unhover(this._hovered)})}setEdgeExtremitiesAttributes(t,e){this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e})}_updateExtremityHighlightLayer(){const t=this._hoverClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}_removeTimeout(){this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}_hover(t){const e=t.isNode?"nodeHover":"edgeHover";this._modules.settings.get(e)&&t&&(this._removeTimeout(),this._timeout=this._modules.dom.setTimeout(()=>{this._setElementHighlight(!0,t),this._timeout=null},this._delay))}_unhover(t){this._removeTimeout(),this._hovered===t&&(this._setElementHighlight(!1,t),this._hoverExtremityHighlightedClass.clearNodes(),this._hovered=null)}_setElementHighlight(t,e){const s=this._modules.settings.get(e.isNode?"cursor.node":"cursor.edge");if(t?(this._modules.graphics.addCursorStyle(s),e.addClass(xo,this._animationOptions),this._hovered=e):(this._modules.graphics.removeCursorStyle(s),e.removeClass(xo,this._animationOptions)),e.isNode){const i=this._modules.graph.getAttribute(e.isNode,"textHidden"),n=e._index;t&&(this._hoveredTextHidden=i.get(n)!==0);const r=!t&&this._hoveredTextHidden;i.set(n,r)}else this._hoverExtremityHighlightedClass.clearNodes(),t&&e.getExtremities().addClass(uu,this._animationOptions)}},DB=class extends Ot{constructor(){super(...arguments),this.x=0,this.y=0}},OB=class{constructor(t,e){this._nodeMapping={valid:!1,values:{}},this._edgeMapping={valid:!1,values:{}},this._computeMapping=e,this._field=t,this._assignedRules=[]}getValue(t,e){const s=t.isNode,i=s?this._nodeMapping:this._edgeMapping;i.valid||(i.values=this._computeMapping(s),i.valid=!0);const n=t.getData(this._field);return Array.isArray(n)?e==="color"?n.map(r=>i.values[r]):i.values[n[0]]:i.values[n]}markAsInvalid(){this._nodeMapping.valid=!1,this._edgeMapping.valid=!1}getValues(t){return t?this._nodeMapping.values:this._edgeMapping.values}getField(){return this._field}isAssignedTo(t){return this._assignedRules.find(e=>e===t)}getAssignedRules(){return this._assignedRules.slice()}assignTo(t){this.isAssignedTo(t)||this._assignedRules.push(t)}unAssignTo(t){this._assignedRules=this._assignedRules.filter(e=>e!==t)}};function XA(t,e,s){const i=(e?t.getNodes():t.getEdges()).getData(s),n={};return i.forEach(r=>{if(!Array.isArray(r))return n[r]=1;r.forEach(o=>n[o]=1)}),Object.keys(n).sort()}function kB(t,e,s,i){const{values:n={},fallback:r}=s,o=XA(t,i,e),a={};let l=0;for(let d=0;d<o.length;++d){const h=o[d];h in n?a[h]=n[h]:(a[h]=r[l],l=(l+1)%r.length)}return a}function BB(t,{nbSlices:e,minValue:s,maxValue:i}){if(Array.isArray(t))return t.slice();const{min:n=s,max:r=i}=t,o=(r-n)/e,a=[];for(let l=1;l<e;++l)a.push(n+o*l);return a}function UB(t,e){if(Array.isArray(t))return t;const{min:s,max:i}=t,n=e.length+1,r=(i-s)/e.length,o=[];for(let a=0;a<n;a++)o.push(s+a*r);return o}function GB(t,e,s,i){const{fallback:n,stops:r={},values:o,reverse:a}=s,l=XA(t,i,e);let d=1/0,h=-1/0;for(let m=0;m<l.length;m++){const f=+l[m];Md(f)&&(d=Math.min(d,f),h=Math.max(h,f),l[m]=f)}const u={};if(!isFinite(d)){for(let m=0;m<l.length;m++)u[l[m]]=n;return u}const c=BB(r,{nbSlices:Array.isArray(o)?o.length:o.nbSlices,minValue:d,maxValue:h}),g=UB(o,c);a&&g.reverse();for(let m=0;m<l.length;++m){const f=l[m];if(isFinite(f)){let p=0;for(;p<c.length&&c[p]<=f;)p+=1;u[f]=g[p]}else u[f]=n}return u}var VB=class extends Ot{constructor(){super(...arguments),this._mappingList=[],this._onStyleRuleRemoved=({rule:t})=>{for(const e of this._mappingList)e.unAssignTo(t.id)},this._onStyleRuleAdded=({rule:t,options:e})=>{const s=e.nodeAttributes&&typeof e.nodeAttributes!="function"?e.nodeAttributes:{},i=e.edgeAttributes&&typeof e.edgeAttributes!="function"?e.edgeAttributes:{};[..._o(s),..._o(i)].forEach(n=>{n&&this._recursiveGetMapping(n).forEach(r=>r.assignTo(t.id))})},this._refreshRulesAndLegend=()=>{this._mappingList.forEach(t=>{const e=t.getAssignedRules();t.markAsInvalid(),e.forEach(s=>this._modules.styleRules.refreshRule(s))}),this._modules.legend.refresh()}}onMounted(){this._modules.events.on(["addStyleRule","updateStyleRule"],this._onStyleRuleAdded).on("removeStyleRule",this._onStyleRuleRemoved).on(["addNodes","addEdges","updateNodeData","updateEdgeData","removeNodes","beforeRemoveEdges","excludedStateChange","clearGraph"],this._refreshRulesAndLegend)}_recursiveGetMapping(t,e=[]){if(!t)return e;if(t.mapping)return e.push(t.mapping),e;if(typeof t!="object")return e;const s=_o(t).map(i=>this._recursiveGetMapping(i));return e.concat(...s)}createMapping({field:t,values:e={},fallback:s}={field:""}){if(t=Tn(t),Array.isArray(s)?s.length===0&&(s=[void 0]):s=[s],!In(e))throw new Error('"mapping" should be an object');return this._createMappingFunction(kB,t,{values:e,fallback:s})}createSlices({field:t,fallback:e,stops:s={},values:i,reverse:n=!1}={field:"",values:[]}){if(t=Tn(t),Array.isArray(i)||i.nbSlices||(i.nbSlices=7),Array.isArray(s)&&Array.isArray(i)&&s.length!==i.length-1)throw new Error("there should be exactly one more value that stops");return this._createMappingFunction(GB,t,{fallback:e,stops:s,values:i,reverse:n})}_createMappingFunction(t,e,s){const i=new OB(e,r=>t(this._modules.graph,e,s,r));this._mappingList.push(i);const n=(r,o,a)=>i.getValue(r,a);return n.mapping=i,n}createTemplate(t){if(typeof t!="string")throw new TypeError('"template" should be a string');const e=[];let s=0,i=!1;for(;!i;){let n=-1;const r=t.indexOf("{{",s);r!==-1&&(n=t.indexOf("}}",r+2)),n!==-1?(e.push(t.substring(s,r)),e.push(t.substring(r+2,n)),s=n+2):(e.push(t.slice(s)),i=!0)}return function(n){let r=e[0];for(let o=1;o<e.length;o+=2)r+=n.getData(e[o]),r+=e[o+1];return r}}},B_=t=>t.stopPropagation(),qB=(t,e)=>{e.style.position="absolute",e.style.left="0",e.style.top="0",t.appendChild(e)},jB=t=>e=>{for(;t.firstChild;)t.removeChild(t.firstChild);for(let s=0;s<e.length;++s)qB(t,e[s])},YB=(t,e)=>{const s=document.createElement("img");return new Promise(i=>{s.addEventListener("load",()=>{e.drawImage(s,0,0,e.canvas.width,e.canvas.height),i(e)});const n=`data:image/svg+xml;base64,${btoa(new XMLSerializer().serializeToString(t))}`;s.src=n})},HB=class extends Ot{constructor(){super(...arguments),this._elements=[],this._layers=[],this.readyCallbacks=[],this.render=(t,e,s,i)=>{const n=i&&i.pixelRatio?i.pixelRatio:gs(),{zoom:r,x:o,y:a,width:l,height:d}=i||this._modules.camera.getView();if(r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=n*r;s.noClear||t.clearRect(0,0,l*n,d*n),s.isStatic||(t.save(),t.translate(l*n/2,d*n/2),t.rotate(i?-(i.angle||0):-this._modules.camera.getAngle()),t.translate(-o*h,-a*h),t.scale(h,h)),e(t),s.isStatic||t.restore()},this.createCanvas=(t,e)=>{const{width:s,height:i}=this._modules.camera.getSize(),n=e.canvas||Ge(s,i),r=e.ctx||n.getContext("2d"),o=(h=t)=>{r&&this.render(r,h,e)},a=()=>{const{width:h,height:u}=this._modules.camera.getSize(),c=gs();n.width=h*c,n.height=u*c,n.style.width=`${h}px`,n.style.height=`${u}px`,o()};let l,d;if(e.isStatic)this._modules.events.on("resize",a),l=()=>this._modules.events.off(a);else{let h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom(),c=!1;const g=0;let m;const f=500,p=()=>{c||(o(),c=!0,h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom())},_=()=>{c||p();const{x:b,y:v}=this._modules.camera.getCenter(),A=b-h.x,E=v-h.y,S=-A*u,w=-E*u,T=this._modules.camera.getZoom()/u,L=-this._modules.camera.getAngle();n.style.transform=`
          scale(${T})
          rotate(${-L}rad)
          translateX(${S}px)
          translateY(${w}px)
          rotate(${L}rad)
        `.replace(/\n/g,"")};d=()=>!c||(o(),c=!1,n.style.transform="scale(1) translateX(0px) translateY(0px)",!1);const y=b=>{m&&clearTimeout(m),p()},x=b=>{Date.now()<g&&m&&clearTimeout(m),m=setTimeout(d,b.duration+f),p()};this._modules.events.on("dragStart",y).on("zoomStart",x).on("dragEnd",d).on(["viewChanged","zoom","rotate","move","animate"],_),this._modules.dom.addDirectWindowEventListener("resize",d),this._modules.events.on("resize",a),l=()=>{this._modules.events.off(a).off(y).off(x).off(d).off(_),this._modules.dom.removeDirectWindowEventListener("resize",d)}}return n.style.touchAction="none",n.style.pointerEvents="none",a(),{element:n,removeListeners:l,refresh:h=>{d&&!d()||o(h)},clear:()=>r?.clearRect(0,0,n.width,n.height)}},this.createSVG=t=>{const{element:e}=t;e.style["pointer-events"]="none";const s=()=>{t.draw(t.element)},i=n=>{let{zoom:r,x:o,y:a,width:l,height:d}=n||this._modules.camera.getView();if(l=Math.floor(l),d=Math.floor(d),r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=l/2/r,u=d/2/r,c=Math.cos(-this._modules.camera.getAngle()),g=Math.sin(-this._modules.camera.getAngle()),m=c*o-g*a-h,f=g*o+c*a-u,p=l/r,_=d/r;e.style.width=`${l}px`,e.style.height=`${d}px`,e.setAttribute("width",`${l}`),e.setAttribute("height",`${d}`),e.setAttribute("viewBox",`${m} ${f} ${p} ${_}`)};return this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],()=>i()),e.addEventListener("mousemove",B_),i(),s(),{element:e,removeListeners:()=>{this._modules.events.off(i)},updateTransformation:i,refresh:s}},this._createOverlay=t=>{const e=()=>{const{element:n,position:r}=t,{zoom:o,x:a,y:l,width:d,height:h}=this._modules.camera.getView();if(o===void 0||a===void 0||l===void 0||d===void 0||h===void 0)return null;const u=o,c=d/2,g=h/2,m=-this._modules.camera.getAngle(),f=(r.x-a)*u,p=(r.y-l)*u;n.style.transformOrigin="top left",n.style.transform=`translate(${c}px, ${g}px) rotate(${m}rad) translate(${f}px, ${p}px) ${t.scaled?`scale(${u}, ${u})`:""}`};this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],e);const{element:s,size:i}=t;return i&&(s.style.width=`${i.width}`,s.style.height=`${i.height}`),s.addEventListener("mousemove",B_),e(),{element:s,removeListeners:()=>{this._modules.events.off(e)},updateTransformation:e}},this.addLayer=(t,e="layer",s=this._elements.length)=>{const i=typeof t=="string"?$h(t):t;this._elements.push(i);const n={element:i};return n.type=e,n.getLevel=()=>this._elements.indexOf(i),n.moveTo=r=>(this._elements.splice(r,0,this._elements.splice(n.getLevel(),1)[0]),this._updateDom(this._elements),n),n.moveUp=()=>n.moveTo(n.getLevel()+1),n.moveDown=()=>n.moveTo(n.getLevel()-1),n.moveToTop=()=>n.moveTo(this._elements.length-1),n.moveToBottom=()=>n.moveTo(0),n.destroy=()=>this._removeLayer(n),n.hide=()=>(n.element&&(n.element.style.visibility="hidden"),n),n.show=()=>(n.element&&(n.element.style.visibility="visible"),n),n.isHidden=()=>n.element.style.visibility==="hidden",n.setOpacity=r=>(n.element&&(n.element.style.opacity=r.toString()),n),n.getOpacity=()=>parseFloat(n.element.style.opacity||"1"),n.setPosition=r=>{if(n.element){const o=n.element.style;o.left=`${r.x}px`,o.top=`${r.y}px`}return n},n.setSize=r=>{if(n.element&&r){const{width:o,height:a}=r,l=n.element.style;l.width=`${o}px`,l.height=`${a}px`}return n},n.moveTo(s),this._layers.push(n),n},this.addCanvasLayer=(t,e={isStatic:!1,noClear:!1},s=this._elements.length)=>{const i=this.createCanvas(t,e),{element:n,removeListeners:r,refresh:o,clear:a}=i,l=this.addLayer(n,"canvas",s);return n.classList.add("ogma-canvas-layer"),l.destroy=()=>this._removeLayer(l,r),l.refresh=o,l.clear=a,l.draw=t,l.options=e,l},this.addOverlay=(t,e=this._elements.length)=>{typeof t.element=="string"&&(t.element=$h(t.element)),t.scaled=t.scaled===void 0||t.scaled;const s=this._createOverlay(t),{element:i,removeListeners:n,updateTransformation:r}=s,o=this.addLayer(i,"overlay",e);return o._onViewChange=r,o._onDestroy=n,o.destroy=()=>this._removeLayer(o,n),o.setPosition=a=>(t.position=a,r(),o),t.size&&o.setSize(t.size),o},this.addSVGLayer=(t,e=this._elements.length)=>{const s=this.createSVG(t),{element:i,refresh:n,removeListeners:r,updateTransformation:o}=s,a=this.addLayer(i,"svg",e);return a._onViewChange=o,a._onDestroy=r,a.destroy=()=>this._removeLayer(a,r),a.refresh=n,a}}canvasToImage(t,e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");this.render(i,t.draw,{...t.options,noClear:!0},{...e,pixelRatio:1});const n=se("image");return n.setAttribute("href",s.toDataURL("image/png")),n.setAttribute("width",s.width),n.setAttribute("height",s.height),n}exportPNG(t,e,s){const i=t.getContext("2d");let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?(this.render(i,r.draw,{...r.options,noClear:!0},s),Promise.resolve()):(r._onViewChange&&r._onViewChange(s),YB(r.element,i)))}),n}exportSVG(t,e,s,i){let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?Promise.resolve(this.canvasToImage(r,s)):(r._onViewChange&&r._onViewChange(s),r.element.cloneNode(!0))).then(o=>i?t.insertBefore(o,t.querySelector(".ogma-nodes").parentNode||t.firstChild):t.appendChild(o))}),n}export(t){const e=this._layers.sort((n,r)=>n.getLevel()-r.getLevel()).filter(n=>n.type==="canvas"||n.type==="svg"),s=this.ogmaLayer?this.ogmaLayer.getLevel():0,i=t.below?e.filter(n=>n.getLevel()<s):e.filter(n=>n.getLevel()>s);return t.canvas?this.exportPNG(t.canvas,i,t.view):this.exportSVG(t.svg,i,t.view,t.below)}onMounted(){const t=this._modules.graphics.getDomElement();this._updateDom=jB(t);const e=t.firstChild;e&&(this.ogmaLayer=this.addLayer(e)),this.runCallbacks()}runCallbacks(){this.ogmaLayer&&(this.readyCallbacks.forEach(t=>t()),this.readyCallbacks=[])}whenReady(t){this.readyCallbacks.push(t),this.ogmaLayer&&this.runCallbacks()}_removeLayer(t,e){return t.element&&t.element.parentNode&&(this._elements.splice(t.getLevel(),1),e&&e(),t.element=null,this._updateDom(this._elements)),this._layers=this._layers.filter(s=>s!==t),t}destroy(){this._elements=[]}},XB=class extends Ot{onMounted(){const t=this._modules.graph;this._nodeList=t.getNodeAttribute("object"),this._edgeList=t.getEdgeAttribute("object"),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target"),this._excludedList=t.getEdgeAttribute("excluded"),this._virtualList=t.getEdgeAttribute("virtual")}shortestPath(t={source:void 0,target:void 0}){const{source:e,target:s,directed:i=!1,edges:n=this._ogma.getEdges(),nodes:r=this._ogma.getNodes(),edgeCostFunction:o=()=>1,heuristicFunction:a=()=>0}=t,l=n.reduce((f,p)=>(f[p._index]=!0,f),{}),d=r.reduce((f,p)=>(f[p._index]=!0,f),{}),h=this._modules.graph.getNode(e),u=this._modules.graph.getNode(s);if(!h)throw new Error("the source is not a node");if(!u)throw new Error("the target is not a node");const c=h._index,g=u._index;d[c]=!0,d[g]=!0;let m=null;if(c===g)m={nodes:h.toList(),edges:this._modules.graph.edgeList()};else{const f=this._modules.graph.getNodeMaxIndex()+1,p=new Int32Array(f),_=new Float32Array(f),y=new Float32Array(f),x=new Set,b=new Hx(y);for(_.fill(1/0),y.fill(1/0),p.fill(-1),b.add(c),_[c]=0,y[c]=a(h,u);!b.isEmpty();){const v=b.removeMin();if(v===g){m=this._constructPath(p,c,g);break}x.add(v);const A=this._modules.graph.getAdjacentDirections(v);if(A)for(let E=0;E<A.length;++E){const S=A[E],w=this._modules.graph.getEdgeIndexesInDirection(S);let T=-1,L=0,R=-1;for(let k=0;k<w.length;++k){const j=w[k],z=this._sourceList.get(j),q=this._targetList.get(j);if(z===q||!d[z]||!d[q]||i&&v!==z||!l[j])continue;const B=o(this._edgeList.get(j));(T===-1||B<L)&&(T=j,L=B,R=z===v?q:z)}if(R!==-1||x.has(R)){const k=_[v]+L;if(!b.has(R)||k<_[R]){const j=this._nodeList.get(v);p[R]=T,_[R]=k,y[R]=k+a(j,u),b.add(R)}}}}}return Promise.resolve(m)}_constructPath(t,e,s){const i=[s],n=[];let r=s;for(;r!==e;){const o=t[r],a=this._sourceList.get(o),l=this._targetList.get(o);r=r===a?l:a,i.push(r),n.push(o)}return i.reverse(),n.reverse(),{nodes:this._modules.graph.nodeList(new Uint32Array(i)),edges:this._modules.graph.edgeList(new Uint32Array(n))}}detectCycle(t,e){const s=e.getSource(),i=e.getTarget(),n=Gx(t._indexes,s._indexes,i._indexes);return n?this._modules.graph.nodeList(new Uint32Array(n)).dedupe():this._modules.graph.nodeList()}getAllSimpleCycles(t,e){const s=e.getSource(),i=e.getTarget();return new qx(t._indexes,s._indexes,i._indexes).getCycles().map(n=>this._modules.graph.nodeList(new Uint32Array(n)))}minimumSpanningTree(t,e,s){const i=this._modules.graph;t=i.getNodes(t),e=i.getEdges(e);const n=new Set;t.forEach(l=>n.add(l._index));const r=i.getConnectedComponents(t,{filter:l=>n.has(l),internalIndexes:!0}),o={};r.forEach((l,d)=>l.forEach(h=>o[h]=d));const a=[];return e.forEach(l=>{const d=o[l.getSource()._index];d!==void 0&&(a[d]===void 0&&(a[d]=[]),a[d].push(l._index))}),r.map((l,d)=>{const h=jx(l,a[d]||[],u=>i.edge(u).getSource()._index,u=>i.edge(u).getTarget()._index,s?u=>s(i.edge(u)):void 0);return{nodes:i.nodeList(new Uint32Array(l)),edges:i.edgeList(new Uint32Array(h))}})}bfs({root:t,onNode:e,onEdge:s=Xt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.unshift(h)})}}}dfs({root:t,onNode:e,onEdge:s=Xt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.push(h)})}}}betweenness({nodes:t,edges:e,directed:s,normalized:i}){const n=this._ogma.getNodes().subtract(t),r=this._ogma.getEdges().subtract(e).concat(n.fastGetAdjacentElements().edges).dedupe();return Yx({adjacency:t.map(o=>{const a=this._ogma.edgeList(this._ogma.modules.graph.topology.getAdjacentElements(!1,o.toList()._indexes,{direction:s?"out":"both"})).subtract(r).dedupe();return{id:o._index,adj:a.map(l=>l.getSource()._index===o._index?l.getTarget()._index:l.getSource()._index)}}),directed:s,normalized:i})}fishEyeExpand(t,e,s,i){return Rx(t,e,s,i)}},U_=(t,e)=>{if(!t)throw new Error("Traversal options are required");if(typeof t.onNode!="function")throw new Error("onNode callback is required");if(t.root=e.getNode(t.root),!t.root)throw new Error(`Root node '${t.root}' does not exist`);return t},dl=()=>({nodes:void 0,edges:void 0}),$B=class extends ce{constructor(){super(...arguments),this.shortestPath=t=>this._ogma.modules.algorithms.shortestPath(t),this.hasCycle=t=>{const{nodes:e,edges:s}=t||dl();return this.detectCycle({nodes:e,edges:s})!==null},this.getAllSimpleCycles=t=>{let{nodes:e,edges:s}=t||dl();return e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0})),this._ogma.modules.algorithms.getAllSimpleCycles(e,s)},this.detectCycle=t=>{let{nodes:e,edges:s}=t||dl();e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0}));const i=this._ogma.modules.algorithms.detectCycle(e,s);return i.size?i:null},this.minimumSpanningTree=t=>{const{nodes:e,edges:s,edgeCostFunction:i}=t||{...dl(),edgeCostFunction:void 0};return this._ogma.modules.algorithms.minimumSpanningTree(e,s,i)},this.dfs=t=>this._ogma.modules.algorithms.dfs(U_(t,this._ogma.modules.graph)),this.bfs=t=>this._ogma.modules.algorithms.bfs(U_(t,this._ogma.modules.graph)),this.betweenness=(t={})=>(t={nodes:t.nodes||this._ogma.getNodes(),edges:t.edges||this._ogma.getEdges(),directed:t.directed!==void 0&&t.directed,normalized:t.normalized===void 0||t.normalized},this._ogma.modules.algorithms.betweenness(t)),this.getMinimumEnclosingCircle=t=>{if(!t||t.size===0)throw new Error("getMinimumEnclosingCircle: no nodes provided");const e=t.getAttribute("x"),s=t.getAttribute("y"),i=t.getAttribute("radius"),[n,r,o]=Qo(e,s,i);return{x:n,y:r,radius:o}},this.circlePack=({nodes:t,margin:e=0,origin:s={x:0,y:0},duration:i=0,easing:n="linear",sort:r,dryRun:o})=>{if(!t||t.size===0)throw new Error("circlePack: no nodes provided");let a=t.map((d,h)=>({index:h,radius:+d.getAttribute("radius")+e,id:d.getId()}));if(r)if(r==="asc")a=a.sort((d,h)=>h.radius-d.radius);else if(r==="desc")a=a.sort((d,h)=>d.radius-h.radius);else{if(typeof r!="function")throw new Error("circlePack: invalid sort option");a=a.sort((d,h)=>r(t.get(d.index),t.get(h.index)))}if(s&&(!isFinite(s.x)||!isFinite(s.y)))throw new Error("circlePack: invalid origin");const l=Mx(a,s.x,s.y).reduce((d,{index:h,x:u,y:c})=>(d[h]={x:u,y:c},d),new Array(t.size));return o?l:t.setAttributes(l,{duration:i,easing:n}).then(()=>l)},this.fishEyeExpand=({nodes:t,focusNode:e,deltaRadius:s,duration:i=0,dryRun:n=!1,easing:r="linear",xyr:o})=>{if(!t||t.size===0)throw new Error("Expand/collapse: no nodes provided");if(!(e instanceof Vs))throw new Error("Expand/collapse: no focus node provided");if(!isFinite(s))throw new Error("Expand/collapse: invalid delta radius");const a=this._ogma.modules.algorithms.fishEyeExpand(t,e,s,o);return n?a:t.setAttributes(a,{duration:i,easing:r}).then(()=>a)}}},$A=mA,WB=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var WA={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}function r(l,d,h,u,c){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new n(h,u||l,c),m=s?s+d:d;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],g]:l._events[m].push(g):(l._events[m]=g,l._eventsCount++),l}function o(l,d){--l._eventsCount===0?l._events=new i:delete l._events[d]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(s?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},a.prototype.listeners=function(d){var h=s?s+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,g=u.length,m=new Array(g);c<g;c++)m[c]=u[c].fn;return m},a.prototype.listenerCount=function(d){var h=s?s+d:d,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(d,h,u,c,g,m){var f=s?s+d:d;if(!this._events[f])return!1;var p=this._events[f],_=arguments.length,y,x;if(p.fn){switch(p.once&&this.removeListener(d,p.fn,void 0,!0),_){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,h),!0;case 3:return p.fn.call(p.context,h,u),!0;case 4:return p.fn.call(p.context,h,u,c),!0;case 5:return p.fn.call(p.context,h,u,c,g),!0;case 6:return p.fn.call(p.context,h,u,c,g,m),!0}for(x=1,y=new Array(_-1);x<_;x++)y[x-1]=arguments[x];p.fn.apply(p.context,y)}else{var b=p.length,v;for(x=0;x<b;x++)switch(p[x].once&&this.removeListener(d,p[x].fn,void 0,!0),_){case 1:p[x].fn.call(p[x].context);break;case 2:p[x].fn.call(p[x].context,h);break;case 3:p[x].fn.call(p[x].context,h,u);break;case 4:p[x].fn.call(p[x].context,h,u,c);break;default:if(!y)for(v=1,y=new Array(_-1);v<_;v++)y[v-1]=arguments[v];p[x].fn.apply(p[x].context,y)}}return!0},a.prototype.on=function(d,h,u){return r(this,d,h,u,!1)},a.prototype.once=function(d,h,u){return r(this,d,h,u,!0)},a.prototype.removeListener=function(d,h,u,c){var g=s?s+d:d;if(!this._events[g])return this;if(!h)return o(this,g),this;var m=this._events[g];if(m.fn)m.fn===h&&(!c||m.once)&&(!u||m.context===u)&&o(this,g);else{for(var f=0,p=[],_=m.length;f<_;f++)(m[f].fn!==h||c&&!m[f].once||u&&m[f].context!==u)&&p.push(m[f]);p.length?this._events[g]=p.length===1?p[0]:p:o(this,g)}return this},a.prototype.removeAllListeners=function(d){var h;return d?(h=s?s+d:d,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,t.exports=a})(WA);var ZB=WA.exports;const KB=bg(ZB),vg="dragend",QB="select",JB="history",tU=10,eU=3,Ag={SHAPES:1,EDITOR:2,HANDLES:3},dr="start",Ml="end";let la=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");const Us=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),gr=t=>Math.sqrt(t.x*t.x+t.y*t.y),ZA=t=>({x:-t.x,y:-t.y}),lc=t=>{const e=gr(t);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}},Tr=(t,e)=>({x:t.x+e.x,y:t.y+e.y}),xn=(t,e)=>({x:t.x*e,y:t.y*e}),G_=(t,e)=>({x:t.x*e.x,y:t.y*e.y}),V_=(t,e)=>{const s=Math.sin(e),i=Math.cos(e);return{x:t.x*i-t.y*s,y:t.x*s+t.y*i}},cn=(t,e)=>t.x*e.x+t.y*e.y,sU=(t,e)=>t.x*e.y-t.y*e.x,da=t=>t.properties.type==="arrow";function KA(t,e,s){const{start:i,end:n}=wg(t),r=Us(e,i),o=t.properties.style.strokeWidth,a=Us(n,i),l=gr(a),d=cn(r,lc(a));return d>0&&d<l&&Math.abs(sU(r,lc(a)))<o/2+s}const md={strokeType:"plain",strokeColor:"#202020",strokeWidth:1,head:"none",tail:"none"};({...md});const QA=(t=0,e=0,s=0,i=0,n={...md})=>({id:la(),type:"Feature",properties:{type:"arrow",style:{...md,...n}},geometry:{type:"LineString",coordinates:[[t,e],[s,i]]}}),qd=t=>t.properties.type==="box";function q_(t,e,s=0,i=1,n=0){const r=As(t),{width:o,height:a}=Gs(t),l=e.x-r.x,d=e.y-r.y,h=l*i-d*s,u=l*s+d*i;return h>-n&&h<o+n&&u>-n&&u<a+n}const fd={background:"#f5f5f5",strokeWidth:0,borderRadius:8,padding:16,strokeType:"plain"};({...fd});const JA=(t=0,e=0,s=100,i=50,n={...fd})=>({id:la(),type:"Feature",properties:{type:"box",style:{...fd,...n}},geometry:{type:"Polygon",coordinates:[[[t,e],[t+s,e],[t+s,e+i],[t,e+i],[t,e]]]}}),wn=t=>t.properties.type==="text",Es={font:"sans-serif",fontSize:18,color:"#505050",background:"#f5f5f5",strokeWidth:0,borderRadius:8,padding:16,strokeType:"plain"};la(),{...Es};const Eg=(t=0,e=0,s=100,i=50,n="",r={...Es})=>({id:la(),type:"Feature",properties:{type:"text",content:n,style:{...Es,...r}},geometry:{type:"Polygon",coordinates:[[[t,e],[t+s,e],[t+s,e+i],[t,e+i],[t,e]]]}}),j_=t=>t.type==="FeatureCollection",iU="http://www.w3.org/2000/svg";function ks(t){return document.createElementNS(iU,t)}function Os(t){return t.geometry.bbox||Sg(t),t.geometry.bbox}function Gs(t){const e=Os(t);return{width:e[2]-e[0],height:e[3]-e[1]}}function As(t){const e=Os(t);return{x:e[0],y:e[1]}}function Y_(t){const e=Os(t);return{x:(e[0]+e[2])/2,y:(e[1]+e[3])/2}}function Sg(t){if(da(t)){const[e,s]=t.geometry.coordinates[0],[i,n]=t.geometry.coordinates[1];t.geometry.bbox=[Math.min(e,i),Math.min(s,n),Math.max(e,i),Math.max(s,n)]}else{let e=1/0,s=1/0,i=-1/0,n=-1/0;for(const r of t.geometry.coordinates[0]){const[o,a]=r;e=Math.min(e,o),s=Math.min(s,a),i=Math.max(i,o),n=Math.max(n,a)}t.geometry.bbox=[e,s,i,n]}}function tE(t){const[e,s]=t.geometry.coordinates[0];return{x:e,y:s}}function Ph(t,e){const[s,i]=t.geometry.coordinates[e===dr?0:1];return{x:s,y:i}}function eE(t){const[e,s]=t.geometry.coordinates[1];return{x:e,y:s}}function wg(t){return{start:tE(t),end:eE(t)}}function sE(t){return Rl(t).reduce((e,s)=>(e[0]=Math.min(s[0],e[0]),e[1]=Math.min(s[1],e[1]),e[2]=Math.max(s[0],e[2]),e[3]=Math.max(s[1],e[3]),e),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY])}function Rl(t){let e=[];return t.type=="Point"?e=[t.coordinates]:t.type=="LineString"||t.type=="MultiPoint"?e=t.coordinates:t.type=="Polygon"||t.type=="MultiLineString"?e=t.coordinates.reduce(function(s,i){return s.concat(i)},[]):t.type=="MultiPolygon"?e=t.coordinates.reduce((s,i)=>s.concat(i.reduce((n,r)=>n.concat(r),[])),[]):t.type=="Feature"?e=Rl(t.geometry):t.type=="GeometryCollection"?e=t.geometries.reduce((s,i)=>s.concat(Rl(i)),[]):t.type=="FeatureCollection"&&(e=t.features.reduce((s,i)=>s.concat(Rl(i)),[])),e}function dc(t,e){if(!e)return{x:t.clientX,y:t.clientY};const s=e.getBoundingClientRect();return{x:t.clientX-s.left-e.clientLeft,y:t.clientY-s.top-e.clientTop}}function H_(){return typeof window<"u"?window:void 0}class iE extends EventTarget{annotation=null;ogma;dragging=!1;dragStartPoint;hoveredHandle;ogmaPanningOption=!1;store;draggingWasEnabled=!0;constructor(e,s){super(),this.store=s,this.ogma=e,this.store.subscribe(i=>i.features,i=>{this.isActive()&&!i[this.annotation]&&this.stopEditing()})}handleMouseMove=e=>{this.isActive()&&(this.dragging?this.dragStartPoint&&this.onDrag(e):this.detectHandle(e,this.ogma.view.getZoom()))};handleMouseDown=e=>{!this.isActive()||this.dragging||!this.hoveredHandle||(e.preventDefault(),e.stopPropagation(),this.dragging=!0,this.dragStartPoint=this.clientToCanvas(e),this.onDragStart(e),this.dispatchEvent(new Event("dragstart")),this.ogmaPanningOption=!!this.ogma.getOptions().interactions?.pan?.enabled,this.ogma.setOptions({interactions:{pan:{enabled:!1}}}))};handleMouseUp=e=>{!this.isActive()||!this.dragging||(this.dragging=!1,this.ogma.setOptions({interactions:{pan:{enabled:this.ogmaPanningOption}}}),this.onDragEnd(e),this.dispatchEvent(new Event("dragend")))};cancelEdit(){!this.isActive()||this.annotation===null||this.clearDragState()}clearDragState(){this.dragging=!1,this.dragStartPoint=void 0,this.hoveredHandle=void 0,this.ogma.setOptions({interactions:{pan:{enabled:this.ogmaPanningOption}}})}commitChange(){this.store.getState().commitLiveUpdates()}onDragStart(e){return this.isActive()?(this.draggingWasEnabled=this.ogma.getOptions().interactions?.drag?.enabled??!0,this.ogma.setOptions({interactions:{drag:{enabled:!1}}}),!0):!1}onDragEnd(e){return this.isActive()?(this.ogma.setOptions({interactions:{drag:{enabled:this.draggingWasEnabled}}}),!0):!1}clientToCanvas(e){const s=this.ogma,i=dc(e,s.getContainer());return s.view.screenToGraphCoordinates(i)}setAnnotation(e){if(this.annotation=e?e.id:null,this.annotation!==null){const s=this.ogma.getContainer(),i=H_()||s;i.addEventListener("mousemove",this.handleMouseMove),i.addEventListener("mouseup",this.handleMouseUp,!0),s.addEventListener("mousedown",this.handleMouseDown,!0);const{x:n,y:r}=this.ogma.getPointerInformation();this.handleMouseMove({clientX:n,clientY:r})}}getAnnotation(){return this.store.getState().getFeature(this.annotation)}setCursor(e){const s=this.ogma.getContainer()?.firstChild;s&&(s.style.cursor=e)}stopEditing(){if(!this.isActive())return;const e=this.ogma.getContainer(),s=H_()||e;s.removeEventListener("mousemove",this.handleMouseMove),s.removeEventListener("mouseup",this.handleMouseUp),e.removeEventListener("mousedown",this.handleMouseDown),this.setAnnotation(null),this.clearDragState(),this.annotation=null}isActive(){return this.annotation!==null}}var mo=(t=>(t[t.START=dr]="START",t[t.END=Ml]="END",t.BODY="body",t))(mo||{});class nU extends iE{snapping;links;snap=null;constructor(e,s,i,n){super(e,s),this.snapping=i,this.links=n}detectHandle(e){const s=this.getAnnotation(),i=this.clientToCanvas(e),n=tU,r=s.geometry.coordinates[0],o=s.geometry.coordinates[1],a=Math.sqrt(Math.pow(i.x-r[0],2)+Math.pow(i.y-r[1],2)),l=Math.sqrt(Math.pow(i.x-o[0],2)+Math.pow(i.y-o[1],2));a<n?(this.hoveredHandle={type:mo.START,point:{x:r[0],y:r[1]}},this.store.setState({hoveredHandle:0})):l<n?(this.hoveredHandle={type:mo.END,point:{x:o[0],y:o[1]}},this.store.setState({hoveredHandle:1}),this.setCursor("move")):KA(s,i,n)?(this.setCursor("grab"),this.hoveredHandle={type:"body",point:i},this.store.setState({hoveredHandle:2})):(this.store.setState({hoveredHandle:-1}),this.hoveredHandle=void 0)}onDrag(e){if(!(this.dragStartPoint||!this.hoveredHandle)||!this.isActive())return;e.stopPropagation(),e.stopImmediatePropagation();const s=this.clientToCanvas(e),i=this.hoveredHandle,n=this.getAnnotation();this.snap=this.snapping.snap(n,s);const r=this.snap?.point||s,o=n.properties.link||{},a=[...n.geometry.coordinates];if(i.type===mo.START)a[0]=[r.x,r.y],this.snap&&(o.start={side:i.type,id:this.snap.id,type:this.snap.type,magnet:this.snap.magnet});else if(i.type===mo.END)a[1]=[r.x,r.y],this.snap&&(o.end={side:i.type,id:this.snap.id,type:this.snap.type,magnet:this.snap.magnet});else if(i.type==="body"){const l=r.x-i.point.x,d=r.y-i.point.y,h=n.geometry.coordinates[0],u=n.geometry.coordinates[1];a[0]=[h[0]+l,h[1]+d],a[1]=[u[0]+l,u[1]+d]}this.store.getState().applyLiveUpdate(n.id,{id:n.id,properties:{...n.properties,link:o},geometry:{type:n.geometry.type,coordinates:a}}),this.dispatchEvent(new CustomEvent("dragging",{detail:{point:r,annotation:this.annotation,handle:i}}))}onDragStart(e){return super.onDragStart(e)?(this.store.getState().startLiveUpdate([this.annotation]),!0):!1}onDragEnd(e){if(!super.onDragEnd(e))return!1;if(this.snap&&this.hoveredHandle){const s=this.hoveredHandle;s.type!=="body"&&this.links.add(this.getAnnotation(),s.type,this.snap.id,this.snap.type,this.snap.magnet)}else if(this.snap===null&&this.hoveredHandle){const s=this.getAnnotation(),i=this.hoveredHandle.type;s.properties.link&&s.properties.link[i]&&(this.links.remove(s,i),this.store.getState().applyLiveUpdate(s.id,{properties:{...s.properties,link:{[i]:void 0}}}))}return this.commitChange(),this.clearDragState(),this.snap=null,!0}}const X_=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:0,y:.5},{x:1,y:.5},{x:0,y:1},{x:.5,y:1},{x:1,y:1}],hl={x:1,y:0},ul={x:0,y:1};class rU extends EventTarget{ogma;options;spatialIndex;hoveredNode=null;constructor(e,s,i){super(),this.ogma=e,this.options=s,this.spatialIndex=i}snap(e,s){if(!da(e))return null;const i=this._findMagnet(s);return i||null}_findMagnet(e){const s={minX:e.x-this.options.detectMargin,minY:e.y-this.options.detectMargin,maxX:e.x+this.options.detectMargin,maxY:e.y+this.options.detectMargin},i=this.spatialIndex.search(s).filter(wn),n=this._snapToText(e,i);if(n)return n;const r=this.ogma.view.getElementsInside(s.minX,s.minY,s.maxX,s.maxY).nodes,o=this._snapToNodes(e,r);return o||null}_snapToText(e,s){for(const i of s){const n=Os(i),r={x:n[0],y:n[1]},o=n[2]-n[0],a=n[3]-n[1];for(const x of X_){const b=Tr(r,G_(x,{x:o,y:a}));if(!(gr(Us(b,e))>=this.options.magnetRadius))return{point:{x:b.x,y:b.y},type:"text",magnet:x,id:i.id}}const l=Gs(i),d=As(i),h=this.options.magnetRadius;let u,c={x:d.x,y:d.y},g={x:d.x+l.width,y:d.y},m=ul,f=cn(m,{x:e.x-c.x,y:e.y-c.y});if(Math.abs(f)<h&&e.x>=c.x-h&&e.x<=g.x+h&&e.y>=c.y-h&&e.y<=g.y+h?u={edge:"top",min:c,max:g,axis:hl,norm:m}:(c={x:d.x+l.width,y:d.y},g={x:d.x+l.width,y:d.y+l.height},m=hl,f=cn(m,{x:e.x-c.x,y:e.y-c.y}),Math.abs(f)<h&&e.x>=c.x-h&&e.x<=g.x+h&&e.y>=c.y-h&&e.y<=g.y+h?u={edge:"right",min:c,max:g,axis:ul,norm:m}:(c={x:d.x,y:d.y+l.height},g={x:d.x+l.width,y:d.y+l.height},m=ul,f=cn(m,{x:e.x-c.x,y:e.y-c.y}),Math.abs(f)<h&&e.x>=c.x-h&&e.x<=g.x+h&&e.y>=c.y-h&&e.y<=g.y+h?u={edge:"bottom",min:c,max:g,axis:hl,norm:m}:(c={x:d.x,y:d.y},g={x:d.x,y:d.y+l.height},m=hl,f=cn(m,{x:e.x-c.x,y:e.y-c.y}),Math.abs(f)<h&&e.x>=c.x-h&&e.x<=g.x+h&&e.y>=c.y-h&&e.y<=g.y+h&&(u={edge:"left",min:c,max:g,axis:ul,norm:m})))),!u)continue;const p=cn(u.axis,{x:e.x-u.min.x,y:e.y-u.min.y});if(p<0||p>gr(Us(u.max,u.min)))continue;const _={x:u.min.x+u.axis.x*p,y:u.min.y+u.axis.y*p},y=G_(Us(_,d),{x:1/l.width,y:1/l.height});return{point:_,magnet:y,type:"text",id:i.id}}return null}_snapToNodes(e,s){const i=s.getAttributes(["x","y","radius"]);for(let n=0;n<i.length;n++){const r=i[n],o=Us({x:r.x,y:r.y},e),a=gr(o);if(a>=Number(r.radius)+Number(this.options.detectMargin))continue;const l=xn(o,1/a),d=a<Number(r.radius)/2,h=d?{x:r.x,y:r.y}:Tr({x:r.x,y:r.y},xn(l,-Number(r.radius))),u=d?{x:0,y:0}:l;return{point:h,id:s.get(n).getId(),magnet:u,type:"node"}}return null}getHoveredNode(){return this.hoveredNode}clearHoveredNode(){this.hoveredNode?.setSelected(!1),this.hoveredNode=null}getMagnets(){return X_}}class oU{constructor(e,s,i){this.ogma=e,this.store=s,this.annotation=i;const n=this.getPosition(),r=this.getSize();this.layer=this.ogma.layers.addOverlay({element:`<div class="ogma-annotation-text-editor">
          <textarea wrap="on" spellcheck="false"></textarea>
        </div>`,position:n,size:r},Ag.EDITOR),this.textarea=this.layer.element.querySelector("textarea"),this.textarea.setAttribute("wrap","on"),this.textarea.setAttribute("spellcheck","false"),this.textarea.value=this.getAnnotation().properties.content||"",this.isFocused=!1,this.textarea.addEventListener("focus",this.onFocus),this.textarea.addEventListener("blur",this.onBlur),this.textarea.addEventListener("input",this.onInput),this.updateStyle(),this.updatePosition(),this.unsubscribe=this.store.subscribe(o=>({rotation:o.rotation,zoom:o.zoom}),()=>this.update(),{equalityFn:(o,a)=>o.rotation===a.rotation&&o.zoom===a.zoom})}layer;textarea;isFocused;unsubscribe;getAnnotation(){const e=this.store.getState();return e.liveUpdates[this.annotation]||e.startLiveUpdate([this.annotation]),e.liveUpdates[this.annotation]}getPosition(){const e=this.getAnnotation(),s=As(e),i=$_(e);return{x:s.x+i,y:s.y+i}}getSize(){const e=this.getAnnotation(),s=Gs(e),i=$_(e);return{width:s.width-i*2,height:s.height-i*2}}updateStyle(){const e=this.getAnnotation();if(!e)return;const{font:s,fontSize:i=Es.fontSize,color:n,background:r,padding:o=0}=e.properties.style||Es,a=this.textarea,l=parseFloat(i.toString()),d=a.style;d.font=`${l} ${s}`,d.fontFamily=s||"sans-serif",d.fontSize=`${l}px`,d.padding=`${o}px`,d.lineHeight=`${l}px`,d.boxSizing="border-box",d.color=n||"black",d.background=r||"transparent",d.transformOrigin="top left",d.transform=`rotate(${this.store.getState().rotation}rad)`}updatePosition(){this.layer.setPosition(this.getPosition())}onFocus=()=>{this.isFocused=!0};onBlur=()=>{this.updateContent(),this.isFocused=!1};updateContent(){const e=this.getAnnotation(),s={...e,properties:{...e.properties,content:this.textarea.value}};this.store.getState().applyLiveUpdate(this.annotation,s)}onInput=()=>{this.updateContent(),this.updateStyle()};update(){this.updateStyle(),this.updatePosition(),this.layer.setSize(this.getSize())}destroy(){this.store.getState().commitLiveUpdates(new Set([this.annotation])),this.unsubscribe(),this.layer.destroy()}}function $_(t){return t.properties.style?.strokeWidth||0}const W_={x:1,y:0},Z_={x:0,y:1},aU=[["top",Z_,0,0,1,0],["right",W_,1,0,1,1],["bottom",Z_,0,1,1,1],["left",W_,0,0,0,1]],lU={top:[0,1],right:[1,2],bottom:[2,3],left:[3,0]},K_=[[0,0],[1,0],[1,1],[0,1]],dU=["nw-resize","ne-resize","se-resize","sw-resize"];class Q_ extends iE{links;textEditor=null;constructor(e,s,i){super(e,s),this.links=i}detectHandle(e,s){const i=this.getAnnotation(),{x:n,y:r}=this.clientToCanvas(e),{width:o,height:a}=Gs(i),l=3/s,d=As(i),h=this.store.getState();let{revSin:u,revCos:c}=h;qd(i)&&(u=0,c=1),this.hoveredHandle=void 0;const g=eU*(1/s),m=n-d.x,f=r-d.y,p=m*c-f*u,_=m*u+f*c;for(let y=0;y<K_.length;y++){const[x,b]=K_[y],v=o*x,A=a*b;if(p>=v-g-l&&p<=v+g+l&&_>=A-g-l&&_<=A+g+l){this.hoveredHandle={type:"corner",corner:y},this.store.setState({hoveredHandle:y}),this.setCursor(this.getCornerCursor(y));return}}for(const[y,x,b,v,A,E]of aU){const S=o*b,w=a*v,T=o*A,L=a*E,R=cn(x,{x:p-S,y:_-w});if(Math.abs(R)<l&&p>=S-l&&p<=T+l&&_>=w-l&&_<=L+l){this.hoveredHandle={type:"edge",edge:y,corner:-1},this.store.setState({hoveredHandle:lU[y][0]+4}),this.setCursor(this.getEdgeCursor(y));return}}if(p>=l&&p<=o+l&&_>=l&&_<=a+l){this.store.setState({hoveredHandle:8}),this.hoveredHandle={type:"body",corner:-1},this.setCursor("grab");return}this.store.setState({hoveredHandle:-1}),this.setCursor("default")}onDrag(e){if(!this.dragStartPoint||!this.hoveredHandle||!this.isActive())return;e.stopPropagation(),e.stopImmediatePropagation();const s=this.getAnnotation(),i=this.clientToCanvas(e),n={x:i.x-this.dragStartPoint.x,y:i.y-this.dragStartPoint.y},r=this.hoveredHandle,o=this.getAnnotation();let a=null;if(r.type==="corner"?a=this.calculateCornerDrag(o,n,r.corner):r.type==="edge"&&r.edge?a=this.calculateEdgeDrag(o,n,r):r.type==="body"&&(a=this.calculateBodyDrag(o,n)),a){const l={id:s.id,properties:s.properties,geometry:a};this.store.getState().applyLiveUpdate(s.id,l);const d=Us(As(l),As(o));this.links.updateLinkedArrowsDuringDrag(s.id,d),this.textEditor&&this.textEditor.update()}this.dispatchEvent(new CustomEvent("dragging",{detail:{point:i,annotation:this.annotation,handle:r}}))}calculateBodyDrag(e,s){const{x:i,y:n}=As(e),{width:r,height:o}=Gs(e);return{type:e.geometry.type,coordinates:[[[i+s.x,n+s.y],[i+s.x+r,n+s.y],[i+s.x+r,n+s.y+o],[i+s.x,n+s.y+o],[i+s.x,n+s.y]]]}}calculateCornerDrag(e,s,i){const n=i===0||i===1,r=i===0||i===3,o=i===1||i===2,a=i===2||i===3;let{x:l,y:d}=As(e),{width:h,height:u}=Gs(e);return r&&n?(l+=s.x,d+=s.y,h-=s.x,u-=s.y):o&&a?(h+=s.x,u+=s.y):r&&a?(l+=s.x,h-=s.x,u+=s.y):o&&n&&(d+=s.y,h+=s.x,u-=s.y),{type:e.geometry.type,coordinates:[[[l,d],[l+h,d],[l+h,d+u],[l,d+u],[l,d]]]}}calculateEdgeDrag(e,s,i){let{x:n,y:r}=As(e),{width:o,height:a}=Gs(e);switch(i.edge){case"top":r+=s.y,a=Math.max(0,a-s.y);break;case"bottom":a=Math.max(0,a+s.y);break;case"left":n+=s.x,o=Math.max(0,o-s.x);break;case"right":o=Math.max(0,o+s.x);break}return{type:e.geometry.type,coordinates:[[[n,r],[n+o,r],[n+o,r+a],[n,r+a],[n,r]]]}}onDragStart(e){return super.onDragEnd(e)?(this.store.getState().startLiveUpdate([this.annotation]),!0):!1}onClick(e){this.textEditor===null&&(this.textEditor=new oU(this.ogma,this.store,this.annotation))}onDragEnd(e){if(!super.onDragEnd(e))return!1;const s=this.clientToCanvas(e),i=s.x-(this.dragStartPoint?.x||0),n=s.y-(this.dragStartPoint?.y||0);return Math.abs(i)<1&&Math.abs(n)<1?(this.clearDragState(),this.onClick(e)):this.commitChange(),this.hoveredHandle=void 0,this.dragStartPoint=void 0,this.dragging=!1,!0}getCornerCursor(e){return dU[e]}getEdgeCursor(e){switch(e){case"top":case"bottom":return"ns-resize";case"left":case"right":return"ew-resize";default:return"default"}}stopEditing(){super.stopEditing(),this.textEditor&&this.textEditor.destroy(),this.commitChange(),this.textEditor=null}}class hU extends EventTarget{handlers=new Map;activeHandler;currentTool="select";interaction;ogma;snapping;store;constructor(e,s,i,n,r){super(),this.ogma=e,this.store=s,this.interaction=r,this.snapping=new rU(e,{detectMargin:10,magnetRadius:10},i),this.handlers.set("box",new Q_(this.ogma,this.store,n)),this.handlers.set("text",new Q_(this.ogma,this.store,n)),this.handlers.set("arrow",new nU(this.ogma,this.store,this.snapping,n)),this.handlers.forEach(o=>{o.addEventListener("dragstart",()=>{this.dispatchEvent(new Event("dragstart")),this.store.setState({isDragging:!0}),this.interaction.setMode("edit")}),o.addEventListener("dragend",()=>{this.dispatchEvent(new Event("dragend")),this.store.setState({isDragging:!1}),this.interaction.suppressClicksTemporarily()})}),this.store.subscribe(o=>o.selectedFeatures,(o,a)=>{const l=Array.from(o.keys()).filter(h=>!a.has(h)),d=Array.from(a.keys()).filter(h=>!o.has(h));!l.length&&!d.length||(d.forEach(h=>this.stopEditingFeature(h)),l.forEach(h=>this.editFeature(h)))})}stopEditingFeature(e){const s=this.store.getState().features[e];if(!s)return;const i=s.properties.type,n=this.handlers.get(i);n&&n.stopEditing()}editFeature(e){const s=this.store.getState().features[e];if(!s)return;const i=s.properties.type,n=this.handlers.get(i);n&&(this.activeHandler=n,n.setAnnotation(s))}getCurrentTool(){return this.currentTool}getActiveHandler(){return this.activeHandler}destroy(){}}class uU{constructor(e,s,i,n,r=.5){this.ogma=e,this.store=s,this.index=i,this.links=n,this.threshold=r,this.ogma.getContainer()?.addEventListener("mousemove",this.onMouseMove,{passive:!0,capture:!0}),this.ogma.getContainer()?.addEventListener("click",this.onMouseClick,{passive:!0,capture:!0}),this.ogma.events.on("rotate",()=>this.links.update())}query={minX:1/0,minY:1/0,maxX:1/0,maxY:1/0};suppressClickUntil=0;detect(e,s){let i=null;const n=this.store.getState(),r=this.threshold;this.query.minX=e-r,this.query.minY=s-r,this.query.maxX=e+r,this.query.maxY=s+r;const o=this.index.query(this.query);if(o.length===0)return null;for(const a of o){const l=n.getFeature(a.id);if(da(l)){if(KA(l,{x:e,y:s},r)){i=l;break}}else if(qd(l)){if(q_(l,{x:e,y:s},0,1,r)){i=l;break}}else if(wn(l)&&q_(l,{x:e,y:s},n.revSin,n.revCos,r)){i=l;break}}return i}onMouseMove=e=>{const s=dc(e,this.ogma.getContainer()),i=this.store.getState();if(i.isDragging)return;const{x:n,y:r}=this.ogma.view.screenToGraphCoordinates(s),a=this.detect(n,r)?.id??null,l=i.hoveredFeature;a!==l&&i.setHoveredFeature(a),this.setCursor(a===null?"default":"pointer")};onMouseClick=e=>{if(Date.now()<this.suppressClickUntil)return;const s=dc(e,this.ogma.getContainer()),{x:i,y:n}=this.ogma.view.screenToGraphCoordinates(s),r=this.detect(i,n),o=this.store.getState();r?e.ctrlKey||e.metaKey?o.toggleSelection(r.id):o.setSelectedFeatures([r.id]):!e.ctrlKey&&!e.metaKey&&o.clearSelection()};setCursor(e){const s=this.ogma.getContainer()?.firstChild;s&&(s.style.cursor=e)}setMode(e){e==="default"?this.setCursor(this.ogma.getOptions().cursor?.default||"default"):e==="add"||e==="link"?this.setCursor("crosshair"):e==="rotate"&&this.setCursor("alias")}suppressClicksTemporarily(e=100){this.suppressClickUntil=Date.now()+e}destroy(){const e=this.ogma.getContainer();e&&(e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("click",this.onMouseClick))}}function nE(t,e,s=0,i=t.length-1,n=cU){for(;i>s;){if(i-s>600){const l=i-s+1,d=e-s+1,h=Math.log(l),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(l-u)/l)*(d-l/2<0?-1:1),g=Math.max(s,Math.floor(e-d*u/l+c)),m=Math.min(i,Math.floor(e+(l-d)*u/l+c));nE(t,e,g,m,n)}const r=t[e];let o=s,a=i;for(Xr(t,s,e),n(t[i],r)>0&&Xr(t,s,i);o<a;){for(Xr(t,o,a),o++,a--;n(t[o],r)<0;)o++;for(;n(t[a],r)>0;)a--}n(t[s],r)===0?Xr(t,s,a):(a++,Xr(t,a,i)),a<=e&&(s=a+1),e<=a&&(i=a-1)}}function Xr(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function cU(t,e){return t<e?-1:t>e?1:0}class gU{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let s=this.data;const i=[];if(!gl(e,s))return i;const n=this.toBBox,r=[];for(;s;){for(let o=0;o<s.children.length;o++){const a=s.children[o],l=s.leaf?n(a):a;gl(e,l)&&(s.leaf?i.push(a):Dh(e,l)?this._all(a,i):r.push(a))}s=r.pop()}return i}collides(e){let s=this.data;if(!gl(e,s))return!1;const i=[];for(;s;){for(let n=0;n<s.children.length;n++){const r=s.children[n],o=s.leaf?this.toBBox(r):r;if(gl(e,o)){if(s.leaf||Dh(e,o))return!0;i.push(r)}}s=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let s=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=s;else if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){const i=this.data;this.data=s,s=i}this._insert(s,this.data.height-s.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Wn([]),this}remove(e,s){if(!e)return this;let i=this.data;const n=this.toBBox(e),r=[],o=[];let a,l,d;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),d=!0),i.leaf){const h=mU(e,i.children,s);if(h!==-1)return i.children.splice(h,1),r.push(i),this._condense(r),this}!d&&!i.leaf&&Dh(i,n)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],d=!1):i=null}return this}toBBox(e){return e}compareMinX(e,s){return e.minX-s.minX}compareMinY(e,s){return e.minY-s.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,s){const i=[];for(;e;)e.leaf?s.push(...e.children):i.push(...e.children),e=i.pop();return s}_build(e,s,i,n){const r=i-s+1;let o=this._maxEntries,a;if(r<=o)return a=Wn(e.slice(s,i+1)),qn(a,this.toBBox),a;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),a=Wn([]),a.leaf=!1,a.height=n;const l=Math.ceil(r/o),d=l*Math.ceil(Math.sqrt(o));J_(e,s,i,d,this.compareMinX);for(let h=s;h<=i;h+=d){const u=Math.min(h+d-1,i);J_(e,h,u,l,this.compareMinY);for(let c=h;c<=u;c+=l){const g=Math.min(c+l-1,u);a.children.push(this._build(e,c,g,n-1))}}return qn(a,this.toBBox),a}_chooseSubtree(e,s,i,n){for(;n.push(s),!(s.leaf||n.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<s.children.length;l++){const d=s.children[l],h=zh(d),u=_U(e,d)-h;u<o?(o=u,r=h<r?h:r,a=d):u===o&&h<r&&(r=h,a=d)}s=a||s.children[0]}return s}_insert(e,s,i){const n=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(n,this.data,s,r);for(o.children.push(e),po(o,n);s>=0&&r[s].children.length>this._maxEntries;)this._split(r,s),s--;this._adjustParentBBoxes(n,r,s)}_split(e,s){const i=e[s],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),a=Wn(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,qn(i,this.toBBox),qn(a,this.toBBox),s?e[s-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,s){this.data=Wn([e,s]),this.data.height=e.height+1,this.data.leaf=!1,qn(this.data,this.toBBox)}_chooseSplitIndex(e,s,i){let n,r=1/0,o=1/0;for(let a=s;a<=i-s;a++){const l=fo(e,0,a,this.toBBox),d=fo(e,a,i,this.toBBox),h=yU(l,d),u=zh(l)+zh(d);h<r?(r=h,n=a,o=u<o?u:o):h===r&&u<o&&(o=u,n=a)}return n||i-s}_chooseSplitAxis(e,s,i){const n=e.leaf?this.compareMinX:fU,r=e.leaf?this.compareMinY:pU,o=this._allDistMargin(e,s,i,n),a=this._allDistMargin(e,s,i,r);o<a&&e.children.sort(n)}_allDistMargin(e,s,i,n){e.children.sort(n);const r=this.toBBox,o=fo(e,0,s,r),a=fo(e,i-s,i,r);let l=cl(o)+cl(a);for(let d=s;d<i-s;d++){const h=e.children[d];po(o,e.leaf?r(h):h),l+=cl(o)}for(let d=i-s-1;d>=s;d--){const h=e.children[d];po(a,e.leaf?r(h):h),l+=cl(a)}return l}_adjustParentBBoxes(e,s,i){for(let n=i;n>=0;n--)po(s[n],e)}_condense(e){for(let s=e.length-1,i;s>=0;s--)e[s].children.length===0?s>0?(i=e[s-1].children,i.splice(i.indexOf(e[s]),1)):this.clear():qn(e[s],this.toBBox)}}function mU(t,e,s){if(!s)return e.indexOf(t);for(let i=0;i<e.length;i++)if(s(t,e[i]))return i;return-1}function qn(t,e){fo(t,0,t.children.length,e,t)}function fo(t,e,s,i,n){n||(n=Wn(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<s;r++){const o=t.children[r];po(n,t.leaf?i(o):o)}return n}function po(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function fU(t,e){return t.minX-e.minX}function pU(t,e){return t.minY-e.minY}function zh(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function cl(t){return t.maxX-t.minX+(t.maxY-t.minY)}function _U(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function yU(t,e){const s=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),n=Math.min(t.maxX,e.maxX),r=Math.min(t.maxY,e.maxY);return Math.max(0,n-s)*Math.max(0,r-i)}function Dh(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function gl(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Wn(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function J_(t,e,s,i,n){const r=[e,s];for(;r.length;){if(s=r.pop(),e=r.pop(),s-e<=i)continue;const o=e+Math.ceil((s-e)/i/2)*i;nE(t,o,e,s,n),r.push(e,o,o,s)}}const $r={minX:0,minY:0,maxX:0,maxY:0};class xU extends gU{store;constructor(e){super(),this.store=e,this.store.subscribe(s=>s.features,s=>{this.clear(),Object.values(s).forEach(i=>{wn(i)?this.updateRotatedText(i):this.insert(i)})}),this.store.subscribe(s=>({features:s.features,isDragging:s.isDragging,lastChangedFeatures:s.lastChangedFeatures,rotation:s.rotation}),(s,i)=>{i&&i.isDragging&&!s.isDragging&&s.lastChangedFeatures.length>0&&s.lastChangedFeatures.forEach(n=>{const r=s.features[n];r&&(Sg(r),wn(r)?this.updateRotatedText(r):(this.remove(r),this.insert(r)))})},{equalityFn:(s,i)=>s.isDragging===i.isDragging}),this.store.subscribe(s=>s.rotation,this.onRotationChange)}onRotationChange=()=>{const e=this.store.getState().getAllFeatures().filter(s=>wn(s));for(const s of e)this.updateRotatedText(s)};updateRotatedText(e){const s=this.store.getState();this.remove(e);const[i,n,r,o]=Os(e),a=s.getRotatedBBox(i,n,r,o);this.insert({...e,geometry:{...e.geometry,bbox:a.slice()}})}compareMinX(e,s){return Os(e)[0]-Os(s)[0]}compareMinY(e,s){return Os(e)[1]-Os(s)[1]}toBBox(e){const s=Os(e);return $r.minX=s[0],$r.minY=s[1],$r.maxX=s[2],$r.maxY=s[3],$r}query(e){return super.search(e)}}function bU(t,e,s){const i=Math.cos(e),n=Math.sin(e),r={x:t.x,y:t.y},o={x:t.x+t.width*i-t.height*n,y:t.y+t.width*n+t.height*i},a={x:o.x+t.height*n,y:o.y-t.height*i},l={x:r.x-t.height*n,y:r.y+t.height*i},d={x:(r.x+o.x)/2,y:(r.y+o.y)/2};let h=null;return h=lr.segmentIntersection(s.x,s.y,d.x,d.y,r.x,r.y,a.x,a.y),h||(h=lr.segmentIntersection(s.x,s.y,d.x,d.y,a.x,a.y,o.x,o.y),h)||(h=lr.segmentIntersection(s.x,s.y,d.x,d.y,o.x,o.y,l.x,l.y),h)||(h=lr.segmentIntersection(s.x,s.y,d.x,d.y,l.x,l.y,r.x,r.y),h)?h:null}function vU(t,e,s,i,n,r,o,a,l){const d=t-o,h=e-a,u=o+d*r-h*n,c=a+d*n+h*r,g=o+(d+s)*r-h*n,m=a+(d+s)*n+h*r,f=o+(d+s)*r-(h+i)*n,p=a+(d+s)*n+(h+i)*r,_=o+d*r-(h+i)*n,y=a+d*n+(h+i)*r;return l[0]=Math.min(u,g,f,_),l[1]=Math.min(c,m,p,y),l[2]=Math.max(u,g,f,_),l[3]=Math.max(c,m,p,y),l}const AU=["x","y","radius"],EU=100;class SU{links=new Map;nodeToLink=new Map;annotationToLink=new Map;linksByArrowId=new Map;store;ogma;updatedItems=new Set;constructor(e,s){this.ogma=e,this.store=s,this.store.subscribe(i=>i.features,this.onAddArrow),this.ogma.events.on("setMultipleAttributes",this.onSetMultipleAttributes)}updateLinkedArrowsDuringDrag(e,s){const i=this.store.getState();if(!i.getFeature(e))return;const r=this.annotationToLink.get(e);if(r)for(const o of r){const a=this.links.get(o);if(!a)continue;const l=i.getFeature(a.arrow),d=Ph(l,a.side),h=Tr(d,s),u={...l.geometry,coordinates:l.geometry.coordinates.map((c,g)=>a.side===dr&&g===0||a.side===Ml&&g===1?[h.x,h.y]:[...c])};i.applyLiveUpdate(l.id,{geometry:u}),this.updatedItems.add(l.id)}}add(e,s,i,n,r){const o=la(),a=e.id,l={id:o,arrow:a,target:i,targetType:n,magnet:r,side:s};if(n==="node"&&!this.ogma.getNode(i))return;this.remove(e,s),this.links.set(o,l);const d=n==="node"?this.nodeToLink:this.annotationToLink;return d.has(i)||d.set(i,new Set),d.get(i).add(o),this.linksByArrowId.has(a)||this.linksByArrowId.set(a,{}),this.linksByArrowId.get(a)[s]=o,e.properties.link=e.properties.link||{},e.properties.link[s]={id:i,side:s,type:n,magnet:r},this}remove(e,s){const i=e.id,n=this.linksByArrowId.get(i)?.[s];if(delete e.properties.link?.[s],!n)return this;const r=this.links.get(n);return r?(this.links.delete(n),this.nodeToLink.get(r.target)?.delete(n),this.annotationToLink.get(r.target)?.delete(n),this.linksByArrowId.has(i)&&(this.linksByArrowId.get(i)[s]=void 0),this):this}onSetMultipleAttributes=({elements:e,updatedAttributes:s})=>{const i=new Set(s);!e.isNode||!i.has("x")&&!i.has("y")&&!i.has("radius")||this.requestUpdateFromNodePositions(e.toList())};requestUpdateFromNodePositions(e){setTimeout(()=>this.updateFromNodePositions(e),1)}updateFromNodePositions(e){const s=e.getId(),i=new Map;s.forEach(o=>{const a=this.nodeToLink.get(o);a&&a.forEach(l=>{const d=this.links.get(l);if(!d)return;const h=d.arrow;i.set(h,this.linksByArrowId.get(h))})});const n=e.getAttributes(AU),r=this.store.getState();for(let o=0;o<s.length;o++){const a=s[o],l=this.nodeToLink.get(a);if(l)for(const d of l){const h=this.links.get(d);if(!h)continue;const u=h.arrow,c=this.store.getState().getFeature(u),g=c.geometry.coordinates.slice(),m=Ph(c,Ml),f=Ph(c,dr),p=n[o],_=this._getNodeSnapPoint(p,xn(Us(f,m),-1),this._isLinkedToCenter(h));g[h.side===dr?0:1]=_,r.applyLiveUpdate(u,{...c,geometry:{coordinates:g}}),this.updatedItems.add(u),h.magnet={x:_[0]-p.x,y:_[1]-p.y},Sg(c)}}this.debouncedCommit()}debouncedCommit=(()=>{let e;return()=>{clearTimeout(e),e=setTimeout(()=>{this.store.getState().batchUpdate(()=>{this.store.getState().commitLiveUpdates(this.updatedItems)}),this.updatedItems.clear()},EU)}})();update(e=this.linksByArrowId){const s=this.store.getState(),i=Array.from(this.nodeToLink.keys()),n=new Map;i.forEach((l,d)=>n.set(l,d));const o=this.ogma.getNodes(i).getAttributes(["x","y","radius"]),a=this.ogma.view.getAngle();e.forEach((l,d)=>{const h=this.links.get(l.start),u=this.links.get(l.end),c=s.getFeature(d);let g=c.geometry.coordinates[0],m=c.geometry.coordinates[1];const f=h?h.targetType==="node"?o[n.get(h.target)]:Y_(s.getFeature(h.target)):{x:g[0],y:g[1]},p=u?u.targetType==="node"?o[n.get(u.target)]:Y_(s.getFeature(u.target)):{x:m[0],y:m[1]},_=Us(p,f);if(h)if(h.targetType==="node")g=this._getNodeSnapPoint(f,_,this._isLinkedToCenter(h));else{const y=s.getFeature(h.target);g=this._getBoxSnapPoint(y,p,a)}if(u)if(u.targetType==="node")m=this._getNodeSnapPoint(p,xn(_,-1),this._isLinkedToCenter(u));else{const y=s.getFeature(u.target);m=this._getBoxSnapPoint(y,f,a)}s.applyLiveUpdate(c.id,{geometry:{coordinates:[g,m]}}),this.updatedItems.add(c.id)}),this.debouncedCommit()}onAddArrow=(e,s)=>{const i=this.store.getState(),n=new Set(Object.keys(s));Object.keys(e).filter(o=>!n.has(o)).forEach(o=>{const a=i.getFeature(o);if(!a||a.properties.type!=="arrow")return;const l=a;l.properties.link?.start&&this.add(l,dr,l.properties.link.start.id,l.properties.link.start.type,l.properties.link.start.magnet),l.properties.link?.end&&this.add(l,Ml,l.properties.link.end.id,l.properties.link.end.type,l.properties.link.end.magnet)})};_isLinkedToCenter(e){return e.magnet.x===0&&e.magnet.y===0}_getBoxSnapPoint(e,s,i=0){const n=Os(e),r=bU({x:n[0],y:n[1],width:n[2]-n[0],height:n[3]-n[1]},i,s);return r?[r.x,r.y]:[n[0],n[1]]}_getNodeSnapPoint(e,s,i){if(i)return[e.x,e.y];const n=Math.sqrt(s.x*s.x+s.y*s.y),r=xn(s,1/n),o=n<Number(e.radius)/2?{x:e.x,y:e.y}:Tr({x:e.x,y:e.y},xn(r,-Number(e.radius)));return[o.x,o.y]}destroy(){this.ogma.events.off(this.onSetMultipleAttributes)}}class rE{constructor(e,s){this.ogma=e,this.store=s}layer;destroy(){}}const ty=[[0,0],[1,0],[1,1],[0,1]];class wU extends rE{handleFill="#fff";handleStroke="#0093ff";handleStrokeWidth=2;handleRadius=3;handleMagnifier=1.5;constructor(e,s){super(e,s),this.layer=e.layers.addCanvasLayer(this.render,void 0,Ag.HANDLES),this.store.subscribe(i=>({selectedFeatures:i.selectedFeatures,liveUpdates:i.liveUpdates}),this.refresh),e.events.on("zoom",this.refresh)}refresh=()=>{this.layer.refresh()};render=e=>{const s=this.store.getState(),i=1/this.ogma.view.getZoom(),{hoveredHandle:n,rotation:r,liveUpdates:o,features:a}=s;e.beginPath();const l=this.handleRadius*i;e.fillStyle=this.handleFill,e.lineWidth=this.handleStrokeWidth*i,e.strokeStyle=this.handleStroke,Object.values(a).forEach(d=>{if(!s.isSelected(d.id))return;const h=o[d.id]?{...d,...o[d.id]}:d;da(h)?this.renderArrowHandles(h,e,l,n):wn(h)?this.renderBoxHandles(h,e,l,n,r):qd(h)&&this.renderBoxHandles(h,e,l,n,0)}),e.fill(),e.stroke()};renderArrowHandles(e,s,i,n){const r=tE(e),o=eE(e),a=+(n===0),l=+(n===1),d=i*(1+(this.handleMagnifier-1)*a),h=i*(1+(this.handleMagnifier-1)*l);s.moveTo(r.x+d,r.y),s.arc(r.x,r.y,d,0,2*Math.PI),s.moveTo(o.x+h,o.y),s.arc(o.x,o.y,h,0,2*Math.PI)}renderBoxHandles(e,s,i,n,r){const{width:o,height:a}=Gs(e),l=As(e);s.save(),s.translate(l.x,l.y),s.rotate(r);for(let d=0;d<ty.length;d++){const[h,u]=ty[d],c=o*h,g=a*u,m=n===d?i*this.handleMagnifier:i;s.moveTo(c+m,g),s.arc(c,g,m,0,2*Math.PI)}s.restore()}destroy(){this.layer.destroy(),super.destroy()}}const TU=.5;function IU(t,e=5,s=30){const{start:i,end:n}=wg(t),r=Us(n,i),o=t.properties.style&&t.properties.style.strokeWidth?t.properties.style?.strokeWidth:0;return Math.min(s,Math.max(3*o,gr(r)*.01,e))}function ey(t,e,s,i){const n=xn(ZA(lc(e)),i);if(!s||s!=="arrow"&&s!=="arrow-plain")return"";const r=Tr(t,V_(n,Math.PI/10)),o=Tr(t,V_(n,-Math.PI/10)),a=`${t.x} ${t.y}`;return`M ${r.x} ${r.y} L ${a} ${o.x} ${o.y} ${s==="arrow"?"":`${r.x} ${r.y}`}`}function LU(t,e){if(!t){t=ks("g");const s=ks("path");t.classList.add("annotation-arrow"),t.setAttribute("data-annotation",`${e}`),t.setAttribute("data-annotation-type","arrow"),t.appendChild(s);const i=ks("g");i.classList.add("annotation-arrow-endpoints"),t.appendChild(i)}return t}function CU(t,e,s,i,n,r){const{start:o,end:a}=wg(e),{tail:l,head:d,strokeColor:h,strokeWidth:u=0}=e.properties.style||md,c=Us(a,o),g=IU(e,s,i),m=LU(n,e.id),f=m.firstChild,p=d==="arrow-plain"||l==="arrow",_=h||"none";f.setAttribute("stroke",_),f.setAttribute("stroke-width",`${u}`),f.setAttribute("fill",p?h||"":"none"),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round");const y=ey(o,ZA(c),l,g),x=ey(a,c,d,g),b=y+`M ${o.x} ${o.y} ${a.x} ${a.y}`+x;f.setAttribute("d",b);const v=m.children[1];return v.innerHTML="",sy(v,o,_,l,u),sy(v,a,_,d,u),m.setAttribute("transform",`rotate(${-r.rotation*(180/Math.PI)})`),t.appendChild(m),m}function sy(t,e,s,i,n){i==="halo-dot"&&iy(t,e,NU(s),TU,n*4),(i==="dot"||i==="halo-dot")&&iy(t,e,s,1,n*2)}function NU(t){return t==="none"?"none":t}function iy(t,e,s,i,n){const r=ks("circle");r.setAttribute("cx",`${e.x}`),r.setAttribute("cy",`${e.y}`),r.setAttribute("r",`${n}`),r.setAttribute("fill-opacity",`${i}`),r.setAttribute("fill",s),t.appendChild(r)}function MU(t,e,s="box"){if(!t){t=ks("g"),t.setAttribute("data-annotation",`${e}`),t.setAttribute("data-annotation-type",s),t.classList.add(`annotation-${s}`);const i=ks("rect");t.appendChild(i)}return t}function oE(t,e,s,i){const n=e.id,r=`class${n}`,o=Gs(e),a=MU(s,n,e.properties.type),{strokeColor:l,strokeWidth:d,strokeType:h,background:u,borderRadius:c}=e.properties.style||fd;a.classList.add("annotation-box"),a.setAttribute("fill",`${u||"transparent"}`);const g=a.firstChild;c&&(g.setAttribute("rx",`${c}`),g.setAttribute("ry",`${c}`)),h&&h!=="none"&&(g.setAttribute("stroke",l||"black"),g.setAttribute("stroke-width",`${d}`),h==="dashed"&&g.setAttribute("stroke-dasharray","5,5")),u&&u.length&&g.setAttribute("fill",u||"transparent");const m=As(e);return g.setAttribute("width",`${o.width}`),g.setAttribute("height",`${o.height}`),g.setAttribute("x",`${m.x}`),g.setAttribute("y",`${m.y}`),a.appendChild(g),a.setAttribute("transform",i.getRotationTransform(0,0)),a.classList.add(r),a.setAttribute("data-annotation",`${e.id}`),a.setAttribute("data-annotation-type",e.properties.type),t.appendChild(a),a}var aE={exports:{}};(function(t,e){(function(s,i){t.exports=i()})(WB,()=>(()=>{var s={d:(N,P)=>{for(var V in P)s.o(P,V)&&!s.o(N,V)&&Object.defineProperty(N,V,{enumerable:!0,get:P[V]})},o:(N,P)=>Object.prototype.hasOwnProperty.call(N,P)},i={};function n(N){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},n(N)}s.d(i,{default:()=>an});var r=/^((?:[a-z\d-]+\s+)*)([\d.]+(%|em|px)|(?:x+-)?large|(?:x+-)?small|medium)(?:\s*\/\s*(normal|[\d.]+(%|px|em)?))?(\s.+)?$/,o=/\bsmall-caps\b/,a=/\b(?:italic|oblique)\b/,l=/\bbold(?:er)?\b/,d=13.3333333,h={"xx-small":9,"x-small":10,smaller:13.3333,small:13,medium:16,large:18,larger:19.2,"x-large":24,"xx-large":32};function u(N){var P="",V=this;return V.style&&V.style!=="normal"&&(P+=V.style),V.variant&&V.variant!=="normal"&&(P+=(P?" ":"")+V.variant),V.weight&&V.weight!=="normal"&&(P+=(P?" ":"")+V.weight),V.size&&(P+=(P?" ":"")+V.size+"px",V.height!==V.size&&(P+="/"+V.height+"px")),V.family&&(P+=(P?" ":"")+V.family),N&&(P+="::"+V.baseline),N&&(P+="::"+V.color),P}var c={id:"",family:"sans-serif",height:14,size:12,variant:"",style:"",weight:"",baseline:"",color:null,toString:u,valueOf:u};function g(N){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},V=r.exec(N);P.family=(V[6]||"").trim();var D=h[V[2]]||parseFloat(V[2]);V[3]==="%"?D*=.16:V[3]==="em"?D*=16:V[3]==="pt"&&(D*=d),P.size=D;var tt=parseFloat(V[4]);if(tt!=="normal"&&tt!=="inherit"&&tt?V[5]&&V[5]!=="em"?V[5]==="pt"?P.height=tt*d:V[5]==="%"?P.height=.01*D:P.height=tt:P.height=tt*D:P.height=Math.round(D*(7/6)),o.test(V[1])&&(P.variant="small-caps"),a.test(V[1])&&(P.style="italic"),l.test(V[1]))P.weight="bold";else{var mt=parseInt(/\b(\d+)\b/.exec(V[1]),10);mt>=100&&mt!==400&&(P.weight=mt)}return P}function m(){var N,P,V,D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"12px/14px sans-serif",tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},mt=14,Et=12,vt=null,Ct=null,Nt="";if(D&&D.nodeType){var $t=D&&(D.ownerDocument&&D.ownerDocument.defaultView||D.document&&D||D.defaultView),Kt=$t.getComputedStyle(D,null);N=Kt.getPropertyValue("font-family")||"",Et=parseFloat(Kt.getPropertyValue("font-size")),mt=Kt.getPropertyValue("line-height"),vt=Kt.getPropertyValue("font-weight"),Ct=Kt.getPropertyValue("font-style"),Nt=Kt.getPropertyValue("font-variant")||""}else if(typeof D=="string"){var Ut=g(D);N=Ut.family,Et=Ut.size,mt=Ut.height,Nt=Ut.variant,Ct=Ut.style,vt=Ut.weight}else n(D)==="object"&&(N=D.family,Et=D.size,mt=D.height,Nt=D.variant,vt=D.weight,Ct=D.style,P=D.baseline,V=D.color);tt.size&&tt.size<3&&(Et*=tt.size),mt=mt!=="normal"&&mt?parseFloat(mt):Et*(7/6),tt.height&&tt.height<3&&(mt*=tt.height);var Wt=Object.create(c);return Wt.family=tt.family||N||"sans-serif",Wt.height=mt??14,Wt.size=Et??12,Wt.variant=tt.variant||Nt||"",Wt.style=tt.style||Ct||"",Wt.weight=tt.weight||vt||"",Wt.baseline=P||0,tt.baseline!=null&&(Wt.baseline=tt.baseline),Wt.color=tt.color||V||"",Wt.id=u.call(Wt,!0),Wt}const f={"\n":.28,"\r":.28," ":.28,"":.28,"":.28,"":0,"":.5,"":1,"":.5,"":1,"":.33,"":.25,"":.16,"":.56,"":.28,"":.2,"":.15,"":0,"":.16,"":.22,"":1,"\uFEFF":0};var p,_=function(N){var P=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(100,100)||N&&N.createElement("canvas");if(P&&P.getContext){var V=P.getContext("2d");if(V&&typeof V.measureText=="function")return function(D,tt){return V.font=String(tt),V.measureText(D).width}}}(typeof document<"u"?document:null)||(p={},function(N,P){if(!p[P]){var V=m(P);p[P]=V,/\bmonospace\b/.test(V.family)?V.size*=.6:(V.size*=.45,V.weight&&(V.size*=1.18))}return N.length*p[P].size}),y={},x={trim:!0,collapse:!0};function b(N,P,V){var D=Object.assign({},x,V),tt=String(N);if(!tt)return 0;if(tt in f){var mt=P.id+"/"+tt;return mt in y||(y[mt]=_("_".concat(tt,"_"),P)-_("__",P)),y[mt]}return D.trim&&D.collapse?D.trim?tt=tt.trim():D.collapse&&(tt=tt.replace(/\s+/g," ")):tt=tt.replace(/\n/g," "),_(tt,P)+P.size*(N.tracking||0)}function v(N){return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},v(N)}function A(N,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function");N.prototype=Object.create(P&&P.prototype,{constructor:{value:N,writable:!0,configurable:!0}}),Object.defineProperty(N,"prototype",{writable:!1}),P&&E(N,P)}function E(N,P){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(V,D){return V.__proto__=D,V},E(N,P)}function S(N){var P=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var V,D=T(N);if(P){var tt=T(this).constructor;V=Reflect.construct(D,arguments,tt)}else V=D.apply(this,arguments);return w(this,V)}}function w(N,P){if(P&&(v(P)==="object"||typeof P=="function"))return P;if(P!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(V){if(V===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return V}(N)}function T(N){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(P){return P.__proto__||Object.getPrototypeOf(P)},T(N)}function L(N,P){if(!(N instanceof P))throw new TypeError("Cannot call a class as a function")}function R(N,P){for(var V=0;V<P.length;V++){var D=P[V];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(N,(tt=function(mt,Et){if(v(mt)!=="object"||mt===null)return mt;var vt=mt[Symbol.toPrimitive];if(vt!==void 0){var Ct=vt.call(mt,Et);if(v(Ct)!=="object")return Ct;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(mt)}(D.key,"string"),v(tt)==="symbol"?tt:String(tt)),D)}var tt}function k(N,P,V){return P&&R(N.prototype,P),Object.defineProperty(N,"prototype",{writable:!1}),N}var j=function(){function N(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";L(this,N),this.value=P,this.weight=null,this.style=null,this.font=null,this.href=null,this.sub=!1,this.sup=!1}return k(N,[{key:"clone",value:function(){var P=new N(this.value);return P.value=this.value,P.weight=this.weight,P.style=this.style,P.font=this.font,P.href=this.href,P.sub=this.sub,P.sup=this.sup,P}},{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}}]),N}(),z=function(N){A(V,N);var P=S(V);function V(){return L(this,V),P.apply(this,arguments)}return k(V)}(j),q=function(N){A(V,N);var P=S(V);function V(){return L(this,V),P.apply(this,arguments)}return k(V)}(j),B=function(N){A(V,N);var P=S(V);function V(){return L(this,V),P.apply(this,arguments)}return k(V)}(j),W=/^[\n\r\t\x20\xA0\u2000-\u200B\u205F\u3000]/,Z=/^[^\n\r\t\u0020\u2000-\u200B\u205F\u3000]{2,}/,it=/^[\xA0\u2011\u202F\u2060\uFEFF]/,dt=/^(?:[;\xAD%?]|,(?!\d))/,At=/^[$\u2212]/;function gt(N,P){P!==!1&&(N=N.trim());for(var V,D,tt=[],mt=N.charAt(0),Et=0,vt=1,Ct=N.length;vt<Ct;vt++){V=N.charAt(vt),D=N.charAt(vt+1);var Nt=W.test(mt),$t=W.test(V),Kt=$t||Nt,Ut=void 0;if((At.test(V)&&!it.test(mt)||dt.test(mt+D)&&!it.test(V))&&(Kt=!0),mt!=="-"&&mt!==""&&mt!==""&&mt!==""||((Ut=W.test(N.charAt(vt-2)))&&!$t&&(Kt=!1),!Ut&&Z.test(V+D)&&(Kt=!0)),Kt){var Wt=N.slice(Et,vt);/\u00AD$/.test(Wt)?(tt.push(new j(Wt.slice(0,-1))),tt.push(new B)):(tt.push(new j(Wt)),tt.push(new z)),Et=vt}mt=V}return tt.push(new j(N.slice(Et))),tt}const ct={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:""};var yt=/^[\n\r\x20\u2000-\u200B\u205F\u3000]/,Tt=/^<\/([a-zA-Z0-9]+)([^>]*)>/,Gt=/^<([a-zA-Z0-9]+)((?:\s[^=\s/]+(?:\s*=\s*(?:"[^"]+"|'[^']+'|[^>\\s]+))?)+)?\s*(\/?)>(\n*)/,Vt=/^<!--(.+?)-->/,St=/&(?:#(\d\d{2,})|#x([\da-fA-F]{2,})|([a-zA-Z][a-zA-Z1-4]{1,8}));/g,ft={b:function(N){N.weight="bold"},strong:function(N){N.weight="bold"},i:function(N){N.style="italic"},em:function(N){N.style="italic"},dfn:function(N){N.style="italic"},cite:function(N){N.style="italic"},code:function(N){N.family="monospace"},kbd:function(N){N.family="monospace"},samp:function(N){N.family="monospace"},var:function(N){N.family="monospace"},tt:function(N){N.family="monospace"},sub:function(N){N.sub=!0},sup:function(N){N.sup=!0}},pt={div:1,li:1,blockquote:2,h1:2,h2:2,h3:2,h4:2,h5:2,h6:2,ul:2,ol:2,hr:2,p:2};function It(N){return N.replace(St,function(P,V,D,tt){if(V||D){var mt=V?10:16;return String.fromCharCode(parseInt(V||D,mt))}return tt in ct?ct[tt]:P})}function Lt(N){return N&&N.length>1&&(N[0]==='"'&&N[N.length-1]==='"'||N[0]==="'"&&N[N.length-1]==="'")?N.slice(1,-1):N}var zt=/^\s*([^=\s&]+)(?:\s*=\s*("[^"]+"|'[^']+'|[^>\s]+))?/;function _t(N){var P,V={};if(N){do if(P=zt.exec(N)){var D=It(Lt(P[2]||"")).replace(/[ \r\n\t]+/g," ").trim();if(V[P[1]]=D,(N=N.slice(P[0].length)).length&&/^\S/.test(N[0]))throw new Error("Attribute error")}while(P&&N.length);if(/\S/.test(N))throw new Error("Attribute error")}return V}const Dt={copyright:"",textcopyright:"",dag:"",textdagger:"",ddag:"",textdaggerdbl:"",guillemotleft:"",guillemotright:"",guilsinglleft:"",guilsinglright:"",ldots:"",dots:"",textellipsis:"",lq:"",P:"",textparagraph:"",pounds:"",textsterling:"",quotedblbase:"",quotesinglbase:"",rq:"",S:"",sim:"~",textasciicircum:"^",textasciitilde:"",texttildelow:"~",textasteriskcentered:"*",textbackslash:"'",textbar:"|",textbardbl:"",textbigcircle:"",textbraceleft:"{",textbraceright:"}",textbullet:"",textdollar:"$",textemdash:"",textendash:"",texteuro:"",eurosym:"",euro:"",textexclamdown:"",textgreater:">",textless:"<",textordfeminine:"",textordmasculine:"",textperiodcentered:"",cdot:"",textquestiondown:"",textquotedblleft:"",textquotedblright:"",textquoteleft:"",textquoteright:"",textquotestraightbase:"",textquotestraightdblbase:"",textregistered:"",textthreequartersemdash:"-",texttrademark:"",texttwelveudash:"-",textunderscore:"_",textvisiblespace:"",gets:"",textleftarrow:"",to:"",textrightarrow:"",textdegree:"",infty:"",triangle:"",triangledown:"",blacktriangle:"",blacktriangledown:"",angle:"",sphericalangle:"",aleph:"",hbar:"",imath:"",jmath:"",ell:"",wp:"",Re:"",Im:"",mho:"",prime:"",emptyset:"",nabla:"",surd:"",partial:"",top:"",bot:"",vdash:"",dashv:"",forall:"",exists:"",nexists:"",neg:"",lnot:"",flat:"",natural:"",sharp:"",backslash:"\\",Box:"",Diamond:"",clubsuit:"",diamondsuit:"",heartsuit:"",spadesuit:"",Join:"",blacksquare:"",bigstar:"",diagdown:"",diagup:"",blacklozenge:"",rfloor:"",lfloor:"",rceil:"",lceil:"",rangle:"",langle:"",sum:"",int:"",oint:"",prod:"",coprod:"",bigcap:"",bigcup:"",bigsqcup:"",bigvee:"",bigwedge:"",bigodot:"",bigotimes:"",bigoplus:"",biguplus:"",alpha:"",beta:"",chi:"",delta:"",epsilon:"",eta:"",gamma:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",omega:"",phi:"",pi:"",psi:"",rho:"",sigma:"",tau:"",theta:"",upsilon:"",xi:"",zeta:"",Alpha:"",Beta:"",Chi:"",Delta:"",Epsilon:"",Eta:"",Gamma:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Omega:"",Phi:"",Pi:"",Psi:"",Rho:"",Sigma:"",Tau:"",Theta:"",Upsilon:"",Xi:"",Zeta:"",aa:"",AA:"",ae:"",AE:"",dh:"",DH:"",dj:"",DJ:"",ij:"",IJ:"",l:"",L:"",ng:"",NG:"",o:"",O:"",oe:"",OE:"",ss:"",SS:"SS",th:"",TH:""};var oe=/^(\^|_|\\[^#$%&~_^\\{}()\s]+)(\{)?/,qt=/^%[^\n]+(?:\n|$)/,jt=/^[^#$%&~_^\\{}]+/,Zt=/^\\([&{}$%#_])/,ie=/(?:\\[\\@,!:;-]|-{2,3}|[!?]`|``?|,,|''?|~|<<|>>)/g,he={"---":"","--":"","!`":"","?`":"","``":"",",,":"","''":"","`":"","'":"","<<":"",">>":"","~":"","\\-":"","\\,":"","\\;":"","\\:":"","\\!":"","\\@":"\uFEFF","\\\\":"\\newline{}"},Yt={bf:function(N){N.weight="bold"},it:function(N){N.style="italic"},sl:function(N){N.style="italic"},color:function(N,P){N.color=P},href:function(N,P){N.href=P},"^":function(N){N.sup=!0},_:function(N){N.sub=!0},par:function(N){this.tokens.push(new q,new q)},newline:function(N){this.tokens.push(new q)},url:function(N,P){this.open_context().href=P,this.add_token(new j(P)),this.close_context()}};Yt.textsuperscript=Yt["^"],Yt.textsubscript=Yt._,Yt.textsl=Yt.sl,Yt.mathbf=Yt.bf,Yt.mathit=Yt.it,Yt.textbf=Yt.bf,Yt.textit=Yt.it,Yt.textcolor=Yt.color;var ae=/[\r\n\xA0]+/g;function Ft(N,P){N.sup&&(N.baseline=.45,N.size=.7),N.sub&&(N.baseline=-.3,N.size=.7);var V=P;return(N.style||N.weight||N.baseline||N.color||N.size||N.family)&&(V=m(P,N)),V}function Pt(N,P,V){for(var D,tt,mt=N.width;mt+V.width>P&&N.length;)tt=(D=N[N.length-1]).width,D.width>V.width?(D.value=D.value.slice(0,-1),D.width=b(D,D.font),mt+=D.width):N.pop(),mt-=tt;N[N.length-1]instanceof B&&N.pop(),D=N[N.length-1]||D||{},V.font=m(V.font,D.bold,D.italic,""),V.href=N.length?D.href:null,V.rel=N.length?D.rel:null,V.target=N.length?D.target:null,N.push(V)}function Ee(N){return Math.round(1e6*N)/1e6}function ps(N){return function(P){if(Array.isArray(P))return Hs(P)}(N)||function(P){if(typeof Symbol<"u"&&P[Symbol.iterator]!=null||P["@@iterator"]!=null)return Array.from(P)}(N)||function(P,V){if(P){if(typeof P=="string")return Hs(P,V);var D=Object.prototype.toString.call(P).slice(8,-1);return D==="Object"&&P.constructor&&(D=P.constructor.name),D==="Map"||D==="Set"?Array.from(P):D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D)?Hs(P,V):void 0}}(N)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Hs(N,P){(P==null||P>N.length)&&(P=N.length);for(var V=0,D=new Array(P);V<P;V++)D[V]=N[V];return D}var sn={center:"middle",right:"end"},nn={middle:.5,center:.5,bottom:1,end:1},Xs=function(N,P){return!N&&!P||N===P};function Ii(N,P){var V=[],D=P.font(),tt=D.size,mt=D.family,Et=P.align(),vt=P.createElement();if(N.length){var Ct=D.height,Nt=P.valign(),$t=P.height()(),Kt=P.width()(0),Ut=!isFinite(Kt)&&N.length===1,Wt=Ut?null:P.x(),I=Ee(Ct/tt),F=Ut?null:Ee(Ct/(1.15*tt+(Ct-tt)/2));if(nn[Nt]&&isFinite($t)){var C=Nt==="bottom"?1:.5;F+=($t*C-Ct*N.length*C)/tt}var M=Et==="justify",G=0;Et==="right"?G=Kt:Et==="center"&&(G=Kt/2);for(var U=[],O="tspan",$=null,Y="",H=function(){if(Y){var Mt=vt(O,$,Y);U.push(Mt)}O="tspan",$=null,Y=""},K=0,X=N.length;K<X;K++){var J="",nt="",Q=0,et=N[K];if(et.length){U=[];for(var st=0,lt=0,rt=void 0,ot=0,ht=et.length;ot<ht;ot++){var at=et[ot],ut=at.font;at.whitespace&&st++,lt+=at.width,ot&&!at.tracking&&!Q&&Xs(ut.id,J)&&Xs(at.class,nt)&&Xs(rt,at.href)?Y+=at.value:(H(),Y=at.value,$={fontFamily:ut.family!==mt?ut.family:null,fontSize:ut.size!==tt?ut.size:null,fontWeight:ut.weight||null,fontStyle:ut.style||null,fontVariant:ut.variant!=="normal"&&ut.variant||null,fill:ut.color||null,baselineShift:ut.baseline?100*ut.baseline+"%":null,className:at.class||null},Q&&($.dx=Ee(Q),Q=0),at.tracking&&(Q=ut.size*at.tracking),at.href&&!rt?(rt=at.href,O="a",$.href=rt,$.rel=at.rel,$.target=at.target):rt=null,J=ut.id,nt=at.class)}if(H(),Ut)V.push.apply(V,ps(U));else{var xt=null,wt=K===X-1||et[et.length-1]instanceof q;M&&et.length>1&&!wt&&(xt=Ee((Kt-lt)/st)),V.push(vt.apply(void 0,["tspan",{wordSpacing:xt,x:Wt(K)+G,dy:Ee(K?I:F)+"em"}].concat(ps(U))))}}else V.push(vt("tspan",{x:Wt(K),dy:Ee(K?I:F)+"em"},""))}}return vt.apply(void 0,["text",{fontFamily:mt,fontSize:tt,textAnchor:sn[Et]||"start"}].concat(V))}var _e={middle:.5,center:.5,bottom:1,end:1};function ls(N,P,V){if(N.length){V.textBaseline="middle";var D=P.font(),tt=D.height,mt=D.size,Et=P.valign(),vt=P.height()(),Ct=P.width()(0),Nt=P.align(),$t=Nt==="justify",Kt=.5*tt,Ut=_e[Et];if(Ut&&isFinite(vt)){var Wt=N.length*tt;Kt+=vt*Ut-Wt*Ut}N.forEach(function(I,F){var C=P.x()(F),M=F*tt+Kt,G=0,U=0;I.forEach(function(Y){Y.whitespace&&G++,U+=Y.width});var O=0,$=F===N.length-1||I[I.length-1]instanceof q;$t&&I.length>1&&!$&&(O=(Ct-U)/G),I.forEach(function(Y){V.font=Y.font;var H=Y.font,K=H.baseline?mt*-H.baseline+.15*mt:0;V.fillStyle=function(nt,Q){return nt.color?nt.color:Q.href?"#00C":"#000"}(H,Y);var X=0;if(Nt==="right"?X+=Ct-U:Nt==="center"?X+=Ct/2-U/2:Nt==="justify"&&(Y.whitespace||Y instanceof q)&&(C+=O),V.fillText(Y.value,C+X,M+K),Y.href){V.beginPath(),V.strokeStyle=V.fillStyle;var J=Math.floor(M+.45*mt)+.5;V.moveTo(C+X,J),V.lineTo(C+X+Y.width,J),V.stroke()}C+=Y.width})})}}function Ke(N){return Ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},Ke(N)}function ds(N){for(var P={},V=0;V<N.length;V++){var D=N[V];typeof D!="number"&&D!=null&&(typeof D=="string"?P.text=D:typeof D=="function"?P.fn=D:Ke(D)==="object"&&D._groups?P.d3=D:D&&D.nodeType&&D.getContext?P.ctx=D.getContext("2d"):D&&D.fillText&&D.beginPath?P.ctx=D:D&&(P.text=D))}return P}function De(N){return De=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},De(N)}function ri(N,P){for(var V=0;V<P.length;V++){var D=P[V];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(N,(tt=function(mt,Et){if(De(mt)!=="object"||mt===null)return mt;var vt=mt[Symbol.toPrimitive];if(vt!==void 0){var Ct=vt.call(mt,Et);if(De(Ct)!=="object")return Ct;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(mt)}(D.key,"string"),De(tt)==="symbol"?tt:String(tt)),D)}var tt}var hs=m(),Cs=function(N){return typeof N=="function"?N:function(){return N}},Ve=function(){function N(D){if(function(mt,Et){if(!(mt instanceof Et))throw new TypeError("Cannot call a class as a function")}(this,N),this.props={overflow:"ellipsis",lineclamp:null,align:"left",wordBreak:null,valign:"top",width:function(){return 1/0},height:function(){return 1/0},x:function(){return 0},font:null,tAnchor:0,parser:N.defaultparser},D)for(var tt in D)typeof this[tt]=="function"&&this[tt](D[tt])}var P,V;return P=N,V=[{key:"linebreak",value:function(D){var tt=this,mt=this.props.parser(String(D)),Et=this.font(),vt=function(Ct,Nt,$t){if(!Ct.length)return[];var Kt=Nt.height(),Ut=Nt.width(),Wt=Nt.overflowLine(),I=Nt.overflowWrap(),F=m($t,!0,!1),C=isFinite(Kt())?Math.floor(Kt()/$t.height):1/0;if(!Kt()&&!Ut(0)||!C)return[];for(var M=0,G=0,U=0,O=[],$=[],Y=!1;M<Ct.length&&G<C;){var H=Ct[M],K=Ft(H,$t);if(H.width=b(H,K),H.font=K,H.line=G,H.whitespace=H.value in f,H.value&&(H.value=H.value.replace(ae," ")),!(!U&&H.whitespace||Y&&H.whitespace))if(H instanceof q)U=0,$=[],O.push(M+1),G++;else if(H instanceof z||H instanceof B)$.push({index:M,width:U});else if(H.whitespace||U+H.width<Ut(G))U+=H.width;else if($.length){var X=void 0,J=void 0;do{J=!0,X=$.pop();var nt=Ct[X.index],Q=void 0;nt instanceof B&&(Q=b("-",nt.font),X.width+Q>Ut(G)&&(J=!$.length))}while(!J);O.push(X.index+1),U=0,G++,M=X.index,$=[]}else if(I==="break-word"){var et=Ut(G);if(U+H.width>et){var st=H.clone();do H.value=H.value.slice(0,-1),H.width=b(H,H.font),U+=H.width;while(H.value&&H.width>et);st.value=st.value.slice(H.value.length),Ct.splice(M+1,0,new z,st)}O.push(M+1),U=0,G++}else U+=H.width;M++,Y=H.whitespace}M!==O[O.length-1]&&O.push(M);var lt=0,rt=0,ot=O.map(function(Mt){for(var Rt,kt=lt;(Rt=Ct[kt])&&(Rt.whitespace||!Rt.value);)kt++;for(var Ht=Mt,Jt=null;Ht>kt&&(Rt=Ct[Ht-1])&&(Rt.whitespace||!(Rt.value||Rt instanceof B));)Rt instanceof q&&(Jt=Rt),Ht--;Rt instanceof B&&(Rt.value="-",Rt.width=b("-",Rt.font)),lt=Mt;var te=Ct.slice(kt,Ht).filter(function(le){return le.value});return Jt&&te.push(Jt),te.width=te.reduce(function(le,Ae){return le+Ae.width},0),te.width>rt&&(rt=te.width),te});if(ot.hasLineOverflow=!1,Wt){var ht=Wt==="ellipsis"?"":Wt;ot.forEach(function(Mt,Rt){var kt=Ut(Rt);if(Mt.width>kt){var Ht=new j(ht);Ht.font=$t,Ht.width=b(ht,F),Pt(Mt,kt,Ht),ot.hasLineOverflow=!0}})}var at=Nt.overflow()==="ellipsis"?"":Nt.overflow();if(at&&M!==Ct.length){var ut=Ut(ot.length-1),xt=ot[ot.length-1],wt=new j(at);wt.font=$t,wt.width=b(at,F),Pt(xt,ut,wt),ot.hasOverflow=!0}else ot.hasOverflow=!1;return ot.font=$t,ot.width=rt,ot}(mt,this,Et);return vt.height=vt.length*Et.height,vt.render=function(Ct){return tt.render(vt,Ct)},vt.svg=vt.render,vt.draw=vt.render,vt}},{key:"font",value:function(D){return arguments.length?(this.props.font=m(D),this):this.props.font||m(hs)}},{key:"overflow",value:function(D){return arguments.length?(this.props.overflow=String(D),this):this.props.overflow}},{key:"overflowLine",value:function(D){return arguments.length?(this.props.lineclamp=String(D),this):this.props.lineclamp}},{key:"valign",value:function(D){return arguments.length?(this.props.valign=D,this):this.props.valign}},{key:"align",value:function(D){if(!arguments.length)return this.props.align;var tt=String(D).toLowerCase();return tt==="left"||tt==="start"?(this.props.align="left",this.props.tAnchor=0):tt==="center"||tt==="middle"?(this.props.align="center",this.props.tAnchor=-.5):tt==="end"||tt==="right"?(this.props.align="right",this.props.tAnchor=-1):tt==="justify"&&(this.props.align=D,this.props.tAnchor=0),this}},{key:"overflowWrap",value:function(D){if(!arguments.length)return this.props.overflowWrap||"normal";var tt=String(D).toLowerCase();return tt==="break-word"?this.props.overflowWrap="break-word":tt!=="normal"&&D!=null||(this.props.overflowWrap=null),this}},{key:"width",value:function(D){return arguments.length?(this.props.width=Cs(D),this):this.props.width}},{key:"height",value:function(D){return arguments.length?(this.props.height=Cs(D),this):this.props.height}},{key:"x",value:function(D){return arguments.length?(this.props.x=Cs(D),this):this.props.x}},{key:"parser",value:function(D){if(!arguments.length)return this.props.parser;if(typeof D=="string"){var tt=N[D]||N[D+"parser"];typeof tt=="function"&&(D=tt)}if(typeof D!="function")throw new Error("Unknown parser: "+D);return this.props.parser=D,this}},{key:"createElement",value:function(D){return arguments.length?(this.props.createElement=D,this):this.props.createElement||N.createElement}},{key:"render",value:function(){var D=ds(arguments);return typeof D.text=="string"&&(D.text=this.linebreak(D.text)),D.ctx?ls(D.text,this,D.ctx):Ii(D.text,this)}}],V&&ri(P.prototype,V),Object.defineProperty(P,"prototype",{writable:!1}),N}();function Ns(N){return Ns=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},Ns(N)}function Ms(N,P){(P==null||P>N.length)&&(P=N.length);for(var V=0,D=new Array(P);V<P;V++)D[V]=N[V];return D}function Li(N,P){for(var V=0;V<P.length;V++){var D=P[V];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(N,(tt=function(mt,Et){if(Ns(mt)!=="object"||mt===null)return mt;var vt=mt[Symbol.toPrimitive];if(vt!==void 0){var Ct=vt.call(mt,Et);if(Ns(Ct)!=="object")return Ct;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(mt)}(D.key,"string"),Ns(tt)==="symbol"?tt:String(tt)),D)}var tt}var oi=function(N){return typeof N=="function"?N:function(){return N}},rn=function(){function N(D){if(function(mt,Et){if(!(mt instanceof Et))throw new TypeError("Cannot call a class as a function")}(this,N),this.props={width:function(){return 1/0},height:function(){return 1/0},rotation:0,vAnchor:0,hAnchor:0},D)for(var tt in D)typeof this[tt]=="function"&&this[tt](D[tt]);this.render=this.render.bind(this)}var P,V;return P=N,V=[{key:"anchor",value:function(D){var tt=this.props,mt=tt.hAnchor,Et=tt.vAnchor,vt=tt.width,Ct=tt.height;if(!arguments.length)return[mt*vt(0),Et*Ct(0)];if(typeof D=="string"){var Nt=this.props;D.toLowerCase().trim().split(/\s+/).forEach(function($t){$t==="top"&&(Nt.vAnchor=-0),$t==="middle"&&(Nt.vAnchor=-.5),$t==="bottom"&&(Nt.vAnchor=-1),$t==="left"&&(Nt.hAnchor=-0),$t==="center"&&(Nt.hAnchor=-.5),$t==="right"&&(Nt.hAnchor=-1)})}return this}},{key:"width",value:function(D){return arguments.length?(this.props.width=oi(D),this):this.props.width}},{key:"height",value:function(D){return arguments.length?(this.props.height=oi(D),this):this.props.height}},{key:"rotate",value:function(D){return arguments.length?(this.props.rotation=D,this):this.props.rotation}},{key:"createElement",value:function(D){return arguments.length?(this.props.createElement=D,this):this.props.createElement||N.createElement}},{key:"canvas",value:function(D,tt){var mt,Et=D.getContext?D.getContext("2d"):D;return Et.save(),Et.rotate(this.rotate()*Math.PI/180),Et.translate.apply(Et,function(vt){if(Array.isArray(vt))return Ms(vt)}(mt=this.anchor())||function(vt){if(typeof Symbol<"u"&&vt[Symbol.iterator]!=null||vt["@@iterator"]!=null)return Array.from(vt)}(mt)||function(vt,Ct){if(vt){if(typeof vt=="string")return Ms(vt,Ct);var Nt=Object.prototype.toString.call(vt).slice(8,-1);return Nt==="Object"&&vt.constructor&&(Nt=vt.constructor.name),Nt==="Map"||Nt==="Set"?Array.from(vt):Nt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Nt)?Ms(vt,Ct):void 0}}(mt)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()),tt(Et),Et.restore(),Et}},{key:"render",value:function(){var D=ds(arguments);if(D.d3)return D.d3.attr("transform","rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")"));if(D.ctx)return this.canvas(D.ctx,D.fn);if(D.text){var tt=typeof D.text.render=="function"?D.text.render():D.text;return this.createElement()("g",{transform:"rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")")},tt)}}}],V&&Li(P.prototype,V),Object.defineProperty(P,"prototype",{writable:!1}),N}(),$s=Object.prototype.hasOwnProperty,_s={};function on(N){return _s[N]||(_s[N]=N.replace(/([a-z])([A-Z])/g,function(P,V,D){return V+"-"+D.toLowerCase()})),_s[N]}function ai(N,P){if(Array.isArray(P))return P.forEach(function(V){return ai(N,V)});typeof P=="string"&&(P=document.createTextNode(P)),N.appendChild(P)}function Oe(N,P){if(typeof document<"u"){var V=typeof N=="string"?document.createElementNS("http://www.w3.org/2000/svg",N):N;if(P&&V.setAttribute)for(var D in P)$s.call(P,D)&&P[D]!=null&&V.setAttribute(D==="className"?"class":on(D),P[D]);for(var tt=arguments.length,mt=new Array(tt>2?tt-2:0),Et=2;Et<tt;Et++)mt[Et-2]=arguments[Et];return mt!=null&&mt.length&&mt.forEach(function(vt){ai(V,vt)}),V}}Ve.createElement=Oe,Ve.textparser=gt,Ve.defaultparser=gt,Ve.htmlparser=function(N){N=String(N||"").trim();for(var P,V,D={weight:null,style:null,sub:!1,sup:!1,href:null,color:null,rel:null,target:null},tt=[],mt=[],Et=function(Kt){for(var Ut in D)D[Ut]&&(Kt[Ut]=D[Ut]);tt.push(Kt)},vt=function(Kt){var Ut=tt.length,Wt=pt[Kt];if(Ut&&Wt){for(var I=Ut-1;tt[I]&&(tt[I]instanceof z||yt.test(tt[I].value));)I--;for(;Wt&&tt[I]&&tt[I]instanceof q;)I--,Wt--;for(;Wt-- >0;)tt.push(new q)}};N.length;){if(P=/^[^<]+/.exec(N))gt(It(P[0]),!1).forEach(Et);else if(!(P=Vt.exec(N)))if(P=Tt.exec(N))mt.length&&(D=mt.pop()),vt(P[1]);else if(P=Gt.exec(N)){var Ct=P[1];vt(Ct),mt.push(D),D=Object.create(D),ft[Ct]&&ft[Ct](D,"");var Nt=_t(P[2]);Ct==="a"&&(Nt.href&&(D.href=Nt.href),Nt.rel&&(D.rel=Nt.rel),Nt.target&&(D.target=Nt.target)),Nt.class&&(D.class=D.class?D.class+" "+Nt.class:Nt.class),Nt.style&&(V=/(?:^|\s|;)color\s*:\s*([^;\s"']+)/.exec(Nt.style))&&V[1]&&(D.color=V[1]),Ct==="br"&&tt.push(new q)}else P=[N.slice(0,1)],Et(new j(P[0]));N=N.slice(P[0].length)}for(var $t=tt[tt.length-1];$t instanceof q;)tt.pop(),$t=tt[tt.length-1];return tt},Ve.latexparser=function(N){N=String(N||"").trim();var P=[0];N=N.replace(/\\verb,(.*?),/,function(C,M){return P.push(M),"\\verb,"+(P.length-1)+","}).replace(/\\\\\n/g,function(){return"\\\\"}).replace(ie,function(C,M,G){return G.charAt(M-1)==="\\"?C:he[C]}).replace(/\n\s+/g,function(C){return/\n/.test(C.slice(1))?"\\par ":C}).replace(/\\symbol\{(\d+)\}/,function(C,M,G,U){return U.charAt(G-1)==="\\"?C:String.fromCharCode(1*M)}).replace(/(^|[^\\])(\^|_)(\d|[^{]\S*)/g,function(C,M,G,U){return M+G+"{"+U+"}"}).replace(/\\verb,(.*?),/,function(C,M){return"\\verb,".concat(P[+M],",")});for(var V,D={weight:null,italic:null,variant:null,sub:!1,sup:!1,href:null},tt=[],mt=[],Et=function(C){for(var M in D)D[M]&&(C[M]=D[M]);return tt.push(C),C},vt=function(){mt.push(D),D=Object.create(D)},Ct=function(){if(!mt.length)throw new Error("Unexpected }");D=mt.pop()},Nt={tokens:tt,open_context:vt,close_context:Ct,add_token:Et};N.length;){if(V=jt.exec(N))gt(V[0],!1).forEach(Et);else if(V=Zt.exec(N))Et(new j(V[1]));else if(!(V=qt.exec(N))){if(V=/^\{/.exec(N))vt();else if(V=/^\}/.exec(N))Ct();else if(!(V=/^\$/.exec(N)))if(V=/^\\verb,([^,]+),/.exec(N))Et(new j(V[1]));else if(V=oe.exec(N)){var $t=V[1].slice(1)||V[1],Kt=!!V[2];if(/^(La)?TeX$/i.test($t)){vt(),D.family="serif";var Ut=void 0;$t==="LaTeX"&&((Ut=Et(new j("L"))).tracking=-.25,(Ut=Et(new j("A"))).size=.7,Ut.baseline=.3,Ut.tracking=-.1),(Ut=Et(new j("T"))).tracking=-.17,(Ut=Et(new j("E"))).baseline=-.22,Ut.tracking=-.13,Ut=Et(new j("X")),Ct()}else if($t in Dt)Et(new j(Dt[$t])),Kt&&vt();else if($t in Yt){var Wt=[],I=Yt[$t].length-1,F=void 0;if(I){for(Kt=!1,N=N.slice(V[0].length-1);I--;){if(!(F=/^\{([^}]+)\}/.exec(N)))throw new Error($t+" is missing an argument");Wt.push(F[1]),N=N.slice(F[0].length)}V[0]=/^\{/.exec(N)?"{":"",Kt=!!V[0]}Kt&&vt(),Yt[$t].apply(Nt,[D].concat(Wt))}else console.warn("unknown latex command",$t),Et(new j(V[1])),Kt&&vt()}else V=[N.slice(0,1)],Et(new j(V[0]))}N=N.slice(V[0].length)}return tt},Ve.measureText=function(N,P,V){return b(N,m(P),V)},Ve.Token=j,Ve.Break=z,Ve.LineBreak=q,Ve.SoftHyphen=B,Ve.Rotator=rn,rn.createElement=Oe;const an=Ve;return i.default})())})(aE);var RU=aE.exports;const ny=bg(RU);function FU(t,e,s,i){const n=Gs(e),{color:r=Es.color,strokeColor:o=Es.strokeColor,strokeWidth:a=Es.strokeWidth,strokeType:l=Es.strokeType,background:d,borderRadius:h}=e.properties.style||Es,u=oE(t,e,s,i);u.setAttribute("data-annotation-type",e.properties.type),u.classList.add("annotation-text"),u.setAttribute("fill",`${r}`);for(const m of u.children)m.tagName!=="rect"&&u.removeChild(m);const c=u.firstChild;h&&(c.setAttribute("rx",`${h}`),c.setAttribute("ry",`${h}`)),l&&l!=="none"&&(c.setAttribute("stroke",o||"black"),c.setAttribute("stroke-width",`${a}`),l==="dashed"&&c.setAttribute("stroke-dasharray","5,5")),d&&d.length&&c.setAttribute("fill",d||"transparent"),c.setAttribute("width",`${n.width}`),c.setAttribute("height",`${n.height}`);const g=As(e);return c.setAttribute("x","0"),c.setAttribute("y","0"),PU(e,u),u.setAttribute("transform",i.getScreenAlignedTransform(g.x,g.y,!0)),t.appendChild(u),u}const Oh=t=>t.replace(/$/,""),kh=t=>t.children[0].innerHTML;function PU(t,e){const s=Gs(t),{fontSize:i=Es.fontSize,font:n=Es.font,padding:r=0}=t.properties.style||{};if(s.width===s.height&&s.width===0)return;const o=new ny({font:`${i}px/${i}px ${n}`.replace(/(px)+/g,"px"),width:s.width-r*2,height:s.height-r*2,align:"left",valign:"top",x:0,overflow:"ellipsis",parser:"html",createElement:ny.createElement});o.overflowWrap("break-word");const a=t.properties.content||"";if(a.length===0)return;const d=o.linebreak(a.replaceAll(`
`,"<br>")).render(),h=[...d.children];let u=0;const c=[];a.split(`
`).forEach(f=>{let p=f;for(;p.length&&u<h.length;){if(h[u].innerHTML==="&nbsp;"){p.startsWith(`
`)||c.push(u),u++;break}const _=Oh(kh(h[u]));p.startsWith(_)&&(p=p.slice(_.length).trim()),u++}}),c.forEach(f=>d.removeChild(h[f]));const g=a.match(/(https?:\/\/.*)/gm),m=g?g.map(f=>f.split(" ")[0]):[];d.setAttribute("transform",`translate(${r}, ${r})`),m.forEach(f=>{let p=f;const _=[];for(;p.length>0;){const y=h.find(b=>!!b.children[0]&&b.children[0].tagName==="tspan"&&p.startsWith(Oh(kh(b))));if(!y)break;_.push(y);const x=Oh(y.children[0].innerHTML).length;if(!x)break;p=p.slice(x)}_.forEach(y=>{const x=document.createElementNS("http://www.w3.org/2000/svg","a");x.setAttribute("href",f),x.setAttribute("target","_blank"),x.innerHTML=kh(y),y.children[0].innerHTML="",y.children[0].appendChild(x)})}),e.appendChild(d)}class zU extends rE{minArrowHeight=20;maxArrowHeight=30;features=new Map;root=null;arrowsRoot=null;annotationsRoot=null;constructor(e,s){super(e,s),this.layer=this.ogma.layers.addSVGLayer({draw:this.render},Ag.SHAPES),this.store.subscribe(i=>({features:i.features,liveUpdates:i.liveUpdates,hoveredFeature:i.hoveredFeature,selectedFeatures:i.selectedFeatures,rotation:i.rotation,zoom:i.zoom}),()=>this.layer.refresh(),{equalityFn:(i,n)=>i===n})}render=e=>{const{features:s,hoveredFeature:i,selectedFeatures:n,liveUpdates:r}=this.store.getState();e.innerHTML="";const o=ks("g"),a=ks("g");a.appendChild(o),this.root||(this.root=ks("g")),this.arrowsRoot||(this.arrowsRoot=ks("g")),this.annotationsRoot||(this.annotationsRoot=ks("g"));const l=this.store.getState(),d=new Set(Object.keys(s));this.removeFeatures(d);for(let h of Object.values(s)){r[h.id]&&(h={...h,...r[h.id]});let u=this.features.get(h.id);qd(h)?u=oE(a,h,u,l):wn(h)?u=FU(a,h,u,l):da(h)&&(u=CU(o,h,this.minArrowHeight,this.maxArrowHeight,u,l)),u&&this.features.set(h.id,u)}this.applyStateClasses(e,i,n),e.appendChild(a)};removeFeatures(e){for(const s of this.features.keys())if(!e.has(s)){const i=this.features.get(s);i&&i.parentNode&&i.parentNode.removeChild(i),this.features.delete(s)}}applyStateClasses(e,s,i){if(s!==null){const n=e.querySelector(`[data-annotation="${s}"]`);n&&n.classList.add("annotation-hovered")}i.forEach(n=>{const r=e.querySelector(`[data-annotation="${n}"]`);r&&r.classList.add("annotation-selected")})}refresh=()=>{this.layer.refresh()};destroy(){this.features.clear(),this.layer.destroy(),super.destroy()}}const ry=t=>{let e;const s=new Set,i=(d,h)=>{const u=typeof d=="function"?d(e):d;if(!Object.is(u,e)){const c=e;e=h??(typeof u!="object"||u===null)?u:Object.assign({},e,u),s.forEach(g=>g(e,c))}},n=()=>e,a={setState:i,getState:n,getInitialState:()=>l,subscribe:d=>(s.add(d),()=>s.delete(d))},l=e=t(i,n,a);return a},lE=t=>t?ry(t):ry;var dE={exports:{}},Qt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ha=Symbol.for("react.element"),DU=Symbol.for("react.portal"),OU=Symbol.for("react.fragment"),kU=Symbol.for("react.strict_mode"),BU=Symbol.for("react.profiler"),UU=Symbol.for("react.provider"),GU=Symbol.for("react.context"),VU=Symbol.for("react.forward_ref"),qU=Symbol.for("react.suspense"),jU=Symbol.for("react.memo"),YU=Symbol.for("react.lazy"),oy=Symbol.iterator;function HU(t){return t===null||typeof t!="object"?null:(t=oy&&t[oy]||t["@@iterator"],typeof t=="function"?t:null)}var hE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uE=Object.assign,cE={};function Cr(t,e,s){this.props=t,this.context=e,this.refs=cE,this.updater=s||hE}Cr.prototype.isReactComponent={};Cr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Cr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function gE(){}gE.prototype=Cr.prototype;function Tg(t,e,s){this.props=t,this.context=e,this.refs=cE,this.updater=s||hE}var Ig=Tg.prototype=new gE;Ig.constructor=Tg;uE(Ig,Cr.prototype);Ig.isPureReactComponent=!0;var ay=Array.isArray,mE=Object.prototype.hasOwnProperty,Lg={current:null},fE={key:!0,ref:!0,__self:!0,__source:!0};function pE(t,e,s){var i,n={},r=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)mE.call(e,i)&&!fE.hasOwnProperty(i)&&(n[i]=e[i]);var a=arguments.length-2;if(a===1)n.children=s;else if(1<a){for(var l=Array(a),d=0;d<a;d++)l[d]=arguments[d+2];n.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:ha,type:t,key:r,ref:o,props:n,_owner:Lg.current}}function XU(t,e){return{$$typeof:ha,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Cg(t){return typeof t=="object"&&t!==null&&t.$$typeof===ha}function $U(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var ly=/\/+/g;function Bh(t,e){return typeof t=="object"&&t!==null&&t.key!=null?$U(""+t.key):e.toString(36)}function Fl(t,e,s,i,n){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ha:case DU:o=!0}}if(o)return o=t,n=n(o),t=i===""?"."+Bh(o,0):i,ay(n)?(s="",t!=null&&(s=t.replace(ly,"$&/")+"/"),Fl(n,e,s,"",function(d){return d})):n!=null&&(Cg(n)&&(n=XU(n,s+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(ly,"$&/")+"/")+t)),e.push(n)),1;if(o=0,i=i===""?".":i+":",ay(t))for(var a=0;a<t.length;a++){r=t[a];var l=i+Bh(r,a);o+=Fl(r,e,s,l,n)}else if(l=HU(t),typeof l=="function")for(t=l.call(t),a=0;!(r=t.next()).done;)r=r.value,l=i+Bh(r,a++),o+=Fl(r,e,s,l,n);else if(r==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ml(t,e,s){if(t==null)return t;var i=[],n=0;return Fl(t,i,"","",function(r){return e.call(s,r,n++)}),i}function WU(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var as={current:null},Pl={transition:null},ZU={ReactCurrentDispatcher:as,ReactCurrentBatchConfig:Pl,ReactCurrentOwner:Lg};function _E(){throw Error("act(...) is not supported in production builds of React.")}Qt.Children={map:ml,forEach:function(t,e,s){ml(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return ml(t,function(){e++}),e},toArray:function(t){return ml(t,function(e){return e})||[]},only:function(t){if(!Cg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Qt.Component=Cr;Qt.Fragment=OU;Qt.Profiler=BU;Qt.PureComponent=Tg;Qt.StrictMode=kU;Qt.Suspense=qU;Qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZU;Qt.act=_E;Qt.cloneElement=function(t,e,s){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=uE({},t.props),n=t.key,r=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=Lg.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)mE.call(e,l)&&!fE.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=s;else if(1<l){a=Array(l);for(var d=0;d<l;d++)a[d]=arguments[d+2];i.children=a}return{$$typeof:ha,type:t.type,key:n,ref:r,props:i,_owner:o}};Qt.createContext=function(t){return t={$$typeof:GU,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:UU,_context:t},t.Consumer=t};Qt.createElement=pE;Qt.createFactory=function(t){var e=pE.bind(null,t);return e.type=t,e};Qt.createRef=function(){return{current:null}};Qt.forwardRef=function(t){return{$$typeof:VU,render:t}};Qt.isValidElement=Cg;Qt.lazy=function(t){return{$$typeof:YU,_payload:{_status:-1,_result:t},_init:WU}};Qt.memo=function(t,e){return{$$typeof:jU,type:t,compare:e===void 0?null:e}};Qt.startTransition=function(t){var e=Pl.transition;Pl.transition={};try{t()}finally{Pl.transition=e}};Qt.unstable_act=_E;Qt.useCallback=function(t,e){return as.current.useCallback(t,e)};Qt.useContext=function(t){return as.current.useContext(t)};Qt.useDebugValue=function(){};Qt.useDeferredValue=function(t){return as.current.useDeferredValue(t)};Qt.useEffect=function(t,e){return as.current.useEffect(t,e)};Qt.useId=function(){return as.current.useId()};Qt.useImperativeHandle=function(t,e,s){return as.current.useImperativeHandle(t,e,s)};Qt.useInsertionEffect=function(t,e){return as.current.useInsertionEffect(t,e)};Qt.useLayoutEffect=function(t,e){return as.current.useLayoutEffect(t,e)};Qt.useMemo=function(t,e){return as.current.useMemo(t,e)};Qt.useReducer=function(t,e,s){return as.current.useReducer(t,e,s)};Qt.useRef=function(t){return as.current.useRef(t)};Qt.useState=function(t){return as.current.useState(t)};Qt.useSyncExternalStore=function(t,e,s){return as.current.useSyncExternalStore(t,e,s)};Qt.useTransition=function(){return as.current.useTransition()};Qt.version="18.3.1";dE.exports=Qt;var KU=dE.exports;const fl=bg(KU),QU=t=>t;function JU(t,e=QU){const s=fl.useSyncExternalStore(t.subscribe,fl.useCallback(()=>e(t.getState()),[t,e]),fl.useCallback(()=>e(t.getInitialState()),[t,e]));return fl.useDebugValue(s),s}const tG=t=>{const e=lE(t),s=i=>JU(e,i);return Object.assign(s,e),s},eG=t=>tG;var dy=(t,e,s)=>(n,r)=>({pastStates:s?.pastStates||[],futureStates:s?.futureStates||[],undo:(o=1)=>{if(r().pastStates.length){const a=s?.partialize?.(e())||e(),l=r().pastStates.splice(-o,o),d=l.shift();t(d),n({pastStates:r().pastStates,futureStates:r().futureStates.concat(s?.diff?.(a,d)||a,l.reverse())})}},redo:(o=1)=>{if(r().futureStates.length){const a=s?.partialize?.(e())||e(),l=r().futureStates.splice(-o,o),d=l.shift();t(d),n({pastStates:r().pastStates.concat(s?.diff?.(a,d)||a,l.reverse()),futureStates:r().futureStates})}},clear:()=>n({pastStates:[],futureStates:[]}),isTracking:!0,pause:()=>n({isTracking:!1}),resume:()=>n({isTracking:!0}),setOnSave:o=>n({_onSave:o}),_onSave:s?.onSave,_handleSet:(o,a,l,d)=>{s?.limit&&r().pastStates.length>=s?.limit&&r().pastStates.shift(),r()._onSave?.(o,l),n({pastStates:r().pastStates.concat(d||o),futureStates:[]})}}),sG=(t,e)=>(i,n,r)=>{r.temporal=lE(e?.wrapTemporal?.(dy(i,n,e))||dy(i,n,e));const o=e?.handleSet?.(r.temporal.getState()._handleSet)||r.temporal.getState()._handleSet,a=d=>{if(!r.temporal.getState().isTracking)return;const h=e?.partialize?.(n())||n(),u=e?.diff?.(d,h);u===null||e?.equality?.(d,h)||o(d,void 0,h,u)},l=r.setState;return r.setState=(...d)=>{const h=e?.partialize?.(n())||n();l(...d),a(h)},t((...d)=>{const h=e?.partialize?.(n())||n();i(...d),a(h)},n,r)};const iG=t=>(e,s,i)=>{const n=i.subscribe;return i.subscribe=(o,a,l)=>{let d=o;if(a){const h=l?.equalityFn||Object.is;let u=o(i.getState());d=c=>{const g=o(c);if(!h(u,g)){const m=u;a(u=g,m)}},l?.fireImmediately&&a(u,u)}return n(d)},t(e,s,i)},nG=iG,rG=[0,0,0,0],Ng=eG()(nG(sG((t,e)=>({features:{},liveUpdates:{},isDragging:!1,hoveringHandle:!1,hoveredHandle:-1,hoveredFeature:null,selectedFeatures:new Set,lastChangedFeatures:[],rotation:0,sin:0,cos:1,revRotation:0,revSin:0,revCos:1,zoom:1,invZoom:1,removeFeature:s=>t(i=>{const{[s]:n,...r}=i.features;return{features:r}}),addFeature:s=>t(i=>({features:{...i.features,[s.id]:s}})),startLiveUpdate:s=>{t(i=>({liveUpdates:s.reduce((n,r)=>({...n,[r]:{...i.features[r]}}),{}),isDragging:!0}))},applyLiveUpdate:(s,i)=>{t(n=>({liveUpdates:{...n.liveUpdates,[s]:{...n.liveUpdates[s],...i}}}))},commitLiveUpdates:s=>{const{features:i,liveUpdates:n}=e(),r={...i},o=[],a=Object.keys(n);s||(s=new Set(a)),a.forEach(l=>{const d=n[l];r[l]&&Object.keys(d).length>0&&(r[l]={...r[l],...d},o.push(l))}),t({features:r,liveUpdates:{},isDragging:!1,lastChangedFeatures:o})},cancelLiveUpdates:()=>t({liveUpdates:{},isDragging:!1}),updateFeature:(s,i)=>t(n=>({features:{...n.features,[s]:{...n.features[s],...i}}})),updateFeatures:s=>t(i=>{const n={...i.features};return Object.entries(s).forEach(([r,o])=>{n[r]&&(n[r]={...n[r],...o})}),{features:n}}),batchUpdate:s=>{const i=Ng.temporal.getState();i.pause(),s(),i.resume()},getFeature:s=>e().features[s],getMergedFeature:s=>{const i=e().features[s],n=e().liveUpdates[s];if(i)return n?{...i,...n}:i},getAllFeatures:()=>{const{features:s,liveUpdates:i}=e();return Object.entries(s).map(([n,r])=>{const o=i[n];return o?{...r,...o}:r})},setHoveredFeature:s=>t({hoveredFeature:s}),setSelectedFeatures:s=>t({selectedFeatures:new Set(s)}),addToSelection:s=>{const{selectedFeatures:i}=e(),n=new Set(i);n.add(s),t({selectedFeatures:n})},removeFromSelection:s=>{const{selectedFeatures:i}=e(),n=new Set(i);n.delete(s),t({selectedFeatures:n})},toggleSelection:s=>{const{selectedFeatures:i}=e(),n=new Set(i);n.has(s)?n.delete(s):n.add(s),t({selectedFeatures:n})},clearSelection:()=>t({selectedFeatures:new Set}),isHovered:s=>e().hoveredFeature===s,isSelected:s=>e().selectedFeatures.has(s),setRotation:s=>{t({rotation:s,sin:Math.sin(s),cos:Math.cos(s),revRotation:-s,revSin:Math.sin(-s),revCos:Math.cos(-s)})},setZoom:s=>{t({zoom:s,invZoom:1/s})},getScreenAlignedTransform(s,i,n=!0){const r=this.revSin,o=this.revCos,a=s*o-i*r,l=s*r+i*o,d=n?1:this.invZoom;return`matrix(${d}, 0, 0, ${d}, ${a}, ${l})`},getRotationTransform(s,i){const n=this.revSin,r=this.revCos,o=s*r-i*n,a=s*n+i*r;return`matrix(${r}, ${n}, ${-n}, ${r}, ${-o}, ${-a})`},getRotatedBBox(s,i,n,r){return vU(s,i,n-s,r-i,this.sin,this.cos,s,i,rG)}}),{limit:50,partialize:t=>({features:t.features}),equality:(t,e)=>JSON.stringify(t)===JSON.stringify(e),handleSet:t=>e=>{e.isDragging||t(e)}}))),{undo:gG,redo:mG,clear:fG}=Ng.temporal.getState(),oG={magnetColor:"#3e8",detectMargin:2,magnetHandleRadius:5,magnetRadius:10,textPlaceholder:"Type here",arrowHandleSize:3.5,textHandleSize:3.5,minArrowHeight:20,maxArrowHeight:30};class yE extends KB{ogma;options;store=Ng;renderers={};interactions;editor;links;index=new xU(this.store);constructor(e,s={}){super(),this.options=this.setOptions({...oG,...s}),this.ogma=e,this.links=new SU(this.ogma,this.store),this.interactions=new uU(this.ogma,this.store,this.index,this.links,this.options.detectMargin),this.editor=new hU(this.ogma,this.store,this.index,this.links,this.interactions),this.initializeRenderers(),this.setupEvents()}initializeRenderers(){this.renderers.shapes=new zU(this.ogma,this.store),this.renderers.handles=new wU(this.ogma,this.store)}setupEvents(){this.ogma.events.on("rotate",this.onRotate).on("zoom",this.onZoom),this.store.temporal.subscribe(e=>{this.emit(JB,{canUndo:e.pastStates.length>0,canRedo:e.futureStates.length>0})}),this.store.subscribe(e=>e.selectedFeatures,e=>this.emit(QB,{ids:Array.from(e)}))}onRotate=()=>this.store.getState().setRotation(this.ogma.view.getAngle());onZoom=()=>this.store.getState().setZoom(this.ogma.view.getZoom());setOptions(e={}){return this.options={...this.options||{},...e},this.options}add(e){if(j_(e))for(const s of e.features)this.add(s);else this.store.getState().addFeature(e);return this}remove(e){if(j_(e))for(const s of e.features)this.remove(s);else this.store.getState().removeFeature(e.id);return this}undo(){return this.canUndo()?(this.store.temporal.getState().undo(),!0):!1}redo(){return this.canRedo()?(this.store.temporal.getState().redo(),!0):!1}canUndo(){return this.store.temporal.getState().pastStates.length>0}canRedo(){return this.store.temporal.getState().futureStates.length>0}clearHistory(){this.store.temporal.getState().clear()}getAnnotations(){const e=this.store.getState().features;return{type:"FeatureCollection",features:Object.values(e)}}cancelDrawing(){}startComment(e,s,i){}startBox(e,s,i){}startArrow(e,s,i){}startText(e,s,i){}getSelectedAnnotations(){const e=this.store.getState();return{type:"FeatureCollection",features:Array.from(e.selectedFeatures).map(s=>e.features[s])}}destroy(){this.ogma.events.off(this.onRotate).off(this.onZoom),this.links.destroy(),Object.values(this.renderers).forEach(e=>e.destroy()),this.interactions.destroy(),this.editor.destroy()}updateStyle(e,s){}}const ze=new $A({container:"app"});window.ogma=ze;const ve=new yE(ze);ze.styles.addRule({nodeAttributes:{color:"#5B97F8"},edgeAttributes:{color:"#c9c9c9"}});const aG=await fetch("annotations-test.json").then(t=>t.json()),Mg=await ze.generate.flower({depth:3}),hy=Mg.nodes.reduce((t,e,s)=>(t[e.id]=e,e.id=`n${s}`,t),{});Mg.edges.forEach(t=>{t.source=hy[t.source].id,t.target=hy[t.target].id});await ze.setGraph(Mg);await ze.layouts.force({locate:!0});ve.add(aG);ve.clearHistory();const pl=document.getElementById("add-arrow");pl.addEventListener("click",()=>{pl.disabled||(pl.disabled=!0,ze.events.once("mousedown",t=>{const{x:e,y:s}=ze.view.screenToGraphCoordinates(t),i=QA(e,s,e,s,{strokeType:"plain",strokeColor:"#3A03CF",strokeWidth:2,head:"arrow"});ve.startArrow(e,s,i),ve.once(vg,n=>{n.id===i.id&&(pl.disabled=!1)})}))});const bn=document.getElementById("add-text");bn.addEventListener("click",()=>{bn.disabled||(bn.disabled=!0,ze.events.once("mousedown",t=>{const{x:e,y:s}=ze.view.screenToGraphCoordinates(t),i=Eg(e,s,0,0,void 0,{font:"IBM Plex Sans",fontSize:24,color:"#3A03CF",background:"#EDE6FF",borderRadius:8,padding:12});ve.startText(e,s,i),ve.once(vg,n=>{n.id===i.id&&(bn.disabled=!1)})}))});document.getElementById("add-box").addEventListener("click",()=>{bn.disabled||(bn.disabled=!0,ze.events.once("mousedown",t=>{const{x:e,y:s}=ze.view.screenToGraphCoordinates(t),i=JA(e,s,0,0,{background:"#EDE6FF",borderRadius:8,padding:12});ve.startBox(e,s,i),ve.once(vg,n=>{n.id===i.id&&(bn.disabled=!1)})}))});document.addEventListener("keydown",t=>{t.key==="Escape"&&ve.cancelDrawing()});ve.on("cancelDrawing",()=>{console.log("cancelDrawing")});document.querySelector("#add-comment").addEventListener("click",()=>{ve.cancelDrawing(),ze.events.once("click",t=>{const{x:e,y:s}=ze.view.screenToGraphCoordinates(t),i=ve.startComment(t.x,t.y,Eg(t.x,t.y,200,100,"This is a comment",{color:"#3A03CF",background:"#EDE6FF",fontSize:16,font:"IBM Plex Sans"}));console.log("Comment added:",i)})});document.getElementById("undo").addEventListener("click",()=>{ve.undo()});document.getElementById("redo").addEventListener("click",()=>{ve.redo()});ve.on("history",xE);xE();ve.on("select",t=>{const e=document.getElementById("delete");e.disabled=t.ids.length===0});document.getElementById("delete").addEventListener("click",()=>{ve.remove(ve.getSelectedAnnotations())});function xE(){document.getElementById("undo").disabled=!ve.canUndo(),document.getElementById("redo").disabled=!ve.canRedo()}async function bE(){const t=ze.view.getGraphBoundingBox();await ze.view.moveToBounds(t.extend(sE(ve.getAnnotations())),{duration:200})}document.getElementById("center-view").addEventListener("click",async()=>{await bE()});document.getElementById("export").addEventListener("click",()=>{const t=ve.getAnnotations(),e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2)),s=document.createElement("a");document.body.appendChild(s),s.setAttribute("href",e),s.setAttribute("download","annotations.json"),s.click(),s.remove(),console.log("Exported annotations:",t)});document.getElementById("rotate-cw").addEventListener("click",async()=>{await ze.view.rotate(-Math.PI/8,{duration:200})});document.getElementById("rotate-ccw").addEventListener("click",async()=>{await ze.view.rotate(Math.PI/8,{duration:200})});document.addEventListener("keyup",t=>{switch(t.key){case"1":console.log("draw arrow keyup",t);break;case"0":bE();break}});const lG=sE(ve.getAnnotations());await ze.view.moveToBounds(lG,{duration:0});Object.assign(window,{Ogma:$A,Control:yE,createArrow:QA,createText:Eg,createBox:JA,control:ve});
