(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();var Pv=Object.create,Iu=Object.defineProperty,Rv=Object.getOwnPropertyDescriptor,Q_=Object.getOwnPropertyNames,Fv=Object.getPrototypeOf,Dv=Object.prototype.hasOwnProperty,J_=(t,e)=>function(){return e||(0,t[Q_(t)[0]])((e={exports:{}}).exports,e),e.exports},So=(t,e)=>{for(var s in e)Iu(t,s,{get:e[s],enumerable:!0})},Ov=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Q_(e))Dv.call(t,n)||n===s||Iu(t,n,{get:()=>e[n],enumerable:!(i=Rv(e,n))||i.enumerable});return t},Cu=(t,e,s)=>(s=t!=null?Pv(Fv(t)):{},Ov(t&&t.__esModule?s:Iu(s,"default",{value:t,enumerable:!0}),t)),tp=J_({"node_modules/@linkurious/ogma-parsers/dist/ogma-parsers.umd.js"(t,e){var s,i;s=t,i=function(n){/**
* Ogma Parsers
* @description Parsers for Ogma
* @version 0.0.24 (built on Mon Feb 03 2025 16:36:16 GMT+0000 (Coordinated Universal Time))
* @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
* @license (c) Linkurious 2025. All rights reserved.
* @preserve
*/function r(X,Q,gt){gt=gt||Q,Q in X&&(X.attributes[gt]=X[Q])}function o(X,Q,gt){if(X&&typeof X=="object"){if(Array.isArray(X))return X.forEach(lt=>o(lt,Q,gt));if(function(st){return st.type==="vertex"||st._type==="vertex"||st.inE||st.outE||st._inE||st._outE}(X)){const lt={};X.properties&&Object.keys(X.properties).forEach(ot=>{lt[ot]=X.properties[ot][0].value});const st=l(X);Q.push({id:st,data:{id:X.id+"",categories:[X.label],properties:lt}});for(const ot in X)ot!=="properties"&&o(X[ot],Q,gt);return}if(function(st){return st.type==="edge"||st._type==="edge"||st.inV||st.outV||st._outV||st._inV}(X)){const lt=l(X);gt.push({id:lt,source:a(X,["inV","_inV"]),target:a(X,["outV","_outV"]),data:{id:lt,type:X.label,properties:X.properties||{}}});for(const st in X)st!=="properties"&&o(X[st],Q,gt);return}Object.keys(X).forEach(lt=>o(X[lt],Q,gt))}}function a(X,Q){for(const gt of Q)if(X[gt])return l(X[gt])}function l(X){if(typeof X=="string"||isFinite(X))return String(X);const Q=X;return String(Q.id||Q._id)}const d=X=>X.charCodeAt(0),h=d(" "),u=d("<"),c=d(">"),g=d('"'),f=d(`
`),m=d("\r"),_=d("/"),p=d("\\"),x=d("a"),y=d("z"),b=d("A"),v=d("Z"),E=d("0"),A=d("9"),S=d(":");function w(X,Q,gt,lt){const st=lt.length;if(gt-Q!==st)return!1;for(let ot=0;ot<st;++ot)if(X[Q+ot]!==lt[ot])return!1;return!0}function L(X,Q,gt,lt){return T(X.tags,Q,gt,lt)}function T(X,Q,gt,lt){const st=X.length;for(let ot=0;ot<st;++ot)if(w(Q,gt,lt,X[ot]))return ot;return X.push(Q.slice(gt,lt)),st}function F(X,Q,gt){let lt=G(Q,gt),st=Q[lt];if(st===c||st===_)return lt;let ot=lt;lt=j(Q,lt);const rt=function(Nt,Rt,Pt,Vt){return T(Nt.attributes,Rt,Pt,Vt)}(X,Q,ot,lt);for(;Q[lt]!==g;)++lt;for(++lt,ot=lt;(st=Q[lt])!==g;)st===p&&++lt,++lt;return X.tokens.push(-3,rt,ot,lt),lt+1}function V(X){return X===h||X===f||X===m}function G(X,Q){for(;V(X[Q]);)++Q;return Q}function O(X){return X>=x&&X<=y||X>=b&&X<=v||X===S||X>=E&&X<=A}function j(X,Q){for(;O(X[Q]);)++Q;return Q}function W(X,Q){const gt=Object.keys(Q);let lt;if(gt.length>0){lt={};for(let st=0;st<gt.length;++st){const ot=Q[gt[st]],rt=ot.title;lt[rt]=ot.default!==void 0?JSON.stringify(ot.default):void 0}}return X?()=>({id:void 0,attributes:{text:void 0,color:void 0,radius:void 0,x:void 0,y:void 0},data:lt}):()=>({id:void 0,source:void 0,target:void 0,attributes:{color:void 0,text:void 0,width:void 0},data:lt})}function et(X){return X.indexOf("\\")===-1||(X=X.replace(/\\"/g,'"')),X}function at(X,Q){let gt=0;for(let lt=0;lt<20;++lt){const st=gt+X[lt]+Q[lt];gt=+(st>=10),X[lt]=st%10}}const mt=new class{constructor(){this._decimalPowerOfTwo=new Uint8Array(20),this._binaryNumber=new Uint8Array(64),this._decimalNumber=new Uint8Array(20)}int64ToString({low:Q,high:gt}){if(Q===0&&gt===0)return"0";(function(ft,Nt,Rt){for(let Pt=0;Pt<32;++Pt)Rt[Pt]=+!!(ft&1<<Pt);for(let Pt=0;Pt<32;++Pt)Rt[Pt+32]=+!!(Nt&1<<Pt);return Rt})(Q,gt,this._binaryNumber),this._decimalNumber.fill(0),this._decimalPowerOfTwo.fill(0),this._decimalPowerOfTwo[0]=1;const lt=this._binaryNumber[63]===1;lt&&function(ft){for(let Nt=0;Nt<64;++Nt)ft[Nt]^=1;for(let Nt=0;Nt<64&&!(ft[Nt]^=1);++Nt);}(this._binaryNumber);for(let rt=0;rt<64;++rt)this._binaryNumber[rt]&&at(this._decimalNumber,this._decimalPowerOfTwo),at(this._decimalPowerOfTwo,this._decimalPowerOfTwo);const st=[];let ot=this._decimalNumber.length-1;for(lt&&st.push("-");!this._decimalNumber[ot];)ot-=1;for(let rt=ot;rt>=0;--rt)st.push(String(this._decimalNumber[rt]));return st.join("")}};function vt(X){return mt.int64ToString(X)}function wt(X){return typeof X=="object"&&"high"in X&&"low"in X}function Et(X,Q,gt,lt){if(Q)if(Array.isArray(Q))Q.forEach(st=>Et(X,st,gt,lt));else if((st=>"segments"in st)(Q))(function(ot,rt,ft,Nt){rt.segments.forEach(Rt=>{Et(ot,Rt.start,ft,Nt),Et(ot,Rt.end,ft,Nt),Et(ot,Rt.relationship,ft,Nt)})})(X,Q,gt,lt);else if(function(ot){if(typeof ot!="object"||ot===null)throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. Please make sure that your Cypher query returns nodes and edges, not values.");const rt=Object.keys(ot.properties);for(const ft of rt){const Nt=ot.properties[ft];wt(Nt)&&(ot.properties[ft]=vt(Nt))}if(ot.identity!==void 0){if(wt(ot.identity)&&(ot.identity=vt(ot.identity)),function(Nt){return"start"in Nt&&"end"in Nt}(ot)){const ft=ot.start.identity||ot.start,Nt=ot.end.identity||ot.end;wt(ft)&&(ot.start=vt(ft)),wt(Nt)&&(ot.end=vt(Nt))}}else ot.id&&(ot.identity=ot.id)}(Q),(st=>"start"in st&&"end"in st&&"type"in st)(Q))lt.has(Q.identity)||(lt.add(Q.identity),X.edges.push({id:Q.identity,source:Q.start,target:Q.end,data:{neo4jType:Q.type,neo4jProperties:Q.properties}}));else{const st=Q;gt.has(st.identity)||(gt.add(st.identity),X.nodes.push({id:st.identity,attributes:{},data:{neo4jLabels:st.labels,neo4jProperties:st.properties}}))}}const yt={boolean:X=>X.toLowerCase()==="true",int:parseFloat,long:parseFloat,float:parseFloat,double:parseFloat,string:X=>X};function St(X,Q,gt){const lt=X.getElementsByTagName("data"),st={};for(let ot=0;ot<lt.length;ot++){const rt=lt[ot],ft=rt.getAttribute("key");if(ft===null)continue;const Nt=Q[ft];typeof Nt>"u"?st[ft]=rt.textContent:rt.textContent&&rt.textContent.length!==0&&(st[Nt.name]=Nt.parse(rt.textContent))}for(const ot in gt)ot in st||(st[ot]=gt[ot]);return st}function zt(X){return X.color?X.color:X.r&&X.g&&X.b?`rgb(${X.r}, ${X.g}, ${X.b})`:void 0}const Zt=new Set(["x","y","size","color","r","g","b","label"]);function Kt(X){const Q={};for(const gt in X)Zt.has(gt)||X[gt]===void 0||(Q[gt]=X[gt]);return Q}n.gexf=function(Q){if(Q.indexOf("<gexf")===-1)throw new Error("not a GEXF file");const gt=function(N){const I=new Int32Array(N.length);for(let P=0,U=N.length;P<U;++P)I[P]=N.charCodeAt(P);return I}(Q),lt=function(N,I){let P,U;const q={tags:[],attributes:[],tokens:[]},k=q.tokens;let B=G(N,I);for(;B<N.length;){let H=N[B];if(H===u){if(B=G(N,++B),N[B]===_)for(k.push(-2);N[++B]!==c;);else{P=B,B=j(N,P);const Z=L(q,N,P,B);for(k.push(-1,Z),H=N[B];H!==c&&H!==_;)B=F(q,N,B),H=N[B];if(H===_)for(k.push(-2);N[++B]!==c;);}B+=1}else{for(P=B;N[++B]!==u;);for(U=B-1;V(N[U]);)--U;k.push(-4,P,U+1)}B=G(N,B)}return q}(gt,Q.indexOf("<gexf ")),st={},ot={};lt.tags.forEach((C,N)=>{const I=String.fromCharCode.apply(null,C);st[I]=N}),lt.attributes.forEach((C,N)=>{const I=String.fromCharCode.apply(null,C);ot[I]=N});const rt=st.attributes,ft=st.attribute,Nt=st.node,Rt=st.edge,Pt=st.default,Vt=st["viz:position"],jt=st["viz:size"],Xt=st["viz:color"],Ft=st.attvalue,oe=ot.class,Gt=ot.id,se=ot.type,le=ot.title,ze=ot.label,Ge=ot.source,$s=ot.target,Ss=ot.x,ns=ot.y,ws=ot.r,Xe=ot.g,gs=ot.b,rs=ot.a,Ve=ot.value,fs=ot.for,hi=ot.weight,Be={float:1,double:1,integer:2,boolean:3,string:4,"list-string":5};let be=0;const ue=lt.tokens,ys=ue.length,Ts=new Array(16);let de=0,Ye=0,we=0,Is=!0;const qe={},Cs={};let xs,te,bs="",M="",R="",z={attributes:{}},D=0,tt=0,_t=0,Tt=1,At="",Mt=!1,Dt=!0,qt=null,Wt=null;const Ut=[],$t=[];let ce=0,fe={};for(;be<ys;){const C=ue[be];if(C===-1)Ye=de,de=ue[be+1],Ts[we]=de,we+=1,de===Nt?(qt||(qt=W(!0,qe)),z=qt(),Dt=!0,fe=qe):de===Rt&&(Wt||(Wt=W(!1,Cs)),z=Wt(),Dt=!1,fe=Cs),be+=2;else if(C===-2){if(bs&&de===ft){fe=Is?qe:Cs;const N=Be[M];let I=xs;I&&(N===1?I=+I:N===2?I=0|+I:N===3?I=I==="true":N===5&&(I=I.split(" ").filter(P=>P))),fe[bs]={title:R||bs,default:I,type:N},bs="",R="",M="",xs=void 0}else if(de===Nt&&we===4)Mt&&z.attributes&&(z.attributes.color=`rgba(${D}, ${tt}, ${_t}, ${Tt})`,D=0,tt=0,_t=0,Tt=1,Mt=!1),z.id||(z.id=++ce),Ut.push(z);else if(de===Rt&&we===4)z.id||(z.id=++ce),$t.push(z);else if(de===Ft&&we===6&&At){const N=(Dt?qe:Cs)[At];if(N){if(te===void 0)te=N.default;else{const I=N.type;I&&(I===1?te=+te:I===2?te=0|+te:I===3?te=te==="true":I===5?te=te.split(" ").filter(P=>P).map(P=>et(P)):typeof gt=="string"&&(te=et(te)))}z.data[fe[At].title]=te}At="",te=null}we-=1,de=Ye,Ye=Ts[we-2],be+=1}else if(C===-3){const N=ue[be+1],I=Q.substring(ue[be+2],ue[be+3]);if(de===rt)N===oe&&(Is=I!=="edge"&&I!=="edges");else if(de===ft)N===Gt?bs=I:N===se?M=I:N===le&&(R=I);else if(de!==Nt&&de!==Rt||we!==4)if(de===Vt&&we===5){if(N===Ss)z.attributes.x=parseFloat(I);else if(N===ns){const P=parseFloat(I);z.attributes.y=P===0?P:-P}}else de===Xt&&we===5?(Mt=!0,N===ws?D=parseInt(I):N===Xe?tt=parseInt(I):N===gs?_t=parseInt(I):N===rs&&(Tt=parseFloat(I))):de===jt&&we===5?N===Ve&&(Dt?z.attributes.radius=+I:z.attributes.width=+I):de===Ft&&we===6&&(N===fs||N===Gt?At=I:N===Ve&&(te=I));else N===Gt?z.id=I:N===ze?z.attributes.text=I:N===Ge?z.source=I:N===$s?z.target=I:N===hi&&(z.attributes.width=+I);be+=4}else{if(C!==-4)throw new Error(`at index ${be}: token ${C}`);{const N=Q.substring(ue[be+1],ue[be+2]);de===Pt&&(xs=N),be+=3}}}return{nodes:Ut,edges:$t}},n.graphml=function(Q,gt){if(!gt){if(typeof DOMParser>"u")throw new Error("DOMParser is not available. You need to provide a DOMParser instance as second argument, if you are not in the browser environment");gt=new DOMParser}const lt=gt.parseFromString(Q,"application/xml"),st=lt.getElementsByTagName("key"),ot=lt.getElementsByTagName("node"),rt=lt.getElementsByTagName("edge"),{definitions:ft,defaults:Nt}=function(Xt){const Ft={graph:{},node:{},edge:{}},oe={graph:{},node:{},edge:{}};for(let Gt=0;Gt<Xt.length;Gt++){const se=Xt[Gt],le=se.getAttribute("for")||"node",ze=se.getAttribute("id"),Ge=se.getAttribute("attr.name"),$s=se.getAttribute("attr.type")||"string",Ss=se.getElementsByTagName("default"),ns=Ss.length!==0?Ss[0].textContent:void 0;Ft[le][ze]={name:Ge,parse:yt[$s]},typeof ns<"u"&&(oe[le][Ge]=ns)}return{definitions:Ft,defaults:oe}}(st),Rt=[],Pt=new Set;for(let jt=0;jt<ot.length;jt++){const Xt=ot[jt],Ft=Xt.getAttribute("id"),oe=Xt.getAttribute("href")||void 0,Gt=St(Xt,ft.node,Nt.node);Pt.add(Ft);const se={id:Ft,attributes:{x:Gt.x,y:Gt.y,radius:Gt.size,color:zt(Gt),text:Gt.label},data:Kt(Gt)};Gt.x!==void 0&&(se.attributes.x=Gt.x),Gt.y!==void 0&&(se.attributes.y=Gt.y),Gt.size!==void 0&&(se.attributes.radius=Gt.size),Gt.label!==void 0&&(se.attributes.text=Gt.label);const le=zt(Gt);le!==void 0&&(se.attributes.color=le),oe!==void 0&&(se.data.href=oe),Rt.push(se)}const Vt=[];for(let jt=0;jt<rt.length;jt++){const Xt=rt[jt],Ft=Xt.getAttribute("id")||jt,oe=Xt.getAttribute("source"),Gt=Xt.getAttribute("target"),se=Xt.getAttribute("xlink:href")||void 0;if(!Pt.has(oe)||!Pt.has(Gt))throw new Error(`Invalid edge: ${oe} -> ${Gt}`);const le=St(Xt,ft.edge,Nt.edge),ze={id:Ft,source:oe,target:Gt,attributes:{},data:Kt(le)},Ge=zt(le);Ge!==void 0&&(ze.attributes.color=Ge),se!==void 0&&(ze.data.href=se),Vt.push(ze)}return{nodes:Rt,edges:Vt}},n.janus=function(Q){const gt=[],lt=[];return o(typeof Q=="string"?JSON.parse(Q):Q,gt,lt),{nodes:gt,edges:lt}},n.json=function(Q,gt=lt=>lt){const lt=gt(JSON.parse(Q)),st=lt.nodes||[],ot=lt.edges||[];for(let rt=0;rt<st.length;rt++){const ft=st[rt];ft.attributes||(ft.attributes={}),typeof ft.size=="string"&&(ft.size=+ft.size),typeof ft.x=="string"&&(ft.x=+ft.x),typeof ft.y=="string"&&(ft.y=+ft.y),r(ft,"x"),r(ft,"y"),r(ft,"size","radius"),r(ft,"color"),r(ft,"text")}for(let rt=0;rt<ot.length;rt++){const ft=ot[rt];ft.attributes||(ft.attributes={}),typeof ft.size=="string"&&(ft.size=+ft.size),r(ft,"size","width"),r(ft,"color"),r(ft,"text")}return{nodes:st,edges:ot}},n.mtx=X=>{const Q=X.split(`
`).filter(st=>!st.startsWith("%")),[gt]=Q[0].split(" ").map(Number),lt=Q.slice(1).map(st=>st.split(" ").slice(0,2).map(Number)).filter(st=>st.length===2);return{nodes:Array.from({length:Number(gt)},(st,ot)=>({id:ot})),edges:lt.map(([st,ot])=>({source:st%gt,target:ot%gt}))}},n.neo4j=function(Q){let gt=typeof Q=="string"?JSON.parse(Q):Q;const lt={nodes:[],edges:[]},st=new Set,ot=new Set;return(rt=>"queryKeys"in rt&&"values"in rt)(gt)&&(gt=function(ft){const Nt=[];return ft.values.forEach(Rt=>{const{nodes:Pt=[],relationships:Vt=[],segments:jt=[]}=Rt.adapted,Xt=[{segments:jt,properties:{}}];Nt.push({_fields:[...Pt,...Vt,...Xt]})}),{records:Nt}}(gt)),gt.records.forEach(({_fields:rt})=>rt.forEach(ft=>Et(lt,ft,st,ot))),lt},Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})},typeof t=="object"&&typeof e<"u"?i(t):typeof define=="function"&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaParsers={})}}),kv=J_({"node_modules/@linkurious/ogma-generators/dist/ogma-generators.umd.js"(t,e){var s,i;s=t,i=function(n){/**
* Ogma Generators
* @description Graphs Generators for Ogma
* @version 0.0.13 (built on Tue Nov 14 2023 10:49:46 GMT+0000 (Coordinated Universal Time))
* @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
* @license (c) Linkurious 2023. All rights reserved.
* @preserve
*/const r=Object.freeze(Object.defineProperty({__proto__:null,configure:({nodes:p=10,edges:x=10,texts:y=!1,scale:b=100}={})=>({nodes:p,edges:x,texts:y,scale:b}),generate:function({nodes:x,scale:y,texts:b,edges:v}){const E=[],A=[];for(let S=0;S<x;S++)E.push({id:S,attributes:{x:Math.random()*y,y:Math.random()*y,text:b?`Node ${S}`:void 0}});for(let S=0;S<v;S++)A.push({id:S,source:Math.random()*x|0,target:Math.random()*x|0,attributes:{text:b?`Edge ${S}`:void 0}});return{nodes:E,edges:A}}},Symbol.toStringTag,{value:"Module"})),o=Object.freeze(Object.defineProperty({__proto__:null,configure:({rows:p=4,columns:x=4,columnDistance:y=20,rowDistance:b=20,xmin:v=0,ymin:E=0}={})=>({rows:p,columns:x,columnDistance:y,rowDistance:b,xmin:v,ymin:E}),generate:function({rows:x,columns:y,columnDistance:b,rowDistance:v,xmin:E,ymin:A}){const S={nodes:[],edges:[]};let w=0;for(let L=0;L<x;++L)for(let T=0;T<y;++T){const F=L*y+T;S.nodes.push({id:F,attributes:{x:E+T*b,y:A+L*v}}),T!==y-1&&(S.edges.push({id:w,source:F,target:L*y+T+1}),w++),L!==x-1&&(S.edges.push({id:w,source:F,target:(L+1)*y+T}),w++)}return S}},Symbol.toStringTag,{value:"Module"})),a=Object.freeze(Object.defineProperty({__proto__:null,configure:({length:p=5,scale:x=100}={})=>({length:p,scale:x}),generate:function({length:x,scale:y}){const b={nodes:[],edges:[]};if(x<=0)return b;b.nodes.push({id:0,attributes:{x:Math.random()*y,y:Math.random()*y}});for(let v=1;v<x;++v)b.nodes.push({id:v,attributes:{x:Math.random()*y,y:Math.random()*y}}),b.edges.push({id:v-1,source:v-1,target:v});return b}},Symbol.toStringTag,{value:"Module"}));function l(p){return typeof p=="number"&&isFinite(p)?p:void 0}const d=Object.freeze(Object.defineProperty({__proto__:null,configure:function({children:x=2,height:y=3}={}){if(!function(v){return typeof v=="number"&&isFinite(v)&&v>0?v:void 0}(x))throw new TypeError('Invalid argument: "children" is not a positive number, was '+x);if(!function(v){return typeof v=="number"&&isFinite(v)&&v>=0?v:void 0}(y))throw new TypeError('Invalid argument: "height" is not a positive number, was '+y);return{children:x,height:y}},generate:function({children:x,height:y}){y+=1;const b=Math.pow(x,y),v=[],E=[];let A=1,S=0,w=0;for(let L=0;L<y;++L){const T=b/(A+1)/1.5;for(let F=0;F<A;++F){const V=S++;if(v.push({id:V,attributes:{x:(F+1)*T*10,y:20*L}}),L!==y-1)for(let G=0;G<x;++G)E.push({id:w,source:V,target:V*x+G+1}),w+=1}A*=x}return{nodes:v,edges:E}}},Symbol.toStringTag,{value:"Module"})),h=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:x=20,edges:y,p:b,scale:v=100}={}){if(!l(x)||x<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+x);if(y!==void 0&&b!==void 0)throw new TypeError("Invalid argument: choose between options.edges and options.p");return y===void 0&&b===void 0&&(b=.1),b===void 0&&(b=-1),y===void 0&&(y=-1),{nodes:x,p:b,edges:y,scale:v}},generate:function(x){const y={nodes:[],edges:[]},b=x.nodes,v=x.p,E=x.scale;if(v>=0){let A=0;for(let S=0;S<b;S++){y.nodes.push({id:S,attributes:{x:Math.random()*E,y:Math.random()*E}});for(let w=0;w<S;w++)Math.random()<v&&y.edges.push({id:A++,source:S,target:w})}}else{const A=[],S=x.edges;for(let L=0;L<b;L++){y.nodes.push({id:L,attributes:{x:100*Math.random(),y:100*Math.random()}});for(let T=L+1;T<b;T++)A.push({source:L,target:T})}let w=A.length-1;for(let L=0;L<S;L++){const T=A.splice(Math.floor(Math.random()*w),1)[0];T.id=L,y.edges.push(T),w--}}return y}},Symbol.toStringTag,{value:"Module"})),u=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:x=40,m0:y=5,m:b=1,scale:v=100}={}){if(!l(x)||x<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+x);if(!l(y)||y>=x)throw new TypeError(`Invalid argument: options.m0 is not a number < ${x}, was ${y}`);if(!l(y)||b>=y)throw new TypeError(`Invalid argument: options.m is not a number <= ${y}, was ${b}`);if(!l(v)||v<0)throw new TypeError("Invalid argument: options.scale is not a number or is less than 0");return{nodes:x,m0:y,m:b,scale:v}},generate:function({scale:x,nodes:y,m0:b,m:v}){const E={nodes:[],edges:[]},A={},S=[],w=x/10;let L=0;for(let T=0;T<b;T++)E.nodes.push({id:T,attributes:{x:Math.random()*w,y:Math.random()*w}}),S[T]=0;for(let T=0;T<b;T++)for(let F=T+1;F<b;F++){const V={id:L++,source:T,target:F};A[V.source+"-"+V.target]=V,E.edges.push(V),S[T]++,S[F]++}for(let T=b;T<y;T++){E.nodes.push({id:T,attributes:{x:Math.random()*x,y:Math.random()*x}}),S[T]=0;let F=0;for(let G=0;G<T;G++)F+=S[G];let V=0;for(let G=0;G<v;G++){const O=Math.random();let j=0;for(let W=0;W<T;W++)if(!A[`${T}-${W}`]&&!A[`${W}-${T}`]&&(j=T===1?1:j+S[W]/F+V/(T-G),O<=j)){V+=S[W]/F;const et={id:L++,source:T,target:W};A[`${et.source}-${et.target}`]=et,E.edges.push(et),S[T]++,S[W]++;break}}}return E}},Symbol.toStringTag,{value:"Module"})),c=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:x=50,width:y=100,height:b=100,x:v=0,y:E=0}={}){if(!isFinite(x)||x<1)throw new RangeError("Tree generator: number of nodes must be a positive integer");return{nodes:x,width:y,height:b,x:v,y:E}},generate:function({nodes:x,x:y,y:b,width:v,height:E}){const A=y-v/2,S=b-E/2;return{nodes:new Array(x).fill(0).map((w,L)=>({id:L,attributes:{x:A+Math.random()*v,y:S+Math.random()*E}})),edges:new Array(x-1).fill(0).map((w,L)=>({id:L,source:Math.floor(Math.sqrt(L)),target:L+1}))}}},Symbol.toStringTag,{value:"Module"}));function g(p){return 10*Math.pow(2.7,p)}function f(p){return 5+g(p)/10}function m(p,x,y,b,v){if(y===0)return v;const E=g(y),A=f(y),S=.2*A;let w=-Math.PI;const L=2*Math.PI/x,T=b.attributes.x||0,F=b.attributes.y||0;for(let V=0;V<x;++V){const G={id:v,attributes:{x:T+E*Math.cos(w),y:F+E*Math.sin(w),radius:A}},O={id:v,source:b.id,target:v,attributes:{width:S}};p.nodes.push(G),p.edges.push(O),v=m(p,x,y-1,G,v+1),w+=L}return v}const _=Object.freeze(Object.defineProperty({__proto__:null,configure:function({depth:x=3,breadth:y=3,nodes:b}){return b!==void 0?(y=5,x=Math.ceil(Math.log(b)/Math.log(5))):b=-1,{depth:x,breadth:y,nodes:b}},generate:function({depth:x,breadth:y,nodes:b}){const v={id:0,attributes:{x:0,y:0,radius:f(x+1)}},E={nodes:[v],edges:[]};return m(E,y,x,v,1),b!==void 0&&b>=0&&(E.nodes=E.nodes.slice(0,b),E.edges=E.edges.slice(0,Math.max(b-1,0))),E}},Symbol.toStringTag,{value:"Module"}));n.balancedTree=d,n.barabasiAlbert=u,n.erdosRenyi=h,n.flower=_,n.grid=o,n.path=a,n.random=r,n.randomTree=c,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})},typeof t=="object"&&typeof e<"u"?i(t):typeof define=="function"&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaGenerators={})}}),ge=class{constructor(t){this._ogma=t}};function Dr(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])>e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function zv(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])<e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function He(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function rh(t){return Array.isArray(t)?t:[t]}function ep(t){const e=[];for(let s=0;s<t.length;++s){const i=t[s];if(Array.isArray(i))for(let n=0;n<i.length;++n)e.push(i[n]);else e.push(i)}return e}function Bv(...t){if(t.length===0)return[];const e=t[0].constructor;let s=0;for(const r of t)s+=r.length;const i=new e(s);let n=0;for(const r of t){for(let o=0;o<r.length;o++)i[n+o]=r[o];n+=r.length}return i}function Uv(t,e){const s=t.indexOf(e);return s!==-1&&(t.splice(s,1),!0)}function sp(t,e){let s,i,n=0,r=t.length-1;for(;n<=r;)if(s=(n+r)/2|0,i=t[s],i<e)n=s+1;else{if(!(i>e))return s;r=s-1}return-1}var oo=(t,e)=>{const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=e[t[i]];return s};function Gv(t){return typeof t=="number"&&t%1==0}function oh(t){return Array.isArray(t)?t.join("."):t}function Sn(t){if(!t)return[];if(typeof t=="string")return t.split(".");if(Array.isArray(t)){for(let e=0;e<t.length;++e)if(typeof t[e]!="string")throw new TypeError(`${t[e]} is not a string`);return t.slice()}throw new TypeError(`invalid property path "${t}": expected string or array of strings`)}function Fl(t,e,s){let i,n,r;if(e===0)return function(){t.apply(s,arguments)};const o=function(){i=!1,n&&(r.apply(s,n),n=null)};return r=function(){let a;return i?n=arguments:(a=t.apply(s,arguments),setTimeout(o,e),i=!0),a},r}function Vv(t,e,s){let i,n,r,o,a;const l=e===0||e===void 0?100:e;function d(){const u=Date.now()-o;u<l&&u>=0?i=setTimeout(d,l-u):(i=null,s||(a=t.apply(r,n),r=n=null))}const h=function(){r=this,n=arguments,o=Date.now();const u=s&&!i;return i||(i=setTimeout(d,e)),u&&(a=t.apply(r,n),r=n=null),a};return h.clear=function(){i&&(clearTimeout(i),i=null)},h.flush=function(){i&&(a=t.apply(r,n),r=n=null,clearTimeout(i),i=null)},h}function ip(t,e,s,i,n){s(t[e],e,t,i,n).then(r=>{e===t.length-1?i(r):ip(t,e+1,s,i,n)}).catch(n)}function qv(t,e){return new Promise((s,i)=>ip(t,0,e,s,i))}function Dl(){return new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120}function np(t){return t.reduce((e,s)=>e.then(s),Promise.resolve())}function ah(t,e,s,i,n,r,o,a){return t+n+256*(e+r)+65536*(s+o)+16777216*(i+a)}function jv(t,e){return t<e?t*e+Math.pow(e-t-1,2)/4:t*e+Math.pow(t-e-1,2)/4}function wn(t){return!(t===null||typeof t!="object"||He(t)||t instanceof RegExp||typeof HTMLElement<"u"&&t instanceof HTMLElement)}function Zr(t){const e=Object.keys(t),s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=t[e[i]];return s}function ri(t,e,s){if(Array.isArray(t))return t.forEach(e,s);if(!wn(t))throw new Error("forEach: invalid argument "+JSON.stringify(t));const i=Object.keys(t);if(s!==void 0)for(let n=0;n<i.length;++n){const r=i[n];e.call(s,t[r],r)}else for(let n=0;n<i.length;++n){const r=i[n];e(t[r],r)}}function Ae(t){if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;++n)i[n]=Ae(t[n]);return i}if(!Ce(t))return t;const e={},s=Object.keys(t);for(const i of s)e[i]=Ae(t[i]);return e}function Hv(t,e){e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)})}function vi(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function ve(t,e){const s=Sn(e);if(!s.length)return t;if(t){for(let i=0;i<s.length-1;++i){const n=t[s[i]];if(!n)return;t=n}return t[s[s.length-1]]}}function ao(t,e,s="."){e||(e=r=>!wn(r));const i={},n=Object.keys(t);for(let r=0;r<n.length;++r){const o=n[r],a=t[o];if(e(a))i[o]=a;else{const l=ao(a,e),d=Object.keys(l);for(let h=0;h<d.length;h++){const u=d[h];i[`${o}${s}${u}`]=l[u]}}}return i}function lh(t){const e={},s=Object.keys(t);for(let i=0;i<s.length;++i){const n=s[i];vi(e,n,t[n])}return e}function Tn(t,e,s=[]){const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=t[r],a=e?e+r:r;Ce(o)?Tn(o,a+".",s):s.push(a)}return s}var rp=Object.prototype.hasOwnProperty;function op(t,e){const s=[t];let i;for(;s.length>0;)if(i=s.pop(),i)if(Ce(i))for(const n in i)rp.call(i,n)&&s.push(i[n]);else e(i)}function Wv(t){const e={};return op(t,s=>e[s.getName()]=s),e}function Ol(t,e=[]){if(Ce(t)){const s=Object.keys(t);for(const i of s)Ol(t[i],e)}else e.push(t);return e}function kl(t){for(const e in t)typeof t[e]=="function"&&delete t[e];return t}function As(t,e){if(t===void 0)return Ae(e);if(!wn(t))return t;const s={},i=Object.keys(e);for(const n of i){const r=e[n],o=t[n];wn(r)?s[n]=As(o,r):s[n]=o===void 0?Ae(r):o}return s}function Ce(t){return t&&(t.constructor===Object||!t.constructor)}function Qa(t,e){if(!Ce(e)||!Ce(t))return e;const s=Object.assign({},t),i=Object.keys(e);for(const n of i)s[n]=Qa(s[n],e[n]);return s}function dh(t,e){return e==null?t:e.reduce((s,i)=>(s[i]=t[i],s),{})}var Vn=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)rp.call(i,n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):Ce(e[n])&&Ce(i[n])?e[n]=Vn(e[n],i[n]):e[n]=i[n])}return e},Xv=typeof global=="object"&&global!==null&&global.it!==void 0,Ti=typeof document<"u",$i=typeof window<"u",zl=$i&&!window.__OGMA_HEADLESS,Bl=zl&&Ti,Yv=typeof navigator<"u"&&navigator.userAgent!==void 0?navigator.userAgent.toLowerCase():"",$v=$i&&/mac/.test(Yv),ap=typeof performance<"u"&&performance.now?()=>0|performance.now():()=>Date.now(),Zv=ap();function ts(){return ap()-Zv}function lp(){const t=new Date,e=t.getDate(),s=t.getMonth()+1;return`${t.getFullYear()}-${s<10?"0"+s:s}-${e<10?"0"+e:e}`}function dp(){const t=new Date;return`[${Uo((t.getUTCHours()-(t.getTimezoneOffset()/60|0))%24)}:${Uo(t.getUTCMinutes())}:${Uo(t.getUTCSeconds())}:${Uo(t.getUTCMilliseconds(),3)}]`}function Uo(t,e=2){let s=Math.pow(10,e-1),i=String(t);for(;s>1;)t<s&&(i="0"+i),s/=10;return i}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var wo={};function Ul(t){if(t!==wo)throw new Error("Bad secret")}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Kv(t,e){if(!Jv(t)||e+1!==t.length)throw new TypeError(`
    ############################## ERROR ##############################

    It looks like you are trying to call a template tag function (fn\`...\`)
    using the normal function syntax (fn(...)), which is not supported.

    The functions in the safevalues library are not designed to be called
    like normal functions, and doing so invalidates the security guarantees
    that safevalues provides.

    If you are stuck and not sure how to proceed, please reach out to us
    instead through:
     - https://github.com/google/safevalues/issues

    ############################## ERROR ##############################`)}function Or(t){return Object.isFrozen(t)&&Object.isFrozen(t.raw)}function Go(t){return t.toString().indexOf("`")===-1}var Zc=Go(t=>t``)||Go(t=>t`\0`)||Go(t=>t`\n`)||Go(t=>t`\u0000`),Qv=Or``&&Or`\0`&&Or`\n`&&Or`\u0000`;function Jv(t){return!(!Array.isArray(t)||!Array.isArray(t.raw))&&t.length===t.raw.length&&!(!Zc&&t===t.raw)&&!!(Zc&&!Qv||Or(t))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var hd,tE="google#safe",eE=tE,sE=globalThis.trustedTypes,Kc=sE;function iE(){let t=null;if(!Kc)return t;try{const e=s=>s;t=Kc.createPolicy(eE,{createHTML:e,createScript:e,createScriptURL:e})}catch(e){throw e}return t}function Lu(){return hd===void 0&&(hd=iE()),hd}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vo(t){return{valueOf:t}.valueOf()}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var hp=class{constructor(t,e){Ul(t),this.privateDoNotAccessOrElseWrappedHtml=e}toString(){return this.privateDoNotAccessOrElseWrappedHtml+""}},nE=hp;function rE(t){return new nE(wo,t)}function up(t){const e=t,s=Lu();return rE(s?s.createHTML(e):e)}function oE(t){return t instanceof hp}function Nu(t){if(oE(t))return t.privateDoNotAccessOrElseWrappedHtml;{let e="";throw e="Unexpected type when unwrapping SafeHtml",new Error(e)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var cp=class{constructor(t,e){Ul(t),this.privateDoNotAccessOrElseWrappedResourceUrl=e}toString(){return this.privateDoNotAccessOrElseWrappedResourceUrl+""}},aE=cp;function lE(t){return new aE(wo,t)}function dE(t){const e=t,s=Lu();return lE(s?s.createScriptURL(e):e)}function hE(t){return t instanceof cp}function _r(t){if(hE(t))return t.privateDoNotAccessOrElseWrappedResourceUrl;{let e="";throw e="Unexpected type when unwrapping TrustedResourceUrl",new Error(e)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ja,Qc,gp=class{constructor(t,e){Ul(t),this.privateDoNotAccessOrElseWrappedScript=e}toString(){return this.privateDoNotAccessOrElseWrappedScript+""}},uE=gp;function cE(t){return new uE(wo,t)}function Mu(t){const e=t,s=Lu();return cE(s?s.createScript(e):e)}function gE(t){return t instanceof gp}function fp(t){if(gE(t))return t.privateDoNotAccessOrElseWrappedScript;{let e="";throw e="Unexpected type when unwrapping SafeScript",new Error(e)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fE(t,e){e.appendChild(t);let s=new XMLSerializer().serializeToString(e);return s=s.slice(s.indexOf(">")+1,s.lastIndexOf("</")),up(s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Jc(t){try{return new URL(t,window.document.baseURI)}catch{return new URL("about:invalid")}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mE(t){let e;try{e=new URL(t)}catch{return"https:"}return e.protocol}(function(t){t[t.STYLE_ELEMENT=0]="STYLE_ELEMENT",t[t.STYLE_ATTRIBUTE=1]="STYLE_ATTRIBUTE",t[t.HTML_ATTRIBUTE=2]="HTML_ATTRIBUTE"})(Ja||(Ja={})),function(t){t[t.AT_KEYWORD=0]="AT_KEYWORD",t[t.CDC=1]="CDC",t[t.CDO=2]="CDO",t[t.CLOSE_CURLY=3]="CLOSE_CURLY",t[t.CLOSE_PAREN=4]="CLOSE_PAREN",t[t.CLOSE_SQUARE=5]="CLOSE_SQUARE",t[t.COLON=6]="COLON",t[t.COMMA=7]="COMMA",t[t.DELIM=8]="DELIM",t[t.DIMENSION=9]="DIMENSION",t[t.EOF=10]="EOF",t[t.FUNCTION=11]="FUNCTION",t[t.HASH=12]="HASH",t[t.IDENT=13]="IDENT",t[t.NUMBER=14]="NUMBER",t[t.OPEN_CURLY=15]="OPEN_CURLY",t[t.OPEN_PAREN=16]="OPEN_PAREN",t[t.OPEN_SQUARE=17]="OPEN_SQUARE",t[t.PERCENTAGE=18]="PERCENTAGE",t[t.SEMICOLON=19]="SEMICOLON",t[t.STRING=20]="STRING",t[t.WHITESPACE=21]="WHITESPACE"}(Qc||(Qc={}));var _E=["data:","http:","https:","mailto:","ftp:"],pE=/^\s*(?!javascript:)(?:[\w+.-]+:|[^:/?#]*(?:[/?#]|$))/i;function yE(t){const e=!pE.test(t);return e&&console.error(`A URL with content '${t}' was sanitized away.`),e}function xE(t){if(!yE(t))return t}function To(t){return xE(t)}function bE(t){const e=mE(t);return e!==void 0&&_E.indexOf(e.toLowerCase())!==-1?t:"about:invalid#zClosurez"}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var vE="display:inline-block;clip-path:inset(0);overflow:hidden;vertical-align:top;text-decoration:inherit",EE=`:host{${vE}}`;/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function AE(t,e){return t.createContextualFragment(Nu(e))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function SE(t,e){if(e.defaultView)throw new Error("createInertFragment called with non-inert document");const s=e.createRange();return s.selectNode(e.body),AE(s,up(t))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function tg(t){const e=t.nodeName;return typeof e=="string"?e:"FORM"}function eg(t){return t.nodeType===3}function sg(t){const e=t.nodeType;return e===1||typeof e!="number"}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var he,ti=class{constructor(t,e,s,i,n){this.allowedElements=t,this.elementPolicies=e,this.allowedGlobalAttributes=s,this.globalAttributePolicies=i,this.globallyAllowedAttributePrefixes=n}isAllowedElement(t){return t!=="FORM"&&(this.allowedElements.has(t)||this.elementPolicies.has(t))}getAttributePolicy(t,e){const s=this.elementPolicies.get(e);return s?.has(t)?s.get(t):this.allowedGlobalAttributes.has(t)?{policyAction:he.KEEP}:this.globalAttributePolicies.get(t)||(this.globallyAllowedAttributePrefixes&&[...this.globallyAllowedAttributePrefixes].some(n=>t.indexOf(n)===0)?{policyAction:he.KEEP}:{policyAction:he.DROP})}};(function(t){t[t.DROP=0]="DROP",t[t.KEEP=1]="KEEP",t[t.KEEP_AND_SANITIZE_URL=2]="KEEP_AND_SANITIZE_URL",t[t.KEEP_AND_NORMALIZE=3]="KEEP_AND_NORMALIZE",t[t.KEEP_AND_SANITIZE_STYLE=4]="KEEP_AND_SANITIZE_STYLE",t[t.KEEP_AND_USE_RESOURCE_URL_POLICY=5]="KEEP_AND_USE_RESOURCE_URL_POLICY",t[t.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET=6]="KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET"})(he||(he={}));var wE=new Set(["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"]);function TE(t){return!wE.has(t.toUpperCase())&&/^[a-z][-_.a-z0-9]*-[-_.a-z0-9]*$/i.test(t)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var IE=["ARTICLE","SECTION","NAV","ASIDE","H1","H2","H3","H4","H5","H6","HEADER","FOOTER","ADDRESS","P","HR","PRE","BLOCKQUOTE","OL","UL","LH","LI","DL","DT","DD","FIGURE","FIGCAPTION","MAIN","DIV","EM","STRONG","SMALL","S","CITE","Q","DFN","ABBR","RUBY","RB","RT","RTC","RP","DATA","TIME","CODE","VAR","SAMP","KBD","SUB","SUP","I","B","U","MARK","BDI","BDO","SPAN","BR","WBR","NOBR","INS","DEL","PICTURE","PARAM","TRACK","MAP","TABLE","CAPTION","COLGROUP","COL","TBODY","THEAD","TFOOT","TR","TD","TH","SELECT","DATALIST","OPTGROUP","OPTION","OUTPUT","PROGRESS","METER","FIELDSET","LEGEND","DETAILS","SUMMARY","MENU","DIALOG","SLOT","CANVAS","FONT","CENTER","ACRONYM","BASEFONT","BIG","DIR","HGROUP","STRIKE","TT"],CE=[["A",new Map([["href",{policyAction:he.KEEP_AND_SANITIZE_URL}]])],["AREA",new Map([["href",{policyAction:he.KEEP_AND_SANITIZE_URL}]])],["LINK",new Map([["href",{policyAction:he.KEEP_AND_USE_RESOURCE_URL_POLICY,conditions:new Map([["rel",new Set(["alternate","author","bookmark","canonical","cite","help","icon","license","next","prefetch","dns-prefetch","prerender","preconnect","preload","prev","search","subresource"])]])}]])],["SOURCE",new Map([["src",{policyAction:he.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:he.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["IMG",new Map([["src",{policyAction:he.KEEP_AND_USE_RESOURCE_URL_POLICY}],["srcset",{policyAction:he.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET}]])],["VIDEO",new Map([["src",{policyAction:he.KEEP_AND_USE_RESOURCE_URL_POLICY}]])],["AUDIO",new Map([["src",{policyAction:he.KEEP_AND_USE_RESOURCE_URL_POLICY}]])]],LE=["title","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-current","aria-disabled","aria-dropeffect","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-live","aria-multiline","aria-multiselectable","aria-orientation","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","alt","align","autocapitalize","autocomplete","autocorrect","autofocus","autoplay","bgcolor","border","cellpadding","cellspacing","checked","cite","color","cols","colspan","controls","controlslist","datetime","disabled","download","draggable","enctype","face","formenctype","frameborder","height","hreflang","hidden","ismap","label","lang","loop","max","maxlength","media","minlength","min","multiple","muted","nonce","open","placeholder","poster","preload","rel","required","reversed","role","rows","rowspan","selected","shape","size","sizes","slot","span","spellcheck","start","step","summary","translate","type","valign","value","width","wrap","itemscope","itemtype","itemid","itemprop","itemref"],NE=[["dir",{policyAction:he.KEEP_AND_NORMALIZE,conditions:Vo(()=>new Map([["dir",new Set(["auto","ltr","rtl"])]]))}],["async",{policyAction:he.KEEP_AND_NORMALIZE,conditions:Vo(()=>new Map([["async",new Set(["async"])]]))}],["loading",{policyAction:he.KEEP_AND_NORMALIZE,conditions:Vo(()=>new Map([["loading",new Set(["eager","lazy"])]]))}],["target",{policyAction:he.KEEP_AND_NORMALIZE,conditions:Vo(()=>new Map([["target",new Set(["_self","_blank"])]]))}]],ME=new ti(new Set(IE),new Map(CE),new Set(LE),new Map(NE),void 0),PE=class{constructor(t,e,s,i,n,r){this.sanitizerTable=t,this.styleElementSanitizer=s,this.styleAttributeSanitizer=i,this.resourceUrlPolicy=n,this.openShadow=r,this.changes=[],Ul(e)}sanitizeAssertUnchanged(t){this.changes=[];const e=this.sanitize(t);if(this.changes.length!==0)throw new Error(`Unexpected change to HTML value as a result of sanitization. Input: "${t}", sanitized output: "${e}"
List of changes:${this.changes.join(`
`)}`);return e}sanitize(t){const e=document.implementation.createHTMLDocument("");return fE(this.sanitizeToFragmentInternal(t,e),e.body)}sanitizeToFragment(t){const e=document.implementation.createHTMLDocument("");return this.styleElementSanitizer&&this.styleAttributeSanitizer?this.sanitizeWithCssToFragment(t,e):this.sanitizeToFragmentInternal(t,e)}sanitizeWithCssToFragment(t,e){const s=document.createElement("safevalues-with-css"),i=this.openShadow?"open":"closed",n=s.attachShadow({mode:i}),r=this.sanitizeToFragmentInternal(t,e),o=document.createElement("style");o.textContent=EE,o.id="safevalues-internal-style",n.appendChild(o),n.appendChild(r);const a=e.createDocumentFragment();return a.appendChild(s),a}sanitizeToFragmentInternal(t,e){const s=SE(t,e),i=document.createTreeWalker(s,5,a=>this.nodeFilter(a));let n=i.nextNode();const r=e.createDocumentFragment();let o=r;for(;n!==null;){let a;if(eg(n))if(this.styleElementSanitizer&&o.nodeName==="STYLE"){const l=this.styleElementSanitizer(n.data);a=this.createTextNode(l)}else a=this.sanitizeTextNode(n);else{if(!sg(n)){let l="";throw l="Node is not of type text or element",new Error(l)}a=this.sanitizeElementNode(n,e)}if(o.appendChild(a),n=i.firstChild(),n)o=a;else for(;!(n=i.nextSibling())&&(n=i.parentNode());)o=o.parentNode}return r}createTextNode(t){return document.createTextNode(t)}sanitizeTextNode(t){return this.createTextNode(t.data)}sanitizeElementNode(t,e){const s=tg(t),i=e.createElement(s),n=t.attributes;for(const{name:r,value:o}of n){const a=this.sanitizerTable.getAttributePolicy(r,s);if(this.satisfiesAllConditions(a.conditions,n))switch(a.policyAction){case he.KEEP:ui(i,r,o);break;case he.KEEP_AND_SANITIZE_URL:const l=bE(o);l!==o&&this.recordChange(`Url in attribute ${r} was modified during sanitization. Original url:"${o}" was sanitized to: "${l}"`),ui(i,r,l);break;case he.KEEP_AND_NORMALIZE:ui(i,r,o.toLowerCase());break;case he.KEEP_AND_SANITIZE_STYLE:this.styleAttributeSanitizer?ui(i,r,this.styleAttributeSanitizer(o)):ui(i,r,o);break;case he.KEEP_AND_USE_RESOURCE_URL_POLICY:if(this.resourceUrlPolicy){const d={type:Ja.HTML_ATTRIBUTE,attributeName:r,elementName:s},h=Jc(o),u=this.resourceUrlPolicy(h,d);u&&ui(i,r,u.toString())}else ui(i,r,o);break;case he.KEEP_AND_USE_RESOURCE_URL_POLICY_FOR_SRCSET:if(this.resourceUrlPolicy){const d={type:Ja.HTML_ATTRIBUTE,attributeName:r,elementName:s},h=RE(o),u={parts:[]};for(const c of h.parts){const g=Jc(c.url),f=this.resourceUrlPolicy(g,d);f&&u.parts.push({url:f.toString(),descriptor:c.descriptor})}ui(i,r,FE(u))}else ui(i,r,o);break;case he.DROP:this.recordChange(`Attribute: ${r} was dropped`);break;default:DE(a.policyAction,"Unhandled AttributePolicyAction case")}else this.recordChange(`Not all conditions satisfied for attribute: ${r}.`)}return i}nodeFilter(t){if(eg(t))return 1;if(!sg(t))return 2;const e=tg(t);return e===null?(this.recordChange(`Node name was null for node: ${t}`),2):this.sanitizerTable.isAllowedElement(e)?1:(this.recordChange(`Element: ${e} was dropped`),2)}recordChange(t){this.changes.push(t)}satisfiesAllConditions(t,e){var s;if(!t)return!0;for(const[i,n]of t){const r=(s=e.getNamedItem(i))===null||s===void 0?void 0:s.value;if(r&&!n.has(r))return!1}return!0}};function ui(t,e,s){t.setAttribute(e,s)}function RE(t){const e=[];for(const s of t.split(",")){const[i,n]=s.trim().split(/\s+/,2);e.push({url:i,descriptor:n})}return{parts:e}}function FE(t){return t.parts.map(e=>{const{url:s,descriptor:i}=e;return`${s}${i?` ${i}`:""}`}).join(" , ")}function DE(t,e=`unexpected value ${t}!`){throw new Error(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var OE=class{constructor(){this.calledBuild=!1,this.sanitizerTable=ME}onlyAllowElements(t){const e=new Set,s=new Map;for(let i of t){if(i=i.toUpperCase(),!this.sanitizerTable.isAllowedElement(i))throw new Error(`Element: ${i}, is not allowed by html5_contract.textpb`);const n=this.sanitizerTable.elementPolicies.get(i);n!==void 0?s.set(i,n):e.add(i)}return this.sanitizerTable=new ti(e,s,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowCustomElement(t,e){const s=new Set(this.sanitizerTable.allowedElements),i=new Map(this.sanitizerTable.elementPolicies);if(!TE(t=t.toUpperCase()))throw new Error(`Element: ${t} is not a custom element`);if(e){const n=new Map;for(const r of e)n.set(r.toLowerCase(),{policyAction:he.KEEP});i.set(t,n)}else s.add(t);return this.sanitizerTable=new ti(s,i,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}onlyAllowAttributes(t){const e=new Set,s=new Map,i=new Map;for(const n of t)this.sanitizerTable.allowedGlobalAttributes.has(n)&&e.add(n),this.sanitizerTable.globalAttributePolicies.has(n)&&s.set(n,this.sanitizerTable.globalAttributePolicies.get(n));for(const[n,r]of this.sanitizerTable.elementPolicies.entries()){const o=new Map;for(const[a,l]of r.entries())t.has(a)&&o.set(a,l);i.set(n,o)}return this.sanitizerTable=new ti(this.sanitizerTable.allowedElements,i,e,s,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowDataAttributes(t){if(t===void 0){const s=new Set(this.sanitizerTable.globallyAllowedAttributePrefixes);return s.add("data-"),this.sanitizerTable=new ti(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,this.sanitizerTable.allowedGlobalAttributes,this.sanitizerTable.globalAttributePolicies,s),this}const e=new Set(this.sanitizerTable.allowedGlobalAttributes);for(const s of t){if(s.indexOf("data-")!==0)throw new Error(`data attribute: ${s} does not begin with the prefix "data-"`);e.add(s)}return this.sanitizerTable=new ti(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,e,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowStyleAttributes(){const t=new Map(this.sanitizerTable.globalAttributePolicies);return t.set("style",{policyAction:he.KEEP_AND_SANITIZE_STYLE}),this.sanitizerTable=new ti(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,this.sanitizerTable.allowedGlobalAttributes,t,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowClassAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("class"),this.sanitizerTable=new ti(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowIdAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("id"),this.sanitizerTable=new ti(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}allowIdReferenceAttributes(){const t=new Set(this.sanitizerTable.allowedGlobalAttributes);return t.add("aria-activedescendant").add("aria-controls").add("aria-labelledby").add("aria-owns").add("for").add("list"),this.sanitizerTable=new ti(this.sanitizerTable.allowedElements,this.sanitizerTable.elementPolicies,t,this.sanitizerTable.globalAttributePolicies,this.sanitizerTable.globallyAllowedAttributePrefixes),this}withResourceUrlPolicy(t){return this.resourceUrlPolicy=t,this}},kE=class extends OE{build(){if(this.calledBuild)throw new Error("this sanitizer has already called build");return this.calledBuild=!0,new PE(this.sanitizerTable,wo,void 0,void 0,this.resourceUrlPolicy)}};/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zE(t){const e=fp(t).toString(),s=new Blob([e],{type:"text/javascript"});return dE(URL.createObjectURL(s))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yr(t,...e){if(e.some(s=>s!==""))throw new Error("safeScript only allows empty string expressions to enable inline comments.");return Kv(t,e.length),Mu(t.join(""))}function BE(t){return Mu(t.map(fp).join(""))}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mp(t,e){const s=To(e);s!==void 0&&(t.href=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function UE(t,e){const s=To(e);s!==void 0&&(t.href=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function GE(t,e){t.href=_r(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function VE(t,e){const s=To(e);s!==void 0&&(t.formAction=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qE(t,e){t.src=_r(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jE(t,e){const s=To(e);s!==void 0&&(t.action=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function HE(t,e){t.src=_r(e).toString()}function WE(t,e){t.srcdoc=Nu(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function XE(t,e){const s=To(e);s!==void 0&&(t.formAction=s)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YE(t,e){t.data=_r(e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $E(t){return ZE("script",t)}function ZE(t,e=document){var s;const i=(s=e.querySelector)===null||s===void 0?void 0:s.call(e,`${t}[nonce]`);return i==null?"":i.nonce||i.getAttribute("nonce")||""}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KE(t){const e=$E(t.ownerDocument);e&&t.setAttribute("nonce",e)}function QE(t,e,s){t.src=_r(e),KE(t)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _p(t,e){tA(t)&&JE(t),t.innerHTML=Nu(e)}function JE(t){let e="";const s=t.tagName;if(/^(script|style)$/i.test(s))throw e=s.toLowerCase()==="script"?"Use setScriptTextContent with a SafeScript.":"Use setStyleTextContent with a SafeStyleSheet.",new Error(e)}function tA(t){return t.nodeType===1}function eA(t,e,s){if(t.namespaceURI!=="http://www.w3.org/1999/xhtml")throw new Error(`Cannot set attribute '${e}' on '${t.tagName}'.Element is not in the HTML namespace`);switch(e=e.toLowerCase(),`${t.tagName} ${e}`){case"A href":return void mp(t,s);case"AREA href":return void UE(t,s);case"BASE href":return void GE(t,s);case"BUTTON formaction":return void VE(t,s);case"EMBED src":return void qE(t,s);case"FORM action":return void jE(t,s);case"IFRAME src":return void HE(t,s);case"IFRAME srcdoc":return void WE(t,s);case"IFRAME sandbox":throw new Error("Can't set 'sandbox' on iframe tags. Use setIframeSrcWithIntent or setIframeSrcdocWithIntent instead");case"INPUT formaction":return void XE(t,s);case"LINK href":throw new Error("Can't set 'href' attribute on link tags. Use setLinkHrefAndRel instead");case"LINK rel":throw new Error("Can't set 'rel' attribute on link tags. Use setLinkHrefAndRel instead");case"OBJECT data":return void YE(t,s);case"SCRIPT src":return void QE(t,s);default:if(/^on./.test(e))throw new Error(`Attribute "${e}" looks like an event handler attribute. Please use a safe alternative like addEventListener instead.`);t.setAttribute(e,s)}}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 *//**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function sA(t,e){return new Worker(_r(t),e)}/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ei(t){!Xv&&console.warn(dp()+" "+t)}function iA(t,e){e.forEach(s=>{Object.getOwnPropertyNames(s.prototype).forEach(i=>{Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(s.prototype,i)||Object.create(null))})})}var Yt=()=>{},tl=()=>!1,Pu=()=>!0,el=()=>null,Hs=t=>t;function pp(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];s(i.get(r),n,e)}}function yp(t,e,s){const i=new Array(e.size),n=t.getObjectList(e.isNode);for(let r=0;r<e._indexes.length;++r){const o=e._indexes[r],a=n.get(o);i[r]=s(a,r,e)}return i}function xp(t,e,s){s=s||Pu;const i=e.isNode,n=t.acquireIndexList(i),r=t.getObjectList(i),o=t.getListFactory(i);for(let a=0;a<e._indexes.length;++a){const l=e._indexes[a],d=r.get(l);d&&s(d,a,e)&&n.push(l)}return o(n.sliceAndReset())}function bp(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];if(!s(i.get(r),n,e))return!1}return!0}function vp(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];if(s(i.get(r),n,e))return!0}return!1}function Ep(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n],o=i.get(r);if(s(o,n,e))return o}}function Ap(t,e,s,i){const n=t.getListFactory(e.isNode);if(!s)return{valid:e,invalid:n()};const r=t.acquireIndexList(e.isNode),o=t.acquireIndexList(e.isNode),a=t.getObjectList(e.isNode);for(let l=0;l<e._indexes.length;l++){const d=e._indexes[l],h=a.get(d);h!==void 0&&(s(h,i)?r:o).pushUnchecked(d)}return{valid:n(r.sliceAndReset()),invalid:n(o.sliceAndReset())}}function Sp(t,e,s,i){const n=t.getObjectList(e.isNode);let r=i;for(let o=0;o<e._indexes.length;++o){const a=e._indexes[o];r=s(r,n.get(a),o)}return r}function wp(t,e){const s=e.isNode,i=t.topology.getDeduper(s),n=t.acquireIndexList(s),r=t.getListFactory(s);for(let o=0;o<e._indexes.length;o++){const a=e._indexes[o];i.get(a)===0&&(i.set(a,1),n.push(a))}return r(n.sliceAndReset())}function Tp(t,e,s){const i=e.isNode,n=s.topology.getDeduper(i),r=s.acquireIndexList(i),o=s.getListFactory(i);for(let a=0;a<e._indexes.length;a++){const l=e._indexes[a];n.set(l,1)}for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];n.get(l)===0&&r.push(l)}return o(r.sliceAndReset())}function Ip(t,e){const s=e.isNode,i=t.storage.fetch(s),n=i.getFlexArray("excluded"),r=i.getMaxIndex(),o=t.topology.getDeduper(s),a=t.acquireIndexList(s),l=t.getListFactory(s);for(let d=0;d<e._indexes.length;d++)o.set(e._indexes[d],1);for(let d=1;d<=r;++d)o.get(d)===0&&n.get(d)===0&&a.push(d);return l(a.sliceAndReset())}function Cp(t,e,s){const i=t.getListFactory(e.isNode),n=new Uint32Array(e._indexes.length+s._indexes.length);return n.set(e._indexes),n.set(s._indexes,e._indexes.length),i(n)}function Lp(t,e){return t.getObjectList(e.isNode).getMultiple(e._indexes)}function Gl(t,e){const s=t.getStorage(e.isNode);if(e.isList){const i=new Array(e.size);for(let n=0;n<e._indexes.length;++n)i[n]=s.getId(e._indexes[n]);return i}return s.getId(e._index)}function Np(t,e){return t.topology.getExtremity(!0,e)}function Mp(t,e){return t.topology.getExtremity(!1,e)}function Pp(t,e,s){return t.getObjectList(e.isNode).get(e._indexes[s])}function Rp(t,e,s){const i=t.getListFactory(e.isNode),n=t.getObjectList(e.isNode),r=e._indexes.slice();return r.sort((o,a)=>{const l=n.get(o),d=n.get(a);return s(l,d)}),i(r)}var nA=[];function Fp(t){typeof t=="object"&&t!==null||(t={});const e=typeof t.data=="function"?t.data:Hs;return{attributes:Array.isArray(t.attributes)?t.attributes:t.attributes||nA,data:e}}function Vl(t,e){for(const s of t){const i=e;Object.keys(i).forEach(n=>{const r=i[n];s.prototype[n]=function(o,a){return Ei(`Deprecated method "${n}"; please use "${r}" instead.`),this[r](o,a)}})}}function ig(t){const e=t.getFlexArray("removed"),s=t.getFlexArray("excluded"),i=t.getFlexArray("virtual");return{all:n=>e.get(n)===0,visible:n=>s.get(n)===0,excluded:n=>s.get(n)===1,raw:n=>i.get(n)===0&&e.get(n)===0,_all:n=>!0}}function ng(t,e,s){return{all:qo(s.all,t,e),visible:qo(s.visible,t,e),raw:qo(s.raw,t,e),_all:qo(s._all,t,e)}}function qo(t,e,s){let i=null;return{getList(){if(!i){const n=e(),r=s();r.reset();for(let o=1;o<=n;++o)t(o)&&r.push(o);i=r.sliceAndReset()}return i},invalidList(){i=null}}}function rA(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`${t} is not a valid id, expected string or number`);return t}var rg=new Uint32Array(1),Zi=class{constructor(t,e){this.size=1,this.isNode=!1,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return rg[0]=this._index,rg}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}hasParallelEdges(){return this._ogma.modules.graph.hasParallelEdges(this)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.filter(s=>s!==this).dedupe()}}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.modules.graph.edgeList(new Uint32Array([this._index]))}getId(){return Gl(this._ogma.modules.graph,this)}getSource(){return Np(this._ogma.modules.graph,this)}getTarget(){return Mp(this._ogma.modules.graph,this)}getExtremities(){return this._ogma.modules.graph.nodeList(new Uint32Array([this.getSource()._index,this.getTarget()._index]))}setSource(t){this._ogma.modules.graph.setSource(this,t)}setTarget(t){this._ogma.modules.graph.setTarget(this,t)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Fp(t);return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(e),data:s(Ae(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdge(this)}getSubEdges(){return this._ogma.modules.transformations.getSubEdges(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};Vl([Zi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var Ln=class{constructor(t,e){this.isList=!0,this.isNode=!1,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.subtract(this).dedupe()}}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map(t=>this._ogma.modules.transformations.isElementVirtual(t))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Lp(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.edgeList(this._indexes.slice())}getId(){return Gl(this._ogma.modules.graph,this)}getSource(){return Np(this._ogma.modules.graph,this)}getTarget(){return Mp(this._ogma.modules.graph,this)}getExtremities(){return this.getSource().concat(this.getTarget())}get(t){return Pp(this._ogma.modules.graph,this,t)}forEach(t){pp(this._ogma.modules.graph,this,t)}map(t){return yp(this._ogma.modules.graph,this,t)}find(t){return Ep(this._ogma.modules.graph,this,t)}some(t){return vp(this._ogma.modules.graph,this,t)}every(t){return bp(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return xp(this._ogma.modules.graph,this,t)}reduce(t,e){return Sp(this._ogma.modules.graph,this,t,e)}concat(t){return Cp(this._ogma.modules.graph,this,t)}dedupe(){return wp(this._ogma.modules.graph,this)}subtract(t){return Tp(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.edgeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof Zi?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}sort(t){return Rp(this._ogma.modules.graph,this,t)}inverse(){return Ip(this._ogma.modules.graph,this)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!He(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaEdge(){return this._ogma.modules.transformations.getMetaEdges(this)}getSubEdges(){return this.map(this._ogma.modules.transformations.getSubEdges)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};Vl([Ln],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var si="geo.latitude",ii="geo.longitude",og="geo.prevLat",ud="geo.prevLng",Dp=85.0511287798,oA=6378137,sl=1,aA='Map data &copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap contributors</a>',hn={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:22,minZoomLevel:0,wrapCoordinates:!0,tileUrlTemplate:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:void 0,backgroundColor:"silver",opacity:1,duration:0,disableNodeDragging:!0,tileBuffer:1,sizeRatio:1,tiles:{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",subdomains:"abc",tms:!1,wms:!1},crs:void 0},lA={maxBoundsViscosity:1,worldCopyJump:!0,zoomControl:!1,attributionControl:!1},dA=(()=>{let t=0;return typeof requestAnimationFrame<"u"?requestAnimationFrame:function(e){const s=Date.now(),i=Math.min(16,Math.max(0,16-(s-t))),n=t=s+i;return setTimeout(()=>e(n),i)}})(),Op=50,hA=typeof cancelAnimationFrame<"u"?cancelAnimationFrame:function(t){return clearTimeout(t)};function Ru(t,e){return dA(s=>{t.call(e,s)})}function kp(t){t&&hA(t)}var cd,In,Fu,zp,uA={},Bp=uA,Ua={},Up={},hh=t=>null;if(typeof global=="object"&&(Ua=global),typeof window=="object"&&(Up=window),typeof module=="object"&&typeof module.require=="function"){const t=module.require.bind(module);hh=e=>{try{return t(e)}catch{return null}}}else typeof Ua.require=="function"&&(hh=t=>{const e=Ua.require;try{return e(t)}catch{return null}});function Ds(t,{throwOnError:e}={}){let s=null;if(!s&&t&&(s=Bp[t]),!s&&t&&(s=hh(t)),!s&&t&&(s=Up[t]),!s&&t&&(s=Ua[t]),!s&&e){const i=[`unable to find module "${t}"; make sure one of these statements is true:`,`- Ogma.libraries['${t}'] is set to the right library`,`- require('${t}') returns the right library`,`- window['${t}'] is set to the right library`].join(`
`);throw new Error(i)}return s}var Gp=class kr{constructor(){this.method=null,this.url=null,this.status=0,this.readyState=0,this.headers={},this.responseText=null,this.response=null,kr.onCreate&&kr.onCreate(this)}open(e,s){this.method=e,this.url=s,kr.onSend&&kr.onSend(this)}respond(e,s,i){this.readyState=4,this.status=e,this.headers=s,this.responseText=i,this.response=i,this.onreadystatechange()}send(){this.readyState=4}static{this.onCreate=Yt}static{this.onSend=Yt}},Vp=class zr{constructor(){this.onload=Yt,zr.onCreate&&zr.onCreate(this)}static{this.onCreate=Yt}static{this.onRead=Yt}readAsDataURL(e){this._blob=e,zr.onRead&&zr.onRead(this)}load(e){this.result=typeof e=="function"?e(this._blob):e,this.onload&&this.onload()}};function Ii(){return In||{createElementNS:()=>null,createElement:()=>null,implementation:{createDocument(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}cd=Ds("@xmldom/xmldom"),In=Ti?document:cd?new cd.DOMImplementation().createDocument():null,Fu=typeof XMLHttpRequest<"u"?XMLHttpRequest:Gp,zp=typeof FileReader<"u"?FileReader:Vp;var cA=class{observe(){}unobserve(){}disconnect(){}},gA=typeof ResizeObserver>"u"?cA:ResizeObserver,qp=t=>new gA(t);function jp(t,e){if(document&&document.defaultView){let s=t.style[e];if((!s||s==="auto")&&Ii().defaultView){const i=document.defaultView.getComputedStyle(t,null);s=i?i[e]:null}return s==="auto"?null:s?s.toString():null}return null}var Hp=class{constructor(){this.onmousewheel=Yt,this.__dummy=!0,this.style={},this.clientWidth=0,this.clientHeight=0,this.childNodes=[],this.style={width:"0px",height:"0px",top:void 0,left:void 0,position:"",backgroundColor:void 0}}get offsetWidth(){return parseFloat(this.style.width||"0")}get offsetHeight(){return parseFloat(this.style.height||"0")}get firstChild(){return null}get parentNode(){return null}get classList(){return{length:0,value:"",add(){},remove(){},contains:t=>!1,item:null}}get innerHTML(){return""}set innerHTML(t){}appendChild(t){return this.childNodes.push(t),t}removeChild(){}addEventListener(){}removeEventListener(){}insertBefore(){}contains(t){return!1}};function il(){return new Hp}var ps=$i?()=>window.devicePixelRatio:()=>1;function Wp(t){const e=";base64,";let s,i,n;if(t.indexOf(e)===-1)return s=t.split(","),i=s[0].split(":")[1],n=decodeURIComponent(s[1]),lo(n,i);s=t.split(e),i=s[0].split(":")[1],n=window.atob(s[1]);const r=n.length,o=new Uint8Array(r);for(let a=0;a<r;++a)o[a]=n.charCodeAt(a);return lo([o],i)}var Xp=class{constructor(t,e){this.data=t,this.type=e}};function lo(t,e){return typeof Blob<"u"?new Blob(t,{type:e}):new Xp(t,e)}function fA(t){return typeof Blob<"u"&&t instanceof Blob||t instanceof Xp}function mA(t,e,s="text/plain"){return e==="blob"?t:e==="dataURL"?Wp(t):lo([t],s||"text/xml")}function nn(t,e,s="text",i="text/plain"){if(!zl)return t;let n=null,r=null,o=null;window.Blob?(n=mA(t,s,i),r=URL.createObjectURL(n)):o="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(t);const a=document.createElement("a");return mp(a,r||o||""),a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a),r&&setTimeout(()=>window.URL.revokeObjectURL(r),0),t}function nl(t,e,s,i=ps()){if(Cn(t,e+"px",s+"px"),t.tagName==="IMG"||t.tagName==="CANVAS"){const n=t;n.width=e*i,n.height=s*i}}function Du(t,e){ri(e,(s,i)=>{s!==void 0&&t.setAttribute(i,s)})}var Ou="http://www.w3.org/2000/svg",uh="http://www.w3.org/2000/xmlns/",Yp="http://www.w3.org/1999/xlink",_A=1;function ie(t,e){const s=In.createElementNS(Ou,t);return s.style||(s.style={}),e&&Du(s,e),s}function ch(t){const e=In.createElement("div");if(e.innerHTML=t.trim().replace(/\s+/g," "),!e.firstChild||e.firstChild.nodeType!==_A)throw new Error(`Failed to create element from: "${t}". Expected an HTML string`);return e.firstChild}function ku(t){if(In)return In.createTextNode(t)}function $p(t){return typeof Image>"u"?Promise.resolve(null):new Promise(e=>{const s=new Image;s.src=t,s.onload=()=>e(s),s.onerror=()=>e(null)})}function Zp(t){if(t.indexOf("http://")===0||t.indexOf("https://")===0)return t;const e=window.location.origin;if(window.location.protocol==="blob:")return t;const s=window.location.pathname,i=s.lastIndexOf("/");return i===-1?e+"/"+t:e+s.substring(0,i)+"/"+t}function pr(t){return new Promise((e,s)=>{const i=new Fu;i.open("GET",Zp(t),!0),i.onreadystatechange=function(){if(i.readyState===4){const n=i.status;n===200?e(i.responseText):s(n!==0?new Error(`cannot retrieve file at url "${t}"; the server responded with status code ${n}.`):new Error(`cannot send XMLHttpRequest to url "${t}"; if you're using the local file protocol this is most likely the cause.`))}},i.onerror=function(){s(new Error(`cannot retrieve file at url "${t}"; the XMLHttpRequest failed.`))},i.send()})}function Kp(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function rl(t,e){t.style.cursor=e,t.style.cursor!==e&&(t.style.cursor=`-webkit-${e}`)}function Qp(t){return new Promise((e,s)=>{const i=new Fu;i.responseType="blob",i.open("GET",Zp(t),!0),i.onreadystatechange=()=>{if(i.readyState===4){if(i.status===200)return e(i.response);s(i.status)}},i.onerror=n=>s(n),i.send()})}function Jp(t){return Qp(t).then(e=>new Promise((s,i)=>{const n=new zp;n.onerror=i,n.onload=()=>s(n.result),n.readAsDataURL(e)}))}function qn(t,e=!0){const s=e?"&#13;":`
`;return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,s).replace(/[\r\n]/g,s)}var zu={0:"left",1:"middle",2:"right"};function ty(t){if(t.baseURI)return t.baseURI;const e=t.getElementsByTagName("base");return e.length>0?e[0].href:t.URL||(t.location?t.location.href:"")}function ey(t,e,s,i){return new Promise(n=>{let r=e;const o=Date.now(),a=(s-e)*Math.min(1,1/(i/16));(function l(){Date.now()-o<i?(r=Math.min(1,Math.max(0,r+a)),t.style.opacity=r.toString(),Ru(l)):n()})()})}function Cn(t,e,s){t.style.width=e,t.style.height=s}var Bu=new kE().allowClassAttributes().allowDataAttributes().allowIdAttributes().allowStyleAttributes().build();function Hi(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Os(t,e,s){return Math.max(e,Math.min(s,t))}function gh(t,e,s){return t+(e-t)*s}function ne(t,e,s){return t*(1-s)+e*s}function jn(t){if(!t.length)return-1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n>e&&(e=n)}return e}function yi(t){if(!t.length)return 1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n<e&&(e=n)}return e}var sy=(t,e)=>Math.log(t)/Math.log(e),ol=t=>t<-Math.PI?t+2*Math.PI:t>Math.PI?t-2*Math.PI:t,pA=class{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let s=0;for(let i=0;i<this._n&&i<32;i++){const n=e[i],r=t+n,o=Math.abs(t)<Math.abs(n)?t-(r-n):n-(r-t);o&&(e[s++]=o),t=r}return e[s]=t,this._n=s+1,this}valueOf(){const t=this._partials;let e,s,i,n=this._n,r=0;if(n>0){for(r=t[--n];n>0&&(e=r,s=t[--n],r=e+s,i=s-(r-e),!i););n>0&&(i<0&&t[n-1]<0||i>0&&t[n-1]>0)&&(s=2*i,e=r+s,s==e-r&&(r=e))}return r}};function*yA(t){for(const e of t)yield*e}function iy(t){return Array.from(yA(t))}var xe=1e-6,ee=Math.PI,Rs=ee/2,ag=ee/4,Ws=2*ee,ci=180/ee,vs=ee/180,Se=Math.abs,xA=Math.atan,nr=Math.atan2,Ee=Math.cos,ye=Math.sin,bA=Math.sign||function(t){return t>0?1:t<0?-1:0},Io=Math.sqrt;function ny(t){return t>1?0:t<-1?ee:Math.acos(t)}function rr(t){return t>1?Rs:t<-1?-Rs:Math.asin(t)}function Br(){}function al(t,e){t&&dg.hasOwnProperty(t.type)&&dg[t.type](t,e)}var lg={Feature:function(t,e){al(t.geometry,e)},FeatureCollection:function(t,e){for(var s=t.features,i=-1,n=s.length;++i<n;)al(s[i].geometry,e)}},dg={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)t=s[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){fh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)fh(s[i],e,0)},Polygon:function(t,e){hg(t.coordinates,e)},MultiPolygon:function(t,e){for(var s=t.coordinates,i=-1,n=s.length;++i<n;)hg(s[i],e)},GeometryCollection:function(t,e){for(var s=t.geometries,i=-1,n=s.length;++i<n;)al(s[i],e)}};function fh(t,e,s){var i,n=-1,r=t.length-s;for(e.lineStart();++n<r;)i=t[n],e.point(i[0],i[1],i[2]);e.lineEnd()}function hg(t,e){var s=-1,i=t.length;for(e.polygonStart();++s<i;)fh(t[s],e,1);e.polygonEnd()}function vA(t,e){t&&lg.hasOwnProperty(t.type)?lg[t.type](t,e):al(t,e)}function mh(t){return[nr(t[1],t[0]),rr(t[2])]}function or(t){var e=t[0],s=t[1],i=Ee(s);return[i*Ee(e),i*ye(e),ye(s)]}function jo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ll(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function gd(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Ho(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function _h(t){var e=Io(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function ph(t,e){function s(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(s.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),s}function yh(t,e){return Se(t)>ee&&(t-=Math.round(t/Ws)*Ws),[t,e]}function EA(t,e,s){return(t%=Ws)?e||s?ph(cg(t),gg(e,s)):cg(t):e||s?gg(e,s):yh}function ug(t){return function(e,s){return Se(e+=t)>ee&&(e-=Math.round(e/Ws)*Ws),[e,s]}}function cg(t){var e=ug(t);return e.invert=ug(-t),e}function gg(t,e){var s=Ee(t),i=ye(t),n=Ee(e),r=ye(e);function o(a,l){var d=Ee(l),h=Ee(a)*d,u=ye(a)*d,c=ye(l),g=c*s+h*i;return[nr(u*n-g*r,h*s-c*i),rr(g*n+u*r)]}return o.invert=function(a,l){var d=Ee(l),h=Ee(a)*d,u=ye(a)*d,c=ye(l),g=c*n-u*r;return[nr(u*n+c*r,h*s+g*i),rr(g*s-h*i)]},o}function AA(t,e,s,i,n,r){if(s){var o=Ee(e),a=ye(e),l=i*s;n==null?(n=e+i*Ws,r=e-l/2):(n=fg(o,n),r=fg(o,r),(i>0?n<r:n>r)&&(n+=i*Ws));for(var d,h=n;i>0?h>r:h<r;h-=l)d=mh([o,-a*Ee(h),-a*ye(h)]),t.point(d[0],d[1])}}function fg(t,e){(e=or(e))[0]-=t,_h(e);var s=ny(-e[1]);return((-e[2]<0?-s:s)+Ws-xe)%Ws}function ry(){var t,e=[];return{point:function(s,i,n){t.push([s,i,n])},lineStart:function(){e.push(t=[])},lineEnd:Br,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var s=e;return e=[],t=null,s}}}function Ga(t,e){return Se(t[0]-e[0])<xe&&Se(t[1]-e[1])<xe}function Wo(t,e,s,i){this.x=t,this.z=e,this.o=s,this.e=i,this.v=!1,this.n=this.p=null}function oy(t,e,s,i,n){var r,o,a=[],l=[];if(t.forEach(function(f){if(!((m=f.length-1)<=0)){var m,_,p=f[0],x=f[m];if(Ga(p,x)){if(!p[2]&&!x[2]){for(n.lineStart(),r=0;r<m;++r)n.point((p=f[r])[0],p[1]);return void n.lineEnd()}x[0]+=2*xe}a.push(_=new Wo(p,f,null,!0)),l.push(_.o=new Wo(p,null,_,!1)),a.push(_=new Wo(x,f,null,!1)),l.push(_.o=new Wo(x,null,_,!0))}}),a.length){for(l.sort(e),mg(a),mg(l),r=0,o=l.length;r<o;++r)l[r].e=s=!s;for(var d,h,u=a[0];;){for(var c=u,g=!0;c.v;)if((c=c.n)===u)return;d=c.z,n.lineStart();do{if(c.v=c.o.v=!0,c.e){if(g)for(r=0,o=d.length;r<o;++r)n.point((h=d[r])[0],h[1]);else i(c.x,c.n.x,1,n);c=c.n}else{if(g)for(d=c.p.z,r=d.length-1;r>=0;--r)n.point((h=d[r])[0],h[1]);else i(c.x,c.p.x,-1,n);c=c.p}d=(c=c.o).z,g=!g}while(!c.v);n.lineEnd()}}}function mg(t){if(e=t.length){for(var e,s,i=0,n=t[0];++i<e;)n.n=s=t[i],s.p=n,n=s;n.n=s=t[0],s.p=n}}function fd(t){return Se(t[0])<=ee?t[0]:bA(t[0])*((Se(t[0])+ee)%Ws-ee)}function SA(t,e){var s=fd(e),i=e[1],n=ye(i),r=[ye(s),-Ee(s),0],o=0,a=0,l=new pA;n===1?i=Rs+xe:n===-1&&(i=-Rs-xe);for(var d=0,h=t.length;d<h;++d)if(c=(u=t[d]).length)for(var u,c,g=u[c-1],f=fd(g),m=g[1]/2+ag,_=ye(m),p=Ee(m),x=0;x<c;++x,f=b,_=E,p=A,g=y){var y=u[x],b=fd(y),v=y[1]/2+ag,E=ye(v),A=Ee(v),S=b-f,w=S>=0?1:-1,L=w*S,T=L>ee,F=_*E;if(l.add(nr(F*w*ye(L),p*A+F*Ee(L))),o+=T?S+w*Ws:S,T^f>=s^b>=s){var V=ll(or(g),or(y));_h(V);var G=ll(r,V);_h(G);var O=(T^S>=0?-1:1)*rr(G[2]);(i>O||i===O&&(V[0]||V[1]))&&(a+=T^S>=0?1:-1)}}return(o<-1e-6||o<xe&&l<-1e-12)^1&a}function ay(t,e,s,i){return function(n){var r,o,a,l=e(n),d=ry(),h=e(d),u=!1,c={point:g,lineStart:m,lineEnd:_,polygonStart:function(){c.point=p,c.lineStart=x,c.lineEnd=y,o=[],r=[]},polygonEnd:function(){c.point=g,c.lineStart=m,c.lineEnd=_,o=iy(o);var b=SA(r,i);o.length?(u||(n.polygonStart(),u=!0),oy(o,TA,b,s,n)):b&&(u||(n.polygonStart(),u=!0),n.lineStart(),s(null,null,1,n),n.lineEnd()),u&&(n.polygonEnd(),u=!1),o=r=null},sphere:function(){n.polygonStart(),n.lineStart(),s(null,null,1,n),n.lineEnd(),n.polygonEnd()}};function g(b,v){t(b,v)&&n.point(b,v)}function f(b,v){l.point(b,v)}function m(){c.point=f,l.lineStart()}function _(){c.point=g,l.lineEnd()}function p(b,v){a.push([b,v]),h.point(b,v)}function x(){h.lineStart(),a=[]}function y(){p(a[0][0],a[0][1]),h.lineEnd();var b,v,E,A,S=h.clean(),w=d.result(),L=w.length;if(a.pop(),r.push(a),a=null,L)if(1&S){if((v=(E=w[0]).length-1)>0){for(u||(n.polygonStart(),u=!0),n.lineStart(),b=0;b<v;++b)n.point((A=E[b])[0],A[1]);n.lineEnd()}}else L>1&&2&S&&w.push(w.pop().concat(w.shift())),o.push(w.filter(wA))}return c}}function wA(t){return t.length>1}function TA(t,e){return((t=t.x)[0]<0?t[1]-Rs-xe:Rs-t[1])-((e=e.x)[0]<0?e[1]-Rs-xe:Rs-e[1])}yh.invert=yh;var _g=ay(function(){return!0},IA,LA,[-ee,-Rs]);function IA(t){var e,s=NaN,i=NaN,n=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(r,o){var a=r>0?ee:-ee,l=Se(r-s);Se(l-ee)<xe?(t.point(s,i=(i+o)/2>0?Rs:-Rs),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),t.point(r,i),e=0):n!==a&&l>=ee&&(Se(s-n)<xe&&(s-=n*xe),Se(r-a)<xe&&(r-=a*xe),i=CA(s,i,r,o),t.point(n,i),t.lineEnd(),t.lineStart(),t.point(a,i),e=0),t.point(s=r,i=o),n=a},lineEnd:function(){t.lineEnd(),s=i=NaN},clean:function(){return 2-e}}}function CA(t,e,s,i){var n,r,o=ye(t-s);return Se(o)>xe?xA((ye(e)*(r=Ee(i))*ye(s)-ye(i)*(n=Ee(e))*ye(t))/(n*r*o)):(e+i)/2}function LA(t,e,s,i){var n;if(t==null)n=s*Rs,i.point(-ee,n),i.point(0,n),i.point(ee,n),i.point(ee,0),i.point(ee,-n),i.point(0,-n),i.point(-ee,-n),i.point(-ee,0),i.point(-ee,n);else if(Se(t[0]-e[0])>xe){var r=t[0]<e[0]?ee:-ee;n=s*r/2,i.point(-r,n),i.point(0,n),i.point(r,n)}else i.point(e[0],e[1])}function NA(t){var e=Ee(t),s=2*vs,i=e>0,n=Se(e)>xe;function r(l,d){return Ee(l)*Ee(d)>e}function o(l,d,h){var u=[1,0,0],c=ll(or(l),or(d)),g=jo(c,c),f=c[0],m=g-f*f;if(!m)return!h&&l;var _=e*g/m,p=-e*f/m,x=ll(u,c),y=Ho(u,_);gd(y,Ho(c,p));var b=x,v=jo(y,b),E=jo(b,b),A=v*v-E*(jo(y,y)-1);if(!(A<0)){var S=Io(A),w=Ho(b,(-v-S)/E);if(gd(w,y),w=mh(w),!h)return w;var L,T=l[0],F=d[0],V=l[1],G=d[1];F<T&&(L=T,T=F,F=L);var O=F-T,j=Se(O-ee)<xe;if(!j&&G<V&&(L=V,V=G,G=L),j||O<xe?j?V+G>0^w[1]<(Se(w[0]-T)<xe?V:G):V<=w[1]&&w[1]<=G:O>ee^(T<=w[0]&&w[0]<=F)){var W=Ho(b,(-v+S)/E);return gd(W,y),[w,mh(W)]}}}function a(l,d){var h=i?t:ee-t,u=0;return l<-h?u|=1:l>h&&(u|=2),d<-h?u|=4:d>h&&(u|=8),u}return ay(r,function(d){var h,u,c,g,f;return{lineStart:function(){g=c=!1,f=1},point:function(m,_){var p,x=[m,_],y=r(m,_),b=i?y?0:a(m,_):y?a(m+(m<0?ee:-ee),_):0;if(!h&&(g=c=y)&&d.lineStart(),y!==c&&(!(p=o(h,x))||Ga(h,p)||Ga(x,p))&&(x[2]=1),y!==c)f=0,y?(d.lineStart(),p=o(x,h),d.point(p[0],p[1])):(p=o(h,x),d.point(p[0],p[1],2),d.lineEnd()),h=p;else if(n&&h&&i^y){var v;b&u||!(v=o(x,h,!0))||(f=0,i?(d.lineStart(),d.point(v[0][0],v[0][1]),d.point(v[1][0],v[1][1]),d.lineEnd()):(d.point(v[1][0],v[1][1]),d.lineEnd(),d.lineStart(),d.point(v[0][0],v[0][1],3)))}!y||h&&Ga(h,x)||d.point(x[0],x[1]),h=x,c=y,u=b},lineEnd:function(){c&&d.lineEnd(),h=null},clean:function(){return f|(g&&c)<<1}}},function(d,h,u,c){AA(c,t,s,u,d,h)},i?[0,-t]:[-ee,t-ee])}function MA(t,e,s,i,n,r){var o,a=t[0],l=t[1],d=0,h=1,u=e[0]-a,c=e[1]-l;if(o=s-a,u||!(o>0)){if(o/=u,u<0){if(o<d)return;o<h&&(h=o)}else if(u>0){if(o>h)return;o>d&&(d=o)}if(o=n-a,u||!(o<0)){if(o/=u,u<0){if(o>h)return;o>d&&(d=o)}else if(u>0){if(o<d)return;o<h&&(h=o)}if(o=i-l,c||!(o>0)){if(o/=c,c<0){if(o<d)return;o<h&&(h=o)}else if(c>0){if(o>h)return;o>d&&(d=o)}if(o=r-l,c||!(o<0)){if(o/=c,c<0){if(o>h)return;o>d&&(d=o)}else if(c>0){if(o<d)return;o<h&&(h=o)}return d>0&&(t[0]=a+d*u,t[1]=l+d*c),h<1&&(e[0]=a+h*u,e[1]=l+h*c),!0}}}}}var Xo=1e9,Yo=-1e9;function PA(t,e,s,i){function n(d,h){return t<=d&&d<=s&&e<=h&&h<=i}function r(d,h,u,c){var g=0,f=0;if(d==null||(g=o(d,u))!==(f=o(h,u))||l(d,h)<0^u>0)do c.point(g===0||g===3?t:s,g>1?i:e);while((g=(g+u+4)%4)!==f);else c.point(h[0],h[1])}function o(d,h){return Se(d[0]-t)<xe?h>0?0:3:Se(d[0]-s)<xe?h>0?2:1:Se(d[1]-e)<xe?h>0?1:0:h>0?3:2}function a(d,h){return l(d.x,h.x)}function l(d,h){var u=o(d,1),c=o(h,1);return u!==c?u-c:u===0?h[1]-d[1]:u===1?d[0]-h[0]:u===2?d[1]-h[1]:h[0]-d[0]}return function(d){var h,u,c,g,f,m,_,p,x,y,b,v=d,E=ry(),A={point:S,lineStart:function(){A.point=w,u&&u.push(c=[]),y=!0,x=!1,_=p=NaN},lineEnd:function(){h&&(w(g,f),m&&x&&E.rejoin(),h.push(E.result())),A.point=S,x&&v.lineEnd()},polygonStart:function(){v=E,h=[],u=[],b=!0},polygonEnd:function(){var T=function(){for(var O=0,j=0,W=u.length;j<W;++j)for(var et,at,mt=u[j],vt=1,wt=mt.length,Et=mt[0],yt=Et[0],St=Et[1];vt<wt;++vt)et=yt,at=St,yt=(Et=mt[vt])[0],St=Et[1],at<=i?St>i&&(yt-et)*(i-at)>(St-at)*(t-et)&&++O:St<=i&&(yt-et)*(i-at)<(St-at)*(t-et)&&--O;return O}(),F=b&&T,V=(h=iy(h)).length;(F||V)&&(d.polygonStart(),F&&(d.lineStart(),r(null,null,1,d),d.lineEnd()),V&&oy(h,a,T,r,d),d.polygonEnd()),v=d,h=u=c=null}};function S(L,T){n(L,T)&&v.point(L,T)}function w(L,T){var F=n(L,T);if(u&&c.push([L,T]),y)g=L,f=T,m=F,y=!1,F&&(v.lineStart(),v.point(L,T));else if(F&&x)v.point(L,T);else{var V=[_=Math.max(Yo,Math.min(Xo,_)),p=Math.max(Yo,Math.min(Xo,p))],G=[L=Math.max(Yo,Math.min(Xo,L)),T=Math.max(Yo,Math.min(Xo,T))];MA(V,G,t,e,s,i)?(x||(v.lineStart(),v.point(V[0],V[1])),v.point(G[0],G[1]),F||v.lineEnd(),b=!1):F&&(v.lineStart(),v.point(L,T),b=!1)}_=L,p=T,x=F}return A}}var pg=t=>t,ar=1/0,dl=ar,ho=-ar,hl=ho,RA={point:FA,lineStart:Br,lineEnd:Br,polygonStart:Br,polygonEnd:Br,result:function(){var t=[[ar,dl],[ho,hl]];return ho=hl=-(dl=ar=1/0),t}};function FA(t,e){t<ar&&(ar=t),t>ho&&(ho=t),e<dl&&(dl=e),e>hl&&(hl=e)}var yg=RA;function Uu(t){return function(e){var s=new xh;for(var i in t)s[i]=t[i];return s.stream=e,s}}function xh(){}function Gu(t,e,s){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),i!=null&&t.clipExtent(null),vA(s,t.stream(yg)),e(yg.result()),i!=null&&t.clipExtent(i),t}function ly(t,e,s){return Gu(t,function(i){var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=Math.min(n/(i[1][0]-i[0][0]),r/(i[1][1]-i[0][1])),a=+e[0][0]+(n-o*(i[1][0]+i[0][0]))/2,l=+e[0][1]+(r-o*(i[1][1]+i[0][1]))/2;t.scale(150*o).translate([a,l])},s)}function DA(t,e,s){return ly(t,[[0,0],e],s)}function OA(t,e,s){return Gu(t,function(i){var n=+e,r=n/(i[1][0]-i[0][0]),o=(n-r*(i[1][0]+i[0][0]))/2,a=-r*i[0][1];t.scale(150*r).translate([o,a])},s)}function kA(t,e,s){return Gu(t,function(i){var n=+e,r=n/(i[1][1]-i[0][1]),o=-r*i[0][0],a=(n-r*(i[1][1]+i[0][1]))/2;t.scale(150*r).translate([o,a])},s)}xh.prototype={constructor:xh,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var xg=16,zA=Ee(30*vs);function bg(t,e){return+e?UA(t,e):BA(t)}function BA(t){return Uu({point:function(e,s){e=t(e,s),this.stream.point(e[0],e[1])}})}function UA(t,e){function s(i,n,r,o,a,l,d,h,u,c,g,f,m,_){var p=d-i,x=h-n,y=p*p+x*x;if(y>4*e&&m--){var b=o+c,v=a+g,E=l+f,A=Io(b*b+v*v+E*E),S=rr(E/=A),w=Se(Se(E)-1)<xe||Se(r-u)<xe?(r+u)/2:nr(v,b),L=t(w,S),T=L[0],F=L[1],V=T-i,G=F-n,O=x*V-p*G;(O*O/y>e||Se((p*V+x*G)/y-.5)>.3||o*c+a*g+l*f<zA)&&(s(i,n,r,o,a,l,T,F,w,b/=A,v/=A,E,m,_),_.point(T,F),s(T,F,w,b,v,E,d,h,u,c,g,f,m,_))}}return function(i){var n,r,o,a,l,d,h,u,c,g,f,m,_={point:p,lineStart:x,lineEnd:b,polygonStart:function(){i.polygonStart(),_.lineStart=v},polygonEnd:function(){i.polygonEnd(),_.lineStart=x}};function p(S,w){S=t(S,w),i.point(S[0],S[1])}function x(){u=NaN,_.point=y,i.lineStart()}function y(S,w){var L=or([S,w]),T=t(S,w);s(u,c,h,g,f,m,u=T[0],c=T[1],h=S,g=L[0],f=L[1],m=L[2],xg,i),i.point(u,c)}function b(){_.point=p,i.lineEnd()}function v(){x(),_.point=E,_.lineEnd=A}function E(S,w){y(n=S,w),r=u,o=c,a=g,l=f,d=m,_.point=y}function A(){s(u,c,h,g,f,m,r,o,n,a,l,d,xg,i),_.lineEnd=b,b()}return _}}var GA=Uu({point:function(t,e){this.stream.point(t*vs,e*vs)}});function VA(t){return Uu({point:function(e,s){var i=t(e,s);return this.stream.point(i[0],i[1])}})}function qA(t,e,s,i,n){function r(o,a){return[e+t*(o*=i),s-t*(a*=n)]}return r.invert=function(o,a){return[(o-e)/t*i,(s-a)/t*n]},r}function vg(t,e,s,i,n,r){if(!r)return qA(t,e,s,i,n);var o=Ee(r),a=ye(r),l=o*t,d=a*t,h=o/t,u=a/t,c=(a*s-o*e)/t,g=(a*e+o*s)/t;function f(m,_){return[l*(m*=i)-d*(_*=n)+e,s-d*m-l*_]}return f.invert=function(m,_){return[i*(h*m-u*_+c),n*(g-u*m-h*_)]},f}function jA(t){return HA(function(){return t})()}function HA(t){var e,s,i,n,r,o,a,l,d,h,u=150,c=480,g=250,f=0,m=0,_=0,p=0,x=0,y=0,b=1,v=1,E=null,A=_g,S=null,w=pg,L=.5;function T(O){return l(O[0]*vs,O[1]*vs)}function F(O){return(O=l.invert(O[0],O[1]))&&[O[0]*ci,O[1]*ci]}function V(){var O=vg(u,0,0,b,v,y).apply(null,e(f,m)),j=vg(u,c-O[0],g-O[1],b,v,y);return s=EA(_,p,x),a=ph(e,j),l=ph(s,a),o=bg(a,L),G()}function G(){return d=h=null,T}return T.stream=function(O){return d&&h===O?d:d=GA(VA(s)(A(o(w(h=O)))))},T.preclip=function(O){return arguments.length?(A=O,E=void 0,G()):A},T.postclip=function(O){return arguments.length?(w=O,S=i=n=r=null,G()):w},T.clipAngle=function(O){return arguments.length?(A=+O?NA(E=O*vs):(E=null,_g),G()):E*ci},T.clipExtent=function(O){return arguments.length?(w=O==null?(S=i=n=r=null,pg):PA(S=+O[0][0],i=+O[0][1],n=+O[1][0],r=+O[1][1]),G()):S==null?null:[[S,i],[n,r]]},T.scale=function(O){return arguments.length?(u=+O,V()):u},T.translate=function(O){return arguments.length?(c=+O[0],g=+O[1],V()):[c,g]},T.center=function(O){return arguments.length?(f=O[0]%360*vs,m=O[1]%360*vs,V()):[f*ci,m*ci]},T.rotate=function(O){return arguments.length?(_=O[0]%360*vs,p=O[1]%360*vs,x=O.length>2?O[2]%360*vs:0,V()):[_*ci,p*ci,x*ci]},T.angle=function(O){return arguments.length?(y=O%360*vs,V()):y*ci},T.reflectX=function(O){return arguments.length?(b=O?-1:1,V()):b<0},T.reflectY=function(O){return arguments.length?(v=O?-1:1,V()):v<0},T.precision=function(O){return arguments.length?(o=bg(a,L=O*O),G()):Io(L)},T.fitExtent=function(O,j){return ly(T,O,j)},T.fitSize=function(O,j){return DA(T,O,j)},T.fitWidth=function(O,j){return OA(T,O,j)},T.fitHeight=function(O,j){return kA(T,O,j)},function(){return e=t.apply(this,arguments),T.invert=e.invert&&F,V()}}function WA(t){return function(e,s){var i=Ee(e),n=Ee(s),r=t(i*n);return r===1/0?[2,0]:[r*n*ye(e),r*ye(s)]}}function XA(t){return function(e,s){var i=Io(e*e+s*s),n=t(i),r=ye(n),o=Ee(n);return[nr(e*r,i*o),rr(i&&s*r/i)]}}var dy=WA(function(t){return(t=ny(t))&&t/ye(t)});function YA(){return jA(dy).scale(79.4188).clipAngle(179.999)}function Eg(t,e){t&&e!==void 0&&isFinite(e)&&t.setOpacity&&t.setOpacity(e)}function Ag(){return $i||typeof global<"u"&&!global.process}function md(t){return Math.log2(t)+sl}function $A(t){return 2**(t-sl)}function Sg(t){return t!=null&&!isNaN(t)}function hy(t,e){return cy(t,e,"longitude")}function uy(t,e){return cy(t,e,"latitude")}function cy(t,e,s){if(isNaN(e))throw new TypeError(`node ${t}: ${e} is not a valid ${s}`)}dy.invert=XA(function(t){return t});var ZA=t=>Math.pow(2,Math.ceil(Math.log2(t)));function KA(t,e){return e==null&&t.url===hn.tiles.url?aA:null}function QA(t={},e){const{tileUrlSubdomains:s,tileUrlTemplate:i,attribution:n,attributionOptions:r,latitudePath:o,longitudePath:a,sizeRatio:l,tiles:d}=t;if(i!=null&&typeof i!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a URL string");if(s!=null&&typeof s!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a string");if(d!=null){if(!(Ce(d)||d instanceof e.Layer))throw new TypeError("Geo mode: tiles must be a object or L.Layer instance");const h=d;if(h.url!=null&&typeof h.url!="string")throw new TypeError("Geo mode: tiles.url must be a string");if(h.subdomains!=null&&typeof h.subdomains!="string")throw new TypeError("Geo mode: tiles.subdomains must be a string");if(h.tms&&typeof h.tms!="boolean")throw new TypeError("Geo mode: tiles.tms must be a boolean");if(h.wms&&typeof h.wms!="boolean")throw new TypeError("Geo mode: tiles.wms must be a boolean")}if(n!=null&&typeof n!="string")throw new TypeError("Geo mode: Map attribution must be a string");if(r!=null&&!Ce(r))throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object");if(o!=null&&typeof o!="string"&&!Array.isArray(o))throw new TypeError("Geo mode: Latitude path must be a valid property path: a string or an array of strings.");if(a!=null&&typeof a!="string"&&!Array.isArray(a))throw new TypeError("Geo mode: Longitude path must be a valid property path: a string or an array of strings.");if(l!=null&&(!isFinite(l)||l<=0))throw new TypeError("Geo mode: sizeRatio must be a positive number.")}function JA(t,e={}){if(e.tiles===void 0||e.tileUrlTemplate||e.tileUrlSubdomains){const s=hn.tiles;return{...e.tiles||{},...hn.tiles,url:e.tileUrlTemplate||s.url,subdomains:e.tileUrlSubdomains||s.subdomains}}return Ce(e.tiles)?{...t.tiles,...e.tiles}:e.tiles}function tS(t,e){return t.attribution!==e.attribution||t.tiles!==e.tiles}var eS=Ii().createElement("div");function sS(t){const e=Ii().createElement("div");e.className="ogma-geo-container",Cn(e,"100%","100%");const s=t||eS;return s.insertBefore(e,s.firstChild),e}function iS(t){const e=[[1/0,1/0],[-1/0,-1/0]];return t.getGeoCoordinates().reduce((s,{latitude:i,longitude:n})=>{const[r,o]=s;return r[0]=Math.min(r[0],i),r[1]=Math.min(r[1],n),o[0]=Math.max(o[0],i),o[1]=Math.max(o[1],n),s},e)}function nS(t,e,s,i){const n=e._indexes;t.getNodeAttribute(si).setMultiple(n,s),t.getNodeAttribute(ii).setMultiple(n,i)}function rS(t,e,s){const{longitudePath:i,latitudePath:n,wrapCoordinates:r}=s,[o,a]=t.getAttributes(!0,[si,ii]),l=e._indexes,d=e.getId(),h=l.length,u=e.getData(n),c=e.getData(i);for(let g=0;g<h;g++){let f=c[g],m=u[g];const _=l[g],p=d[g];m!=null&&f!=null&&(hy(p,f),uy(p,m),r&&(f%=180,m=Os(+m,-85.0511287798,Dp)),a.set(_,f),o.set(_,m))}}function oS(t,{longitudePath:e,latitudePath:s,wrapCoordinates:i},n){const r=t.getData(e),o=t.getData(s);return r!=null&&o!=null&&(!(!i&&!n)||Math.abs(o)<=Dp&&Math.abs(r)<=180)}function $o(t,e,s,i){aS(t,!0,e,s,i)}function aS(t,e,s,i,n){const r=t.getAttribute(e,i),o=t.getAttribute(e,n),a=s._indexes;o.setMultiple(a,r.getMultiple(a))}function lS(t){return t.reduce((e,{nodes:s,newValues:i})=>{if(!s)return e;const n=s.filter((r,o)=>i[o]!=null);return e?e.concat(n):n},null)}function dS(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","radius"]).forEach(({text:s,radius:i},n)=>{e[t.get(n).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:s.minVisibleSize,size:Math.max(1,Number(i))}}),e}function wg(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","minVisibleSize","width"]).forEach(({text:s,minVisibleSize:i,width:n},r)=>{e[t.get(r).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:i,size:Math.max(1,Number(n))}}),e}function hS(t,e,s){if(!e||!Object.keys(e).length)return Promise.resolve();const i=t.getId().filter(n=>e[n]).map(n=>{if(!e[n])return 0;const r=Number(e[n]["text.minVisibleSize"]),o=Number(e[n].minVisibleSize),a=Number(e[n]["text.size"]),l=Number(e[n]["text.scale"]),d=Number(e[n].size)*l*s;return d<=o||d<=r?0:a});return t.setAttribute("text.size",i)}function uS(t,e){const s=t.getId().map(i=>{const n=e[i]||{};return Number(n["text.size"])});return t.setAttribute("text.size",s)}var cS=t=>YA().rotate([-t.longitude,-t.latitude]).scale(oA),Tg=new Uint32Array(1),js=class{constructor(t,e){this.size=1,this.isNode=!0,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return Tg[0]=this._index,Tg}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this._ogma.modules.camera.graphToScreenCoordinates(this.getPosition())}isInScreen(){const t=this.getPositionOnScreen(),e=this._ogma.modules.camera;return t.x>=0&&t.x<=e.width&&t.y>=0&&t.y<=e.height}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)[0]}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}getConnectedComponent(t){return this._ogma.modules.graph.getConnectedComponentByNode(this,t)[0]}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.nodeList(new Uint32Array([+this._index]))}getId(){return Gl(this._ogma.modules.graph,this)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Fp(t),i=this.getAttributes(e);return{id:this.getId(),attributes:i,data:s(Ae(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getGeoCoordinates(){const t=this._ogma.modules.graph,e=t.getNodeAttribute(si).get(this._index),s=t.getNodeAttribute(ii).get(this._index);return{latitude:Sg(e)?e:void 0,longitude:Sg(s)?s:void 0}}setGeoCoordinates(t){return this.toList().setGeoCoordinates([t]).then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNode(this)}getSubNodes(){return this._ogma.modules.transformations.getSubNodes(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};Vl([js],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var Pi=class{constructor(t,e){this.isList=!0,this.isNode=!0,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this.getPosition().map(t=>this._ogma.modules.camera.graphToScreenCoordinates(t))}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)}getConnectedComponents(t){return this._ogma.modules.graph.getConnectedComponents(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}isVirtual(){return this.map(t=>this._ogma.modules.transformations.isElementVirtual(t))}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return Lp(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.nodeList(this._indexes.slice())}getId(){return Gl(this._ogma.modules.graph,this)}get(t){return Pp(this._ogma.modules.graph,this,t)}forEach(t){pp(this._ogma.modules.graph,this,t)}find(t){return Ep(this._ogma.modules.graph,this,t)}some(t){return vp(this._ogma.modules.graph,this,t)}every(t){return bp(this._ogma.modules.graph,this,t)}map(t){return yp(this._ogma.modules.graph,this,t)}[Symbol.iterator](){let t=-1;return{next:()=>({value:this.get(++t),done:t>=this.size})}}filter(t){return xp(this._ogma.modules.graph,this,t)}reduce(t,e){return Sp(this._ogma.modules.graph,this,t,e)}concat(t){return Cp(this._ogma.modules.graph,this,t)}dedupe(){return wp(this._ogma.modules.graph,this)}subtract(t){return Tp(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.nodeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof js?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}inverse(){return Ip(this._ogma.modules.graph,this)}sort(t){return Rp(this._ogma.modules.graph,this,t)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!He(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getGeoCoordinates(){const t=this._ogma.modules.graph,e=new Array(this._indexes.length),s=t.getNodeAttribute(si).getMultiple(this._indexes),i=t.getNodeAttribute(ii).getMultiple(this._indexes);for(let n=0,r=this._indexes.length;n<r;n++)e[n]={latitude:s[n],longitude:i[n]};return e}setGeoCoordinates(t){const e=this._ogma.modules.geo,s=this.getId(),i=this._indexes,n=new Array(i.length),r=new Array(i.length);if(t===null&&(t=new Array(i.length).fill(null)),t.length!==i.length)throw new RangeError("You must provide coordinates for each node in the NodeList");for(let l=0,d=i.length;l<d;l++){let{latitude:h,longitude:u}=t[l]||{latitude:void 0,longitude:void 0};const c=s[l];h==null&&u==null?h=u=void 0:(uy(c,h),hy(c,u)),n[l]=h,r[l]=u}this.setData(e.latitudePath,n),this.setData(e.longitudePath,r);const{dom:o,graph:a}=this._ogma.modules;return nS(a,this,n,r),this._ogma.modules.geo.isEnabled()?o.afterNextFrame().then(()=>o.afterNextFrame()).then(()=>this):o.afterNextFrame().then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaNode(){return this._ogma.modules.transformations.getMetaNodes(this)}getSubNodes(){return this.map(this._ogma.modules.transformations.getSubNodes)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};Vl([Pi],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var Oi=()=>(t,e)=>t[e],ki=()=>(t,e,s)=>{t[e]=s},Ig={1:_d(1),2:_d(2),4:_d(4),8:Oi(),16:Oi(),32:Oi(),int8:Oi(),int16:Oi(),int32:Oi(),float:Oi(),any:Oi()},Cg={1:pd(1),2:pd(2),4:pd(4),8:ki(),16:ki(),32:ki(),int8:ki(),int16:ki(),int32:ki(),float:ki(),any:ki()};function _d(t){const e=8/t,s=(1<<t)-1;return(i,n)=>i[n/e|0]>>n%e*t&s}function pd(t){const e=8/t,s=Math.pow(2,t)-1;return(i,n,r)=>{const o=n%e*t,a=n/e|0,l=r<<o,d=255-(s-r<<o);i[a]=i[a]&d|l}}function gS(t,e){return t===void 0&&e!=="any"&&e!=="resource"?0:t}var fS={get(t){return this._getArrayElt(this._buffer,t)},set(t,e){this._setArrayElt(this._buffer,t,e)}},mS={get(t){return this._byIndex[this._getArrayElt(this._buffer,t)]},set(t,e){let s=this._byName[e];s===void 0&&(s=this._nextIndex++,this._byIndex.push(e),this._getElementBitSize()>this._elementSize&&this.increaseElementSize(),this._byName[e]=s),this._setArrayElt(this._buffer,t,s)}},_S=0,ul=class{constructor(t){this._id=_S++,this._initialized=!1;const e=t.name,s=t.storage,i=t.size||0,n=gS(t.default,s),r=Math.max(8,Lg(i+1)),o=s==="resource"?1:s;this._name=e,this._storage=s,this._getArrayElt=Ig[o],this._setArrayElt=Cg[o],this._elementSize=o,this._nbElements=r,this._fallback=null,this._byName=void 0,this._byIndex=void 0,this._nextIndex=void 0,this._defaultValue=n,this._BASE_VALUE=s==="any"?void 0:0,this._methods=fS,this._initialized=!1,this._buffer=null,s==="resource"&&(this._methods=mS,this._byName=Object.create(null),this._byIndex=[],this._nextIndex=1,this._byName[n]=0,this._byIndex.push(n))}getValues(){return Object.keys(this._byName||{})}getName(){return this._name||""}setDefaultValue(t){this._defaultValue=t,this._storage==="resource"&&(this._byName[t]=0,this._byIndex[0]=t)}get(t){return this._get(t)}set(t,e){this._set(t,e)}_get(t){return this._defaultValue}_set(t,e){e!==this._defaultValue&&(this._initialize(),this._set(t,e))}setFallback(t){this._fallback=t,this.get=this._getWithFallback}_getWithFallback(t){const e=this._get(t);return e===void 0&&this._fallback?this._fallback.get(t):e}_initialize(){this._initialized=!0,this._buffer=yd(this._nbElements,this._elementSize),this._get=this._methods.get,this._set=this._methods.set,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(0)}grow(t){const e=Lg(t+1);if(!(e<=this._nbElements)){if(this._initialized)if(this._elementSize==="any")for(let s=this._nbElements;s<e;++s)this._buffer.push(this._defaultValue);else{const s=yd(e,this._elementSize);s.set(this._buffer),this._buffer=s,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(this._nbElements)}this._nbElements=e}}increaseElementSize(){const t=this._elementSize;if(typeof t!="number"||t===32)throw new Error("FlexArray: cannot increase element size");const e=2*t,s=Ig[e],i=Cg[e];if(this._initialized){const n=this._nbElements,r=this._getArrayElt,o=this._buffer,a=yd(n,e);if(t>=8)a.set(o);else for(let l=0;l<n;++l)i(a,l,r(o,l));this._buffer=a}this._elementSize=e,this._getArrayElt=s,this._setArrayElt=i}buffer(){if(!this._buffer)throw new Error("FlexArray: buffer not instantiated");return this._buffer}elementBitSize(){return this._elementSize}capacity(){return this._nbElements}byteSize(){return this._nbElements*this._elementSize/8}isInitialized(){return this._initialized||this._fallback&&this._fallback.isInitialized()}getMultiple(t,e){const s=t.length;e===void 0&&(e=new Array(s));for(let i=0,n=s;i<n;++i)e[i]=this.get(t[i]);return e}fill(t,e){for(let s=0,i=t.length;s<i;++s)this.set(t[s],e)}setMultiple(t,e,s){if(s||!Array.isArray(e)&&!ArrayBuffer.isView(e))for(let i=0,n=t.length;i<n;++i)this.set(t[i],e);else for(let i=0,n=t.length;i<n;++i)this.set(t[i],e[i])}reset(){return this._initialized&&this._reset(0),this}_reset(t){const e=this._storage==="resource"?0:this._defaultValue;if(this._buffer)if(typeof this._elementSize!="number"||this._elementSize>=8)this._buffer.fill(e,t);else{const s=8/this._elementSize;let i=0;for(let n=0;n<s;++n)i<<=this._elementSize,i+=e;if(t===void 0)this._buffer.fill(i);else{const n=t+(8-t%8);for(let r=t;r<n;++r)this._setArrayElt(this._buffer,r,e);this._buffer.fill(i,n/8)}}}_getElementBitSize(){if(this._nextIndex)return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))}};function Lg(t){let e=2;for(;e<t;)e*=2;return e}function yd(t,e){return e==="any"?new Array(t):e==="float"?new Float32Array(t):e==="int8"?new Int8Array(t):e==="int16"?new Int16Array(t):e==="int32"?new Int32Array(t):e===32?new Uint32Array(t):e===16?new Uint16Array(t):new Uint8Array(Math.ceil(t/8*e))}var Ng=4,gy=class{constructor(){this._buffer=new Uint32Array(Ng),this._capacity=Ng,this._size=0,this._busy=!1}isBusy(){return this._busy}markBusy(){return this._busy=!0,this}sliceAndReset(){this._busy=!1;const t=this.slice(0,this._size);return this.reset(),t}reset(){return this._size=0,this}reserve(t){return t>this._capacity&&this._setCapacity(Hi(t)),this}_setCapacity(t){const e=new Uint32Array(t);e.set(this._buffer),this._buffer=e,this._capacity=t}push(t){return this._size===this._capacity&&this._setCapacity(2*this._capacity),this._buffer[this._size++]=t,this}pushUnchecked(t){return this._buffer[this._size++]=t,this}slice(t=0,e=this._size){return this._buffer.slice(t,e)}getBuffer(){return this._buffer}getLength(){return this._size}getCapacity(){return this._capacity}setLength(t){return this._size=t,this}isEmpty(){return this._size===0}},Mg=class{constructor(t){this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._flexArrays=[],this._defaultValues=[],this._flexArraysByName={},this._indexLists=[],this._name=t?"node":"edge",this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._idFlexArray=new ul({storage:"int32"}),this._idFlexArray.get=e=>this._indexToId[e],this._idFlexArray.getMultiple=e=>{const s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=this._indexToId[e[i]];return s},this._flexArraysByName.id=this._idFlexArray}addElements(t){const e=[];for(let s=0,i=t.length;s<i;++s){const n=t[s];let r=this._idToIndex[n];r===void 0&&(r=this._getNextIndex(),this._idToIndex[n]=r,this._indexToId[r]=n),e.push(r)}for(const s of this._flexArrays)s.grow(this._nextIndex);for(const s of this._indexLists)s.reserve(this._nextIndex);return new Uint32Array(e)}removeElements(t){for(let e=0,s=t.length;e<s;++e){const i=t[e],n=this._indexToId[i];n!==void 0&&(delete this._idToIndex[n],this._removeIndex(i))}}clear(){this._idToIndex=Object.create(null),this._indexToId=[void 0],this._nextIndex=1,this._freeIndexes=[];for(const t of this._flexArrays)t.reset();for(const t of this._indexLists)t.reset()}has(t){return this._indexToId[t]!==void 0}getIndex(t,e=!1){const s=this._idToIndex[t];if(s===void 0&&e)throw new Error(`${this._name} id "${t}" not found`);return s}createFlexArray(t,e){const{name:s}=t;if(s&&e&&this._flexArraysByName[s])throw new Error(`${this._name} flexArray "${s}" already exists`);let i=t.default;i===void 0&&t.storage!=="any"&&t.storage!=="resource"&&(i=0);const n=this._nextIndex,r={storage:t.storage,size:n,name:s,default:i};let o;return o=(i===void 0&&t.storage!=="any"&&t.storage,new ul(r)),this._flexArrays.push(o),this._defaultValues.push(t.default),s&&e&&(this._flexArraysByName[s]=o),o}getFlexArray(t){return this._flexArraysByName[t]}getAllFlexArrays(){return this._flexArraysByName}createIndexList(){const t=new gy;return t.reserve(this._nextIndex),this._indexLists.push(t),t}getId(t){return this._indexToId[t]}getMaxIndex(){return this._nextIndex-1}_removeIndex(t){this._indexesToBeFreed.push(t)}_getNextIndex(){let t=this._freeIndexes.pop();return t===void 0&&(t=this._nextIndex++),t}freeIndexes(){for(const t of this._indexesToBeFreed)this._indexToId[t]=void 0,this._freeIndexes.push(t);for(let t=0;t<this._flexArrays.length;++t){const e=this._flexArrays[t],s=this._defaultValues[t];for(const i of this._indexesToBeFreed)e.set(i,s)}this._indexesToBeFreed=[]}},Pg=(t,e)=>(t+e)*(t+e+1)/2+e;function xr(t,e){const s=t<e?t:e;return 67108864*s+(t+e-s)}var pS=8,bh=class{constructor(){this._BIG_LIST=255,this._MAX_LIST_SIZE=8,this._capacity=pS,this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){return t===void 0&&(t=this._nextIndex++),t>=this._capacity&&this._reserve(t+1),this._sizes[t]=0,t}get(t){const e=this._sizes[t],s=this._MAX_LIST_SIZE*t;if(e<=this._MAX_LIST_SIZE){this._constList.length=e;for(let i=0,n=e;i<n;++i)this._constList[i]=this._buffer[s+i];return this._constList}if(e===this._BIG_LIST){const i=this._buffer[s];return this._bigLists[i]}throw new Error(`Table: ${t} out of bounds (${e})`)}size(t){const e=this._sizes[t];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=t[a],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._sizes[t],i=t*this._MAX_LIST_SIZE;if(s<this._MAX_LIST_SIZE)this._buffer[i+s]=e,this._sizes[t]=s+1;else if(s===this._BIG_LIST){const n=this._buffer[i];this._bigLists[n].push(e)}else{const n=new Array(this._MAX_LIST_SIZE);for(let r=0;r<this._MAX_LIST_SIZE;++r)n[r]=this._buffer[i+r];n.push(e),this._bigLists.push(n),this._sizes[t]=this._BIG_LIST,this._buffer[i]=this._bigLists.length-1}return this}removeFrom(t,e){return this.removeFromAndGetSize(t,e),this}removeFromAndGetSize(t,e){const s=this._MAX_LIST_SIZE*t;let i=this._sizes[t];if(i<=this._MAX_LIST_SIZE){for(let n=s,r=s+i;n<r;++n)if(this._buffer[n]===e)return i-=1,this._buffer[n]=this._buffer[r-1],this._sizes[t]=i,i}else if(i===this._BIG_LIST){const n=this._buffer[s],r=this._bigLists[n],o=r.indexOf(e);if(o!==-1)return r.splice(o,1),r.length}throw new Error('topology: Table: "removeFrom" failed, should not happen')}reserve(t){return this._capacity<t&&this._reserve(t),this}_reserve(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=Rg(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=Rg(this._sizes,this._capacity)}};function Rg(t,e){const s=new t.constructor(e);return s.set(t),s}var yS=1,xS=2,bS=3,vS=4,ES=5,AS=6,vh="_visible",Eh="_data",Kr="_hovered",Ah="_hoverExtremityHighlighted",_e="_selected",Sh="_selectionExtremityHighlighted",Va="_dragged",fy="_rewirable",un="_export",my="_faded",_y="_transparent",SS="_visual_groups",Co=-1,Zo="in",Ko="out",xd="both",Fg=[_e,Va,Sh,Kr,Ah,fy,un,my,_y,SS],py=2,yy=3,wS=3,TS=4,xy=-1,IS=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"],CS=15,Pn=void 0,LS=class{constructor(t){this._neighborTable=new bh,this._parallelTable=new bh,this._parallelEdgesIndex=[],this._hasParallelEdges=new Set,this._fakeDeduper={get:()=>0,set:Yt,reset(){return this}},this._fakeInvertedDeduper={get:()=>1,set:Yt,reset(){return this}},this._graph=t,this.nodeDeduper=t.createNodeAttribute({storage:1},!1),this.edgeDeduper=t.createEdgeAttribute({storage:1},!1),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target")}getAdjacentDirections(t){return this._neighborTable.get(t)}getEdgeIndexesInDirection(t){return this._parallelTable.get(t)}allocateNodes(t){this._neighborTable.reserve(t.length);for(let e=0;e<t.length;++e)this._neighborTable.addEntry(t[e])}allocateEdges(t,e,s){this._parallelTable.reserve(Math.floor(t.length/2));for(let i=0;i<t.length;i++){const n=t[i],r=e[i],o=s[i];this._sourceList.set(n,r),this._targetList.set(n,o),this.addToAdjacencyList(n)}}getExtremity(t,e){const s=t?this._sourceList:this._targetList;if(e.isList){const i=this._graph.acquireIndexList(!0);for(let n=0;n<e._indexes.length;n++)i.push(s.get(e._indexes[n]));return this._graph.nodeList(i.sliceAndReset())}return this._graph.getObjectList(!0).get(s.get(e._index))}setExtremities(t,e,s){for(let i=0;i<t.length;++i)this.removeFromAdjacencyList(t[i]);e!==null&&this._sourceList.setMultiple(t,e),s!==null&&this._targetList.setMultiple(t,s);for(let i=0;i<t.length;++i)this.addToAdjacencyList(t[i])}addToAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=xr(e,s);let n=this._parallelEdgesIndex[i];if(n===Pn)n=this._parallelTable.addEntry(),this._parallelEdgesIndex[i]=n,this._neighborTable.addTo(e,n),e!==s&&this._neighborTable.addTo(s,n);else{this._hasParallelEdges.add(t);const r=this._parallelTable.get(+n);if(r)for(const o of r)this._hasParallelEdges.add(o)}this._parallelTable.addTo(n,t)}hasParallelEdges(t){return this._hasParallelEdges.has(t)}removeFromAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=xr(e,s),n=this._parallelEdgesIndex[i];n!==Pn&&this._parallelTable.removeFromAndGetSize(n,t)===0&&(this._neighborTable.removeFrom(e,n),e!==s&&this._neighborTable.removeFrom(s,n),this._parallelEdgesIndex[i]=Pn,this._hasParallelEdges.delete(t))}getParallelEdges(t,e={}){const s=e.filter||"visible",i=this._graph.acquireIndexList(!1),n=this._graph.getFilter(!1,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r],a=xr(this._sourceList.get(o),this._targetList.get(o)),l=this._parallelEdgesIndex[a];if(l!==Pn){const d=this._parallelTable.get(+l);if(d)for(const h of d)n(h)&&i.push(h)}}return this._graph.edgeList(i.sliceAndReset())}fastGetNodesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=this._neighborTable.get(o);for(const l of a){const d=this._parallelTable.get(l),h=d[0],u=i.get(h),c=n.get(h);if(u!==0&&c!==0){e.push(u+c-o);for(const g of d)s.push(g)}}}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}fastGetEdgesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=i.get(o),l=n.get(o),d=xr(a,l),h=this._parallelEdgesIndex[d];if(h!==Pn){const u=this._parallelTable.get(+h);if(u)for(const c of u)s.push(c)}e.push(a),e.push(l)}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}getDeduper(t){return(t?this.nodeDeduper:this.edgeDeduper).reset()}collectAdjacentEdges(t,e,s,i=!1,n=!1){const r=e===Zo,o=!(e===Ko||r||n),a=this._graph.acquireIndexList(!1),l=this._graph.getFilter(!1,s),d=i?this.getDeduper(!1):this._fakeDeduper;let h=this._fakeInvertedDeduper;const u=this._sourceList,c=this._targetList;if(n){h=this.getDeduper(!0);for(let g=0;g<t.length;g++)h.set(t[g],1)}for(let g=0;g<t.length;g++){const f=t[g],m=this._neighborTable.get(f);for(const _ of m){const p=this._parallelTable.get(_);if(o)for(const x of p)l(x)&&d.get(x)===0&&(a.push(x),d.set(x,1));else for(const x of p){const y=u.get(x),b=c.get(x),v=y+b-f;r!==(b===f)&&y!==b||!l(x)||d.get(x)!==0||h.get(v)!==1||(a.push(x),d.set(x,1))}}}return a.sliceAndReset()}collectAdjacentNodes(t,e,s,i=!1,n,r){const o=e!==Zo,a=e!==Ko,l=this._graph.acquireIndexList(!0),d=this._graph.getFilter(!1,s),h=i?this.getDeduper(!0):this._fakeDeduper,u=this._sourceList,c=this._targetList;if(n)for(let g=0;g<n.length;g++){const f=n[g];l.push(f),h.set(f,1)}if(r)for(let g=0;g<r.length;g++){const f=r[g];h.set(f,1)}for(let g=0;g<t.length;g++){const f=t[g],m=this._neighborTable.get(f);for(const _ of m){const p=this._parallelTable.get(_);for(const x of p)if(d(x)){const y=u.get(x),b=c.get(x),v=y+b-f;if((a&&f===b||o&&f===y)&&h.get(v)===0){l.push(v),h.set(v,1);break}}}}return l.sliceAndReset()}getAdjacentElements(t,e,s={}){const i=s.direction||xd,n=s.filter||"visible",r=s.policy||"union",o=!!s.bothExtremities;if(t){const a=r==="include-sources"?e:null,l=r==="exclude-sources"?e:null;return this.collectAdjacentNodes(e,i,n,!0,a,l)}return this.collectAdjacentEdges(e,i,n,!0,o)}getEdgesBetweenTwoNodes(t,e){const s=xr(t,e),i=this._parallelEdgesIndex[s];if(i===Pn)return new Uint32Array;const n=this._parallelTable.get(+i);return new Uint32Array(n)}getConnectedComponents(t,{filter:e="visible",returnIds:s=!1,internalIndexes:i=!1}={}){const n=this._graph,r=[],o={},a=n.acquireIndexList(!0);let l;typeof e=="string"?l=n.getFilter(!0,e):(l=e,e="visible");for(let u=0;u<t.length;u++){const c=t[u];l(c)&&a.push(c)}const d=a.sliceAndReset(),h={filter:e};for(let u=0;u<d.length;u++){const c=d[u];if(!o[c]){const g=[c],f=[];for(;g.length!==0;){const m=g.pop();!o[m]&&l(m)&&(g.push.apply(g,this.getAdjacentElements(!0,new Uint32Array([m]),h)),o[m]=!0,f.push(m))}f.length>0&&r.push(f)}}if(s){const u=n.getNodeAttribute("id");for(let c=0;c<r.length;c++)r[c]=u.getMultiple(r[c])}else if(!i)for(let u=0;u<r.length;u++)r[u]=n.nodeList(new Uint32Array(r[u]));return r}getAdjacencyList({directed:t,ids:e,weight:s,nodes:i}){const n=t?Ko:xd,r=new Array(i.length),o=this._graph;for(let f=0;f<i.length;++f)r[f]=this.collectAdjacentEdges(new Uint32Array([i[f]]),n,"all");const a=o.getEdgeAttribute("source"),l=o.getEdgeAttribute("target"),d=o.getEdgeAttribute("width"),h=o.getNodeAttribute("id"),u=[],c=typeof s=="number",g=typeof s!="function"&&!c&&!!s;for(let f=0;f<r.length;f++){const m=r[f],_=i[f],p=m.length,x=e?new Array(p):new Uint32Array(p),y=new Array(p);for(let v=0;v<p;v++){const E=m[v],A=a.get(E),S=l.get(E);let w=t||_===A?S:A;if(e&&(w=h.get(w)),x[v]=w,s){if(c&&(y[v]=s),typeof s=="function"){const L=o.getNode(A),T=o.getNode(S);y[v]=s(L,T)}g&&(y[v]=d.get(E)||1)}}const b={nodes:x,id:e?h.get(_):_,...s&&{weights:y}};u.push(b)}return u}degrees(t,e){if(e!==Zo&&e!==Ko)return this._neighborTable.sizes(t);const s=new Array(t.length),i=e===Zo;for(let n=0,r=t.length;n<r;n++)s[n]=this._degree(t[n],i);return s}_degree(t,e){const s=this._neighborTable.get(t),i=this._sourceList,n=this._targetList;let r=0;for(let o=0;o<s.length;++o){const a=this._parallelTable.get(s[o]);for(let l=0;l<a.length;++l){const d=a[l],h=i.get(d),u=n.get(d);if(e&&u===t||!e&&h===t){r+=1;break}}}return r}getDegree(t,e){const{direction:s,filter:i}=this._getDegreeOptions(e),n=new Array(t.length),r=new Uint32Array(1);for(let o=0;o<t.length;++o)r[0]=t[o],n[o]=this.collectAdjacentNodes(r,s,i).length;return n}_getDegreeOptions(t){const e={direction:xd,filter:"visible"};return typeof t=="string"?e.direction=t:t&&(typeof t.direction=="string"&&(e.direction=t.direction),typeof t.filter=="string"&&(e.filter=t.filter)),e}},Bt=class{constructor(t){this._ogma=t}_setModules(t){this._modules=t}onMounted(){}onReady(t){}destroy(t){}},NS=class extends Bt{constructor(){super(...arguments),this.storage={nodes:new Mg(!0),edges:new Mg(!1),fetch(t){return t?this.nodes:this.edges}},this._promisesToResolve=[],this._nodeIndexLists=[],this._edgeIndexLists=[],this._onNewFrame=()=>{this.storage.nodes.freeIndexes(),this.storage.edges.freeIndexes()}}onMounted(){this._modules.events.register(["preAddElements","addNodes","addEdges","preAddGraph","postAddGraph","addGraph","excludedStateChange","clearGraph","afterRemoveNodes","beforeRemoveNodes","requestElementsToDelete","removeNodes","beforeRemoveEdges","afterRemoveEdges","removeEdges"]),[{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}].forEach(t=>{this.createNodeAttribute(t,!0),this.createEdgeAttribute(t,!0)}),this.node=this._ogma.node,this.edge=this._ogma.edge,this.nodeList=this._ogma.nodeList,this.edgeList=this._ogma.edgeList,this._nodes=this.createAttribute(!0,{name:"object",storage:"any"},!0),this._edges=this.createAttribute(!1,{name:"object",storage:"any"},!0),this.createAttribute(!1,{name:"source",storage:32},!0),this.createAttribute(!1,{name:"target",storage:32},!0),this._nodeFilters=ig(this.storage.nodes),this._edgeFilters=ig(this.storage.edges),this._initialize(),this._modules.events.on("frame",this._onNewFrame)}onReady(t){if(t.graph){const{nodes:e,edges:s}=t.graph;e&&this.addNodes(e),s&&this.addEdges(s)}}createIndexList(t){return this.storage.fetch(t).createIndexList()}getDom(){return this._modules.dom}acquireIndexList(t){const e=t?this._nodeIndexLists:this._edgeIndexLists;let s=e.find(i=>!i.isBusy());return s||(s=this.createIndexList(t),e.push(s)),s.markBusy(),s}getObjectList(t){return t?this._nodes:this._edges}getListFactory(t){return t?this.nodeList:this.edgeList}getStorage(t){return t?this.storage.nodes:this.storage.edges}getFilter(t,e){const s=t?this._nodeFilters:this._edgeFilters;return s[e]||s.visible}fireEvent(t,e){this._modules.events.fire(t,e)}getCacheLists(t){return t?this._nodeCacheLists:this._edgeCacheLists}_resolvePromises(){const t=this._promisesToResolve;this._promisesToResolve=[],t.forEach(e=>e())}_initialize(){this._nodeCacheLists=ng(()=>this.getNodeMaxIndex(),()=>this.acquireIndexList(!0),this._nodeFilters),this._edgeCacheLists=ng(()=>this.getEdgeMaxIndex(),()=>this.acquireIndexList(!1),this._edgeFilters),this.topology=new LS(this),this._resolvePromises()}getNodeMaxIndex(){return this.storage.nodes.getMaxIndex()}getEdgeMaxIndex(){return this.storage.edges.getMaxIndex()}isExcluded(t){return this.storage.fetch(t.isNode).getFlexArray("excluded").getMultiple(t._indexes)}setExcluded(t,e){const s=e?1:0,i=t.isNode,n=this.storage.fetch(i),r=n.getFlexArray("excluded"),o=n.getFlexArray("removed"),a=this.acquireIndexList(i),l=this.getListFactory(i);for(let h=0;h<t._indexes.length;h++){const u=t._indexes[h],c=r.get(u),g=o.get(u);s!==c&&g===0&&a.push(u)}const d=a.sliceAndReset();if(d.length){this.getCacheLists(t.isNode).visible.invalidList();const h=l(d);r.setMultiple(d,s),this._modules.events.fire("excludedStateChange",{elements:h,value:e})}}addNode(t,e){return cl(this,!0,t,e)}addEdge(t,e){return cl(this,!1,t,e)}addNodes(t,e){return lr(this,!0,t,e)}addEdges(t,e){return lr(this,!1,t,e)}getExtremityIndex(t,e,s,i){if(e instanceof js)return e._index;{const n=this.storage.nodes.getIndex(e);if(!n&&!i)throw new Error(`addEdge(s): invalid ${s===0?"source":"target"} for edge "${t}"; node "${e}" does not exist`);return n}}getNodes(t){return this.getElements(!0,t)}getEdges(t){return this.getElements(!1,t)}getElements(t,e){const s=t?this.nodeList:this.edgeList,i=t?Pi:Ln,n=t?js:Zi;if(e&&typeof e!="string"){const r=this.acquireIndexList(t),o=this.storage.fetch(t);if(e instanceof n)r.push(e._index);else if(He(e)){const a=e;for(const l of a)if(l instanceof n)r.push(l._index);else{const d=o.getIndex(l);d&&r.push(d)}}else if(e instanceof i){const a=this.getFilter(t,"all"),l=e;for(let d=0;d<l._indexes.length;d++){const h=l._indexes[d];a(h)&&r.push(h)}}return s(r.sliceAndReset())}{const r=e||"visible",o=this.getCacheLists(t)[r];if(!o)throw new Error(`getNodes/getEdges: unexpected argument "${r}"`);return s(o.getList())}}getNode(t){return this._getElement(!0,t)}getEdge(t){return this._getElement(!1,t)}_getElement(t,e){if(e instanceof(t?js:Zi))return e;const s=this.getStorage(t),i=this.getObjectList(t),n=s.getIndex(e);return n?i.get(n):void 0}clear(){this._modules.events.fire("clearGraph",{nodes:this.getNodes("all"),edges:this.getEdges("all")}),this.storage.nodes.clear(),this.storage.edges.clear(),this._initialize()}createAttribute(t,e,s=!1){return this.storage.fetch(t).createFlexArray(e,s)}createNodeAttribute(t,e){return this.createAttribute(!0,t,e)}createEdgeAttribute(t,e){return this.createAttribute(!1,t,e)}getAttribute(t,e){return this.storage.fetch(t).getFlexArray(e)}getAttributes(t,e){return e.map(s=>this.getAttribute(t,s))}getNodeAttribute(t){return this.storage.nodes.getFlexArray(t)}getNodeAttributes(t){return this.getAttributes(!0,t)}getEdgeAttribute(t){return this.storage.edges.getFlexArray(t)}getEdgeAttributes(t){return this.getAttributes(!1,t)}getAllNodeAttributes(){return this.storage.nodes.getAllFlexArrays()}getAllEdgeAttributes(){return this.storage.edges.getAllFlexArrays()}setSource(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,s._indexes,null)}setTarget(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,null,s._indexes)}getParallelEdges(t,e={}){return this.topology.getParallelEdges(t,e)}hasParallelEdges(t){return this.topology.hasParallelEdges(t._index)}getEdgesBetweenTwoNodes(t,e){return this.edgeList(this.topology.getEdgesBetweenTwoNodes(t._index,e._index))}getAdjacentDirections(t){return this.topology.getAdjacentDirections(t)}getEdgeIndexesInDirection(t){return this.topology.getEdgeIndexesInDirection(t)}fastGetNodesAdjacentElements(t){const e=this._ogma.getNodes();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:e,edges:this._ogma.getEdges()}:this.topology.fastGetNodesAdjacentElements(t._indexes)}fastGetEdgesAdjacentElements(t){const e=this._ogma.getEdges();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:this._ogma.getNodes(),edges:e}:this.topology.fastGetEdgesAdjacentElements(t._indexes)}getAdjacentNodes(t,e){return this.nodeList(this.topology.getAdjacentElements(!0,t._indexes,e))}getAdjacentEdges(t,e){return this.edgeList(this.topology.getAdjacentElements(!1,t._indexes,e))}getDegree(t,e){return this.topology.getDegree(t._indexes,e)}degrees(t,e){return this.topology.degrees(t,e)}getAdjacencyList({directed:t=!1,internalIndexes:e=!1,weight:s=1,nodes:i,indexes:n}={}){return this.topology.getAdjacencyList({directed:t,weight:s,ids:!e,nodes:n||this.getNodes(i)._indexes})}getConnectedComponents(t,e){return this.topology.getConnectedComponents(t._indexes,e)}getConnectedComponentByNode(t,e){return this.topology.getConnectedComponents(t._indexes,e)}};function cl(t,e,s={},i={}){return uo(t,e,[s],i).get(0)}function MS(t,{nodes:e=[],edges:s=[]},i={}){if(t.fireEvent("preAddGraph",{name:"preAddGraph"}),!i.batchSize)return Promise.all([uo(t,!0,e,i),uo(t,!1,s,i)]).then(([r,o])=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{nodes:r,edges:o}),{nodes:r,edges:o}));let n;return lr(t,!0,e,i).then(r=>(n=r,lr(t,!1,s,i))).then(r=>({nodes:n,edges:r})).then(r=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{name:"addGraph"}),r))}function lr(t,e,s,i={}){if(i.batchSize){const n=[];for(let a=0;a<s.length;a+=i.batchSize)n.push(s.slice(a,a+i.batchSize));const r=(a,l)=>{let d;return a.then(h=>(d=h,t.getDom().afterNextFrame())).then(()=>uo(t,e,l,i)).then(h=>d.concat(h))},o=e?t.nodeList():t.edgeList();return n.reduce(r,Promise.resolve(o))}return Promise.resolve(uo(t,e,s,i))}function uo(t,e,s,i){const{virtual:n=!1}=i;t.fireEvent("preAddElements",{name:"preAddElements",objects:s,virtual:n,isNode:e});const r=!!i.ignoreInvalid,o=t.storage.fetch(e),a=[],l=[],d=[],h=[],u=new Set;for(const v of s){if(typeof v!="object"||v===null||Array.isArray(v)){if(r)continue;throw new Error(`${v} is not a valid ${e?"node":"edge"}`)}const E=rA(v.id);if(!o.getIndex(E,!1)&&!u.has(E)){if(!e){const A=v,S=t.getExtremityIndex(E,A.source,0,r),w=t.getExtremityIndex(E,A.target,1,r);if(r&&(!S||!w))continue;d.push(S),h.push(w)}l.push(E),a.push(v),u.add(E)}}const c=o.addElements(l);e?t.topology.allocateNodes(c):t.topology.allocateEdges(c,d,h);const g=o.getFlexArray("object"),f=o.getFlexArray("excluded"),m=o.getFlexArray("removed"),_=o.getFlexArray("virtual"),p=e?t.node:t.edge,x=e?t.nodeList:t.edgeList,y=t.getCacheLists(e),b=x(c);for(let v=0;v<c.length;v++){const E=c[v];g.set(E,p(E))}return f.setMultiple(c,0),m.setMultiple(c,0),_.setMultiple(c,n?1:0),y.visible.invalidList(),y.all.invalidList(),y._all.invalidList(),n||y.raw.invalidList(),b.size!==0&&(e?t.fireEvent("addNodes",{virtual:n,objects:a,nodes:b}):t.fireEvent("addEdges",{virtual:n,objects:a,edges:b})),b}function PS(t,e,s){return Lo(t,!0,[e],s)}function RS(t,e,s){return Lo(t,!1,[e],s)}function FS(t,e,s){return Lo(t,!0,e,s)}function DS(t,e,s){return Lo(t,!1,e,s)}function Lo(t,e,s,i={}){Array.isArray(s)||s instanceof(e?Pi:Ln)||(s=[s]);const{virtual:n=!1}=i,r={elementsToRemove:t.getElements(e,s)};t.fireEvent("requestElementsToDelete",r);let{elementsToRemove:o}=r;if(!o.size)return Promise.resolve();o=o.dedupe();const a=t.storage.fetch(e),l=a.getFlexArray("removed");o=o.filter(c=>l.get(c._index)===0),e&&Lo(t,!1,o.getAdjacentEdges({filter:"all"}),i);const d=o._indexes,h=t.getCacheLists(e),u={virtual:n,[e?"nodes":"edges"]:o};if(t.fireEvent(e?"beforeRemoveNodes":"beforeRemoveEdges",u),h.visible.invalidList(),h.all.invalidList(),h.raw.invalidList(),t.setExcluded(o,!0),l.setMultiple(d,1),!e)for(let c=0;c<d.length;++c)t.topology.removeFromAdjacencyList(d[c]);return a.removeElements(d),t.fireEvent(e?"removeNodes":"removeEdges",u),t.fireEvent(e?"afterRemoveNodes":"afterRemoveEdges",u),Promise.resolve()}var OS=class{addNodes(t,e){return lr(this.modules.graph,!0,t,e)}addEdges(t,e){return lr(this.modules.graph,!1,t,e)}addNode(t,e){return cl(this.modules.graph,!0,t,e)}addEdge(t,e){return cl(this.modules.graph,!1,t,e)}removeNodes(t,e){return FS(this.modules.graph,t,e)}removeEdges(t,e){return DS(this.modules.graph,t,e)}removeNode(t,e){return PS(this.modules.graph,t,e)}removeEdge(t,e){return RS(this.modules.graph,t,e)}getNodes(t){return this.modules.graph.getNodes(t)}getEdges(t){return this.modules.graph.getEdges(t)}getNode(t){return this.modules.graph.getNode(t)}getEdge(t){return this.modules.graph.getEdge(t)}clearGraph(){this.modules.graph.clear()}setGraph(t,e){return this.modules.graph.clear(),this.addGraph(t,e)}addGraph(t,e){const s=this.modules.graph.getNodes().size===0,i=MS(this.modules.graph,t,e);return s?this.modules.locate.locateGraph({padding:30,ignoreZoomLimits:!0,duration:0}).then(()=>i):i}createNodeList(){return this.getNodes([])}createEdgeList(){return this.getEdges([])}getConnectedComponents(t={}){return this.modules.graph.getConnectedComponents(this.getNodes(t.filter),t)}getConnectedComponentByNode(t,e){const s=this.modules.graph.getNode(t);if(s===void 0)throw new Error(`getComponentByNode: cannot find node ${t}`);return this.modules.graph.getConnectedComponentByNode(s,e)[0]}},Vu={};function by(t,e,s,i,n,r){let o=0;for(let a=0;a<i;a++)for(let l=0;l<i;l++){const d=r[a],h=r[l];if(d!==h){const u=t[d][h]*n,c=1/(u*u);if(c){const g=e[d]-e[h],f=s[d]-s[h];o+=c*Math.pow(u-Math.sqrt(g*g+f*f),2)}}}return o}function vy(t,e,s,i,n,r,o){let a=0;if(n===-1)return 0;for(let l=0;l<i;l++)for(let d=0;d<i;d++){const h=o[l],u=o[d];if(h!==u&&(h===n||u===n)){const c=t[h][u]*r,g=1/(c*c);if(g){const f=e[h]-e[u],m=s[h]-s[u];a+=g*Math.pow(c-Math.sqrt(f*f+m*m),2)}}}return a}function wh(t,e,s,i,n,r,o,a){o=o||0;let l=0,d=0;for(let h=0;h<i;h++)for(let u=0;u<i;u++){const c=a[h],g=a[u];if(c!==g){const f=t[c][g]*r,m=1/(f*f);if(m){const _=e[c]-e[g],p=s[c]-s[g],x=m*Math.pow(f-Math.sqrt(_*_+p*p),2);l+=x,c!==n&&g!==n||(d+=x)}}}return(1-o)*l+o*d}function Th(t,e,s,i,n,r,o,a,l){o=o||0;const d=e,h=s;(n=n===void 0?-1:n)===-1&&(o=0);const u=e[n],c=s[n];for(let g=0;g<i;g++){const f=a[g],m=l(t[n][g]),_=o/(m*m);if(m===0)continue;let p=0,x=0,y=0;const b=e[f],v=s[f];for(let A=0;A<i;A++){const S=a[A];if(S!==f){const w=t[f][S]*r,L=1/(w*w),T=e[S],F=s[S];if(L!==0){const V=b-T,G=v-F,O=V*V+G*G,j=O<1e-12?0:1/Math.sqrt(O);x+=(1-o)*L*(T+w*(b-T)*j),y+=(1-o)*L*(F+w*(v-F)*j)}p+=L}}const E=(1-o)*p+_;if(E!==0){const A=b-u,S=v-c;let w=A*A+S*S;w=w<1e-12?0:1/Math.sqrt(w);const L=m===0?0:_*(m*w);d[f]=(x+L*e[f])/E,h[f]=(y+L*s[f])/E}}return{x:d,y:h}}function kS(t,e,s,i,n,r,o,a){o=o||0;const l=e,d=s;let h;(n=n===void 0?-1:n)===-1&&(o=0);for(let u=0;u<i;u++){const c=a[u];let g=0,f=0,m=0;const _=e[c],p=s[c];for(let x=0;x<i;x++){const y=a[x];let b=0;if(y!==c){let v=0;const E=t[c][y]*r,A=1/(E*E);c!==n&&y!==n||(v=A);const S=(1-o)*A+o*v;if(g+=S,A!==0){const w=e[y],L=s[y],T=_-w,F=p-L,V=T*T+F*F;V>1e-6&&(b=1/Math.sqrt(V)),f+=S*(w+E*(_-w)*b),m+=S*(L+E*(p-L)*b)}}}h=g,h!==0&&(l[c]=f/h,d[c]=m/h)}return{x:l,y:d}}function ql(t=(n,r)=>n-r,e=[],s={},i=n=>n){let n=e.length;function r(a){for(;;){const l=2*a+1,d=l+1;let h=a;if(l<n&&t(e[l],e[h])<0&&(h=l),d<n&&t(e[d],e[h])<0&&(h=d),h===a)return a;const u=e[h];e[h]=e[a],e[a]=u,s[i(e[h])]=h,s[i(u)]=a,a=h}}return{get keys(){return s},get size(){return n},heapify:r,pop(){if(n<=0)return;if(n===1)return n--,e[0];const a=e[0];return e[0]=e[n-1],n--,r(0),a},decreaseKey(a,l){for(l!==void 0&&(e[a]=l,s[i(l)]=a);a>0;){const d=a-1>>1;if(!(t(e[d],e[a])>0))break;{const h=e[a];e[a]=e[d],e[d]=h,s[i(e[a])]=a,s[i(h)]=d,a=d}}return a},min:()=>e[0],remove(a){return this.decreaseKey(a,Number.NEGATIVE_INFINITY),this.pop()},push(a){n++;let l=n-1;for(e[l]=a;l>0;){const d=l-1>>1;if(!(t(e[d],e[l])>0))break;{const h=e[l];e[l]=e[d],e[d]=h,s[i(e[l])]=l,s[i(h)]=d,l=d}}return l},empty:()=>n<=0,toArray:()=>e.slice(0,n)}}function qu({sources:t,targets:e,weights:s,source:i,target:n,undirected:r=!1,indexes:o,N:a}){if(!(a=o?o.length:a)||!isFinite(a)||a===0)throw new Error("Invalid number of nodes "+a);const l=new Float32Array(a),d=new Int32Array(a),h={},u=Number.POSITIVE_INFINITY;if(!s){s=[];for(let m=0;m<a;m++)s[m]=1}if(!o){o=new Uint32Array(a);for(let m=0;m<a;m++)o[m]=m+1}for(let m=0;m<a;m++)l[m]=u,d[m]=-1,h[o[m]]=m;l[h[i]]=0;let c=!1;for(let m=1;m<=a;m++){for(let _=0;_<s.length;_++){const p=t[_],x=e[_],y=h[p],b=h[x];if(y!==void 0&&b!==void 0){const v=s[_];let E=l[y]+v;l[y]!==u&&E<l[b]&&(l[b]=E,d[b]=p,c=!0),r&&(E=l[b]+v,l[b]!==u&&E<l[y]&&(l[y]=E,d[y]=x,c=!0))}}if(!c)break}if(c)for(let m=0;m<s.length;m++){const _=t[m],p=e[m],x=h[_],y=h[p];if(x!==void 0&&y!==void 0){const b=s[m];if(l[x]+b<l[y])return null}}let g=null,f=null;if(n!==void 0){const m=h[n];if(m!==void 0&&l[m]!==u){g=[];for(let _=n;_!==-1;_=d[h[_]])g.push(_);g=g.reverse(),f=l[m]}}return{distances:l,path:g,pathLength:f}}function ju(t,e,s,i,n,r,o){i=i||t.map((_,p)=>p+1);const a=i.length,l=new Float32Array(a),d=new Int32Array(a),h=new Uint32Array(a),u=Number.POSITIVE_INFINITY,c={};if(a===0)return{distances:l,path:null,pathLength:null};if(!n){n={};for(let _=0;_<a;_++)n[i[_]]=_}for(let _=0;_<a;_++)l[_]=u,d[_]=-1,h[_]=c[_]=_;const g=ql((_,p)=>l[_]-l[p],h,c);for(l[n[e]]=0,g.decreaseKey(c[n[e]]);g.size!==0;){const _=g.pop(),p=l[_],x=t[_];if(p===u)break;for(let y=0,b=x.nodes.length;y<b;y++){const v=x.nodes[y],E=r?1:o?o(i[_],v):x.weights?x.weights[y]:1,A=n[v];if(A===void 0)continue;const S=p+E;S<l[A]&&(l[A]=S,d[A]=_,g.decreaseKey(c[A]))}}let f=null,m=null;if(s!==void 0){const _=n[s];if(l[_]!==u){f=[];for(let p=_;p!==-1;p=d[p])f.push(i[p]);f.reverse(),m=l[s]}}return{distances:l,path:f,pathLength:m}}function Ih({sources:t,targets:e,weights:s,indexes:i,adjacency:n,undirected:r,ignoreWeights:o}){const a=Number.POSITIVE_INFINITY,l=i?i.length:n.length;if(!i){i=new Uint32Array(l);for(let m=0;m<l;m++)i[m]=m+1}const d=new Array(l),h={};for(let m=0;m<l;m++){d[m]=new Float32Array(l);for(let _=0;_<l;_++)d[m][_]=m===_?0:a;h[i[m]]=m}const u=l,c=s.length;t=t.slice(),e=e.slice(),s=s.slice();for(let m=0;m<l;m++)t[c+m]=u,e[c+m]=i[m],s[c+m]=0,o&&(s[m]=1);const g=qu({sources:t,targets:e,weights:s,undirected:r,N:l+1,source:u});if(g===null)throw new Error("Graph has negative weight loops");const f=g.distances;for(let m=0;m<s.length;m++){const _=h[t[m]],p=h[e[m]];_!==void 0&&p!==void 0&&(s[m]=s[m]+f[_]-f[p])}t=t.slice(0,c),e=e.slice(0,c),s=s.slice(0,c);for(let m=0;m<l;m++){const _=i[m],{distances:p}=ju(n,_,void 0,i,h,!!o);for(let x=0;x<l;x++)d[m][x]=m===x?0:p[x]}return d}So(Vu,{CyclesFinder:()=>Uy,Quadtree:()=>Fy,bellmanFord:()=>qu,betweenness:()=>Vy,circlePack:()=>Cy,circleSpread:()=>ow,constrainedStress:()=>wh,convexhull:()=>nw,detectCyclesDirected:()=>zy,detectCyclesUndirected:()=>Kw,detectCyclesUndirectedDFS:()=>Qw,dijkstra:()=>ju,distanceStress:()=>vy,fisheye:()=>Ly,johnson:()=>Ih,kruskal:()=>Gy,largestEmptyCircle:()=>Ay,minDisk:()=>Mo,minHeap:()=>ql,removeRadialOverlap:()=>Lh,stressMinimizationStep:()=>Th,stressMinimizationStepGeneral:()=>kS,weightedStress:()=>by});var Ai=11102230246251565e-32,Ze=134217729,zS=(3+8*Ai)*Ai;function bd(t,e,s,i,n){let r,o,a,l,d=e[0],h=i[0],u=0,c=0;h>d==h>-d?(r=d,d=e[++u]):(r=h,h=i[++c]);let g=0;if(u<t&&c<s)for(h>d==h>-d?(o=d+r,a=r-(o-d),d=e[++u]):(o=h+r,a=r-(o-h),h=i[++c]),r=o,a!==0&&(n[g++]=a);u<t&&c<s;)h>d==h>-d?(o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u]):(o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c]),r=o,a!==0&&(n[g++]=a);for(;u<t;)o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u],r=o,a!==0&&(n[g++]=a);for(;c<s;)o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c],r=o,a!==0&&(n[g++]=a);return r===0&&g!==0||(n[g++]=r),g}function BS(t,e){let s=e[0];for(let i=1;i<t;i++)s+=e[i];return s}function No(t){return new Float64Array(t)}var US=(3+16*Ai)*Ai,GS=(2+12*Ai)*Ai,VS=(9+64*Ai)*Ai*Ai,Rn=No(4),Dg=No(8),Og=No(12),kg=No(16),as=No(4);function qS(t,e,s,i,n,r,o){let a,l,d,h,u,c,g,f,m,_,p,x,y,b,v,E,A,S;const w=t-n,L=s-n,T=e-r,F=i-r;b=w*F,c=Ze*w,g=c-(c-w),f=w-g,c=Ze*F,m=c-(c-F),_=F-m,v=f*_-(b-g*m-f*m-g*_),E=T*L,c=Ze*T,g=c-(c-T),f=T-g,c=Ze*L,m=c-(c-L),_=L-m,A=f*_-(E-g*m-f*m-g*_),p=v-A,u=v-p,Rn[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,Rn[1]=y-(p+u)+(u-E),S=x+p,u=S-x,Rn[2]=x-(S-u)+(p-u),Rn[3]=S;let V=BS(4,Rn),G=GS*o;if(V>=G||-V>=G||(u=t-w,a=t-(w+u)+(u-n),u=s-L,d=s-(L+u)+(u-n),u=e-T,l=e-(T+u)+(u-r),u=i-F,h=i-(F+u)+(u-r),a===0&&l===0&&d===0&&h===0)||(G=VS*o+zS*Math.abs(V),V+=w*h+F*a-(T*d+L*l),V>=G||-V>=G))return V;b=a*F,c=Ze*a,g=c-(c-a),f=a-g,c=Ze*F,m=c-(c-F),_=F-m,v=f*_-(b-g*m-f*m-g*_),E=l*L,c=Ze*l,g=c-(c-l),f=l-g,c=Ze*L,m=c-(c-L),_=L-m,A=f*_-(E-g*m-f*m-g*_),p=v-A,u=v-p,as[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,as[1]=y-(p+u)+(u-E),S=x+p,u=S-x,as[2]=x-(S-u)+(p-u),as[3]=S;const O=bd(4,Rn,4,as,Dg);b=w*h,c=Ze*w,g=c-(c-w),f=w-g,c=Ze*h,m=c-(c-h),_=h-m,v=f*_-(b-g*m-f*m-g*_),E=T*d,c=Ze*T,g=c-(c-T),f=T-g,c=Ze*d,m=c-(c-d),_=d-m,A=f*_-(E-g*m-f*m-g*_),p=v-A,u=v-p,as[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,as[1]=y-(p+u)+(u-E),S=x+p,u=S-x,as[2]=x-(S-u)+(p-u),as[3]=S;const j=bd(O,Dg,4,as,Og);b=a*h,c=Ze*a,g=c-(c-a),f=a-g,c=Ze*h,m=c-(c-h),_=h-m,v=f*_-(b-g*m-f*m-g*_),E=l*d,c=Ze*l,g=c-(c-l),f=l-g,c=Ze*d,m=c-(c-d),_=d-m,A=f*_-(E-g*m-f*m-g*_),p=v-A,u=v-p,as[0]=v-(p+u)+(u-A),x=b+p,u=x-b,y=b-(x-u)+(p-u),p=y-E,u=y-p,as[1]=y-(p+u)+(u-E),S=x+p,u=S-x,as[2]=x-(S-u)+(p-u),as[3]=S;const W=bd(j,Og,4,as,kg);return kg[W-1]}function Qo(t,e,s,i,n,r){const o=(e-r)*(s-n),a=(t-n)*(i-r),l=o-a,d=Math.abs(o+a);return Math.abs(l)>=US*d?l:-qS(t,e,s,i,n,r,d)}var zg=Math.pow(2,-52),Jo=new Uint32Array(512),Hu=class Ey{static from(e,s=YS,i=$S){const n=e.length,r=new Float64Array(2*n);for(let o=0;o<n;o++){const a=e[o];r[2*o]=s(a),r[2*o+1]=i(a)}return new Ey(r)}constructor(e){const s=e.length>>1;if(s>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*s-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(s)),this._hullPrev=new Uint32Array(s),this._hullNext=new Uint32Array(s),this._hullTri=new Uint32Array(s),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(s),this._dists=new Float64Array(s),this.update()}update(){const{coords:e,_hullPrev:s,_hullNext:i,_hullTri:n,_hullHash:r}=this,o=e.length>>1;let a=1/0,l=1/0,d=-1/0,h=-1/0;for(let w=0;w<o;w++){const L=e[2*w],T=e[2*w+1];L<a&&(a=L),T<l&&(l=T),L>d&&(d=L),T>h&&(h=T),this._ids[w]=w}const u=(a+d)/2,c=(l+h)/2;let g,f,m;for(let w=0,L=1/0;w<o;w++){const T=vd(u,c,e[2*w],e[2*w+1]);T<L&&(g=w,L=T)}const _=e[2*g],p=e[2*g+1];for(let w=0,L=1/0;w<o;w++){if(w===g)continue;const T=vd(_,p,e[2*w],e[2*w+1]);T<L&&T>0&&(f=w,L=T)}let x=e[2*f],y=e[2*f+1],b=1/0;for(let w=0;w<o;w++){if(w===g||w===f)continue;const L=WS(_,p,x,y,e[2*w],e[2*w+1]);L<b&&(m=w,b=L)}let v=e[2*m],E=e[2*m+1];if(b===1/0){for(let T=0;T<o;T++)this._dists[T]=e[2*T]-e[0]||e[2*T+1]-e[1];Hn(this._ids,this._dists,0,o-1);const w=new Uint32Array(o);let L=0;for(let T=0,F=-1/0;T<o;T++){const V=this._ids[T],G=this._dists[V];G>F&&(w[L++]=V,F=G)}return this.hull=w.subarray(0,L),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(Qo(_,p,x,y,v,E)<0){const w=f,L=x,T=y;f=m,x=v,y=E,m=w,v=L,E=T}const A=XS(_,p,x,y,v,E);this._cx=A.x,this._cy=A.y;for(let w=0;w<o;w++)this._dists[w]=vd(e[2*w],e[2*w+1],A.x,A.y);Hn(this._ids,this._dists,0,o-1),this._hullStart=g;let S=3;i[g]=s[m]=f,i[f]=s[g]=m,i[m]=s[f]=g,n[g]=0,n[f]=1,n[m]=2,r.fill(-1),r[this._hashKey(_,p)]=g,r[this._hashKey(x,y)]=f,r[this._hashKey(v,E)]=m,this.trianglesLen=0,this._addTriangle(g,f,m,-1,-1,-1);for(let w,L,T=0;T<this._ids.length;T++){const F=this._ids[T],V=e[2*F],G=e[2*F+1];if(T>0&&Math.abs(V-w)<=zg&&Math.abs(G-L)<=zg||(w=V,L=G,F===g||F===f||F===m))continue;let O=0;for(let mt=0,vt=this._hashKey(V,G);mt<this._hashSize&&(O=r[(vt+mt)%this._hashSize],O===-1||O===i[O]);mt++);O=s[O];let j,W=O;for(;j=i[W],Qo(V,G,e[2*W],e[2*W+1],e[2*j],e[2*j+1])>=0;)if(W=j,W===O){W=-1;break}if(W===-1)continue;let et=this._addTriangle(W,F,i[W],-1,-1,n[W]);n[F]=this._legalize(et+2),n[W]=et,S++;let at=i[W];for(;j=i[at],Qo(V,G,e[2*at],e[2*at+1],e[2*j],e[2*j+1])<0;)et=this._addTriangle(at,F,j,n[F],-1,n[at]),n[F]=this._legalize(et+2),i[at]=at,S--,at=j;if(W===O)for(;j=s[W],Qo(V,G,e[2*j],e[2*j+1],e[2*W],e[2*W+1])<0;)et=this._addTriangle(j,F,W,-1,n[W],n[j]),this._legalize(et+2),n[j]=et,i[W]=W,S--,W=j;this._hullStart=s[F]=W,i[W]=s[at]=F,i[F]=at,r[this._hashKey(V,G)]=F,r[this._hashKey(e[2*W],e[2*W+1])]=W}this.hull=new Uint32Array(S);for(let w=0,L=this._hullStart;w<S;w++)this.hull[w]=L,L=i[L];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,s){return Math.floor(jS(e-this._cx,s-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:s,_halfedges:i,coords:n}=this;let r=0,o=0;for(;;){const a=i[e],l=e-e%3;if(o=l+(e+2)%3,a===-1){if(r===0)break;e=Jo[--r];continue}const d=a-a%3,h=l+(e+1)%3,u=d+(a+2)%3,c=s[o],g=s[e],f=s[h],m=s[u];if(HS(n[2*c],n[2*c+1],n[2*g],n[2*g+1],n[2*f],n[2*f+1],n[2*m],n[2*m+1])){s[e]=m,s[a]=c;const _=i[u];if(_===-1){let x=this._hullStart;do{if(this._hullTri[x]===u){this._hullTri[x]=e;break}x=this._hullPrev[x]}while(x!==this._hullStart)}this._link(e,_),this._link(a,i[o]),this._link(o,u);const p=d+(a+1)%3;r<Jo.length&&(Jo[r++]=p)}else{if(r===0)break;e=Jo[--r]}}return o}_link(e,s){this._halfedges[e]=s,s!==-1&&(this._halfedges[s]=e)}_addTriangle(e,s,i,n,r,o){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=s,this._triangles[a+2]=i,this._link(a,n),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}};function jS(t,e){const s=t/(Math.abs(t)+Math.abs(e));return(e>0?3-s:1+s)/4}function vd(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function HS(t,e,s,i,n,r,o,a){const l=t-o,d=e-a,h=s-o,u=i-a,c=n-o,g=r-a,f=h*h+u*u,m=c*c+g*g;return l*(u*m-f*g)-d*(h*m-f*c)+(l*l+d*d)*(h*g-u*c)<0}function WS(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l),g=(d*h-a*u)*c,f=(o*u-l*h)*c;return g*g+f*f}function XS(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l);return{x:t+(d*h-a*u)*c,y:e+(o*u-l*h)*c}}function Hn(t,e,s,i){if(i-s<=20)for(let n=s+1;n<=i;n++){const r=t[n],o=e[r];let a=n-1;for(;a>=s&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let n=s+1,r=i;br(t,s+i>>1,n),e[t[s]]>e[t[i]]&&br(t,s,i),e[t[n]]>e[t[i]]&&br(t,n,i),e[t[s]]>e[t[n]]&&br(t,s,n);const o=t[n],a=e[o];for(;;){do n++;while(e[t[n]]<a);do r--;while(e[t[r]]>a);if(r<n)break;br(t,n,r)}t[s+1]=t[r],t[r]=o,i-n+1>=r-s?(Hn(t,e,n,i),Hn(t,e,s,r-1)):(Hn(t,e,s,r-1),Hn(t,e,n,i))}}function br(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function YS(t){return t[0]}function $S(t){return t[1]}function Ay(t,e=1,s=0,i,n){if(!i||!n){const u=t.map(g=>[g.x,g.y]),c=Hu.from(u,g=>g[0],g=>g[1]);i=oo(c.triangles,u),n=oo(c.hull,u)}if(!n)return[];const r=s*s,o=[],a={};for(let u=0;u<i.length;u+=3)if(ZS(n,Wu(i[u],i[u+1],i[u+2]))){const c=QS(i[u],i[u+1],i[u+2]);c>r&&(o.push(u),a[u]=c)}if(o.length===0)return[];o.sort((u,c)=>a[u]-a[c]);let l=o[0],d=a[l];const h=[];for(let u=0;u<o.length;u++){const c=o[u],g=a[c];g>d&&g>r&&(l=c,d=g,h.push(l),h.length>e&&h.shift())}return h.map(u=>KS(i[u],i[u+1],i[u+2]))}function ZS(t,e){const s=t.length,i=t[s-1],[n,r]=e;let[o,a]=i,l=!1;for(let d=0;d<s;d++){const h=t[d],[u,c]=h;c>r!=a>r&&n<(o-u)*(r-c)/(a-c)+u&&(l=!l),o=u,a=c}return l}function KS(t,e,s){const i=Wu(t,e,s);let n=0;for(let r=0;r<3;r++){const o=arguments[r],a=o[0]-i[0],l=o[1]-i[1],d=Math.sqrt(a*a+l*l);d>n&&(n=d)}return[i[0],i[1],n]}function QS(t,e,s){const[i,n]=Wu(t,e,s),[r,o]=t,a=i-r,l=n-o;return a*a+l*l}function Wu(t,e,s){const i=[(t[0]+e[0])/2,(t[1]+e[1])/2],n=[(e[0]+s[0])/2,(e[1]+s[1])/2],r=-1/((e[1]-t[1])/(e[0]-t[0])),o=-1/((s[1]-e[1])/(s[0]-e[0])),a=i[1]-r*i[0],l=(a-(n[1]-o*n[0]))/(o-r);return[l,r*l+a]}function Mo(t,e,s,i){let n;if(i)n=i;else{n=new Uint32Array(t.length);for(let y=0,b=t.length;y<b;y++)n[y]=y}let r=t[n[0]],o=r,a=e[n[0]],l=a;for(let y=1;y<n.length;y++){const b=n[y],v=t[b],E=e[b];v<r&&(r=v),v>o&&(o=v),E<a&&(a=E),E>l&&(l=E)}const d=(r+o)/2,h=(a+l)/2;for(let y=0;y<n.length;y++){const b=n[y];t[b]-=d,e[b]-=h}function u(y,b,v,E,A,S){const w=v-S+1e-9*Math.max(v,S,1),L=E-y,T=A-b;return w>0&&w*w>L*L+T*T}function c(y,b,v,E,A,S,w){for(let L=0;L<E.length;++L){const T=E[L];if(!u(y,b,v,A[T],S[T],w[T]))return!1}return!0}function g(y,b,v,E,A,S){const w=E-y,L=A-b,T=S-v,F=Math.sqrt(w*w+L*L);return[(y+E+w/F*T)/2,(b+A+L/F*T)/2,(F+v+S)/2]}function f(y,b,v,E,A,S,w,L,T){const F=(y+E+w)/3,V=(b+A+L)/3,G=y-F,O=b-V,j=E-F,W=A-V,et=w-F,at=L-V,mt=G-j,vt=G-et,wt=O-W,Et=O-at,yt=S-v,St=T-v,zt=G*G+O*O-v*v,Zt=zt-j*j-W*W+S*S,Kt=zt-et*et-at*at+T*T,X=vt*wt-mt*Et,Q=(wt*Kt-Et*Zt)/(2*X)-G,gt=(Et*yt-wt*St)/X,lt=(vt*Zt-mt*Kt)/(2*X)-O,st=(mt*St-vt*yt)/X,ot=gt*gt+st*st-1,rt=2*(v+Q*gt+lt*st),ft=Q*Q+lt*lt-v*v,Nt=-(Math.abs(ot)>1e-6?(rt+Math.sqrt(rt*rt-4*ot*ft))/(2*ot):ft/rt);return[F+G+Q+gt*Nt,V+O+lt+st*Nt,Nt]}function m(y,b,v,E){switch(y.length){case 1:const A=y[0];return function(G,O,j){return[G,O,j]}(b[A],v[A],E[A]);case 2:const[S,w]=y;return g(b[S],v[S],E[S],b[w],v[w],E[w]);case 3:const[L,T,F]=y;return f(b[L],v[L],E[L],b[T],v[T],E[T],b[F],v[F],E[F]);default:return null}}function _(y,b,v,E,A,S){const w=v-S,L=E-y,T=A-b;return w<0||w*w<L*L+T*T}function p(y,b,v,E,A){const S=v[b],w=E[b],L=A[b];if(c(S,w,L,y,v,E,A))return[b];for(let T=0;T<y.length;++T){const F=y[T],V=v[F],G=E[F],O=A[F];if(_(S,w,L,V,G,O)){const[j,W,et]=g(V,G,O,S,w,L);if(c(j,W,et,y,v,E,A))return[y[T],b]}}for(let T=0;T<y.length-1;++T)for(let F=T+1;F<y.length;++F){const V=y[T],G=y[F],O=v[V],j=E[V],W=A[V],et=v[G],at=E[G],mt=A[G],vt=g(O,j,W,et,at,mt);if(_(vt[0],vt[1],vt[2],S,w,L)){const wt=g(O,j,W,S,w,L);if(_(wt[0],wt[1],wt[2],et,at,mt)){const Et=g(et,at,mt,S,w,L);if(_(Et[0],Et[1],Et[2],O,j,W)){const yt=f(O,j,W,et,at,mt,S,w,L);if(c(yt[0],yt[1],yt[2],y,v,E,A))return[V,G,b]}}}}throw new Error}n=function(b){for(let v=b.length-1;v>=0;v--){let E=Math.floor(Math.random()*(v+1));E=Math.max(Math.min(E,v),0);const A=b[v];b[v]=b[E],b[E]=A}return b}(n),s=s||new Array(t.length).fill(0);const x=function(b,v,E,A,S){let w=null,L=[],T=0;for(;T<v;){const F=b[T];w&&u(w[0],w[1],w[2],E[F],A[F],S[F])?T++:(L=p(L,F,E,A,S),w=m(L,E,A,S),T=0)}return w}(n,n.length,t,e,s);x[0]+=d,x[1]+=h;for(let y=0;y<n.length;y++){const b=n[y];t[b]+=d,e[b]+=h}return x}var Sy=[1/0,1/0,-1/0,-1/0];function gl(t,e,s,i,n,r={x:0,y:0}){const o=Math.cos(n),a=Math.sin(n),l=t-s,d=e-i;return r.x=o*l-a*d+s,r.y=a*l+o*d+i,r}function JS(t,e,s=0,i={x:0,y:0}){return i.x=t.x+s*Math.sin(e),i.y=t.y+s*Math.cos(e),i}var Ie=(t,e,s,i)=>Math.hypot(t-s,e-i);function qa(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function wy(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=e,t.y/=e,t}function Ch(t){return 180*t/Math.PI}function tw(t){return t*Math.PI/180}function Ty(t,e){return t.minX-=e,t.minY-=e,t.maxX+=e,t.maxY+=e,t.width===void 0&&(t.width=t.maxX-t.minX),t.height===void 0&&(t.height=t.maxY-t.minY),t.width+=2*e,t.height+=2*e,t}function Xu(t,e,s,i,n,r){const o=i-t,a=n-e,l=Math.sqrt(o*o+a*a);if(l>s+r||l<Math.abs(s-r))return null;const d=(s*s-r*r+l*l)/(2*l),h=t+o*d/l,u=e+a*d/l,c=Math.sqrt(s*s-d*d),g=c/l*-a,f=o*(c/l);return[[h+g,u+f],[h-g,u-f]]}function Yu(t,e,s,i,n,r){if(t-n>=0&&s-n<0)return 1;if(t-n<0&&s-n>=0)return-1;if(t-n==0&&s-n==0)return e-i>=0||i-r>=0?e-i:i-e;const o=(t-n)*(i-r)-(s-n)*(e-r);return o<0?1:o>0?-1:(t-n)*(t-n)+(e-r)*(e-r)-((s-n)*(s-n)+(i-r)*(i-r))}function ew([t,e,s],i,n){const r=Math.abs(t-i),o=Math.abs(e-n);return r+o<=s||!(r>s||o>s)&&Math.sqrt(r*r+o*o)<s+1e-12}function sw(t,e,s,i){const n=t[0]-e,r=t[1]-s,o=t[2]-i;return n*n+r*r<o*o+1e-6}function $u(t,e,s,i,n,r,o){const a=t-Math.max(i,Math.min(r,t)),l=e-Math.max(n,Math.min(o,e));return a*a+l*l<s*s}function Iy(t,e,s,i,n,r,o,a={x:0,y:0}){const l=a||{x:0,y:0};let d,h,u,c;if(s===t){const p=t-n,x=o*o-p*p;if(x<0)return null;const y=Math.sqrt(x);d=t,u=t,h=r+y,c=r-y}else{const p=(i-e)/(s-t),x=e-p*t,y=x-r,b=p*p+1,v=2*(p*y-n),E=v*v-4*b*(n*n+y*y-o*o);if(E<0)return null;const A=-v,S=Math.sqrt(E),w=2*b;d=(A+S)/w,u=(A-S)/w,h=p*d+x,c=p*u+x}const g=t-d,f=e-h,m=t-u,_=e-c;return g*g+f*f<m*m+_*_?(l.x=d,l.y=h):(l.x=u,l.y=c),l}function Lh({X:t,Y:e,sizes:s,indexes:i,R:n,center:r,gap:o=0,epsilon:a=.001,maxLoops:l=5,inPlace:d=!0}){const h=i.length,u=r[0],c=r[1];let g=h;d||(t=t.slice(),e=e.slice());const f=Xu,m=Yu,_=i.slice().sort((L,T)=>m(t[L],e[L],t[T],e[T],u,c)),p=_[h-1],x=t[p],y=e[p];let b=!1;for(let L=0;L<g-1;L++){let T=L%h,F=(L+1)%h;L===-1&&(T=h-1,F=0),T=_[T],F=_[F];const V=t[T],G=e[T];let O=t[F],j=e[F];const W=s[T]+s[F]+o;let et=m(V,G,O,j,u,c);if(et===-1&&b&&(et=1),!(W>n)){if(et===1||W-Ie(V,G,O,j)>a){const at=f(u,c,n,V,G,W);if(at){const mt=at[0];b=O>u&&mt[0]<u,O=t[F]=mt[0],j=e[F]=mt[1]}}else b=!1;if(L%h==h-2){const at=_[h-1],mt=_[0];if(e[at]>c&&e[mt]>c&&t[at]-s[at]<t[mt]+s[at]){let vt=0;for(g=Math.min(h*l,g+h);e[_[at]]>c&&e[_[0]]>c&&t[_[at]]<t[_[0]]&&++vt<h;){const wt=_.pop();wt&&_.unshift(wt)}}}}}const v=x-u,E=y-c,A=t[p]-u,S=e[p]-c,w=v===A?0:Math.abs(Math.acos((v*A+E*S)/(Math.sqrt(v*v+E*E)*Math.sqrt(A*A+S*S))));if(w!==0){const L=Math.sin(-w),T=Math.cos(-w);let F;for(let V=0;V<h;V++){F=_[V];const G=t[F]-u,O=e[F]-c;t[F]=G*T-O*L+u,e[F]=G*L+O*T+c}}return{X:t,Y:e}}function Bg(t,e,s,i,n,r){const o={},a=s[t];let l=a,d=0;const h=a*n;for(const u in e){const c=e[u];let g=0,f=0;for(let x=0,y=c.length;x<y;x++){const b=s[c[x]];f=Math.max(f,b),g+=2*b+i}const m=g/(2*Math.PI),_=f+l,p=r?d+Math.max(r,_):d*n;d=Math.max(_,d,m,h,p),o[u]=d,l=f}return o[0]=0,o[Number.POSITIVE_INFINITY]=d,o}function iw(t,e,s){return(e[0]-t[0])*(s[1]-t[1])-(e[1]-t[1])*(s[0]-t[0])}function Ug(t){const e=t.length,s=[0,1];let i=2;for(let n=2;n<e;n++){for(;i>1&&iw(t[s[i-2]],t[s[i-1]],t[n])<=0;)--i;s[i++]=n}return s.slice(0,i)}function nw(t){const e=t.length;if(e<3)return null;const s=new Array(e),i=new Array(e);for(let u=0;u<e;u++)s[u]=[+t[u][0],+t[u][1],u];s.sort((u,c)=>u[0]-c[0]||u[1]-c[1]);for(let u=0;u<e;u++)i[u]=[s[u][0],-s[u][1]];const n=Ug(s),r=Ug(i),o=r[r.length-1],a=n[n.length-1],l=r[0]===n[0],d=o===a?1:0,h=[];for(let u=n.length-1;u>=0;--u)h.push(t[s[n[u]][2]]);for(let u=+l;u<r.length-d;u++)h.push(t[s[r[u]][2]]);return h}var Gg=t=>--t*t*t+1,Vg=(t,e,s)=>{const i=t-s[0],n=e-s[1];return i*i+n*n},rw=(t,e)=>{let s=1/0,i=-1/0;for(let n=0;n<t.length;n++){const r=t[n],o=e?e[r]:r;s=Math.min(o,s),i=Math.max(o,i)}return{min:s,max:i}};function ow({X:t,Y:e,R:s,center:i,maxSteps:n=1e3,padding:r=5,epsilon:o=1e-9,damping:a=2,pinned:l=-1,indexes:d,onUpdate:h,pushSmallerOut:u=!0}){const c=d?d.length:t.length;let g=d;if(g===void 0){g=new Uint32Array(c);for(let b=0;b<c;b++)g[b]=b}else g=d;if(l!==-1)i=[t[l],e[l]];else if(!i){let b=0,v=0;for(let E=0;E<c;E++)b+=t[g[E]],v+=e[g[E]];i=[b/c,v/c]}const{min:f,max:m}=rw(g,s);function _(b,v){let E=0;for(let L=0;L<c-1;L++)for(let T=L+1;T<c;T++){if(L===T)continue;const F=g[L],V=g[T],G=t[F],O=e[F],j=s[F],W=t[V],et=e[V],at=s[V],mt=W-G,vt=et-O,wt=j+at+r,Et=mt*mt+vt*vt;if(Et<wt*wt-b){const yt=(wt-Math.sqrt(Et))*v,St=1/Et,zt=mt*St*yt,Zt=vt*St*yt,Kt=zt*zt+Zt*Zt;if(V!==l){const X=j/f;E+=Kt*X,t[V]+=zt*X,e[V]+=Zt*X}if(F!==l){const X=at/f;E+=Kt*X,t[F]-=zt*X,e[F]-=Zt*X}}}const A=b*a*(1-v),S=i[0],w=i[1];for(let L=0;L<c;L++){const T=g[L];if(T!==l){const F=t[T],V=e[T],G=s[T],O=u?A*(G/m):A,j=(F-S)*O,W=(V-w)*O;E+=j*j+W*W,t[T]-=j,e[T]-=W}}return E}g.sort((b,v)=>s[v]*Vg(t[v],e[v],i)-s[b]*Vg(t[b],e[b],i));let p=0,x=0;const y=Gg(1/c);for(let b=0;b<n&&(p=_(y,Gg((b+1)/n)),h&&setTimeout(()=>h(t,e)),!(Math.abs(p-x)<o));b++)x=p;return{X:t,Y:e}}var ta=t=>({data:t,next:null,prev:null});function Cy(t,e=0,s=0){const i=t.length;if(i===0)return t;const n=t[0];if(n.x=e,n.y=s,i===1)return t;const r=t[1];if(n.x=e-r.radius,r.x=e+n.radius,r.y=s,i===2)return t;const o=t[2];qg(r,n,o);let a=ta(n),l=ta(r),d=ta(o);a.next=d.prev=l,l.next=a.prev=d,d.next=l.prev=a;t:for(let h=3;h<i;h++){d=ta(t[h]),qg(a.data,l.data,t[h]);let u=l.next,c=a.prev,g=l.data.radius,f=a.data.radius;do if(g<=f){if(jg(u.data,d.data)){l=u,a.next=l,l.prev=a,--h;continue t}g+=u.data.radius,u=u.next}else{if(jg(c.data,d.data)){a=c,a.next=l,l.prev=a,--h;continue t}f+=c.data.radius,c=c.prev}while(u!==c.next);d.prev=a,d.next=l,a.next=l.prev=l=d;let m=Hg(a);for(;(d=d.next)!==l;){const _=Hg(d);_<m&&(a=d,m=_)}l=a.next}return t}function qg(t,e,s){const i=t.x-e.x;let n,r;const o=t.y-e.y,a=i*i+o*o;let l,d;a?(r=e.radius+s.radius,r*=r,d=t.radius+s.radius,d*=d,r>d?(n=(a+d-r)/(2*a),l=Math.sqrt(Math.max(0,d/a-n*n)),s.x=t.x-n*i-l*o,s.y=t.y-n*o+l*i):(n=(a+r-d)/(2*a),l=Math.sqrt(Math.max(0,r/a-n*n)),s.x=e.x+n*i-l*o,s.y=e.y+n*o+l*i)):(s.x=e.x+s.radius,s.y=e.y)}var aw=1e-6;function jg(t,e){const s=t.radius+e.radius-aw,i=e.x-t.x,n=e.y-t.y;return s>0&&s*s>i*i+n*n}function Hg(t){const e=t.data,s=t.next.data,i=e.radius+s.radius,n=(e.x*s.radius+s.x*e.radius)/i,r=(e.y*s.radius+s.y*e.radius)/i;return n*n+r*r}function lw(t,e,s,i,n,r){const o=t.get(e),a=t.get(s),l=o.getAttributes(["x","y","radius"]),d=a.getAttributes(["x","y","radius"]),h=Number(d.radius),u=Number(l.radius),c=Ie(l.x,l.y,d.x,d.y),g=c;return i.push({source:e,target:s,weight:g}),c<=u+h+20?1:0}function dw(t){return t%3==2?t-2:t+1}function hw(t,e,s,i){const n=[],{triangles:r,halfedges:o}=t;for(let a=0;a<r.length;a++)a>o[a]&&lw(e,r[a],r[dw(a)],n);return n}var uw=(t,e)=>t.weight-e.weight;function cw(t,e){const s=new Set,i=new Array(t.length),n=[];for(const o of e)i[o.source]||(i[o.source]=[]),i[o.source].push(o),i[o.target]||(i[o.target]=[]),i[o.target].push(o);s.add(0);const r=ql(uw,i[0]);for(;r.size!==0;){const o=r.pop(),a=s.has(o.source)?s.has(o.target)?null:o.target:o.source;if(a){const l=o.source===a?o.target:o.source,d=a;n.push({source:l,target:d,weight:o.weight}),s.add(a);for(const h of i[a])r.push(h)}}return n}function Wg(t,e,s){let i=t.x-e.x,n=t.y-e.y;const r=Math.sqrt(i*i+n*n);i/=r,n/=r;const o=s*i,a=s*n;t.x+=o,t.y+=a}function gw(t,e,s,i){const n=s.getAttributes(["x","y","radius"]),r=new Set;let o={x:0,y:0},a=-1;const l=n.map((d,h)=>(t===s.get(h)&&(a=h,o={index:h,...d}),{x:d.x,y:d.y,r:d.radius,index:h}));for(const d of i){const h=l[d.target],u=l[d.source],c=1;u.index===a||r.has(d.source)||(Wg(u,o,c*e),r.add(d.source)),h.index===a||r.has(d.target)||(Wg(h,o,c*e),r.add(d.target))}return l.map(d=>({x:d.x,y:d.y}))}function Ly(t,e,s){const i=hw(Hu.from(t.getPosition(),r=>r.x,r=>r.y),t),n=cw(t.toArray(),i);return gw(e,s,t,n)}var fw=16,mw=class{constructor(t=Int32Array,e=fw,s=8){this._BIG_LIST=new Uint8Array([-1])[0],this._ArrayType=t,this._capacity=e,this._MAX_LIST_SIZE=s,this._freeIndex=-1,this.clear()}clear(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._idToIndex={},this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){let e;return this._freeIndex===-1?e=this._nextIndex++:(e=this._freeIndex,this._freeIndex=-1),this._idToIndex[t]=e,e>=this._capacity&&this._expand(e+1),this._sizes[e]=0,e}getItems(t){const e=this._idToIndex[t];if(e===void 0)return;const s=this._sizes[e],i=this._MAX_LIST_SIZE*e;if(s<=this._MAX_LIST_SIZE){this._constList.length=s;for(let n=0,r=s;n<r;++n)this._constList[n]=this._buffer[i+n];return this._constList}if(s===this._BIG_LIST){let n=this._buffer[i];return this._bigLists[n]}}removeEntry(t){const e=this._idToIndex[t];if(this._sizes[e]===this._BIG_LIST){const s=this._MAX_LIST_SIZE*e,i=this._buffer[s];this._bigLists[i].length=0}this._sizes[e]=0,this._freeIndex=e}size(t){const e=this._idToIndex[t];let s=this._sizes[e];return s<=this._MAX_LIST_SIZE?s:this._bigLists[this._buffer[e*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=this._idToIndex[t[a]],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._idToIndex[t],i=this._sizes[s],n=s*this._MAX_LIST_SIZE;if(i<this._MAX_LIST_SIZE)this._buffer[n+i]=e,this._sizes[s]=i+1;else if(i===this._BIG_LIST){let r=this._buffer[n];this._bigLists[r].push(e)}else{let r=new Array(this._MAX_LIST_SIZE);for(let o=0;o<this._MAX_LIST_SIZE;++o)r[o]=this._buffer[n+o];r.push(e),this._bigLists.push(r),this._sizes[s]=this._BIG_LIST,this._buffer[n]=this._bigLists.length-1}}removeFrom(t,e){this.removeFromAndGetSize(t,e)}removeFromAndGetSize(t,e){const s=this._idToIndex[t];let i=this._sizes[s],n=this._MAX_LIST_SIZE*s;if(i<=this._MAX_LIST_SIZE){for(let r=n,o=n+i;r<o;++r)if(this._buffer[r]===e)return i-=1,this._buffer[r]=this._buffer[o-1],this._sizes[s]=i,i}else if(i===this._BIG_LIST){let r=this._buffer[n],o=this._bigLists[r],a=o.indexOf(e);if(a!==-1)return o.splice(a,1),o.length}}reserve(t){this._capacity<t&&this._expand(t)}_expand(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=Xg(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=Xg(this._sizes,this._capacity)}has(t){const e=this._idToIndex[t];return!(e===void 0||e>=this._capacity)&&this._sizes[e]!==0}get averageSize(){let t=0;for(let e=0;e<this._capacity;e++)t+=this._sizes[e];return t/this._capacity}};function Xg(t,e){let s=new t.constructor(e);return s.set(t),s}var vr,Yg,Er,Fn,Ar,cn=[0,1],ja=[0,2];for(Er=4;Er<65535;Er<<=2)for(vr=0,Yg=cn.length;vr<Yg;vr++)cn.push(cn[vr]|Er),ja.push((cn[vr]|Er)<<1);function Vs(t,e){return(ja[255&e]|cn[255&t])+65536*(ja[e>>8&255]|cn[t>>8&255])+4294967296*(ja[e>>16&255]|cn[t>>16&255])}function $g(t,e=[0,0]){if(t>0xffffffffffff)throw"Only morton codes up to 48 bits are supported.";if(!Fn){Fn={},Ar={};for(var s=0;s<256;s++)Fn[Vs(s,0)]=s,Ar[Vs(0,s)]=s}var i=Fn[21845&t],n=Ar[43690&t];return t>65535&&(i|=Fn[21845&(t/=65536)]<<8,n|=Ar[43690&t]<<8,t>65535&&(i|=Fn[21845&(t/=65536)]<<16,n|=Ar[43690&t]<<16)),e[0]=i,e[1]=n,e}Vs.code=function(e,s,i){if(e>24)throw"Morton codes are only supported up to Z=24";var n=1<<24-e;return Vs(s*n,i*n)},Vs.range=function(e,s,i){if(e>24)throw"Morton ranges are only supported up to Z=24";var n=1<<24-e,r=Vs(s*n,i*n);return[r,r+n*n-1]},Vs.reverse=$g,Vs.decode=function(e,s){var i=$g(s),n=1<<24-e;return[i[0]/n,i[1]/n]},Vs.min=function(e,s){var i=1431655765&e,n=1431655765&s,r=2863311530&e,o=2863311530&s;return Math.min(i,n)+Math.min(r,o)};var _w=1e-6,pw=1e-12;function Ny(){for(var t=arguments,e=t.length-1,s=e,i=[],n=0;n<=e&&Math.abs(t[n])<=pw;n++)e--;switch(e){case 1:yw(t[s],t[s-1],i);break;case 2:xw(t[s],t[s-1],t[s-2],i);break;case 3:bw(t[s],t[s-1],t[s-2],t[s-3],i)}return i}function yw(t,e,s=[]){return e!==0&&s.push(-t/e),s}function xw(t,e,s,i=[]){var n=e/s,r=n*n-4*(t/s);if(r>0){var o=Math.sqrt(r);i.push(.5*(-n+o)),i.push(.5*(-n-o))}else r===0&&i.push(.5*-n);return i}function bw(t,e,s,i,n=[]){var r,o,a=s/i,l=e/i,d=(3*l-a*a)/3,h=(2*a*a*a-9*l*a+27*(t/i))/27,u=a/3,c=h*h/4+d*d*d/27,g=h/2;if(Math.abs(c)<=_w&&(c=0),c>0){var f=Math.sqrt(c);o=(r=-g+f)>=0?Math.pow(r,1/3):-Math.pow(-r,1/3),(r=-g-f)>=0?o+=Math.pow(r,1/3):o-=Math.pow(-r,1/3),n.push(o-u)}else if(c<0){var m=Math.sqrt(-d/3),_=Math.atan2(Math.sqrt(-c),-g)/3,p=Math.cos(_),x=Math.sin(_),y=Math.sqrt(3);n.push(2*m*p-u),n.push(-m*(p+y*x)-u),n.push(-m*(p-y*x)-u)}else r=g>=0?-Math.pow(g,1/3):Math.pow(-g,1/3),n.push(2*r-u),n.push(-r-u);return n}function zi(t,e,s,i,n,r,o,a,l,d,h){for(var u,c,g=Math.min(o,l),f=Math.min(a,d),m=Math.max(o,l),_=Math.max(a,d),p=Ny((u=a-d)*(t+-2*s+n)+(c=l-o)*(e+-2*i+r),u*(-2*t+2*s)+c*(-2*e+2*i),u*t+c*e+(o*d-l*a)),x=0;x<p.length;x++){var y=p[x];if(0<=y&&y<=1){var b=t+(s-t)*y,v=e+(i-e)*y,E=b+(s+(n-s)*y-b)*y,A=v+(i+(r-i)*y-v)*y;if(o===l){if(f<=A&&A<=_){if(!h)return 1;h.push(E,A)}}else if(a===d){if(g<=E&&E<=m){if(!h)return 1;h.push(E,A)}}else if(E>=g&&A>=f&&E<=m&&A<=_){if(!h)return 1;h.push(E,A)}}}return h?h.length/2:0}function My(t,e,s,i,n,r,o,a,l,d,h){return h?(zi(t,e,s,i,n,r,o,a,l,a,h),zi(t,e,s,i,n,r,l,a,l,d,h),zi(t,e,s,i,n,r,o,d,l,d,h),zi(t,e,s,i,n,r,o,a,o,d,h),h.length/2):o<=t&&l>=t&&a<=e&&d>=e||o<=n&&l>=n&&a<=r&&d>=r||zi(t,e,s,i,n,r,o,a,l,a)||zi(t,e,s,i,n,r,l,a,l,d)||zi(t,e,s,i,n,r,o,d,l,d)||zi(t,e,s,i,n,r,o,a,o,d)?1:0}function Bi(t,e,s,i,n,r,o,a,l,d,h,u,c){for(var g,f,m=Math.min(l,h),_=Math.min(d,u),p=Math.max(l,h),x=Math.max(d,u),y=Ny((g=d-u)*(-1*t+3*s+-3*n+o)+(f=h-l)*(-1*e+3*i+-3*r+a),g*(3*t+-6*s+3*n)+f*(3*e+-6*i+3*r),g*(-3*t+3*s)+f*(-3*e+3*i),g*t+f*e+(l*u-h*d)),b=0;b<y.length;b++){var v=y[b];if(0<=v&&v<=1){var E=t+(s-t)*v,A=e+(i-e)*v,S=s+(n-s)*v,w=i+(r-i)*v,L=E+(S-E)*v,T=A+(w-A)*v,F=L+(S+(n+(o-n)*v-S)*v-L)*v,V=T+(w+(r+(a-r)*v-w)*v-T)*v;if(l===h){if(_<=V&&V<=x){if(!c)return 1;c.push(F,V)}}else if(d===u){if(m<=F&&F<=p){if(!c)return 1;c.push(F,V)}}else if(F>=m&&V>=_&&F<=p&&V<=x){if(!c)return 1;c.push(F,V)}}}return c?c.length/2:0}function Nh(t,e,s,i,n,r,o,a,l,d,h,u,c){return c?(Bi(t,e,s,i,n,r,o,a,l,d,h,d,c),Bi(t,e,s,i,n,r,o,a,h,d,h,u,c),Bi(t,e,s,i,n,r,o,a,l,u,h,u,c),Bi(t,e,s,i,n,r,o,a,l,d,l,u,c),c.length/2):l<=t&&h>=t&&d<=e&&u>=e||l<=o&&h>=o&&d<=a&&u>=a||Bi(t,e,s,i,n,r,o,a,l,d,h,d)||Bi(t,e,s,i,n,r,o,a,h,d,h,u)||Bi(t,e,s,i,n,r,o,a,l,u,h,u)||Bi(t,e,s,i,n,r,o,a,l,d,l,u)?1:0}var Zg=typeof Map>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}set(e,s){e in this._values||this._size++,this._values[e]=s}get(e){return this._values[e]}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Map,vw=typeof Set>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}add(e){e in this._values||this._size++,this._values[e]=!0}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Set,Py=class{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(t){return this._getBounds=t,this}setIntersector(t){return this._intersects=t,this}},Ew=65536,Aw=16,Sw=16,ww=class extends Py{constructor(t,e,s=Sw,i=Ew,n=Int32Array,r=Aw){super(),this._occupied=0,this._idToCode=new Zg,this._codeCache=[0,0,0],this.code=(o,a,l)=>l|Vs(o,a)<<this._bitsForZoom,this.decode=(o,a)=>(Vs.reverse(o>>this._bitsForZoom,a),a[2]=o&this._zoomMask,a),this._intersects=t,this._getBounds=e,this._cells=new mw(n),this._offset=i,this._maxLevels=r,this._mortonMax=(1<<this._maxLevels)-1,this._bitsForZoom=Math.log2(this._maxLevels),this._zoomMask=(1<<this._bitsForZoom)-1,this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._min=-i,this._max=i,this._resolution=this._mortonMax/(this._max-this._min),this._minCellSize=s*this._resolution,this._bounds=new Array(4*this._maxLevels);for(let o=0;o<this._maxLevels;o++)this._bounds[4*o]=1/0,this._bounds[4*o+1]=1/0,this._bounds[4*o+2]=-1/0,this._bounds[4*o+3]=-1/0}setMinCellSize(t){return this._minCellSize=t,this}setOffset(t){return this._offset=t,this._min=-t,this._max=t,this._resolution=this._mortonMax/(this._max-this._min),this}insert(t,e,s,i,n){e===void 0&&([e,s,i,n]=this._getBounds(t));const r=Math.max(i-e,n-s);let o,a=this._minCellSize;for(o=0;a<r&&o<this._maxLevels-1;o++)a*=2;const l=this._resolution,d=this._min,h=l*(.5*(i+e)-d)/a|0,u=l*(.5*(n+s)-d)/a|0,c=this.code(h,u,o);this._cells.has(c)||this._cells.addEntry(c),this._cells.addTo(c,t),this._objectsAtLevel[o]++,this._occupied|=1<<o;const g=4*o,f=this._bounds;return h<f[g]&&(f[g]=h),u<f[g+1]&&(f[g+1]=u),h>f[g+2]&&(f[g+2]=h),u>f[g+3]&&(f[g+3]=u),this._idToCode.set(t,c),c}has(t){return this._idToCode.has(t)}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n)}remove(t){const e=this._idToCode.get(t);this.decode(e,this._codeCache);const s=this._codeCache[2];return--this._objectsAtLevel[s]==0&&(this._occupied&=~(1<<s),this._bounds[4*s]=1/0,this._bounds[4*s+1]=1/0,this._bounds[4*s+2]=-1/0,this._bounds[4*s+3]=-1/0),this._cells.removeFrom(e,t),this._idToCode.delete(t),this}query(t,e,s,i){const n=this._cells,r=this._bounds,o=this._intersects,a=this._min,l=this._resolution;let d=this._minCellSize,h=this._occupied;const u=[];for(let c=0;c<this._maxLevels&&h!==0;d*=2,h>>=1,c++){if(!(1&h))continue;const g=1/d,f=4*c,m=Math.max(r[f],l*(t-a)*g-1|0),_=Math.max(r[f+1],l*(e-a)*g-1|0),p=Math.min(r[f+2],l*(s-a)*g+1|0),x=Math.min(r[f+3],l*(i-a)*g+1|0);for(let y=m;y<=p;y++)for(let b=_;b<=x;b++){const v=this.code(y,b,c),E=n.getItems(v);if(E!==void 0)for(let A=0;A<E.length;A++){const S=E[A];o(S,t,e,s,i)&&u.push(S)}}}return u}traverse(t,e,s,i,n){const r=this._cells,o=this._bounds,a=this._intersects,l=this._min,d=this._resolution;let h=this._minCellSize,u=this._occupied;const c=[];for(let g=0;g<this._maxLevels&&u!==0;h*=2,u>>=1,g++){if(!(1&u))continue;const f=1/h,m=4*g,_=Math.max(o[m],d*(t-l)*f-1|0),p=Math.max(o[m+1],d*(e-l)*f-1|0),x=Math.min(o[m+2],d*(s-l)*f+1|0),y=Math.min(o[m+3],d*(i-l)*f+1|0);for(let b=_;b<=x;b++)for(let v=p;v<=y;v++){const E=this.code(b,v,g),A=r.getItems(E);if(A!==void 0)for(let S=0;S<A.length;S++){const w=A[S];if(a(w,t,e,s,i)&&(c.push(w),n(w)))return c}}}return c}collisions(t,e=this._getBounds){if(typeof e!="function")throw new Error("getBounds function is required to get the object bounds");const s=Array.from(this._idToCode.keys()),i=this._min,n=this._resolution,r=this._cells,o=new Zg,a=[];for(let l=0;l<s.length;l++){let d=0,h=this._minCellSize,u=this._occupied;const c=s[l];let[g,f,m,_]=e(c);const p=Math.max(m-g,_-f);for(d=0;h<p;d++)h*=2,u>>=1;g=n*(g-i),f=n*(f-i),m=n*(m-i),_=n*(_-i);for(let x=d;x<this._maxLevels&&u!==0;h*=2,u>>=1,x++){if(!(1&u))continue;const y=1/h,b=f*y-1|0,v=m*y+1|0,E=_*y+1|0;for(let A=g*y-1|0;A<=v;A++)for(let S=b;S<=E;S++){const w=this.code(A,S,x);if(o.get(w)===l)continue;o.set(w,l);const L=r.getItems(w);if(L!==void 0)for(let T=0;T<L.length;T++){const F=L[T],[V,G,O,j]=this._getBounds(F);F!==c&&t(c,V,G,O,j)&&a.push(c,F)}}}}return Tw(a)}clear(){this._occupied=0,this._cells.clear(),this._idToCode.clear(),this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._bounds=new Array(4*this._maxLevels);for(let t=0;t<this._maxLevels;t++)this._bounds[4*t]=1/0,this._bounds[4*t+1]=1/0,this._bounds[4*t+2]=-1/0,this._bounds[4*t+3]=-1/0;return this}keyToBBox(t){const[e,s,i]=this.decode(t,[0,0,0]),n=this._minCellSize*(1<<i),r=this._min,o=this._resolution;return[e*n/o+r,s*n/o+r,(e+1)*n/o+r,(s+1)*n/o+r]}keys(){return Object.keys(this._cells._idToIndex)}get averageCellOccupancy(){return this._cells.averageSize}get size(){return this._idToCode.size}getBoxes(){return Array.from(this._idToCode.keys()).map(t=>this._getBounds(t))}};function Tw(t){const e=new vw,s=[];for(let i=0;i<t.length;i+=2){const n=t[i],r=t[i+1],o=n<r?n*r+(r-n-1)*(r-n-1)/4:n*r+(n-r-1)*(n-r-1)/4;e.has(o)||(e.add(o),s.push(n,r))}return s}function Iw(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function mi(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}var gi=(t,e,s,i,n,r)=>({minX:t,minY:e,maxX:s,maxY:i,leaf:!0,level:r,parent:n,objects:[],final:!1,children:null});function Ry(t){const{minX:e,minY:s,maxX:i,maxY:n}=t;return[e,s,i,n]}function Ur(t,e,s,i,n,r,o,a){return t>=n&&s<=o&&e>=r&&i<=a}var Cw=0,Lw=1,Nw=2,Mw=3;function ea(t,e,s,i,n,r,o,a){const l=(r+a)/2,d=(e+i)/2;return(t+s)/2<=(n+o)/2?d<=l?Cw:Lw:d<=l?Mw:Nw}var Pw=t=>t,Bn=class extends Py{constructor(t=Pw,e=10,s,i=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=e,this._root=null,this._getBounds=t,this._rootLevel=i,this._maxLevel=i+30,this._idToCell={},s&&(this._root=gi(s[0],s[1],s[2],s[3],null,i))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(t,e,s,i,n,r=this._root){if(e||([e,s,i,n]=this._getBounds(t)),this._objects[t])return;if(this._objects[t]=!0,this._size++,!this._root){const g=Math.max(Math.abs(i-e),Math.abs(n-s));return this._root=gi(e,s,e+g,s+g,null,this._rootLevel),this._idToCell[t]=[this._root],this._root.objects=[t],t}let o,a=[r],l=!1;const d=this._nodeCapacity,h=this._idToCell,u=this._maxLevel;let c;for(;c=a.pop();){o=c;const{minX:g,minY:f,maxX:m,maxY:_}=o;mi(e,s,i,n,g,f,m,_)&&(o.leaf?o.objects&&(o.objects.length<d||o.final)?(o.objects.push(t),h[t]?h[t].push(o):h[t]=[o],l=!0,(o.level>=u||Math.abs(m-g)<=Math.abs(i-e)||Math.abs(_-f)<=Math.abs(n-s))&&(o.final=!0)):(this.splitNode(o),a.push(o)):a.push.apply(a,o.children))}if(!Ur(e,s,i,n,(r=this._root).minX,r.minY,r.maxX,r.maxY)){let g=this._rootLevel;for(;!Ur(e,s,i,n,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){r=this._root;const{minX:f,minY:m,maxX:_,maxY:p}=r;let x=f,y=m,b=_,v=p;const E=Math.abs(_-f),A=Math.abs(p-m);if(A===0&&E===0)break;const S=Math.max(E,A);e<f?(x-=S,s<m?y-=S:v+=S):(b+=S,s<m?y-=S:v+=S);const w=gi(x,y,b,v,null,--g);this.splitNode(w),w.children[ea(f,m,_,p,x,y,b,v)]=r,this._root=r.parent=w}for(a=[this._root],this._root.level=this._rootLevel;c=a.shift();)if(o=c,!o.leaf)for(let f=0;f<4;f++){const m=o.children[f];m.level=o.level+1,a.push(m)}r=this._root;for(let f=0;f<4;f++){const m=r.children[f];m&&m.leaf&&m.objects&&(m.objects.push(t),h[t]?h[t].push(m):h[t]=[m])}}return l?t:void 0}removeById(t){if(!this._objects[t])return t;this._size--;const e=this._idToCell[t];for(let s=0;s<e.length;s++){const i=e[s].objects||[];for(let n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}}return delete this._objects[t],delete this._idToCell[t],t}remove(t){const[e,s,i,n]=this._getBounds(t),r=[this._root];let o,a;const l=[];for(;o=r.pop();)if(mi(e,s,i,n,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const d=o.objects||[];for(let h=0,u=d.length;h<u;h++)if(d[h]===t){d.splice(h,1),u===1&&l.push(o);break}}else r.push.apply(r,o.children);if(delete this._idToCell[t],delete this._objects[t],this._size--,l.length)for(;a=l.pop();){let d=a.parent,h=!0;for(;d&&h;){if(!d.leaf){for(let u=0;u<4;u++)if(o=d.children[u],!o.leaf||o.objects&&o.objects.length!==0){h=!1;break}h&&(d.leaf=!0,d.children=[],d.objects=[])}d=d.parent}}return t}splitNode(t){const{minX:e,minY:s,maxX:i,maxY:n}=t,r=(e+i)/2,o=(s+n)/2,a=t.level+1,l=this._idToCell,d=this._maxLevel,h=[gi(e,s,r,o,t,a),gi(e,o,r,n,t,a),gi(r,o,i,n,t,a),gi(r,s,i,o,t,a)];if(t.objects!==null){const u=t.objects,c=this._getBounds;for(let g=0,f=u.length;g<f;g++){const m=u[g],_=c(m);let p=l[m];for(let x=0;x<4;x++){const y=h[x],{minX:b,minY:v,maxX:E,maxY:A}=y;mi(_[0],_[1],_[2],_[3],b,v,E,A)&&(y.objects&&y.objects.push(m),(y.level>=d||Math.abs(E-b)<=Math.abs(_[2]-_[0])||Math.abs(A-v)<=Math.abs(_[3]-_[1]))&&(y.final=!0),p?p.push(y):p=[y])}p&&p.splice(p.indexOf(t),1)}}t.children=h,t.objects=null,t.leaf=!1}point(t,e,s){let i=[];const n=[this._root];let r,o,a;const l=this._getBounds;for(;r=n.pop();)if(t>=r.minX&&t<=r.maxX&&e>=r.minY&&e<=r.maxY){if(r.leaf){s&&r.objects&&(i=r.objects);const d=r.objects||[];for(let h=0,u=d.length;h<u;h++)a=d[h],o=l(a),t>=o[0]&&t<=o[2]&&e>=o[1]&&e<=o[3]&&i.push(a);break}n.push.apply(n,r.children)}return i.length?i:null}neigbours(t,e){let s,i=[];const n=[this._root];for(;s=n.pop();)if(t>=s.minX&&t<=s.maxX&&e>=s.minY&&e<=s.maxY){if(s.leaf){i=s.objects;break}n.push.apply(n,s.children)}return i}query(t,e,s,i){const n=[],r=[this._root];let o,a,l;const d=this._getBounds,h={},u=this._intersects;let c;for(;o=r.pop();)if(mi(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const g=o.objects||[];for(let f=0,m=g.length;f<m;f++)l=g[f],h[l]||(a=d(l),mi(t,e,s,i,a[0],a[1],a[2],a[3])&&(u&&!u(l,t,e,s,i)||n.push(l)),h[l]=!0)}else c=ea(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY),r.push(o.children[(c+3)%4],o.children[(c+2)%4],o.children[(c+1)%4],o.children[c]);return n}traverse(t,e,s,i,n){const r=[],o=[this._root];let a,l,d;const h=this._getBounds,u={},c=this._intersects;let g;for(;a=o.pop();)if(mi(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY))if(a.leaf){const f=a.objects||[];for(let m=0,_=f.length;m<_;m++)if(d=f[m],!u[d]){if(l=h(d),mi(t,e,s,i,l[0],l[1],l[2],l[3])&&(!c||c(d,t,e,s,i))&&(r.push(d),n(d)))return r;u[d]=!0}}else g=ea(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY),o.push(a.children[(g+3)%4],a.children[(g+2)%4],a.children[(g+1)%4],a.children[g]);return r}getOverlaps(){const t=[this._root];let e,s,i;const n=[],r=this._getBounds,o={};for(;e=t.pop();)if(e.leaf){const a=e.objects||[],l=a.length;for(let d=0;d<l;d++)for(let h=0;h<l;h++)if(s=a[d],i=a[h],d!==h&&!o[s+":"+i]&&!o[i+":"+s]){o[s+":"+i]=!0;const u=r(s),c=r(i);mi(u[0],u[1],u[2],u[3],c[0],c[1],c[2],c[3])&&n.push(s,i)}}else t.push.apply(t,e.children);return n}cover(t,e,s,i){if(this._root===null)return this._root=gi(t,e,s,i,null,0),this;let n=this._root;if(!Ur(t,e,s,i,n.minX,n.minY,n.maxX,n.maxY)){let r=this._rootLevel;for(;!Ur(t,e,s,i,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){n=this._root;const{minX:d,minY:h,maxX:u,maxY:c}=n;let g=d,f=h,m=u,_=c;const p=Math.abs(u-d),x=Math.abs(c-h);if(x===0&&p===0)break;const y=Math.max(p,x);t<d?(g-=y,e<h?f-=y:_+=y):(m+=y,e<h?f-=y:_+=y);const b=gi(g,f,m,_,null,--r);this.splitNode(b),b.children[ea(d,h,u,c,g,f,m,_)]=n,this._root=n.parent=b}const o=[this._root];let a,l;for(this._root.level=this._rootLevel;a=o.shift();)if(l=a,!l.leaf)for(let d=0;d<4;d++){const h=l.children[d];h.level=l.level+1,o.push(h)}}return this}getAll(){return Object.keys(this._objects).map(t=>Number(t))}forEach(t,e){const s=[this._root];let i;for(;i=s.pop();)if(i.leaf&&i.objects)for(let n=0,r=i.objects.length;n<r;n++)t.call(e,i.objects[n]);else s.push.apply(s,i.children);return this}getLeafs(){const t=[this._root],e=[];let s;for(;s=t.pop();)s.leaf?e.push(s):t.push.apply(t,s.children);return e}traverseFromRoot(t,e){const s=[this._root];let i;for(;i=s.pop();)t.call(e,i,i.objects)||i.leaf||s.push.apply(s,i.children);return this}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n),this}getNodeBounds(t){return Ry(t)}};Bn.flatAccessor=(t,e)=>s=>{const i=e*s;return t.slice(i,i+e)},Bn.inside=Ur,Bn.intersects=Iw,Bn.overlaps=mi,Bn.getNodeBBox=Ry;var Fy=Bn;function Rw(t){const e=+this._x.call(null,t),s=+this._y.call(null,t);return Dy(this.cover(e,s),e,s,t)}function Dy(t,e,s,i){if(isNaN(e)||isNaN(s))return t;var n,r,o,a,l,d,h,u,c,g=t._root,f={data:i},m=t._x0,_=t._y0,p=t._x1,x=t._y1;if(!g)return t._root=f,t;for(;g.length;)if((d=e>=(r=(m+p)/2))?m=r:p=r,(h=s>=(o=(_+x)/2))?_=o:x=o,n=g,!(g=g[u=h<<1|d]))return n[u]=f,t;if(a=+t._x.call(null,g.data),l=+t._y.call(null,g.data),e===a&&s===l)return f.next=g,n?n[u]=f:t._root=f,t;do n=n?n[u]=new Array(4):t._root=new Array(4),(d=e>=(r=(m+p)/2))?m=r:p=r,(h=s>=(o=(_+x)/2))?_=o:x=o;while((u=h<<1|d)==(c=(l>=o)<<1|a>=r));return n[c]=g,n[u]=f,t}function Fw(t){var e,s,i,n,r=t.length,o=new Array(r),a=new Array(r),l=1/0,d=1/0,h=-1/0,u=-1/0;for(s=0;s<r;++s)isNaN(i=+this._x.call(null,e=t[s]))||isNaN(n=+this._y.call(null,e))||(o[s]=i,a[s]=n,i<l&&(l=i),i>h&&(h=i),n<d&&(d=n),n>u&&(u=n));if(l>h||d>u)return this;for(this.cover(l,d).cover(h,u),s=0;s<r;++s)Dy(this,o[s],a[s],t[s]);return this}function Dw(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var s=this._x0,i=this._y0,n=this._x1,r=this._y1;if(isNaN(s))n=(s=Math.floor(t))+1,r=(i=Math.floor(e))+1;else{for(var o,a,l=n-s||1,d=this._root;s>t||t>=n||i>e||e>=r;)switch(a=(e<i)<<1|t<s,(o=new Array(4))[a]=d,d=o,l*=2,a){case 0:n=s+l,r=i+l;break;case 1:s=n-l,r=i+l;break;case 2:n=s+l,i=r-l;break;case 3:s=n-l,i=r-l}this._root&&this._root.length&&(this._root=d)}return this._x0=s,this._y0=i,this._x1=n,this._y1=r,this}function Ow(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function kw(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function us(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n}function zw(t,e,s){var i,n,r,o,a,l,d,h=this._x0,u=this._y0,c=this._x1,g=this._y1,f=[],m=this._root;for(m&&f.push(new us(m,h,u,c,g)),s==null?s=1/0:(h=t-s,u=e-s,c=t+s,g=e+s,s*=s);l=f.pop();)if(!(!(m=l.node)||(n=l.x0)>c||(r=l.y0)>g||(o=l.x1)<h||(a=l.y1)<u))if(m.length){var _=(n+o)/2,p=(r+a)/2;f.push(new us(m[3],_,p,o,a),new us(m[2],n,p,_,a),new us(m[1],_,r,o,p),new us(m[0],n,r,_,p)),(d=(e>=p)<<1|t>=_)&&(l=f[f.length-1],f[f.length-1]=f[f.length-1-d],f[f.length-1-d]=l)}else{var x=t-+this._x.call(null,m.data),y=e-+this._y.call(null,m.data),b=x*x+y*y;if(b<s){var v=Math.sqrt(s=b);h=t-v,u=e-v,c=t+v,g=e+v,i=m.data}}return i}function Bw(t){if(isNaN(r=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,s,i,n,r,o,a,l,d,h,u,c,g=this._root,f=this._x0,m=this._y0,_=this._x1,p=this._y1;if(!g)return this;if(g.length)for(;;){if((d=r>=(a=(f+_)/2))?f=a:_=a,(h=o>=(l=(m+p)/2))?m=l:p=l,e=g,!(g=g[u=h<<1|d]))return this;if(!g.length)break;(e[u+1&3]||e[u+2&3]||e[u+3&3])&&(s=e,c=u)}for(;g.data!==t;)if(i=g,!(g=g.next))return this;return(n=g.next)&&delete g.next,i?(n?i.next=n:delete i.next,this):e?(n?e[u]=n:delete e[u],(g=e[0]||e[1]||e[2]||e[3])&&g===(e[3]||e[2]||e[1]||e[0])&&!g.length&&(s?s[c]=g:this._root=g),this):(this._root=n,this)}function Uw(t){for(var e=0,s=t.length;e<s;++e)this.remove(t[e]);return this}function Gw(){return this._root}function Vw(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function qw(t){var e,s,i,n,r,o,a=[],l=this._root;for(l&&a.push(new us(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,i=e.x0,n=e.y0,r=e.x1,o=e.y1)&&l.length){var d=(i+r)/2,h=(n+o)/2;(s=l[3])&&a.push(new us(s,d,h,r,o)),(s=l[2])&&a.push(new us(s,i,h,d,o)),(s=l[1])&&a.push(new us(s,d,n,r,h)),(s=l[0])&&a.push(new us(s,i,n,d,h))}return this}function jw(t){var e,s=[],i=[];for(this._root&&s.push(new us(this._root,this._x0,this._y0,this._x1,this._y1));e=s.pop();){var n=e.node;if(n.length){var r,o=e.x0,a=e.y0,l=e.x1,d=e.y1,h=(o+l)/2,u=(a+d)/2;(r=n[0])&&s.push(new us(r,o,a,h,u)),(r=n[1])&&s.push(new us(r,h,a,l,u)),(r=n[2])&&s.push(new us(r,o,u,h,d)),(r=n[3])&&s.push(new us(r,h,u,l,d))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function Hw(t){return t[0]}function Ww(t){return arguments.length?(this._x=t,this):this._x}function Xw(t){return t[1]}function Yw(t){return arguments.length?(this._y=t,this):this._y}function Oy(t,e,s){var i=new Zu(e??Hw,s??Xw,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function Zu(t,e,s,i,n,r){this._x=t,this._y=e,this._x0=s,this._y0=i,this._x1=n,this._y1=r,this._root=void 0}function Kg(t){for(var e={data:t.data},s=e;t=t.next;)s=s.next={data:t.data};return e}var ls=Oy.prototype=Zu.prototype;ls.copy=function(){var t,e,s=new Zu(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return s;if(!i.length)return s._root=Kg(i),s;for(t=[{source:i,target:s._root=new Array(4)}];i=t.pop();)for(var n=0;n<4;++n)(e=i.source[n])&&(e.length?t.push({source:e,target:i.target[n]=new Array(4)}):i.target[n]=Kg(e));return s},ls.add=Rw,ls.addAll=Fw,ls.cover=Dw,ls.data=Ow,ls.extent=kw,ls.find=zw,ls.remove=Bw,ls.removeAll=Uw,ls.root=Gw,ls.size=Vw,ls.visit=qw,ls.visitAfter=jw,ls.x=Ww,ls.y=Yw;var Sr=function(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n},$w=function(t){const e=[];let s,i,n,r,o,a,l,d=this._root;for(d&&e.push(new Sr(d,this._x0,this._y0,this._x1,this._y1));(s=e.pop())&&(l=t(d=s.node,n=s.x0,r=s.y0,o=s.x1,a=s.y1),l!=="break");)if(!l&&d.length){const h=(n+o)/2,u=(r+a)/2;(i=d[3])&&e.push(new Sr(i,h,u,o,a)),(i=d[2])&&e.push(new Sr(i,n,u,h,a)),(i=d[1])&&e.push(new Sr(i,h,r,o,u)),(i=d[0])&&e.push(new Sr(i,n,r,h,u))}return this};function Ku(t,e,s,i,n){const r=new Array(t.length);for(let o=0;o<e.length;o++){const a=i[e[o]],l=i[s[o]];r[a]=r[a]||[],r[a].push(l),n&&(r[l]=r[l]||[],r[l].push(a))}return r}function co(t,e){return t[e]===-1?e:co(t,t[e])}function Zw(t,e,s){const i=co(t,e),n=co(t,s);t[i]=n}function Kw(t,e,s,i=!1){const n=new Int32Array(t.length),r={};for(let o=0;o<t.length;o++)n[o]=-1,r[t[o]]=o;for(let o=0;o<e.length;o++){const a=r[e[o]],l=r[s[o]];if(i&&a===l)return!0;const d=co(n,a),h=co(n,l);if(d===h)return!0;Zw(n,d,h)}return!1}function ky(t,e,s,i,n,r,o,a){if(i[t]=n,s[t])return!0;if(e[t])return!1;e[t]=1,s[t]=1;const l=r[t];if(l){for(const d of l)if(ky(d,e,s,i,t,r,o,a))return o.push(a[d]),!0}return s[t]=0,!1}function zy(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Uint8Array(i),o=new Int32Array(i),a={};for(let d=0;d<i;d++)a[t[d]]=d;const l=Ku(t,e,s,a,!1);for(let d=0;d<i;d++){const h=[];if(ky(d,n,r,o,-1,l,h,t)&&h.length>1){const u=h[0];for(let c=1;c<h.length;c++)if(h[c]===u){h.length=c;break}return h.push(u),h.reverse()}}return!1}function By(t,e,s,i,n,r,o){e[t]=1,i[t]=s;const a=n[t];if(a){for(const l of a)if(e[l]){if(l!==s)return i[l]=t,r.push(o[l]),!0}else if(By(l,e,t,i,n,r,o))return r.push(o[l]),!0}return!1}function Qw(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Int32Array(i),o={};for(let l=0;l<i;l++)o[t[l]]=l,r[l]=-1;const a=Ku(t,e,s,o,!0);for(let l=0;l<e.length;l++){const d=o[e[l]],h=o[s[l]];a[d]=a[d]||[],a[d].push(h)}for(let l=0;l<i;l++){const d=l,h=[];if(!n[d]&&By(d,n,-1,r,a,h,t))return!0}return!1}Oy.prototype.visit2=$w;var Uy=class{constructor(t,e,s){this.cycles=[],this.visitedLength=0,this.visitedStack=[],this.stack=[],this.idToIndex={},this.removed={},this.nodes=t,this.visited=new Uint8Array(this.nodes.length);for(let i=0;i<t.length;i++)this.idToIndex[t[i]]=i;this.adjacency=Ku(t,e,s,this.idToIndex)}getCycles(){this.visited=new Uint8Array(this.nodes.length),this.visitedStack=[];for(let t=0;t<this.nodes.length;t++)for(this.backtrack(t,t);this.visitedLength!==0;){const e=this.visitedStack.pop();e!==void 0&&this.visited[e]&&(this.visited[e]=0,this.visitedLength--)}return this.cycles}backtrack(t,e){let s=!1;this.stack.push(e),this.visited[e]||(this.visited[e]=1,this.visitedLength++),this.visitedStack.push(e);const i=this.adjacency[e]||[];for(const n of i)if(this.removed[e]=this.removed[e]||{},!this.removed[e][n]){if(n<t)this.removed[e][n]=!0;else if(n===t){s=!0;const r=[];for(let o=0,a=!1;o<this.stack.length;o++){const l=this.stack[o];t===l&&(a=!0),a&&r.push(this.nodes[l])}this.cycles.push(r)}else if(!this.visited[n]){const r=this.backtrack(t,n);s=s||r}}if(s){let n;do n=this.visitedStack.pop(),this.visited[n]&&(this.visited[n]=0,this.visitedLength--);while(n!==e)}return this.stack.pop(),s}};function Jw(){return{index:{},parent:[],count:0}}function tT(t,e){t.index[e]===void 0&&(t.count+=1,t.index[e]=t.parent.push(-t.count))}function Qg(t,e){let s=t.index[e];if(s===void 0)return-1;for(;s>=0;)e=s,s=t.parent[s];return e}function eT(t,e,s){t.parent[s]=e,t.count-=1}function sT(t){return t.count<=1}function Gy(t,e,s,i,n){n&&e.sort((a,l)=>n(a)-n(l));const r=[],o=Jw();t.forEach(a=>tT(o,a));for(let a=0;a<e.length&&!sT(o);a++){const l=Qg(o,s(e[a])),d=Qg(o,i(e[a]));l!==d&&l>0&&d>0&&(eT(o,l,d),r.push(e[a]))}return r}function Vy({adjacency:t,directed:e=!1,normalized:s=!0}){const i=[],n=[],r={},o={},a={},l={};let d;const h=new Array(t.length),u={},c={},g={};for(let x=0;x<t.length;x++){const y=t[x];g[y.id]=y.adj,u[y.id]=!0,c[y.id]=x,e||y.adj.forEach(b=>{u[b]=!0})}const f=Object.keys(u).map(x=>+x);for(let x=0;x<f.length;x++)h[x]=0;for(let x=0;x<f.length;x++)d=f[x],p(d),_();const m=s?f.length>2?1/((f.length-1)*(f.length-2)):0:e?0:.5;if(m)for(let x=0;x<h.length;x++)h[x]*=m;return h;function _(){for(let x=0;x<f.length;x++)l[f[x]]=0;for(;n.length;){const x=n.pop(),y=(1+l[x])/a[x],b=r[x];for(let v=0;v<b.length;++v){const E=b[v];l[E]+=a[E]*y}x!==d&&(h[c[x]]+=l[x])}}function p(x){for(let y=0;y<f.length;y++){const b=f[y];r[b]=[],o[b]=-1,a[b]=0}for(o[x]=0,a[x]=1,i.push(x);i.length;){const y=i.shift();n.push(y),g[y].forEach(b=>{o[b]===-1&&(o[b]=o[y]+1,i.push(b)),o[b]===o[y]+1&&(a[b]+=a[y],r[b].push(y))})}}}var qy=class{constructor(t){this._heap=[],this._size=0,this._keyToValue=t,this._keyToIndex=new Int32Array(t.length),this._keyToIndex.fill(-1)}add(t){let e=this._keyToIndex[t];e===-1&&(e=this._size++,this._heap[e]=t),this._keyToIndex[t]=this._bubble(e)}removeMin(){if(this._size===0)return NaN;const t=this._heap[0];return this._heap[0]=this._heap[--this._size],this._bubble(0),t}isEmpty(){return this._size===0}has(t){return this._keyToIndex[t]!==-1}_bubble(t){const e=this._indexToValue(t),s=this._getParentIndex(t),i=this._indexToValue(s);let n=t;if(t!==0&&i>e)n=this._swap(t,s);else{const r=this._getLeftChildIndex(t),o=this._getRightChildIndex(t),a=this._indexToValue(r),l=this._indexToValue(o),d=Math.min(e,a,l);d===e||(n=d===a?this._swap(t,r):this._swap(t,o))}return n===t?t:this._bubble(n)}_indexToValue(t){return t>=this._size?1/0:this._keyToValue[this._heap[t]]}_getParentIndex(t){return(t-1)/2|0}_getLeftChildIndex(t){return 2*t+1}_getRightChildIndex(t){return 2*t+2}_swap(t,e){const s=this._heap[t],i=this._heap[e];return this._heap[t]=i,this._heap[e]=s,this._keyToIndex[s]=e,this._keyToIndex[i]=t,e}},jy=$i&&!!window.PointerEvent,jl="pointerdown",Hl="pointermove",Wl="pointerup",Po="pointercancel",dr={},fl=0,Hy=t=>t.pointerType==="mouse",Wy=t=>t.pointerType!=="mouse";function iT(){if(Ti&&fl===0&&jy){const t=document.documentElement;t.addEventListener(jl,Xy,!0),t.addEventListener(Hl,Yy,!0),t.addEventListener(Wl,ml,!0),t.addEventListener(Po,ml,!0)}fl++}function nT(){if(fl--,Ti&&fl===0){const t=document.documentElement;t.removeEventListener(jl,Xy,!0),t.removeEventListener(Hl,Yy,!0),t.removeEventListener(Wl,ml,!0),t.removeEventListener(Po,ml,!0)}}function Xy(t){dr[t.pointerId]=t}function Yy(t){dr[t.pointerId]&&(dr[t.pointerId]=t)}function ml(t){delete dr[t.pointerId]}function Xl(t,e){t.touches=[];for(const s in dr)t.touches.push(dr[s]);t.changedTouches=[t],e(t)}function rT(t,e,s){const i=n=>{Hy(n)||(Wy(n)&&n.preventDefault(),Xl(n,s))};return t(e,jl,i,!1),i}function oT(t,e,s){const i=n=>{Wy(n)&&n.preventDefault(),Xl(n,s)};return t(e,Po,i,!1),i}function aT(t,e,s){const i=n=>{Hy(n)&&n.buttons===0||Xl(n,s)};return t(e,Hl,i,!1),i}function lT(t,e,s){const i=n=>Xl(n,s);return t(e,Wl,i,!1),t(e,Po,i,!1),i}function Jg(t,e,s,i){return s==="touchstart"?t(e,jl,i,!1):s==="touchmove"?t(e,Hl,i,!1):s==="touchend"?(t(e,Wl,i,!1),t(e,Po,i,!1)):void 0}var dT=["graphics","legend","brand"],Ed=300,Ad=300,hT=200,uT=class extends Bt{constructor(){super(...arguments),this._width=Ed,this._height=Ad,this._resizeObserver=qp(()=>this._resize()),this._layers={},this._focus=!1,this._container=null,this._isFullScreen=!1,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],this._refreshUntil=0,this._currentTime=ts(),this._timeouts=[],this._isDestroyed=!1,this._onDetachDom=[],this._isRealBrowser=zl,this._isDocumentReady=Bl,this._inFrame=!1,this._mustRefresh=!1,this._nextFrame=null,this._onWindowFocus=()=>this.refresh(),this._onFullscreenChange=()=>{this._isFullScreen=Qr()},this._resize=t=>{if(!this._container&&!t)return;const e=this._width,s=this._height;let i=0,n=0;if(this._container){const r=this._modules.settings.get("minimumWidth"),o=this._modules.settings.get("minimumHeight"),a=this._container.clientWidth||1,l=this._container.clientHeight||1;i=Math.max(r,t?t.width:a),n=Math.max(o,t?t.height:l)}else t&&(i=t.width,n=t.height);i===e&&n===s||(this._width=i,this._height=n,ri(this._layers,({element:r,automaticResize:o})=>{o&&nl(r,i,n)}),this._modules.events.fire("resize",{prevWidth:e,prevHeight:s,width:i,height:n,difWidth:i-e,difHeight:n-s}))}}onMounted(){this._modules.settings.register("minimumWidth",Ed,()=>this._resize(),!1),this._modules.settings.register("minimumHeight",Ad,()=>this._resize(),!1),this._modules.events.register(["beforeNewFrame","frame","afterNewFrame","setContainer","resize"]),this._onDetachDom=[],iT(),this.addWindowEventListener("focus",this._onWindowFocus)}onReady(t){t.container&&this.setContainer(t.container),t.options?.width||t.options?.height?this._resize({width:t.options.width||Ed,height:t.options.height||Ad}):this._resize()}addWindowEventListener(t,e,s){return this._isRealBrowser&&this.addElementEventListener(window,t,e,s),this}addDirectWindowEventListener(t,e,s){this._isRealBrowser&&window.addEventListener(t,e,s)}removeDirectWindowEventListener(t,e){this._isRealBrowser&&window.removeEventListener(t,e)}addDocumentEventListener(t,e,s){return this._isDocumentReady&&this.addElementEventListener(document.documentElement,t,e,s),e}removeDocumentEventListener(t,e){this._isDocumentReady&&document.documentElement.removeEventListener(t,e)}addMediaListener(t,e){if(this._isDocumentReady&&typeof window.matchMedia=="function"){const s=window.matchMedia(t);s.addListener(e),this._onDetachDom.push(()=>s.removeListener(e))}}addElementEventListener(t,e,s,i){return this._isDestroyed||(t.addEventListener(e,s,i),this._onDetachDom.push(()=>t.removeEventListener(e,s,i))),s}detachFromDom(){this._onDetachDom.forEach(t=>t()),this._onDetachDom=[],this._emptyContainer()}setTimeout(t,e=0){const s=setTimeout(()=>{this._timeouts.splice(this._timeouts.indexOf(s),1),t()},e);return this._timeouts.push(s),s}clearTimeout(t){return t&&(clearTimeout(t),this._timeouts.splice(this._timeouts.indexOf(t),1)),null}clearAllTimeouts(){this._timeouts.forEach(clearTimeout),this._timeouts=[]}stopFrames(){this._isDestroyed=!0,this._nextFrame&&(kp(this._nextFrame),this._nextFrame=null)}isDestroyed(){return this._isDestroyed}getDimensions(){return{width:this._width,height:this._height}}setDimensions(t){this._resize(t)}setLayer(t,e,{automaticResize:s=!1}={}){e?(e._ogmaLayer=t,s&&(e.style.position="absolute",e.style.top="0px",e.style.left="0px",nl(e,this._width,this._height,ps())),this._layers[t]={element:e,automaticResize:s}):e===null&&delete this._layers[t],this._updateContainerContent()}setContainer(t){let e;if(typeof t=="string"){if(e=document.getElementById(t),!e)throw new Error(`unable to find DOM element with id "${t}"`)}else e=t;if(e===this._container)return;e===null&&this._emptyContainer();const s=this._container;this._isFullScreen=!1,this._container&&this._resizeObserver.unobserve(this._container),this._container=e,this._container&&(["fullscreenchange","webkitfullscreenchange"].forEach(i=>{this.addElementEventListener(this._container,i,this._onFullscreenChange)}),this._resizeObserver.observe(this._container)),this._resize(),this._updateContainerContent(),this._modules.events.fire("setContainer",{element:e,prevElement:s})}getContainer(){return this._container}appendElement(t){this._container!==null&&this._container.appendChild(t)}focus(){this._focus=!0}blur(){this._focus=!1}hasFocus(){return this._focus}forceResize(){this._resize()}_beforeOrAfterNextFrame(t){const e=t?this._afterNextFramePromises:this._beforeNextFramePromises,s=new Promise(i=>{e.push(()=>(i(void 0),s))});return this._refresh(),s}beforeNextFrame(){return this._beforeOrAfterNextFrame(!1)}afterNextFrame(){return this._beforeOrAfterNextFrame(!0)}refresh(t){t&&(this._refreshUntil=Math.max(this._refreshUntil,t)),this._refresh()}_emptyContainer(){if(this._container){const t=[];for(let e=0;e<this._container.childNodes.length;++e){const s=this._container.childNodes[e];s._ogmaLayer&&t.push(s)}for(let e=0;e<t.length;++e)this._container.removeChild(t[e])}}_fillContainer(){if(this._container){const t=jp(this._container,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(this._container.style.position="relative");const e=this._container.firstChild;dT.forEach(s=>{const i=this._layers[s];i&&i.element&&this._container&&this._container.insertBefore(i.element,e)})}}_updateContainerContent(){this._emptyContainer(),this._fillContainer()}_refresh(){this._inFrame?this._mustRefresh=!0:this._nextFrame||this._isDestroyed||(this._nextFrame=Ru(()=>this._playFrame()))}_playFrame(){const t=ts(),e=t-this._currentTime,s=ep([this._beforeNextFramePromises,()=>this._modules.events.fire("beforeNewFrame",{elapsed:e}),()=>this._modules.events.fire("frame",{elapsed:e}),()=>this._modules.events.fire("afterNewFrame",{elapsed:e}),this._afterNextFramePromises,()=>{this._inFrame=!1,(this._mustRefresh||t<this._refreshUntil+17)&&(this._mustRefresh=!1,this._refresh())}]);this._inFrame=!0,this._nextFrame=null,this._mustRefresh=!1,this._currentTime=t,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],s.reduce((i,n)=>i.then(()=>{if(!this._isDestroyed)return n()}),Promise.resolve())}isPlayingFrame(){return this._inFrame||!!this._nextFrame}setFullScreen(t){let e=Promise.resolve();return t!==this._isFullScreen?(this._container&&(e=t?cT(this._container):gT()),e.then(()=>new Promise(s=>{this.setTimeout(()=>{this._isFullScreen=Qr(),s(void 0)},hT)}))):e}isFullScreen(){return Qr()}debounceBeforeFrame(t){let e=!1,s=[];const i=()=>{const n=s;e=!1,s=[],t(),n.forEach(r=>r())};return()=>new Promise(n=>{s.push(n),e||(e=!0,this.beforeNextFrame().then(i))})}destroy(){this._resizeObserver.disconnect(),nT(),this.detachFromDom(),this.clearAllTimeouts(),this.stopFrames()}};function Qr(){return typeof document<"u"&&!!(document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}function cT(t){return Qr()?Promise.resolve():t.requestFullscreen?t.requestFullscreen():t.requestFullScreen?t.requestFullScreen():t.webkitRequestFullScreen?Promise.resolve(t.webkitRequestFullScreen()):t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():Promise.resolve()}function gT(){return Qr()?typeof document>"u"?Promise.resolve():document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?Promise.resolve(document.webkitCancelFullScreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve():Promise.resolve()}var fT=class extends Bt{constructor(){super(...arguments),this._nodeChanges=[],this._edgeChanges=[],this._shouldTriggerEvents=!1}onMounted(){this._nodeDataList=this._modules.graph.createAttribute(!0,{name:"data",storage:"any"},!1),this._edgeDataList=this._modules.graph.createAttribute(!1,{name:"data",storage:"any"},!1),this._nodeList=this._modules.graph.getNodeAttribute("object"),this._edgeList=this._modules.graph.getEdgeAttribute("object"),this._modules.events.register(["setData","updateNodeData","updateEdgeData"]),this._modules.events.on("addNodes",({nodes:t,objects:e})=>this._onAddElements(t,e)).on("addEdges",({edges:t,objects:e})=>this._onAddElements(t,e)).on("beforeNewFrame",()=>{this._shouldTriggerEvents&&(this._shouldTriggerEvents=!1,this._triggerEvents())})}_onAddElements(t,e){const{isNode:s,size:i,_indexes:n}=t,r=this[s?"_nodeDataList":"_edgeDataList"];for(let o=0;o<i;++o)r.set(n[o],e[o].data)}setProperty(t,e,s,{dispatch:i=!1,virtual:n=!1}={}){this._setDataProperty(t.isNode,t._indexes,e,s,i,n),this._modules.events.fire("setData",{elements:t,virtual:n})}getProperty(t,e){return this._getDataProperty(t.isNode,t._indexes,e)}_setDataProperty(t,e,s,i,n,r){n&&typeof i=="function"&&(n=!1);const o=tf(s),a=typeof i=="function",l=t?this._nodeList:this._edgeList,d=t?this._nodeDataList:this._edgeDataList,h=mT(t?this._nodeChanges:this._edgeChanges,o);for(let u=0;u<e.length;++u){const c=e[u];let g=d.get(c);const f=l.get(c),m=n?i[u]:i;let _,p;if(o===null)_=g,p=a?m(f):m,d.set(c,p);else{g==null&&(g={},d.set(c,g));const x=o.length;for(let y=0;y<x;y++){const b=o[y];let v=g[b];y<x-1?(v==null&&(v={},g[b]=v),g=v):(_=v,p=a?m(f):m,g[b]=p)}}h.indexes.push(c),h.previousValues.push(_),h.newValues.push(p),h.virtual=r}this._scheduleEvents()}_getDataProperty(t,e,s,i){const n=tf(s);i||(i=new Array(e.length));const r=t?this._nodeDataList:this._edgeDataList;for(let o=0;o<e.length;++o){const a=e[o];let l,d=r.get(a);if(n!==null&&n.length)if(d==null)l=void 0;else{const h=n.length;for(let u=0;u<h&&d;++u)l=d=d[n[u]]}else l=d;i[o]=l}return i}_scheduleEvents(){this._shouldTriggerEvents=!0,this._modules.dom.refresh()}_triggerEvents(){const t=this._prepareEvtPayload(!0),e=this._prepareEvtPayload(!1);this._modules.events.fire("updateNodeData",t),this._modules.events.fire("updateEdgeData",e)}_prepareEvtPayload(t){const e=t?this._modules.graph.nodeList:this._modules.graph.edgeList,s=t?"_nodeChanges":"_edgeChanges";let i=[];const n=this[s];this[s]=[];const r=[];for(let o=0;o<n.length;++o){const{indexes:a,property:l,newValues:d,previousValues:h,virtual:u}=n[o];i=i.concat(a||[]),t?r.push({property:l,newValues:d,previousValues:h,virtual:u,nodes:e(a)}):r.push({property:l,newValues:d,previousValues:h,virtual:u,edges:e(a)})}return t?{nodes:e(i).dedupe(),isNode:t,changes:r}:{edges:e(i).dedupe(),isNode:t,changes:r}}};function mT(t,e){for(let i=0;i<t.length;++i){const n=t[i],r=n.property;if(e===null&&r===null)return n;if(e&&r&&r.length===e.length){let o=!0;for(let a=0;a<r.length;++a)if(r[a]!==e[a]){o=!1;break}if(o)return n}}const s={property:e&&e.slice(),indexes:[],previousValues:[],newValues:[],nodes:null,virtual:!1,edges:null};return t.push(s),s}function tf(t){return typeof t=="string"?t.split("."):He(t)?t:null}var Qu=512,Ju=128,$y=Math.round(Math.log2(Qu)),tc=Math.round(Math.log2(Ju)),_T=$y+tc,Wn=255,pT=32767,Zy=65535,sa=16384,Mh=15,Xn=3,_l=15,Ha=32,qi=128,Ph=8,Rh=1/16,Fh=Math.round(Math.sqrt(_l+1)),Dh=qi*Fh,Je=16,Ki=1,Bs=256,yT=128,xT=128,pl=1.5,Ky=1,hr=56,bT=16,vT=2*hr+bT,Wa=6,Qy=3,Jy=3,ms=41,Yl=5,yl=5,tx=.9721,go=24,ET=1.4142,AT=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function ec(t,e=[0,0,0,0]){const s=AT.exec(t);return s?(e[0]=parseInt(s[1])/255,e[1]=parseInt(s[2])/255,e[2]=parseInt(s[3])/255,e[3]=s[4]===void 0?1:parseFloat(s[4]),e):null}function Xa(t){return t<16?"0"+t.toString(16):t.toString(16)}function ex([t,e,s,i=1]){return`rgba(${256*t|0},${256*e|0},${256*s|0},${i})`}function sc(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(s,i,n,r)=>i+i+n+n+r+r);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255,1]:null}var Sd=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"],wr=[0,0,0,0],fo=new Map;fo.set(null,[0,0,0,0]),fo.set("transparent",[0,0,0,0]);for(let t=0;t<Sd.length;t+=2){const e=Sd[t].toLowerCase(),s=Sd[t+1];fo.set(e,sc(s))}var es=t=>{let e=fo.get(t);if(e===void 0){const s=t+"",i=s.charAt(0)==="#"?sc(s):ec(s);fo.set(t,i),e=i}return e},Oh=t=>{const e=es(t);if(!e)return null;const[s,i,n]=e;return`#${Xa(255*s)}${Xa(255*i)}${Xa(255*n)}`},Un=t=>{let e=1,s=t;return s&&ec(t,wr)&&(s=`rgb(${255*+wr[0]},${255*+wr[1]},${255*+wr[2]})`,e=parseFloat(wr[3].toString())),{color:s,opacity:e}},Ro=class{on(t,e){if(typeof t!="string")throw new TypeError("Event name must be string");if(typeof e!="function")throw new TypeError("Event handler must be function");const s=this._events=this._events||{};return(s[t]=s[t]||[]).push(e),this}off(t,e){if(typeof t!="string")throw new TypeError("Event name must be string");const s=this._events=this._events||{},i=s[t];if(He(i))if(typeof e!="function")s[t]=null;else{const n=i.indexOf(e);n!==-1&&i.splice(n,1),i.length===0&&(s[t]=null)}return this}fire(t,...e){if(typeof t!="string")throw new TypeError("Event name must be string");const s=(this._events=this._events||{})[t];if(He(s)){const i=e;for(let n=0;n<s.length;n++){const r=s[n];r&&r.apply(this,i)}}return this}once(t,e){const s=this,i=function(...n){e.apply(s,n),s.off(t,i)};return i.handler=e,this.on(t,i)}hasListener(t,e){if(!t||!e)return!1;const s=(this._events=this._events||{})[t];if(He(s))for(let i=0,n=s.length;i<n;i++){const r=s[i];if(r===e||r.handler===e)return!0}return!1}clearEvents(){this._events={}}getListeners(t){return(this._events=this._events||{})[t]}};function sx(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach((s,i)=>e.push(i)),e}function ix(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach(s=>e.push(s)),e}var nx=class{constructor(){this._map=new Map}reset(){this._map.clear()}set(t,e,s){this._map.set(Pg(t,e),s)}get(t,e){return this._map.get(Pg(t,e))}},ST=class{constructor({elementSize:t,sideElementSize:e,nbSideElementsPerMainElement:s,id:i,depth:n,elementType:r,animated:o,stencilUsage:a}){this._nbCellsAllocated=0,this._nbCellsFreed=0,this._isFullyAllocated=!1,this._isFullyFreed=!1,this._mustUpdate=!0,this._capacity=Qu,this.version=0,this._id=i,this.depth=n,this.type=r,this.animated=o,this.stencilUsage=a,this.elementSize=t,this._nbSideElementsPerMainElement=s,this._totalSideElementsSize=s*e,this._byteCapacity=this._capacity*this.elementSize,this._byteArray=new Uint8Array(this._byteCapacity),this._dataView=new DataView(this._byteArray.buffer),this._sideByteCapacity=this._capacity*this._totalSideElementsSize,this._sideByteArray=new Uint8Array(this._sideByteCapacity),this._sideDataView=new DataView(this._sideByteArray.buffer)}update(){this._mustUpdate&&(this.version+=1,this._mustUpdate=!1,this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated&&(this._isFullyFreed=!0))}allocate(t){let e=-1;return!this._isFullyAllocated&&this._nbCellsAllocated+t<=this._capacity?(e=this._nbCellsAllocated,this._nbCellsAllocated+=t,this._mustUpdate=!0):this._isFullyAllocated=!0,e}free(t,e){for(let s=0;s<e;s++){const i=(t+s)*this.elementSize;this._dataView.setUint16(i,0)}this._mustUpdate=!0,this._nbCellsFreed+=e}triggerUpdate(){this._mustUpdate=!0}isEmpty(){return this._nbCellsFreed===this._nbCellsAllocated}isFullyFreed(){return this._isFullyFreed}getId(){return this._id}getDataView(){return this._dataView}getByteArray(){return this._byteArray}getSize(){return this._nbCellsAllocated}getNbSideElementsPerMainElement(){return this._nbSideElementsPerMainElement}hasSideData(){return this._nbSideElementsPerMainElement>0}getSideDataView(){return this._sideDataView}getSideByteArray(){return this._sideByteArray}getTotalSideElementsSize(){return this._totalSideElementsSize}},ef=8,wT=class{constructor(){this.version=0,this.version=0,this._blockInfo={buffer:null,offset:0,size:0,address:0},this._init_()}reset(){this._init_()}_init_(){this._buffersByDepth=new Array(100),this._buffersById=[],this._buffersByAscendingDepth=[],this._buffersByDescendingDepth=[],this._mustUpdate=!0}_fillBlockInfo(t,e,s,i){return this._blockInfo.buffer=t,this._blockInfo.offset=e,this._blockInfo.size=s,this._blockInfo.address=i,this._blockInfo}_createBuffer(t,e,s,i,n){const r=e?vT:hr,o=this._buffersById.length,a=new ST({elementSize:r,sideElementSize:Wa,nbSideElementsPerMainElement:i,id:o,depth:s,elementType:t,animated:e,stencilUsage:n});return this._buffersById.push(a),a}getBlockInfo(t){return this._fillBlockInfo(this._buffersById[t>>_T],(t>>tc)%Qu,t%Ju,t)}allocateBlock(t,e,s,i,n,r,o){const a=IT(r,ef);this._mustUpdate=!0;let l=null,d=-1;if(t){const u=this.getBlockInfo(t),c=u.buffer,g=u.offset,f=u.size,m=u.size===n,_=c.depth===i,p=c.type===e,x=c.animated===s,y=c.getNbSideElementsPerMainElement()===a,b=c.stencilUsage===o;m&&_&&p&&x&&y&&b?(c.triggerUpdate(),l=c,d=g):c.free(g,f)}if(d===-1){const u=+s,c=a/ef,g=this._buffersByDepth[i]||Array(2);this._buffersByDepth[i]=g;const f=g[u]||[];g[u]=f;const m=f[e]||Array(16);f[e]=m;const _=m[c]||Array(4);m[c]=_;const p=_[o]||[];_[o]=p;const x=p[p.length-1];x&&(l=x,d=x.allocate(n)),d===-1&&(l=this._createBuffer(e,s,i,a,o),d=l.allocate(n),p.push(l))}const h=TT(l.getId(),d,n);return this._fillBlockInfo(l,d,n,h)}freeBlock(t){if(t){this._mustUpdate=!0;const e=this.getBlockInfo(t);e.buffer.free(e.offset,e.size)}return 0}_sortBuffersByDepth(){const t=[];for(let e=0;e<this._buffersByDepth.length;e++){const s=this._buffersByDepth[e];if(s)for(let i=0;i<s.length;i++){const n=s[i];if(n)for(let r=0;r<n.length;r++){const o=n[r];if(o)for(let a=0;a<o.length;a++){const l=o[a];if(l)for(let d=0;d<l.length;d++){const h=l[d];if(h)for(let u=0;u<h.length;u++){const c=h[u];c.update(),c.isFullyFreed()?(this._buffersById[c.getId()]=void 0,h.splice(u,1),u-=1):t.push(c)}}}}}}this._buffersByAscendingDepth=t,this._buffersByDescendingDepth=t.slice().reverse()}update(){this._mustUpdate&&(this._sortBuffersByDepth(),this.version+=1,this._mustUpdate=!1)}getBuffers(){return this._buffersById}getBuffersByAscendingDepth(){return this._buffersByAscendingDepth}getBuffersByDescendingDepth(){return this._buffersByDescendingDepth}};function TT(t,e,s){return((t<<$y)+e<<tc)+s}function IT(t,e){let s=0;for(;s<t;)s+=e;return s}var qs=1,yn=2,xl=3,ss=1,Yi=2,gn=3,Fo=4,xn=5,bn=6,Qi=7,ks=1,$l=2,ic=3,nc=4,ln=5,fn=6,Jn=1,rx=2,ox=3;function sf(){return{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:ss,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,bentEnable:!1,bentVertical:!1}}function nf(t={}){return t.pieceId=0,t.shape="",t.x1=0,t.y1=0,t.x2=0,t.y2=0,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=0,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=0,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern=t.pattern||{type:ss,attributes:{}},t.pattern.type=ss,t.opacity=1,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1,t.isSelfLoop=!1,t.isText=!1,t.adjustTextAngle=!1,t.isBadge=!1,t.bentEnable=!1,t.bentVertical=!1,t}function CT(t={}){return t.duration=0,t.beginTime=-1,t.easing="linear",t}function rc(){return{valid:!1,id:void 0,end:sf(),start:sf(),animation:{duration:0,beginTime:-1,easing:"linear"}}}function ax(t,e,s,i){t.width=e*i,t.height=s*i,Cn(t,`${e}px`,`${s}px`)}function LT(t){return 1/(1+Math.exp(-t))}var NT=class{constructor(){this._capacity=Ju,this._id=0,this.size=0,this.depth=0,this.animated=!1,this.stencilUsage=Jn,this.type=qs,this._list=Array(this._capacity);for(let t=0;t<this._capacity;++t)this._list[t]=rc()}reset(t,e,s,i){return this.type=t,this.animated=e,this.depth=s,i!==void 0&&(this._id=i),this.stencilUsage=Jn,this.size=0,this}next(){if(this.size>=this._capacity)throw new Error("internal error: block.next() was called on a full block");return this._list[this.size++]}nextAndReset(){const t=this.next();return t.end=nf(t.end),t.start=nf(t.start),t.animation=CT(t.animation),t}forEach(t){this._list.forEach(t)}getElement(t){return this._list[t]}getCurrentElement(){return this._list[this.size-1]}getElements(){return this._list}getId(){return this._id}setGlobalAnimation(t,e,s){for(let i=0;i<this.size;++i){const n=this._list[i].animation;n.duration=t,n.beginTime=e,n.easing=s}}},MT=class{constructor(){this._version=0,this._initialize()}reset(){this._initialize()}_initialize(){this._mustUpdate=!0,this.maxCoord=0,this.maxScaledSize=0,this.maxMinVisibleSize=0,this.maxSymbolicSize=0,this.maxDashLength=0,this.maxGapLength=0,this.maxPatternScale=0}set({maxCoord:t,maxScaledSize:e,maxMinVisibleSize:s,maxSymbolicSize:i,maxDashLength:n,maxGapLength:r,maxPatternScale:o}){const a=this.maxCoord<t||this.maxScaledSize<e||this.maxMinVisibleSize<s||this.maxSymbolicSize<i||this.maxDashLength<n||this.maxGapLength<r||this.maxPatternScale<o;return a&&(this.maxCoord=t,this.maxScaledSize=e,this.maxMinVisibleSize=s,this.maxSymbolicSize=i,this.maxDashLength=n,this.maxGapLength=r,this.maxPatternScale=o,this._mustUpdate=!0),a}update(){return this._mustUpdate&&(this._version+=1,this._mustUpdate=!1),this}getVersion(){return this._version}},PT={linear:[0,1,0,0],quadraticIn:[0,0,1,0,0,0,0,0],quadraticOut:[0,2,-1,0,0,0,0,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]},RT=class{constructor(){this._linearEasing=[0,1,0,0,0,1,0,0],this._nameToPolygon={},this._polygonToName={},this.add(PT)}add(t){Object.keys(t).forEach(e=>{const s=t[e].slice();s.length<8&&(s[4]=s[0],s[5]=s[1],s[6]=s[2],s[7]=s[3]);const i=ah(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);this._nameToPolygon[e]=s,this._polygonToName[i]=e})}getCoefficients(t){return this._nameToPolygon[t]||this._linearEasing}getName(t,e,s,i,n,r,o,a){const l=ah(t,e,s,i,n,r,o,a);return this._polygonToName[l]||"linear"}},oc=new RT;function Zl(t){return typeof t=="number"&&isFinite(t)}var FT=t=>{if(t===0)return 0;if(isNaN(t))return 32256;if(!isFinite(t))return t>0?31744:64512;const e=t<0?32768:0;if((t=Math.abs(t))<6103515625e-14)return e|Math.round(4096*t);if(t>65504)return 31744|e;let s=Math.floor(Math.log2(t)),i=Math.round(1024*(t/Math.pow(2,s)-1));return i===1024&&(i=0,s++),e|s+15<<10|i},rf=t=>{const e=32768&t?-1:1,s=t>>10&31,i=1023&t;return s===0?i===0?0*e:e*Math.pow(2,-14)*(i/1024):s===31?i?NaN:e*(1/0):e*Math.pow(2,s-15)*(1+i/1024)},DT=0,OT=1,kT=2,zT=3,BT=4,UT=5,GT=6,VT=7,qT=8,jT=9,Kl=10,HT=0,lx=1,dx=2,ac=30,hx=0,WT=1,XT=2,lc=3,YT=4,$T=5,dc=6,ux=1e-6,Fs=Math.PI,Jr=2*Math.PI,cx=Fs*(5/4),gx=Fs*(7/4),fx=Fs*(3/4),mx=Fs*(1/4),of=1.1,af=.07,ZT=1,lf=1,df=.17,KT=1,QT=-Fs/2,JT=Fs/2,t1={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}},e1={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0},s1={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0},i1=class{constructor(t,e,s,i,n){this._littleEndian=Dl(),this._maxScaledSize=0,this._maxMinVisibleSize=0,this._maxSymbolicSize=0,this._maxDashLength=0,this._maxGapLength=0,this._maxPatternScale=0,this._actualScaledSizeToBytes=pT,this._actualMinVisibleSizeToBytes=Mh,this._actualSymbolicSizeToBytes=Wn,this._actualDashLengthToBytes=Xn,this._actualGapLengthToBytes=Xn,this._actualPatternScaleToBytes=Wn,this._genericObject=rc(),this._shapeManager=e,this._patternManager=t,this._textManager=s,this._bufferOffsetToId=i,this._colorParser=n}resizeBoundaries(t,e,s,i,n,r){this._maxScaledSize=t,this._maxMinVisibleSize=e,this._maxSymbolicSize=s,this._maxDashLength=i,this._maxGapLength=n,this._maxPatternScale=r,this._actualScaledSizeToBytes=Zy/t,this._actualMinVisibleSizeToBytes=Mh/e,this._actualSymbolicSizeToBytes=Wn/s,this._actualDashLengthToBytes=Xn/i,this._actualGapLengthToBytes=Xn/n,this._actualPatternScaleToBytes=Wn/r}storeGenericObject(t,e,s){const i=this._shapeManager.getIdFromName(s.shape),n=s.pieceId,r=this._dashLengthToBytes(s.dashLength),o=this._gapLengthToBytes(s.gapLength),a=+s.hasHead,l=+s.hasTail,d=+s.isBodyTriangle,h=+s.isSelfLoop,u=this._patternScaleToBytes(s.patternScale),c=this._offsetAngleToBytes(s.offsetAngle),g=+s.isText,f=+s.adjustTextAngle,m=+s.isBadge,_=+s.bentEnable,p=+s.bentVertical,x=this._opacityToBytes(s.opacity),y=this._minVisibleSizeToBytes(s.globalMinVisibleSize),b=this._minVisibleSizeToBytes(s.strokeMinVisibleSize),v=this._minVisibleSizeToBytes(s.patternMinVisibleSize),E=this._symbolicSizeToBytes(s.symbolicSize),A=this._curvatureToBytes(s.curvature),S=s.pattern.attributes.colors;S&&(s.pattern.attributes.colors=S.split(";").map(st=>ia(this._colorToBytes(st.trim()))).join(";"));const w=this._patternManager.getIdFromDefinition(s.pattern),L=this._colorToBytes(s.fillColor),T=this._colorToBytes(s.strokeColor),F=this._colorToBytes(s.patternColor),{x1:V,y1:G,x2:O,y2:j}=s,W=this._fixedSizeToBytes(s.rectWidthOrSourceRadiusFixed),et=this._fixedSizeToBytes(s.rectHeightOrTargetRadiusFixed),at=this._scaledSizeToBytes(s.thicknessOrFontSizeScaled),mt=this._fixedSizeToBytes(s.thicknessOrFontSizeFixed),vt=this._scaledSizeToBytes(s.strokeWidthScaled),wt=this._fixedSizeToBytes(s.strokeWidthFixed),Et=this._scaledSizeToBytes(s.offsetScaled),yt=this._fixedSizeToBytes(s.offsetFixed),St=this._fixedSizeToBytes(s.pattern.attributes.paddingTop||0),zt=this._fixedSizeToBytes(s.pattern.attributes.paddingLeft||0),Zt=i+(n<<4)+(r<<8)+(o<<10)+(a<<12)+(l<<13)+(d<<14)+(h<<15),Kt=u+(c<<8)+(g<<11)+(f<<12)+(m<<13)+(_<<14)+(p<<15),X=x+(y<<4)+(b<<8)+(v<<12),Q=E+(A<<8),gt=s.rectWidthOrSourceRadiusScaled/this._maxScaledSize*sa,lt=s.rectHeightOrTargetRadiusScaled/this._maxScaledSize*sa;this._setUint16(t,e+0,Zt),this._setUint16(t,e+2,Kt),this._setUint16(t,e+4,X),this._setUint16(t,e+6,Q),this._setUint16(t,e+8,w),this._setUint16(t,e+10,L),this._setUint16(t,e+12,T),this._setUint16(t,e+14,F),this._setFloat32(t,e+16,V),this._setFloat32(t,e+20,G),this._setFloat32(t,e+24,O),this._setFloat32(t,e+28,j),this._setFloat16(t,e+32,gt),this._setUint16(t,e+34,W),this._setFloat16(t,e+36,lt),this._setUint16(t,e+38,et),this._setUint16(t,e+40,at),this._setUint16(t,e+42,mt),this._setUint16(t,e+44,vt),this._setUint16(t,e+46,wt),this._setUint16(t,e+48,Et),this._setInt16(t,e+50,yt),this._setInt16(t,e+52,St),this._setInt16(t,e+54,zt)}_setUint16(t,e,s){t.setUint16(e,s,this._littleEndian)}_setFloat16(t,e,s){t.setUint16(e,FT(s),this._littleEndian)}_setInt16(t,e,s){t.setUint16(e,this._signedToUnsignedInt16(s),this._littleEndian)}_setFloat32(t,e,s){t.setFloat32(e,s,this._littleEndian)}_colorToBytes(t){const e=this._colorParser(t);return Math.round(15*e[0])+(Math.round(15*e[1])<<4)+(Math.round(15*e[2])<<8)+(Math.round(15*e[3])<<12)}_scaledSizeToBytes(t){return Math.ceil(Math.min(t,this._maxScaledSize)*this._actualScaledSizeToBytes)}_fixedSizeToBytes(t){return t}_minVisibleSizeToBytes(t){return Math.round(Math.min(t,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)}_symbolicSizeToBytes(t){return Math.round(Math.min(t,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)}_dashLengthToBytes(t){return Math.round(Math.min(t,this._maxDashLength)*this._actualDashLengthToBytes)}_gapLengthToBytes(t){return Math.round(Math.min(t,this._maxGapLength)*this._actualGapLengthToBytes)}_patternScaleToBytes(t){return Math.round(Math.min(t,this._maxPatternScale)*this._actualPatternScaleToBytes)}_offsetAngleToBytes(t){return Math.round((t+Jr)%Jr*(8/Jr))}_opacityToBytes(t){return Math.round(15*Math.min(t,1))}_curvatureToBytes(t){return this._signedToUnsignedByte(t)}_signedToUnsignedByte(t){return Os(t,-128,127)+128}_signedToUnsignedInt16(t){return Os(t,-32768,32767)+32768}storeAnimationInformation(t,e,{beginTime:s,duration:i},n){this._setAnimationBeginTime(t,e,s),this._setAnimationDuration(t,e,i),this._setAnimationEasing(t,e,n)}_setAnimationBeginTime(t,e,s){this._setFloat32(t,e,s)}_setAnimationDuration(t,e,s){this._setFloat32(t,e+4,s)}_setAnimationEasing(t,e,s){this._setUint16(t,e+8,(s[0]+128<<8)+(s[4]+128)),this._setUint16(t,e+10,(s[1]+128<<8)+(s[5]+128)),this._setUint16(t,e+12,(s[2]+128<<8)+(s[6]+128)),this._setUint16(t,e+14,(s[3]+128<<8)+(s[7]+128))}extractGenericElement(t,e,s){const i=t.type,n=t.animated,r=t.getDataView(),o=e*t.elementSize,a=this._genericObject;if(a.valid=!1,r.getUint16(o)&&(a.valid=!0,this._extractGenericObject(a.end,r,o,s),n&&(this._extractGenericObject(a.start,r,o+hr,s),this._extractAnimationInformation(a.animation,r,o+2*hr)),a.id=this._bufferOffsetToId.get(t.getId(),e),i===yn)){const l=t.getSideDataView(),d=e*t.getTotalSideElementsSize(),h=d+t.getTotalSideElementsSize();a.end.pattern=this._textManager.extractTextFromDataView(l,d,h)}return a}_extractGenericObject(t,e,s,{bytesToActualCoord:i,bytesToActualScaledSize:n,bytesToActualMinVisibleSize:r,bytesToActualPatternScale:o,bytesToActualSymbolicSize:a,bytesToActualDashLength:l,bytesToActualGapLength:d}){const h=e,u=s,c=this._littleEndian,g=h.getUint16(u,c),f=me(g,0,4),m=me(g,4,8),_=me(g,8,10),p=me(g,10,12),x=me(g,12,13),y=me(g,13,14),b=me(g,14,15),v=me(g,15,16),E=h.getUint16(u+2,c),A=me(E,0,8),S=me(E,8,11),w=me(E,11,12),L=me(E,12,13),T=me(E,13,14),F=me(E,14,15),V=me(E,15,16),G=h.getUint16(u+4,c),O=me(G,0,4),j=me(G,4,8),W=me(G,8,12),et=me(G,12,16),at=h.getUint16(u+6,c),mt=me(at,0,8),vt=me(at,8,16),wt=h.getUint16(u+8,c),Et=h.getUint16(u+10,c),yt=h.getUint16(u+12,c),St=h.getUint16(u+14,c),zt=h.getFloat32(u+16,c),Zt=h.getFloat32(u+20,c),Kt=h.getFloat32(u+24,c),X=h.getFloat32(u+28,c),Q=h.getUint16(u+32,c),gt=h.getUint16(u+34,c),lt=h.getUint16(u+36,c),st=h.getUint16(u+38,c),ot=h.getUint16(u+40,c),rt=h.getUint16(u+42,c),ft=h.getUint16(u+44,c),Nt=h.getUint16(u+46,c),Rt=h.getUint16(u+48,c),Pt=wd(h.getUint16(u+50,c)),Vt=wd(h.getUint16(u+52,c)),jt=wd(h.getUint16(u+54,c));t.pieceId=m,t.shape=this._shapeManager.getNameFromId(f),t.x1=Qs(zt,i),t.y1=Qs(Zt,i),t.x2=Qs(Kt,i),t.y2=Qs(X,i),t.rectWidthOrSourceRadiusScaled=rf(Q)*this._maxScaledSize/sa,t.rectWidthOrSourceRadiusFixed=gt,t.rectHeightOrTargetRadiusScaled=rf(lt)*this._maxScaledSize/sa,t.rectHeightOrTargetRadiusFixed=st,t.thicknessOrFontSizeScaled=Qs(ot,n),t.thicknessOrFontSizeFixed=rt,t.strokeWidthScaled=Qs(ft,n),t.strokeWidthFixed=Nt,t.offsetScaled=Qs(Rt,n),t.offsetFixed=Pt,t.pattern=this._patternManager.getDefinitionFromId(wt),t.pattern.attributes.paddingTop=Vt,t.pattern.attributes.paddingLeft=jt,t.opacity=O/15,t.fillColor=ia(Et),t.strokeColor=ia(yt),t.patternColor=ia(St),t.globalMinVisibleSize=Qs(j,r),t.strokeMinVisibleSize=Qs(W,r),t.patternMinVisibleSize=Qs(et,r),t.offsetAngle=S*(2*Math.PI/8),t.patternScale=A*o,t.symbolicSize=mt*a,t.curvature=n1(vt),t.dashLength=_*l,t.gapLength=p*d,t.hasHead=!!x,t.hasTail=!!y,t.isBodyTriangle=!!b,t.isSelfLoop=!!v,t.isText=!!w,t.adjustTextAngle=!!L,t.isBadge=!!T,t.bentEnable=!!F,t.bentVertical=!!V}_extractAnimationInformation(t,e,s){const i=this._littleEndian,n=e.getFloat32(s,i),r=e.getFloat32(s+4,i),o=e.getUint16(s+8,i),a=e.getUint16(s+10,i),l=e.getUint16(s+12,i),d=e.getUint16(s+14,i),h=(o>>8)-128,u=(a>>8)-128,c=(l>>8)-128,g=(d>>8)-128,f=o%256-128,m=a%256-128,_=l%256-128,p=d%256-128;t.beginTime=n,t.duration=r,t.easing=oc.getName(h,u,c,g,f,m,_,p)}};function me(t,e,s){return t%(1<<s)>>e}function n1(t){return t-128}function wd(t){return t-32768}function Qs(t,e){return t*e}var hf=new Array(65535);function ia(t){let e=hf[t];if(!e){const s=me(t,0,4)/15,i=me(t,4,8)/15,n=me(t,8,12)/15,r=me(t,12,16)/15;e=`rgba(${255*s|0}, ${255*i|0}, ${255*n|0}, ${r})`,s+i+n+r===0&&(e=null),hf[t]=e}return e}var r1={[Yi]:"image",[Fo]:"piechart",[gn]:"text",[xn]:"icon",[bn]:"badge"},o1=class{constructor(){this._pixelRatio=1,this._nextPatternId=1,this._version=0,this._init_()}reset(){this._init_()}_init_(){this._mustUpdate=!0,this._nextPatternId=1,this._patterns=[null],this._patternsByHash={},this._pixelRatio=1,this._nullPattern={id:-1,type:ss,attributes:{}}}_increaseNextId(){let t=this._nextPatternId++;for(t%256==255&&(t=this._nextPatternId++);this._patterns.length<=t;)this._patterns.push(void 0);return t}_createPattern({type:t,attributes:e}){const s={id:this._increaseNextId(),type:t,attributes:this._getAttributes(t,e)};return this._patterns[s.id]=s,this._mustUpdate=!0,s}_getAttributes(t,e){return t===Yi?{image:e.image,scaled:e.scaled,duplicated:e.duplicated}:t===gn||t===xn||t===bn?{font:e.font,size:e.size,style:e.style,text:e.text,paddingLeft:e.paddingLeft,paddingTop:e.paddingTop,align:e.align||"center",offset:e.offset||0}:t===Fo&&e.colors?{colors:e.colors,colorArray:e.colors.split(";").map(s=>s.trim())}:{}}getPatternList(){return this._patterns.filter(t=>t)}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}setPixelRatio(t){t!==this._pixelRatio&&(this._pixelRatio=t,this._mustUpdate=!0)}getPixelRatio(){return this._pixelRatio}notifyUpdate(){this._mustUpdate=!0}getIdFromDefinition(t){const{type:e,attributes:s}=t,i=e===gn||e===xn||e===bn;let n=0;return e&&e!==ss&&e!==Qi&&(e!==Yi||s.image)&&(!i||s.text&&s.font)&&(n=this._addPattern(t),e===gn&&s.style==="normal"&&(s.style="bold",this._addPattern(t))),n}_addPattern(t){const e=this._getPatternHash(t);let s=this._patternsByHash[e];return s||(this._nextPatternId>65500?Ei("maximum number of pattern exceeded"):(s=this._createPattern(t).id,this._patternsByHash[e]=s)),s}_getPatternHash({type:t,attributes:e}){const s=[r1[t]];return t===Yi?s.push(e.scaled?"scaled":"non-scaled",e.duplicated?"duplicated":"non-duplicated",e.image.src||e.image.toDataURL()):t===gn?s.push(e.text,e.font,e.style,e.size,e.align||"center",e.offset||0):t===xn||t===bn?s.push(e.text,e.font,e.style,e.size,e.paddingLeft,e.paddingTop):s.push(e.colors),s.join("+")}getDefinitionFromId(t){if(t&&this._patterns[t]){const e=this._patterns[t];if(e)return e}return this._nullPattern}getVersion(){return this._version}};function uf(t){return t.map(({x:e,y:s,r:i=0})=>({x:e,y:s,r:i}))}var a1=class{constructor(){this._version=0,this._mustUpdate=!0,this._byName={},this._byId=new Array(_l+1)}register(t,{getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:i,hole:n,isSimple:r}){if(this._byName[t])return;let o=r?1:Ph;const a=r?Ph-1:_l;for(;this._byId[o];)o+=1;if(o>a)throw new Error("max number of shape exceeded");const l={id:o,name:t,getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:uf(i.slice()),hole:n?uf(n.slice()):null,isSimple:!!r};return this._mustUpdate=!0,this._byId[o]=l,this._byName[t]=l,l}getIdFromName(t){return this._byName[t].id}getNameFromId(t){const e=this._byId[t];return e?e.name:""}getDefinitionFromName(t){return this._byName[t]}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}getVersion(){return this._version}getShapeList(){return this._byId.filter(t=>t)}},kh=300,zh=150,_x=class{constructor(){this.style={},this.width=kh,this.height=zh,this.__context=new px,this.style={},this.width=kh,this.height=zh}get __dummy(){return!0}get parentNode(){return null}getContext(t){return t==="2d"?this.__context:null}toDataURL(t="png"){return`data:image/${t};base64,`}addEventListener(){}removeEventListener(){}getBoundingClientRect(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}}},px=class{constructor(){this._fontSize=10}set font(t){const e=t.match(/\d+/);e&&(this._fontSize=parseFloat(e[0]))}set fillStyle(t){}set textBaseline(t){}set textAlign(t){}set strokeStyle(t){}set lineWidth(t){}fill(){}stroke(){}clearRect(){}fillRect(){}strokeRect(){}beginPath(){}closePath(){}moveTo(){}lineTo(){}rect(){}arc(){}save(){}restore(){}clip(){}translate(){}rotate(){}fillText(){}setLineDash(){}quadraticCurveTo(){}bezierCurveTo(){}drawImage(){}measureText(t){return{width:t.length*Math.ceil(.625*this._fontSize)}}getImageData(){return{width:0,height:0,data:new Uint8ClampedArray(0)}}},na=Ds("canvas")||Ds("canvas-prebuilt");function We(t=kh,e=zh){if(Ti){const i=document.createElement("canvas");return i.width=t,i.height=e,i}if(na){let i=null;return i="createCanvas"in na?na.createCanvas(t,e):new na(t,e),i.style={},i}const s=new _x;return s.width=t,s.height=e,s}function Bh(t,e,s=t.width,i=t.height){e.clearRect(0,0,s,i)}function Ji(t,e,s,i=""){t.font=`${i} ${s}px ${e}`}function yx(){return hc(We(),{},"webgl")!==null}var xx=t=>{const{canvas:e,width:s,height:i}={canvas:document.createElement("canvas"),width:window.innerWidth*devicePixelRatio,height:window.innerHeight*devicePixelRatio,...t};e.width=Math.ceil(s),e.height=Math.ceil(i),e.style.width=Math.ceil(s/devicePixelRatio)+"px",e.style.height=Math.ceil(i/devicePixelRatio)+"px";const n=e.getContext("webgl2",{antialias:!0});if(!n)throw new Error("WebGL 2.0 not supported");return n},bx=(t,e,s)=>{const i=xx();return i.canvas.addEventListener("webglcontextlost",s),{context:i,cleanUp:()=>{i.canvas.removeEventListener("webglcontextlost",s),i.getExtension("WEBGL_lose_context")?.loseContext()}}};function hc(t,e,s){let i=t.getContext(s,e);return i||(i=t.getContext("experimental-webgl",e)),i||null}function uc(t,e){if(e<2)return t;const s=t.split(`
`),i=[];for(let n=0;n<s.length;++n){const r=s[n];if(r.length<e)i.push(r);else{const o=vx(s[n],e);for(let a=0;a<o.length;++a)i.push(o[a])}}return i.join(`
`)}function vx(t,e){const s=[""],i=t.split(" ");for(let n=0;n<i.length;n++){const r=s[s.length-1],o=i[n];r.length+1+o.length<=e&&r.length?s[s.length-1]+=(r.length>0?" ":"")+o:s.push(o)}return s}function Ex(t,e){if(t===null)return null;const s=(t=t.toString()).split(`
`),i=[];let n=0;for(let r=0;r<s.length;r++){let o=s[r];if(!e||e<=1||o.length<e)i.push(o),n=Math.max(n,o.length);else{const a=vx(s[r],e);for(let l=0;l<a.length;l++)o=a[l],i.push(o),n=Math.max(n,o.length)}}return{data:i,maxLength:n,lines:i.length}}function Ax(){const t=Ds("@mapbox/mapbox-gl-rtl-text")||Ds("mapbox-gl-rtl-text"),e=t?t.processBidirectionalText:$i?window.processBidirectionalText:null,s=t?t.applyArabicShaping:$i?window.applyArabicShaping:null;return{processBidirectionalText:e?n=>{if(n===null||n==null)return"";const r=[];let o=0,a="";const l=n.split(`
`);for(let d=0;d<l.length;d++){const h=l[d],u=l[d].length+o;u>0&&d<l.length-1&&r.push(u),a+=d>0?""+h:h,o+=h.length}return e(a,r).join(`
`)}:n=>n,applyArabicShaping:s?n=>n==null?null:typeof n=="number"?n.toString():s(n):n=>n==null?null:n.toString()}}var Td=Dl(),ra=10,l1=1<<17,d1=65536,h1=256,cf=128,u1=25,Sx=1e3,Uh=2,c1=class{constructor(t){this._patternManager=t,this._canvas=We(),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0}),this._processBidirectionalText=Ax().processBidirectionalText,this._cornerRadius=0,this._version=0,this._textPattern={id:0,type:Qi,attributes:{text:"",font:"",size:0,style:"normal",align:"center"},dimensions:{width:0,height:0}},this._textDimensions={width:0,height:0},this._lineWidthList=new Array(64),this._init()}_init(){this._mustClear=!1,this._clear()}reset(){this._init()}clear(){this._mustClear=!0}_measureChar(t,e,s){return Ji(this._ctx,e,go,s),this._ctx.measureText(t).width/go}_getAtlas(t,e,s,i){const n=s===Co?0:s,r=this._byFont[t]||(this._byFont[t]={none:void 0,bold:void 0,italic:void 0,normal:void 0}),o=r[i]||(r[i]={}),a=o[e]||(o[e]=new Array(50));return a[n]||(a[n]=new Array(256))}_getMeasurementAtlas(t,e){const s=this._widthAtlases[e];return s[t]||(s[t]=new Array(256))}measureText(t,e,s,i=1){if(!e||t===null)return this._textDimensions.width=0,this._textDimensions.height=0,this._textDimensions;const n=this._getMeasurementAtlas(e,s);let r=0,o=0,a=1;for(let l=0;l<t.length;++l){const d=t.charCodeAt(l);if(d===ra)o>r&&(r=o),o=0,a+=1;else{let h=n[d];h===void 0&&(h=this._measureChar(t[l],e,s),n[d]=h),o+=h}}return o>r&&(r=o),this._textDimensions.width=r*i,this._textDimensions.height=a*i,this._textDimensions}_getCharInfo(t,e,s,i,n,r){let o=t[e];if(!o){const a=String.fromCharCode(e);o={ratio:this._measureChar(a,s,i),patternId:0},o.patternId=this._patternManager.getIdFromDefinition({id:0,type:gn,attributes:{text:a,font:s,style:i,size:n,align:r}}),t[e]=o}return o}storeTextInDataView(t,e,s,i){let n=e;if(i&&i.type===Qi){const{font:r,style:o,size:a,align:l}=i.attributes,d=l==="center",h=this._getAtlas(r,o,a,l);let u=0,c=1,g=0,f=0;const m=this._lineWidthList,_=this._processBidirectionalText(i.attributes.text);for(let b=0;b<_.length;++b){const v=_.charCodeAt(b);v===ra?(g>u&&(u=g),m[f]=g,f++,g=0,c++):g+=this._getCharInfo(h,v,r,o,a,l).ratio}m[f]=g,g>u&&(u=g),f=0;let p=-(d?m[f]:u)/2,x=(1-c)/2,y=0;for(let b=0;b<_.length;++b){const v=_.charCodeAt(b),E=h[v];if(v===ra)f+=1,p=-(d?m[f]:u)/2,x+=b===0?.5:1,y=0;else{const A=E.ratio,S=E.patternId;p+=(A+y)/2,y=A;const w=(Os(p*Sx+d1,0,l1-1)<<8)+Os(x*Uh+cf,0,h1-1);t.setUint16(n,S,Td),t.setUint32(n+2,w,Td),n+=Wa}}}this._fillWithZeros(t,n,s)}extractTextFromDataView(t,e,s){const i=t,n=Td,r=i.getUint16(e,n),o=this._textPattern,a=this._patternManager.getDefinitionFromId(r),{font:l,style:d,size:h,align:u}=a.attributes,c=this._getAtlas(l,d,h,u),g=[];let f=0,m=0,_=0,p=null;for(let y=e;y<s;y+=Wa){const b=i.getUint16(y,n);if(!b)break;const v=(i.getUint8(y+2)-cf)/Uh,E=this._patternManager.getDefinitionFromId(b);if(!E||!E.attributes||!E.attributes.text)break;const A=E.attributes.text.charCodeAt(0),S=c[A];p===null?p=v:v>p&&(f>m&&(m=f),f=0,_+=1,g.push(ra),p=v),g.push(A),S&&(f+=S.ratio)}f>m&&(m=f);const x=String.fromCharCode.apply(null,g);return o.attributes.style=d,o.attributes.font=l,o.attributes.size=h,o.attributes.align=u,o.attributes.text=this._processBidirectionalText(x),o.dimensions&&(o.dimensions.width=m,o.dimensions.height=_),o}_fillWithZeros(t,e,s){for(let i=e;i<s;i+=Wa)t.setUint16(i,0)}_clear(){this._byFont={},this._widthAtlases={normal:{},bold:{},italic:{}}}update(){this._mustClear&&(this._clear(),this._mustClear=!1)}getVersion(){return this._version}getCornerRadius(){return this._cornerRadius}setCornerRadius(t){t!==this._cornerRadius&&(this._cornerRadius=t,this._version++)}},cc=()=>({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),cs=class Ya{constructor(e={}){const{xValues:s=[],yValues:i=[],scaledSizeValues:n=[],fixedSizeValues:r=[]}=e;this.minX=yi(s),this.minY=yi(i),this.maxX=jn(s),this.maxY=jn(i),this.minScaledSize=yi(n),this.maxScaledSize=jn(n),this.minFixedSize=yi(r),this.maxFixedSize=jn(r),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY}reset(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.minScaledSize=1/0,this.maxScaledSize=-1/0,this.minFixedSize=1/0,this.maxFixedSize=-1/0,this.width=0,this.height=0,this.cx=0,this.cy=0,this}addPoint(e,s,i,n){return this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s),i!==void 0&&n!==void 0&&(n==="scaled"?(this.minScaledSize=Math.min(this.minScaledSize,i),this.maxScaledSize=Math.max(this.maxScaledSize,i)):(this.minFixedSize=Math.min(this.minFixedSize,i),this.maxFixedSize=Math.max(this.maxFixedSize,i))),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this}computeForZoom(e){const s=Math.max(this.maxScaledSize,this.maxFixedSize/e);return Ya.from({minX:this.minX-s/2,minY:this.minY-s/2,maxX:this.maxX+s/2,maxY:this.maxY+s/2,width:this.width+s,height:this.height+s})}static from({minX:e,minY:s,maxX:i,maxY:n,width:r,height:o}={}){const a=new Ya;return e!=null&&(a.minX=e),s!=null&&(a.minY=s),i!=null&&(a.maxX=i),n!=null&&(a.maxY=n),i!=null&&e!=null&&(a.width=r||(i-e)/2,a.cx=(e+i)/2),n!=null&&s!=null&&(a.height=o||(n-s)/2,a.cy=(s+n)/2),a}static fromValues(e,s,i){let n=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=0;h<e.length;h++){const u=e[h],c=s[h],g=i[h];u-g<n&&(n=u-g),c-g<r&&(r=c-g),u+g>o&&(o=u+g),c+g>a&&(a=c+g),g>l&&(l=g)}const d=Ya.from({minX:n,minY:r,maxX:o,maxY:a});return d.maxScaledSize=l,d}pad(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,this.width+=2*e,this.height+=2*e,this}isValid(){return isFinite(this.width)&&isFinite(this.height)}extend(e){return e.isValid()?(this.addPoint(e.minX,e.minY),this.addPoint(e.maxX,e.maxY),this):this}bottomLeft(){return{x:this.minX,y:this.minY}}topRight(){return{x:this.maxX,y:this.maxY}}};function gf(t,e,s,i,n){const r=1-n;return r*r*r*t+3*n*r*r*e+3*n*n*r*s+n*n*n*i}function Yn(t,e,s,i){const n=1-i;return n*n*t+2*n*i*e+i*i*s}var g1=(t,e)=>2/(1+Math.exp(-Math.abs(t*e))),f1=5,ff=5;function Ql(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/ff*s)*ff,l=-n+Math.PI,d=-n+Math.PI/2;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function Jl(t,e,s,i,n,r,o,a){const l=a||{x1:0,y1:0,x2:0,y2:0};if(r){const d=LT(n);if(o){const h=d*e+(1-d)*i;l.x1=t,l.y1=h,l.x2=s,l.y2=h}else{const h=d*t+(1-d)*s;l.x1=h,l.y1=e,l.x2=h,l.y2=i}}else l.x1=t,l.y1=e,l.x2=s,l.y2=i;return l}function Nn(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,f=-u*n/f1;return o.x=a+c*f,o.y=l+g*f,o}function td(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(1-t)*(1-t)*e+2*(1-t)*t*r+t*t*i,a.y=(1-t)*(1-t)*s+2*(1-t)*t*o+t*t*n,a}function gc(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(2*t-2)*e+(2*i-4*r)*t+2*r,a.y=(2*t-2)*s+(2*n-4*o)*t+2*o,wy(a)}function wx(t,e,s,i,n,r,o,a={x:0,y:0}){return gc(t,e,s,i,n,r,s,a),gl(a.x,a.y,0,0,Math.PI/2,a),a}function Tx(t,e,s,i,n,r,o,a,l,d=0,h=!1){const u=s-2*o+n,c=i-2*a+r,g=-((s-t)*c-(i-e)*u)/((2*o-2*s)*c-(2*a-2*i)*u);if(g<0||g>1)return!1;let f=l/2;h&&(f*=1-g),f+=d;const m=Yn(s,o,n,g),_=Yn(i,a,r,g);return Ie(m,_,t,e)<=f}function m1(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Nn(i.x,i.y,n.x,n.y,s);return td(e,i.x,i.y,n.x,n.y,r.x,r.y)}function _1(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Nn(i.x,i.y,n.x,n.y,s);return wx(e,i.x,i.y,n.x,n.y,r.x,r.y)}function p1(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Nn(i.x,i.y,n.x,n.y,s);return gc(e,i.x,i.y,n.x,n.y,r.x,r.y)}function mo(t,e,s,i,n,r,o,a,l,d={x:0,y:0}){const h=(1-t)*(1-t)*(1-t),u=3*t*(1-t)*(1-t),c=3*t*t*(1-t),g=t*t*t;return d.x=h*e+u*r+c*a+g*i,d.y=h*s+u*o+c*l+g*n,d}function Gh(t,e,s,i,n,r,o,a,l,d,h,u){let c=.5,g=Ie(t,e,s,i)<Ie(t,e,n,r)?-.01:.01,f=100;const m=mo(c,s,i,n,r,o,a,l,d);let _,p=Ie(t,e,m.x,m.y);const x=h/2+u;for(;f-- >0&&c>=0&&c<=1&&p>x&&(g>.001||g<-.001);)_=p,mo(c,s,i,n,r,o,a,l,d,m),p=Ie(t,e,m.x,m.y),p>_?(g=-g/2,c+=g):c+g<0||c+g>1?(g/=2,p=_):c+=g;return p<x}function fc(t,e,s,i,n,r,o=cc()){const a=t+.6666666666666666*(s-t),l=e+2/3*(i-e);return ed(t,e,a,l,a+1/3*(n-t),l+1/3*(r-e),n,r,o)}function ed(t,e,s,i,n,r,o,a,l=cc()){const{min:d,max:h,sqrt:u}=Math;let c,g,f,m,_;l.minX=d(t,o),l.maxX=h(t,o),l.minY=d(e,a),l.maxY=h(e,a);for(let p,x,y,b,v,E,A,S=0;S<2;++S)if(S===0?(g=t,f=s,m=n,_=o):(g=e,f=i,m=r,_=a),x=6*g-12*f+6*m,p=-3*g+9*f-9*m+3*_,y=3*f-3*g,x|=0,p|=0,y|=0,p!==0)v=x*x-4*y*p,v<0||(E=(-x+u(v))/(2*p),E>0&&E<1&&(c=Id(E,g,f,m,_),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))),A=(-x-u(v))/(2*p),A>0&&A<1&&(c=Id(A,g,f,m,_),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))));else{if(x===0)continue;b=-y/x,b>0&&b<1&&(c=Id(b,g,f,m,_),S===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c)))}return l}function Id(t,e,s,i,n){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*s+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*n}function y1(t,e,s,i,n,r){const o=t-2*s+n,a=e-2*i+r,l=2*s-2*t,d=2*i-2*e,h=4*(o*o+a*a),u=4*(o*l+a*d),c=l*l+d*d,g=2*Math.sqrt(h+u+c),f=Math.sqrt(h),m=2*h*f,_=2*Math.sqrt(c),p=u/f;return(m*g+f*u*(g-_)+(4*c*h-u*u)*Math.log((2*f+p+g)/(p+_)))/(4*m)}var Si=class Vh extends Ro{constructor({bufferList:e,patternManager:s,boundariesManager:i,shapeManager:n,textManager:r,memoryManager:o}){super(),this._firstFrame=!0,this._width=0,this._height=0,this._pixelRatio=0,this._viewX=0,this._viewY=0,this._viewZoom=0,this._viewAngle=0,this._viewAngleCos=0,this._viewAngleSin=0,this._currentTime=0,this._scales={bytesToActualCoord:0,bytesToActualScaledSize:0,bytesToActualMinVisibleSize:0,bytesToActualSymbolicSize:0,bytesToActualDashLength:0,bytesToActualGapLength:0,bytesToActualPatternScale:0},this._shapesVersion=0,this._patternsVersion=0,this._boundariesVersion=0,this._textsVersion=0,this._backgroundRgba=[1,1,1,0],this._renderBackground=!1,this._hideImages=!1,this._genericObject=rc(),this._littleEndian=Dl(),this._bufferList=e,this._shapeManager=n,this._patternManager=s,this._boundariesManager=i,this._textManager=r,this._memoryManager=o}static{this.edgeArrowSizeRatio=Qy}static{this.minEdgeTipSize=Jy}static createInitData(){return null}static getName(){return null}static isAvailable(){return!0}static setEdgeArrowSizeRatio(e){Vh.edgeArrowSizeRatio=e}static setMinEdgeTipSize(e){Vh.minEdgeTipSize=e}getDomElement(){return null}_initCanvas(e){e.style.touchAction="none"}export(e){return Promise.resolve()}extractElement(e,s){return this._memoryManager.extractGenericElement(e,s,this._scales)}_compareDimensions(e,s,i){return(e!==this._width||s!==this._height||i!==this._pixelRatio)&&(this._width=e,this._height=s,this._pixelRatio=i,!0)}_compareView(e,s,i,n){return(e!==this._viewX||s!==this._viewY||i!==this._viewZoom||n!==this._viewAngle)&&(this._viewX=e,this._viewY=s,this._viewZoom=i,this._viewAngle=n,this._viewAngleCos=Math.cos(n),this._viewAngleSin=Math.sin(n),!0)}_compareCurrentTime(e){return e!==this._currentTime&&(this._currentTime=e,!0)}_compareBackgroundColor(e,s){return(e!==this._backgroundColor||s!==this._renderBackground)&&(this._renderBackground=s,this._backgroundColor=e,this._backgroundRgba=es(this._backgroundColor),!0)}_compareShapes(){return this._shapesVersion!==this._shapeManager.getVersion()&&(this._shapesVersion=this._shapeManager.getVersion(),!0)}_comparePatterns(){return this._patternsVersion!==this._patternManager.getVersion()&&(this._patternsVersion=this._patternManager.getVersion(),!0)}_compareBoundaries(){return this._boundariesVersion!==this._boundariesManager.getVersion()&&(this._boundariesVersion=this._boundariesManager.getVersion(),!0)}_compareTexts(){return this._textsVersion!==this._textManager.getVersion()&&(this._textsVersion=this._textManager.getVersion(),!0)}_compareIsDisplayableBuffer(e){return this._isBufferDisplayable!==e&&(this._isBufferDisplayable=e,!0)}_compareHideImages(e){return this._hideImages!==e&&(this._hideImages=e,!0)}renderFrame({x:e,y:s,zoom:i,angle:n,width:r,height:o,pixelRatio:a,backgroundColor:l,currentTime:d,isBufferDisplayable:h,hideImages:u,renderBackground:c}){const g=this._compareShapes(),f=this._comparePatterns(),m=this._compareBoundaries(),_=this._compareTexts(),p=this._compareDimensions(r,o,a),x=this._compareView(e,s,i,n),y=this._compareCurrentTime(d),b=this._compareBackgroundColor(l,c),v=this._compareIsDisplayableBuffer(h),E=this._compareHideImages(u);if(m){const A=this._boundariesManager,S=this._scales;S.bytesToActualCoord=1,S.bytesToActualScaledSize=A.maxScaledSize/Zy,S.bytesToActualMinVisibleSize=A.maxMinVisibleSize/Mh,S.bytesToActualSymbolicSize=A.maxSymbolicSize/Wn,S.bytesToActualDashLength=A.maxDashLength/Xn,S.bytesToActualGapLength=A.maxGapLength/Xn,S.bytesToActualPatternScale=A.maxPatternScale/Wn}this._firstFrame&&this._beforeFirstFrame(),this._render({shapesChanged:g,patternsChanged:f,boundariesChanged:m,textsChanged:_,dimensionsChanged:p,viewChanged:x,currentTimeChanged:y,backgroundColorChanged:b,isBufferDisplayableChanged:v,isHideImagesChanged:E}),this._firstFrame&&(this._afterFirstFrame(),this._firstFrame=!1)}_render(e){}_beforeFirstFrame(){}_afterFirstFrame(){}destroy(){}ensureAnimationsReady(){}getImageData(){return null}setViewportClipping(e){}};function Ix(t,e,s,i,n,r,o,a=0,l=!1){const d=Ie(s,i,n,r),h=(o/2*(l?Ie(t,e,n,r)/d:1)+a)/d,u=(n-s)*h,c=(r-i)*h,g=s+c,f=i-u,m=t-g,_=e-f,p=s-c-g,x=i+u-f,y=n+c-g,b=r-u-f,v=m*p+_*x,E=m*y+_*b;return v>0&&v<p*p+x*x&&E>0&&E<y*y+b*b}function x1(t,e,s,i,n=!1){if(n&&(oa(t,s)||oa(t,i)||oa(e,s)||oa(e,i)))return!1;let r=(t.y-s.y)*(i.x-s.x)-(t.x-s.x)*(i.y-s.y);const o=(e.x-t.x)*(i.y-s.y)-(e.y-t.y)*(i.x-s.x);if(o===0)return!1;const a=r/o;r=(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y);const l=r/o;return!(a<=0||a>=1||l<=0||l>=1)}function oa(t,e){return t.x===e.x&&t.y===e.y}function ur(t,e,s,i){return Math.atan2(i-e,s-t)}function b1(t,e,s){const i=ur(t.x,t.y,e.x,e.y)-ur(s.x,s.y,e.x,e.y);return i<0?i+2*Math.PI:i}function v1(t,e,s,i,n,r,o,a){const l=(a-r)*(s-t)-(o-n)*(i-e);if(l===0)return null;let d=e-r;return d=((o-n)*d-(a-r)*(t-n))/l,{x:t+d*(s-t),y:e+d*(i-e)}}function Gr(t,e,s,i,n,r,o,a){const l=t-s,d=e-i,h=n-o,u=r-a,c=l*u-h*d,g=(d*(t-n)-l*(e-r))/c;if(g<0||g>1)return null;const f=(h*(r-e)+u*(t-n))/c;return f>=0&&f<=1?{x:t-f*l,y:e-f*d}:null}function Cx(t,e,s,i,n,r,o,a){let l;const d=[];return l=Gr(t,e,s,i,n,r,n,a),l&&d.push(l),l=Gr(t,e,s,i,n,a,o,a),l&&d.push(l),l=Gr(t,e,s,i,o,a,o,r),l&&d.push(l),l=Gr(t,e,s,i,o,r,n,r),l&&d.push(l),d}function $n(t,e,s,i,n,r,o,a){const l=((o-n)*(e-r)-(a-r)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e)),d=((s-t)*(e-r)-(i-e)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e));return l>=0&&l<=1&&d>=0&&d<=1}function mc(t,e,s,i,n,r,o,a){return t>=n&&e>=r&&t<=o&&e<=a||s>=n&&i>=r&&s<=o&&i<=a||!!$n(t,e,s,i,n,r,n,a)||!!$n(t,e,s,i,o,r,o,a)||!!$n(t,e,s,i,n,r,o,r)||!!$n(t,e,s,i,n,a,o,a)}function Lx(t,e,s){return Math.sqrt(_c(t.x,t.y,e.x,e.y,s.x,s.y))}function _c(t,e,s,i,n,r){const o=qa(s,i,n,r);if(o===0)return qa(t,e,s,i);let a=((t-s)*(n-s)+(e-i)*(r-i))/o;return a=Math.max(0,Math.min(1,a)),qa(t,e,s+a*(n-s),i+a*(r-i))}function Nx(t,e,s,i,n,r){const o=n-s,a=r-i;if(o===0&&a===0)return{x:s,y:i};const l=((t-s)*o+(e-i)*a)/(o*o+a*a);return l<0?{x:s,y:i}:l>1?{x:n,y:r}:{x:s+l*o,y:i+l*a}}function E1(t,e,s,i,n,r){const o=n-s,a=r-i,l=((t-s)*o+(e-i)*a)/(o*o+a*a);return{x:s+o*l,y:i+a*l}}function sd(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,f=-u*n/Yl;return o.x=a+c*f,o.y=l+g*f,o}function pc(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/yl*s)*yl,l=-n+Fs,d=Fs/2-n;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function A1(t,e,s,i){const n=Math.abs(t.x-e.x-s.x+i.x)+Math.abs(t.y-e.y-s.y+i.y)<.01,r=9*(e.x-t.x)**2,o=(-243*t.x+189*e.x+51*s.x+3*i.x)**2/1e4,a=(-48*t.x+24*e.x+21*s.x+3*i.x)**2/625,l=(-147*t.x+21*e.x+99*s.x+27*i.x)**2/1e4,d=(-27*t.x-9*e.x+24*s.x+12*i.x)**2/625,h=9/16*(s.x+i.x-t.x-e.x)**2,u=9*(e.y-t.y)**2,c=(-243*t.y+189*e.y+51*s.y+3*i.y)**2/1e4,g=(-48*t.y+24*e.y+21*s.y+3*i.y)**2/625,f=(-147*t.y+21*e.y+99*s.y+27*i.y)**2/1e4,m=(-27*t.y-9*e.y+24*s.y+12*i.y)**2/625,_=9/16*(s.y+i.y-t.y-e.y)**2,p=Math.sqrt(r+u),x=Math.sqrt(o+c),y=Math.sqrt(a+g),b=Math.sqrt(l+f),v=Math.sqrt(d+m),E=Math.sqrt(h+_);if(n)return 5/2993760*(32134*p+212600*x-97050*y+544800*b-521100*v+427368*E);const A=(-12*t.x-24*e.x+9*s.x+27*i.x)**2/625,S=(-27*t.x-99*e.x-21*s.x+147*i.x)**2/1e4,w=(-3*t.x-21*e.x-24*s.x+48*i.x)**2/625,L=(-3*t.x-51*e.x-189*s.x+243*i.x)**2/1e4,T=9*(i.x-s.x)**2,F=(-12*t.y-24*e.y+9*s.y+27*i.y)**2/625,V=(-27*t.y-99*e.y-21*s.y+147*i.y)**2/1e4,G=(-3*t.y-21*e.y-24*s.y+48*i.y)**2/625,O=(-3*t.y-51*e.y-189*s.y+243*i.y)**2/1e4,j=9*(i.y-s.y)**2,W=Math.sqrt(A+F),et=Math.sqrt(S+V),at=Math.sqrt(w+G),mt=Math.sqrt(L+O);return 5/2993760*(16067*(p+Math.sqrt(T+j))+106300*(x+mt)-48525*(y+at)+272400*(b+et)-260550*(v+W)+427368*E)}var S1={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}},w1=[{name:"topLeft",dx:-1,dy:-1,cornerIndex:2},{name:"topRight",dx:1,dy:-1,cornerIndex:3},{name:"bottomLeft",dx:-1,dy:1,cornerIndex:1},{name:"bottomRight",dx:1,dy:1,cornerIndex:0}],_i={x:0,y:0};function T1(t,e,s,i,n,r,o,a,l,d,h,u){r=r||o.getNodes()._indexes;const c=l.getZoom(),g=o.getObjectList(!0),f=a.getFlexArrays().nodes.current;let m=1/0,_=0,p=-1/0;a.update();for(let x=0;x<r.length;++x){const y=r[x];if(f.excluded.get(y)||!f.detectable.get(y)||h.has(y))continue;const b=f.x.get(y),v=f.y.get(y),E=f.layer.get(y);if(E<p)continue;_i.x=b,_i.y=v;const A=l.graphToScreenCoordinates(_i),S=A.x,w=A.y,L=f.shape.get(y),T=f.scalingMethod.get(y)==="scaled",F=f.radius.get(y)*(T?c:1),V=F+n,G=(t-S)/V,O=(e-w)/V;if(_i.x=t,_i.y=e,!(i&&Mx(_i,y,a,l,d)))if(d.checkShapeHit(L,G,O)){const j=o.getAttribute(!0,"virtual").get(y)!==0;if(V>m&&j)continue;m=V}else{if(!s)continue;{const j=u(f.text.content.get(y)||null),W=f.textHidden.get(y),et=f.text.minVisibleSize.get(y);if(W||!j||(T?2*F:1/0)<et)continue;const at=uc(j,f.text.maxLineLength.get(y)),mt=f.innerStroke.width.get(y),vt=f.text.margin.get(y),wt=f.text.padding.get(y),Et=f.text.size.get(y),yt=f.text.scale.get(y),St=f.text.scaling.get(y),zt=f.text.font.get(y),Zt=f.text.style.get(y),Kt=f.text.position.get(y),X=d.measureText(at,zt,Zt,1),Q=St?yt*F*2:Et,gt=X.width*Q/2+wt,lt=X.height*Q/2+wt,st=S1[Kt],ot=mt+vt+F,rt=S+(ot+gt)*st.x,ft=w+(ot+lt)*st.y;if(t<=rt-gt||t>=rt+gt||e<=ft-lt||e>=ft+lt)continue}}_=y,p=E}return g.get(_)||null}function Mx(t,e,s,i,n){const r=s.getFlexArrays().nodes.current,o=i.getZoom(),a=r.scalingMethod.get(e)==="scaled",l=r.radius.get(e)*(a?o:1),d=r.x.get(e),h=r.y.get(e),u=r.radius.get(e);for(let c=0;c<4;c++){const{name:g,cornerIndex:f}=w1[c],m=r.badges[g].stroke.width.get(e),_=r.badges[g].stroke.scalingMethod.get(e)==="scaled",p=r.badges[g].scale.get(e)*l+(_?o:1)*m,x=r.badges[g].minVisibleSize.get(e)/2,y=r.badges[g].positionScale.get(e);if(!r.badges[g].text.content.get(e)&&!r.badges[g].image.url.get(e)||p<x)continue;const b=i.graphToScreenCoordinates({x:d+u*y*i.getCornerCos(f),y:h+u*y*i.getCornerSin(f)}),{x:v,y:E}=b,A=(t.x-v)/p,S=(t.y-E)/p;if(n.checkShapeHit("circle",A,S))return g}}function I1(t,e,s,i,n,r,o,a,l,d,h){n=n||r.getEdges()._indexes;const u=r.getObjectList(!1),c=l.getFlexArrays(),g=c.edges.current,f=c.nodes.current,m=o.getZoom(),_=o.getAngle(),p=Math.cos(_),x=Math.sin(_),y=i/m;_i.x=t,_i.y=e;const b=o.screenToGraphCoordinates(_i),v=b.x,E=b.y;let A=0;l.update();for(let S=0;S<n.length;++S){const w=n[S],L=g.source.get(w),T=g.target.get(w),F=g.excluded.get(w),V=g.detectable.get(w),G=a.has(L),O=a.has(T);if(F||!V||G||O)continue;const j=L===T,W=g.curvature.get(w),et=g.shape.body.get(w)==="triangle",at=g.scalingMethod.get(w)==="scaled",mt=g.width.get(w)/(at?1:m),vt=f.x.get(L),wt=f.y.get(L),Et=f.x.get(T),yt=f.y.get(T);if(j){const St=f.scalingMethod.get(L)==="scaled",zt=pc(vt,wt,W,f.radius.get(L)/(St?1:m),0);if(!Gh(v,E,vt,wt,vt,wt,zt.x1,zt.y1,zt.x2,zt.y2,mt,y))continue}else if(d){const St=Jl(vt*p-wt*x,wt*p+vt*x,Et*p-yt*x,yt*p+Et*x,W,d,h);if(!Gh(v,E,vt,wt,Et,yt,St.x1*p+St.y1*x,St.y1*p-St.x1*x,St.x2*p+St.y2*x,St.y2*p-St.x2*x,mt,y))continue}else if(W!==0){const St=sd(vt,wt,Et,yt,W);if(!Tx(v,E,vt,wt,Et,yt,St.x,St.y,mt,y,et))continue}else if(!Ix(v,E,vt,wt,Et,yt,mt,y,et))continue;A=w}return u.get(A)||null}function C1(t){const e=t.getNodeAttribute("radius"),s=t.getEdgeAttribute("width"),i=t.getNodes(),n=t.getEdges();let r=0,o=0;for(let a=0;a<i._indexes.length;a++){const l=i._indexes[a],d=e.get(l);d>r&&(r=d)}for(let a=0;a<n._indexes.length;a++){const l=n._indexes[a],d=s.get(l);d>o&&(o=d)}return Math.max(2*r,o)}function L1(t){return t===null?"none":t==="webgl"?"WebGL":t==="svg"?"SVG":t==="canvas"?"Canvas":t}function Px(t,e,s,i){const n=(t-e)/s,r=n*n,o=r*n,a=oc.getCoefficients(i),l=n<.5?0:4;return Os(a[l]+a[l+1]*n+a[l+2]*r+a[l+3]*o,0,1)}function Vr(t,e,s,i){if(t===e)return t;const[n,r,o,a]=es(t),[l,d,h,u]=es(e);return`rgba(${Math.round(255*ne(n,l,s))},${Math.round(255*ne(r,d,s))},${Math.round(255*ne(o,h,s))},${ne(a,u,i)})`}function N1(t,e){const[s,i,n,r]=es(t);return`rgba(${255*s},${255*i},${255*n},${r*e})`}var mf=1/ms,Rx=class extends Si{constructor(t){super(t),this._cachePoints=[],this._nextCachePoint=0,this._tmp={x1:0,y1:0,x2:0,y2:0},this._ccp={x1:0,y1:0,x2:0,y2:0},this._pointCopies=Array(128),this._clipViewport=!0}_resetCachePoints(){this._nextCachePoint=0}_point(t,e){let s=this._cachePoints[this._nextCachePoint++];return s||(s={x:0,y:0},this._cachePoints.push(s)),s.x=t,s.y=e,s}setViewportClipping(t){this._clipViewport=t}_displayBuffer(t){const e=t.getSize(),s=t.animated;for(let i=0;i<e;++i){const n=this.extractElement(t,i);n.valid&&this._displayElement(n,s)}}_mixAttributes(t,e,s){const i=Px(this._currentTime,s.beginTime,s.duration,s.easing);return t.dashLength=ne(e.dashLength,t.dashLength,i),t.gapLength=ne(e.gapLength,t.gapLength,i),t.offsetAngle=ne(e.offsetAngle,t.offsetAngle,i),t.opacity=ne(e.opacity,t.opacity,i),t.globalMinVisibleSize=ne(e.globalMinVisibleSize,t.globalMinVisibleSize,i),t.strokeMinVisibleSize=ne(e.strokeMinVisibleSize,t.strokeMinVisibleSize,i),t.patternMinVisibleSize=ne(e.patternMinVisibleSize,t.patternMinVisibleSize,i),t.symbolicSize=ne(e.symbolicSize,t.symbolicSize,i),t.curvature=ne(e.curvature,t.curvature,i),t.fillColor=Vr(e.fillColor,t.fillColor,i,i),t.strokeColor=Vr(e.strokeColor,t.strokeColor,i,i),t.patternColor=Vr(e.patternColor,t.patternColor,i,i),t.x1=ne(e.x1,t.x1,i),t.y1=ne(e.y1,t.y1,i),t.x2=ne(e.x2,t.x2,i),t.y2=ne(e.y2,t.y2,i),t.rectWidthOrSourceRadiusScaled=ne(e.rectWidthOrSourceRadiusScaled,t.rectWidthOrSourceRadiusScaled,i),t.rectWidthOrSourceRadiusFixed=ne(e.rectWidthOrSourceRadiusFixed,t.rectWidthOrSourceRadiusFixed,i),t.rectHeightOrTargetRadiusScaled=ne(e.rectHeightOrTargetRadiusScaled,t.rectHeightOrTargetRadiusScaled,i),t.rectHeightOrTargetRadiusFixed=ne(e.rectHeightOrTargetRadiusFixed,t.rectHeightOrTargetRadiusFixed,i),t.thicknessOrFontSizeScaled=ne(e.thicknessOrFontSizeScaled,t.thicknessOrFontSizeScaled,i),t.thicknessOrFontSizeFixed=ne(e.thicknessOrFontSizeFixed,t.thicknessOrFontSizeFixed,i),t.strokeWidthScaled=ne(e.strokeWidthScaled,t.strokeWidthScaled,i),t.strokeWidthFixed=ne(e.strokeWidthFixed,t.strokeWidthFixed,i),t.offsetScaled=ne(e.offsetScaled,t.offsetScaled,i),t.offsetFixed=ne(e.offsetFixed,t.offsetFixed,i),t}_computeRenderInfo(t){const e=this._viewZoom,s=this._point(t.x1,t.y1),i=this._point(t.x2,t.y2);return{shape:this._shapeManager.getDefinitionFromName(t.shape),pieceId:t.pieceId,dashLength:t.dashLength,gapLength:t.gapLength,hasHead:t.hasHead,hasTail:t.hasTail,isBodyTriangle:t.isBodyTriangle,isSelfLoop:t.isSelfLoop,patternScale:t.patternScale,offsetAngle:ol(t.offsetAngle),isText:t.isText,adjustTextAngle:t.adjustTextAngle,isBadge:t.isBadge,bentEnable:t.bentEnable,bentVertical:t.bentVertical,opacity:t.opacity,globalMinVisibleSize:t.globalMinVisibleSize,strokeMinVisibleSize:t.strokeMinVisibleSize,patternMinVisibleSize:t.patternMinVisibleSize,symbolicSize:t.symbolicSize===0?1/0:t.symbolicSize*e,curvature:t.curvature,pattern:t.pattern,fillColor:t.fillColor,strokeColor:t.strokeColor,patternColor:t.patternColor,pos1OnGraph:s,pos2OnGraph:i,pos1:this._graphToScreenCoordinates(s),pos2:this._graphToScreenCoordinates(i),rectWidthOrSourceRadius:t.rectWidthOrSourceRadiusScaled*e+t.rectWidthOrSourceRadiusFixed,rectHeightOrTargetRadius:t.rectHeightOrTargetRadiusScaled*e+t.rectHeightOrTargetRadiusFixed,thicknessOrFontSize:t.thicknessOrFontSizeScaled*e+t.thicknessOrFontSizeFixed,strokeWidth:t.strokeWidthScaled*e+t.strokeWidthFixed,offset:t.offsetScaled*e+t.offsetFixed}}_applyBackgroundBlending(t){t.opacity!==1&&(t.fillColor=this._blendColor(t.fillColor,t.opacity),t.strokeColor=this._blendColor(t.strokeColor,t.opacity),t.textColor=this._blendColor(t.textColor,t.opacity))}_pointArray(t){let e=this._pointCopies[t];if(!e){e=new Array(t),this._pointCopies[t]=e;for(let s=0;s<t;++s)e[s]={x:0,y:0,r:0}}return e}_scalePoints(t,e,s,i){const n=t.shape.points.length,r=this._pointArray(n);for(let l=0;l<n;++l){const d=t.shape.points[l],h=r[l];h.x=e.x+d.x*s,h.y=e.y+d.y*i,h.r=d.r*s}const o=t.pos2OnGraph.x-t.pos1OnGraph.x,a=t.pos2OnGraph.y-t.pos1OnGraph.y;if(o!==0||a!==0){const l=Math.sqrt(o*o+a*a),d=o/l,h=a/l;for(const u of r){const c=u.x-e.x,g=u.y-e.y;u.x=e.x+d*c+h*g,u.y=e.y-h*c+d*g}}return r}_drawPoints(t,e=!1){t.length===1?this._drawCircle(t[0],t[0].r):this._drawPolygon(t,e)}_computeCenter(t){const e=Math.cos(t.offsetAngle),s=Math.sin(t.offsetAngle),i=(t.pos1.x+t.pos2.x)/2+e*t.offset,n=(t.pos1.y+t.pos2.y)/2+s*t.offset;return this._point(i,n)}_displayTextBox(t,e,s,i){const n=this._computeCenter(t),r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2;(e||i)&&this._drawRoundedRectangle(n,r,o,0,t.fillColor)}_displayNodeComponent(t,e,s,i){const n=this._computeCenter(t);if(t.pattern.type!==Qi){const r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2,a=this._scalePoints(t,n,r,o);if((e||i)&&this._drawPoints(a,!0),e&&this._fill(t.fillColor),i){if(this._startClip(),t.pattern.type===Fo){let l=t.pattern.attributes.colorArray;t.opacity!==1&&(l=l.map(d=>this._blendColor(d,t.opacity))),this._displayPieChart(n,r,l)}else if(t.pattern.type===xn||t.pattern.type===bn){const d=Math.round(t.rectHeightOrTargetRadius*t.patternScale),h=t.pattern.attributes.text,u=this._blendColor(t.patternColor,t.opacity),c=t.pattern.attributes.font,g=t.pattern.attributes.style,f=t.pattern.attributes.align,m=t.rectWidthOrSourceRadius,_=t.pattern.attributes.paddingTop,p=t.pattern.attributes.paddingLeft;this._displayText(n,0,h,u,c,d,g,f,m,p,_,!0)}else if(t.pattern.type===Yi){const l=t.pattern.attributes.image;if(l.isDummy||l.width&&l.height){const d=t.pattern.attributes.duplicated,h=d?1:t.patternScale,u=t.rectWidthOrSourceRadius*h,c=t.rectHeightOrTargetRadius*h,g=t.pattern.attributes.scaled,f=t.opacity;this._displayImage(n,u,c,l,g,d,f)}}this._endClip()}if(s){const l=t.strokeWidth/2,d=this._scalePoints(t,n,r+l,o+l);this._drawPoints(d),this._stroke(t.strokeColor,t.strokeWidth)}}else if(i){const o=t.thicknessOrFontSize,a=t.pattern.attributes.text,l=this._blendColor(t.patternColor,t.opacity),d=t.pattern.attributes.font,h=t.pattern.attributes.style,u=t.pattern.attributes.align,c=t.rectWidthOrSourceRadius;this._displayText(n,0,a,l,d,o,h,u,c,0,0,!1)}}_displayElement(t,e){if(!t.end||!t.end.shape||!t.end.pieceId||e&&(!t.start||!t.animation))return;this._resetCachePoints();const s=e?this._mixAttributes(t.end,t.start,t.animation):t.end,i=this._computeRenderInfo(s);if(i.symbolicSize<i.globalMinVisibleSize||i.opacity===0)return;this._applyBackgroundBlending(i);const n=!!(i.strokeColor&&i.strokeWidth>0&&i.symbolicSize>=i.strokeMinVisibleSize),r=i.pattern.type!==ss&&i.symbolicSize>=i.patternMinVisibleSize,o=!!i.fillColor;if(i.pieceId===ks)return this._displayNodeComponent(i,o,n,r);if(i.pieceId===fn)return this._displayTextBox(i,o,n,r);const a=i.pos2.x-i.pos1.x,l=i.pos2.y-i.pos1.y,d=Math.sqrt(a*a+l*l);let h,u=null,c=null;if(i.bentEnable&&!i.isSelfLoop)this._tmp.x1=i.pos1.x,this._tmp.y1=i.pos1.y,this._tmp.x2=i.pos2.x,this._tmp.y2=i.pos2.y,i.pos1.x=this._tmp.x1*this._viewAngleCos-this._tmp.y1*this._viewAngleSin,i.pos1.y=this._tmp.y1*this._viewAngleCos+this._tmp.x1*this._viewAngleSin,i.pos2.x=this._tmp.x2*this._viewAngleCos-this._tmp.y2*this._viewAngleSin,i.pos2.y=this._tmp.y2*this._viewAngleCos+this._tmp.x2*this._viewAngleSin,Jl(i.pos1.x,i.pos1.y,i.pos2.x,i.pos2.y,i.curvature,i.bentEnable,i.bentVertical,this._ccp),i.pos1.x=this._tmp.x1,i.pos1.y=this._tmp.y1,i.pos2.x=this._tmp.x2,i.pos2.y=this._tmp.y2,this._tmp.x1=this._ccp.x1,this._tmp.y1=this._ccp.y1,this._tmp.x2=this._ccp.x2,this._tmp.y2=this._ccp.y2,this._ccp.x1=this._tmp.x1*this._viewAngleCos+this._tmp.y1*this._viewAngleSin,this._ccp.y1=this._tmp.y1*this._viewAngleCos-this._tmp.x1*this._viewAngleSin,this._ccp.x2=this._tmp.x2*this._viewAngleCos+this._tmp.y2*this._viewAngleSin,this._ccp.y2=this._tmp.y2*this._viewAngleCos-this._tmp.x2*this._viewAngleSin,u=this._point(this._ccp.x1,this._ccp.y1),c=this._point(this._ccp.x2,this._ccp.y2),h=A1(i.pos1,u,c,i.pos2);else if(i.isSelfLoop){const g=i.pieceId===ln||i.pieceId===ln+fn?i.strokeWidth/2:i.rectWidthOrSourceRadius,{x1:f,y1:m,x2:_,y2:p}=this._getSelfLoopControlPoints(i.pos1,i.curvature,g);u=this._point(f,m),c=this._point(_,p),h=P1(i.pos1,u,c,i.pos2,1)}else i.curvature?(u=this._getQuadraticCurveControlPoint(i),h=M1(i.curvature,d,1)):h=d;if(i.pieceId===ln||i.pieceId===ln+fn){const g=i.strokeWidth,f=this._getPointOnLine(i.pos1,u,c,i.pos2,.5),m=this._getTangentOnLine(i.pos1,u,c,i.pos2,.5);if(i.rectWidthOrSourceRadius>=h-g&&!i.isSelfLoop){if(!i.adjustTextAngle)return;m.x=1,m.y=0}let _=-Math.atan2(m.y,m.x);const p=ol(i.offsetAngle-_);(!i.isSelfLoop&&p<0||i.isSelfLoop&&i.offsetAngle<0)&&(m.x*=-1,m.y*=-1),(_>Math.PI/2||_<-Math.PI/2)&&(_+=Math.PI);const x=this._getOrthogonal(m),y=f.x+x.x*i.offset,b=f.y+x.y*i.offset;if(i.pieceId===ln+fn){if(!i.fillColor)return;const v=i.rectWidthOrSourceRadius/2,E=i.rectHeightOrTargetRadius/2;this._drawRoundedRectangle(this._point(y,b),v,E,p+Math.PI/2,i.fillColor)}else{const v=this._point(y,b),E=_,A=i.thicknessOrFontSize,S=i.pattern.attributes.text,w=this._blendColor(i.patternColor,i.opacity),L=i.pattern.attributes.font,T=i.pattern.attributes.style,F=i.pattern.attributes.align,V=i.rectWidthOrSourceRadius;this._displayText(v,E,S,w,L,A,T,F,V,0,0,!1)}}else{const g=i.pieceId===ic,f=i.pieceId===nc,m=Math.cos(i.offsetAngle),_=Math.sin(i.offsetAngle);i.pos1.x+=m*i.offset,i.pos1.y+=_*i.offset,i.pos2.x+=m*i.offset,i.pos2.y+=_*i.offset;const p=i.shape.name==="line",x=i.thicknessOrFontSize,y=i.rectWidthOrSourceRadius,b=i.rectHeightOrTargetRadius,v=+i.hasHead,E=+i.hasTail,A=Math.max(Si.minEdgeTipSize,x*Si.edgeArrowSizeRatio),S=v*Math.min(5*y,A),w=E*Math.min(5*b,A),L=i.isSelfLoop?1/0:d-y-b,T=Math.min(0,L-S-w)/2,F=x/2;let V=y>F?y-Math.sqrt(y*y-F*F):F;const G=Math.max(y+w+E*T,0)-(1-v)*V;V=y>F?b-Math.sqrt(b*b-F*F):F;const O=Math.max(b+S+v*T,0)-(1-E)*V;if(g||f){const j=f?-1:1,W=(g?h-O:G)-j;let et=null,at=null;if((i.bentEnable||i.isSelfLoop)&&u&&c){const mt=this._getTFromLengthOnCubicCurve(i.pos1,u,c,i.pos2,(g?O:G)+1+i.strokeWidth/2,f);et=this._getPointOnCubicCurve(i.pos1,u,c,i.pos2,mt),at=this._getTangentOnCubicCurve(i.pos1,u,c,i.pos2,mt)}else if(i.curvature&&u){const mt=this._getTFromLengthOnQuadraticCurve(i.pos1,u,i.pos2,W-i.strokeWidth/2*j);et=this._getPointOnQuadraticCurve(i.pos1,u,i.pos2,mt),at=this._getTangentOnQuadraticCurve(i.pos1,u,i.pos2,mt)}else{const mt=W/h;et=this._mixPoints(i.pos1,i.pos2,mt),at=this._point(a/d,l/d)}if(at.x*=j,at.y*=j,o){if(i.shape.hole){const vt=this._makeEdgeExtremityPoints(et,at,A,i.shape.hole);this._drawPoints(vt),this._startReverseClip()}const mt=this._makeEdgeExtremityPoints(et,at,A,i.shape.points);this._drawPoints(mt),this._fill(i.fillColor),i.shape.hole&&this._endReverseClip()}if(n){if(i.shape.hole){const wt=this._makeEdgeExtremityPoints(et,at,A,i.shape.hole);this._drawPoints(wt),this._stroke(i.strokeColor,i.strokeWidth)}const mt=A+i.strokeWidth/2,vt=this._makeEdgeExtremityPoints(et,at,mt,i.shape.points);this._drawPoints(vt),this._stroke(i.strokeColor,i.strokeWidth)}}else{if(h-G-O<=0)return;if(p){const j=R1(h,x,G,O,i.dashLength,i.gapLength);n&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.strokeColor,x+2*i.strokeWidth,j)),o&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.fillColor,x,j))}else{const j=G,W=h-O;if(n){const et=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,j,W,x+i.strokeWidth/2,i.strokeWidth/2,h);this._drawPoints(et),this._stroke(i.strokeColor,i.strokeWidth)}if(o){const et=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,j,W,x,0,h);this._drawPoints(et),this._fill(i.fillColor)}}}}}_makeTriangleEdgeBody(t,e,s,i,n,r,o,a,l){return e?s?this._makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a,l):this._makeCurveTriangleEdge(t,e,i,n,r,o,a):this._makeStraightTriangleEdge(t,i,n,r,o,a)}_makeCurveTriangleEdge(t,e,s,i,n,r,o){const a=2*ms+2,l=this._pointArray(a),d=this._getTFromLengthOnQuadraticCurve(t,e,s,i),h=(this._getTFromLengthOnQuadraticCurve(t,e,s,n)-d)/ms,u=(o-r)/ms/2;let c=r/2,g=d;for(let f=0;f<=ms;++f){const m=this._getPointOnQuadraticCurve(t,e,s,g),_=this._getTangentOnQuadraticCurve(t,e,s,g),p=this._getOrthogonal(_),x=p.x*c,y=p.y*c,b=l[f],v=l[a-1-f];b.x=m.x+x,b.y=m.y+y,v.x=m.x-x,v.y=m.y-y,g+=h,c+=u}return l}_makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a,l){const d=2*ms+2,h=this._pointArray(d),u=this._getTFromLengthOnCubicCurve(t,e,s,i,n),c=(this._getTFromLengthOnCubicCurve(t,e,s,i,l-r,!1)-u)/ms,g=(a-o)/ms/2;let f=o/2,m=u;for(let _=0;_<=ms;++_){const p=this._getPointOnCubicCurve(t,e,s,i,m),x=this._getTangentOnCubicCurve(t,e,s,i,m),y=this._getOrthogonal(x),b=y.x*f,v=y.y*f,E=h[_],A=h[d-1-_];E.x=p.x+b,E.y=p.y+v,A.x=p.x-b,A.y=p.y-v,m+=c,f+=g}return h}_makeStraightTriangleEdge(t,e,s,i,n,r){const o=e.x-t.x,a=e.y-t.y,l=Math.sqrt(o*o+a*a),d=this._point(o/l,a/l),h=this._getOrthogonal(d),u=n/2,c=r/2,g=this._pointArray(4),f=g[0],m=g[1],_=g[2],p=g[3],x=t.x+d.x*s,y=t.y+d.y*s,b=t.x+d.x*i,v=t.y+d.y*i,E=h.x*u,A=h.y*u,S=h.x*c,w=h.y*c;return f.x=x+E,f.y=y+A,m.x=x-E,m.y=y-A,_.x=b-S,_.y=v-w,p.x=b+S,p.y=v+w,g}_makeEdgeExtremityPoints(t,e,s,i){const n=this._pointArray(i.length),r=s/2,o=t.x+e.x*r,a=t.y+e.y*r,l=e.x,d=e.y;for(let h=0;h<i.length;++h){const u=i[h],c=n[h],g=(l*u.x-d*u.y)*r,f=(d*u.x+l*u.y)*r;c.x=o+g,c.y=a+f,c.r=u.r*r}return n}_drawLine(t,e,s,i){e?s?this._drawCubicCurve(t,e,s,i):this._drawQuadraticCurve(t,e,i):this._drawStraightLine(t,i)}_getSelfLoopControlPoints(t,e,s){return pc(t.x,t.y,e,s,this._viewAngle,this._tmp)}_getQuadraticCurveControlPoint(t){return sd(t.pos1.x,t.pos1.y,t.pos2.x,t.pos2.y,t.curvature,this._point(0,0))}_graphToScreenCoordinates(t){const e=this._width/2,s=this._height/2,i=(t.x-this._viewX)*this._viewZoom,n=(t.y-this._viewY)*this._viewZoom,r=this._viewAngleCos,o=this._viewAngleSin,a=r*i+o*n+e,l=-o*i+r*n+s;return this._point(a,l)}_blendColor(t,e){return t&&this._backgroundColor?Vr(this._backgroundColor,t,e,1):t?N1(t,e):null}_getTangentOnLine(t,e,s,i,n){return e?s?this._getTangentOnCubicCurve(t,e,s,i,n):this._getTangentOnQuadraticCurve(t,e,i,n):this._getTangentOnStraightLine(t,i)}_getTangentOnStraightLine(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.sqrt(s*s+i*i);return this._point(s/n,i/n)}_getTangentOnQuadraticCurve(t,e,s,i){const n=1-i,r=n*e.x+i*s.x-(n*t.x+i*e.x),o=n*e.y+i*s.y-(n*t.y+i*e.y),a=Math.sqrt(r*r+o*o);return this._point(r/a,o/a)}_getTangentOnCubicCurve(t,e,s,i,n){const r=1-n,o=r*r,a=n*n,l=o*(e.x-t.x)+2*r*n*(s.x-e.x)+a*(i.x-s.x),d=o*(e.y-t.y)+2*r*n*(s.y-e.y)+a*(i.y-s.y),h=Math.sqrt(l*l+d*d);return this._point(l/h,d/h)}_mixPoints(t,e,s){const i=ne(t.x,e.x,s),n=ne(t.y,e.y,s);return this._point(i,n)}_getOrthogonal(t){return this._point(-t.y,t.x)}_getPointOnLine(t,e,s,i,n){return e?s?this._getPointOnCubicCurve(t,e,s,i,n):this._getPointOnQuadraticCurve(t,e,i,n):this._mixPoints(t,i,n)}_getPointOnQuadraticCurve(t,e,s,i){const n=Yn(t.x,e.x,s.x,i),r=Yn(t.y,e.y,s.y,i);return this._point(n,r)}_getPointOnCubicCurve(t,e,s,i,n){const r=gf(t.x,e.x,s.x,i.x,n),o=gf(t.y,e.y,s.y,i.y,n);return this._point(r,o)}_getTFromLengthOnCubicCurve(t,e,s,i,n,r=!0){if(!r)return 1-this._getTFromLengthOnCubicCurve(i,s,e,t,n,!0);let o=0,a=1,l=0;for(let d=0;d<10;d++){const h=(o+a)/2,u=h,c=this._getPointOnCubicCurve(t,e,s,i,u),g=Math.hypot(t.x-c.x,t.y-c.y);if(Math.abs(g-n)<.01)return h;g<n?(o=h,l=h):a=h}return l}_getTFromLengthOnQuadraticCurve(t,e,s,i){let n=t.x,r=t.y,o=0,a=0;for(let l=0;l<ms;++l){o+=mf;const d=Yn(t.x,e.x,s.x,o),h=Yn(t.y,e.y,s.y,o),u=d-n,c=h-r,g=Math.sqrt(u*u+c*c),f=a+g;if(f>i)return o-mf*((f-i)/g);a=f,n=d,r=h}return 1}};function M1(t,e,s){const i=Math.abs(t)/Yl+ux,n=i*i,r=s-.5,o=r*r,a=1/(16*n),l=Math.sqrt(o+a),d=.5/i*Math.sqrt(n+.25);return Math.abs(2*i)*(r*l+.5*d+a*Math.log(Math.abs((r+l)/(-.5+d))))*e}function P1(t,e,s,i,n){const r=(t.x+e.x+s.x)/3,o=(t.y+e.y+s.y)/3,a=r-e.x,l=o-e.y,d=e.x-s.x,h=e.y-s.y,u=a*a+l*l,c=(d*d+h*h)/4,g=Math.sqrt(u-c);return 2*tx*g*3.14159265359*n}function R1(t,e,s,i,n,r){const o=[];if(s&&o.push(0,s),n&&r){const a=n*e,l=r*e,d=a+l,h=t-i-s-d;let u=0;for(;u<h;)o.push(a,l),u+=d;const c=t-i-s-u,g=Math.min(a,c),f=Math.max(c-g,0);o.push(g,f)}else o.push(t-i-s,0);return i&&o.push(0,i),o}var Zn=0,to=1,eo=2,dn=3,_f=4,yc=0,qh=1,F1={[Zn]:{min:"NEAREST",mag:"NEAREST",mipmap:!1},[to]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[eo]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[dn]:{min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:!0}},D1={[yc]:"ALPHA",[qh]:"RGBA"};function cr(t){return Math.ceil((t+2*Ki)/Je)*Je}function O1(t,e,s,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r],l=a.x,d=a.y,h=l+i,u=d+n;let c=h<s&&u<s;if(c){for(let g=l;g<h;++g)if(e[g+d*s]===1){c=!1;break}}if(c){for(let g=d;g<u;++g)if(e[l+g*s]===1){c=!1;break}}if(c){for(let g=l;g<h;++g)for(let f=d;f<u;++f)e[g+f*s]=1;return t.splice(r,1),t.push({x:l,y:u},{x:h,y:d}),a}}return null}function pf(t,e,s,i,n,r,o){const a=4*t,l=e>>1<<7,d=e%2<<7;o[a]=s/Je,o[a+1]=i/Je,o[a+2]=l+n/Je,o[a+3]=d+r/Je}function k1(t,e,s,i,n,r,o){i|=0,n|=0,r|=0,o|=0,e|=0;for(let a=0;a<r;++a)for(let l=0;l<o;++l){const d=4*(i+a+(n+l)*e),h=4*(a+l*r);t[d]=s[h],t[d+1]=s[h+1],t[d+2]=s[h+2],t[d+3]=s[h+3]}}function z1(t,e){let s=0,i=4;for(let r=0;r<t.length;++r){const{width:o,height:a}=t[r],l=cr(o),d=cr(a);s+=l*d,i=Math.max(i,Math.max(l,d))}const n=Hi(Math.max(i,Math.sqrt(s)));return Math.min(n,e)}function yf(t,e){return Math.floor((e-t)/2)}function xf(t,e,s,i,n,r,o){const{min:a,mag:l,mipmap:d}=F1[r],h=t[D1[o]];if(o===yc){const u=new Uint8Array(n*n);for(let c=0;c<u.length;++c)u[c]=i[4*c+3];i=u}t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,h,n,n,0,h,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[l]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[a]),d&&t.generateMipmap(t.TEXTURE_2D)}function Fx(t,e,s,i,n){const r=new Uint8Array(s*s*4),o=Math.ceil(s/Je),a=new Uint8Array(o*o),l=[{x:0,y:0}];for(let d=0;d<e.length;++d){const h=e[d],u=h.id,c=cr(h.width)/Je,g=cr(h.height)/Je,f=O1(l,a,o,c,g);if(f){const m=h.width,_=h.height,p=h.pixels,x=c*Je,y=g*Je,b=f.x*Je+yf(m,x),v=f.y*Je+yf(_,y);k1(r,s,p,b,v,m,_),pf(u,t,b,v,x,y,n)}else{if(s<i)return Fx(t,e,2*s,i,n);Ei(`exceeded max WebGL texture size of ${i}; some texts/icons/images won't be displayed`),pf(u,t,0,0,0,0,n)}}return{texture:r,size:s}}function B1(t,e,s,i){const{getDistanceFromStrokeVertically:n,getDistanceFromStrokeHorizontally:r}=t,o=e*(1-s)/2,a=(e-1)/2;for(let l=0;l<e;++l)for(let d=0;d<e;++d){const h=4*(d*e+l),u=(l-a)/o,c=(d-a)/o,g=Os(n(u,c),-1,1),f=Os(r(u,c),-1,1);U1(i,h,bf(g),bf(f))}}function bf(t){const e=(t+1)/2;return Math.floor(32768*e)}function U1(t,e,s,i){t[e]=s>>8,t[e+1]=s%256,t[e+2]=i>>8,t[e+3]=i%256}function Dx(t,e){let s=-Math.PI/2;const i=2*Math.PI/t.length;for(const n of t){const r=s+i;e(n,s,r),s=r}}function Ox(t,e,s,i,n){Dx(e,(r,o,a)=>{t.beginPath(),t.moveTo(s,i),t.arc(s,i,n,o,a),t.fillStyle=r,t.fill()})}var G1=!We().__dummy,V1=class extends Rx{constructor(t){super(t),this._canvas=We(),this._imgCanvas=We(),this._initCanvas(this._canvas),this._ctx=this._canvas.getContext("2d"),this._imgCtx=this._imgCanvas.getContext("2d")}static getName(){return"Canvas"}static isAvailable(){return G1}getDomElement(){return this._canvas}_render({dimensionsChanged:t}){t&&ax(this._canvas,this._width,this._height,this._pixelRatio);const e=this._ctx,s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;e.clearRect(0,0,s,i),this._backgroundColor&&this._renderBackground&&(e.fillStyle=this._backgroundColor,e.fillRect(0,0,s,i));const n=this._bufferList.getBuffersByAscendingDepth();for(const r of n)this._isBufferDisplayable(r)&&this._displayBuffer(r)}_drawRoundedRectangle(t,e,s,i,n){const r=this._ctx,o=this._pixelRatio,a=t.x*o,l=t.y*o;e*=o,s*=o;const d=this._textManager.getCornerRadius(),h=Math.min(d*o,s);e+=h/2,r.save(),r.translate(a,l),r.rotate(i),r.beginPath(),r.arc(e-h,s-h,h,0,Math.PI/2),r.arc(-e+h,s-h,h,Math.PI/2,Math.PI),r.arc(-e+h,-s+h,h,Math.PI,3*Math.PI/2),r.arc(e-h,-s+h,h,3*Math.PI/2,0),n&&(r.fillStyle=n,r.fill()),r.restore()}_drawCircle(t,e){const s=this._ctx,i=this._pixelRatio,n=t.x*i,r=t.y*i,o=e*i;s.beginPath(),s.arc(n,r,o,0,2*Math.PI)}_drawPolygon(t){const e=this._ctx,s=this._pixelRatio;e.beginPath();const i=t[0];e.moveTo(i.x*s,i.y*s);for(let n=1;n<t.length;++n){const r=t[n];e.lineTo(r.x*s,r.y*s)}e.closePath()}_drawStraightLine(t,e){const s=this._ctx,i=this._pixelRatio;s.beginPath(),s.moveTo(t.x*i,t.y*i),s.lineTo(e.x*i,e.y*i)}_drawQuadraticCurve(t,e,s){const i=this._ctx,n=this._pixelRatio;i.beginPath(),i.moveTo(t.x*n,t.y*n),i.quadraticCurveTo(e.x*n,e.y*n,s.x*n,s.y*n)}_drawCubicCurve(t,e,s,i){const n=this._ctx,r=this._pixelRatio;n.beginPath(),n.moveTo(t.x*r,t.y*r),n.bezierCurveTo(e.x*r,e.y*r,s.x*r,s.y*r,i.x*r,i.y*r)}_fill(t){const e=this._ctx;e.fillStyle=t,e.fill()}_stroke(t,e,s=[]){if(e===0)return;const i=this._ctx,n=this._pixelRatio;i.setLineDash(s.map(r=>r*this._pixelRatio)),i.lineWidth=e*n,i.strokeStyle=t,i.stroke()}_startClip(){this._ctx.save(),this._ctx.clip()}_endClip(){this._ctx.restore()}_startReverseClip(){this._ctx.save(),this._ctx.rect(0,0,this._canvas.width,this._canvas.height),this._ctx.clip("evenodd")}_endReverseClip(){this._ctx.restore()}_displayText(t,e,s,i,n,r,o,a,l,d,h){const u=this._ctx,c=this._pixelRatio,g=t.x*c,f=t.y*c,m=r*c,_=a==="center"?0:-l/2;if(h=h*this._viewZoom*c,d=d*this._viewZoom*c,u.save(),u.translate(g,f+c),u.rotate(-e),u.textBaseline="middle",u.textAlign=a,Ji(u,n,m,o),u.fillStyle=i,s.indexOf(`
`)!==-1){const p=s.split(`
`),x=p.length;let y=(1-x)/2*m;for(let b=0;b<x;++b)u.fillText(p[b],d+_,h+y),y+=m}else u.fillText(s,d+_,h);u.restore()}_displayImage(t,e,s,i,n,r,o){if(this._hideImages||"isDummy"in i)return;let a=i;o!==1&&(a=this._blendImageOnBackground(i,o));const l=this._ctx,d=this._pixelRatio,h=t.x*d,u=t.y*d,c=e*d,g=s*d,f=a.width*d,m=a.height*d;if(n)l.drawImage(a,h-c/2,u-g/2,c,g);else if(r){const _=h-c/2,p=u-g/2,x=h+c/2,y=u+g/2;let b=h-f/2,v=u-m/2;for(;b>_;)b-=f;for(;v>p;)v-=m;const E=v;for(;b<x;){for(;v<y;)l.drawImage(a,b,v,f,m),v+=m;b+=f,v=E}}else l.drawImage(a,h-f/2,u-m/2,f,m)}_displayPieChart(t,e,s){const i=this._ctx,n=this._pixelRatio,r=t.x*n,o=t.y*n,a=e*n*2,l=2*a;s.length===1&&(i.fillStyle=s[0],i.fillRect(r-a,o-a,l,l)),s.length>1&&Ox(i,s,r,o,a)}_blendImageOnBackground(t,e){const s=this._backgroundRgba,i=`rgb(${Math.round(255*s[0])},${Math.round(255*s[1])},${Math.round(255*s[2])})`;return this._imgCanvas.width=t.width,this._imgCanvas.height=t.height,this._imgCtx.clearRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=1,this._imgCtx.fillStyle=i,this._imgCtx.fillRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=e,this._imgCtx.drawImage(t,0,0),this._imgCanvas}getImageData(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)}},kx=!1;try{kx=!!ie("svg")}catch{}var Tr="none",q1={left:"start",center:"middle",right:"end"},Ps="data-element-id",vf="data-text-component",j1="node-text",H1="edge-text",W1="badge-text";function mn(t){return Math.round(1e3*t)/1e3}function Ef(t,e,s,i,n,r){const o=ie("image");return o.setAttribute("width",mn(i)),o.setAttribute("height",mn(n)),o.setAttribute("x",mn(e)),o.setAttribute("y",mn(s)),o.setAttribute("href",t),r&&r.appendChild(o),o}function X1(t,e,s,i,n,r=1,o){const a=ie("rect");return a.setAttribute("x",t),a.setAttribute("y",e),a.setAttribute("width",s),a.setAttribute("height",i),a.setAttribute("fill",n),a.setAttribute("fill-opacity",r),o&&o.appendChild(a),a}var Y1=class extends Rx{constructor(t){super(t),this._svg=ie("svg"),this._defs=ie("defs"),this._styles=ie("g",{class:"styles"}),this._background=ie("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"}),this._currentElementId="0",this._currentClipPathId=null,this._clipPathCounter=0,this._defs.appendChild(this._styles),this._svg.setAttribute("pointer-events","none"),this._svg.style.userSelect="none",this._svg.appendChild(this._defs),this._svg.appendChild(this._background),this._clear()}static getName(){return"SVG"}static isAvailable(){return kx}getDomElement(){return this._svg}_render({dimensionsChanged:t}){if(t&&Du(this._svg,{width:this._width,height:this._height}),this._backgroundColor&&this._renderBackground){const s=Un(this._backgroundColor);this._background.setAttribute("fill",s.color),this._background.setAttribute("fill-opacity",s.opacity)}const e=this._bufferList.getBuffersByAscendingDepth();this._clear(),this._svg.removeChild(this._container);for(let s=0;s<e.length;++s){const i=e[s];this._isBufferDisplayable(i)&&this._displayBuffer(i)}this._svg.appendChild(this._container)}_clear(){this._container&&this._svg.removeChild(this._container),this._container=ie("g"),this._svg.appendChild(this._container),this._clipPaths&&this._defs.removeChild(this._clipPaths),this._clipPaths=ie("g"),this._defs.appendChild(this._clipPaths),this._clipPaths.setAttribute("class","clip-paths"),this._filters&&this._defs.removeChild(this._filters),this._filters=ie("g"),this._defs.appendChild(this._filters)}_displayElement(t,e){this._currentElementId=t.id>=0?`n${t.id}`:"e"+-t.id,super._displayElement(t,e)}_addBackgroundBlendingFilter(t){const e=es(this._backgroundColor),s=t,i=1-t,n=[s,0,0,0,e[0]*i,0,s,0,0,e[1]*i,0,0,s,0,e[2]*i,0,0,0,1,0].join(" "),r=`filter-${this._currentElementId}`,o=ie("filter",{id:r}),a=ie("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:n});return o.appendChild(a),this._filters.appendChild(o),r}_drawRoundedRectangle(t,e,s,i,n){const r=t.x,o=t.y,a=Math.min(this._textManager.getCornerRadius(),s);e+=a/2;const l=ie("path"),d=`M ${r+e-a} ${o+s}     A ${a} ${a} 0 0 0 ${r+e} ${o+s-a}     L ${r+e} ${o-s+a}     A ${a} ${a} 0 0 0 ${r+e-a} ${o-s}     L ${r-e+a} ${o-s}     A ${a} ${a} 0 0 0 ${r-e} ${o-s+a}     L ${r-e} ${o+s-a}     A ${a} ${a} 0 0 0 ${r-e+a} ${o+s}     L ${r+e-a} ${o+s}`;l.setAttribute("d",d),l.setAttribute("fill",Tr),l.setAttribute("transform",`rotate(${Ch(i)} ${t.x} ${t.y})`),l.setAttribute(Ps,this._currentElementId),this._container.appendChild(l),this._element=l,n&&this._fill(n)}_drawCircle(t,e){const{x:s,y:i}=t,n=`M ${s-e}, ${i} a ${e},${e} 0 1,0 ${2*e},0 a ${e},${e} 0 1,0 -${2*e},0`,r=ie("path");r.setAttribute("d",n),r.setAttribute("fill",Tr),r.setAttribute(Ps,this._currentElementId),this._container.appendChild(r),this._element=r}_drawPolygon(t,e){const s=ie("path");let i="";for(let n=0;n<t.length;n++){const{x:r,y:o}=t[n];i+=`${n===0?"M":"L"}${r},${o} `}i+="Z",s.setAttribute("d",i),s.setAttribute(Ps,this._currentElementId),s.setAttribute("fill",Tr),e&&s.setAttribute(vf,!0),this._container.appendChild(s),this._element=s}_drawStraightLine(t,e){const s=ie("path"),i=`M ${t.x},${t.y} L${e.x},${e.y}`;s.setAttribute("d",i),s.setAttribute(Ps,this._currentElementId),this._container.appendChild(s),this._element=s}_drawQuadraticCurve(t,e,s){const i=ie("path"),n=`M ${t.x},${t.y} Q${e.x},${e.y} ${s.x},${s.y}`;i.setAttribute("d",n),i.setAttribute("fill",Tr),i.setAttribute(Ps,this._currentElementId),this._container.appendChild(i),this._element=i}_drawCubicCurve(t,e,s,i){const n=ie("path"),r=`M ${t.x},${t.y} C${e.x},${e.y} ${s.x},${s.y} ${i.x},${i.y}`;n.setAttribute("d",r),n.setAttribute("fill",Tr),n.setAttribute(Ps,this._currentElementId),this._container.appendChild(n),this._element=n}_fill(t){const e=Un(t);this._element.setAttribute("fill",e.color),this._element.setAttribute("fill-opacity",e.opacity),this._currentClipPathId&&this._element.setAttribute("clip-path",`url(#${this._currentClipPathId})`)}_stroke(t,e,s=[]){if(e===0)return;const i=this._element;i.setAttribute("stroke-width",e);const n=Un(t);i.setAttribute("stroke",n.color),i.setAttribute("stroke-opacity",n.opacity),s.length>0&&i.setAttribute("stroke-dasharray",s.map(mn).toString())}_startClip(){const t=ie("clipPath"),e=this._element.cloneNode(!1);this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endClip(){this._currentClipPathId=null}_startReverseClip(){const t=ie("clipPath"),e=this._element.cloneNode(!1),s=e.getAttribute("d");e.setAttribute("clip-rule","evenodd"),e.setAttribute("d",`${s} M 0 0 L ${this._width} 0 L ${this._width} ${this._height} L 0 ${this._height}`),this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endReverseClip(){this._currentClipPathId=null}_displayText(t,e,s,i,n,r,o="normal",a,l,d,h,u){const c=ie("g");c.setAttribute(Ps,this._currentElementId),c.setAttribute(vf,!0);let g=this._currentElementId[0]==="n"?j1:H1;u&&(g+=" "+W1),c.setAttribute("class",g);const f=Un(i),m=f.opacity,_=Un(f.color),p=t.x+d*this._viewZoom,x=t.y+1+h*this._viewZoom,y=mn(p);c.setAttribute("font-family",n),c.setAttribute("font-size",r),o==="bold"?c.setAttribute("font-weight",o):c.setAttribute("font-style",o),c.setAttribute("fill",_.color),c.setAttribute("fill-opacity",m),e&&c.setAttribute("transform",`rotate(${Ch(-e)} ${p}, ${x})`),c.setAttribute("text-anchor",q1[a]||"middle"),c.setAttribute("dominant-baseline","middle");const b=s.split(`
`),v=b.length,E=mn(x-(v+1)/2*r),A=a==="center"?0:-l/2;for(let S=0;S<v;S++){const w=ie("text");w.appendChild(ku(b[S])),w.setAttribute("x",y+A),w.setAttribute("y",E+(S+1)*r),c.appendChild(w)}this._currentClipPathId&&c.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(c)}_displayImage(t,e,s,i,n,r,o){const a=t.x,l=t.y;if(this._hideImages||!("isDummy"in i)&&(!i.width||!i.height))return;const d=e,h=s;let u,c=i.width,g=i.height;if(n&&(c=d,g=h),r){const f=a-d/2,m=l-h/2,_=a+d/2,p=l+h/2;let x=a-c/2,y=l-g/2;for(u=ie("g"),u.setAttribute(Ps,this._currentElementId);x>f;)x-=c;for(;y>m;)y-=g;const b=y;for(;x<_;){for(;y<p;)Ef(i.src,x,y,c,g,u),y+=g;y=b,x+=c}}else u=Ef(i.src,a-c/2,l-g/2,c,g),u.setAttribute(Ps,this._currentElementId);if(this._currentClipPathId&&u.setAttribute("clip-path",`url(#${this._currentClipPathId})`),o!==1){const f=this._addBackgroundBlendingFilter(o);u.setAttribute("filter",`url(#${f})`)}this._container.appendChild(u)}_displayPieChart(t,e,s){const i=2*e,n=2*i,r=t.x,o=t.y;let a;const l=ie("g");l.setAttribute(Ps,this._currentElementId),s.length===1&&(a=X1(r-i,o-i,n,n,s[0],1,l)),s.length>1&&Dx(s,(d,h,u)=>{const c=r+e*Math.cos(u),g=o+e*Math.sin(u),f=r+e*Math.cos(h),m=o+e*Math.sin(h),_=u-h<=Math.PI?0:1,p=`M ${c},${g} A ${e},${e} 0 ${_} 0 ${f},${m} L ${r},${o} L ${c},${g}`;a=ie("path"),a.setAttribute("d",p),a.setAttribute("fill",d),a.setAttribute("stroke-width",0),l.appendChild(a)}),this._currentClipPathId&&l.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(l)}},$1=6,Z1=class{constructor({gl:t,ext:e,staticProgram:s,animationProgram:i}){this._version=0,this._used=!1,this._dataBufferChanged=!1,this._gl=t,this._ext=e,this._staticProgram=s,this._animationProgram=i,this._glBuffer=this._gl.createBuffer()}setDataBuffer(t){this._dataBuffer!==t&&(this._program=t.animated?this._animationProgram:this._staticProgram,this._dataBuffer=t,this._dataBufferChanged=!0,t.hasSideData()&&!this._sideGlBuffer?this._sideGlBuffer=this._gl.createBuffer():!t.hasSideData()&&this._sideGlBuffer&&(this._gl.deleteBuffer(this._sideGlBuffer),delete this._sideGlBuffer))}setPrograms(t,e){this._staticProgram=t,this._animationProgram=e}markAsUnused(){return this._used=!1,this}getProgram(){return this._program}markAsUsed(){return this._used=!0,this}isUsed(){return this._used}draw(){const t=this._gl,e=this._dataBuffer.type,s=e===yn,i=s?this._dataBuffer.getNbSideElementsPerMainElement():1,n=e===xl?ms:1,r=this._dataBuffer.getSize(),o=this._dataBuffer.stencilUsage,a=this._dataBuffer.version,l=this._version!==a||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:l?this._dataBuffer.getByteArray():null,divisor:i}),this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:l&&s?this._dataBuffer.getSideByteArray():null,divisor:1}),this._program.setupStencil(o),l&&(this._version=a,this._dataBufferChanged=!1),this._ext.drawArraysInstancedANGLE(t.TRIANGLES,0,$1*n,r*i)}destroy(){this._gl.deleteBuffer(this._glBuffer),this._sideGlBuffer&&this._gl.deleteBuffer(this._sideGlBuffer)}},K1={byte:1,ubyte:1,short:2,ushort:2,ulong:4,float:4},Q1={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",ulong:"UNSIGNED_LONG",float:"FLOAT"},Af=class{constructor({gl:t,ext:e,specialGlBuffers:s,metaData:i,programWrapper:n}){this._stencilUsage=Jn,this._gl=t,this._ext=e,this._specialGlBuffers=s,this._metaData=Ae(i),this._programWrapper=n}_finishInit(){const t=this._gl,e=this._ext,s=this._programWrapper.getError();if(s)throw new Error(`WebGL compilation at step "${s.step}:
${s.message}"`);const i=this._programWrapper.getProgram();this._program=i,t.useProgram(i),this._metaData.attributes.forEach(o=>{o.location=t.getAttribLocation(this._program,o.name),o.byteSize=o.size*K1[o.type],o.glType=Q1[o.type]}),this._specialAttributes=this._createSpecialAttributesFunctions();const n=[],r=[];for(const o of this._metaData.attributes)o.location!==-1&&(o.name.startsWith("a_text")?r.push(o):n.push(o));this._baseAttributes=Cd(n,t,e),this._textAttributes=Cd(r,t,e),this._setupUniforms=t2(this._metaData.uniforms,t,i)}_createSpecialAttributesFunctions(){return Cd([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3,type:"byte",name:"special"}],this._gl,this._ext)}startPass(t){this._program||this._finishInit(),this._gl.useProgram(this._program),this._resetStencil(),this._setupUniforms(this._gl,t),this._specialAttributes.enable(this._gl),this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)}_setupAttributes(t,{glBuffer:e,dataBuffer:s,divisor:i}){t.enabled&&!e?t.disable(this._gl):!t.enabled&&e&&t.enable(this._gl),e&&t.setup(e,s,i)}setupBaseAttributes(t){this._setupAttributes(this._baseAttributes,t)}setupTextAttributes(t){this._setupAttributes(this._textAttributes,t)}_resetStencil(){const t=this._gl;this._stencilUsage=Jn,t.disable(t.STENCIL_TEST)}setupStencil(t){if(t!==this._stencilUsage){const e=this._gl;t!==Jn?(e.enable(e.STENCIL_TEST),t===rx?(e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilFunc(e.ALWAYS,1,1)):t===ox&&(e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilFunc(e.EQUAL,0,1))):e.disable(e.STENCIL_TEST),this._stencilUsage=t}}endPass(){const t=this._gl;this._specialAttributes.disable(t),this._baseAttributes.disable(t),this._textAttributes.disable(t)}};function J1(t,e,s){return(i,n,r)=>{let o=0,a=0;for(let l=0;l<t.length;l++)a+=t[l].byteSize;e.bindBuffer(e.ARRAY_BUFFER,i),n&&e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);for(let l=0;l<t.length;l++){const{location:d,size:h,glType:u,byteSize:c}=t[l];e.vertexAttribPointer(d,h,e[u],!1,a,o),o+=c,s.vertexAttribDivisorANGLE(d,r)}}}function t2(t,e,s){const i={};for(let n=0;n<t.length;++n){const{id:r,name:o}=t[n],a=e.getUniformLocation(s,o);a&&(i[r]=a)}return(n,r)=>{for(let o=0;o<t.length;++o){const{id:a,type:l}=t[o],d=i[a],h=r[a];if(d)switch(l){case"int":case"sampler2D":n.uniform1i(d,h);break;case"float":n.uniform1f(d,h);break;case"vec2":n.uniform2f(d,h[0],h[1]);break;case"vec3":n.uniform3f(d,h[0],h[1],h[2]);break;case"vec4":n.uniform4f(d,h[0],h[1],h[2],h[3])}}}}function e2(t){return e=>{for(let s=0;s<t.length;s++){const i=t[s].location;e.enableVertexAttribArray(i)}}}function s2(t){return e=>{for(let s=0;s<t.length;++s){const i=t[s].location;e.disableVertexAttribArray(i)}}}function Cd(t,e,s){const i=e2(t),n=s2(t);return{enable(r){i(r),this.enabled=!0},disable(r){n(r),this.enabled=!1},setup:J1(t,e,s),enabled:!1}}var Ld=`#define D3D9_FIX 0
precision highp float;
precision mediump int;
uniform vec3 u_backgroundColor;
uniform sampler2D u_patternNearestTexture;
uniform sampler2D u_patternLinearTexture;
uniform sampler2D u_patternLinearSdfTexture;
uniform sampler2D u_patternMipmapTexture;
uniform sampler2D u_shapeTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying vec4 f;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SDF_GAMMA = 0.0;
const float EPSILON = 0.000000001;
const float SDF_BUFFER = (256.0 - 64.0) / 256.0; 
vec4 af(in vec4 ag, in vec4 ah) {
float ai = ah.a;
float aj = ag.a + EPSILON;
float ak = min(ai + aj, 1.0);
float r = ai / ak;
return vec4(mix(ag.rgb, ah.rgb, r), ak);
}
float al(in float am, in float an) {
float ao = (am * 256.0 + an) * 256.0;
float ap = ao / 32768.0;
return ap * 2.0 - 1.0;
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
float at(float au) {
float bh = 2.;
vec2 bi = abs(c.rg) - c.ba - vec2(bh) + vec2(au);
float bj = min(max(bi.x, bi.y), 0.0) + length(max(bi, 0.0)) - au;
return smoothstep(0.1, .5, (1. - bj) / 10.);
}
void main() {
#if D3D9_FIX
#else
float br = o.x;
float bs = o.y;
float bt = r.x;
float bu = r.y;
#endif
vec4 bx = texture2D(u_shapeTexture, d);
float by = al(bx.b, bx.a) * s.x;
float bz = al(bx.r, bx.g) * s.y;
float ch = float(f.z > EPSILON);
float ci = float(f.w > EPSILON);
float cj = 1. - smoothstep(
0.01,
0.25760,
distance(f.xy * f.z - vec2(0.0586), d * f.z)
);
cj = cj * 2.5 - 1.5;
cj *= 0.5;
cj *= s.x;
float ck = at(g) ;
vec4 cl = a;
vec4 cm = b;
if (u > -EPSILON) {
vec2 cq = e;
float dd =
step(m.x, cq.x) *
step(cq.x, n.x) *
step(m.y, cq.y) *
step(cq.y, n.y);
float de = dd;
vec4 dh;
if (aq(u, FILTER_NEAREST)) {
dh = texture2D(u_patternNearestTexture, cq);
} else if (aq(u, FILTER_LINEAR)) { 
dh = texture2D(u_patternLinearTexture, cq);
} else if (aq(u, FILTER_LINEAR_SDF)) { 
dh = texture2D(u_patternLinearSdfTexture, cq);
dh.a = smoothstep(SDF_BUFFER - t, SDF_BUFFER + t, dh.a);
} else if (aq(u, FILTER_MIPMAP)) { 
dh = texture2D(u_patternMipmapTexture, cq);
}
dh.rgb += c.rgb;
dh.a *= de;
cl = af(cl, dh);
}
float dw = (1. - ch) * min(by, bz)
+ ch * cj;
dw = (1. - ci) * dw + ci * ck;
float ek = clamp(dw, 0.0, 1.0);
float en = clamp(dw - l, 0.0, 1.0);
float eo = ek - en;
eo = 1.0 - clamp(dw - l, 0.0, 1.0);
cl.a *= en;
cm.a *= eo * step(EPSILON, l);
vec4 ew = af(cl, cm);
float ex = ek;
ew.rgb = mix(u_backgroundColor, ew.rgb, br);
if (q > EPSILON) {
float fk = fract(bu) * q;
float fl = clamp(min(fk, bt - fk), 0.0, 1.0);
ex *= fl;
}
if (p < 0.0 || p > 1.0 || ex < EPSILON) {
discard;
}
ew.a *= ex;
ew.rgb *= ew.a;
gl_FragColor = ew;
}
`,Nd=`#define D3D9_FIX 0
#define ANIMATED 0
precision highp float;
precision mediump int;
attribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_final_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_prev_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*float*/ vec2 a_animationBeginTime_animationDuration; 
attribute /*ushort*/ vec4 a_animationEasing; 
attribute /*ushort*/ vec3 a_text_charId_charOffsetXY; 
attribute vec3 a_vertexInfo;
uniform float u_viewWidth;
uniform float u_viewHeight;
uniform float u_viewX;
uniform float u_viewY;
uniform float u_viewAngle;
uniform float u_viewZoom;
uniform float u_currentTime;
uniform float u_pixelRatio;
uniform sampler2D u_patternInfoTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
varying vec4 f;
const float EPSILON = 0.000001;
const float INFINITY = 10000000.0;
const float PI = 3.14159265359;
const float P2_17 = 131072.0;
const float P2_16 = 65536.0;
const float P2_14 = 32768.0;
const float P2_12 = 4096.0;
const float P2_8 = 256.0;
const float P2_7 = 128.0;
const float P2_6 = 64.0;
const float P2_5 = 32.0;
const float P2_4 = 16.0;
const float P2_3 = 8.0;
const float P2_2 = 4.0;
const float P2_1 = 2.0;
const float MAX_FLOAT16_OFFSET = 16384.0;
const float MAX_FLOAT16 = 65535.0;
const float MAX_PROGRESS = 1.0;
uniform float BYTES_TO_COORD;
uniform float BYTES_TO_SCALED_SIZE;
uniform float BYTES_TO_MIN_VISIBLE_SIZE;
uniform float BYTES_TO_SYMBOLIC_SIZE;
uniform float BYTES_TO_CURVATURE;
uniform float BYTES_TO_DASH_LENGTH;
uniform float BYTES_TO_GAP_LENGTH;
uniform float BYTES_TO_PATTERN_SCALE;
uniform float PATTERN_POSITION_UNIT_SIZE;
uniform float PATTERN_INFO_TEXTURE_SIZE;
uniform float PATTERN_NEAREST_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;
uniform float PATTERN_MIPMAP_TEXTURE_SIZE;
uniform float ROUNDED_BOX_RADIUS;
const float BYTES_TO_OFFSET_ANGLE = 0.0;
const float BYTES_TO_COLOR = 0.0;
const float SDF_FONT_SIZE = 0.0;
const float SDF_GAMMA = 0.0;
const float CURVATURE_RATIO = 0.0;
const float PATTERN_PADDING = 0.0;
const float TEXT_WIDTH_MULTIPLIER = 0.0;
const float TEXT_HEIGHT_MULTIPLIER = 0.0;
const float SELF_LOOP_CURVATURE_RATIO = 0.0;
const float EDGE_ARROW_SIZE_RATIO = 0.0;
const float EDGE_MIN_TIP_SIZE = 0.0;
const float CURVE_SUBDIVISIONS = 0.0;
const float PIECE_NODE_COMPONENT = 0.0;
const float PIECE_TEXT_BOX = 0.0;
const float PIECE_EDGE_BODY = 0.0;
const float PIECE_EDGE_HEAD = 0.0;
const float PIECE_EDGE_TAIL = 0.0;
const float PIECE_EDGE_TEXT = 0.0;
const float MAX_TEXT_SIZE = 0.0;
const float BYTES_TO_TEXT_OFFSET_X = 0.0;
const float BYTES_TO_TEXT_OFFSET_Y = 0.0;
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SHAPE_TEXTURE_SIZE = 0.0;
const float SIMPLE_SHAPE_SAMPLING_SIZE = 0.0;
const float COMPLEX_SHAPE_SAMPLING_SIZE = 0.0;
const float SHAPE_SAMPLING_BUFFER_RATIO = 0.0;
const float MAX_SHAPES = 0.0;
const float FIRST_COMPLEX_SHAPE_ID = 0.0;
const float SELF_LOOP_TO_CIRCLE_APPROX = 0.0;
const float NB_SHAPES_BY_SIDE = SHAPE_TEXTURE_SIZE / COMPLEX_SHAPE_SAMPLING_SIZE;
const float SHAPE_FILL_PERCENT = 1.0 - SHAPE_SAMPLING_BUFFER_RATIO;
const float T_STEP_PER_CURVE_PIECE = 1.0 / CURVE_SUBDIVISIONS;
const float HEAD_TAIL_PX_ADJUST = 1.5;
const float SDF_SMOOTH_FACTOR = 2.0;
struct pv {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
};
struct qe {
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
};
struct qm {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
float dc;
float qn;
float qo;
float qp;
float qq;
float qr;
float qs;
vec4 cl;
vec4 cm;
vec4 dh;
float qt;
float qu;
float qv;
float qw;
float qx;
float qy;
float qz;
float ra;
float rb;
float rc;
float rd;
float re;
float rf;
float rg;
float rh;
float ri;
float rj;
float rk;
float rl;
};
struct rm {
float eu;
vec2 rn;
vec4 cl;
vec4 cm;
float dc;
float ro;
float rp;
float py;
float rq;
vec2 rr;
float rs;
vec2 cq;
vec2 rt;
vec2 ru;
float rv;
float rw;
vec4 dh;
vec2 bd;
float rx;
float or;
vec2 ry;
vec2 rz;
vec2 sa;
};
float sb(float nq, float sc, float sd) {
float se = mod(nq, pow(2.0, sd));
return floor(se / pow(2.0, sc));
}
pv sf(float nq) {
pv sg;
sg.pw = sb(nq, 0.0, 4.0);
sg.px = sb(nq, 4.0, 8.0);
sg.py = sb(nq, 8.0, 10.0);
sg.pz = sb(nq, 10.0, 12.0);
sg.qa = sb(nq, 12.0, 13.0);
sg.qb = sb(nq, 13.0, 14.0);
sg.qc = sb(nq, 14.0, 15.0);
sg.qd = sb(nq, 15.0, 16.0);
return sg;
}
qe sh(float nq) {
qe sg;
sg.qf = sb(nq, 0.0, 8.0);
sg.qg = sb(nq, 8.0, 11.0);
sg.qh = sb(nq, 11.0, 12.0);
sg.qi = sb(nq, 12.0, 13.0);
sg.qj = sb(nq, 13.0, 14.0);
sg.qk = sb(nq, 14.0, 15.0);
sg.ql = sb(nq, 15.0, 16.0);
return sg;
}
float si(float ll) {
float sj = mod(floor(ll / 32768.0), 2.0) == 1.0 ? -1.0 : 1.0; 
float sl = mod(floor(ll / 1024.0), 32.0); 
float sn = mod(ll, 1024.0); 
float sq = float(sl == 0.0 || sl == 31.0);
return (1. - sq)
* sj * pow(2.0, sl - 15.0) * (1.0 + sn / 1024.0);
}
vec4 sr(in float nq) {
return vec4(
sb(nq, 0.0, 4.0),
sb(nq, 4.0, 8.0),
sb(nq, 8.0, 12.0),
sb(nq, 12.0, 16.0)
);
}
vec2 ss(in float nq) {
return vec2(mod(nq, 256.0), floor(nq / 256.0));
}
vec2 st(in float nq) {
float su = floor(nq / P2_6);
float sv = nq - (su * P2_6);
return vec2(su, sv);
}
vec2 sw(in float nq) {
float sx = floor(nq / P2_7);
float sy = nq - (sx * P2_7);
return vec2(sx, sy);
}
vec2 sz(in vec2 ta, in float tb) {
float tc = cos(tb);
float td = sin(tb);
return vec2(tc * ta.x + td * ta.y, -td * ta.x + tc * ta.y);
}
vec4 te(in vec4 tf) {
return floor(tf / 256.0) - 128.0;
}
vec4 tg(in vec4 tf) {
return mod(tf, 256.0) - 128.0;
}
float th(float nq) {
return nq - 128.0;
}
vec2 th(vec2 nq) {
return nq - 128.0;
}
vec2 ti(vec2 tj) {
return vec2(-tj.y, tj.x);
}
vec2 tk(vec2 tl, vec2 ih, vec2 tm, float t) {
float tn = 1.0 - t;
return (tn * tn * tl) + (2.0 * tn * t * ih) + (t * t * tm);
}
vec2 to(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
float tn = 1.0 - t;
float tr = tn * tn;
float ts = tr * tn;
float tt = t * t;
float tu = tt * t;
return (ts * tl) + (3.0 * tr * t * tp) + (3.0 * tn * tt * tq) + (tu * tm);
}
vec2 tv(vec2 tl, vec2 ih, vec2 tm, float t) {
float tn = (1.0 - t);
vec2 ta = (tn * ih + t * tm) - (tn * tl + t * ih);
return normalize(ta);
}
vec2 tw(vec2 tl, vec2 ih, vec2 tm, float t) {
return ti(tv(tl, ih, tm, t));
}
vec2 tx(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
float tn = 1.0 - t;
float tr = tn * tn;
float tt = t * t;
vec2 ta = tr * (tp - tl) + 2.0 * tn * t * (tq - tp) + tt * (tm - tq);
return normalize(ta);
}
vec2 ty(vec2 tl, vec2 tp, vec2 tq, vec2 tm, float t) {
return ti(tx(tl, tp, tq, tm, t));
}
float uj(float qr, float uk, float t) {
float y = abs(qr) / CURVATURE_RATIO + EPSILON;
float qw = y * y;
float tn = t - 0.5;
float tr = tn * tn;
float ul = 1.0 / (16.0 * qw);
float um = sqrt(tr + ul);
float un = (0.5 / y) * sqrt(qw + 0.25);
float uo = (abs(2.0 * y)) * ((tn * um) + (0.5 * un) + (ul * log(abs((tn + um) / (-0.5 + un)))));
return uo * uk;
}
float uz(vec2 va, vec2 vb, vec2 vc, vec2 vd) {
bool vk = abs(va.x - vb.x - vc.x + vd.x) + abs(va.y - vb.y - vc.y + vd.y) < EPSILON;
float vl = 9.0 * pow(vb.x - va.x, 2.0); 
float vo = pow(-243.0 * va.x + 189.0 * vb.x + 51.0 * vc.x + 3.0 * vd.x, 2.0) / 10000.0; 
float vp = pow(-48.0 * va.x + 24.0 * vb.x + 21.0 * vc.x + 3.0 * vd.x, 2.0) / 625.0; 
float vq = pow(-147.0 * va.x + 21.0 * vb.x + 99.0 * vc.x + 27.0 * vd.x, 2.0) / 10000.0; 
float vr = pow(-27.0 * va.x - 9.0 * vb.x + 24.0 * vc.x + 12.0 * vd.x, 2.0) / 625.0; 
float vs = (9.0 / 16.0) * pow(vc.x + vd.x - va.x - vb.x, 2.0); 
float vt = 9.0 * pow(vb.y - va.y, 2.0); 
float vv = pow(-243.0 * va.y + 189.0 * vb.y + 51.0 * vc.y + 3.0 * vd.y, 2.0) / 10000.0; 
float vw = pow(-48.0 * va.y + 24.0 * vb.y + 21.0 * vc.y + 3.0 * vd.y, 2.0) / 625.0; 
float vx = pow(-147.0 * va.y + 21.0 * vb.y + 99.0 * vc.y + 27.0 * vd.y, 2.0) / 10000.0; 
float vy = pow(-27.0 * va.y - 9.0 * vb.y + 24.0 * vc.y + 12.0 * vd.y, 2.0) / 625.0; 
float vz = (9.0 / 16.0) * pow(vc.y + vd.y - va.y - vb.y, 2.0); 
float wa = sqrt(vl + vt); 
float wc = sqrt(vo + vv); 
float wd = sqrt(vp + vw); 
float we = sqrt(vq + vx); 
float wf = sqrt(vr + vy); 
float wg = sqrt(vs + vz); 
if(vk)
return (5.0 / 2993760.0) * 
(32134.0 * wa + 
212600.0 * wc - 
97050.0 * wd + 
544800.0 * we - 
521100.0 * wf + 
427368.0 * wg);
float wh = pow(-12.0 * va.x - 24.0 * vb.x + 9.0 * vc.x + 27.0 * vd.x, 2.0) / 625.0; 
float wi = pow(-27.0 * va.x - 99.0 * vb.x - 21.0 * vc.x + 147.0 * vd.x, 2.0) / 10000.0; 
float wj = pow(-3.0 * va.x - 21.0 * vb.x - 24.0 * vc.x + 48.0 * vd.x, 2.0) / 625.0; 
float wk = pow(-3.0 * va.x - 51.0 * vb.x - 189.0 * vc.x + 243.0 * vd.x, 2.0) / 10000.0; 
float wl = 9.0 * pow(vd.x - vc.x, 2.0); 
float wm = pow(-12.0 * va.y - 24.0 * vb.y + 9.0 * vc.y + 27.0 * vd.y, 2.0) / 625.0; 
float wn = pow(-27.0 * va.y - 99.0 * vb.y - 21.0 * vc.y + 147.0 * vd.y, 2.0) / 10000.0; 
float wo = pow(-3.0 * va.y - 21.0 * vb.y - 24.0 * vc.y + 48.0 * vd.y, 2.0) / 625.0; 
float wp = pow(-3.0 * va.y - 51.0 * vb.y - 189.0 * vc.y + 243.0 * vd.y, 2.0) / 10000.0; 
float wq = 9.0 * pow(vd.y - vc.y, 2.0); 
float wr = sqrt(wh + wm); 
float ws = sqrt(wi + wn); 
float wt = sqrt(wj + wo); 
float wu = sqrt(wk + wp); 
float wv = sqrt(wl + wq); 
return (5.0 / 2993760.0) * 
(16067.0 * (wa + wv) + 
106300.0 * (wc + wu) - 
48525.0 * (wd + wt) + 
272400.0 * (we + ws) - 
260550.0 * (wf + wr) + 
427368.0 * wg);
}
float ww(float nq) {
return nq - 32.0;
}
float wx(float nq) {
return nq - 512.0;
}
float wy(float nq) {
return nq - P2_14;
}
void wz() {
gl_Position = vec4(-10.0, -10.0, 1.0, 1.0);
}
vec4 xa(vec2 xb) {
return vec4(((vec2(xb.x, u_viewHeight - xb.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);
}
float xf(float ar, float as) {
return step(ar - EPSILON, as) * step(as, ar + EPSILON);
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
bool xg(float nq) {
return nq > 0.5;
}
vec2 xh(vec2 xi) {
return sz((xi - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;
}
float xj(float or) {
return max(EDGE_MIN_TIP_SIZE, or * EDGE_ARROW_SIZE_RATIO);
}
float xk(float xl, float xm) {
return xl * BYTES_TO_SCALED_SIZE * u_viewZoom + xm;
}
float xn(float xl, float xm) {
return xl * BYTES_TO_SCALED_SIZE * MAX_FLOAT16 / MAX_FLOAT16_OFFSET * u_viewZoom + xm;
}
float xt(float ro, float xr, float xs) {
float xu = xs - xr;
float a = 1.0 / xu;
float b = -xr / xu;
return ro * a + b;
}
struct xv {
vec2 vb;
vec2 vc;
};
xv xw(vec2 xx, float au, float qr) {
xv ns;
float xy = (au + au / SELF_LOOP_CURVATURE_RATIO * qr) * SELF_LOOP_CURVATURE_RATIO;
float xz = -u_viewAngle + PI;
float ya = -u_viewAngle + PI / 2.0;
ns.vb = xx + vec2(cos(xz), sin(xz)) * xy;
ns.vc = xx + vec2(cos(ya), sin(ya)) * xy;
return ns;
}
float yb(vec2 yc, vec2 yd, vec2 ye, vec2 yf, float yg) {
const int MAX_ITERATIONS = 10; 
const float EPSILON = 0.01; 
float yn = 0.0;
float cf = 1.0;
float yo = 0.0;
for (int yp = 0; yp < MAX_ITERATIONS; yp++) {
float yq = (yn + cf) * 0.5;
vec2 yr = to(yc, yd, ye, yf, yq);
float ys = distance(yc, yr);
if (abs(ys - yg) < EPSILON) {
return yq;
}
if (ys < yg) {
yn = yq;
yo = yq;
} else {
cf = yq;
}
}
return yo;
}
float yz(vec2 yc, vec2 yd, vec2 ye, vec2 yf, float yg, bool za) {
if (!za) {
return 1.0 - yb(yf, ye, yd, yc, yg);
}
return yb(yc, yd, ye, yf, yg);
}
qm zd(
vec4 ze,
vec4 zf,
vec4 zg,
vec4 zh,
vec4 zi,
vec4 zj,
vec3 zk
) {
qm a;
pv bx = sf(ze.x);
qe zl = sh(ze.y);
vec4 zm = sr(ze.z);
vec2 zn = ss(ze.w);
a.pw = bx.pw;
a.px = bx.px;
a.py = bx.py;
a.pz = bx.pz;
a.qa = bx.qa;
a.qb = bx.qb;
a.qc = bx.qc;
a.qd = bx.qd;
a.qf = zl.qf;
a.qg = zl.qg;
a.qh = zl.qh;
a.qi = zl.qi;
a.qj = zl.qj;
a.qk = zl.qk;
a.ql = zl.ql;
a.dc = zm.x;
a.qn = zm.y;
a.qo = zm.z;
a.qp = zm.w;
a.qq = zn.x;
a.qr = zn.y;
a.qs = zf.x;
a.cl = sr(zf.y);
a.cm = sr(zf.z);
a.dh = sr(zf.w);
a.qt = zg.x;
a.qu = zg.y;
a.qv = zg.z;
a.qw = zg.w;
a.qx = si(zh.x);
a.qy = zh.y;
a.qz = si(zh.z);
a.ra = zh.w;
a.rb = zi.x;
a.rc = zi.y;
a.rd = zi.z;
a.re = zi.w;
a.rf = zj.x;
a.rg = wy(zj.y);
a.rk = wy(zj.z);
a.rl = wy(zj.w);
a.rh = zk.x;
float x = zk.y;
float y = mod(x, P2_8);
if (zk.z > 0.0) x += zk.z * P2_16;
a.ri = ((x - y) / P2_8) - P2_16;
a.rj = (y - P2_7) * BYTES_TO_TEXT_OFFSET_Y;
return a;
}
bool aaq(const in qm a, out rm ns) {
float pw = a.pw;
float px = a.px;
float py = a.py * BYTES_TO_DASH_LENGTH;
float pz = a.pz * BYTES_TO_GAP_LENGTH;
float qa = a.qa;
float qb = a.qb;
float qc = a.qc;
float qd = a.qd;
float qf = a.qf * BYTES_TO_PATTERN_SCALE;
float qg = a.qg * BYTES_TO_OFFSET_ANGLE;
float qh = a.qh;
float qi = a.qi;
float qj = a.qj;
float qk = a.qk;
float ql = a.ql;
float dc = a.dc * BYTES_TO_COLOR;
float qn = a.qn * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qo = a.qo * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qp = a.qp * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qq = a.qq * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom + step(a.qq, EPSILON) * INFINITY;
float qr = th(a.qr);
float qs = a.qs;
vec4 cl = a.cl * BYTES_TO_COLOR;
vec4 cm = a.cm * BYTES_TO_COLOR;
vec4 dh = a.dh * BYTES_TO_COLOR;
vec2 aar = vec2(a.qt, a.qu) * BYTES_TO_COORD;
vec2 aas = vec2(a.qv, a.qw) * BYTES_TO_COORD;
vec2 yc = xh(aar);
vec2 yf = xh(aas);
float aat = xn(a.qx,a.qy);
float aau = xn(a.qz, a.ra);
float aav = xk(a.rb, a.rc);
float eu = xk(a.rd, a.re);
float zs = xk(a.rf, a.rg);
vec2 aaw = a_vertexInfo.xy;
vec2 aax = vec2(0.0, 0.0);
float aay = aat;
float aaz = aau;
float aba = aau * qf;
if (qh > EPSILON || dc< EPSILON) {
if (a.rh < EPSILON || dc< EPSILON) return false;
aba = aav;
qs = a.rh;
aat = aba * TEXT_WIDTH_MULTIPLIER * u_pixelRatio;
aau = aba * TEXT_HEIGHT_MULTIPLIER * u_pixelRatio;
}
bool abu = abs(qr) > EPSILON && xf(px, PIECE_EDGE_BODY) < EPSILON;
bool abv = abu && a_vertexInfo.z > EPSILON;
if (pw < EPSILON || px < EPSILON || qq < qn || abv) {
return false;
}
eu *= step(qo, qq);
float aci = 0.0;
float acj = 1.0;
float acf = 0.0;
float ach = 1.0;
float ack = 0.0;
float acu = 1.0;
float acw = 1.0;
float adg = 0.0;
float adh = 0.0;
vec2 bd;
vec2 ry;
vec2 rz;
vec2 sa;
float or;
float rx;
float ady = 0.0;
float adz = 1.0;
bool ci = xf(px, PIECE_TEXT_BOX) > EPSILON;
if (xf(px, PIECE_NODE_COMPONENT) > EPSILON || ci) {
bd = ceil((yc + yf) / 2.0);
if(length(aas - aar) > EPSILON){
ry = normalize(aas - aar) * vec2(1.,-1.);
}else{
ry = vec2(1.0, 0.0);
}
rz = ti(ry);
sa = rz;
or = aat;
rx = aau;
} else {
acw = 0.0;
float aep = distance(yc, yf);
vec2 aeq = normalize(yf - yc);
vec2 aer = (yc + yf) / 2.0;
vec2 aes = ti(aeq);
vec2 yd;
vec2 ye;
if (qk > EPSILON) {
vec2 aey = sz(yc, -u_viewAngle);
vec2 aez = sz(yf, -u_viewAngle);
float afc = 1. / (1. + exp(-qr));
if (ql > EPSILON) {
float afd = afc * aey.y + (1. - afc) * aez.y;
yd = vec2(aey.x, afd);
ye = vec2(aez.x, afd);
} else {
float afe = afc * aey.x + (1. - afc) * aez.x;
yd = vec2(afe, aey.y);
ye = vec2(afe, aez.y);
}
yd = sz(yd, u_viewAngle);
ye = sz(ye, u_viewAngle);
}
vec2 aff = aer + (aes * aep * -qr / CURVATURE_RATIO);
if (xf(px, PIECE_EDGE_TEXT) > 0.0
|| xf(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0
) {
ci = xf(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0;
float afg;
float afh = eu;
eu = 0.0;
if (qd > EPSILON) {
xv ih = xw(yc, afh / 2.0, qr);
bd = to(yc, ih.vb, ih.vc, yf, 0.5);
ry = tx(yc, ih.vb, ih.vc, yf, 0.5);
rz = ti(ry);
sa = rz;
afg = .5 * uz(yc, ih.vb, ih.vc, yf);
} else if (qk > EPSILON) {
bd = to(yc, yd, ye, yf, 0.5);
ry = tx(yc, yd, ye, yf, 0.5);
rz = ti(ry);
sa = rz;
afg = uz(yc, yd, ye, yf);
} else if (abs(qr) > EPSILON) {
bd = tk(yc, aff, yf, 0.5);
ry = tv(yc, aff, yf, 0.5);
rz = ti(ry);
sa = rz;
afg = uj(qr, aep, 1.0);
} else {
bd = aer;
ry = aeq;
rz = aes;
sa = aes;
afg = aep;
}
or = aat;
rx = aau;
if(aay > afg - afh && qd < EPSILON){
if(qi > EPSILON){
ry = vec2(1.0, 0.0);
rz = vec2(0.0, 1.0);
sa = vec2(0.0, 1.0);
} else {
ry = vec2(0,0);
rz = vec2(0.0, 0.0);
sa = vec2(0.0, 0.0);
}
} else {
float tb = -atan(ry.y, ry.x);
ady = tb;
qg -= tb;
if ((tb > PI / 2.0 || tb < -PI / 2.0)) {
qg += (1.0 - qd) * PI;
adz = -1.0;
ry *= -1.0;
rz *= -1.0;
sa *= -1.0;
}
}
} else {
float afo = aat;
float afp = aau;
float afq = xj(aav);
float afr = qa
* min(5. * afo, afq);
float afs = qb
* min(5. * afp, afq);
float aft = xf(px, PIECE_EDGE_HEAD);
float afu = xf(px, PIECE_EDGE_TAIL);
float afv = INFINITY * qd + aep - afo - afp;
float age = min(0., afv - afr - afs)/2.;
float agj = aav / 2.;
float agk =
afo > agj
? afo - sqrt(afo * afo - agj * agj)
: agj;
float agl = max( afo +
afs
+ qb * age,
0.) - (1. - qa) * agk;
agk =
afp > agj
? afp - sqrt(afp * afp - agj * agj)
: agj;
float agm = max( afp +
afr
+ qa * age
, 0.) - (1. - qb) * agk;
if(qk > EPSILON && qd < EPSILON) {
agl = afo + afs / 2.;
agm = afp + afr / 2.;
}
if (aft > EPSILON || afu > EPSILON) {
vec2 agr = aft * yf + afu * yc;
float zs = aft * agm + afu * agl + (HEAD_TAIL_PX_ADJUST - 0.5);
float ags = aft * afr + afu * afs;
vec2 agt;
if (qk > EPSILON && qd < EPSILON) {
float yg = aft > EPSILON ? agm : agl;
float t = yz(yc, yd, ye, yf, yg, afu > EPSILON);
agt = to(yc, yd, ye, yf, t);
ry = normalize(agt - to(yc, yd, ye, yf, t - 0.01));
if(afu > EPSILON) ry *= -1.;
bd = agt;
} else {
if (qd > EPSILON) {
xv ih = xw(yc, afo, qr);
float yg = aft * agm + afu * agl;
float t = yz(yc, ih.vb, ih.vc, yf, yg, afu > EPSILON);
agt = to(yc, ih.vb, ih.vc, yf, t);
} else {
float afg = uj(qr, aep, 1.0);
float t = (aft * (afg - agm) + afu * agl) / afg;
agt = tk(yc, aff, yf, t);
}
ry = normalize(agr - agt);
bd = agr - ry * (zs - ags / 2.0);
}
rz = ti(ry);
sa = rz;
or = ags;
rx = ags;
py = 0.0;
pz = 0.0;
} else {
float agx;
float agy;
float agz;
if(qk > EPSILON && qd < EPSILON) {
float aha = yz(yc, yd, ye, yf, agl, true);
float ahb = yz(yc, yd, ye, yf, agm, false);
float ahc = ahb - aha;
float ahd = a_vertexInfo.z;
float ahe = (aha + ahc * ahd * T_STEP_PER_CURVE_PIECE);
float tt = (aha + ahc * (ahd + 1.) * T_STEP_PER_CURVE_PIECE);
vec2 ahf = to(yc, yd, ye, yf, ahe);
vec2 ahg = to(yc, yd, ye, yf, tt);
bd = (ahf + ahg) / 2.0;
ry = normalize(ahg - ahf);
rz = ty(yc, yd, ye, yf, ahe);
sa = ty(yc, yd, ye, yf, tt);
or = distance(ahf, ahg);
agx = uz(yc, yd, ye, yf);
agy = agx * ahe;
agz = agx * tt;
} else {
if (abs(qr) < EPSILON) {
bd = aer;
ry = aeq;
rz = aes;
sa = rz;
or = aep;
agx = aep;
agy = 0.0;
agz = aep;
} else {
float ahd = a_vertexInfo.z;
float ahe = ahd * T_STEP_PER_CURVE_PIECE;
float tt = ahe + T_STEP_PER_CURVE_PIECE;
if (qd < EPSILON) {
vec2 ahf = tk(yc, aff, yf, ahe);
vec2 ahg = tk(yc, aff, yf, tt);
bd = (ahf + ahg) / 2.0;
ry = normalize(ahg - ahf);
rz = tw(yc, aff, yf, ahe);
sa = tw(yc, aff, yf, tt);
or = distance(ahf, ahg);
agx = uj(qr, aep, 1.0);
agy = uj(qr, aep, ahe);
agz = uj(qr, aep, tt);
} else {
xv ih = xw(yc, afo, qr);
vec2 yd = ih.vb;
vec2 ye = ih.vc;
vec2 ahf = to(yc, yd, ye, yf, ahe);
vec2 ahg = to(yc, yd, ye, yf, tt);
bd = (ahf + ahg) / 2.0;
ry = normalize(ahg - ahf);
rz = ty(yc, yd, ye, yf, ahe);
sa = ty(yc, yd, ye, yf, tt);
or = distance(ahf, ahg);
agx = uz(yc, yd, ye, yf);
agy = ahe * agx;
agz = tt * agx;
}
}
}
rx = aav;
if(qd > EPSILON) {
xv ih = xw(yc, afo, qr);
float ahk = yz(yc, ih.vb, ih.vc, yf, agl, true);
float ahb = yz(yc, ih.vb, ih.vc, yf, agm, false);
acf = ahk;
ach = ahb;
} else if(qk < EPSILON) {
acf = (agl - 1.0) / agx;
ach = MAX_PROGRESS - (agm - HEAD_TAIL_PX_ADJUST) / agx;
}
aci = agy / agx;
acj = agz / agx;
ack = agx;
if (aav < EPSILON)
cl.a = 0.; 
if (qc > 0.0 && afv > 5.0) {
float aho = (agx * rx) / (agx - agl);
float ahp = agx;
float qt = agl;
float qv = agx - agm;
float a = -aho / ahp;
float b = aho;
float qu = a * qt + b;
float qw = a * qv + b;
float ahq = qu / (qt - qv);
float bi = -ahq * qv;
rx = min(min(bi, afo), afp);;
adh = ahq * ahp + bi + 1.0;
}
}
}
}
vec2 cq = vec2(0.0, 0.0);
vec2 rt = vec2(EPSILON, EPSILON);
vec2 ru = vec2(-EPSILON, -EPSILON);
float rv = -1.0;
float rw = 0.0;
bool ahs = false;
vec2 aht = vec2(0,0);
vec2 ahu = vec2(0,0);
vec2 ahv = vec2(0,0);
if (qs > EPSILON && qq > qp) {
float ahy = floor(qs / PATTERN_INFO_TEXTURE_SIZE);
float ahz = qs - (ahy * PATTERN_INFO_TEXTURE_SIZE);
vec4 aia = texture2D(u_patternInfoTexture, vec2(ahz, ahy) / 255.0) * 255.0;
vec2 aib = sw(aia.z);
vec2 aic = sw(aia.w);
rv = aib.x * 2.0 + aic.x;
float aid = 0.0;
if (aq(rv, FILTER_NEAREST)) { 
aid = PATTERN_NEAREST_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR)) { 
aid = PATTERN_LINEAR_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR_SDF)) { 
aid = PATTERN_LINEAR_SDF_TEXTURE_SIZE;
ahs = true;
} else if (aq(rv, FILTER_MIPMAP)) { 
aid = PATTERN_MIPMAP_TEXTURE_SIZE;
}
float aig = 1.0 / aid;
vec2 aih = (vec2(aib.y, aic.y) * PATTERN_POSITION_UNIT_SIZE) * aig / 2.0;
ahu += (aia.xy * PATTERN_POSITION_UNIT_SIZE * aig) + aih;
aih -= PATTERN_PADDING * aig * 2.0;
vec2 aii = vec2(or / 2.0, rx / 2.0) * aig;
vec2 aij = vec2(eu, eu) * aig;
float ail = 1.0 * u_pixelRatio;
float aim = SDF_SMOOTH_FACTOR;
if (qf > EPSILON) {
if (ahs) { 
if (a.qj > EPSILON) {
aim = SDF_SMOOTH_FACTOR * u_pixelRatio / SDF_GAMMA;
aht = vec2(-a.rl,-a.rk);
}
rw = aim * SDF_GAMMA / aba / u_pixelRatio;
ail = SDF_FONT_SIZE / aba;
} else { 
ail = (aih.y / aii.y) / qf;
}
}
ahv = (aii + aij) * ail;
aih += PATTERN_PADDING * aig;
rt = ahu - aih;
ru = ahu + aih;
}
if (qh > EPSILON) {
aax.y = (a.rj) * aba;
acu = 0.0;
acw = 0.0;
aax.x = a.ri * aba * BYTES_TO_TEXT_OFFSET_X;
aax = sz(aax, ady);
aax *= adz;
}
vec2 air = vec2(cos(qg), sin(qg)) * zs;
vec2 ais = bd + air + aax;
float ait = eu * 2.0;
float aiu = or + acw * (ait + 1.0);
float aiv = rx + acu * (ait + 1.0);
vec2 aiw = ry * aiu / 2.0;
vec2 aix = rz * aiv / 2.0;
vec2 aiy = sa * aiv / 2.0;
float aiz = (acj - aci);
float aja = aaw.x / 2.0 + 0.5;
float ro = aci + aiz * aja;
float rs = adg + (adh - adg) * ro / 2.0;
float ajb = step(pw, FIRST_COMPLEX_SHAPE_ID - EPSILON);
float ajc = ajb * SIMPLE_SHAPE_SAMPLING_SIZE + (1.0 - ajb) * COMPLEX_SHAPE_SAMPLING_SIZE;
float ajd = ajc / COMPLEX_SHAPE_SAMPLING_SIZE;
float aje = ajd * SHAPE_SAMPLING_BUFFER_RATIO / 2.0;
float ajf = ajd * (1.0 - SHAPE_SAMPLING_BUFFER_RATIO);
vec2 ajm = vec2(
mod(pw, NB_SHAPES_BY_SIDE),
floor(pw / NB_SHAPES_BY_SIDE)
);
vec2 ajn = ajm + vec2(aje) +
vec2(aci * ajf, 0.0);
vec2 ajq = vec2(aiz, 1.0) * ajf;
vec2 rn = (ajn + ajq * (aaw / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE;
vec2 rr = vec2(aiu / aiz, aiv) / 2.0;
float ajw = py * aav;
float ajx = pz * aav;
float rp = ajw + ajx;
float rq = (ro * ack) / rp;
cq = ahu
+ ahv
* (aaw + aht / rr * u_viewZoom);
ns.rn = rn;
float ch = float(pw == 1.);
f = vec4(
(ajn + ajq * (vec2(0.5,0.5) / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE,
NB_SHAPES_BY_SIDE * (1. - qh) * ch,
float(ci)
);
ns.rr = rr;
ns.eu = eu;
ns.cl = cl;
ns.cm = cm;
ns.dc = dc;
ns.ro = xt(ro, acf, ach);
ns.rp = rp;
ns.py = ajw;
ns.rq = rq;
ns.rs = rs;
ns.cq = cq;
ns.rt = rt;
ns.ru = ru;
ns.rv = rv;
ns.rw = rw;
ns.dh = dh;
ns.bd = ais;
ns.or = aiu + ch;
ns.rx = aiv + ch;
ns.ry = ry;
ns.rz = rz;
ns.sa = sa;
return true;
}
float akc(float akd, float ake, vec4 akf) {
float akg = clamp(((u_currentTime - akd) / ake), 0.0, 1.0);
float r = akg;
float akh = r * r;
float aki = akh * r;
vec4 akj = akg < 0.5 ? te(akf) : tg(akf);
float akk = akj.x;
float akl = akj.y;
float akm = akj.z;
float akn = akj.w;
float ako = akk + akl * r + akm * akh + akn * aki;
return ako;
}
void main() {
qm a_final = zd(
a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_final_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_final_x1_y1_x2_y2,
a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
#if ANIMATED
float akd = a_animationBeginTime_animationDuration.x;
float ake = a_animationBeginTime_animationDuration.y;
vec4 akf = a_animationEasing;
float aap = akc(akd, ake, akf);
qm a_prev = zd(
a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_prev_x1_y1_x2_y2,
a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
const float ONE = 1.0;
a_final.pw = mix(a_prev.pw, a_final.pw, ONE);
a_final.py = mix(a_prev.py, a_final.py, aap);
a_final.pz = mix(a_prev.pz, a_final.pz, aap);
a_final.qa = mix(a_prev.qa, a_final.qa, ONE);
a_final.qb = mix(a_prev.qb, a_final.qb, ONE);
a_final.px = mix(a_prev.px, a_final.px, ONE);
a_final.qf = mix(a_prev.qf, a_final.qf, ONE);
a_final.qh = mix(a_prev.qh, a_final.qh, ONE);
a_final.qi = mix(a_prev.qi, a_final.qi, ONE);
a_final.qj = mix(a_prev.qj, a_final.qj, ONE);
a_final.qk = mix(a_prev.qk, a_final.qk, ONE);
a_final.qd = mix(a_prev.qd, a_final.qd, ONE);
a_final.qg = mix(a_prev.qg, a_final.qg, aap);
a_final.dc = mix(a_prev.dc, a_final.dc, aap);
a_final.qn = mix(a_prev.qn, a_final.qn, aap);
a_final.qo = mix(a_prev.qo, a_final.qo, aap);
a_final.qp = mix(a_prev.qp, a_final.qp, aap);
a_final.qq =mix(a_prev.qq, a_final.qq, aap);
a_final.qr = mix(a_prev.qr, a_final.qr, aap);
a_final.qs = mix(a_prev.qs, a_final.qs, ONE);
a_final.cl = mix(a_prev.cl, a_final.cl, aap);
a_final.cm = mix(a_prev.cm, a_final.cm, aap);
a_final.dh = mix(a_prev.dh, a_final.dh, aap);
a_final.qt = mix(a_prev.qt, a_final.qt, aap);
a_final.qu = mix(a_prev.qu, a_final.qu, aap);
a_final.qv = mix(a_prev.qv, a_final.qv, aap);
a_final.qw = mix(a_prev.qw, a_final.qw, aap);
a_final.qx = mix(a_prev.qx, a_final.qx, aap);
a_final.qy = mix(a_prev.qy, a_final.qy, aap);
a_final.qz = mix(a_prev.qz, a_final.qz, aap);
a_final.ra = mix(a_prev.ra, a_final.ra, aap);
a_final.rb = mix(a_prev.rb, a_final.rb, aap);
a_final.rc = mix(a_prev.rc, a_final.rc, aap);
a_final.rd = mix(a_prev.rd, a_final.rd, aap);
a_final.re = mix(a_prev.re, a_final.re, aap);
a_final.rf = mix(a_prev.rf, a_final.rf, aap);
a_final.rg = mix(a_prev.rg, a_final.rg, aap);
a_final.rh = mix(a_prev.rh, a_final.rh, ONE);
a_final.ri = mix(a_prev.ri, a_final.ri, ONE);
a_final.rj = mix(a_prev.rj, a_final.rj, ONE);
#endif
rm ns;
bool aks = aaq(a_final, ns);
if (!aks) {
wz();
return;
}
vec2 aaw = a_vertexInfo.xy;
a = ns.cl;
b = ns.cm;
c = ns.dh;
d = ns.rn;
e = ns.cq;
#if D3D9_FIX
#else
l = ns.eu;
m = ns.rt;
n = ns.ru;
o = vec2(ns.dc, ns.rs);
p = ns.ro;
q = ns.rp;
r = vec2(ns.py, ns.rq);
s = ns.rr;
t = ns.rw;
u = ns.rv;
#endif
float akv = step(aaw.x, 0.0);
float akw = 1.0 - akv;
g = min(ns.rx, ROUNDED_BOX_RADIUS * 2.) * u_pixelRatio;
vec2 xb = ns.bd
+ ns.ry * (ns.or / 2.0) * aaw.x
+ (akv * ns.rz + akw * ns.sa) * ns.rx / 2.0 * aaw.y;
c = c * (1. - f.w)
+ vec4(
aaw.x * ns.or,
aaw.y * ns.rx,
ns.or,
ns.rx
) * u_pixelRatio * f.w;
gl_Position = xa(xb);
}
`,Sf=1e20,i2=class{constructor({fontSize:t=24,buffer:e=8,radius:s=6,cutoff:i=.25}={}){this._maxDimension=1,this._gridSize=1,this._fontSize=t,this._buffer=e,this._radius=s,this._cutoff=i,this._height=Math.ceil(this._fontSize+2*this._buffer*pl),this._canvas=We(),this._canvas.height=this._height,this._canvas.width=1;const n=this._canvas.getContext("2d",{willReadFrequently:!0});this._ctx=n,n.textBaseline="middle",n.textAlign="center",n.fillStyle="black"}setOptions({fontSize:t=24,buffer:e=8,cutoff:s=.25,radius:i=6}){this._fontSize=t,this._buffer=e,this._cutoff=s,this._radius=i,this._height=Math.ceil(this._fontSize+2*this._buffer*pl)}draw(t,e,s){Ji(this._ctx,e,this._fontSize,s);const i=n2(this._ctx.measureText(t).width+2*this._buffer)-2*Ki,n=this._height,r=i*n,o=Math.max(i,n);this._canvas.width<i&&(this._canvas.width=i,Ji(this._ctx,e,this._fontSize,s),this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="black"),r>this._gridSize&&(this._gridOuter=new Float64Array(r),this._gridInner=new Float64Array(r),this._gridSize=r),o>this._maxDimension&&(this._f=new Float64Array(o),this._d=new Float64Array(o),this._z=new Float64Array(o+1),this._v=new Int16Array(o),this._maxDimension=o),this._ctx.clearRect(0,0,i,n),this._ctx.fillText(t,i/2,n/2);const a=this._ctx.getImageData(0,0,i,n),l=new Uint8ClampedArray(r);for(let d=0;d<r;d++){const h=a.data[4*d+3]/255;this._gridOuter[d]=h===1?0:h===0?Sf:Math.pow(Math.max(0,.5-h),2),this._gridInner[d]=h===1?Sf:h===0?0:Math.pow(Math.max(0,h-.5),2)}wf(this._gridOuter,i,n,this._f,this._d,this._v,this._z),wf(this._gridInner,i,n,this._f,this._d,this._v,this._z);for(let d=0;d<r;d++){const h=this._gridOuter[d]-this._gridInner[d];l[d]=Math.max(0,Math.min(255,Math.round(255-255*(h/this._radius+this._cutoff))))}return{height:n,width:i,distance:l}}};function wf(t,e,s,i,n,r,o){for(let a=0;a<e;a++){for(let l=0;l<s;l++)i[l]=t[l*e+a];Tf(i,n,r,o,s);for(let l=0;l<s;l++)t[l*e+a]=n[l]}for(let a=0;a<s;a++){for(let l=0;l<e;l++)i[l]=t[a*e+l];Tf(i,n,r,o,e);for(let l=0;l<e;l++)t[a*e+l]=Math.sqrt(n[l])}}function Tf(t,e,s,i,n){s[0]=0,i[0]=-1e20,i[1]=1e20;for(let r=1,o=0;r<n;r++){let a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);for(;a<=i[o];)o--,a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);o++,s[o]=r,i[o]=a,i[o+1]=1e20}for(let r=0,o=0;r<n;r++){for(;i[o+1]<r;)o++;e[r]=(r-s[o])*(r-s[o])+t[s[o]]}}function n2(t){return Math.ceil((t+2*Ki)/Je)*Je}var aa=256,r2=.275,o2=.25,a2=6,l2=xT-2*Ki,d2=yT-2*Ki,If={fontSize:go,cutoff:r2,radius:a2},h2={fontSize:go,cutoff:o2,radius:8},u2=class{constructor(t,e){this._patternIdToInfoTexture=new Uint8Array(aa*aa*4),this._glTextures=[],this._textureSizes=[],this._pixelRatio=1,this._gl=t,this._glUnit=e;const s=We(Bs,Bs),i=s.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Pattern: could not get 2d context");this._imageCanvasContext=i,this._imageCanvas=s,this._canvasForDuplicatedImage,this._sdfGenerator=new i2(If),this._maxTextureSize=Math.min(4096,t.getParameter(t.MAX_TEXTURE_SIZE))}refresh(t){this._pixelRatio=t.getPixelRatio();const e=this._gl,s=this._getPatternsByFilter(t.getPatternList());for(let r=0;r<s.length;++r){const o=r,a=s[r],l=z1(a,this._maxTextureSize),{texture:d,size:h}=Fx(o,a,l,this._maxTextureSize,this._patternIdToInfoTexture),u=this._glTextures[o]||(this._glTextures[o]=e.createTexture()),c=o===Zn?yc:qh;xf(e,u,this._glUnit+1+o,d,h,o,c),this._textureSizes[o]=h}const i=this._glTextureInfo||(this._glTextureInfo=e.createTexture()),n=this._patternIdToInfoTexture;xf(e,i,this._glUnit,n,aa,Zn,qh)}bindMetaDataTexture(){const t=this._gl;t.activeTexture(t.TEXTURE0+this._glUnit),t.bindTexture(t.TEXTURE_2D,this._glTextureInfo)}getInfoTextureUnit(){return this._glUnit}getNearestTextureUnit(){return this._glUnit+1+Zn}getLinearTextureUnit(){return this._glUnit+1+to}getLinearSdfTextureUnit(){return this._glUnit+1+eo}getMipmapTextureUnit(){return this._glUnit+1+dn}getInfoTextureSize(){return aa}getNearestTextureSize(){return this._textureSizes[Zn]}getLinearTextureSize(){return this._textureSizes[to]}getLinearSdfTextureSize(){return this._textureSizes[eo]}getMipmapTextureSize(){return this._textureSizes[dn]}_getPatternsByFilter(t){const e=new Array(_f);for(let s=0;s<_f;++s)e[s]=[];for(let s=0;s<t.length;++s){const i=this._getPatternPixels(t[s]);e[i.filter].push(i)}return e}_getPatternPixels({id:t,type:e,attributes:s}){let i;const{text:n,font:r,style:o,image:a,scaled:l,duplicated:d,colorArray:h}=s;switch(e){case Yi:i=d?this._getDuplicatedImagePixels(a):l?this._getScaledImagePixels(a):this._getNonScaledImagePixels(a);break;case gn:i=this._getSdfTextPixels(n,r,o);break;case xn:i=this._getIconPixels(n,r,o);break;case bn:i=this._getBadgeIconPixels(n,r,o);break;case Fo:i=this._getPieChartPixels(h);break;default:throw new Error(`pattern type "${e}" does not exist`)}return i.id=t,i}_getScaledImagePixels(t){let e=t.width,s=t.height;if(e>0){const i=Bs/Math.max(t.width,t.height);e*=i,s*=i}return e&&s&&(e=cr(e),s=cr(s)),e-=2*Ki,s-=2*Ki,this._getImagePixels(t,e,s)}_getNonScaledImagePixels(t){return this._getImagePixels(t,t.width,t.height)}_getDuplicatedImagePixels(t){if(t.width===0||t.height===0)return this._getImagePixels(t,0,0);this._canvasForDuplicatedImage||(this._canvasForDuplicatedImage=We(Bs,Bs));const e=this._canvasForDuplicatedImage,s=e.getContext("2d"),i=t.width,n=t.height;let r=(Bs-i)/2,o=(Bs-n)/2;for(;r>0;)r-=i;for(;o>0;)o-=n;for(let a=r;a<Bs;a+=i)for(let l=o;l<Bs;l+=n)s.drawImage(t,a,l);return this._getImagePixels(e,Bs,Bs)}_getImagePixels(t,e,s){let i;if(e===0||s===0)i=new Uint8Array(0);else{(this._imageCanvas.width<e||this._imageCanvas.height<s)&&(this._imageCanvas.width=e,this._imageCanvas.height=s);const n=this._imageCanvasContext;Bh(this._imageCanvas,n,e,s);try{n.drawImage(t,0,0,e,s)}catch{}i=n.getImageData(0,0,e,s).data}return{width:e,height:s,pixels:i,filter:dn}}_getPieChartPixels(t){const e=d2,s=this._imageCanvasContext,i=e/2,n=e/2;return Bh(this._imageCanvas,s,e,e),s.save(),s.rect(0,0,e,e),s.clip(),Ox(s,t,i,n,e),s.restore(),{width:e,height:e,pixels:s.getImageData(0,0,e,e).data,filter:to}}_getTextPixels(t,e,s,i,n,r){const o=this._imageCanvasContext,a=n*this._pixelRatio;Ji(o,s,a,i);let l=Math.ceil(o.measureText(e).width);l===0&&(l=a);let d=0,h=0;t===dn||(d=2*Math.ceil(a*pl/2),h=2*Math.ceil(l*Ky/2));const u=Math.ceil(l+h),c=Math.ceil(a+d),g=this._imageCanvas.height<c||this._imageCanvas.width<u;return this._imageCanvas.height<c&&(this._imageCanvas.height=c),this._imageCanvas.width<u&&(this._imageCanvas.width=u),g&&Ji(o,s,a,i),o.clearRect(0,0,u,c),o.fillStyle="black",o.textBaseline="middle",o.textAlign="left",o.fillText(e,r+h/2,c/2),{width:u,height:c,pixels:o.getImageData(0,0,u,c).data,filter:t}}_getIconPixels(t,e,s){return this._getTextPixels(dn,t,e,s,l2,0)}_getBadgeIconPixels(t,e,s){return this._sdfGenerator.setOptions(h2),this._getSdfPixels(t,e,s)}_getSdfTextPixels(t,e,s){return this._sdfGenerator.setOptions(If),this._getSdfPixels(t,e,s)}_getSdfPixels(t,e,s){const{width:i,height:n,distance:r}=this._sdfGenerator.draw(t,e,s),o=new Uint8Array(i*n*4);for(let a=0;a<r.length;++a)o[4*a+3]=r[a];return{width:i,height:n,pixels:o,filter:eo}}},c2=class{constructor(t,e){this._gl=t,this._glTextureUnit=e,this._simpleShapePixels=new Uint8Array(Ha*Ha*4),this._complexShapePixels=new Uint8Array(qi*qi*4),this._shapesWritten=[]}refresh(t){const e=t.getShapeList();for(const s of e)if(!this._shapesWritten.includes(s.id)){const i=s.isSimple?Ha:qi,n=s.isSimple?this._simpleShapePixels:this._complexShapePixels;B1(s,i,Rh,n),this._loadShapeInGpu(s.id,i,n),this._shapesWritten.push(s.id)}}_loadShapeInGpu(t,e,s){const i=this._gl,n=Dh,r=t%Fh*qi,o=Math.floor(t/Fh)*qi;if(this._texture)i.bindTexture(i.TEXTURE_2D,this._texture);else{const a=new Uint8Array(n*n*4);this._texture=i.createTexture(),i.activeTexture(i.TEXTURE0+this._glTextureUnit),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,n,0,i.RGBA,i.UNSIGNED_BYTE,a)}i.texSubImage2D(i.TEXTURE_2D,0,r,o,e,e,i.RGBA,i.UNSIGNED_BYTE,s)}getTextureSize(){return Dh}getSamplingSize(){return qi}getBufferRatio(){return Rh}getTextureUnit(){return this._glTextureUnit}},Cf=class{constructor(t,{vertex:e,fragment:s,constants:i,macros:n}){this._state=0,this._gl=t,this._vertexSource=e,this._fragmentSource=s,this._constants=Ae(i||{}),this._macros=Ae(n||{})}setConstant(t,e){this._constants[t]=e}setMacro(t,e){this._macros[t]=e}getState(){return this._state}getProgram(){return this._program}compile(){const t=this._gl,e=Lf(this._vertexSource,this._macros,this._constants),s=Lf(this._fragmentSource,this._macros,this._constants);this._program&&(t.deleteProgram(this._program),t.deleteShader(this._vertexShader),t.deleteShader(this._fragmentShader));const i=t.createProgram(),n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);if(!(i&&n&&r))throw new Error("Error instantiating WebGL program");this._program=i,this._vertexShader=n,this._fragmentShader=r,t.shaderSource(this._vertexShader,e),t.compileShader(this._vertexShader),t.attachShader(this._program,this._vertexShader),t.shaderSource(this._fragmentShader,s),t.compileShader(this._fragmentShader),t.attachShader(this._program,this._fragmentShader),t.linkProgram(this._program),this._state=1}getError(){const t=this._gl;if(!t.getShaderParameter(this._vertexShader,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(this._vertexShader)||"";let s=e;const i=e.match(/ERROR: (\d+):(\d+):(.*)\n/g);if(i&&i.length){const n=this._vertexSource.split(`
`);s=i.map(r=>{const o=r.match(/ERROR: (\d+):(\d+):(.*)\n/);if(!o)return r;const[a,l]=o.slice(2);return`${n[+a]}
${n[+a+1]}
~~~~~~~~~~~
${n[+a+2]}
 -> ${l}`}).join(`
`)}return{step:"vertex",message:s}}return t.getShaderParameter(this._fragmentShader,t.COMPILE_STATUS)?t.getProgramParameter(this._program,t.LINK_STATUS)?(this._state=2,null):{step:"link",message:t.getProgramInfoLog(this._program)||""}:{step:"fragment",message:t.getShaderInfoLog(this._fragmentShader)||""}}};function Lf(t,e,s){const i=Object.keys(e),n=Object.keys(s);for(let r=0;r<i.length;++r){const o=i[r],a=e[o];t=t.replace(`#define ${o} 0`,`#define ${o} ${a}`)}for(let r=0;r<n.length;++r){const o=n[r],a=s[o],l=a+(a%1==0?".0":"");t=t.replace(`const float ${o} = 0.0;`,`const float ${o} = ${l};`)}return t}function g2(){return typeof window<"u"&&!!window.FORCE_WEBGL}/** @preserve instance id */var Nf=yx(),f2={stencil:!0,antialias:!1,alpha:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!g2()},m2=0,_2=1,p2={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'},zx=class extends Error{};function Md(t,e){if(!t&&e){const s=new zx(p2[e]);throw s.code=e,s}}var y2=class Bx extends Si{constructor(e){super(e),this._2dcanvas=We(),this._ctx=this._2dcanvas.getContext("2d"),this._bufferDrawers=[],this._mustResize=!1,this._error=null,this._onContextLost=l=>{l.preventDefault(),this._error=new zx("WebGL context lost"),this.fire("error",this._error)};const s=Bx.createInitData(),{canvas:i,gl:n,ext:r,staticProgramWrapper:o,animationProgramWrapper:a}=s;Md(n,"NO_WEBGL"),Md(r,"NO_ANGLE_INSTANCED_ARRAYS"),this._glCanvas=i,this._gl=n,this._ext=r,this._staticProgramWrapper=o,this._animationProgramWrapper=a,this._shapeTexture=new c2(this._gl,m2),this._patternTexture=new u2(this._gl,_2),this._initCanvas(this._glCanvas),this._computeShaderInfo(),this._initSpecialGlBuffers(),this._initGlPrograms(),this._initGl()}_initCanvas(e){super._initCanvas(e),e.addEventListener("webglcontextlost",this._onContextLost,!1)}static isAvailable(){return Nf||Md(null,"NO_WEBGL"),Nf}static createInitData(){const e=We(),s=hc(e,f2,"webgl"),i=s&&typeof s.getExtension=="function"?s.getExtension("ANGLE_instanced_arrays"):null,n=v2(),r=new Cf(s,{vertex:Nd,fragment:Ld,constants:n,macros:{ANIMATED:0}}),o=new Cf(s,{vertex:Nd,fragment:Ld,constants:n,macros:{ANIMATED:1}});return s&&i&&(r.compile(),s.flush()),{canvas:e,gl:s,ext:i,staticProgramWrapper:r,animationProgramWrapper:o}}static getName(){return"WebGL"}_beforeFirstFrame(){this._animationProgramWrapper.getState()===0&&this._animationProgramWrapper.compile()}ensureAnimationsReady(){const e=this._animationProgramWrapper.getState();e!==2&&(e===0&&this._animationProgramWrapper.compile(),this._animationProgramWrapper.getError())}getDomElement(){return this._glCanvas}_initGl(){const e=this._gl;e.clearColor(0,0,0,0),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}_computeShaderInfo(){this._shaderMetadata=x2(Nd,Ld)}_initGlPrograms(){this._staticProgram=new Af({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._staticProgramWrapper}),this._animationProgram=new Af({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._animationProgramWrapper})}_initSpecialGlBuffers(){const e=this._gl,s=e.createBuffer(),i=new Int8Array(18*ms);for(let n=0;n<ms;++n){const r=[-1,-1,n,1,-1,n,1,1,n,-1,-1,n,-1,1,n,1,1,n],o=n*r.length;for(let a=0;a<r.length;a++)i[a+o]=r[a]}e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this._specialGlBuffers={vertexInfo:s}}_computeUniforms(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._scales.bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._scales.bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._scales.bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._scales.bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._scales.bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._scales.bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._scales.bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_UNIT_SIZE:Je,ROUNDED_BOX_RADIUS:this._textManager.getCornerRadius(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}}_render({shapesChanged:e,patternsChanged:s,dimensionsChanged:i,backgroundColorChanged:n}){const r=this._gl;if(this._error)throw this._error;if(e&&(this._shapeTexture.refresh(this._shapeManager),this._patternTexture.bindMetaDataTexture()),s&&this._patternTexture.refresh(this._patternManager),i&&(this._mustResize=!0),n){const[l,d,h,u]=this._renderBackground?this._backgroundRgba:[0,0,0,0];r.clearColor(l*u,d*u,h*u,u)}const o=this._computeUniforms(),a=this._getSortedBufferList();this._mustResize&&a.length&&(nl(this._glCanvas,this._width,this._height,this._pixelRatio),r.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),this._mustResize=!1),r.clear(r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT);for(let l=0;l<a.length;++l)this._displayBuffer(a[l],o);this._endFrame()}_displayBuffer(e,s){const i=e.getProgram();i!==this._currentProgram&&(this._currentProgram&&this._currentProgram.endPass(),this._currentProgram=i,this._currentProgram.startPass(s)),e.markAsUsed(),e.draw()}_getSortedBufferList(){const e=this._bufferList.getBuffersByAscendingDepth(),s=[];for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&n.markAsUnused()}for(let i=0;i<e.length;++i){const n=e[i],r=this._getBufferDrawer(n);r.markAsUsed(),!n.isEmpty()&&this._isBufferDisplayable(n)&&s.push(r)}for(let i=0;i<this._bufferDrawers.length;++i){const n=this._bufferDrawers[i];n&&!n.isUsed()&&(n.destroy(),this._bufferDrawers[i]=void 0)}return s}_endFrame(){this._currentProgram&&(this._currentProgram.endPass(),this._currentProgram=null)}_getBufferDrawer(e){const s=e.getId();let i=this._bufferDrawers[s];if(!i){for(;this._bufferDrawers.length<=s;)this._bufferDrawers.push(void 0);i=new Z1({gl:this._gl,ext:this._ext,staticProgram:this._staticProgram,animationProgram:this._animationProgram}),this._bufferDrawers[s]=i}return i.setDataBuffer(e),i}destroy(){this._glCanvas&&this._glCanvas.removeEventListener("webglcontextlost",this._onContextLost);const e=this._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}getImageData(){const e=this._glCanvas.width,s=this._glCanvas.height;return(this._2dcanvas.width<e||this._2dcanvas.height<s)&&(this._2dcanvas.width=e,this._2dcanvas.height=s),this._ctx.clearRect(0,0,e,s),this._ctx.drawImage(this._glCanvas,0,0),this._ctx.getImageData(0,0,e,s)}_getImageDataFlippedYAxis(){const e=this._gl,s=this._glCanvas.width,i=this._glCanvas.height,n=this._ctx.createImageData(s,i),r=new Uint8Array(n.data.buffer);return e.readPixels(0,0,s,i,e.RGBA,e.UNSIGNED_BYTE,r),n}setConstant(e,s){this._staticProgramWrapper.setConstant(e,s),this._animationProgramWrapper.setConstant(e,s),this._staticProgramWrapper.compile(),this._animationProgramWrapper.compile(),this._initGlPrograms(),this._bufferDrawers.forEach(i=>{i?.destroy()}),this._bufferDrawers=[]}};function x2(t,e){const s={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};return Mf(s,t),Mf(s,e),s}var b2={float:1,vec2:2,vec3:3,vec4:4};function Mf(t,e){const s=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g,i=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g,n=[];let r=s.exec(e);for(;r;){const o=r[0];o==="#endif"?n.pop():o.startsWith("#if")?n.push(r[4]):t.attributes.push({name:r[3],size:b2[r[2]],type:r[1],tags:n.slice(),location:null,byteSize:0,glType:null}),r=s.exec(e)}for(r=i.exec(e);r;){if(!t.uniforms.some(({id:o})=>o===r[1])){const o=r[1],a=r[2],l=a.replace("u_","");t.uniforms.push({id:l,name:a,type:o})}r=i.exec(e)}}function v2(){return{BYTES_TO_OFFSET_ANGLE:2*Math.PI/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:go,CURVATURE_RATIO:Yl,PATTERN_PADDING:Ki,TEXT_WIDTH_MULTIPLIER:Ky,TEXT_HEIGHT_MULTIPLIER:pl,SELF_LOOP_CURVATURE_RATIO:yl,EDGE_ARROW_SIZE_RATIO:Si.edgeArrowSizeRatio,EDGE_MIN_TIP_SIZE:Si.minEdgeTipSize,CURVE_SUBDIVISIONS:ms,PIECE_NODE_COMPONENT:ks,PIECE_TEXT_BOX:fn,PIECE_EDGE_BODY:$l,PIECE_EDGE_HEAD:ic,PIECE_EDGE_TAIL:nc,PIECE_EDGE_TEXT:ln,MAX_TEXT_SIZE:u1,BYTES_TO_TEXT_OFFSET_X:1/Sx,BYTES_TO_TEXT_OFFSET_Y:1/Uh,FILTER_NEAREST:Zn,FILTER_LINEAR:to,FILTER_LINEAR_SDF:eo,FILTER_MIPMAP:dn,SHAPE_TEXTURE_SIZE:Dh,SIMPLE_SHAPE_SAMPLING_SIZE:Ha,COMPLEX_SHAPE_SAMPLING_SIZE:qi,SHAPE_SAMPLING_BUFFER_RATIO:Rh,MAX_SHAPES:_l.toString(),FIRST_COMPLEX_SHAPE_ID:Ph,SELF_LOOP_TO_CIRCLE_APPROX:tx,SDF_GAMMA:ET}}var E2={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,isBufferDisplayable:Pu,hideImages:!1,renderBackground:!1,bentEnable:!1,bentVertical:!1},la={webgl:y2,canvas:V1,svg:Y1},Pf=[0,0,0,0],Pd={webgl:null,svg:null,canvas:null},Rd=class extends Ro{constructor(t){super(),this._view=Ae(E2),this._domWrapper=Ti?document.createElement("div"):il(),this._domElement=this._domWrapper.appendChild(Ti?document.createElement("div"):il()),this._currentElementSize=0,this._currentBlockOffset=0,this._currentByteOffset=0,this._blockIdToAddress=new Uint32Array(0),this._renderersByType={},this._switchMainRenderer=!0,this._refreshTexts=!1,this._backgroundColor=null,this._initData=t||{},this._patternManager=new o1,this._shapeManager=new a1,this._boundariesManager=new MT,this._textManager=new c1(this._patternManager),this._bufferOffsetToId=new nx,this._memoryManager=new i1(this._patternManager,this._shapeManager,this._textManager,this._bufferOffsetToId,e=>this.parseColor(e)||Pf),this._bufferList=new wT}static createInitData(){const t={};for(const e in la)t[e]=la[e].createInitData();return t}static cacheInitData(t){Pd=t}static getCachedInitData(){return Pd}static clearCachedInitData(){Pd={webgl:null,svg:null,canvas:null}}freeBlock(t){this._checkBlockId(t);const e=this._blockIdToAddress[t],s=this._bufferList.freeBlock(e);return this._blockIdToAddress[t]=s,s}_ensureDomElementsFitParent(){const t=this._domElement.parentNode;!t||t.offsetWidth===this._view.width&&t.offsetHeight===this._view.height||Cn(t,`${this._view.width}px`,`${this._view.height}px`)}_ensureCorrectBackgroundColor(){const t=this._domElement.parentNode;this._backgroundColor!==this._view.backgroundColor&&t&&(t.style.backgroundColor=this._view.backgroundColor||"",this._backgroundColor=this._view.backgroundColor)}createGroup(){return new NT}parseColor(t){return es(t)}clear(){this._blockIdToAddress.fill(0),this._patternManager.reset(),this._boundariesManager.reset(),this._textManager.reset(),this._bufferList.reset(),this._bufferOffsetToId.reset()}notifyFontsReloaded(){this._patternManager.notifyUpdate(),this._textManager.clear(),this._refreshTexts=!0}notifyPatternUpdate(){this._patternManager.notifyUpdate()}getShapePoints(t){return this._shapeManager.getDefinitionFromName(t).points}checkShapeHit(t,e,s){const{getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:n}=this._shapeManager.getDefinitionFromName(t);return Math.min(i(e,s),n(e,s))>=0}setGlobalBoundaries(t){const{maxBlockId:e=0,maxScaledSize:s,maxMinVisibleSize:i,maxSymbolicSize:n,maxDashLength:r,maxGapLength:o,maxPatternScale:a}=t;return e>this._blockIdToAddress.length&&this._resizeBlockArray(e),!!this._boundariesManager.set(t)&&(this._memoryManager.resizeBoundaries(s,i,n,r,o,a),!0)}_resizeBlockArray(t){const e=new Uint32Array(t);e.set(this._blockIdToAddress),this._blockIdToAddress=e}registerShape(t,e){this._shapeManager.register(t,e)}_bindBlock(t,e,s,i,n,r,o){this._checkBlockId(t);const a=this._blockIdToAddress[t],l=this._bufferList.allocateBlock(a,e,s,i,n,r,o);return this._blockIdToAddress[t]=l.address,this._currentDataView=l.buffer.getDataView(),this._currentElementSize=l.buffer.elementSize,this._currentBlockOffset=l.offset,this._currentByteOffset=this._currentBlockOffset*this._currentElementSize,this._currentSideDataView=l.buffer.getSideDataView(),this._currentSideElementSize=l.buffer.getTotalSideElementsSize(),this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize,l}_setItemIndex(t){const e=this._currentBlockOffset+t;this._currentByteOffset=e*this._currentElementSize,this._currentSideByteOffset=e*this._currentSideElementSize}_checkBlockId(t){t>=this._blockIdToAddress.length&&this._resizeBlockArray(Hi(t+1))}_setTextCharacters(t){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,t)}_storeElement(t,e){this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset,t.end),e&&(this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset+hr,t.start),this._memoryManager.storeAnimationInformation(this._currentDataView,this._currentByteOffset+2*hr,t.animation,oc.getCoefficients(t.animation.easing)))}storeGroup(t,e){if(!e||e.size===0)return this.freeBlock(t);const s=e.type,i=e.depth,n=e.size,r=e.getElements(),o=e.animated,a=e.stencilUsage,l=e.getId();let d=0;if(s===yn)for(let u=0;u<n;++u){const c=r[u],{start:g,end:f}=c;if(f.pattern.type===Qi){const m=f.pattern.attributes.text;d=Math.max(d,m.length)}if(o&&g.pattern.type===Qi){const m=g.pattern.attributes.text;d=Math.max(d,m.length)}}const h=this._bindBlock(t,s,o,i,n,d,a);for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._storeElement(c,o),this._bufferOffsetToId.set(h.buffer.getId(),h.offset+u,l)}if(s===yn)for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._setTextCharacters(c.end.pattern)}return h.address}_refreshTextElements(){const t=this._bufferList.getBuffers();for(const e of t)if(e&&e.type===yn){const s=e.getSideDataView(),i=e.getTotalSideElementsSize(),n=e.getSize();let r=0,o=i;for(let a=0;a<n;++a){const l=this._textManager.extractTextFromDataView(s,r,o);this._textManager.storeTextInDataView(s,r,o,l),r=o,o+=i}e.triggerUpdate()}}extractElement(t,e=0){if(!t)return null;const s=this._bufferList.getBlockInfo(t);return this._renderer.extractElement(s.buffer,s.offset+e)}getDomElement(){return this._domElement}getDomWrapper(){return this._domWrapper}measureText(t,e,s,i=1){return this._textManager.measureText(t,e,s,i)}setRenderType(t){this._renderType!==t&&(this._renderType=t,this._switchMainRenderer=!0)}setEdgeArrowSizeRatio(t){Si.setEdgeArrowSizeRatio(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_ARROW_SIZE_RATIO",t)}setEdgeMinTipSize(t){Si.setMinEdgeTipSize(t),this._renderersByType.webgl&&this._renderersByType.webgl.setConstant("EDGE_MIN_TIP_SIZE",t)}setBentEdges(t,e){this._view.bentEnable=t,this._view.bentVertical=e}getBentEdges(){return{bentEnable:this._view.bentEnable,bentVertical:this._view.bentVertical}}_ensureMainRendererReady(){if(this._switchMainRenderer){this._renderType===null&&(this._renderType="canvas");const t=la[this._renderType];t&&t.isAvailable()||(this._renderType="canvas"),this._renderer=this._renderersByType[this._renderType],this._renderer||(this._renderer=this._instanciateRenderer(this._renderType),this._renderer.on("error",e=>this.fire("error",e)),this._renderersByType[this._renderType]=this._renderer),this._updateDomElement()}}_updateDomElement(){const t=this._renderer&&this._renderer.getDomElement(),e=this._domElement;for(;e&&e.firstChild;)e.removeChild(e.firstChild);t&&this._appendDomChild(t)}_appendDomChild(t){t.style.position="absolute",t.style.left="0",t.style.top="0",this._domElement.appendChild(t)}_instanciateRenderer(t){return new(t===null?Si:la[t])({initData:t===null?null:this._initData[t],bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,memoryManager:this._memoryManager})}setView(t){this._view={...this._view,...t}}getTextManager(){return this._textManager}_updateManagers(){this._patternManager.setPixelRatio(this._view.pixelRatio),this._shapeManager.update(),this._patternManager.update(),this._textManager.update(),this._boundariesManager.update(),this._bufferList.update(),this._refreshTexts&&(this._refreshTexts=!1,this._refreshTextElements())}_resizeCanvas(t){ax(t,this._view.width,this._view.height,this._view.pixelRatio)}render(){this._ensureMainRendererReady(),this._ensureDomElementsFitParent(),this._ensureCorrectBackgroundColor(),this._updateManagers(),this._renderer.renderFrame(this._view)}ensureAnimationsReady(){this._ensureMainRendererReady(),this._renderer.ensureAnimationsReady()}export(t,e,s){const i=this._instanciateRenderer(t),n={...this._view,...e};return"setViewportClipping"in i&&i.setViewportClipping(!1),this._updateManagers(),i.renderFrame(n),i.export(s).then(()=>i.getDomElement())}getCurrentTime(){return ts()}getImageData(){return this._renderer&&this._renderer.getImageData()}destroy(){for(const t of Object.keys(this._renderersByType)){const e=this._renderersByType[t];e&&e.destroy()}}transparentify(t){const e=this.parseColor(t)||Pf;return`rgba(${Math.round(255*e[0])},${Math.round(255*e[1])},${Math.round(255*e[2])},0)`}initDebugRenderingLoop({triggerKey:t="r",start:e=!0}={}){let s=e;document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s)});const i=n=>{(s||n)&&(this.setView({currentTime:ts()}),this.render()),window.requestAnimationFrame(()=>{i()})};window.requestAnimationFrame(()=>{document.body.appendChild(this.getDomElement()),i(!0)})}},A2=Bl&&document.fonts,S2=200,Fd="/qwerty/ [HELLO] ",Rf="serif",w2=16,T2=class{constructor(){this._fontFaceSet=A2?document.fonts:null,this._canvas=We(),this._ctx=this._canvas.getContext("2d")}_measureText(t,e){return this._ctx.font=`12px ${e}`,this._ctx.measureText(t).width}check(t){if(t===Rf)return!0;const e=this._measureText(Fd,Rf);return this._measureText(Fd,t)!==e}load(t){return this._fontFaceSet&&this._fontFaceSet.load?this._fontFaceSet.load(`12px ${t}`):(this._ctx.font=`12px ${t}`,this._ctx.fillText(Fd,10,50),Promise.resolve())}},I2=class{constructor(t,e){this._fontLoaderCounter=0,this._loaded=!1,this._value=null,this._timeout=0,this._fontFaceSet=t,this._fontName=e,this._loaded=!1,this._value=null,this._timeout=0,Bl&&!this._fontFaceSet.check(this._fontName)||this._setLoaded()}_setLoaded(){this._loaded=!0,this._value=this._fontName}getValue(){return this._value}isLoaded(){return this._loaded}destroy(){clearTimeout(this._timeout)}load(){return this._tryLoad(S2).then(()=>this._setLoaded())}_tryLoad(t){return this._fontFaceSet.load(this._fontName).then(()=>{if(!this._fontFaceSet.check(this._fontName)&&this._fontLoaderCounter<w2)return new Promise(e=>{t<6e4&&(this._timeout=setTimeout(e,t))}).then(()=>(this._fontLoaderCounter++,this._tryLoad(1.5*t)))})}},C2=class{constructor(){this._fontFaceSet=new T2,this._fonts={},this._onFontLoaded=[],this._hideUntilFontsLoaded=!0}setHideUntilFontsLoaded(t){this._hideUntilFontsLoaded=t}getFont(t){let e=this._fonts[t];return e||(e=new I2(this._fontFaceSet,t),this._fonts[t]=e,e.isLoaded()||e.load().then(()=>this._triggerFontLoaded(t))),!this._hideUntilFontsLoaded&&t||e.getValue()}onFontLoaded(t){this._onFontLoaded.push(t)}destroy(){this._onFontLoaded=[],Object.keys(this._fonts).forEach(t=>this._fonts[t].destroy())}_triggerFontLoaded(t){this._onFontLoaded.forEach(e=>e(t))}};function L2(t,e,s,i){xc(t,e,s,i),t.thicknessOrFontSizeScaled=e.widthScaled,t.thicknessOrFontSizeFixed=e.widthFixed,t.strokeWidthScaled=e.stroke.widthScaled,t.strokeWidthFixed=e.stroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.color,t.strokeColor=e.stroke.color,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=e.stroke.minVisibleSize,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function xc(t,e,s,i){t.pieceId=s,t.shape=i,t.x1=e.sourceX,t.y1=e.sourceY,t.x2=e.targetX,t.y2=e.targetY,t.rectWidthOrSourceRadiusScaled=e.sourceRadiusScaled,t.rectWidthOrSourceRadiusFixed=e.sourceRadiusFixed,t.rectHeightOrTargetRadiusScaled=e.targetRadiusScaled,t.rectHeightOrTargetRadiusFixed=e.targetRadiusFixed,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=ss,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.widthScaled,t.curvature=e.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=e.isSelfLoop,t.isText=!1}function N2(t,e,s){const i=e.widthScaled+2*e.halo.widthScaled,n=e.widthFixed+2*e.halo.widthFixed;xc(t,e,s,"line"),t.thicknessOrFontSizeScaled=i,t.thicknessOrFontSizeFixed=n,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.halo.color,t.strokeColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1}function M2(t,e,s,i){xc(t,e,s,i);const n=e.widthFixed*df+KT;t.thicknessOrFontSizeScaled=e.widthScaled*lf,t.thicknessOrFontSizeFixed=e.widthFixed*lf,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=e.widthScaled*df,t.offsetFixed=n,t.fillColor=e.outline.color,t.strokeColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,e.outline.minVisibleSize),t.strokeMinVisibleSize=0,t.offsetAngle=Math.PI/2,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function P2(t,e,s){Ux(t,e,s),t.pattern.type=Qi,t.pattern.attributes.text=e.content,t.pattern.attributes.size=Co,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternColor=e.color,t.patternScale=1,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function R2(t,e,s){Ux(t,e,s),t.pieceId+=fn,t.fillColor=e.backgroundColor,t.shape="square"}function Ux(t,e,s){const i=e.position==="centered"?0:(s.widthScaled+e.heightScaled)/2+s.stroke.widthScaled,n=e.position==="centered"?0:(s.widthFixed+e.heightFixed)/2+s.stroke.widthFixed+e.padding+e.margin;if(t.pieceId=ln,t.shape="square",t.x1=s.sourceX,t.y1=s.sourceY,t.x2=s.targetX,t.y2=s.targetY,!s.isSelfLoop&&s.curvature===0){const r=Math.atan2(t.y2-t.y1,t.x2-t.x1),o=s.sourceRadiusScaled-s.targetRadiusScaled,a=Math.cos(r),l=Math.sin(r);t.x1+=a*o,t.y1+=l*o}t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding+1,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=s.sourceRadiusScaled+s.targetRadiusScaled,t.strokeWidthFixed=s.sourceRadiusFixed+s.targetRadiusFixed,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=ss,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,s.minVisibleSize),t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.offsetAngle,t.patternScale=0,t.symbolicSize=s.widthScaled,t.curvature=s.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=s.isSelfLoop,t.isText=!1,t.adjustTextAngle=e.adjustAngle}var F2=t=>!!t||t===0;function Xs(t,e,s=0){return t==="inherit"?Array.isArray(e)?e[((s/(2*Math.PI)*e.length|0)+1)%e.length]:e:t}function D2(t,e,s){return t==="source"?Array.isArray(e)?e[0]:e:t==="target"?Array.isArray(s)?s[0]:s:t}function O2(t){const e=t.depth;return e===dx||e===lx||(e-ac)%dc>=lc}function Gx(t){const e=(t.depth-ac)%dc;return e>=0&&e!==hx&&e!==lc}var Do="shifted",k2="centered";Cu(tp());function Ff(t,e,s,i,n,r){z2(t,e,s,i,n,r),Df(t,e,s,i.text,n.texts.primary,r.texts.primary,r),Df(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r)}function z2(t,e,s,i,n,r){if(Dd(n.body,r,L2),n.halo.body){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),Dd(n.halo,r,N2)}n.outline.body&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),Dd(n.outline,r,M2))}function Dd(t,e,s){s(t.body,e,$l,e.shape.body),t.head&&s(t.head,e,ic,e.shape.head),t.tail&&s(t.tail,e,nc,e.shape.tail)}function Df(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=Xs(a.color.get(s),o.color),r.position=a.position?a.position.get(s):Do,r.style=a.style.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=uc(r.content,r.maxLineLength),r.adjustAngle=a.adjustAngle.get(s),r.align=a.align.get(s),l){const h=a.scale.get(s);r.sizeScaled=o.widthScaled*h,r.sizeFixed=o.widthFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.offsetAngle=r===o.texts.primary?QT:JT,P2(n.text,r,o),n.background&&R2(n.background,r,o)}}function Of(t,e){Od(t.body,e,!0,!0),Od(t.outline,e,e.outline.enabled,!0),Od(t.halo,e,!!e.halo.color,!1),kf(t.texts.primary,e.texts.primary),kf(t.texts.secondary,e.texts.secondary)}function Od(t,e,s,i){t.body=s,t.head=s&&i&&!!e.shape.head,t.tail=s&&i&&!!e.shape.tail}function kf(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor}function zf(t,e,s,i,n,r){B2(t,e,s,i,n,r),Bf(t,e.texts.primary,s.text,i,e),Bf(t,e.texts.secondary,s.text.secondary,i,e)}function B2(t,e,s,i,n,r){const o=n.source,a=n.target,l=s.source.get(i),d=s.target.get(i),h=o.x.get(l),u=o.y.get(l),c=o.radius.get(l),g=o.innerStroke.width.get(l),f=+(o.innerStroke.color.get(l)!==null),m=+(o.innerStroke.scalingMethod.get(l)==="scaled"),_=o.outerStroke.width.get(l),p=+(o.outerStroke.color.get(l)!==null),x=+(o.outerStroke.scalingMethod.get(l)==="scaled"),y=o.color.get(l),b=+(o.scalingMethod.get(l)==="scaled"),v=a.x.get(d),E=a.y.get(d),A=a.radius.get(d),S=a.innerStroke.width.get(d),w=+(a.innerStroke.color.get(d)!==null),L=+(a.innerStroke.scalingMethod.get(d)==="scaled"),T=a.outerStroke.width.get(d),F=+(a.outerStroke.color.get(d)!==null),V=+(a.outerStroke.scalingMethod.get(d)==="scaled"),G=a.color.get(d),O=+(a.scalingMethod.get(d)==="scaled"),j=D2(s.color.get(i),y,G),W=s.width.get(i),et=s.scalingMethod.get(i)==="scaled"?1:0,at=s.stroke.width.get(i),mt=s.stroke.scalingMethod.get(i)==="scaled"?1:0,vt=t1[s.shape.style.get(i)],wt=s.adjustAnchors.get(i);if(e.source=l,e.target=d,e.sourceX=h,e.sourceY=u,e.targetX=v,e.targetY=E,e.sourceRadiusScaled=g*f*m+_*p*x+c*b,e.sourceRadiusFixed=g*f*(1-m)+_*p*(1-x)+c*(1-b),e.targetRadiusScaled=S*w*L+T*F*V+A*O,e.targetRadiusFixed=S*w*(1-L)+T*F*(1-V)+A*(1-O),e.widthScaled=W*et,e.widthFixed=W*(1-et),e.curvature=s.curvature.get(i),e.isSelfLoop=l===d,e.color=j,e.opacity=s.opacity.get(i),e.minVisibleSize=s.minVisibleSize.get(i),e.shape.body=s.shape.body.get(i),e.shape.head=s.shape.head.get(i),e.shape.tail=s.shape.tail.get(i),e.shape.dashLength=vt.dash,e.shape.gapLength=vt.gap,e.shape.isBodyTriangle=e.shape.body==="triangle",e.stroke.color=Xs(s.stroke.color.get(i),j),e.stroke.widthScaled=at*mt,e.stroke.widthFixed=at*(1-mt),e.stroke.minVisibleSize=s.stroke.minVisibleSize.get(i),e.halo.color=s.halo.color.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1,wt&&(e.shape.head||e.shape.tail||e.shape.body==="triangle")){const Et=e,yt=Et.curvature,St=Et.sourceX,zt=Et.sourceY,Zt=Et.targetX,Kt=Et.targetY;let X=1,Q=1;if(yt){if(!Et.isSelfLoop){const gt=sd(St,zt,Zt,Kt,yt/2);X=da(Et,r,o,l,St,zt,gt.x,gt.y),Q=da(Et,r,a,d,Zt,Kt,gt.x,gt.y)}}else X=da(Et,r,o,l,St,zt,Zt,Kt),Q=da(Et,r,a,d,Zt,Kt,St,zt);e.sourceRadiusScaled*=X,e.sourceRadiusFixed*=X,e.targetRadiusScaled*=Q,e.targetRadiusFixed*=Q}}function Bf(t,e,s,i,n){e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=Xs(s.backgroundColor.get(i),n.color)}function da(t,e,s,i,n,r,o,a){const l=e.angle||0;let d,h=Math.atan2(a-r,o-n)-l,u=1,c=0;h<-Fs?h+=Jr:h>Fs&&(h-=Jr),h<-Fs/2?(c=cx,d=s.badges.topLeft):h<0?(c=gx,d=s.badges.topRight):h<Fs/2?(c=mx,d=s.badges.bottomRight):(c=fx,d=s.badges.bottomLeft),c+=l;const g=d.text.content&&d.text.content.get(i),f=d.image.url&&d.image.url.get(i);if(F2(g)||f){const m=d.positionScale.get(i),_=d.scale.get(i),p=Iy(o,a,n,r,n+Math.cos(c)*m,r+Math.sin(c)*m,_);if(p){const x=p.x-n,y=p.y-r,b=Math.sqrt(x*x+y*y);u=Math.max(u,b)}}if(s.shape.get(i)==="square"){const m=Math.abs(Math.cos(h)),_=Math.abs(Math.sin(h)),p=1/Math.max(m,_);u=Math.max(u,p)}return u}function Uf(){return{source:0,target:0,sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:!1,color:"",opacity:0,minVisibleSize:0,shape:{body:"line",head:null,tail:null,dashLength:0,gapLength:0,isBodyTriangle:!1},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:!1,color:"",minVisibleSize:0},textHidden:!1,texts:{primary:Gf(),secondary:Gf()}}}function Gf(){return{align:"left",hidden:!1,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",minVisibleSize:0,margin:0,padding:0,position:Do,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:!1,offsetAngle:0}}function U2(t){return t===null?t:void 0}function je(t){return typeof t=="boolean"||t===0||t===1?t:void 0}function vn(t){return typeof t=="number"&&isFinite(t)?t:void 0}function pe(t){return typeof t=="number"&&isFinite(t)&&t>=0?t:void 0}var Vx=-100,G2=400,qx=t=>typeof t=="number"&&isFinite(t)&&t>=Vx&&t<=G2?t:void 0;function xi(t){return t===null||typeof t=="string"||typeof t=="number"?t:void 0}function Wi(t){return t==="fixed"||t==="scaled"?t:void 0}function Xi(t){return es(t)?t:void 0}function V2(t){return t===k2||t===Do?t:void 0}function Qe(t){return t==="inherit"||es(t)?t:void 0}function q2(t){return t==="source"||t==="target"||es(t)?t:void 0}function tr(t){return t===null?null:typeof t=="string"?t.split(",").map(e=>{const s=e.trim(),i=s.indexOf(" ")!==-1,n=s[0];return i&&n!=='"'&&n!=="'"?`"${s}"`:s}).join(","):void 0}function er(t){return t==="none"?"normal":t==="normal"||t==="italic"||t==="bold"||t==="italic bold"||t==="bold italic"?t:void 0}function bl(t){return t==="left"||t==="center"?t:void 0}function j2(t){return t==="equilateral"?"pentagon":t==="circle"||t==="square"||t==="cross"||t==="diamond"||t==="pentagon"||t==="star"?t:void 0}function H2(t){return["line","tapered","arrow","dashed","dotted"].includes(t)?t:void 0}function W2(t){return t==="line"||t==="triangle"?t:void 0}function Vf(t){return[null,"arrow","circle-hole-arrow","triangle-hole-arrow","short-arrow","sharp-arrow","circle","square"].includes(t)?t:void 0}function X2(t){return t==="plain"||t==="dashed"||t==="dotted"?t:void 0}function Y2(t){return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="center"?t:void 0}function $2(t){if(es(t))return t;if(Array.isArray(t)){if(t.length<1)return;for(let e=0;e<t.length;++e)if(!es(t[e]))return;return t}}function re(t){return function(e){if(typeof e=="number")return isFinite(e)&&e>=0?e:void 0;if(typeof e!="string"||e.charAt(e.length-1)!=="%")return;const s=parseFloat(e);return isNaN(s)?void 0:t*s/100}}function bc(){return{edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}}function _o(t,e=bc()){const s=(t-Vx)*dc+ac;return e.edgeHalo=HT,e.nodeHaloStroke=lx,e.nodeHalo=dx,e.edgeBody=s+hx,e.edgeTextBackground=s+WT,e.edgeText=s+XT,e.nodeBody=s+lc,e.nodeTextBackground=s+YT,e.nodeText=s+$T,e}var Z2=(t,e)=>{e.halo.body=e.halo.body||t.halo.body,e.halo.head=e.halo.head||t.halo.head,e.halo.tail=e.halo.tail||t.halo.tail,e.outline.body=e.outline.body||t.outline.body,e.outline.head=e.outline.head||t.outline.head,e.outline.tail=e.outline.tail||t.outline.tail,e.body.body=e.body.body||t.body.body,e.body.head=e.body.head||t.body.head,e.body.tail=e.body.tail||t.body.tail;const s=e.texts,i=t.texts;s.primary.text=s.primary.text||i.primary.text,s.primary.background=s.primary.background||i.primary.background,s.secondary.text=s.secondary.text||i.secondary.text,s.secondary.background=s.secondary.background||i.secondary.background},jx=t=>(e,s)=>{s.halo.body=e.halo.body[t],s.halo.head=e.halo.head[t],s.halo.tail=e.halo.tail[t],s.outline.body=e.outline.body[t],s.outline.head=e.outline.head[t],s.outline.tail=e.outline.tail[t],s.body.body=e.body.body[t],s.body.head=e.body.head[t],s.body.tail=e.body.tail[t],s.texts.primary.text=e.texts.primary.text[t],s.texts.primary.background=e.texts.primary.background[t],s.texts.secondary.text=e.texts.secondary.text[t],s.texts.secondary.background=e.texts.secondary.background[t]},K2=jx("start"),Q2=jx("end"),J2=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,view:n,attributes:r,attributesPrev:o,nodeAttributes:a,nodeAttributesPrev:l}){this._fullComponents=Ir(),this._startComponents=Ir(),this._endComponents=Ir(),this._startFlags=Ir(),this._endFlags=Ir(),this._startInput=Uf(),this._endInput=Uf(),this._depthInfo=bc(),this._nullElt={id:-1,valid:!0},this._engine=t,this._view=n,this._helper={imageManager:e,fontManager:s,formatText:i},this._attributes=r,this._attributesPrev=o,this._nodeAttributes=a,this._nodeAttributesPrev=l,this._layers=qf(()=>t.createGroup()),this._blockIds=qf(()=>0)}drawEdge(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=-t,n=this._attributes,{bentEnable:r,bentVertical:o}=e.getBentEdges(),a=_o(n.layer.get(t)-(n.detectable.get(t)?0:.5),this._depthInfo),l=n.source.get(t),d=n.target.get(t),h=n.curvature.get(t),u=this._attributesPrev.curvature.get(t),c=n.animationDuration.get(t),g=n.animationStart.get(t),f=n.animationEasing.get(t),m=c>0,_=h!==0||m&&u!==0||this._engine.getBentEdges().bentEnable;this._prepareBlocks(m,a,i,_);const p=this._extremitiesAttributes={source:this._nodeAttributes,target:this._nodeAttributes};if(zf(s,this._endInput,n,t,p,this._view),Of(this._endFlags,this._endInput),m){const x=this._nodeAttributes.animationDuration.get(l)>0,y=this._nodeAttributes.animationDuration.get(d)>0;p.source=x?this._nodeAttributesPrev:this._nodeAttributes,p.target=y?this._nodeAttributesPrev:this._nodeAttributes,zf(s,this._startInput,this._attributesPrev,t,p,this._view),Of(this._startFlags,this._startInput),Z2(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._layers),Q2(this._fullComponents,this._endComponents),this._endComponents.body.body.bentEnable=r,this._endComponents.body.body.bentVertical=o,this._endComponents.body.head&&(this._endComponents.body.head.bentEnable=r,this._endComponents.body.head.bentVertical=o),this._endComponents.body.tail&&(this._endComponents.body.tail.bentEnable=r,this._endComponents.body.tail.bentVertical=o),Ff(e,s,t,this._attributes,this._endComponents,this._endInput),this._endComponents.texts.primary.text&&(this._endComponents.texts.primary.background.bentEnable=r,this._endComponents.texts.primary.background.bentVertical=o,this._endComponents.texts.primary.text.bentEnable=r,this._endComponents.texts.primary.text.bentVertical=o),this._endComponents.texts.secondary.text&&(this._endComponents.texts.secondary.background.bentEnable=r,this._endComponents.texts.secondary.background.bentVertical=o,this._endComponents.texts.secondary.text.bentEnable=r,this._endComponents.texts.secondary.text.bentVertical=o),m&&(K2(this._fullComponents,this._startComponents),Ff(e,s,t,this._attributesPrev,this._startComponents,this._startInput),this._setBlocksAnimation(c,g,f)),this._setupHaloMasking(l,d),this._storeBlocks()}_setupHaloMasking(t,e){const s=this._nodeAttributes.halo,i=this._layers,n=s.color.get(t)&&s.hideNonAdjacentEdges.get(t),r=s.color.get(e)&&s.hideNonAdjacentEdges.get(e),o=!n&&!r?ox:Jn;i.body.stencilUsage=i.text.stencilUsage=i.textBg.stencilUsage=o}_computeBlockIds(t){const e=t*Kl,s=this._blockIds;s.body=e+UT,s.halo=e+qT,s.text=e+GT,s.textBg=e+VT}_prepareBlocks(t,e,s,i){const n=this._layers;n.body.reset(i?xl:qs,t,e.edgeBody,s),n.halo.reset(i?xl:qs,t,e.edgeHalo,s),n.text.reset(yn,t,e.edgeText,s),n.textBg.reset(qs,t,e.edgeTextBackground,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.halo,e.halo),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.halo),t.freeBlock(e.text),t.freeBlock(e.textBg)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._initEdgeComponents(t.halo,e.halo,s.halo),this._initEdgeComponents(t.outline,e.outline,s.body),this._initEdgeComponents(t.body,e.body,s.body),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initEdgeComponents(t,e,s){t.head=this._nextElement(e.head,s),t.tail=this._nextElement(e.tail,s),t.body=this._nextElement(e.body,s)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}};function qf(t){return{body:t(),halo:t(),text:t(),textBg:t()}}function Ir(){return{halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}}}function tI(t,e,s){Hx(t,e,s),e.imageContent!==null?(t.pattern.type=Yi,t.pattern.attributes.image=e.imageContent,t.pattern.attributes.scaled=!0,t.pattern.attributes.duplicated=!1,t.patternScale=e.imageScale,t.patternMinVisibleSize=0,t.patternColor=null):(t.fillColor=null,t.strokeColor=null)}function eI(t,e,s){Hx(t,e,s),e.textContent&&(t.pattern.type=bn,t.pattern.attributes.text=e.textContent,t.pattern.attributes.font=e.textFont,t.pattern.attributes.style=e.textStyle,t.pattern.attributes.paddingLeft=e.scale*e.textPaddingLeft*2,t.pattern.attributes.paddingTop=e.scale*e.textPaddingTop*2,t.pattern.attributes.size=Co,t.patternMinVisibleSize=0,t.patternColor=e.textColor,t.patternScale=e.textScale,t.isBadge=!0),!e.imageUrl&&e.textContent||(t.fillColor=null,t.strokeColor=null)}function Hx(t,e,s){const i=s.diameterScaled*e.scale,n=s.diameterFixed*e.scale,r=s.diameterScaled*e.positionScale/2,o=s.diameterFixed*e.positionScale/2;t.pieceId=ks,t.shape="circle",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=i,t.rectWidthOrSourceRadiusFixed=n,t.rectHeightOrTargetRadiusScaled=i,t.rectHeightOrTargetRadiusFixed=n,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.strokeWidthScaled,t.strokeWidthFixed=e.strokeWidthFixed,t.offsetScaled=r,t.offsetFixed=o,t.pattern.type=ss,t.opacity=s.opacity,t.fillColor=e.color,t.strokeColor=e.strokeColor,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.angle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function sI(t,e,s){id(t,e),t.fillColor=Array.isArray(e.color)?null:e.color,t.strokeColor=e.innerStroke.color,t.strokeMinVisibleSize=e.innerStroke.minVisibleSize,t.strokeWidthScaled=e.innerStroke.widthScaled,t.strokeWidthFixed=e.innerStroke.widthFixed,s&&(t.pattern.type=ss)}function id(t,e){t.pieceId=ks,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=e.diameterScaled,t.rectWidthOrSourceRadiusFixed=e.diameterFixed,t.rectHeightOrTargetRadiusScaled=e.diameterScaled,t.rectHeightOrTargetRadiusFixed=e.diameterFixed,t.shape=e.shape,t.opacity=e.opacity,t.symbolicSize=e.diameterScaled,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=null,t.strokeColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function iI(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=ks,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=ss,t.opacity=e.opacity,t.fillColor=e.halo.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function nI(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=ks,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.halo.strokeWidthScaled,t.strokeWidthFixed=e.halo.strokeWidthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=ss,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.halo.strokeColor,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function rI(t,e){id(t,e),t.pattern.type=xn,t.pattern.attributes.text=e.icon.content,t.pattern.attributes.font=e.icon.font,t.pattern.attributes.style=e.icon.style,t.pattern.attributes.size=Co,t.patternMinVisibleSize=e.icon.minVisibleSize,t.patternColor=e.icon.color,t.patternScale=e.icon.scale}function oI(t,e){const s=e.image.fit&&!e.image.tile;id(t,e),t.pattern.type=Yi,t.pattern.attributes.image=e.image.content,t.pattern.attributes.scaled=s,t.pattern.attributes.duplicated=e.image.tile,t.patternScale=s?e.image.scale:0,t.patternMinVisibleSize=e.image.minVisibleSize,t.patternColor=null}function aI(t,e){const s=e.diameterScaled+2*e.innerStroke.widthScaled,i=e.diameterFixed+2*e.innerStroke.widthFixed;t.pieceId=ks,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.outerStroke.widthScaled,t.strokeWidthFixed=e.outerStroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=ss,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.outerStroke.color,t.patternColor=null,t.globalMinVisibleSize=e.outerStroke.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function lI(t,e){const s=e.diameterScaled*of,i=e.diameterFixed*of;let n=e.diameterScaled*af,r=e.diameterFixed*af+ZT;e.outerStroke.color&&(n+=e.outerStroke.widthScaled/2,r+=e.outerStroke.widthFixed/2),t.pieceId=ks,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=ss,t.opacity=e.opacity,t.fillColor=e.outline.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.outline.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=1.5707963267948966,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function dI(t,e){id(t,e),Array.isArray(e.color)&&(t.pattern.type=Fo,t.pattern.attributes.colors=e.color.join(";"),t.patternScale=1,t.patternMinVisibleSize=0,t.patternColor=null)}function hI(t,e,s){Wx(t,e,s),t.pattern.type=Qi,t.pattern.attributes.text=e.content,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternMinVisibleSize=0,t.patternColor=e.color,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function uI(t,e,s){Wx(t,e,s),t.fillColor=e.backgroundColor,t.pieceId=fn,t.shape="square"}function cI(t,e,s){const i=Math.ceil(e.margin/2),n=s.diameterScaled/2,r=s.diameterFixed/2+i,o=s1[e.position],a=Math.cos(o),l=Math.sin(o),d=e.margin<12?1:e.margin<30?1-(e.margin-12)/18*.7:.25;t.pieceId=ks,t.shape="triangle",t.x1=s.x-a,t.y1=s.y-l,t.x2=s.x+a,t.y2=s.y+l,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=e.margin,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=e.margin*d,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=ss,t.opacity=s.opacity,t.fillColor=e.backgroundColor,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1}function Wx(t,e,s){let i=0,n=0;if(e.isPositionCenter||(i+=s.diameterScaled/2,n+=s.diameterFixed/2+e.margin+e.padding),e.isPositionVertical){if(i+=e.heightScaled/2,n+=e.heightFixed/2,e===s.texts.secondary&&s.texts.primary.position==="bottom"){const o=s.texts.primary;i+=o.heightScaled,n+=o.heightFixed+o.margin+2*o.padding}}else e.isPositionHorizontal&&(i+=e.widthScaled/2,n+=e.widthFixed/2);const r=Co;t.pieceId=ks,t.shape="square",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=ss,t.pattern.attributes.size=r,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=1,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function jf(t,e,s,i,n,r){const o=n.badges,a=i.badges,l=r.badges;gI(t,e,s,i,n,r),Hf(t,e,s,i.text,n.texts.primary,r.texts.primary,r),Hf(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r),ha(t,e,s,a.topLeft,o.topLeft,l.topLeft,r),ha(t,e,s,a.topRight,o.topRight,l.topRight,r),ha(t,e,s,a.bottomLeft,o.bottomLeft,l.bottomLeft,r),ha(t,e,s,a.bottomRight,o.bottomRight,l.bottomRight,r)}function gI(t,e,s,i,n,r){if(n.halo){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),iI(n.halo,r),n.haloStroke&&(r.halo.strokeWidthScaled=0,r.halo.strokeWidthFixed=i.halo.strokeWidth.get(s),nI(n.haloStroke,r))}if(n.outline&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),lI(n.outline,r)),n.outerStroke&&(r.outerStroke.minVisibleSize=i.outerStroke.minVisibleSize.get(s),aI(n.outerStroke,r)),n.pieChart&&dI(n.pieChart,r),n.image&&(r.image.content=e.imageManager.getImage(r.image.url),r.image.fit=i.image.fit.get(s),r.image.tile=i.image.tile.get(s),r.image.scale=i.image.scale.get(s),r.image.minVisibleSize=i.image.minVisibleSize.get(s),oI(n.image,r)),n.icon&&(r.icon.font=e.fontManager.getFont(i.icon.font.get(s)),r.icon.style=i.icon.style.get(s),r.icon.color=i.icon.color.get(s),r.icon.scale=i.icon.scale.get(s),r.icon.minVisibleSize=i.icon.minVisibleSize.get(s),rI(n.icon,r)),n.body){const o=!n.pieChart&&!n.image&&!n.icon;sI(n.body,r,o)}}function ha(t,e,s,i,n,r,o){if(n.image||n.text){const a=i.stroke.width.get(s),l=+(i.stroke.scalingMethod.get(s)==="scaled");r.color=Xs(i.color.get(s),o.color,r.angle),r.strokeColor=i.stroke.color.get(s),r.strokeWidthScaled=a*l,r.strokeWidthFixed=a*(1-l),r.minVisibleSize=i.minVisibleSize.get(s),r.positionScale=i.positionScale.get(s),r.scale=i.scale.get(s)}if(n.image&&(r.imageContent=e.imageManager.getImage(r.imageUrl),r.imageScale=i.image.scale.get(s),tI(n.image,r,o)),n.text){if(r.textFont=e.fontManager.getFont(i.text.font.get(s)),r.textStyle=i.text.style.get(s),r.textColor=Xs(i.text.color.get(s),o.color),r.textScale=i.text.scale.get(s),r.textPaddingTop=i.text.paddingTop.get(s),r.textPaddingLeft=i.text.paddingLeft.get(s),t.measureText(r.textContent,r.textFont,r.textStyle,r.textScale).width>1){let a=0,l=0;for(;l<r.textContent.length&&a<1;)a+=t.measureText(r.textContent[l],r.textFont,r.textStyle,r.textScale).width,l+=1;l!==r.textContent.length&&(r.textContent=r.textContent.substring(0,l-1)+"")}eI(n.text,r,o)}}function Hf(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=Xs(a.color.get(s),o.color),r.style=a.style.get(s),r.align=a.align.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=uc(r.content,r.maxLineLength),l){const h=a.scale.get(s);r.sizeScaled=o.diameterScaled*h,r.sizeFixed=o.diameterFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.positionAngle=e1[r.position],r.isPositionCenter=r.position==="center",r.isPositionVertical=r.position==="top"||r.position==="bottom",r.isPositionHorizontal=r.position==="left"||r.position==="right",hI(n.text,r,o),n.background&&(uI(n.background,r,o),n.tip&&cI(n.tip,r,o))}}function Wf(t,e){fI(t,e),Xf(t.texts.primary,e.texts.primary),Xf(t.texts.secondary,e.texts.secondary),ua(t.badges.topLeft,e.badges.topLeft),ua(t.badges.topRight,e.badges.topRight),ua(t.badges.bottomLeft,e.badges.bottomLeft),ua(t.badges.bottomRight,e.badges.bottomRight)}function fI(t,e){t.body=!0,t.icon=!!e.icon.content,t.image=!!e.image.url,t.pieChart=Array.isArray(e.color),t.outerStroke=!!e.outerStroke.color,t.outline=!!e.outline.enabled,t.halo=!!e.halo.color,t.haloStroke=t.halo&&!!e.halo.strokeColor}function Xf(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor,t.tip=t.background&&e.tip&&e.position!=="center"}function ua(t,e){t.text=!!e.textContent,t.image=!!e.imageUrl}function Yf(t,e,s,i){mI(t,e,s,i),$f(t,e.texts.primary,s.text,i,e),$f(t,e.texts.secondary,s.text.secondary,i,e),ca(t,e.badges.topLeft,s.badges.topLeft,i),ca(t,e.badges.topRight,s.badges.topRight,i),ca(t,e.badges.bottomLeft,s.badges.bottomLeft,i),ca(t,e.badges.bottomRight,s.badges.bottomRight,i)}function mI(t,e,s,i){const n=+(s.scalingMethod.get(i)==="scaled"),r=2*s.radius.get(i),o=s.innerStroke.width.get(i),a=+(s.innerStroke.scalingMethod.get(i)==="scaled"),l=s.outerStroke.width.get(i),d=+(s.outerStroke.scalingMethod.get(i)==="scaled");e.x=s.x.get(i),e.y=s.y.get(i),e.shape=s.shape.get(i),e.color=s.color.get(i),e.opacity=s.opacity.get(i),e.diameterScaled=r*n,e.diameterFixed=r*(1-n),e.innerStroke.color=Xs(s.innerStroke.color.get(i),e.color),e.innerStroke.widthScaled=o*a,e.innerStroke.widthFixed=o*(1-a),e.innerStroke.minVisibleSize=s.innerStroke.minVisibleSize.get(i),e.outerStroke.color=Xs(s.outerStroke.color.get(i),e.color),e.outerStroke.widthScaled=l*d,e.outerStroke.widthFixed=l*(1-d),e.halo.color=s.halo.color.get(i),e.halo.strokeColor=s.halo.strokeColor.get(i),e.icon.content=t.formatText(s.icon.content.get(i)),e.image.url=s.image.url.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1}function $f(t,e,s,i,n){if(e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=Xs(s.backgroundColor.get(i),n.color),e===n.texts.primary){const r=s;e.tip=r.tip.get(i),e.position=r.position.get(i)}else e.position="bottom"}function ca(t,e,s,i){const n=s.text.content.get(i);e.textContent=t.formatText(n),e.imageUrl=s.image.url.get(i)}var ga=t=>({angle:t,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,textContent:"",textFont:"",textColor:"",textScale:0,textStyle:"none",imageUrl:"",imageContent:null,imageScale:0,textPaddingLeft:0,textPaddingTop:0}),Zf=()=>({hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1}),Kf=()=>({x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,style:"none",minVisibleSize:0},image:{url:"",content:null,scale:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:!1,color:"",minVisibleSize:0},badges:{topLeft:ga(cx),topRight:ga(gx),bottomLeft:ga(fx),bottomRight:ga(mx)},textHidden:!1,texts:{primary:Zf(),secondary:Zf()}}),_I=(t,e)=>{e.haloStroke=e.haloStroke||t.haloStroke,e.halo=e.halo||t.halo,e.outline=e.outline||t.outline,e.outerStroke=e.outerStroke||t.outerStroke,e.body=e.body||t.body,e.pieChart=e.pieChart||t.pieChart,e.image=e.image||t.image,e.icon=e.icon||t.icon;const s=t.badges,i=e.badges;i.topLeft.text=i.topLeft.text||s.topLeft.text,i.topLeft.image=i.topLeft.image||s.topLeft.image,i.topRight.text=i.topRight.text||s.topRight.text,i.topRight.image=i.topRight.image||s.topRight.image,i.bottomLeft.text=i.bottomLeft.text||s.bottomLeft.text,i.bottomLeft.image=i.bottomLeft.image||s.bottomLeft.image,i.bottomRight.text=i.bottomRight.text||s.bottomRight.text,i.bottomRight.image=i.bottomRight.image||s.bottomRight.image;const n=t.texts,r=e.texts;r.primary.text=r.primary.text||n.primary.text,r.primary.background=r.primary.background||n.primary.background,r.primary.tip=r.primary.tip||n.primary.tip,r.secondary.text=r.secondary.text||n.secondary.text,r.secondary.background=r.secondary.background||n.secondary.background,r.secondary.tip=r.secondary.tip||n.secondary.tip},Xx=t=>(e,s)=>{s.haloStroke=e.haloStroke[t],s.halo=e.halo[t],s.outline=e.outline[t],s.outerStroke=e.outerStroke[t],s.body=e.body[t],s.pieChart=e.pieChart[t],s.image=e.image[t],s.icon=e.icon[t];const i=e.badges,n=s.badges;n.topLeft.text=i.topLeft.text[t],n.topLeft.image=i.topLeft.image[t],n.topRight.text=i.topRight.text[t],n.topRight.image=i.topRight.image[t],n.bottomLeft.text=i.bottomLeft.text[t],n.bottomLeft.image=i.bottomLeft.image[t],n.bottomRight.text=i.bottomRight.text[t],n.bottomRight.image=i.bottomRight.image[t];const r=e.texts,o=s.texts;o.primary.text=r.primary.text[t],o.primary.background=r.primary.background[t],o.primary.tip=r.primary.tip[t],o.secondary.text=r.secondary.text[t],o.secondary.background=r.secondary.background[t],o.secondary.tip=r.secondary.tip[t]},pI=Xx("start"),yI=Xx("end"),xI=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,attributes:n,attributesPrev:r}){this._fullComponents=Cr(),this._startComponents=Cr(),this._endComponents=Cr(),this._startFlags=Cr(),this._endFlags=Cr(),this._startInput=Kf(),this._endInput=Kf(),this._depthInfo=bc(),this._nodePatternAssigned=!1,this._nullElt={id:-1,valid:!0},this._engine=t,this._attributes=n,this._attributesPrev=r,this._helper={imageManager:e,fontManager:s,formatText:i},this._layers=Qf(()=>t.createGroup()),this._blockIds=Qf(()=>0)}drawNode(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=t,n=this._attributes,r=_o(n.layer.get(t)-(n.detectable.get(t)?0:.5),this._depthInfo),o=n.animationDuration.get(t),a=o>0;if(this._prepareBlocks(a,r,i),Yf(s,this._endInput,n,t),Wf(this._endFlags,this._endInput),a&&(Yf(s,this._startInput,this._attributesPrev,t),Wf(this._startFlags,this._startInput),_I(this._endFlags,this._startFlags)),this._initComponents(this._fullComponents,this._endFlags,this._layers),yI(this._fullComponents,this._endComponents),jf(e,s,t,n,this._endComponents,this._endInput),a&&(pI(this._fullComponents,this._startComponents),jf(e,s,t,this._attributesPrev,this._startComponents,this._startInput)),a){const l=this._attributes.animationStart.get(t),d=this._attributes.animationEasing.get(t);this._setBlocksAnimation(o,l,d)}this._endFlags.halo&&this._attributes.halo.hideNonAdjacentEdges.get(t)&&(this._layers.halo.stencilUsage=this._layers.haloStroke.stencilUsage=rx),this._storeBlocks()}_computeBlockIds(t){const e=t*Kl,s=this._blockIds;s.body=e+DT,s.text=e+OT,s.textBg=e+kT,s.halo=e+zT,s.haloStroke=e+BT}_prepareBlocks(t,e,s){const i=this._layers;i.body.reset(qs,t,e.nodeBody,s),i.text.reset(yn,t,e.nodeText,s),i.textBg.reset(qs,t,e.nodeTextBackground,s),i.halo.reset(qs,t,e.nodeHalo,s),i.haloStroke.reset(qs,t,e.nodeHaloStroke,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg),t.storeGroup(s.halo,e.halo),t.storeGroup(s.haloStroke,e.haloStroke)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.text),t.freeBlock(e.textBg),t.freeBlock(e.halo),t.freeBlock(e.haloStroke)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.haloStroke.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._nodePatternAssigned=!1,this._initBaseComponents(t,e,s),this._initBadgeComponents(t.badges.topLeft,e.badges.topLeft,s),this._initBadgeComponents(t.badges.topRight,e.badges.topRight,s),this._initBadgeComponents(t.badges.bottomLeft,e.badges.bottomLeft,s),this._initBadgeComponents(t.badges.bottomRight,e.badges.bottomRight,s),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initBaseComponents(t,e,s){t.haloStroke=this._nextElement(e.haloStroke,s.haloStroke),t.halo=this._nextElement(e.halo,s.halo),t.outline=this._nextElement(e.outline,s.body),t.outerStroke=this._nextElement(e.outerStroke,s.body),t.body=this._nextElement(e.body,s.body),t.pieChart=this._getNodePatternElement(e.pieChart,s),t.image=this._getNodePatternElement(e.image,s),t.icon=this._getNodePatternElement(e.icon,s)}_initBadgeComponents(t,e,s){t.image=this._nextElement(e.image,s.body),t.text=this._nextElement(e.text,s.body)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.tip=this._nextElement(e.tip,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}_getNodePatternElement(t,e){return t?this._nodePatternAssigned?e.body.next():(this._nodePatternAssigned=!0,e.body.getCurrentElement()):this._nullElt}};function Qf(t){return{body:t(),text:t(),textBg:t(),halo:t(),haloStroke:t()}}function Cr(){return{haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}}}function bI({graph:t,elements:e,engine:s,imageManager:i,fontManager:n,view:r,attributes:o,boundaries:a,formatText:l}){const{nodeAttributes:d,nodeAttributesPrev:h,edgeAttributes:u,edgeAttributesPrev:c}=vI(o),{nodes:g,edges:f}=e,{maxSize:m,maxMinVisibleSize:_}=a;if(!g.size&&!f.size)return;const p=(Math.max(t.getNodeMaxIndex(),t.getEdgeMaxIndex())+1)*Kl,x=m<1024?8*m:2*m,y=s.setGlobalBoundaries({maxBlockId:Hi(p),maxScaledSize:Hi(x),maxMinVisibleSize:Hi(_),maxSymbolicSize:Hi(m),maxDashLength:3,maxGapLength:1,maxPatternScale:2,maxCoord:-1/0}),b=(y?t.getNodes("_all"):g)._indexes,v=(y?t.getEdges("_all"):f)._indexes;if(b.length){const E=new xI({engine:s,imageManager:i,fontManager:n,formatText:l,attributes:d,attributesPrev:h});for(let A=0;A<b.length;++A)E.drawNode(b[A])}if(v.length){const E=new J2({engine:s,imageManager:i,fontManager:n,formatText:l,view:r,attributes:u,attributesPrev:c,nodeAttributes:d,nodeAttributesPrev:h});for(let A=0;A<v.length;++A)E.drawEdge(v[A])}}function vI(t){const e=Vn(t.nodes.current,{text:{secondary:{scaling:t.nodes.current.text.scaling,maxLineLength:t.nodes.current.text.maxLineLength}}});return{nodeAttributes:e,nodeAttributesPrev:Vn(t.nodes.previous,{textHidden:e.textHidden,text:{secondary:{scaling:t.nodes.previous.text.scaling,maxLineLength:t.nodes.previous.text.maxLineLength}}}),edgeAttributes:Vn(t.edges.current,{text:{secondary:{scaling:t.edges.current.text.scaling,maxLineLength:t.edges.current.text.maxLineLength,adjustAngle:t.edges.current.text.adjustAngle}}}),edgeAttributesPrev:Vn(t.edges.previous,{source:t.edges.current.source,target:t.edges.current.target,textHidden:t.edges.current.textHidden,text:{secondary:{scaling:t.edges.previous.text.scaling,maxLineLength:t.edges.previous.text.maxLineLength,adjustAngle:t.edges.previous.text.adjustAngle}}})}}function po(t,e,s){const i=s.length;let n=i-1,r=!1;for(let o=0;o<i;++o)(s[o].y<e&&s[n].y>=e||s[n].y<e&&s[o].y>=e)&&(s[o].x<=t||s[n].x<=t)&&(r=r!==s[o].x+(e-s[o].y)/(s[n].y-s[o].y)*(s[n].x-s[o].x)<t),n=o;return r}function fa(t){const e=t.x*t.x+t.y*t.y;return{x:t.x/e,y:t.y/e}}function Jf(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=o.x*e.x+o.y*e.y;a<s&&(s=a),a>i&&(i=a)}return{x:s,y:i}}function EI(t,e){let s=t[1],i=t[0],n=fa({x:s.x-i.x,y:s.y-i.y}),r=n.x;n.x=-n.y,n.y=r;const o=n;s=t[2],i=t[1],n=fa({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const a=n;s=e[1],i=e[0],n=fa({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const l=n;return s=e[2],i=e[1],n=fa({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r,[o,a,l,n]}function Yx(t,e){const s=EI(t,e);for(let i=0,n=s.length;i<n;i++){const r=s[i],o=Jf(t,r),a=Jf(e,r);if((o.x<=a.y&&o.y>=a.x?Math.min(o.y,a.y)-Math.max(o.x,a.x):0)===0)return!1}return!0}function AI(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}var SI=vc(4),wI=vc(5),TI=vc(10,.4),vl=1/3,II=[{x:-1,y:-.3333333333333333},{x:0,y:-.3333333333333333},{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:0,y:vl},{x:-1,y:vl}],CI=[{x:-1,y:-.3333333333333333},{x:-.55,y:-.3333333333333333},{x:-1,y:-1},{x:1,y:0},{x:-1,y:1},{x:-.55,y:vl},{x:-1,y:vl}],tm=[{x:-.6,y:-.3},{x:.1,y:0},{x:-.6,y:.3}],LI={circle:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>1-Math.sqrt(t*t+e*e),points:[{x:0,y:0,r:1}],isSimple:!0},square:{getDistanceFromStrokeVertically:(t,e)=>.996-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>.996-Math.abs(t),points:[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],isSimple:!0},line:{getDistanceFromStrokeVertically:(t,e)=>1-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:0},{x:1,y:0}],isSimple:!0},triangle:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},arrow:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},"circle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>Math.min(Math.sqrt((t+.4)*(t+.4)+e*e)-.27,(1-t)/2-Math.abs(e)),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:[{x:-.4,y:0,r:.3}],isSimple:!0},"triangle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>{const s=Math.min((1-t)/2-Math.abs(e),1-Math.abs(t)),i=-$x(t,e,tm);return Math.min(s,i)},getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:tm,isSimple:!0},"short-arrow":Lr(II,!1),"sharp-arrow":Lr(CI,!1),cross:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>{const s=Math.abs(t),i=Math.abs(e),n=.31-Math.min(s,i),r=1-Math.max(s,i);return Math.min(n,r)},points:[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}],isSimple:!1},diamond:Lr(SI),pentagon:Lr(wI),star:Lr(TI)},NI=["circle","square","triangle","line"],MI=["cross","diamond","pentagon","star"],PI=["arrow","triangle-hole-arrow","circle-hole-arrow","short-arrow","sharp-arrow"];function em(t,e){for(const r of NI)kd(t,r);const s=e.nodes.current.shape.getValues(),i=e.edges.current.shape.head.getValues(),n=e.edges.current.shape.tail.getValues();for(const r of MI)s.includes(r)&&kd(t,r);for(const r of PI)r&&(i.includes(r)||n.includes(r))&&kd(t,r)}function kd(t,e){t.registerShape(e,LI[e])}function $x(t,e,s){let i=1/0;const n={x:t,y:e};for(let r=0;r<s.length;++r){const o=s[r],a=s[(r+1)%s.length];i=Math.min(i,Lx(n,o,a))}return i*(po(t,e,s)?1:-1)}function vc(t,e=1){const s=-Math.PI/2+ux,i=[],n=2*Math.PI/t;let r=s;for(let o=0;o<t;++o){const a=o%2==1?e:1;i.push({x:Math.cos(r)*a,y:Math.sin(r)*a}),r+=n}return i}function Lr(t,e=!1){return{getDistanceFromStrokeVertically:()=>1,getDistanceFromStrokeHorizontally:(s,i)=>$x(s,i,t),points:t,isSimple:e}}var RI=class extends Ro{constructor(t,e){super(),this.isDummy=!0,this.width=0,this.height=0,this.namespaceURI="http://www.w3.org/1999/xhtml"}setAttribute(t,e){t==="src"&&(this.src=e),t==="crossOrigin"&&(this.crossOrigin=e)}set src(t){t&&(this._src=t,setTimeout(()=>{this.onload&&this.onload.call(this),this.width=1,this.height=1,this.fire("load")},10))}get src(){return this._src}addEventListener(t,e){this.on(t,e)}};function FI(t,e){return new(typeof Image<"u"?Image:RI)(t,e)}var DI=class{constructor(){this._images={},this._crossOrigin="anonymous",this._whenReady=[],this._onFetch=[],this._nbLoaded=0,this._nbToLoad=0}setImgCrossOrigin(t){this._crossOrigin=t}clear(){this._images={},this._nbLoaded=0,this._nbToLoad=0}getImage(t){let e=this._images[t];return e===void 0&&(this._nbToLoad+=1,e=FI(),e.crossOrigin=this._crossOrigin,e.addEventListener("load",()=>this._onImgLoad(t)),e.addEventListener("error",()=>{this._onImgLoad(t),this._images[t]=null}),eA(e,"src",t),this._images[t]=e),e}_onImgLoad(t){this._nbLoaded+=1,this._onFetch.forEach(e=>e(t)),this._nbLoaded===this._nbToLoad&&(this._whenReady.forEach(e=>e()),this._whenReady=[])}onFetch(t){this._onFetch.push(t)}whenReady(){return this._nbLoaded===this._nbToLoad?Promise.resolve():new Promise(t=>this._whenReady.push(t))}destroy(){this._whenReady=[],this._onFetch=[]}},Ec={};function OI(t){let e="";for(let s=0;s<t.length;s++)e+=t[s].cssText+`
`;return e}function Zx(){const t=Ii(),e=t.styleSheets||[],s=ty(t),i=[],n=[];for(let o=0;o<e.length;o++){const a=e[o];a.href==null?i.push({href:s,content:OI(a.cssRules)}):n.push(a.href)}const r=/@font-face\s*\{[^}]+\}/g;return Promise.all(n.map(o=>pr(o).then(a=>({href:o,content:a})).catch(el))).then(o=>o.concat(i)).then(o=>{const a=[];for(let l=0;l<o.length;l++){const d=o[l];if(d!==null){const{href:h,content:u}=d,c=u.match(r);if(c){const g=zI(c,h);a.push.apply(a,g)}}}return a})}function Kx(t,e){return Promise.all(t.map(({formats:s,originalRule:i})=>Promise.all(s.map(({format:n,url:r})=>e?Jp(r).then(o=>({format:n,src:o})).catch(el):{format:n,src:r})).then(n=>{const r=[];for(const o of n)o!==null&&r.push(`url('${o.src}') format('${o.format}')`);if(r.length!==0){const o=`src: ${r.join(",")}`;return i.replace(/@font-face\s*{([^}]*);?}/,`@font-face{$1;${o}}`).replace(/\s+/," ").replace(/;+/,";")}return i})))}So(Ec,{BUTTON_MAPPING:()=>zu,BoundingBox:()=>cs,DummyCanvas:()=>_x,DummyCanvasRenderingContext2D:()=>px,DummyDomElement:()=>Hp,DummyFileReader:()=>Vp,DummyTextNode:()=>nb,DummyXHR:()=>Gp,ElementSet:()=>Oo,EventTarget:()=>Ro,FlexArray:()=>ul,IndexList:()=>gy,MOUSE_WHEEL_THROTTLE:()=>Op,Map2:()=>nx,PathMap:()=>Jx,PrioritySet:()=>qy,SVG_NS:()=>Ou,Table:()=>bh,XLINK:()=>Yp,XML_NS:()=>uh,applyCursorStyle:()=>rl,baseURI:()=>ty,binaryIndexOf:()=>sp,cancelAnimFrame:()=>kp,clamp:()=>Os,clearCanvas:()=>Bh,componentsToRGBA:()=>ex,computeMax:()=>jn,computeMin:()=>yi,concatenateArrays:()=>Bv,createBlob:()=>lo,createCanvas:()=>We,createDummyDomElement:()=>il,createDummyXmlDocument:()=>ob,createElement:()=>ch,createSvgElement:()=>ie,createTextNode:()=>ku,createWebGL2Context:()=>xx,createWorker:()=>sb,createXmlDocument:()=>ab,dataUrlToBlob:()=>Wp,debounce:()=>Vv,deepCopy:()=>Ae,displayPixelsOnScreen:()=>XI,ensureTransferable:()=>kl,escapeDOMAttribute:()=>qn,extendList:()=>Hv,fadeElement:()=>ey,fetch:()=>pr,fetchBinary:()=>Qp,fetchBinaryAsBase64:()=>Jp,flatten:()=>ao,flattenArray:()=>ep,forEach:()=>ri,formatAngle:()=>ol,formatHex:()=>Xa,formatWorkerMessage:()=>eb,getBaseLog:()=>sy,getCurrentTime:()=>ts,getDate:()=>lp,getDocument:()=>Ii,getDocumentFontRules:()=>Zx,getEmbeddedFontRules:()=>Kx,getFlattenedKeys:()=>Tn,getGlContext:()=>bx,getImage:()=>$p,getLeafValues:()=>Ol,getOptions:()=>As,getPixelRatio:()=>ps,getProperty:()=>ve,getResizeObserver:()=>qp,getStyle:()=>jp,getTime:()=>dp,getValues:()=>Zr,getWebglContext:()=>hc,hash8:()=>ah,htmlSanitizer:()=>Bu,indexArrayToArray:()=>oo,indexByName:()=>Wv,insertSortAsc:()=>Dr,insertSortDesc:()=>zv,isArray:()=>He,isBlob:()=>fA,isHTMLElement:()=>Kp,isInteger:()=>Gv,isLittleEndian:()=>Dl,isObject:()=>Ce,isRawObject:()=>wn,isWebGLSupported:()=>yx,lerp:()=>ne,mapKeys:()=>sx,mapValues:()=>ix,merge:()=>Vn,mergeValues:()=>Qa,mix:()=>gh,nextPowerOfTwo:()=>Hi,objToValueList:()=>nd,parseColor:()=>es,parseColorHex:()=>sc,parseColorRgba:()=>ec,pick:()=>dh,processQueue:()=>qv,promiseQueue:()=>np,promptDownload:()=>nn,propertyPathToString:()=>oh,removeFromArray:()=>Uv,requestAnimFrame:()=>Ru,resizeElement:()=>nl,resolvePath:()=>Qx,rgbaToRgb:()=>Un,serializeXMLDocument:()=>Ac,setAttributes:()=>Du,setCtxFont:()=>Ji,setElementSize:()=>Cn,setKeys:()=>VI,setProperty:()=>vi,setValues:()=>qr,smartRequire:()=>Ds,throttle:()=>Fl,toArray:()=>rh,toHexa:()=>Oh,toPropertyPath:()=>Sn,traverse:()=>op,unflatten:()=>lh,unorderedHash:()=>jv,workerIsAvailable:()=>tb});var kI={"embedded-opentype":!0,svg:!0};function zI(t,e){const s=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g,i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/,n=[];for(let r=0;r<t.length;r++){const o=t[r],a=o.match(i);if(a){const l=a[1],d=[];let h;for(;h=s.exec(o);){const u=h[1],c=h[2];kI[c.toLowerCase()]||d.push({format:c,url:Qx(u,e)})}n.push({name:l,formats:d,originalRule:o})}}return n}function Qx(t,e){if(/^http(s)?:/.test(t))return t;if(t[0]==="/"){const n=e.match(/((\w+:\/\/)([^/]+))/);return n?n[1]+t:t}const s=t.split("/"),i=e.split("/");for(e[e.length-1]!=="/"&&i.pop();s[0]==="..";)s.shift(),i.pop();return i.concat(s).join("/").replace(/[\w](\/{2,})/g,n=>n[0]+"/")}function BI(t){return t instanceof RegExp||t instanceof Date}var UI=typeof HTMLElement>"u"?t=>!1:t=>t instanceof HTMLElement,GI=function(t){return typeof t!="object"||t===null||He(t)||BI(t)};function nd(t,e=[],s=[]){if(!UI(t)){if(GI(t))e.push({path:s.slice(),value:t});else{const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=s.slice();o.push(r),nd(t[r],e,o)}}return e}}var Jx=class{constructor(){this._keys=[],this._values=[],this._size=0,this._cachedPath=[],this._cachedIndex=-1}get size(){return this._size}set(t,e){const s=this._getIndex(t);s!==-1?this._values[s]=e:(zd(this._cachedPath,t)&&(this._cachedIndex=this._keys.length),this._keys.push(t),this._values.push(e),this._size+=1)}get(t){const e=this._getIndex(t);if(e!==-1)return this._values[e]}has(t){return this._getIndex(t)!==-1}keys(){return this._keys.slice()}_getIndex(t){if(zd(t,this._cachedPath))return this._cachedIndex;this._cachedPath=t.slice();const e=this._keys;for(let s=0;s<e.length;++s)if(zd(e[s],t))return this._cachedIndex=s,s;return this._cachedIndex=-1,-1}};function zd(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}var jh,VI=function(e){return Array.from(e.keys())},qr=function(e){return Array.from(e.values())},yo=Ds("web-worker"),tb=!!yo||typeof Worker<"u"&&typeof Blob<"u";function eb(t){return yo?Hh(t):t}function Hh(t){if(ArrayBuffer.isView(t))return Array.from(t);if(Array.isArray(t)){for(let e=0;e<t.length;e++)t[e]=Hh(t[e]);return t}if(Ce(t)){const e=Object.keys(t);for(const s of e)t[s]=Hh(t[s]);return t}return t}function sb(t){return yo?jI(t.toString()):qI(t)}function qI(t){return sA(zE(t))}function jI(t){if(yo)return new yo("data:application/javascript,"+t.replace(/\n/g,""))}var sm=Ds("@xmldom/xmldom");jh=typeof XMLSerializer<"u"?XMLSerializer:sm?sm.XMLSerializer:null;var HI=class ib{constructor(e){this._attributes={},this._children=[],this._name=e}setAttribute(e,s){this._attributes[e]=s}appendChild(e){this._children.push(e)}get tagName(){return this._name}get children(){return this._children}get childNodes(){return this._children}get firstChild(){return this._children[0]||null}serialize(){const e=this._name,s=this._attributes,i=this._children,n=Object.keys(s).filter(o=>s[o]!==void 0).map(o=>` ${o}="${""+s[o]}"`).join(""),r=i.map(o=>o.serialize()).join("");return r.length?`<${e}${n}>${r}</${e}>`:`<${e}${n}/>`}cloneNode(e){const s=new ib(this._name),i=Object.keys(this._attributes);for(const n of i)s.setAttribute(n,this._attributes[n]);if(e)for(let n=0;n<this._children.length;n++)s.appendChild(this._children[n].cloneNode(e));return s}},nb=class rb{constructor(e){this._text=e}serialize(){return this._text}cloneNode(){return new rb(this._text)}},WI=class{constructor(){this._children=[],this._meta=[],this._children=[],this._meta=[]}appendChild(t){this._children.push(t)}serialize(){return this._meta.concat(this._children.map(t=>t.serialize())).join("")}createElement(t){return new HI(t)}createTextNode(t){return new nb(t)}},ob=()=>new WI;function Ac(t){if(jh)return new jh().serializeToString(t)}var ab=()=>Ii().implementation.createDocument("","",null),Oo=class{constructor(t,e){this._graph=t,this._nodes={elementList:t.nodeList,flexArray:t.createNodeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!0)},this._edges={elementList:t.edgeList,flexArray:t.createEdgeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!1)}}_get(t){return t.isNode?this._nodes:this._edges}addOrRemoveElements(t,e){return e?this.addElements(t):this.removeElements(t)}addElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength();for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];s.get(o)!==1&&(s.set(o,1),i.pushUnchecked(o))}return e(i.slice(n))}removeElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength(),r=i.getBuffer();if(n>r.length)return this.clear(),this.addElements(t),t;let o=0;for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];s.get(l)!==0&&(s.set(l,0),o+=1)}if(o===n)return e(i.sliceAndReset());if(o===0)return e();{const a=this._graph.acquireIndexList(t.isNode);let l=0;for(let d=0;d<n;++d){const h=r[d];s.get(h)===0?(l+=1,a.pushUnchecked(h)):r[d-l]=h}return i.setLength(n-o),e(a.sliceAndReset())}}hasElement(t){return!!this._get(t).flexArray.get(t._index)}clear(){this._nodes.indexList.isEmpty()||(this._nodes.indexList.reset(),this._nodes.flexArray.reset()),this._edges.indexList.isEmpty()||(this._edges.indexList.reset(),this._edges.flexArray.reset())}isEmpty(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()}getElements(){return{nodes:this._nodes.elementList(this._nodes.indexList.slice()),edges:this._edges.elementList(this._edges.indexList.slice())}}};function XI(t,e,s,i=0){e===void 0&&(e=s=Math.sqrt(t.length/4)),s===void 0&&(s=e);const n=document.createElement("canvas"),r=n.getContext("2d");if(r){const o=r.createImageData(e,s);n.style.imageRendering="pixelated",n.style.border="1px solid black",n.style.margin="2px",n.style.position="absolute",n.style.top=n.style.left="0px",n.width=e,n.height=s,o.data.set(t),r.putImageData(o,0,0);const a=document.getElementById("graph-container");a&&(a.style.position="static"),setTimeout(()=>document.body.appendChild(n),i)}}var YI=class{constructor(t,e){this._attributesManager=t,this._id=e}getDefinition(){return this._attributesManager.getAttributeLayerDefinition(this._id)}update(t){this._attributesManager.updateAttributeLayer(this._id,t)}destroy(){this._attributesManager.destroyAttributeLayer(this._id)}updateElements(t){this._attributesManager.updateElementsForAttributeLayer(this._id,t)}updateAll(){this._attributesManager.updateAllForAttributeLayer(this._id)}setAttributeValues(t,e,s){this._attributesManager.setAttributeLayerValues(this._id,t,e,s)}getUsedAttributeNames(t){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,t)}getFlexArrays(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)}},Sc={};So(Sc,{cubicIn:()=>QI,cubicInOut:()=>tC,cubicOut:()=>JI,linear:()=>El,quadraticIn:()=>$I,quadraticInOut:()=>KI,quadraticOut:()=>ZI});var El=t=>t,$I=t=>t*t,ZI=t=>t*(2-t),KI=t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1),QI=t=>t*t*t,JI=t=>--t*t*t+1,tC=t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2),eC={name:"animationStart",storage:32,default:0},sC={name:"animationDuration",storage:16,default:0},iC={name:"animationEasing",storage:"resource",default:"linear"},nC={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentNodes:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},rC={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},extremities:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},parallelEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},oC={x:1,y:1,radius:1,"halo.hideNonAdjacentEdges":1};function so(t){return typeof t=="string"}var hs="Arial",tn="black",Al="rgba(255,255,255,0)",gr=12,xo=3,wc=7,aC=!0,Tc=10,lC=5,lb=.08,db="rgba(255,255,255,0)",hb="normal",ub="center",cb=!1,gb=0,Wh="red",fb="rgb(220, 220, 220)",mb="red",_b="rgb(220, 220, 220)",Xh=1,pb="scaled",yb="grey",xb=1,bb=0,vb=0,Eb=!0,Ab=0,Sb=!0,wb="line",Tb=null,Ib=null,Cb="plain",Lb="inherit",Yh=0,Nb="fixed",Mb=0,Pb=null,$h=10,Rb="fixed",Fb=1e3,Db=800,Ob="rgba(0, 0, 0, 0.6)",kb="rgba(0, 0, 0, 0)",zb=10,Bb=1,Ub=2,Gb="rgba(0, 0, 0, 0.36)",Vb=0,dC=1,qb="normal",jb="center",Hb=2,Zh=2,Wb=Do,Xb=4,Yb=!0,$b=4,Kh=2,Qh=12,Zb=2;function hC(t,e,s){let i,n,r,o;s==="line"?(i="line",n="plain",r=null,o=null):s==="arrow"?(i="line",n="plain",r="arrow",o=null):s==="tapered"?(i="triangle",n="plain",r=null,o=null):s==="dashed"?(i="line",n="dashed",r=null,o=null):s==="dotted"&&(i="line",n="dotted",r=null,o=null),t.shape.body.set(e,i),t.shape.style.set(e,n),t.shape.head.set(e,r),t.shape.tail.set(e,o)}var Kb={width:{_flexArray:Xh,_check:re(Xh)},scalingMethod:{_flexArray:pb,_check:Wi},color:{_flexArray:yb,_check:q2},opacity:{_flexArray:xb,_check:pe},minVisibleSize:{_flexArray:bb,_check:pe},layer:{_flexArray:vb,_check:qx},detectable:{_flexArray:Eb,_check:je},curvature:{_flexArray:Ab,_check:vn},adjustAnchors:{_flexArray:Sb,_check:je},shape:{_check:H2,_set:hC,type:"shape.head",body:{_flexArray:wb,_check:W2},head:{_flexArray:Tb,_check:Vf},tail:{_flexArray:Ib,_check:Vf},style:{_flexArray:Cb,_check:X2}},stroke:{color:{_flexArray:Lb,_check:Qe},width:{_flexArray:Yh,_check:re(Yh)},scalingMethod:{_flexArray:Nb,_check:Wi},minVisibleSize:{_flexArray:Mb,_check:pe}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:Pb,_check:Xi},width:{_flexArray:$h,_check:re($h)},scalingMethod:{_flexArray:Rb,_check:Wi},size:"halo.width"},pulse:{enabled:{_flexArray:!1,_check:je},duration:{_flexArray:Fb,_check:pe},interval:{_flexArray:Db,_check:pe},startColor:{_flexArray:Ob,_check:Qe},endColor:{_flexArray:kb,_check:Qe},width:{_flexArray:zb,_check:pe},startRatio:{_flexArray:Bb,_check:pe},endRatio:{_flexArray:Ub,_check:pe}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:je},color:{_flexArray:Gb,_check:Xi},minVisibleSize:{_flexArray:Vb,_check:pe}},text:{_alias:"text.content",content:{_flexArray:null,_check:xi},font:{_flexArray:hs,_check:tr},color:{_flexArray:tn,_check:Xi},size:{_flexArray:gr,_check:re(gr)},scale:{_flexArray:1,_check:pe},style:{_flexArray:qb,_check:er},align:{_flexArray:jb,_check:bl},margin:{_flexArray:Hb,_check:vn},padding:{_flexArray:Zh,_check:re(Zh)},backgroundColor:{_flexArray:Al,_check:Qe},minVisibleSize:{_flexArray:Xb,_check:pe},position:{_flexArray:Wb,_check:V2},adjustAngle:{_flexArray:Yb,_check:je},scaling:{_flexArray:cb,_check:je},maxLineLength:{_flexArray:gb,_check:pe},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:xi},font:{_flexArray:hs,_check:tr},color:{_flexArray:tn,_check:Xi},size:{_flexArray:Qh,_check:re(Qh)},scale:{_flexArray:lb,_check:pe},style:{_flexArray:hb,_check:er},align:{_flexArray:ub,_check:bl},margin:{_flexArray:Zb,_check:vn},padding:{_flexArray:Kh,_check:re(Kh)},backgroundColor:{_flexArray:db,_check:Qe},minVisibleSize:{_flexArray:$b,_check:pe}}}},Qb="grey",Jb="white",Ic=2,t0=null,Cc=5,Jh=0,e0="rgba(0, 0, 0, 0.36)",uC=1,cC="circle",tu=12,jr="white",ma=12,Hr="black",Kn=2,Wr="black",Lc=40,s0=null,i0=null,Nc=1,n0="black",r0=1e3,o0=800,a0=1,l0=2,d0="rgba(0, 0, 0, 0.0)",h0="rgba(0, 0, 0, 0.6)",u0=50,gC=.1,ji=12,_a=24,bo=1,im=bo/2,nm=.45,rm=.7,fC=10,c0=fC/2,g0=5,mC=re(g0),_C=re(gr),pC=re(Tc),yC=re(Ic),xC=re(Cc),bC=re(wc),om=re(xo),vC=re(c0),EC=re(Lc),AC=re(Nc);function pa(t){return{_check:xi,_set:(e,s,i)=>{e.badges[t].text.content.set(s,i),i==null&&e.badges[t].image.url.set(s,i)},_get:(e,s)=>e.badges[t].text.content.get(s),color:{_flexArray:jr,_check:Qe},scale:{_flexArray:nm,_check:re(nm)},positionScale:{_flexArray:1,_check:pe},minVisibleSize:{_flexArray:ji,_check:re(ji)},image:{_alias:`badges.${t}.image.url`,url:{_flexArray:null,_check:xi},scale:{_flexArray:bo,_check:re(bo)}},stroke:{color:{_flexArray:Hr,_check:Qe},width:{_flexArray:Kn,_check:re(Kn)},scalingMethod:{_flexArray:"fixed",_check:Wi}},text:{_alias:`badges.${t}.text.content`,content:{_flexArray:null,_check:xi},color:{_flexArray:Wr,_check:Qe},font:{_flexArray:hs,_check:tr},style:{_flexArray:"normal",_check:er},scale:{_flexArray:im,_check:re(im)},paddingLeft:{_flexArray:0,_check:vn},paddingTop:{_flexArray:0,_check:vn}}}}var f0={x:{_flexArray:0,_check:vn,_disableMemoryOptimization:!0},y:{_flexArray:0,_check:vn,_disableMemoryOptimization:!0},radius:{_flexArray:g0,_check:mC},scalingMethod:{_flexArray:"scaled",_check:Wi},color:{_flexArray:Qb,_check:$2},opacity:{_flexArray:1,_check:pe},shape:{_flexArray:"circle",_check:j2},layer:{_flexArray:0,_check:qx},detectable:{_flexArray:!0,_check:je},draggable:{_flexArray:!0,_check:je},layoutable:{_flexArray:!0,_check:je},innerStroke:{_alias:"innerStroke.color",width:{_flexArray:Ic,_check:yC},scalingMethod:{_flexArray:"fixed",_check:Wi},color:{_flexArray:Jb,_check:Qe},minVisibleSize:{_flexArray:tu,_check:re(tu)}},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:Cc,_check:xC},scalingMethod:{_flexArray:"fixed",_check:Wi},color:{_flexArray:t0,_check:Qe},minVisibleSize:{_flexArray:Jh,_check:re(Jh)}},badges:{_check:U2,_set(t,e,s){t.badges.topLeft.text.content.set(e,s),t.badges.topLeft.image.url.set(e,s),t.badges.topRight.text.content.set(e,s),t.badges.topRight.image.url.set(e,s),t.badges.bottomLeft.text.content.set(e,s),t.badges.bottomLeft.image.url.set(e,s),t.badges.bottomRight.text.content.set(e,s),t.badges.bottomRight.image.url.set(e,s)},topLeft:pa("topLeft"),topRight:pa("topRight"),bottomLeft:pa("bottomLeft"),bottomRight:pa("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:s0,_check:Xi},width:{_flexArray:Lc,_check:EC},scalingMethod:{_flexArray:"fixed",_check:Wi},strokeColor:{_flexArray:i0,_check:Xi},strokeWidth:{_flexArray:Nc,_check:AC},clustering:{_flexArray:!1,_check:je},hideNonAdjacentEdges:{_flexArray:!1,_check:je}},pulse:{enabled:{_flexArray:!1,_check:je},duration:{_flexArray:r0,_check:pe},interval:{_flexArray:o0,_check:pe},startColor:{_flexArray:h0,_check:Qe},endColor:{_flexArray:d0,_check:Qe},width:{_flexArray:u0,_check:pe},startRatio:{_flexArray:a0,_check:pe},endRatio:{_flexArray:l0,_check:pe}},icon:{_alias:"icon.content",content:{_flexArray:null,_check:xi},font:{_flexArray:hs,_check:tr},color:{_flexArray:n0,_check:Xi},scale:{_flexArray:rm,_check:re(rm)},style:{_flexArray:"normal",_check:er},minVisibleSize:{_flexArray:ji,_check:re(ji)}},image:{_alias:"image.url",url:{_flexArray:null,_check:xi},scale:{_flexArray:bo,_check:re(bo)},fit:{_flexArray:!0,_check:je},tile:{_flexArray:!1,_check:je},minVisibleSize:{_flexArray:ji,_check:re(ji)}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:je},color:{_flexArray:e0,_check:Xi},minVisibleSize:{_flexArray:ji,_check:re(ji)}},text:{_alias:"text.content",content:{_flexArray:null,_check:xi},font:{_flexArray:hs,_check:tr},color:{_flexArray:tn,_check:Qe},size:{_flexArray:gr,_check:_C},scale:{_flexArray:gC,_check:pe},style:{_flexArray:"normal",_check:er},align:{_flexArray:"center",_check:bl},margin:{_flexArray:wc,_check:bC},padding:{_flexArray:xo,_check:om},backgroundColor:{_flexArray:null,_check:Qe},tip:{_flexArray:!0,_check:je},minVisibleSize:{_flexArray:_a,_check:re(_a)},scaling:{_flexArray:!1,_check:je},position:{_flexArray:"bottom",_check:Y2},maxLineLength:{_flexArray:0,_check:pe},truncateLength:{_flexArray:0,_check:pe},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:xi},font:{_flexArray:hs,_check:tr},color:{_flexArray:tn,_check:Qe},size:{_flexArray:Tc,_check:pC},scale:{_flexArray:.08,_check:pe},style:{_flexArray:"normal",_check:er},align:{_flexArray:"center",_check:bl},margin:{_flexArray:c0,_check:vC},padding:{_flexArray:xo,_check:om},backgroundColor:{_flexArray:null,_check:Qe},minVisibleSize:{_flexArray:_a,_check:re(_a)}}}},SC=t=>(e,s)=>e[t].get(s),wC=(t,e)=>(s,i)=>s[t][e].get(i),TC=(t,e,s)=>(i,n)=>i[t][e][s].get(n),IC=(t,e,s,i)=>(n,r)=>n[t][e][s][i].get(r),CC=t=>(e,s,i)=>e[t].set(s,i),LC=(t,e)=>(s,i,n)=>s[t][e].set(i,n),NC=(t,e,s)=>(i,n,r)=>i[t][e][s].set(n,r),MC=(t,e,s,i)=>(n,r,o)=>n[t][e][s][i].set(r,o),PC=[SC,wC,TC,IC],RC=[CC,LC,NC,MC];function am(t,e){if(!t._check)throw new Error(`error somewhere for ${e}`);const s=e.split("."),i=s.length-1,n=PC[i].apply(null,s),r=RC[i].apply(null,s);return{check:t._check,set:r,get:n,nested:{}}}function Sl(t,e){const s=e?f0:Kb,i=typeof t=="string"?[t]:Tn(t,"",[]);let n=!1;const r=[];for(let o=0;o<i.length;o++){const a=i[o].split(".");let l=s[a[0]];for(let h=1;h<a.length;h++)l=l[a[h]];l.type&&(i[o]=l.type),l._alias&&(i[o]=l._alias),i[o]==="badges"&&(i[o]="badges.topLeft.text.content",n=!0);const d=a[a.length-1];d!=="topLeft"&&d!=="topRight"&&d!=="bottomLeft"&&d!=="bottomRight"||(i[o]=`badges.${d}.text.content`,r.push(`badges.${d}.image.url`)),i[o]==="strokeWidth"&&(i[o]="stroke.width")}return n&&(i.push("badges.topLeft.image.url"),i.push("badges.topRight.text.content"),i.push("badges.topRight.image.url"),i.push("badges.bottomLeft.text.content"),i.push("badges.bottomLeft.image.url"),i.push("badges.bottomRight.text.content"),i.push("badges.bottomRight.image.url")),i.push(...r),i}var ya=t=>(e,s)=>({url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)}),xa=t=>(e,s)=>({color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)}),ba=t=>(e,s)=>({content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}),va=t=>(e,s)=>({color:e.badges[t].color.get(s),scale:e.badges[t].scale.get(s),positionScale:e.badges[t].positionScale.get(s),minVisibleSize:e.badges[t].minVisibleSize.get(s),image:{url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)},stroke:{color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)},text:{content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}}),Ui={topLeft:va("topLeft"),topRight:va("topRight"),bottomLeft:va("bottomLeft"),bottomRight:va("bottomRight")},Gs={stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),innerStroke:(t,e)=>({width:t.innerStroke.width.get(e),scalingMethod:t.innerStroke.scalingMethod.get(e),color:t.innerStroke.color.get(e),minVisibleSize:t.innerStroke.minVisibleSize.get(e)}),outerStroke:(t,e)=>({width:t.outerStroke.width.get(e),scalingMethod:t.outerStroke.scalingMethod.get(e),color:t.outerStroke.color.get(e),minVisibleSize:t.outerStroke.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e),strokeColor:t.halo.strokeColor.get(e),strokeWidth:t.halo.strokeWidth.get(e),clustering:t.halo.clustering.get(e),hideNonAdjacentEdges:t.halo.hideNonAdjacentEdges.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),backgroundColor:t.text.backgroundColor.get(e),tip:t.text.tip.get(e),minVisibleSize:t.text.minVisibleSize.get(e),scaling:t.text.scaling.get(e),position:t.text.position.get(e),maxLineLength:t.text.maxLineLength.get(e),truncateLength:t.text.truncateLength.get(e),secondary:Gs["text.secondary"](t,e)}),image:(t,e)=>({url:t.image.url.get(e),scale:t.image.scale.get(e),fit:t.image.fit.get(e),tile:t.image.tile.get(e),minVisibleSize:t.image.minVisibleSize.get(e)}),icon:(t,e)=>({content:t.icon.content.get(e),font:t.icon.font.get(e),color:t.icon.color.get(e),scale:t.icon.scale.get(e),style:t.icon.style.get(e),minVisibleSize:t.icon.minVisibleSize.get(e)}),badges:(t,e)=>({topLeft:Ui.topLeft(t,e),topRight:Ui.topRight(t,e),bottomLeft:Ui.bottomLeft(t,e),bottomRight:Ui.bottomRight(t,e)}),"badges.topLeft":Ui.topLeft,"badges.topRight":Ui.topRight,"badges.bottomLeft":Ui.bottomLeft,"badges.bottomRight":Ui.bottomRight,"badges.topLeft.image":ya("topLeft"),"badges.topLeft.stroke":xa("topLeft"),"badges.topLeft.text":ba("topLeft"),"badges.topRight.image":ya("topRight"),"badges.topRight.stroke":xa("topRight"),"badges.topRight.text":ba("topRight"),"badges.bottomLeft.image":ya("bottomLeft"),"badges.bottomLeft.stroke":xa("bottomLeft"),"badges.bottomLeft.text":ba("bottomLeft"),"badges.bottomRight.image":ya("bottomRight"),"badges.bottomRight.stroke":xa("bottomRight"),"badges.bottomRight.text":ba("bottomRight"),all:(t,e)=>({x:t.x.get(e),y:t.y.get(e),radius:t.radius.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),shape:t.shape.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),draggable:t.draggable.get(e),layoutable:t.layoutable.get(e),innerStroke:Gs.innerStroke(t,e),outerStroke:Gs.outerStroke(t,e),badges:Gs.badges(t,e),halo:Gs.halo(t,e),pulse:Gs.pulse(t,e),icon:Gs.icon(t,e),image:Gs.image(t,e),outline:Gs.outline(t,e),text:Gs.text(t,e)})},Vi={shape:(t,e)=>({body:t.shape.body.get(e),head:t.shape.head.get(e),tail:t.shape.tail.get(e),style:t.shape.style.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),position:t.text.position.get(e),backgroundColor:t.text.backgroundColor.get(e),minVisibleSize:t.text.minVisibleSize.get(e),adjustAngle:t.text.adjustAngle.get(e),scaling:t.text.scaling.get(e),maxLineLength:t.text.maxLineLength.get(e),secondary:Vi["text.secondary"](t,e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e)}),all:(t,e)=>({width:t.width.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),minVisibleSize:t.minVisibleSize.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),curvature:t.curvature.get(e),adjustAnchors:t.adjustAnchors.get(e),shape:Vi.shape(t,e),stroke:Vi.stroke(t,e),halo:Vi.halo(t,e),pulse:Vi.pulse(t,e),outline:Vi.outline(t,e),text:Vi.text(t,e)})};function Mc(t,e,s,i=!0){if((e=e||t)._flexArray!==void 0)return am(e,s);let n={check:Hs,get:Yt,set:Yt,nested:{}};if(so(e)||e._alias){const r=so(e)?e:e._alias;n=am(ve(t,r),r)}else{if(e._set?(n.set=e._set,n.check=e._check):(n.set=Yt,n.check=Yt),e._get)n.get=e._get;else{const r=i?Gs:Vi;n.get=r[s||"all"]}n.nested={}}if(!so(e)){const r=Object.keys(e);for(const o of r){const a=e[o];o.startsWith("_")||(n.nested[o]=Mc(t,a,s?s+"."+o:o,i))}}return n}var FC=Mc(f0,void 0,void 0,!0),DC=Mc(Kb,void 0,void 0,!1),OC=[];function lm(t){let e=OC;return t.output===void 0?(typeof t.attributes=="function"&&(e="all"),Ce(t.attributes)&&(e=Tn(t.attributes))):t.output&&(e=t.output.attributes),Pc(e,t.allAttributePaths)}function kC(t,e,s,i){if(i>s){for(const n of e.attributes)for(const r of t.attributes)if(r===n)return!0}for(const n of e.tags)for(const r of t.tags)if(n===r)return!0;return!1}function Js(t,e,s,i,n,r){kC(s,i,n,r)&&t.push(e)}function zC(t){let e=t.dependencies;e===void 0?e=nC:Ce(e)||(e={});const s=Ol(t.attributes).some(o=>typeof o=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);let r=e.adjacentEdges;return!r&&e.adjacentNodes&&(r=!0),{self:ni(e.self,n,t.allAttributePaths),adjacentNodes:ni(e.adjacentNodes,n,t.allAttributePaths),adjacentEdges:ni(r,n,t.allAttributePaths),allNodes:ni(e.allNodes,n,t.allAttributePaths),allEdges:ni(e.allEdges,n,t.allAttributePaths)}}function BC(t){let e=t.dependencies;e===void 0?e=rC:Ce(e)||(e={});const s=Ol(t.attributes).some(r=>typeof r=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);return{self:ni(e.self,n,t.allAttributePaths),extremities:ni(e.extremities,n,t.allAttributePaths),parallelEdges:ni(e.parallelEdges,n,t.allAttributePaths),allNodes:ni(e.allNodes,n,t.allAttributePaths),allEdges:ni(e.allEdges,n,t.allAttributePaths)}}function ni(t,e,s){if(!e)return{attributes:[],tags:[]};if(t===!0)return{attributes:[],tags:[vh]};const i={attributes:Pc((t=t||{}).attributes,s),tags:VC(t.tags)};return t.data&&i.tags.push(Eh),t.selection&&i.tags.push(_e),t.hover&&i.tags.push(Kr),i}function UC(t){return Array.isArray(t)?t.join("."):t}function GC(t){return t.map(UC).filter(so)}function Pc(t,e){if(t==="all")return e.slice();if(!Array.isArray(t))return[];const s=GC(t);return e?e.filter(i=>s.some(n=>i.startsWith(n))):s}function VC(t){return Array.isArray(t)?t.filter(so):[]}var dm={storage:1,default:0},wl=class{constructor({graph:t,isNode:e,includeRemovedElements:s}){this._all=!1,this._isNode=e,this._graph=t,this._includeRemovedElements=s,this._eltList=e?this._graph.nodeList:this._graph.edgeList,this._flexArray=e?t.createNodeAttribute(dm,!1):t.createEdgeAttribute(dm,!1),this._all=!1,this._indexList=t.createIndexList(e)}_getAllIndexes(){const t=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex(),e=new Uint32Array(t);for(let s=1;s<=t;++s)e[s-1]=s;return e}addAll(){this._all=!0}add(t){if(!this._all)for(let e=0;e<t._indexes.length;e++){const s=t._indexes[e];this.addIndex(s)}}addIndex(t){this._flexArray.get(t)===0&&(this._flexArray.set(t,1),this._indexList.push(t))}isEmpty(){return!this._all&&this._indexList.isEmpty()}isFull(){return this._all}getListAndClear(){const t=this.getList();return this.clear(),t}getList(){let t;if(this._all&&!this._includeRemovedElements)t=this._isNode?this._graph.getNodes("all"):this._graph.getEdges("all");else{const e=this._all?this._getAllIndexes():this._indexList.slice();t=this._eltList(e)}return t}clear(){this._all=!1,this._indexList.isEmpty()||(this._indexList.reset(),this._flexArray.reset())}addSet(t){if(t._all)this.addAll();else{const e=t._indexList.getBuffer(),s=t._indexList.getLength();for(let i=0;i<s;++i)this.addIndex(e[i])}}};function m0(t,e=[],s=""){return t.constructor===ul?t.isInitialized()&&e.push(s):t.constructor===Object&&Object.keys(t).forEach(i=>{m0(t[i],e,s?s+"."+i:i)}),e}var hm=class{constructor(t,e,s){this._updatedAttributes=new Set,this._updatedAttributesTmp=new Set,this._allUsedAttributes=new Set,this._graph=t,this._eltName=e?"node":"edge",this._accessors=e?FC:DC,this._createFlexArrays=s;const i=this._createFlexArrays(t,{original:!0,useDefaultValues:!0});this._finalFlexArrays=i;const n=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._prevFlexArrays=n;const r=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._defaultFlexArrays=r,this._currentFlexArrays=this._defaultFlexArrays,this.setLastFlexArrays(this._defaultFlexArrays),this._elementsToRedraw=new wl({graph:t,isNode:e,includeRemovedElements:!0}),this._elementsUpdated=new wl({graph:t,isNode:e,includeRemovedElements:!1}),this._finalFlexArraysWrapped={...this._finalFlexArrays,excluded:t.getAttribute(e,"excluded"),textHidden:t.getAttribute(e,"textHidden"),animationStart:t.createAttribute(e,eC),animationDuration:t.createAttribute(e,sC),animationEasing:t.createAttribute(e,iC),id:this._graph.getAttribute(e,"id"),...!e&&{source:t.getEdgeAttribute("source"),target:t.getEdgeAttribute("target")}}}clear(){this._elementsToRedraw.clear(),this._elementsUpdated.clear(),this._updatedAttributes.clear(),this._updatedAttributesTmp.clear()}getAttributeFlexArrays(){return this._finalFlexArraysWrapped}getPrevAttributeFlexArrays(){return this._prevFlexArrays}getAnimationInformation(t){const e=t._indexes,s=Array(e.length),i=this._finalFlexArraysWrapped;for(let n=0;n<e.length;n++){const r=e[n];s[n]={duration:i.animationDuration.get(r),start:i.animationStart.get(r),easing:i.animationEasing.get(r)}}return s}setDefaultAttributes(t){Tn(t).forEach(e=>{const s=ve(this._currentFlexArrays,e),i=ve(this._prevFlexArrays,e),n=ve(this._defaultFlexArrays,e),r=ve(this._finalFlexArrays,e);if(!s)return;const o=ve(t,e);s.setDefaultValue(o),n.setDefaultValue(o),i.setDefaultValue(o),r.setDefaultValue(o)}),this.redrawAll()}startUpdate(){}prepareFlexArraysUpdate(t){this._currentFlexArrays=t.inputFlexArrays}setLastFlexArrays(t){this._lastFlexArrays=t}updateFlexArrays(t){const{attributes:e,selector:s,context:i,outputFlexArrays:n,toUpdate:r,formattedOutput:o}=t;this._elementsUpdated.addSet(r),this._elementsToRedraw.addSet(r);const a=r.getListAndClear();if(e&&a.size){const{valid:l,invalid:d}=Ap(this._graph,a,s,i);for(const h of o.attributes){const u=ve(n,h);for(let c=0;c<d._indexes.length;c++){const g=d._indexes[c];u.set(g,void 0)}}this._assignAttributesToFlexArrays(this._accessors,n,l,e,i),this._addUpdatedAttributes(t)}}endUpdate(){const t=this._elementsUpdated.getList(),e=qr(this._updatedAttributesTmp);for(const s of e){const i=ve(this._lastFlexArrays,s),n=ve(this._finalFlexArrays,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];n.set(o,i.get(o))}}this._updatedAttributesTmp.clear(),this._currentFlexArrays=this._finalFlexArrays}setAttributeValues(t,e,s,i,n){const r=t.outputFlexArrays,o=this._accessors;this._assignAttributesToFlexArrays(o,r,e,s,null),this._addUpdatedAttributes(t,i),this._elementsUpdated.add(e),this._elementsToRedraw.add(e)}notifyLayerDestroyed(t){this._addUpdatedAttributes(t)}_addUpdatedAttributes(t,e){const{outputFlexArrays:s,formattedOutput:i}=t,n=Array.isArray(e)?Pc(e):i.attributes;for(const r of n)ve(s,r).isInitialized()&&(this._updatedAttributes.add(r),this._updatedAttributesTmp.add(r),this._allUsedAttributes.add(r))}addUpdatedAttribute(t){this._updatedAttributes.add(t),this._updatedAttributesTmp.add(t),this._allUsedAttributes.add(t)}getUsedAttributeNames(t){return m0(t.outputFlexArrays)}redrawElements(t){this._elementsToRedraw.add(t)}redrawAll(){this._elementsToRedraw.addAll()}getAndResetElementsToRedraw(){return this._elementsToRedraw.getListAndClear()}getAndResetElementsUpdated(){return this._elementsUpdated.getListAndClear()}getAndResetAttributesUpdated(){const t=qr(this._updatedAttributes);return this._updatedAttributes.clear(),t}getUpdatedAttributes(){return this._updatedAttributes}getUpdatedElementsList(){return this._elementsUpdated.getList()}getUpdatedAttributesSet(){return new Set(this._updatedAttributes)}createFlexArrays(){return this._createFlexArrays(this._graph,{original:!1,useDefaultValues:!1})}getAttributeValues(t,e,s,i){const n=i?this._prevFlexArrays:this._currentFlexArrays;return s?this._getMultipleAttributeValues(t,e,n):this._getSingleAttributeValues(t,e,n)}_getAccessor(t=""){let e=this._accessors;const s=Sn(t);for(const i of s)if(e=e.nested[i],!e)throw new Error(`${this._eltName} attribute "${s.join("")}" does not exist`);return e}_getSingleAttributeValues(t,e,s){const i=this._getAccessor(e),n=t._indexes,r=Array(n.length);for(let o=0;o<n.length;o++)r[o]=i.get(s,n[o]);return r}_getMultipleAttributeValues(t,e,s){if(!e||e==="all")return this._getSingleAttributeValues(t,"",s);const i=Array(t.size);for(let n=0;n<i.length;++n)i[n]={};for(let n=0;n<e.length;n++){const r=e[n],o=this._getSingleAttributeValues(t,r,s);for(let a=0;a<i.length;++a)vi(i[a],r,o[a])}return i}setAnimationAttributes(t,{duration:e,startTime:s,easing:i}){const n=t._indexes,r=this._finalFlexArraysWrapped,o=r.animationDuration,a=r.animationStart,l=r.animationEasing,d=qr(this._allUsedAttributes);if(e){let h=!1;for(const u of d){if(u==="x"||u==="y"){h=!0;continue}const c=ve(this._finalFlexArrays,u),g=ve(this._prevFlexArrays,u);for(let f=0;f<n.length;f++){const m=n[f];g.set(m,c.get(m))}}if(h){const u=ts(),c=this._finalFlexArrays.x,g=this._finalFlexArrays.y,f=this._prevFlexArrays.x,m=this._prevFlexArrays.y;for(let _=0;_<n.length;_++){const p=n[_],x=o.get(p);if(x){const y=a.get(p),b=l.get(p),v=(Sc[b]||El)(Math.min((u-y)/x,1)),E=gh(f.get(p),c.get(p),v),A=gh(m.get(p),g.get(p),v);f.set(p,E),m.set(p,A)}else f.set(p,c.get(p)),m.set(p,g.get(p))}}}o.fill(n,e),a.fill(n,s),l.fill(n,i)}resetAnimationAttributes(t){this._finalFlexArraysWrapped.animationDuration.fill(t._indexes,0)}getUsedAttributes(){return qr(this._allUsedAttributes)}getDefaultFlexArrays(){return this._defaultFlexArrays}_assignAttributesToFlexArrays(t,e,s,i,n,r=[]){if(typeof i=="function"){const o=r.join(".");for(let a=0;a<s.size;++a){const l=s.get(a);if(l){const d=i(l,n,o);this._assignSingleValueToFlexArray(e,l,t,d,r)}}}else if(Ce(i)){const o=Object.keys(i);for(let a=0;a<o.length;++a){const l=o[a];r.push(l);const d=this._getNestedAccessor(t,l,r),h=i[l];this._assignAttributesToFlexArrays(d,e,s,h,n,r),r.pop()}}else if((Array.isArray(i)||ArrayBuffer.isView(i))&&r[0]!=="color")if(r.length===0)for(let o=0;o<s.size;++o)this._assignSingleValueToFlexArray(e,s.get(o),t,i[o],r);else for(let o=0;o<s.size;++o){const a=s._indexes[o],l=t.check(i[o]);t.set(e,a,l)}else{const o=t.check(i);for(let a=0;a<s.size;++a){const l=s.get(a);t.set(e,l._index,o)}}}_getNestedAccessor(t,e,s){const i=t.nested[e];if(!i)throw new Error(`${this._eltName} attribute "${s.join(".")}" does not exist`);return i}_assignSingleValueToFlexArray(t,e,s,i,n){if(Ce(i)){const r=Object.keys(i);for(const o of r){n.push(o);const a=i[o],l=this._getNestedAccessor(s,o,n);this._assignSingleValueToFlexArray(t,e,l,a,n),n.pop()}}else{const r=s.check(i);s.set(t,e._index,r)}}};function qC(t,{original:e,useDefaultValues:s}){const i="resource";return{width:t.createAttribute(!1,{storage:i,default:s?Xh:void 0,name:"width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?pb:void 0,name:"scalingMethod"},e),color:t.createAttribute(!1,{storage:i,default:s?yb:void 0,name:"color"},e),opacity:t.createAttribute(!1,{storage:i,default:s?xb:void 0,name:"opacity"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?bb:void 0,name:"minVisibleSize"},e),layer:t.createAttribute(!1,{storage:i,default:s?vb:void 0,name:"layer"},e),detectable:t.createAttribute(!1,{storage:i,default:s?Eb:void 0,name:"detectable"},e),curvature:t.createAttribute(!1,{storage:i,default:s?Ab:void 0,name:"curvature"},e),adjustAnchors:t.createAttribute(!1,{storage:i,default:s?Sb:void 0,name:"adjustAnchors"},e),shape:{body:t.createAttribute(!1,{storage:i,default:s?wb:void 0,name:"shape.body"},e),head:t.createAttribute(!1,{storage:i,default:s?Tb:void 0,name:"shape.head"},e),tail:t.createAttribute(!1,{storage:i,default:s?Ib:void 0,name:"shape.tail"},e),style:t.createAttribute(!1,{storage:i,default:s?Cb:void 0,name:"shape.style"},e)},stroke:{color:t.createAttribute(!1,{storage:i,default:s?Lb:void 0,name:"stroke.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Yh:void 0,name:"stroke.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?Nb:void 0,name:"stroke.scalingMethod"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Mb:void 0,name:"stroke.minVisibleSize"},e)},halo:{color:t.createAttribute(!1,{storage:i,default:s?Pb:void 0,name:"halo.color"},e),width:t.createAttribute(!1,{storage:i,default:s?$h:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?Rb:void 0,name:"halo.scalingMethod"},e)},pulse:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!1,{storage:i,default:s?Fb:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!1,{storage:i,default:s?Db:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!1,{storage:i,default:s?Ob:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!1,{storage:i,default:s?kb:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!1,{storage:i,default:s?zb:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!1,{storage:i,default:s?Bb:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!1,{storage:i,default:s?Ub:void 0,name:"pulse.endRatio"},e)},outline:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!1,{storage:i,default:s?Gb:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Vb:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!1,{storage:i,default:s?hs:void 0,name:"text.font"},e),color:t.createAttribute(!1,{storage:i,default:s?tn:void 0,name:"text.color"},e),size:t.createAttribute(!1,{storage:i,default:s?gr:void 0,name:"text.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?dC:void 0,name:"text.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?qb:void 0,name:"text.style"},e),align:t.createAttribute(!1,{storage:i,default:s?jb:void 0,name:"text.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Hb:void 0,name:"text.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?Zh:void 0,name:"text.padding"},e),position:t.createAttribute(!1,{storage:i,default:s?Wb:void 0,name:"text.position"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?Al:void 0,name:"text.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Xb:void 0,name:"text.minVisibleSize"},e),adjustAngle:t.createAttribute(!1,{storage:i,default:s?Yb:void 0,name:"text.adjustAngle"},e),scaling:t.createAttribute(!1,{storage:i,default:s?cb:void 0,name:"text.scaling"},e),maxLineLength:t.createAttribute(!1,{storage:i,default:s?gb:void 0,name:"text.maxLineLength"},e),secondary:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!1,{storage:i,default:s?hs:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!1,{storage:i,default:s?tn:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!1,{storage:i,default:s?Qh:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?lb:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?hb:void 0,name:"text.secondary.style"},e),align:t.createAttribute(!1,{storage:i,default:s?ub:void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Zb:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?Kh:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?db:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?$b:void 0,name:"text.secondary.minVisibleSize"},e)}}}}function jC(t,{original:e,useDefaultValues:s}){const i="resource";return{x:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"x"},e),y:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"y"},e),radius:t.createAttribute(!0,{storage:i,default:s?5:void 0,name:"radius"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?Qb:void 0,name:"color"},e),opacity:t.createAttribute(!0,{storage:i,default:s?uC:void 0,name:"opacity"},e),shape:t.createAttribute(!0,{storage:i,default:s?cC:void 0,name:"shape"},e),layer:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"layer"},e),detectable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"detectable"},e),draggable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"draggable"},e),layoutable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"layoutable"},e),innerStroke:{width:t.createAttribute(!0,{storage:i,default:s?Ic:void 0,name:"innerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"innerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?Jb:void 0,name:"innerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?tu:void 0,name:"innerStroke.minVisibleSize"},e)},outerStroke:{width:t.createAttribute(!0,{storage:i,default:s?Cc:void 0,name:"outerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"outerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?t0:void 0,name:"outerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Jh:void 0,name:"outerStroke.minVisibleSize"},e)},badges:{topLeft:{color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.topLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ma:void 0,name:"badges.topLeft.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Hr:void 0,name:"badges.topLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Kn:void 0,name:"badges.topLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topLeft.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?Wr:void 0,name:"badges.topLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?hs:void 0,name:"badges.topLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.top"},e)}},topRight:{color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.topRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ma:void 0,name:"badges.topRight.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Hr:void 0,name:"badges.topRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Kn:void 0,name:"badges.topRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topRight.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?Wr:void 0,name:"badges.topRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?hs:void 0,name:"badges.topRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topRight.text.scale"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.left"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.top"},e)}},bottomLeft:{color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.bottomLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ma:void 0,name:"badges.bottomLeft.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Hr:void 0,name:"badges.bottomLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Kn:void 0,name:"badges.bottomLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomLeft.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?Wr:void 0,name:"badges.bottomLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?hs:void 0,name:"badges.bottomLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.top"},e)}},bottomRight:{color:t.createAttribute(!0,{storage:i,default:s?jr:void 0,name:"badges.bottomRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ma:void 0,name:"badges.bottomRight.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?Hr:void 0,name:"badges.bottomRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Kn:void 0,name:"badges.bottomRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomRight.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?Wr:void 0,name:"badges.bottomRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?hs:void 0,name:"badges.bottomRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomRight.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.top"},e)}}},halo:{color:t.createAttribute(!0,{storage:i,default:s?s0:void 0,name:"halo.color"},e),width:t.createAttribute(!0,{storage:i,default:s?Lc:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"halo.scalingMethod"},e),strokeColor:t.createAttribute(!0,{storage:i,default:s?i0:void 0,name:"halo.strokeColor"},e),strokeWidth:t.createAttribute(!0,{storage:i,default:s?Nc:void 0,name:"halo.strokeWidth"},e),clustering:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.clustering"},e),hideNonAdjacentEdges:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.hideNonAdjacentEdges"},e)},pulse:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!0,{storage:i,default:s?r0:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!0,{storage:i,default:s?o0:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!0,{storage:i,default:s?h0:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!0,{storage:i,default:s?d0:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!0,{storage:i,default:s?u0:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!0,{storage:i,default:s?a0:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!0,{storage:i,default:s?l0:void 0,name:"pulse.endRatio"},e)},icon:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"icon.content"},e),font:t.createAttribute(!0,{storage:i,default:s?hs:void 0,name:"icon.font"},e),color:t.createAttribute(!0,{storage:i,default:s?n0:void 0,name:"icon.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.7:void 0,name:"icon.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"icon.style"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"icon.minVisibleSize"},e)},image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"image.scale"},e),fit:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"image.fit"},e),tile:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"image.tile"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"image.minVisibleSize"},e)},outline:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!0,{storage:i,default:s?e0:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!0,{storage:i,default:s?hs:void 0,name:"text.font"},e),color:t.createAttribute(!0,{storage:i,default:s?tn:void 0,name:"text.color"},e),size:t.createAttribute(!0,{storage:i,default:s?gr:void 0,name:"text.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.1:void 0,name:"text.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?wc:void 0,name:"text.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?xo:void 0,name:"text.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?Al:void 0,name:"text.backgroundColor"},e),tip:t.createAttribute(!0,{storage:i,default:s?aC:void 0,name:"text.tip"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.minVisibleSize"},e),scaling:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"text.scaling"},e),position:t.createAttribute(!0,{storage:i,default:s?"bottom":void 0,name:"text.position"},e),maxLineLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.maxLineLength"},e),truncateLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.truncateLength"},e),secondary:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!0,{storage:i,default:s?hs:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!0,{storage:i,default:s?tn:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!0,{storage:i,default:s?Tc:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.08:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.secondary.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?lC:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?xo:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?Al:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.secondary.minVisibleSize"},e)}}}}var HC=class{constructor(t){this.nodes=new hm(t,!0,jC),this.edges=new hm(t,!1,qC)}setNodeDefaultAttributes(t){this.nodes.setDefaultAttributes(t)}setEdgeDefaultAttributes(t){this.edges.setDefaultAttributes(t)}getFlexArrays(){return{nodes:{current:this.nodes.getAttributeFlexArrays(),previous:this.nodes.getPrevAttributeFlexArrays()},edges:{current:this.edges.getAttributeFlexArrays(),previous:this.edges.getPrevAttributeFlexArrays()}}}redrawAll(){this.nodes.redrawAll(),this.edges.redrawAll()}clear(){this.nodes.clear(),this.edges.clear()}redrawElements(t){this._fetch(t).redrawElements(t)}getAnimationInformation(t){return this._fetch(t).getAnimationInformation(t)}redrawNodes(t){this.nodes.redrawElements(t)}getUsedAttributes(t,e){return this._fetch(e).getUsedAttributeNames(e.isNode?t.nodes:t.edges)}startUpdate(){this.nodes.startUpdate(),this.edges.startUpdate()}notifyDestroyed(t){this.nodes.notifyLayerDestroyed(t.nodes),this.edges.notifyLayerDestroyed(t.edges)}prepareUpdate(t){this.nodes.prepareFlexArraysUpdate(t.nodes),this.edges.prepareFlexArraysUpdate(t.edges)}onUpdate(t){this.nodes.updateFlexArrays(t.nodes),this.edges.updateFlexArrays(t.edges)}afterLayersUpdate(){this.nodes.endUpdate(),this.edges.endUpdate()}getAndResetElementsToRedraw(){return{nodes:this.nodes.getAndResetElementsToRedraw(),edges:this.edges.getAndResetElementsToRedraw()}}getAndResetElementsUpdated(){const t=this.nodes,e=this.edges;return{nodes:t.getAndResetElementsUpdated(),edges:e.getAndResetElementsUpdated(),nodeAttributesSet:t.getUpdatedAttributesSet(),nodeAttributes:t.getAndResetAttributesUpdated(),edgeAttributes:e.getAndResetAttributesUpdated()}}setAnimationAttributes({nodes:t,edges:e},s){this.nodes.setAnimationAttributes(t,s),this.edges.setAnimationAttributes(e,s)}resetAnimationAttributes({nodes:t,edges:e}){this.nodes.resetAnimationAttributes(t),this.edges.resetAnimationAttributes(e)}setLastOutput(t,e){this.nodes.setLastFlexArrays(t),this.edges.setLastFlexArrays(e)}getCurrentInput(){const t=Ae(this.nodes.getDefaultFlexArrays()),e=Ae(this.edges.getDefaultFlexArrays());return{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:Tn(t),allEdgeAttributePaths:Tn(e)}}initializeLayer(t,e,s){t.nodes.allAttributePaths=e,t.edges.allAttributePaths=s,t.nodes.formattedDependencies=zC(t.nodes),t.edges.formattedDependencies=BC(t.edges),t.nodes.formattedOutput={attributes:lm(t.nodes),tags:t.tag?[t.tag]:[]},t.edges.formattedOutput={attributes:lm(t.edges),tags:t.tag?[t.tag]:[]},t.nodes.redrawAdjacentEdges=t.nodes.formattedOutput.attributes.some(i=>oC[i]),t.initialized=!0}connectLayerInputOutput(t,e,s){const i=t.nodes.formattedOutput,n=t.edges.formattedOutput;for(const r of i.attributes){const o=ve(e,r),a=ve(t.nodes.outputFlexArrays,r);a.setFallback(o),vi(e,r,a)}for(const r of n.attributes){const o=ve(s,r),a=ve(t.edges.outputFlexArrays,r);a.setFallback(o),vi(s,r,a)}}setupLayerDependencies(t,e){if(t===e)return;const s=t.priority,i=e.priority,n=t.nodes.formattedOutput,r=t.edges.formattedOutput,o=e.nodes.formattedDependencies,a=e.edges.formattedDependencies;Js(t.depsNodeSelf,e,n,o.self,s,i),Js(t.depsNodeAdjacentNodes,e,n,o.adjacentNodes,s,i),Js(t.depsNodeAdjacentEdges,e,r,a.extremities,s,i),Js(t.depsNodeAllNodes,e,n,o.allNodes,s,i),Js(t.depsNodeAllEdges,e,r,a.allNodes,s,i),Js(t.depsEdgeSelf,e,r,a.self,s,i),Js(t.depsEdgeExtremities,e,n,o.adjacentEdges,s,i),Js(t.depsEdgeParallelEdges,e,r,a.parallelEdges,s,i),Js(t.depsEdgeAllNodes,e,n,o.allEdges,s,i),Js(t.depsEdgeAllEdges,e,r,a.allEdges,s,i)}createAttributeLayerData(t,e,s,{tag:i,onBeforeUpdate:n,standaloneSelectors:r}){const o=!!r;return{index:-1,id:e,name:t,tag:i||null,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:!1,onBeforeUpdate:n,nodes:{type:"node",name:t,standaloneSelector:o,toUpdate:new wl({graph:s,isNode:!0,includeRemovedElements:!1}),outputFlexArrays:this.nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{type:"edge",name:t,standaloneSelector:o,toUpdate:new wl({graph:s,isNode:!1,includeRemovedElements:!1}),outputFlexArrays:this.edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}}}setAttributeValues(t,e,s,i,n){this._fetch(e).setAttributeValues(t,e,s,i,n)}getAttributeValues(t,e,s,i){return this._fetch(t).getAttributeValues(t,e,s,i)}_fetch(t){return t.isNode?this.nodes:this.edges}},WC=(t,e)=>new YI(t,e),XC=class{constructor(t,{graph:e,dom:s}){this._layerIdCounter=0,this._layers=[],this._destroyedLayers=[],this._layersNeedUpdate=!1,this._updateOngoing=!1,this._needUpdate=!1,this._ogma=t,this._graph=e,this._dom=s,this._emptySubgraph={nodes:t.nodeList(),edges:t.edgeList()},this._textHiddenSet=new Oo(this._graph,"textHidden"),this._layerController=new HC(this._graph)}_getLayerById(t){for(let e=0;e<this._layers.length;++e){const s=this._layers[e];if(s.id===t)return s.index=e,s}throw new Error("usage of a destroyed style rule or class")}setDefaultAttributes(t,e){this._layerController.setNodeDefaultAttributes(t),this._layerController.setEdgeDefaultAttributes(e)}getFlexArrays(){return this._layerController.getFlexArrays()}clear(){this._updateOngoing=!1,this._needUpdate=!1,this._destroyedLayers=[],this._layerController.clear(),this.updateAllForAllAttributeLayers()}redrawElements(t){t.size&&(this._layerController.redrawElements(t),this._dom.refresh())}redrawAll(){this._layerController.redrawAll(),this._dom.refresh()}_triggerUpdate(){this._needUpdate=!0,this._dom.refresh()}_reconstructAttributeLayersIfNecessary(){return!!this._layersNeedUpdate&&(this._reconstructAttributeLayers(),this._layersNeedUpdate=!1,this._dom.refresh(),!0)}getAnimationInformation(t){return this._layerController.getAnimationInformation(t)}update(){if(!this._needUpdate||this._updateOngoing||!this._ogma._token)return!1;this._reconstructAttributeLayersIfNecessary(),this._updateOngoing=!0,this._layerController.startUpdate();for(const t of this._destroyedLayers)t.initialized&&this._layerController.notifyDestroyed(t);for(const t of this._layers)this._layerController.prepareUpdate(t),typeof t.onBeforeUpdate=="function"&&t.onBeforeUpdate(t,this,this._layerController),this._layerController.onUpdate(t);return this._layerController.afterLayersUpdate(),this._updateOngoing=!1,this._needUpdate=!1,!0}setAttributeLayerValues(t,e,s,i){const n=this._getLayerById(t),r=e.isNode?n.nodes:n.edges;this._reconstructAttributeLayersIfNecessary(),this._layerController.setAttributeValues(r,e,s,i,n),this._updateElementsForAttributeLayers([n],e)}getAttributeLayerFlexArrays(t){const e=this._getLayerById(t);return{nodes:e.nodes.outputFlexArrays,edges:e.edges.outputFlexArrays}}getUsedAttributeLayerAttributes(t,e){const s=this._getLayerById(t);return this._layerController.getUsedAttributes(s,e)}getUpdatedElements(){return{elementsToRedraw:this._layerController.getAndResetElementsToRedraw(),elementsUpdated:this._layerController.getAndResetElementsUpdated()}}addAttributeLayer(t){const{name:e,layerFactory:s=WC}=t;if(!e)throw new Error("Attribute layer must have a name");if(e&&this._layers.find(n=>n.name===e))throw new Error(`attribute layer with name "${t.name}" already exists`);const i=this._layerController.createAttributeLayerData(e,++this._layerIdCounter,this._graph,t);return this._layers.push(i),this._updateLayer(i,t),s(this,this._layerIdCounter)}_reconstructAttributeLayers(){this._layers.sort((n,r)=>n.priority-r.priority);const{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:s,allEdgeAttributePaths:i}=this._layerController.getCurrentInput();for(const n of this._layers)this._layerController.initializeLayer(n,s,i);for(const n of this._layers){n.nodes.inputFlexArrays=Ae(t),n.edges.inputFlexArrays=Ae(e),n.depsNodeSelf=[],n.depsNodeAdjacentNodes=[],n.depsNodeAdjacentEdges=[],n.depsNodeAllNodes=[],n.depsNodeAllEdges=[],n.depsEdgeSelf=[],n.depsEdgeExtremities=[],n.depsEdgeParallelEdges=[],n.depsEdgeAllNodes=[],n.depsEdgeAllEdges=[],n.nodes.toUpdate.addAll(),n.edges.toUpdate.addAll(),this._layerController.connectLayerInputOutput(n,t,e);for(const r of this._layers)this._layerController.setupLayerDependencies(n,r)}this._layerController.setLastOutput(t,e);for(const n of this._layers)n.nodes.needAdjacentElements=n.nodes.redrawAdjacentEdges||n.depsNodeAdjacentNodes.length>0||n.depsNodeAdjacentEdges.length>0,n.edges.needAdjacentElements=n.depsEdgeExtremities.length>0||n.depsEdgeParallelEdges.length>0}_updateLayer(t,{priority:e,fullOverwrite:s,nodeAttributes:i,nodeSelector:n,nodeContext:r,nodeDependencies:o,nodeOutput:a,edgeAttributes:l,edgeSelector:d,edgeContext:h,edgeDependencies:u,edgeOutput:c}={}){i!==void 0&&(t.nodes.attributes=s?i:Qa(t.nodes.attributes,i)),n!==void 0&&(t.nodes.selector=n),r!==void 0&&(t.nodes.context=r),o!==void 0&&(t.nodes.dependencies=o),a!==void 0&&(t.nodes.output=a),l!==void 0&&(t.edges.attributes=s?l:Qa(t.edges.attributes,l)),d!==void 0&&(t.edges.selector=d),h!==void 0&&(t.edges.context=h),u!==void 0&&(t.edges.dependencies=u),c!==void 0&&(t.edges.output=c),e!==void 0&&(t.priority=e),this._triggerLayerUpdate()}_triggerLayerUpdate(){this._layersNeedUpdate=!0,this._triggerUpdate()}updateAllForAttributeLayer(t){const e=this._getLayerById(t);this._updateAllForAttributeLayer(e)}updateAllForAllAttributeLayers(){for(const t of this._layers)this._updateAllForAttributeLayer(t)}_updateAllForAttributeLayer(t,e=!0,s=!0){if(e&&!t.nodes.toUpdate.isFull()){t.nodes.toUpdate.addAll();for(const i of t.depsNodeSelf)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsNodeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}if(s&&!t.edges.toUpdate.isFull()){t.edges.toUpdate.addAll();for(const i of t.depsEdgeSelf)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeExtremities)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeParallelEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}this._triggerUpdate()}updateElementsForAttributeLayer(t,e){const s=this._getLayerById(t);this._updateElementsForAttributeLayers([s],e)}updateForAllAttributeLayers(t){this._updateElementsForAttributeLayers(this._layers,t)}_updateElementsForAttributeLayers(t,e){let s=this._emptySubgraph;if(e.isNode){for(const i of t)if(!i.nodes.toUpdate.isFull()){i.nodes.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.nodes.toUpdate.add(e);for(const n of i.depsNodeSelf)n.nodes.toUpdate.add(e);for(const n of i.depsNodeAdjacentNodes)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsNodeAdjacentEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsNodeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsNodeAllEdges)this._updateAllForAttributeLayer(n,!1,!0);i.nodes.redrawAdjacentEdges&&this._layerController.redrawElements(s.edges)}}else for(const i of t)if(!i.edges.toUpdate.isFull()){i.edges.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.edges.toUpdate.add(e);for(const n of i.depsEdgeSelf)n.edges.toUpdate.add(e);for(const n of i.depsEdgeExtremities)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsEdgeParallelEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsEdgeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsEdgeAllEdges)this._updateAllForAttributeLayer(n,!1,!0)}this._triggerUpdate()}destroyAttributeLayer(t){const e=this._getLayerById(t);this._destroyedLayers.push(e),this._layers.splice(e.index,1),this._triggerLayerUpdate()}updateAttributeLayer(t,e){const s=this._getLayerById(t);this._updateLayer(s,e)}getAttributeLayerDefinition(t){const e=this._getLayerById(t),{priority:s,nodes:i,edges:n}=e;return{priority:s,nodeAttributes:i.attributes,nodeSelector:i.selector,nodeContext:i.context,nodeDependencies:i.dependencies,nodeOutput:i.output,edgeAttributes:n.attributes,edgeSelector:n.selector,edgeContext:n.context,edgeDependencies:n.dependencies,edgeOutput:n.output}}getAttributeValues(t,e,s,i){return this.update(),this._layerController.getAttributeValues(t,e,s,i)}setAnimationAttributes(t,e){return this._layerController.setAnimationAttributes(t,e)}resetAnimationAttributes(t){return this._layerController.resetAnimationAttributes(t)}setTextHidden(t,e){const s=this._textHiddenSet.addOrRemoveElements(t,e);this.redrawElements(s)}resetTextHidden(){const{nodes:t,edges:e}=this._textHiddenSet.getElements();this._textHiddenSet.clear(),this._layerController.redrawElements(t),this._layerController.redrawElements(e)}getUsedNodeAttributes(){return this._layerController.nodes.getUsedAttributes()}getUsedEdgeAttributes(){return this._layerController.edges.getUsedAttributes()}interpolateAttributes(t){const e=ts(),s=this._ogma.modules.graphics.getAttributesManager(),i=this._layerController,n=t.isNode?s.getUsedNodeAttributes():s.getUsedEdgeAttributes(),{animationDuration:r,animationEasing:o,animationStart:a}=i.getFlexArrays().nodes.current,l=r.getMultiple(t._indexes),d=o.getMultiple(t._indexes),h=a.getMultiple(t._indexes),u=[];for(let c=0;c<t.size;c++){const g={};n.forEach(f=>{const m=typeof f=="string"?f:f.join("."),_=ve(i.getFlexArrays().nodes.previous,f),p=ve(i.getFlexArrays().nodes.current,f);if(!p)return;const x=Px(e,h[c],l[c],d[c]);isNaN(x)?g[m]=p.get(t._indexes[c]):m.match(/color/gi)?g[m]=Vr(_.get(t._indexes[c]),p.get(t._indexes[c]),x,x):g[m]=ne(_.get(t._indexes[c]),p.get(t._indexes[c]),x)}),u.push(g)}return u}},YC=1e-12;function um(t){return((t=Math.exp(t))+1/t)/2}function $C(t){return((t=Math.exp(t))-1/t)/2}function ZC(t){return((t=Math.exp(2*t))-1)/(t+1)}var KC=function t(e,s,i){function n(r,o){var a,l,d=r[0],h=r[1],u=r[2],c=o[0],g=o[1],f=o[2],m=c-d,_=g-h,p=m*m+_*_;if(p<YC)l=Math.log(f/u)/e,a=function(A){return[d+A*m,h+A*_,u*Math.exp(e*A*l)]};else{var x=Math.sqrt(p),y=(f*f-u*u+i*p)/(2*u*s*x),b=(f*f-u*u-i*p)/(2*f*s*x),v=Math.log(Math.sqrt(y*y+1)-y),E=Math.log(Math.sqrt(b*b+1)-b);l=(E-v)/e,a=function(A){var S=A*l,w=um(v),L=u/(s*x)*(w*ZC(e*S+v)-$C(v));return[d+L*m,h+L*_,u*w/um(e*S+v)]}}return a.duration=1e3*l*e/Math.SQRT2,a}return n.rho=function(r){var o=Math.max(.001,+r),a=o*o;return t(o,a,a*a)},n}(Math.SQRT2,2,4),QC="cubicOut",JC=({graphWidth:t,graphHeight:e,viewWidth:s,viewHeight:i})=>.2*Math.min(s/t,i/e),tL=({smallestNodeSize:t,viewWidth:e,viewHeight:s})=>t===1/0?1/0:Math.min(e,s)/t*.5;function eL(t,e,s){return e===void 0?sL(t):e==="alt"?t.altKey:e==="shift"?t.shiftKey:e==="space"?s.isPressed("space"):void 0}function sL(t){return!t.altKey&&($v?t.metaKey:t.ctrlKey)&&!t.shiftKey}var eu=Math.SQRT2,cm=.15,iL=class extends Bt{constructor(t,e){super(t),this._zooming=!1,this.debug=!1,this._smoothZoom=Fl((s,i,n)=>{const r=this._modules.settings,o=r.get("interactions.zoom.duration"),a=r.get("interactions.zoom.easing"),l=this._modules.camera.getZoom(),d={duration:o,easing:a};this._zooming||(this._zooming=!0,this._updateVisibility("zoom",!0));const h=r.get("interactions.zoom.speed")||cm;let u=g1(s,h);s<0&&u!==0&&(u=1/u);const c=l*u;this._modules.camera.setZoom(c,d,{x:i,y:n}).then(()=>{this._zooming&&(this._zooming=!1,this._updateVisibility("zoom",!1))})},Op),this.debug=e}onMounted(){const t=this._modules.settings;t.register("interactions.zoom.enabled",!0),t.register("interactions.zoom.onDoubleClick",!1),t.register("interactions.zoom.duration",150),t.register("interactions.zoom.modifier",eu),t.register("interactions.zoom.speed",cm),t.register("interactions.zoom.easing",QC),t.register("interactions.zoom.minValue",this.debug?null:JC),t.register("interactions.zoom.maxValue",this.debug?null:tL),t.register("interactions.zoom.hideNodes",!1),t.register("interactions.zoom.hideEdges",!1),t.register("interactions.zoom.hideNodeTexts",!1),t.register("interactions.zoom.hideEdgeTexts",!1),t.register("interactions.zoom.scrollToPan",!1),t.register("interactions.zoom.metaKey",void 0),t.register("interactions.pan.enabled",!0),t.register("interactions.pan.hideNodes",!1),t.register("interactions.pan.hideEdges",!1),t.register("interactions.pan.hideNodeTexts",!1),t.register("interactions.pan.hideEdgeTexts",!1),t.register("interactions.rotation.enabled",!0),t.register("interactions.rotation.hideNodes",!1),t.register("interactions.rotation.hideEdges",!1),t.register("interactions.rotation.hideNodeTexts",!1),t.register("interactions.rotation.hideEdgeTexts",!1),t.register("interactions.gesture.enabled",!0),t.register("interactions.gesture.hideNodes",!1),t.register("interactions.gesture.hideEdges",!1),t.register("interactions.gesture.hideNodeTexts",!1),t.register("interactions.gesture.hideEdgeTexts",!1),this._setupInteractions()}_setupInteractions(){this._modules.interactions.onMouseWheel({priority:"zoom",check:()=>!!this._modules.settings.get("interactions.zoom.enabled"),handler:({x:t,y:e,delta:s,dx:i,dy:n,domEvent:r})=>{const o=i%1!=0||n%1!=0,a=this._modules.settings;!a.get("interactions.zoom.scrollToPan")||eL(r,a.get("interactions.zoom.metaKey"),this._modules.keyboard)||o?this._smoothZoom(s,t,e):this._modules.camera.move({x:i,y:n})}}),this._modules.interactions.onDoubleClick({priority:"zoom",check:()=>{const t=this._modules.settings.get("interactions.zoom.enabled"),e=this._modules.settings.get("interactions.zoom.onDoubleClick");return!(!t||!e)},handler:({x:t,y:e})=>this._smoothZoom(1,t,e)}),this._modules.interactions.onDrag({priority:"panning",disableDetection:!0,check:({button:t})=>{const e=!!this._modules.settings.get("interactions.pan.enabled");return t==="left"&&e},onStart:()=>this._updateVisibility("pan",!0),onProgress:({dx:t,dy:e})=>this._modules.camera.move({x:-t,y:-e}),onStop:()=>this._updateVisibility("pan",!1)}),this._modules.interactions.onDrag({priority:"rotation",disableDetection:!0,check:({button:t,domEvent:e})=>(t==="right"||e&&e.buttons===2)&&!!this._modules.settings.get("interactions.rotation.enabled"),onStart:({x:t,y:e})=>{this._rotationStart={x:t,y:e},this._updateVisibility("rotation",!0)},onProgress:({x:t,y:e})=>this._rotate({x:t,y:e}),onStop:()=>this._updateVisibility("rotation",!1)}),this._modules.interactions.onGesture({priority:"gesture",disableDetection:!0,check:()=>!!this._modules.settings.get("interactions.gesture.enabled"),onStart:()=>this._updateVisibility("gesture",!0),onProgress:({dx:t,dy:e,rotation:s,scale:i,x:n,y:r})=>{this._modules.settings.get("interactions.rotation.enabled")&&this._modules.camera.rotate(-s),this._modules.camera.zoomIn({modifier:i},{x:n,y:r}),this._modules.camera.move({x:-t,y:-e})},onStop:()=>this._updateVisibility("gesture",!0)})}_rotate({x:t,y:e}){const{width:s,height:i}=this._modules.camera.getSize(),n=s/2,r=i/2,o=this._rotationStart.x-n,a=this._rotationStart.y-r,l=t-n,d=e-r,h=Math.atan2(a,o)-Math.atan2(d,l);this._rotationStart.x=t,this._rotationStart.y=e,this._modules.camera.rotate(h)}_updateVisibility(t,e){const s=!e,i=this._modules.settings,n=i.get(`interactions.${t}.hideNodes`),r=i.get(`interactions.${t}.hideEdges`),o=i.get(`interactions.${t}.hideNodeTexts`),a=i.get(`interactions.${t}.hideEdgeTexts`);n&&this._modules.graphics.setNodesVisibility(s),o&&this._modules.graphics.setNodeTextsVisibility(s),r&&this._modules.graphics.setEdgesVisibility(s),a&&this._modules.graphics.setEdgeTextsVisibility(s)}},gm=1e-8,fm=1e8,Bd={duration:0,startAfter:0,ignoreZoomLimits:!1,callback:Yt,easing:"quadraticOut"};function Ea(t){return Math.abs(t)<1e-9}var nL=80,rL=class _0 extends Bt{constructor(){super(...arguments),this._minZoom=gm,this._maxZoom=fm,this._timeout=0,this._cornerCosSin=new Float32Array([0,0,0,0,0,0,0,0])}onMounted(){this._reset(),this._modules.settings.register("minZoom",gm,e=>{this._minZoom=e,this._zoom<e&&(this._zoom=e,this._modules.events.fire("move"))}),this._modules.settings.register("maxZoom",fm,e=>{this._maxZoom=e,this._zoom>e&&(this._zoom=e,this._modules.events.fire("move"))}),this._modules.events.on("setContainer",()=>{this._reset(),this._modules.events.fire("move")}).on("resize",()=>{this._reloadDimensions(),this._modules.events.fire("move")})}get x(){return this._x}get y(){return this._y}get zoom(){return this._zoom}get angle(){return this._angle}get width(){return this._dimensions.width}get height(){return this._dimensions.height}moveEnd(e){this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>{this._modules.events.fire("viewChanged",{type:e})},nL)}getSize(){return{width:this._dimensions.width,height:this._dimensions.height}}getCenter(){return{x:this._x,y:this._y}}setCenter({x:e,y:s},i){const n=this._x,r=this._y,o=e-this._x,a=s-this._y;return Ea(o)&&Ea(a)?Promise.resolve():new Promise(l=>{this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const d=this._modules.animations.play(h=>{this._x=n+o*h,this._y=r+a*h,this._modules.events.fire("move").fire("pan")},{...Bd,...i,callback:()=>this.moveEnd("pan"),resolve:l});d&&(this._moveAnimation=d)})}move({x:e,y:s},i){const n=mm({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle);return this.setCenter({x:this._x+n.x,y:this._y+n.y},i)}getZoom(){return this._zoom}setZoom(e,s,i={x:void 0,y:void 0}){const{x:n,y:r}=i;let o=Os(e,this._minZoom,this._maxZoom);return s&&s.ignoreZoomLimits||(o=this._applyZoomLimits(o)),Ea(this._zoom-o)?Promise.resolve():new Promise(a=>{const l={...Bd,...s,callback:()=>this.moveEnd("zoom"),resolve:a},d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._zoom,c=d/u-d/o;if(n!==void 0&&r!==void 0){const f=(n-d)/u-(n-d)/o,m=(r-h)/u-(r-h)/o,_=this._cosAngle,p=this._sinAngle,x=_*f-p*m,y=p*f+_*m;this.setCenter({x:this._x+x,y:this._y+y},s)}this._zoomAnimation&&this._modules.animations.cancel(this._zoomAnimation),this._modules.dom.afterNextFrame().then(()=>{this._modules.events.fire("zoomStart",{duration:l.duration,easing:l.easing,startZoom:u,endZoom:o})});const g=this._modules.animations.play(f=>{this._zoom=d/(d/u-c*f),this._modules.events.fire("move").fire("zoom")},l);g&&(this._zoomAnimation=g)})}_applyZoomLimits(e){const s=this._modules.settings.get("interactions.zoom.minValue"),i=this._modules.settings.get("interactions.zoom.maxValue"),{minScaledSize:n,maxScaledSize:r,width:o,height:a,cx:l}=this._modules.locate.getGraphBoundingBox(),d=this._zoom,h=this.getSize();let u=e;if(!isNaN(l)){const c={smallestNodeSize:n,biggestNodeSize:r,graphWidth:o+r,graphHeight:a+r,viewWidth:h.width,viewHeight:h.height},g=s&&s(c),f=i&&i(c);_m(g)&&u<g?u<d&&(u=Math.min(d,g)):_m(f)&&u>f&&u>d&&(u=Math.max(d,f))}return u}zoomIn(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||eu:e.modifier,this.setZoom(this._zoom*i,e,s)}moveToBounds(e,s={}){const i=this._modules.locate.computeConfigForBounds(e,{ignoreZoomLimits:!0});return this.moveTo(i,s)}moveTo(e,s={}){const i=this.getZoom(),n=this.getCenter(),r=e.zoom||this._zoom;return s.duration===0?this.setView(e):new Promise(o=>{const a=Math.min(this.width,this.height),l=KC([n.x,n.y,a/i],[e.x,e.y,a/r]),d=l.duration,h=s.duration||d;this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const u=this._modules.animations.play(c=>{const[g,f,m]=l(c);this._x=g,this._y=f,this._zoom=a/m,this._modules.events.fire("move"),this._modules.events.fire("pan")},{duration:h,easing:s.easing,callback:()=>this.moveEnd("pan"),resolve:o});u&&(this._moveAnimation=u)})}zoomOut(e,s={x:void 0,y:void 0}){let i=1;return e===void 0&&(e={}),typeof e=="number"&&(e={modifier:e}),i=typeof e.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||eu:e.modifier,this.setZoom(this._zoom/i,e,s)}getAngle(){return this._angle}setAngle(e,s){const i=this._angle,n=e-i;return Ea(n)?Promise.resolve():new Promise(r=>{this._rotateAnimation&&this._modules.animations.cancel(this._rotateAnimation);const o=this._modules.animations.play(a=>{for(this._angle=i+n*a,this.calculateBoxCornerAngles();this._angle>Math.PI;)this._angle-=2*Math.PI;for(;this._angle<-Math.PI;)this._angle+=2*Math.PI;this._sinAngle=Math.sin(this._angle),this._cosAngle=Math.cos(this._angle),this._modules.events.fire("move").fire("rotate")},{...Bd,...s,callback:()=>this.moveEnd("rotate"),resolve:r});o&&(this._rotateAnimation=o)})}rotate(e,s){return this.setAngle(this._angle+e,s)}getScreenCenter(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}}graphToScreenCoordinates({x:e,y:s},i={x:0,y:0}){const n=this._dimensions.width/2,r=this._dimensions.height/2;return gl((e-this._x)*this._zoom+n,(s-this._y)*this._zoom+r,n,r,-this._angle,i)}screenToGraphCoordinates({x:e,y:s},i={x:0,y:0}){return gl(this._x+(e-this._dimensions.width/2)/this._zoom,this._y+(s-this._dimensions.height/2)/this._zoom,this._x,this._y,this._angle,i)}projectBounds(e,s=e){const i=e[0],n=e[1],r=e[2],o=e[3],a=this._x,l=this._y,d=this._dimensions.width/2,h=this._dimensions.height/2,u=this._sinAngle,c=this._cosAngle,g=1/this._zoom;let f=1/0,m=1/0,_=-1/0,p=-1/0;const x=[i,n,i,o,r,o,r,n];for(let y=0;y<x.length;y+=2){let b=x[y],v=x[y+1];b=a+(b-d)*g,v=l+(v-h)*g;const E=b-a,A=v-l;b=c*E-u*A+a,v=u*E+c*A+l,b<f&&(f=b),b>_&&(_=b),v<m&&(m=v),v>p&&(p=v)}return s[0]=f,s[1]=m,s[2]=_,s[3]=p,s}screenToGraphVector({x:e,y:s}){return mm({x:e,y:s},this._zoom,this._sinAngle,this._cosAngle)}getView(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}}setView(e,s){const{x:i,y:n,zoom:r,angle:o}={x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,...e};return Promise.all([this.setCenter({x:i,y:n},s),this.setZoom(r,s),this.setAngle(o,s)]).then(Yt)}_reloadDimensions(){this._dimensions=this._modules.dom.getDimensions()}animationInProgress(){const e=this._moveAnimation,s=this._zoomAnimation,i=this._rotateAnimation;return!!(e&&!e.done||s&&!s.done||i&&!i.done)}getProjectedScreenBounds(e=0){const{width:s,height:i}=this._dimensions,n=Math.max(s,i)*e;return this.projectBounds([0-n,0-n,s+n,i+n])}calculateBoxCornerAngles(){const e=this._angle;this._cornerCosSin[0]=Math.cos(e+Math.PI/4),this._cornerCosSin[1]=Math.sin(e+Math.PI/4),this._cornerCosSin[2]=Math.cos(e+3*Math.PI/4),this._cornerCosSin[3]=Math.sin(e+3*Math.PI/4),this._cornerCosSin[4]=Math.cos(e-3*Math.PI/4),this._cornerCosSin[5]=Math.sin(e-3*Math.PI/4),this._cornerCosSin[6]=Math.cos(e-Math.PI/4),this._cornerCosSin[7]=Math.sin(e-Math.PI/4)}getCornerCos(e){return this._cornerCosSin[2*e]}getCornerSin(e){return this._cornerCosSin[2*e+1]}_reset(){this._zoom=1,this._x=0,this._y=0,this._angle=0,this.calculateBoxCornerAngles(),this._sinAngle=0,this._cosAngle=1,this._dimensions=this._modules.dom.getDimensions()}clone(e){const s=new _0(this._ogma);return s._zoom=e.zoom||this._zoom,s._x=e.x||this._x,s._y=e.y||this._y,s._angle=e.angle||this._angle,s._sinAngle=Math.sin(s._angle),s._cosAngle=Math.cos(s._angle),s.calculateBoxCornerAngles(),s._dimensions={width:e.width||this._dimensions.width,height:e.height||this._dimensions.height},s}};function mm({x:t,y:e},s,i,n){return{x:n*(t/=s)-i*(e/=s),y:i*t+n*e}}function _m(t){return typeof t=="number"&&isFinite(t)}function oL(t){const e=t.filter(s=>isFinite(s)&&s>0);return e.length?yi(e):1}var aL="anonymous",lL="white",dL="default",hL={maxBlockId:1024,maxCoord:-1/0,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1,maxSymbolicSize:0,maxPatternScale:0},uL=zl?"webgl":null,pm=5,cL=class extends Bt{constructor(){super(...arguments),this._debug=!1,this._initDone=!1,this._boundaries={maxSize:10,maxMinVisibleSize:64},this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0},this._nextAnimationId=1,this._animations=[],this._rendererState={type:null,code:null,state:"ok",message:""},this._cursorStyle=[],this._fontsNewlyLoaded=[],this._nextGeIndex=1,this._availableGeIndexes=[],this._renderOnNewFrame=!0,this._isBufferDisplayable=t=>{const e=O2(t),s=Gx(t),i=e?this._visibility.nodes:this._visibility.edges,n=e?this._visibility.nodeTexts:this._visibility.edgeTexts;return i===0&&(!s||n===0)},this._onRendererChange=t=>{this._updateRendererState({type:t,state:"requested",code:null,message:void 0}),this._engine.setRenderType(t),this._modules.dom.refresh()},this._onNewFrame=()=>{this._processAnimations(),this._loadGraphInGraphicsEngine(),this._renderOnNewFrame&&this._render()},this._applyCursorStyle=()=>{const t=this._cursorStyle[this._cursorStyle.length-1]||this._modules.settings.get("cursor.default");rl(this._domWrapper,t)},this._updateImageCrossOrigin=()=>{this._imageManager.setImgCrossOrigin(this._modules.settings.get("imgCrossOrigin")||null)}}onMounted(){this._debug=this._ogma.isDebug(),this._renderOnNewFrame=!0,this._formatText=Ax().applyArabicShaping,this._attributesManager=new XC(this._ogma,this._modules),this._imageManager=new DI,this._fontManager=new C2,this._engine=new Rd(Rd.getCachedInitData()),this._domWrapper=this._engine.getDomWrapper(),this._engine.on("error",this._onNewFrame),this._nodeAnimationMap=new Map,this._edgeAnimationMap=new Map,this._movingNodes=new Set,this._movingEdges=new Set,this._modules.events.register(["reloadFonts","rendererStateChange","beforeUpdateAttributes","updateAttributes","animate","move","pan","zoom","rotate","viewExportStart","viewExportEnd","afterImageExport","viewChanged","zoomStart"]),this._modules.settings.register("renderer",uL,this._onRendererChange),this._modules.settings.register("edgeTipRatio",Qy,t=>{this._engine.setEdgeArrowSizeRatio(t),this._modules.dom.refresh()}),this._modules.settings.register("edgeMinTipSize",Jy,t=>{this._engine.setEdgeMinTipSize(t),this._modules.dom.refresh()}),this._modules.settings.register("backgroundColor",lL,t=>{this._engine.parseColor(t)?this._modules.dom.refresh():(Ei(`Invalid background color "${t}" specified; will default to black.`),this._modules.settings.set("backgroundColor","black"))}),this._modules.settings.register("texts.hideUntilFontsLoaded",!0,t=>{this._fontManager.setHideUntilFontsLoaded(!!t)}),this._modules.settings.register("texts.cornerRadius",pm,t=>{this._engine.getTextManager().setCornerRadius(typeof t=="number"?t:pm),this._modules.dom.refresh()}),this._modules.settings.register("imgCrossOrigin",aL,this._updateImageCrossOrigin),this._modules.settings.register("cursor.default",dL,this._applyCursorStyle),this._modules.dom.setLayer("graphics",this._domWrapper),this._engine.setGlobalBoundaries(hL),this._modules.dom.beforeNextFrame().then(()=>{this._initDone=!0,this._fireRendererStateChangeEvent()}),this._imageManager.onFetch(()=>{this._engine.notifyPatternUpdate(),this._modules.dom.refresh()}),this._fontManager.onFontLoaded(t=>{this._fontsNewlyLoaded.push(t),this._engine.notifyPatternUpdate(),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}),this._modules.dom.addMediaListener("(min-resolution: 2dppx)",()=>this._modules.dom.refresh()),this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${vh})`,tag:vh,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${Eh})`,tag:Eh,nodeDependencies:void 0,edgeDependencies:void 0}),em(this._engine,this._attributesManager.getFlexArrays()),this._modules.events.on("move",()=>this._modules.dom.refresh()).on("frame",this._onNewFrame).on("viewExportStart",()=>{this._renderOnNewFrame=!1}).on("viewExportEnd",()=>{this._renderOnNewFrame=!0}).on("clearGraph",()=>{this._nextGeIndex=1,this._availableGeIndexes=[],this._engine.clear(),this._attributesManager.clear(),this._modules.dom.refresh(),this._animations=[],this._nodeAnimationMap.clear(),this._edgeAnimationMap.clear()}).on("viewChanged",({type:t})=>{if(t==="rotate"){const e=this._modules.graph.getEdges().filter(s=>s.getAttribute("adjustAnchors"));this._attributesManager.redrawElements(e)}}).on("addNodes",t=>{this._attributesManager.updateForAllAttributeLayers(t.nodes)}).on("addEdges",t=>{this._attributesManager.updateForAllAttributeLayers(t.edges)}).on("excludedStateChange",t=>{this._visibleAttributeLayer.updateElements(t.elements)}).on("setData",t=>{this._dataAttributeLayer.updateElements(t.elements)}),Rd.clearCachedInitData(),this._modules.dom.addWindowEventListener("unload",()=>this.destroy())}onReady(t){t.renderer!==void 0&&this._ogma.setOptions({renderer:t.renderer}),t.imgCrossOrigin!==void 0&&this._ogma.setOptions({imgCrossOrigin:t.imgCrossOrigin})}getTransparentBackgroundColor(){const t=this._modules.settings.get("backgroundColor");return t?this._engine.transparentify(t):null}_render(){const t=this._modules.dom.getDimensions(),e=this._modules.camera.getView(),s=ps(),i=ts(),n=this._modules.settings.get("backgroundColor"),r=this._isBufferDisplayable;this._engine.setView({x:e.x,y:e.y,zoom:e.zoom,angle:e.angle,width:t.width,height:t.height,pixelRatio:s,currentTime:i,backgroundColor:n,isBufferDisplayable:r});try{this._engine.render(),this._rendererState.state==="requested"&&this._updateRendererState({state:"ok"})}catch(o){if(this._debug)throw o;const{message:a,code:l="OTHER"}=o,d=this._rendererState.type,h=L1(d);let u=this._rendererState.state==="requested"?`Error while initializing the ${h} renderer`:`The ${h} renderer encountered an unexpected runtime error`,c=null;d==="webgl"&&(u+="; fallbacking on canvas renderer",c="canvas"),Ei(a||""),Ei(u),this._updateRendererState({state:"error",code:l,message:a}),this._modules.settings.set("renderer",c)}}_fireRendererStateChangeEvent(){const t=this._rendererState;this._modules.events.fire("rendererStateChange",{type:t.type,state:t.state,code:t.code,message:t.message})}_updateRendererState({type:t,state:e,code:s,message:i}){let n=!1;t!==void 0&&this._rendererState.type!==t&&(this._rendererState.type=t,n=!0),e!==void 0&&this._rendererState.state!==e&&(this._rendererState.state=e,n=!0),s!==void 0&&this._rendererState.code!==s&&(this._rendererState.code=s,n=!0),i!==void 0&&this._rendererState.message!==i&&(this._rendererState.message=i,n=!0),n&&this._initDone&&this._fireRendererStateChangeEvent()}getImageData(){return this._modules.dom.afterNextFrame().then(()=>this._engine.getImageData())}getNodeAttributes(){return this._attributesManager.getFlexArrays().nodes.current}getEdgeAttributes(){return this._attributesManager.getFlexArrays().edges.current}getGraphicsEngine(){return this._engine}getImageManager(){return this._imageManager}getFontManager(){return this._fontManager}allocateGraphicsEngineBlockId(){return this._availableGeIndexes.length?this._availableGeIndexes.pop():this._nextGeIndex++*Kl+jT}releaseGraphicsEngineBlockId(t){this._engine.freeBlock(t),this._availableGeIndexes.push(t),this._modules.dom.refresh()}addCursorStyle(t){t&&(this._cursorStyle.push(t),this._applyCursorStyle())}removeCursorStyle(t){if(!t)return;const e=this._cursorStyle.lastIndexOf(t);e!==-1&&(this._cursorStyle.splice(e,1),this._applyCursorStyle())}reloadFonts(){this._modules.events.fire("reloadFonts"),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}getDomElement(){return this._domWrapper}setTextHidden(t,e){this._attributesManager.setTextHidden(t,e)}resetTextHidden(){this._attributesManager.resetTextHidden(),this._modules.dom.refresh()}getAttributesManager(){return this._attributesManager}_checkFontsNewlyLoaded(){return!!this._fontsNewlyLoaded.length&&(this._fontsNewlyLoaded=[],!0)}_loadGraphInGraphicsEngine(){this._attributesManager.update(),this._checkFontsNewlyLoaded()&&this._attributesManager.redrawAll(),this._modules.events.fire("beforeUpdateAttributes");const{elementsToRedraw:t,elementsUpdated:e}=this._attributesManager.getUpdatedElements(),s=e.nodes.size>0||e.edges.size>0;(e.nodeAttributesSet.has("radius")||e.edgeAttributes.includes("width"))&&(this._boundaries.maxSize=C1(this._modules.graph)),(e.nodeAttributesSet.has("shape")||e.edgeAttributes.includes("shape.head")||e.edgeAttributes.includes("shape.tail"))&&em(this._engine,this._attributesManager.getFlexArrays()),bI({graph:this._modules.graph,elements:t,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._modules.camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText}),s&&this._modules.events.fire("updateAttributes",e)}_forceCompleteGraphRefresh(){this._attributesManager.redrawAll(),this._loadGraphInGraphicsEngine()}export(t,e,s,i){let n;return Promise.all([this._modules.graph.getNodes().addClass(un),this._modules.graph.getEdges().addClass(un)]).then(()=>this.resolveAtNextFrame()).then(()=>this._imageManager.whenReady()).then(()=>{s==="all"?(n=mL(this._modules.graph),this._forceCompleteGraphRefresh()):this._loadGraphInGraphicsEngine();const r=this._modules.camera.clone({...e});return this._modules.events.fire("viewExportStart",{preventOverlap:i.preventOverlap,camera:r,view:r.getView()}),this._ogma.view.afterNextFrame().then(()=>this._engine.export(t,e,i))}).then(r=>Promise.all([this._modules.graph.getNodes().removeClass(un),this._modules.graph.getEdges().removeClass(un)]).then(()=>r)).then(r=>(s==="all"&&(_L(n),this._forceCompleteGraphRefresh()),this._modules.events.fire("viewExportEnd"),r))}addAttributeLayer(t){return this._attributesManager.addAttributeLayer(t)}getAttributeValues(t,e,s,i){return this._attributesManager.getAttributeValues(t,e,s,i)}forceAttributesComputation(){this._attributesManager.update()}resolveAtNextFrame(t){return this._modules.dom.afterNextFrame().then(()=>t)}isMoving(t){return(t.isNode?this._movingNodes:this._movingEdges).has(t._index)}animate(t,e,s,i){const n=gL(i);return n.duration&&this._engine.ensureAnimationsReady(),this._animate(t,e,s,n)}isAnimating(){return this._animations.length>0}getAnimationInformation(t){return this._attributesManager.getAnimationInformation(t)}_toSubGraph(t){if(t instanceof Pi||t instanceof js)return{nodes:t.toList(),edges:t.getAdjacentEdges()};if(t instanceof Ln||t instanceof Zi)return{nodes:this._modules.graph.nodeList(),edges:t.toList()};const e=t,s={nodes:e.nodes||this._modules.graph.nodeList(),edges:e.edges||this._modules.graph.edgeList()};return s.nodes.size&&(s.edges.size?s.edges=s.edges.concat(s.nodes.getAdjacentEdges()).dedupe():s.edges=s.nodes.getAdjacentEdges()),s}_animate(t,e,s,{duration:i,easing:n}){if((!this._animations.length||s)&&!i)return e(t),Promise.resolve(t);const r=this._toSubGraph(t),o=r.nodes,a=r.edges;if(o.size===0&&a.size===0)return e(t),Promise.resolve(t);if(o.size){if(s)for(let c=0;c<o._indexes.length;c++)this._movingNodes.add(o._indexes[c]);this._modules.events.fire("animate",{elements:o,duration:i,updatesPositions:s,easing:n})}if(a.size){if(s)for(let c=0;c<a._indexes.length;c++)this._movingEdges.add(a._indexes[c]);this._modules.events.fire("animate",{elements:a,duration:i,updatesPositions:s,easing:n})}const l={id:this._nextAnimationId++,startTime:ts(),finished:!1,func:()=>e(t),duration:i,easing:n,nodes:o,edges:a,started:!1,updatesPositions:s,resolve:Yt};let d=l;const h=new Set;if(d=this._getLongestAnimation(d,l.nodes,h),d=this._getLongestAnimation(d,l.edges,h),d.updatesPositions){for(let c=0;c<o._indexes.length;c++)this._nodeAnimationMap.set(o._indexes[c],d);for(let c=0;c<a._indexes.length;c++)this._edgeAnimationMap.set(a._indexes[c],d);l.duration=d.duration,l.startTime=d.startTime}if(l.duration===0&&d.id===l.id)return e(t),Promise.resolve(t);const u=new Promise(c=>l.resolve=()=>c(t));return this._animations.push(l),this._modules.dom.refresh(),i||this._processAnimations(),u}_removeFinishedAnimations(){this._animations=this._animations.filter(t=>!t.finished)}_getAnimationElements(t){return{nodes:t.nodes,edges:t.edges}}_resetAnimationAttributes({nodes:t,edges:e}){this._attributesManager.resetAnimationAttributes({nodes:t,edges:e});for(let s=0;s<t._indexes.length;s++)this._nodeAnimationMap.delete(t._indexes[s]),this._movingNodes.delete(t._indexes[s]);for(let s=0;s<e._indexes.length;s++)this._edgeAnimationMap.delete(e._indexes[s]),this._movingEdges.delete(t._indexes[s])}_getLongestAnimation(t,e,s){const i=e.isNode?this._nodeAnimationMap:this._edgeAnimationMap;for(let n=0;n<e._indexes.length;n++){const r=i.get(e._indexes[n]);r&&!s.has(r.id)&&(s.add(r.id),(t.updatesPositions||!r.updatesPositions)&&r.duration+r.startTime<t.duration+t.startTime||(t=r))}return t}_processAnimations(){if(!this._animations.length)return;const t=ts(),e=[];this._attributesManager.update();for(const s of this._animations)s.started||(s.started=!0,e.push(s.func),this._attributesManager.setAnimationAttributes(this._getAnimationElements(s),s));for(const s of e)s();for(const s of this._animations)t>=s.startTime+s.duration&&(this._resetAnimationAttributes(this._getAnimationElements(s)),s.resolve(s.elements),s.finished=!0);this._removeFinishedAnimations(),this._animations.length&&this._modules.dom.refresh()}hideTexts(){this.setNodeTextsVisibility(!1),this.setEdgeTextsVisibility(!1)}showTexts(){this.setNodeTextsVisibility(!0),this.setEdgeTextsVisibility(!0)}setNodesVisibility(t){return this._updateVisibilityCounter("nodes",t)}setNodeTextsVisibility(t){return this._updateVisibilityCounter("nodeTexts",t)}setEdgesVisibility(t){return this._updateVisibilityCounter("edges",t)}setEdgeTextsVisibility(t){return this._updateVisibilityCounter("edgeTexts",t)}_updateVisibilityCounter(t,e){this._visibility[t]+=e?-1:1,this._modules.dom.refresh()}detectNode(t,e,s,i,n,r){return T1(t,e,s,i,n,r,this._modules.graph,this._attributesManager,this._modules.camera,this._engine,this._movingNodes,this._formatText)}detectEdge(t,e,s,i,n){const{bentEnable:r,bentVertical:o}=this._modules.graphics.getGraphicsEngine().getBentEdges();return I1(t,e,s,i,n,this._modules.graph,this._modules.camera,this._movingNodes,this._attributesManager,r,o)}getVisibilityCounters(){return this._visibility}destroy(){this.getGraphicsEngine().destroy(),this.getImageManager().destroy(),this.getFontManager().destroy()}};function gL(t){return typeof t=="number"?t={duration:t}:typeof t=="object"&&t!==null||(t={duration:0}),{duration:fL(t.duration),easing:t.easing||"linear",chain:!!t.chain}}function fL(t){return typeof t!="number"||!isFinite(t)||t<0?0:t}function ym(t,e){const s=e?t.getNodeAttribute("excluded"):t.getEdgeAttribute("excluded"),i=(e?t.getNodes("all"):t.getEdges("all"))._indexes,n=s.getMultiple(i);return s.fill(i,0),{excludedList:s,indexes:i,values:n}}function xm({excludedList:t,indexes:e,values:s}){t.setMultiple(e,s)}function mL(t){return{nodes:ym(t,!0),edges:ym(t,!1)}}function _L({nodes:t,edges:e}){xm(t),xm(e)}var pL=250,yL=50,xL=class extends Bt{constructor(){super(...arguments),this._onAnyEvents=[],this._registeredEvents={},this.onIdle=Fl(()=>this.fire("idle"),yL)}onMounted(){this._registeredEvents={},this.register(["idle"]),this._ogma.onReady(()=>{this.on(["viewChanged","layoutEnd","addNodes","addEdges","removeNodes","removeEdges","animate","setMultipleAttributes","transformationRefresh"],()=>{this._modules.dom.clearTimeout(this._idleTimeout),this._idleTimeout=this._modules.dom.setTimeout(this.onIdle,pL)})})}isRegistered(t){return!!this._registeredEvents[t]}register(t,e=[]){t.forEach(s=>{if(this._registeredEvents[s])throw new Error(`event "${s}" already exists`);this._registeredEvents[s]=new bL(!1,s)})}onAnyEvent(t){this._onAnyEvents.push(t)}on(t,e){return Array.isArray(t)?(t.forEach(s=>this.on(s,e)),this):this._registeredEvents[t]?(this._registeredEvents[t].on(e),this):this}off(t){return Object.values(this._registeredEvents).forEach(e=>{e.off(t)}),this}fire(t,e=null){const s=this._getEvent(t);return this._onAnyEvents.forEach(i=>i(e,t)),s.trigger(e),this}once(t,e){const s=this,i=function(){e.apply(null,arguments),s.off(i)};return this.on(t,i)}_getEvent(t){if(!(t in this._registeredEvents))throw new Error(`Event ${t} does not exist`);return this._registeredEvents[t]}destroy(){Object.values(this._registeredEvents).forEach(t=>{t.destroy()})}},bL=class{constructor(t,e){this._subscribers=[],this._handlers=[],this._reverseOrder=t,this._name=e}trigger(t){for(const e of this._handlers)e(t,this._name);return this}on(t){if(typeof t!="function")throw new Error("handler is not a function");const e=this._reverseOrder?0:this._subscribers.length;return this._handlers.splice(e,0,t),this._subscribers.splice(e,0,t),this}off(t){let e;for(;(e=this._subscribers.indexOf(t))!==-1;)this._subscribers.splice(e,1),this._handlers.splice(e,1);return this}destroy(){this._subscribers=[],this._handlers=[]}},vL=class extends Bt{onMounted(){this._graphics=this._modules.graphics,this._modules.events.register(["setMultipleAttributes"]),this._modules.events.on(["addNodes","addEdges"],({nodes:t,edges:e,objects:s})=>{this._onAddElements(t||e,s)}),this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:yS,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:vS,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0})}_onAddElements(t,e){const s=e.map(i=>i.attributes);this._originalAttributesLayer.setAttributeValues(t,s)}getOriginalAttributes(){return this._originalAttributesLayer.getFlexArrays()}getIndividualAttributes(){return this._individualAttributesLayer.getFlexArrays()}setMultipleAttributes(t,e,s){const i=Array.isArray(e)?e.length&&e[0]?Sl(e[0],t.isNode):[]:Sl(e,t.isNode),n=i.includes("x")||i.includes("y"),r=[];return this._modules.events.fire("setMultipleAttributes",{elements:t,values:e,updatedAttributes:i,options:s,promises:r}),this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,e)},n,s).then(o=>Promise.all(r).then(()=>o))}setSingleAttribute(t,e,s,i){const n={};return vi(n,e,s),this.setMultipleAttributes(t,n,i)}resetMultipleAttributes(t,e,s){const i=e||this._individualAttributesLayer.getUsedAttributeNames(t),n=i&&(i.includes("x")||i.includes("y")),r={};for(const o of i)vi(r,o,void 0);return this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,r)},n,s)}getMultipleAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!1)}getSingleAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!1)}replaceOriginalAttributes(t,e,s=[]){const i={},n=this._originalAttributesLayer.getUsedAttributeNames(t).filter(r=>!s.includes(r));for(let r=0;r<n.length;++r)vi(i,n[r],void 0);this._originalAttributesLayer.setAttributeValues(t,i),this._originalAttributesLayer.setAttributeValues(t,e)}getSinglePreviousAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!0)}getMultiplePreviousAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!0)}},EL=class extends Bt{constructor(){super(...arguments),this._currentValue={},this._onChange={},this._defaultValues={},this._keys=[]}onReady(t){t.renderer&&this.update({renderer:t.renderer}),t.options&&this.update(t.options)}register(t,e,s,i){return i===void 0&&(i=!0),this._keys.push(t),this._currentValue[t]=e,this._defaultValues[t]=e,this._onChange[t]=s||Yt,s&&i&&s(e),this}update(t){t=ao(t);const e=this._keys,s={},i=this._currentValue;for(let r=0;r<e.length;++r){const o=e[r];if(o in t){let a=t[o];a===void 0&&(a=this._defaultValues[o]),s[o]=i[o],i[o]=a}}const n=Object.keys(s);for(let r=0;r<n.length;++r){const o=n[r],a=this._currentValue[o],l=s[o];a!==l&&this._onChange[o](a,l)}return lh(s)}get(t){return arguments.length===0?lh(this._currentValue):this._currentValue[t]}set(t,e){const s=this._currentValue[t],i=this._onChange[t];this._currentValue[t]=e,i&&i(e,s)}},AL=class{constructor(t,e){this._classes=t,this._name=e}getName(){return this._name}getIndex(){return this._classes.getIndex(this._name)}setIndex(t){return this._classes.setIndex(this._name,t)}update(t){return this._classes.update(this._name,t),this}getDefinition(){return this._classes.getDefinition(this._name)}getNodes(t){return this._classes.getElementsByClass(this._name,t).nodes}getEdges(t){return this._classes.getElementsByClass(this._name,t).edges}clearNodes(t){this.getNodes(t).removeClass(this._name)}clearEdges(t){this.getEdges(t).removeClass(this._name)}add(t){t.addClass(this._name)}remove(t){t.removeClass(this._name)}destroy(){const t=this._classes.getElementsByClass(this._name);return Promise.all([t.nodes.removeClass(this._name),t.edges.removeClass(this._name)]).then(()=>this._classes.removeClass(this._name))}},SL=1e3,wL=.5/SL,TL=class extends Bt{constructor(){super(...arguments),this._builtinClasses=[],this._userClasses=[],this._classesByName={},this._onExcludedStateChange=({elements:t,value:e})=>{if(e){const s=this._builtinClasses.map(i=>i.name);this._addOrRemoveClassesToElements(s,t,!1)}},this._onClearGraph=()=>{this._builtinClasses.concat(this._userClasses).forEach(t=>t.elementSet.clear())},this._onRemoveElements=({nodes:t,edges:e})=>{const s=t||e;this._builtinClasses.concat(this._userClasses).forEach(i=>i.elementSet.removeElements(s))}}onMounted(){this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on("clearGraph",this._onClearGraph).on("removeEdges",this._onRemoveElements).on("removeNodes",this._onRemoveElements)}_getClassList(t){return t?this._builtinClasses:this._userClasses}createClass({name:t,isBuiltin:e=!1,after:s,nodeAttributes:i,nodeDependencies:n,nodeOutput:r,edgeAttributes:o,edgeDependencies:a,edgeOutput:l}={}){if(typeof t!="string")throw new Error('the "name" argument should be a string');const d=this._getClassList(e),h=s?IL(d,s)+1:d.length;if(h===-1)throw new Error(`createClass: class specified as \`after\` parameter "${s}" does not exist`);if(e&&!t.startsWith("_"))throw new Error(`invalid builtin class name "${t}": builtin classes should start with '_'`);const u=new Oo(this._modules.graph),c=new AL(this,t),g={name:t,elementSet:u,attributeLayer:this._modules.graphics.addAttributeLayer({name:`class(${t})`,tag:t,standaloneSelectors:!0,nodeAttributes:i||void 0,edgeAttributes:o||void 0,nodeSelector:(f,m)=>m.hasElement(f),edgeSelector:(f,m)=>m.hasElement(f),nodeContext:u,edgeContext:u,nodeOutput:r,edgeOutput:l,nodeDependencies:n,edgeDependencies:a}),isBuiltin:e,wrapper:c};return d.splice(h,0,g),e&&d.sort((f,m)=>Fg.indexOf(f.name)-Fg.indexOf(m.name)),this._updatePriorities(e),this._classesByName[t]=g,this._modules.events.register([Dn(t,!0,!0),Dn(t,!0,!1),Dn(t,!1,!0),Dn(t,!1,!1)]),c}removeClass(t){const e=this._get(t),s=this._getClassList(e.isBuiltin),i=s.indexOf(e);if(i===-1)throw new Error(`class "${t}" does not exist`);return s.splice(i,1),e.attributeLayer.destroy(),delete this._classesByName[t],this._updatePriorities(e.isBuiltin),Promise.resolve(void 0)}_updatePriorities(t){const e=this._getClassList(t),s=ES+(t?.5:0);for(let i=0;i<e.length;++i){const n=e[i],r=s+wL*i;n.attributeLayer.update({priority:r})}}_get(t){const e=this._classesByName[t];if(!e)throw new Error(`class "${t}" does not exist`);return e}getIndex(t){const e=this._get(t);return this._getClassList(e.isBuiltin).indexOf(e)}setIndex(t,e){const s=this._get(t),i=this._getClassList(s.isBuiltin),n=i.indexOf(s),r=Os(e,0,i.length-1);i.splice(n,1),i.splice(r,0,s),this._updatePriorities(s.isBuiltin)}update(t,{nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a}={}){this._get(t).attributeLayer.update({nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a})}getDefinition(t){const e=this._get(t),{nodeAttributes:s,nodeDependencies:i,nodeOutput:n,edgeAttributes:r,edgeDependencies:o,edgeOutput:a}=e.attributeLayer.getDefinition();return{nodeAttributes:s||void 0,edgeAttributes:r||void 0,nodeDependencies:i,edgeDependencies:o,nodeOutput:n,edgeOutput:a}}_addOrRemoveClassesToElements(t,e,s){const i=e.isNode;for(let n=0;n<t.length;++n){const r=t[n],{elementSet:o,attributeLayer:a}=this._get(r),l=o.addOrRemoveElements(e,s),d=Dn(r,i,s);l.size&&(a.updateElements(l),this._modules.events.fire(d,i?{nodes:l}:{edges:l}))}}_animatedAttributesUpdatePositions(t,e){for(let s=0;s<t.length;++s){const i=t[s],n=this.getDefinition(i);if(e.isNode&&n.nodeAttributes&&(n.nodeAttributes.x||n.nodeAttributes.y))return!0}return!1}_getAnimatedAtrributes(t,e){return t.reduce((s,i)=>{const n=this.getDefinition(i);return e.isNode&&n.nodeAttributes&&s.push(...Sl(n.nodeAttributes,!0)),!e.isNode&&n.edgeAttributes&&s.push(...Sl(n.edgeAttributes,!1)),s},[])}addClassesToElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!0)},n,s)}removeClassesFromElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!1)},n,s)}hasSingleElementClass(t,e){return this._get(t).elementSet.hasElement(e)}getElementsClassList(t,e={}){const{includeBuiltinClasses:s=!1}=e,i=new Array(t.size);for(let n=0;n<i.length;++n)i[n]=[];return this._addClassNamesToList(i,t,this._userClasses),s&&this._addClassNamesToList(i,t,this._builtinClasses),i}_addClassNamesToList(t,e,s){const i=e.toList();for(let n=0;n<s.length;++n){const{name:r,elementSet:o}=s[n];for(let a=0;a<i.size;++a){const l=i.get(a);o.hasElement(l)&&t[a].push(r)}}}getClassByName(t,e=!1){const s=this._classesByName[t]||null;if(e&&!s)throw new Error(`class "${t}" does not exist`);return s&&s.wrapper}getClassList(){return this._userClasses.map(t=>t.wrapper)}getElementsByClass(t,e="visible"){const{elementSet:s}=this._get(t),i=s.getElements();let n=i.nodes,r=i.edges;return e==="visible"?(n=n.filter(o=>o.isVisible()),r=r.filter(o=>o.isVisible())):e==="raw"&&(n=n.filter(o=>!o.isVirtual()),r=r.filter(o=>!o.isVirtual())),{nodes:n,edges:r}}_onClassEvent(t,e,s,i){const n=Dn(t,s,i);this._modules.events.on(n,e)}onNodeClassAdded(t,e){this._onClassEvent(t,e,!0,!0)}onNodeClassRemoved(t,e){this._onClassEvent(t,e,!0,!1)}onEdgeClassAdded(t,e){this._onClassEvent(t,e,!1,!0)}onEdgeClassRemoved(t,e){this._onClassEvent(t,e,!1,!1)}};function Dn(t,e,s){return`${e?"node":"edge"}Class${s?"Added":"Removed"}_${t}`}function IL(t,e){for(let s=0;s<t.length;++s)if(t[s].name===e)return s;return-1}var p0=()=>({x:0,y:0,x1:0,y1:0,x2:0,y2:0});function bm(t,e,s,{cells:i=!0,boxes:n=!0,query:r=!0}={}){const o=e.keys().map(l=>e.keyToBBox(Number(l))),a=e.getBoxes();if(i&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#707070",o.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.stroke()),n&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#ff7070",a.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.closePath(),t.stroke()),r&&s){const l=s;t.beginPath(),t.lineWidth=2,t.strokeStyle="#3030ff",t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1]),t.closePath(),t.stroke()}}function CL(t){const[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o]=t.getEdgeAttributes(["source","target","curvature"]),a=p0(),l=cc();return d=>{if(d<0){d=-d;const h=n.get(d),u=r.get(d),c=o.get(d),g=e.get(h),f=s.get(h),m=e.get(u),_=s.get(u);h===u?(Ql(g,f,c,i.get(h),0,a),ed(g,f,a.x1,a.y1,a.x2,a.y2,m,_,l)):c===0?(l.minX=Math.min(g,m),l.minY=Math.min(f,_),l.maxX=Math.max(g,m),l.maxY=Math.max(f,_)):(Nn(g,f,m,_,c,a),fc(g,f,a.x,a.y,m,_,l))}else{const h=e.get(d),u=s.get(d),c=i.get(d);l.minX=h-c,l.minY=u-c,l.maxX=h+c,l.maxY=u+c}return[l.minX,l.minY,l.maxX,l.maxY]}}var LL=["x","y","radius"],NL=["width","curvature"],ML=.5,PL=class extends Bt{constructor(){super(...arguments),this._minCellSize=8,this._clear=()=>{this._index.clear(),this._elementsToUpdate.clear()},this._onGraphUpdate=t=>{if(t.nodes&&(!t.nodeAttributes||t.nodeAttributes.some(e=>LL.includes(e)))){const e=t.nodes.fastGetAdjacentElements().edges;this._elementsToUpdate.addElements(t.nodes),this._elementsToUpdate.addElements(e)}t.edges&&(t.edgeAttributes&&!t.edgeAttributes.some(e=>NL.includes(e))||this._elementsToUpdate.addElements(t.edges))}}onMounted(){this._index=new ww(this._getIntersector(),CL(this._modules.graph),this._minCellSize,1e6),this._elementsToUpdate=new Oo(this._modules.graph),this._removedNodes=this._modules.graph.getNodeAttribute("removed"),this._removedEdges=this._modules.graph.getEdgeAttribute("removed"),this._excludedNodes=this._modules.graph.getNodeAttribute("excluded"),this._excludedEdges=this._modules.graph.getEdgeAttribute("excluded"),this._queryResult={edges:[],nodes:[]},this._queryBounds=[0,0,0,0],this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges","updateAttributes"],this._onGraphUpdate).on("excludedStateChange",({elements:t})=>{this._elementsToUpdate.addElements(t)}).on("clearGraph",this._clear)}_getIntersector(){const t=this._modules.graph,[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o,a]=t.getEdgeAttributes(["source","target","width","curvature"]),l=p0(),d=this._modules.camera.getAngle(),h=Math.cos(d),u=Math.sin(d);return(c,g,f,m,_)=>{const{bentEnable:p,bentVertical:x}=this._modules.graphics.getGraphicsEngine().getBentEdges();if(c<0){c=-c;const y=n.get(c),b=r.get(c),v=a.get(c),E=o.get(c)/2,A=e.get(y),S=s.get(y),w=e.get(b),L=s.get(b);return p?(Jl(A*h-S*u,S*h+A*u,w*h-L*u,L*h+w*u,v,p,x,l),Nh(A,S,l.x1*h+l.y1*u,l.y1*h-l.x1*u,l.x2*h+l.y2*u,l.y2*h-l.x2*u,w,L,g-E,f-E,m+E,_+E)):y===b?(Ql(A,S,v,i.get(y),0,l),Nh(A,S,l.x1,l.y1,l.x2,l.y2,w,L,g-E,f-E,m+E,_+E)):v===0?mc(A,S,w,L,g-E,f-E,m+E,_+E):(Nn(A,S,w,L,v,l),My(A,S,l.x,l.y,w,L,g-E,f-E,m+E,_+E))}return $u(e.get(c),s.get(c),i.get(c),g,f,m,_)}}reindex(){this._modules.graphics.forceAttributesComputation(),this._index.clear(),this._elementsToUpdate.clear(),this._updateItems(this._modules.graph.getNodes("all")._indexes,this._modules.graph.getEdges("all")._indexes)}getSize(){return this._index.size}_updateIndex(){if(!this._elementsToUpdate.isEmpty()){const{nodes:t,edges:e}=this._elementsToUpdate.getElements();if(t._indexes.length/this._modules.graph.getNodes("all").size>ML)return void this.reindex();this._updateItems(t._indexes,e._indexes),this._elementsToUpdate.clear()}}_updateItems(t,e){const s=this._index,i=this._removedNodes,n=this._removedEdges,r=this._excludedNodes,o=this._excludedEdges,a=[],l=[];if(i&&r)for(let d=0;d<t.length;d++){const h=t[d];i.get(h)!==0||r.get(h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}if(n&&o)for(let d=0;d<e.length;d++){const h=-e[d];n.get(-h)!==0||o.get(-h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}for(const d of a)s.remove(d);for(const d of l)s.insert(d)}getNodesInScreenByDistance(t){const{x:e,y:s}=t.getPositionOnScreen();return this._modules.graph.getNodes().filter(i=>i.isInScreen()&&i!==t).sort((i,n)=>{const r=i.getPositionOnScreen(),o=n.getPositionOnScreen();return Ie(r.x,r.y,e,s)-Ie(o.x,o.y,e,s)})}getNearestNodesForNode(t,e=240,s){const{x:i,y:n}=t.getPosition();return this.getNearestNodes(i,n,e,s,t)}getNearestNodes(t,e,s,i,n){if(this._updateIndex(),i){const r=this._modules.camera.screenToGraphVector({x:s,y:s});s=Ie(0,0,r.x,r.y)}return this._getNearestNodes(t,e,s,n)}_getNearestNodes(t,e,s,i){const n=[],r=s*s,o=i?i._index:0,a=this._modules.graph.getNodes()._indexes,[l,d]=this._modules.graph.getNodeAttributes(["x","y"]);for(let h=0,u=a.length;h<u;h++){const c=a[h];if(c===o)continue;const g=t-l.get(c),f=e-d.get(c);g*g+f*f<=r&&n.push(c)}return this._modules.graph.nodeList(new Uint32Array(n))}queryRaw(t,e,s,i){this._updateIndex();const n=this._queryBounds;n[0]=t,n[1]=e,n[2]=s,n[3]=i;const r=this._index.query(t,e,s,i),{nodes:o,edges:a}=this._queryResult;o.length=a.length=0;for(let l=0;l<r.length;l++){const d=r[l];d<0?a.push(-d):o.push(d)}return this._queryResult}queryRawProjected(t,e,s,i){const n=this._queryBounds;return n[0]=t,n[1]=e,n[2]=s,n[3]=i,this._modules.camera.projectBounds(n),this.queryRaw(n[0],n[1],n[2],n[3])}query(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRaw(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r.slice())),edges:n.edgeList(new Uint32Array(o.slice()))}}queryProjected(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRawProjected(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r)),edges:n.edgeList(new Uint32Array(o))}}getNodesByBoundingBox(t,e,s,i,n){if(this._updateIndex(),n){let u;u=this._modules.camera.screenToGraphVector({x:t,y:e}),t=u.x,e=u.y,u=this._modules.camera.screenToGraphVector({x:s,y:i}),s=u.x,i=u.y}const r=this._modules.graph,o=r.getNodes()._indexes,a=[],l=r.getNodeAttribute("excluded"),[d,h]=r.getNodeAttributes(["x","y"]);for(let u=0,c=o.length;u<c;u++){const g=o[u];if(l&&l.get(g))continue;const f=d&&d.get(g),m=h&&h.get(g);f>=t&&f<=s&&m>=e&&m<=i&&a.push(g)}return r.nodeList(new Uint32Array(a))}toggleDebug(t){t?(this._layer=this._modules.layers.addCanvasLayer(e=>{bm(e,this._index,this._queryBounds)},{isStatic:!1,noClear:!1}),this._layer.moveToTop()):this._layer&&(this._layer.destroy(),this._layer=null)}renderDebug(t){if(!this._layer)return this.toggleDebug(!0);this._layer.refresh(e=>{bm(e,this._index,this._queryBounds,t)})}},y0={};function rd(t,e,s,i,n=0,r=Math.sin(n),o=Math.cos(n),a=[0,0,0,0]){const l=s/2,d=i/2,h=t+l,u=e+d;if(n===0)return a[0]=t,a[1]=e,a[2]=t+s,a[3]=e+i,a;let c,g,f,m,_,p,x,y;return f=-l,m=-d,c=h+f*o-m*r,g=u+f*r+m*o,_=x=c,p=y=g,f=-l,m=d,c=h+f*o-m*r,g=u+f*r+m*o,c<_?_=c:c>x&&(x=c),g<p?p=g:g>y&&(y=g),f=l,m=d,c=h+f*o-m*r,g=u+f*r+m*o,c<_?_=c:c>x&&(x=c),g<p?p=g:g>y&&(y=g),f=l,m=-d,c=h+f*o-m*r,g=u+f*r+m*o,c<_?_=c:c>x&&(x=c),g<p?p=g:g>y&&(y=g),a[0]=_,a[1]=p,a[2]=x,a[3]=y,a}function ko(t,e,s,i,n=0){const r=s/2,o=i/2,a=t+r,l=e+o;if(n===0)return[{x:t,y:e},{x:t+s,y:e},{x:t+s,y:e+i},{x:t,y:e+i}];const d=Math.sin(n),h=Math.cos(n);let u,c,g,f;g=-r,f=-o,u=a+g*h-f*d,c=l+g*d+f*h;const m={x:u,y:c};g=-r,f=o,u=a+g*h-f*d,c=l+g*d+f*h;const _={x:u,y:c};g=r,f=o,u=a+g*h-f*d,c=l+g*d+f*h;const p={x:u,y:c};return g=r,f=-o,u=a+g*h-f*d,c=l+g*d+f*h,[m,_,p,{x:u,y:c}]}function su(t,e=0,s=1,i=Sy.slice()){const n=s*Math.sin(e),r=s*Math.cos(e);return i[0]=t[0]+n,i[1]=t[1]+r,i[2]=t[2]+n,i[3]=t[3]+r,i}function RL(t,e){return Ty(t,e)}function FL(t,e){return x0(t[0],t[1],t[2],t[3],e[0],e[1],e[2],e[3])}function DL(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function x0(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}So(y0,{angle:()=>b1,circleCircleIntersection:()=>Xu,circleContainsCircle:()=>sw,circleContainsPoint:()=>ew,circleIntersectsBox:()=>$u,circleLineIntersection:()=>Iy,circleSortCompare:()=>Yu,computeCentroid:()=>AI,cubicBezierAABB:()=>Nh,defaultAABB:()=>Sy,degreesToRadians:()=>tw,distToSegmentSquared:()=>_c,distance:()=>Ie,distancePointSegment:()=>Lx,extendBounds:()=>Ty,getAABB:()=>rd,getBentEdgesControlPoints:()=>Jl,getBezierCurveBoundingBox:()=>ed,getClosestPointOnLine:()=>E1,getClosestPointOnSegment:()=>Nx,getNormalOnEdge:()=>_1,getNormalOnQuadraticCurve:()=>wx,getOBBPoints:()=>ko,getPointOnBezierCurve:()=>mo,getPointOnEdge:()=>m1,getPointOnQuadraticCurve:()=>td,getQuadraticBezierCurveLength:()=>y1,getQuadraticCurveBoundingBox:()=>fc,getQuadraticCurveControlPoint:()=>Nn,getSelfLoopControlPoints:()=>Ql,getTangentOnEdge:()=>p1,getTangentOnQuadraticCurve:()=>gc,intersects:()=>DL,isPointInLine:()=>Ix,isPointInPolygon:()=>po,isPointOnBezierCurve:()=>Gh,isPointOnQuadraticCurve:()=>Tx,lineAABB:()=>mc,lineAngle:()=>ur,lineIntersection:()=>v1,lineLine:()=>$n,minDisk:()=>Mo,move:()=>JS,moveAABB:()=>su,normalize:()=>wy,overlaps:()=>x0,overlapsAABB:()=>FL,padBounds:()=>RL,polygonsIntersect:()=>Yx,quadBezierAABB:()=>My,radiansToDegrees:()=>Ch,rotate:()=>gl,segmentIntersection:()=>Gr,segmentRectangleIntersection:()=>Cx,squaredDistance:()=>qa,twoSegmentsIntersect:()=>x1});var Aa=40;function b0(t,e){const s=t.getAttribute("curvature"),i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen();if(i===n){const m=(s+i.getAttribute("radius"))*yl*e,_=r.x,p=r.y,x=_-m,y=p,b=_,v=p+m;return[r,...[.2,.4,.6,.8].map(E=>mo(E,_,p,_,p,x,y,b,v)),r]}const o=n.getPositionOnScreen();if(s===0)return[r,o];const a=o.x-r.x,l=o.y-r.y,d=Math.sqrt(a*a+l*l),h=(r.x+o.x)/2,u=(r.y+o.y)/2,c=s*(d/Yl)*2,g=h+l/d*c,f=u+-a/d*c;return[r,...[.25,.5,.75].map(m=>td(m,r.x,r.y,o.x,o.y,g,f)),o]}function OL(t,e,s){const i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen(),o=n.getPositionOnScreen();if(po(r.x,r.y,e)||po(o.x,o.y,e))return!0;const a=b0(t,s);for(let l=0;l<a.length-1;++l){const d=a[l],h=a[l+1];for(let u=0;u<e.length-1;++u){const c=e[u],g=e[u+1];if($n(d.x,d.y,h.x,h.y,c.x,c.y,g.x,g.y))return!0}}return!1}function kL(t,e,s){const i=t.getPositionOnScreen(),n=Number(t.getAttribute("radius"))*s;return v0(i.x,i.y,n,e)}function v0(t,e,s,i){const n=t-s,r=e-s,o=e+s;return t+s>=i.minX&&n<=i.maxX&&o>=i.minY&&r<=i.maxY}function zL(t,e,s){const i=b0(t,s);for(let n=0;n<i.length-1;++n){const r=i[n],o=i[n+1];if(mc(r.x,r.y,o.x,o.y,e.minX,e.minY,e.maxX,e.maxY))return!0}return!1}function vm(t,e,s,i){typeof s=="number"&&(s={left:s,right:s,top:s,bottom:s});const n=s.left===void 0?Aa:s.left,r=s.right===void 0?Aa:s.right,o=s.top===void 0?Aa:s.top,a=s.bottom===void 0?Aa:s.bottom,l=n+r,d=o+a,h=t.width===0?t.maxFixedSize:t.width,u=t.height===0?t.maxFixedSize:t.height,c=oL([(e.width-l)/(h+t.maxScaledSize),(e.height-d)/(u+t.maxScaledSize),(e.width-l-t.maxFixedSize)/h,(e.height-d-t.maxFixedSize)/u,i/t.maxScaledSize||NaN]);return{x:t.cx+(r-n)/(2*c),y:t.cy+(a-o)/(2*c),zoom:c}}var BL="cubicOut",Em=200,UL=class extends Bt{constructor(){super(...arguments),this._isLocating=!1,this._cacheValid=!0,this._cachedGraphBoundingBox=new cs,this._onLocateStart=()=>{this._isLocating=!0},this._onLocated=()=>{this._isLocating=!1,this._modules.events.fire("locate")},this._invalidCache=()=>{this._cacheValid=!1}}onMounted(){this._modules.events.register(["locate"]),this._modules.events.on(["addNodes","removeNodes","addEdges","removeEdges","excludedStateChange","clearGraph","updateAttributes"],this._invalidCache)}onReady(){this.locateGraph({},!0)}locateGraph(t,e=!1){return this._onLocateStart(),e?this._locateGraph(t):this._modules.transformations.whenApplied().then(()=>this._locateGraph(t))}_locateGraph(t){return this._locateBoundingBox(this.getGraphBoundingBox(),t).then(this._onLocated)}locateElements(t,e){return this._modules.transformations.whenApplied().then(()=>this._locateBoundingBox(this.getBoundingBox(t),e)).then(this._onLocated)}locateRawGraph(t,e){return this._onLocateStart(),this._locateBoundingBox(this.getRawGraphBoundingBox(t),e).then(this._onLocated)}isLocating(){return this._isLocating}getGraphBoundingBox(t=!1){if(t){const e=this.getBoundingBox(this._ogma.getNodes(),!0,t),s=this.getBoundingBox(this._ogma.getEdges(),!1,t);return e.extend(s)}return this._cacheValid||this._updateCache(),Object.assign({},this._cachedGraphBoundingBox)}forceInvalidCache(){this._invalidCache()}_updateCache(){this._cacheValid=!0,this._cachedGraphBoundingBox=this.getBoundingBox(this._modules.graph.getNodes()).extend(this.getBoundingBox(this._modules.graph.getEdges()))}getBoundingBox(t,e=!1,s=!1,i){let n;if(n=t.isNode?this._getNodesBoundingBox(t.toList(),e):this._getEdgesBoundingBox(t.toList(),i),s){const r=this._ogma.modules.labels.getTextsBoundingBox(t.isNode?t.toList():null,t.isNode?null:t.toList());n=n.extend(r)}return n}_getNodesBoundingBox(t,e=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getNodeAttributes(),i=[],n=[],r=[],o=[];for(let a=0;a<t.size;++a){const l=t._indexes[a];if(s.excluded.get(l)===0){const d=s.x.get(l),h=s.y.get(l),u=s.radius.get(l),c=2*u;s.scalingMethod.get(l)==="scaled"?r.push(c):o.push(c),e?(i.push(d-u,d+u),n.push(h-u,h+u)):(i.push(d),n.push(h))}}return new cs({xValues:i,yValues:n,scaledSizeValues:r,fixedSizeValues:o})}_getEdgesBoundingBox(t,e=!1){return this._getEdgesBoundingBoxInternal(t._indexes,e)}_getEdgesBoundingBoxInternal(t,e=!1,s,i){this._modules.graphics.forceAttributesComputation();const n=this._modules.graphics.getEdgeAttributes(),r=this._modules.graphics.getNodeAttributes(),o={x1:0,y1:0,x2:0,y2:0},a={x:0,y:0},l={minX:0,minY:0,maxX:0,maxY:0},d=[],h=[],u=[],c=[],g=s||r.x,f=i||r.y;for(let m=0;m<t.length;++m){const _=t[m],p=n.source.get(_),x=n.target.get(_),y=n.curvature.get(_),b=g.get(p),v=f.get(p),E=r.scalingMethod.get(p)==="scaled",A=2*r.radius.get(p),S=g.get(x),w=f.get(x),L=r.scalingMethod.get(x)==="scaled",T=2*r.radius.get(x);E?u.push(A):c.push(A),L?u.push(T):c.push(T),e||y===0?(d.push(b,S),h.push(v,w)):p===x?(pc(b,v,y,A/2,0,o),ed(b,v,o.x1,o.y1,o.x2,o.y2,S,w,l),d.push(l.minX,l.maxX),h.push(l.minY,l.maxY)):(sd(b,v,S,w,y,a),fc(b,v,a.x,a.y,S,w,l),d.push(l.minX,l.maxX),h.push(l.minY,l.maxY))}return new cs({xValues:d,yValues:h,scaledSizeValues:u,fixedSizeValues:c})}getRawGraphBoundingBox(t){const e=t.nodes.length,s=new Array(e),i=new Array(e),n=new Array(e);for(let r=0;r<e;r++){const o=t.nodes[r].attributes||{};s[r]=o.x||0,i[r]=o.y||0,n[r]=o.radius||5}return new cs({xValues:s,yValues:i,scaledSizeValues:n})}_locateBoundingBox(t,e={}){if(isNaN(t.cx))return Promise.resolve();const{padding:s={},easing:i=BL,duration:n=0,maxNodeSizeOnScreen:r=Em,ignoreZoomLimits:o=!1}=e,a=vm(t,this._modules.dom.getDimensions(),s,r),l=a.x,d=a.y,h=a.zoom,u=h/this._modules.camera.getZoom();return this._moveCamera(l,d,h,n,i,u,o)}_moveCamera(t,e,s,i,n,r,o){const a={duration:i,easing:n,ignoreZoomLimits:o},l=this._modules.camera.setCenter({x:t,y:e},a);return r>1.01||r<.99?this._modules.camera.setZoom(s,a):l}computeConfigForBounds(t,e={}){const{padding:s={},maxNodeSizeOnScreen:i=Em}=e;return vm(t,this._modules.dom.getDimensions(),s,i)}layoutDataBoundingBox({x:t,y:e,indexes:s}){const i=this._modules.graphics.getNodeAttributes(),n=[],r=[],o=[],a=[],l=new Map,d=new Map;for(let c=0;c<s.length;++c){const g=s[c],f=t[c],m=e[c];l.set(g,f),d.set(g,m);const _=2*i.radius.get(g),p=i.scalingMethod.get(g)==="scaled";n.push(f),r.push(m),p?o.push(_):a.push(_)}const h=this._modules.graph.topology.getAdjacentElements(!1,s,{bothExtremities:!0}),u=this._getEdgesBoundingBoxInternal(h,!1,l,d);return new cs({xValues:n,yValues:r,scaledSizeValues:o,fixedSizeValues:a}).extend(u)}isEdgeInPolygon(t,e){return OL(t,e,this._modules.camera.getZoom())}isElementInView(t,{margin:e=0}={}){const{width:s,height:i}=this._modules.camera.getSize(),n={minX:-e,minY:-e,maxX:s+e,maxY:i+e};return t.isNode?this.isNodeInRectangle(t,n):this.isEdgeInRectangle(t,n)}isNodeInRectangle(t,e){if(this._modules.geo.isEnabled()){const s=this._modules.geo.getContainerCoord(t);return v0(s.x,s.y,Number(t.getAttribute("radius")),e)}return kL(t,e,this._modules.camera.getZoom())}isNodeInPolygon(t,e){const s=t.getPositionOnScreen();return po(s.x,s.y,e)}isEdgeInRectangle(t,e){return zL(t,e,this._modules.camera.getZoom())}},GL=$i&&typeof navigator<"u"&&"msLaunchUri"in navigator&&Ti&&!("documentMode"in document);function VL(t){return GL?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/ps():t.deltaY&&t.deltaMode===1?20*-t.deltaY:t.deltaY&&t.deltaMode===2?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}var qL=6,jL=class extends Bt{constructor(){super(...arguments),this._px=0,this._py=0,this._pressX=0,this._pressY=0,this._left=!1,this._middle=!1,this._right=!1,this._clickCounter={left:0,middle:0,right:0},this._buttons={left:!1,middle:!1,right:!1},this._skipNextMove=!1,this._onMouseWheel=t=>{this._isEnabled()&&this._isWheelEnabled()&&(!this._disableWheelUntilMouseDown()||this._modules.dom.hasFocus())&&(t.preventDefault(),t.stopPropagation(),this._applyMouseWheelZoom(t))},this._onMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=e-this._px,n=s-this._py;i===0&&n===0||(this._skipNextMove?this._skipNextMove=!1:Ie(e,s,this._pressX,this._pressY)>=qL&&(this._resetClickCounter(),this._modules.events.fire("mousemoveInternal",{x:e,y:s,dx:i,dy:n,domEvent:this._evt})))},this._onDocumentMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._bounds,n=e-this._px,r=s-this._py;(e<0||e>i.width||s<0||s>i.height)&&this._modules.events.fire("documentMouseMove",{x:e,y:s,dx:n,dy:r,domEvent:this._evt})},this._onMouseUp=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._evt;this._buttons[i]=!1,this._clickCounter[this._button]===1?this._modules.events.fire("clickInternal",{button:i,x:e,y:s,domEvent:n}):this._clickCounter[i]>1&&(this._modules.events.fire("doubleclickInternal",{button:i,x:e,y:s,domEvent:n}),this._resetClickCounter(i)),this._modules.events.fire("mouseupInternal",{button:i,x:e,y:s,domEvent:n})},this._onDocumentMouseup=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button;this._buttons[i]=!1;const n=this._modules.dom;this._modules.events.fire("documentMouseUp",{button:i,x:e,y:s,domEvent:this._evt}),n.removeDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.removeDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onMouseDown=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._modules.dom;this._skipNextMove=!0,this._pressX=e,this._pressY=s,this._lastMouseDownTarget=t.target,n.focus(),this._buttons[i]=!0,this._clickCounter[i]+=1;const r=i;this._dbclickTimer=n.setTimeout(()=>{this._resetClickCounter(r,0)},this._getDoubleClickTimer()),this._modules.events.fire("mousedownInternal",{button:i,x:e,y:s,domEvent:this._evt}),n.addDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.addDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onDrop=t=>{if(!this._isEnabled()||!this._setXY(t))return;t.preventDefault();const{x:e,y:s}=this._modules.camera.screenToGraphCoordinates(this._modules.position);this._modules.events.fire("drop",{domEvent:this._evt,x:e,y:s})}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("mouse.enabled",!0),this._modules.settings.register("mouse.wheelEnabled",!0),this._modules.settings.register("mouse.disableWheelUntilMouseDown",!1),this._modules.settings.register("mouse.doubleClickTimer",500),this._modules.events.register(["mousedownInternal","mouseupInternal","mousemoveInternal","mousewheelInternal","clickInternal","doubleclickInternal","mouseoverInternal","mouseoutInternal","documentMouseUp","documentMouseMove","drop"]),this._modules.dom.afterNextFrame().then(()=>this._initializeListeners())}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get left(){return this._left}get right(){return this._right}get middle(){return this._middle}_isEnabled(){return this._modules.settings.get("mouse.enabled")}_isWheelEnabled(){return this._modules.settings.get("mouse.wheelEnabled")}_disableWheelUntilMouseDown(){return this._modules.settings.get("mouse.disableWheelUntilMouseDown")}_getDoubleClickTimer(){return this._modules.settings.get("mouse.doubleClickTimer")}_resetClickCounter(t,e=0){t?this._clickCounter[t]=e:(this._clickCounter.left=e,this._clickCounter.middle=e,this._clickCounter.right=e),this._modules.dom.clearTimeout(this._dbclickTimer),this._lastMouseDownTarget=null}_setXY(t){const e=this._domElt.getBoundingClientRect();return this._bounds=e,!!e&&(this._evt=t,this._button=zu[t.button],this._px=this._modules.position.x,this._py=this._modules.position.y,this._modules.position.x=t.clientX-e.left,this._modules.position.y=t.clientY-e.top,this._left=this._buttons.left,this._right=this._buttons.right,this._middle=this._buttons.middle,!0)}_applyMouseWheelZoom(t){this._setXY(t)&&this._modules.events.fire("mousewheelInternal",{delta:VL(t),dx:t.deltaX,dy:t.deltaY,x:this._modules.position.x,y:this._modules.position.y,domEvent:this._evt})}_initializeListeners(){const t=this._domElt,e=this._modules.dom;Bl&&this._modules.dom.addElementEventListener(document,"contextmenu",i=>{this._lastMouseDownTarget&&i.target!==this._lastMouseDownTarget&&i.preventDefault()}),e.addElementEventListener(t,"contextmenu",i=>{this._setXY(i),this._modules.dom.hasFocus()&&this._modules.settings.get("mouse.enabled")&&i.preventDefault()},!1);const s="onwheel"in t?"wheel":t.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";e.addElementEventListener(t,s,this._onMouseWheel,{passive:!1}),e.addElementEventListener(t,"mousemove",this._onMouseMove),e.addElementEventListener(t,"mouseleave",i=>{if(!this._isEnabled())return;this._modules.dom.blur();const n=t.getBoundingClientRect();i.clientX>=n.left+1&&i.clientX<=n.right-1&&i.clientY>=n.top+1&&i.clientY<=n.bottom-1||this._modules.events.fire("mouseout",{domEvent:this._evt})}),e.addElementEventListener(t,"mousedown",this._onMouseDown),e.addElementEventListener(t,"mouseup",this._onMouseUp),e.addElementEventListener(t,"dragover",i=>{i.preventDefault()}),e.addElementEventListener(t,"drop",this._onDrop)}},HL={doubleTapTimer:500},WL=class extends Bt{constructor(){super(...arguments),this._pressed=!1,this._addEvent=(t,e,s,i)=>{this._modules.dom.addElementEventListener(t,e,s,i)},this._addWinEvent=(t,e,s,i)=>{this._modules.dom.addDirectWindowEventListener(e,s,i)},this._removeWinEvent=(t,e,s)=>{this._modules.dom.removeDirectWindowEventListener(e,s)}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("touch.enabled",!0),this._modules.events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]),this._modules.dom.afterNextFrame().then(()=>{this._initialize(this)})}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get pressed(){return this._pressed}_listen(t,e,s){if(jy){if(e==="touchstart")return rT(this._addEvent,t,s);if(e==="touchmove")return aT(this._addWinEvent,t,s);if(e==="touchend")return lT(this._addWinEvent,t,s);if(e==="touchcancel")return oT(this._addWinEvent,t,s)}return this._modules.dom.addElementEventListener(t,e,s)}_initialize(t){let e=0,s=0,i=0,n=0,r=!1,o="left",a=0,l=!1,d=!1,h=0,u=1,c=null,g=null;const f=()=>{this._modules.position.x=e,this._modules.position.y=s,this._pressed=r},m=(v,E)=>{const A=this._domElt.getBoundingClientRect();if(!A||v.touches==null)return null;const[S,w]=v.touches,L=S.clientX-A.left,T=S.clientY-A.top,F=w.clientX-A.left,V=w.clientY-A.top,G=(L+F)/2,O=(T+V)/2,j=G-e,W=O-s,et=Ie(L,T,F,V),at=et/u,mt=ur(L,T,F,V),vt={dx:j,dy:W,rotation:mt-h,scale:at};return((wt,Et,yt,St)=>{u=wt,h=Et,e=yt,s=St,f()})(et,mt,G,O),vt},_=v=>{if(v.touches&&v.touches.length===2&&d){const E=m(v);if(E){const{dx:A,dy:S,rotation:w,scale:L}=E;this._modules.events.fire("touchProgressGesture",{dx:A,dy:S,rotation:w,scale:L,x:e,y:s,domEvent:c,button:o})}}},p=v=>{if(o=zu[v.button],!v.touches)return!1;if(v.touches.length!==1)return r=!1,v.touches.length>1&&this._modules.events.fire("touchUp",{x:e,y:s,domEvent:c,button:o}),!1;const E=this._domElt.getBoundingClientRect();return E&&(i=e,n=s,e=v.touches[0].clientX-E.left|0,s=v.touches[0].clientY-E.top|0,r=!0,c=v,f()),!0},x=()=>{a=0,this._modules.dom.clearTimeout(g)},y=v=>{if(v.preventDefault(),!v.touches)return;if(v.touches.length!==2&&d&&(d=!1,this._modules.events.fire("touchEndGesture",{domEvent:c})),p(v),v.touches.length===0){const A={x:e,y:s,domEvent:c,button:o};a===1&&this._modules.events.fire("touchTap",A),a>1&&(this._modules.events.fire("touchDoubleTap",A),x()),this._modules.events.fire("touchUp",A)}const E=Ii().documentElement;Jg(this._removeWinEvent,E,"touchmove",this._onMove),Jg(this._removeWinEvent,E,"touchend",this._onEnd)},b=v=>{_(v),l?l=!1:(x(),p(v)&&this._modules.events.fire("touchMove",{x:e,y:s,dx:e-i,dy:s-n,domEvent:c,button:o}))};this._listen(this._domElt,"touchstart",v=>{if(!v.touches)return;v.touches.length!==2||d||(u=1,m(v)&&(d=!0,this._modules.events.fire("touchStartGesture",{domEvent:c}))),p(v)&&(this._modules.dom.focus(),this._modules.events.fire("touchDown",{x:e,y:s,domEvent:c,button:o}),a+=1,g=this._modules.dom.setTimeout(x,HL.doubleTapTimer),l=!0);const E=Ii().documentElement;this._onMove=this._listen(E,"touchmove",b),this._onEnd=this._listen(E,"touchend",y)})}},XL=class{getHoveredElement(){return this.modules.captor.getPointedElement()}getPointerInformation(){return this.modules.captor.getCursorInformation()}},YL=class{getNodesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getNodes(e)}getEdgesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getEdges(e)}},Rc={};So(Rc,{gexf:()=>E0,gexfFromUrl:()=>Fc,graphml:()=>T0,graphmlFromUrl:()=>I0,janus:()=>A0,json:()=>S0,jsonFromUrl:()=>Dc,mtx:()=>$L,mtxFromUrl:()=>ZL,neo4j:()=>w0});var di=Cu(tp()),E0=t=>Promise.resolve(di.gexf(t)),Fc=t=>pr(t).then(e=>di.gexf(e)),A0=t=>Promise.resolve(di.janus(t)),S0=(t,e)=>Promise.resolve(di.json(t,e)),Dc=(t,e)=>pr(t).then(s=>di.json(s,e)),w0=t=>Promise.resolve(di.neo4j(t)),T0=(t,e)=>Promise.resolve(di.graphml(t,e)),I0=(t,e)=>pr(t).then(s=>di.graphml(s,e)),$L=t=>Promise.resolve(di.mtx(t)),ZL=t=>pr(t).then(e=>di.mtx(e)),KL=class extends ge{constructor(){super(...arguments),this.wait=t=>new Promise(e=>setTimeout(e,t)),this.initRandomGraph=t=>this._ogma.generate.random(t).then(this._ogma.setGraph).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.initGrid=t=>{const e=Math.ceil(Math.sqrt(t));return this._ogma.generate.grid({rows:e,columns:e}).then(s=>this._ogma.setGraph(s)).then(()=>this._ogma.view.locateGraph())},this.initLine=t=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:t?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]}),this._ogma.view.locateGraph()),this.initSingleNode=()=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}],edges:[]}),this._ogma.view.locateGraph()),this.initContinuousRenderLoop=({triggerKey:t="r",start:e=!0}={})=>{let s=e;const i=()=>{s&&this._ogma.modules.dom.beforeNextFrame().then(i)};document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s,i())}),i()},this.appendToBody=()=>{const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.bottom="0",t.style.right="0",document.body.appendChild(t),this._ogma.setContainer(t)},this.loadFile=t=>(t.endsWith(".gexf")?Fc(t):Dc(t)).then(e=>this._ogma.setGraph(e)).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.enableLasso=t=>{this._ogma.events.on("dragStart",()=>{this._ogma.keyboard.isKeyPressed("ctrl")&&this._ogma.tools.lasso.enable(t)})},this.randomizeGraph=({minX:t=0,minY:e=0,maxX:s=500,maxY:i=500}={})=>this._ogma.getNodes().setAttributes(this._ogma.getNodes().map(()=>({x:t+Math.random()*(s-t),y:e+Math.random()*(i-e)})))}},QL=class{setContainer(t){this.modules.dom.setContainer(t)}getContainer(){return this.modules.dom.getContainer()}},JL=class extends ge{constructor(){super(...arguments),this.once=(t,e)=>(this._ogma.modules.events.once(t,e),this),this.removeListener=t=>{this._ogma.modules.events.off(t)},this.onNodesAdded=t=>(this._ogma.events.on("addNodes",t),this._ogma),this.onBeforeNodesRemoved=t=>(this._ogma.events.on("beforeRemoveNodes",t),this._ogma),this.onNodesRemoved=t=>(this._ogma.events.on("removeNodes",t),this._ogma),this.onEdgesAdded=t=>(this._ogma.events.on("addEdges",t),this._ogma),this.onBeforeEdgesRemoved=t=>(this._ogma.events.on("beforeRemoveEdges",t),this._ogma),this.onEdgesRemoved=t=>(this._ogma.events.on("removeEdges",t),this._ogma),this.onGraphCleared=t=>(this._ogma.events.on("clearGraph",t),this._ogma),this.onNodesClassAdded=(t,e)=>(this._ogma.modules.classes.onNodeClassAdded(t,e),this._ogma),this.onNodesClassRemoved=(t,e)=>(this._ogma.modules.classes.onNodeClassRemoved(t,e),this._ogma),this.onEdgesClassAdded=(t,e)=>(this._ogma.modules.classes.onEdgeClassAdded(t,e),this._ogma),this.onEdgesClassRemoved=(t,e)=>(this._ogma.modules.classes.onEdgeClassRemoved(t,e),this._ogma),this.onNodeDragStart=t=>(this._ogma.events.on("nodesDragStart",t),this._ogma),this.onNodeDragProgress=t=>(this._ogma.events.on("nodesDragProgress",t),this._ogma),this.onNodeDragEnd=t=>(this._ogma.events.on("nodesDragEnd",t),this._ogma),this.onDrop=t=>(this._ogma.events.on("drop",t),this._ogma),this.onNodesSelected=t=>this.onNodesClassAdded(_e,t),this.onNodesUnselected=t=>this.onNodesClassRemoved(_e,t),this.onEdgesSelected=t=>this.onEdgesClassAdded(_e,t),this.onEdgesUnselected=t=>this.onEdgesClassRemoved(_e,t),this.onNodeDataChange=t=>(this._ogma.events.on("updateNodeData",t),this._ogma),this.onEdgeDataChange=t=>(this._ogma.events.on("updateEdgeData",t),this._ogma),this.onAnimate=t=>(this._ogma.events.on("animate",t),this._ogma),this.onMouseMove=t=>(this._ogma.events.on("mousemove",t),this._ogma),this.onMouseButtonDown=t=>(this._ogma.events.on("mousedown",t),this._ogma),this.onMouseButtonUp=t=>(this._ogma.events.on("mouseup",t),this._ogma),this.onClick=t=>(this._ogma.events.on("click",t),this._ogma),this.onDoubleClick=t=>(this._ogma.events.on("doubleclick",t),this._ogma),this.onMouseWheel=t=>(this._ogma.events.on("mousewheel",t),this._ogma),this.onHover=t=>(this._ogma.events.on("mouseover",t),this._ogma),this.onUnhover=t=>(this._ogma.events.on("mouseout",t),this._ogma),this.onDragStart=t=>(this._ogma.events.on("dragStart",t),this._ogma),this.onDragProgress=t=>(this._ogma.events.on("dragProgress",t),this._ogma),this.onDragEnd=t=>(this._ogma.events.on("dragEnd",t),this._ogma),this.onGestureStart=t=>(this._ogma.events.on("gestureStart",t),this._ogma),this.onGestureProgress=t=>(this._ogma.events.on("gestureProgress",t),this._ogma),this.onGestureEnd=t=>(this._ogma.events.on("gestureEnd",t),this._ogma),this.onRendererStateChange=t=>(this._ogma.events.on("rendererStateChange",t),this._ogma),this.onZoomProgress=t=>(this._ogma.events.on("zoom",t),this._ogma),this.onViewChanged=t=>(this._ogma.events.on("viewChanged",t),this._ogma),this.onNodesConnected=t=>(this._ogma.events.on("connectNodes",t),this._ogma),this.onGeoModeEnabled=t=>(this._ogma.events.on("geoEnabled",t),this._ogma),this.onGeoModeDisabled=t=>(this._ogma.events.on("geoDisabled",t),this._ogma),this.onGeoModeLoaded=t=>(this._ogma.events.on("geoLoaded",t),this._ogma),this.onLayoutStart=t=>(this._ogma.events.on("layoutStart",t),this._ogma),this.onLayoutComplete=t=>(this._ogma.events.on("layoutEnd",t),this._ogma),this.onLayoutComputed=t=>(this._ogma.events.on("layoutComputed",t),this._ogma),this.onTooltipShown=t=>(this._ogma.events.on("tooltipShow",t),this._ogma),this.onTooltipHidden=t=>(this._ogma.events.on("tooltipHide",t),this._ogma),this.onTransformationEnabled=t=>(this._ogma.events.on("transformationEnabled",t),this._ogma),this.onTransformationDisabled=t=>(this._ogma.events.on("transformationDisabled",t),this._ogma),this.onTransformationSetIndex=t=>(this._ogma.events.on("transformationSetIndex",t),this._ogma),this.onTransformationDestroyed=t=>(this._ogma.modules.events.on("transformationDestroyed",t),this._ogma),this.onTransformationRefreshed=t=>(this._ogma.events.on("transformationRefresh",t),this._ogma)}on(t,e){return this._ogma.modules.events.on(t,e),this}off(t){return this._ogma.modules.events.off(t),this}onKeyPress(t,e){return this._ogma.modules.keyboard.onKeyPress(t,e),this._ogma}};function Tl(t,e,s){if(t!=null)return Array.isArray(t)?t[0]:t}function iu(t){return t==null?null:typeof t=="string"||typeof t=="number"?`${t}`:t&&iu(t.content)}function tN(t){if(t!=null)return typeof t=="string"?t:t.style||"line"}var eN=["color","radius","shape","text.content","x","y"],sN=["color","width","shape.body","text.content"];function iN(t){return t!=="all"?{nodes:["x","y"],edges:[]}:{nodes:eN,edges:sN}}function nN(t,{nodes:e,edges:s}){const i=t.getOriginalAttributes();return{nodes:e.reduce((n,r)=>(n[r.getId()]={x:i.nodes.x.get(r._index),y:i.nodes.y.get(r._index),color:Tl(i.nodes.color.get(r._index)),radius:i.nodes.radius.get(r._index),shape:i.nodes.shape.get(r._index),text:{content:i.nodes.text.content.get(r._index)}},n),{}),edges:s.reduce((n,r)=>(n[r.getId()]={color:Tl(i.edges.color.get(r._index)),width:i.edges.width.get(r._index),shape:{type:i.edges.shape.body.get(r._index)},text:{content:i.edges.text&&i.edges.text.content&&i.edges.text.content.get(r._index)}},n),{})}}function rN(t){return{nodes:t.nodes.map(({id:e,attributes:s={},data:i})=>{const{color:n,radius:r,shape:o,text:a,x:l,y:d}=s;return{id:e,x:l,y:d,color:Tl(n),size:r,shape:o,text:iu(a),data:i}}),edges:t.edges.map(({id:e,source:s,target:i,attributes:n={},data:r})=>{const{color:o,width:a,text:l,shape:d}=n;return{id:e,source:s,target:i,color:Tl(o),size:a,shape:tN(d),text:iu(l),data:r}})}}function Am(t){return t instanceof js?t.getId():t}function Sm(t){return t instanceof Zi?t.getId():t}function wm(t){return t instanceof Pi?t.getId():t instanceof js?[t.getId()]:He(t)?t.map(Am):[Am(t)]}function Tm(t){return t instanceof Ln?t.getId():t instanceof Zi?[t.getId()]:He(t)?t.map(Sm):[Sm(t)]}var Oc="visible";function oN(t,e){return t?wm(t):typeof e=="object"?wm(e.nodes):e||Oc}function aN(t,e){return t?Tm(t):typeof e=="object"?Tm(e.edges):e||Oc}function C0(t,e,s,i){const n=oN(e,i),r=aN(s,i);return{nodes:t.getNodes(n),edges:t.getEdges(r)}}function L0(t,{nodeAttributes:e,edgeAttributes:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const l=C0(t,i,n,r);return{nodes:l.nodes.toJSON({attributes:e,data:o}),edges:l.edges.toJSON({attributes:s,data:a})}}function od(t,e,{styles:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const{nodes:l,edges:d}=iN(s),h=L0(t,{nodeAttributes:l,edgeAttributes:d,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a});if(s==="original"){const u=nN(e,C0(t,i,n,r));for(const c of h.nodes)c.id!=null&&(c.attributes=u[c.id]);for(const c of h.edges)c.id!=null&&(c.attributes=u[c.id])}return s==="all"&&h.edges.forEach(({source:u,target:c,attributes:g})=>{if(g){const f=t.getNode(u);if(g.color==="source"&&f){const _=f.getAttribute("color");g.color=Array.isArray(_)?_[0]:_}const m=t.getNode(c);if(g.color==="target"&&m){const _=m.getAttribute("color");g.color=Array.isArray(_)?_[0]:_}}}),rN(h)}function lN(t,e){for(let s=0;s<e.length;++s){if(t==null)return;t=t[e[s]]}return t}function dN(t,e,s){for(let i=0;i<e.length-1;++i){const n=e[i];let r=t[n];r===void 0&&(r={},t[n]=r),t=r}t[e[e.length-1]]=s}function hN(t){const e={...t[0]};for(const s of t)for(const i of Object.keys(s))i in e||(e[i]=void 0);return Object.keys(e)}function Im(t,e){return t==null||Array.isArray(t)&&!t.length?e:t}function uN(t){return typeof t=="string"}function cN(t,e,s,i,n){const r=e==="edges",o={};return t.forEach((a,l)=>{const d=n.get(l),h=rh(Im(s(d),e));if(!h.every(uN))throw Error(`The tab ${e} function returned an invalid value.`);const u=rh(i(a.data,h));h.forEach((c,g)=>{const f=Im(u[g],{}),m=nd({internal___id:a.id,...r?{internal___source:a.source,internal___target:a.target}:{},...f}).reduce((_,{path:p,value:x})=>(_[p.join(".")]=x,_),{});o[c]=o[c]||[],o[c].push(m)})}),o}function gN(t){if(!t.length)return[];const e=hN(t),s=[e];for(const i of t)s.push(e.map(n=>i[n]));return s[0]=s[0].map(i=>i.replace("internal___","")),s}function fN(t,e,s){const i=new Jx;let n=e?1:3;const r=[];for(let a=0;a<t.length;++a){const l=t[a],d=new Array(n);let h=l.data;if(s){const c={};s.forEach(g=>{const f=Sn(g),m=lN(h,f);dN(c,f,m)}),h=c}const u=nd(h);d[0]=l.id,e||(d[1]=l.source,d[2]=l.target);for(let c=0;c<u.length;++c){const{path:g,value:f}=u[c];g.length&&(i.has(g)?d[i.get(g)]=f:(i.set(g,n),d[n]=f,n++))}r.push(d)}const o=[];return o.push("id"),e||(o.push("source"),o.push("target")),i.keys().forEach(a=>o.push(a[a.length-1])),r.unshift(o),r.forEach(a=>a.length=n),r}var mN=/[=+\-@|%]/,_N=t=>t.length>0&&mN.test(t[0])?`'${t=t.replace("|","|")}`:t;function N0(t){return t===void 0?"":t instanceof Date?t.toISOString():_N(""+t)}var pN={what:void 0,dataProperties:void 0,separator:",",textSeparator:'"',download:!0,filename:"graph.csv",filter:"visible",nodes:void 0,edges:void 0,nodeData:Hs,edgeData:Hs,styles:"none"};function yN(t,e){const{what:s,dataProperties:i,nodes:n,edges:r,separator:o,textSeparator:a,download:l,nodeData:d,edgeData:h,filename:u,filter:c}=As(typeof e=="string"?{what:e}:e,pN),g=od(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:n,edges:r,filter:c,nodeData:d,edgeData:h});try{const f=xN(g,{what:s,separator:o,textSeparator:a,dataProperties:i});return l&&nn(f,u,"text","text/csv"),Promise.resolve(f)}catch(f){return Promise.reject(f)}}function xN(t,{what:e,separator:s,textSeparator:i,dataProperties:n}){const r=new RegExp(i,"g");if(i&&i!=='"'&&i!=="'")throw new TypeError(`Invalid argument :"textSeparator" is not single-quote or double-quote, was ${i}`);if(e!=="nodes"&&e!=="edges")throw new TypeError('missing argument: "what": should have value "nodes" or "edges"');const o=e==="nodes";return fN(o?t.nodes:t.edges,o,n).map(a=>a.map(l=>function(h){return i+N0(h).replace(r,`${i}${i}`).replace(/\n/g,"\\n").replace(/\r/g,"")+i}(l))).map(a=>a.join(s)).join(`
`)}var On=t=>Math.round(255*t);function Cm(t,e){if(e==="integer"&&typeof t=="number"){if(t%1!=0)return"float"}else if(typeof t!="number")return typeof t=="boolean"?"boolean":"string";return e}var nu=t=>typeof t=="object"&&t!==null&&t.constructor===Object;function ru(t,e={}){return ri(t,(s,i)=>{nu(s)?ru(s,e):e[i]=s}),e}var bN={creator:void 0,description:void 0,styles:"all",download:!0,filename:"graph.gexf",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function vN(t,e={}){const{styles:s,nodes:i,edges:n,download:r,filename:o,creator:a,description:l,filter:d,nodeData:h,edgeData:u}=As(e,bN),c=EN(od(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{creator:a,description:l});return r&&nn(c,o,"text","text/xml"),Promise.resolve(c)}function EN(t,e){const s=ob(),i={},n={};let r,o=0,a=0;const l=s.createElement("gexf");l.setAttribute("xmlns","http://www.gexf.net/1.2draft"),l.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),l.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),l.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),l.setAttribute("version","1.2");const d=s.createElement("meta");if(d.setAttribute("lastmodifieddate",lp()),e.creator){const m=s.createElement("creator");r=s.createTextNode(""+e.creator),m.appendChild(r),d.appendChild(m)}if(e.description){const m=s.createElement("description");r=s.createTextNode(""+e.description),m.appendChild(r),d.appendChild(m)}const h=s.createElement("graph");h.setAttribute("mode","static");const u=s.createElement("nodes");t.nodes.forEach(m=>{const _=s.createElement("node");if(_.setAttribute("id",String(m.id)),m.text&&_.setAttribute("label",qn(m.text)),nu(m.data)){const x=ru(m.data),y=s.createElement("attvalues");Object.keys(x).forEach(b=>{b in i||(i[b]={id:o,type:"integer"},o++);const v=x[b];i[b].type=Cm(v,i[b].type);const E=s.createElement("attvalue");E.setAttribute("for",i[b].id),E.setAttribute("value",qn(v)),y.appendChild(E)}),_.appendChild(y)}if(m.color){const x=es(m.color);if(x){const y=s.createElement("viz:color");y.setAttribute("r",On(x[0])),y.setAttribute("g",On(x[1])),y.setAttribute("b",On(x[2])),y.setAttribute("a",x[3]),_.appendChild(y)}}const p=s.createElement("viz:position");if(p.setAttribute("x",m.x),p.setAttribute("y",-m.y),_.appendChild(p),m.size){const x=s.createElement("viz:size");x.setAttribute("value",m.size),_.appendChild(x)}u.appendChild(_)});const c=s.createElement("attributes");c.setAttribute("class","node"),Object.keys(i).forEach(m=>{const _=s.createElement("attribute");_.setAttribute("id",i[m].id),_.setAttribute("title",m),_.setAttribute("type",i[m].type),c.appendChild(_)});const g=s.createElement("edges");t.edges.forEach(m=>{const _=s.createElement("edge");if(_.setAttribute("id",m.id.toString()),_.setAttribute("source",m.source),_.setAttribute("target",m.target),m.size&&_.setAttribute("weight",m.size),m.text&&_.setAttribute("label",qn(m.text)),nu(m.data)){const p=ru(m.data),x=s.createElement("attvalues");Object.keys(p).forEach(y=>{y in n||(n[y]={id:a,type:"integer"},a++);const b=p[y];n[y].type=Cm(b,n[y].type);const v=s.createElement("attvalue");v.setAttribute("for",n[y].id),v.setAttribute("value",qn(b)),x.appendChild(v)}),_.appendChild(x)}if(m.color){const p=es(m.color);if(p){const x=s.createElement("viz:color");x.setAttribute("r",On(p[0])),x.setAttribute("g",On(p[1])),x.setAttribute("b",On(p[2])),x.setAttribute("a",p[3]),_.appendChild(x)}}if(m.size){const p=s.createElement("viz:size");p.setAttribute("value",m.size),_.appendChild(p)}g.appendChild(_)});const f=s.createElement("attributes");return f.setAttribute("class","edge"),Object.keys(n).forEach(m=>{const _=s.createElement("attribute");_.setAttribute("id",n[m].id),_.setAttribute("title",m),_.setAttribute("type",n[m].type),f.appendChild(_)}),h.appendChild(c),h.appendChild(f),h.appendChild(u),h.appendChild(g),l.appendChild(d),l.appendChild(h),s.appendChild(l),`<?xml version="1.0" encoding="UTF-8"?>${s.serialize()}`}var AN={graphId:"G",directedEdges:!0,styles:"all",download:!0,filename:"graph.graphml",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function SN(t,e){const{styles:s,nodes:i,edges:n,download:r,filename:o,graphId:a,directedEdges:l,filter:d,nodeData:h,edgeData:u}=As(e,AN),c=wN(od(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{graphId:a,directedEdges:l,noStyles:s==="none"});return r&&nn(c,o,"text","text/xml"),Promise.resolve(c)}function wN(t,e){const s=ab();function i(c,g,f,m,_){f=f||{};const p=s.createElement(g);for(const x in f){if(!Object.prototype.hasOwnProperty.call(f,x))continue;const y=f[x];y!==void 0&&p.setAttribute(x,y)}return(m!==void 0||_)&&(Object.prototype.toString.call(m)==="[object Object]"&&(m=JSON.stringify(m)),p.appendChild(s.createTextNode(m))),c.appendChild(p),p}const n=["id","source","target"],r=["size","x","y","shape","text","color"],o={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}};e.noStyles&&(delete o.color,delete o.r,delete o.g,delete o.b,delete o.a,delete o.shape,r.pop());const a=[],l=[];function d(c,g){const f={id:c.id};r.forEach(m=>{let _=c[m];m==="y"&&_&&(_=-parseFloat(_)),_!==void 0&&(f[(g==="edge"?"edge_":"")+m]=_,m==="color"&&function(x,y){const b=es(y);b&&(x.r=b[0],x.g=b[1],x.b=b[2])}(f,_))}),ri(c.data||{},(m,_)=>{r.indexOf(_)===-1&&n.indexOf(_)===-1&&(o[_]?o[_].for!==g&&(o[_].for="all"):o[_]={for:g,type:"string"},f[_]=m)}),g==="edge"?(f.source=c.source,f.target=c.target,l.push(f)):a.push(f)}t.nodes.forEach(c=>d(c,"node")),t.edges.forEach(c=>d(c,"edge"));const h=i(s,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});ri(o,(c,g)=>{c.for!=="node"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"node",id:g}),c.for!=="edge"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"edge",id:"edge_"+g})}),i(h,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"}),i(h,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});const u=i(h,"graph",{edgedefault:e.directedEdges||e.directedEdges===void 0?"directed":"undirected",id:e.graphId?e.graphId:"G","parse.nodes":t.nodes.length,"parse.edges":t.edges.length,"parse.order":"nodesfirst"});return a.forEach(c=>{const g=i(u,"node",{id:c.id});(function(m,_){const p=i(m,"data",{key:"nodegraphics"}),x=i(p,"y:ShapeNode");i(x,"y:Geometry",{x:_.x,y:_.y,width:_.size,height:_.size}),e.noStyles||i(x,"y:Fill",{color:Oh(_.color),transparent:!1}),i(x,"y:NodeLabel",null,_.text||""),i(x,"y:Shape",{type:_.shape})})(g,c),ri(c,(f,m)=>{n.indexOf(m)===-1&&i(g,"data",{key:m},f,!0)})}),l.forEach(c=>{const g=i(u,"edge",{id:c.id,source:c.source,target:c.target});(function(m,_){const p=i(m,"data",{key:"edgegraphics"}),x=i(p,"y:PolyLineEdge");i(x,"y:LineStyle",{type:_.edge_type,color:e.noStyles?void 0:Oh(_.edge_color),width:_.edge_size}),i(x,"y:EdgeLabel",null,_.edge_label)})(g,c),ri(c,(f,m)=>{n.indexOf(m)===-1&&i(g,"data",{key:m},f,!0)})}),`<?xml version="1.0" encoding="UTF-8"?>
${Ac(s)}`}var TN={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:Hs,edgeData:Hs,filter:"visible",pretty:!1,download:!0,filename:"graph.json",anonymize:!1};function IN(t,e={}){e.anonymize&&(e={nodeAttributes:"all",edgeAttributes:"all",nodeData:el,edgeData:el,filter:e.filter||"all",download:e.download,pretty:e.pretty,filename:e.filename});const{nodeAttributes:s,edgeAttributes:i,nodeData:n,edgeData:r,filter:o,pretty:a,download:l,filename:d}=As(e,TN),h=L0(t.modules.graph,{nodeAttributes:s,edgeAttributes:i,filter:o,nodeData:n,edgeData:r}),u=a?JSON.stringify(h,null," "):JSON.stringify(h);return l&&nn(u,d,"text","application/json"),Promise.resolve(h)}function CN(t,e){return t.getBoundingBox().computeForZoom(e).extend(cs.fromValues(t.getAttribute("x"),t.getAttribute("y"),t.map(s=>s.getAttribute("radius")+s.getAttribute("innerStroke.width")+s.getAttribute("outerStroke.width"))))}function LN(t,e,s){const i=e.view.graphToScreenCoordinates(s.bottomLeft()),n=e.view.graphToScreenCoordinates(s.topRight()),r=Math.abs(n.x-i.x),o=Math.abs(n.y-i.y),a=Math.min(t.width/r,t.height/o);t.width=r*a,t.height=o*a}function M0(t,e={}){const s=t.view.get(),i=typeof e.margin=="number"?e.margin:0,n={pixelRatio:e.pixelRatio||ps(),angle:0,backgroundColor:null,zoom:0,x:0,y:0,width:0,height:0,hideImages:!1,renderBackground:!0,isBufferDisplayable:tl};if(e.width&&e.height?(n.width=e.width,n.height=e.height):(n.width=s.width,n.height=s.height),e.clip)n.zoom=s.zoom,n.x=s.x,n.y=s.y;else{const r=CN(t.getNodes(e.filter),s.zoom);if(e.texts){const o=t.modules.labels.getTextsBoundingBox();o.isValid()&&r.extend(o)}e.width!=null&&isFinite(e.width)&&e.height!=null&&isFinite(e.height)||LN(n,t,r),n.width=Math.max(n.width,2*i),n.height=Math.max(n.height,2*i),n.x=r.cx,n.y=r.cy,n.zoom=Math.min((n.width-2*i)/r.width,(n.height-2*i)/r.height)}return t.modules.geo.isEnabled()?n.backgroundColor=null:e.background!==void 0&&(n.backgroundColor=e.background),n}function ou(t,e,s,i,n=!1){const r={...s,hideImages:n,angle:s.angle||0,currentTime:ts(),isBufferDisplayable:l=>e.texts||!Gx(l),bentEnable:!1,bentVertical:!1},o={};if(e.badges===!1){const l={text:null,image:null};o.badges={topLeft:l,topRight:l,bottomRight:l,bottomLeft:l}}const a=t.styles.getClass(un);return a&&a.update({nodeAttributes:o}),t.modules.graphics.export(i,r,e.filter||Oc,e)}var Sa=t=>({download:!0,filter:"visible",filename:`graph.${t}`,clip:!1,margin:10,width:void 0,height:void 0,background:null,badges:!0,legend:void 0,texts:!0,preventOverlap:!0,images:!0,textWatermark:{content:"",fontFamily:"Arial",fontSize:48,fontStyle:void 0,fontColor:"red",repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageWatermark:{url:void 0,width:void 0,height:void 0,repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageCrossOrigin:void 0,layers:!0,pixelRatio:void 0}),NN={png:Sa("png"),jpg:Sa("jpg"),tiff:Sa("tiff"),gif:Sa("gif")};function MN(t){const{canvas:e,parameters:s}=t;return s.textWatermark.content&&Lm(e,s.textWatermark,BN,UN),s.imageWatermark.url?$p(s.imageWatermark.url).then(i=>(i&&(s.imageWatermark.content=i,Lm(e,s.imageWatermark,VN,GN)),t)):t}function PN(t){const{ogma:e,canvas:s,parameters:i}=t,n=e.modules.legend;let r=null;return i.legend===void 0&&(r=!!n.enabled()&&n.getCurrentOptions()),i.legend===!0&&(r={}),r&&n.exportOnCanvas(s,r,t.parameters.pixelRatio),t}function RN(t){const{canvas:e,parameters:s,view:i}=t;if(!i.renderBackground)return t;i.renderBackground=!1;const n=e.getContext("2d");return n.fillStyle=s.background,n.fillRect(0,0,e.width,e.height),t}function FN(t){const{ogma:e,view:s}=t;return e.modules.geo.isEnabled()?e.modules.geo.exportBackground(s).then(i=>{const n=s.width*s.pixelRatio,r=s.height*s.pixelRatio,o=We(n,r),a=o.getContext("2d");return a.drawImage(i,(n-i.width)/2,(r-i.height)/2),a.drawImage(t.canvas,0,0),t.canvas=o,t}):t}function DN(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,canvas:i,below:!0}).then(()=>t):t}function ON(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,below:!1,canvas:i}).then(()=>t):t}function kN(t){const{ogma:e,parameters:s,canvas:i,view:n}=t,r=i.getContext("2d");return ou(e,s,n,"canvas",!s.images).then(o=>{try{const a=o.getContext("2d");if(!a)throw new Error("Failed to render graph");return a.getImageData(0,0,1,1),r.drawImage(o,0,0,i.width,i.height),t}catch(a){return Ei(a),ou(e,s,n,"canvas",!0).then(l=>(r.drawImage(l,0,0,i.width,i.height),t))}})}function zN({canvas:t,parameters:e,type:s}){const i=t.toDataURL("image/"+s);return e.download&&nn(i,e.filename,"dataURL","image/"+s),i}function wa(t,e,s){const i=As(e,NN[s]);i.filename.endsWith(s)||(i.filename+="."+s),i.background===null&&(i.background=t.modules.graphics.getTransparentBackgroundColor());const n=M0(t,i);i.pixelRatio=n.pixelRatio;const r=We(n.width*n.pixelRatio,n.height*n.pixelRatio),o={ogma:t,parameters:i,canvas:r,view:n,type:s};return Promise.resolve().then(()=>o).then(RN).then(FN).then(DN).then(kN).then(ON).then(MN).then(PN).then(zN).then(a=>(t.modules.events.fire("afterImageExport"),a))}function BN(t,e,s,i){t.textAlign="center",t.textBaseline="middle",t.fillText(e,s,i)}function UN(t,e,s){return{width:t.measureText(e).width,height:s}}function GN(t,e,s,i,n){return{width:i===void 0?e.width:i,height:n===void 0?e.height:n}}function VN(t,e,s,i,n,r){t.drawImage(e,s-n/2,i-r/2,n,r)}function Lm(t,e,s,i){if(!e)return;if(typeof e!="object")e={content:e};else if(!e.content)return;const{fontFamily:n,fontSize:r,fontStyle:o,fontColor:a,repeat:l,alpha:d,space:h,content:u}=e;let c=e.angle;const g=t.getContext("2d"),f=t.width,m=t.height,_=e.x===void 0?f/2:e.x,p=e.y===void 0?m/2:e.y,x=e.height,y=e.width;c=c/180*Math.PI,Ji(g,n,r,o),g.fillStyle=a,g.globalAlpha=d;const b=i(g,u,r,y,x);if(l){const v=b.width+h,E=b.height+h,A=Math.sqrt(f*f+m*m);g.save(),g.translate(0,0),g.rotate(c);for(let S=0;S<A;S+=v)for(let w=0;w<A;w+=E)s(g,u,S,w,b.width,b.height),w!==0&&s(g,u,S,-w,b.width,b.height);g.restore()}else g.save(),g.translate(_,p),g.rotate(c),s(g,u,0,0,b.width,b.height),g.restore()}var qN={download:!0,filename:"graph.svg",width:void 0,height:void 0,background:null,texts:!0,preventOverlap:!0,groupSemantically:!0,images:!0,badges:!0,embedFonts:!1,layers:!0,clip:!1,margin:10,prefix:"ogma"};function jN(t,e){const s=As(e,qN),{background:i,filename:n,download:r,layers:o}=s,a=t.modules.graphics;i===null&&(s.background=a.getTransparentBackgroundColor());const l=M0(t,s);return ou(t,s,l,"svg",!s.images).then(d=>(d.removeAttribute("pointer-events"),d.setAttribute("version","1.1"),d.setAttributeNS(uh,"xmlns",Ou),d.setAttributeNS(uh,"xmlns:xlink",Yp),d)).then(d=>s.groupSemantically?WN(t,d,s):d).then(d=>YN(d,s)).then(d=>HN(t,l,d)).then(d=>Nm(t,l,d,o,!0)).then(d=>Nm(t,l,d,o,!1)).then(d=>(t.modules.events.fire("afterImageExport"),d)).then(d=>{const h=`<?xml version="1.0" encoding="utf-8"?>${Ac(d)}`;return r&&nn(h,n,"text","image/svg+xml"),h})}function HN(t,e,s){return t.modules.geo.isEnabled()?t.modules.geo.exportBackground({...e,pixelRatio:1}).then(i=>{const n=ie("image",{width:i.width,height:i.height,x:0,y:0,href:i.toDataURL()});return s.insertBefore(n,s.children[0]),s}):Promise.resolve(s)}function Nm(t,e,s,i,n=!1){return i?t.modules.layers.export({view:e,svg:s,below:n}).then(()=>s):Promise.resolve(s)}function WN(t,e,s){const i=e.childNodes[2],n=i.childNodes,r={},o=s.prefix;for(let g=0;g<n.length;g++){const f=n[g],m=f.getAttribute(Ps);m!=null&&(r[m]=r[m]||[],r[m].push(f))}const a=Object.keys(r),l=t.modules.graph,d=l.getNodeAttribute("id"),h=l.getEdgeAttribute("id"),u=ie("g",{class:`${o}-edges`}),c=ie("g",{class:`${o}-nodes`});for(let g=0;g<a.length;g++){const f=a[g],m=f.charAt(0)==="n",_=parseInt(f.substring(1)),p=r[f],x=qn((m?d:h).get(_).toString()),y=ie("g");y.setAttribute(`data-${m?"node":"edge"}-id`,x),y.setAttribute("class",`${o}-${m?"node":"edge"}`);for(let b=0;b<p.length;b++){const v=p[b];y.appendChild(v),v.removeAttribute(Ps)}(m?c:u).appendChild(y)}return i.appendChild(u),i.appendChild(c),e}function XN(t){const e=[].concat(Array.prototype.slice.call(t.getElementsByTagName("text")||[])),s=[],i={};for(let n=0;n<e.length;n++){const r=e[n].parentNode.getAttribute("font-family");if(typeof r=="string"){const o=r.split(",");for(let a=0;a<o.length;a++){const l=o[a].replace(/['"]/g,"");l===""||i[l]||(i[l]=!0,s.push(l))}}}return{list:s,map:i}}function YN(t,e){const s=XN(t).map;return Zx().then(i=>i.filter(n=>s[n.name])).then(i=>Kx(i,!!e.embedFonts)).then(i=>{if(i.length!==0){const n=ie("style");for(let r=0;r<i.length;r++)n.appendChild(ku(i[r]));t.childNodes[0].appendChild(n)}return t})}var $N={what:void 0,dataProperties:void 0,filter:"visible",nodes:void 0,edges:void 0,download:!0,filename:"graph.xlsx",tab:void 0,nodeData:void 0,edgeData:void 0};function ZN(t,e={}){typeof e=="string"&&(e={what:e});const{what:s,nodes:i,edges:n,tab:r={nodes:()=>"nodes",edges:()=>"edges"},download:o,filename:a,dataProperties:l,filter:d,nodeData:h,edgeData:u}=As(e,$N);r.nodes||(r.nodes=()=>"nodes"),r.edges||(r.edges=()=>"edges");const c=od(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:i,edges:n,filter:d,nodeData:f=>f,edgeData:f=>f}),g=KN(c,{what:s,tabFunctions:r,tabContentFunctions:{nodes:h||(f=>dh(ao(f||{}),l)),edges:u||(f=>dh(ao(f||{}),l))}},{nodes:t.modules.graph.getNodes(c.nodes.map(({id:f})=>f)),edges:t.modules.graph.getEdges(c.edges.map(({id:f})=>f))});return o&&nn(g,a,"blob","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),Promise.resolve(g)}function KN(t,{what:e,tabFunctions:s,tabContentFunctions:i},n){const r=Ds("XLSX")||Ds("xlsx",{throwOnError:!0});if(!r)throw Error('The xlsx exports requires the "xlsx" peer dependency to be associated');const o=new JN;if(e){if(e!=="nodes"&&e!=="edges")throw new TypeError(`Invalid argument: "what" is not "nodes" or "edges", was ${e}`);e==="nodes"&&(t.edges=[]),e==="edges"&&(t.nodes=[])}const a={};for(const l of["nodes","edges"]){const d=cN(t[l],l,s[l],i[l],n[l]);for(const h of Object.keys(d))a[h]=[...a[h]||[],...d[h]]}for(const l of Object.keys(a))o.SheetNames.push(l),o.Sheets[l]=QN(r,gN(a[l]));return o.SheetNames.length===0&&(o.SheetNames=["nodes","edges"],o.Sheets.nodes={},o.Sheets.edges={}),lo([tM(r.write(o,{bookType:"xlsx",bookSST:!1,type:"binary"}))],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")}function QN(t,e){const s={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let n=0;n!==e.length;++n){const r=e[n];for(let o=0;o!==r.length;++o){const a=r[o];i.s.r>n&&(i.s.r=n),i.s.c>o&&(i.s.c=o),i.e.r<n&&(i.e.r=n),i.e.c<o&&(i.e.c=o);const l={v:N0(a)};s[t.utils.encode_cell({c:o,r:n})]=l}}return i.s.c<1e7&&(s["!ref"]=t.utils.encode_range(i)),s}var JN=class{constructor(){this.SheetNames=[],this.Sheets={}}};function tM(t){const e=new ArrayBuffer(t.length),s=new Uint8Array(e);for(let i=0;i!==t.length;++i)s[i]=255&t.charCodeAt(i);return e}var eM=class extends ge{constructor(t){super(t),this.csv=e=>yN(this._ogma,e),this.xlsx=e=>(e&&e.dataProperties&&void 0,ZN(this._ogma,e)),this.gexf=e=>vN(this._ogma,e),this.graphml=(e={})=>SN(this._ogma,e),this.json=(e={})=>IN(this._ogma,e),this.svg=(e={})=>jN(this._ogma,e),this.png=(e={})=>wa(this._ogma,e,"png"),this.jpg=(e={})=>wa(this._ogma,e,"jpg"),this.tiff=(e={})=>wa(this._ogma,e,"tiff"),this.gif=(e={})=>wa(this._ogma,e,"gif"),t.styles.createClass({name:un,isBuiltin:!0})}},Ke=Cu(kv()),sM=class extends ge{constructor(){super(...arguments),this.balancedTree=t=>Promise.resolve(Ke.balancedTree.generate(Ke.balancedTree.configure(t))),this.barabasiAlbert=t=>Promise.resolve(Ke.barabasiAlbert.generate(Ke.barabasiAlbert.configure(t))),this.erdosRenyi=t=>Promise.resolve(Ke.erdosRenyi.generate(Ke.erdosRenyi.configure(t))),this.flower=t=>Promise.resolve(Ke.flower.generate(Ke.flower.configure(t))),this.grid=t=>Promise.resolve(Ke.grid.generate(Ke.grid.configure(t))),this.path=t=>Promise.resolve(Ke.path.generate(Ke.path.configure(t))),this.random=t=>Promise.resolve(Ke.random.generate(Ke.random.configure(t))),this.randomTree=t=>Promise.resolve(Ke.randomTree.generate(Ke.randomTree.configure(t)))}},iM=class extends ge{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.geo.enable(t),this.disable=t=>this._ogma.modules.geo.disable(t),this.setOptions=t=>this._ogma.modules.geo.setOptions(t),this.getOptions=()=>this._ogma.modules.geo.getOptions(),this.getMap=()=>this._ogma.modules.geo.getMap(),this.enabled=()=>this._ogma.modules.geo.isEnabled(),this.getCenter=()=>this._ogma.modules.geo.getCenter(),this.getView=()=>this._ogma.modules.geo.getView(),this.getZoom=()=>this._ogma.modules.geo.getZoom(),this.setZoom=t=>this._ogma.modules.geo.setZoom(t),this.setView=(t,e,s)=>this._ogma.modules.geo.setView(t,e,s),this.setCenter=(t,e)=>this._ogma.modules.geo.setCenter(t,e),this.toggle=t=>this._ogma.modules.geo.toggle(t),this.resetCoordinates=()=>this._ogma.modules.geo.resetCoordinates(),this.getUnprojectedCoordinates=t=>this._ogma.modules.geo.getUnprojectedCoordinates(this._ogma.getNodes(t)),this.runLayout=async({type:t,nodes:e,latitudePath:s=si,longitudePath:i=ii,options:n,center:r})=>{if(t===void 0||n===void 0)throw new Error("Ogma.geo.runLayout: Both layout type and options are required");if(e=this._ogma.getNodes(e),r===void 0){let o=0;if(r=e.reduce((a,l)=>{const d=l.getData(s),h=l.getData(i);return isNaN(d)||isNaN(h)||(a.latitude+=d,a.longitude+=h,o++),a},{latitude:0,longitude:0}),isNaN(r.latitude)||isNaN(r.longitude))throw new Error("Ogma.geo.runLayout: No valid center coordinates found");r.latitude/=o,r.longitude/=o}return this._ogma.modules.geo.runLayout({center:r,nodes:e,type:t,options:n,latitudePath:s,longitudePath:i})}}},nM=class{reloadFonts(){this.modules.graphics.reloadFonts()}},rM=class extends ge{constructor(){super(...arguments),this.gexf=t=>E0(t),this.gexfFromUrl=t=>Fc(t),this.janus=t=>A0(t),this.json=(t,e)=>S0(t,e),this.jsonFromUrl=(t,e)=>Dc(t,e),this.neo4j=t=>w0(t),this.graphml=(t,e)=>T0(t,e),this.graphmlFromUrl=(t,e)=>I0(t,e)}},oM=class extends ge{constructor(){super(...arguments),this.isKeyPressed=t=>this._ogma.modules.keyboard.isPressed(t),this.resetKeys=()=>{this._ogma.modules.keyboard.resetKeys()}}},aM=class extends ge{addLayer(t,e){return this._ogma.modules.layers.addLayer(t,"layer",e)}addCanvasLayer(t,e,s){return this._ogma.modules.layers.addCanvasLayer(t,e,s)}addOverlay(t,e){if(!t.position)throw new Error("options.position argument is required");return this._ogma.modules.layers.addOverlay(t,e)}addSVGLayer(t,e){return t.element||(t.element=document.createElementNS("http://www.w3.org/2000/svg","svg")),t.draw||(t.draw=()=>{}),this._ogma.modules.layers.addSVGLayer(t,e)}},Mm={name:"concentric",configure:function(t,{graph:e,data:s}){if(t.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');const i={...t,centralNode:function(b,v){return v instanceof js?v:b.getNode(v)}(e,t.centralNode)},{centralNode:n,nodes:r}=i,o=e.getNode(n);if(o===void 0)throw new Error('concentric layout: "centralNode" parameter is not valid');const a=o._index,{x:l,y:d}=o.getPosition(),h=r.getAttribute("layoutable"),u=e.getNodes(r)._indexes,c=Array.from(u.filter((y,b)=>h[b]));c.indexOf(a)===-1&&c.push(a);const g=e.getNodeAttribute("radius").getMultiple(u),f=function(b,v,E,A){if(v)return v==="random"?"random":v==="radius"?A.slice():v==="degree"?E.getDegree():b.getProperty(E,v)}(s,i.sortBy,r,g),m=c.reduce((y,b,v)=>(y[b]=v,y),{}),_=c.map((y,b)=>b),p=new Set(t.edges.getExtremities()._indexes),x=c.map(y=>e.topology.getAdjacentElements(!0,new Uint32Array([y])).filter(b=>p.has(b)).map(b=>m[b]));return{sourceNodeIndex:c.indexOf(a),centerX:typeof i.centerX=="number"?i.centerX:l,centerY:typeof i.centerY=="number"?i.centerY:d,list:c,indexes:_,size:c.length,totalSize:c.length,attributes:{adjacentNodes:x,size:g},sortAttr:f,clockwise:i.clockwise===void 0||i.clockwise,circleHopRatio:i.circleHopRatio||5,allowOverlap:!!i.allowOverlap}},context:function(){return{dijkstra:function(t,e,s,i,n){const r=Math.pow(2,31)-1,o=new Int32Array(i),a=new Int32Array(i),l=new Int8Array(i);o.fill(r),a.fill(-1);for(let h=0;h<i;++h){const u=e[h];u!==void 0&&(o[u]=r,a[u]=-1)}o[n]=0;let d=0;for(;d!==-1;){let h=r;d=-1;for(let u=0;u<s;++u){const c=e[u],g=o[c];!l[c]&&g<h&&(h=g,d=c,l[c]=1)}if(d>-1){const u=t[d],c=h+1;u.forEach(g=>{const f=o[g];c<f&&(o[g]=c,a[g]=d)})}}return o},determinePropertyType:function(t,e,s){return e.some(i=>t[i]!=="number")?"string":"number"}}},update:function(t,e){const{attributes:s,indexes:i,size:n}=t,{sourceNodeIndex:r,centerX:o,centerY:a,sortAttr:l}=t,d=s.adjacentNodes,h=s.size,u=new Array(t.totalSize),c=new Array(t.totalSize),g=e.dijkstra(d,i,t.size,t.totalSize,r);let f=0;const m={};for(let E=0;E<n;E++){const A=h[i[E]];A>f&&(f=A)}const _=f*t.circleHopRatio;let p=0,x=0;const y=Math.PI/9;for(let E=0;E<n;E++){const A=i[E],S=g[A];let w=m[S];w||(w=[],m[S]=w),w.push(A)}const b=function(A,S,w){if(A==="random")return function(){return Math.random()-.5};if(A)return w.determinePropertyType(A,S,S.length)==="number"?function(L,T){return A[L]-A[T]}:function(L,T){return A[L]<A[T]?-1:1}}(l,i,e),v=l==="random"||l;return Object.keys(m).sort((E,A)=>parseInt(E)-parseInt(A)).forEach((E,A)=>{const S=m[E],w=S.length;let L=0,T=x;const F=2*Math.PI/w;if(A!==0&&!t.allowOverlap){const V=2*Math.PI*p;let G=0;L+=S.reduce((O,j)=>O+h[j],0),G=2*L*Math.SQRT2,G>V&&(p+=G/(2*Math.PI)-p)}v&&(S.sort(b),t.clockwise||S.reverse());for(let V=0;V<w;V++){const G=S[V];u[G]=Math.cos(T)*p+o,c[G]=Math.sin(T)*p+a;const O=h[G];T+=F*(t.allowOverlap?1:O/L*w)}p+=_,x+=y}),{x:u,y:c,indexes:t.list}},isRunning:function(){return!1},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}},lM=t=>(t.modules.layouts.register(Mm),e=>t.modules.layouts.start(Mm.name,e)),dM=Object.defineProperty,It=(t,e)=>dM(t,"name",{value:e,configurable:!0}),hM=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),uM=It(()=>({[WebGL2RenderingContext.FLOAT]:"uniform1f",[WebGL2RenderingContext.FLOAT_VEC2]:"uniform2fv",[WebGL2RenderingContext.FLOAT_VEC3]:"uniform3fv",[WebGL2RenderingContext.FLOAT_VEC4]:"uniform4fv",[WebGL2RenderingContext.INT]:"uniform1i",[WebGL2RenderingContext.INT_VEC2]:"uniform2iv",[WebGL2RenderingContext.INT_VEC3]:"uniform3iv",[WebGL2RenderingContext.INT_VEC4]:"uniform4iv",[WebGL2RenderingContext.UNSIGNED_INT]:"uniform1ui",[WebGL2RenderingContext.UNSIGNED_INT_VEC2]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC3]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC4]:"uniform2uiv",[WebGL2RenderingContext.FLOAT_MAT2]:"uniformMatrix2fv",[WebGL2RenderingContext.FLOAT_MAT3]:"uniformMatrix3fv",[WebGL2RenderingContext.FLOAT_MAT4]:"uniformMatrix4fv",[WebGL2RenderingContext.SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.SAMPLER_CUBE]:"uniform1i"}),"ne"),_n=new Map,Ud=new Map,cM=It((t,e,s,i)=>{_n.has(t)||_n.set(t,_n.size);const n=`${_n.get(t)}:${e}:${s}`;return Ud.has(n)||Ud.set(n,i()),Ud.get(n)},"ie"),Gd=new Map,gM=It((t,e)=>(_n.has(t)||_n.set(t,_n.size),Gd.has(t)||Gd.set(t,e()),Gd.get(t)),"ae"),oi=It((t,e)=>()=>([t,e]=[e,t],t),"A"),fM=It(t=>{const e=t.createBuffer();if(!e)throw new Error("Could not create buffer");return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,hM,t.STATIC_DRAW),e},"ce"),Ci=It((t,e)=>gM(t,()=>{const s=t.getAttribLocation(e,"position");return t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),s}),"b"),Pm=It((t,e,s)=>{const i=t.createShader(e);if(i===null)throw new Error("Cannot create WebGL shader.");return t.shaderSource(i,s),t.compileShader(i),i},"J"),Li=It((t,e,s)=>cM(t,e,s,()=>{const i=t.createProgram();if(i===null)throw new Error("Cannot create WebGL program.");if(t.attachShader(i,Pm(t,t.VERTEX_SHADER,e)),t.attachShader(i,Pm(t,t.FRAGMENT_SHADER,s)),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const n=t.getProgramInfoLog(i);throw t.deleteProgram(i),new Error(`Could not link WebGL program: 
${n}`)}return i}),"M"),Ys=It((t,{size:e,data:s,type:i,internalFormat:n=t.RGBA32F,format:r=t.RGBA})=>{const o=t.createTexture();if(!o)throw new Error("Cannot create WebGL texture.");const[a,l]=e.map(d=>Math.max(1,d));return s instanceof Float32Array&&s.byteLength===0?s=new Float32Array(a*l*4):s instanceof Uint32Array&&s.byteLength===0&&(s=new Uint32Array(a*l*4)),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,a,l,0,r,i,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{size:e,data:s,type:i,format:r,handle:o}},"R"),_s=It((t,e)=>{const s=t.createFramebuffer();if(!s)throw new Error("Cannot create WebGL frame buffer.");t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i!==t.FRAMEBUFFER_COMPLETE)switch(i){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("Framebuffer: Attachment is NOT complete.");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("Framebuffer: No valid attachment.");case t.FRAMEBUFFER_UNSUPPORTED:throw new Error("Framebuffer: Attachment types are not supported.");default:throw new Error(`Framebuffer: Unknown reason (status: ${i}).`)}return s},"T"),Ni=It((t,e,s)=>{t.useProgram(e);const i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const o=t.getActiveUniform(e,r);if(!o)throw new Error(`Cannot get GL active uniform ${r}.`);const{name:a,size:l,type:d}=o,h=t.getUniformLocation(e,a);if(!h)throw new Error(`Cannot get GL uniform location ${a}.`);i[a]={size:l,data:s[a],type:d,location:h}}return i},"S");function ai(t,e,s={}){let i=0;const n=uM();return Object.entries(e).forEach(([r,{location:o,type:a,data:l}])=>{let d=s[r]!==void 0?s[r]:l;(a===t.SAMPLER_2D||a===t.INT_SAMPLER_2D||a===t.UNSIGNED_INT_SAMPLER_2D)&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,d),d=i,i++),t[n[a]](o,d)})}It(ai,"C");var ad=It(t=>Math.ceil(Math.sqrt(t)),"k"),kc=It(t=>Math.ceil(Math.sqrt(2*t)),"X"),mM=It((t,e,s,i)=>{const n=ad(e),r=new Float32Array(4*n**2);for(let o=0;o<e;o++){const a=4*o;r[a]=s[o],r[a+1]=i[o]}return Ys(t,{size:[n,n],data:r,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"se"),_M=It((t,e,s,i)=>{const n=ad(e),r=kc(s),o=new Uint32Array(3*n**2);let a=0;for(let l=0;l<e;l++){const d=3*l,h=a,u=Math.floor(h/r),c=h%r;o[d]=c,o[d+1]=u,o[d+2]=i[l],a+=i[l]}return Ys(t,{size:[n,n],data:o,type:t.UNSIGNED_INT,format:t.RGB_INTEGER,internalFormat:t.RGB32UI})},"fe"),pM=It((t,e,s,i)=>{const n=ad(e),r=kc(s),o=new Uint32Array(2*r**2);let a=0;for(let l=0;l<e;l++)for(const d of i[l]){const h=Math.floor(d/n),u=d%n;o[a]=u,o[a+1]=h,a+=2}return Ys(t,{size:[r,r],data:o,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})},"_e"),yM=It((t,e,s,i=new Float32Array(e),n=new Uint8Array(e))=>{const r=ad(e),o=new Float32Array(4*r**2);for(let a=0;a<e;a++){const l=4*a;o[l]=s[a],o[l+1]=i[a],o[l+2]=n[a],o[l+3]=0}return Ys(t,{size:[r,r],data:o,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"xe"),xM=It((t,e,s,i)=>{const n=kc(s),r=new Float32Array(n**2);let o=0;for(let a=0;a<e;a++)for(const l of i[a])r[o]=l,o++;return Ys(t,{size:[n,n],data:r,type:t.FLOAT,format:t.RED,internalFormat:t.R32F})},"ve"),Rm=It((t,e)=>Array.from({length:t},(s,i)=>e(i)),"Q"),P0=It(t=>{const e=new Map,s={nodes:[],edges:[]};return t.nodes.forEach((i,n)=>{e.has(i.id)&&console.warn(`Duplicated ID ${i.id}@${n}`),s.nodes.push({...i,id:n}),e.set(i.id,n)}),t.edges.forEach(i=>{const n=e.get(i.source),r=e.get(i.target);return n===void 0||r===void 0?console.warn(`Missing source ${i.source}`):void s.edges.push({...i,source:Math.min(n,r),target:Math.max(n,r)})}),s.edges.sort((i,n)=>i.source-n.source||i.target-n.target),s},"je"),R0=It(({nodes:t,edges:e},[s,i]=[0,0])=>{const n=Math.PI*(3-Math.sqrt(5)),r=t.map(a=>(a.x=(a.x||0)-s,a.y=(a.y||0)-i,a)).map(a=>({n:a,key:a.pinned?0:1+1e6*a.y+a.x})).sort((a,l)=>a.key-l.key);let o=0;return r.forEach(({n:a,key:l},d)=>{if(l*d==0||l!==r[d-1].key)return o=d;const h=Math.sqrt(d-o);a.x=r[o].n.x+h*Math.cos(n*(d-o)),a.y=r[o].n.y+h*Math.sin(n*(d-o))}),{nodes:t,edges:e}},"He"),Fm=It((t,e)=>{const{nodes:s,edges:i}=e,n=s.length,r=i.length,o=new Uint32Array(r),a=new Uint32Array(r),l=new Uint32Array(n);for(let _=0;_<r;_++){const{source:p,target:x}=i[_];o[_]=p,a[_]=x,l[p]++,l[x]++}const d=Rm(n,()=>[]);o.forEach((_,p)=>{d[_].push(a[p]),d[a[p]].push(_)});const h=Rm(n,()=>[]);o.forEach((_,p)=>{if(i[p].stiffness!==void 0)h[_].push(i[p].stiffness),h[a[p]].push(i[p].stiffness);else{const x=l[_],y=l[a[p]],b=x*y/(Math.min(x,y)*(x+y));h[_].push(b),h[a[p]].push(b)}});const u=new Float32Array(s.map(({x:_})=>_||0)),c=new Float32Array(s.map(({y:_})=>_||0)),g=new Float32Array(s.map(({r:_})=>isNaN(_)?1:_)),f=new Float32Array(s.map(({mass:_},p)=>_||l[p]+1)),m=new Uint8Array(s.map(({pinned:_})=>_?1:0));return{N:n,E:r,bodyTexture:mM(t,n,u,c),nodeTexture:_M(t,n,r,l),topologyTexture:pM(t,n,r,d),propertyTexture:yM(t,n,f,g,m),edgePropertyTexture:xM(t,n,r,h)}},"Ke"),Dm=It((t,e)=>{t.deleteTexture(e.bodyTexture.handle),t.deleteTexture(e.nodeTexture.handle),t.deleteTexture(e.topologyTexture.handle),t.deleteTexture(e.propertyTexture.handle),t.deleteTexture(e.edgePropertyTexture.handle)},"Ye"),Mi=`#version 300 es

in vec2 position;

void main() {
  gl_Position = vec4(position, 0.0f, 1.0f);
}`,bM=`#version 300 es
precision highp float;uniform int u_0;uniform lowp sampler2D u_1,u_2;uniform int u_3,u_4;out vec4 outColor;void main(){ivec2 o=ivec2(gl_FragCoord.xy);if(outColor=vec4(1e9,1e9,-1e9,-1e9),u_3>0)for(int e;e<4;e++){ivec2 u=(o<<1)+ivec2(e&1,e>>1);vec4 t=texelFetch(u_2,u,0);outColor=vec4(min(outColor.xy,t.xy),max(outColor.zw,t.zw));}else if(textureSize(u_1,0).x*o.y+o.x<u_0)outColor.xy=outColor.zw=texelFetch(u_1,o,0).xy;if(u_3==u_4){vec2 o=outColor.zw-outColor.xy;o=vec2(max(o.x,o.y),max(o.x,o.y)),outColor=vec4(outColor.xy-vec2(1),o+vec2(2));}}`,vM=It(t=>1<<Math.ceil(Math.log2(Math.sqrt(t))),"me"),Om=It((t,e,s)=>{const i=vM(e),n=new Float32Array(4*i**2);return s&&s.forEach((r,o)=>n[o]=r),Ys(t,{size:[i,i],data:n,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"Z"),EM=It(t=>Math.ceil(Math.log2(Math.sqrt(t)))+1,"he"),AM=It((t,e,s)=>{const i=Li(t,Mi,bM);Ci(t,i);const n=Om(t,e),r=Om(t,e),o=oi(n,r),a=_s(t,r.handle),l=_s(t,n.handle),d=oi(a,l),h=Ni(t,i,{u_0:e,u_1:s().handle,u_2:n.handle,u_3:0,u_4:0});let u=n;return{step:(c=EM(e))=>{t.viewport(0,0,n.size[0],n.size[1]),t.useProgram(i);for(let g=0;g<c;g++){t.bindFramebuffer(t.FRAMEBUFFER,d()),t.viewport(0,0,n.size[0]>>g,n.size[1]>>g);const f=o();u=f===n?r:n,ai(t,h,{u_2:f.handle,u_1:s().handle,u_4:c-1,u_3:g}),t.drawArrays(t.TRIANGLES,0,6)}},texture:()=>u,destroy:()=>{t.deleteFramebuffer(a),t.deleteFramebuffer(l),t.deleteTexture(r.handle),t.deleteTexture(n.handle)}}},"pe"),SM=`#version 300 es
precision lowp float;vec2 i(vec2 i,vec2 e){return vec2(i.x*e.x-i.y*e.y,i.x*e.y+i.y*e.x);}vec2 i(vec2 i){return i.y=-i.y,i;}vec2 i(vec2 u[8],vec2 r,vec2 c){vec2 t,o=r-c,e=vec2(1,0);for(int r;r<8;++r)t+=i(u[r],e),e=i(e,o);return t;}vec2 i(vec2 e,vec4 i){return(e-i.xy)/i.zw;}uniform float u_8,u_9,u_a,u_b,u_c,u_d,u_5,u_6,u_7;uniform int u_0;uniform lowp sampler2D u_1;uniform lowp usampler2D u_e,u_f;uniform lowp sampler2D u_g,u_h;uniform int u_i,u_j;uniform lowp sampler2D u_2;uniform lowp usampler2D u_k,u_l;uniform lowp sampler2D u_m;out vec4 outColor;void main(){uint c=uint(textureSize(u_1,0).x);int h=textureSize(u_f,0).x;ivec2 r=ivec2(gl_FragCoord.xy);if(int(c)*r.y+r.x>=u_0)return;vec3 o=texelFetch(u_g,r,0).xyz;if(o.z>0.)return;vec4 n=texelFetch(u_1,r,0);vec2 u=n.xy,e=n.zw;ivec4 t=ivec4(texelFetch(u_e,r,0));vec4 v=texelFetch(u_2,ivec2(0),0);uint a=uint(textureSize(u_k,0).x);float x=float(1<<u_j-1);ivec2 d=ivec2(u_i,1),l=ivec2(x*i(u,v));vec2 g=(vec2(l)+.5)/x;ivec2 m=l-ivec2(1);for(int i;i<9;++i){ivec2 t=m+ivec2(i%3,i/3);if(t>>u_j-1!=ivec2(0))continue;uvec2 r=texelFetch(u_l,t,0).xy;for(uint i=r.x;i<r.y;i++){uint n=texelFetch(u_k,ivec2(i%a,i/a),0).x;ivec2 v=ivec2(n%c,n/c);vec2 t=texelFetch(u_1,v,0).xy-u;float l=dot(t,t)+1e-4;if(u_c>0.&&u_5<.5){float u=texelFetch(u_g,v,0).y,i=max(o.y+u+u_d,.01);if(l<i*i){float r=sqrt(l);e-=(i-r)*u_c*u/i*t/r;}}float x=texelFetch(u_g,v,0).x;e-=u_5*u_8*x*t/l;}}vec2 y[8];for(int i;i<8;i++)y[i]=i<u_i?texelFetch(u_m,d*l+ivec2(i,0),0).xy:vec2(0);vec2 s=i(i(y,g,i(u,v))/v.z);e-=u_5*u_8*s;ivec2 p;for(int r;r<t.z;r++){p=ivec2(texelFetch(u_f,t.xy,0).xy);float c=texelFetch(u_h,t.xy,0).x;vec2 i=texelFetch(u_1,p,0).xy-u;if(i*=1.-u_b/(length(i)+1e-4),e+=u_5*u_a*c*i/o.x,t.x+=1,t.x>=h)t.x=0,t.y+=1;}e=u_6*(e-u_5*u_9*u);float f=dot(e,e);if(f>u_7)e*=sqrt(u_7/f);outColor=vec4(u+e,e);}`,wM=It((t,e,s,i,n,{handle:r},{handle:o},{N:a,bodyTexture:l,nodeTexture:d,topologyTexture:h,propertyTexture:u,edgePropertyTexture:c},{charge:g,gravity:f,inertia:m,edgeStrength:_,edgeLength:p,elasticity:x,margin:y,maxDisplacement:b})=>{const v=Li(t,Mi,SM);Ci(t,v);const E=Ys(t,{type:t.FLOAT,size:l.size,data:new Float32Array(l.data.buffer.slice(0)),format:t.RGBA,internalFormat:t.RGBA32F}),A=oi(l,E),S=_s(t,E.handle),w=_s(t,l.handle),L=oi(S,w),T=Ni(t,v,{u_5:1,u_6:m,u_7:b**2,u_8:g,u_9:f,u_a:_,u_b:p,u_c:x,u_d:y,u_0:a,u_1:l.handle,u_e:d.handle,u_f:h.handle,u_g:u.handle,u_h:c.handle,u_i:s,u_j:e,u_2:i().handle,u_k:n().handle,u_l:r,u_m:o});let F=l;return{step:V=>{t.viewport(0,0,l.size[0],l.size[1]),t.useProgram(v),t.bindFramebuffer(t.FRAMEBUFFER,L());const G=A();F=G===l?E:l,ai(t,T,{u_5:V,u_1:G.handle,u_2:i().handle,u_k:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>F,destroy:()=>{t.deleteFramebuffer(S),t.deleteFramebuffer(w),t.deleteTexture(E.handle)}}},"le"),TM=It((t,e)=>t.map(s=>e*s),"Fe"),IM=It((t,e)=>TM([e,1],1<<t),"Te"),F0=It((t,e,s,i)=>{const n=IM(e,s),r=new Float32Array(2*n[0]*n[1]);return i&&i.forEach((o,a)=>r[a]=o),Ys(t,{size:n,data:r,type:t.FLOAT,format:t.RG,internalFormat:t.RG32F})},"ee"),CM=`#version 300 es
precision lowp float;vec2 c(vec2 c,vec2 u){return vec2(c.x*u.x-c.y*u.y,c.x*u.y+c.y*u.x);}vec2 u(vec2 u,vec2 c){return vec2(dot(u,c),u.y*c.x-u.x*c.y)/dot(c,c);}vec2 c(vec2 c){return u(vec2(1,0),c);}const float n[64]=float[64](1.,1.,1.,1.,1.,1.,1.,1.,1.,2.,3.,4.,5.,6.,7.,8.,1.,3.,6.,10.,15.,21.,28.,36.,1.,4.,10.,20.,35.,56.,84.,120.,1.,5.,15.,35.,70.,126.,210.,330.,1.,6.,21.,56.,126.,252.,462.,792.,1.,7.,28.,84.,210.,462.,924.,1716.,1.,8.,36.,120.,330.,792.,1716.,3432.);uniform int u_i,u_n;uniform lowp sampler2D u_p,u_q;out vec2 outColor;void main(){float f=float(1<<u_n);ivec2 i=ivec2(u_i,1),v=ivec2(gl_FragCoord.xy)/i;vec2 x=(vec2(v)+.5)/f;uint o=uint(gl_FragCoord.x)%uint(u_i);if(u_n>2){ivec2 m=v>>1;vec2 e=(vec2(v&65534)+1.)/f-x,u=vec2(1,0);for(uint v;v<uint(u_i-int(o));++v)outColor+=n[v+(o<<3)]*c(texelFetch(u_p,i*m+ivec2(v+o,0),0).xy,u),u=c(u,e);}ivec2 m=(v&65534)-2;for(int r;r<36;r++){ivec2 t=m+ivec2(r%6,r/6);vec2 d=texelFetch(u_q,i*t,0).xy;if(d.x==0.)continue;vec2 a=vec2(t-v);if(dot(a,a)<=2.||t>>u_n!=ivec2(0))continue;vec2 l=(vec2(t)+.5)/f-x,e=vec2(1,0);for(uint u;u<o;++u)e=c(e,-l);if(dot(e,e)<1e-20)continue;vec2 p=c(l),y=n[o<<3]*u(d,e);e=c(e,l);for(uint v=1u;v<uint(u_i);++v){if(dot(e,e)<1e-20)break;y+=n[v+(o<<3)]*u(texelFetch(u_q,i*t+ivec2(v,0),0).xy,e),e=c(e,l);}outColor+=c(y,p);}}`,LM=It((t,e,s,i)=>{const n=Li(t,Mi,CM);Ci(t,n);const r=Array.from({length:e},(l,d)=>F0(t,d,s)),o=r.map(({handle:l})=>_s(t,l)),a=Ni(t,n,{u_i:s,u_n:e-1,u_p:null,u_q:null});return{step:()=>{t.useProgram(n);for(let l=2;l<e;l++){const{handle:d}=r[l-1],h=i(l);t.viewport(0,0,h.size[0],h.size[1]),t.bindFramebuffer(t.FRAMEBUFFER,o[l]),ai(t,a,{u_n:l,u_p:d,u_q:h.handle}),t.drawArrays(t.TRIANGLES,0,6)}},texture:l=>r[l],destroy:()=>{o.forEach(l=>t.deleteFramebuffer(l)),r.forEach(({handle:l})=>t.deleteTexture(l))}}},"we"),NM=`#version 300 es
precision lowp float;vec2 e(vec2 e,vec2 t){return vec2(e.x*t.x-e.y*t.y,e.x*t.y+e.y*t.x);}vec2 n(vec2 t,vec2 e){return vec2(dot(t,e),t.y*e.x-t.x*e.y)/dot(e,e);}const vec2 t[8]=vec2[8](vec2(1,0),vec2(-1,0),vec2(2,0),vec2(-6,0),vec2(24,0),vec2(-120,0),vec2(720,0),vec2(-5040,0));const float x[16]=float[16](1.,1.,2.,6.,24.,120.,720.,5040.,40320.,362880.,3628800.,39916800.,479001600.,6.227021e9,8.717829e1,1.3076744e12);vec2 e(vec2 t,vec4 e){return(t-e.xy)/e.zw;}uniform int u_i,u_j,u_n;uniform lowp sampler2D u_o,u_2;uniform lowp usampler2D u_k;uniform lowp sampler2D u_g,u_1;uniform lowp usampler2D u_l;out vec2 outColor;void main(){float i=float(1<<u_n);ivec2 v=ivec2(u_i,1),u=ivec2(gl_FragCoord.xy)/v;vec2 l=(vec2(u)+.5)/i;uint c=uint(gl_FragCoord.x)%uint(u_i);if(u_n==u_j-1){uint t=uint(textureSize(u_1,0).x),n=uint(textureSize(u_k,0).x);vec4 i=texelFetch(u_2,ivec2(0),0);uvec2 x=texelFetch(u_l,u,0).xy;for(uint u=x.x;u<x.y;u++){uint o=texelFetch(u_k,ivec2(u%n,u/n),0).x;ivec2 r=ivec2(o%t,o/t);vec2 d=l-e(texelFetch(u_1,r,0).xy,i),v=vec2(1,0);for(uint t;t<c;++t)v=e(v,d);outColor+=texelFetch(u_g,r,0).x*v;}}else for(int o;o<4;++o){ivec2 d=2*u+ivec2(o&1,o>>1);vec2 f=(vec2(d)+.5)/i/2.-l,r=vec2(1,0),y;for(uint u;u<=c;++u)y+=n(e(texelFetch(u_o,v*d+ivec2(c-u,0),0).xy,r),t[c-u]*x[u]),r=e(r,f);outColor+=e(y,t[c]);}}`,MM=It((t,e,s,i,n,{handle:r},o,{handle:a})=>{const l=Li(t,Mi,NM);Ci(t,l);const d=Array.from({length:e},(c,g)=>F0(t,g,s)),h=d.map(({handle:c})=>_s(t,c)),u=Ni(t,l,{u_i:s,u_j:e,u_n:e-1,u_o:d[0].handle,u_2:i().handle,u_k:n().handle,u_g:r,u_1:o().handle,u_l:a});return{step:()=>{t.useProgram(l);for(let c=e-1;c>=2;c--){const{handle:g}=d[(c+1)%e],f=d[c];t.viewport(0,0,f.size[0],f.size[1]),t.bindFramebuffer(t.FRAMEBUFFER,h[c]),ai(t,u,{u_2:i().handle,u_k:n().handle,u_1:o().handle,u_n:c,u_o:g}),t.drawArrays(t.TRIANGLES,0,6)}},texture:c=>d[c],destroy:()=>{h.forEach(c=>t.deleteFramebuffer(c)),d.forEach(({handle:c})=>t.deleteTexture(c))}}},"Re"),PM=`#version 300 es
uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 r){return u(r.y)<<1|u(r.x);}uniform uint u_0;uniform lowp usampler2D u_k;out uvec2 outColor;uint u(uint n,uint i){uint u,r=u_0;for(;u<r;){uint t=u+r>>1,e=texelFetch(u_k,ivec2(t%i,t/i),0).y;e<n?u=t+1u:r=t;}return u;}void main(){uint r=uint(textureSize(u_k,0).x),i=u(uvec2(gl_FragCoord.xy));outColor=uvec2(u(i,r),u(i+1u,r));}`,RM=It(t=>1<<t-1,"Me"),FM=It((t,e,s)=>{const i=RM(e);return Ys(t,{size:[i,i],data:s||new Uint32Array(2*i**2),type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})},"Se"),DM=It((t,e,s,i)=>{const n=Li(t,Mi,PM);Ci(t,n);const r=FM(t,s),o=_s(t,r.handle),a=Ni(t,n,{u_0:e,u_k:i()});return{step:()=>{t.viewport(0,0,r.size[0],r.size[1]),t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,o),ai(t,a,{u_k:i().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>r,destroy:()=>{t.deleteFramebuffer(o),t.deleteTexture(r.handle)}}},"Ce"),OM=`#version 300 es
precision lowp float;uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 e){return u(e.y)<<1|u(e.x);}vec2 u(vec2 e,vec4 u){return(e-u.xy)/u.zw;}uniform int u_0,u_j;uniform ivec2 u_r;uniform lowp sampler2D u_2,u_1;out uvec2 outColor;void main(){ivec2 o=ivec2(gl_FragCoord.xy);int e=u_r.x*o.y+o.x;if(e>=u_0){outColor=uvec2(uint(e),4294967295u);return;}int t=textureSize(u_1,0).x;o=ivec2(e%t,e/t);vec4 i=texelFetch(u_2,ivec2(0),0);vec2 n=u(texelFetch(u_1,o,0).xy,i);outColor=uvec2(uint(e),u(uvec2(float(1<<u_j-1)*n)));}`,kM=It(t=>{for(let e=0;e<t.length/2;e++)t[2*e]=e,t[2*e+1]=4294967295;return t},"Ge"),zc=It(t=>1<<Math.ceil(Math.log2(t)),"q"),Bc=It(t=>{const e=32-Math.clz32(t-1);return[1<<(e>>>1)+(1&e),1<<(e>>>1)]},"j"),Uc=It((t,e,s)=>{const[i,n]=Bc(zc(e)),r=kM(new Uint32Array(2*i*n));return s&&s.forEach((o,a)=>r[a]=o),Ys(t,{size:[i,n],data:r,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})},"V"),km=It((t,e)=>{const[s,i]=Bc(zc(e)),n=new Uint32Array(4*s*i);return Ys(t,{size:[s,i],data:n,type:t.UNSIGNED_INT,format:t.RGBA_INTEGER,internalFormat:t.RGBA32UI})},"g"),zM=It((t,e,s,i,n)=>{const r=Li(t,Mi,OM);Ci(t,r);const o=Uc(t,e),a=_s(t,o.handle),l=Ni(t,r,{u_0:e,u_j:s,u_r:o.size,u_2:i().handle,u_1:n().handle});return{step:()=>{t.viewport(0,0,o.size[0],o.size[1]),t.useProgram(r),t.bindFramebuffer(t.FRAMEBUFFER,a),ai(t,l,{u_2:i().handle,u_1:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>o,destroy:()=>{t.deleteFramebuffer(a),t.deleteTexture(o.handle)}}},"Le"),BM=`#version 300 es
precision highp int;uniform uint u_s,u_t;uniform highp usampler2D u_u;out uvec2 outColor;uvec2 u(uvec2 u,uvec2 e,bool n,uint i){uvec2 t=u.x<4294967295u?texelFetch(u_u,ivec2(u.x%i,u.x/i),0).xy:u,c=e.x<4294967295u?texelFetch(u_u,ivec2(e.x%i,e.x/i),0).xy:e;if(n)return t.y<c.y?t:c;return t.y>c.y?t:c;}void main(){uint e=uint(textureSize(u_u,0).x);uvec2 t=uvec2(gl_FragCoord.xy);uint i=uint(t.x+e*t.y),x=texelFetch(u_u,ivec2(t),0).x,c=i^1u<<u_s-u_t,o=texelFetch(u_u,ivec2(c%e,c/e),0).x;bool n=(i>>u_s-u_t&1u)==0u;(i>>u_s&2u)==2u&&(n=!n),outColor=u(uvec2(i,x),uvec2(c,o),n,e);}`,UM=It(t=>Math.max(0,Math.ceil(Math.log2(t))),"Pe"),GM=It(t=>t*(t+1)/2,"Ne"),VM=It((t,e,s)=>{const i=Li(t,Mi,BM);Ci(t,i);const n=Uc(t,e),r=s,o=oi(n,r),a=_s(t,r.handle),l=_s(t,n.handle),d=oi(a,l),h=Ni(t,i,{u_s:0,u_t:0,u_u:r.handle}),u=UM(e);let c=0,g=0,f=r;return{step:(m=GM(u))=>{t.useProgram(i),t.viewport(0,0,n.size[0],n.size[1]),f!==s&&(d(),o(),f=s);for(let _=0;_<m;_++){t.bindFramebuffer(t.FRAMEBUFFER,d());const p=o();f=p===n?r:n,ai(t,h,{u_s:c,u_t:g,u_u:p.handle}),t.drawArrays(t.TRIANGLES,0,6),g=(g+1)%(c+1),g===0&&(c=(c+1)%u)}},texture:()=>f,destroy:()=>{t.deleteFramebuffer(a),t.deleteFramebuffer(l),t.deleteTexture(n.handle)}}},"Be"),qM=`#version 300 es
precision highp int;uniform uint u_s,u_t;uniform highp usampler2D u_u,u_v;out uvec4 outColor;uint v(uint v,uint t,uint u,uint n,uint e){uint i=v<u?t+v:n-u+v;uvec2 c=texelFetch(u_u,ivec2(i%e,i/e),0).xy;return c.y;}void main(){ivec2 x=ivec2(gl_FragCoord.xy);uint o=u_s-u_t;uvec2 n=uvec2(textureSize(u_u,0)),t=n.x==n.y?uvec2(0u,1u):uvec2(1u,0u);t=(o&1u)==1u?1u-t:t;uvec2 s=n>>uvec2(o+t.y>>1u,o+t.x>>1u);uint y=s.x*uint(x.y)+uint(x.x);uvec4 u;if(u_t==0u)u=uvec4(y&4294967294u,1u,(y&4294967294u)+1u,1u)<<u_s;else{uint v=y>>1u,e=s.x>>t.x;u=texelFetch(u_v,ivec2(v%e,v/e),0);}uint e=u.y+u.w>>1u,c=u.y<e?0u:u.y-e,r=u.y<e?u.y:e;for(;c<r;){uint i=c+(r-c>>1u);v(i,u.x,u.y,u.z,uint(n.x))<v(i+e,u.x,u.y,u.z,uint(n.x))?c=i+1u:r=i;}uint i=e-c;if((x.x&1)==0)outColor=uvec4(u.x,e-i,u.z+u.w-i,i);else outColor.zw=uvec2(u.z,u.w-i),outColor.xy=u.y<u.w?uvec2(u.x+e-i,u.y-e+i):uvec2(u.x+u.y-e+u.w-i,e-u.w+i);}`,jM=`#version 300 es
precision highp int;uniform uint u_s;uniform highp usampler2D u_u,u_v;out uvec2 outColor;void main(){uvec2 t=uvec2(gl_FragCoord.xy);uint u=uint(textureSize(u_v,0).x),e=t.y*u+t.x;bool o=(e>>u_s+1u&1u)==1u;if(o){uint u=1u<<u_s+1u;e+=u-2u*(e%u)-1u;}uvec4 i=texelFetch(u_v,ivec2(e%u,e/u),0);uint n=i.y>0u?i.x:i.z;outColor=texelFetch(u_u,ivec2(n%u,n/u),0).xy;}`,HM=It(t=>Math.max(0,Math.ceil(Math.log2(t))),"We"),WM=It(t=>t*(t+1)/2,"$e"),XM=It((t,e,s)=>{e=zc(e);const i=Li(t,Mi,qM),n=Li(t,Mi,jM);Ci(t,i),Ci(t,n);const r=Uc(t,e),o=s,a=oi(r,o),l=_s(t,o.handle),d=_s(t,r.handle),h=oi(l,d),u=km(t,e),c=km(t,e),g=oi(u,c),f=_s(t,c.handle),m=_s(t,u.handle),_=oi(f,m),p=Ni(t,i,{u_s:0,u_t:0,u_u:o.handle,u_v:c.handle}),x=Ni(t,n,{u_s:0,u_u:o.handle,u_v:c.handle}),y=HM(e);let b=0,v=0,E=o;return{step:(A=WM(y))=>{E!==s&&(h(),a(),E=s);for(let S=0;S<A;S++){if(S*v==0&&t.useProgram(i),t.bindFramebuffer(t.FRAMEBUFFER,_()),t.viewport(0,0,...Bc(e>>>b-v)),ai(t,p,{u_s:b,u_t:v,u_v:g().handle,u_u:E.handle}),t.drawArrays(t.TRIANGLES,0,6),v===b){t.useProgram(n),t.bindFramebuffer(t.FRAMEBUFFER,h());const w=a();E=w===r?o:r,t.viewport(0,0,w.size[0],w.size[1]),_(),ai(t,x,{u_s:b,u_u:w.handle,u_v:g().handle}),t.drawArrays(t.TRIANGLES,0,6)}v=(v+1)%(b+1),v===0&&(b=(b+1)%y)}},texture:()=>E,destroy:()=>{t.deleteFramebuffer(l),t.deleteFramebuffer(d),t.deleteTexture(r.handle),t.deleteFramebuffer(f),t.deleteFramebuffer(m),t.deleteTexture(c.handle),t.deleteTexture(u.handle)}}},"Xe"),YM=It(t=>{let e;return()=>e||t().finally(()=>e=void 0)},"qe"),$M=It((t,e)=>Math.max(.1,1-(t/Math.max(1,e-20))**7.39),"te"),ZM=It((t,e=25,s=24e3)=>{const i=(s-e)/(e-1);return Math.ceil(e*i*4/(i+t))},"re"),zm={charge:10,edgeStrength:.5,edgeLength:30,elasticity:.9,margin:1,gravity:.01,inertia:.9,maxDisplacement:1e3,steps:200},KM=It((t,e,s)=>{let[i,n]=[0,0];const r=fM(t),o=It(()=>{t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0);for(let l=0;l<e;l++,i++)if(!s(i))return!0},"a"),a=It(l=>{o()?l(i):n=requestAnimationFrame(()=>a(l))},"i");return{start:YM(()=>new Promise(l=>(i=0)||a(l))),step:o,stop:()=>cancelAnimationFrame(n)}},"ue"),Vd=It((t,e,s)=>{let{bodyTexture:i}=e;const{N:n,propertyTexture:r}=e,{steps:o,batch:a,sortingMethod:l}=s,d=s.order??4;if(d<2||d>8)throw new Error("Order must be between 2 and 8");const h=Math.max(1,s.depth??Math.ceil(Math.log2(n)/2)),{step:u,texture:c,destroy:g}=AM(t,n,()=>i),{step:f,texture:m,destroy:_}=zM(t,n,h,c,()=>i),p=l==="ibr"?XM:VM,{step:x,texture:y,destroy:b}=p(t,n,m()),{step:v,texture:E,destroy:A}=DM(t,n,h,y),{step:S,texture:w,destroy:L}=MM(t,h,d,c,y,r,()=>i,E()),{step:T,texture:F,destroy:V}=LM(t,h,d,w),{step:G,texture:O,destroy:j}=wM(t,h,d,c,y,E(),F(h-1),e,s);return{...KM(t,a??ZM(n),W=>(i=O(),u(),f(),x(),v(),S(),T(),G($M(W,o)),W<o)),destroy:()=>{g(),_(),b(),A(),L(),V(),j()}}},"Ze"),QM=It(({nodes:t,edges:e})=>{const s=t.length,i=e.length,n=new Uint32Array(s);for(let r=0;r<i;r++){const{source:o,target:a}=e[r];n[o]++,n[a]++}return n},"degrees"),JM=It((t,e)=>({nodes:t.nodes.map((s,i)=>{const n=s.mass||1;return{...s,mass:n*(e[i]+1)}}),edges:t.edges.map(s=>{const i=s.weight||1,n=e[s.target]+1,r=e[s.source]+1,o=i*(n*r)/Math.min(n,r)/(n+r);return{...s,stiffness:o}})}),"defaultSettings"),tP=It((t,e)=>{const s=R0(P0(t),e);return JM(s,QM(s))},"cleanGraph"),Bm=0,D0=typeof window>"u",eP=typeof performance<"u"&&performance.now?performance:Date,sP=D0?t=>{const e=eP.now(),s=Math.max(0,16-(e-Bm)),i=setTimeout(()=>t(e+s),s);return Bm=e+s,i}:window.requestAnimationFrame,iP=D0?t=>clearTimeout(t):window.cancelAnimationFrame;function O0(t,e,s){for(let i=0;i<t.length;i++){const n=t[i];n.x=e[i],n.y=s[i]}}It(O0,"defaultUpdate");var nP=It(()=>{},"noop"),qd={movementRatio:7e-8,surfaceRatio:.0025},au=class{constructor(t={}){this.onUpdate=It(e=>{},"onUpdate"),this.update=O0,this.nextTick=sP,this.cancelTick=iP,this.onEnd=nP,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=qd,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in t?t.autoStop&&(typeof t.autoStop=="boolean"?t.autoStop=qd:t.autoStop={...t.autoStop,...qd}):t.steps;for(const e in t)t[e]===void 0&&e!=="order"&&e!=="depth"||(this[e]=t[e])}};It(au,"Settings");var Um=class{constructor(t){this.promise=new Promise(t)}then(t){return this.promise.then(t)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function $a(t,e,s={}){let i,n;e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_lose_context")?.loseContext();let r=new au({...zm,...s});const o=t.nodes.length,a=s.cx||t.nodes.reduce((f,m)=>f+(m.x||0),0)/o,l=s.cy||t.nodes.reduce((f,m)=>f+(m.y||0),0)/o,d=[a,l],h=It(f=>{if(!i)throw new Error("No graph has been set");const{size:m}=i.bodyTexture;if(m[0]*m[1]<=1)return{X:[0],Y:[0]};const _=new Float32Array(4*m[0]*m[1]);e.readPixels(0,0,m[0],m[1],e.RGBA,e.FLOAT,_),f&&(u(),c());const p=_.filter((y,b)=>b%4==0).map(y=>y+a),x=_.filter((y,b)=>b%4==1).map(y=>y+l);return{X:p,Y:x}},"readLayoutData"),u=It(()=>{n&&(n.stop(),n.destroy(),n=void 0)},"simulationCleanup"),c=It(()=>{i&&(Dm(e,i),i=void 0)},"graphLayoutCleanup"),g={setOptions:(f={})=>(r=new au({...zm,...f}),i&&(u(),n=Vd(e,i,r)),g),setGraph:(f={nodes:[],edges:[]})=>(i&&Dm(e,i),i=Fm(e,R0(P0(f),d)),r&&(u(),n=Vd(e,i,r)),g),start:()=>{if(!n)throw new Error("No graph has been set");return n.start().finally(()=>s.onEnd?.(1)),g},stop:()=>(n&&n.stop(),g),step:()=>{if(!n)throw new Error("No graph has been set");return n.step(),g},data:f=>h(f),iterations:()=>1};return i=Fm(e,tP(t,d)),n=Vd(e,i,r),g}/**
* @preserve
* @linkurious/force-layout@0.7.3
* Ogma general-purpose force-directed layout
*/function Gm(){var t=(()=>{var e=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,r=(C,N)=>e(C,"name",{value:N,configurable:!0}),o={};((C,N)=>{for(var I in N)e(C,I,{get:N[I],enumerable:!0})})(o,{IntegratorType:()=>M,default:()=>fe});var a=class{constructor(C){let N=l();this.c=1,this.s0=N(" "),this.s1=N(" "),this.s2=N(" "),this.s0-=N(String(C)),this.s0<0&&(this.s0+=1),this.s1-=N(String(C)),this.s1<0&&(this.s1+=1),this.s2-=N(C),this.s2<0&&(this.s2+=1),N=null}next(){return()=>{const C=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=C-(this.c=0|C)}}nextDouble(){const C=this.next();return()=>C()+11102230246251565e-32*(2097152*C()|0)}nextInt32(){const C=this.next();return()=>4294967296*C()|0}};function l(){let C=4022871197;return N=>{N=N.toString();for(let I=0;I<N.length;I++){C+=N.charCodeAt(I);let P=.02519603282416938*C;C=P>>>0,P-=C,P*=C,C=P>>>0,P-=C,C+=4294967296*P}return 23283064365386963e-26*(C>>>0)}}function d(C){return new a(C.toString()).next()}r(a,"Alea"),r(l,"Mash"),r(d,"impl");var h=d(42);function u(C){h=d(C)}function c(){return 1e-6*(h()-.5)}function g(C,N,{sources:I,targets:P,X:U,Y:q,R:k,fx:B,fy:H,degrees:Z,masses:Y,weights:K},{edgeStrength:J,edgeLength:it}){for(let $=0;$<N.length;$++){const dt=N[$],ct=I[dt],ut=P[dt],pt=1,nt=Z[ct]+pt,ht=Z[ut]+pt,xt=J*K[dt];let bt=U[ut]+B[ut]-U[ct]-B[ct]||c(),Lt=q[ut]+H[ut]-q[ct]-H[ct]||c();const Ct=bt*bt+Lt*Lt,Ot=Math.sqrt(Ct),kt=it+k[ct]+k[ut];if(Ot<=kt)continue;const Ht=kt-Ot,Qt=Ht*(ht*nt/Math.min(ht,nt)/(ht+nt)),Jt=Math.min(1,C*xt*Ht/Ct*(Qt*(ht+nt)/(ht*nt))),ae=ht*nt/(ht+nt);bt*=Jt,Lt*=Jt,B[ct]+=bt*ae/Y[ct],H[ct]+=Lt*ae/Y[ct],B[ut]-=bt*ae/Y[ut],H[ut]-=Lt*ae/Y[ut]}}r(u,"setSeed"),r(c,"randomize"),r(g,"attraction");var f=r((C,{edgeIds:N,sources:I,targets:P,degrees:U,weights:q})=>{for(let k=0;k<C.length;k++){const{source:B,target:H,weight:Z=1}=C[k];I[k]=B,P[k]=H,q[k]=Z,U[B]++,U[H]++,N[k]=k,q[k]=Z===void 0?1:Z}},"initialize");function m(C,N,{X:I,Y:P,fx:U,fy:q},{gravity:k,cx:B,cy:H}){const Z=N.length;for(let Y=0;Y<Z;Y++){const K=N[Y],J=B-I[K]||c(),it=H-P[K]||c(),$=k*C;U[K]+=J*$,q[K]+=it*$}}g.initialize=f,r(m,"center");var _=r((C,N,I)=>{const{X:P,Y:U}=N;let q=I.cx,k=I.cy;const B=C.length;if(q===void 0||k===void 0){q=k=0;for(let H=0;H<B;H++)q+=P[H],k+=U[H];q/=B,k/=B}I.cx=q,I.cy=k},"initialize");m.initialize=_;var p=class{constructor(C,N,I,P){this.left=null,this.right=null,this.data=null,this.code=C,this.data=N,this.left=I,this.right=P}};function x(C,N,I,P,U){const q=new p(null,null,null,null),k=[q],B=[P,U];for(;k.length!==0;){const H=B.pop(),Z=B.pop(),Y=k.pop();if(H-Z==0)Y.code=I[Z],Y.data=C[N[Z]];else{const K=v(N,I,Z,H);Y.code=K,Z<=K&&(Y.left=new p(null,null,null,null),k.push(Y.left),B.push(Z,K)),H>K&&(Y.right=new p(null,null,null,null),k.push(Y.right),B.push(K+1,H))}}return q}function y(C,N,I,P,U,q){const k=new p(null,null,null,null),B=[k],H=[P,U];for(;B.length!==0;){const Z=H.pop(),Y=H.pop(),K=B.pop();if(Z-Y<q){const J=new Array(Z-Y+1);for(let it=Y,$=0;it<=Z;it++,$++)J[$]=C[N[it]];K.code=I[Y],K.data=J}else{const J=v(N,I,Y,Z);K.code=J,Y<=J&&(K.left=new p(null,null,null,null),B.push(K.left),H.push(Y,J)),Z>J&&(K.right=new p(null,null,null,null),B.push(K.right),H.push(J+1,Z))}}return k}r(p,"Node"),r(x,"buildIterative"),r(y,"buildIterativeBuckets");var b=Math.clz32||r(function(N){let I=-2147483648;for(let P=0;P<31;P+=1){if(I&N)return P;I>>>=1}return 32},"clz");function v(C,N,I,P){const U=N[C[I]],q=N[C[P]];if(U===q)return I;const k=b(U^q);let B,H,Z,Y=I,K=P-I;do K=K+1>>1,B=Y+K,B<P&&(H=N[C[B]],Z=b(U^H),Z>k&&(Y=B));while(K>1);return Y}function E(C,N){let I=C^N,P=65535^I,U=65535^(C|N),q=C&(65535^N),k=I|P>>1,B=I>>1^I,H=U>>1^P&q>>1^U,Z=I&U>>1^q>>1^q;I=k,P=B,U=H,q=Z,k=I&I>>2^P&P>>2,B=I&P>>2^P&(I^P)>>2,H^=I&U>>2^P&q>>2,Z^=P&U>>2^(I^P)&q>>2,I=k,P=B,U=H,q=Z,k=I&I>>4^P&P>>4,B=I&P>>4^P&(I^P)>>4,H^=I&U>>4^P&q>>4,Z^=P&U>>4^(I^P)&q>>4,I=k,P=B,U=H,q=Z,H^=I&U>>8^P&q>>8,Z^=P&U>>8^(I^P)&q>>8,I=H^H>>1,P=Z^Z>>1;let Y=C^N,K=P|65535^(Y|I);return Y=16711935&(Y|Y<<8),Y=252645135&(Y|Y<<4),Y=858993459&(Y|Y<<2),Y=1431655765&(Y|Y<<1),K=16711935&(K|K<<8),K=252645135&(K|K<<4),K=858993459&(K|K<<2),K=1431655765&(K|K<<1),(K<<1|Y)>>>0}r(v,"findSplit"),r(E,"hilbert");var A=[0,1],S=[0,2];for(let C=4;C<65535;C<<=2)for(let N=0,I=A.length;N<I;N++)A.push(A[N]|C),S.push((A[N]|C)<<1);function w(C,N){return(S[255&N]|A[255&C])+65536*(S[N>>8&255]|A[C>>8&255])+4294967296*(S[N>>16&255]|A[C>>16&255])}r(w,"morton");var L=new Uint32Array(1024);function T(C,N){const I=new Uint32Array(N.length);for(let U=0;U<1024;U++)L[U]=0;const P=255;for(let U=0;U<N.length;U++){const q=N[U];L[q&P]++,L[256+(q>>8&P)]++,L[512+(q>>16&P)]++,L[768+(q>>24&P)]++}for(let U=0;U<4;U++){let q=0,k=0;const B=256*U;for(let H=0;H<256;H++)q=L[H+B],L[H+B]=k,k+=q}for(let U=0;U<N.length;U++){const q=N[U];I[L[q&P]++]=U}for(let U=0;U<N.length;U++){const q=I[U],k=N[q];C[L[256+(k>>8&P)]++]=q}for(let U=0;U<N.length;U++){const q=C[U],k=N[q];I[L[512+(k>>16&P)]++]=q}for(let U=0;U<N.length;U++){const q=I[U],k=N[q];C[L[768+(k>>24&P)]++]=q}}r(T,"radixSort");var F=class{constructor(C,{getX:N,getY:I,bucketSize:P=0,sfc:U=1}={}){this.bucketSize=0,this._root=null;const q=C.length,k=new Uint32Array(q);let B=1/0,H=1/0,Z=-1/0,Y=-1/0;this._x=N,this._y=I;const K=U===1?E:w;this._project=K;const J=new Uint32Array(q);for(let dt=0;dt<q;dt++){const ct=C[dt],ut=N(ct),pt=I(ct);ut<B&&(B=ut),pt<H&&(H=pt),ut>Z&&(Z=ut),pt>Y&&(Y=pt),J[dt]=dt}this._minX=B,this._minY=H,this._maxX=Z,this._maxY=Y;const it=65535/Math.max(Z-B,1),$=65535/Math.max(Y-H,1);this._hw=it,this._hh=$;for(let dt=0;dt<q;dt++){const ct=C[dt];k[dt]=K(it*(N(ct)-B),$*(I(ct)-H))}T(J,k),this._root=P===0?x(C,J,k,0,q-1):y(C,J,k,0,q-1,P),this.bucketSize=P}get root(){return this._root}inOrder(C,N){let I=this._root;const P=[];let U=!1;for(;!U;)if(I)P.push(I),I=I.left;else if(P.length!==0){if(I=P.pop(),C.call(N,I))break;I=I.right}else U=!0;return this}preOrder(C,N){const I=[this._root];for(;I.length!==0;){const P=I.pop();C.call(N,P)||(P.right&&I.push(P.right),P.left&&I.push(P.left))}return this}postOrder(C,N){const I=[];let P,U=this._root;do{for(;U;)U.right&&I.push(U.right),I.push(U),U=U.left;U=I.pop(),P=I.length-1,U.right&&I[P]===U.right?(I[P]=U,U=U.right):(C.call(N,U),U=null)}while(I.length!==0);return this}map(C,N){const I=[];return this.inOrder(P=>{I.push(C.call(N,P))}),I}height(){return V(this._root)}toString(C=N=>N.code.toString()){const N=[];return G(this._root,"",!0,I=>N.push(I),C),N.join("")}size(){let C=0;return this.preOrder(()=>{C++}),C}destroy(){return this._root=null,this}};function V(C){return C?1+Math.max(V(C.left),V(C.right)):0}function G(C,N,I,P,U){if(C){P(N+(I?"^-- ":"|-- ")+U(C)+`
`);const q=N+(I?"    ":"|   ");C.left&&G(C.left,q,!1,P,U),C.right&&G(C.right,q,!0,P,U)}}function O(C){for(let N=C.length-1;N>=0;N--){let I=Math.floor(Math.random()*(N+1));I=Math.max(Math.min(I,N),0);const P=C[N];C[N]=C[I],C[I]=P}return C}r(F,"BVH"),r(V,"treeHeight"),r(G,"row"),r(O,"shuffle");var j,W,et,at,mt,vt,wt,Et,yt,St=r(C=>C.x,"getX"),zt=r(C=>C.y,"getY"),Zt=r(C=>C.r,"getR");function Kt(C,N=St,I=zt,P=Zt){const U=O(C.slice()),q=U.length;let k,B=[],H=0;for(;H<q;){const Z=U[H];k&&gt(k,N(Z),I(Z),P(Z))?H++:(B=X(B,Z,N,I,P),k=st(B,N,I,P),H=0)}return k}function X(C,N,I,P,U){const q=I(N),k=P(N),B=U(N),H={x:q,y:k,r:B};if(lt(H,C,I,P,U))return[N];for(let Z=0;Z<C.length;++Z){const Y=C[Z],K=I(Y),J=P(Y),it=U(Y);if(!Q(H,K,J,it)&&lt(rt(K,J,it,q,k,B),C,I,P,U))return[C[Z],N]}for(let Z=0;Z<C.length-1;Z++)for(let Y=Z+1;Y<C.length;Y++){const K=C[Z],J=C[Y],it=I(K),$=P(K),dt=U(K),ct=I(J),ut=P(J),pt=U(J);if(!Q(rt(it,$,dt,ct,ut,pt),q,k,B)&&!Q(rt(it,$,dt,q,k,B),ct,ut,pt)&&!Q(rt(ct,ut,pt,q,k,B),it,$,dt)&&lt(ft(it,$,dt,ct,ut,pt,q,k,B),C,I,P,U))return[C[Z],C[Y],N]}throw new Error}function Q(C,N,I,P){const U=C.r-P,q=N-C.x,k=I-C.y;return U>=0&&U*U>q*q+k*k}function gt(C,N,I,P){const U=C.r-P+1e-6,q=N-C.x,k=I-C.y;return U>0&&U*U>q*q+k*k}function lt(C,N,I,P,U){for(let q=0;q<N.length;++q){const k=N[q];if(!gt(C,I(k),P(k),U(k)))return!1}return!0}function st(C,N,I,P){return C.length===1?ot(N(C[0]),I(C[0]),P(C[0])):C.length===2?rt(N(C[0]),I(C[0]),P(C[0]),N(C[1]),I(C[1]),P(C[1])):ft(N(C[0]),I(C[0]),P(C[0]),N(C[1]),I(C[1]),P(C[1]),N(C[2]),I(C[2]),P(C[2]))}function ot(C,N,I){return{x:C,y:N,r:I}}function rt(C,N,I,P,U,q){const k=P-C,B=U-N,H=q-I,Z=Math.sqrt(k*k+B*B);return{x:(C+P+k/Z*H)/2,y:(N+U+B/Z*H)/2,r:(Z+I+q)/2}}function ft(C,N,I,P,U,q,k,B,H){const Z=(C+P+k)/3,Y=(N+U+B)/3,K=C-Z,J=N-Y,it=P-Z,$=U-Y,dt=k-Z,ct=B-Y,ut=K-it,pt=K-dt,nt=J-$,ht=J-ct,xt=q-I,bt=H-I,Lt=K*K+J*J-I*I,Ct=Lt-it*it-$*$+q*q,Ot=Lt-dt*dt-ct*ct+H*H,kt=pt*nt-ut*ht,Ht=(nt*Ot-ht*Ct)/(2*kt)-K,Qt=(ht*xt-nt*bt)/kt,Jt=(pt*Ct-ut*Ot)/(2*kt)-J,ae=(ut*bt-pt*xt)/kt,Ue=Qt*Qt+ae*ae-1,Re=2*(I+Ht*Qt+Jt*ae),Le=Ht*Ht+Jt*Jt-I*I,Fe=-(Math.abs(Ue)>1e-6?(Re+Math.sqrt(Re*Re-4*Ue*Le))/(2*Ue):Le/Re);return{x:Z+K+Ht+Qt*Fe,y:Y+J+Jt+ae*Fe,r:Fe}}function Nt(C,N,I,{X:P,Y:U,R:q,fx:k,fy:B,bucketSize:H},{elasticity:Z}){if(Z===0)return I;I||(I=new F(N,{getX:j,getY:W,bucketSize:H})).postOrder(at);for(let Y=0;Y<N.length;Y++)vt=N[Y],wt=P[vt]+k[vt],Et=U[vt]+B[vt],yt=q[vt],I.preOrder(mt);return I}r(Kt,"med"),r(X,"extend"),r(Q,"contains"),r(gt,"containsWeak"),r(lt,"containsWeakAll"),r(st,"enclose"),r(ot,"from1"),r(rt,"from2"),r(ft,"from3"),r(Nt,"collisionForce");var Rt,Pt,Vt,jt,Xt,Ft,oe,Gt,se,le,ze,Ge=r(({X:C,Y:N,R:I,bucketSize:P})=>U=>{let q,k,B,H;const Z=U.data;if(Z!==null)if(P!==0){const Y=Kt(Z,j,W,et);q=Y.x,k=Y.y,B=Y.r}else{const Y=Z;q=C[Y],k=N[Y],B=I[Y]}else if(U.left&&U.right){const Y=U.left.cx,K=U.left.cy,J=U.right.cx,it=U.right.cy,$=U.left.r,dt=U.right.r,ct=J-Y,ut=it-K,pt=dt-$,nt=Math.sqrt(ct*ct+ut*ut);q=(Y+J+ct/nt*pt)/2,k=(K+it+ut/nt*pt)/2,B=(nt+$+dt)/2}else H=U.left||U.right,H&&(q=H.cx,k=H.cy,B=H.r);U.cx=q,U.cy=k,U.r=B},"getMeasureBodies"),$s=r(({X:C,Y:N,R:I,fx:P,fy:U,bucketSize:q},{elasticity:k,margin:B})=>H=>{const Z=H.data;if(Z===null){const Y=H.cx-wt,K=H.cy-Et,J=H.r+yt;return Y*Y+K*K>J*J}if(q!==0){const Y=Z;for(let K=0;K<Y.length;K++){const J=Y[K];if(J>vt){const it=I[J];let $=wt-C[J]-P[J],dt=Et-N[J]-U[J];const ct=yt+it+B;let ut=$*$+dt*dt;if(ut<ct*ct){$===0&&($=c(),ut+=$*$),dt===0&&(dt=c(),ut+=dt*dt);const pt=Math.sqrt(ut),nt=(ct-pt)*k/pt,ht=it/ct;P[vt]+=$*nt*ht,U[vt]+=dt*nt*ht,P[J]-=$*nt*(1-ht),U[J]-=dt*nt*(1-ht)}}}}else{const Y=H.data;if(Y>vt){const K=I[Y];let J=wt-C[Y],it=Et-N[Y];const $=yt+K+B;let dt=J*J+it*it;if(dt<$*$){J===0&&(J=c(),dt+=J*J),it===0&&(it=c(),dt+=it*it);const ct=Math.sqrt(dt),ut=($-ct)*k/ct,pt=K/$;P[vt]+=J*ut*pt,U[vt]+=it*ut*pt,P[Y]-=J*ut*(1-pt),U[Y]-=it*ut*(1-pt)}}}},"getApplyForce"),Ss=r((C,N,I)=>{const{X:P,Y:U,R:q}=N;j=r(k=>P[k],"getX"),W=r(k=>U[k],"getY"),et=r(k=>q[k],"getR"),at=Ge(N),mt=$s(N,I)},"initialize");function ns(C,N,{masses:I,X:P,Y:U,fx:q,fy:k},{charge:B}){const H=N.length;let Z,Y,K,J,it,$,dt,ct,ut;for(let pt=0;pt<H;pt++){Z=N[pt];for(let nt=pt+1;nt<H;nt++)if(pt!==nt){if(Y=N[nt],Z===Y)continue;K=P[Z]-P[Y]||c(),J=U[Z]-U[Y]||c(),it=K*K+J*J,it<1&&(it=Math.sqrt(1*it)),$=B*I[Y],dt=C*$/it,ct=B*I[Z],ut=C*ct/it,q[Z]+=K*dt,k[Z]+=J*dt,q[Y]-=K*ut,k[Y]-=J*ut}}}Nt.initialize=Ss,r(ns,"repulsion"),ns.initialize=()=>{};var ws=0;function Xe(C,N,I,{X:P,Y:U,R:q,masses:k,bucketSize:B}){ws=C,I===null&&(I=new F(N,{getX:Vt,getY:jt,bucketSize:B})).postOrder(Rt);const H=N.length;for(let Z=0;Z<H;Z++)Ft=N[Z],oe=P[Ft],Gt=U[Ft],se=q[Ft],le=k[Ft],ze=le,I.preOrder(Pt);return I}r(Xe,"repulsion");var gs=r(({fx:C,fy:N,X:I,Y:P,R:U,masses:q,bucketSize:k},{charge:B,theta:H})=>Z=>{let Y=0,K=0,J=oe-Z.cx||c(),it=Gt-Z.cy||c(),$=J*J+it*it,dt=se+Z.r;const ct=Z.data;if(ct!==null){if(ct===Ft)return!1;if(k!==0){const ut=ct;for(let pt=0;pt<ut.length;pt++){const nt=ut[pt];if(nt===Ft)continue;J=oe-I[nt]||c(),it=Gt-P[nt]||c(),$=J*J+it*it,dt=se+U[nt],$<1&&($=Math.sqrt(1*$));const ht=q[nt];Y=B*ht*ze,K=ws*Y/$,C[Ft]+=J*K/le,N[Ft]+=it*K/le}}else $<1&&($=Math.sqrt(1*$)),Y=B*Z.mass*ze,K=ws*Y/$,C[Ft]+=J*K/le,N[Ft]+=it*K/le}else{const ut=dt/H;if($>ut*ut)return $<1&&($=Math.sqrt(1*$)),Y=B*Z.mass*ze,K=ws*Y/$,C[Ft]+=J*K/le,N[Ft]+=it*K/le,!0}},"getApplyForce"),rs=r(({X:C,Y:N,R:I,masses:P,bucketSize:U})=>q=>{let k,B,H=0,Z=0,Y=0,K=0;const J=q.data;if(J!==null)if(U!==0){const it=J,$=Kt(it,Vt,jt,Xt);H=$.x,Z=$.y,Y=$.r;for(let dt=0;dt<it.length;dt++)K+=P[it[dt]]}else B=J,H=C[B],Z=N[B],Y=I[B],K=P[B];else if(q.left&&q.right){const it=q.left.cx,$=q.left.cy,dt=q.right.cx,ct=q.right.cy,ut=q.left.r,pt=q.right.r,nt=dt-it,ht=ct-$,xt=pt-ut,bt=Math.sqrt(nt*nt+ht*ht);H=(it+dt+nt/bt*xt)/2,Z=($+ct+ht/bt*xt)/2,Y=(bt+ut+pt)/2,K=q.left.mass+q.right.mass}else k=q.left||q.right,H=k.cx,Z=k.cy,Y=k.r,K=k.mass;q.cx=H,q.cy=Z,q.r=Y,q.mass=K},"getAccumulateBodies"),Ve=r((C,N,I)=>{const P=C.length,{X:U,Y:q,R:k,degrees:B,pinned:H,masses:Z,nodeIds:Y}=N,{scaling:K,defaultRadius:J,bucketSize:it}=I;N.bucketSize=it===void 0?Math.floor(Math.log(P)):it;let $=1/0,dt=1/0,ct=-1/0,ut=-1/0;const pt=Math.PI*(3-Math.sqrt(5));let nt=0;for(let ht=0;ht<C.length;ht++){const xt=C[ht];let{x:bt,y:Lt,r:Ct}=xt;const{mass:Ot=1}=xt;if(isNaN(bt)||isNaN(Lt)){const kt=5*Math.sqrt(ht),Ht=ht*pt;bt=kt*Math.cos(Ht),Lt=kt*Math.sin(Ht)}Ct=Ct||J,U[ht]=bt,q[ht]=Lt,k[ht]=Ct,H[ht]=xt.pinned?1:0,Z[ht]=Ot*(1+B[ht])*K,Y[ht]=ht,Ct>nt&&(nt=Ct),bt<$&&($=bt),Lt<dt&&(dt=Lt),bt>ct&&(ct=bt),Lt>ut&&(ut=Lt)}if(C.length>1&&(ct-$<2*nt||ut-dt<2*nt)){const ht=($+ct)/2,xt=(dt+ut)/2;for(let bt=0;bt<P;bt++)if(!H[bt]){const Lt=5*Math.sqrt(bt),Ct=bt*pt,Ot=ht+Lt*Math.cos(Ct),kt=xt+Lt*Math.sin(Ct);U[bt]=Ot,q[bt]=kt,Ot<$&&($=Ot),kt<dt&&(dt=kt),Ot>ct&&(ct=Ot),kt>ut&&(ut=kt)}}Vt=r(ht=>U[ht],"getX"),jt=r(ht=>q[ht],"getY"),Xt=r(ht=>k[ht],"getR"),Rt=rs(N),Pt=gs(N,I)},"initialize");function fs(C,N,{X:I,Y:P,fx:U,fy:q,vx:k,vy:B,masses:H,pinned:Z},Y){let K=0,J=0;const it=C.length,$=1/8;for(let dt=0;dt<it;dt++){const ct=C[dt],ut=H[ct],pt=U[ct]/ut,nt=q[ct]/ut;k[ct]+=pt*$,B[ct]+=nt*$;const ht=.2*k[ct]*$+.5*pt*$*$,xt=.2*B[ct]*$+.5*nt*$*$;U[ct]=q[ct]=0,Z[ct]||(I[ct]+=ht,P[ct]+=xt,K+=Math.abs(ht)*ut,J+=Math.abs(xt)*ut)}return(K*K+J*J)/it}function hi(C,N,{X:I,Y:P,fx:U,fy:q,vx:k,vy:B,pinned:H,masses:Z},Y){const K=C.length;let J=0;for(let it=0;it<K;it++){const $=C[it],dt=Z[$],ct=U[$]/dt,ut=q[$]/dt,pt=k[$]+1*ct,nt=B[$]+1*ut;let ht=1*pt,xt=1*nt;ht>1e4&&(ht=.1),xt>1e4&&(xt=.1),k[$]=N*(pt+k[$])/2,B[$]=N*(nt+B[$])/2,U[$]=q[$]=0,H[$]||(I[$]+=ht,P[$]+=xt),J+=.5*(ht*ht+xt*xt)}return J}function Be(C,N,{X:I,Y:P,fx:U,fy:q,pinned:k,layer:B,layers:H,surfaces:Z,movements:Y},{maxDisplacement:K}){Y.fill(0);let J=0;const it=C.length;let $=1/0,dt=1/0,ct=-1/0,ut=-1/0;const pt=K*K;for(let xt=0;xt<it;xt++){const bt=C[xt],Lt=U[bt]*=N,Ct=q[bt]*=N,Ot=B[bt];let kt=Lt,Ht=Ct;const Qt=I[bt],Jt=P[bt];if(kt*kt+Ht*Ht>pt){const Ue=Math.sqrt(kt*kt+Ht*Ht)/K;Ht/=Ue,kt/=Ue}k[bt]||(I[bt]+=kt,P[bt]+=Ht);const ae=Math.sqrt(kt*kt+Ht*Ht);k[bt]||(Qt<$&&($=Qt),Jt<dt&&(dt=Jt),Qt>$&&(ct=Qt),Jt>dt&&(ut=Jt),Y[Ot-1]+=ae),J+=Ot*ae}const nt=Math.max(ct-$,0),ht=Math.max(ut-dt,0);for(let xt=0;xt<H.length;xt++){const bt=H[xt],Lt=bt.length;let Ct=1/0,Ot=1/0,kt=-1/0,Ht=-1/0,Qt=0;for(let Fe=0;Fe<Lt;Fe++){const De=bt[Fe];if(k[De])continue;const os=I[De],Oe=P[De];os<Ct&&(Ct=os),Oe<Ot&&(Ot=Oe),os>kt&&(kt=os),Oe>Ht&&(Ht=Oe),Qt++}const Jt=kt-Ct,ae=Ht-Ot,Ue=Math.max(1,Math.sqrt(Jt**2+ae**2));Z[xt]=Ue;const Re=Qt===0?0:Y[xt]/Qt,Le=nt*ht||1;Y[xt]=Re>Qt?Re/Le:0}return J}function be(C,N,I){ue(C,N,I),ys(I)}function ue(C,N,{sources:I,targets:P,degrees:U,nodeIds:q,edgeIds:k}){const B={};for(let H=0;H<C.length;H++)B[H]=q[H]=H;for(let H=0;H<N.length;H++){const{source:Z,target:Y}=N[H],K=B[Z],J=B[Y];k[H]=H,I[H]=K,P[H]=J,U[K]++,U[J]++}}function ys({nodeIds:C,edgeIds:N,sources:I,targets:P,degrees:U,layer:q,layers:k,component:B,components:H,cluster:Z,parent:Y}){let K=0,J=1;const it=new Uint32Array(C.length);for(let nt=0;nt<C.length;nt++)it[nt]=U[nt];const $=new Array(C.length);for(let nt=0;nt<N.length;nt++){const ht=N[nt],xt=I[ht],bt=P[ht];$[xt]=$[xt]||[],$[bt]=$[bt]||[],$[xt].push(bt),$[bt].push(xt)}const dt=new Uint8Array(C.length),ct=new Uint8Array(C.length);Y.fill(-1);let ut=0;for(let nt=0;nt<C.length;nt++)if(dt[nt]===0){const ht=[nt];for(;ht.length!==0;){const xt=ht.pop();if(dt[xt]===0&&$[xt]!==void 0){const bt=$[xt];for(let Lt=0;Lt<bt.length;Lt++)ht.push(bt[Lt])}dt[xt]=1,B[xt]=ut}ut++}const pt=new Array(C.length);for(let nt=0;nt<C.length;nt++)q[nt]=0,pt[nt]=nt;for(;pt.length!==0;){const nt=[],ht=[];for(let xt=0;xt<pt.length;xt++)it[pt[xt]]<=K&&(nt.push(xt),ht.push(pt[xt]));for(let xt=0;xt<ht.length;xt++){const bt=ht[xt];ct[bt]=K,q[bt]=J;const Lt=$[bt];if(Lt)for(let Ct=0;Ct<Lt.length;Ct++)it[Lt[Ct]]--}for(let xt=0;xt<ht.length;xt++){const bt=ht[xt],Lt=$[bt];if(Lt)for(let Ct=0;Ct<Lt.length;Ct++){const Ot=Lt[Ct],kt=q[Ot];if(kt===void 0||kt>J){Y[bt]=Ot;break}}}nt.reverse();for(let xt=0;xt<nt.length;xt++)pt.splice(nt[xt],1);if(J+=1,pt.length>0){let xt=1/0;for(let bt=0;bt<pt.length;bt++){const Lt=it[pt[bt]];Lt<xt&&(xt=Lt)}xt>=K+1&&(K=xt,J=1)}}dt.fill(0);for(let nt=0;nt<C.length;nt++){const ht=C[nt],xt=q[ht];if(Y[ht]===-1||q[Y[ht]]===xt){const bt=[ht];for(dt.fill(0);bt.length!==0;){const Lt=bt.pop();if(dt[Lt])continue;if(q[Lt]>xt){Y[ht]=Lt;break}const Ct=$[Lt];if(dt[Lt]=1,Ct)for(let Ot=0;Ot<Ct.length;Ot++)bt.push(Ct[Ot])}}}for(let nt=0;nt<C.length;nt++){const ht=C[nt],xt=B[ht];H[xt]=H[xt]||[],H[xt].push(ht);const bt=q[ht]-1;k[bt]=k[bt]||[],k[bt].push(ht),Z[ht]=Y[ht]}}Xe.initialize=Ve,r(fs,"euler"),r(hi,"leapfrog"),r(Be,"velocityVerlet"),r(be,"default"),r(ue,"initTopology"),r(ys,"decomposition");var Ts=class{constructor(C,N=!0){this.bucketSize=0;const I=C.nodes.length,P=C.edges.length;u(I+P),this.X=new Array(I),this.Y=new Array(I),this.R=new Array(I),this.fx=new Float32Array(I),this.fy=new Float32Array(I),this.vx=new Float32Array(I),this.vy=new Float32Array(I),this.pinned=new Uint8Array(I),this.masses=new Float32Array(I),this.weights=new Float32Array(P),this.lengths=new Float32Array(P),this.sources=new Uint32Array(P),this.targets=new Uint32Array(P),this.degrees=new Uint32Array(I),this.layer=new Uint32Array(I),this.parent=new Int32Array(I),this.cluster=new Int32Array(I),this.component=new Uint32Array(I),this.components=[],this.layers=[],this.nodeIds=new Array(I),this.edgeIds=new Array(P),N&&be(C.nodes,C.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)}};function de(C,N){return C<N?C*N+Math.pow(N-C-1,2)/4:C*N+Math.pow(C-N-1,2)/4}function Ye(C,N){return(C+N)*(C+N+1)/2+N}function we({edgeIds:C,sources:N,targets:I,pinned:P,degrees:U,X:q,Y:k,R:B},H=0,Z=.5){const Y={},K={};for(const J of C){const it=N[J],$=I[J];it!==$&&(Y[it]=Y[it]||{},Y[$]=Y[$]||{},Y[it][$]=!0,Y[$][it]=!0)}Object.keys(Y).forEach(J=>{const it=Number(J),$=Object.keys(Y[Number(it)]);if($.length===2){const[dt,ct]=$,ut=de(Number(dt),Number(ct));ut in K||(K[ut]=[Number(ct),Number(dt)]),P[it]||K[ut].push(it)}}),Object.keys(K).forEach(J=>{const[it,$,...dt]=K[Number(J)];if(dt.length<3)return;const ct=q[it],ut=k[it],pt=q[$],nt=k[$],ht=U[it],xt=.25+.5*ht/(ht+U[$]);let bt=ct+(pt-ct)*xt,Lt=ut+(nt-ut)*xt,Ct=-(nt-ut),Ot=pt-ct;const kt=Math.sqrt(Math.pow(ct-pt,2)+Math.pow(ut-nt,2));Ct=-2*Ct/kt,Ot=-2*Ot/kt;const Ht=Math.acos(Ct/Math.sqrt(Ct*Ct+Ot*Ot));H>0&&(Ht<H||Ht>Math.PI-H&&Ht<=Math.PI?(Ct=2*Math.cos(Math.PI-H),Ot=2*Math.sin(Math.PI-H)):(Ht>2*Math.PI-H||Ht>=Math.PI&&Ht<Math.PI+H)&&(Ct=2*Math.cos(H),Ot=2*Math.sin(H)));let Qt=0,Jt=1;dt.sort((Fe,De)=>B[De]-B[Fe]);let ae=0,Ue=0;const Re=Math.max(B[dt[0]],B[dt[1]])/2;dt.length%2==1&&(Qt=1,bt-=Ct*Re,Lt-=Ot*Re);const Le=1+Z;for(let Fe=0;Fe<dt.length;Fe++){const De=(Qt+Fe)%2,os=dt[Fe],Oe=Fe>=2?B[os]:Re,Mn=(De?ae:Ue)+Oe;q[os]=bt+Ct*Jt*Mn,k[os]=Lt+Ot*Jt*Mn,De?ae+=Oe*Le:Ue+=Oe*Le,Jt=-Jt}})}function Is(C){let N=0,I=0;for(const k of C)N+=k.w*k.h,I=Math.max(I,k.w);C.sort((k,B)=>B.h-k.h);const P=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(N/.95)),I),h:1/0}];let U=0,q=0;for(const k of C)for(let B=P.length-1;B>=0;B--){const H=P[B];if(!(k.w>H.w||k.h>H.h)){if(k.x=H.x,k.y=H.y,q=Math.max(q,k.y+k.h),U=Math.max(U,k.x+k.w),k.w===H.w&&k.h===H.h){const Z=P.pop();B<P.length&&(P[B]=Z)}else k.h===H.h?(H.x+=k.w,H.w-=k.w):k.w===H.w?(H.y+=k.h,H.h-=k.h):(P.push({x:H.x+k.w,y:H.y,w:H.w-k.w,h:k.h}),H.y+=k.h,H.h-=k.h);break}}}function qe(C,N=1){return Is(C.map(I=>(I.w+=I.maxr+N,I.h+=I.maxr+N,I)).sort((I,P)=>I.w*I.h-P.w*P.h))}r(Ts,"LayoutData"),r(de,"unorderedPair"),r(Ye,"orderedPair"),r(we,"alignSiblings"),r(Is,"potpack"),r(qe,"boxpack");var Cs=class{constructor(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}add(C,N,I,P){this.ids.push(C),N-P<this.xmin&&(this.xmin=N-P),I-P<this.ymin&&(this.ymin=I-P),N+P>this.xmax&&(this.xmax=N+P),I+P>this.ymax&&(this.ymax=I+P),P>this.maxr&&(this.maxr=P),this.mx+=P*N,this.my+=P*I,this.m+=P}measure(C=0){return this.w=this.xmax-this.xmin+2*C,this.h=this.ymax-this.ymin+2*C,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this}};function xs(C,N=20,I,P,U){for(const $ of C){const{x:dt,y:ct,r:ut}=Kt($.ids,pt=>I[pt],pt=>P[pt],pt=>U[pt]);$.cx=dt,$.cy=ct,$.radius=ut+N}const q=C.slice().sort(($,dt)=>$.radius-dt.radius),k=q.map($=>({x:$.cx,y:$.cy,r:$.radius})),B=q.pop();let H=3*Math.PI/2,Z=B.radius;const Y=2*Math.PI,{cx:K,cy:J}=B,it=[B];for(;q.length!==0;){const $=q[q.length-1],dt=Z+$.radius,ct=K+Math.cos(H)*dt,ut=J+Math.sin(H)*dt;it.some(pt=>{const nt=pt.cx-ct,ht=pt.cy-ut;return Math.sqrt(nt*nt+ht*ht)<pt.radius+$.radius})?Z+=1:($.x=ct-$.w/2,$.y=ut-$.h/2,$.cx=ct,$.cy=ut,k[q.length-1].x=ct,k[q.length-1].y=ut,it.push(q.pop()),H+=(2*$.radius+1)/dt*1%Y)}}function te(C,N,I,P){let U=0;const q=[];for(const k of P){const B=new Cs;for(const H of k)B.add(H,C[H],N[H],I[H]);q.push(B.measure()),k.length>q[U].ids.length&&(U=q.length-1)}return{boxes:q,biggest:U}}function bs(C,N,{X:I,Y:P,R:U,components:q,pinned:k,degrees:B,sources:H,targets:Z,edgeIds:Y},{update:K,onUpdate:J,placement:it,placementOffset:$,alignSiblings:dt,siblingsMinAngle:ct,siblingsOffset:ut}){if(dt&&(we({X:I,Y:P,R:U,degrees:B,pinned:k,sources:H,targets:Z,edgeIds:Y},ct,ut),K(C,I,P)),it){const{boxes:pt,biggest:nt}=te(I,P,U,q);if(it==="spiral")xs(pt,$,I,P,U);else{if(it!=="box")return;qe(pt,$)}const ht=pt[nt].xmin-pt[nt].x,xt=pt[nt].ymin-pt[nt].y;for(const bt of pt){const{xmin:Lt,ymin:Ct,x:Ot,y:kt,ids:Ht}=bt,Qt=Lt-Ot-ht,Jt=Ct-kt-xt;for(const ae of Ht)I[ae]-=Qt,P[ae]-=Jt}K(C,I,P),J()}}r(Cs,"Component"),r(xs,"spiralpack"),r(te,"groupAndMeasure"),r(bs,"postprocessing");var M=(C=>(C[C.verlet=0]="verlet",C[C.euler=1]="euler",C))(M||{}),R=0,z=typeof window>"u",D=typeof performance<"u"&&performance.now?performance:Date,tt=z?C=>{const N=D.now(),I=Math.max(0,16-(N-R)),P=setTimeout(()=>C(N+I),I);return R=N+I,P}:window.requestAnimationFrame,_t=z?C=>clearTimeout(C):window.cancelAnimationFrame;function Tt(C,N,I){for(let P=0;P<C.length;P++){const U=C[P];U.x=N[P],U.y=I[P]}}r(Tt,"defaultUpdate");var At=r(()=>{},"noop"),Mt={movementRatio:7e-8,surfaceRatio:.0025},Dt=class{constructor(C={}){this.onUpdate=r(N=>{},"onUpdate"),this.update=Tt,this.nextTick=tt,this.cancelTick=_t,this.onEnd=At,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=Mt,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in C?C.autoStop&&(typeof C.autoStop=="boolean"?C.autoStop=Mt:C.autoStop={...C.autoStop,...Mt}):C.steps;for(const N in C)C[N]===void 0&&N!=="order"&&N!=="depth"||(this[N]=C[N])}};function qt(C,N,{X:I,Y:P,R:U,degrees:q,nodeIds:k,edgeIds:B,layers:H,layer:Z,cluster:Y,masses:K,weights:J,sources:it,targets:$},{cx:dt,cy:ct,nextTick:ut,cancelTick:pt,update:nt,onUpdate:ht,batch:xt,maxIterations:bt,steps:Lt,minMovement:Ct},Ot,kt){const Ht=H.slice();xt=xt??1;let Qt,Jt=0;function ae(){pt(Qt),nt(C,I,P),ht(),kt(Jt)}r(ae,"stop");const Ue={};for(let $e=0;$e<N.length;$e++)Ue[Number(N[$e].id)||$e]=$e;const Re=new Map;for(let $e=0;$e<B.length;$e++){const Zs=B[$e];Re.set(Ye(it[Zs],$[Zs]),Zs)}for(let $e=0;$e<H.length;$e++){const Zs=H[$e],Di=$e;for(let zs=0;zs<Zs.length;zs++){const ke=Zs[zs],Ne=Y[ke];Ne!==-1&&(K[Ne]+=K[ke])}for(let zs=0;zs<N.length;zs++){const ke=N[zs],Ne=Number(ke.id)||zs,Ks=ke.source,on=ke.target,Bo=J[Ue[Ne]];if(Z[Ks]===Di&&Z[on]===Di){const Xc=Y[Ks],Yc=Y[on];if(Xc!==Yc){const $c=Re.get(Ye(Xc,Yc));$c!==void 0&&(J[$c]+=Bo)}}}}k.length=0,B.length=0,bt=1/0;let Le=1;const Fe=1-Math.pow(.1,1/Lt/2),De=(Le-.1)/Lt;let os,Oe,Mn=.5;function dd(){Le+=(0-Le)*Fe;const $e=Ot(Le,k,B);let Zs=Le<=Mn||$e<Ct;if(Jt===0||Zs){const Di=Ht.pop();if(Di){os&&(Oe=os.reduce((ke,Ne)=>Math.max(ke,dt-I[Ne],ct-P[Ne]),0)),k.push.apply(k,Di);for(let ke=0;ke<Di.length;ke++){const Ne=Di[ke],Ks=Y[Ne];if(Ks!==-1){const on=q[Ne]>1?2:1,Bo=U[Ks]+U[Ne];K[Ks]-=K[Ne],I[Ne]=I[Ks]+on*Bo*(2*h()-1),P[Ne]=P[Ks]+on*Bo*(2*h()-1)}else os&&(I[Ne]=dt+2*Oe*(1-2*h()),P[Ne]=ct+2*Oe*(1-2*h()))}os=Di;const zs=k.reduce((ke,Ne)=>(ke[Ne]=!0,ke),{});B.length=0;for(let ke=0;ke<N.length;ke++){const{source:Ne,target:Ks,id:on}=N[ke];zs[Ne]&&zs[Ks]&&B.push(Ue[Number(on)])}Zs=!1,Ht.length===0?(Le=.2,Mn=.1):(Le=.1+2*De,Mn=.1)}}Jt%xt==0&&(nt(C,I,P),ht()),++Jt>=bt||Zs?ae():Qt=ut(dd)}return r(dd,"simulationStep"),{done:!1,start(){return Qt=setTimeout(dd),this},stop(){return ae(),this},get iterations(){return Jt}}}r(Dt,"Settings"),r(qt,"multiLevel");var Wt=class{constructor(C){this.promise=new Promise(C)}then(C){return this.promise.then(C)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function Ut(C,N,{X:I,Y:P,nodeIds:U,edgeIds:q,layers:k,movements:B,movementsPrev:H,surfaces:Z,surfacesPrev:Y},K,J,it){const{nextTick:$,cancelTick:dt,steps:ct,minMovement:ut,update:pt,onUpdate:nt,autoStop:ht}=K,xt=K.batch??1;let bt=0,Lt=1,Ct,Ot=1-Math.pow(.05,1/ct),kt=!1;const Ht=r(()=>{kt=!0,dt(Ct),nt(),it(bt)},"stop");let Qt=!1;const Jt=r(()=>{Lt+=(.001-Lt)*Ot;const ae=J(Lt,U,q),Ue=k.length;let Re=!1,Le=!1;if(ht){Re=Le=!0;const{movementRatio:De,surfaceRatio:os}=ht;for(let Oe=0;Oe<Ue;Oe++)Re&&Math.abs(1-Z[Oe]/Y[Oe])>os&&(Re=!1),Le&&Math.abs(B[Oe]-H[Oe])>De&&(Le=!1)}Re&&Le&&!Qt&&(Ot=1-Math.pow(.001,1/Math.max(10,bt)),Qt=!0);const Fe=kt||Lt<.05||ae!==0&&ae<=ut;if(bt%xt==0&&(pt(C,I,P),nt()),++bt>=ct||Fe)return Ht();for(let De=0;De<Ue;De++)H[De]=B[De],Y[De]=Z[De];Ct=$(Jt)},"simulationStep");return{done:!1,start(){return Ct=setTimeout(Jt),this},stop(){return Ht(),this},get iterations(){return bt}}}r(Wt,"SimulationPromise"),r(Ut,"singleLevel");var $t,ce={euler:fs,verlet:Be,leapfrog:hi};function fe(C,N={}){let I,P;const U=r((J={nodes:[],edges:[]})=>(I=J.nodes,P=J.edges,u(Ye(I.length,P.length)),new Ts(J,!0)),"setGraph"),q=r((J={})=>new Dt(J),"setOptions");let k=U(C),B=q(N);f(P,k),Ve(I,k,B),Ss(I,k,B),_(I,k,B);const H=ce[B.integrator]||Be;let Z=null;const Y=r((J,it,$)=>(Z&&(Z.destroy(),Z=null),it.length<=1?0:(B.barnesHutOptimization?Z=Xe(J,it,Z,k):ns(J,it,k,B),g(J,$,k,B),Z&&B.elasticity!==0&&Nt(0,it,Z,k,B),m(J,it,k,B),H(it,B.inertia,k,B))),"step");let K;return{setOptions:(J={})=>(B=q(J),this),setGraph:({nodes:J,edges:it})=>(k=U(C),f(it,k),Ve(J,k,B),Ss(J,k,B),_(J,k,B),this),start(){return K=(B.multilevel?qt:Ut)(I,P,k,B,Y,J=>{K.done||bs(I,0,k,B),B.onEnd(J),K.done=!0}).start(),this},iterations:()=>K.iterations,data:()=>k,stop(){return K&&K.stop(),this},step(J=1){return Y(J,k.nodeIds,k.edgeIds),B.update(I,k.X,k.Y),this}}}return r(fe,"force"),fe.run=(C,N)=>{let I;const P=new Wt(U=>{N.onEnd=U,I=fe(C,N).start()});return P.simulation=I,P.stop=()=>(I.stop(),P),P},$t=o,((C,N,I,P)=>{if(N&&typeof N=="object"||typeof N=="function")for(let U of i(N))n.call(C,U)||U===I||e(C,U,{get:()=>N[U],enumerable:!(P=s(N,U))||P.enumerable});return C})(e({},"__esModule",{value:!0}),$t)})();return t.default.apply(this,arguments)}It(Um,"SimulationPromise"),It($a,"gpuLayout"),$a.run=(t,e,s)=>{let i;const n=new Um(r=>{s.onEnd=r,i=$a(t,e,s).start()});return n.simulation=i,n.stop=()=>(i.stop(),n),n};var rP=2,oP=.001,aP=1.25,Vm=t=>1,qm={name:"force",imports:{force:Gm},configure(t,{graph:e,events:s}){const i=t.nodes._indexes,n=e.getNodeAttribute("x").getMultiple(i),r=e.getNodeAttribute("y").getMultiple(i),o=e.getNodeAttribute("radius").getMultiple(i),a=e.getNodeAttribute("layoutable").getMultiple(i),l=t.edges,d=[],h=[],u={},c=t.nodeMass||Vm,g=t.edgeWeight||Vm;t.edgeStrength===void 0&&(t.edgeStrength=.5),t.gpu&&(t.edgeStrength/=rP),t.gravity==null&&(t.gravity=.01),t.siblingsOffset==null&&(t.siblingsOffset=0),t.theta==null&&(t.theta=.62),t.autoStop=!!t.autoStop,t.alignSiblings=!!t.alignSiblings;const f=t.radiusRatio||aP;for(let _=0;_<t.nodes._indexes.length;_++){const p=t.nodes._indexes[_];u[p]=_,d.push({id:_,x:n[_],y:r[_],r:o[_]*f,mass:Math.max(oP,c(t.nodes.get(_))),pinned:!a[_]})}l.forEach(_=>{const p=u[_.getSource()._index],x=u[_.getTarget()._index];p!==x&&p!==void 0&&x!==void 0&&h.push({source:p,target:x,weight:g(_)})});const m=kl({...t});return delete m.nodes,delete m.edges,{graph:{nodes:d,edges:h},options:m,indexes:t.nodes._indexes,done:!1,x:n,y:r,chunkPeriod:250}},update:function(t,e){if(!e.simulation&&t){let s;e.done=!1,e.graph=t.graph,e.options=t.options,e.indexes=t.indexes;let i=!1;if(t.options.gpu){const l=bx("webgl2",{},()=>{Ei("GPU layout: WebGL context not available. Falling back on CPU."),e.simulation=void 0,e.options.gpu=!1,e.cleanUp&&e.cleanUp(),this._update(t,e)});l&&(s=l.context,e.cleanUp=l.cleanUp),i=!!s}let n=Date.now();i||(t.options.nextTick=l=>Date.now()-n<=e.chunkPeriod?l():(n=Date.now(),setTimeout(l,0))),t.options.update=(l,d,h)=>{e.x=d,e.y=h},t.options.onEnd=()=>{if(i&&s){const{X:l,Y:d}=e.simulation.data(!0);e.x=l,e.y=d}e.done=!0,e.simulation=void 0,e.cleanUp&&e.cleanUp()},t.options.bucketSize=0;const r=i&&s?$a(t.graph,s,t.options).start():Gm(t.graph,t.options).start();e.simulation=r;const{X:o,Y:a}=i&&s?{X:new Float32Array(t.graph.nodes.length),Y:new Float32Array(t.graph.nodes.length)}:r.data();e.x=o,e.y=a}return{graph:e.graph,indexes:e.indexes,x:e.x,y:e.y}},context:function(){return{done:!1,graph:{nodes:[],edges:[]},x:null,y:null,indexes:null,chunkPeriod:250}},stop:function(t){t.done=!0,t.simulation&&(t.simulation.stop(),delete t.simulation)},isRunning:function(t){return!t.done||(t.done=!1,!1)},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}};function lP(t,e,s,i=t.getNodes()){if(!e)return s?t.nodeList():i.filter(n=>n.getMetaNode()===null);if(!(e instanceof Pi)){if(Array.isArray(e)&&e.length>0)return t.getNodes(e);throw Error("[Layout]: 'nodes' must be a NodeList or an NodeId[]")}return e}function dP(t,e,s=t.getEdges()){if(!e)return s;if(!(e instanceof Ln)){if(Array.isArray(e)&&e.length>0)return t.getEdges(e);throw Error("[Layout]: 'edges' must be a EdgeList or a valid EdgeId[]")}return e}function hP(t){if(!t.size)return;const e=new Set(t.getId());return t.getAdjacentEdges().filter(s=>s.getExtremities().getId().every(i=>e.has(i)))}function k0(t,e={},s=!0){s||(e.edges=void 0);const i=lP(t,e.nodes,e.edges),n=dP(t,e.edges,hP(i));return{...e,nodes:i.concat(n.getExtremities()).dedupe(),edges:n}}function uP(t,e,s,i,n){return{x:t+n*(s-t),y:e+n*(i-e)}}var cP=10;function gP(t,e,s){let i,n,r=1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o],d=e[(o+1)%a],h=_c(t[0],t[1],l[0],l[1],d[0],d[1]);h<r&&(r=h,i=l,n=d)}return fP(t[0],t[1],i[0],i[1],n[0],n[1],s)}function fP(t,e,s,i,n,r,o){const a=Nx(t,e,s,i,n,r);let l=-(i-r),d=s-n;const h=Math.sqrt(l*l+d*d);return l/=h,d/=h,[a.x-o*l,a.y-o*d]}function mP(t,e,s,i){for(let n=0;n<t.length;n++){const[r,o]=t[n],a=Math.abs(r-e),l=Math.abs(o-s);if(a+l<=i||!(a>i||l>i)&&a*a+l*l<=i*i)return!0}return!1}function _P(t,e,s){const i=Cx(s.cx,s.cy,t,e,s.minX,s.minY,s.maxX,s.maxY);let n,r=1/0,o={x:s.maxX,y:e};for(const a of i)n=Ie(t,e,a.x,a.y),n<r&&(r=n,o=a);return o}function pP(t){const e=t.bottomLeft(),s=t.topRight();return[[e.x,e.y],[e.x,s.y],[s.x,s.y],[s.x,e.y]]}function yP(t,e,s,i){const n=[],r=[],o=[];return t.forEach((a,l)=>{i[l]&&(n.push(a),r.push(e[l]),o.push(s[l]))}),{ids:n,subgraphPositions:r,radii:o}}function xP(t,e,s){const{duration:i=0,margin:n=5,referenceNodes:r,nodes:o}=e,{ids:a,subgraphPositions:l,radii:d}=yP(o.getId(),s,o.getAttribute("radius"),o.getAttribute("layoutable")),h=t.getNodes(a);let u=r;!u||u instanceof Pi||(u=t.getNodes(u));const c=u||h.inverse(),g=c.getPosition().map(S=>[S.x,S.y]),f=h.getBoundingBox(),m=c.getBoundingBox();m.pad(m.maxScaledSize);const _={layoutName:"incremental",ids:h.getId(),positions:{before:l,current:l}};if(!h.size)return Promise.resolve(_);const p=Mo(l.map(S=>S.x),l.map(S=>S.y),d),[x,y]=p,b=p[2]+m.maxScaledSize+n;let v,E=0,A=0;if(mP(g,x,y,b))if(c.size<=3){if($u(x,y,p[2],m.minX,m.minY,m.maxX,m.maxY)){const S=_P(x,y,m);v=Ie(m.cx,m.cy,S.x,S.y);const w=uP(m.cx,m.cy,S.x,S.y,(v+b)/v);E=w.x-x,A=w.y-y}}else{const S=Hu.from(g,V=>V[0],V=>V[1]),w=oo(S.triangles,g),L=g.length>3?oo(S.hull,g):pP(m),T=Ay(c.getPosition(),cP,b,w,L);let F=gP([x,y],L,b);if(T.length>0){let V=Math.pow(x-F[0],2)+Math.pow(y-F[1],2);for(const G of T)E=x-G[0],A=y-G[1],v=E*E+A*A,v<V&&(V=v,F=G.slice(0,2));E=F[0]-x,A=F[1]-y}else E=F[0]-f.cx,A=F[1]-f.cy}if(E||A){const S=l.map(w=>(w.x+=E,w.y+=A,w));if(e.locate){typeof e.locate=="boolean"&&(e.locate={});const w=t.modules.locate.layoutDataBoundingBox({x:[...g.map(T=>T[0]),...S.map(T=>T.x)],y:[...g.map(T=>T[1]),...S.map(T=>T.y)],indexes:t.getNodes()._indexes}),L=t.modules.locate.computeConfigForBounds(w,e.locate);t.modules.camera.setView(L,{duration:i,easing:e.locate.easing,ignoreZoomLimits:!0})}return _.positions.current=S,h.setAttributes(S,i).then(()=>_)}return h.setAttributes(l,i).then(()=>_)}function bP(t,e,s){const i=Ae(e);return i.duration=0,i.dryRun=!0,i.locate=!1,delete i.incremental,s(i).then(n=>xP(t,e,n.positions.current))}function vP(t,e,s){const{nodes:i,duration:n,centralNode:r}=e,o=i,a=o.reduce((d,h)=>(d[h._index]=!0,d),{}),l=t.getNodes();if(e.focusOnGroupShape)return s({nodes:o,duration:0}).then(()=>{const d=o.concat(r),h=d.getAttribute("layoutable");return d.setAttributes({layoutable:!1}),s({nodes:t.getNodes(),duration:n}).then(()=>d.setAttributes(h))});{const d=Ae(e);return delete d.centralNode,d.incremental=!1,d.nodes=l,d.nodeMass=(h,u)=>(u+1)*(a[h._index]?1:2),s(d)}}function z0(t,e,s){const i=k0(e.modules.graph,t);if(typeof i.incremental!="boolean"&&"margin"in i.incremental&&!isFinite(i.incremental.margin))throw new Error("Incremental layout: margin has to be a positive number");const n=Ae(i);return typeof i.incremental!="boolean"&&(n.margin=i.incremental.margin,n.referenceNodes=i.incremental.referenceNodes),n.centralNode&&!n.centralNode.getAttribute("layoutable")?vP(e,n,s):bP(e,n,s)}var EP=t=>(t.modules.layouts.register(qm),(e={})=>{if(e.incremental)return z0(e,t,t.layouts.force);if(e.edgeStrength!==void 0&&(!isFinite(e.edgeStrength)||e.edgeStrength<0))throw new Error("force layout: edgeStrength must be a positive number");if(e.steps!==void 0&&(!isFinite(e.steps)||e.steps<=0))throw new Error("force layout: 'steps' must be a positive integer");if(e.edgeLength!==void 0&&(!isFinite(e.edgeLength)||e.edgeLength<=0))throw new Error("force layout: 'edgeLength' must be positive");if(e.gravity!==void 0&&(!isFinite(e.gravity)||e.gravity<0||e.gravity>=1))throw new Error("force layout: 'gravity' must be between 0 and 1");if(e.charge!==void 0&&!isFinite(e.charge))throw new Error("force layout: 'charge' must be a number");if(e.radiusRatio!==void 0&&(!isFinite(e.radiusRatio)||e.radiusRatio<0))throw new Error("force layout: 'radiusRatio' must be a positive number");if(e.theta!==void 0&&(!isFinite(e.theta)||e.theta<0||e.theta>1))throw new Error("force layout: 'theta' must be between 0 and 1");if(!(e.cx===void 0&&e.cy===void 0||typeof e.cx=="number"&&typeof e.cy=="number"))throw new Error("force layout: both 'cx' and 'cy' must be numbers");if(e.siblingsOffset!==void 0&&!isFinite(e.siblingsOffset))throw new Error("force layout: 'siblingsOffset' must be a number");return e.gpu=!!e.gpu,e.gpu&&(e.useWebWorker=!1),t.modules.layouts.start(qm.name,e)}),jm={name:"forceLink",configure:function(t,{graph:e,camera:s,graphics:i}){const n=t.nodes._indexes,r=t.edges._indexes,o={},a={},l=n.length,d=r.length;let h;var u=e.getObjectList(!0),c=e.getObjectList(!1);(t.nodes||t.edges)&&(delete(t=Ae(t)).nodes,delete t.edges);const g=e.getNodeAttribute("innerStroke.width").getMultiple(n),f=e.getNodeAttribute("outerStroke.width").getMultiple(n),m=e.degrees(n),_=e.getNodeAttribute("x").getMultiple(n),p=e.getNodeAttribute("y").getMultiple(n),x=e.getNodeAttribute("radius").getMultiple(n),y=e.nodeList(n).getAttribute("layoutable"),b=typeof t.nodeMass=="function"?t.nodeMass:function(O,j,W){return j+1};delete t.nodeMass;const v=typeof t.edgeWeight=="function"?t.edgeWeight:function(O){return 1};delete t.edgeWeight,isFinite(t.scalingRatio)||delete t.scalingRatio;const E=n.reduce((O,j,W)=>(y[W]||(O[j]=!0),O),{});let A=0,S=0,w=0;const L=s.getZoom();for(h=0;h<n.length;++h){const O=n[h],j=_[h],W=p[h],et=x[h]+(g[h]+f[h])/L;o[O]={id:O,x:j,y:W,degree:m[h],size:et,pinned:!!E[O],mass:b(u.get(O),m[h],h)},w=Math.max(et,w)}if(l>1)for(h=0;h<l;h++){const O=o[n[h]];A+=O.x,S+=O.y}A/=l,S/=l;const T={x:A,y:S},F=e.edgeList(r),V=F.getSource()._indexes,G=F.getTarget()._indexes;for(h=0;h<d;h++){const O=r[h],j=V[h],W=G[h];o[j]&&o[W]&&(a[O]={source:j,target:W},a[O].weight=v(c.get(O)))}return{nodes:o,edges:a,maxSize:w,config:kl(t),barycentre:T}},context:function(){return{chunkPeriod:250}},update:function(t,e){let s;!e.W&&t?(s={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:!0,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!0,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}},e.W=s,function(d,h){const u=function(g,f){let m,_,p,x=g.nodes,y=g.edges,b=g.maxSize,v=Object.keys(g.nodes),E=Object.keys(g.edges),A=v.length*s.ppn,S=E.length*s.ppe,w={};const L=Math.pow(10,Math.log(Math.max(b,1))-6),T=L/2,F=Math.random,V=f.randomizeFactor||1;let G;G=f.randomize==="locally"?W=>W+F()*V:f.randomize==="globally"?W=>F()*V:W=>W+F()*L-T;const O=new Float32Array(A),j=new Float32Array(S);for(m=_=0,p=v.length;m<p;m++){const W=v[m],et=x[W];let at=et.x,mt=et.y;et.pinned||(at=G(at),mt=G(mt)),w[W]=_,O[_]=at,O[_+1]=mt,O[_+2]=0,O[_+3]=0,O[_+4]=0,O[_+5]=0,O[_+6]=et.mass,O[_+7]=1,O[_+8]=et.size,O[_+9]=et.pinned||0,_+=s.ppn}for(m=_=0,p=E.length;m<p;m++){const W=y[E[m]];j[_]=w[W.source],j[_+1]=w[W.target],j[_+2]=W.weight||0,_+=s.ppe}return{nodes:O,edges:j}}(d,h);e.NodeMatrix=u.nodes,e.EdgeMatrix=u.edges,s.nodesLength=e.NodeMatrix.length,s.edgesLength=e.EdgeMatrix.length}(t,t.config),s.settings=function(d,h){for(const u in d)h[u]=d[u];return h}(t.config,s.settings),e.nodes=t.nodes,e.edges=t.edges,e.barycentre=t.barycentre):s=e.W;let i,n=e.NodeMatrix,r=e.EdgeMatrix;function o(){let l,d,h,u,c,g,f,m,_,p,x,y,b,v,E,A,S;for(h=0;h<s.nodesLength;h+=s.ppn)n[h+4]=n[h+2],n[h+5]=n[h+3],n[h+2]=0,n[h+3]=0;if(s.settings.outboundAttractionDistribution){for(_=0,h=0;h<s.nodesLength;h+=s.ppn)_+=n[h+6];_/=s.nodesLength}if(s.settings.barnesHutOptimize){let G,O,j,W,et=1/0,at=-1/0,mt=1/0,vt=-1/0;for(i=[],h=0;h<s.nodesLength;h+=s.ppn)et=Math.min(et,n[h+0]),at=Math.max(at,n[h+0]),mt=Math.min(mt,n[h+1]),vt=Math.max(vt,n[h+1]);const wt=at-et,Et=vt-mt;for(wt>Et?(mt-=(wt-Et)/2,vt=mt+wt):(et-=(Et-wt)/2,at=et+Et),i[0]=-1,i[1]=(et+at)/2,i[2]=(mt+vt)/2,i[3]=Math.max(at-et,vt-mt),i[4]=-1,i[5]=-1,i[6]=0,i[7]=0,i[8]=0,l=1,h=0;h<s.nodesLength;h+=s.ppn)for(d=0,j=s.MAX_SUBDIVISION_RETRIES;;){if(!(i[d+5]>=0)){if(i[d+0]<0){i[d+0]=h;break}if(i[d+5]=l*s.ppr,f=i[d+3]/2,m=i[d+5],i[m+0]=-1,i[m+1]=i[d+1]-f,i[m+2]=i[d+2]-f,i[m+3]=f,i[m+4]=m+s.ppr,i[m+5]=-1,i[m+6]=0,i[m+7]=0,i[m+8]=0,m+=s.ppr,i[m+0]=-1,i[m+1]=i[d+1]-f,i[m+2]=i[d+2]+f,i[m+3]=f,i[m+4]=m+s.ppr,i[m+5]=-1,i[m+6]=0,i[m+7]=0,i[m+8]=0,m+=s.ppr,i[m+0]=-1,i[m+1]=i[d+1]+f,i[m+2]=i[d+2]-f,i[m+3]=f,i[m+4]=m+s.ppr,i[m+5]=-1,i[m+6]=0,i[m+7]=0,i[m+8]=0,m+=s.ppr,i[m+0]=-1,i[m+1]=i[d+1]+f,i[m+2]=i[d+2]+f,i[m+3]=f,i[m+4]=i[d+4],i[m+5]=-1,i[m+6]=0,i[m+7]=0,i[m+8]=0,l+=4,W=d+0,G=n[i[W]+0]<i[d+1]?n[i[W]+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[i[W]+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,i[d+6]=n[i[W]+6],i[d+7]=n[i[W]+0],i[d+8]=n[i[W]+1],i[G+0]=i[d+0],i[d+0]=-1,O=n[h+0]<i[d+1]?n[h+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[h+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,G===O){if(j--){d=G;continue}j=s.MAX_SUBDIVISION_RETRIES;break}i[O+0]=h;break}G=n[h+0]<i[d+1]?n[h+1]<i[d+2]?i[d+5]:i[d+5]+s.ppr:n[h+1]<i[d+2]?i[d+5]+2*s.ppr:i[d+5]+3*s.ppr,i[d+7]=(i[d+7]*i[d+6]+n[h+0]*n[h+6])/(i[d+6]+n[h+6]),i[d+8]=(i[d+8]*i[d+6]+n[h+1]*n[h+6])/(i[d+6]+n[h+6]),i[d+6]+=n[h+6],d=G}}if(s.settings.barnesHutOptimize)for(p=s.settings.scalingRatio,h=0;h<s.nodesLength;h+=s.ppn)for(d=0;;)if(i[d+5]>=0){if(A=Math.sqrt((n[h+0]-i[d+7])*(n[h+0]-i[d+7])+(n[h+1]-i[d+8])*(n[h+1]-i[d+8])),2*i[d+3]/A<s.settings.barnesHutTheta){if(x=n[h+0]-i[d+7],y=n[h+1]-i[d+8],s.settings.adjustSizes?A>0?(S=p*n[h+6]*i[d+6]/A/A,n[h+2]+=x*S,n[h+3]+=y*S):A<0&&(S=-p*n[h+6]*i[d+6]/A,n[h+2]+=x*S,n[h+3]+=y*S):A>0&&(S=p*n[h+6]*i[d+6]/A/A,n[h+2]+=x*S,n[h+3]+=y*S),i[d+4]<0)break;d=i[d+4];continue}d=i[d+5]}else{if(i[d+0]>=0&&i[d+0]!==h&&(x=n[h+0]-n[i[d+0]+0],y=n[h+1]-n[i[d+0]+1],A=Math.sqrt(x*x+y*y),s.settings.adjustSizes?A>0?(S=p*n[h+6]*n[i[d+0]+6]/A/A,n[h+2]+=x*S,n[h+3]+=y*S):A<0&&(S=-p*n[h+6]*n[i[d+0]+6]/A,n[h+2]+=x*S,n[h+3]+=y*S):A>0&&(S=p*n[h+6]*n[i[d+0]+6]/A/A,n[h+2]+=x*S,n[h+3]+=y*S)),i[d+4]<0)break;d=i[d+4]}else for(p=s.settings.scalingRatio,u=0;u<s.nodesLength;u+=s.ppn)for(c=0;c<u;c+=s.ppn)x=n[u+0]-n[c+0],y=n[u+1]-n[c+1],s.settings.adjustSizes?(A=Math.sqrt(x*x+y*y)-n[u+8]-n[c+8],A>0?(S=p*n[u+6]*n[c+6]/A/A,n[u+2]+=x*S,n[u+3]+=y*S,n[c+2]+=x*S,n[c+3]+=y*S):A<0&&(S=100*p*n[u+6]*n[c+6],n[u+2]+=x*S,n[u+3]+=y*S,n[c+2]-=x*S,n[c+3]-=y*S)):(A=Math.sqrt(x*x+y*y),A>0&&(S=p*n[u+6]*n[c+6]/A/A,n[u+2]+=x*S,n[u+3]+=y*S,n[c+2]-=x*S,n[c+3]-=y*S));for(m=s.settings.gravity/s.settings.scalingRatio,p=s.settings.scalingRatio,h=0;h<s.nodesLength;h+=s.ppn)S=0,x=n[h+0],y=n[h+1],A=Math.sqrt(x*x+y*y),s.settings.strongGravityMode?A>0&&(S=p*n[h+6]*m):A>0&&(S=p*n[h+6]*m/A),n[h+2]-=x*S,n[h+3]-=y*S;for(p=1*(s.settings.outboundAttractionDistribution?_:1),g=0;g<s.edgesLength;g+=s.ppe)u=r[g+0],c=r[g+1],f=r[g+2],E=Math.pow(f,s.settings.edgeWeightInfluence),x=n[u+0]-n[c+0],y=n[u+1]-n[c+1],s.settings.adjustSizes?(A=Math.sqrt(x*x+y*y)-n[u+8]-n[c+8],s.settings.linLogMode?s.settings.outboundAttractionDistribution?A>0&&(S=-p*E*Math.log(1+A)/A/n[u+6]):A>0&&(S=-p*E*Math.log(1+A)/A):s.settings.outboundAttractionDistribution?A>0&&(S=-p*E/n[u+6]):A>0&&(S=-p*E)):(A=Math.sqrt(x*x+y*y),s.settings.linLogMode?s.settings.outboundAttractionDistribution?A>0&&(S=-p*E*Math.log(1+A)/A/n[u+6]):A>0&&(S=-p*E*Math.log(1+A)/A):s.settings.outboundAttractionDistribution?(A=1,S=-p*E/n[u+6]):(A=1,S=-p*E)),A>0&&(n[u+2]+=x*S,n[u+3]+=y*S,n[c+2]-=x*S,n[c+3]-=y*S);let w,L,T,F,V=0;if(s.settings.adjustSizes)for(h=0;h<s.nodesLength;h+=s.ppn)n[h+9]||(w=Math.sqrt(n[h+2]*n[h+2]+n[h+3]*n[h+3]),w>s.maxForce&&(n[h+2]=n[h+2]*s.maxForce/w,n[h+3]=n[h+3]*s.maxForce/w),L=n[h+6]*Math.sqrt((n[h+4]-n[h+2])*(n[h+4]-n[h+2])+(n[h+5]-n[h+3])*(n[h+5]-n[h+3])),T=Math.sqrt((n[h+4]+n[h+2])*(n[h+4]+n[h+2])+(n[h+5]+n[h+3])*(n[h+5]+n[h+3]))/2,F=.1*Math.log(1+T)/(1+Math.sqrt(L)),b=n[h+0],v=n[h+1],n[h+0]=n[h+0]+n[h+2]*(F/s.settings.slowDown),n[h+1]=n[h+1]+n[h+3]*(F/s.settings.slowDown),x=n[h+0],y=n[h+1],A=Math.sqrt((x-b)*(x-b)+(y-v)*(y-v)),V+=A);else for(h=0;h<s.nodesLength;h+=s.ppn)n[h+9]||(L=n[h+6]*Math.sqrt((n[h+4]-n[h+2])*(n[h+4]-n[h+2])+(n[h+5]-n[h+3])*(n[h+5]-n[h+3])),T=Math.sqrt((n[h+4]+n[h+2])*(n[h+4]+n[h+2])+(n[h+5]+n[h+3])*(n[h+5]+n[h+3]))/2,F=n[h+7]*Math.log(1+T)/(1+Math.sqrt(L)),n[h+7]=Math.min(1,Math.sqrt(F*(n[h+2]*n[h+2]+n[h+3]*n[h+3])/(1+Math.sqrt(L)))),b=n[h+0],v=n[h+1],n[h+0]=n[h+0]+n[h+2]*(F/s.settings.slowDown),n[h+1]=n[h+1]+n[h+3]*(F/s.settings.slowDown),x=n[h+0],y=n[h+1],A=Math.sqrt((x-b)*(x-b)+(y-v)*(y-v)),V+=A);if(s.iterations++,s.settings.autoStop&&(s.converged=s.iterations>s.settings.maxIterations||V/s.nodesLength<s.settings.avgDistanceThreshold,s.converged&&s.settings.alignNodeSiblings)){let G,O,j={},W={};for(g=0;g<s.edgesLength;g+=s.ppe)u=r[g+0],c=r[g+1],u!==c&&(j[u]=j[u]||{},j[c]=j[c]||{},j[u][c]=!0,j[c][u]=!0);Object.keys(j).forEach(ot=>{var rt=~~ot;O=Object.keys(j[rt]),O.length==2&&(G=O[0]+";"+O[1],G in W||(G=O[1]+";"+O[0],W[G]||(W[G]=[~~O[1],~~O[0]])),W[G].push(rt))});let et,at,mt,vt,wt,Et,yt,St,zt,Zt,Kt,X,Q,gt,lt,st=s.settings.nodeSiblingsAngleMin;Object.keys(W).forEach(ot=>{if(at=W[ot].shift(),mt=W[ot].shift(),et=W[ot].filter(Rt=>!n[Rt+9]),et.length==1)return;if(Et=n[at+0],yt=n[at+1],St=n[mt+0],zt=n[mt+1],vt=Object.keys(j[at]).length,wt=Object.keys(j[mt]).length,Zt=function(Pt,Vt,jt,Xt,Ft){return(Ft-Xt)*(Pt-Vt)/(jt-Vt)+Xt}(vt/(vt+wt),0,1,1/4,3/4),X=function(Pt,Vt,jt,Xt,Ft){return{x:Pt+(jt-Pt)*Ft,y:Vt+(Xt-Vt)*Ft}}(Et,yt,St,zt,Zt),Q=function(Pt,Vt,jt,Xt){return{xi:-(Xt-Vt),yi:jt-Pt,xiPrime:Xt-Vt,yiPrime:-(jt-Pt)}}(Et,yt,St,zt),Kt=function(Pt,Vt,jt,Xt){const Ft=jt-Pt,oe=Xt-Vt;return Math.sqrt(Ft*Ft+oe*oe)}(Et,yt,St,zt),gt=function(Pt,Vt){return{x:(Pt.xiPrime-Pt.xi)/Vt,y:(Pt.yiPrime-Pt.yi)/Vt}}(Q,Kt),lt=function(Pt){return Math.acos(Pt.x/Math.sqrt(Pt.x*Pt.x+Pt.y*Pt.y))}(gt),2*st>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");st>0&&(lt<st||lt>Math.PI-st&&lt<=Math.PI?gt={x:2*Math.cos(Math.PI-st),y:2*Math.sin(Math.PI-st)}:(lt>2*Math.PI-st||lt>=Math.PI&&lt<Math.PI+st)&&(gt={x:2*Math.cos(st),y:2*Math.sin(st)}));let rt=0,ft=1,Nt=1;et.length%2==1&&(Nt=0,rt=1);for(let Rt=0;Rt<et.length;Rt++)n[et[Rt]+0]=X.x+ft*gt.x*Nt*(rt||Rt>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),n[et[Rt]+1]=X.y+ft*gt.y*Nt*(rt||Rt>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),ft=-ft,Nt+=(Rt+rt)%2})}}function a(l){const d=Object.keys(l),h={};for(let u=0;u<n.length;u+=s.ppn){const c=d[u/s.ppn];h[c]={id:c,x:n[u+0],y:n[u+1],pinned:n[u+9]}}return h}return function(){if(s.settings.autoStop){const d=Date.now();for(;!(s.converged||Date.now()-d>=e.chunkPeriod);)o()}else{const d=s.iterations===0?s.settings.startingIterations:s.iterations+s.settings.iterationsPerRender;for(;s.iterations!==d;)o()}return{nodes:a(e.nodes),barycentre:e.barycentre}}()},isRunning:function(t){return!t.W.settings.autoStop||!t.W.converged||(t.W=void 0,!1)},stop:function(t){t.W&&(t.W.converged=!0)},onSync:function({nodes:t,barycentre:e},{graph:s}){const i=Object.keys(t),n=i.length;let r,o,a,l,d,h,u,c,g=0,f=0;const m=new Array(n),_=new Array(n),p=new Array(n),x=new Array(n),[y,b]=s.getAttributes(!0,["x","y"]);for(r=0;r<n;r++)o=i[r],a=t[o],c=parseInt(o),m[r]=c,x[r]=a.pinned,a.pinned?(l=y.get(c),d=b.get(c)):(l=a.x,d=a.y),_[r]=l,p[r]=d,g+=l,f+=d;for(h=g/n-e.x,u=f/n-e.y,r=0;r<n;r++)x[r]||(_[r]-=h,p[r]-=u);return{indexes:m,x:_,y:p}}},AP=t=>(t.modules.layouts.register(jm),(e={})=>e.incremental?z0(e,t,t.layouts.forceLink):t.modules.layouts.start(jm.name,e)),Hm={name:"grid",configure:function(t,{graph:e,camera:s}){function i(v){return v===void 0||typeof v=="number"&&isFinite(v)&&v>0}const n=t.sortBy,r=t,o=r.nodes,a=Array.from(o._indexes),l=a.length,{rows:d,cols:h,rowDistance:u,colDistance:c}=function(E,A,S,w,L){if(!i(A))throw new TypeError('"rows" should be a positive integer');if(!i(S))throw new TypeError('"cols" should be a positive integer');if(!i(w))throw new TypeError('"rowDistance" should be a positive number');if(!i(L))throw new TypeError('"colDistance" should be a positive number');if(A)return{rows:A,cols:Math.ceil(E/A),rowDistance:w,colDistance:L};if(S)return{cols:S,rows:Math.ceil(E/S),rowDistance:w,colDistance:L};const T=Math.ceil(Math.sqrt(E));return{cols:T,rows:Math.ceil(E/T),rowDistance:w,colDistance:L}}(l,r.rows,r.cols,r.colDistance,r.rowDistance),g=function(E,A,S,w,L){return typeof E!="string"?w.map((T,F)=>F):E==="radius"?A.getAttribute(!0,"radius").getMultiple(w):E==="degree"?S.getDegree():E==="random"?w.map(()=>Math.random()):S.getData(E).map(T=>T||L)}(n,e,o,a,t.sortFallbackValue),f=o.getAttribute("layoutable"),m=a.reduce((v,E,A)=>(f[A]&&v.push({id:E,attr:g[A]}),v),[]),_=o.getAttribute("x"),p=o.getAttribute("y"),x=o.getAttribute("radius");let y=1/0,b=1/0;for(let v=0;v<a.length;v++)y=Math.min(y,_[v]),b=Math.min(b,p[v]);return{sort:!!n,nodes:m,reverse:!!r.reverse,cols:h,rows:d,minX:y,minY:b,rs:x,rowDistance:u,colDistance:c}},update:function({sort:t,nodes:e,minX:s,rs:i,minY:n,reverse:r,cols:o,rowDistance:a,colDistance:l}){const d=e.map((p,x)=>x);t&&d.sort((p,x)=>e[p].attr-e[x].attr),r&&d.reverse();let h=0;for(let p=0;p<e.length;p++){const x=p>0&&(p+1)%o==0,y=p%o==0,b=x?0:i[d[p+1]]||0,v=y?0:i[d[p+o-1]]||0,E=i[d[p+o]]||0,A=x?0:i[d[p+o+1]]||0,S=i[d[p]]||0;h=Math.max(h,S+b,S+v,S+E,S+A)}let u=h+1,c=h+1;const g=s,f=n;isFinite(u)||(u=0),isFinite(c)||(c=0),a!==void 0&&isFinite(a)&&(u=h+a),l!==void 0&&isFinite(l)&&(c=h+l);let m=0,_=0;return d.forEach(p=>{const x=e[p];x.x=g+m*u,x.y=f+_*c,m+=1,m===o&&(_+=1,m=0)}),e},onSync:function(t){return{indexes:t.map(({id:e})=>e),x:t.map(({x:e})=>e),y:t.map(({y:e})=>e)}}},SP=t=>(t.modules.layouts.register(Hm),(e={})=>t.modules.layouts.start(Hm.name,e));function wP(t){let e=0,s=0;for(const o of t)e+=o.w*o.h,s=Math.max(s,o.w);t.sort((o,a)=>a.h-o.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let n=0,r=0;for(const o of t)for(let a=i.length-1;a>=0;a--){const l=i[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,r=Math.max(r,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===l.w&&o.h===l.h){const d=i.pop();a<i.length&&(i[a]=d)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(i.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:n,h:r,fill:e/(n*r)||0}}var TP={down:()=>{},up:t=>t.y=-t.y,left:t=>{const e=t.x;t.x=-t.y,t.y=e},right:t=>{const e=t.x;t.x=t.y,t.y=-e}},jd=(t,e)=>isFinite(t)&&t>0?t:e;function IP(t){return{nodesSeparation:jd(t.nodesSeparation,0),componentsSeparation:jd(t.componentsSeparation,25),layerSeparation:jd(t.layerSeparation,50)}}function CP(t,{componentsSeparation:e,packing:s}){const i=[];for(let n=0;n<t.length;n++){const r=t[n],o=r.nodes;if(r.isFake&&r.w!==void 0&&r.h!==void 0){i.push({w:r.w,h:r.h,x:void 0,y:void 0,dag:r});continue}if(r.nodes.length===1){const c=2*o[0].data.radius;i.push({w:c+e/2,h:c+e/2,x:void 0,y:void 0,dag:r});continue}const{minX:a,maxX:l,minY:d,maxY:h}=o.reduce((c,{x:g,y:f,data:m})=>{const _=m.radius||0;return c.minX=Math.min(c.minX,g-_),c.maxX=Math.max(c.maxX,g+_),c.minY=Math.min(c.minY,f-_),c.maxY=Math.max(c.maxY,f+_),c},{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),u=(l+a)/2;o.forEach(c=>{c.x-=u}),i.push({w:Math.abs(l-a)+e/2,h:Math.abs(h-d)+e/2,minX:a,x:void 0,y:void 0,dag:r})}if(s!=="singleline")wP(i);else{let n=0;for(let r=0;r<i.length;r++){const o=i[r];o.x=n,o.y=0,n+=o.w}}return i}function LP(t,e={}){const{componentsSeparation:s}=IP(e);e.direction===void 0&&(e.direction="down");const i=CP(t,{componentsSeparation:s,packing:e.packing});for(let n=0;n<i.length;n++){const{x:r=0,y:o=0,dag:a}=i[n];for(const l of a.nodes)l.x+=r,l.y+=o,TP[e.direction](l)}}var Gc={id:"__SENTINEL__",layer:-1,sink:!1,fixed:!1,siblingIndex:-1,parentIds:[],children:[],radius:0,ref:null},Xr=t=>t.data===Gc||!1,lu=t=>!Xr(t),NP=[],MP=(t,e)=>({id:t,layer:e,data:Gc,children:NP,ref:void 0,x:0,y:0}),PP=(t,e)=>({id:t,layer:-1,data:e,children:[],x:0,y:0}),Wm=class{constructor(t,e,s){this.data=t,this.prev=e,this.next=s}toString(){return this.data}},B0=t=>t.reduce((e,s)=>(e[s]=!0,e),{});function RP(t,e){const s=[t],i=B0(s),n=[t];for(;s.length;){const r=s.shift();for(const o of e.get(r))i[o]||(i[o]=!0,n.push(o),s.push(o))}return n}function Vc(t){return t.reduce((e,{source:s,target:i})=>(e.set(s,e.get(s)||[]),e.set(i,e.get(i)||[]),e.get(s).push(i),e.get(i).push(s),e),new Map)}function FP(t){return t.reduce((e,{source:s,target:i})=>(e[s]=e[s]||[],e[s].push(i),e),{})}function DP(t,e,s){const i=s||Vc(e||[]);return t.filter(({id:n})=>!i.has(n))}function OP(t,e){const s=B0(e);return t.filter(i=>!(i in s))}function Ls(t,e){t.forEach((s,i)=>{s.forEach((n,r,o)=>{e(n,r,o,i)})})}var Xm=t=>{let e=Math.floor(t.length/2);return(t=[...t].sort((s,i)=>s-i)).length%2!=0?t[e]:(t[e-1]+t[e])/2};function kP(t,e,s){const i=Vc(e);let n=Array.from(i.keys());const r=[];for(;n.length;){const o=RP(n[0],i);r.push(o),n=OP(n,o)}return s.skipSingletons?r:r.concat(DP(t,e,i).map(({id:o})=>[o]))}var zP=t=>t.reduce((e,{radius:s})=>Math.max(e,2*s),0);function BP(t,e){return{nodes:t.map(s=>({...s,data:s})),isFake:!0,...e}}function UP(t,e,s){const i=Vc(e||[]),n=t.filter(({id:g})=>!i.has(g)).sort((g,f)=>f.radius-g.radius),r=Math.sqrt(n.length);let o=Math.floor(r),a=Math.ceil(r);o*a<n.length&&(o<a?o++:a++);const l=Math.max(1,zP(n)),d=Math.max(s.nodesGridSeparation||0,1),h=l*a+d*(a-1),u=l*o+d*Math.max(o-1,0),c=BP(n,{w:h,h:u});return c.nodes.forEach((g,f)=>{const m=f%a,_=Math.floor(f/a);g.x=h*m/a,g.y=u*_/o}),c}function Ym(t,e,s){const i=e.reduce((o,a)=>(o.set(a.source,o.get(a.source)||[]),o.get(a.source).push(a),o),new Map),{result:n}=t.reduce(function o(a,l){const{visited:d,stack:h,result:u}=a;if(d.has(l.id))return a;h.add(l.id),d.add(l.id);const c=i.get(l.id)||[];for(const g of c)h.has(g.target)?u.push(g):o(a,s.get(g.target));return h.delete(l.id),a},{visited:new Set,stack:new Set,result:[]}),r=n.reduce((o,{source:a,target:l})=>(o.set(a,o.get(a)||new Set),o.get(a).add(l),o),new Map);return e.map(o=>{const{source:a,target:l,id:d}=o;return r.has(a)&&r.get(a).has(l)?{id:d,source:l,target:a}:o})}function GP(t){if(!t||!t.length)throw Error("Cannot stratify empty data");for(const n of t){if(!n)throw Error('Node data is "null"');if(n.id==null)throw Error('Node id contains a "null" value')}const e=t.map(n=>PP(n.id,n)),s=e.reduce((n,r)=>{if(n[r.id])throw Error(`The connected component contains id duplicates: ${r.id}`);return n[r.id]=r,n},{}),i=[];for(let n=0;n<e.length;n++){const r=e[n];for(let o=0;o<r.data.parentIds.length;o++){const a=r.data.parentIds[o],l=s[a];if(!l)throw Error(`The node ${r.id} has a missing parent id ${a}`);l.children.push(r)}r.data.parentIds.length||i.push(r)}return{isFake:!1,nodes:VP(i)}}function VP(t){const e={},s=[];for(;t.length;){const i=t.pop();e[i.id]||(s.push(i),e[i.id]=!0,t.push(...i.children))}return s}var qP=class{constructor(){this.byId={},this.byIndex={},this.length=0}append(t,e){let s;return this.head?(s=new Wm(t,this.tail),this.tail=this.tail.next=s):(s=new Wm(t),this.tail=this.head=s),this.byId[e]=s,this.byIndex[this.length++]=s,s}find(t){let e=this.head;do{if(e.data===t)return e;e=e.next}while(e)}forEach(t){let e=this.head,s=0;do t(e,s),s++;while(e=e.next)}},Ns=-1,Me=1e-5,Hd=[],jP=class{constructor(t,e,s){this.edges=[],this.nodeMap={},this.nodeIndexTopDown={},this.nodeToLayer={},this.longEdges={},this.virt={},this.height={},this.breadth={},this.first=[],this.totalW={},this.mDist={},this.X={},this.block={},this.nodeList=new qP,this.nodeDistance=e,this.layerDistance=s,this.layers=t;const{breadth:i,virt:n,height:r,nodeToLayer:o,nodeIndexTopDown:a,nodeMap:l,longEdges:d,edges:h}=this;let u=0;Ls(this.layers,(m,_,p,x)=>{if(a[m.id]=u++,l[m.id]=m,o[m.id]=x,this.nodeList.append(m,m.id),m.children.forEach(b=>{const v=Xr(b)||Xr(m);h.push({source:m.id,target:b.id,virtual:v,id:h.length})}),d[m.id])return;const y=[m.id];if(d[m.id]=y,!lu(m))for(let b=0;b<m.children.length;b++){const v=m.children[b];if(lu(v))continue;let E=v;for(;Xr(E);)y.push(E.id),d[E.id]=y,E=E.children[0]}});const c=this.adjacencyList=FP(h);this.N=t.reduce((m,_)=>m+_.length,0),this.Y=new Float32Array(t.length),this.first=t.map(m=>m[0]),t.forEach((m,_)=>r[_]=0),Ls(this.layers,(m,_,p,x)=>{const y=c[m.id]?c[m.id].length:0;n[m.id]=Xr(m)&&y===1,this.nodeToLayer[m.id]=x,n[m.id]?i[m.id]=0:(i[m.id]=2*m.data.radius,r[x]=Math.max(r[x]||0,2*m.data.radius))});const g={},f={};h.forEach(m=>{const _=m.source,p=m.target;g[p]=g[p]||[],g[p].push(_),f[_]=f[_]||[],f[_].push(p)}),Object.values(g).forEach(m=>{m.sort((_,p)=>this.nodeIndexTopDown[_]-this.nodeIndexTopDown[p])}),Object.values(f).forEach(m=>{m.sort((_,p)=>this.nodeIndexTopDown[_]-this.nodeIndexTopDown[p])}),this.neighbours={prev:g,next:f}}computeMinNodeDistances(){const{layers:t,totalW:e}=this;Ls(t,s=>{e[s.id]=0}),Ls(t,s=>e[s.data.id]=0),this.layers.forEach(s=>{e[s[0].id]=0,s.slice(1).forEach((i,n)=>{const r=s[n],o=i.id;e[o]=e[r.id]+r.data.radius+i.data.radius+this.nodeDistance})})}decrossVirtualEdges(){this.layers.forEach(t=>{let e=-1;t.forEach(s=>{if(!this.virt[s.id])return;const i=this.neighbours.next[s.id][0];if(this.virt[i])if(e!==-1&&e>this.nodeIndexTopDown[i]){const n=this.longEdges[s.id];let r=0;for(r=0;r<n.length&&n[r]!==i;r++);const o=n.slice(r);o.forEach(l=>this.longEdges[l]=o);const a=n.slice(0,r);a.forEach(l=>this.longEdges[l]=a)}else e=this.nodeIndexTopDown[i]})})}placeLongEdges(){const{X:t,layers:e}=this;Ls(e,s=>t[s.id]=0);for(let s=1;s>=-1;s-=2){const i={};let n=0;const r={};Ls(e,d=>r[d.id]=0),r[Gc.id]=0;const o=s;e.forEach(d=>{let h=o===1?d[0]:d[d.length-1];r[h.id]||(this.longEdges[h.id].forEach(g=>{r[g]=n}),n++);let u=o===1?0:d.length-1,c=u+o;for(;c>=0&&c<d.length;)h=d[c],r[h.id]||this.longEdges[h.id].forEach(g=>{r[g]=r[d[u].id]}),u=c,c+=o});const a={};e.forEach(d=>{for(let h=o===1?0:d.length-1;o===1?h<d.length:h>=0;h+=o){const u=d[h],c=r[u.id];a[c]=a[c]||[],a[c].push(u.id)}});const l={};this.nodeList.forEach(d=>l[d.data.id]=0);for(let d=0;d<n;d++){const h={done:!1,dist:0},u=a[d];for(let c=0;c<u.length;c++){const g=u[c];this.sortLongEdges(g,s,l,h,r,i)}if(!h.done){const c=this.layers[this.nodeToLayer[a[d][0]]],g=[];c.forEach(f=>{for(const m of this.neighbours.prev[f.id]||Hd){const _=Math.abs(l[m]-l[f.id]);g.push(_)}}),g.length!==0&&(h.dist=Xm(g))}for(let c=0;c<u.length;c++)l[u[c]]-=s*h.dist}Ls(e,d=>t[d.id]+=l[d.id]/2)}}sortLongEdges(t,e,s,i,n,r){if(r[t])return!1;let o=!1,a=0;const{nodeToLayer:l,totalW:d}=this,h=this.longEdges[t];h.forEach(u=>r[u]=!0),h.forEach(u=>{const c=this.nodeList.byIndex[this.nodeIndexTopDown[u]-e];if(!c)return;const g=c.data.id,f=u,m=l[g]===l[f],_=n[g]===n[f];!m||!_||(this.sortLongEdges(g,e,s,i,n,r),(!o||e*(a-s[g])<e*(d[f]-d[g]))&&(o=!0,a=s[g]+d[f]-d[g]))}),h.forEach(u=>{s[u]=a;const c=this.nodeList.byId[u],g=e===1?c.next:c.prev;if(!g)return;const f=g.data.id,m=u,_=l[f]===l[m],p=n[f]!==n[m],x=e*(d[f]-d[m]-s[f]+s[m]);_&&p&&(!i.done||x>i.dist)&&(i.dist=x,i.done=!0)})}placeNonVirtualNodes(){const t={};Ls(this.layers,l=>t[l.id]=-1);const{X:e,totalW:s,virt:i,nodeIndexTopDown:n,mDist:r,nodeList:o}=this,a={};Ls(this.layers,(l,d,h,u)=>{if(!i[l.id])return void(a[l.id]=!1);let c=this.nodeList.byId[l.id].next;for(;c&&this.nodeToLayer[c.data.id]===u&&!i[c.data.id];)c=c.next;a[l.id]=this.nodeToLayer[c.data.id]===u&&e[c.data.id]-e[l.id]<s[c.data.id]-s[l.id]+Me}),Ls(this.layers,({id:l})=>{a[l]&&t[l]===-1&&this.longEdges[l].forEach(d=>{d!==l&&(t[d]=n[d]<n[l]?1:0)})}),Ls(this.layers,({id:l})=>r[l]=s[l]);for(let l=0;l<2;l++)for(let d=l?this.layers.length-1:0;d>=0&&d<this.layers.length;l?d--:d++){let h=Ns;const u=this.layers[d];if(u.forEach(({id:c},g,f)=>{if(i[c]){if(h===Ns){this.placeSequence(Ns,c,f[0].id,o.byId[c].prev.data.id,l);for(let m=0;m<g;m++){const _=f[m].id;r[_]=r[c]-e[c]+e[_]}}else if(t[h]!==1-l){a[h]||this.placeSequence(h,c,o.byId[h].next.data.id,o.byId[c].prev.data.id,l);const m=l===1?this.neighbours.prev:this.neighbours.next,_=m[h][0],p=m[c][0];if(i[_]&&i[p])for(let x=n[_]+1;x<n[p];x++)t[o.byIndex[x].data.id]=l}h=c}}),h===Ns)this.placeSequence(Ns,Ns,u[0].id,u[u.length-1].id,l),u.forEach(({id:c})=>r[c]=e[c]);else{this.placeSequence(h,Ns,o.byId[h].next.data.id,u[u.length-1].id,l);for(let c=u.length-1;c>=0;c--){const g=u[c].id;if(g===h)break;r[g]=r[h]-e[h]+e[g]}}}}placeSequence(t,e,s,i,n,r=0){const o=this.nodeIndexTopDown[s],a=this.nodeIndexTopDown[i],{X:l,nodeIndexTopDown:d,mDist:h}=this;if(o===a)l[s]=this.placeNode(s,t,e,l[s],n);else if(o<a){const u=Math.floor((d[s]+d[i])/2),c=this.nodeList.byIndex[u],g=c.next.data.id,f=h[g]-h[c.data.id];this.placeSequence(t,e,s,c.data.id,n,r+1),this.placeSequence(t,e,g,i,n,r+1),this.combineSequences(t,e,s,i,g,c.data.id,n,f)}}calculateBends(t,e,s,i,n,r,o,a){let l=0;const d=[],{X:h,mDist:u,neighbours:c}=this,g=this.nodeIndexTopDown[s],f=this.nodeIndexTopDown[i];for(let m=this.nodeList.byId[r],_=this.nodeIndexTopDown[m.data.id];_>=g&&_<=f&&m;m=t===-1?m.prev:m.next,_=m&&this.nodeIndexTopDown[m.data.id]){const p=m.data.id,x=(e===0?c.prev[p]:c.next[p])||Hd;let y=0;for(let v=0;v<x.length;v++){const E=x[v];if(t*(h[E]-h[p])<Me)y++;else{y--;const A=h[E]+u[r]-u[p];t*(h[r]-A)>-1e-5?l++:(a===Ns||t*(A-h[a]+u[a]-u[r])<Me)&&t*(A-h[n])<o-Me&&d.push({value:2,key:A})}}const b=h[p]+u[r]-u[p];t*(h[r]-b)>-1e-5?l+=y:(a===Ns||t*(b-h[a]+u[a]-u[r])<Me)&&t*(b-h[n])<o-Me&&d.push({value:y,key:b})}return a!==Ns&&d.push({value:this.edges.length,key:h[a]-u[a]+u[r]}),d.sort(({key:m},{key:_})=>m-_),{res:l,bends:d.reduce((m,_,p)=>{if(p<d.length-1){const x=d[p+1];Math.abs(_.key-x.key)>Me?_.value>0&&m.push(_):_.value+=x.value}else _.value>0&&m.push(_);return m},[])}}combineSequences(t,e,s,i,n,r,o,a){const{X:l,mDist:d,nodeIndexTopDown:h}=this;let{res:u,bends:c}=this.calculateBends(-1,o,s,i,n,r,a,t),{res:g,bends:f}=this.calculateBends(1,o,s,i,r,n,a,e);for(c.length>0&&c.reverse();l[n]-l[r]<a-Me;){let p=0,x=0;if(u<g){const y=c.length;if(y>0){const b=c.pop();p=b.value,l[r]=b.key}(y===0||l[n]-l[r]>a+Me)&&(l[r]=l[n]-a)}else if(u>g){const y=f.length;if(y>0){const b=f.pop();x=b.value,l[n]=b.key}(y===0||l[n]-l[r]>a+Me)&&(l[n]=l[r]+a)}else{let y=(a-l[n]+l[r])/2;const b=c.length===0?y+1:l[r]-c[c.length-1].key,v=f.length===0?y+1:f[f.length-1].key-l[n];b<y+Me&&b<v+Me&&(p=c.pop().value),v<y+Me&&v<b+Me&&(x=f.pop().value),y=Math.min(y,b,v),l[r]-=y,l[n]+=y}u+=p,g+=x}let m,_=this.nodeList.byId[r].prev;for(;_&&h[m=_.data.id]>=h[s]&&l[r]-l[m]<d[r]-d[m];)l[m]=l[r]-d[r]+d[m],_=_.prev;for(_=this.nodeList.byId[n].next;_&&h[m=_.data.id]<=h[i]&&l[n]-l[m]>d[n]-d[m];)l[m]=l[n]-d[n]+d[m],_=_.next}placeNode(t,e,s,i,n){const{X:r,neighbours:o,mDist:a}=this,l=((n===0?o.prev:o.next)[t]||Hd).map(d=>r[d]);return l.length===0?r[t]:(i=Xm(l),e!==Ns&&(i=Math.max(i,r[e]+a[t]-a[e])),s!==Ns&&(i=Math.min(i,r[s]+a[t]-a[s])),i)}moveLongEdge(t,e,s){const{X:i,virt:n,totalW:r,nodeList:o}=this,{id:a}=t.data;if(s[a]||!n[a])return;const l=this.longEdges[a];if(!l)return;l.forEach(m=>s[m]=!0);const d=l[0],h=l[l.length-1],u=[];e<0?u.push(i[d]<i[h]?i[d]:i[h],i[d]<i[h]?i[h]:i[d]):e>0?u.push(i[d]<i[h]?i[h]:i[d],i[d]<i[h]?i[d]:i[h]):u.push(i[d],i[h]);const c=u[0];let g,f=!1;for(;!f&&u.length!==0;)g=u.pop(),f=!0,l.forEach(m=>{const _=this.layers[this.nodeToLayer[m]];if(m!==_[0].id){const p=o.byId[m].prev.data;g-i[p.data.id]<r[m]-r[p.data.id]&&this.moveLongEdge(p,-1,s),f=f&&g-i[p.data.id]>=r[m]-r[p.data.id]-Me}if(m!==_[_.length-1].id){const p=o.byId[m].next.data;g-i[p.data.id]>r[m]-r[p.data.id]&&this.moveLongEdge(p,1,s),f=f&&g-i[p.data.id]<=r[m]-r[p.data.id]+Me}});f||(g=c,l.forEach(m=>{const _=this.layers[this.nodeToLayer[m]];if(m!==_[0].id){const p=o.byId[m].prev.data;g=Math.max(g,i[p.data.id]+r[m]-r[p.data.id])}if(m!==_[_.length-1].id){const p=o.byId[m].next.data;g=Math.min(g,i[p.data.id]+r[m]-r[p.data.id])}})),l.forEach(m=>i[m]=g)}moveLongEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.moveLongEdge(e[i],0,t);for(let i=s-1;i>=0;i--)this.moveLongEdge(e[i],0,t)})}computeY(){const{Y:t,layers:e,height:s}=this;t[0]=0,e.slice(1).forEach((i,n)=>{t[n+1]=t[n]+(s[n]+s[n+1])/2+this.layerDistance})}straightenLongEdge(t,e){const{nodeList:s,longEdges:i,neighbours:n,X:r,Y:o,nodeToLayer:a,totalW:l}=this,d=i[t.id];if(e[t.id]||!n.prev[t.id]||n.prev[t.id].length!==1||!n.next[t.id]||n.next[t.id].length!==1||!(d&&d.length<2))return;e[t.id]=!0;const h=n.prev[t.id][0],u=n.next[t.id][0];if(a[u]===a[h])return;const c=r[h]+(r[u]-r[h])*(o[a[t.id]]-o[a[h]])/(o[a[u]]-o[a[h]]);if(t!==this.first[a[t.id]]){const f=s.byId[t.id].prev.data;if(c-r[f.id]<l[t.id]-l[f.id]-Me&&this.straightenLongEdge(f,e),c-r[f.id]<l[t.id]-l[f.id]-Me)return}const g=this.layers[a[t.id]];if(t!==g[g.length-1]){const f=s.byId[t.id].next.data;if(r[f.id]-c<l[f.id]-l[t.id]-Me&&this.straightenLongEdge(f,e),r[f.id]-c<l[f.id]-l[t.id]-Me)return}r[t.id]=c}straightenEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.straightenLongEdge(e[i],t);for(let i=s-1;i>=0;i--)this.straightenLongEdge(e[i],t)})}run(){this.computeMinNodeDistances(),this.decrossVirtualEdges(),this.placeLongEdges(),this.placeNonVirtualNodes(),this.moveLongEdges(),this.computeY(),this.straightenEdges(),Ls(this.layers,(t,e,s,i)=>{t.x=this.X[t.id],t.y=this.Y[i]})}},HP=(t,e=20,s=50)=>new jP(t,e,s).run();function WP(t){if(t.sort((i,n)=>i-n),t.length===0)return 0;const e=Math.floor(t.length/2),s=Math.floor(t.length/2);return(t[e]+t[s])/2}function du(t,e,s){const i={};return e.forEach((n,r)=>i[n.id]=r),t.map(n=>(s[n.id]||[]).map(r=>i[r]).sort()).reduce((n,r,o,a)=>{const l=r.length?r[r.length-1]:-1;for(let d=o+1;d<a.length;d++)n+=a[d].filter(h=>h<l).length;return n},0)}function XP(t,e,s,i,n){const r={};for(let o=0;o<t.length;o++)r[t[o].id]=WP((e[t[o].id]||[]).map(a=>s[a]))||0;n?t.sort((o,a)=>{const l=r[o.id]-r[a.id],d=i[o.id]===i[a.id],h=o.data.siblingIndex,u=a.data.siblingIndex;return d&&h>-1&&u>-1?h-u:l===0?s[a.id]-s[o.id]:l}):t.sort((o,a)=>{const l=r[o.id]-r[a.id];return l===0?s[a.id]-s[o.id]:l})}function $m({layers:t,topDown:e,topDownAdj:s,bottomUpAdj:i,idToIndex:n,crossings:r,sortSiblings:o}){const a=e?s:i;for(let l=e?0:t.length-1;e?l<t.length:l>=0;e?l++:l--){XP(t[l],a[l]||{},n,i[l],o);const d=l>0?du(t[l-1],t[l],s[l-1]):0,h=l<t.length-1?du(t[l],t[l+1],s[l]):0;h+d<(r[l]||0)+(r[l-1]||0)?(r[l]=h,l>0&&(r[l-1]=d),t[l].forEach((u,c)=>n[u.id]=c)):t[l].sort((u,c)=>n[u.id]-n[c.id])}}var YP=(t,e,s)=>{if(!s&&!e)return;const i={},n=t.map(()=>({})),r=t.map(()=>({}));t.forEach((h,u)=>{h.forEach((c,g)=>{i[c.id]=s?c.data.siblingIndex:g,c.children.forEach(f=>{const m=f.layer;m>u?(n[u][c.id]=n[u][c.id]||[],n[u][c.id].push(f.id),r[m][f.id]=r[m][f.id]||[],r[m][f.id].push(c.id)):(n[m][f.id]=n[m][f.id]||[],n[m][f.id].push(c.id),r[u][c.id]=r[u][c.id]||[],r[u][c.id].push(f.id))})})}),i[-1]=-1,s&&t.forEach(h=>h.sort((u,c)=>i[u.id]-i[c.id]));const o=t.slice(1).map((h,u)=>du(t[u],h,n[u])),a=[[50,100],[100,10],[1e3,1],[5e3,0]],l=Math.max(...t.map(h=>h.length)),d=(a.find(([h])=>l<h)||a[a.length-1])[1];for(let h=0;h<d;h++)$m({layers:t,topDown:!0,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s}),$m({layers:t,topDown:!1,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s})};function $P(t){const e={},s={},i={};t.nodes.forEach(o=>{i[o.id]=o});const n=o=>{if(e[o.id])return s[o.id];e[o.id]=!0;let a=1/0;for(const l of o.children)a=Math.min(a,n(i[l.id])-1);return a===1/0&&(a=0),s[o.id]=a,a};t.nodes.forEach(o=>{o.data.parentIds.length===0&&n(o)});let r=1/0;t.nodes.forEach(o=>{r=Math.min(r,s[o.id])}),t.nodes.forEach(o=>{s[o.id]-=r,o.layer=s[o.id]})}function ZP(t){const e=t.nodes.reduce((s,i)=>i.data.fixed&&(s===null||s.layer>i.layer)?i:s,null);return e&&t.nodes.forEach(s=>s.ref=e.id),t}function KP(t){if(t.nodes.every(e=>e.layer)){const e=t.nodes.reduce((s,i)=>Math.min(s,i.layer),1/0);t.nodes.forEach(s=>s.layer-=e)}}function QP(t){if(t.nodes.some(e=>e.data.sink)){const e=t.nodes.reduce((s,i)=>Math.max(s,i.layer),-1/0);t.nodes.forEach(s=>{s.data.sink&&(s.layer=e+1)})}}function JP(t){const e=[];t.nodes.forEach(i=>e[i.layer]=0);const s=Array.from(e).reduce((i,n,r)=>{if(r===0)return i.push(0),i;const o=i[r-1];return n!==void 0?(i.push(o),i):(i.push(o-1),i)},[]);t.nodes.forEach(i=>i.layer+=s[i.layer])}function tR(t){return $P(t),QP(t),KP(t),JP(t),t.nodes.forEach(e=>{const{below:s,above:i}=e.children.reduce((n,r)=>(e.layer>r.layer?n.above.push(r):n.below.push(r),n),{above:[],below:[]});i.forEach(n=>n.children.push(e)),e.children=s}),ZP(t)}var eR=(t,{nodeDistance:e,layerDistance:s,nodeLookup:i,customSort:n,customLayering:r,sortSiblings:o,shouldDecross:a=!0})=>{tR(t),r&&r(t);const l=sR(t);return t.nodes.length>1?(YP(l,a,o),n&&l.forEach(d=>{d.sort((h,u)=>n(i.get(h.id),i.get(u.id)))}),HP(l,e,s)):(t.nodes[0].x=0,t.nodes[0].y=0),iR(t),t};function sR(t){return t.nodes.reduce((e,s)=>(e[s.layer]=e[s.layer]||[],e[s.layer].push(s),s.children=s.children.map(i=>{if(i.layer===s.layer+1)return i;let n=i;for(let r=i.layer-1;r>s.layer;r--){const o=MP(`${s.id}->${i.id}@${r}`,r);o.children=[n],e[r]=e[r]||[],e[r].push(o),n=o}return n}),e),[])}function iR(t){t.nodes.forEach(e=>{e.data&&(e.children=e.children.filter(lu))})}var Wd=({id:t,layer:e,sink:s,siblingIndex:i,radius:n,layoutable:r})=>({id:t,layer:e!==void 0?e:void 0,sink:s,siblingIndex:i||0,radius:n||0,fixed:r===!1,parentIds:[],children:[],ref:null});function nR(t){const e={x:0,y:0};let s=0;for(let i=0;i<t.length;i++){const n=t[i];for(let r=0;r<n.nodes.length;r++){const o=n.nodes[r];e.x+=o.x||0,e.y+=o.y||0,s++}}return e.x/=s,e.y/=s,e}function rR(t){const e={x:0,y:0};let s=0;for(const[i,{x:n,y:r}]of t)e.x+=n||0,e.y+=r||0,s++;return e.x/=s,e.y/=s,e}function oR(t,e,s){const i=nR(s),n=t.x-i.x,r=t.y-i.y;for(let o=0;o<s.length;o++){const a=s[o];for(let l=0;l<a.nodes.length;l++){const d=a.nodes[l],h=e.get(d.id);!h||d.data&&d.data.fixed||(h.x=d.x+n,h.y=d.y+r)}}}var aR=t=>{var e,s,i;const n=[];if(t.nodes.forEach(g=>{if(g&&!isNaN(g.layer)&&g.layer!==null){if(g.layer<0)throw new Error("Layer must be greater than or equal to 0");n.push([g.id,g.layer])}}),n.length===0)return t.edges;n.sort((g,f)=>g[1]-f[1]);const r=new Set;for(let g=0;g<n.length;g++)n[g][1]!==0&&r.add(n[g][0]);const o=new Map;for(const g of t.nodes)o.set(g.id,[]);for(const g of t.edges)(e=o.get(g.source))==null||e.push(g.target),(s=o.get(g.target))==null||s.push(g.source);if(!n.map(([g,f])=>f).some(g=>g===0)){n.sort((_,p)=>_[1]-p[1]);const g=new Set,f=[n[0]];let m;for(;f.length>0;){const[_,p]=f.shift();if(p===0){m=_;break}g.add(_);const x=o.get(_)||[];for(const y of x)r.has(y)||g.has(y)||f.push([y,p-1])}if(m)n.push([m,0]);else{const _=n[0][1];for(let p=0;p<n.length;p++)n[p][1]-=_}}const a=n.filter(([g,f])=>f===0).map(([g])=>g),l=a.slice(),d=new Map,h=new Map,u=new Map;for(const g of a)d.set(g,0),h.set(g,[]);for(;l.length>0;){const g=l.shift(),f=d.get(g),m=o.get(g)||[];for(const _ of m){const p=d.get(_);p===void 0?(d.set(_,f+1),h.set(_,[g]),l.push(_)):p===f+1&&((i=h.get(_))==null||i.push(g))}}for(const[g,f]of h.entries())for(const m of f)u.set(m,(u.get(m)||[]).concat(g));for(const[g,f]of n)if(d.get(g)!==f)if(f===0){const m=h.get(g)||[];h.set(g,[]),m.forEach(x=>{u.set(x,(u.get(x)||[]).filter(y=>y!==g))});const _=t.nodes.filter(x=>d.get(x.id)===0);d.clear(),_.forEach(x=>d.set(x.id,0));const p=_.map(x=>x.id);for(;p.length>0;){const x=p.shift(),y=d.get(x),b=u.get(x)||[];for(const v of b)d.get(v)===void 0&&(d.set(v,y+1),p.push(v))}}else{const m=t.nodes.find(y=>d.get(y.id)===f-1&&y.id!==g);if(!m)continue;const _=h.get(g)||[];h.set(g,[m.id]),_.forEach(y=>{u.set(y,(u.get(y)||[]).filter(b=>b!==g))}),u.set(m.id,(u.get(m.id)||[]).concat(g));const p=t.nodes.filter(y=>d.get(y.id)===0);d.clear(),p.forEach(y=>d.set(y.id,0));const x=p.map(y=>y.id);for(;x.length>0;){const y=x.shift(),b=d.get(y),v=u.get(y)||[];for(const E of v)d.get(E)===void 0&&(d.set(E,b+1),x.push(E))}}const c=[];for(const[g,f]of h.entries())if(f.length>0)for(const m of f)c.push({id:`${m}-${g}`,source:m,target:g});return c},lR=(t,e={})=>{const s=new Map,i=new Map;for(const d of t.nodes)s.set(d.id,d);const n=t.nodes.slice(),r=(t.edges||[]).filter(({source:d,target:h})=>d!==h),o=Ym(n,r,s).filter(d=>{const h=i.get(d.source);if(!h){const u=new Map;return u.set(d.target,!0),i.set(d.source,u),!0}return!h.get(d.target)&&(h.set(d.target,!0),!0)}),a=kP(n,o,{skipSingletons:e.packing==="grid"}),l=a.map(d=>{const h=d.map(c=>s.get(c)),u=o.filter(c=>d.includes(c.source));return Ym(h,aR({nodes:h,edges:u}),s)}).flat().reduce((d,h)=>(d.has(h.source)||d.set(h.source,Wd(s.get(h.source))),d.has(h.target)||d.set(h.target,Wd(s.get(h.target))),d.get(h.target).children.push(h.source),d.get(h.target).parentIds.push(h.source),d),new Map);return{components:a.map(d=>d.map(h=>l.get(h)||Wd(s.get(h)))),lookup:s}};function dR(t,e,s){const i=[];for(const n of t){const r=GP(n);i.push(r),eR(r,{nodeDistance:s.nodesSeparation,layerDistance:s.layerSeparation,shouldDecross:s.shouldDecross,customSort:s.customSort,customLayering:s.customLayering,sortSiblings:!!s.sortSiblings,nodeLookup:e})}return i}var Zm=(t,e={})=>{if(!t||!t.nodes)return t;const s={direction:"down",packing:"fit",nodesGridSeparation:1,...e,shouldDecross:e.shouldDecross!==!1},{components:i,lookup:n}=lR(t,s),r=rR(n),o=dR(i,n,s);if(s.packing==="grid"){const a=UP(t.nodes,t.edges,s);o.push(a)}return LP(o,s),oR(r,n,o),t},Xd={direction:"TB",nodeDistance:5,levelDistance:50,componentDistance:50,gapWidth:1,arrangeComponents:"fit",gridDistance:50,layer:"layer",siblingIndex:""},hu={name:"hierarchical",imports:{sequential:Zm},configure:function(t,{graph:e,data:s}){function i(x,y,b=x.getNodes()){return y?y instanceof Pi?y:x.getNodes(y):b}const n={...Xd,...t,nodeList:t.nodes};n.direction=t.direction||Xd.direction,n.layerSeparation=n.levelDistance,n.nodesSeparation=n.nodeDistance,n.componentsSeparation=n.componentDistance,n.gapDistance=n.gapWidth,n.packing=n.arrangeComponents;const r={...n},o=n.edges,a=n.nodeList;if(["TB","BT","LR","RL"].indexOf(n.direction)===-1)throw new Error('direction should be one of the "TB", "BT", "LR", "RL"');if(["fit","grid","singleLine"].indexOf(n.packing)===-1)throw new Error('arrangeComponents should be one of the "fit", "grid", "singleLine"');n.nodesGridSeparation=t.gridDistance||Xd.gridDistance;const l=a.getId(),d=a.getAttribute("layoutable").reduce((x,y,b)=>(x[l[b]]=y,x),{}),h=a.getAttributes(["x","y"]).reduce((x,y,b)=>(x[l[b]]=y,x),{}),u=a.getAttribute("radius");if(typeof r.layer!="string")throw new Error("'layer' should be the valid data field name");if(r.siblingIndex===void 0&&(r.siblingIndex=""),typeof r.siblingIndex!="string")throw new Error("'siblingIndex' should be the valid data field name");const c=i(e,n.roots,e.nodeList()),g=s.getProperty(n.nodeList,r.layer),f=r.siblingIndex.length?s.getProperty(n.nodeList,r.siblingIndex):[],m=c.map(x=>{let y=-1;return n.nodeList.forEach((b,v)=>{b===x&&(y=v)}),y});for(const x of m)g[x]=0;const _=i(e,n.sinks,e.nodeList()).toArray().reduce((x,y)=>(x[y.getId()]=!0,x),{}),p=l.map(x=>_[x]);return{nodes:l,edges:o.map(x=>({id:x.getId(),source:x.getSource().getId(),target:x.getTarget().getId()})),options:kl(n),layoutable:d,radiuses:u,siblingIndexes:f,layers:g,sinks:p,coords:h}},context:Yt,update:function({nodes:t,edges:e,options:s,layoutable:i,radiuses:n,layers:r,siblingIndexes:o,sinks:a,coords:l}){const d=e.filter(({source:c,target:g})=>c in i&&g in i),h={nodes:t.map((c,g)=>({id:c,radius:n[g],layer:r[g],siblingIndex:o[g],sink:a[g],layoutable:i[c],x:l[c].x,y:l[c].y})),edges:d},{nodes:u}=Zm(h,{packing:{fit:"fit",singleLine:"singleline",grid:"grid"}[s.arrangeComponents],direction:{TB:"down",BT:"up",RL:"left",LR:"right"}[s.direction],layerSeparation:s.layerSeparation,nodesSeparation:s.nodesSeparation,sortSiblings:o.length>0,componentsSeparation:s.componentsSeparation,nodesGridSeparation:s.nodesGridSeparation,evenDistribution:s.evenDistribution});return{positions:u}},isRunning:function(){return!1},onSync:function({positions:t},{graph:e}){return{indexes:t.map(({id:s})=>(e.getNode(s)||{_index:-1})._index),x:t.map(({x:s})=>s),y:t.map(({y:s})=>s)}}},hR=t=>(t.modules.layouts.register(hu),(e={})=>(e.useWebWorker=!1,t.modules.layouts.start(hu.name,e))),uu=(t,e)=>t-e,Km={name:"radial",imports:{minHeap:ql,bellmanFord:qu,dijkstra:ju,johnson:Ih,distance:Ie,circleCircleIntersection:Xu,circleSortCompare:Yu,weightedStress:by,distanceStress:vy,constrainedStress:wh,stressMinimizationStep:Th,removeRadialOverlap:Lh,linear:El,calculateRadii:Bg},configure(t,{graph:e}){let s=t.nodes;const i=s.size;function n(E,A){return E!=null&&isFinite(E)?E:A}if(t.centralNode===void 0)throw new Error('radial layout: missing parameter "centralNode"');const r=e.getNode(t.centralNode);if(r===void 0)throw new Error('radial layout: parameter "centralNode" is not valid');t.radiusRatio=n(t.radiusRatio,Math.SQRT2),t.radiusDelta=n(t.radiusDelta,0),t.nodeGap=n(t.nodeGap,10),t.repulsion=i*n(t.repulsion,1);const o=r.getPosition(),a=n(t.centerX,o.x),l=n(t.centerY,o.y),d=r._index;s.includes(r)||(s=s.concat(r.toList()));let h=s._indexes;const u=s.getAttribute("layoutable");h=h.filter((E,A)=>u[A]||E===d),h.sort(uu);const c=h.length,g=uR(h,e.getConnectedComponents(s,{internalIndexes:!0}),d),f=e.degrees(h),m=new Float32Array(e.getNodeAttribute("x").getMultiple(h)),_=new Float32Array(e.getNodeAttribute("y").getMultiple(h)),p=e.getNodeAttribute("radius").getMultiple(h),x=e.getEdges()._indexes,y=e.getEdgeAttribute("source").getMultiple(x),b=e.getEdgeAttribute("target").getMultiple(x),v=e.getAdjacencyList({internalIndexes:!0,weight:1,indexes:h});return{centerIndex:d,centerIndexPos:0,cx:a,cy:l,D:null,indexes:h,components:g,normIndexes:null,radii:null,rings:null,x:m,y:_,degree:f,size:c,attributes:{size:p,adjacency:v,weights:b.map(()=>1),sources:y,targets:b},sortAttr:null,allowOverlap:!!t.allowOverlap,nodeGap:t.nodeGap,radiusRatio:t.radiusRatio,radiusDelta:t.radiusDelta,repulsion:t.repulsion,randomize:!("randomize"in t)||!!t.randomize,renderSteps:!!t.renderSteps,epsilon:n(t.epsilon,.001),maxSteps:n(t.maxIterations,100),iterationsPerRender:n(t.iterationsPerRender,20),step:-1,stress:Number.POSITIVE_INFINITY,prevStress:0,converged:!1,overlapRemoved:!1,done:!1}},context:()=>({data:null,gridPlacement(t,e,s=8){const i=t.length,n=new Float32Array(i),r=new Float32Array(i);let o=0;for(let c=0,g=t.length;c<g;c++){const f=e[t[c]];f>o&&(o=f)}const a=o*s,l=Math.ceil(Math.sqrt(i)),d=Math.ceil(i/l),h=-Math.floor((d-1)*a/2),u=-Math.floor((l-1)*a/2);for(let c=0;c<l;c++)for(let g=0;g<d;g++)n[c*d+g]=h+g*a,r[c*d+g]=u+c*a;return{x:n,y:r}},connectComponents(t,e,s,i,n,r){let o;function a(l,d){const h=new Uint32Array(l.length+1);return h.set(l),h[l.length]=d,h}for(let l=1;l<t.length;l++){const d=t[l];let h=0,u=0;d.forEach((f,m)=>{const _=n.get(f);_!=null&&_>h&&(u=m,h=_)}),o=d[u];const c=e[r.get(o)];c.weights=c.weights||[],c.nodes=a(c.nodes,s),c.weights.push(i);const g=e[r.get(s)];g.weights=g.weights||[],g.nodes=a(g.nodes,o),g.weights.push(i)}},correctSubgraphsDistances(t,e,s,i,n){const r=Array.prototype.reduce.call(t[s],(a,l,d)=>(d!==s&&l<i&&l>a&&(a=l),a),0),o=i-r-1;for(let a=1;a<e.length;a++){const l=e[a];for(let d=0,h=l.length;d<h;d++){const u=n.get(l[d]);u!=null&&(t[s][u]-=o,t[u][s]-=o)}}},initialize(t,e){t.data=e,e.step=0;const s=new Map,i=new Map;e.normIndexes=e.indexes.reduce((d,h,u)=>(d[u]=u,s.set(h,u),i.set(h,e.degree[u]),t.data&&h===e.centerIndex&&(t.data.centerIndexPos=u),d),new Uint32Array(e.indexes.length));const n=e.centerIndexPos,r=e.components[0].length;t.connectComponents(e.components,e.attributes.adjacency,e.centerIndex,r,i,s);const o=Ih({sources:e.attributes.sources,targets:e.attributes.targets,weights:e.attributes.weights,indexes:e.indexes,adjacency:e.attributes.adjacency,undirected:!0});t.correctSubgraphsDistances(o,e.components,n,r,s),e.D=o;const a=o[n],l={};for(let d=0,h=e.normIndexes.length;d<h;d++)if(d!==n){const u=a[d];l[u]=l[u]||[],l[u].push(e.normIndexes[d])}e.rings=l,e.radii=Bg(n,e.rings,e.attributes.size,e.nodeGap,e.radiusRatio,e.radiusDelta)},removeOverlaps(t,e){if(!t.data)return;const s=t.data.centerIndexPos,i=e.attributes.size,{rings:n,radii:r}=e,o=e.x[s],a=e.y[s];for(const l in n){const d=n[l];for(let h=0;h<d.length;h++){const u=d[h],c=r[l];let g=e.x[u]-o,f=e.y[u]-a;g+f===0&&(g=Math.sin(u)*Math.random()*.001,f=Math.cos(u)*Math.random()*.001);const m=Math.sqrt(g*g+f*f);if(m-c<0){const _=c/m;e.x[u]=o+g*_,e.y[u]=a+f*_}}}for(const l in n){const d=n[l],h=Ie(o,a,e.x[d[0]],e.y[d[0]]);Lh({X:e.x,Y:e.y,sizes:i,indexes:d,center:[o,a],R:h,gap:e.nodeGap,inPlace:!0})}}}),update(t,e){t||(t=e.data);const s=t.indexes,i=t.centerIndex;let n;t.x=t.x||new Float32Array(t.size),t.y=t.y||new Float32Array(t.size),t.step===-1&&e.initialize(e,t);const r=t.repulsion,o=a=>t.radii&&t.radii[a]||1;if(t.step===0&&t.randomize&&(n=e.gridPlacement(t.indexes,t.attributes.size),t.x=n.x,t.y=n.y),!t.converged){const a=t.maxSteps,l=t.iterationsPerRender;let d=t.step;const h=Math.min(d+l,a),{D:u,x:c,y:g,size:f,centerIndexPos:m,normIndexes:_}=t;for(;d<=h&&!t.converged;){const p=El(Math.min(d,a)/a);t.step=d++,n=Th(u,c,g,f,m,r,p,_,o),t.x=n.x,t.y=n.y,t.prevStress=t.stress,t.stress=wh(u,c,g,f,m,r,p,_),t.converged=t.converged||Math.abs(t.stress-t.prevStress)<=t.epsilon}}if(t.converged)if(t.overlapRemoved||t.allowOverlap){t.done=!0;const a=t.rings||{};t.rings=Object.keys(a).reduce((l,d)=>(l[d]=a[d].map(h=>s[h]),l),{})}else e.removeOverlaps(e,t,i),t.overlapRemoved=!0;return t},isRunning:({data:t})=>!(!t||t.converged&&(t.allowOverlap||t.done))||(t&&(t.step=-1),!1),onSync(t){if(t.renderSteps||t.done)return Qm(t)},onEnd:t=>Qm(t)};function Qm(t){const e=t.x,s=t.y,i=t.indexes.length,n=e[t.centerIndexPos]-t.cx,r=s[t.centerIndexPos]-t.cy;for(let o=0;o<i;o++)e[o]-=n,s[o]-=r;return{indexes:t.indexes,x:e,y:s}}function uR(t,e,s){const i=t.slice().sort(uu),n=[];for(let r=0,o=e.length;r<o;r++){const a=[],l=e[r];let d=!1;for(let h=0,u=l.length;h<u;h++){const c=l[h];sp(i,c)!==-1&&(c===s&&(d=!0),a.push(c))}a.length!==0&&n[d?"unshift":"push"](a.sort(uu))}return n}var cR=t=>(t.modules.layouts.register(Km),e=>{if(e.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');if(e.maxIterations=e.maxIterations&&isFinite(e.maxIterations)?Math.floor(e.maxIterations):100,e.maxIterations<1)throw new RangeError("maxIterations must be a positive integer");if(e.iterationsPerRender=e.iterationsPerRender&&isFinite(e.iterationsPerRender)?Math.floor(e.iterationsPerRender):20,e.iterationsPerRender<1)throw new RangeError("iterationsPerRender must be a positive integer");if(e.epsilon=e.epsilon&&isFinite(e.epsilon)?e.epsilon:.001,e.epsilon<=0)throw new RangeError("epsilon has to be a positive number");return t.modules.layouts.start(Km.name,e)}),Jm={...hu,name:"sequential"},gR=t=>(t.modules.layouts.register(Jm),(e={})=>{e.useWebWorker=!1;const s={...e,evenDistribution:!0};return t.modules.layouts.start(Jm.name,s)}),fR=class extends ge{constructor(t){super(t),this.stop=()=>this._ogma.modules.layouts.stop(),this.concentric=lM(t),this.radial=cR(t),this.force=EP(t),this.forceLink=AP(t),this.hierarchical=hR(t),this.sequential=gR(t),this.grid=SP(t)}},mR=class extends ge{constructor(){super(...arguments),this.move=t=>this._ogma.modules.virtualMouse.move(t),this.down=t=>this._ogma.modules.virtualMouse.down(t),this.up=t=>this._ogma.modules.virtualMouse.up(t),this.click=t=>this._ogma.modules.virtualMouse.click(t),this.rightClick=t=>this._ogma.modules.virtualMouse.rightClick(t),this.doubleclick=t=>this._ogma.modules.virtualMouse.doubleclick(t),this.drag=(t,e)=>this._ogma.modules.virtualMouse.drag(t,e),this.wheel=t=>this._ogma.modules.virtualMouse.wheel(t)}},_R=class extends ge{constructor(){super(...arguments),this.map=t=>this._ogma.modules.rules.createMapping(t),this.slices=t=>this._ogma.modules.rules.createSlices(t),this.template=t=>this._ogma.modules.rules.createTemplate(t)}},pR=class extends ge{constructor(){super(...arguments),this.watchNodeObjectProperty=t=>this._ogma.modules.watcher.watchNodeObjectProperty(t),this.watchEdgeObjectProperty=t=>this._ogma.modules.watcher.watchEdgeObjectProperty(t),this.watchNodeNonObjectProperty=t=>this._ogma.modules.watcher.watchNodeNonObjectProperty(t),this.watchEdgeNonObjectProperty=t=>this._ogma.modules.watcher.watchEdgeNonObjectProperty(t)}},yR=class{clearSelection(){return this.modules.selection.clear()}getSelectedNodes(){return this.modules.selection.getSelectedNodes()}getNonSelectedNodes(){return this.modules.selection.getNonSelectedNodes()}getSelectedEdges(){return this.modules.selection.getSelectedEdges()}getNonSelectedEdges(){return this.modules.selection.getNonSelectedEdges()}},xR=class{setOptions(t){return this.modules.settings.update(t)}getOptions(){return this.modules.settings.get()}},bR=class extends ge{constructor(){super(...arguments),this.setNodesVisibility=t=>this._ogma.modules.graphics.setNodesVisibility(t),this.setEdgesVisibility=t=>this._ogma.modules.graphics.setEdgesVisibility(t),this.setNodeTextsVisibility=t=>this._ogma.modules.graphics.setNodeTextsVisibility(t),this.setEdgeTextsVisibility=t=>this._ogma.modules.graphics.setEdgeTextsVisibility(t),this.addRule=(t={})=>this._ogma.modules.styleRules.addRule(t),this.getRuleList=()=>this._ogma.modules.styleRules.getRuleList(),this.addNodeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({nodeAttributes:s,nodeSelector:i})},this.addEdgeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({edgeAttributes:s,edgeSelector:i})},this.getNodeRules=()=>this.getRuleList().filter(t=>t.getDefinition().edgeAttributes===void 0),this.getEdgeRules=()=>this.getRuleList().filter(t=>t.getDefinition().nodeAttributes===void 0),this.createClass=t=>this._ogma.modules.classes.createClass(t),this.getClass=t=>this._ogma.modules.classes.getClassByName(t),this.getClassList=()=>this._ogma.modules.classes.getClassList(),this.setHoveredNodeAttributes=(t,e)=>{this._ogma.modules.hover.updateNodeAttributes(t,e)},this.setHoveredEdgeAttributes=(t,e)=>{this._ogma.modules.hover.updateEdgeAttributes(t,e)},this.setSelectedNodeAttributes=(t,e)=>this._ogma.modules.selection.setNodeAttributes(t,!!e),this.setSelectedEdgeAttributes=(t,e)=>this._ogma.modules.selection.setEdgeAttributes(t,!!e),this.setTheme=({nodeAttributes:t,edgeAttributes:e,selectedNodeAttributes:s,selectedEdgeAttributes:i,hoveredNodeAttributes:n,hoveredEdgeAttributes:r})=>{this._ogma.modules.pulses.setTheme(t&&t.pulse||{},e&&e.pulse||{}),this._ogma.modules.graphics.getAttributesManager().setDefaultAttributes(t||{},e||{}),this.setSelectedNodeAttributes(s||{}),this.setSelectedEdgeAttributes(i||{}),this.setHoveredNodeAttributes(n||{}),this.setHoveredEdgeAttributes(r||{})}}},vR=class extends ge{constructor(){super(...arguments),this.set=(t,e)=>this._ogma.modules.brand.set(t,e),this.remove=()=>{this._ogma.modules.brand.remove()}}},ER=class extends ge{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.connectNodes.enable(t),this),this.disable=()=>(this._ogma.modules.connectNodes.disable(),this),this.enabled=()=>this._ogma.modules.connectNodes.enabled()}},t_={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t})=>t.setSelected(!0),bothExtremities:!1},U0=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._points=[],this._bbox=new cs,this._onStart=({x:t,y:e})=>{this._bbox.reset(),this.savePoint(t,e,!1)},this._onStop=()=>{const{minX:t,minY:e,maxX:s,maxY:i}=this._bbox,{nodes:n,edges:r}=this._modules.spatial.queryProjected(t,e,s,i),o={},a=n.filter(h=>{const u=h.isVisible(),c=h.getAttribute("detectable"),g=u&&c&&this._modules.locate.isNodeInPolygon(h,this._points);return o[h._index]=g,g});let l=r.filter(h=>{const u=h.isVisible(),c=h.getAttribute("detectable");return u&&c&&this._modules.locate.isEdgeInPolygon(h,this._points)});this._options.bothExtremities&&(l=this.filterByExtremities(l,o)),this._layer.clear();const d=this._points.slice();this._points=[],this.disable(),this._options.callback({nodes:a,edges:l,points:d})}}onMounted(){this._options=Ae(t_),this._cachedCursor="",this._modules.events.isRegistered("lassoEnabled")||this._modules.events.register(["lassoEnabled","lassoDisabled"]),this._interaction=this._modules.interactions.onDrag({priority:"lasso",check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this.savePoint(t,e,!0),onStop:this._onStop})}enable(t={}){return this._enabled||(this._enabled=!0,this._modules.captor.setDetectionEnabled(!1),this._options=As(t,t_),this._layer=this._modules.layers.addCanvasLayer(Yt,{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._cachedCursor=this._layer.element.parentElement?.style.cursor||"",rl(this._layer.element.parentElement,this._options.cursorStyle),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorPosition()),this._modules.events.fire("lassoEnabled")),this}disable(){return this._enabled?(this._enabled=!1,this._modules.captor.setDetectionEnabled(!0),rl(this._layer.element.parentElement,this._cachedCursor),this._layer.destroy(),this._modules.events.fire("lassoDisabled"),this):this}enabled(){return this._enabled}savePoint(t,e,s){const i=ps(),n=this._options,r=this._points;if(this._bbox.addPoint(t,e),r.push({x:t,y:e}),s){const o=r[0];this._layer.refresh(a=>{a.lineWidth=n.strokeWidth,a.lineJoin="bevel",a.strokeStyle=n.strokeColor,a.fillStyle=n.fillColor,a.beginPath(),a.moveTo(o.x*i,o.y*i);for(let l=1;l<r.length;++l){const d=r[l];a.lineTo(d.x*i,d.y*i)}a.stroke(),n.fillColor&&a.fill()})}}filterByExtremities(t,e){const s=this._modules.graph.getEdgeAttribute("source"),i=this._modules.graph.getEdgeAttribute("target");return t.filter(n=>{const r=n._index,o=s.get(r),a=i.get(r);return e[o]&&e[a]})}},AR=class extends ge{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.lasso.enable(t),this),this.disable=()=>(this._ogma.modules.lasso.disable(),this),this.enabled=()=>this._ogma.modules.lasso.enabled()}},SR=class extends ge{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.legend.enable(t),this.disable=()=>this._ogma.modules.legend.disable(),this.enabled=()=>this._ogma.modules.legend.enabled(),this.getOptions=()=>this._ogma.modules.legend.getOptions(),this.export=t=>this._ogma.modules.legend.export(t)}},e_={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t,edges:e})=>{t.size?t.setSelected(!0):e.setSelected(!0)},bothExtremities:!1},wR=class extends U0{constructor(){super(...arguments),this._onStart=({x:t,y:e})=>{this._rectangle.reset(),this._start={x:t,y:e},this._layer?.refresh(s=>{s.fillStyle=this._options.fillColor,s.strokeStyle=this._options.strokeColor,s.lineWidth=this._options.strokeWidth})},this._onStop=()=>{const t=this._modules.captor.getCursorPosition(),e=this._formatRectangle(t),{nodes:s,edges:i}=this._modules.spatial.queryProjected(e.minX,e.minY,e.maxX,e.maxY),n={},r=s.filter(a=>{const l=a.isVisible(),d=a.getAttribute("detectable"),h=l&&d&&this._modules.locate.isNodeInRectangle(a,e);return n[a._index]=h,h});let o=i.filter(a=>{const l=a.isVisible(),d=a.getAttribute("detectable");return l&&d&&this._modules.locate.isEdgeInRectangle(a,e)});this._options.bothExtremities&&(o=this.filterByExtremities(o,n)),this._layer?.clear(),this.disable(),this._options.callback({nodes:r,edges:o,rectangle:{minX:e.minX,minY:e.minY,maxX:e.maxX,maxY:e.maxY,width:e.width,height:e.height,cx:e.cx,cy:e.cy}})}}onMounted(){this._options=Ae(e_),this._enabled=!1,this._rectangle=new cs,this._interaction=this._modules.interactions.onDrag({priority:"lasso",disableDetection:!0,check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this._refreshRectangle({x:t,y:e}),onStop:this._onStop})}enable(t){return super.enable(As(t,e_))}_formatRectangle(t){const e=this._start.x,s=this._start.y,i=t.x,n=t.y,r=Math.abs(e-i),o=Math.abs(s-n),a=e<i?e:i,l=s<n?s:n;return this._rectangle.reset().addPoint(a,l).addPoint(a+r,l+o)}_refreshRectangle(t){const{minX:e,minY:s,width:i,height:n}=this._formatRectangle(t),r=ps();this._layer?.refresh(o=>{o.strokeRect(e*r,s*r,i*r,n*r),this._options.fillColor&&o.fillRect(e*r,s*r,i*r,n*r)})}},TR=class extends ge{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rectangleSelect.enable(t)},this.disable=()=>{this._ogma.modules.rectangleSelect.disable()},this.enabled=()=>this._ogma.modules.rectangleSelect.enabled()}},IR=class extends ge{constructor(){super(...arguments),this.enable=t=>{this._ogma.modules.resizing.enable(t)},this.disable=()=>{this._ogma.modules.resizing.disable()},this.enabled=()=>this._ogma.modules.resizing.enabled()}},CR=class extends ge{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rewiring.enable(t)},this.disable=()=>{this._ogma.modules.rewiring.disable()},this.enabled=()=>this._ogma.modules.rewiring.enabled()}},LR=class extends ge{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.snapping.enable(t)},this.disable=()=>{this._ogma.modules.snapping.disable()},this.enabled=()=>this._ogma.modules.snapping.enabled()}},NR=class extends ge{constructor(){super(...arguments),this.onNodeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.node",t,e)},this.onNodeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.node",t,e)},this.onNodeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.node",t,e)},this.onNodeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.node",t,e)},this.onEdgeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.edge",t,e)},this.onEdgeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.edge",t,e)},this.onEdgeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.edge",t,e)},this.onEdgeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.edge",t,e)},this.onBackgroundClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.background",t,e)},this.onBackgroundRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.background",t,e)},this.onBackgroundDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.background",t,e)},this.refresh=()=>this._ogma.modules.tooltip.refresh(),this.isShown=()=>this._ogma.modules.tooltip.isShown(),this.hide=()=>{this._ogma.modules.tooltip.hide()},this.show=(t,e)=>this._ogma.modules.tooltip.show(t,e)}},MR=class extends ge{constructor(t){super(t),this.lasso=new AR(t),this.connectNodes=new ER(t),this.legend=new SR(t),this.rectangleSelect=new TR(t),this.resize=new IR(t),this.rewire=new CR(t),this.snapping=new LR(t),this.tooltip=new NR(t),this.brand=new vR(t)}},PR=class extends ge{constructor(t){super(t),this.getList=()=>this._ogma.modules.transformations.api.getList(),this.clear=()=>this._ogma.modules.transformations.api.clear().then(()=>{}),this.getById=e=>this._ogma.modules.transformations.api.getById(e),this.afterNextUpdate=()=>this._ogma.modules.transformations.afterNextUpdate(),this.onGroupsUpdated=e=>{this._ogma.modules.transformations.onGroupsUpdated(e)},this.layoutGroups=(e,s,i=!1)=>(Ei('Deprecated method "Ogma.transformations.layoutGroups"; please use "ogma.transformations.triggerGroupsUpdated" instead.'),this._ogma.modules.transformations.api.layoutGroups(e,s,i)),this.triggerGroupUpdated=e=>this._ogma.modules.transformations.triggerGroupUpdated(e),this.triggerGroupsUpdated=()=>this._ogma.modules.transformations.api.triggerGroupsUpdated()}addNodeGrouping(t){return this._ogma.modules.transformations.api.addNodeGrouping(t)}addNodeClustering(t){return this._ogma.modules.transformations.api.addNodeClustering(t)}addEdgeGrouping(t){return this._ogma.modules.transformations.api.addEdgeGrouping(t)}addDrillDown(t){return this._ogma.modules.transformations.api.addDrilldown(t)}addNodeFilter(t){return this._ogma.modules.transformations.api.addNodeFilter(t)}addEdgeFilter(t){return this._ogma.modules.transformations.api.addEdgeFilter(t)}getNodeFilters(){return this._ogma.modules.transformations.getNodeFilters()}getEdgeFilters(){return this._ogma.modules.transformations.getEdgeFilters()}addNeighborGeneration(t){return this._ogma.modules.transformations.api.addNeighborGeneration(t)}addNeighborMerging(t){return this._ogma.modules.transformations.api.addNeighborMerging(t)}addNodeCollapsing(t){return this._ogma.modules.transformations.api.addNodeCollapsing(t)}addGeoClustering(t){return this._ogma.modules.transformations.api.addGeoClustering(t)}addVirtualProperties(t){return this._ogma.modules.transformations.api.addVirtualProperties(t)}getXYR(t){return this._ogma.modules.transformations.getXYR(t)}expandGroup({node:t,computeSubNodesPosition:e,duration:s,easing:i,onExpand:n}){return this._ogma.modules.transformations.expandGroup(this._ogma,t,e,n,s,i)}collapseGroup({node:t,duration:e,easing:s,onCollapse:i}){return this._ogma.modules.transformations.collapseGroup(this._ogma,t,i,e,s)}},RR=class extends ge{constructor(){super(...arguments),this.setZoom=(t,e)=>this._ogma.modules.camera.setZoom(t,e),this.zoomIn=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomIn():this._ogma.modules.camera.zoomIn(t),this.zoomOut=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomOut():this._ogma.modules.camera.zoomOut(t),this.getZoom=()=>this._ogma.modules.camera.getZoom(),this.setCenter=(t,e)=>this._ogma.modules.camera.setCenter(t,e),this.move=(t,e)=>this._ogma.modules.camera.move(t,e),this.moveToBounds=(t,e)=>{if(!(t&&t instanceof cs)){if(!He(t)||t.length!==4)throw new Error("ogma.view.zoomToBounds requires a BoundingBox as a parameter");{const[s,i,n,r]=t;t=cs.from({minX:s,minY:i,maxX:n,maxY:r})}}return this._ogma.modules.camera.moveToBounds(t,e)},this.moveTo=(t,e)=>this._ogma.modules.camera.moveTo(t,e),this.getCenter=()=>this._ogma.modules.camera.getCenter(),this.setAngle=(t,e)=>this._ogma.modules.camera.setAngle(t,e),this.rotate=(t,e)=>this._ogma.modules.camera.rotate(t,e),this.getAngle=()=>this._ogma.modules.camera.getAngle(),this.set=(t,e)=>this._ogma.modules.camera.setView(t,e),this.get=()=>this._ogma.modules.camera.getView(),this.graphToScreenCoordinates=t=>this._ogma.modules.camera.graphToScreenCoordinates(t),this.screenToGraphCoordinates=t=>this._ogma.modules.camera.screenToGraphCoordinates(t),this.getImageData=()=>this._ogma.modules.graphics.getImageData(),this.getElementAt=t=>this._ogma.modules.captor.detectElementAt(t.x,t.y,!1,!0),this.getElementsInView=()=>{const{width:t,height:e}=this.get(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return this._ogma.modules.spatial.query(s.x,s.y,i.x,i.y)},this.getBounds=()=>{const{width:t,height:e}=this.getSize(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return{cx:(s.x+i.x)/2,cy:(s.y+i.y)/2,width:i.x-s.x,height:i.y-s.y,minX:s.x,minY:s.y,maxX:i.x,maxY:i.y}},this.getElementsInside=(t,e,s,i,n=!0)=>{const{spatial:r,camera:o}=this._ogma.modules;if(n){const a=o.graphToScreenCoordinates({x:t,y:e}),l=o.graphToScreenCoordinates({x:s,y:i});return r.queryProjected(a.x,a.y,l.x,l.y)}return r.queryProjected(t,e,s,i)},this.beforeNextFrame=()=>this._ogma.modules.dom.beforeNextFrame(),this.afterNextFrame=()=>this._ogma.modules.dom.afterNextFrame(),this.setFullScreen=t=>this._ogma.modules.dom.setFullScreen(t),this.isFullScreen=()=>this._ogma.modules.dom.isFullScreen(),this.forceResize=()=>this._ogma.modules.dom.forceResize(),this.getSize=()=>this._ogma.modules.dom.getDimensions(),this.setSize=t=>{if(!t||isNaN(t.width)||isNaN(t.height))throw new Error("Size must follow the format { width: number, height: number }");if(t.width<0)throw new Error("width must be positive");if(t.height<0)throw new Error("height must be positive");return this._ogma.modules.dom.setDimensions(t),Promise.resolve()},this.locateGraph=t=>this._ogma.modules.locate.locateGraph(t),this.locateRawGraph=(t,e)=>this._ogma.modules.locate.locateRawGraph(t,e),this.getGraphBoundingBox=({withTexts:t=!1}={})=>this._ogma.modules.locate.getGraphBoundingBox(t),this.animationInProgress=()=>this._ogma.modules.locate.isLocating()||this._ogma.modules.camera.animationInProgress(),this.getTextBoundingBox=t=>{if(!t)throw new Error("ogma.view.getTextBoundingBox: item must be a Node or an Edge");const e=t.getAttribute("text");return e==null||e===""?null:t.isList?this._ogma.modules.labels.getTextsBoundingBox(t):this._ogma.modules.labels.getTextsBoundingBox(t.toList())},this.getNodeBadgeAt=(t,e)=>{if(!t)throw new Error("ogma.view.getNodeBadgeAt: node is not defined");return Mx(e,t._index,this._ogma.modules.graphics.getAttributesManager(),this._ogma.modules.camera,this._ogma.modules.graphics.getGraphicsEngine())}}},FR=class{constructor(t,e){this._ogma=t,this.settings=new EL(t),this.events=new xL(t),this.dom=new uT(t),this.animations=new NF(t),this.camera=new rL(t),this.graph=new NS(t),this.data=new fT(t),this.graphics=new cL(t),this.layers=new tk(t),this.individualAttributes=new vL(t),this.algorithms=new ek(t),this.position=new jO(t),this.touch=new WL(t),this.mouse=new jL(t),this.virtualMouse=new hD(t),this.spatial=new PL(t),this.captor=new jD(t),this.interactions=new OD(t),this.classes=new TL(t),this.cameraInteractions=new iL(t,!!e.debug),this.hover=new qO(t),this.keyboard=new nO(t),this.selection=new EF(t),this.styleRules=new mD(t),this.legend=new GO(t),this.sync=new AF(t),this.rules=new ZO(t),this.transformations=new bF(t),this.locate=new UL(t),this.drag=new HD(t),this.pulses=new IF(t),this.curvatureManager=new HF(t),this.workers=new QF(t),this.layouts=new tD(t),this.watcher=new rD(t),this.rectangleSelect=new wR(t),this.labels=new DD(t,e),this.brand=new qF(t),this.lasso=new U0(t),this.rewiring=new XD(t),this.resizing=new YD(t),this.snapping=new uD(t),this.connectNodes=new ZD(t),this.tooltip=new sO(t),this.geo=new jF(t),Object.keys(this).forEach(s=>{const i=this[s];i instanceof Bt&&(i._setModules(this),i.onMounted())}),t.onReady(()=>{Object.keys(this).forEach(s=>{const i=this[s];i instanceof Bt&&i.onReady(e)})})}destroy(){Object.keys(this).forEach(t=>{const e=this[t];e instanceof Bt&&e.destroy(this._ogma)})}},DR=1,OR=[YL,XL,QL,OS,nM,yR,xR],cu={version:"5.2.2",commit:"de8dcac10",buildTime:"Wed Feb 19 2025 12:53:44 GMT+0000 (Coordinated Universal Time)"},Gn=class gu{constructor(e={}){this.node=s=>new js(s,this),this.edge=s=>new Zi(s,this),this.nodeList=s=>new Pi(s||new Uint32Array(0),this),this.edgeList=s=>new Ln(s||new Uint32Array(0),this),this._onReady=[],this.build=cu,this._init(e)}static{this.libraries=Bp}static{this.geometry=y0}static{this.parse=Rc}_init(e){this._initParameters=e,this._debug=!!e.debug,this._token=DR++,this.modules=new FR(this,e),this.styles=new bR(this),this.algorithms=new sk(this),this.export=new eM(this),this.keyboard=new oM(this),this.generate=new sM(this),this.layouts=new fR(this),this.parse=new rM(this),this.transformations=new PR(this),this.tools=new MR(this),this.view=new RR(this),this.mouse=new mR(this),this.events=new JL(this),this.schema=new pR(this),this.rules=new _R(this),this.geo=new iM(this),this.layers=new aM(this),this.debug=new KL(this),this._onReady.forEach(s=>s(this)),this.safelyBindToInstance(),this.modules.events.register(["destroy"]),this.build={version:"5.2.2",commit:"de8dcac10",buildTime:"Wed Feb 19 2025 12:53:44 GMT+0000 (Coordinated Universal Time)"}}safelyBindToInstance(){for(const e of Object.getOwnPropertyNames(gu.prototype))typeof gu.prototype[e]=="function"&&(this[e]=this[e].bind(this))}onReady(e){this._onReady.push(e)}_destroy(){if(!this._token)throw new Error('"destroy" called twice on the same instance of Ogma');this._onReady=[],this.modules.destroy(),this.modules=null}destroy(){this.modules.events.fire("destroy",{}),this._destroy()}isDestroyed(){return!this.modules}reset(){const e=this._initParameters;this._destroy(),this._init(e)}isDebug(){return this._debug}static{this.build=cu}static{this.algorithms=Vu}static{this.utils=Ec}};Gn.algorithms=Vu,Gn.utils=Ec,Gn.parse=Rc,Gn.build=cu,iA(Gn,OR);var qc=Gn,is=(t=>(t.NodeFilter="node-filter",t.EdgeFilter="edge-filter",t.NodeCollapsing="node-collapsing",t.VirtualProperties="virtual-properties",t.NeighborGeneration="neighbor-generation",t.NeighborMerging="neighbor-merging",t.NodeGrouping="node-grouping",t.EdgeGrouping="edge-grouping",t.NodeClustering="node-clustering",t.GeoClustering="geo-clustering",t.Unknown="unknown",t))(is||{}),rn=class{constructor({id:t,duration:e,easing:s,ogma:i,module:n}){this.animation=s?{duration:e,easing:s}:e===void 0?0:e,this.destroyed=!1,this.id=t,this.ogma=i,this.context={},this.module=n,this.resetContext()}setOptions(t){var e;let s=typeof this.animation=="number"?this.animation:(e=this.animation)==null?void 0:e.duration,i=typeof this.animation=="object"?this.animation.easing:void 0;return typeof t.duration=="number"&&(s=t.duration),t.easing!==void 0&&(i=t.easing),this.animation=i?{duration:s,easing:i}:s===void 0?0:s,this.module.setOptions(this),this.module.afterNextUpdate()}enable(t){return this.animation=t===void 0?this.animation:t,this.module.enable(this)}disable(t){return this.animation=t===void 0?this.animation:t,this.module.disable(this)}isEnabled(){return this.module.isEnabled(this)}getId(){return this.id}whenApplied(){return this.module.afterNextUpdate().then(()=>this)}toggle(t){return this.animation=t===void 0?this.animation:t,this.isEnabled()?this.module.disable(this):this.module.enable(this)}run(t=!0){return Promise.resolve()}undo(t=!0){return Promise.resolve()}cleanup(){return this.resetContext(),Promise.resolve()}refresh(){return this.module.refreshTransformation(this),this.module.afterNextUpdate()}getIndex(){return this.module.getIndex(this)}setIndex(t){return this.module.setIndex(this,t),this.module.afterNextUpdate()}getAnimation(){return typeof this.animation=="number"?{duration:this.animation,easing:"linear"}:this.animation}getContext(){return this.context}setContent(t){this.context=t}resetContext(){this.context={}}getName(){return is.Unknown}destroy(t){return t!==void 0&&(this.animation=t),this.module.remove(this)}},kR=class{constructor(t){this.xs=new Map,this.ys=new Map,this.rs=new Map,this.curvatures=new Map,this.hiddenNodes=new Set,this.hiddenEdges=new Set,this.animations=[],this.before=[],this.after=[],this.enabled=!1,this.applying=!1,this._onLayoutEnd=e=>{if(!this.enabled)return;const s=e.positions.current,i=e.ids;for(let n=0;n<i.length;n++){const r=this.ogma.getNode(i[n])._index,o=s[n];o&&(this.xs.set(r,o.x),this.ys.set(r,o.y))}},this._onLayoutPrepare=e=>{this.enabled&&(e.params.dryRun=!0)},this._onNodesRemoved=e=>{const s=e.nodes._indexes;for(const i of s)this.xs.delete(i),this.ys.delete(i),this.rs.delete(i)},this._onLayoutGetData=({name:e,data:s})=>{if(this.enabled){if(e==="force"){const i=s.graph.nodes,n=s.indexes;for(let r=0;r<n.length;r++)this.xs.has(n[r])&&(i[r].x=this.xs.get(n[r]),i[r].y=this.ys.get(n[r]),i[r].r=this.rs.get(n[r])!==void 0?1.25*this.rs.get(n[r]):i[r].r)}else if(e==="hierarchical"||e==="sequential"){const i=s.options.nodes._indexes;for(let n=0;n<i.length;n++)this.rs.has(i[n])&&(s.radiuses[n]=this.rs.get(i[n]))}else if(e==="concentric"){const i=s.list;for(let n=0;n<i.length;n++)this.rs.has(i[n])&&(s.attributes.size[n]=this.rs.get(i[n]))}else if(e==="forceLink")for(const i in s.nodes){const n=Number(i),r=s.nodes[n];this.xs.has(n)&&(r.x=this.xs.get(n),r.y=this.ys.get(n)),this.rs.has(n)&&(r.size=this.rs.get(n))}else if(e==="radial"){const i=s.indexes;for(let n=0;n<i.length;n++){const r=i[n];this.xs.has(r)&&(s.x[n]=this.xs.get(r),s.y[n]=this.ys.get(r)),this.rs.has(r)&&(s.attributes.size[n]=this.rs.get(r))}}else if(e!=="grid")throw new Error(`Ogma transformtaions: Unsupported layout: ${e}`)}},this.ogma=t,this.afterMod={nodesToHide:new Set,edgesToHide:new Set},this.layer=this.ogma.modules.graphics.addAttributeLayer({name:"ogma-transformations-animations",priority:5.99999,nodeOutput:{attributes:["radius"]},edgeOutput:{attributes:["curvature"]},nodeDependencies:void 0,edgeDependencies:void 0}),this.attributeLayerData=this.layer._attributesManager._getLayerById(this.layer._id),this.initEvents()}initEvents(){this.ogma.events.on("layoutPrepare",this._onLayoutPrepare).on("layoutEnd",this._onLayoutEnd).on("removeNodes",this._onNodesRemoved).on("layoutGetData",this._onLayoutGetData)}handleLayoutPromises(t){return Promise.all(t).then(e=>{e.forEach(s=>{if(!s)return;const{res:i,subNodes:n}=s;if(!Array.isArray(i))return;const r=n._indexes;for(let o=0;o<r.length;o++){const a=i[o];a.radius!==void 0?this.setXYR(r[o],a.x,a.y,a.radius):this.setXY(r[o],a.x,a.y)}})})}handleGlobalLayout(t,e){if(t)for(let s=0;s<e.length;s++)t[s].radius!==void 0?this.setXYR(e[s],t[s].x,t[s].y,t[s].radius):this.setXY(e[s],t[s].x,t[s].y)}apply(t){const e=Array.from(this.xs.values()),s=Array.from(this.ys.values()),i=Array.from(this.rs.values()).map(u=>({radius:u})),n=Array.from(this.curvatures.values()).map(u=>({curvature:u})),r=this.ogma.nodeList(Array.from(this.hiddenNodes)),o=this.ogma.edgeList(Array.from(this.hiddenEdges)),a=e.map((u,c)=>({x:u,y:s[c]})),l=this.ogma.nodeList(Array.from(this.xs.keys())),d=this.ogma.nodeList(Array.from(this.rs.keys())),h=this.ogma.edgeList(Array.from(this.curvatures.keys()));return this.xs.clear(),this.ys.clear(),this.rs.clear(),this.curvatures.clear(),this.hiddenNodes.clear(),this.hiddenEdges.clear(),this.before.forEach(u=>u()),this.initCurvature(h._indexes),this.applying=a.length>0||i.length>0||n.length>0,Promise.all([a.length?l.setAttributes(a,t):Promise.resolve(),i.length?this.ogma.modules.graphics.animate(d,()=>this.layer.setAttributeValues(d,i),!1,t):Promise.resolve(),n.length?this.ogma.modules.graphics.animate(h,()=>this.layer.setAttributeValues(h,n),!1,t):Promise.resolve(),...this.animations.map(u=>u())]).then(()=>(this.ogma.nodeList(Array.from(this.afterMod.nodesToHide)).setVisible(!1),this.ogma.edgeList(Array.from(this.afterMod.edgesToHide)).setVisible(!1),Promise.all(this.after.map(u=>u())))).then(()=>{this.deleteCurvatures(h._indexes),r.setVisible(!1),o.setVisible(!1),this.animations=[],this.before=[],this.after=[],this.afterMod.nodesToHide.clear(),this.afterMod.edgesToHide.clear(),this.applying=!1})}setXYR(t,e,s,i){if(typeof t=="number")this.xs.set(t,e),this.ys.set(t,s),i!==void 0&&this.rs.set(t,i);else for(const n of t)this.xs.set(n,e),this.ys.set(n,s),i!==void 0&&this.rs.set(n,i)}getOpenRadius(t){return this.attributeLayerData.nodes.outputFlexArrays.radius.get(t)}getInputFlexArrays(){return this.attributeLayerData.nodes.inputFlexArrays}getCloseRadius(t){return this.attributeLayerData.nodes.inputFlexArrays.radius.get(t)}deleteOpenRadius(t){this.layer.getFlexArrays().nodes.radius.set(t,void 0)}initCurvature(t){const e=this.attributeLayerData.edges.inputFlexArrays.curvature,s=this.attributeLayerData.edges.outputFlexArrays.curvature;for(let i=0;i<t.length;i++)s.set(t[i],e.get(t[i]))}deleteCurvatures(t){const e=this.layer.getFlexArrays().edges.curvature;for(let s=0;s<t.length;s++)e.set(t[s],void 0)}hideNode(t){this.hiddenNodes.add(t)}showNode(t){this.hiddenNodes.delete(t)}hideNodes(t){for(const e of t)this.hiddenNodes.add(e)}showNodes(t){for(const e of t)this.hiddenNodes.delete(e)}hideEdge(t){this.hiddenEdges.add(t)}showEdge(t){this.hiddenEdges.delete(t)}hideEdges(t){for(const e of t)this.hiddenEdges.add(e)}showEdges(t){for(const e of t)this.hiddenEdges.delete(e)}pushBefore(t){Array.isArray(t)?this.before.push(...t):this.before.push(t)}pushAfter(t){Array.isArray(t)?this.after.push(...t):this.after.push(t)}setXY(t,e,s){this.xs.set(t,e),this.ys.set(t,s)}setR(t,e){this.rs.set(t,e)}setRs(t,e){for(let s=0;s<t.length;s++)this.rs.set(t[s],e[s])}setCurvatures(t,e){for(let s=0;s<t.length;s++)this.curvatures.set(t[s],e[s])}setCurvature(t,e){this.curvatures.set(t,e)}hideNodesAfter(t){for(let e=0;e<t.length;e++)this.afterMod.nodesToHide.add(t[e])}hideEdgesAfter(t){for(let e=0;e<t.length;e++)this.afterMod.edgesToHide.add(t[e])}setOpenRadius(t,e){this.attributeLayerData.nodes.outputFlexArrays.radius.set(t,e)}push(t){Array.isArray(t)?this.animations.push(...t):this.animations.push(t)}enable(){this.enabled=!0}disable(){this.enabled=!1}getMaxAnimation(t,e){return(typeof t=="number"?t:t.duration)>(typeof e=="number"?e:e.duration)?t:e}isApplying(){return this.applying}},fu=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)i.hasOwnProperty(n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):s_(e[n])&&s_(i[n])?e[n]=fu(e[n],i[n]):e[n]=i[n])}return e};function Yr(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function zR(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Ogma transformations: Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}function BR(t,e){const s=t.get(0);return{data:s.getData(),attributes:s.getAttributes(e)}}function Il(t,e){return`gen_grp_${e}_${t}`}function s_(t){return!(!t||t.constructor!==Object&&t.constructor)}function UR(t){return t.map(({id:e,source:s,target:i})=>({id:e,source:s,target:i}))}function GR(t,e,s,i){let n=e,r=s;return!i&&n.toString()>r.toString()&&(n=s,r=e),`${t}[${n}-${r}]`}function VR(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`Ogma transformation: ${t} is not a valid id, expected string or number`);return t}function Ta(t){return`data.${t}`}var qR=class{constructor(t){this.groupsByDepth=new Map,this.treeMap=new Map,this.dataMap=new Map,this.invalidEdges=new Map,this.edges=new Map,this.ogma=t.ogma,this.module=t.module,this.enabled=t.enabled===void 0||t.enabled,this.onGetSubgraph=t.onGetSubgraph,this.duration=t.duration||0,this.easing=t.easing||"quadraticOut",this.parentPath=t.parentPath||"parent",this.depthPath=t.depthPath||"depth",this.padding=t.padding||0,this.nodeGenerator=t.nodeGenerator||(()=>({})),this.showContents=t.showContents===void 0||t.showContents,this.onGroupUpdate=t.onGroupUpdate||(()=>Promise.resolve()),this.copyData=t.copyData===void 0||t.copyData,this.context={virtualEdges:this.ogma.edgeList()}}createGrouping(t){var e;const{ogma:s,groupsByDepth:i}=this,n=s.transformations.addNodeGrouping({selector:o=>o.getData(this.depthPath)===t,groupIdFunction:o=>o.getData(this.parentPath),showContents:o=>typeof this.showContents=="boolean"?this.showContents:this.showContents(o,t),onBeforeAddMetaEdges:(o,a)=>this.addEdges(o,a),onGroupUpdate:(o,a,l)=>this.onGroupUpdate(o,a,l,t),padding:o=>typeof this.padding=="number"?this.padding:this.padding(o,t),duration:this.duration,enabled:this.enabled,nodeGenerator:(o,a)=>{const l=this.nodeGenerator(o,a,n);return this.copyData&&(l.data||(l.data={}),l.data={...l.data,...this.dataMap.get(a)}),Yr(l,Ta(this.parentPath),this.treeMap.get(a)),Yr(l,Ta(this.depthPath),t-1),l.id=a,l}});if(!i.size)return i.set(t,n);const r=Array.from(i.keys()).reduce((o,a)=>Math.max(o,a));i.set(t,n),n.setIndex((e=i.get(r))==null?void 0:e.getIndex())}async drill(t){if(this.treeMap.has(t.getId()))return;const{ogma:e,groupsByDepth:s}=this,i=t.getId(),n=this.getGroupId(i);this.treeMap.set(n,t.getData(this.parentPath)),this.dataMap.set(n,t.getData());const r=t.getData(this.depthPath)||0,o=t.getPosition(),a=await this.onGetSubgraph(t);this.edges.set(n,t.getAdjacentEdges().map(d=>{const h=d.getSource().getId(),u=d.getTarget().getId();return{source:h===i?n:h,target:u===i?n:u,data:{...d.getData()}}})),a.nodes.forEach(d=>{Yr(d,Ta(this.parentPath),n),Yr(d,Ta(this.depthPath),r+1),d.attributes||(d.attributes={}),d.attributes.x=o.x,d.attributes.y=o.y}),this.module.pause(),e.removeEdges(t.getAdjacentEdges()),e.removeNode(t),await e.view.afterNextFrame(),await e.addNodes(a.nodes);const l=a.edges.filter(d=>{const h=d.source,u=d.target;if(e.getNode(h)&&e.getNode(u))return!0;const c=e.getNode(h)?u:h;return this.invalidEdges.has(c)?this.invalidEdges.get(c).push(d):this.invalidEdges.set(c,[d]),!1});a.nodes.forEach(d=>{if(!this.invalidEdges.has(d.id))return;const{valid:h,invalid:u}=this.invalidEdges.get(d.id).reduce((c,g)=>(e.getNode(g.source)&&e.getNode(g.target)?c.valid.push(g):c.invalid.push(g),c),{valid:[],invalid:[]});e.addEdges(h),u.length?this.invalidEdges.set(d.id,u):this.invalidEdges.delete(d.id)}),await e.addEdges(l),s.has(r+1)||this.createGrouping(r+1),this.module.resume(),await this.module.afterNextUpdate()}async addEdges(t,e){e.forEach(s=>{const i=this.edges.get(s.getId());i&&this.ogma.addEdges(i,{virtual:!0}).then(n=>{this.context.virtualEdges=this.context.virtualEdges.concat(n)})})}getGroupId(t){return`ogma-group-${t}`}getMaxDepth(){return this.groupsByDepth.size}disable(t){return this.enabled=!1,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach(e=>e.disable(t)),this.module.animations.hideEdges(this.context.virtualEdges._indexes),this.context.virtualEdges.setSelected(!0),this.module.afterNextUpdate()}enable(t){return this.enabled=!0,this.duration=typeof t=="number"?t:this.duration,this.easing=typeof t=="object"?t.easing:this.easing,this.groupsByDepth.forEach(e=>e.enable(t)),this.module.animations.showEdges(this.context.virtualEdges._indexes),this.module.afterNextUpdate().then(()=>this.context.virtualEdges.setVisible(!0))}toggle(t){return this.enabled?this.disable(t):this.enable(t)}setOptions(t){this.onGetSubgraph=t.onGetSubgraph?t.onGetSubgraph:this.onGetSubgraph,this.duration=t.duration!==void 0?t.duration:this.duration,this.easing=t.easing||this.easing,this.parentPath=t.parentPath||this.parentPath,this.depthPath=t.depthPath||this.depthPath,this.padding=t.padding!==void 0?t.padding:this.padding,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.showContents=t.showContents!==void 0?t.showContents:this.showContents,this.onGroupUpdate=t.onGroupUpdate||this.onGroupUpdate,this.copyData=t.copyData!==void 0?t.copyData:this.copyData;const e=this.enabled;return this.enabled=t.enabled!==void 0?t.enabled:this.enabled,this.enabled!==e&&this.groupsByDepth.forEach(s=>this.enabled?s.enable({duration:this.duration,easing:this.easing}):s.disable({duration:this.duration,easing:this.easing})),this.groupsByDepth.forEach(s=>s.refresh()),this.module.afterNextUpdate()}onRemove(t){this.context.virtualEdges=this.context.virtualEdges.filter(e=>!t.has(e._index))}},jR=class{constructor(t){this.drilldowns=[],this.module=t}addDrilldown(t){this.drilldowns.push(t)}removeDrilldown(t){this.drilldowns=this.drilldowns.filter(e=>e!==t)}onRemove(t,e){e||this.drilldowns.forEach(s=>s.onRemove(t))}},HR=class{constructor(t,e){this.enabled=!1,this.relayouted=new Set,this.shouldRelayout=new Set,this.layoutPerGroup=new Map,this.ogma=t,this.module=e,this.ogma.events.on("layoutPrepare",s=>{if(!s.params.nodes)return;const i=s.params.nodes,n=Array.isArray(i)?this.ogma.getNode(i[0])._index:i._indexes[0],r=this.module.nodeToMeta.get(n);if(!r)return;const o={...s,params:{...s.params}};delete o.params.nodes,this.layoutPerGroup.set(r._index,o)})}getNodesToRecompute(t){const e=Array.from(t),s=new Set,i=[];for(;e.length>0;){const n=e.shift();if(s.has(n))continue;i.push(n),s.add(n);const r=this.module.nodeToMeta.get(n);r&&e.push(r._index)}return this.ogma.nodeList(i)}async layoutGroups(t,e,s=!1){this.module.animations.enable(),this.enable();const i=new Map,n=this.ogma.getNodes(t.map(({groupId:a})=>a));t.forEach(({groupId:a,layout:l,params:d},h)=>{i.set(a,()=>this.ogma.layouts[l]({...d,nodes:this.module.metaToNodes.get(n.get(h)._index)}))});const r=this.getNodesToRecompute(n._indexes),o=new Map;r.forEach(a=>o.set(a._index,this.module.nodeToTransformation.get(a._index).getIndex())),r.sort((a,l)=>o.get(a._index)-o.get(l._index));for(let a=0;a<r.size;a++){const l=o.get(r._indexes[a]);let d;for(d=a+1;d<r.size&&o.get(r._indexes[d])===l;d++);const h=r.slice(a,d);a=d-1,await Promise.all(h.map(u=>{this.relayouted.add(u._index);let c=Promise.resolve();if(i.has(u.getId()))c=i.get(u.getId())();else if(s&&this.layoutPerGroup.has(u._index)){const g=this.module.metaToNodes.get(u._index),f=this.layoutPerGroup.get(u._index);c=this.ogma.layouts[f.name]({...f.params,nodes:g})}return c.then(()=>{this.module.groupController.setGroupXYR(u)})}))}return await this.module.groupController.onAfterLayouts(),this.module.animations.apply(e||0).finally(()=>{this.disable(),this.module.animations.disable(),this.relayouted.clear()})}hasRelayouted(t){return this.relayouted.has(t)}enable(){this.enabled=!0}disable(){this.enabled=!1}clear(){this.relayouted.clear(),this.shouldRelayout.clear()}},Ia=14,WR=class{constructor(t,e){this.subNodeOffsetX=new Map,this.subNodeOffsetY=new Map,this.openRadius=new Map,this.isExpanding=new Set,this.alreadyGrouped=new Set,this.openGroups=new Set,this.closeGroups=new Set,this.destroyed=!1,this.nodeLayer=new Map,this.edgeLayer=new Map,this.padding=new Map,this.geoRadius=new Map,this.collapsedGroups=new Set,this.hasUpdated=new Set,this.onGroupsUpdate=()=>Promise.resolve(),this.shouldRunGroupUpdate=!1,this.runningLayouts=!1,this.onSetMultipleAttributes=({elements:i,values:n,options:r,updatedAttributes:o,promises:a})=>{if(this.module.isRefreshing()||this.destroyed||this.runningLayouts||this.module.animations.isApplying())return;const l=new Set(o),d=n;if(!i.isNode||!l.has("x")&&!l.has("y")&&!l.has("radius"))return Promise.resolve();const h=i.toList();if(!h.size)return Promise.resolve();const u=[],c=new Set,g=Array.from(h._indexes);for(;g.length;){const m=g.shift(),_=this.module.nodeToMeta.get(m);if(!_||c.has(_._index))continue;const p=this.getGroupXYR(_,this.module.getSubNodes(_),h,d);p.isGeo?u.push(_.setAttribute("radius",p.radius,r)):(delete p.isGeo,this.closeGroups.has(_._index)||this.collapsedGroups.has(_._index)?(this.openRadius.set(_._index,p.radius),this.module.animations.setXY(_._index,p.x,p.y)):this.module.animations.setXYR(_._index,p.x,p.y,p.radius),c.add(_._index)),g.push(_._index)}const f=h.map((m,_)=>{if(!this.openGroups.has(m._index))return null;const p=m.getPosition();return Array.isArray(d)&&d[_]?(d[_].x!==void 0&&(p.x=d[_].x),d[_].y!==void 0&&(p.y=d[_].y)):(d.x!==void 0&&(p.x=d.x),d.y!==void 0&&(p.y=d.y)),{group:m,position:p}}).filter(m=>m);f.length&&f.forEach(({group:m,position:_})=>this.animateChildren(m,_)),(c.size>0||f.length)&&u.push(this.module.animations.apply(r)),a.push(...u)},this.ogma=t,this.layoutController=new HR(t,e),this.groupLayer=this.ogma.modules.graphics.addAttributeLayer({name:"groups-layer",priority:5.50225,edgeAttributes:{layer:i=>this.edgeLayer.get(i._index)},nodeAttributes:{layer:i=>this.nodeLayer.get(i._index)},nodeDependencies:void 0,edgeDependencies:void 0});const s=t.styles.getClass("_group-fading_");this.fadingClass=s||this.ogma.styles.createClass({name:"_group-fading_",nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this.module=e,t.events.on("setMultipleAttributes",this.onSetMultipleAttributes).on("beforeGeoCameraMove",({zoom:i})=>{const n=this.ogma.nodeList(Array.from(this.geoRadius.keys())).filter(r=>r&&!this.collapsedGroups.has(r._index)&&this.openGroups.has(r._index));n.forEach(r=>{const o=this.geoRadius.get(r._index)*2**i;this.module.animations.setOpenRadius(r._index,o)}),this.ogma.modules.geo._projection&&this.ogma.modules.geo._projection.updateElements(n)}).on(["geoEnabled","beforeGeoDisabled"],()=>this._onToggleGeo()).on("geoNodesMoved",({nodes:i})=>{const n=i._indexes;for(let r=0;r<n.length;r++){const o=this.module.getMetaNode(i.get(r));!o||!this.openGroups.has(o._index)||this.layoutController.shouldRelayout.add(o._index)}}).on(["nodeClassRemoved__hovered","nodeClassAdded__hovered","nodeClassRemoved__selected","nodeClassAdded__selected","nodeClassAdded__hoverExtremityHighlighted","nodeClassRemoved__hoverExtremityHighlighted"],({nodes:i})=>{const n=i._indexes;for(let r=0;r<n.length;r++){const o=i.get(r);if(!this.isOpen(o))continue;const a=o.getAttribute("layer");this.setSubEltsLayer(o,a,!0)}})}setSubEltsLayer(t,e,s){const i=s?1:-1;if(!this.isOpen(t))return;const n=this.module.getSubNodes(t);n.forEach(o=>{this.nodeLayer.set(o._index,e+i),this.setSubEltsLayer(o,e+i,s)});const r=n.getAdjacentEdges({bothExtremities:!0});for(let o=0;o<r.size;o++)this.edgeLayer.set(r._indexes[o],e+i)}closeGroup(t,e,s,i,n=!1){const r=[e],o=this.closeGroups.has(t._index)||this.collapsedGroups.has(t._index);this.openGroups.delete(t._index),this.closeGroups.add(t._index),this.hasUpdated.add(t._index);const a=this.module.animations,l=n?0:a.getCloseRadius(t._index),d=a.getOpenRadius(t._index);if(d!==void 0&&!o&&this.openRadius.set(t._index,d),a.setXYR(t._index,s,i,l),n)return;for(;r.length;){const u=r.shift(),c=u._indexes,g=u.getAdjacentEdges({bothExtremities:!0}),f=new Set;for(let _=0;_<g._indexes.length;_++)f.add(g._indexes[_]);const m=u.getAdjacentEdges({bothExtremities:!1}).filter(_=>!f.has(_._index));a.setXYR(c,s,i,l),a.hideNodesAfter(c),a.hideEdgesAfter(g._indexes),a.hideEdgesAfter(m._indexes),a.pushAfter(()=>{const _=[];for(let p=0;p<c.length;p++){const x=this.closeGroups.has(c[p]);a.deleteOpenRadius(t._index),_.push(x?l:this.openRadius.get(c[p]))}this.module.animations.setRs(u._indexes,_)});for(let _=0;_<c.length;_++){if(!this.openGroups.has(c[_]))continue;const p=u.get(_);this.collapsedGroups.add(p._index);const x=this.module.getSubNodes(u.get(_));x.size&&r.push(x)}}const h=this.module.getMetaNode(t);h&&this.openGroups.has(h._index)&&this.layoutController.shouldRelayout.add(h._index)}setGroupXYR(t){const e=this.getGroupXYR(t,this.module.getSubNodes(t),void 0,void 0);e.isGeo?(this.setGeoLatLng(t,e.y,e.x),this.module.animations.setR(t._index,e.radius)):this.module.animations.setXYR(t._index,e.x,e.y,e.radius)}setGeoLatLng(t,e,s){this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.latitudePath,e,{virtual:!0}),this.ogma.modules.data.setProperty(t,this.ogma.modules.geo.longitudePath,s,{virtual:!0})}expandGroup(t,e,s=!1){const i=this.module.animations,n=t.getPosition();s||(this.openGroups.add(t._index),this.closeGroups.delete(t._index),this.collapsedGroups.delete(t._index)),this.isExpanding.add(t._index),this.hasUpdated.add(t._index);const r=[{subNodes:e,offset:this.getOffset(t._index),isClosed:!1,wasCollapsed:!1}];for(;r.length;){const{subNodes:a,offset:l,isClosed:d,wasCollapsed:h}=r.shift();if((d||h)&&i.pushBefore(()=>a.setAttributes({x:n.x+l.x,y:n.y+l.y},0)),d)continue;const u=a._indexes,c=a.getAdjacentEdges({bothExtremities:!0,filter:"all"});a.setVisible(!0),c.setVisible(!0);for(let g=0;g<u.length;g++){const f=this.closeGroups.has(u[g]),m=this.collapsedGroups.has(u[g]);i.setXYR(u[g],n.x+l.x+this.subNodeOffsetX.get(u[g])||0,n.y+l.y+this.subNodeOffsetY.get(u[g])||0,f?this.module.animations.getCloseRadius(u[g]):this.openRadius.get(u[g])),this.collapsedGroups.delete(u[g]);const _=this.module.getSubNodes(a.get(g));_.size&&r.push({subNodes:_,isClosed:f,wasCollapsed:m,offset:{x:l.x+this.subNodeOffsetX.get(u[g])||0,y:l.y+this.subNodeOffsetY.get(u[g])||0}})}}const o=this.module.getMetaNode(t);o&&this.openGroups.has(o._index)&&this.layoutController.shouldRelayout.add(o._index),i.setXYR(t._index,n.x,n.y,s?0:this.openRadius.get(t._index))}getOffset(t){return this.collapsedGroups.has(t)&&this.subNodeOffsetX.has(t)?{x:this.subNodeOffsetX.get(t),y:this.subNodeOffsetY.get(t)}:{x:0,y:0}}restorePositions(t,e){const s=t.getPosition(),i=(e=e.filter(o=>!o.isVirtual()))._indexes,n=this.getOffset(t._index),r=[];for(let o=0;o<i.length;o++)r.push({x:n.x+s.x+this.subNodeOffsetX.get(i[o])||0,y:n.x+s.y+this.subNodeOffsetY.get(i[o])||0});e.setAttributes(r,0)}animateChildren(t,e){const s=[{parent:t,position:e}];for(;s.length;){const{parent:i,position:n}=s.shift();if(!i.isNode)continue;const r=this.module.getSubNodes(i);r.size&&r.forEach(o=>{const a=this.subNodeOffsetX.get(o._index)||0,l=this.subNodeOffsetY.get(o._index)||0,d={x:n.x+a,y:n.y+l};this.module.animations.setXY(o._index,d.x,d.y),s.push({parent:o,position:d})})}}addOpenGroup(t){this.openGroups.add(t._index),this.closeGroups.delete(t._index)}isOpen(t){return this.openGroups.has(t._index)}isClose(t){return this.closeGroups.has(t._index)}setPadding(t,e){const s=new Set,i=isNaN(+e),n=e;return t.forEach(r=>{const o=i?n(r):+e;this.padding.get(r._index)!==o&&s.add(r._index),this.padding.set(r._index,o)}),s}getGroupXYR(t,e,s,i){let n,r,o;const a=this.module.animations,l=this.ogma.geo.enabled();if(n=new Array(e.size).fill(0),r=new Array(e.size).fill(0),o=new Array(e.size).fill(0),l){const f=e.getData(this.ogma.modules.geo.latitudePath),m=e.getData(this.ogma.modules.geo.longitudePath);n=[],r=[],o=[];for(let _=0;_<f.length;_++){const{x:p,y:x}=this.ogma.geo.getMap().project({lat:f[_],lng:m[_]},Ia);n.push(p),r.push(x),o.push(2**Ia*this.geoRadius.get(e._indexes[_])||10)}}else{const f=this.ogma.modules.graphics.getAttributesManager()._layerController.nodes._currentFlexArrays,m=this.openGroups.has(t._index),_=this.isExpanding.has(t._index),p=m&&!_?f.radius:a.getInputFlexArrays().radius;for(let x=0;x<e.size;x++)n[x]=f.x.get(e._indexes[x]),r[x]=f.y.get(e._indexes[x]),o[x]=p.get(e._indexes[x])}if(s&&i&&s.isNode){const f=s._indexes,m=new Map,_=new Map,p=new Map;for(let y=0;y<f.length;y++){const b=Array.isArray(i)?i[y]:i;!isNaN(b.x)&&m.set(f[y],b.x),!isNaN(b.y)&&_.set(f[y],b.y),!isNaN(b.radius)&&p.set(f[y],b.radius)}const x=e._indexes;for(let y=0;y<x.length;y++)m.has(x[y])&&(n[y]=m.get(x[y])),_.has(x[y])&&(r[y]=_.get(x[y])),p.has(x[y])&&(o[y]=p.get(x[y]))}const d=e._indexes;for(let f=0;f<d.length;f++)this.openRadius.has(d[f])&&(o[f]=this.openRadius.get(d[f]));if(!l)for(let f=0;f<d.length;f++)a.xs.get(d[f])!==void 0&&(n[f]=a.xs.get(d[f])),a.ys.get(d[f])!==void 0&&(r[f]=a.ys.get(d[f])),a.rs.get(d[f])!==void 0&&(o[f]=a.rs.get(d[f]));let h=0,u=0,c=0;const g=qc.algorithms.minDisk(n,r,o);if(h=g[0],u=g[1],c=g[2],c+=this.padding.get(t._index)||0,l){const{lat:f,lng:m}=this.ogma.geo.getMap().unproject({x:h,y:u},Ia);h=m,u=f,c/=2**Ia,this.geoRadius.set(t._index,c),c*=2**this.ogma.geo.getZoom()}else this.openRadius.set(t._index,c),e.forEach((f,m)=>{this.subNodeOffsetX.set(f._index,n[m]-h),this.subNodeOffsetY.set(f._index,r[m]-u)});return{x:h,y:u,radius:c,isGeo:l}}async onAfterLayouts(){const t=this.module.animations,e=this.module.getList().filter(r=>r.getName()===is.NodeGrouping&&r.isEnabled()),s=[];let i=!1;for(let r=e.length-1;r>=0;r--)e[r].getContext().metaNodes.forEach(o=>{if(o.getMetaNode())return;i||(i=this.hasUpdated.has(o._index)||this.layoutController.relayouted.has(o._index)||this.layoutController.shouldRelayout.has(o._index));const a=!this.collapsedGroups.has(o._index)&&!this.closeGroups.has(o._index);s.push({group:o,collapsed:!a})});if(i||this.shouldRunGroupUpdate){this.shouldRunGroupUpdate=!1;const r=this.ogma.getNodes().filter(l=>!this.module.nodeToMeta.has(l._index)),o=new Array(r.size);for(let l=0;l<r.size;l++)o[l]=this.openRadius.get(r._indexes[l])||this.module.animations.getCloseRadius(r._indexes[l])||0;const a=await this.onGroupsUpdate(r,o);this.module.animations.handleGlobalLayout(a&&Array.isArray(a)?a:null,r._indexes)}const n=new Set;for(;s.length;){const{group:r,collapsed:o}=s.shift();if(n.has(r._index))continue;n.add(r._index);const a=this.module.getSubNodes(r),l=a._indexes,d=t.xs.get(r._index),h=t.ys.get(r._index);if(d!==void 0&&h!==void 0){if(o){t.deleteOpenRadius(r._index);for(let u=0;u<l.length;u++)t.setXY(l[u],d,h)}else for(let u=0;u<l.length;u++)t.setXY(l[u],d+this.subNodeOffsetX.get(l[u])||0,h+this.subNodeOffsetY.get(l[u])||0);for(let u=0;u<l.length;u++)this.module.isVirtual(l[u],!0)&&s.push({group:a.get(u),collapsed:this.collapsedGroups.has(l[u])||this.closeGroups.has(l[u])||o})}}this.hasUpdated.clear(),this.layoutController.clear(),this.isExpanding.clear()}cleanup(t,e,s){let i=t._indexes;for(let n=0;n<i.length;n++)this.padding.delete(i[n]),this.openGroups.delete(i[n]),this.closeGroups.delete(i[n]),this.nodeLayer.delete(i[n]);for(let n=0;n<e.size;n++)this.edgeLayer.delete(e._indexes[n]);if(s){i=s._indexes;for(let n=0;n<i.length;n++)this.subNodeOffsetX.delete(i[n]),this.subNodeOffsetY.delete(i[n])}}getPositions(t,e){const{x:s,y:i}=t.getPosition();return e.map(n=>({x:s+(this.subNodeOffsetX.get(n._index)||0),y:i+(this.subNodeOffsetY.get(n._index)||0)}))}hideSubNodes(t){const e=[t];for(;e.length;){const s=e.pop();s.setVisible(!1);for(let i=0;i<s._indexes.length;i++)this.collapsedGroups.add(s._indexes[i]),this.openGroups.has(s._indexes[i])&&e.push(this.module.getSubNodes(s.get(i)))}}onRemove(t,e){if(!e)return;const s=[],i=new Set;for(let n=0;n<t.length;n++){const r=this.module.nodeToMeta.get(t[n]);r&&this.openGroups.has(r._index)&&(this.layoutController.shouldRelayout.add(r._index),s.push(r._index))}for(;s.length;){const n=s.shift();if(i.has(n))continue;i.add(n);const r=this.module.nodeToMeta.get(n);r&&this.openGroups.has(r._index)&&(this.layoutController.shouldRelayout.add(r._index),s.push(r._index))}}triggerGroupsUpdate(){this.shouldRunGroupUpdate=!0}layoutGroups(t,e,s=!1){return this.runningLayouts=!0,this.layoutController.layoutGroups(t,e,s).finally(()=>{this.runningLayouts=!1})}_onToggleGeo(){this.geoRadius.clear();const t=this.module.getList().find(s=>s.getName()===is.NodeGrouping);if(!t)return;const e=Array.from(this.openGroups.keys());for(let s=0;s<e.length;s++)this.layoutController.shouldRelayout.add(e[s]);t.refresh()}startRefresh(){this.alreadyGrouped.clear()}clear(){this.subNodeOffsetX.clear(),this.subNodeOffsetY.clear(),this.openRadius.clear(),this.isExpanding.clear(),this.layoutController.clear(),this.alreadyGrouped.clear(),this.openGroups.clear(),this.closeGroups.clear(),this.nodeLayer.clear(),this.edgeLayer.clear(),this.padding.clear(),this.geoRadius.clear(),this.collapsedGroups.clear(),this.hasUpdated.clear()}destroy(){this.destroyed||(this.destroyed=!0,this.ogma.events.off(this.onSetMultipleAttributes))}},XR=class{constructor(t){this.ogma=t}save(){this.selectedNodes=this.ogma.getSelectedNodes(),this.selectedEdges=this.ogma.getSelectedEdges(),this.ogma.modules.selection.disableEvents&&this.ogma.modules.selection.disableEvents()}restore(){const t=this.selectedNodes.filter(s=>!this.ogma.getNode(s.getId())||!s.isVisible()),e=this.selectedEdges.filter(s=>!this.ogma.getEdge(s.getId())||!s.isVisible());t.size&&this.ogma.modules.events.fire("nodesUnselected",{nodes:t}),e.size&&this.ogma.modules.events.fire("edgesUnselected",{edges:e}),this.selectedNodes.filter(s=>!!this.ogma.getNode(s.getId())&&!s.isSelected()).setSelected(!0),this.selectedEdges.filter(s=>this.ogma.getEdge(s.getId())&&!s.isSelected()).setSelected(!0),this.ogma.modules.selection.enableEvents&&this.ogma.modules.selection.enableEvents()}cleanup(){this.selectedNodes=void 0,this.selectedEdges=void 0,this.ogma.modules.selection.enableEvents&&this.ogma.modules.selection.enableEvents()}},YR={setData:!1,addElement:!0,removeElement:!0,setOptions:!1,refresh:!1},$R=class mu{constructor(){this.prev={},this.next={},this.prevorder=[],this.nextorder=[],this.shouldAnimate=!1,this.minRefreshIndex=0}addTransformation(e,s){this.next[e]=s,this.nextorder.push(e)}removeTransformation(e){delete this.next[e]}setIndex(e,s){const i=this.nextorder.indexOf(e);this.nextorder.splice(i,1),this.nextorder.splice(s,0,e),this.minRefreshIndex=Math.min(this.minRefreshIndex,i,s)}setEnabled(e,s){this.next[e]=s}isEnabled(e){return this.prev[e]||!1}static getDiff(e,s){const i=new Map;for(const n in e)s[n]!==void 0?s[n]!==e[n]&&i.set(+n,{shouldDo:s[n],shouldUndo:e[n]}):i.set(+n,{shouldDo:!1,shouldUndo:e[n],shouldCleanup:!0});for(const n in s)e[n]===void 0&&s[n]===!0&&i.set(+n,{shouldDo:!0,shouldUndo:!1});return i}getFirstChange(e){const{nextorder:s}=this;let i=s.length;for(let n=0;n<s.length;n++){const r=e.get(s[n]);if(r&&(r.shouldUndo||r.shouldDo)){i=n;break}}return i}refreshFrom(e,s){const{nextorder:i}=this;for(let n=s;n<this.nextorder.length;n++)e.set(i[n],{shouldUndo:this.prev[i[n]],shouldDo:this.prev[i[n]],...e.get(i[n])||{}});return e}isDirty(){const e=mu.getDiff(this.prev,this.next),s=Math.min(this.minRefreshIndex,this.getFirstChange(e));return(e.size>0||s<this.nextorder.length)&&{reason:e.size>0?"diff":"refresh",index:s}}invalidateFrom(e,s){this.shouldAnimate||(this.shouldAnimate=YR[s]),this.minRefreshIndex=Math.min(this.minRefreshIndex,e)}step(){const e=mu.getDiff(this.prev,this.next);this.prev={...this.next};const s=Math.min(this.minRefreshIndex,this.getFirstChange(e)),i=this.nextorder.reduce((o,a,l)=>o.set(a,l),new Map),n=this.prevorder.reduce((o,a,l)=>o.set(a,l),new Map);this.nextorder=this.nextorder.filter(o=>this.prev[o]!==void 0),this.prevorder=[...this.nextorder],this.minRefreshIndex=this.nextorder.length;const r=this.shouldAnimate;return this.shouldAnimate=!1,{diff:this.refreshFrom(e,s),nextorder:i,prevorder:n,shouldAnimate:r}}done(){}},ZR=class{constructor(t){this.transformations=[],this.nodeToTransformation=new Map,this.edgeToTransformation=new Map,this.nodeVirtual=new Set,this.edgeVirtual=new Set,this.nodeToMeta=new Map,this.edgeToMeta=new Map,this.metaToNodes=new Map,this.metaToEdges=new Map,this._onDestroy=()=>{this.destroy(),this.ogma.events.off(this._onFrame)},this._onFrame=()=>this.refresh(),this._onAddElements=({nodes:e,edges:s,virtual:i})=>{if(i){if(e)for(let n=0;n<e.size;n++)this.nodeVirtual.add(e._indexes[n]);if(s)for(let n=0;n<s.size;n++)this.edgeVirtual.add(s._indexes[n])}else this.state.invalidateFrom(0,"addElement"),this.invalidate()},this._onSetData=({elements:e,virtual:s})=>{if(s)return;const{isNode:i,_indexes:n}=e;let r=1/0;for(const o of n){const a=this.getTransformation(o,i);if(!a){r=0;break}r=Math.min(r,a.getIndex())}return this.state.invalidateFrom(r,"setData"),this.invalidate(),r},this._onRequestElementsToDelete=e=>{const{elementsToRemove:s}=e,i=s.isNode,n=s._indexes,r=this.getLeafElements(n,i);e.elementsToRemove=i?this.ogma.nodeList(r):this.ogma.edgeList(r)},this._onAfterRemoveElements=({nodes:e,edges:s})=>{if(!this.ogma.isDestroyed()){if(e)for(let i=0;i<e.size;i++)this.nodeVirtual.delete(e._indexes[i]);if(s)for(let i=0;i<s.size;i++)this.edgeVirtual.delete(s._indexes[i])}},this._onRemoveElements=({nodes:e,edges:s,virtual:i})=>{i||this.ogma.isDestroyed()||this._refreshPromise.then(()=>{const n=!!e,r=n?e._indexes:s._indexes,o=new Set(r);this.transformations.forEach(a=>a.onRemove(o,n)),this.groupController.onRemove(r,n),this.drilldownController.onRemove(o,n),this.nodeToMeta.clear(),this.edgeToMeta.clear(),this.metaToNodes.clear(),this.metaToEdges.clear(),this.nodeToTransformation.clear(),this.edgeToTransformation.clear(),this.state.invalidateFrom(0,"removeElement"),this.invalidate()})},this._onClearGraph=()=>{this.transformations.forEach(e=>{e.cleanup()}),this.groupController.clear(),this.nodeToMeta.clear(),this.edgeToMeta.clear(),this.metaToNodes.clear(),this.metaToEdges.clear(),this.nodeToTransformation.clear(),this.edgeToTransformation.clear(),this.state.invalidateFrom(0,"removeElement"),this.invalidate()},this.ogma=t,this.state=new $R,this.animations=new kR(t),this._shouldRefresh=!1,this._refreshing=!1,this.isDestroyed=!1,this.isPaused=!1,this.selection=new XR(t),this._refreshPromise=Promise.resolve(),this.groupController=new WR(t,this),this.drilldownController=new jR(this),this.ogma.events.on("frame",this._onFrame).on("setData",this._onSetData).on(["addNodes","addEdges"],this._onAddElements).on(["removeNodes","removeEdges"],this._onRemoveElements).on("clearGraph",this._onClearGraph).on(["afterRemoveNodes","afterRemoveEdges"],this._onAfterRemoveElements).on("requestElementsToDelete",this._onRequestElementsToDelete).on("destroy",this._onDestroy)}addTransformation(t,e=!0){this.state.addTransformation(t.getId(),e),this.transformations.push(t),this.invalidate()}removeTransformation(t){const e=this.transformations.indexOf(t);e!==-1&&this.transformations.splice(e,1),this.invalidate()}async step(t=0,e={fireEnabled:[],fireDisabled:[],fireRefresh:[],fireDestroy:[],fireSetIndex:[]}){var s;if(t>5)throw new Error("Ogma transformations: Transformations refresh in loop");const{diff:i,prevorder:n,nextorder:r}=this.state.step(),{fireEnabled:o,fireDisabled:a,fireRefresh:l,fireDestroy:d,fireSetIndex:h}=e,u=[],c=[],g=[];this.groupController.startRefresh();for(const m of this.transformations){const _=m.getId();if(!i.has(_))continue;const{shouldDo:p,shouldUndo:x,shouldCleanup:y}=i.get(_);p&&!x?o.push(m):x&&!p?a.push(m):p&&x&&l.push(m),n.has(_)&&n.get(_)!==r.get(_)&&h.push(m),x&&u.push(m),p&&c.push(m),y&&(d.push(m),g.push(m))}let f=0;u.sort((m,_)=>n.get(_.getId())-n.get(m.getId())||0);for(const m of u){const _=!((s=i.get(m.getId()))!=null&&s.shouldDo);_&&(f=this.animations.getMaxAnimation(f,m.getAnimation())),await m.undo(_)}c.sort((m,_)=>r.get(m.getId())-r.get(_.getId())||0);for(let m=0;m<c.length;m++){const _=c[m],p=m===c.length-1;p&&(f=this.animations.getMaxAnimation(f,_.getAnimation())),await _.run(p)}for(const m of g)await m.cleanup();if(await this.groupController.onAfterLayouts(),await this.animations.apply(f),!this.isDestroyed)return this.state.isDirty()?this.step(t+1,e):e}refresh(){!this._shouldRefresh||this._refreshing||this.isDestroyed||this.isPaused||(this._shouldRefresh=!1,this._refreshing=!0,this._refreshPromise=this._refreshPromise.then(()=>(this.animations.enable(),this.selection.save(),this.step().then(t=>{this.animations.disable(),this._refreshing=!1;const{fireEnabled:e,fireDisabled:s,fireRefresh:i,fireDestroy:n,fireSetIndex:r}=t,o=this.ogma.modules.events;s.reverse().forEach(a=>o.fire("transformationDisabled",{target:a})),e.forEach(a=>o.fire("transformationEnabled",{target:a})),r.forEach(a=>o.fire("transformationSetIndex",{target:a})),i.forEach(a=>o.fire("transformationRefresh",{target:a})),n.forEach(a=>o.fire("transformationDestroyed",{target:a}))}).finally(()=>{this.selection.restore(),this.selection.cleanup(),this.animations.disable()}))).catch(t=>{const e=this.state.isDirty();if(!e)throw new Error(`Ogma transformations, refresh failed.
${t.stack}`);const s=e.reason==="diff"?"You are constantly adding/removing/changing index of a transformation":"You are constantly adding/removing/updating nodes or edges while transformations refresh";throw new Error(`Ogma transformations, refresh failed.
${s}`)}).catch(t=>{if(!this.onRefreshError)throw t;this.onRefreshError(t)}).finally(()=>{}))}enable(t){return this.state.setEnabled(t.getId(),!0),this.invalidate(),this.afterNextUpdate()}disable(t){return this.state.setEnabled(t.getId(),!1),this.invalidate(),this.afterNextUpdate()}remove(t){return this.disable(t),this.state.removeTransformation(t.getId()),this.afterNextUpdate().then(()=>{this.transformations.splice(this.getIndex(t),1)})}isEnabled(t){return this.state.isEnabled(t.getId())}getList(){return this.transformations.slice()}getIndex(t){for(let e=0;e<this.transformations.length;e++)if(this.transformations[e]===t)return e;return-1}setIndex(t,e){const s=this.getIndex(t);this.state.setIndex(t.getId(),e),this.transformations.splice(s,1),this.transformations.splice(e,0,t),this.invalidate()}setOptions(t){this.state.invalidateFrom(this.getIndex(t),"setOptions"),this.invalidate()}refreshTransformation(t){this.state.invalidateFrom(this.getIndex(t),"refresh"),this.invalidate()}clear(){return this.transformations.forEach(t=>t.destroy(0)),this.invalidate(),this.afterNextUpdate()}destroy(){this.transformations.forEach(t=>t.destroy(0)),this.groupController.destroy(),this._refreshPromise=Promise.resolve(),this.isDestroyed=!0}invalidate(){this._refreshing||this.ogma.isDestroyed()||(this._shouldRefresh=!0,this.ogma.modules.dom.refresh())}afterNextUpdate(){return this.ogma.view.afterNextFrame().then(()=>this._refreshPromise)}getTransformation(t,e){return e?this.nodeToTransformation.get(t):this.edgeToTransformation.get(t)}setTransformation(t,e,s){s?this.nodeToTransformation.set(t,e):this.edgeToTransformation.set(t,e)}deleteTransformation(t){const e=t.isNode?this.nodeToTransformation:this.edgeToTransformation,s=t._indexes;for(const i of s)e.delete(i)}setMetaNode(t,e){this.nodeToMeta.set(t,e)}setSubNodes(t,e){this.metaToNodes.set(t,e)}removeMetaNodes(t){const e=t._indexes;for(const s of e){const i=this.metaToNodes.get(s);i&&i.forEach(n=>this.nodeToMeta.delete(n._index)),this.nodeToTransformation.delete(s),this.metaToNodes.delete(s)}}removeMetaEdges(t){const e=t._indexes;for(const s of e){const i=this.metaToEdges.get(s);i&&i.forEach(n=>this.edgeToMeta.delete(n._index)),this.edgeToTransformation.delete(s),this.metaToEdges.delete(s)}}clearSubNodes(t){this.metaToNodes.delete(t)}clearMetaNode(t){this.nodeToMeta.delete(t)}setMetaEdge(t,e){this.edgeToMeta.set(t,e)}setSubEdges(t,e){this.metaToEdges.set(t,e)}clearSubEdges(t){this.metaToEdges.delete(t)}clearMetaEdge(t){this.edgeToMeta.delete(t)}getMetaNode(t){return this.nodeToMeta.get(t._index)||null}getMetaEdge(t){return this.edgeToMeta.get(t._index)||null}getLeafElements(t,e){const s=[t],i=e?this.metaToNodes:this.metaToEdges,n=[];for(;s.length;){const r=s.pop();for(let o=0;o<r.length;o++){n.push(r[o]);const a=i.get(r[o]);a&&s.push(a._indexes)}}return n}getSubElements(t){const e=t.isNode?this.metaToNodes:this.metaToEdges,s=t.toList()._indexes;let i=t.isNode?this.ogma.nodeList():this.ogma.edgeList();for(let n=0;n<s.length;n++){const r=e.get(s[n]);r&&(i=i.concat(r))}return i}getSubNodes(t){return this.getSubElements(t)}getSubEdges(t){return this.getSubElements(t)}getById(t){return this.transformations.find(e=>e.getId()===t)}isIntraEdge(t){const e=t.getSource()._index;return this.nodeToMeta.has(e)&&this.nodeToMeta.get(e)===this.nodeToMeta.get(t.getTarget()._index)}isVirtual(t,e){return e?this.nodeVirtual.has(t):this.edgeVirtual.has(t)}isRefreshing(){return this._refreshing}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.refresh()}},ds="_transparent",fr=t=>!0,KR=()=>{};function G0(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach((s,i)=>e.push(i)),e}function Cl(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach(s=>e.push(s)),e}function i_(t){return!(!t||t.constructor!==Object&&t.constructor)}var pn=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)i.hasOwnProperty(n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):i_(e[n])&&i_(i[n])?e[n]=pn(e[n],i[n]):e[n]=i[n])}return e};function QR(t){return Array.isArray(t)?t:[t]}var _u=()=>!0,V0=()=>!1,JR=()=>null,tF=class extends rn{constructor(t){super(t),this.nodeSelector=t.criteria||fr}setOptions(t){return this.nodeSelector=t.criteria||this.nodeSelector,super.setOptions(t)}getName(){return is.NodeFilter}run(){const t=this.nodeSelector,e=this.ogma.getNodes().filter(a=>!t||!t(a)),s=e.getAdjacentEdges();this.module.animations.hideNodes(e._indexes),this.module.animations.hideEdges(s._indexes),e.setVisible(!1),s.setVisible(!1);const i=e.subtract(this.context.hiddenNodes),n=s.subtract(this.context.hiddenEdges),r=this.context.hiddenNodes.subtract(e),o=this.context.hiddenEdges.subtract(s);return this.module.animations.pushBefore(()=>{r.setVisible(!0),r.setVisible(!0),n.setVisible(!0),i.setVisible(!0),r.addClass(ds),o.addClass(ds)}),this.module.animations.push(()=>Promise.all([o.removeClass(ds,this.animation),r.removeClass(ds,this.animation),i.addClass(ds,this.animation),n.addClass(ds,this.animation)])),this.context={...this.context,hiddenNodes:e,hiddenEdges:s},Promise.resolve()}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s}=this.context,i=t?this.animation:0;return e.setExcluded(!1),s.setExcluded(!1),t&&(e.addClass(ds),s.addClass(ds),this.module.animations.push(()=>Promise.all([e.removeClass(ds,i),s.removeClass(ds,i)])),this.context.hiddenNodes=this.ogma.nodeList(),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e?this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index)):this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}resetContext(){this.context={...this.context,hiddenEdges:this.ogma.edgeList(),hiddenNodes:this.ogma.nodeList()}}},eF=class extends rn{constructor(t){super(t),this.edgeSelector=t.criteria||fr}setOptions(t){return this.edgeSelector=t.criteria||this.edgeSelector,super.setOptions(t)}getName(){return is.EdgeFilter}run(){const t=this.edgeSelector,e=this.ogma.getEdges().filter(r=>!t||!t(r)),s=this.module.animations;e.setVisible(!1);const i=e.subtract(this.context.hiddenEdges),n=this.context.hiddenEdges.subtract(e);return this.module.animations.pushBefore(()=>{i.setVisible(!0),n.setVisible(!0),n.addClass(ds)}),s.hideEdges(e._indexes),s.push(()=>Promise.all([n.removeClass(ds,this.animation),i.addClass(ds,this.animation)])),this.context={...this.context,hiddenEdges:e},Promise.resolve()}undo(t=!0){super.undo(t);const{hiddenEdges:e}=this.context,s=t?this.animation:0;return e.setExcluded(!1),t&&(e.addClass(ds),this.module.animations.push(()=>Promise.all([e.removeClass(ds,s)])),this.context.hiddenEdges=this.ogma.edgeList()),Promise.resolve()}onRemove(t,e){e||(this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index)))}resetContext(){this.context={...this.context,hiddenEdges:this.ogma.edgeList()}}},Te="_faded",sF=class extends rn{constructor(t){super(t),this.selector=t.selector||V0,this.dataFunction=t.dataFunction||KR}getName(){return is.NeighborMerging}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=[],r=new Map;for(let c=0;c<i.size;++c){const g=i.get(c),f=g.getAdjacentEdges(),m=this.dataFunction(g);for(let _=0;_<f.size;++_){const p=f.get(_),x=p.getSource(),y=p.getTarget();if(x!==y&&m!==void 0){const b=x===g?y:x;let v=r.get(b);v||(v=[],r.set(b,v)),v.push(m)}n.push(p)}}const o=e.getEdges(n),a=e.getNodes(G0(r)),l=Cl(r),d=a.getData(),h=new Array(a.size);for(let c=0;c<h.length;++c){const g=l[c];let f=d[c];for(let m=0;m<g.length;++m)f=pn(f,g[m]);h[c]=f}const u=this.module.animations;return u.hideNodes(i._indexes),u.hideEdges(o._indexes),u.push(()=>Promise.all([i.addClass(Te,s),o.addClass(Te,s)]).then(()=>{this.ogma.modules.data.setProperty(a,null,h,{dispatch:!0,virtual:!0})})),this.context={...this.context,hiddenNodes:i,hiddenEdges:o,nodesWithDataChange:a,oldDataList:d},Promise.resolve()}resetContext(){super.resetContext(),this.context={...this.context,hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),nodesWithDataChange:this.ogma.nodeList(),oldDataList:[]}}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,nodesWithDataChange:i,oldDataList:n}=this.context,r=t?this.animation:0,o=this.module.animations;return this.context.hiddenEdges=this.ogma.edgeList(),this.context.hiddenNodes=this.ogma.nodeList(),this.context.nodesWithDataChange=this.ogma.nodeList(),this.context.oldDataList=[],e.setVisible(!0),s.setVisible(!0),o.pushBefore(()=>{e.addClass(Te),s.addClass(Te)}),o.push(()=>Promise.all([e.removeClass(Te,r),s.removeClass(Te,r)]).then(()=>{this.ogma.modules.data.setProperty(i,null,n,{dispatch:!0,virtual:!0})})),Promise.resolve()}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index))),this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}cleanup(){return Promise.resolve()}setOptions(t){return this.selector=t.selector||this.selector,this.dataFunction=t.dataFunction||this.dataFunction,super.setOptions(t)}};function iF(t){return t!=null}var nF=(t,e)=>({source:t.getId(),target:e.getId()}),rF=class extends rn{constructor(t){super(t);const{selector:e=_u,neighborIdFunction:s=JR,nodeGenerator:i=()=>({}),edgeGenerator:n=nF}=t;this.neighborIdFunction=s,this.selector=e,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i,this.edgeGenerator=n}getName(){return is.NeighborGeneration}run(t=!0){const{ogma:e,id:s}=this,i=t?this.animation:0,n=e.getNodes(),r=new Map;for(let c=0;c<n.size;++c){const g=n.get(c),f=(oF(this.generateIds(g))||[]).filter(iF);if(f)for(const m of f){let _=r.get(m);_||(_=[],r.set(m,_)),_.push(g)}}const o=new Array(r.size),a=[],l=G0(r),d=Cl(r).map(c=>e.getNodes(c));for(let c=0;c<o.length;++c){const g=l[c],f=d[c],m=this.nodeGenerator(g,f);m.id=`_gen_${s}_${g}`;const _=zR(f.getPosition());m.attributes=m.attributes||{},m.attributes.x=_.x,m.attributes.y=_.y,o[c]=m}let h,u;return e.addNodes(o.map(c=>({id:c.id,attributes:c.attributes})),{virtual:!0}).then(()=>{h=e.getNodes(o.map(g=>g.id));const c=h._indexes;this.context.virtualNodes&&this.module.removeMetaNodes(this.context.virtualNodes);for(let g=0;g<h.size;g++)this.module.setTransformation(c[g],this,!0),this.module.setSubNodes(c[g],this.ogma.createNodeList());h.replaceOriginalAttributes(o.map(g=>g.attributes),["x","y"]),this.ogma.modules.data.setProperty(h,null,o.map(g=>g.data),{dispatch:!0,virtual:!0});for(let g=0;g<h.size;++g){const f=h.get(g),m=d[g];for(let _=0;_<m.size;++_){const p=m.get(_),x=this.edgeGenerator(p,f);!x.source&&!x.target&&(x.source=p.getId(),x.target=f.getId()),x.id||(x.id=`${x.source}-${x.target}`),a.push(x)}}return e.addEdges(a,{virtual:!0})}).then(()=>{u=e.getEdges(a.map(g=>g.id));const c=u._indexes;this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);for(let g=0;g<u.size;g++)this.module.setTransformation(c[g],this,!1),this.module.setSubEdges(c[g],this.ogma.createEdgeList());this.context={virtualEdges:u,virtualNodes:h},e.removeNodes(this.context.virtualNodes.subtract(h),{virtual:!0}),e.removeEdges(this.context.virtualEdges.subtract(u),{virtual:!0}),h.setVisible(!0),u.setVisible(!0),this.module.animations.pushBefore(()=>{h.addClass(Te),u.addClass(Te)}),this.module.animations.push(()=>Promise.all([h.removeClass(Te,i),u.removeClass(Te,i)]))})}undo(t=!0){const{virtualNodes:e,virtualEdges:s}=this.context;if(!s||!e)return Promise.resolve(this.context);const i=t?this.animation:0,n=this.module.animations;t?(n.hideNodes(e._indexes),n.hideEdges(s._indexes),n.push(()=>Promise.all([e.addClass(Te,i),s.addClass(Te,i)]))):(e.setVisible(!1),s.setVisible(!1))}onRemove(){}cleanup(){const{virtualEdges:t,virtualNodes:e}=this.context;return t&&e&&(this.module.removeMetaNodes(e),this.module.removeMetaEdges(t),this.ogma.removeNodes(e,{virtual:!0}),this.ogma.removeEdges(t,{virtual:!0}),this.context.virtualEdges=this.ogma.edgeList(),this.context.virtualNodes=this.ogma.nodeList()),Promise.resolve()}setOptions(t){const{selector:e,neighborIdFunction:s,nodeGenerator:i,edgeGenerator:n}=t;return this.selector=e||this.selector,this.neighborIdFunction=s||this.neighborIdFunction,this.generateIds=r=>this.selector(r)&&this.neighborIdFunction(r)||null,this.nodeGenerator=i||this.nodeGenerator,this.edgeGenerator=n||this.edgeGenerator,super.setOptions(t)}resetContext(){super.resetContext(),this.context={...this.context,virtualNodes:this.ogma.nodeList(),virtualEdges:this.ogma.edgeList()}}};function oF(t){return Array.isArray(t)?t:t?[t]:null}function aF(t,e){return t.size===e.size&&t.filter(s=>e.includes(s)).size>0}var lF=class extends rn{constructor(t){super(t),this.selector=t.selector||V0,this.edgeGenerator=t.edgeGenerator||(()=>({}))}getName(){return is.NodeCollapsing}resetContext(){this.context={hiddenNodes:this.ogma.nodeList(),hiddenEdges:this.ogma.edgeList(),virtualEdges:this.ogma.edgeList()}}run(t=!0){const{ogma:e}=this,s=t?this.animation:0,i=e.getNodes().filter(this.selector),n=i.getAdjacentEdges(),r=[],o=i.map(l=>l.getAdjacentNodes().filter(d=>!this.selector(d)));for(let l=0;l<i.size;l++)for(let d=l;d<i.size;d++){const h=i.get(l),u=i.get(d);if(this.ogma.modules.graph.getEdgesBetweenTwoNodes(h,u).size>0&&(o[l].size||o[d].size)&&!aF(o[l],o[d]))throw Error(`addNodeCollapsing: invalid connected nodes [${h.getId()}] and [${u.getId()}] to be collapsed. The addNodeCollapsing function supports only disconnected nodes.`)}const a=new Map;for(let l=0;l<i.size;++l){const d=i.get(l),h=o[l];for(let u=0;u<h.size-1;++u){const c=h.get(u),g=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,c);if(c!==d)for(let f=u+1;f<h.size;++f){const m=h.get(f),_=this.ogma.modules.graph.getEdgesBetweenTwoNodes(d,m),p=this.edgeGenerator(d,c,m,g,_);if(p){const x=QR(p);for(let y=0;y<x.length;++y)r.push(dF(e,x[y],y,d,c,m,g,_)),a.set(r[r.length-1].id,g.concat(_))}}}}return e.addEdges(r,{virtual:!0}).then(()=>{const l=this.ogma.getEdges(r.map(u=>u.id));this.context.virtualEdges&&this.module.removeMetaEdges(this.context.virtualEdges);const d=l._indexes;for(let u=0;u<l.size;u++){this.module.setTransformation(d[u],this,!1);const c=a.get(l.get(u).getId());this.module.setSubEdges(d[u],c);for(let g=0;g<c.size;g++)this.module.setMetaEdge(c._indexes[g],l.get(u))}e.removeEdges(this.context.virtualEdges.subtract(l),{virtual:!0});const h=this.module.animations;l.setVisible(!0),h.pushBefore(()=>l.addClass(Te)),h.push(()=>Promise.all([l.removeClass(Te,s),i.addClass(Te,s),n.addClass(Te,s)])),h.hideNodes(i._indexes),h.hideEdges(n._indexes),this.context={hiddenEdges:n,hiddenNodes:i,virtualEdges:l}})}undo(t=!0){const{hiddenNodes:e,hiddenEdges:s,virtualEdges:i}=this.context,n=t?this.animation:0,r=this.module.animations;return e.setVisible(!0),s.setVisible(!0),t?(r.hideEdges(i._indexes),r.pushBefore(()=>Promise.all([e.addClass(Te),s.addClass(Te)])),r.push(()=>Promise.all([i.addClass(Te,n),e.removeClass(Te,n),s.removeClass(Te,n)]))):i.setVisible(!1),Promise.resolve()}cleanup(){const t=this.context.virtualEdges||this.ogma.createEdgeList();return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then(()=>{this.resetContext()})}onRemove(t,e){e&&(this.context.hiddenNodes=this.context.hiddenNodes.filter(s=>!t.has(s._index))),this.context.hiddenEdges=this.context.hiddenEdges.filter(s=>!t.has(s._index))}setOptions(t){return this.selector=t.selector||this.selector,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,super.setOptions(t)}};function dF(t,e,s,i,n,r,o,a){let l,d;if(e.source!==void 0&&(l=t.getNode(e.source),l!==n&&l!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid source [${e.source}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(e.target!==void 0&&(d=t.getNode(e.target),d!==n&&d!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid target [${e.target}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(l&&d&&l===d)throw new Error(`addNodeCollapsing: edge generator produced RawEdge with same source and target [${l.getId()}]`);if(l&&!d)d=l===n?r:n;else if(d&&!l)l=d===n?r:n;else if(!l&&!d){let h=!0;for(let u=0;u<o.size;++u)o.get(u).getSource()===n&&(h=!1);for(let u=0;u<a.size;++u)a.get(u).getTarget()===r&&(h=!1);h?(l=r,d=n):(l=n,d=r)}return l&&d?{...e,id:`_gen_${i.getId()}_${l.getId()}_${d.getId()}_${s}`,source:l.getId(),target:d.getId()}:{}}var hF=class extends rn{constructor(t){super(t),this.nodeSelector=t.nodeSelector||_u,this.edgeSelector=t.edgeSelector||_u,this.nodeDataFunction=t.nodeDataFunction||null,this.edgeDataFunction=t.edgeDataFunction||null}getName(){return is.VirtualProperties}resetContext(){this.context={nodes:this.ogma.nodeList(),oldNodesData:[],edges:this.ogma.edgeList(),oldEdgesData:[]}}run(){const{ogma:t,context:e}=this;return this.nodeDataFunction&&(e.nodes=t.getNodes().filter(this.nodeSelector),e.oldNodesData=n_(e.nodes,this.nodeDataFunction,this.ogma)),this.edgeDataFunction&&(e.edges=t.getEdges().filter(this.edgeSelector),e.oldEdgesData=n_(e.edges,this.edgeDataFunction,this.ogma)),Promise.resolve()}undo(){const{nodes:t,oldNodesData:e,edges:s,oldEdgesData:i}=this.context,n=this.ogma.modules.data;return t&&n.setProperty(t,null,e,{dispatch:!0,virtual:!0}),s&&n.setProperty(s,null,i,{dispatch:!0,virtual:!0}),Promise.resolve()}onRemove(t,e){e&&(this.context.nodes=this.context.nodes.filter(s=>!t.has(s._index))),this.context.edges=this.context.edges.filter(s=>!t.has(s._index))}cleanup(){return this.resetContext(),Promise.resolve()}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.nodeDataFunction=t.nodeDataFunction||this.nodeDataFunction,this.edgeDataFunction=t.edgeDataFunction||this.edgeDataFunction,super.setOptions(t)}};function n_(t,e,s){const i=[],n=[];for(let r=0;r<t.size;++r){const o=t.get(r),a=o.getData(),l=e(o);n.push(pn(a,l)),i.push(a)}return s.modules.data.setProperty(t,null,n,{dispatch:!0,virtual:!0}),i}var mr=()=>"";function vo(){return{}}var q0=class extends rn{constructor(t){super(t),this.nodeSelector=t.nodeSelector||fr,this.nodeGroupIdFunction=t.nodeGroupIdFunction||mr,this.nodeGenerator=t.nodeGenerator||vo,this.edgeSelector=t.edgeSelector||fr,this.edgeGroupIdFunction=t.edgeGroupIdFunction||mr,this.edgeGenerator=t.edgeGenerator||vo,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0&&t.separateEdgesByDirection,this.groupSelfLoopEdges=!!t.groupSelfLoopEdges,this.groupEdges=t.groupEdges===void 0||t.groupEdges,this.ogma.events.on("updateNodeData",({changes:e})=>this.checkChanges(e,!0)).on("updateEdgeData",({changes:e})=>this.checkChanges(e,!1))}computeNodeGroupId(t){if(this.nodeGroupIdFunction){if(!this.nodeSelector(t)||this.module.groupController.alreadyGrouped.has(t._index)||this.module.animations.hiddenNodes.has(t._index))return;const e=this.nodeGroupIdFunction(t);return e===void 0?void 0:e}}computeEdgeGroupId(t){if(this.edgeGroupIdFunction)return this.edgeSelector(t)&&!this.module.animations.hiddenEdges.has(t._index)?this.edgeGroupIdFunction(t):void 0}addMetaNodes(){const t=this.id,e=this.ogma,s=e.getNodes(),i=new Map;for(let d=0;d<s.size;++d){const h=s.get(d),u=this.computeNodeGroupId(h);if(u===void 0)continue;let c=i.get(u);c||(c={id:u,nodes:[]},i.set(u,c)),c.nodes.push(h)}const n=Array.from(i.values()),r=n.map(({nodes:d})=>e.getNodes(d)),o=[],a=[],{nodeDataUpdates:l}=this.context;for(let d=0;d<n.length;++d){const h=n[d].id,u=r[d],c=this.nodeGenerator(u,h,this);c?(c.id===void 0&&(c.id=Il(h,t)),a.push(c.id),o.push(c)):(n.splice(d,1),r.splice(d,1),d--)}return e.addNodes(o.map(({id:d})=>({id:d})),{virtual:!0}).then(d=>{const h=e.getNodes(a);e.modules.individualAttributes.replaceOriginalAttributes(h,o.map(({attributes:g})=>g));const u=h.getData();for(let g=0;g<u.length;g++){const f=u[g],m=o[g];u[g]=pn(pn(f,m.data),l.get(h._indexes[g]))}e.modules.data.setProperty(h,null,u,{dispatch:!0,virtual:!0}),h.setVisible(!0);const c=h._indexes;this.context.metaNodes&&this.module.removeMetaNodes(this.context.metaNodes);for(let g=0;g<c.length;g++){const f=c[g],m=r[g];this.module.setSubNodes(f,m),this.module.setTransformation(f,this,!0);for(let _=0;_<m._indexes.length;_++)this.module.groupController.alreadyGrouped.add(m._indexes[_]),this.module.setMetaNode(m._indexes[_],h.get(g))}return{metaNodes:h,newNodes:d}})}addMetaEdges(t){const e=this.id,s=this.ogma;let i,n=!1;t?(i=this.module.getSubNodes(t).getAdjacentElements({bothExtremities:!1}).edges,n=!0):i=s.getEdges();const r=new Map,o=this.ogma.modules.graphics.getAttributesManager().getUsedEdgeAttributes().filter(g=>g!=="curvature"),a=new Map;for(let g=0;g<i.size;++g){const f=i.get(g),m=this.computeEdgeGroupId(f);if(m==null)continue;let _=f.getSource(),p=f.getTarget();if(n){let b=this.module.nodeToMeta.get(_._index);b&&b.getTransformation().getId()!==this.getId()&&(b=_);let v=this.module.nodeToMeta.get(p._index);if(v&&v.getTransformation().getId()!==this.getId()&&(v=p),_=b||_,p=v||p,_&&_===p){a.has(_._index)?a.get(_._index).push(f._index):a.set(_._index,[f._index]);continue}}const x=this.groupEdges?GR(m,_.getId(),p.getId(),this.separateEdgesByDirection):`${f.getId()}:${_.getId()}->${p.getId()}`;let y=r.get(x);y||(y={id:x,source:_,target:p,edges:[]},r.set(x,y)),y.edges.push(f)}const l=Array.from(r.values()),d=l.map(({edges:g})=>s.getEdges(g)),h=[],{edgeDataUpdates:u}=this.context,c=[];for(let g=0;g<l.length;++g){const f=l[g],m=f.id,_=d[g],p=this.groupEdges?this.edgeGenerator(_,m,this):BR(_,o);if(p){if(p.id===null)throw Error(`The id ${p.id} returned by the edgeGenerator function is not unique.`);p.id===void 0&&(p.id=Il(m,e)),c.push(p.id),p.source=f.source.getId(),p.target=f.target.getId(),h.push(p)}}return s.addEdges(UR(h),{virtual:!0}).then(()=>{const g=s.getEdges(c);g.setVisible(!1),s.modules.individualAttributes.replaceOriginalAttributes(g,h.map(_=>_.attributes));const f=g.getData();for(let _=0;_<f.length;_++){const p=h[_],x=f[_];f[_]=pn(pn(x,p.data),u.get(g._indexes[_]))}s.modules.data.setProperty(g,null,f,{dispatch:!0,virtual:!0}),this.context.metaEdges&&this.module.removeMetaEdges(this.context.metaEdges);const m=g._indexes;for(let _=0;_<m.length;_++){const p=d[_]._indexes,x=m[_];for(let y=0;y<p.length;y++)this.module.setMetaEdge(p[y],g.get(_));this.module.setSubEdges(x,d[_]),this.module.setTransformation(x,this,!1)}return{intraEdges:a,metaEdges:g}})}removeMetaEdges(t){t.forEach(e=>{const s=this.module.getSubEdges(e);if(!s)return;const i=s._indexes;for(let r=0;r<i.length;r++)this.module.clearMetaEdge(i[r]);this.module.clearSubEdges(e._index);const n=this.module.getMetaEdge(e);if(n){for(let r=0;r<i.length;r++)this.module.setMetaEdge(i[r],n);this.module.setSubEdges(n._index,this.module.getSubEdges(n).filter(r=>r!==e).concat(s))}s.filter(r=>r.getTarget().isVisible()&&r.getSource().isVisible()).setVisible(!0)}),t.setVisible(!1)}removeMetaNodes(t){t.forEach(e=>{const s=this.module.getSubNodes(e);if(!s)return;const i=s._indexes;for(const n of i)this.module.clearMetaNode(n);this.module.clearSubNodes(e._index),s.setVisible(!0)}),t.setVisible(!1)}onRemove(t,e){}checkChanges(t,e){const s=e?this.context.nodeDataUpdates:this.context.edgeDataUpdates,i=this.module;for(let n=0;n<t.length;n++){const{property:r,newValues:o,virtual:a,nodes:l,edges:d}=t[n];if(a)continue;const h=e?l.filter(u=>i.getTransformation(u._index,e)===this):d.filter(u=>i.getTransformation(u._index,e)===this);if(h.size)for(let u=0;u<h._indexes.length;u++){let c=s.get(h._indexes[u])||{};const g=o[u];r?Yr(c,r,g):c=g,s.set(h._indexes[u],c)}}}setOptions(t){return this.nodeSelector=t.nodeSelector||this.nodeSelector,this.nodeGroupIdFunction=t.nodeGroupIdFunction||this.nodeGroupIdFunction,this.nodeGenerator=t.nodeGenerator||this.nodeGenerator,this.edgeSelector=t.edgeSelector||this.edgeSelector,this.edgeGroupIdFunction=t.edgeGroupIdFunction||this.edgeGroupIdFunction,this.edgeGenerator=t.edgeGenerator||this.edgeGenerator,this.separateEdgesByDirection=t.separateEdgesByDirection!==void 0?!!t.separateEdgesByDirection:this.separateEdgesByDirection,this.groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this.groupSelfLoopEdges,this.groupEdges=t.groupEdges!==void 0?!!t.groupEdges:this.groupEdges,super.setOptions(t)}resetContext(){super.resetContext(),this.context={...this.context,nodeDataUpdates:new Map,edgeDataUpdates:new Map}}},j0=class extends q0{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,padding:o=2,onBeforeAddMetaEdges:a,selector:l=fr,groupIdFunction:d=mr,edgeGroupIdFunction:h=mr,nodeGenerator:u=vo,edgeGenerator:c=vo,onGroupUpdate:g=()=>Promise.resolve(),separateEdgesByDirection:f=!1,groupSelfLoopEdges:m=!1,groupEdges:_=!0,restorePositions:p=!0,showContents:x=!1}){super({id:s,ogma:i,module:n,nodeSelector:l,nodeGroupIdFunction:d,edgeGroupIdFunction:h,nodeGenerator:u,edgeSelector:y=>!(!this.module.getMetaNode(y.getSource())&&!this.module.getMetaNode(y.getTarget())),edgeGenerator:c,separateEdgesByDirection:f,groupEdges:_,groupSelfLoopEdges:m,duration:t,easing:e,enabled:r}),this.onBeforeAddMetaEdges=a||(()=>Promise.resolve()),this.onGroupUpdate=g,this._padding=o,this._showContents=typeof x!="function"?()=>x:x,this._restorePositions=p}getName(){return is.NodeGrouping}get padding(){return this._padding}set padding(t){this._padding=t,this.refresh()}resetContext(){super.resetContext(),this.context={...this.context,metaNodes:this.ogma.nodeList(),metaEdges:this.ogma.edgeList(),subNodes:this.ogma.nodeList(),intraEdges:this.ogma.edgeList(),subNodesPerMetaNode:new Map,subEdges:this.ogma.edgeList()}}run(){let t,e;const s=this.ogma,i=this.module.groupController,n=i.layoutController;let r=s.createNodeList(),o=s.createEdgeList();const a=[];let l=s.createEdgeList();const d=new Map,h=-(this.getIndex()+1),u=new Set,c=[];let g;const f=s.geo.enabled();return this.addMetaNodes().then(({metaNodes:m,newNodes:_})=>{g=i.setPadding(m,this._padding),t=m;for(let p=0;p<_.size;p++)u.add(_._indexes[p]);for(let p=0;p<t.size;p++)i.nodeLayer.set(t._indexes[p],h);return this.onBeforeAddMetaEdges(t,_).then(()=>this.addMetaEdges(t))}).then(({intraEdges:m,metaEdges:_})=>{e=_,o=this.module.getSubEdges(e),e.filter(y=>y.getExtremities().map(b=>b.isVisible()).every(b=>b)).setVisible(!0);for(let y=0;y<e.size;y++)i.edgeLayer.set(e._indexes[y],h);o.setVisible(!1);const p=this.context.metaNodes.subtract(t),x=this.context.metaEdges.subtract(e);return this.module.removeMetaNodes(p),this.module.removeMetaEdges(x),i.cleanup(p,x),s.removeNodes(p,{virtual:!0}).then(()=>s.removeEdges(x,{virtual:!0})).then(()=>({intraEdges:m,metaEdges:_}))}).then(({intraEdges:m})=>{const _=t._indexes,p=[],x=t.getPosition();for(let y=0;y<_.length;y++){const b=t.get(y),v=i.isClose(b),E=!v&&!i.isOpen(b),A=i.collapsedGroups.has(b._index),S=this._showContents(b),w=this.module.getSubNodes(b),L=x[y],T=w._indexes,F=new Set;if(E){const{x:W,y:et}=i.getGroupXYR(b,this.module.getSubNodes(b),void 0,void 0);f?i.setGeoLatLng(b,et,W):(b.setAttributes({x:W,y:et},0),L.x=W,L.y=et)}d.set(_[y],F);const V=m.has(b._index)&&s.edgeList(m.get(b._index));V&&(l=l.concat(V),V.setVisible(S&&!A)),r=r.concat(w);for(let W=0;W<T.length;W++)F.add(T[W]);const G=this.context.subNodesPerMetaNode.get(_[y]),O=g.has(b._index);let j=!G||n.shouldRelayout.has(b._index);if(!j&&G)for(const W of G.keys())j||(j=!F.has(W));if(!j&&G)for(let W=0;W<T.length;W++)j||(j=!G.has(T[W]));if(j&&(n.shouldRelayout.add(b._index),p.push(this.getLayoutPromise(b,w,S))),S){if(v?i.expandGroup(b,w):i.addOpenGroup(b),j||O||v){c.push(b);const W=this.module.getMetaNode(b);W&&n.shouldRelayout.add(W._index)}}else i.closeGroup(b,w,L.x,L.y)}return this.module.animations.handleLayoutPromises(p).then(()=>{c.forEach(y=>i.setGroupXYR(y)),f&&this.ogma.modules.geo._updateNodesCoordinates(t)})}).then(()=>(this.context={metaNodes:t,metaEdges:e,subNodesPerMetaNode:d,subNodes:r,intraEdges:l,nodeDataUpdates:this.context.nodeDataUpdates,edgeDataUpdates:this.context.edgeDataUpdates,subEdges:o},a))}undo(t=!0){super.undo(t);const{metaNodes:e,metaEdges:s,intraEdges:i,subNodes:n,subEdges:r}=this.context,o=this.module.animations,a=this.module.groupController,l=-(this.getIndex()+1);i.setVisible(!0),r.setVisible(!0),s.setVisible(!1),n.setVisible(!0),n.setAttribute("layer",l+1),e.setVisible(!1),t&&(o.pushBefore(()=>{e.setVisible(!0),s.setVisible(!0)}),o.pushAfter(()=>{e.setVisible(!1),s.setVisible(!1)}),e.forEach(d=>{const h=this.module.getSubNodes(d);if(a.isClose(d))a.expandGroup(d,h,!0);else{const u=d.getPosition();a.closeGroup(d,h,u.x,u.y,!0)}}))}onRemove(t,e){if(e){const s=this.context.metaNodes.size;this.context.metaNodes=this.context.metaNodes.filter(n=>!t.has(n._index));const i=this.context.subNodes.size;this.context.subNodes=this.context.subNodes.filter(n=>!t.has(n._index)),(this.context.subNodes.size!==s||this.context.metaNodes.size!==i)&&this.context.subNodesPerMetaNode.clear()}else this.context.subEdges=this.context.subEdges.filter(s=>!t.has(s._index)),this.context.metaEdges=this.context.metaEdges.filter(s=>!t.has(s._index))}cleanup(){const{ogma:t}=this,e=this.context,{metaNodes:s,metaEdges:i,subNodes:n}=e;return this.module.removeMetaNodes(s),this.module.removeMetaEdges(i),this.module.groupController.cleanup(s,i,n),super.cleanup(),Promise.all([t.removeEdges(i,{virtual:!0}),t.removeNodes(s,{virtual:!0})]).then(()=>Promise.resolve())}setOptions({duration:t,easing:e,enabled:s,padding:i,selector:n,groupIdFunction:r,nodeGenerator:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupSelfLoopEdges:h,groupEdges:u,restorePositions:c,showContents:g}){return this._padding=i!==void 0?i:this.padding,this._showContents=g!==void 0?typeof g!="function"?()=>g:g:this._showContents,this._restorePositions=c===void 0?this._restorePositions:c,super.setOptions({nodeSelector:n,nodeGroupIdFunction:r,nodeGenerator:o,edgeSelector:f=>!(!this.module.getMetaNode(f.getSource())&&!this.module.getMetaNode(f.getTarget())),edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:u,groupSelfLoopEdges:h,duration:t,easing:e,enabled:s})}getLayoutPromise(t,e,s){return(this.onGroupUpdate(t,e,s)||Promise.resolve()).then(i=>i?{subNodes:e,res:i}:null)}},uF=class extends q0{constructor({duration:t,easing:e,id:s,ogma:i,module:n,enabled:r,selector:o=fr,groupIdFunction:a=mr,generator:l=vo,separateEdgesByDirection:d=!1}){super({id:s,ogma:i,module:n,nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:o,edgeGroupIdFunction:a,edgeGenerator:l,separateEdgesByDirection:d,groupEdges:!0,groupSelfLoopEdges:!0,duration:t,easing:e,enabled:r})}resetContext(){super.resetContext(),this.context={...this.context,metaEdges:this.ogma.edgeList(),subEdges:this.ogma.edgeList()}}getName(){return is.EdgeGrouping}run(){let t,e;const s=this.module.animations,i=new Set(this.context.metaEdges.getId());return this.addMetaEdges().then(({metaEdges:n})=>{t=n,e=this.module.getSubEdges(t),t.setVisible(!0),e.setVisible(!1),s.hideEdges(e._indexes);const r=t.concat(this.context.metaEdges).getParallelEdges().dedupe().filter(d=>!i.has(d.getId())),o=new Array(r.size),a=new Map;for(let d=0;d<r.size;d++)o[d]=this.ogma.modules.curvatureManager.computeCurvature(r.get(d),"visible"),a.set(r._indexes[d],o[d]);const l=this.module.getSubEdges(r);l.setVisible(!0),this.module.animations.setCurvatures(r._indexes,o);for(let d=0;d<l._indexes.length;d++)this.module.animations.setCurvature(e._indexes[d],a.get(this.module.getMetaEdge(e.get(d))._index)||0)}).then(()=>{this.context.metaEdges=t,this.context.subEdges=e})}undo(t=!0){super.undo(t);const{metaEdges:e,subEdges:s}=this.context;if(s.setVisible(!0),e.setVisible(!1),!t)return Promise.resolve();const i=s.getParallelEdges().dedupe(),n=new Array(i.size),r=new Map;for(let o=0;o<i.size;o++)n[o]=this.ogma.modules.curvatureManager.computeCurvature(i.get(o),"visible"),r.set(i._indexes[o],n[o]);return this.module.animations.setCurvatures(i._indexes,n),Promise.resolve()}onRemove(t,e){e||(this.context.subEdges=this.context.subEdges.filter(s=>!t.has(s._index)))}_getCurvatures(t){return t.map(e=>this.ogma.modules.curvatureManager.computeCurvature(e,"visible",()=>!0))}cleanup(){const{metaEdges:t}=this.context;return this.module.removeMetaEdges(t),this.ogma.removeEdges(t,{virtual:!0}).then(()=>(this.context.metaEdges=this.ogma.edgeList(),this.context.subEdges=this.ogma.edgeList(),Promise.resolve()))}setOptions({duration:t,easing:e,enabled:s,selector:i,groupIdFunction:n,generator:r,separateEdgesByDirection:o}){return super.setOptions({nodeSelector:void 0,nodeGroupIdFunction:void 0,nodeGenerator:void 0,edgeSelector:i,edgeGroupIdFunction:n,edgeGenerator:r,separateEdgesByDirection:o,groupEdges:!0,duration:t,easing:e,enabled:s})}},r_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Yd=1,Nr=8,cF=class H0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,i]=new Uint8Array(e,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(n!==Yd)throw new Error(`Got v${n} data when expected v${Yd}.`);const r=r_[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new H0(a,o,r,e)}constructor(e,s=64,i=Float64Array,n){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=r_.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-a%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,Nr,e),this.coords=new this.ArrayType(this.data,Nr+a+l,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(Nr+o+a+l),this.ids=new this.IndexArrayType(this.data,Nr,e),this.coords=new this.ArrayType(this.data,Nr+a+l,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(Yd<<4)+r]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=e)}add(e,s){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=s,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return pu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,s,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:a}=this,l=[0,r.length-1,0],d=[];for(;l.length;){const h=l.pop()||0,u=l.pop()||0,c=l.pop()||0;if(u-c<=a){for(let _=c;_<=u;_++){const p=o[2*_],x=o[2*_+1];p>=e&&p<=i&&x>=s&&x<=n&&d.push(r[_])}continue}const g=c+u>>1,f=o[2*g],m=o[2*g+1];f>=e&&f<=i&&m>=s&&m<=n&&d.push(r[g]),(h===0?e<=f:s<=m)&&(l.push(c),l.push(g-1),l.push(1-h)),(h===0?i>=f:n>=m)&&(l.push(g+1),l.push(u),l.push(1-h))}return d}within(e,s,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,a=[0,n.length-1,0],l=[],d=i*i;for(;a.length;){const h=a.pop()||0,u=a.pop()||0,c=a.pop()||0;if(u-c<=o){for(let _=c;_<=u;_++)o_(r[2*_],r[2*_+1],e,s)<=d&&l.push(n[_]);continue}const g=c+u>>1,f=r[2*g],m=r[2*g+1];o_(f,m,e,s)<=d&&l.push(n[g]),(h===0?e-i<=f:s-i<=m)&&(a.push(c),a.push(g-1),a.push(1-h)),(h===0?e+i>=f:s+i>=m)&&(a.push(g+1),a.push(u),a.push(1-h))}return l}};function pu(t,e,s,i,n,r){if(n-i<=s)return;const o=i+n>>1;W0(t,e,o,i,n,r),pu(t,e,s,i,o-1,1-r),pu(t,e,s,o+1,n,1-r)}function W0(t,e,s,i,n,r){for(;n>i;){if(n-i>600){const d=n-i+1,h=s-i+1,u=Math.log(d),c=.5*Math.exp(2*u/3),g=.5*Math.sqrt(u*c*(d-c)/d)*(h-d/2<0?-1:1);W0(t,e,s,Math.max(i,Math.floor(s-h*c/d+g)),Math.min(n,Math.floor(s+(d-h)*c/d+g)),r)}const o=e[2*s+r];let a=i,l=n;for(Mr(t,e,i,s),e[2*n+r]>o&&Mr(t,e,i,n);a<l;){for(Mr(t,e,a,l),a++,l--;e[2*a+r]<o;)a++;for(;e[2*l+r]>o;)l--}e[2*i+r]===o?Mr(t,e,i,l):(l++,Mr(t,e,l,n)),l<=s&&(i=l+1),s<=l&&(n=l-1)}}function Mr(t,e,s,i){$d(t,s,i),$d(e,2*s,2*i),$d(e,2*s+1,2*i+1)}function $d(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function o_(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}var gF=t=>t/360+.5,fF=t=>{const e=Math.sin(t*Math.PI/180);return(t=.5-.25*Math.log((1+e)/(1-e))/Math.PI)<0?0:t>1?1:t},mF=[],_F=256,pF=class extends j0{constructor(t){super({...t,enabled:t.enabled&&t.ogma.geo.enabled(),showContents:!1,selector:e=>{const s=this.getPosition(e);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!t.selector||t.selector(e))},groupIdFunction:e=>{let s=t.groupIdFunction?t.groupIdFunction(e):"geo-cluster";return s||(s="geo-cluster"),`${s}-${this.getNodeId(e)}`},edgeGroupIdFunction:e=>{let s=t.edgeGroupIdFunction?t.edgeGroupIdFunction(e):"";return s||(s=""),`${s}-${this.getNodeId(e.getSource())}-${this.getNodeId(e.getTarget())}`},nodeGenerator:(e,s,i)=>{let n=t.nodeGenerator?t.nodeGenerator(e,s,i):{};n||(n={});const r=this.getCoords(e.get(0));return n.data?n.data=fu(n.data,r):n.data=r,n}}),this._zoomLevels=t.zoomLevels?t.zoomLevels:[0,22],this._groupingRadius=t.radius===void 0?60:t.radius,this._generateIdFunction=t.groupIdFunction||(()=>""),this._shouldEnable=t.enabled,this._shouldRefreshClusters=!0,this.ogma.events.on("beforeGeoCameraMove",({zoom:e})=>{!this.isEnabled()||!this.ogma.geo.enabled()||this.getClosestZoomLevel(e).zoom===this._currentClusters.zoom||(this._shouldRefreshClusters=!1,this.refresh())}).on("geoDisabled",()=>{this.isEnabled()&&this.disable(0).then(()=>{this._shouldEnable=!0})}).on("geoEnabled",()=>{this._shouldEnable&&this.enable(0)})}getPosition(t){return{x:t.getData(this.ogma.modules.geo.latitudePath),y:t.getData(this.ogma.modules.geo.longitudePath)}}getMercatorPosition(t){return{x:gF(t.getData(this.ogma.modules.geo.longitudePath)),y:fF(t.getData(this.ogma.modules.geo.latitudePath))}}getNodeId(t){var e;return((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.id)||""}getName(){return is.GeoClustering}enable(t){return this.ogma&&!this.ogma.geo.enabled()?(this._shouldEnable=!0,Promise.resolve()):super.enable(t)}undo(t=!0){const{metaNodes:e,metaEdges:s,intraEdges:i,subNodes:n,subEdges:r}=this.context,o=-(this.getIndex()+1);return t?(i.setVisible(!0),r.setVisible(!0),s.setVisible(!1),n.setVisible(!0),n.setAttribute("layer",o+1),this.module.animations.push(()=>{s.filter(a=>a).setVisible(!1),e.filter(a=>a).setVisible(!1)}),Promise.resolve()):(e.setVisible(!1),s.setVisible(!1),n.setVisible(!0),r.setVisible(!0),i.setVisible(!0),Promise.resolve())}disable(t){return this._shouldEnable=!1,super.disable(t)}getCoords(t){var e;const s=((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.center)||{x:0,y:0},i={};return this.setToPropertyPath(i,this.ogma.modules.geo.latitudePath,s.x),this.setToPropertyPath(i,this.ogma.modules.geo.longitudePath,s.y),i}setToPropertyPath(t,e,s){if(typeof e=="string")return this.setToPropertyPath(t,e.split("."),s);{let i=t;e.forEach((n,r)=>{r===e.length-1?i[n]=s:i[n]||(i[n]={}),i=i[n]})}}nodeToElement(t){return{nodeId:t._index,generatedId:this._generateIdFunction(t),nodes:this.ogma.nodeList(new Uint32Array([t._index])),radius:t.getAttribute("radius"),center:this.getPosition(t),mercatorCenter:this.getMercatorPosition(t),zoom:1/0}}getCluster(t){const e=t.reduce((n,r)=>({x:n.x+r.center.x/t.length,y:n.y+r.center.y/t.length}),{x:0,y:0}),s=t.reduce((n,r)=>({x:n.x+r.mercatorCenter.x/t.length,y:n.y+r.mercatorCenter.y/t.length}),{x:0,y:0}),i=t.reduce((n,r)=>{const o=e.x-r.center.x,a=e.y-r.center.y,l=r.radius+Math.sqrt(o*o+a*a);return Math.max(l,n)},0);return{nodes:this.ogma.nodeList(new Uint32Array(t.map(({nodeId:n})=>n))),generatedId:t[0].generatedId,center:e,mercatorCenter:s,radius:i}}onePassCluster(t){const e=t.map(r=>this.nodeToElement(r)),[s,i]=this._zoomLevels,n=[];for(let r=i;Math.abs(r-s)>.01;r-=1*(i-s)/19){const o=[],a=new cF(e.length);e.forEach(l=>{a.add(l.mercatorCenter.x,l.mercatorCenter.y)}),a.finish(),e.forEach(l=>{if(l.zoom<=r)return;const d=this._groupingRadius/(_F*Math.pow(2,l.zoom-1));let h=a.within(l.mercatorCenter.x,l.mercatorCenter.y,d).map(u=>e[u]).filter(u=>u.zoom>r&&u&&u.generatedId===l.generatedId);h.length||(h=[l]),h.forEach(u=>u.zoom=r),o.push({...this.getCluster(h),zoom:r,id:`${r.toFixed(2)}-${o.length}`})}),n.push({zoom:r,clusters:o})}return n.map(({zoom:r,clusters:o})=>{const a=new Map;return o.forEach(l=>{l.nodes.forEach(({_index:d})=>a.set(d,l))}),{zoom:r,idToCluster:a}})}getClosestZoomLevel(t){return this._clustersByZoom.reduce((e,s)=>Math.abs(t-s.zoom)<Math.abs(t-e.zoom)?s:e)}run(){var t;this._shouldRefreshClusters&&(this._clustersByZoom=this.onePassCluster(this.ogma.getNodes().filter(u=>this.nodeSelector(u)))),this._shouldRefreshClusters=!0;const e=((t=this.ogma.geo.getMap())==null?void 0:t.getZoom())||0;let s,i;this._currentClusters=this.getClosestZoomLevel(e);const n=this.ogma,r=this.module.groupController;let o=n.createNodeList(),a=n.createEdgeList(),l=n.createEdgeList();const d=-(this.getIndex()+1),h=new Set;return this.addMetaNodes().then(({metaNodes:u,newNodes:c})=>{s=u;for(let g=0;g<c.size;g++)h.add(c._indexes[g]);for(let g=0;g<s.size;g++)r.nodeLayer.set(s._indexes[g],d);return this.addMetaEdges(s)}).then(({intraEdges:u,metaEdges:c})=>{i=c,a=this.module.getSubEdges(i),i.filter(m=>m.getExtremities().map(_=>_.isVisible()).every(_=>_)).setVisible(!0);for(let m=0;m<i.size;m++)r.edgeLayer.set(i._indexes[m],d);a.setVisible(!1);const g=this.context.metaNodes.subtract(s),f=this.context.metaEdges.subtract(i);return this.module.removeMetaNodes(g),this.module.removeMetaEdges(f),r.cleanup(g,f),n.removeNodes(g,{virtual:!0}).then(()=>n.removeEdges(f,{virtual:!0})).then(()=>({intraEdges:u,metaEdges:c}))}).then(({intraEdges:u})=>{const c=s._indexes;for(let g=0;g<c.length;g++){const f=s.get(g),m=this.module.getSubNodes(f),_=u.has(f._index)&&n.edgeList(u.get(f._index));_&&(l=l.concat(_),_.setVisible(!1)),o=o.concat(m),m.setVisible(!1)}return this.ogma.modules.geo._updateNodesCoordinates(s),this.ogma.modules.geo.updateProjection(),this.context={metaNodes:s,metaEdges:i,subNodes:o,intraEdges:l,subNodesPerMetaNode:new Map,nodeDataUpdates:this.context.nodeDataUpdates,edgeDataUpdates:this.context.edgeDataUpdates,subEdges:a},mF})}setOptions(t){const e=super.setOptions({...t,selector:s=>{const i=this.getPosition(s);return i&&!isNaN(i.x)&&!isNaN(i.y)&&(!t.selector||t.selector(s))},groupIdFunction:s=>{let i=t.groupIdFunction?t.groupIdFunction(s):"geo-cluster";return i||(i="geo-cluster"),`${i}-${this.getNodeId(s)}`},nodeGenerator:(s,i,n)=>{let r=t.nodeGenerator?t.nodeGenerator(s,i,n):{};r||(r={});const o=this.getCoords(s.get(0));return r.data?r.data=fu(r.data,o):r.data=o,r},edgeGroupIdFunction:s=>{let i=t.edgeGroupIdFunction?t.edgeGroupIdFunction(s):"";return i||(i=""),`${i}-${this.getNodeId(s.getSource())}-${this.getNodeId(s.getTarget())}`}});return this._groupingRadius=t.radius===void 0?this._groupingRadius:t.radius,this._generateIdFunction=t.groupIdFunction||this._generateIdFunction,this._shouldRefreshClusters=!0,this._shouldEnable=t.enabled,e}},a_=()=>({}),yF=class extends rn{constructor(t){super(t),this._groupSelfLoopEdges=!1,this._isCleaningUp=!1,this._isRunning=!1,this.shouldDo=!0,this.enabled=!1,this._onBeforeAdd=e=>{if(this._isCleaningUp||!this.enabled||e.virtual)return;const{isNode:s,objects:i}=e;if(s){const n=i;l_(n,this._groupNodes(n))}else{const n=i;l_(n,this._groupEdges(n))}this._shouldSetVirtual=!0},this._onAfterAdd=e=>{this._shouldSetVirtual&&(this._shouldSetVirtual=!1,this._setVirtual(e.nodes||e.edges,!!e.nodes))},this._onRequestElementsToDelete=e=>{if(e.virtual)return;const{ogma:s,context:i}=this,n=e.elementsToRemove.isNode,r=n?s.getNodes:s.getEdges,o=n?i.metaNodesSet:i.metaEdgesSet,a=n?i.nodeGroups:i.edgeGroups,l=n?s.removeNodes:s.removeEdges,d=e.elementsToRemove.size,h=r(Array.from(o)),u=e.elementsToRemove.slice();if(e.elementsToRemove=e.elementsToRemove.subtract(h),e.elementsToRemove.size===d)return;const c=u.subtract(e.elementsToRemove);if(c.forEach(g=>{a.delete(g.getId())}),n){const g=c.getAdjacentEdges().filter(f=>f.isVirtual());s.removeEdges(g)}l(c,{virtual:!0})},this._nodeToGroupId=t.groupIdFunction||mr,this._groupSelfLoopEdges=!!t.groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||a_,this._edgeGenerator=t.edgeGenerator||a_,this._shouldSetVirtual=!1,this._selector=t.selector,this.shouldDo=t.enabled===void 0||!!t.enabled,this.ogma.events.on("preAddElements",this._onBeforeAdd).on("requestElementsToDelete",this._onRequestElementsToDelete).on(["postAddGraph","addNodes","addEdges"],this._onAfterAdd),this.shouldDo&&(this.enable(),this.shouldDo=!1)}getName(){return is.NodeClustering}enable(){if(this.enabled)return Promise.resolve();this.enabled=!0,this.shouldDo=!0,this._isRunning=!0;const{ogma:t}=this;return t.getNodes().size?t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(e=>(t.clearGraph(),t.setGraph(e))).then(()=>(this._isRunning=!1,Promise.resolve())):(this._isRunning=!1,Promise.resolve())}disable(){return this.enabled?(this.enabled=!1,this.shouldDo=!1,super.disable()):Promise.resolve()}destroy(){return this.disable(),super.destroy()}run(){const{ogma:t}=this;return this.enabled||!this.shouldDo?Promise.resolve():t.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(e=>(this._isCleaningUp=!0,t.clearGraph(),this._isCleaningUp=!1,t.setGraph(e)))}undo(){if(this._isRunning||this.enabled)return Promise.resolve();const{ogma:t,context:e}=this;this._isCleaningUp=!0;const s=t.getNodes(Array.from(e.metaNodesSet));this.module.removeMetaNodes(s);const i=t.getEdges(Array.from(e.metaEdgesSet));this.module.removeMetaEdges(i);const n=this._getSubNodes(),r=this._getSubEdges();return this.resetContext(),t.removeNodes(s,{virtual:!0}).then(()=>t.removeEdges(i,{virtual:!0})).then(()=>t.addNodes(n)).then(()=>t.addEdges(r)).then(()=>{this._isCleaningUp=!1,Promise.resolve()})}cleanup(){return this._isRunning||this.ogma.events.off(this._onBeforeAdd).off(this._onRequestElementsToDelete).off(this._onAfterAdd),Promise.resolve()}resetContext(){this._isRunning||(this.context={nodeGroups:new Map,edgeGroups:new Map,metaNodesSet:new Set,metaEdgesSet:new Set,virtualNodes:this.ogma.createNodeList(),virtualEdges:this.ogma.createEdgeList(),nodeToGroupId:new Map})}getSubNodes(t){const e=this.context.nodeGroups.get(t.getId());return e?e.nodes:[]}getSubEdges(t){const e=this.context.edgeGroups.get(t.getId());return e?e.edges:[]}_getSubNodes(){return Array.from(this.context.nodeGroups.values()).reduce((t,{nodes:e})=>(t.push(...e),t),[])}_getSubEdges(){return Array.from(this.context.edgeGroups.values()).reduce((t,{edges:e})=>(t.push(...e),t),[])}_setVirtual(t,e){if(!t)return;const{context:s}=this,i=e?s.metaNodesSet:s.metaEdgesSet,n=t.filter(r=>i.has(r.getId()));if(e)for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubNodes(n._indexes[r],null);else for(let r=0;r<n.size;r++)this.module.setTransformation(n._indexes[r],this,e),this.module.setSubEdges(n._indexes[r],null);e?s.virtualNodes=s.virtualNodes.concat(n):s.virtualEdges=s.virtualEdges.concat(n)}setContext(){}_computeEdgeGroupId(t,e){return t>e?`${e}:${t}`:`${t}:${e}`}_groupEdges(t){const{ogma:e,id:s,context:i}=this,n=s,r=new Map,o=i.nodeToGroupId;i.edgeGroups.forEach(h=>{h.newEdges=[],r.set(h.id,h)});const a=[];for(let h=0;h<t.length;++h){const u=t[h];let c=i.nodeToGroupId.get(u.source),g=i.nodeToGroupId.get(u.target);if(!c&&!g){a.push(u);continue}c=c||u.source,g=g||u.target;const f=this._computeEdgeGroupId(c,g);if(f!==void 0){const m=o.get(u.source)||u.source,_=o.get(u.target)||u.target;let p=r.get(f);p||(p={id:f,source:m,target:_,edges:[],newEdges:[]},r.set(f,p)),p.edges.push(u),p.newEdges.push(u)}}const l=Cl(r),d=l.map(({edges:h})=>h);for(let h=0;h<l.length;++h){const u=l[h];if(!u.newEdges.length)continue;const c=u.id,g=d[h],f=this._edgeGenerator(g,c);f.id===void 0&&(f.id=Il(c,n)),f.source=u.source,f.target=u.target,u.metaEdge=f,i.metaEdgesSet.add(f.id),i.edgeGroups.get(f.id)||i.edgeGroups.set(f.id,u),(this._groupSelfLoopEdges||f.source!==f.target)&&a.push(f)}return e.view.afterNextFrame().then(()=>{i.edgeGroups.forEach(({newEdges:h,metaEdge:u})=>{if(!(h.length&&u&&u.id&&u.attributes))return;const c=e.getEdge(u.id);c?.setAttributes(u.attributes)})}),a}_groupNodes(t){const{id:e,context:s,ogma:i}=this,n=e,r=new Map;s.nodeGroups.forEach(u=>{u.newNodes=[],r.set(u.id,u)});const o=[];for(let u=0;u<t.length;u++){const c=t[u];if(this._selector&&!this._selector(c)){o.push(c);continue}c.id=VR(c.id);const g=this._nodeToGroupId(c);if(g!==void 0){let f=r.get(g);f||(f={id:g,nodes:[],newNodes:[]},r.set(g,f)),f.nodes.push(c),f.newNodes.push(c)}else s.nodeToGroupId.set(c.id,c.id)}const a=Cl(r),l=a.map(({nodes:u})=>u),d=a.map(({newNodes:u})=>u),h=[];for(let u=0;u<a.length;++u){if(!a[u].newNodes.length)continue;const c=a[u].id,g=l[u],f=this._nodeGenerator(g,c);a[u].metaNode=f,f.id===void 0&&(f.id=Il(c,n));for(const m of d[u])s.nodeToGroupId.set(m.id,f.id);s.metaNodesSet.add(f.id),s.nodeGroups.get(f.id)||s.nodeGroups.set(f.id,a[u]),h.push(f)}return h.push(...o),i.view.afterNextFrame().then(()=>{s.nodeGroups.forEach(({newNodes:u,metaNode:c})=>{if(!(u.length&&c&&c.id&&c.attributes))return;const g=i.getNode(c.id);g?.setAttributes(c.attributes)})}),h}setOptions(t){return this._nodeToGroupId=t.groupIdFunction||this._nodeToGroupId,this._groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this._groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||this._nodeGenerator,this._edgeGenerator=t.edgeGenerator||this._edgeGenerator,this._selector=t.selector||this._selector,this.disable().then(()=>this.undo()).then(()=>this.ogma.view.afterNextFrame()).then(()=>this.enable())}onRemove(){}};function l_(t,e){const s=e.length;return t.length=s,t.splice(0,s,...e),t}function fi(t){return t.enabled!==!1}var xF=class extends ZR{_setOptions(t){const e=t;return e.ogma=this.ogma,e.module=this,e.id=this.transformations.length,e}addNodeGrouping(t={}){const e=new j0(this._setOptions(t));return this.addTransformation(e,fi(t)),e}addEdgeGrouping(t={}){const e=new uF(this._setOptions(t));return this.addTransformation(e,fi(t)),e}addGeoClustering(t={}){const e=new pF(this._setOptions(t));return this.addTransformation(e,t.enabled),e}addNodeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new tF(this._setOptions(e));return this.addTransformation(s,fi(e)),s}addEdgeFilter(t={}){let e={};e=typeof t=="function"?{criteria:t}:t;const s=new eF(this._setOptions(e));return this.addTransformation(s,fi(e)),s}addNeighborMerging(t){const e=new sF(this._setOptions(t));return this.addTransformation(e,fi(t)),e}addNeighborGeneration(t){const e=new rF(this._setOptions(t));return this.addTransformation(e,fi(t)),e}addNodeCollapsing(t={}){const e=new lF(this._setOptions(t));return this.addTransformation(e,fi(t)),e}addVirtualProperties(t={}){const e=new hF(this._setOptions(t));return this.addTransformation(e,fi(t)),e}addNodeClustering(t={}){const e=new yF(this._setOptions(t));return this.addTransformation(e,fi(t)),e}addDrilldown(t={onGetSubgraph:()=>Promise.resolve({nodes:[],edges:[]})}){const e=new qR(this._setOptions(t));return this.drilldownController.addDrilldown(e),e}onGroupsUpdated(t){this.groupController.onGroupsUpdate=t}triggerGroupsUpdated(){this.groupController.triggerGroupsUpdate()}layoutGroups(t,e,s=!1){return this.groupController.layoutGroups(t,e,s)}getXYR(t){const e=this.animations.xs,s=this.animations.ys,i=this.animations.rs,n=t.getAttributes(["x","y","radius"]);for(let r=0;r<t.size;r++){const o=t._indexes[r];e.has(o)&&(n[r].x=e.get(o)),s.has(o)&&(n[r].y=s.get(o)),i.has(o)&&(n[r].radius=i.get(o))}return n}},bF=class extends Bt{constructor(t){super(t),this.getSubElements=e=>this.api.getSubElements(e),this.getSubNodes=e=>this.api.getSubNodes(e),this.getSubEdges=e=>this.api.getSubEdges(e),this.getXYR=e=>this.api.getXYR(e),this.onGroupsUpdated=e=>this.api.onGroupsUpdated(e)}onMounted(){this._modules.classes.createClass({name:my,isBuiltin:!0,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this._modules.classes.createClass({name:_y,isBuiltin:!0,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}}),this._modules.settings.register("transformations.updateOnDataChange",!0),this._modules.events.register(["transformationEnabled","transformationDisabled","transformationSetIndex","transformationDestroyed","transformationRefresh"])}onReady(t){this.api=new xF(this._ogma)}destroy(){}isElementVirtual(t){return this.api.isVirtual(t._index,t.isNode)}getElementTransformation(t){return this.api.getTransformation(t._index,t.isNode)}getMetaElements(t){return t.map(e=>this.getMetaElement(e))}getMetaElement(t){const e=t.isNode?this.api.getMetaNode(t):this.api.getMetaEdge(t);return e&&this.api.getTransformation(e._index,e.isNode)?.isEnabled()?e:null}getMetaEdge(t){return this.getMetaElement(t)}getMetaNode(t){return this.getMetaElement(t)}getMetaNodes(t){return this.getMetaElements(t)}getMetaEdges(t){return this.getMetaElements(t)}getNodeFilters(){return this.api.getList().filter(t=>t.getName()===is.NodeFilter)}getEdgeFilters(){return this.api.getList().filter(t=>t.getName()===is.EdgeFilter)}whenApplied(){return this.api.afterNextUpdate()}afterNextUpdate(){return this.api.afterNextUpdate()}triggerGroupUpdated(t){const e=t._indexes,s=this._ogma.modules.transformations.api.groupController.layoutController.shouldRelayout;for(let i=0;i<t.size;i++)s.add(e[i])}async expandGroup(t,e,s,i,n,r){if(!e.isVirtual())throw new Error("Focus node is not virtual.");const o=e.getSubNodes();let a=e.getAttribute("radius");await i(),await this.afterNextUpdate();const l=await s(o);await o.setAttributes(e.getPosition());const[,,d]=qc.geometry.minDisk(l.map(f=>f.x),l.map(f=>f.y),o.getAttribute("radius"));a=d-a;const h=t.getNodes().filter(f=>f.isVirtual()),u=await t.algorithms.fishEyeExpand({nodes:h,focusNode:e,deltaRadius:a,dryRun:!0,duration:n,easing:r}),c=h.concat(o),g=u.concat(l);await c.setAttributes(g,{duration:n||0,easing:r})}async collapseGroup(t,e,s,i,n){if(!e.isVirtual())throw new Error("Focus node is not virtual.");const r=e.getSubNodes(),o=e.getPosition(),a=CS-e.getAttribute("radius"),l=Array.from({length:r.size},()=>o),d=t.getNodes().filter(g=>g.isVirtual()),h=await t.algorithms.fishEyeExpand({nodes:d,focusNode:e,deltaRadius:a,dryRun:!0,duration:i,easing:n}),u=d.concat(r),c=h.concat(l);await u.setAttributes(c,{duration:i||0,easing:n}),await s(),await this.afterNextUpdate()}},d_={layer:py,outline:!0,outerStroke:{color:Wh,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:fb,minVisibleSize:0}},vF={layer:py,color:Wh,text:{backgroundColor:fb,minVisibleSize:0},stroke:{color:Wh,width:0}},EF=class extends Bt{onMounted(){this.shouldTriggerEvents=!0,this._modules.events.register(["nodesSelected","nodesUnselected","edgesSelected","edgesUnselected"]),this._selectionExtremityHighlightedClass=this._modules.classes.createClass({name:Sh,isBuiltin:!0,nodeAttributes:d_}),this._selectedClass=this._modules.classes.createClass({name:_e,isBuiltin:!0,nodeAttributes:d_,edgeAttributes:vF}),this._modules.events.on(`nodeClassAdded_${_e}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("nodesSelected",e)}),this._modules.events.on(`edgeClassAdded_${_e}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("edgesSelected",e)}),this._modules.events.on(`nodeClassRemoved_${_e}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("nodesUnselected",e)}),this._modules.events.on(`edgeClassRemoved_${_e}`,e=>{this.shouldTriggerEvents&&this._modules.events.fire("edgesUnselected",e)}),this._modules.settings.register("interactions.selection.enabled",!0),this._modules.settings.register("interactions.selection.multiSelectionKey","ctrl"),this._modules.interactions.onClick({priority:"selection",check:({button:e})=>{const s=!!this._modules.settings.get("interactions.selection.enabled");return e==="left"&&s},handler:({target:e})=>{if(e){const s=this._modules.settings.get("interactions.selection.multiSelectionKey"),i=s&&this._modules.keyboard.isPressed(s);e.isNode?this._selectedClass.clearEdges():this._selectedClass.clearNodes(),i?e.hasClass(_e)?e.removeClass(_e):e.addClass(_e):((e.isNode?this._selectedClass.getNodes():this._selectedClass.getEdges()).filter(n=>n!==e).removeClass(_e),e.hasClass(_e)||e.addClass(_e))}else this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}});const t=()=>{this._selectionExtremityHighlightedClass.clearNodes(),this._selectedClass.getEdges().getExtremities().addClass(Sh)};this._modules.events.on("beforeRemoveEdges",({edges:e})=>e.setSelected(!1)).on("excludedStateChange",({elements:e,value:s})=>{s||e.setSelected(!1)}).on(`edgeClassAdded_${_e}`,t).on(`edgeClassRemoved_${_e}`,t)}setNodeAttributes(t,e){this._selectedClass.update({nodeAttributes:t,fullOverwrite:e}),this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}setEdgeAttributes(t,e){this._selectedClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}_updateExtremityHighlightLayer(){const t=this._selectedClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}setActive(t,e){if(He(e)){const s=[],i=[];t.toList().forEach((n,r)=>{(e[r]?s:i).push(n.getId())}),s.length!==0&&this._modules.graph.getElements(t.isNode,s).addClass(_e),i.length!==0&&this._modules.graph.getElements(t.isNode,i).removeClass(_e)}else t.size&&t[e?"addClass":"removeClass"](_e)}areActive(t){return t.hasClass(_e)}getSelectedNodes(){return this._selectedClass.getNodes()}getSelectedEdges(){return this._selectedClass.getEdges()}getNonSelectedNodes(){return this._modules.graph.getNodes().filter(t=>!t.hasClass(_e))}getNonSelectedEdges(){return this._modules.graph.getEdges().filter(t=>!t.hasClass(_e))}disableEvents(){this.shouldTriggerEvents=!1}enableEvents(){this.shouldTriggerEvents=!0}clear(){this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}},AF=class extends Bt{onMounted(){this._delayedCalls=[],this._idIdle=()=>!this._modules.captor.isAnyButtonPressed()&&!this._modules.dom.isPlayingFrame(),this._modules.events.on(["mousedown","mouseup","beforeNewFrame","frame"],()=>{this._delayedCalls.forEach(t=>t.reset())})}_nextTimeIdle(t){const e=new SF(this._modules.dom,this._idIdle,t);return this._delayedCalls.push(e),e.whenDone().then(()=>{this._delayedCalls.splice(this._delayedCalls.indexOf(e),1)})}debounceIdle(t,e=0){let s=!1,i=[];const n=()=>{const r=i;s=!1,i=[],t(),r.forEach(o=>o())};return()=>new Promise(r=>{i.push(r),s||(s=!0,this._nextTimeIdle(e).then(n))})}},SF=class{constructor(t,e,s){this._timeout=null,this._done=!1,this._dom=t,this._promise=new Promise(i=>this._resolve=i),this._isIdle=e,this._delay=s,this._startTimeout()}_startTimeout(){this._timeout=this._dom.setTimeout(()=>{this._isIdle()?(this._done=!0,this._resolve()):this._startTimeout()},this._delay)}reset(){this._done||(this._dom.clearTimeout(this._timeout),this._startTimeout())}whenDone(){return this._promise}},Ca=-2,wF={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2,enabled:!1},TF={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2,enabled:!1},IF=class extends Bt{constructor(){super(...arguments),this._nodePromiseMap=new Map,this._edgePromiseMap=new Map,this._onAttributeChange=({nodes:t,edges:e,nodeAttributes:s,edgeAttributes:i})=>{this._onElementsAttributeChange(t,s),this._onElementsAttributeChange(e,i,!1)},this._refreshPulses=()=>{const{nodes:t,edges:e}=this._hasPulses.getElements();if(t.size!==0||e.size!==0){const s=this._engine.getCurrentTime();this._refreshElementsPulses(t,s),this._refreshElementsPulses(e,s),this._modules.dom.refresh()}}}onMounted(){this._modules.events.on("updateAttributes",this._onAttributeChange).on("frame",this._refreshPulses).on("beforeRemoveEdges",({edges:t})=>{this._removePulses(t)}).on("beforeRemoveNodes",({nodes:t})=>{this._removePulses(t)}).on("excludedStateChange",({elements:t,value:e})=>{e&&(this._hasPulses.removeElements(t),this._removePulses(t))}).on("clearGraph",()=>this._hasPulses.clear()),this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._nodePulses=this._modules.graph.createNodeAttribute({storage:"any"},!1),this._edgePulses=this._modules.graph.createEdgeAttribute({storage:"any"},!1),this._nodeNbPulsesRemaining=this._modules.graph.createNodeAttribute({storage:"int16",default:-1},!1),this._edgeNbPulsesRemaining=this._modules.graph.createEdgeAttribute({storage:"int16",default:-1},!1),this._nodeFlexArrays=this._modules.graphics.getNodeAttributes(),this._edgeFlexArrays=this._modules.graphics.getEdgeAttributes(),this._edgeSourceList=this._modules.graph.getEdgeAttribute("source"),this._edgeTargetList=this._modules.graph.getEdgeAttribute("target"),this._hasPulses=new Oo(this._modules.graph)}_onElementsAttributeChange(t,e,s=!0){if(!e.includes("pulse.enabled"))return;const{valid:i,invalid:n}=Ap(this._modules.graph,t,o=>o.getAttribute("pulse.enabled")&&o.isVisible());this._hasPulses.removeElements(n),this._hasPulses.addElements(i);const r=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let o=0;o<i.size;o++)r.get(i._indexes[o])>0||r.set(i._indexes[o],Ca);this._removePulses(n)}_removePulses(t){const e=t.isNode?this._nodePulses:this._edgePulses,s=t.isNode?this._nodePromiseMap:this._edgePromiseMap;for(let i=0;i<t._indexes.length;i++){const n=t._indexes[i],r=e.get(n);if(r){for(let a=0;a<r.length;a++){const l=r[a];this._modules.graphics.releaseGraphicsEngineBlockId(l.blockId)}e.set(n,null);const o=s.get(n);o&&(o.resolve(),s.delete(n))}}}_refreshElementsPulses(t,e){const s=t.isNode,i=s?this._nodePulses:this._edgePulses,n=s?this._nodeFlexArrays.pulse.duration:this._edgeFlexArrays.pulse.duration,r=s?"_createNodePulseBlock":"_createEdgePulseBlock",o=s?this._nodeFlexArrays.pulse.interval:this._edgeFlexArrays.pulse.interval,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let l=0;l<t._indexes.length;l++){const d=t._indexes[l];let h=i.get(d);h||(h=[],i.set(d,h));for(let m=0;m<h.length;m++){const{startTime:_,duration:p,blockId:x}=h[m];e>=_+p&&(this._modules.graphics.releaseGraphicsEngineBlockId(x),h.splice(m--,1))}const u=h[h.length-1];if(u&&e<u.startTime+o.get(d))continue;const c=n.get(d),g=a.get(d);if(g<1&&g!==Ca)continue;h.push({blockId:this[r](d,e,c),startTime:e,duration:c});const f=g===Ca?Ca:g-1;a.set(d,f)}}_createNodePulseBlock(t,e,s){const i=this._nodeFlexArrays,n=i.color.get(t),r=i.layer.get(t),o=i.x.get(t),a=i.y.get(t),l=i.radius.get(t),d=i.scalingMethod.get(t)==="scaled",h=i.pulse.startRatio.get(t),u=i.pulse.endRatio.get(t),c=i.pulse.width.get(t),g=2*l*h,f=2*l*u,m=_o(r).nodeBody,_=i.pulse.startColor.get(t),p=i.pulse.endColor.get(t),x=this._modules.graphics.allocateGraphicsEngineBlockId(),y=this._group.reset(qs,!0,m),b=y.nextAndReset(),v=Xs(_,n),E=Xs(p,n);return b.end.shape="circle",b.end.pieceId=ks,b.end.x1=o,b.end.y1=a,b.end.x2=o,b.end.y2=a,b.end.rectWidthOrSourceRadiusScaled=d?f:0,b.end.rectHeightOrTargetRadiusScaled=d?f:0,b.end.rectWidthOrSourceRadiusFixed=d?0:f,b.end.rectHeightOrTargetRadiusFixed=d?0:f,b.end.strokeWidthFixed=c,b.end.strokeColor=E,b.start.shape="circle",b.start.pieceId=ks,b.start.x1=o,b.start.y1=a,b.start.x2=o,b.start.y2=a,b.start.rectWidthOrSourceRadiusScaled=d?g:0,b.start.rectHeightOrTargetRadiusScaled=d?g:0,b.start.rectWidthOrSourceRadiusFixed=d?0:g,b.start.rectHeightOrTargetRadiusFixed=d?0:g,b.start.strokeWidthFixed=c,b.start.strokeColor=v,b.animation.duration=s,b.animation.beginTime=e,this._engine.storeGroup(x,y),x}_createEdgePulseBlock(t,e,s){const i=this._edgeFlexArrays,n=this._nodeFlexArrays,r=i.pulse.startRatio.get(t),o=i.pulse.endRatio.get(t),a=i.pulse.startColor.get(t),l=i.pulse.endColor.get(t),d=_o(i.layer.get(t)).edgeBody,h=this._edgeSourceList.get(t),u=this._edgeTargetList.get(t),c=i.curvature.get(t),g=c!==0,f=this._modules.graphics.allocateGraphicsEngineBlockId(),m=this._group.reset(g?xl:qs,!0,d),_=m.nextAndReset(),p={isSelfLoop:h===u,curvature:c,sourceX:n.x.get(h),sourceY:n.y.get(h),targetX:n.x.get(u),targetY:n.y.get(u),sourceRadius:n.radius.get(h),targetRadius:n.radius.get(u),isSourceRadiusScaled:n.scalingMethod.get(h)==="scaled",isTargetRadiusScaled:n.scalingMethod.get(u)==="scaled",width:i.width.get(t),isWidthScaled:i.scalingMethod.get(t)==="scaled",strokeWidth:i.pulse.width.get(t)};return h_(_.start,p),h_(_.end,p),_.start.strokeColor=a,_.end.strokeColor=l,_.start.thicknessOrFontSizeScaled*=r,_.start.thicknessOrFontSizeFixed*=r,_.end.thicknessOrFontSizeScaled*=o,_.end.thicknessOrFontSizeFixed*=o,_.animation.duration=s,_.animation.beginTime=e,this._engine.storeGroup(f,m),f}pulse(t,e){const s=t.isNode,i={...s?wF:TF,...s?this._nodePulseTheme:this._edgePulseTheme,...e},n=i.number,r=i.interval,o=i.duration,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining,l=(n-1)*r+o;let d;i.enabled=!0,delete i.number,t.setAttributes({pulse:i}),a.setMultiple(t._indexes,n),this._modules.dom.setTimeout(()=>{t.isList?t.filter(Hs).setAttribute("pulse.enabled",!1):t.setAttribute("pulse.enabled",!1),a.setMultiple(t._indexes,-1)},l);const h=new Promise(c=>{d=()=>c(t)}),u=t.isNode?this._nodePromiseMap:this._edgePromiseMap;return t.isList?t._indexes.forEach(c=>{this._setPromise(c,u,h,d)}):this._setPromise(t._index,u,h,d),h}_setPromise(t,e,s,i){e.has(t)&&e.get(t).resolve(),e.set(t,{promise:s,resolve:i})}setTheme(t,e){this._nodePulseTheme=t,this._edgePulseTheme=e}};function h_(t,{sourceX:e,sourceY:s,targetX:i,targetY:n,isSourceRadiusScaled:r,isTargetRadiusScaled:o,targetRadius:a,sourceRadius:l,isWidthScaled:d,width:h,strokeWidth:u,curvature:c,isSelfLoop:g}){t.pieceId=$l,t.shape="line",t.x1=e,t.y1=s,t.x2=i,t.y2=n,t.rectWidthOrSourceRadiusScaled=r?l:0,t.rectWidthOrSourceRadiusFixed=r?0:l,t.rectHeightOrTargetRadiusScaled=o?a:0,t.rectHeightOrTargetRadiusFixed=o?0:a,t.thicknessOrFontSizeScaled=d?h:0,t.thicknessOrFontSizeFixed=d?0:h,t.strokeWidthFixed=u,t.curvature=c,t.isSelfLoop=g}var CF={duration:0,easing:"linear",callback:Yt,resolve:Yt,startAfter:0},LF=0,NF=class extends Bt{constructor(){super(...arguments),this._animationList=[],this._update=()=>{if(this._animationList.length===0)return;const t=ts(),e=[];for(let s=0;s<this._animationList.length;++s){const i=this._animationList[s],n=(t-i.creationDate)/i.duration,r=i.startAfter;let o=i.easing(n);n>=1?(i.func(1),i.done=!0,i.resolve(void 0),this._animationList.splice(s,1),s-=1,e.push(i.callback)):o>=r&&(o=(o-r)*(1/(1-r)),i.func(o))}for(let s=0;s<e.length;s++)e[s](!1);this._modules.dom.refresh()}}onMounted(){this._modules.events.on("beforeNewFrame",this._update)}play(t,e){const{duration:s,easing:i,callback:n,startAfter:r,resolve:o}=As(e,CF);if(s<=0)return t(1),n(),o(void 0),null;const a={func:t,easing:typeof i=="function"?i:Sc[i],duration:s,callback:n,resolve:o,startAfter:r,creationDate:ts(),done:!1,id:++LF};return this._animationList.push(a),this._modules.dom.refresh(),a}cancel(t){const e=this._animationList.indexOf(t);e!==-1&&(t.func(1),this._animationList.splice(e,1),t.done=!0,t.resolve(void 0))}},MF=(t,e,s,i)=>{const n=s._getMapPanePos(),r=t.getMapboxMap(),o=t.getCanvas(),a=t.getSize().round(),l=i.DomUtil.getPosition(t.getContainer()),d=l.x+n.x,h=l.y+n.y;return new Promise(u=>{function c(){e.drawImage(o,d,h,a.x,a.y),u()}if(r.loaded())return c();r.once("idle",c)})},PF=(t,e,s,i,n)=>{const r=s._getMapPanePos(),o=t.getContainer();if(!o)throw new Error(`Trying to access the container of ${t} but it does not exist.`);const a=i.DomUtil.getPosition(o);s.removeLayer(t),t.options.crossOrigin="anonymous";const l=[],d=[];return t.on("tileload",({tile:h})=>{const{x:u,y:c}=i.DomUtil.getPosition(h);l.push(h),d.push({x:u-a.x+r.x,y:c-a.y+r.y})}),s.addLayer(t),new Promise(h=>{t.once("load",()=>{const u=t.getTileSize();l.forEach((c,g)=>{const{x:f,y:m}=d[g];e.drawImage(c,f,m,u.x,u.y)}),h()})})},RF=(t,e,s,i,n,r)=>new Promise(o=>{const a=t.options.renderer;s.removeLayer(t),t.options.renderer=r,s.addLayer(t),r._updatePaths();const l=s._getMapPanePos(),d=r._container,h=i.DomUtil.getPosition(d);e.drawImage(r._container,h.x+l.x,h.y+l.y,d.width/n,d.height/n),s.removeLayer(t),t.options.renderer=a,s.addLayer(t),o()}),FF=(t,e,s,i,n)=>new Promise(r=>{const o=s.getPixelBounds().min,a=s.project(t.getLatLng(),s.getZoom()),l=/^data:/.test(t._icon.src),d=l?t._icon.src:X0(t._icon.src),h=new Image,u=t.options.icon;if(u){const c=u.options;let g=c.iconSize||[24,24];const f=a.subtract(o);let m=c.iconAnchor||[0,0];Array.isArray(g)||(g=[g.x,g.y]),Array.isArray(m)||(m=[m.x,m.y]);const _=Math.round(f.x-(g[0]-m[0])*n),p=Math.round(f.y-m[1]*n);h.crossOrigin="";const x=()=>{e.drawImage(h,_,p,g[0]*n,g[1]*n),r()};h.onload=x,h.src=d,l&&x()}}),DF=(t,e,s,i,n)=>new Promise(r=>{s.removeLayer(t),t.setUrl(X0(t.getUrl())),t.options.crossOrigin="anonymous",t.once("load",()=>{const o=t.getBounds(),a=s.latLngToContainerPoint(o.getNorthWest()),l=s.latLngToContainerPoint(o.getSouthEast()),d=l.x-a.x,h=l.y-a.y;e.drawImage(t._image,a.x,a.y,d,h),r()}),s.addLayer(t)});function X0(t){return t+(t.indexOf("?")===-1?"?":"&")+"noCache="+Date.now()}var OF={tileLayers:PF,imageOverlays:DF,vectorLayers:RF,markers:FF,vectorMap:MF};function kF(t,e){return t instanceof e.TileLayer?"tileLayers":t instanceof e.ImageOverlay?"imageOverlays":t instanceof e.Path?"vectorLayers":t instanceof e.Marker?"markers":"MapboxGL"in e&&t instanceof e.MapboxGL?"vectorMap":void 0}function zF(t,e,s,i,n,r){const o={vectorMap:[],tileLayers:[],vectorLayers:[],imageOverlays:[],markers:[]};return e.eachLayer(a=>{if(a!==t){const l=kF(a,i);if(l&&l in o){const d=OF[l];o[l].push(()=>d(a,s,e,i,n,r))}}}),o}function BF(t){t.TileLayer.prototype.getUrl=function(){return this._url},t.ImageOverlay.prototype.getUrl=function(){return this._url};const e="leaflet-zoom-animated";t.OgmaOverlay||(t.OgmaOverlay=t.Layer.extend({options:{pane:"overlayPane",padding:0,onUpdate:()=>{}},initialize:function(s){const{container:i}=s;t.Util.setOptions(this,s),this._container=i},setLocked:function(s){return this._locked=s,this},onAdd:function(s){this._map=s,this.getPane().appendChild(this._container),this._wgsOrigin=t.latLng([0,0]),this._wgsInitialShift=s.project(this._wgsOrigin,this._initialZoom),t.DomUtil.addClass(this._container,"leaflet-layer"),this._zoomAnimated&&(t.DomUtil.addClass(this._container,e),this._container.style.position="absolute",this._container.style.zIndex=9999),this._initialZoom=(this._map.getMaxZoom()+this._map.getMinZoom())/2,this._mapInitialZoom=this._map.getZoom(),this._updateBounds(),this._update({})},_updateBounds(){const s=this.options.padding,i=this._map.getSize(),n=this._map.containerPointToLayerPoint(i.multiplyBy(-s));this._bounds=new t.Bounds(n,n.add(i.multiplyBy(1+2*s))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_update(s){this._updateBounds(),this._redraw(this._bounds.min,s),this._positionTimer=t.Util.requestAnimFrame(()=>{this._container&&t.DomUtil.setPosition(this._container,this._bounds.min)})},_redraw(s,i){this.options.onUpdate()},_updateTransform(s,i){if(this._locked)return;const n=this._map.getZoomScale(i,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,i),a=r.multiplyBy(-n).add(o).subtract(this._map._getNewPixelOrigin(s,i));t.Browser.any3d?t.DomUtil.setTransform(this._container,a,n):t.DomUtil.setPosition(this._container,a)},_onZoom(s){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveEnd(s){this._update(s)},_onAnimZoom({center:s,zoom:i}){this._updateTransform(s,i)},bringToFront(){t.DomUtil.toFront(this._container)},getEvents(){return{zoom:this._onZoom,moveend:this._onMoveEnd,zoomanim:this._onAnimZoom,layeradd:this.bringToFront,zoomend:this.options.onUpdate}},onRemove:function(){t.DomUtil.removeClass(this._container,e);const s=this._container;["transform","webkitTransform","OTransform","MozTransform","msTransform","zIndex","position"].forEach(i=>s.style[i]=null),t.Util.cancelAnimFrame(this._positionTimer),this._container=null}}))}function UF(t,e,s,i){const n=t.filter(E=>E.isVisible()),r=n.size===0,{mapX:o,mapY:a}=n.reduce((E,A)=>{const{latitude:S,longitude:w}=A.getGeoCoordinates(),{x:L,y:T}=i(S,w);return E.mapX.push(L),E.mapY.push(T),E},{mapX:[],mapY:[]}),l=n.getAttribute("x"),d=n.getAttribute("y"),h=n.getAttribute("radius").map(Number),u=new cs({xValues:l,yValues:d,scaledSizeValues:h}),c=new cs({xValues:o,yValues:a});r&&(u.cx=u.cy=0,u.width=u.height=0),isFinite(c.width)&&isFinite(c.height)||(c.cx=c.cy=0,c.width=c.height=0);let g=c.cx-u.cx,f=c.cy-u.cy;const m=r?1:Math.max(c.width,c.height)/Math.max(u.width,u.height),[_,p]=h.reduce((E,A)=>(E[0]=Math.min(E[0],A*m),E[1]=Math.max(E[1],A*m),E),[1/0,0]);c.pad(p),c.minScaledSize=_,c.maxScaledSize=p;const x=s.computeConfigForBounds(c),y=e.zoom/ZA(x.zoom);g+=(u.cx-e.x)*y,f+=(u.cy-e.y)*y;const b=u.cx+g,v=u.cy+f;return{offsetChanges:{name:"graph-to-geo",nodeAttributes:{radius:E=>Number(E.getAttribute("radius"))*y,x:E=>(E.getAttribute("x")+g-b)*y+b,y:E=>(E.getAttribute("y")+f-v)*y+v},edgeAttributes:{width:E=>Number(E.getAttribute("width"))*y}},camera:{zoom:e.zoom/y,x:(e.x+g-b)*y+b,y:(e.y+f-v)*y+v,angle:0,...e.getSize()}}}function GF(t,e,s,i){const n=t.getAttributes(["x","y","radius"]),r=t.getBoundingBox(),o=t.size===0,a=t.reduce((b,{_index:v},E)=>(b[v]=E,b),{});i();const l=t.getAttribute("x"),d=t.getAttribute("y"),h=t.getAttribute("radius"),u=new cs({xValues:l,yValues:d,scaledSizeValues:h.map(b=>2*b)});o&&(r.reset(),u.reset());let c=u.cx-r.cx,g=u.cy-r.cy,f=0,m=0;const _=s.computeConfigForBounds(u),p=e.zoom/_.zoom;let x,y;return isNaN(r.cx)||isNaN(r.cy)?(r.cx=e.x,r.cy=e.y,x=_.x,y=_.y):(c+=(r.cx-e.x)*p,g+=(r.cy-e.y)*p,f=r.cx+c,m=r.cy+g,x=(e.x+c-f)*p+f,y=(e.y+g-m)*p+m),{offsetChanges:{name:"geo-to-graph",nodeAttributes:{x:b=>(n[a[b._index]].x+c-f)*p+f,y:b=>(n[a[b._index]].y+g-m)*p+m}},camera:{zoom:_.zoom,x,y,angle:0,...e.getSize()}}}var Y0={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"},VF={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"},u_={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:void 0},qF=class extends Bt{onMounted(){this._brand=null}set(t,e){let{position:s,horizontalMargin:i,verticalMargin:n,className:r}={...u_,...e};Y0[s]||(s=u_.position),this.remove();const o=document.createElement("div");return _p(o,Bu.sanitize(t)),o.style.position="absolute",$0(o,s,i,n),o.style.zIndex="10",r&&o.setAttribute("class",r),this._brand=o,this._modules.dom.setLayer("brand",this._brand),o}remove(){this._modules.dom.setLayer("brand",null),this._brand=null}};function $0(t,e,s,i){const n=s===void 0?"":s+"px",r=i===void 0?"":i+"px";t.style[Y0[e]]=n,t.style[VF[e]]=r}var c_={},jF=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._settings={...hn},this._edgesOriginalTextStyle={},this._nodesOriginalTextStyle={},this._nodeDraggingSetting=!1,this._transition=!1,this._attribution=null,this._updating=!1,this._updateRate=50,this._x=0,this._y=0,this._onCameraUpdate=t=>{if(this.L&&this._enabled&&this._map&&this._map._loaded){const e=this._x-this._modules.camera.x,s=this._y-this._modules.camera.y;(e||s)&&this._syncMapWithCamera()}},this._syncMapWithCamera=()=>{if(!this._map)return;this._updating||(this._updating=!0,this._layer.setLocked(!0),this._map._moveStart(!0,!1));const t=this._fromPointToLatLng(this._modules.camera.x,this._modules.camera.y),e=md(this._modules.camera.zoom),s=this.L.latLng(t.latitude,t.longitude);this._map._move(s,e,{pinch:!0,round:!1}),clearTimeout(this._updateRequest),this._updateRequest=this._modules.dom.setTimeout(()=>{this._updating=!1,this._layer.setLocked(!1),this._map&&this._map._move(s,e,{pinch:!0})._moveEnd(!0)},this._updateRate)},this._onNodesDragStart=()=>{this._enabled&&(this._setMapDragging(!1),this._nodeDragOffsetX=this._nodeDragOffsetY=0)},this._onNodesDragged=({nodes:t,dx:e,dy:s})=>{if(this._enabled){const i=t.map(n=>{const{x:r,y:o}=n.getAttributes(["x","y"]);return this._fromPointToLatLng(r+e-this._nodeDragOffsetX,o+s-this._nodeDragOffsetY)});return this._nodeDragOffsetX=e,this._nodeDragOffsetY=s,t.setGeoCoordinates(i)}return Promise.resolve(this._modules.graph.nodeList())},this._onMapUpdate=()=>{if(!this._map)return Promise.resolve(void 0);const{lat:t,lng:e}=this._map.getCenter(),s=this._fromLatLngToPoint(t,e);this._x=s.x,this._y=s.y;const i=$A(this._map.getZoom());return this._modules.events.fire("beforeGeoCameraMove",{zoom:this._map.getZoom()}),this._modules.camera.setView({zoom:i,x:s.x,y:s.y},{ignoreZoomLimits:!0}).then(()=>this._adjustMinvisibleSizes())},this.runLayout=async({type:t,nodes:e,latitudePath:s=si,longitudePath:i=ii,options:n,center:r})=>{const o=cS(r),a=o([r.longitude,r.latitude]),l=e.getPosition(),d=[];return e.setAttributes(e.map(h=>{const u=h.getData(s),c=h.getData(i);if(isNaN(u)||isNaN(c))return{x:a[0],y:a[1]};const g=o([c,u]);return{x:g[0],y:g[1]}})).then(()=>this._ogma.layouts[t]({...n,nodes:e,dryRun:!0})).then(h=>{const u=h.positions.current,c=new Array(u.length),g=new Array(u.length),f=new Array(u.length).fill(10);u.forEach((x,y)=>{const b=o.invert([x.x,x.y]);c[y]=b[1],g[y]=b[0],d.push({latitude:b[1],longitude:b[0]})});const m=Mo(g,c,f),_=m[0]-r.longitude,p=m[1]-r.latitude;for(let x=0;x<d.length;x++)c[x]-=p,g[x]-=_,d[x].latitude-=p,d[x].longitude-=_;return e.setData(s,c),e.setData(i,g),e.setAttributes(l)}).then(()=>this._ogma.modules.geo._updateNodesCoordinates(e)).then(()=>d)}}onMounted(){this._modules.events.register(["geoEnabled","beforeGeoDisabled","geoDisabled","geoNodesMoved","geoLoaded","geoReady"]),Ag()&&(this.L=Ds("L")||Ds("leaflet"),this.L&&BF(this.L)),this._modules.graph.createNodeAttribute({name:"geo.prevLat",storage:"float"},!0),this._modules.graph.createNodeAttribute({name:ud,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:si,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:ii,storage:"float"},!0),this._modules.events.register(["beforeGeoCameraMove"]),this._modules.events.on("addNodes",t=>{t.virtual||this._refreshOrAddNodes(t.nodes,!0)}).on("updateNodeData",t=>{this._onDataChange(t.changes)}).on("nodesDragProgress",this._onNodesDragged).on(["nodesDragStart","lassoEnabled"],this._onNodesDragStart).on(["nodesDragEnd","lassoDisabled"],()=>this._setMapDragging(!0)).on("viewChanged",this._onCameraUpdate)}_onDataChange(t){const e=oh(this.latitudePath),s=oh(this.longitudePath),i=t.filter(({virtual:r,property:o,newValues:a})=>!(r||!a.length)&&(o&&typeof o!="string"?o.find(l=>e.startsWith(l)||s.startsWith(l)):o===null||e.startsWith(o)||s.startsWith(o)));if(!i.length)return;const n=lS(i);n&&(this._modules.events.fire("geoNodesMoved",{nodes:n}),this._refreshOrAddNodes(n,!1))}_refreshOrAddNodes(t,e){e&&this._updatePrevNodesCoordinates(t),this._updateNodesCoordinates(t),this._enabled&&(this._cacheOriginalTextStyles(t,null),this._filter.refresh())}_updatePrevNodesCoordinates(t){$o(this._modules.graph,t,si,og),$o(this._modules.graph,t,ii,ud)}_restorePrevNodesCoordinates(t){$o(this._modules.graph,t,og,si),$o(this._modules.graph,t,ud,ii)}_updateNodesCoordinates(t){rS(this._modules.graph,t,this._settings)}_createMapTileLayer(t,e){if(t&&!Ce(t))return t;const s=t,i=s.wms?this.L.tileLayer.wms:this.L.tileLayer,n=KA(s,e)||"";return i(s.url,{attribution:n,...t})}_setupTileLayer(t,e,s){const i=this._createMapTileLayer(t,e);return i.once("load",()=>{this._modules.events.fire("geoLoaded")}),i.addTo(this._map),Eg(i,s),i}_onSettingsChanged(t,e){const s=t.wrapCoordinates!==e.wrapCoordinates,i=t.latitudePath!==e.latitudePath||t.longitudePath!==e.longitudePath;if(s||i){let n=Promise.resolve();this._enabled&&this._filter&&(n=n.then(()=>this._filter.refresh())),n.then(()=>this._updateNodesCoordinates(this._modules.graph.getNodes("all")))}this._enabled&&(tS(t,e)&&this._map&&(this._map.removeLayer(this._tileLayer),this._tileLayer=this._setupTileLayer(e.tiles,e.attribution,e.opacity)),t.sizeRatio!==e.sizeRatio&&this._updateSizes(),t.maxZoomLevel!==e.maxZoomLevel&&this._modules.settings.update({minZoom:1,maxZoom:Math.pow(2,e.maxZoomLevel)}),t.disableNodeDragging!==e.disableNodeDragging&&this._setDragging(!e.disableNodeDragging),t.attributionOptions!==e.attributionOptions&&this._setAttributionOptions(e.attributionOptions,e.attribution),Eg(this._tileLayer,e.opacity))}_setMapDragging(t){if(this._map){const e=t?"enable":"disable";this._map.dragging[e]()}}_fromLatLngToPoint(t,e){return this._map.options.crs.latLngToPoint(this.L.latLng(t,e),sl)}_fromPointToLatLng(t,e){const{lat:s,lng:i}=this._map.options.crs.pointToLatLng(this.L.point({x:t,y:e}),sl);return{latitude:s,longitude:i}}_updateSizes(){this._enabled&&this._projection&&this._projection.updateAll()}enable(t){return this.setEnabled(!0,t)}getMap(){return this._enabled?this._map:null}getOptions(){return this._enabled?{...this._settings,tiles:Ce(this._settings.tiles)?{...this._settings.tiles}:this._settings.tiles}:{...hn}}setOptions(t){if(!this._enabled||this._transition)return;QA(t,this.L);const e=this._settings;this._settings={...hn,...e,...t,tiles:JA(hn,t)},this._onSettingsChanged(e,this._settings)}disable(t){return this.setEnabled(!1,t)}isEnabled(){return this._enabled}toggle(t={}){return this.setEnabled(!this._enabled,t)}getContainerCoords(t){return t.getGeoCoordinates().map(({latitude:e,longitude:s})=>this._map.latLngToContainerPoint([e,s]))}getContainerCoord(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return this._map.latLngToContainerPoint([e||0,s||0])}setEnabled(t,e){if(!Ag())throw new Error("Ogma Geo cannot be used outside a browser");if(!this.L)throw new Error("You are trying to use Geo mode but Leaflet has not been found. Please follow our migration guide: https://bit.ly/2SYkF8A");if(this._transition||t===this._enabled)return Promise.resolve();const s=this._modules.settings;this._enabled||(this._prevSettings=s.get(),this._nodeDraggingSetting=!!s.get("interactions.drag.enabled")),this._enabled=t,this.setOptions(e),this._transition=!0;const i=this._settings;return t?this._show().then(()=>(this._registerTextStyle(this._modules.graph.getNodes(),this._modules.graph.getEdges()),this._setDragging(!i.disableNodeDragging),this._transition=!1,this._updating=!1,this._modules.events.fire("geoEnabled").fire("geoReady"),this._adjustMinvisibleSizes())):this._restoreTextStyle().then(()=>this._hide()).then(()=>{this._transition=!1,this._modules.events.fire("geoDisabled"),this._setDragging(this._nodeDraggingSetting,!0)}).then(()=>this._ogma.view.afterNextFrame())}destroy(){return this._enabled&&this._destroyMapSync(),Promise.resolve()}_cacheOriginalTextStyles(t,e){e&&(this._edgesOriginalTextStyle=wg(e,this._edgesOriginalTextStyle)),t&&(this._nodesOriginalTextStyle=dS(t,this._nodesOriginalTextStyle))}_registerTextStyle(t,e){this._cacheOriginalTextStyles(t,e);const{nodeAttributes:s,edgeAttributes:i}=this._modules.hover.getHoverClassDefinition();this._hoverEdgesOriginalTextStyle=i||null,this._hoverNodesOriginalTextStyle=s||null,this._modules.hover.updateEdgeAttributes({text:{size:n=>(this._edgesOriginalTextStyle[n.getId()]||c_)["text.size"]}}),this._modules.hover.updateNodeAttributes({text:{size:n=>(this._nodesOriginalTextStyle[n.getId()]||c_)["text.size"]}})}_restoreTextStyle(){return this._modules.hover.updateEdgeAttributes(this._hoverEdgesOriginalTextStyle,!0),this._modules.hover.updateNodeAttributes(this._hoverNodesOriginalTextStyle,!0),Promise.all([uS(this._modules.graph.getEdges(),this._edgesOriginalTextStyle)]).then(()=>(this._edgesOriginalTextStyle=wg(this._modules.graph.edgeList(),{}),this._nodesOriginalTextStyle={},this._edgesOriginalTextStyle={},Promise.resolve()))}_setDragging(t,e=!1){this._modules.settings.update({interactions:{drag:{enabled:t,applyResult:e}}})}_setAttributionOptions(t,e){if(this._map){if(this._attribution&&(this._attribution.remove(),this._attribution=null),this._attribution=this.L.control.attribution({prefix:!1}).addTo(this._map),Ce(t)){this._attribution.setPrefix(""),t.position=t.position||"bottom-right";const s=t.position.replace("-","");this._attribution.setPosition(s);const i=this._attribution.getContainer();i&&(t.className&&this.L.DomUtil.addClass(i,t.className),$0(i,t.position||"bottom-right",t.horizontalMargin,t.verticalMargin))}e!=null&&this._attribution.addAttribution(e)}}_nodeIsVisible(t){return oS(t,this._settings,this._hasCustomProjection())}_updateSettingsForMap(){const t=this._modules.graphics.getGraphicsEngine().parseColor(this._settings.backgroundColor);t[3]=0,this._modules.settings.update({backgroundColor:ex(t),minZoom:1e-6,interactions:{rotation:{enabled:!1},drag:{enabled:!1},pan:{enabled:!1},zoom:{enabled:!1,onDoubleClick:!1}},mouse:{wheelEnabled:!1}})}getGraphPosition(t){const e=this.L.latLngBounds(iS(t));return{center:t.size>0?e.getCenter():this.L.latLng([0,0]),zoom:this._clampZoom(this._map.getBoundsZoom(e))}}_initMap(){this._updateSettingsForMap(),this._mapContainer=sS(this._modules.dom.getContainer());const t={...lA,minZoom:this._settings.minZoomLevel,maxZoom:this._settings.maxZoomLevel};this._hasCustomProjection()&&(t.crs=this._settings.crs,t.worldCopyJump=!1,t.maxBoundsViscosity=0),this._map=new this.L.Map(this._mapContainer,t),this._map.on("movestart zoomstart",()=>{this._updating=!0}).on("moveend zoomend",()=>{this._updating=!1}),this._setAttributionOptions(this._settings.attributionOptions,this._settings.attribution),this._setupLayers()}_clampZoom(t){let e=this._tileLayer.options.maxZoom;return e===void 0&&(e=1/0),Math.min(t,e)}_show(){let t;return this._initMap(),this._filter?t=this.filter.enable(0):(this._filter=this._modules.transformations.api.addNodeFilter({criteria:e=>this._nodeIsVisible(e)}),this._filter.setIndex(0),t=this._filter.whenApplied()),t.then(()=>{const e=this._map,s=this._modules.graph.getNodes(),i=this._modules.graph.getEdges(),{center:n,zoom:r}=this.getGraphPosition(s),{offset:o,newCameraView:a}=this._transformToGeo();return this._modules.camera.setView(a,{ignoreZoomLimits:!0}).then(()=>(this._updatePrevNodesCoordinates(s),e.setView(n,r,{animate:!1}),this._modules.graphics.animate({nodes:s,edges:i},()=>{this._projection=this._createFinalPositionLayer()},!0,this._settings.duration))).then(()=>o.destroy())})}updateProjection(){this._projection?.update()}_hasCustomProjection(){return this._settings.crs!=null}_setupLayers(){this._settings.tiles&&(this._tileLayer=this._setupTileLayer(this._settings.tiles,this._settings.attribution,this._settings.opacity)),this._layer=new this.L.OgmaOverlay({container:this._modules.graphics.getDomElement(),mapContainer:this._mapContainer,onUpdate:()=>this._onMapUpdate()}),this._layer.addTo(this._map)}_adjustMinvisibleSizes(){return Promise.all([hS(this._modules.graph.getEdges(),this._edgesOriginalTextStyle,this._map.getZoom())])}_hide(){if(!this._map)return Promise.resolve();this._modules.settings.update(this._prevSettings);const t=this._map;t.removeLayer(this._layer);const e=this._modules.dom.getContainer(),s=this._modules.graphics.getDomElement();e&&e.appendChild(s),t.getContainer().style.zIndex="0";const i=this._modules.graph.getNodes("all"),n=this._modules.graph.getEdges("all"),{offset:r,newCameraView:o}=this._transformToGraph();return this._modules.camera.setView(o||{}).then(()=>(this._modules.events.fire("beforeGeoDisabled"),Promise.all([ey(t.getContainer(),1,0,this._settings.duration/2).then(()=>this._destroyMapSync()),this._modules.graphics.animate({nodes:i,edges:n},()=>r&&r.destroy(),!0,this._settings.duration)]))).then(()=>(this._map=null,this._filter.disable(0).then(()=>{})))}_destroyMapSync(){if(this._map){this._layer&&this._layer._map&&this._map.removeLayer(this._layer),this._map.remove(),this._map._animatingZoom=!1,this._map=null;const t=this._mapContainer.parentNode;t&&t.removeChild(this._mapContainer)}}_transformToGeo(){const t=this._modules.graph.getNodes(),{offsetChanges:e,camera:s}=UF(t,this._modules.camera,this._modules.locate,(i,n)=>this._fromLatLngToPoint(i,n));return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}_addGraphAttributesLayer(t){return this._modules.graphics.addAttributeLayer({priority:AS,nodeSelector:e=>e.isVisible(),edgeSelector:e=>e.isVisible(),...t})}_transformToGraph(){const t=this._modules.graph.getNodes("all"),{offsetChanges:e,camera:s}=GF(t,this._modules.camera,this._modules.locate,()=>{this._projection&&(this._projection.destroy(),this._projection=null)});return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}getPointFromLatLng(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return e==null?t.getAttributes(["x","y"]):this._fromLatLngToPoint(e,s)}_createFinalPositionLayer(){return this._addGraphAttributesLayer({name:"graph-2-geo-animation",nodeAttributes:{scalingMethod:"fixed",radius:t=>Number(t.getAttribute("radius"))*this._settings.sizeRatio,x:t=>this.getPointFromLatLng(t).x,y:t=>this.getPointFromLatLng(t).y},edgeAttributes:{scalingMethod:"fixed",width:t=>Number(t.getAttribute("width"))*this._settings.sizeRatio}})}setCenter(t,e){return this._enabled?this.setView(t,e,md(this._modules.camera.getZoom())):Promise.resolve()}setZoom(t){return this._enabled&&this._map?(t=this._clampZoom(t),this._map.setZoom(t),new Promise(e=>{const s=this._map;if(s.getZoom()===t)return e(void 0);s.once("moveend zoomend",e)}).then(this._onMapUpdate)):Promise.resolve()}zoomIn(){return this.setZoom(this.getZoom()+1)}zoomOut(){return this.setZoom(this.getZoom()-1)}setView(t,e,s){if(!this._enabled||!this._map)return Promise.resolve();const i=this._map;s=this._clampZoom(s);const n=this.L.latLng([t,e]);return i.setView(n,s,{animate:!1,reset:!0}),new Promise(r=>{if(i.getZoom()===s&&i.getCenter().equals(n))return r(void 0);i.once("moveend zoomend",r)}).then(this._onMapUpdate)}getView(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{zoom:this._map.getZoom(),latitude:t.lat,longitude:t.lng}}getCenter(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{latitude:t.lat,longitude:t.lng}}getZoom(){if(this._enabled&&this._map)return this._map.getZoom()}resetCoordinates(){if(!this._enabled||!this._projection)return;const t=this._modules.graph.getNodes();this._restorePrevNodesCoordinates(this._modules.graph.getNodes());const e=this._modules.graph.getNodeAttribute(si).getMultiple(t._indexes),s=this._modules.graph.getNodeAttribute(ii).getMultiple(t._indexes);t.setData(this._settings.latitudePath,e),t.setData(this._settings.longitudePath,s),this._projection.update()}getUnprojectedCoordinates(t){this._projection&&this._projection.destroy();const e=t.getPosition();return this._projection=this._createFinalPositionLayer(),e}get latitudePath(){return this._settings.latitudePath}get longitudePath(){return this._settings.longitudePath}get filter(){return this._filter}exportBackground(t){if(!this._map)return Promise.reject("Map is not ready");const{pixelRatio:e,width:s,height:i,zoom:n,x:r,y:o}=t,a=s*e,l=i*e,d=We(a,l),h=d.getContext("2d"),u=this._map;if(!h)throw new Error(`Unable to get 2d context from  ${d}`);const c=this.getView(),g={zoom:Math.round(md(n*e)),...this._fromPointToLatLng(r,o)},f=new this.L.Canvas;u.addLayer(f);const{vectorMap:m,tileLayers:_,vectorLayers:p,imageOverlays:x,markers:y}=zF(this._layer,u,h,this.L,e,f),b=u.options.zoomSnap;return Promise.resolve().then(()=>(Cn(this._mapContainer,a+"px",l+"px"),u.invalidateSize({animate:!1}),this.setView(g.latitude,g.longitude,g.zoom))).then(()=>np([...m,..._,...x,...p,...y])).then(()=>{Cn(this._mapContainer,"100%","100%"),u.invalidateSize({animate:!1}),u.options.zoomSnap=b,this.setView(c.latitude,c.longitude,c.zoom)}).then(()=>new Promise(v=>this.L.Util.requestAnimFrame(v))).then(()=>u.removeLayer(f)).then(()=>d)}},HF=class extends Bt{constructor(){super(...arguments),this._context={edgesAlwaysCurvy:!1,edgesRoutingStyle:"none",directedEdges:!1}}onMounted(){this._attributeLayer=this._addAttributeLayer(),this._modules.settings.register("edgesAlwaysCurvy",!1,t=>{this._context.edgesAlwaysCurvy=t,this._attributeLayer.updateAll()}),this._modules.settings.register("directedEdges",!1,t=>{this._context.directedEdges=t,this._attributeLayer.updateAll()}),this._modules.settings.register("edgesRoutingStyle","none",t=>{const e=t&&t!=="none",s=t==="vertical",i=this._ogma.modules?.graphics.getGraphicsEngine();i&&i.setBentEdges(e,s),this._attributeLayer.updateAll()})}computeCurvature(t,e="visible",s){const{edgesAlwaysCurvy:i,directedEdges:n}=this._context,r=t.getSource()===t.getTarget();if(!i&&t.hasParallelEdges()===!1&&!r)return 0;let o=t.getParallelEdges({filter:e});s&&(o=o.filter(d=>s(d)));const a=o.indexOf(t);if(a===-1)return 0;let l;if(r)l=(a+1)*Math.max(+t.getAttribute("width")||0,1);else{const d=t.getSource(),h=o.size;if(h===1&&!i)return 0;if(n){let u=0;for(let c=0;c<a;++c)o.get(c).getSource()===d&&(u+=1);l=u+1}else{const u=d!==o.get(0).getSource();l=h%2!=1||i?(1+(a/2|0))*(a%2==0?1:-1)*(u?-1:1):a===0?0:((a+1)/2|0)*(a%2==0?1:-1)*(u?-1:1)}}return l}_addAttributeLayer(){return this._modules.graphics.addAttributeLayer({name:"curvature",priority:xS,edgeDependencies:{parallelEdges:!0},edgeContext:this._context,edgeAttributes:{curvature:t=>this.computeCurvature(t)}})}};/**
 * @license
 * Copyright Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function WF(t){if(typeof t!="string"||t.trim()===""){let e="Calls to uncheckedconversion functions must go through security review.";throw e+=" A justification must be provided to capture what security assumptions are being made.",new Error(e)}}function Pr(t,e){return WF(e.justification),Mu(t)}var Z0="worker_start",K0="worker_configure",jc="worker_update",Eo="worker_stop",Q0=class extends Ro{constructor(t,e){super(),this._complete=!1,this._destroyed=!1,this._data=null,this._onStart=Yt,this._onStop=Yt,this._setIdle=Yt,this._onPause=Yt,this.timer={start:0,steps:0},this._modules=e,this.configure(t)}configure({configure:t=Hs,update:e=Yt,context:s=Yt,stop:i=Yt,isRunning:n=tl,onStart:r=Yt,onStop:o=Yt,onPause:a=Yt,setIdle:l=Yt}){this._configure=t,this._update=e,this._createContext=s,this._isRunning=n,this._stop=i,this._onStart=r,this._onStop=o,this._setIdle=l,this._onPause=a}setData(t){this._data=t}getData(){return this._data}start(t){this._complete=!1,this._onStart(),this.fire(Z0,{target:this});const e=this._configure(t,this._modules);return this.fire(K0,e),this.send(e),this}stop(t){return this._complete||(this._onStop(),this.send({type:Eo}),this._complete=!0),this}pause(){this._onPause()}setIdle(t){this._setIdle(t)}isBusy(){return!this._complete}destroy(){this._destroyed||(this._destroyed=!0,this._modules&&(this.stop(),delete this._modules))}},J0=/^function\s*\(/,tv=/^\(|^\w+\s?=>/,XF="Layout control code for the worker",Rr={justification:XF};function La(t){const e=t.toString();return e.indexOf("function")===0||tv.test(e)?e:`function ${e}`}var YF=class extends Q0{constructor(t,e){super(t,e);const s=BE([Pr($F(t.imports),Rr),yr`\nconst __CONTEXT = (`,Pr(La(this._createContext),Rr),yr`)();\nconst __UPDATE_FUNC = `,Pr(La(this._update),Rr),yr`\nconst __IS_RUNNING_FUNC = `,Pr(La(this._isRunning),Rr),yr`\nconst __STOP_FN = `,Pr(La(this._stop),Rr),yr`\nlet result;
      self.addEventListener("message", function (evt) {
        if (evt.data && evt.data.type === 'worker_stop') {
          __STOP_FN(__CONTEXT);
          return self.postMessage({ result, isRunning: false });
        }
        result = __UPDATE_FUNC(evt.data, __CONTEXT);
        const isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);
        self.postMessage({ result, isRunning });
      });
    `]);this._worker=sb(s),this._worker.addEventListener("message",i=>{e.dom.isDestroyed()||this.onWorkerMessage(i)})}onWorkerMessage(t){const e=t.data.isRunning,s=t.data.result,i={data:void 0},n=Promise.resolve(s),r={worker:this,workerMessage:s,modules:this._modules,promise:n,data:i,isRunning:e};return this.fire(jc,r),e?this.send(i.data):r.promise.then(()=>(this.fire(Eo,{worker:this,result:s,modules:this._modules}),this.stop(s)))}destroy(){super.destroy(),this._worker.terminate()}send(t){return this._complete||this._worker.postMessage(eb(t)),this}};function $F(t={}){const e=Object.keys(t),s=[];for(let i=0,n=e.length;i<n;i++){const r=e[i],o=t[r];if(typeof o!="function")throw new Error(`Asynchronous worker: dependency "${r}" is not found`);{const a=ZF(o);a?(s.push(g_(o,r)),a!==r&&s.push(`var ${r} = ${a};`)):s.push(`var ${r} = ${g_(o,r)};`)}}return s.join(`
`)}function g_(t,e){const s=t.toString();return J0.test(s)?`function ${t.name||e} ${s.substring(s.indexOf("("))}`:tv.test(s)?`const ${t.name||e} = ${s.toString()}`:s}function ZF(t){const e=t.toString();return t.name?t.name:J0.test(e)?null:e.substring(9,e.indexOf("(")).trim()}var KF=class extends Q0{constructor(t,e){super(t,e),this._context=this._createContext()}sync(t){if(t&&t.type===Eo)return this._stop(this._context);const e=this._update(t,this._context),s=this._isRunning(this._context,t),i={data:void 0},n=Promise.resolve(),r={worker:this,workerMessage:e,modules:this._modules,data:i,promise:n,isRunning:s};return this.fire(jc,r),s?this.send(i.data):r.promise.then(()=>(this.fire(Eo,{worker:this,result:e,modules:this._modules}),this.stop(e)))}send(t){return this._complete||this._modules.dom.setTimeout(()=>this.sync(t),0),this}},QF=class extends Bt{constructor(){super(...arguments),this._pool={}}create(t,e){const s=e&&tb,i=this._modules,n=`${t.name||"worker"}-${s?"async":"sync"}`;let r=this._pool[n];r||(r=this._pool[n]=[]);let o=r.find(a=>!a.isBusy());return o?o.configure(t):(o=s?new YF(t,i):new KF(t,i),this._pool[n].push(o)),o.on(Eo,()=>{o.clearEvents(),this._pool[n].length<2||(o.destroy(),this._pool[n]=this._pool[n].filter(a=>a!==o))}),o}start(t,e){return t.start(e)}run(t,e,s){const i=this.create(t,s);return this.start(i,e)}destroy(){for(const t in this._pool)this._pool[t].forEach(e=>e.destroy()),delete this._pool[t]}},JF=16,f_="cubicOut",m_={duration:300,locate:!1},tD=class extends Bt{constructor(){super(...arguments),this.resolves=new Map,this._running=[],this._textsHidden=!1,this.onInteractionStart=()=>{this.setWorkersIdle(!0)},this.onViewChanged=()=>{this.setWorkersIdle(!1)},this.onVisibilityChange=()=>{Ii().hidden?this.setWorkersIdle(!0):this.setWorkersIdle(!1)},this._onWorkerUpdate=(t,e,s,i,n)=>{const{duration:r,onSync:o,onUpdate:a,dryRun:l,locate:d}=i,h=n.workerMessage,u=n.isRunning;if(o&&this._modules.dom.setTimeout(()=>o(h,this._modules,u),r),s){const c=s(h,this._modules,u);this._modules.events.fire("layoutComputed",{type:"layoutComputed",name:e,positions:c}),a&&a(h,c,u);const g=n.promise.then(()=>this._assignNodePositions(c,r,l,i.easing)).then(()=>{u||this._onWorkerComplete(t,c,h,this._layouts[e],i,t.getData())});u||d&&c&&this._animateCamera(c,d,i.duration),n.promise=g.then(()=>{})}else u||t.fire("taskComplete",h)},this._onWorkerComplete=(t,e,s,i,n,r)=>{for(let h=0;h<this._running.length;h++)if(this._running[h]===t){this._running.splice(h,1);break}i.onStop&&e&&i.onStop(n,e,this._modules);const o=this._modules.graph.nodeList(new Uint32Array(r.indexes)),a=n.dryRun&&e?e:this.collectNodesData(o),l=o.getId(),d={before:Zd(r),current:Zd(a)};this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:d,ids:l}),this._modules.dom.setTimeout(()=>{if(n.onEnd&&n.onEnd(s),n.skipTextDrawing&&this._textsHidden&&(this._modules.graphics.showTexts(),this._textsHidden=!1),!this.resolves.has(t))throw new Error("Worker not found");const h=this.resolves.get(t);this.resolves.delete(t),h({name:i.name,positions:d,ids:l})},10)},this._onWorkerStart=(t,e,s)=>{e.skipTextDrawing&&!this._textsHidden&&(this._modules.graphics.hideTexts(),this._textsHidden=!0);const i=this._modules.graph.getNodes(e.nodes),n=this.collectNodesData(i),r=n.ids;s.setData(n),this._modules.events.fire("layoutStart",{type:"layoutStart",name:t.name,ids:r,worker:s})}}onMounted(){this._layouts={},this.timers=new Map,this.resolves=new Map,this._modules.events.register(["layoutGetData","layoutPrepare","layoutStart","layoutEnd","layoutComputed"]),this._modules.events.on("clearGraph",()=>this.stop()).on(["dragStart","zoomStart"],this.onInteractionStart).on(["dragEnd","viewChanged"],this.onViewChanged),this._modules.dom.addDocumentEventListener("visibilitychange",this.onVisibilityChange)}setWorkersIdle(t){this._running.forEach(e=>e.setIdle(t))}register(t){if(this._layouts[t.name])throw new Error(`Layout ${t.name} already exists`);this._layouts[t.name]=t}getAvailableLayouts(){return Object.keys(this._layouts)}start(t,e={}){const s=this._layouts[t];this._modules.events.fire("layoutPrepare",{name:t,params:e});const i=k0(this._modules.graph,e,["radial","grid"].indexOf(t)===-1);return new Promise(n=>{if(!s)throw new Error(`layout ${t} does not exist`);i.duration=typeof i.duration=="number"?i.duration:m_.duration;const r=s.onSync;i.skipTextDrawing=i.skipTextDrawing===void 0?!0:!!i.skipTextDrawing;let o=i.locate||m_.locate;o&&typeof o=="boolean"&&(o={}),i.locate=o;const a={name:t,update:s.update,isRunning:s.isRunning,configure:s.configure,context:s.context,imports:s.imports,stop:s.stop,setIdle:s.setIdle};this._modules.graphics.forceAttributesComputation();const l=i.useWebWorker===void 0?!0:!!i.useWebWorker,d=this._modules.workers.create(a,l);this.resolves.set(d,n),d.on(Z0,()=>{s.onStart&&s.onStart(e),this._onWorkerStart(s,i,d)}).on(K0,h=>{this._modules.events.fire("layoutGetData",{name:t,data:h})}).on(jc,h=>{const u=h.workerMessage,c=u.lastUpdate||-1/0,g=h.isRunning,f=ts();g&&(!i.continuous||f-c<JF)||(u.lastUpdate=f,this._onWorkerUpdate(d,t,r,i,h))}),this._modules.workers.start(d,i),this._running.push(d)})}_animateCamera(t,e,s){if(t.indexes.length===0)return Promise.resolve();const i=this._modules.locate.layoutDataBoundingBox(t),n=this._modules.locate.computeConfigForBounds(i,e);return this._modules.camera.setView(n,{duration:s,easing:e.easing||f_,ignoreZoomLimits:!0})}stop(){for(;this._running.length!==0;){const t=this._running.pop();t.stop(),t.fire("taskComplete",null)}return Promise.resolve()}isRunning(){return this._running.length!==0}_assignNodePositions(t,e,s,i=f_){if(!t||s){const d=t?new Uint32Array(t.indexes):void 0,h=this._modules.graph.nodeList(d);return Promise.resolve(h)}const{indexes:n,x:r,y:o}=t,a=this._modules.graph.nodeList(new Uint32Array(n)),l=Zd(t);for(let d=0;d<l.length;d++)l[d]={x:r[d],y:o[d]};return a.setAttributes(l,{duration:e,easing:i})}collectNodesData(t){const e=t._indexes,s=this._modules.graph.getNodeAttribute("x").getMultiple(e),i=this._modules.graph.getNodeAttribute("y").getMultiple(e);return{ids:t.getId(),indexes:e,x:s,y:i}}};function Zd({x:t,y:e,indexes:s}){const i=s.length,n=new Array(i);for(let r=0;r<i;r++)n[r]={x:t[r],y:e[r]};return n}function __(t){return typeof t=="number"&&isNaN(t)}var p_=class{constructor(){this._keys=[],this._values=[]}set(t,e){const s=this._getIndex(t);return s===-1?(this._keys.push(t.slice()),this._values.push(e),!0):(this._values[s]=e,!1)}get(t){const e=this._getIndex(t);return e===-1?void 0:this._values[e]}has(t){return this._getIndex(t)!==-1}delete(t){const e=this._getIndex(t);return e!==-1&&(this._keys.splice(e,1),this._values.splice(e,1),!0)}keys(){return this._keys.map(t=>t.slice())}values(){return this._values.slice()}_getIndex(t){for(let e=0;e<this._keys.length;e++){const s=this._keys[e];if(s.length===t.length){let i=!0;for(let n=0;n<t.length;n++){const r=s[n],o=t[n];if(!(r===o||__(r)&&__(o))){i=!1;break}}if(i)return e}}return-1}get size(){return this._keys.length}},eD=class{constructor(){this._map=new Map,this._arrays=new p_}clear(){return this._arrays=new p_,this._map.clear()}delete(t){return He(t)?this._arrays.delete(t):this._map.delete(t)}get(t){return He(t)?this._arrays.get(t):this._map.get(t)}set(t,e){return He(t)?this._arrays.set(t,e):this._map.set(t,e),this}keys(){return[...sx(this._map),...this._arrays.keys()]}values(){return[...ix(this._map),...this._arrays.values()]}get size(){return this._map.size+this._arrays.size}},sD=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s||[],this._filter=i,this._unwindArrays=n,this._onUpdateHandlers=[],this._triggerUpdate=r=>{for(let o=0;o<this._onUpdateHandlers.length;++o)this._onUpdateHandlers[o](r)},this._info=t.watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}onUpdate(t){this._onUpdateHandlers.push(t)}getPropertyInfo(){return this._info}getPath(){return this._path.slice()}destroy(){this._module.unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}},iD=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s,this._filter=i,this._unwindArrays=n,this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[]}get path(){return this._path}onPropertyAdded(t){return this._onAddHandlers.push(t),this}onPropertyRemoved(t){return this._onRemoveHandlers.push(t),this}onPropertyUpdated(t){return this._onUpdateHandlers.push(t),this}getPath(){return this._path.slice()}getProperties(){return this._propertyList.slice()}getPropertyInfo(t){const e=this._properties[t];return e?e.info:null}destroy(){ri(this._properties,({handler:e},s)=>{const i=this._path.concat([s]);this._module.unwatchPropertyInformation(this._isNode,i,e,this._filter,this._unwindArrays)}),this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[];const t=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(t,1)}updateSubPropertiesToWatch(t,e){if(t!==this._isNode)return;const s=e.getData(this._path);for(let i=0;i<s.length;i++){const n=s[i];if(wn(n)){const r=Object.keys(n);for(let o=0;o<r.length;o++)this._addSubPropertyToWatch(r[o])}}}_addSubPropertyToWatch(t){if(!this._properties[t]){const e=this._path.concat([t]),s=()=>this._triggerPropertyUpdate(t),i=this._unwindArrays,n=this._isNode,r=this._filter,o=this._module.watchPropertyInformation(n,e,s,r,i);this._properties[t]={handler:s,info:o},this._triggerPropertyUpdate(t)}}_triggerPropertyUpdate(t){const{info:e}=this._properties[t],s=this._propertyList.indexOf(t),i=s!==-1,n=e.getType()!=="undefined";!i&&n?(this._propertyList.push(t),this._triggerHandlers("_onAddHandlers",t,e),this._triggerHandlers("_onUpdateHandlers",t,e)):i&&!n?(this._propertyList.splice(s,1),this._triggerHandlers("_onUpdateHandlers",t,e),this._triggerHandlers("_onRemoveHandlers",t,e)):i&&n&&this._triggerHandlers("_onUpdateHandlers",t,e)}_triggerHandlers(t,e,s){const i=this[t];for(let n=0,r=i.length;n<r;n++)i[n](e,s)}},nD=class{constructor(){}setWatcher(t){this._watcher=t}isNode(){return this._watcher.isNode}getPath(){return this._watcher.property.slice()}getBoundaries(){const t=this._watcher.boundaries;return t?{min:t.min,max:t.max}:null}getValues(){return this._watcher.values.keys()}getValueCount(t){return this._watcher.values.get(t)||0}getCount(){return this._watcher.total}getType(){return this._watcher.any>0?"any":this._watcher.numbers>0?"number":"undefined"}},rD=class extends Bt{constructor(){super(...arguments),this._onExcludedStateChange=({elements:t,value:e})=>{const s=!e;for(let i=0,n=this._propertyWatchers.length;i<n;i++){const r=this._propertyWatchers[i];r.isNode===t.isNode&&r.filter==="visible"&&(s?$r(r,t.getData(r.property)):Za(r,t.getData(r.property)),Na(r))}},this._onDataChange=({isNode:t,changes:e})=>{for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.property,r=i.filter==="all";if(i.isNode===t)for(let o=0;o<e.length;++o){const a=e[o],l=lD(a.property||[],n);if(l){const d=a.nodes||a.edges,h=[],u=[];if(d)for(let c=0;c<d.size;++c){const g=d.get(c);(r||g.isVisible())&&(h.push(ve(a.newValues[c],l)),u.push(ve(a.previousValues[c],l)))}h.length&&($r(i,h),Za(i,u),Na(i))}}}for(let s=0,i=this._objectPropertyWatchers.length;s<i;s++){const n=this._objectPropertyWatchers[s],r=n.path;for(let o=0;o<e.length;++o){const{property:a,nodes:l,edges:d}=e[o],h=l||d;if(h){const u=h.isNode;(!a||a.length<=r.length+1&&r.every((c,g)=>c===a[g]))&&n.updateSubPropertiesToWatch(u,h)}}}},this._onElementsAdded=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s];if(i.isNode===e.isNode){const n=e.getData(i.property);n.length&&($r(i,n),Na(i))}}for(let s=0;s<this._objectPropertyWatchers.length;s++)this._objectPropertyWatchers[s].updateSubPropertiesToWatch(e.isNode,e)},this._onElementsRemoved=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.filter==="all";if(i.isNode===e.isNode&&n){const r=e.getData(i.property);r.length&&(Za(i,r),Na(i))}}},this._onGraphClear=()=>{this._propertyWatchers.forEach(t=>{t.numbers=0,t.any=0,t.total=0,t.boundaries=null,t.values.clear()})}}onMounted(){this._propertyWatchers=[],this._objectPropertyWatchers=[],this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on(["updateNodeData","updateEdgeData"],this._onDataChange).on(["addNodes","addEdges"],this._onElementsAdded).on(["removeNodes","removeEdges"],this._onElementsRemoved).on("clearGraph",this._onGraphClear)}watchNodeObjectProperty(t){return this._watchObjectProperty(!0,Ma(t))}watchEdgeObjectProperty(t){return this._watchObjectProperty(!1,Ma(t))}watchNodeNonObjectProperty(t){return this._watchNonObjectProperty(!0,Ma(t))}watchEdgeNonObjectProperty(t){return this._watchNonObjectProperty(!1,Ma(t))}watchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n)||this._createWatcher(t,e,i,n);return s&&r.onChange.push(s),r.info}unwatchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n);if(!r)return;const o=r.onChange,a=o.indexOf(s);if(a!==-1&&(o.splice(a,1),o.length===0)){const l=this._propertyWatchers.indexOf(r);this._propertyWatchers.splice(l,1)}}_watchObjectProperty(t,e){const s=new iD(this,t,e);return this._objectPropertyWatchers.push(s),s.updateSubPropertiesToWatch(t,this._modules.graph[t?"getNodes":"getEdges"](e.filter)),s}_watchNonObjectProperty(t,e){return new sD(this,t,e)}_findWatcher(t,e,s,i){for(let n=0;n<this._propertyWatchers.length;++n){const r=this._propertyWatchers[n];if(r.isNode===t&&r.filter===s&&r.unwindArrays===i&&aD(r.property,e))return r}return null}_createWatcher(t,e,s,i){const n={isNode:t,property:e,numbers:0,any:0,total:0,values:new eD,boundaries:null,onChange:[],filter:s,unwindArrays:i,info:new nD};return n.info.setWatcher(n),$r(n,this._modules.graph[t?"getNodes":"getEdges"](s).getData(e)),this._propertyWatchers.push(n),n}};function y_(t){return t==null?[]:Sn(t)}function oD(t){return t==="all"?"all":"visible"}function Na(t){for(let e=0;e<t.onChange.length;++e)t.onChange[e](t.info)}function aD(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}function lD(t,e){if(t.length>e.length)return null;let s=0;for(;s<t.length;++s)if(t[s]!==e[s])return null;return e.slice(s)}function $r(t,e,s){const i=t.values,n=!s&&t.unwindArrays;for(let r=0;r<e.length;++r){const o=e[r];if(s||o===void 0||(t.total+=1),n&&Array.isArray(o))$r(t,o,!0);else{const a=i.get(o);a?i.set(o,a+1):(i.set(o,1),Zl(o)?(t.boundaries?o<t.boundaries.min?t.boundaries.min=o:o>t.boundaries.max&&(t.boundaries.max=o):t.boundaries={min:o,max:o},t.numbers+=1):o!==void 0&&(t.any+=1))}}}function Za(t,e,s){const i=t.values,n=!s&&t.unwindArrays,r=t.boundaries;let o=!1;for(let a=0;a<e.length;++a){const l=e[a];if(s||l===void 0||(t.total-=1),n&&Array.isArray(l))o=o||Za(t,l,!0);else{const d=i.get(l);d>1?i.set(l,d-1):(i.delete(l),Zl(l)?(t.numbers-=1,!r||r.min!==l&&r.max!==l||(o=!0)):l!==void 0&&(t.any-=1))}}return!s&&o&&(t.boundaries=dD(i.keys())),o}function dD(t){let e=null,s=null;for(let i=0;i<t.length;++i){const n=t[i];Zl(n)&&((e==null||n<e)&&(e=n),(s==null||n>s)&&(s=n))}return e==null||s==null?null:{min:e,max:s}}function Ma(t){return typeof t!="object"||t===null||Array.isArray(t)?{path:y_(t),filter:"visible",unwindArrays:!1}:{path:y_(t.path),filter:oD(t.filter||"visible"),unwindArrays:!!t.unwindArrays}}var hD=class extends Bt{onMounted(){this._modules.events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])}get x(){return this._modules.position.x||0}get y(){return this._modules.position.y||0}_later(){return this._modules.dom.afterNextFrame()}move({x:t,y:e}){if(t!==void 0&&e!==void 0){const s=t-this.x,i=e-this.y;this._modules.events.fire("virtualMove",{x:t,y:e,dx:s,dy:i})}return Promise.resolve()}down({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDown",{x:this.x,y:this.y,button:s}),this._modules.events.fire("virtualMove",{x:this.x,y:this.y,dx:0,dy:0,button:s})})}up({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualUp",{x:t,y:e,button:s})})}click({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}rightClick({x:t,y:e,button:s="right"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}doubleclick({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDoubleClick",{x:t,y:e,button:s})})}drag(t,e){return this.down(t).then(()=>this.move(e)).then(()=>this.up(e))}wheel({x:t,y:e,dx:s,dy:i,delta:n,metaKey:r,ctrlKey:o}){return this.move({x:t,y:e}).then(()=>(this._modules.events.fire("virtualWheel",{x:t,y:e,dx:s,dy:i,delta:n,domEvent:{metaKey:r,ctrlKey:o}}),this._later()))}};function Ms(t,e,s,i,n,r){const o=ps(),a=r.graphToScreenCoordinates(t),l=r.graphToScreenCoordinates(e);n.beginPath(),n.moveTo(a.x*o,a.y*o),n.lineTo(l.x*o,l.y*o),n.strokeStyle=i,n.lineWidth=s,n.stroke()}function x_(t,e,s,i){let n,r,o,a=0,l=t.length-1;for(;a<l&&a>-1;)if(n=(a+l)/2|0,r=Math.abs(e[t[n]]-s),o=Math.abs(e[t[n+1]]-s),o<r)a=n+1;else if(o>r)l=n;else{const d=Math.abs(e[t[a]]-s),h=Math.abs(e[t[l]]-s);if(d<h)l=n;else{if(!(d>h))return l;a=n+1}}return i?l:t[l]}function b_(t,e,s,i,n,r,o){let a,l,d,h,u,c;for(let g=0,f=t.length;g<f;g++)for(let m=0;m<f;m++){if(g===m)continue;let _=t[g],p=t[m];m<g&&(h=p,p=_,_=h);const x=e[_],y=e[p],b=r.get(_),v=r.get(p);if(x+b<i-n&&y-v>i+n&&Math.abs(Math.abs(x+b-(i-n))-Math.abs(y-v-(i+n)))<=o)return a=_,l=s,d=p,c=x+b+Math.abs(y-v-(x+b))/2,u=[x+b,c-n,c+n,y-v],{a,b:l,c:d,current:s,target:c,points:u};if(x+b<i-n&&y+v<i-n&&Math.abs(Math.abs(x+b-(y-v))-Math.abs(Math.max(x+b,y+v)-(i-n)))<=o)return a=_,l=p,d=s,c=y+b+Math.abs(Math.abs(x+b-(y-v)))+n,u=[x+b,y-v,y+v,c-n],{a,b:l,c:d,current:s,target:c,points:u};if(x-b>i+n&&y-v>i+n&&Math.abs(Math.abs(x+b-(y-v))-Math.abs(Math.min(x-b,y-v)-(i+n)))<=o)return a=s,l=_,d=p,c=x-b-Math.abs(Math.abs(x+b-(y-v)))-n,u=[c+n,x-b,x+b,y-v],{a,b:l,c:d,current:s,target:c,points:u}}return null}var Kd={enabled:!1,tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:!0,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:!0,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}},uD=class extends Bt{constructor(){super(...arguments),this._options=Ae(Kd),this._enabled=!1,this._ysnap=0,this._xsnap=0,this._node=null,this._nodes=null,this._r=0,this._vguideline={start:{x:0,y:0},end:{x:0,y:0}},this._hguideline={start:{x:0,y:0},end:{x:0,y:0}},this._gridResolution=0,this._onNodeDragStart=({nodes:t})=>{t.size===1&&(this._node=t.get(0),this._cacheViewportData(),this._r=Number(this._node.getAttribute("radius")))},this._onNodeDragEnd=()=>{this._node=null,this._layer.refresh()}}onMounted(){this._options=Ae(Kd),this._enabled=!1}enable(t){this._enabled||(this._options=As(t,Kd),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(e=>{e.clearRect(0,0,e.canvas.width,e.canvas.height)},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._modules.events.on("nodesDragStart",this._onNodeDragStart).on("nodesDragEnd",this._onNodeDragEnd),this._modules.settings.update({"interactions.drag.onBeforeDrag":(e,s,i,n)=>this._onBeforeDrag(s,i,n)}))}disable(){this._enabled&&(this._modules.events.off(this._onNodeDragStart).off(this._onNodeDragEnd),this._layer.destroy(),this._modules.settings.update({"interactions.drag.onBeforeDrag":null}),this._enabled=!1)}enabled(){return this._enabled}_onBeforeDrag(t,e,s){if(this._node){const i=s[0];this._layer.refresh(n=>{this._scan(n,i)}),this._node.setAttributes(i)}}_cacheViewportData(){const t=this._modules.camera,e=t.screenToGraphCoordinates({x:0,y:0}),s=t.screenToGraphCoordinates({x:t.width,y:t.height});if(this._nodes=this._modules.spatial.getNodesByBoundingBox(e.x,e.y,s.x,s.y),this._node==null)return;const i=this._node._index,n=Array.from(this._nodes._indexes);n.splice(n.indexOf(i),1);const r=this._modules.graph.getNodeAttribute("radius"),o=this._modules.graph.getNodeAttribute("x"),a=this._modules.graph.getNodeAttribute("y"),l=o.buffer(),d=a.buffer(),h=Dr(n.slice(),o),u=Dr(n.slice(),a),c={},g={};this._gridResolution=Number(this._node.getAttribute("radius"));const f=this._gridResolution;for(let m=0,_=n.length;m<_;m++){const p=h[m],x=u[m],y=l[p]/f|0,b=d[x]/f|0;c[y]||(c[y]=[]),g[b]||(g[b]=[]),c[y].push(p),g[b].push(x)}this._nodesByX=h,this._nodesByY=u,this._xGrid=c,this._yGrid=g,this._xList=o,this._yList=a,this._X=l,this._Y=d,this._R=r}_scan(t,e){if(this._node==null)return;const s=this._node._index,i=e.x,n=e.y,r=this._r,o=this._options,a=this._xList,l=this._yList,d=this._R,h=this._X,u=this._Y,c=this._modules.camera.zoom,g=Math.min(r,this._options.tolerance/c),f=2*r*o.sideSnapDistanceFactor,m=o.guidelineWidth,_=o.guidelineColor;let p,x,y,b,v,E,A,S,w=s,L=s,T=null,F=!1,V=!1;if(w=x_(this._nodesByX,h,i),L=x_(this._nodesByY,u,n),Math.abs(h[w]-i)>o.centerSnapDistance&&(w=s),Math.abs(u[L]-n)>o.centerSnapDistance&&(L=s),this._xsnap=0,w!==s){p=this._vguideline.start,x=this._vguideline.end,S=w,y=h[S],b=u[S],T=d.get(S),A=Math.abs(i-y);const G=Math.abs(i-r-(y-T)),O=Math.abs(i+r-(y+T));if(A<Math.max(r,T)){b<n?(p.y=b-T,x.y=n+r):(p.y=b+T,x.y=n-r);const j=Math.min(G,A,O);j===A?(p.x=x.x=y,x.y=n,p.y=b,this._xsnap=1):Math.abs(n-b)<T+r+f&&(j===G?(p.x=x.x=y-T,this._xsnap=2):(p.x=x.x=y+T,this._xsnap=3)),j<g&&(F=!0)}this._xsnap!==0&&Ms(p,x,m,_,t,this._modules.camera)}if(this._ysnap=0,L!==s){p=this._hguideline.start,x=this._hguideline.end,S=L,y=h[S],b=u[S],T=d.get(S),A=Math.abs(n-b);const G=Math.abs(n-r-(b-T)),O=Math.abs(n+r-(b+T));if(A<Math.max(r,T)){y<i?(p.x=y-T,x.x=i+r):(p.x=y+T,x.x=i-r);const j=Math.min(G,A,O);j===A?(p.y=x.y=b,x.x=i,p.x=y,this._ysnap=1):Math.abs(i-y)<T+r+f&&(j===G?(p.y=x.y=b-T,this._ysnap=4):(p.y=x.y=b+T,this._ysnap=5)),j<g&&(V=!0)}this._ysnap!==0&&Ms(p,x,m,_,t,this._modules.camera)}if(T!=null&&o.preferredDistance.enabled){const G=o.preferredDistance.ratio,O=Math.min(o.preferredDistance.tolerance/c,r),j=Math.max(r,T);if(w===s||this._xsnap!==0&&F){if(L!==s&&(this._ysnap===0||!V)&&(S=L,y=h[S],b=u[S],T=d.get(S),E=Math.abs(n-b)-(r+T)*(1+G),E<=O&&E>=-O)){const W=n<b?-1:1;p=this._hguideline.start,x=this._hguideline.end,p.x=y-j,x.x=y+j,p.y=x.y=b,Ms(p,x,m,_,t,this._modules.camera),p.x=i-j,x.x=i+j,p.y=x.y=b+W*(1+G)*(r+T),Ms(p,x,m,_,t,this._modules.camera),this._ysnap=1,V=!0}}else if(S=w,y=h[S],b=u[S],T=d.get(S),v=Math.abs(i-y)-(r+T)*(1+G),v<=O&&v>=-O){const W=i<y?-1:1;p=this._vguideline.start,x=this._vguideline.end,p.x=x.x=y+W*(1+G)*(r+T),p.y=b-j,x.y=b+j,p.x=x.x=y,Ms(p,x,m,_,t,this._modules.camera),p.y=n-j,x.y=n+j,p.x=x.x=y+W*(1+G)*(r+T),Ms(p,x,m,_,t,this._modules.camera),this._xsnap=1,F=!0}}if(o.neighbours.enabled){const G=this._gridResolution,O=i/G|0,j=n/G|0,W=this._xGrid,et=this._yGrid,at=[],mt=[].concat(et[j-1]||at,et[j]||at,et[j+1]||at),vt=[].concat(W[O-1]||at,W[O]||at,W[O+1]||at);let wt;mt.length>1&&(Dr(mt,a),wt=b_(mt,h,s,i,r,d,g),wt&&(this._drawNeighbourGuidelines(t,wt,e,!1),F=!1)),vt.length>1&&!wt&&(Dr(vt,l),wt=b_(vt,u,s,n,r,d,g),wt&&(this._drawNeighbourGuidelines(t,wt,e,!0),V=!1))}(F||V)&&this._snap(e,!F,!V)}_drawNeighbourGuidelines(t,{a:e,b:s,c:i,points:n,target:r},o,a){const l={x:0,y:0},d={x:0,y:0},h=this._R,u=this._X,c=this._Y;let[g,f,m]=h.getMultiple([e,s,i]);const{offset:_,lineWidth:p,lineColor:x}=this._options.neighbours;let y,b;a?(o.y=r,g=-g,f=-f,m=-m,y=d.x=l.x=Math.min(u[e]+g,u[s]+f,u[i]+m)-_,b=u):(o.x=r,y=d.y=l.y=Math.max(c[e]+g,c[s]+f,c[i]+m)+_,b=c);const v=a?"y":"x",E=a?"x":"y";l[v]=n[0],d[v]=n[1],Ms(l,d,p,x,t,this._modules.camera),l[v]=n[2],d[v]=n[3],Ms(l,d,p,x,t,this._modules.camera),l[v]=n[0],l[E]=y-_/2,d[v]=n[0],l[E]=b[e]+g,Ms(l,d,p,x,t,this._modules.camera),l[v]=n[1],l[E]=y-_/2,d[v]=n[1],l[E]=b[s]+f,Ms(l,d,p,x,t,this._modules.camera),l[v]=n[2],l[E]=y-_/2,d[v]=n[2],l[E]=b[s]+f,Ms(l,d,p,x,t,this._modules.camera),l[v]=n[3],l[E]=y-_/2,d[v]=n[3],l[E]=b[i]+m,Ms(l,d,p,x,t,this._modules.camera)}_snap(t,e,s){const i=this._xsnap,n=this._ysnap;let r;e||i===0||(r=this._vguideline.end,t.x=i===2?r.x+this._r:i===3?r.x-this._r:r.x),s||n===0||(r=this._hguideline.end,t.y=n===4?r.y+this._r:n===5?r.y-this._r:r.y)}},cD=class{constructor(t,e,s){this._module=t,this._id=e,this._whenApplied=s.then(()=>this)}getId(){return this._id}whenApplied(){return this._whenApplied}refresh(){return this._module.refreshRule(this._id)}getIndex(){return this._module.getRuleIndex(this._id)}setIndex(t){return this._module.setRuleIndex(this._id,t)}update(t){return this._module.updateRule(this._id,t)}getDefinition(){return this._module.getRuleDefinition(this._id)}destroy(){return this._module.destroyRule(this._id)}},gD=1e3,fD=1/gD,mD=class extends Bt{constructor(){super(...arguments),this._idCounter=1,this._rules=[]}onMounted(){this._rules=[],this._modules.events.register(["addStyleRule","removeStyleRule","updateStyleRule","refreshStyleRule"])}_get(t){for(let e=0;e<this._rules.length;++e){const s=this._rules[e];if(s.id===t)return s.index=e,s}throw new Error("calling a method on a destroyed style rule")}_updatePriorities(){for(let t=0;t<this._rules.length;++t){const e=this._rules[t],s=bS+t*fD;e.attributeLayer.update({priority:s})}}addRule(t={}){const e=this._idCounter++,s=this._modules.graphics.addAttributeLayer({name:`rule(${e})`,...v_(t)}),i=this._modules.dom.afterNextFrame(),n=new cD(this,e,i),r={id:e,attributeLayer:s,wrapper:n};return this._rules.push(r),this._updatePriorities(),this._modules.events.fire("addStyleRule",{rule:r,options:t,id:r.id}),n}getRuleIndex(t){const e=this._get(t);return e.index==null?null:e.index}setRuleIndex(t,e){const s=this._get(t),i=Os(e,0,this._rules.length-1);return this._rules.splice(s.index,1),this._rules.splice(i,0,s),this._updatePriorities(),this._modules.dom.afterNextFrame()}updateRule(t,e){const s=this._get(t),i=Object.assign({fullOverwrite:e.fullOverwrite},e);return s.attributeLayer.update(i),this._modules.events.fire("updateStyleRule",{rule:s,options:e}),this._modules.dom.afterNextFrame()}getRuleDefinition(t){return v_(this._get(t).attributeLayer.getDefinition())}destroyRule(t){const e=this._get(t);return this._modules.events.fire("removeStyleRule",{rule:e,id:e.id}),e.attributeLayer.destroy(),this._rules.splice(e.index,1),this._modules.dom.afterNextFrame()}refreshRule(t){const e=this._get(t);return e.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:e,id:t}),this._modules.dom.afterNextFrame()}refreshAllRules(){for(const t of this._rules)t.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:t,id:t.id});return this._modules.dom.afterNextFrame()}getRuleList(){return this._rules.map(t=>t.wrapper)}};function v_(t){return{nodeAttributes:t.nodeAttributes,edgeAttributes:t.edgeAttributes,nodeSelector:t.nodeSelector,edgeSelector:t.edgeSelector,nodeDependencies:t.nodeDependencies,edgeDependencies:t.edgeDependencies,nodeOutput:t.nodeOutput,edgeOutput:t.edgeOutput}}var yu,ei=6,ev=5,io=1,sv=0,iv=0,xu=-1;function nv(t,e,s,i){sv=t,yu=s,iv=e?1:0,xu=i}var E_=(t,e,s,i)=>n=>{const{rects:r,bboxes:o,intersects:a,indexToLayer:l,indexToRemoveNodeText:d,indexToRemoveEdgeText:h}=i;if(o[n*ei+5]===sv&&o[n*ei+4]===s)return!1;const u=n*ev,c=ko(r[u],r[u+1],r[u+2],r[u+3],r[u+4]);if(Yx(yu,c)){if(i.realIntersection=!0,xu<=0&&a.push(yu,c),!(l[o[n*ei+5]]<xu))return!0;t.remove(n),i.realIntersection=!1,o[n*ei+4]===iv?d[o[n*ei+5]]=!0:h[o[n*ei+5]]=!0}return!1};function A_(t,e,s="#22ff00"){return bu([[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]].map(i=>({x:i[0],y:i[1]})),e,s)}function bu(t,e,s="#ff0000"){e.strokeStyle=s,e.beginPath();for(let i=0,n=t.length;i<n;i++)i===0?e.moveTo(t[i].x,t[i].y):e.lineTo(t[i].x,t[i].y);e.closePath(),e.stroke()}function _D(t,e,s,i,n){for(let a=0,l=e.length;a<l;a+=ei)A_(e.slice(a,a+4),t,"#aaaaaa");for(let a=0;a<s.length;a+=ev)bu(ko(s[a],s[a+1],s[a+2],s[a+3],s[a+4]),t,"green");const r=[n.root];let o=n.root;for(;o=r.pop();)o.leaf||r.push.apply(r,o.children),A_(n.getNodeBounds(o),t,"rgba(0,0,0,0.2)"),o=r.pop();i.forEach(a=>bu(a,t,"red"))}var Fr={x1:0,y1:0,x2:0,y2:0},Qd={x:0,y:0},kn={x:0,y:0},pD=Math.PI/2,yD=0;function xD(t,e,s,i,n,r,o,a,l,d,h){const u=a.remove.nodes,c=a.remove.edges,g=a.redraw.edges,f=s.angle,m=s.zoom,_=n.x,p=n.y,x=n.radius,y=Math.PI,{source:b,target:v,scalingMethod:E}=i,A=i.width,S=i.curvature,w=i.layer,L=i.text.content,T=i.text.scaling,F=i.text.size,V=i.text.font,G=i.text.style,O=i.text.scale,j=i.text.maxLineLength,W=i.text.margin,et=i.text.minVisibleSize,at=i.text.padding,mt=i.animationDuration,vt=i.text.adjustAngle,wt=i.text.position;a.indexToLayer={},a.indexToQuadIndex={},a.indexToRemoveNodeText={},a.indexToRemoveEdgeText={},a.indexToRedrawEdgeText={},a.byLayer=[];const{byLayer:Et,indexToLayer:yt,indexToQuadIndex:St,indexToRedrawEdgeText:zt,indexToRemoveNodeText:Zt,indexToRemoveEdgeText:Kt}=a;for(let rt=0;rt<t.length;rt++){const ft=t[rt],Nt=w.get(ft)-xy;for(let Rt=1;Rt<=Nt;Rt++)(Et[Rt]=Et[Rt]||[]).push(ft);yt[ft]=Nt}if(l!==null){const rt=Et.length;for(let ft=yt[l]+1;ft<=rt;ft++)(Et[ft]=Et[ft]||[]).unshift(l);yt[l]=rt}const X=[0,0,0,0],Q=[0,0,0,0,0],{bboxes:gt,rects:lt}=a,st=(rt,ft=-1)=>{const Nt=mt.get(rt);let Rt=L?L.get(rt):"";if(Rt===null||Rt===""||Nt)return!1;const Pt=b.get(rt),Vt=v.get(rt);let jt=A.get(rt);const Xt=S.get(rt),Ft=et.get(rt);if(jt*m<Ft)return Kt[rt]=!0,!1;E.get(rt)==="fixed"&&(jt/=m);let oe=(_.get(Pt)+_.get(Vt))/2,Gt=(p.get(Pt)+p.get(Vt))/2;Rt=Rt?Rt.toString():"";const se=!T.get(rt),le=O.get(rt)*(se?1:m),ze=V.get(rt),Ge=(se?F.get(rt):le*jt)*io,$s=G.get(rt),Ss=j.get(rt),ns=wt.get(rt)===Do;let ws=+ns*W.get(rt)+i.text.padding.get(rt);const Xe=_.get(Pt),gs=p.get(Pt),rs=_.get(Vt),Ve=p.get(Vt),fs=x.get(Pt),hi=x.get(Vt);if(Xt===0){const te=ur(Xe,gs,rs,Ve)-f,bs=fs-hi;oe+=bs*Math.cos(te)/2,Gt+=bs*Math.sin(te)/2}let Be;const be=Pt===Vt;if(be)Be=y/4-f,Ql(Xe,gs,Xt,fs,0,Fr),mo(.5,Xe,gs,rs,Ve,Fr.x1,Fr.y1,Fr.x2,Fr.y2,kn),oe=kn.x,Gt=kn.y,ws/=-m;else{if(Xe===rs&&gs===Ve)return!1;Be=ur(Xe,gs,rs,Ve)-f,Xt!==0&&(Nn(Xe,gs,rs,Ve,Xt,Qd),td(.5,Xe,gs,rs,Ve,Qd.x,Qd.y,kn),oe=kn.x,Gt=kn.y)}const ue=ws+yD,ys=Ex(Rt,Ss);if(!ys)return!1;const{lines:Ts,data:de}=ys;let Ye=r(de[0],ze,$s,Ge).width*io;for(let te=1;te<Ts;te++)Ye=Math.max(Ye,r(de[te],ze,$s,Ge).width*io);const we=Ts*Ge,Is=Ye/m/2,qe=we/m/2,Cs=Math.abs(ol(Be))<pD?1:-1;let xs=ns?be?we/m+jt/2+ws:Cs*(ue/m+jt/2+qe):0;if(!be&&Xt===0&&vt.get(rt)){const te=at.get(rt);Ie(Xe,gs,rs,Ve)*m-(fs+hi)*(h?1:m)<Ye+2*te+1&&(xs*=Cs,Be=0)}if(Q[0]=oe-Is,Q[1]=Gt-qe,Q[2]=oe+Is,Q[3]=Gt+qe,Q[4]=Be+f,su(Q,-(Be+f),-xs,Q),Q[2]=Q[2]-Q[0],Q[3]=Q[3]-Q[1],Be=y-Be-f,rd(oe-Is,Gt-qe,2*Is,2*qe,Be,void 0,void 0,X),su(X,Be,xs,X),a.realIntersection=!1,nv(rt,!1,ko(Q[0],Q[1],Q[2],Q[3],Q[4]),ft),e.traverse(X[0],X[1],X[2],X[3],d),a.realIntersection&&!o)return Kt[rt]=!0,!1;if(zt[rt]=!0,Zt[rt]=!1,ft<=0){const te=gt.length/ei;St[rt]=te,gt.push(X[0],X[1],X[2],X[3],0,rt),e.insert(te,X[0],X[1],X[2],X[3]),lt.push(Q[0],Q[1],Q[2],Q[3],Q[4])}else e.insert(St[rt],X[0],X[1],X[2],X[3])};for(const rt of t)st(rt);let ot=!0;for(let rt=0;rt<Et.length;rt++){const ft=Et[rt];if(ft)if(ot)ot=!1;else for(const Nt of ft)st(Nt,rt)}for(let rt=0;rt<t.length;rt++){const ft=t[rt];Zt[ft]?u.push(ft):zt[ft]&&g.push(ft),Kt[ft]&&c.push(ft)}return a}var bD={left:-1,right:1,top:0,bottom:0,center:0},vD={left:0,right:0,top:-1,bottom:1,center:0},ED={left:-1,right:0,top:-.5,bottom:-.5,center:-.5},AD={left:-.5,right:-.5,top:-1,bottom:0,center:-.5},SD=(t,e,s)=>Ex(e,s.get(t))||{lines:0,data:[" "],maxLength:1},wD=(t,e,s,i,n,r,o)=>{const{lines:a,data:l}=SD(t,e,i);let d=s(l[0],n,r,o).width;for(let h=1;h<a;h++)d=Math.max(d,s(l[h],n,r,o).width);return[d,a*o*io]},TD=(t,e,s)=>{const i=e.text.content,n=e.radius,r=e.text.scaling,o=e.text.position,a=e.text.padding,l=e.text.scale,d=e.text.size,h=e.text.style,u=e.text.font,c=e.text.maxLineLength,g=e.text.margin,f=i.get(t),m=n.get(t),_=!r.get(t),p=o.get(t),x=a.get(t),y=l.get(t),b=(_?d.get(t):y*m*2)*io,v=h.get(t),E=u.get(t),A=x+g.get(t),S=bD[p],w=vD[p],[L,T]=wD(t,`${f}`,s,c,E,v,b),F=L/2,V=T/2;return[ED[p]*L,AD[p]*T,S*A,w*A,S*m,w*m,L,T,F,V]};function ID(t,e,s,i,n,r,o,a,l){const d=o.remove.nodes,h=o.remove.edges,u=o.redraw.nodes,c=s.angle,g=s.zoom,f=s.sin,m=s.cos,_=i.x,p=i.y,x=i.radius,y=i.layer,b=i.scalingMethod,v=i.text.content,E=i.text.scaling,A=i.text.minVisibleSize,S=i.animationDuration,w=i.textHidden,L=i.excluded;o.indexToLayer={},o.indexToQuadIndex={},o.indexToRemoveNodeText={},o.indexToRemoveEdgeText={},o.indexToRedrawNodeText={},o.byLayer=[];const{indexToLayer:T,indexToRedrawNodeText:F,indexToRemoveNodeText:V,indexToRemoveEdgeText:G,indexToQuadIndex:O,byLayer:j}=o;for(let yt=0;yt<t.length;yt++){const St=t[yt],zt=y.get(St)-xy;(j[zt]=j[zt]||[]).push(St),T[St]=zt}if(a!==null){const yt=j.length;for(let St=T[a]+1;St<=yt;St++)(j[St]=j[St]||[]).unshift(a);T[a]=yt}let W;const et=[0,0,0,0],at=[0,0,0,0,0],{bboxes:mt,rects:vt}=o,wt=(yt,St=-1)=>{const zt=S.get(yt);let Zt=v.get(yt);if(Zt===null||Zt===""||zt!==0)return!1;let Kt=x.get(yt);const X=A.get(yt);if(L.get(yt)===1)return V[yt]=!0,!1;if(2*Kt*g<X)return w.get(yt)===0&&(V[yt]=!0),!1;b.get(yt)==="fixed"&&(Kt/=g);const Q=_.get(yt),gt=p.get(yt);typeof Zt=="number"&&(Zt=Zt.toString());let[lt,st,ot,rt,ft,Nt,Rt,Pt,Vt,jt]=n(yt);const Xt=!E.get(yt),Ft=Xt?g:1,oe=b.get(yt)==="fixed"?g:1;Xt?(ot+=Vt,rt+=jt,Vt/=g,jt/=g,Rt/=g,Pt/=g):(ot+=Vt*g,rt+=jt*g),lt=lt/Ft+ot/g+ft/oe,st=st/Ft+rt/g+Nt/oe,rd(Q-Vt,gt-jt,Rt,Pt,-c,f,-m,et),at[0]=Q-Vt,at[1]=gt-jt,at[2]=Rt,at[3]=Pt,at[4]=c;const Gt=m*lt-f*st,se=f*lt+m*st;if(et[0]+=Gt,et[1]+=se,et[2]+=Gt,et[3]+=se,at[0]+=Gt,at[1]+=se,o.realIntersection=!1,nv(yt,!0,ko(at[0],at[1],at[2],at[3],at[4]),St),e.traverse(et[0],et[1],et[2],et[3],l),o.realIntersection&&!r)return V[yt]=!0,!1;F[yt]=!0,V[yt]=!1,St<=0?(W=mt.length/ei,O[yt]=W,mt.push(et[0],et[1],et[2],et[3],1,yt),e.insert(W,et[0],et[1],et[2],et[3]),vt.push(at[0],at[1],at[2],at[3],at[4])):e.insert(O[yt],et[0],et[1],et[2],et[3])};for(const yt of t)wt(yt);let Et=!0;for(let yt=0;yt<j.length;yt++){const St=j[yt];if(St)if(Et)Et=!1;else for(const zt of St)wt(zt,yt)}for(let yt=0;yt<t.length;yt++){const St=t[yt];V[St]?d.push(St):F[St]&&u.push(St),G[St]&&h.push(St)}return o}var CD=1,LD="topDown",ND="bottomUp",MD=.15,PD=200,RD=80,FD=["x","y","radius","width","layer","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"].reduce((t,e)=>(t.add(e),t),new Set),DD=class extends Bt{constructor(t,e){super(t),this._textBBoxes=[],this._rects=[],this._enabled=!1,this._geoEnabled=!1,this._intersects=[],this._textDisplacement={},this._textDisplacementUpdate={},this._skipFrames=!1,this._output={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]},rects:this._rects,bboxes:this._textBBoxes,intersects:this._intersects,realIntersection:!1,indexToLayer:{},byLayer:[],indexToRedrawEdgeText:{},indexToRemoveEdgeText:{},indexToRedrawNodeText:{},indexToRemoveNodeText:{},indexToQuadIndex:{}},this._onZoomStart=Fl(({startZoom:s,endZoom:i})=>{this._enabled&&i<s&&this._updateLabels(this._modules.camera.clone({zoom:i}))},RD),this._onAttributesChanged=s=>{if([...s.edgeAttributes,...s.nodeAttributes].some(i=>FD.has(i))){const i=s.nodes._indexes;for(let n=0;n<i.length;n++)this._textDisplacementUpdate[i[n]]=!0;this._update()}},this._onToggle=s=>(s?this._update():this._reset(),this),this._update=()=>{(this._enabled||this._forceEnabled)&&this._updateDebounced()},this._toggleDebug=s=>{s?this._modules.layers.whenReady(()=>{this._layer=this._modules.layers.addCanvasLayer(i=>{i.lineWidth=1/this._modules.camera.getZoom(),_D(i,this._textBBoxes,this._rects,this._intersects,this._quadtree)},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._canvas=this._layer.element,this._ctx=this._canvas.getContext("2d"),this._update()}):this._canvas&&(this._layer.destroy(),this._canvas=this._ctx=null)},this._measureText=(s,i,n,r)=>this._engine.measureText(s,i,n,r),this._textDisplacement={},this._textDisplacementUpdate={},this._quadtree=new Fy(s=>{const i=ei,n=i*s;return this._textBBoxes.slice(n,n+i)},CD),e.forceEnableTextOverlapRemoval&&this.forceEnable()}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.events.register(["labelCollisionsRemoved"]),this.setRate(PD),this._modules.settings.register("texts.preventOverlap",!0,this._onToggle),this._modules.settings.register("texts.debug",!1,this._toggleDebug),this._modules.settings.register("texts.removalStrategy",LD);const t=this._output;this._nodeTraversal=E_(this._quadtree,!1,1,t),this._edgeTraversal=E_(this._quadtree,!1,0,t),this._modules.events.on(["layoutEnd","locate"],()=>this._updateLabels()).on(["viewChanged","mouseover","mouseout"],this._update).on("updateAttributes",this._onAttributesChanged).on("setContainer",({element:e})=>{if(e)return this._enable();this._disable()}).on("zoomStart",this._onZoomStart).on("viewExportStart",({preventOverlap:e,camera:s})=>{e&&this.forceUpdate(s)}).on("viewExportEnd",()=>{this.forceUpdate()}).on("geoEnabled",()=>this._geoEnabled=!0).on("geoDisabled",()=>this._geoEnabled=!1)}getTextsBoundingBox(t,e){if(this._skipFrames=!0,t||e?this._updateLabels(this._modules.camera,t?Array.from(t._indexes):[],e?Array.from(e._indexes):[]):this._updateLabels(),this._skipFrames=!1,this._rects===void 0)throw new Error("this._rects is undefined");const s=this._rects,i=new cs;for(let n=0;n<s.length;n+=5){const r=s[n],o=s[n+1],a=s[n+2],l=s[n+3],d=s[n+4],[h,u,c,g]=rd(r,o,a,l,d);i.addPoint(h,u).addPoint(c,g)}return i}setRate(t){this._updateDebounced=this._modules.sync.debounceIdle(e=>this._updateLabels(e),t)}forceEnable(){this._forceEnabled=!0}update(){this._update()}forceUpdate(t=this._modules.camera){this._updateLabels(t)}_enable(){this._enabled=!0,this._update()}_disable(){this._textBBoxes=[],this._rects=[],this._intersects=[],this._enabled=!1}_onCameraMove(){this._update()}_updateLabels(t=this._modules.camera,e,s){if(!this._modules.settings.get("texts.preventOverlap"))return;const i=this._modules.graphics.getNodeAttributes(),n=this._modules.graphics.getEdgeAttributes();this._intersects=[],this._textBBoxes=[],this._rects=[];const r=t.getAngle(),o=t.getProjectedScreenBounds(MD),a=this._modules.settings.get("texts.removalStrategy")===ND,l={angle:r,zoom:t.zoom,sin:Math.sin(r),cos:Math.cos(r)};this._resetOutput();const d=this._output;if(!e||!s){const f=this._modules.spatial.queryRaw(o[0],o[1],o[2],o[3]);e=f.nodes,s=f.edges}const h=this._quadtree.clear().cover(o[0],o[1],o[2],o[3]);if(e.length+s.length===0)return;const u=this._modules.captor.getPointedElement();let c=null,g=null;u!==null&&(u.isNode?c=u._index:g=u._index);for(const f of e)!this._textDisplacementUpdate[f]&&this._textDisplacement[f]||(this._textDisplacement[f]=TD(f,i,this._measureText),this._textDisplacementUpdate[f]=!1);ID(e,h,l,i,f=>this._textDisplacement[f],a,d,c,this._nodeTraversal),xD(s,h,l,n,i,this._measureText,a,d,g,this._edgeTraversal,this._geoEnabled),this._skipFrames||this._clearOverlaps(this._output),this._modules.settings.get("texts.debug")&&this._layer.refresh()}_clearOverlaps(t){const e=this._modules.graph.nodeList,s=this._modules.graph.edgeList,i=this._modules.graphics,n=e(new Uint32Array(t.remove.nodes)),r=s(new Uint32Array(t.remove.edges)),o=e(new Uint32Array(t.redraw.nodes)),a=s(new Uint32Array(t.redraw.edges));i.setTextHidden(n,!0),i.setTextHidden(r,!0),i.setTextHidden(o,!1),i.setTextHidden(a,!1),this._modules.events.fire("labelCollisionsRemoved",t)}_resetOutput(){const t=this._output;t.remove.nodes=[],t.remove.edges=[],t.redraw.nodes=[],t.redraw.edges=[],t.rects=this._rects,t.bboxes=this._textBBoxes,t.intersects=this._intersects,t.realIntersection=!1,t.indexToLayer={},t.byLayer=[],t.indexToRedrawEdgeText={},t.indexToRemoveEdgeText={},t.indexToRedrawNodeText={},t.indexToRemoveNodeText={},t.indexToQuadIndex={}}_reset(){this._modules.graphics.resetTextHidden(),this._textDisplacement={},this._textDisplacementUpdate={}}},OD=class extends Bt{constructor(){super(...arguments),this._onStartInteractionEvent=(t,e)=>{if(this._current)return;const s=this._interactionsByStartEvent[e];let i;for(const n of s)n.check(t)&&(!i||n.priority>=i.priority)&&(i=n);i&&this._startInteraction(i,t)},this._onProgressInteractionEvent=(t,e)=>{this._current&&this._current.progressEventName===e&&this._current.onProgress&&this._current.onProgress(t)},this._onStopInteractionEvent=(t,e)=>{this._current&&this._current.stopEventName===e&&this._stopCurrentInteraction(null)}}onMounted(){this._interactionsByStartEvent={},this._boundProgressEvents={},this._boundStopEvents={}}_startInteraction(t,e){t.onStart&&t.onStart(e),t.onStop&&(this._current=t,t.disableDetection&&this._modules.captor.setDetectionEnabled(!1))}_stopCurrentInteraction(t){this._current&&this._current.disableDetection&&this._modules.captor.setDetectionEnabled(!0),this._current&&this._current.onStop&&this._current.onStop(t),this._current=void 0}_forceStartInteraction(t,e){this._current&&this._stopCurrentInteraction(e),this._startInteraction(t,e)}_createWrapper(t){return{start:e=>this._forceStartInteraction(t,e)}}_addInteraction(t,e){const s=this._interactionsByStartEvent[t];return s?s.push(e):(this._interactionsByStartEvent[t]=[e],this._modules.events.on(t,this._onStartInteractionEvent)),this._createWrapper(e)}_createProgressiveInteraction(t,e,s,i){const n={priority:S_(i.priority),check:i.check||tl,onStart:i.onStart||Yt,onProgress:i.onProgress||Yt,onStop:i.onStop||Yt,disableDetection:!!i.disableDetection,progressEventName:e,stopEventName:s};return this._boundProgressEvents[e]||(this._boundProgressEvents[e]=!0,this._modules.events.on(e,this._onProgressInteractionEvent)),this._boundStopEvents[s]||(this._boundStopEvents[s]=!0,this._modules.events.on(s,this._onStopInteractionEvent)),this._addInteraction(t,n)}_createNonProgressiveInteraction(t,e){return this._addInteraction(t,{priority:S_(e.priority),check:e.check||tl,onStart:e.handler||Yt,onProgress:void 0,onStop:void 0,disableDetection:!1,progressEventName:void 0,stopEventName:void 0})}onDrag(t){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",t)}onGesture(t){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",t)}onClick(t){return this._createNonProgressiveInteraction("click",t)}onDoubleClick(t){return this._createNonProgressiveInteraction("doubleclick",t)}onHover(t){return this._createNonProgressiveInteraction("mouseover",t)}onUnhover(t){return this._createNonProgressiveInteraction("mouseout",t)}onMouseWheel(t){return this._createNonProgressiveInteraction("mousewheel",t)}onMouseDown(t){return this._createNonProgressiveInteraction("mousedown",t)}onMouseUp(t){return this._createNonProgressiveInteraction("mouseup",t)}onMouseMove(t){return this._createNonProgressiveInteraction("mousemove",t)}};function S_(t){return typeof t=="string"?IS.indexOf(t):typeof t!="number"||isNaN(t)?0:t}var kD=["virtualUp","mouseupInternal","touchUp"],zD=["virtualDown","mousedownInternal","touchDown"],BD=["virtualMove","mousemoveInternal","touchMove"],UD=["virtualClick","clickInternal","touchTap"],GD=["virtualDoubleClick","doubleclickInternal","touchDoubleTap"],VD=["virtualWheel","mousewheelInternal"],qD=100,jD=class extends Bt{constructor(){super(...arguments),this.spatialIndexMarginRatio=5,this._elt=null,this._hoveredElt=null,this._draggedElt=null,this._hover=!1,this._disabledCounter=0,this._accDx=0,this._accDy=0,this._prevX=0,this._prevY=0,this._buttons={left:{isPressed:!1,isDragging:!1},middle:{isPressed:!1,isDragging:!1},right:{isPressed:!1,isDragging:!1}},this._onGraphChanged=()=>{this._resetCurrent(this._modules.position.x,this._modules.position.y),this._onMove({x:this._modules.position.x,y:this._modules.position.y,source:null,domEvent:null})}}onMounted(){this._modules.events.register(["mousemove","mousedown","mouseup","click","doubleclick","mousewheel","mouseout","mouseover","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]),this._modules.settings.register("detect.nodes",!0).register("detect.edges",!0).register("detect.nodeTexts",!0).register("detect.nodeBadges",!0).register("detect.edgeTexts",!0).register("detect.nodeErrorMargin",5).register("detect.edgeErrorMargin",2).register("detect.enableSpatialIndex",!0),this._modules.events.on(["removeNodes","removeEdges","clearGraph"],this._onGraphChanged).on(BD,(t,e)=>{this._onMove({...t,source:an(e)})}).on(zD,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDown({domEvent:t,x:e,y:s,button:i,source:an(n)})}).on(kD,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onUp({domEvent:t,x:e,y:s,button:i,source:an(n)})}).on(UD,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onClick({domEvent:t,x:e,y:s,button:i,source:an(n)})}).on(GD,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDoubleClick({domEvent:t,x:e,y:s,button:i,source:an(n)})}).on(VD,({domEvent:t,x:e,y:s,delta:i,dx:n,dy:r})=>this._onWheel({domEvent:t,x:e,y:s,delta:i,source:"mouse",dx:n,dy:r})).on("touchStartGesture",t=>this._modules.events.fire("gestureStart",t)).on("touchProgressGesture",t=>this._modules.events.fire("gestureProgress",t)).on("touchEndGesture",t=>this._modules.events.fire("gestureEnd",t)).on("documentMouseMove",({domEvent:t,x:e,y:s},i)=>{this._onDocumentMove({domEvent:t,x:e,y:s,source:an(i)})}).on("documentMouseUp",({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDocumentUp({domEvent:t,x:e,y:s,source:an(n),button:i})})}triggerUnhover(){this._hover=!1,this._hoveredElt=null}triggerDetection(){this._detectElement(this._modules.position.x,this._modules.position.y,!1,!1),this._elt&&(this._hoveredElt=this._elt,this._hover=!0)}getPointedElement(){return this._hoveredElt}getDraggedElement(){return this._draggedElt}isAnyButtonPressed(){return this._buttons.left.isPressed||this._buttons.right.isPressed||this._buttons.middle.isPressed}isAnyButtonDragging(){return this._buttons.left.isDragging||this._buttons.right.isDragging||this._buttons.middle.isDragging}isButtonPressed(t){return this._buttons[t].isPressed}isLeftPressed(){return this.isButtonPressed("left")}getCursorPosition(){return{x:this._modules.position.x,y:this._modules.position.y}}getCursorInformation(){return{x:this._modules.position.x,y:this._modules.position.y,target:this._hoveredElt}}setDetectionEnabled(t){this._disabledCounter=Math.max(0,this._disabledCounter+(t?-1:1))}_resetCurrent(t,e){for(const s in this._buttons){const i=this._buttons[s];i.isDragging&&this._modules.events.fire("dragEnd",{domEvent:null,x:t,y:e,button:s,target:this._draggedElt}),i.isPressed=!1,i.isDragging=!1}this._hover&&this._hoveredElt&&this._modules.events.fire("mouseout",{domEvent:null,x:t,y:e,target:this._hoveredElt}),this._hover=!1,this._hoveredElt=null,this._draggedElt=null}_onMove({domEvent:t,x:e,y:s,source:i}){let{dx:n,dy:r}=this._setPointerPosition(e,s);this._modules.events.fire("mousemove",{domEvent:t,x:e,y:s,dx:n,dy:r,source:i});for(const o in this._buttons){const a=this._buttons[o];if(a.isPressed)if(a.isDragging){const l=this._getStoredDXY();n+=l.dx,r+=l.dy,this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:n,dy:r,button:o,source:i,target:this._draggedElt})}else a.isDragging=!0,this._hoveredElt&&this._hover&&(this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt}),this._hover=!1),this._draggedElt||(this._draggedElt=this._hoveredElt),this._storeDXY(n,r),this._modules.events.fire("dragStart",{domEvent:t,x:e,y:s,button:o,source:i,target:this._draggedElt})}t&&!this._modules.graphics.getDomElement().contains(t.target)||this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&(this._hoveredElt&&this._hover&&(this._hover=!0,this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})),this._hoveredElt=this._elt,this._elt&&(this._hover=!0,this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})))}_onDocumentMove({domEvent:t,x:e,y:s,source:i}){for(const n in this._buttons){const{isDragging:r}=this._buttons[n];if(r){const{dx:o,dy:a}=this._setPointerPosition(e,s);this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:o,dy:a,button:n,source:i,target:this._draggedElt})}}}_onDocumentUp({domEvent:t,x:e,y:s,source:i,button:n}){if(n!=null&&this._buttons[n].isDragging){this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:n,source:i,target:this._draggedElt});const r=this._buttons[n];r.isDragging=!1,r.isPressed=!1,this.isAnyButtonDragging()||(this._draggedElt=null)}}_onDown({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&this._resetCurrent(e,s);const r=this._buttons[i];this._hoveredElt=this._elt,r.isPressed=!0,this._elt&&t&&(t.stopPropagation(),t.preventDefault()),this._modules.events.fire("mousedown",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onDoubleClick({domEvent:t,x:e,y:s,button:i,source:n}){i!=null&&(T_(t,"doubleclick")||this._modules.events.fire("doubleclick",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt}))}_onUp({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;const r=this._buttons[i];r.isPressed&&(r.isDragging&&(this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:i,source:n,target:this._draggedElt}),r.isDragging=!1,this.isAnyButtonDragging()||(this._draggedElt=null)),r.isPressed=!1,this._detectElement(e,s,!1,!1),this._modules.events.fire("mouseup",{domEvent:t,x:e,y:s,button:i,source:n,target:this._elt}),this.isAnyButtonPressed()||this._hover||n==="touch"||(this._hoveredElt=this._elt,this._hoveredElt&&(this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:n,target:this._hoveredElt}),this._hover=!0)))}_onClick({domEvent:t,x:e,y:s,button:i,source:n}){T_(t,"click")||this._modules.events.fire("click",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onWheel({domEvent:t,x:e,y:s,delta:i,source:n,dx:r,dy:o}){this._modules.position.x=e,this._modules.position.y=s,this._modules.events.fire("mousewheel",{domEvent:t,x:e,y:s,dx:r,dy:o,delta:i,source:n,target:this._hoveredElt})}_storeDXY(t,e){this._accDx=t,this._accDy=e}_getStoredDXY(){const t=this._accDx,e=this._accDy;return this._accDx=0,this._accDy=0,{dx:t,dy:e}}_setPointerPosition(t,e){const s=t-this._prevX,i=e-this._prevY;return this._modules.position.x=t,this._modules.position.y=e,this._prevX=t,this._prevY=e,this._accDx=0,this._accDy=0,{dx:s,dy:i}}_detectElement(t,e,s,i){this._elt=this.detectElementAt(t,e,s,i)}detectElementAt(t,e,s,i){if(this._disabledCounter!==0)return null;const n=this._modules.settings,r=n.get("detect.enableSpatialIndex"),o=n.get("detect.nodeErrorMargin")||0,a=n.get("detect.edgeErrorMargin")||0;let l=n.get("detect.nodes"),d=n.get("detect.edges");i&&(l=!0,d=!0);let h=null,u=[],c=[];if(!s&&r&&(l||d)){const m=this.spatialIndexMarginRatio,_=Math.max(o*m,a*m),p=this._modules.spatial.queryRawProjected(t-_,e-_,t+_,e+_);u=p.nodes,c=p.edges}let g=null,f=null;if(l&&(g=this._modules.graphics.detectNode(t,e,!!n.get("detect.nodeTexts"),!!n.get("detect.nodeBadges"),o,u)),d&&(c.length<qD||!g)&&(f=this._modules.graphics.detectEdge(t,e,!!n.get("detect.edgeTexts"),a,c)),g&&f){const m=this._modules.graphics.getAttributesManager().getFlexArrays();h=m.nodes.current.layer.get(g._index)>=m.edges.current.layer.get(f._index)?g:f}else g?h=g:f&&(h=f);return h}};function an(t){return t.indexOf("touch")===0?"touch":"mouse"}var Jd=!1,w_={down:{trigger:"pointerdown",duplicate:"mousedown"},click:{trigger:"pointerdown",duplicate:"mouseup"},doubleclick:{trigger:"pointerdown",duplicate:"mouseup"}};function T_(t,e){if(t)return t.type===w_[e].trigger&&(Jd=!0),t.type===w_[e].duplicate&&Jd?(Jd=!1,!0):void 0}var HD=class extends Bt{constructor(){super(...arguments),this._dragged=null,this._start=[],this._end=[],this._shouldDrag=({target:t,button:e})=>{const s=e==="left",i=this._modules.settings.get("interactions.drag.enabled"),n=t!==null&&t.isNode&&t.getAttribute("draggable")===!0;return!!(s&&i&&n)},this._onDragStart=({x:t,y:e,target:s})=>{s&&(s.isSelected()?this._dragged=this._modules.selection.getSelectedNodes().filter(i=>i.getAttribute("draggable")):this._dragged=s.toList()),this._dragged&&(this._start=this._dragged.getPosition(),this._end=Ae(this._start),this._onBeforeDrag=this._modules.settings.get("interactions.drag.onBeforeDrag"),this._startDrag=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._dragged.addClass(Va),this._modules.events.fire("nodesDragStart",{nodes:this._dragged}),this._modules.graphics.addCursorStyle(this._modules.settings.get("interactions.drag.cursor")))},this._onDrag=()=>{if(!this._dragged||!this._startDrag)return;const{x:t,y:e}=this._modules.captor.getCursorInformation(),s=this._dragged._indexes,i=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),n=i.x-this._startDrag.x,r=i.y-this._startDrag.y;for(let o=0;o<s.length;++o){const a=this._start[o],l=this._end[o];l.x=a.x+n,l.y=a.y+r}this._onBeforeDrag&&this._onBeforeDrag(this._dragged,t,e,this._end),this._modules.settings.get("interactions.drag.applyResult")&&this._modules.individualAttributes.setMultipleAttributes(this._dragged,this._end),this._modules.events.fire("nodesDragProgress",{nodes:this._dragged,dx:n,dy:r})},this._onDragEnd=()=>{this._dragged&&(this._dragged.removeClass(Va),this._modules.graphics.removeCursorStyle(this._modules.settings.get("interactions.drag.cursor")),this._modules.events.fire("nodesDragEnd",{nodes:this._dragged,start:this._start,end:this._end}),this._dragged=null,this._start=[],this._end=[])}}onMounted(){this._modules.classes.createClass({name:Va,isBuiltin:!0,nodeAttributes:{layer:wS}}),this._modules.events.register(["nodesDragStart","nodesDragProgress","nodesDragEnd"]),this._modules.settings.register("interactions.drag.enabled",!0).register("interactions.drag.cursor","move").register("interactions.drag.onBeforeDrag",void 0),this._modules.settings.register("interactions.drag.applyResult",!0),this._modules.interactions.onDrag({priority:"drag",disableDetection:!0,check:this._shouldDrag,onStart:this._onDragStart,onProgress:this._onDrag,onStop:this._onDragEnd})}},WD={color:"#00C3FF",radius:4,cursorOnHover:"grab",cursorOnDrag:"grabbing"},XD=class extends Bt{constructor(){super(...arguments),this._hoverHandle=!1,this._grabHandle=!1,this._x=0,this._y=0,this._enabled=!1,this._onMouseUp=()=>this._grabHandle=!1,this._onMouseDown=()=>{this._hoverHandle&&(this._grabHandle=!0)},this._onDragProgress=()=>{this._grabHandle&&this._refreshCanvas()},this._onDragStart=()=>{if(!this._movedEdges)return;this._nodesToHighlight=this._nodesToHighlight.filter(e=>e!==this._startNode&&!e.isVirtual()),this._movedEdges.setExcluded(!0);const t=this._options.cursorOnDrag;this._prevSettings=this._modules.settings.update({edgeHover:!1,cursor:{default:t,node:t,edge:t}})},this._onDragEnd=()=>{if(!this._movedEdges)return;this._restoreSettings();const t=this._getPointedNode();t&&this._movedEdges.forEach(e=>{e.getTarget()===this._startNode?e.setTarget(t):e.setSource(t)}),this._movedEdges.setExcluded(!1),this._movedEdges.setSelected(!0),this._movedEdges=null,this._refreshHandles()},this._refreshHandles=()=>{if(!this._enabled||this._movedEdges)return;const t=this._modules.selection.getSelectedEdges();this._nodesToHighlight=t.getExtremities().dedupe().filter(e=>!e.isVirtual()),this._rewirableClass.clearEdges(),this._rewirableClass.add(t),this._refreshCanvas()},this._shouldInteractionStart=({target:t})=>{if(!this._enabled||!t||!t.isNode||!this._hoverHandle||t.isVirtual())return!1;const e=t.getAdjacentEdges().filter(s=>s.isSelected());return!!e.size&&(this._movedEdges=e,this._edgeColors=this._movedEdges.getAttribute("color"),this._startNode=t,!0)},this._refreshCanvas=()=>{this._enabled&&this._layer.refresh()},this._checkForHover=()=>{if(!this._enabled||!this._nodesToHighlight)return;const t=this._options.radius,e=this._nodesToHighlight.getPosition(),s=this._modules.camera.screenToGraphCoordinates(this._modules.captor.getCursorPosition());for(let i=0;i<e.length;i++){const{x:n,y:r}=e[i];if(Ie(n,r,s.x,s.y)<t)return void this._enableCursorOnHover()}this._disableCursorOnHover()}}onMounted(){this._rewirableClass=this._modules.classes.createClass({name:fy,isBuiltin:!0,edgeAttributes:{layer:TS}})}enable(t){this._enabled||(this._modules.events.on("move",this._checkForHover).on("mousemove",this._checkForHover).on("dragProgress",this._onDragProgress).on("nodesDragProgress",this._refreshCanvas).on("mousedown",this._onMouseDown).on("mouseup",this._onMouseUp).on("edgesSelected",this._refreshHandles).on("edgesUnselected",this._refreshHandles),this._interaction=this._modules.interactions.onDrag({priority:"rewiring",check:this._shouldInteractionStart,onStart:this._onDragStart,onProgress:({x:e,y:s})=>{this._x=e,this._y=s},onStop:this._onDragEnd}),this._options={...WD,...t},this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(e=>{if(!this._enabled||!this._nodesToHighlight)return;const s=this._modules.captor.getCursorPosition(),i=this._getPointedNode(),n=this._options.color,r=this._options.radius,o=2*r;if(this._displayMovedEdges(e),e.fillStyle=n,e.strokeStyle=n,this._nodesToHighlight.forEach(a=>{const{x:l,y:d}=a.getPosition();e.fillRect(l-r,d-r,o,o)}),this._movedEdges){const a=i?i.getPosition():s;e.fillRect(a.x-r,a.y-r,o,o)}},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._refreshHandles())}disable(){this._enabled&&(this._interaction&&this._interaction.stop&&this._interaction.stop(),this._interaction=void 0,this._modules.graphics.removeCursorStyle(this._options.cursorOnDrag),this._disableCursorOnHover(),this._restoreSettings(),this._layer.destroy(),this._rewirableClass.clearEdges(),this._enabled=!1,[this._checkForHover,this._onDragProgress,this._refreshCanvas,this._onMouseDown,this._onMouseUp,this._refreshHandles].forEach(t=>this._ogma.events.off(t)))}enabled(){return this._enabled}_restoreSettings(){this._prevSettings&&(this._modules.settings.update(this._prevSettings),this._prevSettings=void 0)}_disableCursorOnHover(){this._hoverHandle&&!this._grabHandle&&(this._hoverHandle=!1,this._modules.graphics.removeCursorStyle(this._options.cursorOnHover))}_enableCursorOnHover(){this._hoverHandle||(this._hoverHandle=!0,this._modules.graphics.addCursorStyle(this._options.cursorOnHover))}_displayMovedEdges(t){if(!this._movedEdges)return;const e=this._x,s=this._y,i=this._modules.camera.screenToGraphCoordinates({x:e,y:s});this._movedEdges.forEach((n,r)=>{const o=this._edgeColors[r],a=n.getSource(),l=n.getTarget(),d=this._getPointedNode(),h=l===this._startNode?a:l,u=Number(n.getAttribute("width")),c=h.getPosition(),g=d?d.getPosition():i;t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(g.x,g.y),t.strokeStyle=o,t.lineWidth=u,t.stroke()})}_getPointedNode(){const t=this._modules.captor.getPointedElement();return t&&t.isNode&&!t.isVirtual()?t:null}},I_={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1},YD=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._nodesToHighlight=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[],this._onSelectionChange=()=>{this._enabled&&(this._nodesToHighlight=this._modules.selection.getSelectedNodes(),this._displayHandles())},this._displayHandlesHandler=()=>this._displayHandles(),this._moveHandler=({x:t,y:e})=>{this._modules.dom.setTimeout(()=>this._detectBoundingBoxes(t,e),0)}}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.interactions.onDrag({priority:"resizing",disableDetection:!0,check:()=>!(!this._enabled||!this._pointedNode),onStart:({x:t,y:e})=>{this._x=t,this._y=e,this._nodeBeingResized=this._pointedNode},onProgress:({x:t,y:e})=>{this._x=t,this._y=e,this._displayHandles()},onStop:()=>{if(this._nodesToHighlight){const t=this._modules.camera.zoom,e=this._nodesToHighlight.getAttributes(["x","y","radius"]).map(({x:s,y:i,radius:n},r)=>{const o=this._additionalRadiuses[r]/t;return{radius:+n+o,x:s+o,y:i-o}});this._nodesToHighlight.setAttributes(e)}this._pointedNode=null,this._nodeBeingResized=null,this._displayHandles()}})}onReady(){this._modules.events.on(["nodesSelected","nodesUnselected"],this._onSelectionChange)}_enableCursor(){this._cursorEnabled||(this._modules.graphics.addCursorStyle(this._options.cursor),this._cursorEnabled=!0)}_disableCursor(){this._cursorEnabled&&(this._modules.graphics.removeCursorStyle(this._options.cursor),this._cursorEnabled=!1)}_detectBoundingBoxes(t,e){if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight)return;const s=this._options.handleSize/2,i=this._options.detectionMargin;return this._pointedNode=null,this._forEachNodeToHighlight((n,r,o)=>{const a=r.x+o-s-i,l=r.x+o+s+i,d=r.y-o-s-i,h=r.y-o+s+i;t>=a&&t<=l&&e>=d&&e<=h&&(this._pointedNode=n)}),this._pointedNode?this._enableCursor():this._disableCursor()}_forEachNodeToHighlight(t){this._nodesToHighlight&&this._nodesToHighlight.forEach(e=>{const s=e.getPositionOnScreen(),i=this._getTotalRadius(e);t(e,s,i)})}_displayHandles(){this._enabled&&this._nodesToHighlight&&this._layer.refresh()}_displayNodePreview(t,e,s,i,n,r){if(n*=1/this._modules.camera.getZoom(),t.beginPath(),r.length===1)t.arc(s,i,n,0,2*Math.PI);else for(let o=0;o<r.length;++o){const a=r[o],l=s+a.x*n,d=i+a.y*n;o===0?t.moveTo(l,d):t.lineTo(l,d)}t.fillStyle=this._options.previewColor,t.fill()}_getTotalRadius(t,e=!0){return Number(t.getAttribute("radius"))*(this._modules.camera.zoom*(e?1:0))+Number(t.getAttribute("innerStroke.width"))+Number(t.getAttribute("outerStroke.width"))+this._options.lineWidth/2}_snap(t,e,s){const i=this._modules.spatial.getNodesInScreenByDistance(e).filter(u=>!u.isSelected()).slice(0,this._options.nbNodesToSnapTo),n=this._getTotalRadius(e),r=n+s,o=this._options.snappingRatio,a=r/n,l=Math.round(sy(a,o));let d=n*Math.pow(o,l),h=null;if(i.forEach(u=>{const c=this._getTotalRadius(u);Math.abs(c-r)<=Math.abs(d-r)&&(d=c,h=u)}),h){t.save(),t.strokeStyle=this._options.sizeIndicatorColor,t.lineWidth=this._options.sizeIndicatorThickness/this._modules.camera.getZoom();const u=h.getAttribute("radius");this._displaySizeIndicator(t,e,d),i.filter(c=>c.getAttribute("radius")===u).forEach(c=>this._displaySizeIndicator(t,c)),t.restore()}return d-n}_displaySizeIndicator(t,e,s){s=s||void 0;const i=this._modules.camera.getZoom(),n=e.getPosition(),r=this._getTotalRadius(e),o=(s||r)/i,a=(s?s-r:0)/i,l=a+(-this._options.sizeIndicatorOffset-(s?Number(e.getAttribute("innerStroke.width"))+Number(e.getAttribute("outerStroke.width")):0))/i,d=n.x-o+l|0,h=n.y-o-a|0,u=n.y+o-a|0,c=this._options.sizeIndicatorWidth/i;t.beginPath(),t.moveTo(d-c,h),t.lineTo(d+c,h),t.moveTo(d,h),t.lineTo(d,u),t.moveTo(d-c,u),t.lineTo(d+c,u),t.stroke()}enable(t={}){this._enabled||(this._options={...I_,...t},this._layer=this._modules.layers.addCanvasLayer(e=>{const s=ps(),i=this._modules.camera.getZoom(),{color:n,lineWidth:r}=this._options;let o=this._options.handleSize,a=0;if(this._nodeBeingResized){const l=this._getTotalRadius(this._nodeBeingResized),d=this._nodeBeingResized.getPositionOnScreen();a=Math.max(this._x-(d.x+l),-(this._y-(d.y-l)))/2}this._additionalRadiuses=[],this._nodesToHighlight&&this._nodesToHighlight.forEach(l=>{const d=l.getPosition();let h=this._getTotalRadius(l),u=0;if(this._nodeBeingResized){u=a;const c=-h+Number(l.getAttribute("innerStroke.width"))+Number(l.getAttribute("outerStroke.width"))+r/2+1;u=u<c?c:this._snap(e,l,u),this._additionalRadiuses.push(u);const g=l.getAttribute("shape"),f=this._engine.getShapePoints(g),m=d.x+u/i,_=d.y-u/i,p=h+u;this._displayNodePreview(e,s,m,_,p,f)}e.strokeStyle=n,e.fillStyle=n,e.lineWidth=r/i,h/=i,u/=i,o/=i*s,e.strokeRect(d.x-h,d.y-h-2*u,2*(u+h),2*(u+h)),e.fillRect(d.x+h+2*u-o/2,d.y-h-2*u-o/2,o,o)})},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._modules.events.on(["mousemove","mousedown"],this._moveHandler),this._enabled=!0)}disable(){this._enabled&&(this._modules.events.off(this._displayHandlesHandler).off(this._moveHandler),this._layer.destroy(),this._disableCursor(),this._reset())}_reset(){this._enabled=!1,this._nodesToHighlight=null,this._options={...I_},this._nodeBeingResized=null,this._pointedNode=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[]}enabled(){return this._enabled}},$D={strokeColor:"black",strokeWidth:5,dashed:!0,cursorStyle:"cell",createNodes:!0,condition:Pu,onNodeCreated:Yt,onEdgeCreated:Yt,createNode:Hs,createEdge:Hs,onComplete:Yt},ZD=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._blockId=0,this._cursorEnabled=!1}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._depth=_o(0).edgeBody,this._modules.events.register(["connectNodes"]),this._interaction=this._modules.interactions.onDrag({priority:"connectNodes",check:({target:t,button:e="left"})=>this._enabled&&e==="left"&&t&&t.isNode&&!t.isVirtual(),onStart:({target:t})=>this._onStart(t),onProgress:({x:t,y:e})=>this._onMove(t,e),onStop:()=>this._onStop()}),this._modules.events.on("clearGraph",()=>this.disable())}_onStart(t){t&&(this._cursorEnabled=!0,this._startNode=t,this._startPos=t.getPosition(),this._modules.graphics.addCursorStyle(this._options.cursorStyle),this._blockId=this._modules.graphics.allocateGraphicsEngineBlockId())}_onMove(t,e){this._startNode!==null&&(this._endPos=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._drawLine())}_onStop(){if(this._startNode===null)return;const{condition:t,onNodeCreated:e,onEdgeCreated:s,createEdge:i,createNode:n,onComplete:r,createNodes:o}=this._options;let a=this._modules.captor.getPointedElement(),l=null,d=null;if(this._modules.graphics.releaseGraphicsEngineBlockId(this._blockId),!a&&o){const h=n({attributes:{x:this._endPos.x,y:this._endPos.y}});a=this._modules.graph.addNode(h),d=a,e&&e(d)}if(a&&!a.isVirtual()&&(d||!t||t(this._startNode,a))){const h=i({source:this._startNode.getId(),target:a.getId()});l=this._modules.graph.addEdge(h),s&&s(l)}r&&(this._modules.events.fire("connectNodes",{source:this._startNode,target:a,edge:l}),r(this._startNode,a,l||void 0)),this.disable()}_drawLine(){this._group.reset(qs,!1,this._depth);const t=this._group.nextAndReset().end;t.pieceId=$l,t.shape="line",t.x1=this._startPos.x,t.y1=this._startPos.y,t.x2=this._endPos.x,t.y2=this._endPos.y,t.fillColor=this._options.strokeColor,t.thicknessOrFontSizeFixed=this._options.strokeWidth,this._options.dashed&&(t.dashLength=3,t.gapLength=1),this._engine.storeGroup(this._blockId,this._group),this._modules.dom.refresh()}enable(t={}){return this._enabled||(this._options={...$D,...t},this._enabled=!0,this._cursorEnabled=!1,this._startNode=null,this._prevSettings=this._modules.settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":!1}),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorInformation())),this}disable(){return this._enabled?(this._enabled=!1,this._modules.settings.update(this._prevSettings),this._cursorEnabled&&this._modules.graphics.removeCursorStyle(this._options.cursorStyle),this):this}enabled(){return this._enabled}},KD=["top","bottom","left","right","cssDefined"],QD=1e4,JD={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},tO={position:"top",autoAdjust:!0,delay:100},eO={hover:{node:({target:t})=>t&&t.isNode,edge:({target:t})=>t&&!t.isNode},click:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}},doubleclick:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}}},sO=class extends Bt{constructor(){super(...arguments),this._x=0,this._y=0}onMounted(){this._handlers={},this._currentHandlerName=null,this._tooltip=null,this._isHover=!1,this._modules.events.register(["tooltipShow","tooltipHide"]),this._modules.events.on(["mouseup","dragStart"],()=>{this._isHover||this._hideTooltip(!1)}).on("mouseout",()=>{this._isHover&&this._hideTooltip(!1)}).on("clearGraph",()=>this._hideTooltip(!1)),this._modules.interactions.onHover(this._createInteraction("hover",!0)),this._modules.interactions.onClick(this._createInteraction("click")),this._modules.interactions.onDoubleClick(this._createInteraction("doubleclick"))}hide(){this._hideTooltip(!0)}isShown(){return!!this._tooltip}refresh(){this._refreshTooltip()}show(t,{position:e="top",autoAdjust:s=!0,className:i,x:n=0,y:r=0}={}){this._showTooltip(t,{position:e,autoAdjust:s,className:i},{x:n,y:r})}setHandler(t,e,s){const i={...tO,...s};i.position&&KD.indexOf(i.position)===-1&&(i.position="top"),this._handlers[t]={handler:e,condition:ve(eO,t),settings:i}}_hideTooltip(t){if(this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null),t&&(this._currentHandlerName=null),this._tooltip){const e=this._tooltip;this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null,this._modules.events.fire("tooltipHide",{tooltip:e})}}_createInteraction(t,e=!1){return{priority:"tooltip",check:s=>{const i=C_(t,s),n=this._handlers[i];return(!e||!this._modules.connectNodes.enabled())&&(!(!n||!n.condition(s))||!(e||!this._currentHandlerName||this._isHover)&&this._tooltip!==null)},handler:s=>{const{target:i,x:n,y:r}=s;this._hideTooltip(!1),this._isHover=e,this._elt=i,this._x=n,this._y=r,this._currentHandlerName=C_(t,s),this._refreshTooltip()}}}_refreshTooltip(){if(!this._currentHandlerName)return void this._hideTooltip(!1);const t=this._handlers[this._currentHandlerName];if(!t)return;const{settings:e,handler:s}=t,i=this._elt;if(i){const r=i.isNode?"node":"edge";if(this._currentHandlerName.indexOf(r)===-1)return}const n=s(i);Promise.resolve(n).then(r=>{this._schedule(()=>this._showTooltip(r,e),e.delay)})}_schedule(t,e){this._timeout&&this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>{this._timeout=null,t()},e)}_showTooltip(t,e,s){this._hideTooltip(!1);const{position:i,className:n,autoAdjust:r}=e;let o=this._x,a=this._y,l=this._elt;const d=this._modules.dom.getDimensions();let h=0,u=0;if(s&&(o=s.x,a=s.y,l=null),typeof t=="string")this._tooltip=iO("div"),_p(this._tooltip,Bu.sanitize(t));else{if(!Kp(t))throw new Error(`invalid tooltip ${t}, expected HTML string or HTML element`);this._tooltip=t}const c=this._tooltip;if(n&&this._tooltip.classList.add(n),i!=="cssDefined"&&(c.style.position="absolute"),c.style.zIndex=QD.toString(),this._modules.dom.appendElement(c),l&&l.isNode){const m=l,_=m.getPositionOnScreen(),p=Number(m.getAttribute("radius"))*(m.getAttribute("scalingMethod")==="fixed"?1:this._modules.camera.getZoom())+Number(m.getAttribute("innerStroke.width"))+Number(m.getAttribute("outerStroke.width"));o=_.x,a=_.y,h=p,u=p}const g=c.offsetWidth/2,f=c.offsetHeight/2;if(h+=g,u+=f,i&&i!=="cssDefined"){const m=JD[i];let _=m.x,p=m.y;if(r){const x=o+h*m.x,y=a+u*m.y;(x-g<0||x+g>=d.width)&&(i==="left"||i==="right"?_*=-1:_=x-g<0?(g-x+1)/h:(d.width-(x+g)-1)/h),(y-f<0||y+f>=d.height)&&(i==="top"||i==="bottom"?p*=-1:p=y-f<0?(f-y+1)/u:(d.height-(y+f)-1)/u)}c.style.left=o+h*_-g+"px",c.style.top=a+u*p-f+"px"}this._modules.events.fire("tooltipShow",{tooltip:c})}};function C_(t,{button:e,target:s}){return`${t}${e?`.${e}`:""}.${s!==null?s.isNode?"node":"edge":"background"}`}function iO(t){return Ti?document.createElement(t):il()}var no={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"},L_=Object.keys(no).reduce((t,e)=>{const s=no[e];return t[s]||(t[s]=[]),t[s].push(e),t},{}),nO=class extends Bt{constructor(){super(...arguments),this._onBlur=()=>this.resetKeys(),this._onKeyUp=t=>{const e=t.keyCode||t.which;this._pressed[e]=!1,this._modules.events.fire("keyup",{domEvent:t,key:no[e],code:e})},this._onKeyDown=t=>{const e=t.keyCode||t.which,s=this._binds[e];if(!this._pressed[e]){if(this._pressed[e]=!0,s)for(const i of s)i.keys.every(n=>n.some(r=>this._pressed[r]))&&i.handler({domEvent:t});this._modules.events.fire("keydown",{domEvent:t,key:no[e],code:e})}}}onMounted(){this._modules.events.register(["keyup","keydown"]),this._binds=[],this._pressed=[],this._modules.dom.addWindowEventListener("keydown",this._onKeyDown).addWindowEventListener("keyup",this._onKeyUp).addWindowEventListener("visibilitychange",this._onBlur).addWindowEventListener("blur",this._onBlur,!1),this._idleTimeout=4e3,this._prevEventTimeStamp=ts(),this._modules.events.onAnyEvent(()=>{const t=ts();t-this._prevEventTimeStamp>this._idleTimeout&&this.resetKeys(),this._prevEventTimeStamp=t})}setIdleTimeout(t){if(!isFinite(t)||t<=1)throw new TypeError("Idle timeout must be a positive number > 1");this._idleTimeout=t}resetKeys(){for(let t=0;t<this._pressed.length;t++)this._pressed[t]&&(this._pressed[t]=!1,this._modules.events.fire("keyup",{key:no[t],code:t}))}onKeyPress(t,e){let s=[];if(typeof t=="number")s=[t];else if(typeof t=="string")s=t.split(" ");else{if(!Array.isArray(t))throw new TypeError(`${t} is not a number, string or array`);s=t}if(s.length===0)throw new Error("the array should contain at least one element");const i=s.map(o=>{if(typeof o=="number")return[o];if(typeof o=="string"){const a=L_[o];if(!a)throw new Error(`${o} is not a valid key identifier`);return a}throw new TypeError(`${o} is not a valid key identifier`)}),n=i.pop(),r={keys:i,handler:e};n&&n.forEach(o=>{this._binds[o]||(this._binds[o]=[]),this._binds[o].push(r)})}isPressed(t){if(typeof t=="number")return this._pressed[t];if(typeof t=="string"){const e=L_[t];if(e)return e.some(s=>this._pressed[s])}return!1}},rO=[{name:"color",isNode:!0},{name:"shape",isNode:!0},{name:"radius",isNode:!0},{name:"icon.content",isNode:!0},{name:"image.url",isNode:!0},{name:"image",isNode:!0},{name:"color",isNode:!1},{name:"shape",isNode:!1},{name:"width",isNode:!1}],Ri=Math.PI,Fi=2*Math.PI,rv=Math.cos(Ri/2-Fi/5),ov=Math.cos(Ri/2-Fi/5*2),av=Math.cos(Ri/2-Fi/5*3),lv=Math.cos(Ri/2-Fi/5*4),dv=Math.sin(-Ri/2+Fi/5),hv=Math.sin(-Ri/2+Fi/5*2),uv=Math.sin(-Ri/2+Fi/5*3),cv=Math.sin(-Ri/2+Fi/5*4),Ll=1.6,gv=3,oO=.9,Pa=.31,th=1/3,aO=[8,3],lO=[3,3],Ra={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:t=>t[t.length-1]},dO=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];function fv(t){return Array.isArray(t)?t.reduce((e,s)=>e&&fv(s),!0):t==="undefined"||!isNaN(Number(t))}function mv(t){return Array.isArray(t)?t.reduce((e,s)=>Math.min(e,mv(s)),1/0):typeof(t=Number(t))=="number"?isNaN(t)?1/0:+t:1/0}function _v(t){return Array.isArray(t)?t.reduce((e,s)=>Math.max(e,_v(s)),-1/0):typeof(t=Number(t))=="number"?isNaN(t)?-1/0:+t:-1/0}function wi(t){const e=["K","M","B","T","P","E","Z","Y"];if(t>9999){let s=0;for(;s<e.length&&t>999;)t/=1e3,s++;return(N_(t,3)+e[s-1]).toString()}return N_(t,4).toString()}function N_(t,e=3){const s=e===4?10:1;return t<10?Math.round(100*t*s)/(100*s):t<100?Math.round(10*t*s)/(10*s):t<1e3?Math.round(t*s)/s:Math.round(t)}function pv(t){return t.innerMargin+(t.titleFontSize+t.fontSize)*Ll}var hO=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.title<=e.title?-1:1,uO=(t,e)=>t.height-e.height,cO=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:e.height-t.height,gO=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.content[0].title<=e.content[0].title?-1:1;function fO(t,e,s){const i=e.getContext("2d"),{x:n,y:r,height:o,isNode:a,styleProperty:l,title:d,mapping:h,iconFont:u,iconFontStyle:c}=s;pO(i,t,n,r,o),yO(i,t,d,n,r);const g=t.fontSize*Ll,f=t.fontSize/2*Ll*oO,m=t.fontSize*gv,_=t.fontSize,p=_O(t,a);let x=r+pv(t);const y=n+t.innerMargin+p/2,b=n+2*t.innerMargin+p,v=Zr(h),E=fv(v),A=t.fontColor,S=t.shapeColor,w=Object.keys(h);if(E&&(w.sort((L,T)=>yi(h[T])-yi(h[L])),l==="radius"||l==="width")){const L=mv(v),T=_v(v);return(a?RO:FO)(t,i,n,x,L,(L+T)/2,T,S)}w.forEach(L=>{const T=h[L];l==="color"&&(a?yv(i,y,x,f,L):bO(i,y,x,m,_,L)),l==="shape"&&(a?IO(i,y,x,f,L,S):MO(i,y,x,m,_,L,S)),l==="icon.content"&&vO(i,y,x,L,u,f,A,c),l!=="image"&&l!=="image.url"||EO(i,y,x,f,L),xO(i,t,b,x,T,E),x+=g})}function mO(t,e,s,i,n,r){t.beginPath(),t.arc(e,s,i,0,Fi),t.strokeStyle=n,t.lineWidth=r,t.stroke()}function zo(t,e,s,i,n="left",r="normal"){t.textAlign=n,t.textBaseline="middle",t.fillStyle=i,t.font=`${r} ${s}px "${e}"`}function _O(t,e){const s=e?1:gv;return t.fontSize*s}function pO(t,e,s,i,n){return PO(t,s,i,e.widgetWidth,n,e.borderRadius,e.backgroundColor,e.borderColor,e.borderWidth)}function yO(t,e,s,i,n){zo(t,e.fontFamily,e.titleFontSize,e.titleFontColor,e.titleTextAlign);const r=e.titleTextAlign==="center",o=e.widgetWidth-2*e.innerMargin,a=t.measureText(s).width,l=i+(r?e.widgetWidth/2:e.innerMargin),d=n+e.titleFontSize/2+e.innerMargin;if(a>o){const h=o/a,u=(s.length*h|0)-2;s=s.substr(0,u)+""}t.fillText(s,l,d)}function xO(t,e,s,i,n,r){let o=n.join();if(r)if(n.length===1)o=wi(n[0]);else{const a=yi(n),l=jn(n);o=`${wi(a)} - ${wi(l)}`}zo(t,e.fontFamily,e.fontSize,e.fontColor),t.fillText(o,s,i)}function yv(t,e,s,i,n){t.beginPath(),t.arc(e,s,i,0,2*Ri),t.fillStyle=n,t.fill()}function bO(t,e,s,i,n,r){t.fillStyle=r,t.fillRect(e-i/2,s-n/2,i,n)}function vO(t,e,s,i,n,r,o,a){zo(t,n,2*r,o,"center",a),t.fillText(i,e,s)}function EO(t,e,s,i,n){if(typeof Image>"u")return;t._imgStore||(t._imgStore={});let r=t._imgStore[n];if(r)return t.drawImage(r,e-i,s-i,2*i,2*i);r=new Image,r.src=n,r.onload=()=>{t.drawImage(r,e-i,s-i,2*i,2*i)},t._imgStore[n]=r}function AO(t,e,s,i){t.fillRect(e-i,s-i*Pa,2*i,2*i*Pa),t.fillRect(e-i*Pa,s-i,2*i*Pa,2*i)}function SO(t,e,s,i){return t.beginPath(),t.moveTo(e-i,s),t.lineTo(e,s-i),t.lineTo(e+i,s),t.lineTo(e,s+i),t.fill()}function wO(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+rv*i,s+dv*i),t.lineTo(e+ov*i,s+hv*i),t.lineTo(e+av*i,s+uv*i),t.lineTo(e+lv*i,s+cv*i),t.fill()}function TO(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+ov*i,s+hv*i),t.lineTo(e+lv*i,s+cv*i),t.lineTo(e+rv*i,s+dv*i),t.lineTo(e+av*i,s+uv*i),t.fill()}function IO(t,e,s,i,n,r){switch(t.fillStyle=r,n){case"square":return t.fillRect(e-i,s-i,2*i,2*i);case"circle":return yv(t,e,s,i,r);case"cross":return AO(t,e,s,i);case"diamond":return SO(t,e,s,i);case"equilateral":return wO(t,e,s,i);case"star":return TO(t,e,s,i)}}function CO(t,e,s,i,n){t.fillRect(e-i/2,s-n/4,i*(1-th),n/2),t.beginPath(),t.moveTo(e+i*(1-th-.5),s-n/2),t.lineTo(e+i*(1-th-.5),s+n/2),t.lineTo(e+i/2,s),t.fill()}function LO(t,e,s,i,n,r,o){t.beginPath(),t.moveTo(e-i/2,s),t.lineTo(e+i/2,s),t.strokeStyle=r,t.lineWidth=n/2,t.setLineDash(o==="dashed"?aO:lO),t.stroke()}function NO(t,e,s,i,n){t.beginPath(),t.moveTo(e-i/2,s-n/2),t.lineTo(e-i/2,s+n/2),t.lineTo(e+i/2,s),t.fill()}function MO(t,e,s,i,n,r,o){return t.fillStyle=o,r==="line"&&t.fillRect(e-i/2,s-n/4,i,n/2),r==="arrow"?CO(t,e,s,i,n):r==="dashed"||r==="dotted"?LO(t,e,s,i,n,o,r):r==="tapered"?NO(t,e,s,i,n):void 0}function PO(t,e,s,i,n,r,o,a,l){t.setLineDash([]),t.beginPath(),t.moveTo(e+r,s),t.lineTo(e+i-r,s),t.quadraticCurveTo(e+i,s,e+i,s+r),t.lineTo(e+i,s+n-r),t.quadraticCurveTo(e+i,s+n,e+i-r,s+n),t.lineTo(e+r,s+n),t.quadraticCurveTo(e,s+n,e,s+n-r),t.lineTo(e,s+r),t.quadraticCurveTo(e,s,e+r,s),t.closePath(),t.fillStyle=o,t.fill(),t.strokeStyle=a,t.lineWidth=l,t.stroke()}function RO(t,e,s,i,n,r,o,a){const l=.7*t.fontSize,d=3*l,h=(l+d)/2,u=s+t.innerMargin+d,c=u+d+t.innerMargin,g=i+2*d-.5*t.innerMargin,f=t.circleStrokeWidth;for(const m of[l,h,d])mO(e,u,g-m,m,a,f);zo(e,t.fontFamily,t.fontSize,t.fontColor,"left"),e.fillText(wi(n),c,g+l-2*l),e.fillText(wi(r),c,g+l-2*h),e.fillText(wi(o),c,g+l-2*d)}function FO(t,e,s,i,n,r,o,a){const l=(t.widgetWidth-2*t.innerMargin)/3,d=t.fontSize,h=i-t.innerMargin/2,u=h+2*d,c=s+t.innerMargin;e.fillStyle=a,e.fillRect(c,h-d/2,l+1,d),e.fillRect(c+l,h-d/3,l+1,d/1.5),e.fillRect(c+2*l,h-d/6,l,d/3),zo(e,t.fontFamily,t.fontSize,t.fontColor,"center"),e.fillText(wi(o),c+.5*l,u),e.fillText(wi(r),c+1.5*l,u),e.fillText(wi(n),c+2.5*l,u)}function DO(t,e,s,i){const n=i.outerMargin+pv(i),r=i.fontSize*Ll,o=n-.8*i.innerMargin;return e==="radius"||e==="width"?o+r*(s?3:2):o+Object.keys(t).length*r}function OO(t,e,s){const i={width:e.width,height:e.height};let n=!1;return!!(i.width&&i.height&&s)&&(n=t.position==="top"||t.position==="bottom"?UO(i,t,s,t.position==="bottom"):kO(i,t,s,t.position==="left"),n&&s.forEach(r=>fO(t,e,r)),n)}function kO(t,e,s,i){const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height;let a=e.outerMargin,l=i?e.outerMargin:t.width-n,d=1;s=s.slice().sort(hO);for(let h=0;h<s.length;++h){const u=s[h];if(a+u.height>o){if(a===e.outerMargin)return!1;a=e.outerMargin,d+=1,i?l+=n:l-=n}u.x=l,u.y=a,a+=u.height}return d<=r}function zO(t,e,s){let i=null;for(let n=0;n<e.length;++n){const r=e[n];r.isNode!==t.isNode&&e.length!==1||!(i===null||r.height<e[i].height)||(i=n)}if(i!=null){const n=e[i];n.content.push(t),n.height+=t.height+s.outerMargin}}function BO(t){let e=0;for(let s=1;s<t.length;++s)t[s].height>t[e].height&&(e=s);return e}function UO(t,e,s,i){s=s.slice();const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height-e.outerMargin,a=new Array(Math.min(r,s.length)),l=s.length;let d=0,h=0,u=0,c=0;for(let y=0;y<l;++y){const b=s[y];b.isNode?(d+=1,h+=b.height):(u+=1,c+=b.height)}const g=h+c,f=h/g,m=c/g;let _=Math.round(f*r);const p=Math.round(m*r);if(_>d?_=d:p>u&&(_=r-u),r===0)return!1;for(let y=0;y<a.length;y++)a[y]={content:[],height:0,isNode:y<_};for(let y=0;y<l;++y){const b=BO(s);zO(s[b],a,e),s.splice(b,1)}a.every(({content:y})=>y.length===1)?a.sort(gO):a.sort(cO);let x=e.outerMargin;for(let y=0;y<a.length;++y){const b=a[y];if(b.height>o)return!1;b.content.sort(uO);let v=0;for(let E=0;E<b.content.length;++E){const A=b.content[E];A.x=x,A.y=i?t.height-v-A.height-e.outerMargin:v+e.outerMargin,v+=A.height+e.outerMargin}x+=n}return!0}var GO=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._mustRefresh=!1,this._promises=[]}onMounted(){this._modules.events.on("frame",()=>{this._enabled&&this._mustRefresh&&this._layer.refresh()}).on(["resize","reloadFonts"],()=>{this._mustRefresh=!0})}enable(t={}){const e=this._settings;return this._settings={...Ra,...t},this._mustRefresh=!this._enabled||!this._sameOptions(e,this._settings),this._enabled?Promise.resolve():(this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(s=>{this._drawOnCanvas(this._settings,s.canvas,ps());const i=this._promises;this._promises=[],i.forEach(n=>n()),this._mustRefresh=!1},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this.refresh())}_afterNextUpdate(){return new Promise(t=>this._promises.push(t))}_formatSettings(t,e){const s={...Ra,...t};return dO.forEach(i=>s[i]*=e),s}disable(){return this._enabled&&(this._enabled=!1,this._layer.destroy()),Promise.resolve()}enabled(){return this._enabled}refresh(){return this._mustRefresh=!0,this._modules.dom.refresh(),this._afterNextUpdate()}destroy(){this._enabled=!1,this._mustRefresh=!1,this._settings={...Ra},this._promises=[]}getOptions(){return this._enabled?{...this._settings}:{...Ra}}getCurrentOptions(){return this._settings}_sameOptions(t,e){return t===e||Object.keys(t).reduce((s,i)=>s&&t[i]===e[i],!0)}_drawOnCanvas(t,e,s){const i=this._formatSettings(t,s);OO(i,e,this._computeWidgetList(i))}exportOnCanvas(t,e,s){return this._drawOnCanvas(e,t,s)}export(t={}){const{width:e,height:s}={...this._modules.camera.getSize(),...t},i=ps(),n=We(e*i,s*i);return this._drawOnCanvas(t,n,i),Promise.resolve().then(()=>n)}_computeWidgetList(t){const e=[];return rO.forEach(({name:s,isNode:i})=>{const n=this._computeWidget(t,s,i);n&&e.push(n)}),e}_computeWidget(t,e,s){const i=this._computePropertyMapping(t,e,s);if(i){if(e!=="icon.content")return i;const n=this._getRulesForAttribute(s,"icon.font"),r=this._getRulesForAttribute(s,"icon.style");let o=null,a=null;if(n.length||(o="Arial",a="normal"),typeof n[0]=="string"&&(o=n[0],a=r[0]),o&&a)return i.iconFont=o,i.iconFontStyle=a,i}return null}_computePropertyMapping(t,e,s){const[i]=this._getRulesForAttribute(s,e),n=i&&i.mapping,r=n&&n.getValues(s);if(n&&r){const o=n.getField(),a={};return ri(r,(l,d)=>{l!==void 0&&d!=="undefined"&&(a[l]=a[l]||[],a[l].push(d))}),Object.keys(a).length===0?null:{isNode:s,title:t.titleFunction(o,e),styleProperty:e,dataProperty:o,mapping:a,height:DO(a,e,s,t)}}return null}_getRulesForAttribute(t,e){return this._modules.styleRules.getRuleList().map(s=>{const i=s.getDefinition();return ve(t?i.nodeAttributes:i.edgeAttributes,e)}).filter(Hs).sort((s,i)=>s.mapping&&i.mapping?0:s.mapping?-1:1)}},M_={layer:yy,outerStroke:{color:mb,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:_b,minVisibleSize:0}},VO={layer:yy,color:mb,text:{backgroundColor:_b,minVisibleSize:0}},P_={duration:150,easing:"quadradicOut"},qO=class extends Bt{constructor(){super(...arguments),this._delay=16,this._manualTriggerDetection=!1,this._hovered=null,this._hoveredTextHidden=!1,this._onAnimate=({updatesPositions:t})=>{t&&this._hovered&&this._modules.graphics.isMoving(this._hovered)&&(this._manualTriggerDetection=!0,this._resetHover())},this._onBeforeNewFrame=()=>{if(this._manualTriggerDetection){this._manualTriggerDetection=!1,this._modules.captor.triggerDetection();const t=this._modules.captor.getPointedElement();t&&this._hover(t)}},this._onClear=()=>{this._hovered=null,this._timeout&&this._modules.dom.clearTimeout(this._timeout)},this._resetHover=()=>{this._hovered&&(this._unhover(this._hovered),this._modules.captor.triggerUnhover()),this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}}_setAnimationOptions(t){this._animationOptions={duration:t?.duration!==void 0?t.duration:P_.duration,easing:t?.easing!==void 0?t.easing:P_.easing},delete t?.duration,delete t?.easing}setRate(t){return this._delay=t,this}replaceNullColor(t,e){t&&ve(t,e)===null&&vi(t,e,this._modules.settings.get("backgroundColor"))}updateNodeAttributes(t,e){this._setAnimationOptions(t),this.replaceNullColor(t,"text.backgroundColor"),this._hoverClass.update({nodeAttributes:t,fullOverwrite:e}),this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}updateEdgeAttributes(t,e){this.replaceNullColor(t,"text.backgroundColor"),this.replaceNullColor(t,"text.secondary.backgroundColor"),this._setAnimationOptions(t),this._hoverClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}getHoverClassDefinition(){return this._hoverClass.getDefinition()}onMounted(){this._registerSettings(),this._setAnimationOptions(null),this._hoverExtremityHighlightedClass=this._modules.classes.createClass({name:Ah,isBuiltin:!0,nodeAttributes:M_}),this._hoverClass=this._modules.classes.createClass({name:Kr,isBuiltin:!0,nodeAttributes:M_,edgeAttributes:VO}),this._modules.events.on("mouseover",({target:t})=>t&&this._hover(t)).on("mouseout",({target:t})=>t&&this._unhover(t)).on("animate",this._onAnimate).on("beforeNewFrame",this._onBeforeNewFrame).on("mouseout",this._resetHover).on("clearGraph",this._onClear)}_registerSettings(){this._modules.settings.register("cursor.node","pointer",(t,e)=>{this._hovered&&this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("cursor.edge","pointer",(t,e)=>{this._hovered&&!this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("nodeHover",!0,t=>{!t&&this._hovered&&this._hovered.isNode&&this._unhover(this._hovered)}),this._modules.settings.register("edgeHover",!0,t=>{t||!this._hovered||this._hovered.isNode||this._unhover(this._hovered)})}_updateExtremityHighlightLayer(){const t=this._hoverClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}_removeTimeout(){this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}_hover(t){const e=t.isNode?"nodeHover":"edgeHover";this._modules.settings.get(e)&&t&&(this._removeTimeout(),this._timeout=this._modules.dom.setTimeout(()=>{this._setElementHighlight(!0,t),this._timeout=null},this._delay))}_unhover(t){this._removeTimeout(),this._hovered===t&&(this._setElementHighlight(!1,t),this._hoverExtremityHighlightedClass.clearNodes(),this._hovered=null)}_setElementHighlight(t,e){const s=this._modules.settings.get(e.isNode?"cursor.node":"cursor.edge");if(t?(this._modules.graphics.addCursorStyle(s),e.addClass(Kr,this._animationOptions),this._hovered=e):(this._modules.graphics.removeCursorStyle(s),e.removeClass(Kr,this._animationOptions)),e.isNode){const i=this._modules.graph.getAttribute(e.isNode,"textHidden"),n=e._index;t&&(this._hoveredTextHidden=i.get(n)!==0);const r=!t&&this._hoveredTextHidden;i.set(n,r)}else this._hoverExtremityHighlightedClass.clearNodes(),t&&e.getExtremities().addClass(Ah,this._animationOptions)}},jO=class extends Bt{constructor(){super(...arguments),this.x=0,this.y=0}},HO=class{constructor(t,e){this._nodeMapping={valid:!1,values:{}},this._edgeMapping={valid:!1,values:{}},this._computeMapping=e,this._field=t,this._assignedRules=[]}getValue(t,e){const s=t.isNode,i=s?this._nodeMapping:this._edgeMapping;i.valid||(i.values=this._computeMapping(s),i.valid=!0);const n=t.getData(this._field);return Array.isArray(n)?e==="color"?n.map(r=>i.values[r]):i.values[n[0]]:i.values[n]}markAsInvalid(){this._nodeMapping.valid=!1,this._edgeMapping.valid=!1}getValues(t){return t?this._nodeMapping.values:this._edgeMapping.values}getField(){return this._field}isAssignedTo(t){return this._assignedRules.find(e=>e===t)}getAssignedRules(){return this._assignedRules.slice()}assignTo(t){this.isAssignedTo(t)||this._assignedRules.push(t)}unAssignTo(t){this._assignedRules=this._assignedRules.filter(e=>e!==t)}};function xv(t,e,s){const i=(e?t.getNodes():t.getEdges()).getData(s),n={};return i.forEach(r=>{if(!Array.isArray(r))return n[r]=1;r.forEach(o=>n[o]=1)}),"undefined"in n&&delete n[void 0],Object.keys(n).sort()}function WO(t,e,s,i){const{values:n={},fallback:r}=s,o=xv(t,i,e),a={};let l=0;for(let d=0;d<o.length;++d){const h=o[d];h in n?a[h]=n[h]:(a[h]=r[l],l=(l+1)%r.length)}return a}function XO(t,{nbSlices:e,minValue:s,maxValue:i}){if(Array.isArray(t))return t.slice();const{min:n=s,max:r=i}=t,o=(r-n)/e,a=[];for(let l=1;l<e;++l)a.push(n+o*l);return a}function YO(t,e){if(Array.isArray(t))return t;const{min:s,max:i}=t,n=e.length+1,r=(i-s)/e.length,o=[];for(let a=0;a<n;a++)o.push(s+a*r);return o}function $O(t,e,s,i){const{fallback:n,stops:r={},values:o,reverse:a}=s,l=xv(t,i,e);let d=1/0,h=-1/0;for(let f=0;f<l.length;f++){const m=+l[f];Zl(m)&&(d=Math.min(d,m),h=Math.max(h,m),l[f]=m)}const u={};if(!isFinite(d)){for(let f=0;f<l.length;f++)u[l[f]]=n;return u}const c=XO(r,{nbSlices:Array.isArray(o)?o.length:o.nbSlices,minValue:d,maxValue:h}),g=YO(o,c);a&&g.reverse();for(let f=0;f<l.length;++f){const m=l[f];if(isFinite(m)){let _=0;for(;_<c.length&&c[_]<=m;)_+=1;u[m]=g[_]}else u[m]=n}return u}var ZO=class extends Bt{constructor(){super(...arguments),this._mappingList=[]}onMounted(){this._modules.events.on(["addStyleRule","updateStyleRule"],({rule:t,options:e})=>{const s=e.nodeAttributes&&typeof e.nodeAttributes!="function"?e.nodeAttributes:{},i=e.edgeAttributes&&typeof e.edgeAttributes!="function"?e.edgeAttributes:{};[...Zr(s),...Zr(i)].forEach(n=>{n&&this._recursiveGetMapping(n).forEach(r=>r.assignTo(t.id))})}).on("removeStyleRule",({rule:t})=>{this._mappingList.forEach(e=>e.unAssignTo(t.id))}).on(["addNodes","addEdges","updateNodeData","updateEdgeData","removeNodes","beforeRemoveEdges","excludedStateChange","clearGraph"],()=>{this._mappingList.forEach(t=>{const e=t.getAssignedRules();t.markAsInvalid(),e.forEach(s=>this._modules.styleRules.refreshRule(s))}),this._modules.legend.refresh()})}_recursiveGetMapping(t,e=[]){if(!t)return e;if(t.mapping)return e.push(t.mapping),e;if(typeof t!="object")return e;const s=Zr(t).map(i=>this._recursiveGetMapping(i));return e.concat(...s)}createMapping({field:t,values:e={},fallback:s}={field:""}){if(t=Sn(t),Array.isArray(s)?s.length===0&&(s=[void 0]):s=[s],!wn(e))throw new Error('"mapping" should be an object');return this._createMappingFunction(WO,t,{values:e,fallback:s})}createSlices({field:t,fallback:e,stops:s={},values:i,reverse:n=!1}={field:"",values:[]}){if(t=Sn(t),Array.isArray(i)||i.nbSlices||(i.nbSlices=7),Array.isArray(s)&&Array.isArray(i)&&s.length!==i.length-1)throw new Error("there should be exactly one more value that stops");return this._createMappingFunction($O,t,{fallback:e,stops:s,values:i,reverse:n})}_createMappingFunction(t,e,s){const i=new HO(e,r=>t(this._modules.graph,e,s,r));this._mappingList.push(i);const n=(r,o,a)=>i.getValue(r,a);return n.mapping=i,n}createTemplate(t){if(typeof t!="string")throw new TypeError('"template" should be a string');const e=[];let s=0,i=!1;for(;!i;){let n=-1;const r=t.indexOf("{{",s);r!==-1&&(n=t.indexOf("}}",r+2)),n!==-1?(e.push(t.substring(s,r)),e.push(t.substring(r+2,n)),s=n+2):(e.push(t.slice(s)),i=!0)}return function(n){let r=e[0];for(let o=1;o<e.length;o+=2)r+=n.getData(e[o]),r+=e[o+1];return r}}},R_=t=>t.stopPropagation(),KO=(t,e)=>{e.style.position="absolute",e.style.left="0",e.style.top="0",t.appendChild(e)},QO=t=>e=>{for(;t.firstChild;)t.removeChild(t.firstChild);for(let s=0;s<e.length;++s)KO(t,e[s])},JO=(t,e)=>{const s=document.createElement("img");return new Promise(i=>{s.addEventListener("load",()=>{e.drawImage(s,0,0,e.canvas.width,e.canvas.height),i(e)});const n=`data:image/svg+xml;base64,${btoa(new XMLSerializer().serializeToString(t))}`;s.src=n})},tk=class extends Bt{constructor(){super(...arguments),this._elements=[],this._layers=[],this.readyCallbacks=[],this.render=(t,e,s,i)=>{const n=i&&i.pixelRatio?i.pixelRatio:ps(),{zoom:r,x:o,y:a,width:l,height:d}=i||this._modules.camera.getView();if(r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=n*r;s.noClear||t.clearRect(0,0,l*n,d*n),s.isStatic||(t.save(),t.translate(l*n/2,d*n/2),t.rotate(i?-(i.angle||0):-this._modules.camera.getAngle()),t.translate(-o*h,-a*h),t.scale(h,h)),e(t),s.isStatic||t.restore()},this.createCanvas=(t,e)=>{const{width:s,height:i}=this._modules.camera.getSize(),n=e.canvas||We(s,i),r=e.ctx||n.getContext("2d"),o=(h=t)=>{r&&this.render(r,h,e)},a=()=>{const{width:h,height:u}=this._modules.camera.getSize(),c=ps();n.width=h*c,n.height=u*c,n.style.width=`${h}px`,n.style.height=`${u}px`,o()};let l,d;if(e.isStatic)this._modules.events.on("resize",a),l=()=>this._modules.events.off(a);else{let h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom(),c=!1;const g=0;let f;const m=500,_=()=>{c||(o(),c=!0,h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom())},p=()=>{c||_();const{x:b,y:v}=this._modules.camera.getCenter(),E=b-h.x,A=v-h.y,S=-E*u,w=-A*u,L=this._modules.camera.getZoom()/u,T=-this._modules.camera.getAngle();n.style.transform=`
          scale(${L})
          rotate(${-T}rad)
          translateX(${S}px)
          translateY(${w}px)
          rotate(${T}rad)
        `.replace(/\n/g,"")};d=()=>!c||(o(),c=!1,n.style.transform="scale(1) translateX(0px) translateY(0px)",!1);const x=b=>{f&&clearTimeout(f),_()},y=b=>{Date.now()<g&&f&&clearTimeout(f),f=setTimeout(d,b.duration+m),_()};this._modules.events.on("dragStart",x).on("zoomStart",y).on("dragEnd",d).on(["viewChanged","zoom","rotate","move","animate"],p),this._modules.dom.addDirectWindowEventListener("resize",d),this._modules.events.on("resize",a),l=()=>{this._modules.events.off(a).off(x).off(y).off(d).off(p),this._modules.dom.removeDirectWindowEventListener("resize",d)}}return n.style.touchAction="none",n.style.pointerEvents="none",a(),{element:n,removeListeners:l,refresh:h=>{d&&!d()||o(h)},clear:()=>r?.clearRect(0,0,n.width,n.height)}},this.createSVG=t=>{const{element:e}=t;e.style["pointer-events"]="none";const s=()=>{t.draw(t.element)},i=n=>{let{zoom:r,x:o,y:a,width:l,height:d}=n||this._modules.camera.getView();if(l=Math.floor(l),d=Math.floor(d),r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=l/2/r,u=d/2/r,c=Math.cos(-this._modules.camera.getAngle()),g=Math.sin(-this._modules.camera.getAngle()),f=c*o-g*a-h,m=g*o+c*a-u,_=l/r,p=d/r;e.style.width=`${l}px`,e.style.height=`${d}px`,e.setAttribute("width",`${l}`),e.setAttribute("height",`${d}`),e.setAttribute("viewBox",`${f} ${m} ${_} ${p}`)};return this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],()=>i()),e.addEventListener("mousemove",R_),i(),s(),{element:e,removeListeners:()=>{this._modules.events.off(i)},updateTransformation:i,refresh:s}},this._createOverlay=t=>{const e=()=>{const{element:n,position:r}=t,{zoom:o,x:a,y:l,width:d,height:h}=this._modules.camera.getView();if(o===void 0||a===void 0||l===void 0||d===void 0||h===void 0)return null;const u=o,c=d/2,g=h/2,f=-this._modules.camera.getAngle(),m=(r.x-a)*u,_=(r.y-l)*u;n.style.transformOrigin="top left",n.style.transform=`translate(${c}px, ${g}px) rotate(${f}rad) translate(${m}px, ${_}px) ${t.scaled?`scale(${u}, ${u})`:""}`};this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],e);const{element:s,size:i}=t;return i&&(s.style.width=`${i.width}`,s.style.height=`${i.height}`),s.addEventListener("mousemove",R_),e(),{element:s,removeListeners:()=>{this._modules.events.off(e)},updateTransformation:e}},this.addLayer=(t,e="layer",s=this._elements.length)=>{const i=typeof t=="string"?ch(t):t;this._elements.push(i);const n={element:i};return n.type=e,n.getLevel=()=>this._elements.indexOf(i),n.moveTo=r=>(this._elements.splice(r,0,this._elements.splice(n.getLevel(),1)[0]),this._updateDom(this._elements),n),n.moveUp=()=>n.moveTo(n.getLevel()+1),n.moveDown=()=>n.moveTo(n.getLevel()-1),n.moveToTop=()=>n.moveTo(this._elements.length-1),n.moveToBottom=()=>n.moveTo(0),n.destroy=()=>this._removeLayer(n),n.hide=()=>(n.element&&(n.element.style.visibility="hidden"),n),n.show=()=>(n.element&&(n.element.style.visibility="visible"),n),n.isHidden=()=>n.element.style.visibility==="hidden",n.setOpacity=r=>(n.element&&(n.element.style.opacity=r.toString()),n),n.getOpacity=()=>parseFloat(n.element.style.opacity||"1"),n.setPosition=r=>{if(n.element){const o=n.element.style;o.left=`${r.x}px`,o.top=`${r.y}px`}return n},n.setSize=r=>{if(n.element&&r){const{width:o,height:a}=r,l=n.element.style;l.width=`${o}px`,l.height=`${a}px`}return n},n.moveTo(s),this._layers.push(n),n},this.addCanvasLayer=(t,e={isStatic:!1,noClear:!1},s=this._elements.length)=>{const i=this.createCanvas(t,e),{element:n,removeListeners:r,refresh:o,clear:a}=i,l=this.addLayer(n,"canvas",s);return n.classList.add("ogma-canvas-layer"),l.destroy=()=>this._removeLayer(l,r),l.refresh=o,l.clear=a,l.draw=t,l.options=e,l},this.addOverlay=(t,e=this._elements.length)=>{typeof t.element=="string"&&(t.element=ch(t.element)),t.scaled=t.scaled===void 0||t.scaled;const s=this._createOverlay(t),{element:i,removeListeners:n,updateTransformation:r}=s,o=this.addLayer(i,"overlay",e);return o._onViewChange=r,o._onDestroy=n,o.destroy=()=>this._removeLayer(o,n),o.setPosition=a=>(t.position=a,r(),o),t.size&&o.setSize(t.size),o},this.addSVGLayer=(t,e=this._elements.length)=>{const s=this.createSVG(t),{element:i,refresh:n,removeListeners:r,updateTransformation:o}=s,a=this.addLayer(i,"svg",e);return a._onViewChange=o,a._onDestroy=r,a.destroy=()=>this._removeLayer(a,r),a.refresh=n,a}}canvasToImage(t,e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");this.render(i,t.draw,{...t.options,noClear:!0},{...e,pixelRatio:1});const n=ie("image");return n.setAttribute("href",s.toDataURL("image/png")),n.setAttribute("width",s.width),n.setAttribute("height",s.height),n}exportPNG(t,e,s){const i=t.getContext("2d");let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?(this.render(i,r.draw,{...r.options,noClear:!0},s),Promise.resolve()):(r._onViewChange&&r._onViewChange(s),JO(r.element,i)))}),n}exportSVG(t,e,s,i){let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?Promise.resolve(this.canvasToImage(r,s)):(r._onViewChange&&r._onViewChange(s),r.element.cloneNode(!0))).then(o=>i?t.insertBefore(o,t.querySelector(".ogma-nodes").parentNode||t.firstChild):t.appendChild(o))}),n}export(t){const e=this._layers.sort((n,r)=>n.getLevel()-r.getLevel()).filter(n=>n.type==="canvas"||n.type==="svg"),s=this.ogmaLayer?this.ogmaLayer.getLevel():0,i=t.below?e.filter(n=>n.getLevel()<s):e.filter(n=>n.getLevel()>s);return t.canvas?this.exportPNG(t.canvas,i,t.view):this.exportSVG(t.svg,i,t.view,t.below)}onMounted(){const t=this._modules.graphics.getDomElement();this._updateDom=QO(t);const e=t.firstChild;e&&(this.ogmaLayer=this.addLayer(e)),this.runCallbacks()}runCallbacks(){this.ogmaLayer&&(this.readyCallbacks.forEach(t=>t()),this.readyCallbacks=[])}whenReady(t){this.readyCallbacks.push(t),this.ogmaLayer&&this.runCallbacks()}_removeLayer(t,e){return t.element&&t.element.parentNode&&(this._elements.splice(t.getLevel(),1),e&&e(),t.element=null,this._updateDom(this._elements)),this._layers=this._layers.filter(s=>s!==t),t}destroy(){this._elements=[]}},ek=class extends Bt{onMounted(){const t=this._modules.graph;this._nodeList=t.getNodeAttribute("object"),this._edgeList=t.getEdgeAttribute("object"),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target"),this._excludedList=t.getEdgeAttribute("excluded"),this._virtualList=t.getEdgeAttribute("virtual")}shortestPath(t={source:void 0,target:void 0}){const{source:e,target:s,directed:i=!1,edges:n=this._ogma.getEdges(),nodes:r=this._ogma.getNodes(),edgeCostFunction:o=()=>1,heuristicFunction:a=()=>0}=t,l=n.reduce((m,_)=>(m[_._index]=!0,m),{}),d=r.reduce((m,_)=>(m[_._index]=!0,m),{}),h=this._modules.graph.getNode(e),u=this._modules.graph.getNode(s);if(!h)throw new Error("the source is not a node");if(!u)throw new Error("the target is not a node");const c=h._index,g=u._index;d[c]=!0,d[g]=!0;let f=null;if(c===g)f={nodes:h.toList(),edges:this._modules.graph.edgeList()};else{const m=this._modules.graph.getNodeMaxIndex()+1,_=new Int32Array(m),p=new Float32Array(m),x=new Float32Array(m),y=new Set,b=new qy(x);for(p.fill(1/0),x.fill(1/0),_.fill(-1),b.add(c),p[c]=0,x[c]=a(h,u);!b.isEmpty();){const v=b.removeMin();if(v===g){f=this._constructPath(_,c,g);break}y.add(v);const E=this._modules.graph.getAdjacentDirections(v);if(E)for(let A=0;A<E.length;++A){const S=E[A],w=this._modules.graph.getEdgeIndexesInDirection(S);let L=-1,T=0,F=-1;for(let V=0;V<w.length;++V){const G=w[V],O=this._sourceList.get(G),j=this._targetList.get(G);if(O===j||!d[O]||!d[j]||i&&v!==O||!l[G])continue;const W=o(this._edgeList.get(G));(L===-1||W<T)&&(L=G,T=W,F=O===v?j:O)}if(F!==-1||y.has(F)){const V=p[v]+T;if(!b.has(F)||V<p[F]){const G=this._nodeList.get(v);_[F]=L,p[F]=V,x[F]=V+a(G,u),b.add(F)}}}}}return Promise.resolve(f)}_constructPath(t,e,s){const i=[s],n=[];let r=s;for(;r!==e;){const o=t[r],a=this._sourceList.get(o),l=this._targetList.get(o);r=r===a?l:a,i.push(r),n.push(o)}return i.reverse(),n.reverse(),{nodes:this._modules.graph.nodeList(new Uint32Array(i)),edges:this._modules.graph.edgeList(new Uint32Array(n))}}detectCycle(t,e){const s=e.getSource(),i=e.getTarget(),n=zy(t._indexes,s._indexes,i._indexes);return n?this._modules.graph.nodeList(new Uint32Array(n)).dedupe():this._modules.graph.nodeList()}getAllSimpleCycles(t,e){const s=e.getSource(),i=e.getTarget();return new Uy(t._indexes,s._indexes,i._indexes).getCycles().map(n=>this._modules.graph.nodeList(new Uint32Array(n)))}minimumSpanningTree(t,e,s){const i=this._modules.graph;t=i.getNodes(t),e=i.getEdges(e);const n=new Set;t.forEach(l=>n.add(l._index));const r=i.getConnectedComponents(t,{filter:l=>n.has(l),internalIndexes:!0}),o={};r.forEach((l,d)=>l.forEach(h=>o[h]=d));const a=[];return e.forEach(l=>{const d=o[l.getSource()._index];d!==void 0&&(a[d]===void 0&&(a[d]=[]),a[d].push(l._index))}),r.map((l,d)=>{const h=Gy(l,a[d]||[],u=>i.edge(u).getSource()._index,u=>i.edge(u).getTarget()._index,s?u=>s(i.edge(u)):void 0);return{nodes:i.nodeList(new Uint32Array(l)),edges:i.edgeList(new Uint32Array(h))}})}bfs({root:t,onNode:e,onEdge:s=Yt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.unshift(h)})}}}dfs({root:t,onNode:e,onEdge:s=Yt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.push(h)})}}}betweenness({nodes:t,edges:e,directed:s,normalized:i}){const n=this._ogma.getNodes().subtract(t),r=this._ogma.getEdges().subtract(e).concat(n.fastGetAdjacentElements().edges).dedupe();return Vy({adjacency:t.map(o=>{const a=this._ogma.edgeList(this._ogma.modules.graph.topology.getAdjacentElements(!1,o.toList()._indexes,{direction:s?"out":"both"})).subtract(r).dedupe();return{id:o._index,adj:a.map(l=>l.getSource()._index===o._index?l.getTarget()._index:l.getSource()._index)}}),directed:s,normalized:i})}fishEyeExpand(t,e,s){return Ly(t,e,s)}},F_=(t,e)=>{if(!t)throw new Error("Traversal options are required");if(typeof t.onNode!="function")throw new Error("onNode callback is required");if(t.root=e.getNode(t.root),!t.root)throw new Error(`Root node '${t.root}' does not exist`);return t},Fa=()=>({nodes:void 0,edges:void 0}),sk=class extends ge{constructor(){super(...arguments),this.shortestPath=t=>this._ogma.modules.algorithms.shortestPath(t),this.hasCycle=t=>{const{nodes:e,edges:s}=t||Fa();return this.detectCycle({nodes:e,edges:s})!==null},this.getAllSimpleCycles=t=>{let{nodes:e,edges:s}=t||Fa();return e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0})),this._ogma.modules.algorithms.getAllSimpleCycles(e,s)},this.detectCycle=t=>{let{nodes:e,edges:s}=t||Fa();e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0}));const i=this._ogma.modules.algorithms.detectCycle(e,s);return i.size?i:null},this.minimumSpanningTree=t=>{const{nodes:e,edges:s,edgeCostFunction:i}=t||{...Fa(),edgeCostFunction:void 0};return this._ogma.modules.algorithms.minimumSpanningTree(e,s,i)},this.dfs=t=>this._ogma.modules.algorithms.dfs(F_(t,this._ogma.modules.graph)),this.bfs=t=>this._ogma.modules.algorithms.bfs(F_(t,this._ogma.modules.graph)),this.betweenness=(t={})=>(t={nodes:t.nodes||this._ogma.getNodes(),edges:t.edges||this._ogma.getEdges(),directed:t.directed!==void 0&&t.directed,normalized:t.normalized===void 0||t.normalized},this._ogma.modules.algorithms.betweenness(t)),this.getMinimumEnclosingCircle=t=>{if(!t||t.size===0)throw new Error("getMinimumEnclosingCircle: no nodes provided");const e=t.getAttribute("x"),s=t.getAttribute("y"),i=t.getAttribute("radius"),[n,r,o]=Mo(e,s,i);return{x:n,y:r,radius:o}},this.circlePack=({nodes:t,margin:e=0,origin:s={x:0,y:0},duration:i=0,easing:n="linear",sort:r,dryRun:o})=>{if(!t||t.size===0)throw new Error("circlePack: no nodes provided");let a=t.map((d,h)=>({index:h,radius:+d.getAttribute("radius")+e,id:d.getId()}));if(r)if(r==="asc")a=a.sort((d,h)=>h.radius-d.radius);else if(r==="desc")a=a.sort((d,h)=>d.radius-h.radius);else{if(typeof r!="function")throw new Error("circlePack: invalid sort option");a=a.sort((d,h)=>r(t.get(d.index),t.get(h.index)))}if(s&&(!isFinite(s.x)||!isFinite(s.y)))throw new Error("circlePack: invalid origin");const l=Cy(a,s.x,s.y).reduce((d,{index:h,x:u,y:c})=>(d[h]={x:u,y:c},d),new Array(t.size));return o?l:t.setAttributes(l,{duration:i,easing:n}).then(()=>l)},this.fishEyeExpand=({nodes:t,focusNode:e,deltaRadius:s,duration:i=0,dryRun:n=!1,easing:r="linear"})=>{if(!t||t.size===0)throw new Error("Expand/collapse: no nodes provided");if(!(e instanceof js))throw new Error("Expand/collapse: no focus node provided");if(!isFinite(s))throw new Error("Expand/collapse: invalid delta radius");const o=this._ogma.modules.algorithms.fishEyeExpand(t,e,s);return n?o:t.setAttributes(o,{duration:i,easing:r}).then(()=>o)}}},ik=qc;let ld=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");const Ao={strokeType:"plain",strokeColor:"#202020",strokeWidth:1,head:"none",tail:"none"},D_={id:0,type:"Feature",properties:{type:"arrow",style:{...Ao}},geometry:{type:"LineString",coordinates:[[0,0],[100,100]]}},Hc=(t=0,e=0,s=0,i=0,n={...Ao})=>({id:ld(),type:"Feature",properties:{type:"arrow",style:{...Ao,...n}},geometry:{type:"LineString",coordinates:[[t,e],[s,i]]}}),nk="http://www.w3.org/2000/svg";function En(t){return document.createElementNS(nk,t)}function bv(t){return t.geometry.bbox||rk(t),t.geometry.bbox}function bi(t){const e=bv(t);return{width:e[2]-e[0],height:e[3]-e[1]}}function pi(t){const e=bv(t);return{x:e[0],y:e[1]}}function rk(t){const[e,s]=t.geometry.coordinates[0][0],[i,n]=t.geometry.coordinates[0][2];t.geometry.bbox=[e,s,i,n]}function ok(t,e,s,i,n){t.geometry.bbox=[e,s,e+i,s+n],t.geometry.coordinates=[[[e,s],[e+i,s],[e+i,s+n],[e,s+n],[e,s]]]}function ro(t){const[e,s]=t.geometry.coordinates[0];return{x:e,y:s}}function Da(t,e){const[s,i]=t.geometry.coordinates[e==="start"?0:1];return{x:s,y:i}}function Nl(t){const[e,s]=t.geometry.coordinates[1];return{x:e,y:s}}function vv(t,e,s){t.geometry.coordinates[0]=[e,s]}function Ev(t,e,s){t.geometry.coordinates[1]=[e,s]}function Ml(t){return{start:ro(t),end:Nl(t)}}function zn(t,e,s,i){e==="start"?vv(t,s,i):Ev(t,s,i)}const Av=t=>parseInt(t.getAttribute("data-handle-id")||"-1");function ak(t){return Array.isArray(t)&&t.length===2&&t.every(isFinite)}function lk(t,e,s,i){for(let n=0;n<t.coordinates.length;n++){const r=t.coordinates[n];if(ak(r))r[0]=s+(r[0]-s)*e,r[1]=i+(r[1]-i)*e;else for(let o=0;o<r.length;o++){const a=r[o];a[0]=s+(a[0]-s)*e,a[1]=i+(a[1]-i)*e}}return t}function Oa(t,e,s){const i=Math.atan2(t.y-e.y,t.x-e.x);return{x:e.x+s*Math.cos(i),y:e.y+s*Math.sin(i)}}function vu(t,e){if(!e)return{x:t.clientX,y:t.clientY};const s=e.getBoundingClientRect();return{x:t.clientX-s.left-e.clientLeft,y:t.clientY-s.top-e.clientTop}}function dk(t,e){return t.startsWith("#")?uk(t,e):t.startsWith("rgb")?ck(t,e):t}function hk(t){return t.length===4?t.split("").map(e=>e+e).join(""):t}function uk(t,e){const[s,i,n]=hk(t).match(/\w\w/g).map(r=>parseInt(r,16));return`rgba(${s}, ${i}, ${n}, ${e})`}function ck(t,e){const[s,i,n]=t.match(/\d+/g).map(r=>parseInt(r,10));return`rgba(${s}, ${i}, ${n}, ${e})`}const An=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),sr=t=>Math.sqrt(t.x*t.x+t.y*t.y),Sv=t=>({x:-t.x,y:-t.y}),wv=t=>{const e=sr(t);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}},Qn=(t,e)=>({x:t.x+e.x,y:t.y+e.y}),Tv=(t,e)=>({x:t.x*e,y:t.y*e}),ka=(t,e)=>({x:t.x*e.x,y:t.y*e.y}),Es=(t,e)=>{const s=Math.sin(e),i=Math.cos(e);return{x:t.x*i-t.y*s,y:t.x*s+t.y*i}},gk=(t,e)=>({x:t.x/e,y:t.y/e}),O_=(t,e)=>t.x*e.x+t.y*e.y,fk=.5;function Iv(t,e=5,s=30){const{start:i,end:n}=Ml(t),r=An(n,i),o=t.properties.style&&t.properties.style.strokeWidth?t.properties.style?.strokeWidth:0;return Math.min(s,Math.max(3*o,sr(r)*.01,e))}function k_(t,e,s,i){const n=Tv(Sv(wv(e)),i);if(!s||s!=="arrow"&&s!=="arrow-plain")return"";const r=Qn(t,Es(n,Math.PI/10)),o=Qn(t,Es(n,-Math.PI/10)),a=`${t.x} ${t.y}`;return`M ${r.x} ${r.y} L ${a} ${o.x} ${o.y} ${s==="arrow"?"":`${r.x} ${r.y}`}`}function mk(t,e,s,i,n){const{start:r,end:o}=Ml(t),{tail:a,head:l,strokeColor:d,strokeWidth:h=0}=t.properties.style||s,u=An(o,r),c=Iv(t,i,n),g=En("g"),f=En("path");g.setAttribute("data-annotation",`${t.id}`),g.setAttribute("data-annotation-type","arrow");const m=l==="arrow-plain"||a==="arrow",_=d||"none";f.setAttribute("stroke",_),f.setAttribute("stroke-width",`${h}`),f.setAttribute("fill",m?d||"":"none"),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round");const p=k_(r,Sv(u),a,c),x=k_(o,u,l,c),y=p+`M ${r.x} ${r.y} ${o.x} ${o.y}`+x;f.setAttribute("d",y),g.appendChild(f),z_(g,r,_,a,h),z_(g,o,_,l,h),e.appendChild(g)}function z_(t,e,s,i,n){i==="halo-dot"&&B_(t,e,_k(s),n*4),(i==="dot"||i==="halo-dot")&&B_(t,e,s,n*2)}function _k(t){return t==="none"?"none":dk(t,fk)}function B_(t,e,s,i){const n=En("circle");n.setAttribute("cx",`${e.x}`),n.setAttribute("cy",`${e.y}`),n.setAttribute("r",`${i}`),n.setAttribute("fill",s),t.appendChild(n)}const Pe=-1,Pl="dragging",Rl="dragstart",en="dragend",Eu="select",Au="unselect",pk="hover",yk="unhover",Su="remove",wu="add",xk="cancelDrawing",Tu="update",bk="link";function Cv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var eh={exports:{}},U_;function vk(){return U_||(U_=1,function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}function r(l,d,h,u,c){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new n(h,u||l,c),f=s?s+d:d;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],g]:l._events[f].push(g):(l._events[f]=g,l._eventsCount++),l}function o(l,d){--l._eventsCount===0?l._events=new i:delete l._events[d]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(s?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},a.prototype.listeners=function(d){var h=s?s+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,g=u.length,f=new Array(g);c<g;c++)f[c]=u[c].fn;return f},a.prototype.listenerCount=function(d){var h=s?s+d:d,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(d,h,u,c,g,f){var m=s?s+d:d;if(!this._events[m])return!1;var _=this._events[m],p=arguments.length,x,y;if(_.fn){switch(_.once&&this.removeListener(d,_.fn,void 0,!0),p){case 1:return _.fn.call(_.context),!0;case 2:return _.fn.call(_.context,h),!0;case 3:return _.fn.call(_.context,h,u),!0;case 4:return _.fn.call(_.context,h,u,c),!0;case 5:return _.fn.call(_.context,h,u,c,g),!0;case 6:return _.fn.call(_.context,h,u,c,g,f),!0}for(y=1,x=new Array(p-1);y<p;y++)x[y-1]=arguments[y];_.fn.apply(_.context,x)}else{var b=_.length,v;for(y=0;y<b;y++)switch(_[y].once&&this.removeListener(d,_[y].fn,void 0,!0),p){case 1:_[y].fn.call(_[y].context);break;case 2:_[y].fn.call(_[y].context,h);break;case 3:_[y].fn.call(_[y].context,h,u);break;case 4:_[y].fn.call(_[y].context,h,u,c);break;default:if(!x)for(v=1,x=new Array(p-1);v<p;v++)x[v-1]=arguments[v];_[y].fn.apply(_[y].context,x)}}return!0},a.prototype.on=function(d,h,u){return r(this,d,h,u,!1)},a.prototype.once=function(d,h,u){return r(this,d,h,u,!0)},a.prototype.removeListener=function(d,h,u,c){var g=s?s+d:d;if(!this._events[g])return this;if(!h)return o(this,g),this;var f=this._events[g];if(f.fn)f.fn===h&&(!c||f.once)&&(!u||f.context===u)&&o(this,g);else{for(var m=0,_=[],p=f.length;m<p;m++)(f[m].fn!==h||c&&!f[m].once||u&&f[m].context!==u)&&_.push(f[m]);_.length?this._events[g]=_.length===1?_[0]:_:o(this,g)}return this},a.prototype.removeAllListeners=function(d){var h;return d?(h=s?s+d:d,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,t.exports=a}(eh)),eh.exports}var Ek=vk();const Lv=Cv(Ek);class Nv extends Lv{ogma;elements;layer;editor;selectedId=Pe;hoveredId=Pe;ogmaOptions;shouldDetect;isDragging;showeditorOnHover;constructor(e,s){super(),this.ogma=e,this.elements=[],this.shouldDetect=!0,this.isDragging=!1,this.showeditorOnHover=!0,this.ogmaOptions=e.getOptions(),e.events.on(["click","mousemove"],this._onClickMouseMove).on("keyup",this._onKeyUp).on("frame",()=>{this.refreshEditor(),this.refreshDrawing()}),this.layer=e.layers.addSVGLayer({draw:i=>this.draw(i)}),this.layer.moveToTop(),this.editor=e.layers.addLayer(s),this.editor.hide()}_onKeyUp=e=>{e.code===27&&this.selectedId!==Pe?this.unselect():(e.code===46||e.code===8)&&this.selectedId!==Pe&&this._canRemove()&&this.remove(this.selectedId)};_canRemove(){return!0}_onClickMouseMove=e=>{if(!e.domEvent||this.isDragging||!this.shouldDetect||e.domEvent.type!=="mousemove"&&e.domEvent.target&&e.domEvent.target.tagName==="a")return;const s=this.ogma.view.screenToGraphCoordinates(e),i=this.shouldDetect||!this.shouldDetect&&+this.selectedId>-1?this.detect(s,0):void 0;e.domEvent.type==="mousemove"?i?this.hover(i.id):this.hoveredId!==Pe&&this.unhover():i?this.select(i.id):this.selectedId!==Pe&&this.unselect()};add(e){const s=this.getDefaultOptions(),i=Object.assign(e,{id:e.id===void 0?ld():e.id,type:e.type,properties:{...s.properties,...e.properties||{},style:{...s.properties.style,...e.properties.style||{}}},geometry:{...s.geometry,...e.geometry}});return this.elements.push(i),this.layer.refresh(),this.emit(wu,i),i}updateStyle(e,s){this.updateAnnotation(e,{properties:{style:s}})}updateGeometry(e,s){this.updateAnnotation(e,{geometry:s})}scale(e,s,i,n){this.updateGeometry(e,lk(e.geometry,s,i,n))}update(e,s){const i=this.getById(e);this.updateAnnotation(i,s)}updateAnnotation(e,s){if(!e)return;const i=e.id;Object.keys(s).forEach(n=>{if(n!=="id")if(n==="properties"){const r=s.properties||{style:{}};e.properties={...e.properties||{},...r||{},style:{...e.properties.style||{},...r.style||{}}}}else n==="geometry"?e.geometry={...e.geometry,...s.geometry}:e[n]=s[n]}),i===this.selectedId&&this.refreshEditor(),this.layer.refresh()}getById(e){const s=Number(e);for(let i=0;i<this.elements.length;i++){const n=this.elements[i];if(!(n.id!==e&&n.id!==s))return n}}select(e){const s=this.getById(e);s&&(this.editor.show(),this.selectedId=e,this.refreshEditor(),this.layer.refresh(),this.emit(Eu,s))}hover(e){const s=this.getById(e);s&&(this.showeditorOnHover&&this.editor.show(),this.hoveredId=e,this.refreshEditor(),this.layer.refresh(),this.emit(pk,s))}getSelectedFeature(){return this.selectedId===Pe?null:this.getById(this.selectedId)}unselect(){const e=this.getById(this.selectedId);return e&&this.emit(Au,e),this.selectedId=Pe,this.hoveredId===Pe&&this.editor.hide(),this.layer.refresh(),this}unhover(){const e=this.getById(this.hoveredId);return this.emit(yk,e),this.hoveredId=Pe,this.selectedId===Pe&&this.editor.hide(),this.layer.refresh(),this}remove(e){const s=this.getById(e);e===this.hoveredId&&this.unhover(),e===this.selectedId&&this.unselect(),this.elements=this.elements.filter(i=>i.id!==e),s&&this.emit(Su,s),this.layer.refresh()}disableDragging(){this.ogma.setOptions({interactions:{drag:{enabled:!1},pan:{enabled:!1}},detect:{nodes:!1,edges:!1,nodeTexts:!1,edgeTexts:!1}})}restoreDragging(){this.ogma.setOptions(this.ogmaOptions)}enableDetection(){this.shouldDetect=!0}disableDetection(){this.shouldDetect=!1}refreshLayer(){this.layer.refresh()}refreshDrawing(){}getElements(){return[...this.elements]}destroy(){this.ogma.events.off(this._onClickMouseMove).off(this._onKeyUp),this.layer.destroy()}}const G_="handle-line",V_="handle-start",q_="handle-end";class Ak extends Nv{draggedHandle=Pe;start={x:0,y:0};end={x:0,y:0};arrow={...D_};startX=0;startY=0;minArrowHeight=0;maxArrowHeight=0;handles=[];constructor(e,s={}){super(e,`
    <div class="arrow-handle">
      <div id="${G_}" data-handle-id="0" class="handle line"></div>
      <div id="${V_}" data-handle-id="1" class="handle point"></div>
      <div id="${q_}" data-handle-id="2" class="handle point"></div>
    </div>
  `),this.minArrowHeight=s.minArrowHeight||0,this.maxArrowHeight=s.maxArrowHeight||1e6,this.handles=Array.prototype.slice.call(this.editor.element.querySelectorAll(".arrow-handle>.handle")),this.handles.forEach(i=>i.addEventListener("mousedown",this.onHandleMouseDown)),document.addEventListener("mousemove",this.onMouseMove,!0),document.addEventListener("mouseup",this.onMouseUp)}onHandleMouseDown=e=>{const s=this.getById(this.selectedId)||this.getById(this.hoveredId);if(!s)return;const{x:i,y:n}=vu(e,this.ogma.getContainer());this.startDragging(s,i,n),this.draggedHandle=Av(e.target)};startDrawing(e,s,i=Hc(e,s,e,s,Ao)){this.disableDragging(),this.add(i),this.hoveredId=i.id;const n=this.ogma.view.graphToScreenCoordinates({x:e,y:s}),r=this.ogma.getContainer()?.getBoundingClientRect()||{left:0,top:0};this.startDragging(this.getById(i.id),n.x+r?.left,n.y+r.top),this.draggedHandle=2}cancelDrawing(){this.isDragging&&(this.remove(this.arrow.id),this.emit(en,this.arrow),this.restoreDragging(),this.isDragging=!1,this.draggedHandle=Pe)}startDragging(e,s,i){this.selectedId!==e.id&&this.select(this.hoveredId),this.arrow=e,this.startX=s,this.startY=i,this.start=ro(this.arrow),this.end=Nl(this.arrow),this.disableDragging(),this.emit(Rl,this.arrow),this.isDragging=!0}onMouseUp=()=>{this.draggedHandle!==-1&&(this.restoreDragging(),this.isDragging=!1,this.draggedHandle=Pe,this.emit(en,this.arrow))};onMouseMove=e=>{if(!this.isDragging||this.draggedHandle===Pe)return;const s=this.handles[this.draggedHandle],i=this.ogma.view.getAngle(),{x:n,y:r}=Es(gk({x:e.x-this.startX,y:e.y-this.startY},this.ogma.view.getZoom()),i),o=s.id===G_,a=s.id===V_,l=s.id===q_;(o||a)&&vv(this.arrow,this.start.x+n,this.start.y+r),(o||l)&&Ev(this.arrow,this.end.x+n,this.end.y+r),this.emit(Pl,this.arrow,o?"line":a?"start":"end"),this.refreshEditor(),this.layer.refresh()};detect(e,s=0){return this.elements.find(i=>{const{start:n,end:r}=Ml(i),o=An(e,{x:(n.x+r.x)/2,y:(n.y+r.y)/2}),a=An(r,n),l=sr(a),d=wv(a),h=Iv(i);return Math.abs(O_(d,o))<l/2+s&&Math.abs(O_(Es(d,Math.PI/2),o))<h/2+s})}refreshEditor(){if(+this.selectedId<0&&+this.hoveredId<0)return;const e=this.selectedId!==Pe?this.getById(this.selectedId):this.getById(this.hoveredId),s=Ml(e),i=this.ogma.view.graphToScreenCoordinates(s.start),n=this.ogma.view.graphToScreenCoordinates(s.end),[r,o,a]=Array.prototype.slice.call(this.editor.element.querySelectorAll(".handle"));o.style.transform=`translate(${i.x}px, ${i.y}px) translate(-50%, -50%)`,a.style.transform=`translate(${n.x}px, ${n.y}px) translate(-50%, -50%)`;const l={x:(n.x+i.x)/2,y:(n.y+i.y)/2},d=An(n,i),h=Tv(d,1/sr(d)),u=Math.atan2(h.y,h.x);r.style.width=`${sr(d)}px`,r.style.left=`${l.x}px`,r.style.top=`${l.y}px`,r.style.transform=`translate(-50%, -50%) rotate(${u}rad)`}getDefaultOptions(){return D_}draw(e){e.innerHTML="";const s=En("g"),i=this.ogma.view.getAngle();i!==0&&s.setAttribute("transform",`rotate(${-i*(180/Math.PI)})`),this.elements.forEach(n=>mk(n,s,Ao,this.minArrowHeight,this.maxArrowHeight)),e.appendChild(s)}refreshDrawing(){const e=this.ogma.view.getAngle();this.layer.element!==null&&e!==0&&this.layer.element.children[0].setAttribute("transform",`rotate(${-e*(180/Math.PI)})`)}destroy(){super.destroy(),document.removeEventListener("mousemove",this.onMouseMove,!0),document.removeEventListener("mouseup",this.onMouseUp)}}const ir={font:"sans-serif",fontSize:18,color:"#505050",background:"#f5f5f5",strokeWidth:0,borderRadius:8,padding:16,strokeType:"plain"},sh={id:0,type:"Feature",properties:{type:"text",content:"",style:{...ir}},geometry:{type:"Polygon",coordinates:[[[0,0],[100,0],[100,50],[0,50],[0,0]]]}},j_={handleSize:3.5,placeholder:"Your text..."},Mv=(t=0,e=0,s=100,i=50,n="",r={...ir})=>({id:ld(),type:"Feature",properties:{type:"text",content:n,style:{...ir,...r}},geometry:{type:"Polygon",coordinates:[[[t,e],[t+s,e],[t+s,e+i],[t,e+i],[t,e]]]}});var Ka={exports:{}},Sk=Ka.exports,H_;function wk(){return H_||(H_=1,function(t,e){(function(s,i){t.exports=i()})(Sk,()=>(()=>{var s={d:(M,R)=>{for(var z in R)s.o(R,z)&&!s.o(M,z)&&Object.defineProperty(M,z,{enumerable:!0,get:R[z]})},o:(M,R)=>Object.prototype.hasOwnProperty.call(M,R)},i={};function n(M){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},n(M)}s.d(i,{default:()=>bs});var r=/^((?:[a-z\d-]+\s+)*)([\d.]+(%|em|px)|(?:x+-)?large|(?:x+-)?small|medium)(?:\s*\/\s*(normal|[\d.]+(%|px|em)?))?(\s.+)?$/,o=/\bsmall-caps\b/,a=/\b(?:italic|oblique)\b/,l=/\bbold(?:er)?\b/,d=13.3333333,h={"xx-small":9,"x-small":10,smaller:13.3333,small:13,medium:16,large:18,larger:19.2,"x-large":24,"xx-large":32};function u(M){var R="",z=this;return z.style&&z.style!=="normal"&&(R+=z.style),z.variant&&z.variant!=="normal"&&(R+=(R?" ":"")+z.variant),z.weight&&z.weight!=="normal"&&(R+=(R?" ":"")+z.weight),z.size&&(R+=(R?" ":"")+z.size+"px",z.height!==z.size&&(R+="/"+z.height+"px")),z.family&&(R+=(R?" ":"")+z.family),M&&(R+="::"+z.baseline),M&&(R+="::"+z.color),R}var c={id:"",family:"sans-serif",height:14,size:12,variant:"",style:"",weight:"",baseline:"",color:null,toString:u,valueOf:u};function g(M){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=r.exec(M);R.family=(z[6]||"").trim();var D=h[z[2]]||parseFloat(z[2]);z[3]==="%"?D*=.16:z[3]==="em"?D*=16:z[3]==="pt"&&(D*=d),R.size=D;var tt=parseFloat(z[4]);if(tt!=="normal"&&tt!=="inherit"&&tt?z[5]&&z[5]!=="em"?z[5]==="pt"?R.height=tt*d:z[5]==="%"?R.height=.01*D:R.height=tt:R.height=tt*D:R.height=Math.round(D*(7/6)),o.test(z[1])&&(R.variant="small-caps"),a.test(z[1])&&(R.style="italic"),l.test(z[1]))R.weight="bold";else{var _t=parseInt(/\b(\d+)\b/.exec(z[1]),10);_t>=100&&_t!==400&&(R.weight=_t)}return R}function f(){var M,R,z,D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"12px/14px sans-serif",tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_t=14,Tt=12,At=null,Mt=null,Dt="";if(D&&D.nodeType){var qt=D&&(D.ownerDocument&&D.ownerDocument.defaultView||D.document&&D||D.defaultView),Wt=qt.getComputedStyle(D,null);M=Wt.getPropertyValue("font-family")||"",Tt=parseFloat(Wt.getPropertyValue("font-size")),_t=Wt.getPropertyValue("line-height"),At=Wt.getPropertyValue("font-weight"),Mt=Wt.getPropertyValue("font-style"),Dt=Wt.getPropertyValue("font-variant")||""}else if(typeof D=="string"){var Ut=g(D);M=Ut.family,Tt=Ut.size,_t=Ut.height,Dt=Ut.variant,Mt=Ut.style,At=Ut.weight}else n(D)==="object"&&(M=D.family,Tt=D.size,_t=D.height,Dt=D.variant,At=D.weight,Mt=D.style,R=D.baseline,z=D.color);tt.size&&tt.size<3&&(Tt*=tt.size),_t=_t!=="normal"&&_t?parseFloat(_t):Tt*(7/6),tt.height&&tt.height<3&&(_t*=tt.height);var $t=Object.create(c);return $t.family=tt.family||M||"sans-serif",$t.height=_t??14,$t.size=Tt??12,$t.variant=tt.variant||Dt||"",$t.style=tt.style||Mt||"",$t.weight=tt.weight||At||"",$t.baseline=R||0,tt.baseline!=null&&($t.baseline=tt.baseline),$t.color=tt.color||z||"",$t.id=u.call($t,!0),$t}const m={"\n":.28,"\r":.28," ":.28,"":.28,"":.28,"":0,"":.5,"":1,"":.5,"":1,"":.33,"":.25,"":.16,"":.56,"":.28,"":.2,"":.15,"":0,"":.16,"":.22,"":1,"\uFEFF":0};var _,p=function(M){var R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(100,100)||M&&M.createElement("canvas");if(R&&R.getContext){var z=R.getContext("2d");if(z&&typeof z.measureText=="function")return function(D,tt){return z.font=String(tt),z.measureText(D).width}}}(typeof document<"u"?document:null)||(_={},function(M,R){if(!_[R]){var z=f(R);_[R]=z,/\bmonospace\b/.test(z.family)?z.size*=.6:(z.size*=.45,z.weight&&(z.size*=1.18))}return M.length*_[R].size}),x={},y={trim:!0,collapse:!0};function b(M,R,z){var D=Object.assign({},y,z),tt=String(M);if(!tt)return 0;if(tt in m){var _t=R.id+"/"+tt;return _t in x||(x[_t]=p("_".concat(tt,"_"),R)-p("__",R)),x[_t]}return D.trim&&D.collapse?D.trim?tt=tt.trim():D.collapse&&(tt=tt.replace(/\s+/g," ")):tt=tt.replace(/\n/g," "),p(tt,R)+R.size*(M.tracking||0)}function v(M){return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},v(M)}function E(M,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function");M.prototype=Object.create(R&&R.prototype,{constructor:{value:M,writable:!0,configurable:!0}}),Object.defineProperty(M,"prototype",{writable:!1}),R&&A(M,R)}function A(M,R){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(z,D){return z.__proto__=D,z},A(M,R)}function S(M){var R=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var z,D=L(M);if(R){var tt=L(this).constructor;z=Reflect.construct(D,arguments,tt)}else z=D.apply(this,arguments);return w(this,z)}}function w(M,R){if(R&&(v(R)==="object"||typeof R=="function"))return R;if(R!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(z){if(z===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return z}(M)}function L(M){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(R){return R.__proto__||Object.getPrototypeOf(R)},L(M)}function T(M,R){if(!(M instanceof R))throw new TypeError("Cannot call a class as a function")}function F(M,R){for(var z=0;z<R.length;z++){var D=R[z];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(M,(tt=function(_t,Tt){if(v(_t)!=="object"||_t===null)return _t;var At=_t[Symbol.toPrimitive];if(At!==void 0){var Mt=At.call(_t,Tt);if(v(Mt)!=="object")return Mt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_t)}(D.key,"string"),v(tt)==="symbol"?tt:String(tt)),D)}var tt}function V(M,R,z){return R&&F(M.prototype,R),Object.defineProperty(M,"prototype",{writable:!1}),M}var G=function(){function M(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";T(this,M),this.value=R,this.weight=null,this.style=null,this.font=null,this.href=null,this.sub=!1,this.sup=!1}return V(M,[{key:"clone",value:function(){var R=new M(this.value);return R.value=this.value,R.weight=this.weight,R.style=this.style,R.font=this.font,R.href=this.href,R.sub=this.sub,R.sup=this.sup,R}},{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}}]),M}(),O=function(M){E(z,M);var R=S(z);function z(){return T(this,z),R.apply(this,arguments)}return V(z)}(G),j=function(M){E(z,M);var R=S(z);function z(){return T(this,z),R.apply(this,arguments)}return V(z)}(G),W=function(M){E(z,M);var R=S(z);function z(){return T(this,z),R.apply(this,arguments)}return V(z)}(G),et=/^[\n\r\t\x20\xA0\u2000-\u200B\u205F\u3000]/,at=/^[^\n\r\t\u0020\u2000-\u200B\u205F\u3000]{2,}/,mt=/^[\xA0\u2011\u202F\u2060\uFEFF]/,vt=/^(?:[;\xAD%?]|,(?!\d))/,wt=/^[$\u2212]/;function Et(M,R){R!==!1&&(M=M.trim());for(var z,D,tt=[],_t=M.charAt(0),Tt=0,At=1,Mt=M.length;At<Mt;At++){z=M.charAt(At),D=M.charAt(At+1);var Dt=et.test(_t),qt=et.test(z),Wt=qt||Dt,Ut=void 0;if((wt.test(z)&&!mt.test(_t)||vt.test(_t+D)&&!mt.test(z))&&(Wt=!0),_t!=="-"&&_t!==""&&_t!==""&&_t!==""||((Ut=et.test(M.charAt(At-2)))&&!qt&&(Wt=!1),!Ut&&at.test(z+D)&&(Wt=!0)),Wt){var $t=M.slice(Tt,At);/\u00AD$/.test($t)?(tt.push(new G($t.slice(0,-1))),tt.push(new W)):(tt.push(new G($t)),tt.push(new O)),Tt=At}_t=z}return tt.push(new G(M.slice(Tt))),tt}const yt={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:""};var St=/^[\n\r\x20\u2000-\u200B\u205F\u3000]/,zt=/^<\/([a-zA-Z0-9]+)([^>]*)>/,Zt=/^<([a-zA-Z0-9]+)((?:\s[^=\s/]+(?:\s*=\s*(?:"[^"]+"|'[^']+'|[^>\\s]+))?)+)?\s*(\/?)>(\n*)/,Kt=/^<!--(.+?)-->/,X=/&(?:#(\d\d{2,})|#x([\da-fA-F]{2,})|([a-zA-Z][a-zA-Z1-4]{1,8}));/g,Q={b:function(M){M.weight="bold"},strong:function(M){M.weight="bold"},i:function(M){M.style="italic"},em:function(M){M.style="italic"},dfn:function(M){M.style="italic"},cite:function(M){M.style="italic"},code:function(M){M.family="monospace"},kbd:function(M){M.family="monospace"},samp:function(M){M.family="monospace"},var:function(M){M.family="monospace"},tt:function(M){M.family="monospace"},sub:function(M){M.sub=!0},sup:function(M){M.sup=!0}},gt={div:1,li:1,blockquote:2,h1:2,h2:2,h3:2,h4:2,h5:2,h6:2,ul:2,ol:2,hr:2,p:2};function lt(M){return M.replace(X,function(R,z,D,tt){if(z||D){var _t=z?10:16;return String.fromCharCode(parseInt(z||D,_t))}return tt in yt?yt[tt]:R})}function st(M){return M&&M.length>1&&(M[0]==='"'&&M[M.length-1]==='"'||M[0]==="'"&&M[M.length-1]==="'")?M.slice(1,-1):M}var ot=/^\s*([^=\s&]+)(?:\s*=\s*("[^"]+"|'[^']+'|[^>\s]+))?/;function rt(M){var R,z={};if(M){do if(R=ot.exec(M)){var D=lt(st(R[2]||"")).replace(/[ \r\n\t]+/g," ").trim();if(z[R[1]]=D,(M=M.slice(R[0].length)).length&&/^\S/.test(M[0]))throw new Error("Attribute error")}while(R&&M.length);if(/\S/.test(M))throw new Error("Attribute error")}return z}const ft={copyright:"",textcopyright:"",dag:"",textdagger:"",ddag:"",textdaggerdbl:"",guillemotleft:"",guillemotright:"",guilsinglleft:"",guilsinglright:"",ldots:"",dots:"",textellipsis:"",lq:"",P:"",textparagraph:"",pounds:"",textsterling:"",quotedblbase:"",quotesinglbase:"",rq:"",S:"",sim:"~",textasciicircum:"^",textasciitilde:"",texttildelow:"~",textasteriskcentered:"*",textbackslash:"'",textbar:"|",textbardbl:"",textbigcircle:"",textbraceleft:"{",textbraceright:"}",textbullet:"",textdollar:"$",textemdash:"",textendash:"",texteuro:"",eurosym:"",euro:"",textexclamdown:"",textgreater:">",textless:"<",textordfeminine:"",textordmasculine:"",textperiodcentered:"",cdot:"",textquestiondown:"",textquotedblleft:"",textquotedblright:"",textquoteleft:"",textquoteright:"",textquotestraightbase:"",textquotestraightdblbase:"",textregistered:"",textthreequartersemdash:"-",texttrademark:"",texttwelveudash:"-",textunderscore:"_",textvisiblespace:"",gets:"",textleftarrow:"",to:"",textrightarrow:"",textdegree:"",infty:"",triangle:"",triangledown:"",blacktriangle:"",blacktriangledown:"",angle:"",sphericalangle:"",aleph:"",hbar:"",imath:"",jmath:"",ell:"",wp:"",Re:"",Im:"",mho:"",prime:"",emptyset:"",nabla:"",surd:"",partial:"",top:"",bot:"",vdash:"",dashv:"",forall:"",exists:"",nexists:"",neg:"",lnot:"",flat:"",natural:"",sharp:"",backslash:"\\",Box:"",Diamond:"",clubsuit:"",diamondsuit:"",heartsuit:"",spadesuit:"",Join:"",blacksquare:"",bigstar:"",diagdown:"",diagup:"",blacklozenge:"",rfloor:"",lfloor:"",rceil:"",lceil:"",rangle:"",langle:"",sum:"",int:"",oint:"",prod:"",coprod:"",bigcap:"",bigcup:"",bigsqcup:"",bigvee:"",bigwedge:"",bigodot:"",bigotimes:"",bigoplus:"",biguplus:"",alpha:"",beta:"",chi:"",delta:"",epsilon:"",eta:"",gamma:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",omega:"",phi:"",pi:"",psi:"",rho:"",sigma:"",tau:"",theta:"",upsilon:"",xi:"",zeta:"",Alpha:"",Beta:"",Chi:"",Delta:"",Epsilon:"",Eta:"",Gamma:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Omega:"",Phi:"",Pi:"",Psi:"",Rho:"",Sigma:"",Tau:"",Theta:"",Upsilon:"",Xi:"",Zeta:"",aa:"",AA:"",ae:"",AE:"",dh:"",DH:"",dj:"",DJ:"",ij:"",IJ:"",l:"",L:"",ng:"",NG:"",o:"",O:"",oe:"",OE:"",ss:"",SS:"SS",th:"",TH:""};var Nt=/^(\^|_|\\[^#$%&~_^\\{}()\s]+)(\{)?/,Rt=/^%[^\n]+(?:\n|$)/,Pt=/^[^#$%&~_^\\{}]+/,Vt=/^\\([&{}$%#_])/,jt=/(?:\\[\\@,!:;-]|-{2,3}|[!?]`|``?|,,|''?|~|<<|>>)/g,Xt={"---":"","--":"","!`":"","?`":"","``":"",",,":"","''":"","`":"","'":"","<<":"",">>":"","~":"","\\-":"","\\,":"","\\;":"","\\:":"","\\!":"","\\@":"\uFEFF","\\\\":"\\newline{}"},Ft={bf:function(M){M.weight="bold"},it:function(M){M.style="italic"},sl:function(M){M.style="italic"},color:function(M,R){M.color=R},href:function(M,R){M.href=R},"^":function(M){M.sup=!0},_:function(M){M.sub=!0},par:function(M){this.tokens.push(new j,new j)},newline:function(M){this.tokens.push(new j)},url:function(M,R){this.open_context().href=R,this.add_token(new G(R)),this.close_context()}};Ft.textsuperscript=Ft["^"],Ft.textsubscript=Ft._,Ft.textsl=Ft.sl,Ft.mathbf=Ft.bf,Ft.mathit=Ft.it,Ft.textbf=Ft.bf,Ft.textit=Ft.it,Ft.textcolor=Ft.color;var oe=/[\r\n\xA0]+/g;function Gt(M,R){M.sup&&(M.baseline=.45,M.size=.7),M.sub&&(M.baseline=-.3,M.size=.7);var z=R;return(M.style||M.weight||M.baseline||M.color||M.size||M.family)&&(z=f(R,M)),z}function se(M,R,z){for(var D,tt,_t=M.width;_t+z.width>R&&M.length;)tt=(D=M[M.length-1]).width,D.width>z.width?(D.value=D.value.slice(0,-1),D.width=b(D,D.font),_t+=D.width):M.pop(),_t-=tt;M[M.length-1]instanceof W&&M.pop(),D=M[M.length-1]||D||{},z.font=f(z.font,D.bold,D.italic,""),z.href=M.length?D.href:null,z.rel=M.length?D.rel:null,z.target=M.length?D.target:null,M.push(z)}function le(M){return Math.round(1e6*M)/1e6}function ze(M){return function(R){if(Array.isArray(R))return Ge(R)}(M)||function(R){if(typeof Symbol<"u"&&R[Symbol.iterator]!=null||R["@@iterator"]!=null)return Array.from(R)}(M)||function(R,z){if(R){if(typeof R=="string")return Ge(R,z);var D=Object.prototype.toString.call(R).slice(8,-1);return D==="Object"&&R.constructor&&(D=R.constructor.name),D==="Map"||D==="Set"?Array.from(R):D==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(D)?Ge(R,z):void 0}}(M)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ge(M,R){(R==null||R>M.length)&&(R=M.length);for(var z=0,D=new Array(R);z<R;z++)D[z]=M[z];return D}var $s={center:"middle",right:"end"},Ss={middle:.5,center:.5,bottom:1,end:1},ns=function(M,R){return!M&&!R||M===R};function ws(M,R){var z=[],D=R.font(),tt=D.size,_t=D.family,Tt=R.align(),At=R.createElement();if(M.length){var Mt=D.height,Dt=R.valign(),qt=R.height()(),Wt=R.width()(0),Ut=!isFinite(Wt)&&M.length===1,$t=Ut?null:R.x(),ce=le(Mt/tt),fe=Ut?null:le(Mt/(1.15*tt+(Mt-tt)/2));if(Ss[Dt]&&isFinite(qt)){var C=Dt==="bottom"?1:.5;fe+=(qt*C-Mt*M.length*C)/tt}var N=Tt==="justify",I=0;Tt==="right"?I=Wt:Tt==="center"&&(I=Wt/2);for(var P=[],U="tspan",q=null,k="",B=function(){if(k){var Lt=At(U,q,k);P.push(Lt)}U="tspan",q=null,k=""},H=0,Z=M.length;H<Z;H++){var Y="",K="",J=0,it=M[H];if(it.length){P=[];for(var $=0,dt=0,ct=void 0,ut=0,pt=it.length;ut<pt;ut++){var nt=it[ut],ht=nt.font;nt.whitespace&&$++,dt+=nt.width,ut&&!nt.tracking&&!J&&ns(ht.id,Y)&&ns(nt.class,K)&&ns(ct,nt.href)?k+=nt.value:(B(),k=nt.value,q={fontFamily:ht.family!==_t?ht.family:null,fontSize:ht.size!==tt?ht.size:null,fontWeight:ht.weight||null,fontStyle:ht.style||null,fontVariant:ht.variant!=="normal"&&ht.variant||null,fill:ht.color||null,baselineShift:ht.baseline?100*ht.baseline+"%":null,className:nt.class||null},J&&(q.dx=le(J),J=0),nt.tracking&&(J=ht.size*nt.tracking),nt.href&&!ct?(ct=nt.href,U="a",q.href=ct,q.rel=nt.rel,q.target=nt.target):ct=null,Y=ht.id,K=nt.class)}if(B(),Ut)z.push.apply(z,ze(P));else{var xt=null,bt=H===Z-1||it[it.length-1]instanceof j;N&&it.length>1&&!bt&&(xt=le((Wt-dt)/$)),z.push(At.apply(void 0,["tspan",{wordSpacing:xt,x:$t(H)+I,dy:le(H?ce:fe)+"em"}].concat(ze(P))))}}else z.push(At("tspan",{x:$t(H),dy:le(H?ce:fe)+"em"},""))}}return At.apply(void 0,["text",{fontFamily:_t,fontSize:tt,textAnchor:$s[Tt]||"start"}].concat(z))}var Xe={middle:.5,center:.5,bottom:1,end:1};function gs(M,R,z){if(M.length){z.textBaseline="middle";var D=R.font(),tt=D.height,_t=D.size,Tt=R.valign(),At=R.height()(),Mt=R.width()(0),Dt=R.align(),qt=Dt==="justify",Wt=.5*tt,Ut=Xe[Tt];if(Ut&&isFinite(At)){var $t=M.length*tt;Wt+=At*Ut-$t*Ut}M.forEach(function(ce,fe){var C=R.x()(fe),N=fe*tt+Wt,I=0,P=0;ce.forEach(function(k){k.whitespace&&I++,P+=k.width});var U=0,q=fe===M.length-1||ce[ce.length-1]instanceof j;qt&&ce.length>1&&!q&&(U=(Mt-P)/I),ce.forEach(function(k){z.font=k.font;var B=k.font,H=B.baseline?_t*-B.baseline+.15*_t:0;z.fillStyle=function(K,J){return K.color?K.color:J.href?"#00C":"#000"}(B,k);var Z=0;if(Dt==="right"?Z+=Mt-P:Dt==="center"?Z+=Mt/2-P/2:Dt==="justify"&&(k.whitespace||k instanceof j)&&(C+=U),z.fillText(k.value,C+Z,N+H),k.href){z.beginPath(),z.strokeStyle=z.fillStyle;var Y=Math.floor(N+.45*_t)+.5;z.moveTo(C+Z,Y),z.lineTo(C+Z+k.width,Y),z.stroke()}C+=k.width})})}}function rs(M){return rs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},rs(M)}function Ve(M){for(var R={},z=0;z<M.length;z++){var D=M[z];typeof D!="number"&&D!=null&&(typeof D=="string"?R.text=D:typeof D=="function"?R.fn=D:rs(D)==="object"&&D._groups?R.d3=D:D&&D.nodeType&&D.getContext?R.ctx=D.getContext("2d"):D&&D.fillText&&D.beginPath?R.ctx=D:D&&(R.text=D))}return R}function fs(M){return fs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},fs(M)}function hi(M,R){for(var z=0;z<R.length;z++){var D=R[z];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(M,(tt=function(_t,Tt){if(fs(_t)!=="object"||_t===null)return _t;var At=_t[Symbol.toPrimitive];if(At!==void 0){var Mt=At.call(_t,Tt);if(fs(Mt)!=="object")return Mt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_t)}(D.key,"string"),fs(tt)==="symbol"?tt:String(tt)),D)}var tt}var Be=f(),be=function(M){return typeof M=="function"?M:function(){return M}},ue=function(){function M(D){if(function(_t,Tt){if(!(_t instanceof Tt))throw new TypeError("Cannot call a class as a function")}(this,M),this.props={overflow:"ellipsis",lineclamp:null,align:"left",wordBreak:null,valign:"top",width:function(){return 1/0},height:function(){return 1/0},x:function(){return 0},font:null,tAnchor:0,parser:M.defaultparser},D)for(var tt in D)typeof this[tt]=="function"&&this[tt](D[tt])}var R,z;return R=M,z=[{key:"linebreak",value:function(D){var tt=this,_t=this.props.parser(String(D)),Tt=this.font(),At=function(Mt,Dt,qt){if(!Mt.length)return[];var Wt=Dt.height(),Ut=Dt.width(),$t=Dt.overflowLine(),ce=Dt.overflowWrap(),fe=f(qt,!0,!1),C=isFinite(Wt())?Math.floor(Wt()/qt.height):1/0;if(!Wt()&&!Ut(0)||!C)return[];for(var N=0,I=0,P=0,U=[],q=[],k=!1;N<Mt.length&&I<C;){var B=Mt[N],H=Gt(B,qt);if(B.width=b(B,H),B.font=H,B.line=I,B.whitespace=B.value in m,B.value&&(B.value=B.value.replace(oe," ")),!(!P&&B.whitespace||k&&B.whitespace))if(B instanceof j)P=0,q=[],U.push(N+1),I++;else if(B instanceof O||B instanceof W)q.push({index:N,width:P});else if(B.whitespace||P+B.width<Ut(I))P+=B.width;else if(q.length){var Z=void 0,Y=void 0;do{Y=!0,Z=q.pop();var K=Mt[Z.index],J=void 0;K instanceof W&&(J=b("-",K.font),Z.width+J>Ut(I)&&(Y=!q.length))}while(!Y);U.push(Z.index+1),P=0,I++,N=Z.index,q=[]}else if(ce==="break-word"){var it=Ut(I);if(P+B.width>it){var $=B.clone();do B.value=B.value.slice(0,-1),B.width=b(B,B.font),P+=B.width;while(B.value&&B.width>it);$.value=$.value.slice(B.value.length),Mt.splice(N+1,0,new O,$)}U.push(N+1),P=0,I++}else P+=B.width;N++,k=B.whitespace}N!==U[U.length-1]&&U.push(N);var dt=0,ct=0,ut=U.map(function(Lt){for(var Ct,Ot=dt;(Ct=Mt[Ot])&&(Ct.whitespace||!Ct.value);)Ot++;for(var kt=Lt,Ht=null;kt>Ot&&(Ct=Mt[kt-1])&&(Ct.whitespace||!(Ct.value||Ct instanceof W));)Ct instanceof j&&(Ht=Ct),kt--;Ct instanceof W&&(Ct.value="-",Ct.width=b("-",Ct.font)),dt=Lt;var Qt=Mt.slice(Ot,kt).filter(function(Jt){return Jt.value});return Ht&&Qt.push(Ht),Qt.width=Qt.reduce(function(Jt,ae){return Jt+ae.width},0),Qt.width>ct&&(ct=Qt.width),Qt});if(ut.hasLineOverflow=!1,$t){var pt=$t==="ellipsis"?"":$t;ut.forEach(function(Lt,Ct){var Ot=Ut(Ct);if(Lt.width>Ot){var kt=new G(pt);kt.font=qt,kt.width=b(pt,fe),se(Lt,Ot,kt),ut.hasLineOverflow=!0}})}var nt=Dt.overflow()==="ellipsis"?"":Dt.overflow();if(nt&&N!==Mt.length){var ht=Ut(ut.length-1),xt=ut[ut.length-1],bt=new G(nt);bt.font=qt,bt.width=b(nt,fe),se(xt,ht,bt),ut.hasOverflow=!0}else ut.hasOverflow=!1;return ut.font=qt,ut.width=ct,ut}(_t,this,Tt);return At.height=At.length*Tt.height,At.render=function(Mt){return tt.render(At,Mt)},At.svg=At.render,At.draw=At.render,At}},{key:"font",value:function(D){return arguments.length?(this.props.font=f(D),this):this.props.font||f(Be)}},{key:"overflow",value:function(D){return arguments.length?(this.props.overflow=String(D),this):this.props.overflow}},{key:"overflowLine",value:function(D){return arguments.length?(this.props.lineclamp=String(D),this):this.props.lineclamp}},{key:"valign",value:function(D){return arguments.length?(this.props.valign=D,this):this.props.valign}},{key:"align",value:function(D){if(!arguments.length)return this.props.align;var tt=String(D).toLowerCase();return tt==="left"||tt==="start"?(this.props.align="left",this.props.tAnchor=0):tt==="center"||tt==="middle"?(this.props.align="center",this.props.tAnchor=-.5):tt==="end"||tt==="right"?(this.props.align="right",this.props.tAnchor=-1):tt==="justify"&&(this.props.align=D,this.props.tAnchor=0),this}},{key:"overflowWrap",value:function(D){if(!arguments.length)return this.props.overflowWrap||"normal";var tt=String(D).toLowerCase();return tt==="break-word"?this.props.overflowWrap="break-word":tt!=="normal"&&D!=null||(this.props.overflowWrap=null),this}},{key:"width",value:function(D){return arguments.length?(this.props.width=be(D),this):this.props.width}},{key:"height",value:function(D){return arguments.length?(this.props.height=be(D),this):this.props.height}},{key:"x",value:function(D){return arguments.length?(this.props.x=be(D),this):this.props.x}},{key:"parser",value:function(D){if(!arguments.length)return this.props.parser;if(typeof D=="string"){var tt=M[D]||M[D+"parser"];typeof tt=="function"&&(D=tt)}if(typeof D!="function")throw new Error("Unknown parser: "+D);return this.props.parser=D,this}},{key:"createElement",value:function(D){return arguments.length?(this.props.createElement=D,this):this.props.createElement||M.createElement}},{key:"render",value:function(){var D=Ve(arguments);return typeof D.text=="string"&&(D.text=this.linebreak(D.text)),D.ctx?gs(D.text,this,D.ctx):ws(D.text,this)}}],z&&hi(R.prototype,z),Object.defineProperty(R,"prototype",{writable:!1}),M}();function ys(M){return ys=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},ys(M)}function Ts(M,R){(R==null||R>M.length)&&(R=M.length);for(var z=0,D=new Array(R);z<R;z++)D[z]=M[z];return D}function de(M,R){for(var z=0;z<R.length;z++){var D=R[z];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(M,(tt=function(_t,Tt){if(ys(_t)!=="object"||_t===null)return _t;var At=_t[Symbol.toPrimitive];if(At!==void 0){var Mt=At.call(_t,Tt);if(ys(Mt)!=="object")return Mt;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_t)}(D.key,"string"),ys(tt)==="symbol"?tt:String(tt)),D)}var tt}var Ye=function(M){return typeof M=="function"?M:function(){return M}},we=function(){function M(D){if(function(_t,Tt){if(!(_t instanceof Tt))throw new TypeError("Cannot call a class as a function")}(this,M),this.props={width:function(){return 1/0},height:function(){return 1/0},rotation:0,vAnchor:0,hAnchor:0},D)for(var tt in D)typeof this[tt]=="function"&&this[tt](D[tt]);this.render=this.render.bind(this)}var R,z;return R=M,z=[{key:"anchor",value:function(D){var tt=this.props,_t=tt.hAnchor,Tt=tt.vAnchor,At=tt.width,Mt=tt.height;if(!arguments.length)return[_t*At(0),Tt*Mt(0)];if(typeof D=="string"){var Dt=this.props;D.toLowerCase().trim().split(/\s+/).forEach(function(qt){qt==="top"&&(Dt.vAnchor=-0),qt==="middle"&&(Dt.vAnchor=-.5),qt==="bottom"&&(Dt.vAnchor=-1),qt==="left"&&(Dt.hAnchor=-0),qt==="center"&&(Dt.hAnchor=-.5),qt==="right"&&(Dt.hAnchor=-1)})}return this}},{key:"width",value:function(D){return arguments.length?(this.props.width=Ye(D),this):this.props.width}},{key:"height",value:function(D){return arguments.length?(this.props.height=Ye(D),this):this.props.height}},{key:"rotate",value:function(D){return arguments.length?(this.props.rotation=D,this):this.props.rotation}},{key:"createElement",value:function(D){return arguments.length?(this.props.createElement=D,this):this.props.createElement||M.createElement}},{key:"canvas",value:function(D,tt){var _t,Tt=D.getContext?D.getContext("2d"):D;return Tt.save(),Tt.rotate(this.rotate()*Math.PI/180),Tt.translate.apply(Tt,function(At){if(Array.isArray(At))return Ts(At)}(_t=this.anchor())||function(At){if(typeof Symbol<"u"&&At[Symbol.iterator]!=null||At["@@iterator"]!=null)return Array.from(At)}(_t)||function(At,Mt){if(At){if(typeof At=="string")return Ts(At,Mt);var Dt=Object.prototype.toString.call(At).slice(8,-1);return Dt==="Object"&&At.constructor&&(Dt=At.constructor.name),Dt==="Map"||Dt==="Set"?Array.from(At):Dt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Dt)?Ts(At,Mt):void 0}}(_t)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()),tt(Tt),Tt.restore(),Tt}},{key:"render",value:function(){var D=Ve(arguments);if(D.d3)return D.d3.attr("transform","rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")"));if(D.ctx)return this.canvas(D.ctx,D.fn);if(D.text){var tt=typeof D.text.render=="function"?D.text.render():D.text;return this.createElement()("g",{transform:"rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")")},tt)}}}],z&&de(R.prototype,z),Object.defineProperty(R,"prototype",{writable:!1}),M}(),Is=Object.prototype.hasOwnProperty,qe={};function Cs(M){return qe[M]||(qe[M]=M.replace(/([a-z])([A-Z])/g,function(R,z,D){return z+"-"+D.toLowerCase()})),qe[M]}function xs(M,R){if(Array.isArray(R))return R.forEach(function(z){return xs(M,z)});typeof R=="string"&&(R=document.createTextNode(R)),M.appendChild(R)}function te(M,R){if(typeof document<"u"){var z=typeof M=="string"?document.createElementNS("http://www.w3.org/2000/svg",M):M;if(R&&z.setAttribute)for(var D in R)Is.call(R,D)&&R[D]!=null&&z.setAttribute(D==="className"?"class":Cs(D),R[D]);for(var tt=arguments.length,_t=new Array(tt>2?tt-2:0),Tt=2;Tt<tt;Tt++)_t[Tt-2]=arguments[Tt];return _t!=null&&_t.length&&_t.forEach(function(At){xs(z,At)}),z}}ue.createElement=te,ue.textparser=Et,ue.defaultparser=Et,ue.htmlparser=function(M){M=String(M||"").trim();for(var R,z,D={weight:null,style:null,sub:!1,sup:!1,href:null,color:null,rel:null,target:null},tt=[],_t=[],Tt=function(Wt){for(var Ut in D)D[Ut]&&(Wt[Ut]=D[Ut]);tt.push(Wt)},At=function(Wt){var Ut=tt.length,$t=gt[Wt];if(Ut&&$t){for(var ce=Ut-1;tt[ce]&&(tt[ce]instanceof O||St.test(tt[ce].value));)ce--;for(;$t&&tt[ce]&&tt[ce]instanceof j;)ce--,$t--;for(;$t-- >0;)tt.push(new j)}};M.length;){if(R=/^[^<]+/.exec(M))Et(lt(R[0]),!1).forEach(Tt);else if(!(R=Kt.exec(M)))if(R=zt.exec(M))_t.length&&(D=_t.pop()),At(R[1]);else if(R=Zt.exec(M)){var Mt=R[1];At(Mt),_t.push(D),D=Object.create(D),Q[Mt]&&Q[Mt](D,"");var Dt=rt(R[2]);Mt==="a"&&(Dt.href&&(D.href=Dt.href),Dt.rel&&(D.rel=Dt.rel),Dt.target&&(D.target=Dt.target)),Dt.class&&(D.class=D.class?D.class+" "+Dt.class:Dt.class),Dt.style&&(z=/(?:^|\s|;)color\s*:\s*([^;\s"']+)/.exec(Dt.style))&&z[1]&&(D.color=z[1]),Mt==="br"&&tt.push(new j)}else R=[M.slice(0,1)],Tt(new G(R[0]));M=M.slice(R[0].length)}for(var qt=tt[tt.length-1];qt instanceof j;)tt.pop(),qt=tt[tt.length-1];return tt},ue.latexparser=function(M){M=String(M||"").trim();var R=[0];M=M.replace(/\\verb,(.*?),/,function(C,N){return R.push(N),"\\verb,"+(R.length-1)+","}).replace(/\\\\\n/g,function(){return"\\\\"}).replace(jt,function(C,N,I){return I.charAt(N-1)==="\\"?C:Xt[C]}).replace(/\n\s+/g,function(C){return/\n/.test(C.slice(1))?"\\par ":C}).replace(/\\symbol\{(\d+)\}/,function(C,N,I,P){return P.charAt(I-1)==="\\"?C:String.fromCharCode(1*N)}).replace(/(^|[^\\])(\^|_)(\d|[^{]\S*)/g,function(C,N,I,P){return N+I+"{"+P+"}"}).replace(/\\verb,(.*?),/,function(C,N){return"\\verb,".concat(R[+N],",")});for(var z,D={weight:null,italic:null,variant:null,sub:!1,sup:!1,href:null},tt=[],_t=[],Tt=function(C){for(var N in D)D[N]&&(C[N]=D[N]);return tt.push(C),C},At=function(){_t.push(D),D=Object.create(D)},Mt=function(){if(!_t.length)throw new Error("Unexpected }");D=_t.pop()},Dt={tokens:tt,open_context:At,close_context:Mt,add_token:Tt};M.length;){if(z=Pt.exec(M))Et(z[0],!1).forEach(Tt);else if(z=Vt.exec(M))Tt(new G(z[1]));else if(!(z=Rt.exec(M))){if(z=/^\{/.exec(M))At();else if(z=/^\}/.exec(M))Mt();else if(!(z=/^\$/.exec(M)))if(z=/^\\verb,([^,]+),/.exec(M))Tt(new G(z[1]));else if(z=Nt.exec(M)){var qt=z[1].slice(1)||z[1],Wt=!!z[2];if(/^(La)?TeX$/i.test(qt)){At(),D.family="serif";var Ut=void 0;qt==="LaTeX"&&((Ut=Tt(new G("L"))).tracking=-.25,(Ut=Tt(new G("A"))).size=.7,Ut.baseline=.3,Ut.tracking=-.1),(Ut=Tt(new G("T"))).tracking=-.17,(Ut=Tt(new G("E"))).baseline=-.22,Ut.tracking=-.13,Ut=Tt(new G("X")),Mt()}else if(qt in ft)Tt(new G(ft[qt])),Wt&&At();else if(qt in Ft){var $t=[],ce=Ft[qt].length-1,fe=void 0;if(ce){for(Wt=!1,M=M.slice(z[0].length-1);ce--;){if(!(fe=/^\{([^}]+)\}/.exec(M)))throw new Error(qt+" is missing an argument");$t.push(fe[1]),M=M.slice(fe[0].length)}z[0]=/^\{/.exec(M)?"{":"",Wt=!!z[0]}Wt&&At(),Ft[qt].apply(Dt,[D].concat($t))}else console.warn("unknown latex command",qt),Tt(new G(z[1])),Wt&&At()}else z=[M.slice(0,1)],Tt(new G(z[0]))}M=M.slice(z[0].length)}return tt},ue.measureText=function(M,R,z){return b(M,f(R),z)},ue.Token=G,ue.Break=O,ue.LineBreak=j,ue.SoftHyphen=W,ue.Rotator=we,we.createElement=te;const bs=ue;return i.default})())}(Ka)),Ka.exports}var Tk=wk();const W_=Cv(Tk);function ih(t){return t.replace(/$/,"")}function nh(t){return t.children[0].innerHTML}function Ik(t,e){const s=bi(t),{fontSize:i,font:n,padding:r=0}=t.properties.style||{};if(s.width===s.height&&s.width===0)return;const o=new W_({font:`${i}px/${i}px ${n}`.replace(/(px)+/g,"px"),width:s.width-r*2,height:s.height-r*2,align:"left",valign:"top",x:0,overflow:"ellipsis",parser:"html",createElement:W_.createElement});o.overflowWrap("break-word");const l=o.linebreak(t.properties.content.replaceAll(`
`,"<br>")).render(),d=[...l.children];let h=0;const u=[];t.properties.content.split(`
`).forEach(f=>{let m=f;for(;m.length&&h<d.length;){if(d[h].innerHTML==="&nbsp;"){m.startsWith(`
`)||u.push(h),h++;break}const _=ih(nh(d[h]));m.startsWith(_)&&(m=m.slice(_.length).trim()),h++}}),u.forEach(f=>l.removeChild(d[f]));const c=t.properties.content.match(/(https?:\/\/.*)/gm),g=c?c.map(f=>f.split(" ")[0]):[];l.setAttribute("transform",`translate(${r}, ${r})`),g.forEach(f=>{let m=f;const _=[];for(;m.length>0;){const p=d.find(y=>!!y.children[0]&&y.children[0].tagName==="tspan"&&m.startsWith(ih(nh(y))));if(!p)break;_.push(p);const x=ih(p.children[0].innerHTML).length;if(!x)break;m=m.slice(x)}_.forEach(p=>{const x=document.createElementNS("http://www.w3.org/2000/svg","a");x.setAttribute("href",f),x.setAttribute("target","_blank"),x.innerHTML=nh(p),p.children[0].innerHTML="",p.children[0].appendChild(x)})}),e.appendChild(l)}const X_=20;class Ck extends Nv{textArea;handleSize;rect={x:0,y:0,width:0,height:0};annotation={...sh};startX=0;startY=0;handles=[];draggedHandle=Pe;isFocused=!1;placeholder="Type your text here...";constructor(e,s={}){super(e,`
    <div class="annotation-text-handle" data-handle-id="8">
      <span class="handle line-handle top" data-handle-id="0"></span>
      <span class="handle line-handle bottom" data-handle-id="1"></span>
      <span class="handle line-handle left" data-handle-id="2"></span>
      <span class="handle line-handle right" data-handle-id="3"></span>
      <span class="handle top right point-handle top-right" data-handle-id="4"></span>
      <span class="handle left top point-handle top-left" data-handle-id="5"></span>
      <span class="handle bottom right point-handle bottom-right" data-handle-id="6"></span>
      <span class="handle left bottom left-handle point-handle bottom-left" data-handle-id="7"></span>
      <textarea wrap="on"></textarea>
    </div>
  `),this.showeditorOnHover=!1,this.handleSize=j_.handleSize,this.placeholder=j_.placeholder;const i=this.textArea=this.editor.element.querySelector("textarea");i.addEventListener("input",this._onInput),i.addEventListener("focus",this._onFocus),i.addEventListener("blur",this._onBlur),i.addEventListener("mousedown",this._onMousedown),i.spellcheck=!1,this.handles=Array.prototype.slice.call(this.editor.element.querySelectorAll(".annotation-text-handle > .handle")),this.handles.push(this.editor.element),this.handles.forEach(n=>n.addEventListener("mousedown",this.onHandleMouseDown)),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousemove",this.onMouseMove,!0),e.events.on(["viewChanged","zoom"],this.onViewChanged)}_onFocus=()=>{this.textArea.value===this.placeholder&&(this.textArea.value=""),this.isFocused=!0};_onBlur=()=>{this.isFocused=!1};_canRemove(){return!this.isFocused}startDrawing=(e,s,i=Mv(e,s,0,0,"",ir))=>{this.add(i);const n=this.ogma.view.graphToScreenCoordinates({x:e,y:s});this.select(i.id),this.startDragging(this.getById(i.id),n.x,n.y),this.draggedHandle=6};cancelDrawing=()=>{this.isDragging&&(this.remove(this.annotation.id),this.annotation={...sh},this.draggedHandle=Pe,this.isDragging=!1,this.emit(en,this.annotation))};startDragging=(e,s,i)=>{this.annotation=e;const n=pi(this.annotation),r=bi(this.annotation);this.rect.x=n.x,this.rect.y=n.y,this.rect.width=r.width,this.rect.height=r.height,this.startX=s,this.startY=i,this.disableDragging(),this.textArea.classList.add("noevents"),this.textArea.setAttribute("disabled","disabled"),this.emit(Rl,this.annotation),this.isDragging=!0};onHandleMouseDown=e=>{const s=this.getById(this.selectedId)||this.getById(this.hoveredId);if(!s)return;this.selectedId!==s.id&&this.select(this.hoveredId);const{x:i,y:n}=vu(e,this.ogma.getContainer());this.startDragging(s,i,n),this.draggedHandle=Av(e.target)};onMouseMove=e=>{requestAnimationFrame(()=>this._onMouseMove(e))};_onMouseMove=e=>{if(!this.isDragging)return;e.stopPropagation(),e.preventDefault();const s=this.handles[this.draggedHandle];let i=s.classList.contains("top");const n=s.classList.contains("left"),r=s.classList.contains("right"),o=s.classList.contains("bottom");let a=s.classList.contains("line-handle");!a&&!i&&!o&&!n&&!r&&(i=!0,a=!0);const{x:l,y:d}=vu(e,this.ogma.getContainer());let h=this.rect.x,u=this.rect.y,c=Math.max(this.rect.width,X_),g=Math.max(this.rect.height,X_);const f=this.ogma.view.getZoom(),m=(l-this.startX)/f,_=(d-this.startY)/f,p=this.ogma.view.getAngle(),x=Es({x:m,y:_},p),y=Es({x:m,y:_},-p);a?(h=this.rect.x+x.x,u=this.rect.y+x.y):n&&i?(h+=x.x,u+=x.y,c-=m,g-=_):r&&o?(c+=m,g+=_):n&&o?(h+=y.x,c-=y.x,g+=y.y):r&&i&&(u+=y.y,c+=y.x,g-=y.y),ok(this.annotation,h,u,c,g),this.emit(Pl,this.annotation,"text"),this.refreshEditor(),this.layer.refresh()};onMouseUp=()=>{!this.isDragging||this.draggedHandle===Pe||(this.restoreDragging(),this.textArea.classList.remove("noevents"),this.textArea.removeAttribute("disabled"),this.emit(en,this.annotation),this.isDragging=!1,this.draggedHandle=Pe)};_onMousedown=e=>{e.stopPropagation()};onViewChanged=()=>{const e=Math.max(2,this.handleSize/this.ogma.view.getZoom());document.documentElement.style.setProperty("--handle-scale",`${1/e}`),this.ogma.view.getAngle()===0?this.editor.element.classList.remove("rotated"):this.editor.element.classList.add("rotated")};_onInput=()=>{const e=this.getById(this.selectedId);e&&(this.textArea.value=this.textArea.value.replace(/ +(?= )/g,""),this.textArea.focus(),e.properties.content=this.textArea.value,this.emit(Tu,e),this.layer.refresh())};detect({x:e,y:s},i=0){const n={x:e,y:s},r=this.ogma.view.getAngle();return this.elements.find(o=>{const{x:a,y:l}=pi(o),{width:d,height:h}=bi(o),u={x:a,y:l},{x:c,y:g}=Es(An(n,u),-r);return c>-i&&c<d+i&&g>-i&&g<h+i})}draw(e){e.innerHTML="";const s="",i=this.ogma.view.getAngle();for(let r=0;r<this.elements.length;r++){const o=this.elements[r],a=`class${r}`,l=bi(o),d=pi(o);if(o.id===this.selectedId)continue;const{color:u,fontSize:c,font:g,strokeColor:f,strokeWidth:m,strokeType:_,background:p,borderRadius:x}=o.properties.style||ir,y=En("g");y.classList.add("annotation-text"),y.setAttribute("fill",`${u}`),y.setAttribute("font-size",`${c}px`),y.setAttribute("font-family",`${g}`);const b=En("rect");x&&(b.setAttribute("rx",`${x}`),b.setAttribute("ry",`${x}`));let v=!1;_&&_!=="none"&&(v=!0,b.setAttribute("stroke",f||"black"),b.setAttribute("stroke-width",`${m}`),_==="dashed"&&b.setAttribute("stroke-dasharray","5,5")),(p&&p.length||v)&&(v=!0,b.setAttribute("fill",p||"transparent")),v&&(b.setAttribute("width",`${l.width}`),b.setAttribute("height",`${l.height}`)),y.appendChild(b),Ik(o,y);const{x:E,y:A}=Es(d,-i);y.setAttribute("transform",`translate(${E},${A})`),y.classList.add(a),y.setAttribute("data-annotation",`${o.id}`),y.setAttribute("data-annotation-type","text"),e.appendChild(y)}const n=En("style");n.innerHTML=s,e.firstChild&&e.insertBefore(n,e.firstChild)}refreshDrawing(){const e=this.ogma.view.getAngle(),s=this.layer.element.children;for(let i=0;i<s.length;i++){const n=s[i];if(!n.hasAttribute("data-annotation"))continue;const r=n.getAttribute("data-annotation"),o=pi(this.getById(r)),{x:a,y:l}=Es(o,-e);n.setAttribute("transform",`translate(${a},${l})`)}}getDefaultOptions(){return sh}refreshEditor(){if(+this.selectedId<0&&+this.hoveredId<0)return;const e=this.getById(this.selectedId)||this.getById(this.hoveredId),s=bi(e),i=this.ogma.view.graphToScreenCoordinates(pi(e)),n=this.ogma.view.getZoom(),{font:r,fontSize:o,color:a,background:l,padding:d=0}=e.properties.style||ir,h=(o||1)*n;this.textArea.value=e.properties.content;const u=this.editor.element.style;u.transform=`translate(${i.x}px, ${i.y}px)translate(-50%, -50%)translate(${s.width/2*n}px, ${s.height/2*n}px)`,u.width=`${s.width*n}px`,u.height=`${s.height*n}px`;const c=this.textArea.style;c.font=`${h} ${r}`,c.fontFamily=r||"sans-serif",c.fontSize=`${h}px`,c.padding=`${n*d}px`,c.lineHeight=`${h}px`,c.boxSizing="border-box",c.color=a||"black",c.background=l||"transparent",this.textArea.placeholder=this.placeholder,this.layer.refresh()}select(e){super.select(e),this.textArea.classList.add("noevents")}destroy(){super.destroy(),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove,!0),this.ogma.events.off(this.onViewChanged)}}class Lk{links={};linksByTargetId={};linksByArrowId={};add(e,s,i,n,r){const o=ld(),a=e.id,l={id:o,arrow:a,target:i,targetType:n,connectionPoint:r,side:s};return this.links[o]=l,this.linksByTargetId[i]||(this.linksByTargetId[i]=[]),this.linksByTargetId[i].push(o),this.linksByArrowId[a]||(this.linksByArrowId[a]={}),this.linksByArrowId[a][s]=o,e.properties.link=e.properties.link||{},e.properties.link[s]={id:i,side:s,type:n,magnet:r},this}arrowIsLinked(e,s){return!!this.linksByArrowId[e]?.[s]}remove(e,s){const i=e.id,n=this.linksByArrowId[i]?.[s];if(delete e.properties.link?.[s],!n)return this;const r=this.links[n];delete this.links[n];const o=this.linksByTargetId[r.target];for(let a=0;a<o.length;a++)if(o[a]===n){o.splice(a,1);break}return delete this.linksByArrowId[i][s],this}getArrowLink(e,s){const i=this.linksByArrowId[e]?.[s];return i?this.links[i]:null}getTargetLinks(e,s){return this.linksByTargetId[e]?.map(i=>this.links[i]).filter(i=>i.targetType===s)??[]}forEach(e){Object.values(this.links).forEach(e)}}const Us=t=>t.properties.type==="arrow",Gi=t=>t.properties.type==="text",Y_=t=>t.type==="FeatureCollection",Nk={magnetColor:"#3e8",detectMargin:20,magnetHandleRadius:5,magnetRadius:10,textPlaceholder:"Type here",arrowHandleSize:3.5,textHandleSize:3.5,minArrowHeight:20,maxArrowHeight:30},$_=["start","end"],Z_=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:0,y:.5},{x:1,y:.5},{x:0,y:1},{x:.5,y:1},{x:1,y:1}];class Mk extends Lv{arrows;texts;links=new Lk;layer;annotations;ogma;options;selected=null;updateTimeout=0;hoveredNode=null;dragged=null;textToMagnet=void 0;activeLinks=[];constructor(e,s={}){super(),this.options=this.setOptions({...Nk,...s}),this.ogma=e,this.arrows=new Ak(e,this.options),this.texts=new Ck(e,this.options),this.annotations=[this.arrows,this.texts],this.annotations.forEach(i=>{i.on(Rl,this._onFeatureDragStart).on(Pl,this._onFeatureDrag).on(en,this._onFeatureDragEnd).on(Tu,this.onUpdate).on(Au,this._onUnselect).on(Eu,this._onSelect).on(wu,this._onAdded).on(Su,this._onRemoved)}),this.ogma.events.on("nodesDragStart",this._onNodesDragStart).on("nodesDragProgress",this._onNodesDrag).on("layoutEnd",this._onLayoutEnd).on(["viewChanged","rotate"],()=>{this.refreshTextLinks()}),this.layer=e.layers.addCanvasLayer(this._render),this.layer.moveToBottom()}_render=e=>{if(!this.dragged||this.textToMagnet===void 0)return;e.beginPath(),e.fillStyle="green";const s=this.ogma.view.getZoom();Z_.forEach(i=>{if(!this.textToMagnet)return;const n=bi(this.textToMagnet),r=pi(this.textToMagnet),o=ka(i,{x:n.width,y:n.height}),a=Es(o,this.ogma.view.getAngle()),{x:l,y:d}=Qn(a,r);e.moveTo(l,d),e.arc(l,d,this.options.magnetHandleRadius/s,0,Math.PI*2)}),e.fill(),e.closePath()};_onFeatureDrag=(e,s)=>{const i=s;if(Us(e)&&i==="line")["start","end"].find(n=>{const r=n==="start"?ro(e):Nl(e);return this._snapToText(e,i,r)||this._findAndSnapToNode(e,n,r)});else if(Us(e)&&i!=="line"){const n=i==="start"?ro(e):Nl(e);this._snapToText(e,i,n)||this._findAndSnapToNode(e,i,n)}else Gi(e)&&(this.activeLinks.forEach(({arrow:n,side:r,connectionPoint:o})=>{const a=this.getAnnotation(n),l=bi(e),d=pi(e),h=ka(o,{x:l.width,y:l.height}),u=Es(h,this.ogma.view.getAngle()),c=Qn(u,d);a.geometry.coordinates[r==="start"?0:1]=[c.x,c.y]}),this.activeLinks.length&&this.arrows.refreshLayer());this.layer.refresh(),this.emit(Pl,e,s)};_onFeatureDragEnd=e=>{this.dragged!==null&&Us(e)&&ro(this.dragged)&&$_.forEach(s=>{this.links.getArrowLink(e.id,s)&&this.emit(bk,{arrow:e,link:this.links.getArrowLink(e.id,s)})}),(Gi(e)||Us(e))&&this.onUpdate(e),this.dragged=null,this.activeLinks=[],this.textToMagnet=void 0,this.annotations.forEach(s=>s.enableDetection()),this.layer.refresh(),this.emit(en,e)};_onFeatureDragStart=e=>{this.textToMagnet=void 0,Us(e)?this.dragged=e:Gi(e)&&this.activeLinks.push(...this.links.getTargetLinks(e.id,"text")),this.annotations.forEach(s=>{const i=s.getSelectedFeature();i&&i!==e&&s.unhover().unselect(),s.disableDetection()}),this.emit(Rl,e)};_onNodesDragStart=()=>{this.arrows.unhover().unselect(),this.texts.unhover().unselect()};_onNodesDrag=e=>{const{dx:s,dy:i}=e;this._moveNodes(e.nodes,s,i)};_onLayoutEnd=e=>{e.ids.forEach((s,i)=>{this.links.getTargetLinks(s,"node").forEach(r=>{const o=this.getAnnotation(r.arrow),a=r.side,l=Da(o,a==="start"?"end":"start"),d=e.positions.current[i],h=this.ogma.getNode(s).getAttribute("radius"),u=Oa(l,d,+h);zn(o,a,u.x,u.y)})}),this.arrows.refreshLayer(),this.texts.refreshLayer()};_moveNodes(e,s,i){e.forEach(n=>{const r=this.links.getTargetLinks(n.getId(),"node"),o=n.getPosition();r.forEach(a=>{const l=this.getAnnotation(a.arrow),d=a.side,h=Da(l,d==="start"?"end":"start");let u=o;const c=+n.getAttribute("radius"),g=1e-6;(a.connectionPoint.x-(o.x-s)>g||a.connectionPoint.y-(o.y-i)>g)&&(u=Oa(h,o,c)),zn(l,d,u.x,u.y)})}),this.arrows.refreshLayer()}_snapToText(e,s,i){const n=this.texts.detect(i,this.options.detectMargin);if(this.links.remove(e,s),!n)return!1;this.textToMagnet=n;const r=this.findMagnetPoint(Z_,n,i);return r?(zn(e,s,r.point.x,r.point.y),this.links.add(e,s,n.id,"text",r.magnet),!0):!1}_findAndSnapToNode(e,s,i){const n=this.ogma.view.graphToScreenCoordinates(i),r=this.ogma.view.getElementAt(n);this.links.remove(e,s),r&&r.isNode?(this.hoveredNode?.setSelected(!1),this.hoveredNode=r,r.setSelected(!0),this._snapToNode(e,s,r,n)):(this.hoveredNode?.setSelected(!1),this.hoveredNode=null)}_snapToNode(e,s,i,n){const r=i.getPositionOnScreen(),o=+i.getAttribute("radius"),a=o*this.ogma.view.getZoom(),l=n.x-r.x,d=n.y-r.y,h=Math.sqrt(l*l+d*d),u=i.getPosition();if(h<a+this.options.detectMargin){let c=u;if(h>a/2){const g=Da(e,s==="end"?"start":"end");c=Oa(g,c,o)}zn(e,s,c.x,c.y),this.links.add(e,s,i.getId(),"node",c)}}_onAdded=e=>{this.emit(wu,e)};_onRemoved=e=>{this.emit(Su,e)};_onUnselect=e=>{this.selected=null,this.emit(Au,e)};_onSelect=e=>{this.selected!==e&&(this.selected=e,this.emit(Eu,this.selected))};refreshTextLinks(){let e=!1;this.links.forEach(({connectionPoint:s,targetType:i,target:n,arrow:r,side:o})=>{if(i!=="text")return;e=!0;const a=this.getAnnotation(n),l=this.getAnnotation(r),d=bi(a),h=pi(a),u=ka(s,{x:d.width,y:d.height}),c=Es(u,this.ogma.view.getAngle()),g=Qn(c,h);zn(l,o,g.x,g.y)}),e&&this.arrows.refreshLayer()}getSelected(){return this.selected}findMagnetPoint(e,s,i){let n;for(const r of e){const o=bi(s),a=pi(s),l=ka(r,{x:o.width,y:o.height}),d=Es(l,this.ogma.view.getAngle()),h=Qn(d,a),u=sr(An(h,i)),c=Math.min(this.options.magnetRadius*this.ogma.view.getZoom(),o.width/2,o.height/2);if(u<Math.max(c,this.options.magnetHandleRadius)){n={point:h,magnet:r};break}}return n}setOptions(e={}){return this.options={...this.options||{},...e},this.options}select(e){const s=this.getAnnotations().features.find(i=>i.id===e);return s?(Us(s)?this.arrows.select(s.id):Gi(s)&&this.texts.select(s.id),this):this}unselect(){return this.selected?(Us(this.selected)?this.arrows.unselect():Gi(this.selected)&&this.texts.unselect(),this):this}add(e){if(Y_(e)){const[s,i]=e.features.reduce((n,r)=>(Us(r)?n[1].push(r):Gi(r)&&n[0].push(r),n),[[],[]]);return s.forEach(n=>this.add(n)),i.forEach(n=>this.add(n)),this.arrows.refreshLayer(),this}switch(e.properties.type){case"text":this.texts.add(e);break;default:this.arrows.add(e),this.loadLink(e);break}return this}remove(e){return Y_(e)?(e.features.forEach(s=>this.remove(s)),this):(Us(e)?(this.links.remove(e,"start"),this.links.remove(e,"end"),this.arrows.remove(e.id)):this.texts.remove(e.id),this)}loadLink(e){if(e.properties.link)for(const s of $_){const i=e.properties.link[s];if(!i)continue;const n=this.getAnnotation(i.id);if(i.type==="text"&&n)this.links.add(e,s,i.id,i.type,i.magnet);else if(i.type==="node"){const r=this.ogma.getNode(i.id);if(!r)continue;this.links.add(e,s,i.id,i.type,i.magnet);const o=r.getPosition(),a=r.getAttribute("radius")||0,l=Da(e,s==="start"?"end":"start"),d=Oa(l,o,+a);zn(e,s,d.x,d.y)}}}startArrow(e,s,i){this.cancelDrawing(),this.arrows.startDrawing(e,s,i)}startText(e,s,i){this.cancelDrawing(),this.texts.startDrawing(e,s,i)}cancelDrawing(){this.annotations.forEach(e=>e.cancelDrawing()),this.emit(xk)}onUpdate=e=>{cancelAnimationFrame(this.updateTimeout),this.updateTimeout=requestAnimationFrame(()=>this._onUpdate(e))};_onUpdate=e=>{this.emit(Tu,e)};updateStyle(e,s){const i=this.getAnnotations().features.find(n=>n.id===e);return i?(Us(i)?this.arrows.updateStyle(i,s):Gi(i)&&this.texts.updateStyle(i,s),this.onUpdate(i),this):this}setScale(e,s,i,n){const r=this.getAnnotations().features.find(o=>o.id===e);return r?(Us(r)?this.arrows.scale(r,s,i,n):Gi(r)&&this.texts.scale(r,s,i,n),this.onUpdate(r),this):this}getAnnotations(){const e={type:"FeatureCollection",features:[]};return this.annotations.forEach(s=>{e.features=[...e.features,...s.getElements()]}),e}getAnnotation(e){return this.getAnnotations().features.find(s=>s.id===e)}destroy(){this.annotations.forEach(e=>e.destroy()),this.layer.destroy()}}const li=new ik({container:"app"}),sn=new Mk(li);window.ogma=li;li.styles.addRule({nodeAttributes:{color:"#5B97F8"},edgeAttributes:{color:"#c9c9c9"}});const Pk=await fetch("annotations.json").then(t=>t.json()),Wc=await li.generate.flower({depth:3}),K_=Wc.nodes.reduce((t,e,s)=>(t[e.id]=e,e.id=`n${s}`,t),{});Wc.edges.forEach(t=>{t.source=K_[t.source].id,t.target=K_[t.target].id});await li.setGraph(Wc);await li.layouts.force({locate:!0});sn.add(Pk);window.control=sn;window.createArrow=Hc;const za=document.getElementById("add-arrow");za.addEventListener("click",()=>{za.disabled||(za.disabled=!0,li.events.once("mousedown",t=>{const{x:e,y:s}=li.view.screenToGraphCoordinates(t),i=Hc(e,s,e,s,{strokeType:"plain",strokeColor:"#3A03CF",strokeWidth:2,head:"arrow"});sn.startArrow(e,s,i),sn.once(en,n=>{n.id===i.id&&(za.disabled=!1)})}))});const Ba=document.getElementById("add-text");Ba.addEventListener("click",()=>{Ba.disabled||(Ba.disabled=!0,li.events.once("mousedown",t=>{const{x:e,y:s}=li.view.screenToGraphCoordinates(t),i=Mv(e,s,0,0,void 0,{font:"IBM Plex Sans",fontSize:24,color:"#3A03CF",background:"#EDE6FF",borderRadius:8,padding:12});sn.startText(e,s,i),sn.once(en,n=>{n.id===i.id&&(Ba.disabled=!1)})}))});document.addEventListener("keydown",t=>{t.key==="Escape"&&sn.cancelDrawing()});sn.on("cancelDrawing",()=>{console.log("cancelDrawing")});
