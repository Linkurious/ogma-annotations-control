var r0=Object.defineProperty;var o0=(t,e,s)=>e in t?r0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var a0=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Lt=(t,e,s)=>(o0(t,typeof e!="symbol"?e+"":e,s),s);var GF=a0((XF,Er)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();var l0=Object.create,Ha=Object.defineProperty,d0=Object.defineProperties,h0=Object.getOwnPropertyDescriptor,u0=Object.getOwnPropertyDescriptors,J_=Object.getOwnPropertyNames,Du=Object.getOwnPropertySymbols,c0=Object.getPrototypeOf,tm=Object.prototype.hasOwnProperty,g0=Object.prototype.propertyIsEnumerable,ku=(t,e,s)=>e in t?Ha(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ct=(t,e)=>{for(var s in e||(e={}))tm.call(e,s)&&ku(t,s,e[s]);if(Du)for(var s of Du(e))g0.call(e,s)&&ku(t,s,e[s]);return t},Wt=(t,e)=>d0(t,u0(e)),em=(t,e)=>function(){return e||(0,t[J_(t)[0]])((e={exports:{}}).exports,e),e.exports},to=(t,e)=>{for(var s in e)Ha(t,s,{get:e[s],enumerable:!0})},_0=(t,e,s,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of J_(e))tm.call(t,n)||n===s||Ha(t,n,{get:()=>e[n],enumerable:!(i=h0(e,n))||i.enumerable});return t},Sh=(t,e,s)=>(s=t!=null?l0(c0(t)):{},_0(!e&&t&&t.__esModule?s:Ha(s,"default",{value:t,enumerable:!0}),t)),sm=em({"node_modules/@linkurious/ogma-parsers/dist/ogma-parsers.umd.js"(t,e){var s,i;s=t,i=function(n){/**
* Ogma Parsers
* @description Parsers for Ogma
* @version 0.0.20 (built on Fri Jan 12 2024 15:00:46 GMT+0000 (Coordinated Universal Time))
* @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
* @license (c) Linkurious 2024. All rights reserved.
* @preserve
*/function r(q,et,dt){dt=dt||et,et in q&&(q.attributes[dt]=q[et])}function o(q,et,dt){if(q&&typeof q=="object"){if(Array.isArray(q))return q.forEach(ot=>o(ot,et,dt));if(function(nt){return nt.type==="vertex"||nt._type==="vertex"||nt.inE||nt.outE||nt._inE||nt._outE}(q)){const ot={};q.properties&&Object.keys(q.properties).forEach(it=>{ot[it]=q.properties[it][0].value});const nt=l(q);et.push({id:nt,data:{id:q.id+"",categories:[q.label],properties:ot}});for(const it in q)it!=="properties"&&o(q[it],et,dt);return}if(function(nt){return nt.type==="edge"||nt._type==="edge"||nt.inV||nt.outV||nt._outV||nt._inV}(q)){const ot=l(q);dt.push({id:ot,source:a(q,["inV","_inV"]),target:a(q,["outV","_outV"]),data:{id:ot,type:q.label,properties:q.properties||{}}});for(const nt in q)nt!=="properties"&&o(q[nt],et,dt);return}Object.keys(q).forEach(ot=>o(q[ot],et,dt))}}function a(q,et){for(const dt of et)if(q[dt])return l(q[dt])}function l(q){if(typeof q=="string"||isFinite(q))return String(q);const et=q;return String(et.id||et._id)}const d=q=>q.charCodeAt(0),h=d(" "),u=d("<"),c=d(">"),g=d('"'),_=d(`
`),m=d("\r"),f=d("/"),p=d("\\"),y=d("a"),b=d("z"),x=d("A"),v=d("Z"),E=d("0"),w=d("9"),A=d(":"),I=-1,M=-2,k=-3,W=-4;function H(q,et,dt,ot){const nt=ot.length;if(dt-et!==nt)return!1;for(let it=0;it<nt;++it)if(q[et+it]!==ot[it])return!1;return!0}function $(q,et,dt,ot){return P(q.tags,et,dt,ot)}function P(q,et,dt,ot){const nt=q.length;for(let it=0;it<nt;++it)if(H(et,dt,ot,q[it]))return it;return q.push(et.slice(dt,ot)),nt}function S(q,et,dt){let ot=st(et,dt),nt=et[ot];if(nt===c||nt===f)return ot;let it=ot;ot=Tt(et,ot);const wt=function(Et,Ht,Gt,pe){return P(Et.attributes,Ht,Gt,pe)}(q,et,it,ot);for(;et[ot]!==g;)++ot;for(++ot,it=ot;(nt=et[ot])!==g;)nt===p&&++ot,++ot;return q.tokens.push(k,wt,it,ot),ot+1}function Y(q){return q===h||q===_||q===m}function st(q,et){for(;Y(q[et]);)++et;return et}function at(q){return q>=y&&q<=b||q>=x&&q<=v||q===A||q>=E&&q<=w}function Tt(q,et){for(;at(q[et]);)++et;return et}function ut(q,et){const dt=["return {","  id: undefined,","  attributes: {","    text: undefined,","    color: undefined,",`    ${q?"radius":"width"}: undefined`,q?"  ,x: undefined":"",q?"  ,y: undefined":"","  },"];q||dt.push("  source: undefined,","  target: undefined,");const ot=Object.keys(et);ot.length&&dt.push("  data: {");for(let nt=0;nt<ot.length;++nt){const it=et[ot[nt]],wt=it.title;dt.push(`  "${wt}": ${it.default!==void 0?JSON.stringify(it.default):void 0}${nt===ot.length-1?"":","}`)}return ot.length&&dt.push("}"),dt.push("};"),new Function(dt.join(`
`))}function Mt(q){return q.indexOf("\\")===-1||(q=q.replace(/\\"/g,'"')),q}function Nt(q,et){let dt=0;for(let ot=0;ot<20;++ot){const nt=dt+q[ot]+et[ot];dt=+(nt>=10),q[ot]=nt%10}}const _t=new class{constructor(){this._decimalPowerOfTwo=new Uint8Array(20),this._binaryNumber=new Uint8Array(64),this._decimalNumber=new Uint8Array(20)}int64ToString({low:et,high:dt}){if(et===0&&dt===0)return"0";(function(At,Et,Ht){for(let Gt=0;Gt<32;++Gt)Ht[Gt]=+!!(At&1<<Gt);for(let Gt=0;Gt<32;++Gt)Ht[Gt+32]=+!!(Et&1<<Gt);return Ht})(et,dt,this._binaryNumber),this._decimalNumber.fill(0),this._decimalPowerOfTwo.fill(0),this._decimalPowerOfTwo[0]=1;const ot=this._binaryNumber[63]===1;ot&&function(At){for(let Et=0;Et<64;++Et)At[Et]^=1;for(let Et=0;Et<64&&!(At[Et]^=1);++Et);}(this._binaryNumber);for(let wt=0;wt<64;++wt)this._binaryNumber[wt]&&Nt(this._decimalNumber,this._decimalPowerOfTwo),Nt(this._decimalPowerOfTwo,this._decimalPowerOfTwo);const nt=[];let it=this._decimalNumber.length-1;for(ot&&nt.push("-");!this._decimalNumber[it];)it-=1;for(let wt=it;wt>=0;--wt)nt.push(String(this._decimalNumber[wt]));return nt.join("")}};function St(q){return _t.int64ToString(q)}function Zt(q){return typeof q=="object"&&"high"in q&&"low"in q}const Qt=q=>"start"in q&&"end"in q&&"type"in q,Kt=q=>"segments"in q;function mt(q,et,dt,ot){if(et)if(Array.isArray(et))et.forEach(nt=>mt(q,nt,dt,ot));else if(Kt(et))(function(it,wt,At,Et){wt.segments.forEach(Ht=>{mt(it,Ht.start,At,Et),mt(it,Ht.end,At,Et),mt(it,Ht.relationship,At,Et)})})(q,et,dt,ot);else if(function(it){if(typeof it!="object"||it===null)throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. Please make sure that your Cypher query returns nodes and edges, not values.");const wt=Object.keys(it.properties);for(const At of wt){const Et=it.properties[At];Zt(Et)&&(it.properties[At]=St(Et))}if(it.identity!==void 0){if(Zt(it.identity)&&(it.identity=St(it.identity)),function(Et){return"start"in Et&&"end"in Et}(it)){const At=it.start.identity||it.start,Et=it.end.identity||it.end;Zt(At)&&(it.start=St(At)),Zt(Et)&&(it.end=St(Et))}}else it.id&&(it.identity=it.id)}(et),Qt(et))ot.has(et.identity)||(ot.add(et.identity),q.edges.push({id:et.identity,source:et.start,target:et.end,data:{neo4jType:et.type,neo4jProperties:et.properties}}));else{const nt=et;dt.has(nt.identity)||(dt.add(nt.identity),q.nodes.push({id:nt.identity,attributes:{},data:{neo4jLabels:nt.labels,neo4jProperties:nt.properties}}))}}const pt={boolean:q=>q.toLowerCase()==="true",int:parseFloat,long:parseFloat,float:parseFloat,double:parseFloat,string:q=>q};function ue(q,et,dt){const ot=q.getElementsByTagName("data"),nt={};for(let it=0;it<ot.length;it++){const wt=ot[it],At=wt.getAttribute("key");if(At===null)continue;const Et=et[At];typeof Et>"u"?nt[At]=wt.textContent:wt.textContent&&wt.textContent.length!==0&&(nt[Et.name]=Et.parse(wt.textContent))}for(const it in dt)it in nt||(nt[it]=dt[it]);return nt}function Jt(q){return q.color?q.color:q.r&&q.g&&q.b?`rgb(${q.r}, ${q.g}, ${q.b})`:void 0}const ce=new Set(["x","y","size","color","r","g","b","label"]);function oe(q){const et={};for(const dt in q)ce.has(dt)||q[dt]===void 0||(et[dt]=q[dt]);return et}n.gexf=function(et){if(et.indexOf("<gexf")===-1)throw new Error("not a GEXF file");const dt=function(O){const U=new Int32Array(O.length);for(let Z=0,J=O.length;Z<J;++Z)U[Z]=O.charCodeAt(Z);return U}(et),ot=function(O,U){let Z,J;const rt={tags:[],attributes:[],tokens:[]},K=rt.tokens;let tt=st(O,U);for(;tt<O.length;){let gt=O[tt];if(gt===u){if(tt=st(O,++tt),O[tt]===f)for(K.push(M);O[++tt]!==c;);else{Z=tt,tt=Tt(O,Z);const bt=$(rt,O,Z,tt);for(K.push(I,bt),gt=O[tt];gt!==c&&gt!==f;)tt=S(rt,O,tt),gt=O[tt];if(gt===f)for(K.push(M);O[++tt]!==c;);}tt+=1}else{for(Z=tt;O[++tt]!==u;);for(J=tt-1;Y(O[J]);)--J;K.push(W,Z,J+1)}tt=st(O,tt)}return rt}(dt,et.indexOf("<gexf ")),nt={},it={};ot.tags.forEach((j,O)=>{const U=String.fromCharCode.apply(null,j);nt[U]=O}),ot.attributes.forEach((j,O)=>{const U=String.fromCharCode.apply(null,j);it[U]=O});const wt=nt.attributes,At=nt.attribute,Et=nt.node,Ht=nt.edge,Gt=nt.default,pe=nt["viz:position"],ge=nt["viz:size"],_e=nt["viz:color"],be=nt.attvalue,Ce=it.class,$t=it.id,re=it.type,ve=it.title,fe=it.label,ee=it.source,we=it.target,ye=it.x,Pe=it.y,ps=it.r,te=it.g,se=it.b,ie=it.a,Me=it.value,Ne=it.for,$e=it.weight,as={float:1,double:1,integer:2,boolean:3,string:4,"list-string":5};let De=0;const qe=ot.tokens,gs=qe.length,Us=new Array(16);let me=0,He=0,Ye=0,C=!0;const D={},G={};let R,Q,xt="",Ft="",It="",Ct={attributes:{}},Ot=0,jt=0,Xt=0,Ut=1,Vt="",T=!1,F=!0,L=null,N=null;const z=[],V=[];let B=0,X={};for(;De<gs;){const j=qe[De];if(j===I)He=me,me=qe[De+1],Us[Ye]=me,Ye+=1,me===Et?(L||(L=ut(!0,D)),Ct=L(),F=!0,X=D):me===Ht&&(N||(N=ut(!1,G)),Ct=N(),F=!1,X=G),De+=2;else if(j===M){if(xt&&me===At){X=C?D:G;const O=as[Ft];let U=R;U&&(O===1?U=+U:O===2?U=0|+U:O===3?U=U==="true":O===5&&(U=U.split(" ").filter(Z=>Z))),X[xt]={title:It||xt,default:U,type:O},xt="",It="",Ft="",R=void 0}else if(me===Et&&Ye===4)T&&Ct.attributes&&(Ct.attributes.color=`rgba(${Ot}, ${jt}, ${Xt}, ${Ut})`,Ot=0,jt=0,Xt=0,Ut=1,T=!1),Ct.id||(Ct.id=++B),z.push(Ct);else if(me===Ht&&Ye===4)Ct.id||(Ct.id=++B),V.push(Ct);else if(me===be&&Ye===6&&Vt){const O=(F?D:G)[Vt];if(O){if(Q===void 0)Q=O.default;else{const U=O.type;U&&(U===1?Q=+Q:U===2?Q=0|+Q:U===3?Q=Q==="true":U===5?Q=Q.split(" ").filter(Z=>Z).map(Z=>Mt(Z)):typeof dt=="string"&&(Q=Mt(Q)))}Ct.data[X[Vt].title]=Q}Vt="",Q=null}Ye-=1,me=He,He=Us[Ye-2],De+=1}else if(j===k){const O=qe[De+1],U=et.substring(qe[De+2],qe[De+3]);if(me===wt)O===Ce&&(C=U!=="edge"&&U!=="edges");else if(me===At)O===$t?xt=U:O===re?Ft=U:O===ve&&(It=U);else if(me!==Et&&me!==Ht||Ye!==4)if(me===pe&&Ye===5){if(O===ye)Ct.attributes.x=parseFloat(U);else if(O===Pe){const Z=parseFloat(U);Ct.attributes.y=Z===0?Z:-Z}}else me===_e&&Ye===5?(T=!0,O===ps?Ot=parseInt(U):O===te?jt=parseInt(U):O===se?Xt=parseInt(U):O===ie&&(Ut=parseFloat(U))):me===ge&&Ye===5?O===Me&&(F?Ct.attributes.radius=+U:Ct.attributes.width=+U):me===be&&Ye===6&&(O===Ne||O===$t?Vt=U:O===Me&&(Q=U));else O===$t?Ct.id=U:O===fe?Ct.attributes.text=U:O===ee?Ct.source=U:O===we?Ct.target=U:O===$e&&(Ct.attributes.width=+U);De+=4}else{if(j!==W)throw new Error(`at index ${De}: token ${j}`);{const O=et.substring(qe[De+1],qe[De+2]);me===Gt&&(R=O),De+=3}}}return{nodes:z,edges:V}},n.graphml=function(et,dt){if(!dt){if(typeof DOMParser>"u")throw new Error("DOMParser is not available. You need to provide a DOMParser instance as second argument, if you are not in the browser environment");dt=new DOMParser}const ot=dt.parseFromString(et,"application/xml"),nt=ot.getElementsByTagName("key"),it=ot.getElementsByTagName("node"),wt=ot.getElementsByTagName("edge"),{definitions:At,defaults:Et}=function(_e){const be={graph:{},node:{},edge:{}},Ce={graph:{},node:{},edge:{}};for(let $t=0;$t<_e.length;$t++){const re=_e[$t],ve=re.getAttribute("for")||"node",fe=re.getAttribute("id"),ee=re.getAttribute("attr.name"),we=re.getAttribute("attr.type")||"string",ye=re.getElementsByTagName("default"),Pe=ye.length!==0?ye[0].textContent:void 0;be[ve][fe]={name:ee,parse:pt[we]},typeof Pe<"u"&&(Ce[ve][ee]=Pe)}return{definitions:be,defaults:Ce}}(nt),Ht=[],Gt=new Set;for(let ge=0;ge<it.length;ge++){const _e=it[ge],be=_e.getAttribute("id"),Ce=_e.getAttribute("href")||void 0,$t=ue(_e,At.node,Et.node);Gt.add(be);const re={id:be,attributes:{x:$t.x,y:$t.y,radius:$t.size,color:Jt($t),text:$t.label},data:oe($t)};$t.x!==void 0&&(re.attributes.x=$t.x),$t.y!==void 0&&(re.attributes.y=$t.y),$t.size!==void 0&&(re.attributes.radius=$t.size),$t.label!==void 0&&(re.attributes.text=$t.label);const ve=Jt($t);ve!==void 0&&(re.attributes.color=ve),Ce!==void 0&&(re.data.href=Ce),Ht.push(re)}const pe=[];for(let ge=0;ge<wt.length;ge++){const _e=wt[ge],be=_e.getAttribute("id")||ge,Ce=_e.getAttribute("source"),$t=_e.getAttribute("target"),re=_e.getAttribute("xlink:href")||void 0;if(!Gt.has(Ce)||!Gt.has($t))throw new Error(`Invalid edge: ${Ce} -> ${$t}`);const ve=ue(_e,At.edge,Et.edge),fe={id:be,source:Ce,target:$t,attributes:{},data:oe(ve)},ee=Jt(ve);ee!==void 0&&(fe.attributes.color=ee),re!==void 0&&(fe.data.href=re),pe.push(fe)}return{nodes:Ht,edges:pe}},n.janus=function(et){const dt=[],ot=[];return o(typeof et=="string"?JSON.parse(et):et,dt,ot),{nodes:dt,edges:ot}},n.json=function(et,dt=ot=>ot){const ot=dt(JSON.parse(et)),nt=ot.nodes||[],it=ot.edges||[];for(let wt=0;wt<nt.length;wt++){const At=nt[wt];At.attributes||(At.attributes={}),typeof At.size=="string"&&(At.size=+At.size),typeof At.x=="string"&&(At.x=+At.x),typeof At.y=="string"&&(At.y=+At.y),r(At,"x"),r(At,"y"),r(At,"size","radius"),r(At,"color"),r(At,"text")}for(let wt=0;wt<it.length;wt++){const At=it[wt];At.attributes||(At.attributes={}),typeof At.size=="string"&&(At.size=+At.size),r(At,"size","width"),r(At,"color"),r(At,"text")}return{nodes:nt,edges:it}},n.mtx=q=>{const et=q.split(`
`).filter(nt=>!nt.startsWith("%")),[dt]=et[0].split(" ").map(Number),ot=et.slice(1).map(nt=>nt.split(" ").slice(0,2).map(Number)).filter(nt=>nt.length===2);return{nodes:Array.from({length:Number(dt)},(nt,it)=>({id:it})),edges:ot.map(([nt,it])=>({source:nt%dt,target:it%dt}))}},n.neo4j=function(et){let dt=typeof et=="string"?JSON.parse(et):et;const ot={nodes:[],edges:[]},nt=new Set,it=new Set;return(wt=>"queryKeys"in wt&&"values"in wt)(dt)&&(dt=function(At){const Et=[];return At.values.forEach(Ht=>{const{nodes:Gt=[],relationships:pe=[],segments:ge=[]}=Ht.adapted,_e=[{segments:ge,properties:{}}];Et.push({_fields:[...Gt,...pe,..._e]})}),{records:Et}}(dt)),dt.records.forEach(({_fields:wt})=>wt.forEach(At=>mt(ot,At,nt,it))),ot},Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})},typeof t=="object"&&typeof e<"u"?i(t):typeof define=="function"&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaParsers={})}}),m0=em({"node_modules/@linkurious/ogma-generators/dist/ogma-generators.umd.js"(t,e){var s,i;s=t,i=function(n){/**
* Ogma Generators
* @description Graphs Generators for Ogma
* @version 0.0.13 (built on Tue Nov 14 2023 10:49:46 GMT+0000 (Coordinated Universal Time))
* @author Alexander Milevski - Leo Nicolle - Sylvain Milan - Marco Liberati
* @license (c) Linkurious 2023. All rights reserved.
* @preserve
*/const r=Object.freeze(Object.defineProperty({__proto__:null,configure:({nodes:E=10,edges:w=10,texts:A=!1,scale:I=100}={})=>({nodes:E,edges:w,texts:A,scale:I}),generate:function({nodes:w,scale:A,texts:I,edges:M}){const k=[],W=[];for(let H=0;H<w;H++)k.push({id:H,attributes:{x:Math.random()*A,y:Math.random()*A,text:I?`Node ${H}`:void 0}});for(let H=0;H<M;H++)W.push({id:H,source:Math.random()*w|0,target:Math.random()*w|0,attributes:{text:I?`Edge ${H}`:void 0}});return{nodes:k,edges:W}}},Symbol.toStringTag,{value:"Module"})),o=Object.freeze(Object.defineProperty({__proto__:null,configure:({rows:E=4,columns:w=4,columnDistance:A=20,rowDistance:I=20,xmin:M=0,ymin:k=0}={})=>({rows:E,columns:w,columnDistance:A,rowDistance:I,xmin:M,ymin:k}),generate:function({rows:w,columns:A,columnDistance:I,rowDistance:M,xmin:k,ymin:W}){const H={nodes:[],edges:[]};let $=0;for(let P=0;P<w;++P)for(let S=0;S<A;++S){const Y=P*A+S;H.nodes.push({id:Y,attributes:{x:k+S*I,y:W+P*M}}),S!==A-1&&(H.edges.push({id:$,source:Y,target:P*A+S+1}),$++),P!==w-1&&(H.edges.push({id:$,source:Y,target:(P+1)*A+S}),$++)}return H}},Symbol.toStringTag,{value:"Module"})),a=Object.freeze(Object.defineProperty({__proto__:null,configure:({length:E=5,scale:w=100}={})=>({length:E,scale:w}),generate:function({length:w,scale:A}){const I={nodes:[],edges:[]};if(w<=0)return I;I.nodes.push({id:0,attributes:{x:Math.random()*A,y:Math.random()*A}});for(let M=1;M<w;++M)I.nodes.push({id:M,attributes:{x:Math.random()*A,y:Math.random()*A}}),I.edges.push({id:M-1,source:M-1,target:M});return I}},Symbol.toStringTag,{value:"Module"}));function l(E){return typeof E=="number"&&isFinite(E)?E:void 0}const d=Object.freeze(Object.defineProperty({__proto__:null,configure:function({children:w=2,height:A=3}={}){if(!function(M){return typeof M=="number"&&isFinite(M)&&M>0?M:void 0}(w))throw new TypeError('Invalid argument: "children" is not a positive number, was '+w);if(!function(M){return typeof M=="number"&&isFinite(M)&&M>=0?M:void 0}(A))throw new TypeError('Invalid argument: "height" is not a positive number, was '+A);return{children:w,height:A}},generate:function({children:w,height:A}){A+=1;const I=Math.pow(w,A),M=[],k=[];let W=1,H=0,$=0;for(let P=0;P<A;++P){const S=I/(W+1)/1.5;for(let Y=0;Y<W;++Y){const st=H++;if(M.push({id:st,attributes:{x:(Y+1)*S*10,y:20*P}}),P!==A-1)for(let at=0;at<w;++at)k.push({id:$,source:st,target:st*w+at+1}),$+=1}W*=w}return{nodes:M,edges:k}}},Symbol.toStringTag,{value:"Module"})),h=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:w=20,edges:A,p:I,scale:M=100}={}){if(!l(w)||w<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+w);if(A!==void 0&&I!==void 0)throw new TypeError("Invalid argument: choose between options.edges and options.p");return A===void 0&&I===void 0&&(I=.1),I===void 0&&(I=-1),A===void 0&&(A=-1),{nodes:w,p:I,edges:A,scale:M}},generate:function(w){const A={nodes:[],edges:[]},I=w.nodes,M=w.p,k=w.scale;if(M>=0){let W=0;for(let H=0;H<I;H++){A.nodes.push({id:H,attributes:{x:Math.random()*k,y:Math.random()*k}});for(let $=0;$<H;$++)Math.random()<M&&A.edges.push({id:W++,source:H,target:$})}}else{const W=[],H=w.edges;for(let P=0;P<I;P++){A.nodes.push({id:P,attributes:{x:100*Math.random(),y:100*Math.random()}});for(let S=P+1;S<I;S++)W.push({source:P,target:S})}let $=W.length-1;for(let P=0;P<H;P++){const S=W.splice(Math.floor(Math.random()*$),1)[0];S.id=P,A.edges.push(S),$--}}return A}},Symbol.toStringTag,{value:"Module"})),u=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:w=40,m0:A=5,m:I=1,scale:M=100}={}){if(!l(w)||w<3)throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+w);if(!l(A)||A>=w)throw new TypeError(`Invalid argument: options.m0 is not a number < ${w}, was ${A}`);if(!l(A)||I>=A)throw new TypeError(`Invalid argument: options.m is not a number <= ${A}, was ${I}`);if(!l(M)||M<0)throw new TypeError("Invalid argument: options.scale is not a number or is less than 0");return{nodes:w,m0:A,m:I,scale:M}},generate:function({scale:w,nodes:A,m0:I,m:M}){const k={nodes:[],edges:[]},W={},H=[],$=w/10;let P=0;for(let S=0;S<I;S++)k.nodes.push({id:S,attributes:{x:Math.random()*$,y:Math.random()*$}}),H[S]=0;for(let S=0;S<I;S++)for(let Y=S+1;Y<I;Y++){const st={id:P++,source:S,target:Y};W[st.source+"-"+st.target]=st,k.edges.push(st),H[S]++,H[Y]++}for(let S=I;S<A;S++){k.nodes.push({id:S,attributes:{x:Math.random()*w,y:Math.random()*w}}),H[S]=0;let Y=0;for(let at=0;at<S;at++)Y+=H[at];let st=0;for(let at=0;at<M;at++){const Tt=Math.random();let ut=0;for(let Mt=0;Mt<S;Mt++)if(!W[`${S}-${Mt}`]&&!W[`${Mt}-${S}`]&&(ut=S===1?1:ut+H[Mt]/Y+st/(S-at),Tt<=ut)){st+=H[Mt]/Y;const Nt={id:P++,source:S,target:Mt};W[`${Nt.source}-${Nt.target}`]=Nt,k.edges.push(Nt),H[S]++,H[Mt]++;break}}}return k}},Symbol.toStringTag,{value:"Module"})),c=Object.freeze(Object.defineProperty({__proto__:null,configure:function({nodes:w=50,width:A=100,height:I=100,x:M=0,y:k=0}={}){if(!isFinite(w)||w<1)throw new RangeError("Tree generator: number of nodes must be a positive integer");return{nodes:w,width:A,height:I,x:M,y:k}},generate:function({nodes:w,x:A,y:I,width:M,height:k}){const W=A-M/2,H=I-k/2;return{nodes:new Array(w).fill(0).map(($,P)=>({id:P,attributes:{x:W+Math.random()*M,y:H+Math.random()*k}})),edges:new Array(w-1).fill(0).map(($,P)=>({id:P,source:Math.floor(Math.sqrt(P)),target:P+1}))}}},Symbol.toStringTag,{value:"Module"})),g=5,_=10,m=10,f=2.7,p=.2;function y(E){return Math.pow(f,E)*_}function b(E){return g+y(E)/m}function x(E,w,A,I,M){if(A===0)return M;const k=y(A),W=b(A),H=W*p;let $=-Math.PI;const P=2*Math.PI/w,S=I.attributes.x||0,Y=I.attributes.y||0;for(let st=0;st<w;++st){const at={id:M,attributes:{x:S+k*Math.cos($),y:Y+k*Math.sin($),radius:W}},Tt={id:M,source:I.id,target:M,attributes:{width:H}};E.nodes.push(at),E.edges.push(Tt),M=x(E,w,A-1,at,M+1),$+=P}return M}const v=Object.freeze(Object.defineProperty({__proto__:null,configure:function({depth:w=3,breadth:A=3,nodes:I}){return I!==void 0?(A=5,w=Math.ceil(Math.log(I)/Math.log(5))):I=-1,{depth:w,breadth:A,nodes:I}},generate:function({depth:w,breadth:A,nodes:I}){const M={id:0,attributes:{x:0,y:0,radius:b(w+1)}},k={nodes:[M],edges:[]};return x(k,A,w,M,1),I!==void 0&&I>=0&&(k.nodes=k.nodes.slice(0,I),k.edges=k.edges.slice(0,Math.max(I-1,0))),k}},Symbol.toStringTag,{value:"Module"}));n.balancedTree=d,n.barabasiAlbert=u,n.erdosRenyi=h,n.flower=v,n.grid=o,n.path=a,n.random=r,n.randomTree=c,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})},typeof t=="object"&&typeof e<"u"?i(t):typeof define=="function"&&define.amd?define(["exports"],i):i((s=typeof globalThis<"u"?globalThis:s||self).ogmaGenerators={})}}),xe=class{constructor(t){this._ogma=t}},dd={};function im(t,e,s,i,n,r){let o=0;for(let a=0;a<i;a++)for(let l=0;l<i;l++){const d=r[a],h=r[l];if(d!==h){const u=t[d][h]*n,c=1/(u*u);if(c){const g=e[d]-e[h],_=s[d]-s[h];o+=c*Math.pow(u-Math.sqrt(g*g+_*_),2)}}}return o}function nm(t,e,s,i,n,r,o){let a=0;if(n===-1)return 0;for(let l=0;l<i;l++)for(let d=0;d<i;d++){const h=o[l],u=o[d];if(h!==u&&(h===n||u===n)){const c=t[h][u]*r,g=1/(c*c);if(g){const _=e[h]-e[u],m=s[h]-s[u];a+=g*Math.pow(c-Math.sqrt(_*_+m*m),2)}}}return a}function hd(t,e,s,i,n,r,o,a){o=o||0;let l=0,d=0;for(let h=0;h<i;h++)for(let u=0;u<i;u++){const c=a[h],g=a[u];if(c!==g){const _=t[c][g]*r,m=1/(_*_);if(m){const f=e[c]-e[g],p=s[c]-s[g],y=m*Math.pow(_-Math.sqrt(f*f+p*p),2);l+=y,c!==n&&g!==n||(d+=y)}}}return(1-o)*l+o*d}function ud(t,e,s,i,n,r,o,a,l){o=o||0;const d=e,h=s;(n=n===void 0?-1:n)===-1&&(o=0);const u=e[n],c=s[n];for(let g=0;g<i;g++){const _=a[g],m=l(t[n][g]),f=o/(m*m);if(m===0)continue;let p=0,y=0,b=0;const x=e[_],v=s[_];for(let w=0;w<i;w++){const A=a[w];if(A!==_){const I=t[_][A]*r,M=1/(I*I),k=e[A],W=s[A];if(M!==0){const H=x-k,$=v-W,P=H*H+$*$,S=P<1e-12?0:1/Math.sqrt(P);y+=(1-o)*M*(k+I*(x-k)*S),b+=(1-o)*M*(W+I*(v-W)*S)}p+=M}}const E=(1-o)*p+f;if(E!==0){const w=x-u,A=v-c;let I=w*w+A*A;I=I<1e-12?0:1/Math.sqrt(I);const M=m===0?0:f*(m*I);d[_]=(y+M*e[_])/E,h[_]=(b+M*s[_])/E}}return{x:d,y:h}}function f0(t,e,s,i,n,r,o,a){o=o||0;const l=e,d=s;let h;(n=n===void 0?-1:n)===-1&&(o=0);for(let u=0;u<i;u++){const c=a[u];let g=0,_=0,m=0;const f=e[c],p=s[c];for(let y=0;y<i;y++){const b=a[y];let x=0;if(b!==c){let v=0;const E=t[c][b]*r,w=1/(E*E);c!==n&&b!==n||(v=w);const A=(1-o)*w+o*v;if(g+=A,w!==0){const I=e[b],M=s[b],k=f-I,W=p-M,H=k*k+W*W;H>1e-6&&(x=1/Math.sqrt(H)),_+=A*(I+E*(f-I)*x),m+=A*(M+E*(p-M)*x)}}}h=g,h!==0&&(l[c]=_/h,d[c]=m/h)}return{x:l,y:d}}function wh(t=(n,r)=>n-r,e=[],s={},i=n=>n){let n=e.length;function r(a){for(;;){const l=2*a+1,d=l+1;let h=a;if(l<n&&t(e[l],e[h])<0&&(h=l),d<n&&t(e[d],e[h])<0&&(h=d),h===a)return a;const u=e[h];e[h]=e[a],e[a]=u,s[i(e[h])]=h,s[i(u)]=a,a=h}}return{get keys(){return s},get size(){return n},heapify:r,pop(){if(n<=0)return;if(n===1)return n--,e[0];const a=e[0];return e[0]=e[n-1],n--,r(0),a},decreaseKey(a,l){for(l!==void 0&&(e[a]=l,s[i(l)]=a);a>0;){const d=a-1>>1;if(!(t(e[d],e[a])>0))break;{const h=e[a];e[a]=e[d],e[d]=h,s[i(e[a])]=a,s[i(h)]=d,a=d}}return a},min:()=>e[0],remove(a){return this.decreaseKey(a,Number.NEGATIVE_INFINITY),this.pop()},push(a){n++;let l=n-1;for(e[l]=a;l>0;){const d=l-1>>1;if(!(t(e[d],e[l])>0))break;{const h=e[l];e[l]=e[d],e[d]=h,s[i(e[l])]=l,s[i(h)]=d,l=d}}return l},empty:()=>n<=0,toArray:()=>e.slice(0,n)}}function Th({sources:t,targets:e,weights:s,source:i,target:n,undirected:r=!1,indexes:o,N:a}){if(!(a=o?o.length:a)||!isFinite(a)||a===0)throw new Error("Invalid number of nodes "+a);const l=new Float32Array(a),d=new Int32Array(a),h={},u=Number.POSITIVE_INFINITY;if(!s){s=[];for(let m=0;m<a;m++)s[m]=1}if(!o){o=new Uint32Array(a);for(let m=0;m<a;m++)o[m]=m+1}for(let m=0;m<a;m++)l[m]=u,d[m]=-1,h[o[m]]=m;l[h[i]]=0;let c=!1;for(let m=1;m<=a;m++){for(let f=0;f<s.length;f++){const p=t[f],y=e[f],b=h[p],x=h[y];if(b!==void 0&&x!==void 0){const v=s[f];let E=l[b]+v;l[b]!==u&&E<l[x]&&(l[x]=E,d[x]=p,c=!0),r&&(E=l[x]+v,l[x]!==u&&E<l[b]&&(l[b]=E,d[b]=y,c=!0))}}if(!c)break}if(c)for(let m=0;m<s.length;m++){const f=t[m],p=e[m],y=h[f],b=h[p];if(y!==void 0&&b!==void 0){const x=s[m];if(l[y]+x<l[b])return null}}let g=null,_=null;if(n!==void 0){const m=h[n];if(m!==void 0&&l[m]!==u){g=[];for(let f=n;f!==-1;f=d[h[f]])g.push(f);g=g.reverse(),_=l[m]}}return{distances:l,path:g,pathLength:_}}function Lh(t,e,s,i,n,r,o){i=i||t.map((f,p)=>p+1);const a=i.length,l=new Float32Array(a),d=new Int32Array(a),h=new Uint32Array(a),u=Number.POSITIVE_INFINITY,c={};if(a===0)return{distances:l,path:null,pathLength:null};if(!n){n={};for(let f=0;f<a;f++)n[i[f]]=f}for(let f=0;f<a;f++)l[f]=u,d[f]=-1,h[f]=c[f]=f;const g=wh((f,p)=>l[f]-l[p],h,c);for(l[n[e]]=0,g.decreaseKey(c[n[e]]);g.size!==0;){const f=g.pop(),p=l[f],y=t[f];if(p===u)break;for(let b=0,x=y.nodes.length;b<x;b++){const v=y.nodes[b],E=r?1:o?o(i[f],v):y.weights?y.weights[b]:1,w=n[v];if(w===void 0)continue;const A=p+E;A<l[w]&&(l[w]=A,d[w]=f,g.decreaseKey(c[w]))}}let _=null,m=null;if(s!==void 0){const f=n[s];if(l[f]!==u){_=[];for(let p=f;p!==-1;p=d[p])_.push(i[p]);_.reverse(),m=l[s]}}return{distances:l,path:_,pathLength:m}}function cd({sources:t,targets:e,weights:s,indexes:i,adjacency:n,undirected:r,ignoreWeights:o}){const a=Number.POSITIVE_INFINITY,l=i?i.length:n.length;if(!i){i=new Uint32Array(l);for(let m=0;m<l;m++)i[m]=m+1}const d=new Array(l),h={};for(let m=0;m<l;m++){d[m]=new Float32Array(l);for(let f=0;f<l;f++)d[m][f]=m===f?0:a;h[i[m]]=m}const u=l,c=s.length;t=t.slice(),e=e.slice(),s=s.slice();for(let m=0;m<l;m++)t[c+m]=u,e[c+m]=i[m],s[c+m]=0,o&&(s[m]=1);const g=Th({sources:t,targets:e,weights:s,undirected:r,N:l+1,source:u});if(g===null)throw new Error("Graph has negative weight loops");const _=g.distances;for(let m=0;m<s.length;m++){const f=h[t[m]],p=h[e[m]];f!==void 0&&p!==void 0&&(s[m]=s[m]+_[f]-_[p])}t=t.slice(0,c),e=e.slice(0,c),s=s.slice(0,c);for(let m=0;m<l;m++){const f=i[m],{distances:p}=Lh(n,f,void 0,i,h,!!o);for(let y=0;y<l;y++)d[m][y]=m===y?0:p[y]}return d}to(dd,{CyclesFinder:()=>mf,Quadtree:()=>df,bellmanFord:()=>Th,betweenness:()=>pf,circlePack:()=>sf,circleSpread:()=>bb,constrainedStress:()=>hd,convexhull:()=>yb,detectCyclesDirected:()=>gf,detectCyclesUndirected:()=>rv,detectCyclesUndirectedDFS:()=>ov,dijkstra:()=>Lh,distanceStress:()=>nm,johnson:()=>cd,kruskal:()=>ff,largestEmptyCircle:()=>Km,minDisk:()=>el,minHeap:()=>wh,removeRadialOverlap:()=>Md,stressMinimizationStep:()=>ud,stressMinimizationStepGeneral:()=>f0,weightedStress:()=>im});var oi=11102230246251565e-32,es=134217729,p0=(3+8*oi)*oi;function bl(t,e,s,i,n){let r,o,a,l,d=e[0],h=i[0],u=0,c=0;h>d==h>-d?(r=d,d=e[++u]):(r=h,h=i[++c]);let g=0;if(u<t&&c<s)for(h>d==h>-d?(o=d+r,a=r-(o-d),d=e[++u]):(o=h+r,a=r-(o-h),h=i[++c]),r=o,a!==0&&(n[g++]=a);u<t&&c<s;)h>d==h>-d?(o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u]):(o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c]),r=o,a!==0&&(n[g++]=a);for(;u<t;)o=r+d,l=o-r,a=r-(o-l)+(d-l),d=e[++u],r=o,a!==0&&(n[g++]=a);for(;c<s;)o=r+h,l=o-r,a=r-(o-l)+(h-l),h=i[++c],r=o,a!==0&&(n[g++]=a);return r===0&&g!==0||(n[g++]=r),g}function y0(t,e){let s=e[0];for(let i=1;i<t;i++)s+=e[i];return s}function eo(t){return new Float64Array(t)}var x0=(3+16*oi)*oi,b0=(2+12*oi)*oi,v0=(9+64*oi)*oi*oi,pn=eo(4),Ru=eo(8),Ou=eo(12),zu=eo(16),ls=eo(4);function E0(t,e,s,i,n,r,o){let a,l,d,h,u,c,g,_,m,f,p,y,b,x,v,E,w,A;const I=t-n,M=s-n,k=e-r,W=i-r;x=I*W,c=es*I,g=c-(c-I),_=I-g,c=es*W,m=c-(c-W),f=W-m,v=_*f-(x-g*m-_*m-g*f),E=k*M,c=es*k,g=c-(c-k),_=k-g,c=es*M,m=c-(c-M),f=M-m,w=_*f-(E-g*m-_*m-g*f),p=v-w,u=v-p,pn[0]=v-(p+u)+(u-w),y=x+p,u=y-x,b=x-(y-u)+(p-u),p=b-E,u=b-p,pn[1]=b-(p+u)+(u-E),A=y+p,u=A-y,pn[2]=y-(A-u)+(p-u),pn[3]=A;let H=y0(4,pn),$=b0*o;if(H>=$||-H>=$||(u=t-I,a=t-(I+u)+(u-n),u=s-M,d=s-(M+u)+(u-n),u=e-k,l=e-(k+u)+(u-r),u=i-W,h=i-(W+u)+(u-r),a===0&&l===0&&d===0&&h===0)||($=v0*o+p0*Math.abs(H),H+=I*h+W*a-(k*d+M*l),H>=$||-H>=$))return H;x=a*W,c=es*a,g=c-(c-a),_=a-g,c=es*W,m=c-(c-W),f=W-m,v=_*f-(x-g*m-_*m-g*f),E=l*M,c=es*l,g=c-(c-l),_=l-g,c=es*M,m=c-(c-M),f=M-m,w=_*f-(E-g*m-_*m-g*f),p=v-w,u=v-p,ls[0]=v-(p+u)+(u-w),y=x+p,u=y-x,b=x-(y-u)+(p-u),p=b-E,u=b-p,ls[1]=b-(p+u)+(u-E),A=y+p,u=A-y,ls[2]=y-(A-u)+(p-u),ls[3]=A;const P=bl(4,pn,4,ls,Ru);x=I*h,c=es*I,g=c-(c-I),_=I-g,c=es*h,m=c-(c-h),f=h-m,v=_*f-(x-g*m-_*m-g*f),E=k*d,c=es*k,g=c-(c-k),_=k-g,c=es*d,m=c-(c-d),f=d-m,w=_*f-(E-g*m-_*m-g*f),p=v-w,u=v-p,ls[0]=v-(p+u)+(u-w),y=x+p,u=y-x,b=x-(y-u)+(p-u),p=b-E,u=b-p,ls[1]=b-(p+u)+(u-E),A=y+p,u=A-y,ls[2]=y-(A-u)+(p-u),ls[3]=A;const S=bl(P,Ru,4,ls,Ou);x=a*h,c=es*a,g=c-(c-a),_=a-g,c=es*h,m=c-(c-h),f=h-m,v=_*f-(x-g*m-_*m-g*f),E=l*d,c=es*l,g=c-(c-l),_=l-g,c=es*d,m=c-(c-d),f=d-m,w=_*f-(E-g*m-_*m-g*f),p=v-w,u=v-p,ls[0]=v-(p+u)+(u-w),y=x+p,u=y-x,b=x-(y-u)+(p-u),p=b-E,u=b-p,ls[1]=b-(p+u)+(u-E),A=y+p,u=A-y,ls[2]=y-(A-u)+(p-u),ls[3]=A;const Y=bl(S,Ou,4,ls,zu);return zu[Y-1]}function co(t,e,s,i,n,r){const o=(e-r)*(s-n),a=(t-n)*(i-r),l=o-a,d=Math.abs(o+a);return Math.abs(l)>=x0*d?l:-E0(t,e,s,i,n,r,d)}var Bu=Math.pow(2,-52),go=new Uint32Array(512),Ih=class{static from(t,e=L0,s=I0){const i=t.length,n=new Float64Array(2*i);for(let r=0;r<i;r++){const o=t[r];n[2*r]=e(o),n[2*r+1]=s(o)}return new Ih(n)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const s=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*s),this._halfedges=new Int32Array(3*s),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:s,_hullTri:i,_hullHash:n}=this,r=t.length>>1;let o=1/0,a=1/0,l=-1/0,d=-1/0;for(let A=0;A<r;A++){const I=t[2*A],M=t[2*A+1];I<o&&(o=I),M<a&&(a=M),I>l&&(l=I),M>d&&(d=M),this._ids[A]=A}const h=(o+l)/2,u=(a+d)/2;let c,g,_;for(let A=0,I=1/0;A<r;A++){const M=vl(h,u,t[2*A],t[2*A+1]);M<I&&(c=A,I=M)}const m=t[2*c],f=t[2*c+1];for(let A=0,I=1/0;A<r;A++){if(A===c)continue;const M=vl(m,f,t[2*A],t[2*A+1]);M<I&&M>0&&(g=A,I=M)}let p=t[2*g],y=t[2*g+1],b=1/0;for(let A=0;A<r;A++){if(A===c||A===g)continue;const I=w0(m,f,p,y,t[2*A],t[2*A+1]);I<b&&(_=A,b=I)}let x=t[2*_],v=t[2*_+1];if(b===1/0){for(let M=0;M<r;M++)this._dists[M]=t[2*M]-t[0]||t[2*M+1]-t[1];Tn(this._ids,this._dists,0,r-1);const A=new Uint32Array(r);let I=0;for(let M=0,k=-1/0;M<r;M++){const W=this._ids[M],H=this._dists[W];H>k&&(A[I++]=W,k=H)}return this.hull=A.subarray(0,I),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(co(m,f,p,y,x,v)<0){const A=g,I=p,M=y;g=_,p=x,y=v,_=A,x=I,v=M}const E=T0(m,f,p,y,x,v);this._cx=E.x,this._cy=E.y;for(let A=0;A<r;A++)this._dists[A]=vl(t[2*A],t[2*A+1],E.x,E.y);Tn(this._ids,this._dists,0,r-1),this._hullStart=c;let w=3;s[c]=e[_]=g,s[g]=e[c]=_,s[_]=e[g]=c,i[c]=0,i[g]=1,i[_]=2,n.fill(-1),n[this._hashKey(m,f)]=c,n[this._hashKey(p,y)]=g,n[this._hashKey(x,v)]=_,this.trianglesLen=0,this._addTriangle(c,g,_,-1,-1,-1);for(let A,I,M=0;M<this._ids.length;M++){const k=this._ids[M],W=t[2*k],H=t[2*k+1];if(M>0&&Math.abs(W-A)<=Bu&&Math.abs(H-I)<=Bu||(A=W,I=H,k===c||k===g||k===_))continue;let $=0;for(let at=0,Tt=this._hashKey(W,H);at<this._hashSize&&($=n[(Tt+at)%this._hashSize],$===-1||$===s[$]);at++);$=e[$];let P,S=$;for(;P=s[S],co(W,H,t[2*S],t[2*S+1],t[2*P],t[2*P+1])>=0;)if(S=P,S===$){S=-1;break}if(S===-1)continue;let Y=this._addTriangle(S,k,s[S],-1,-1,i[S]);i[k]=this._legalize(Y+2),i[S]=Y,w++;let st=s[S];for(;P=s[st],co(W,H,t[2*st],t[2*st+1],t[2*P],t[2*P+1])<0;)Y=this._addTriangle(st,k,P,i[k],-1,i[st]),i[k]=this._legalize(Y+2),s[st]=st,w--,st=P;if(S===$)for(;P=e[S],co(W,H,t[2*P],t[2*P+1],t[2*S],t[2*S+1])<0;)Y=this._addTriangle(P,k,S,-1,i[S],i[P]),this._legalize(Y+2),i[P]=Y,s[S]=S,w--,S=P;this._hullStart=e[k]=S,s[S]=e[st]=k,s[k]=st,n[this._hashKey(W,H)]=k,n[this._hashKey(t[2*S],t[2*S+1])]=S}this.hull=new Uint32Array(w);for(let A=0,I=this._hullStart;A<w;A++)this.hull[A]=I,I=s[I];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(A0(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:s,coords:i}=this;let n=0,r=0;for(;;){const o=s[t],a=t-t%3;if(r=a+(t+2)%3,o===-1){if(n===0)break;t=go[--n];continue}const l=o-o%3,d=a+(t+1)%3,h=l+(o+2)%3,u=e[r],c=e[t],g=e[d],_=e[h];if(S0(i[2*u],i[2*u+1],i[2*c],i[2*c+1],i[2*g],i[2*g+1],i[2*_],i[2*_+1])){e[t]=_,e[o]=u;const m=s[h];if(m===-1){let p=this._hullStart;do{if(this._hullTri[p]===h){this._hullTri[p]=t;break}p=this._hullPrev[p]}while(p!==this._hullStart)}this._link(t,m),this._link(o,s[r]),this._link(r,h);const f=l+(o+1)%3;n<go.length&&(go[n++]=f)}else{if(n===0)break;t=go[--n]}}return r}_link(t,e){this._halfedges[t]=e,e!==-1&&(this._halfedges[e]=t)}_addTriangle(t,e,s,i,n,r){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=s,this._link(o,i),this._link(o+1,n),this._link(o+2,r),this.trianglesLen+=3,o}};function A0(t,e){const s=t/(Math.abs(t)+Math.abs(e));return(e>0?3-s:1+s)/4}function vl(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function S0(t,e,s,i,n,r,o,a){const l=t-o,d=e-a,h=s-o,u=i-a,c=n-o,g=r-a,_=h*h+u*u,m=c*c+g*g;return l*(u*m-_*g)-d*(h*m-_*c)+(l*l+d*d)*(h*g-u*c)<0}function w0(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l),g=(d*h-a*u)*c,_=(o*u-l*h)*c;return g*g+_*_}function T0(t,e,s,i,n,r){const o=s-t,a=i-e,l=n-t,d=r-e,h=o*o+a*a,u=l*l+d*d,c=.5/(o*d-a*l);return{x:t+(d*h-a*u)*c,y:e+(o*u-l*h)*c}}function Tn(t,e,s,i){if(i-s<=20)for(let n=s+1;n<=i;n++){const r=t[n],o=e[r];let a=n-1;for(;a>=s&&e[t[a]]>o;)t[a+1]=t[a--];t[a+1]=r}else{let n=s+1,r=i;Kn(t,s+i>>1,n),e[t[s]]>e[t[i]]&&Kn(t,s,i),e[t[n]]>e[t[i]]&&Kn(t,n,i),e[t[s]]>e[t[n]]&&Kn(t,s,n);const o=t[n],a=e[o];for(;;){do n++;while(e[t[n]]<a);do r--;while(e[t[r]]>a);if(r<n)break;Kn(t,n,r)}t[s+1]=t[r],t[r]=o,i-n+1>=r-s?(Tn(t,e,n,i),Tn(t,e,s,r-1)):(Tn(t,e,s,r-1),Tn(t,e,n,i))}}function Kn(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function L0(t){return t[0]}function I0(t){return t[1]}var gd={};to(gd,{BUTTON_MAPPING:()=>Dh,BoundingBox:()=>je,DummyCanvas:()=>Mm,DummyCanvasRenderingContext2D:()=>Nm,DummyDomElement:()=>xm,DummyFileReader:()=>aa,DummyTextNode:()=>zh,DummyXHR:()=>ya,ElementSet:()=>so,EventTarget:()=>io,FlexArray:()=>Aa,IndexList:()=>Um,Map2:()=>Gm,PathMap:()=>Vm,PrioritySet:()=>Zm,SVG_NS:()=>Fh,Table:()=>Id,XLINK:()=>Em,XML_NS:()=>xd,applyCursorStyle:()=>va,baseURI:()=>Im,binaryIndexOf:()=>am,cancelAnimFrame:()=>rm,clamp:()=>bs,clearCanvas:()=>Ad,componentsToRGBA:()=>Xm,computeMax:()=>In,computeMin:()=>ii,computeSum:()=>zm,concatenateArrays:()=>P0,createBlob:()=>Ur,createCanvas:()=>Je,createDummyDomElement:()=>xa,createDummyXmlDocument:()=>$m,createElement:()=>bd,createSvgElement:()=>de,createTextNode:()=>Ph,createWebGL2Context:()=>Pm,createWorker:()=>Hm,createXmlDocument:()=>Ym,dataUrlToBlob:()=>bm,debounce:()=>R0,deepCopy:()=>Ie,displayPixelsOnScreen:()=>lb,ensureTransferable:()=>Ka,escapeDOMAttribute:()=>Ln,extendList:()=>B0,fadeElement:()=>Cm,fetch:()=>Zn,fetchBinary:()=>Tm,fetchBinaryAsBase64:()=>Lm,flatten:()=>Or,flattenArray:()=>om,forEach:()=>Ws,formatAngle:()=>Ea,formatHex:()=>la,formatWorkerMessage:()=>qm,getBaseLog:()=>Bm,getCurrentTime:()=>rs,getDate:()=>mm,getDocument:()=>hi,getDocumentFontRules:()=>km,getEmbeddedFontRules:()=>Rm,getFlattenedKeys:()=>on,getGlContext:()=>Dm,getImage:()=>Am,getLeafValues:()=>Za,getOptions:()=>vs,getPixelRatio:()=>fs,getProperty:()=>Le,getStyle:()=>ym,getTime:()=>fm,getValues:()=>Ar,getWebglContext:()=>kh,hash8:()=>md,indexArrayToArray:()=>Rr,indexByName:()=>U0,insertSortAsc:()=>hr,insertSortDesc:()=>F0,isArray:()=>Qe,isBlob:()=>q0,isHTMLElement:()=>wm,isInteger:()=>k0,isLittleEndian:()=>Ya,isObject:()=>ze,isRawObject:()=>rn,isWebGLSupported:()=>Fm,lerp:()=>le,mapKeys:()=>Ja,mapValues:()=>Pi,merge:()=>xs,mergeValues:()=>pa,mix:()=>Sd,nextPowerOfTwo:()=>Si,objToValueList:()=>tl,parseColor:()=>os,parseColorHex:()=>Oh,parseColorRgba:()=>Rh,pick:()=>pd,processQueue:()=>O0,promiseQueue:()=>dm,promptDownload:()=>Ui,propertyPathToString:()=>_d,removeFromArray:()=>D0,requestAnimFrame:()=>Ch,resizeElement:()=>ba,resolvePath:()=>Om,rgbaToRgb:()=>Sn,serializeXMLDocument:()=>Bh,setAttributes:()=>Nh,setCtxFont:()=>Fi,setElementSize:()=>ln,setKeys:()=>J0,setProperty:()=>$s,setValues:()=>gr,smartRequire:()=>Ms,throttle:()=>$a,toArray:()=>fa,toHexa:()=>Ld,toPropertyPath:()=>nn,traverse:()=>um,unflatten:()=>fd,unorderedHash:()=>z0,workerIsAvailable:()=>jm});var C0=(()=>{let t=0;return typeof requestAnimationFrame<"u"?requestAnimationFrame:function(e){const s=Date.now(),i=Math.min(16,Math.max(0,16-(s-t))),n=t=s+i;return setTimeout(()=>e(n),i)}})(),M0=typeof cancelAnimationFrame<"u"?cancelAnimationFrame:function(t){return clearTimeout(t)};function Ch(t,e){return C0(s=>{t.call(e,s)})}function rm(t){t&&M0(t)}var N0=typeof global=="object"&&global!==null&&global.it!==void 0,di=typeof document<"u",sn=typeof window<"u",Xa=sn&&!window.__OGMA_HEADLESS,Wa=Xa&&di;function hr(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])>e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function F0(t,e){for(let s=1,i=t.length;s<i;s++){const n=t[s];let r=s;for(;r>0&&e.get(t[r-1])<e.get(n);)t[r]=t[r-1],--r;t[r]=n}return t}function Qe(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function fa(t){return Array.isArray(t)?t:[t]}function om(t){const e=[];for(let s=0;s<t.length;++s){const i=t[s];if(Array.isArray(i))for(let n=0;n<i.length;++n)e.push(i[n]);else e.push(i)}return e}function P0(...t){if(t.length===0)return[];const e=t[0].constructor;let s=0;for(const r of t)s+=r.length;const i=new e(s);let n=0;for(const r of t){for(let o=0;o<r.length;o++)i[n+o]=r[o];n+=r.length}return i}function D0(t,e){const s=t.indexOf(e);return s!==-1&&(t.splice(s,1),!0)}function am(t,e){let s,i,n=0,r=t.length-1;for(;n<=r;)if(s=(n+r)/2|0,i=t[s],i<e)n=s+1;else{if(!(i>e))return s;r=s-1}return-1}var Rr=(t,e)=>{const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=e[t[i]];return s};function k0(t){return typeof t=="number"&&t%1==0}function _d(t){return Array.isArray(t)?t.join("."):t}function nn(t){if(!t)return[];if(typeof t=="string")return t.split(".");if(Array.isArray(t)){for(let e=0;e<t.length;++e)if(typeof t[e]!="string")throw new TypeError(`${t[e]} is not a string`);return t.slice()}throw new TypeError(`invalid property path "${t}": expected string or array of strings`)}function $a(t,e,s){let i,n,r;if(e===0)return function(){t.apply(s,arguments)};const o=function(){i=!1,n&&(r.apply(s,n),n=null)};return r=function(){let a;return i?n=arguments:(a=t.apply(s,arguments),setTimeout(o,e),i=!0),a},r}function R0(t,e,s){let i,n,r,o,a;const l=e===0||e===void 0?100:e;function d(){const u=Date.now()-o;u<l&&u>=0?i=setTimeout(d,l-u):(i=null,s||(a=t.apply(r,n),r=n=null))}const h=function(){r=this,n=arguments,o=Date.now();const u=s&&!i;return i||(i=setTimeout(d,e)),u&&(a=t.apply(r,n),r=n=null),a};return h.clear=function(){i&&(clearTimeout(i),i=null)},h.flush=function(){i&&(a=t.apply(r,n),r=n=null,clearTimeout(i),i=null)},h}function lm(t,e,s,i,n){s(t[e],e,t,i,n).then(r=>{e===t.length-1?i(r):lm(t,e+1,s,i,n)}).catch(n)}function O0(t,e){return new Promise((s,i)=>lm(t,0,e,s,i))}function Ya(){return new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120}function dm(t){return t.reduce((e,s)=>e.then(s),Promise.resolve())}function md(t,e,s,i,n,r,o,a){return t+n+256*(e+r)+65536*(s+o)+16777216*(i+a)}function z0(t,e){return t<e?t*e+Math.pow(e-t-1,2)/4:t*e+Math.pow(t-e-1,2)/4}function rn(t){return!(t===null||typeof t!="object"||Qe(t)||t instanceof RegExp||typeof HTMLElement<"u"&&t instanceof HTMLElement)}function Ar(t){const e=Object.keys(t),s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=t[e[i]];return s}function Ws(t,e,s){if(Array.isArray(t))return t.forEach(e,s);if(!rn(t))throw new Error("forEach: invalid argument "+JSON.stringify(t));const i=Object.keys(t);if(s!==void 0)for(let n=0;n<i.length;++n){const r=i[n];e.call(s,t[r],r)}else for(let n=0;n<i.length;++n){const r=i[n];e(t[r],r)}}function Ie(t){if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;++n)i[n]=Ie(t[n]);return i}if(!ze(t))return t;const e={},s=Object.keys(t);for(const i of s)e[i]=Ie(t[i]);return e}function B0(t,e){e.forEach(s=>{t.indexOf(s)===-1&&t.push(s)})}function $s(t,e,s){const i=typeof e=="string"?e.split("."):e;for(let n=0;n<i.length-1;++n){const r=i[n];let o=t[r];o||(o={},t[r]=o),t=o}t[i[i.length-1]]=s}function Le(t,e){const s=nn(e);if(!s.length)return t;if(t){for(let i=0;i<s.length-1;++i){const n=t[s[i]];if(!n)return;t=n}return t[s[s.length-1]]}}function Or(t,e,s="."){e||(e=r=>!rn(r));const i={},n=Object.keys(t);for(let r=0;r<n.length;++r){const o=n[r],a=t[o];if(e(a))i[o]=a;else{const l=Or(a,e),d=Object.keys(l);for(let h=0;h<d.length;h++){const u=d[h];i[`${o}${s}${u}`]=l[u]}}}return i}function fd(t){const e={},s=Object.keys(t);for(let i=0;i<s.length;++i){const n=s[i];$s(e,n,t[n])}return e}function on(t,e,s=[]){const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=t[r],a=e?e+r:r;ze(o)?on(o,a+".",s):s.push(a)}return s}var hm=Object.prototype.hasOwnProperty;function um(t,e){const s=[t];let i;for(;s.length>0;)if(i=s.pop(),i)if(ze(i))for(const n in i)hm.call(i,n)&&s.push(i[n]);else e(i)}function U0(t){const e={};return um(t,s=>e[s.getName()]=s),e}function Za(t,e=[]){if(ze(t)){const s=Object.keys(t);for(const i of s)Za(t[i],e)}else e.push(t);return e}function Ka(t){for(const e in t)typeof t[e]=="function"&&delete t[e];return t}function vs(t,e){if(t===void 0)return Ie(e);if(!rn(t))return t;const s={},i=Object.keys(e);for(const n of i){const r=e[n],o=t[n];rn(r)?s[n]=vs(o,r):s[n]=o===void 0?Ie(r):o}return s}function ze(t){return t&&(t.constructor===Object||!t.constructor)}function pa(t,e){if(!ze(e)||!ze(t))return e;const s=Object.assign({},t),i=Object.keys(e);for(const n of i)s[n]=pa(s[n],e[n]);return s}function pd(t,e){return e==null?t:e.reduce((s,i)=>(s[i]=t[i],s),{})}var xs=(...t)=>{const e={};for(let s=0;s<t.length;s++){const i=t[s];for(const n in i)hm.call(i,n)&&(Array.isArray(e[n])&&Array.isArray(i[n])?e[n]=Array.from(new Set(e[n].concat(i[n]))):ze(e[n])&&ze(i[n])?e[n]=xs(e[n],i[n]):e[n]=i[n])}return e},G0={},cm=G0,oa={},gm={},yd=t=>null;if(typeof global=="object"&&(oa=global),typeof window=="object"&&(gm=window),typeof Er=="object"&&typeof Er.require=="function"){const t=Er.require.bind(Er);yd=e=>{try{return t(e)}catch{return null}}}else typeof oa.require=="function"&&(yd=t=>{const e=oa.require;try{return e(t)}catch{return null}});function Ms(t,{throwOnError:e}={}){let s=null;if(!s&&t&&(s=cm[t]),!s&&t&&(s=yd(t)),!s&&t&&(s=gm[t]),!s&&t&&(s=oa[t]),!s&&e){const i=[`unable to find module "${t}"; make sure one of these statements is true:`,`- Ogma.libraries['${t}'] is set to the right library`,`- require('${t}') returns the right library`,`- window['${t}'] is set to the right library`].join(`
`);throw new Error(i)}return s}var _m=typeof performance<"u"&&performance.now?()=>0|performance.now():()=>Date.now(),V0=_m();function rs(){return _m()-V0}function mm(){const t=new Date,e=t.getDate(),s=t.getMonth()+1;return`${t.getFullYear()}-${s<10?"0"+s:s}-${e<10?"0"+e:e}`}function fm(){const t=new Date;return`[${_o((t.getUTCHours()-(t.getTimezoneOffset()/60|0))%24)}:${_o(t.getUTCMinutes())}:${_o(t.getUTCSeconds())}:${_o(t.getUTCMilliseconds(),3)}]`}function _o(t,e=2){let s=Math.pow(10,e-1),i=String(t);for(;s>1;)t<s&&(i="0"+i),s/=10;return i}function Mi(t){!N0&&console.warn(fm()+" "+t)}function j0(t,e){e.forEach(s=>{Object.getOwnPropertyNames(s.prototype).forEach(i=>{Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(s.prototype,i)||Object.create(null))})})}var El,an,Mh,pm,qt=()=>{},zr=()=>!1,Qa=()=>!0,Br=()=>null,Os=t=>t,ur=class{constructor(){this.method=null,this.url=null,this.status=0,this.readyState=0,this.headers={},this.responseText=null,this.response=null,ur.onCreate&&ur.onCreate(this)}open(t,e){this.method=t,this.url=e,ur.onSend&&ur.onSend(this)}respond(t,e,s){this.readyState=4,this.status=t,this.headers=e,this.responseText=s,this.response=s,this.onreadystatechange()}send(){this.readyState=4}},ya=ur;ya.onCreate=qt,ya.onSend=qt;var cr=class{constructor(){this.onload=qt,cr.onCreate&&cr.onCreate(this)}readAsDataURL(t){this._blob=t,cr.onRead&&cr.onRead(this)}load(t){this.result=typeof t=="function"?t(this._blob):t,this.onload&&this.onload()}},aa=cr;function hi(){return an||{createElementNS:()=>null,createElement:()=>null,implementation:{createDocument(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}function ym(t,e){if(document&&document.defaultView){let s=t.style[e];if((!s||s==="auto")&&hi().defaultView){const i=document.defaultView.getComputedStyle(t,null);s=i?i[e]:null}return s==="auto"?null:s?s.toString():null}return null}aa.onCreate=qt,aa.onRead=qt,El=Ms("xmldom"),an=di?document:El?new El.DOMImplementation().createDocument():null,Mh=typeof XMLHttpRequest<"u"?XMLHttpRequest:ya,pm=typeof FileReader<"u"?FileReader:aa;var xm=class{constructor(){this.onmousewheel=qt,this.__dummy=!0,this.style={},this.clientWidth=0,this.clientHeight=0,this.childNodes=[],this.style={width:"0px",height:"0px",top:void 0,left:void 0,position:"",backgroundColor:void 0}}get offsetWidth(){return parseFloat(this.style.width||"0")}get offsetHeight(){return parseFloat(this.style.height||"0")}get firstChild(){return null}get parentNode(){return null}get classList(){return{length:0,value:"",add(){},remove(){},contains:t=>!1,item:null}}get innerHTML(){return""}set innerHTML(t){}appendChild(t){return this.childNodes.push(t),t}removeChild(){}addEventListener(){}removeEventListener(){}insertBefore(){}contains(t){return!1}};function xa(){return new xm}var fs=sn?()=>window.devicePixelRatio:()=>1;function bm(t){const e=";base64,";let s,i,n;if(t.indexOf(e)===-1)return s=t.split(","),i=s[0].split(":")[1],n=decodeURIComponent(s[1]),Ur(n,i);s=t.split(e),i=s[0].split(":")[1],n=window.atob(s[1]);const r=n.length,o=new Uint8Array(r);for(let a=0;a<r;++a)o[a]=n.charCodeAt(a);return Ur([o],i)}var vm=class{constructor(t,e){this.data=t,this.type=e}};function Ur(t,e){return typeof Blob<"u"?new Blob(t,{type:e}):new vm(t,e)}function q0(t){return typeof Blob<"u"&&t instanceof Blob||t instanceof vm}function H0(t,e){return e==="blob"?t:e==="dataURL"?bm(t):Ur([t],"text/xml")}function Ui(t,e,s){if(!Xa)return t;let i=null,n=null,r=null;window.Blob?(i=H0(t,s),n=window.URL.createObjectURL(i)):r="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(t);const o=document.createElement("a");return o.setAttribute("href",n||r),o.setAttribute("download",e),document.body.appendChild(o),o.click(),document.body.removeChild(o),n&&setTimeout(()=>window.URL.revokeObjectURL(n),0),t}function ba(t,e,s,i=fs()){if(ln(t,e+"px",s+"px"),t.tagName==="IMG"||t.tagName==="CANVAS"){const n=t;n.width=e*i,n.height=s*i}}function Nh(t,e){Ws(e,(s,i)=>{s!==void 0&&t.setAttribute(i,s)})}var Fh="http://www.w3.org/2000/svg",xd="http://www.w3.org/2000/xmlns/",Em="http://www.w3.org/1999/xlink",X0=1;function de(t,e){const s=an.createElementNS(Fh,t);return s.style||(s.style={}),e&&Nh(s,e),s}function bd(t){const e=an.createElement("div"),s=t.trim().replace(/\s+/g," ");if(e.innerHTML=s,!e.firstChild||e.firstChild.nodeType!==X0)throw new Error(`Failed to create element from: "${t}". Expected an HTML string`);return e.firstChild}function Ph(t){if(an)return an.createTextNode(t)}function Am(t){return typeof Image>"u"?Promise.resolve(null):new Promise(e=>{const s=new Image;s.src=t,s.onload=()=>e(s),s.onerror=()=>e(null)})}function Sm(t){if(t.indexOf("http://")===0||t.indexOf("https://")===0)return t;const e=window.location.origin,s=window.location.pathname,i=s.lastIndexOf("/");return i===-1?e+"/"+t:e+s.substr(0,i)+"/"+t}function Zn(t){return new Promise((e,s)=>{const i=new Mh;i.open("GET",Sm(t),!0),i.onreadystatechange=function(){if(i.readyState===4){const n=i.status;n===200?e(i.responseText):s(n!==0?new Error(`cannot retrieve file at url "${t}"; the server responded with status code ${n}.`):new Error(`cannot send XMLHttpRequest to url "${t}"; if you're using the local file protocol this is most likely the cause.`))}},i.onerror=function(){s(new Error(`cannot retrieve file at url "${t}"; the XMLHttpRequest failed.`))},i.send()})}function wm(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function va(t,e){t.style.cursor=e,t.style.cursor!==e&&(t.style.cursor=`-webkit-${e}`)}function Tm(t){return new Promise((e,s)=>{const i=new Mh;i.responseType="blob",i.open("GET",Sm(t),!0),i.onreadystatechange=()=>{if(i.readyState===4){if(i.status===200)return e(i.response);s(i.status)}},i.onerror=n=>s(n),i.send()})}function Lm(t){return Tm(t).then(e=>new Promise((s,i)=>{const n=new pm;n.onerror=i,n.onload=()=>s(n.result),n.readAsDataURL(e)}))}function Ln(t,e=!0){const s=e?"&#13;":`
`;return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,s).replace(/[\r\n]/g,s)}var Dh={0:"left",1:"middle",2:"right"};function Im(t){if(t.baseURI)return t.baseURI;const e=t.getElementsByTagName("base");return e.length>0?e[0].href:t.URL||(t.location?t.location.href:"")}function Cm(t,e,s,i){return new Promise(n=>{let r=e;const o=Date.now(),a=(s-e)*Math.min(1,1/(i/16));(function l(){Date.now()-o<i?(r=Math.min(1,Math.max(0,r+a)),t.style.opacity=r.toString(),Ch(l)):n()})()})}function ln(t,e,s){t.style.width=e,t.style.height=s}var vd=300,Ed=150,Mm=class{constructor(){this.style={},this.width=vd,this.height=Ed,this.__context=new Nm,this.style={},this.width=vd,this.height=Ed}get __dummy(){return!0}get parentNode(){return null}getContext(t){return t==="2d"?this.__context:null}toDataURL(t="png"){return`data:image/${t};base64,`}addEventListener(){}removeEventListener(){}getBoundingClientRect(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}}},Nm=class{constructor(){this._fontSize=10}set font(t){const e=t.match(/\d+/);e&&(this._fontSize=parseFloat(e[0]))}set fillStyle(t){}set textBaseline(t){}set textAlign(t){}set strokeStyle(t){}set lineWidth(t){}fill(){}stroke(){}clearRect(){}fillRect(){}strokeRect(){}beginPath(){}closePath(){}moveTo(){}lineTo(){}rect(){}arc(){}save(){}restore(){}clip(){}translate(){}rotate(){}fillText(){}setLineDash(){}quadraticCurveTo(){}bezierCurveTo(){}drawImage(){}measureText(t){return{width:t.length*Math.ceil(.625*this._fontSize)}}getImageData(){return{width:0,height:0,data:new Uint8ClampedArray(0)}}},mo=Ms("canvas")||Ms("canvas-prebuilt");function Je(t=vd,e=Ed){if(di){const i=document.createElement("canvas");return i.width=t,i.height=e,i}if(mo){let i=null;return i="createCanvas"in mo?mo.createCanvas(t,e):new mo(t,e),i.style={},i}const s=new Mm;return s.width=t,s.height=e,s}function Ad(t,e,s=t.width,i=t.height){e.clearRect(0,0,s,i)}function Fi(t,e,s,i=""){t.font=`${i} ${s}px ${e}`}function Fm(){return kh(Je(),{},"webgl")!==null}var Pm=t=>{const{canvas:e,width:s,height:i}=ct({canvas:document.createElement("canvas"),width:window.innerWidth*devicePixelRatio,height:window.innerHeight*devicePixelRatio},t);e.width=Math.ceil(s),e.height=Math.ceil(i),e.style.width=Math.ceil(s/devicePixelRatio)+"px",e.style.height=Math.ceil(i/devicePixelRatio)+"px";const n=e.getContext("webgl2",{antialias:!0});if(!n)throw new Error("WebGL 2.0 not supported");return n},Dm=(t,e,s)=>{const i=Pm();return i.canvas.addEventListener("webglcontextlost",s),{context:i,cleanUp:()=>{var n;i.canvas.removeEventListener("webglcontextlost",s),(n=i.getExtension("WEBGL_lose_context"))==null||n.loseContext()}}};function kh(t,e,s){let i=t.getContext(s,e);return i||(i=t.getContext("experimental-webgl",e)),i||null}function W0(t){let e="";for(let s=0;s<t.length;s++)e+=t[s].cssText+`
`;return e}function km(){const t=hi(),e=t.styleSheets||[],s=Im(t),i=[],n=[];for(let o=0;o<e.length;o++){const a=e[o];a.href==null?i.push({href:s,content:W0(a.cssRules)}):n.push(a.href)}const r=/@font-face\s*\{[^}]+\}/g;return Promise.all(n.map(o=>Zn(o).then(a=>({href:o,content:a})).catch(Br))).then(o=>o.concat(i)).then(o=>{const a=[];for(let l=0;l<o.length;l++){const d=o[l];if(d!==null){const{href:h,content:u}=d,c=u.match(r);if(c){const g=Y0(c,h);a.push.apply(a,g)}}}return a})}function Rm(t,e){return Promise.all(t.map(({formats:s,originalRule:i})=>Promise.all(s.map(({format:n,url:r})=>e?Lm(r).then(o=>({format:n,src:o})).catch(Br):{format:n,src:r})).then(n=>{const r=[];for(const o of n)o!==null&&r.push(`url('${o.src}') format('${o.format}')`);if(r.length!==0){const o=`src: ${r.join(",")}`;return i.replace(/@font-face\s*{([^}]*);?}/,`@font-face{$1;${o}}`).replace(/\s+/," ").replace(/;+/,";")}return i})))}var $0={"embedded-opentype":!0,svg:!0};function Y0(t,e){const s=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g,i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/,n=[];for(let r=0;r<t.length;r++){const o=t[r],a=o.match(i);if(a){const l=a[1],d=[];let h;for(;h=s.exec(o);){const u=h[1],c=h[2];$0[c.toLowerCase()]||d.push({format:c,url:Om(u,e)})}n.push({name:l,formats:d,originalRule:o})}}return n}function Om(t,e){if(/^http(s)?:/.test(t))return t;if(t[0]==="/"){const n=e.match(/((\w+:\/\/)([^/]+))/);return n?n[1]+t:t}const s=t.split("/"),i=e.split("/");for(e[e.length-1]!=="/"&&i.pop();s[0]==="..";)s.shift(),i.pop();return i.concat(s).join("/").replace(/[\w](\/{2,})/g,n=>n[0]+"/")}function Si(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function zm(t){let e=0;for(let s=0;s<t.length;++s)e+=t[s];return e}function bs(t,e,s){return Math.max(e,Math.min(s,t))}function Sd(t,e,s){return t+(e-t)*s}function le(t,e,s){return t*(1-s)+e*s}function In(t){if(!t.length)return-1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n>e&&(e=n)}return e}function ii(t){if(!t.length)return 1/0;let e=t[0];for(let s=1,i=t.length;s<i;++s){const n=t[s];n<e&&(e=n)}return e}var Bm=(t,e)=>Math.log(t)/Math.log(e),Ea=t=>t<-Math.PI?t+2*Math.PI:t>Math.PI?t-2*Math.PI:t,Uu=4,Um=class{constructor(){this._buffer=new Uint32Array(Uu),this._capacity=Uu,this._size=0,this._busy=!1}isBusy(){return this._busy}markBusy(){return this._busy=!0,this}sliceAndReset(){this._busy=!1;const t=this.slice(0,this._size);return this.reset(),t}reset(){return this._size=0,this}reserve(t){return t>this._capacity&&this._setCapacity(Si(t)),this}_setCapacity(t){const e=new Uint32Array(t);e.set(this._buffer),this._buffer=e,this._capacity=t}push(t){return this._size===this._capacity&&this._setCapacity(2*this._capacity),this._buffer[this._size++]=t,this}pushUnchecked(t){return this._buffer[this._size++]=t,this}slice(t=0,e=this._size){return this._buffer.slice(t,e)}getBuffer(){return this._buffer}getLength(){return this._size}getCapacity(){return this._capacity}setLength(t){return this._size=t,this}isEmpty(){return this._size===0}},Gu=(t,e)=>(t+e)*(t+e+1)/2+e;function Qn(t,e){const s=t<e?t:e;return 67108864*s+(t+e-s)}function Ja(t){if(t.keys)return Array.from(t.keys());const e=[];return t.forEach((s,i)=>e.push(i)),e}function Pi(t){if(t.values)return Array.from(t.values());const e=[];return t.forEach(s=>e.push(s)),e}var Gm=class{constructor(){this._map=new Map}reset(){this._map.clear()}set(t,e,s){this._map.set(Gu(t,e),s)}get(t,e){return this._map.get(Gu(t,e))}};function Z0(t){return t instanceof RegExp||t instanceof Date}var K0=typeof HTMLElement>"u"?t=>!1:t=>t instanceof HTMLElement,Q0=function(t){return typeof t!="object"||t===null||Qe(t)||Z0(t)};function tl(t,e=[],s=[]){if(!K0(t)){if(Q0(t))e.push({path:s.slice(),value:t});else{const i=Object.keys(t);for(let n=0;n<i.length;++n){const r=i[n],o=s.slice();o.push(r),tl(t[r],e,o)}}return e}}var Vm=class{constructor(){this._keys=[],this._values=[],this._size=0,this._cachedPath=[],this._cachedIndex=-1}get size(){return this._size}set(t,e){const s=this._getIndex(t);s!==-1?this._values[s]=e:(Al(this._cachedPath,t)&&(this._cachedIndex=this._keys.length),this._keys.push(t),this._values.push(e),this._size+=1)}get(t){const e=this._getIndex(t);if(e!==-1)return this._values[e]}has(t){return this._getIndex(t)!==-1}keys(){return this._keys.slice()}_getIndex(t){if(Al(t,this._cachedPath))return this._cachedIndex;this._cachedPath=t.slice();const e=this._keys;for(let s=0;s<e.length;++s)if(Al(e[s],t))return this._cachedIndex=s,s;return this._cachedIndex=-1,-1}};function Al(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}var J0=function(e){return Array.from(e.keys())},gr=function(e){return Array.from(e.values())},mi=()=>(t,e)=>t[e],fi=()=>(t,e,s)=>{t[e]=s},Vu={1:Sl(1),2:Sl(2),4:Sl(4),8:mi(),16:mi(),32:mi(),int8:mi(),int16:mi(),int32:mi(),float:mi(),any:mi()},ju={1:wl(1),2:wl(2),4:wl(4),8:fi(),16:fi(),32:fi(),int8:fi(),int16:fi(),int32:fi(),float:fi(),any:fi()};function Sl(t){const e=8/t,s=(1<<t)-1;return(i,n)=>i[n/e|0]>>n%e*t&s}function wl(t){const e=8/t,s=Math.pow(2,t)-1;return(i,n,r)=>{const o=n%e*t,a=n/e|0,l=r<<o,d=255-(s-r<<o);i[a]=i[a]&d|l}}function tb(t,e){return t===void 0&&e!=="any"&&e!=="resource"?0:t}var eb={get(t){return this._getArrayElt(this._buffer,t)},set(t,e){this._setArrayElt(this._buffer,t,e)}},sb={get(t){return this._byIndex[this._getArrayElt(this._buffer,t)]},set(t,e){let s=this._byName[e];s===void 0&&(s=this._nextIndex++,this._byIndex.push(e),this._getElementBitSize()>this._elementSize&&this.increaseElementSize(),this._byName[e]=s),this._setArrayElt(this._buffer,t,s)}},ib=0,Aa=class{constructor(t){this._id=ib++,this._initialized=!1;const e=t.name,s=t.storage,i=t.size||0,n=tb(t.default,s),r=Math.max(8,qu(i+1)),o=s==="resource"?1:s;this._name=e,this._storage=s,this._getArrayElt=Vu[o],this._setArrayElt=ju[o],this._elementSize=o,this._nbElements=r,this._fallback=null,this._byName=void 0,this._byIndex=void 0,this._nextIndex=void 0,this._defaultValue=n,this._BASE_VALUE=s==="any"?void 0:0,this._methods=eb,this._initialized=!1,this._buffer=null,s==="resource"&&(this._methods=sb,this._byName=Object.create(null),this._byIndex=[],this._nextIndex=1,this._byName[n]=0,this._byIndex.push(n))}getValues(){return Object.keys(this._byName||{})}getName(){return this._name||""}setDefaultValue(t){this._defaultValue=t,this._storage==="resource"&&(this._byName[t]=0,this._byIndex[0]=t)}get(t){return this._get(t)}set(t,e){this._set(t,e)}_get(t){return this._defaultValue}_set(t,e){e!==this._defaultValue&&(this._initialize(),this._set(t,e))}setFallback(t){this._fallback=t,this.get=this._getWithFallback}_getWithFallback(t){const e=this._get(t);return e===void 0&&this._fallback?this._fallback.get(t):e}_initialize(){this._initialized=!0,this._buffer=Tl(this._nbElements,this._elementSize),this._get=this._methods.get,this._set=this._methods.set,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(0)}grow(t){const e=qu(t+1);if(!(e<=this._nbElements)){if(this._initialized)if(this._elementSize==="any")for(let s=this._nbElements;s<e;++s)this._buffer.push(this._defaultValue);else{const s=Tl(e,this._elementSize);s.set(this._buffer),this._buffer=s,this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE&&this._reset(this._nbElements)}this._nbElements=e}}increaseElementSize(){const t=this._elementSize;if(typeof t!="number"||t===32)throw new Error("FlexArray: cannot increase element size");const e=2*t,s=Vu[e],i=ju[e];if(this._initialized){const n=this._nbElements,r=this._getArrayElt,o=this._buffer,a=Tl(n,e);if(t>=8)a.set(o);else for(let l=0;l<n;++l)i(a,l,r(o,l));this._buffer=a}this._elementSize=e,this._getArrayElt=s,this._setArrayElt=i}buffer(){if(!this._buffer)throw new Error("FlexArray: buffer not instantiated");return this._buffer}elementBitSize(){return this._elementSize}capacity(){return this._nbElements}byteSize(){return this._nbElements*this._elementSize/8}isInitialized(){return this._initialized||this._fallback&&this._fallback.isInitialized()}getMultiple(t,e){const s=t.length;e===void 0&&(e=new Array(s));for(let i=0,n=s;i<n;++i)e[i]=this.get(t[i]);return e}fill(t,e){for(let s=0,i=t.length;s<i;++s)this.set(t[s],e)}setMultiple(t,e,s){if(s||!Array.isArray(e)&&!ArrayBuffer.isView(e))for(let i=0,n=t.length;i<n;++i)this.set(t[i],e);else for(let i=0,n=t.length;i<n;++i)this.set(t[i],e[i])}reset(){return this._initialized&&this._reset(0),this}_reset(t){const e=this._storage==="resource"?0:this._defaultValue;if(this._buffer)if(typeof this._elementSize!="number"||this._elementSize>=8)this._buffer.fill(e,t);else{const s=8/this._elementSize;let i=0;for(let n=0;n<s;++n)i<<=this._elementSize,i+=e;if(t===void 0)this._buffer.fill(i);else{const n=t+(8-t%8);for(let r=t;r<n;++r)this._setArrayElt(this._buffer,r,e);this._buffer.fill(i,n/8)}}}_getElementBitSize(){if(this._nextIndex)return Math.pow(2,Math.ceil(Math.log2(Math.log2(this._nextIndex))))}};function qu(t){let e=2;for(;e<t;)e*=2;return e}function Tl(t,e){return e==="any"?new Array(t):e==="float"?new Float32Array(t):e==="int8"?new Int8Array(t):e==="int16"?new Int16Array(t):e==="int32"?new Int32Array(t):e===32?new Uint32Array(t):e===16?new Uint16Array(t):new Uint8Array(Math.ceil(t/8*e))}var Hu=class{constructor(t){this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._flexArrays=[],this._defaultValues=[],this._flexArraysByName={},this._indexLists=[],this._name=t?"node":"edge",this._nextIndex=1,this._freeIndexes=[],this._indexesToBeFreed=[],this._idToIndex=Object.create(null),this._indexToId=[void 0],this._idFlexArray=new Aa({storage:"int32"}),this._idFlexArray.get=e=>this._indexToId[e],this._idFlexArray.getMultiple=e=>{const s=new Array(e.length);for(let i=0;i<e.length;++i)s[i]=this._indexToId[e[i]];return s},this._flexArraysByName.id=this._idFlexArray}addElements(t){const e=[];for(let s=0,i=t.length;s<i;++s){const n=t[s];let r=this._idToIndex[n];r===void 0&&(r=this._getNextIndex(),this._idToIndex[n]=r,this._indexToId[r]=n),e.push(r)}for(const s of this._flexArrays)s.grow(this._nextIndex);for(const s of this._indexLists)s.reserve(this._nextIndex);return new Uint32Array(e)}removeElements(t){for(let e=0,s=t.length;e<s;++e){const i=t[e],n=this._indexToId[i];n!==void 0&&(delete this._idToIndex[n],this._removeIndex(i))}}clear(){this._idToIndex=Object.create(null),this._indexToId=[void 0],this._nextIndex=1,this._freeIndexes=[];for(const t of this._flexArrays)t.reset();for(const t of this._indexLists)t.reset()}has(t){return this._indexToId[t]!==void 0}getIndex(t,e=!1){const s=this._idToIndex[t];if(s===void 0&&e)throw new Error(`${this._name} id "${t}" not found`);return s}createFlexArray(t,e){const{name:s}=t;if(s&&e&&this._flexArraysByName[s])throw new Error(`${this._name} flexArray "${s}" already exists`);let i=t.default;i===void 0&&t.storage!=="any"&&t.storage!=="resource"&&(i=0);const n=this._nextIndex,r={storage:t.storage,size:n,name:s,default:i};let o;return o=(i===void 0&&t.storage!=="any"&&t.storage,new Aa(r)),this._flexArrays.push(o),this._defaultValues.push(t.default),s&&e&&(this._flexArraysByName[s]=o),o}getFlexArray(t){return this._flexArraysByName[t]}getAllFlexArrays(){return this._flexArraysByName}createIndexList(){const t=new Um;return t.reserve(this._nextIndex),this._indexLists.push(t),t}getId(t){return this._indexToId[t]}getMaxIndex(){return this._nextIndex-1}_removeIndex(t){this._indexesToBeFreed.push(t)}_getNextIndex(){let t=this._freeIndexes.pop();return t===void 0&&(t=this._nextIndex++),t}freeIndexes(){for(const t of this._indexesToBeFreed)this._indexToId[t]=void 0,this._freeIndexes.push(t);for(let t=0;t<this._flexArrays.length;++t){const e=this._flexArrays[t],s=this._defaultValues[t];for(const i of this._indexesToBeFreed)e.set(i,s)}this._indexesToBeFreed=[]}},Gr=Ms("web-worker"),jm=!!Gr||typeof Worker<"u"&&typeof Blob<"u";function qm(t){return Gr?wd(t):t}function wd(t){if(ArrayBuffer.isView(t))return Array.from(t);if(Array.isArray(t)){for(let e=0;e<t.length;e++)t[e]=wd(t[e]);return t}if(ze(t)){const e=Object.keys(t);for(const s of e)t[s]=wd(t[s]);return t}return t}function Hm(t){return Gr?rb(t):nb(t)}function nb(t){const e=new Blob([t],{type:"application/javascript"}),s=URL.createObjectURL(e);return new Worker(s)}function rb(t){if(Gr)return new Gr("data:application/javascript,"+t.replace(/\n/g,""))}var ob=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function Rh(t,e=[0,0,0,0]){const s=ob.exec(t);return s?(e[0]=parseInt(s[1])/255,e[1]=parseInt(s[2])/255,e[2]=parseInt(s[3])/255,e[3]=s[4]===void 0?1:parseFloat(s[4]),e):null}function la(t){return t<16?"0"+t.toString(16):t.toString(16)}function Xm([t,e,s,i=1]){return`rgba(${256*t|0},${256*e|0},${256*s|0},${i})`}function Oh(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(s,i,n,r)=>i+i+n+n+r+r);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255,1]:null}var Ll=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"],Jn=[0,0,0,0],Vr=new Map;Vr.set(null,[0,0,0,0]),Vr.set("transparent",[0,0,0,0]);for(let t=0;t<Ll.length;t+=2){const e=Ll[t].toLowerCase(),s=Ll[t+1];Vr.set(e,Oh(s))}var Td,os=t=>{let e=Vr.get(t);if(e===void 0){const s=t+"",i=s.charAt(0)==="#"?Oh(s):Rh(s);Vr.set(t,i),e=i}return e},Ld=t=>{const e=os(t);if(!e)return null;const[s,i,n]=e;return`#${la(255*s)}${la(255*i)}${la(255*n)}`},Sn=t=>{let e=1,s=t;return s&&Rh(t,Jn)&&(s=`rgb(${255*+Jn[0]},${255*+Jn[1]},${255*+Jn[2]})`,e=parseFloat(Jn[3].toString())),{color:s,opacity:e}},Xu=Ms("xmldom");Td=typeof XMLSerializer<"u"?XMLSerializer:Xu?Xu.XMLSerializer:null;var Wm=class{constructor(t){this._attributes={},this._children=[],this._name=t}setAttribute(t,e){this._attributes[t]=e}appendChild(t){this._children.push(t)}get tagName(){return this._name}get children(){return this._children}get childNodes(){return this._children}get firstChild(){return this._children[0]||null}serialize(){const t=this._name,e=this._attributes,s=this._children,i=Object.keys(e).filter(r=>e[r]!==void 0).map(r=>` ${r}="${""+e[r]}"`).join(""),n=s.map(r=>r.serialize()).join("");return n.length?`<${t}${i}>${n}</${t}>`:`<${t}${i}/>`}cloneNode(t){const e=new Wm(this._name),s=Object.keys(this._attributes);for(const i of s)e.setAttribute(i,this._attributes[i]);if(t)for(let i=0;i<this._children.length;i++)e.appendChild(this._children[i].cloneNode(t));return e}},zh=class{constructor(t){this._text=t}serialize(){return this._text}cloneNode(){return new zh(this._text)}},ab=class{constructor(){this._children=[],this._meta=[],this._children=[],this._meta=[]}appendChild(t){this._children.push(t)}serialize(){return this._meta.concat(this._children.map(t=>t.serialize())).join("")}createElement(t){return new Wm(t)}createTextNode(t){return new zh(t)}},$m=()=>new ab;function Bh(t){if(Td)return new Td().serializeToString(t)}var Ym=()=>hi().implementation.createDocument("","",null),Zm=class{constructor(t){this._heap=[],this._size=0,this._keyToValue=t,this._keyToIndex=new Int32Array(t.length),this._keyToIndex.fill(-1)}add(t){let e=this._keyToIndex[t];e===-1&&(e=this._size++,this._heap[e]=t),this._keyToIndex[t]=this._bubble(e)}removeMin(){if(this._size===0)return NaN;const t=this._heap[0];return this._heap[0]=this._heap[--this._size],this._bubble(0),t}isEmpty(){return this._size===0}has(t){return this._keyToIndex[t]!==-1}_bubble(t){const e=this._indexToValue(t),s=this._getParentIndex(t),i=this._indexToValue(s);let n=t;if(t!==0&&i>e)n=this._swap(t,s);else{const r=this._getLeftChildIndex(t),o=this._getRightChildIndex(t),a=this._indexToValue(r),l=this._indexToValue(o),d=Math.min(e,a,l);d===e||(n=d===a?this._swap(t,r):this._swap(t,o))}return n===t?t:this._bubble(n)}_indexToValue(t){return t>=this._size?1/0:this._keyToValue[this._heap[t]]}_getParentIndex(t){return(t-1)/2|0}_getLeftChildIndex(t){return 2*t+1}_getRightChildIndex(t){return 2*t+2}_swap(t,e){const s=this._heap[t],i=this._heap[e];return this._heap[t]=i,this._heap[e]=s,this._keyToIndex[s]=e,this._keyToIndex[i]=t,e}},so=class{constructor(t,e){this._graph=t,this._nodes={elementList:t.nodeList,flexArray:t.createNodeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!0)},this._edges={elementList:t.edgeList,flexArray:t.createEdgeAttribute({storage:1,name:e},!!e),indexList:t.createIndexList(!1)}}_get(t){return t.isNode?this._nodes:this._edges}addOrRemoveElements(t,e){return e?this.addElements(t):this.removeElements(t)}addElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength();for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];s.get(o)!==1&&(s.set(o,1),i.pushUnchecked(o))}return e(i.slice(n))}removeElements(t){const{elementList:e,flexArray:s,indexList:i}=this._get(t),n=i.getLength(),r=i.getBuffer();if(n>r.length)return this.clear(),this.addElements(t),t;let o=0;for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];s.get(l)!==0&&(s.set(l,0),o+=1)}if(o===n)return e(i.sliceAndReset());if(o===0)return e();{const a=this._graph.acquireIndexList(t.isNode);let l=0;for(let d=0;d<n;++d){const h=r[d];s.get(h)===0?(l+=1,a.pushUnchecked(h)):r[d-l]=h}return i.setLength(n-o),e(a.sliceAndReset())}}hasElement(t){return!!this._get(t).flexArray.get(t._index)}clear(){this._nodes.indexList.isEmpty()||(this._nodes.indexList.reset(),this._nodes.flexArray.reset()),this._edges.indexList.isEmpty()||(this._edges.indexList.reset(),this._edges.flexArray.reset())}isEmpty(){return this._nodes.indexList.isEmpty()&&this._edges.indexList.isEmpty()}getElements(){return{nodes:this._nodes.elementList(this._nodes.indexList.slice()),edges:this._edges.elementList(this._edges.indexList.slice())}}};function lb(t,e,s,i=0){e===void 0&&(e=s=Math.sqrt(t.length/4)),s===void 0&&(s=e);const n=document.createElement("canvas"),r=n.getContext("2d");if(r){const o=r.createImageData(e,s);n.style.imageRendering="pixelated",n.style.border="1px solid black",n.style.margin="2px",n.style.position="absolute",n.style.top=n.style.left="0px",n.width=e,n.height=s,o.data.set(t),r.putImageData(o,0,0);const a=document.getElementById("graph-container");a&&(a.style.position="static"),setTimeout(()=>document.body.appendChild(n),i)}}var Uh=()=>({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}),je=class{constructor(t={}){const{xValues:e=[],yValues:s=[],scaledSizeValues:i=[],fixedSizeValues:n=[]}=t;this.minX=ii(e),this.minY=ii(s),this.maxX=In(e),this.maxY=In(s),this.minScaledSize=ii(i),this.maxScaledSize=In(i),this.minFixedSize=ii(n),this.maxFixedSize=In(n),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY}reset(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.minScaledSize=1/0,this.maxScaledSize=-1/0,this.minFixedSize=1/0,this.maxFixedSize=-1/0,this.width=0,this.height=0,this.cx=0,this.cy=0,this}addPoint(t,e,s,i){return this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,e),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,e),s!==void 0&&i!==void 0&&(i==="scaled"?(this.minScaledSize=Math.min(this.minScaledSize,s),this.maxScaledSize=Math.max(this.maxScaledSize,s)):(this.minFixedSize=Math.min(this.minFixedSize,s),this.maxFixedSize=Math.max(this.maxFixedSize,s))),this.cx=this.minX+(this.maxX-this.minX)/2,this.cy=this.minY+(this.maxY-this.minY)/2,this.width=this.maxX-this.minX,this.height=this.maxY-this.minY,this}computeForZoom(t){const e=Math.max(this.maxScaledSize,this.maxFixedSize/t);return je.from({minX:this.minX-e/2,minY:this.minY-e/2,maxX:this.maxX+e/2,maxY:this.maxY+e/2,width:this.width+e,height:this.height+e})}static from({minX:t,minY:e,maxX:s,maxY:i,width:n,height:r}={}){const o=new je;return t!=null&&(o.minX=t),e!=null&&(o.minY=e),s!=null&&(o.maxX=s),i!=null&&(o.maxY=i),s!=null&&t!=null&&(o.width=n||(s-t)/2,o.cx=(t+s)/2),i!=null&&e!=null&&(o.height=r||(i-e)/2,o.cy=(e+i)/2),o}static fromValues(t,e,s){let i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0;for(let d=0;d<t.length;d++){const h=t[d],u=e[d],c=s[d];h-c<i&&(i=h-c),u-c<n&&(n=u-c),h+c>r&&(r=h+c),u+c>o&&(o=u+c),c>a&&(a=c)}const l=je.from({minX:i,minY:n,maxX:r,maxY:o});return l.maxScaledSize=a,l}pad(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,this.width+=2*t,this.height+=2*t,this}isValid(){return isFinite(this.width)&&isFinite(this.height)}extend(t){return this.addPoint(t.minX,t.minY),this.addPoint(t.maxX,t.maxY),this}bottomLeft(){return{x:this.minX,y:this.minY}}topRight(){return{x:this.maxX,y:this.maxY}}},io=class{on(t,e){if(typeof t!="string")throw new TypeError("Event name must be string");if(typeof e!="function")throw new TypeError("Event handler must be function");const s=this._events=this._events||{};return(s[t]=s[t]||[]).push(e),this}off(t,e){if(typeof t!="string")throw new TypeError("Event name must be string");const s=this._events=this._events||{},i=s[t];if(Qe(i))if(typeof e!="function")s[t]=null;else{const n=i.indexOf(e);n!==-1&&i.splice(n,1),i.length===0&&(s[t]=null)}return this}fire(t,...e){if(typeof t!="string")throw new TypeError("Event name must be string");const s=(this._events=this._events||{})[t];if(Qe(s)){const i=e;for(let n=0;n<s.length;n++){const r=s[n];r&&r.apply(this,i)}}return this}once(t,e){const s=this,i=function(...n){e.apply(s,n),s.off(t,i)};return i.handler=e,this.on(t,i)}hasListener(t,e){if(!t||!e)return!1;const s=(this._events=this._events||{})[t];if(Qe(s))for(let i=0,n=s.length;i<n;i++){const r=s[i];if(r===e||r.handler===e)return!0}return!1}clearEvents(){this._events={}}getListeners(t){return(this._events=this._events||{})[t]}},db=8,Id=class{constructor(){this._BIG_LIST=255,this._MAX_LIST_SIZE=8,this._capacity=db,this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){return t===void 0&&(t=this._nextIndex++),t>=this._capacity&&this._reserve(t+1),this._sizes[t]=0,t}get(t){const e=this._sizes[t],s=this._MAX_LIST_SIZE*t;if(e<=this._MAX_LIST_SIZE){this._constList.length=e;for(let i=0,n=e;i<n;++i)this._constList[i]=this._buffer[s+i];return this._constList}if(e===this._BIG_LIST){const i=this._buffer[s];return this._bigLists[i]}throw new Error(`Table: ${t} out of bounds (${e})`)}size(t){const e=this._sizes[t];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=t[a],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._sizes[t],i=t*this._MAX_LIST_SIZE;if(s<this._MAX_LIST_SIZE)this._buffer[i+s]=e,this._sizes[t]=s+1;else if(s===this._BIG_LIST){const n=this._buffer[i];this._bigLists[n].push(e)}else{const n=new Array(this._MAX_LIST_SIZE);for(let r=0;r<this._MAX_LIST_SIZE;++r)n[r]=this._buffer[i+r];n.push(e),this._bigLists.push(n),this._sizes[t]=this._BIG_LIST,this._buffer[i]=this._bigLists.length-1}return this}removeFrom(t,e){return this.removeFromAndGetSize(t,e),this}removeFromAndGetSize(t,e){const s=this._MAX_LIST_SIZE*t;let i=this._sizes[t];if(i<=this._MAX_LIST_SIZE){for(let n=s,r=s+i;n<r;++n)if(this._buffer[n]===e)return i-=1,this._buffer[n]=this._buffer[r-1],this._sizes[t]=i,i}else if(i===this._BIG_LIST){const n=this._buffer[s],r=this._bigLists[n],o=r.indexOf(e);if(o!==-1)return r.splice(o,1),r.length}throw new Error('topology: Table: "removeFrom" failed, should not happen')}reserve(t){return this._capacity<t&&this._reserve(t),this}_reserve(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=Wu(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=Wu(this._sizes,this._capacity)}};function Wu(t,e){const s=new t.constructor(e);return s.set(t),s}function Km(t,e=1,s=0,i,n){if(!i||!n){const u=t.map(g=>[g.x,g.y]),c=Ih.from(u,g=>g.x,g=>g.y);i=Rr(c.triangles,u),n=Rr(c.hull,u)}if(!n)return[];const r=s*s,o=[],a={};for(let u=0;u<i.length;u+=3)if(hb(n,Gh(i[u],i[u+1],i[u+2]))){const c=cb(i[u],i[u+1],i[u+2]);c>r&&(o.push(u),a[u]=c)}if(o.length===0)return[];o.sort((u,c)=>a[u]-a[c]);let l=o[0],d=a[l];const h=[];for(let u=0;u<o.length;u++){const c=o[u],g=a[c];g>d&&g>r&&(l=c,d=g,h.push(l),h.length>e&&h.shift())}return h.map(u=>ub(i[u],i[u+1],i[u+2]))}function hb(t,e){const s=t.length,i=t[s-1],[n,r]=e;let[o,a]=i,l=!1;for(let d=0;d<s;d++){const h=t[d],[u,c]=h;c>r!=a>r&&n<(o-u)*(r-c)/(a-c)+u&&(l=!l),o=u,a=c}return l}function ub(t,e,s){const i=Gh(t,e,s);let n=0;for(let r=0;r<3;r++){const o=arguments[r],a=o[0]-i[0],l=o[1]-i[1],d=Math.sqrt(a*a+l*l);d>n&&(n=d)}return[i[0],i[1],n]}function cb(t,e,s){const[i,n]=Gh(t,e,s),[r,o]=t,a=i-r,l=n-o;return a*a+l*l}function Gh(t,e,s){const i=[(t[0]+e[0])/2,(t[1]+e[1])/2],n=[(e[0]+s[0])/2,(e[1]+s[1])/2],r=-1/((e[1]-t[1])/(e[0]-t[0])),o=-1/((s[1]-e[1])/(s[0]-e[0])),a=i[1]-r*i[0],l=(a-(n[1]-o*n[0]))/(o-r);return[l,r*l+a]}function el(t,e,s,i){let n;if(i)n=i;else{n=new Uint32Array(t.length);for(let c=0,g=t.length;c<g;c++)n[c]=c}function r(c,g,_,m,f,p){const y=_-p+1e-9*Math.max(_,p,1),b=m-c,x=f-g;return y>0&&y*y>b*b+x*x}function o(c,g,_,m,f,p,y){for(let b=0;b<m.length;++b){const x=m[b];if(!r(c,g,_,f[x],p[x],y[x]))return!1}return!0}function a(c,g,_,m,f,p){const y=m-c,b=f-g,x=p-_,v=Math.sqrt(y*y+b*b);return[(c+m+y/v*x)/2,(g+f+b/v*x)/2,(v+_+p)/2]}function l(c,g,_,m,f,p,y,b,x){const v=c-m,E=c-y,w=g-f,A=g-b,I=p-_,M=x-_,k=c*c+g*g-_*_,W=k-m*m-f*f+p*p,H=k-y*y-b*b+x*x,$=E*w-v*A,P=(w*H-A*W)/(2*$)-c,S=(A*I-w*M)/$,Y=(E*W-v*H)/(2*$)-g,st=(v*M-E*I)/$,at=S*S+st*st-1,Tt=2*(_+P*S+Y*st),ut=P*P+Y*Y-_*_,Mt=-(Math.abs(at)>1e-6?(Tt+Math.sqrt(Tt*Tt-4*at*ut))/(2*at):ut/Tt);return[c+P+S*Mt,g+Y+st*Mt,Mt]}function d(c,g,_,m){switch(c.length){case 1:const f=c[0];return function(w,A,I){return[w,A,I]}(g[f],_[f],m[f]);case 2:const[p,y]=c;return a(g[p],_[p],m[p],g[y],_[y],m[y]);case 3:const[b,x,v]=c;return l(g[b],_[b],m[b],g[x],_[x],m[x],g[v],_[v],m[v]);default:return null}}function h(c,g,_,m,f,p){const y=_-p,b=m-c,x=f-g;return y<0||y*y<b*b+x*x}function u(c,g,_,m,f){const p=_[g],y=m[g],b=f[g];if(o(p,y,b,c,_,m,f))return[g];for(let x=0;x<c.length;++x){const v=c[x],E=_[v],w=m[v],A=f[v];if(h(p,y,b,E,w,A)){const[I,M,k]=a(E,w,A,p,y,b);if(o(I,M,k,c,_,m,f))return[c[x],g]}}for(let x=0;x<c.length-1;++x)for(let v=x+1;v<c.length;++v){const E=c[x],w=c[v],A=_[E],I=m[E],M=f[E],k=_[w],W=m[w],H=f[w],$=a(A,I,M,k,W,H);if(h($[0],$[1],$[2],p,y,b)){const P=a(A,I,M,p,y,b);if(h(P[0],P[1],P[2],k,W,H)){const S=a(k,W,H,p,y,b);if(h(S[0],S[1],S[2],A,I,M)){const Y=l(A,I,M,k,W,H,p,y,b);if(o(Y[0],Y[1],Y[2],c,_,m,f))return[E,w,g]}}}}throw new Error}return n=function(g){for(let _=g.length-1;_>=0;_--){let m=Math.floor(Math.random()*(_+1));m=Math.max(Math.min(m,_),0);const f=g[_];g[_]=g[m],g[m]=f}return g}(n),s=s||new Array(t.length).fill(0),function(g,_,m,f,p){let y=null,b=[],x=0;for(;x<_;){const v=g[x];y&&r(y[0],y[1],y[2],m[v],f[v],p[v])?x++:(b=u(b,v,m,f,p),y=d(b,m,f,p),x=0)}return y}(n,n.length,t,e,s)}var Qm=[1/0,1/0,-1/0,-1/0];function Sa(t,e,s,i,n,r={x:0,y:0}){const o=Math.cos(n),a=Math.sin(n),l=t-s,d=e-i;return r.x=o*l-a*d+s,r.y=a*l+o*d+i,r}function gb(t,e,s=0,i={x:0,y:0}){return i.x=t.x+s*Math.sin(e),i.y=t.y+s*Math.cos(e),i}var Oe=(t,e,s,i)=>Math.hypot(t-s,e-i);function da(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}function Jm(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=e,t.y/=e,t}function Cd(t){return 180*t/Math.PI}function _b(t){return t*Math.PI/180}function tf(t,e){return t.minX-=e,t.minY-=e,t.maxX+=e,t.maxY+=e,t.width===void 0&&(t.width=t.maxX-t.minX),t.height===void 0&&(t.height=t.maxY-t.minY),t.width+=2*e,t.height+=2*e,t}function Vh(t,e,s,i,n,r){const o=i-t,a=n-e,l=Math.sqrt(o*o+a*a);if(l>s+r||l<Math.abs(s-r))return null;const d=(s*s-r*r+l*l)/(2*l),h=t+o*d/l,u=e+a*d/l,c=Math.sqrt(s*s-d*d),g=c/l*-a,_=o*(c/l);return[[h+g,u+_],[h-g,u-_]]}function jh(t,e,s,i,n,r){if(t-n>=0&&s-n<0)return 1;if(t-n<0&&s-n>=0)return-1;if(t-n==0&&s-n==0)return e-i>=0||i-r>=0?e-i:i-e;const o=(t-n)*(i-r)-(s-n)*(e-r);return o<0?1:o>0?-1:(t-n)*(t-n)+(e-r)*(e-r)-((s-n)*(s-n)+(i-r)*(i-r))}function mb([t,e,s],i,n){const r=Math.abs(t-i),o=Math.abs(e-n);return r+o<=s||!(r>s||o>s)&&Math.sqrt(r*r+o*o)<s+1e-12}function fb(t,e,s,i){const n=t[0]-e,r=t[1]-s,o=t[2]-i;return n*n+r*r<o*o+1e-6}function qh(t,e,s,i,n,r,o){const a=t-Math.max(i,Math.min(r,t)),l=e-Math.max(n,Math.min(o,e));return a*a+l*l<s*s}function ef(t,e,s,i,n,r,o,a={x:0,y:0}){const l=a||{x:0,y:0};let d,h,u,c;if(s===t){const p=t-n,y=o*o-p*p;if(y<0)return null;const b=Math.sqrt(y);d=t,u=t,h=r+b,c=r-b}else{const p=(i-e)/(s-t),y=e-p*t,b=y-r,x=p*p+1,v=2*(p*b-n),E=v*v-4*x*(n*n+b*b-o*o);if(E<0)return null;const w=-v,A=Math.sqrt(E),I=2*x;d=(w+A)/I,u=(w-A)/I,h=p*d+y,c=p*u+y}const g=t-d,_=e-h,m=t-u,f=e-c;return g*g+_*_<m*m+f*f?(l.x=d,l.y=h):(l.x=u,l.y=c),l}function Md({X:t,Y:e,sizes:s,indexes:i,R:n,center:r,gap:o=0,epsilon:a=.001,maxLoops:l=5,inPlace:d=!0}){const h=i.length,u=r[0],c=r[1];let g=h;d||(t=t.slice(),e=e.slice());const _=Vh,m=jh,f=i.slice().sort((M,k)=>m(t[M],e[M],t[k],e[k],u,c)),p=f[h-1],y=t[p],b=e[p];let x=!1;for(let M=0;M<g-1;M++){let k=M%h,W=(M+1)%h;M===-1&&(k=h-1,W=0),k=f[k],W=f[W];const H=t[k],$=e[k];let P=t[W],S=e[W];const Y=s[k]+s[W]+o;let st=m(H,$,P,S,u,c);if(st===-1&&x&&(st=1),!(Y>n)){if(st===1||Y-Oe(H,$,P,S)>a){const at=_(u,c,n,H,$,Y);if(at){const Tt=at[0];x=P>u&&Tt[0]<u,P=t[W]=Tt[0],S=e[W]=Tt[1]}}else x=!1;if(M%h==h-2){const at=f[h-1],Tt=f[0];if(e[at]>c&&e[Tt]>c&&t[at]-s[at]<t[Tt]+s[at]){let ut=0;for(g=Math.min(h*l,g+h);e[f[at]]>c&&e[f[0]]>c&&t[f[at]]<t[f[0]]&&++ut<h;){const Mt=f.pop();Mt&&f.unshift(Mt)}}}}}const v=y-u,E=b-c,w=t[p]-u,A=e[p]-c,I=v===w?0:Math.abs(Math.acos((v*w+E*A)/(Math.sqrt(v*v+E*E)*Math.sqrt(w*w+A*A))));if(I!==0){const M=Math.sin(-I),k=Math.cos(-I);let W;for(let H=0;H<h;H++){W=f[H];const $=t[W]-u,P=e[W]-c;t[W]=$*k-P*M+u,e[W]=$*M+P*k+c}}return{X:t,Y:e}}function $u(t,e,s,i,n,r){const o={},a=s[t];let l=a,d=0;const h=a*n;for(const u in e){const c=e[u];let g=0,_=0;for(let y=0,b=c.length;y<b;y++){const x=s[c[y]];_=Math.max(_,x),g+=2*x+i}const m=g/(2*Math.PI),f=_+l,p=r?d+Math.max(r,f):d*n;d=Math.max(f,d,m,h,p),o[u]=d,l=_}return o[0]=0,o[Number.POSITIVE_INFINITY]=d,o}function pb(t,e,s){return(e[0]-t[0])*(s[1]-t[1])-(e[1]-t[1])*(s[0]-t[0])}function Yu(t){const e=t.length,s=[0,1];let i=2;for(let n=2;n<e;n++){for(;i>1&&pb(t[s[i-2]],t[s[i-1]],t[n])<=0;)--i;s[i++]=n}return s.slice(0,i)}function yb(t){const e=t.length;if(e<3)return null;const s=new Array(e),i=new Array(e);for(let u=0;u<e;u++)s[u]=[+t[u][0],+t[u][1],u];s.sort((u,c)=>u[0]-c[0]||u[1]-c[1]);for(let u=0;u<e;u++)i[u]=[s[u][0],-s[u][1]];const n=Yu(s),r=Yu(i),o=r[r.length-1],a=n[n.length-1],l=r[0]===n[0],d=o===a?1:0,h=[];for(let u=n.length-1;u>=0;--u)h.push(t[s[n[u]][2]]);for(let u=+l;u<r.length-d;u++)h.push(t[s[r[u]][2]]);return h}var Zu=t=>--t*t*t+1,Ku=(t,e,s)=>{const i=t-s[0],n=e-s[1];return i*i+n*n},xb=(t,e)=>{let s=1/0,i=-1/0;for(let n=0;n<t.length;n++){const r=t[n],o=e?e[r]:r;s=Math.min(o,s),i=Math.max(o,i)}return{min:s,max:i}};function bb({X:t,Y:e,R:s,center:i,maxSteps:n=1e3,padding:r=5,epsilon:o=1e-9,damping:a=2,pinned:l=-1,indexes:d,onUpdate:h,pushSmallerOut:u=!0}){const c=d?d.length:t.length;let g=d;if(g===void 0){g=new Uint32Array(c);for(let x=0;x<c;x++)g[x]=x}else g=d;if(l!==-1)i=[t[l],e[l]];else if(!i){let x=0,v=0;for(let E=0;E<c;E++)x+=t[g[E]],v+=e[g[E]];i=[x/c,v/c]}const{min:_,max:m}=xb(g,s);function f(x,v){let E=0;for(let M=0;M<c-1;M++)for(let k=M+1;k<c;k++){if(M===k)continue;const W=g[M],H=g[k],$=t[W],P=e[W],S=s[W],Y=t[H],st=e[H],at=s[H],Tt=Y-$,ut=st-P,Mt=S+at+r,Nt=Tt*Tt+ut*ut;if(Nt<Mt*Mt-x){const _t=(Mt-Math.sqrt(Nt))*v,St=1/Nt,Zt=Tt*St*_t,Qt=ut*St*_t,Kt=Zt*Zt+Qt*Qt;if(H!==l){const mt=S/_;E+=Kt*mt,t[H]+=Zt*mt,e[H]+=Qt*mt}if(W!==l){const mt=at/_;E+=Kt*mt,t[W]-=Zt*mt,e[W]-=Qt*mt}}}const w=x*a*(1-v),A=i[0],I=i[1];for(let M=0;M<c;M++){const k=g[M];if(k!==l){const W=t[k],H=e[k],$=s[k],P=u?w*($/m):w,S=(W-A)*P,Y=(H-I)*P;E+=S*S+Y*Y,t[k]-=S,e[k]-=Y}}return E}g.sort((x,v)=>s[v]*Ku(t[v],e[v],i)-s[x]*Ku(t[x],e[x],i));let p=0,y=0;const b=Zu(1/c);for(let x=0;x<n&&(p=f(b,Zu((x+1)/n)),h&&setTimeout(()=>h(t,e)),!(Math.abs(p-y)<o));x++)y=p;return{X:t,Y:e}}var fo=t=>({data:t,next:null,prev:null});function sf(t,e=0,s=0){const i=t.length;if(i===0)return t;const n=t[0];if(n.x=e,n.y=s,i===1)return t;const r=t[1];if(n.x=e-r.radius,r.x=e+n.radius,r.y=s,i===2)return t;const o=t[2];Qu(r,n,o);let a=fo(n),l=fo(r),d=fo(o);a.next=d.prev=l,l.next=a.prev=d,d.next=l.prev=a;t:for(let h=3;h<i;h++){d=fo(t[h]),Qu(a.data,l.data,t[h]);let u=l.next,c=a.prev,g=l.data.radius,_=a.data.radius;do if(g<=_){if(Ju(u.data,d.data)){l=u,a.next=l,l.prev=a,--h;continue t}g+=u.data.radius,u=u.next}else{if(Ju(c.data,d.data)){a=c,a.next=l,l.prev=a,--h;continue t}_+=c.data.radius,c=c.prev}while(u!==c.next);d.prev=a,d.next=l,a.next=l.prev=l=d;let m=tc(a);for(;(d=d.next)!==l;){const f=tc(d);f<m&&(a=d,m=f)}l=a.next}return t}function Qu(t,e,s){const i=t.x-e.x;let n,r;const o=t.y-e.y,a=i*i+o*o;let l,d;a?(r=e.radius+s.radius,r*=r,d=t.radius+s.radius,d*=d,r>d?(n=(a+d-r)/(2*a),l=Math.sqrt(Math.max(0,d/a-n*n)),s.x=t.x-n*i-l*o,s.y=t.y-n*o+l*i):(n=(a+r-d)/(2*a),l=Math.sqrt(Math.max(0,r/a-n*n)),s.x=e.x+n*i-l*o,s.y=e.y+n*o+l*i)):(s.x=e.x+s.radius,s.y=e.y)}var vb=1e-6;function Ju(t,e){const s=t.radius+e.radius-vb,i=e.x-t.x,n=e.y-t.y;return s>0&&s*s>i*i+n*n}function tc(t){const e=t.data,s=t.next.data,i=e.radius+s.radius,n=(e.x*s.radius+s.x*e.radius)/i,r=(e.y*s.radius+s.y*e.radius)/i;return n*n+r*r}var Eb=16,Ab=class{constructor(t=Int32Array,e=Eb,s=8){this._BIG_LIST=new Uint8Array([-1])[0],this._ArrayType=t,this._capacity=e,this._MAX_LIST_SIZE=s,this._freeIndex=-1,this.clear()}clear(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE),this._sizes=new Uint8Array(this._capacity),this._bigLists=[],this._nextIndex=0,this._idToIndex={},this._constList=new Array(this._MAX_LIST_SIZE)}addEntry(t){let e;return this._freeIndex===-1?e=this._nextIndex++:(e=this._freeIndex,this._freeIndex=-1),this._idToIndex[t]=e,e>=this._capacity&&this._expand(e+1),this._sizes[e]=0,e}getItems(t){const e=this._idToIndex[t];if(e===void 0)return;const s=this._sizes[e],i=this._MAX_LIST_SIZE*e;if(s<=this._MAX_LIST_SIZE){this._constList.length=s;for(let n=0,r=s;n<r;++n)this._constList[n]=this._buffer[i+n];return this._constList}if(s===this._BIG_LIST){let n=this._buffer[i];return this._bigLists[n]}}removeEntry(t){const e=this._idToIndex[t];if(this._sizes[e]===this._BIG_LIST){const s=this._MAX_LIST_SIZE*e,i=this._buffer[s];this._bigLists[i].length=0}this._sizes[e]=0,this._freeIndex=e}size(t){const e=this._idToIndex[t];let s=this._sizes[e];return s<=this._MAX_LIST_SIZE?s:this._bigLists[this._buffer[e*this._MAX_LIST_SIZE]].length}sizes(t){const e=this._sizes,s=this._bigLists,i=this._buffer,n=this._MAX_LIST_SIZE,r=t.length,o=new Array(r);for(let a=0;a<r;a++){const l=this._idToIndex[t[a]],d=e[l];o[a]=d<=n?d:s[i[l*n]].length}return o}addTo(t,e){const s=this._idToIndex[t],i=this._sizes[s],n=s*this._MAX_LIST_SIZE;if(i<this._MAX_LIST_SIZE)this._buffer[n+i]=e,this._sizes[s]=i+1;else if(i===this._BIG_LIST){let r=this._buffer[n];this._bigLists[r].push(e)}else{let r=new Array(this._MAX_LIST_SIZE);for(let o=0;o<this._MAX_LIST_SIZE;++o)r[o]=this._buffer[n+o];r.push(e),this._bigLists.push(r),this._sizes[s]=this._BIG_LIST,this._buffer[n]=this._bigLists.length-1}}removeFrom(t,e){this.removeFromAndGetSize(t,e)}removeFromAndGetSize(t,e){const s=this._idToIndex[t];let i=this._sizes[s],n=this._MAX_LIST_SIZE*s;if(i<=this._MAX_LIST_SIZE){for(let r=n,o=n+i;r<o;++r)if(this._buffer[r]===e)return i-=1,this._buffer[r]=this._buffer[o-1],this._sizes[s]=i,i}else if(i===this._BIG_LIST){let r=this._buffer[n],o=this._bigLists[r],a=o.indexOf(e);if(a!==-1)return o.splice(a,1),o.length}}reserve(t){this._capacity<t&&this._expand(t)}_expand(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t))),this._buffer=ec(this._buffer,this._capacity*this._MAX_LIST_SIZE),this._sizes=ec(this._sizes,this._capacity)}has(t){const e=this._idToIndex[t];return!(e===void 0||e>=this._capacity)&&this._sizes[e]!==0}get averageSize(){let t=0;for(let e=0;e<this._capacity;e++)t+=this._sizes[e];return t/this._capacity}};function ec(t,e){let s=new t.constructor(e);return s.set(t),s}var tr,sc,er,yn,sr,Xi=[0,1],ha=[0,2];for(er=4;er<65535;er<<=2)for(tr=0,sc=Xi.length;tr<sc;tr++)Xi.push(Xi[tr]|er),ha.push((Xi[tr]|er)<<1);function ks(t,e){return(ha[255&e]|Xi[255&t])+65536*(ha[e>>8&255]|Xi[t>>8&255])+4294967296*(ha[e>>16&255]|Xi[t>>16&255])}function ic(t,e=[0,0]){if(t>0xffffffffffff)throw"Only morton codes up to 48 bits are supported.";if(!yn){yn={},sr={};for(var s=0;s<256;s++)yn[ks(s,0)]=s,sr[ks(0,s)]=s}var i=yn[21845&t],n=sr[43690&t];return t>65535&&(i|=yn[21845&(t/=65536)]<<8,n|=sr[43690&t]<<8,t>65535&&(i|=yn[21845&(t/=65536)]<<16,n|=sr[43690&t]<<16)),e[0]=i,e[1]=n,e}ks.code=function(e,s,i){if(e>24)throw"Morton codes are only supported up to Z=24";var n=1<<24-e;return ks(s*n,i*n)},ks.range=function(e,s,i){if(e>24)throw"Morton ranges are only supported up to Z=24";var n=1<<24-e,r=ks(s*n,i*n);return[r,r+n*n-1]},ks.reverse=ic,ks.decode=function(e,s){var i=ic(s),n=1<<24-e;return[i[0]/n,i[1]/n]},ks.min=function(e,s){var i=1431655765&e,n=1431655765&s,r=2863311530&e,o=2863311530&s;return Math.min(i,n)+Math.min(r,o)};var Sb=1e-6,wb=1e-12;function nf(){for(var t=arguments,e=t.length-1,s=e,i=[],n=0;n<=e&&Math.abs(t[n])<=wb;n++)e--;switch(e){case 1:Tb(t[s],t[s-1],i);break;case 2:Lb(t[s],t[s-1],t[s-2],i);break;case 3:Ib(t[s],t[s-1],t[s-2],t[s-3],i)}return i}function Tb(t,e,s=[]){return e!==0&&s.push(-t/e),s}function Lb(t,e,s,i=[]){var n=e/s,r=n*n-4*(t/s);if(r>0){var o=Math.sqrt(r);i.push(.5*(-n+o)),i.push(.5*(-n-o))}else r===0&&i.push(.5*-n);return i}function Ib(t,e,s,i,n=[]){var r,o,a=s/i,l=e/i,d=(3*l-a*a)/3,h=(2*a*a*a-9*l*a+27*(t/i))/27,u=a/3,c=h*h/4+d*d*d/27,g=h/2;if(Math.abs(c)<=Sb&&(c=0),c>0){var _=Math.sqrt(c);o=(r=-g+_)>=0?Math.pow(r,1/3):-Math.pow(-r,1/3),(r=-g-_)>=0?o+=Math.pow(r,1/3):o-=Math.pow(-r,1/3),n.push(o-u)}else if(c<0){var m=Math.sqrt(-d/3),f=Math.atan2(Math.sqrt(-c),-g)/3,p=Math.cos(f),y=Math.sin(f),b=Math.sqrt(3);n.push(2*m*p-u),n.push(-m*(p+b*y)-u),n.push(-m*(p-b*y)-u)}else r=g>=0?-Math.pow(g,1/3):Math.pow(-g,1/3),n.push(2*r-u),n.push(-r-u);return n}function pi(t,e,s,i,n,r,o,a,l,d,h){for(var u,c,g=Math.min(o,l),_=Math.min(a,d),m=Math.max(o,l),f=Math.max(a,d),p=nf((u=a-d)*(t+-2*s+n)+(c=l-o)*(e+-2*i+r),u*(-2*t+2*s)+c*(-2*e+2*i),u*t+c*e+(o*d-l*a)),y=0;y<p.length;y++){var b=p[y];if(0<=b&&b<=1){var x=t+(s-t)*b,v=e+(i-e)*b,E=x+(s+(n-s)*b-x)*b,w=v+(i+(r-i)*b-v)*b;if(o===l){if(_<=w&&w<=f){if(!h)return 1;h.push(E,w)}}else if(a===d){if(g<=E&&E<=m){if(!h)return 1;h.push(E,w)}}else if(E>=g&&w>=_&&E<=m&&w<=f){if(!h)return 1;h.push(E,w)}}}return h?h.length/2:0}function rf(t,e,s,i,n,r,o,a,l,d,h){return h?(pi(t,e,s,i,n,r,o,a,l,a,h),pi(t,e,s,i,n,r,l,a,l,d,h),pi(t,e,s,i,n,r,o,d,l,d,h),pi(t,e,s,i,n,r,o,a,o,d,h),h.length/2):o<=t&&l>=t&&a<=e&&d>=e||o<=n&&l>=n&&a<=r&&d>=r||pi(t,e,s,i,n,r,o,a,l,a)||pi(t,e,s,i,n,r,l,a,l,d)||pi(t,e,s,i,n,r,o,d,l,d)||pi(t,e,s,i,n,r,o,a,o,d)?1:0}function yi(t,e,s,i,n,r,o,a,l,d,h,u,c){for(var g,_,m=Math.min(l,h),f=Math.min(d,u),p=Math.max(l,h),y=Math.max(d,u),b=nf((g=d-u)*(-1*t+3*s+-3*n+o)+(_=h-l)*(-1*e+3*i+-3*r+a),g*(3*t+-6*s+3*n)+_*(3*e+-6*i+3*r),g*(-3*t+3*s)+_*(-3*e+3*i),g*t+_*e+(l*u-h*d)),x=0;x<b.length;x++){var v=b[x];if(0<=v&&v<=1){var E=t+(s-t)*v,w=e+(i-e)*v,A=s+(n-s)*v,I=i+(r-i)*v,M=E+(A-E)*v,k=w+(I-w)*v,W=M+(A+(n+(o-n)*v-A)*v-M)*v,H=k+(I+(r+(a-r)*v-I)*v-k)*v;if(l===h){if(f<=H&&H<=y){if(!c)return 1;c.push(W,H)}}else if(d===u){if(m<=W&&W<=p){if(!c)return 1;c.push(W,H)}}else if(W>=m&&H>=f&&W<=p&&H<=y){if(!c)return 1;c.push(W,H)}}}return c?c.length/2:0}function of(t,e,s,i,n,r,o,a,l,d,h,u,c){return c?(yi(t,e,s,i,n,r,o,a,l,d,h,d,c),yi(t,e,s,i,n,r,o,a,h,d,h,u,c),yi(t,e,s,i,n,r,o,a,l,u,h,u,c),yi(t,e,s,i,n,r,o,a,l,d,l,u,c),c.length/2):l<=t&&h>=t&&d<=e&&u>=e||l<=o&&h>=o&&d<=a&&u>=a||yi(t,e,s,i,n,r,o,a,l,d,h,d)||yi(t,e,s,i,n,r,o,a,h,d,h,u)||yi(t,e,s,i,n,r,o,a,l,u,h,u)||yi(t,e,s,i,n,r,o,a,l,d,l,u)?1:0}var nc=typeof Map>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}set(e,s){e in this._values||this._size++,this._values[e]=s}get(e){return this._values[e]}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Map,Cb=typeof Set>"u"?class{constructor(){this._values={},this._size=0}get size(){return this._size}has(e){return!!this._values[e]}add(e){e in this._values||this._size++,this._values[e]=!0}delete(e){e in this._values&&(delete this._values[e],this._size--)}keys(){return Object.keys(this._values)}clear(){this._values={},this._size=0}}:Set,af=class{constructor(){this._intersects=null,this._getBounds=null}setBoundsGetter(t){return this._getBounds=t,this}setIntersector(t){return this._intersects=t,this}},Mb=65536,Nb=16,Fb=16,Pb=class extends af{constructor(t,e,s=Fb,i=Mb,n=Int32Array,r=Nb){super(),this._occupied=0,this._idToCode=new nc,this._codeCache=[0,0,0],this.code=(o,a,l)=>l|ks(o,a)<<this._bitsForZoom,this.decode=(o,a)=>(ks.reverse(o>>this._bitsForZoom,a),a[2]=o&this._zoomMask,a),this._intersects=t,this._getBounds=e,this._cells=new Ab(n),this._offset=i,this._maxLevels=r,this._mortonMax=(1<<this._maxLevels)-1,this._bitsForZoom=Math.log2(this._maxLevels),this._zoomMask=(1<<this._bitsForZoom)-1,this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._min=-i,this._max=i,this._resolution=this._mortonMax/(this._max-this._min),this._minCellSize=s*this._resolution,this._bounds=new Array(4*this._maxLevels);for(let o=0;o<this._maxLevels;o++)this._bounds[4*o]=1/0,this._bounds[4*o+1]=1/0,this._bounds[4*o+2]=-1/0,this._bounds[4*o+3]=-1/0}setMinCellSize(t){return this._minCellSize=t,this}setOffset(t){return this._offset=t,this._min=-t,this._max=t,this._resolution=this._mortonMax/(this._max-this._min),this}insert(t,e,s,i,n){e===void 0&&([e,s,i,n]=this._getBounds(t));const r=Math.max(i-e,n-s);let o,a=this._minCellSize;for(o=0;a<r&&o<this._maxLevels-1;o++)a*=2;const l=this._resolution,d=this._min,h=l*(.5*(i+e)-d)/a|0,u=l*(.5*(n+s)-d)/a|0,c=this.code(h,u,o);this._cells.has(c)||this._cells.addEntry(c),this._cells.addTo(c,t),this._objectsAtLevel[o]++,this._occupied|=1<<o;const g=4*o,_=this._bounds;return h<_[g]&&(_[g]=h),u<_[g+1]&&(_[g+1]=u),h>_[g+2]&&(_[g+2]=h),u>_[g+3]&&(_[g+3]=u),this._idToCode.set(t,c),c}has(t){return this._idToCode.has(t)}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n)}remove(t){const e=this._idToCode.get(t);this.decode(e,this._codeCache);const s=this._codeCache[2];return--this._objectsAtLevel[s]==0&&(this._occupied&=~(1<<s),this._bounds[4*s]=1/0,this._bounds[4*s+1]=1/0,this._bounds[4*s+2]=-1/0,this._bounds[4*s+3]=-1/0),this._cells.removeFrom(e,t),this._idToCode.delete(t),this}query(t,e,s,i){const n=this._cells,r=this._bounds,o=this._intersects,a=this._min,l=this._resolution;let d=this._minCellSize,h=this._occupied;const u=[];for(let c=0;c<this._maxLevels&&h!==0;d*=2,h>>=1,c++){if(!(1&h))continue;const g=1/d,_=4*c,m=Math.max(r[_],l*(t-a)*g-1|0),f=Math.max(r[_+1],l*(e-a)*g-1|0),p=Math.min(r[_+2],l*(s-a)*g+1|0),y=Math.min(r[_+3],l*(i-a)*g+1|0);for(let b=m;b<=p;b++)for(let x=f;x<=y;x++){const v=this.code(b,x,c),E=n.getItems(v);if(E!==void 0)for(let w=0;w<E.length;w++){const A=E[w];o(A,t,e,s,i)&&u.push(A)}}}return u}traverse(t,e,s,i,n){const r=this._cells,o=this._bounds,a=this._intersects,l=this._min,d=this._resolution;let h=this._minCellSize,u=this._occupied;const c=[];for(let g=0;g<this._maxLevels&&u!==0;h*=2,u>>=1,g++){if(!(1&u))continue;const _=1/h,m=4*g,f=Math.max(o[m],d*(t-l)*_-1|0),p=Math.max(o[m+1],d*(e-l)*_-1|0),y=Math.min(o[m+2],d*(s-l)*_+1|0),b=Math.min(o[m+3],d*(i-l)*_+1|0);for(let x=f;x<=y;x++)for(let v=p;v<=b;v++){const E=this.code(x,v,g),w=r.getItems(E);if(w!==void 0)for(let A=0;A<w.length;A++){const I=w[A];if(a(I,t,e,s,i)&&(c.push(I),n(I)))return c}}}return c}collisions(t,e=this._getBounds){if(typeof e!="function")throw new Error("getBounds function is required to get the object bounds");const s=Array.from(this._idToCode.keys()),i=this._min,n=this._resolution,r=this._cells,o=new nc,a=[];for(let l=0;l<s.length;l++){let d=0,h=this._minCellSize,u=this._occupied;const c=s[l];let[g,_,m,f]=e(c);const p=Math.max(m-g,f-_);for(d=0;h<p;d++)h*=2,u>>=1;g=n*(g-i),_=n*(_-i),m=n*(m-i),f=n*(f-i);for(let y=d;y<this._maxLevels&&u!==0;h*=2,u>>=1,y++){if(!(1&u))continue;const b=1/h,x=_*b-1|0,v=m*b+1|0,E=f*b+1|0;for(let w=g*b-1|0;w<=v;w++)for(let A=x;A<=E;A++){const I=this.code(w,A,y);if(o.get(I)===l)continue;o.set(I,l);const M=r.getItems(I);if(M!==void 0)for(let k=0;k<M.length;k++){const W=M[k],[H,$,P,S]=this._getBounds(W);W!==c&&t(c,H,$,P,S)&&a.push(c,W)}}}}return Db(a)}clear(){this._occupied=0,this._cells.clear(),this._idToCode.clear(),this._objectsAtLevel=new Array(this._maxLevels).fill(0),this._bounds=new Array(4*this._maxLevels);for(let t=0;t<this._maxLevels;t++)this._bounds[4*t]=1/0,this._bounds[4*t+1]=1/0,this._bounds[4*t+2]=-1/0,this._bounds[4*t+3]=-1/0;return this}keyToBBox(t){const[e,s,i]=this.decode(t,[0,0,0]),n=this._minCellSize*(1<<i),r=this._min,o=this._resolution;return[e*n/o+r,s*n/o+r,(e+1)*n/o+r,(s+1)*n/o+r]}keys(){return Object.keys(this._cells._idToIndex)}get averageCellOccupancy(){return this._cells.averageSize}get size(){return this._idToCode.size}getBoxes(){return Array.from(this._idToCode.keys()).map(t=>this._getBounds(t))}};function Db(t){const e=new Cb,s=[];for(let i=0;i<t.length;i+=2){const n=t[i],r=t[i+1],o=n<r?n*r+(r-n-1)*(r-n-1)/4:n*r+(n-r-1)*(n-r-1)/4;e.has(o)||(e.add(o),s.push(n,r))}return s}function kb(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function ti(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}var Js=(t,e,s,i,n,r)=>({minX:t,minY:e,maxX:s,maxY:i,leaf:!0,level:r,parent:n,objects:[],final:!1,children:null});function lf(t){const{minX:e,minY:s,maxX:i,maxY:n}=t;return[e,s,i,n]}function _r(t,e,s,i,n,r,o,a){return t>=n&&s<=o&&e>=r&&i<=a}var Rb=0,Ob=1,zb=2,Bb=3;function po(t,e,s,i,n,r,o,a){const l=(r+a)/2,d=(e+i)/2;return(t+s)/2<=(n+o)/2?d<=l?Rb:Ob:d<=l?Bb:zb}var Ub=t=>t,wn=class extends af{constructor(t=Ub,e=10,s,i=0){super(),this._nodeCapacity=10,this._root=null,this._objects={},this._size=0,this._rootLevel=0,this._maxLevel=30,this._idToCell={},this._nodeCapacity=e,this._root=null,this._getBounds=t,this._rootLevel=i,this._maxLevel=i+30,this._idToCell={},s&&(this._root=Js(s[0],s[1],s[2],s[3],null,i))}get size(){return this._size}get root(){return this._root}clear(){return this._root=null,this._objects={},this._size=0,this._idToCell={},this._rootLevel=0,this._maxLevel=this._rootLevel+30,this}insert(t,e,s,i,n,r=this._root){if(e||([e,s,i,n]=this._getBounds(t)),this._objects[t])return;if(this._objects[t]=!0,this._size++,!this._root){const g=Math.max(Math.abs(i-e),Math.abs(n-s));return this._root=Js(e,s,e+g,s+g,null,this._rootLevel),this._idToCell[t]=[this._root],this._root.objects=[t],t}let o,a=[r],l=!1;const d=this._nodeCapacity,h=this._idToCell,u=this._maxLevel;let c;for(;c=a.pop();){o=c;const{minX:g,minY:_,maxX:m,maxY:f}=o;ti(e,s,i,n,g,_,m,f)&&(o.leaf?o.objects&&(o.objects.length<d||o.final)?(o.objects.push(t),h[t]?h[t].push(o):h[t]=[o],l=!0,(o.level>=u||Math.abs(m-g)<=Math.abs(i-e)||Math.abs(f-_)<=Math.abs(n-s))&&(o.final=!0)):(this.splitNode(o),a.push(o)):a.push.apply(a,o.children))}if(!_r(e,s,i,n,(r=this._root).minX,r.minY,r.maxX,r.maxY)){let g=this._rootLevel;for(;!_r(e,s,i,n,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){r=this._root;const{minX:_,minY:m,maxX:f,maxY:p}=r;let y=_,b=m,x=f,v=p;const E=Math.abs(f-_),w=Math.abs(p-m);if(w===0&&E===0)break;const A=Math.max(E,w);e<_?(y-=A,s<m?b-=A:v+=A):(x+=A,s<m?b-=A:v+=A);const I=Js(y,b,x,v,null,--g);this.splitNode(I),I.children[po(_,m,f,p,y,b,x,v)]=r,this._root=r.parent=I}for(a=[this._root],this._root.level=this._rootLevel;c=a.shift();)if(o=c,!o.leaf)for(let _=0;_<4;_++){const m=o.children[_];m.level=o.level+1,a.push(m)}r=this._root;for(let _=0;_<4;_++){const m=r.children[_];m&&m.leaf&&m.objects&&(m.objects.push(t),h[t]?h[t].push(m):h[t]=[m])}}return l?t:void 0}removeById(t){if(!this._objects[t])return t;this._size--;const e=this._idToCell[t];for(let s=0;s<e.length;s++){const i=e[s].objects||[];for(let n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}}return delete this._objects[t],delete this._idToCell[t],t}remove(t){const[e,s,i,n]=this._getBounds(t),r=[this._root];let o,a;const l=[];for(;o=r.pop();)if(ti(e,s,i,n,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const d=o.objects||[];for(let h=0,u=d.length;h<u;h++)if(d[h]===t){d.splice(h,1),u===1&&l.push(o);break}}else r.push.apply(r,o.children);if(delete this._idToCell[t],delete this._objects[t],this._size--,l.length)for(;a=l.pop();){let d=a.parent,h=!0;for(;d&&h;){if(!d.leaf){for(let u=0;u<4;u++)if(o=d.children[u],!o.leaf||o.objects&&o.objects.length!==0){h=!1;break}h&&(d.leaf=!0,d.children=[],d.objects=[])}d=d.parent}}return t}splitNode(t){const{minX:e,minY:s,maxX:i,maxY:n}=t,r=(e+i)/2,o=(s+n)/2,a=t.level+1,l=this._idToCell,d=this._maxLevel,h=[Js(e,s,r,o,t,a),Js(e,o,r,n,t,a),Js(r,o,i,n,t,a),Js(r,s,i,o,t,a)];if(t.objects!==null){const u=t.objects,c=this._getBounds;for(let g=0,_=u.length;g<_;g++){const m=u[g],f=c(m);let p=l[m];for(let y=0;y<4;y++){const b=h[y],{minX:x,minY:v,maxX:E,maxY:w}=b;ti(f[0],f[1],f[2],f[3],x,v,E,w)&&(b.objects&&b.objects.push(m),(b.level>=d||Math.abs(E-x)<=Math.abs(f[2]-f[0])||Math.abs(w-v)<=Math.abs(f[3]-f[1]))&&(b.final=!0),p?p.push(b):p=[b])}p&&p.splice(p.indexOf(t),1)}}t.children=h,t.objects=null,t.leaf=!1}point(t,e,s){let i=[];const n=[this._root];let r,o,a;const l=this._getBounds;for(;r=n.pop();)if(t>=r.minX&&t<=r.maxX&&e>=r.minY&&e<=r.maxY){if(r.leaf){s&&r.objects&&(i=r.objects);const d=r.objects||[];for(let h=0,u=d.length;h<u;h++)a=d[h],o=l(a),t>=o[0]&&t<=o[2]&&e>=o[1]&&e<=o[3]&&i.push(a);break}n.push.apply(n,r.children)}return i.length?i:null}neigbours(t,e){let s,i=[];const n=[this._root];for(;s=n.pop();)if(t>=s.minX&&t<=s.maxX&&e>=s.minY&&e<=s.maxY){if(s.leaf){i=s.objects;break}n.push.apply(n,s.children)}return i}query(t,e,s,i){const n=[],r=[this._root];let o,a,l;const d=this._getBounds,h={},u=this._intersects;let c;for(;o=r.pop();)if(ti(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY))if(o.leaf){const g=o.objects||[];for(let _=0,m=g.length;_<m;_++)l=g[_],h[l]||(a=d(l),ti(t,e,s,i,a[0],a[1],a[2],a[3])&&(u&&!u(l,t,e,s,i)||n.push(l)),h[l]=!0)}else c=po(t,e,s,i,o.minX,o.minY,o.maxX,o.maxY),r.push(o.children[(c+3)%4],o.children[(c+2)%4],o.children[(c+1)%4],o.children[c]);return n}traverse(t,e,s,i,n){const r=[],o=[this._root];let a,l,d;const h=this._getBounds,u={},c=this._intersects;let g;for(;a=o.pop();)if(ti(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY))if(a.leaf){const _=a.objects||[];for(let m=0,f=_.length;m<f;m++)if(d=_[m],!u[d]){if(l=h(d),ti(t,e,s,i,l[0],l[1],l[2],l[3])&&(!c||c(d,t,e,s,i))&&(r.push(d),n(d)))return r;u[d]=!0}}else g=po(t,e,s,i,a.minX,a.minY,a.maxX,a.maxY),o.push(a.children[(g+3)%4],a.children[(g+2)%4],a.children[(g+1)%4],a.children[g]);return r}getOverlaps(){const t=[this._root];let e,s,i;const n=[],r=this._getBounds,o={};for(;e=t.pop();)if(e.leaf){const a=e.objects||[],l=a.length;for(let d=0;d<l;d++)for(let h=0;h<l;h++)if(s=a[d],i=a[h],d!==h&&!o[s+":"+i]&&!o[i+":"+s]){o[s+":"+i]=!0;const u=r(s),c=r(i);ti(u[0],u[1],u[2],u[3],c[0],c[1],c[2],c[3])&&n.push(s,i)}}else t.push.apply(t,e.children);return n}cover(t,e,s,i){if(this._root===null)return this._root=Js(t,e,s,i,null,0),this;let n=this._root;if(!_r(t,e,s,i,n.minX,n.minY,n.maxX,n.maxY)){let r=this._rootLevel;for(;!_r(t,e,s,i,this._root.minX,this._root.minY,this._root.maxX,this._root.maxY);){n=this._root;const{minX:d,minY:h,maxX:u,maxY:c}=n;let g=d,_=h,m=u,f=c;const p=Math.abs(u-d),y=Math.abs(c-h);if(y===0&&p===0)break;const b=Math.max(p,y);t<d?(g-=b,e<h?_-=b:f+=b):(m+=b,e<h?_-=b:f+=b);const x=Js(g,_,m,f,null,--r);this.splitNode(x),x.children[po(d,h,u,c,g,_,m,f)]=n,this._root=n.parent=x}const o=[this._root];let a,l;for(this._root.level=this._rootLevel;a=o.shift();)if(l=a,!l.leaf)for(let d=0;d<4;d++){const h=l.children[d];h.level=l.level+1,o.push(h)}}return this}getAll(){return Object.keys(this._objects).map(t=>Number(t))}forEach(t,e){const s=[this._root];let i;for(;i=s.pop();)if(i.leaf&&i.objects)for(let n=0,r=i.objects.length;n<r;n++)t.call(e,i.objects[n]);else s.push.apply(s,i.children);return this}getLeafs(){const t=[this._root],e=[];let s;for(;s=t.pop();)s.leaf?e.push(s):t.push.apply(t,s.children);return e}traverseFromRoot(t,e){const s=[this._root];let i;for(;i=s.pop();)t.call(e,i,i.objects)||i.leaf||s.push.apply(s,i.children);return this}update(t,e,s,i,n){return this.remove(t),this.insert(t,e,s,i,n),this}getNodeBounds(t){return lf(t)}};wn.flatAccessor=(t,e)=>s=>{const i=e*s;return t.slice(i,i+e)},wn.inside=_r,wn.intersects=kb,wn.overlaps=ti,wn.getNodeBBox=lf;var df=wn;function Gb(t){const e=+this._x.call(null,t),s=+this._y.call(null,t);return hf(this.cover(e,s),e,s,t)}function hf(t,e,s,i){if(isNaN(e)||isNaN(s))return t;var n,r,o,a,l,d,h,u,c,g=t._root,_={data:i},m=t._x0,f=t._y0,p=t._x1,y=t._y1;if(!g)return t._root=_,t;for(;g.length;)if((d=e>=(r=(m+p)/2))?m=r:p=r,(h=s>=(o=(f+y)/2))?f=o:y=o,n=g,!(g=g[u=h<<1|d]))return n[u]=_,t;if(a=+t._x.call(null,g.data),l=+t._y.call(null,g.data),e===a&&s===l)return _.next=g,n?n[u]=_:t._root=_,t;do n=n?n[u]=new Array(4):t._root=new Array(4),(d=e>=(r=(m+p)/2))?m=r:p=r,(h=s>=(o=(f+y)/2))?f=o:y=o;while((u=h<<1|d)==(c=(l>=o)<<1|a>=r));return n[c]=g,n[u]=_,t}function Vb(t){var e,s,i,n,r=t.length,o=new Array(r),a=new Array(r),l=1/0,d=1/0,h=-1/0,u=-1/0;for(s=0;s<r;++s)isNaN(i=+this._x.call(null,e=t[s]))||isNaN(n=+this._y.call(null,e))||(o[s]=i,a[s]=n,i<l&&(l=i),i>h&&(h=i),n<d&&(d=n),n>u&&(u=n));if(l>h||d>u)return this;for(this.cover(l,d).cover(h,u),s=0;s<r;++s)hf(this,o[s],a[s],t[s]);return this}function jb(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var s=this._x0,i=this._y0,n=this._x1,r=this._y1;if(isNaN(s))n=(s=Math.floor(t))+1,r=(i=Math.floor(e))+1;else{for(var o,a,l=n-s||1,d=this._root;s>t||t>=n||i>e||e>=r;)switch(a=(e<i)<<1|t<s,(o=new Array(4))[a]=d,d=o,l*=2,a){case 0:n=s+l,r=i+l;break;case 1:s=n-l,r=i+l;break;case 2:n=s+l,i=r-l;break;case 3:s=n-l,i=r-l}this._root&&this._root.length&&(this._root=d)}return this._x0=s,this._y0=i,this._x1=n,this._y1=r,this}function qb(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function Hb(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function cs(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n}function Xb(t,e,s){var i,n,r,o,a,l,d,h=this._x0,u=this._y0,c=this._x1,g=this._y1,_=[],m=this._root;for(m&&_.push(new cs(m,h,u,c,g)),s==null?s=1/0:(h=t-s,u=e-s,c=t+s,g=e+s,s*=s);l=_.pop();)if(!(!(m=l.node)||(n=l.x0)>c||(r=l.y0)>g||(o=l.x1)<h||(a=l.y1)<u))if(m.length){var f=(n+o)/2,p=(r+a)/2;_.push(new cs(m[3],f,p,o,a),new cs(m[2],n,p,f,a),new cs(m[1],f,r,o,p),new cs(m[0],n,r,f,p)),(d=(e>=p)<<1|t>=f)&&(l=_[_.length-1],_[_.length-1]=_[_.length-1-d],_[_.length-1-d]=l)}else{var y=t-+this._x.call(null,m.data),b=e-+this._y.call(null,m.data),x=y*y+b*b;if(x<s){var v=Math.sqrt(s=x);h=t-v,u=e-v,c=t+v,g=e+v,i=m.data}}return i}function Wb(t){if(isNaN(r=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,s,i,n,r,o,a,l,d,h,u,c,g=this._root,_=this._x0,m=this._y0,f=this._x1,p=this._y1;if(!g)return this;if(g.length)for(;;){if((d=r>=(a=(_+f)/2))?_=a:f=a,(h=o>=(l=(m+p)/2))?m=l:p=l,e=g,!(g=g[u=h<<1|d]))return this;if(!g.length)break;(e[u+1&3]||e[u+2&3]||e[u+3&3])&&(s=e,c=u)}for(;g.data!==t;)if(i=g,!(g=g.next))return this;return(n=g.next)&&delete g.next,i?(n?i.next=n:delete i.next,this):e?(n?e[u]=n:delete e[u],(g=e[0]||e[1]||e[2]||e[3])&&g===(e[3]||e[2]||e[1]||e[0])&&!g.length&&(s?s[c]=g:this._root=g),this):(this._root=n,this)}function $b(t){for(var e=0,s=t.length;e<s;++e)this.remove(t[e]);return this}function Yb(){return this._root}function Zb(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function Kb(t){var e,s,i,n,r,o,a=[],l=this._root;for(l&&a.push(new cs(l,this._x0,this._y0,this._x1,this._y1));e=a.pop();)if(!t(l=e.node,i=e.x0,n=e.y0,r=e.x1,o=e.y1)&&l.length){var d=(i+r)/2,h=(n+o)/2;(s=l[3])&&a.push(new cs(s,d,h,r,o)),(s=l[2])&&a.push(new cs(s,i,h,d,o)),(s=l[1])&&a.push(new cs(s,d,n,r,h)),(s=l[0])&&a.push(new cs(s,i,n,d,h))}return this}function Qb(t){var e,s=[],i=[];for(this._root&&s.push(new cs(this._root,this._x0,this._y0,this._x1,this._y1));e=s.pop();){var n=e.node;if(n.length){var r,o=e.x0,a=e.y0,l=e.x1,d=e.y1,h=(o+l)/2,u=(a+d)/2;(r=n[0])&&s.push(new cs(r,o,a,h,u)),(r=n[1])&&s.push(new cs(r,h,a,l,u)),(r=n[2])&&s.push(new cs(r,o,u,h,d)),(r=n[3])&&s.push(new cs(r,h,u,l,d))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function Jb(t){return t[0]}function tv(t){return arguments.length?(this._x=t,this):this._x}function ev(t){return t[1]}function sv(t){return arguments.length?(this._y=t,this):this._y}function uf(t,e,s){var i=new Hh(e??Jb,s??ev,NaN,NaN,NaN,NaN);return t==null?i:i.addAll(t)}function Hh(t,e,s,i,n,r){this._x=t,this._y=e,this._x0=s,this._y0=i,this._x1=n,this._y1=r,this._root=void 0}function rc(t){for(var e={data:t.data},s=e;t=t.next;)s=s.next={data:t.data};return e}var ds=uf.prototype=Hh.prototype;ds.copy=function(){var t,e,s=new Hh(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return s;if(!i.length)return s._root=rc(i),s;for(t=[{source:i,target:s._root=new Array(4)}];i=t.pop();)for(var n=0;n<4;++n)(e=i.source[n])&&(e.length?t.push({source:e,target:i.target[n]=new Array(4)}):i.target[n]=rc(e));return s},ds.add=Gb,ds.addAll=Vb,ds.cover=jb,ds.data=qb,ds.extent=Hb,ds.find=Xb,ds.remove=Wb,ds.removeAll=$b,ds.root=Yb,ds.size=Zb,ds.visit=Kb,ds.visitAfter=Qb,ds.x=tv,ds.y=sv;var ir=function(t,e,s,i,n){this.node=t,this.x0=e,this.y0=s,this.x1=i,this.y1=n},iv=function(t){const e=[];let s,i,n,r,o,a,l,d=this._root;for(d&&e.push(new ir(d,this._x0,this._y0,this._x1,this._y1));(s=e.pop())&&(l=t(d=s.node,n=s.x0,r=s.y0,o=s.x1,a=s.y1),l!=="break");)if(!l&&d.length){const h=(n+o)/2,u=(r+a)/2;(i=d[3])&&e.push(new ir(i,h,u,o,a)),(i=d[2])&&e.push(new ir(i,n,u,h,a)),(i=d[1])&&e.push(new ir(i,h,r,o,u)),(i=d[0])&&e.push(new ir(i,n,r,h,u))}return this};function Xh(t,e,s,i,n){const r=new Array(t.length);for(let o=0;o<e.length;o++){const a=i[e[o]],l=i[s[o]];r[a]=r[a]||[],r[a].push(l),n&&(r[l]=r[l]||[],r[l].push(a))}return r}function jr(t,e){return t[e]===-1?e:jr(t,t[e])}function nv(t,e,s){const i=jr(t,e),n=jr(t,s);t[i]=n}function rv(t,e,s,i=!1){const n=new Int32Array(t.length),r={};for(let o=0;o<t.length;o++)n[o]=-1,r[t[o]]=o;for(let o=0;o<e.length;o++){const a=r[e[o]],l=r[s[o]];if(i&&a===l)return!0;const d=jr(n,a),h=jr(n,l);if(d===h)return!0;nv(n,d,h)}return!1}function cf(t,e,s,i,n,r,o,a){if(i[t]=n,s[t])return!0;if(e[t])return!1;e[t]=1,s[t]=1;const l=r[t];if(l){for(const d of l)if(cf(d,e,s,i,t,r,o,a))return o.push(a[d]),!0}return s[t]=0,!1}function gf(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Uint8Array(i),o=new Int32Array(i),a={};for(let d=0;d<i;d++)a[t[d]]=d;const l=Xh(t,e,s,a,!1);for(let d=0;d<i;d++){const h=[];if(cf(d,n,r,o,-1,l,h,t)&&h.length>1){const u=h[0];for(let c=1;c<h.length;c++)if(h[c]===u){h.length=c;break}return h.push(u),h.reverse()}}return!1}function _f(t,e,s,i,n,r,o){e[t]=1,i[t]=s;const a=n[t];if(a){for(const l of a)if(e[l]){if(l!==s)return i[l]=t,r.push(o[l]),!0}else if(_f(l,e,t,i,n,r,o))return r.push(o[l]),!0}return!1}function ov(t,e,s){const i=t.length,n=new Uint8Array(i),r=new Int32Array(i),o={};for(let l=0;l<i;l++)o[t[l]]=l,r[l]=-1;const a=Xh(t,e,s,o,!0);for(let l=0;l<e.length;l++){const d=o[e[l]],h=o[s[l]];a[d]=a[d]||[],a[d].push(h)}for(let l=0;l<i;l++){const d=l,h=[];if(!n[d]&&_f(d,n,-1,r,a,h,t))return!0}return!1}uf.prototype.visit2=iv;var mf=class{constructor(t,e,s){this.cycles=[],this.visitedLength=0,this.visitedStack=[],this.stack=[],this.idToIndex={},this.removed={},this.nodes=t,this.visited=new Uint8Array(this.nodes.length);for(let i=0;i<t.length;i++)this.idToIndex[t[i]]=i;this.adjacency=Xh(t,e,s,this.idToIndex)}getCycles(){this.visited=new Uint8Array(this.nodes.length),this.visitedStack=[];for(let t=0;t<this.nodes.length;t++)for(this.backtrack(t,t);this.visitedLength!==0;){const e=this.visitedStack.pop();e!==void 0&&this.visited[e]&&(this.visited[e]=0,this.visitedLength--)}return this.cycles}backtrack(t,e){let s=!1;this.stack.push(e),this.visited[e]||(this.visited[e]=1,this.visitedLength++),this.visitedStack.push(e);const i=this.adjacency[e]||[];for(const n of i)if(this.removed[e]=this.removed[e]||{},!this.removed[e][n]){if(n<t)this.removed[e][n]=!0;else if(n===t){s=!0;const r=[];for(let o=0,a=!1;o<this.stack.length;o++){const l=this.stack[o];t===l&&(a=!0),a&&r.push(this.nodes[l])}this.cycles.push(r)}else if(!this.visited[n]){const r=this.backtrack(t,n);s=s||r}}if(s){let n;do n=this.visitedStack.pop(),this.visited[n]&&(this.visited[n]=0,this.visitedLength--);while(n!==e)}return this.stack.pop(),s}};function av(){return{index:{},parent:[],count:0}}function lv(t,e){t.index[e]===void 0&&(t.count+=1,t.index[e]=t.parent.push(-t.count))}function oc(t,e){let s=t.index[e];if(s===void 0)return-1;for(;s>=0;)e=s,s=t.parent[s];return e}function dv(t,e,s){t.parent[s]=e,t.count-=1}function hv(t){return t.count<=1}function ff(t,e,s,i,n){n&&e.sort((a,l)=>n(a)-n(l));const r=[],o=av();t.forEach(a=>lv(o,a));for(let a=0;a<e.length&&!hv(o);a++){const l=oc(o,s(e[a])),d=oc(o,i(e[a]));l!==d&&l>0&&d>0&&(dv(o,l,d),r.push(e[a]))}return r}function pf({adjacency:t,directed:e=!1,normalized:s=!0}){const i=[],n=[],r={},o={},a={},l={};let d;const h=new Array(t.length),u={},c={},g={};for(let y=0;y<t.length;y++){const b=t[y];g[b.id]=b.adj,u[b.id]=!0,c[b.id]=y,e||b.adj.forEach(x=>{u[x]=!0})}const _=Object.keys(u).map(y=>+y);for(let y=0;y<_.length;y++)h[y]=0;for(let y=0;y<_.length;y++)d=_[y],p(d),f();const m=s?_.length>2?1/((_.length-1)*(_.length-2)):0:e?0:.5;if(m)for(let y=0;y<h.length;y++)h[y]*=m;return h;function f(){for(let y=0;y<_.length;y++)l[_[y]]=0;for(;n.length;){const y=n.pop(),b=(1+l[y])/a[y],x=r[y];for(let v=0;v<x.length;++v){const E=x[v];l[E]+=a[E]*b}y!==d&&(h[c[y]]+=l[y])}}function p(y){for(let b=0;b<_.length;b++){const x=_[b];r[x]=[],o[x]=-1,a[x]=0}for(o[y]=0,a[y]=1,i.push(y);i.length;){const b=i.shift();n.push(b),g[b].forEach(x=>{o[x]===-1&&(o[x]=o[b]+1,i.push(x)),o[x]===o[b]+1&&(a[x]+=a[b],r[x].push(b))})}}}var yf=sn&&!!window.PointerEvent,sl="pointerdown",il="pointermove",nl="pointerup",no="pointercancel",Gn={},wa=0,xf=t=>t.pointerType==="mouse",bf=t=>t.pointerType!=="mouse";function uv(){if(di&&wa===0&&yf){const t=document.documentElement;t.addEventListener(sl,vf,!0),t.addEventListener(il,Ef,!0),t.addEventListener(nl,Ta,!0),t.addEventListener(no,Ta,!0)}wa++}function cv(){if(wa--,di&&wa===0){const t=document.documentElement;t.removeEventListener(sl,vf,!0),t.removeEventListener(il,Ef,!0),t.removeEventListener(nl,Ta,!0),t.removeEventListener(no,Ta,!0)}}function vf(t){Gn[t.pointerId]=t}function Ef(t){Gn[t.pointerId]&&(Gn[t.pointerId]=t)}function Ta(t){delete Gn[t.pointerId]}function rl(t,e){t.touches=[];for(const s in Gn)t.touches.push(Gn[s]);t.changedTouches=[t],e(t)}function gv(t,e,s){const i=n=>{xf(n)||(bf(n)&&n.preventDefault(),rl(n,s))};return t(e,sl,i,!1),i}function _v(t,e,s){const i=n=>{bf(n)&&n.preventDefault(),rl(n,s)};return t(e,no,i,!1),i}function mv(t,e,s){const i=n=>{xf(n)&&n.buttons===0||rl(n,s)};return t(e,il,i,!1),i}function fv(t,e,s){const i=n=>rl(n,s);return t(e,nl,i,!1),t(e,no,i,!1),i}function ac(t,e,s,i){return s==="touchstart"?t(e,sl,i,!1):s==="touchmove"?t(e,il,i,!1):s==="touchend"?(t(e,nl,i,!1),t(e,no,i,!1)):void 0}var Bt=class{constructor(t){this._ogma=t}_setModules(t){this._modules=t}onMounted(){}onReady(t){}destroy(t){}},pv=["graphics","legend","brand"],Il=300,Cl=300,yv=200,xv=class extends Bt{constructor(){super(...arguments),this._width=Il,this._height=Cl,this._layers={},this._focus=!1,this._container=null,this._isFullScreen=!1,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],this._refreshUntil=0,this._currentTime=rs(),this._timeouts=[],this._isDestroyed=!1,this._onDetachDom=[],this._isRealBrowser=Xa,this._isDocumentReady=Wa,this._inFrame=!1,this._mustRefresh=!1,this._nextFrame=null,this._onWindowResize=()=>this._resize(),this._onWindowFocus=()=>this.refresh(),this._onFullscreenChange=()=>{this._isFullScreen=Sr()}}onMounted(){this._modules.settings.register("minimumWidth",Il,()=>this._resize(),!1),this._modules.settings.register("minimumHeight",Cl,()=>this._resize(),!1),this._modules.events.register(["beforeNewFrame","frame","afterNewFrame","setContainer","resize"]),this._onDetachDom=[],uv(),this.addWindowEventListener("resize",this._onWindowResize).addWindowEventListener("focus",this._onWindowFocus)}onReady(t){var e,s;t.container&&this.setContainer(t.container),(e=t.options)!=null&&e.width||(s=t.options)!=null&&s.height?this._resize({width:t.options.width||Il,height:t.options.height||Cl}):this._resize()}addWindowEventListener(t,e,s){return this._isRealBrowser&&this.addElementEventListener(window,t,e,s),this}addDirectWindowEventListener(t,e,s){this._isRealBrowser&&window.addEventListener(t,e,s)}removeDirectWindowEventListener(t,e){this._isRealBrowser&&window.removeEventListener(t,e)}addDocumentEventListener(t,e,s){return this._isDocumentReady&&this.addElementEventListener(document.documentElement,t,e,s),e}removeDocumentEventListener(t,e){this._isDocumentReady&&document.documentElement.removeEventListener(t,e)}addMediaListener(t,e){if(this._isDocumentReady&&typeof window.matchMedia=="function"){const s=window.matchMedia(t);s.addListener(e),this._onDetachDom.push(()=>s.removeListener(e))}}addElementEventListener(t,e,s,i){return this._isDestroyed||(t.addEventListener(e,s,i),this._onDetachDom.push(()=>t.removeEventListener(e,s,i))),s}detachFromDom(){this._onDetachDom.forEach(t=>t()),this._onDetachDom=[],this._emptyContainer()}setTimeout(t,e=0){const s=setTimeout(()=>{this._timeouts.splice(this._timeouts.indexOf(s),1),t()},e);return this._timeouts.push(s),s}clearTimeout(t){return t&&(clearTimeout(t),this._timeouts.splice(this._timeouts.indexOf(t),1)),null}clearAllTimeouts(){this._timeouts.forEach(clearTimeout),this._timeouts=[]}stopFrames(){this._isDestroyed=!0,this._nextFrame&&(rm(this._nextFrame),this._nextFrame=null)}isDestroyed(){return this._isDestroyed}getDimensions(){return{width:this._width,height:this._height}}setDimensions(t){this._resize(t)}setLayer(t,e,{automaticResize:s=!1}={}){e&&(e._ogmaLayer=t,s&&(e.style.position="absolute",e.style.top="0px",e.style.left="0px",ba(e,this._width,this._height,fs()))),this._layers[t]={element:e,automaticResize:s},this._updateContainerContent()}setContainer(t){let e;if(typeof t=="string"){if(e=document.getElementById(t),!e)throw new Error(`unable to find DOM element with id "${t}"`)}else e=t;if(e===this._container)return;e===null&&this._emptyContainer();const s=this._container;this._isFullScreen=!1,this._container=e,this._container&&["fullscreenchange","webkitfullscreenchange"].forEach(i=>{this.addElementEventListener(this._container,i,this._onFullscreenChange)}),this._resize(),this._updateContainerContent(),this._modules.events.fire("setContainer",{element:e,prevElement:s})}getContainer(){return this._container}appendElement(t){this._container!==null&&this._container.appendChild(t)}focus(){this._focus=!0}blur(){this._focus=!1}hasFocus(){return this._focus}forceResize(){this._resize()}_beforeOrAfterNextFrame(t){const e=t?this._afterNextFramePromises:this._beforeNextFramePromises,s=new Promise(i=>{e.push(()=>(i(void 0),s))});return this._refresh(),s}beforeNextFrame(){return this._beforeOrAfterNextFrame(!1)}afterNextFrame(){return this._beforeOrAfterNextFrame(!0)}refresh(t){t&&(this._refreshUntil=Math.max(this._refreshUntil,t)),this._refresh()}_emptyContainer(){if(this._container){const t=[];for(let e=0;e<this._container.childNodes.length;++e){const s=this._container.childNodes[e];s._ogmaLayer&&t.push(s)}for(let e=0;e<t.length;++e)this._container.removeChild(t[e])}}_fillContainer(){if(this._container){const t=ym(this._container,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&(this._container.style.position="relative");const e=this._container.firstChild;pv.forEach(s=>{const i=this._layers[s];i&&i.element&&this._container&&this._container.insertBefore(i.element,e)})}}_updateContainerContent(){this._emptyContainer(),this._fillContainer()}_resize(t){if(!this._container&&!t)return;const e=this._width,s=this._height;let i,n;if(this._container){const r=this._modules.settings.get("minimumWidth"),o=this._modules.settings.get("minimumHeight"),a=this._container.clientWidth||1,l=this._container.clientHeight||1;i=Math.max(r,t?t.width:a),n=Math.max(o,t?t.height:l)}else t!=null&&(i=t.width,n=t.height);i===e&&n===s||(this._width=i,this._height=n,Ws(this._layers,({element:r,automaticResize:o})=>{o&&ba(r,i,n)}),this._modules.events.fire("resize",{prevWidth:e,prevHeight:s,width:i,height:n,difWidth:i-e,difHeight:n-s}))}_refresh(){this._inFrame?this._mustRefresh=!0:this._nextFrame||this._isDestroyed||(this._nextFrame=Ch(()=>this._playFrame()))}_playFrame(){const t=rs(),e=t-this._currentTime,s=om([this._beforeNextFramePromises,()=>this._modules.events.fire("beforeNewFrame",{elapsed:e}),()=>this._modules.events.fire("frame",{elapsed:e}),()=>this._modules.events.fire("afterNewFrame",{elapsed:e}),this._afterNextFramePromises,()=>{this._inFrame=!1,(this._mustRefresh||t<this._refreshUntil+17)&&(this._mustRefresh=!1,this._refresh())}]);this._inFrame=!0,this._nextFrame=null,this._mustRefresh=!1,this._currentTime=t,this._beforeNextFramePromises=[],this._afterNextFramePromises=[],s.reduce((i,n)=>i.then(()=>{if(!this._isDestroyed)return n()}),Promise.resolve())}isPlayingFrame(){return this._inFrame||!!this._nextFrame}setFullScreen(t){let e=Promise.resolve();return t!==this._isFullScreen?(this._container&&(e=t?bv(this._container):vv()),e.then(()=>new Promise(s=>{this.setTimeout(()=>{this._isFullScreen=Sr(),s(void 0)},yv)}))):e}isFullScreen(){return Sr()}debounceBeforeFrame(t){let e=!1,s=[];const i=()=>{const n=s;e=!1,s=[],t(),n.forEach(r=>r())};return()=>new Promise(n=>{s.push(n),e||(e=!0,this.beforeNextFrame().then(i))})}destroy(){cv(),this.detachFromDom(),this.clearAllTimeouts(),this.stopFrames()}};function Sr(){return typeof document<"u"&&!!(document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}function bv(t){return Sr()?Promise.resolve():t.requestFullscreen?t.requestFullscreen():t.requestFullScreen?t.requestFullScreen():t.webkitRequestFullScreen?Promise.resolve(t.webkitRequestFullScreen()):t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():Promise.resolve()}function vv(){return Sr()?typeof document>"u"?Promise.resolve():document.exitFullscreen?document.exitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?Promise.resolve(document.webkitCancelFullScreen()):document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():Promise.resolve():Promise.resolve()}var Ev=class extends Bt{constructor(){super(...arguments),this._nodeChanges=[],this._edgeChanges=[],this._shouldTriggerEvents=!1}onMounted(){this._nodeDataList=this._modules.graph.createAttribute(!0,{name:"data",storage:"any"},!1),this._edgeDataList=this._modules.graph.createAttribute(!1,{name:"data",storage:"any"},!1),this._nodeList=this._modules.graph.getNodeAttribute("object"),this._edgeList=this._modules.graph.getEdgeAttribute("object"),this._modules.events.register(["setData","updateNodeData","updateEdgeData"]),this._modules.events.on("addNodes",({nodes:t,objects:e})=>this._onAddElements(t,e)).on("addEdges",({edges:t,objects:e})=>this._onAddElements(t,e)).on("beforeNewFrame",()=>{this._shouldTriggerEvents&&(this._shouldTriggerEvents=!1,this._triggerEvents())})}_onAddElements(t,e){const{isNode:s,size:i,_indexes:n}=t,r=this[s?"_nodeDataList":"_edgeDataList"];for(let o=0;o<i;++o)r.set(n[o],e[o].data)}setProperty(t,e,s,{dispatch:i=!1}={}){this._setDataProperty(t.isNode,t._indexes,e,s,i),this._modules.events.fire("setData",{elements:t})}getProperty(t,e){return this._getDataProperty(t.isNode,t._indexes,e)}_setDataProperty(t,e,s,i,n){n&&typeof i=="function"&&(n=!1);const r=lc(s),o=typeof i=="function",a=t?this._nodeList:this._edgeList,l=t?this._nodeDataList:this._edgeDataList,d=Av(t?this._nodeChanges:this._edgeChanges,r);for(let h=0;h<e.length;++h){const u=e[h];let c=l.get(u);const g=a.get(u),_=n?i[h]:i;let m,f;if(r===null)m=c,f=o?_(g):_,l.set(u,f);else{c==null&&(c={},l.set(u,c));const p=r.length;for(let y=0;y<p;y++){const b=r[y];let x=c[b];y<p-1?(x==null&&(x={},c[b]=x),c=x):(m=x,f=o?_(g):_,c[b]=f)}}d.indexes.push(u),d.previousValues.push(m),d.newValues.push(f)}this._scheduleEvents()}_getDataProperty(t,e,s,i){const n=lc(s);i||(i=new Array(e.length));const r=t?this._nodeDataList:this._edgeDataList;for(let o=0;o<e.length;++o){const a=e[o];let l,d=r.get(a);if(n!==null&&n.length)if(d==null)l=void 0;else{const h=n.length;for(let u=0;u<h&&d;++u)l=d=d[n[u]]}else l=d;i[o]=l}return i}_scheduleEvents(){this._shouldTriggerEvents=!0,this._modules.dom.refresh()}_triggerEvents(){const t=this._prepareEvtPayload(!0),e=this._prepareEvtPayload(!1);this._modules.events.fire("updateNodeData",t),this._modules.events.fire("updateEdgeData",e)}_prepareEvtPayload(t){const e=t?this._modules.graph.nodeList:this._modules.graph.edgeList,s=t?"_nodeChanges":"_edgeChanges";let i=[];const n=this[s];this[s]=[];const r=[];for(let o=0;o<n.length;++o){const{indexes:a,property:l,newValues:d,previousValues:h}=n[o];i=i.concat(a||[]),t?r.push({property:l,newValues:d,previousValues:h,nodes:e(a)}):r.push({property:l,newValues:d,previousValues:h,edges:e(a)})}return t?{nodes:e(i).dedupe(),isNode:t,changes:r}:{edges:e(i).dedupe(),isNode:t,changes:r}}};function Av(t,e){for(let i=0;i<t.length;++i){const n=t[i],r=n.property;if(e===null&&r===null)return n;if(e&&r&&r.length===e.length){let o=!0;for(let a=0;a<r.length;++a)if(r[a]!==e[a]){o=!1;break}if(o)return n}}const s={property:e&&e.slice(),indexes:[],previousValues:[],newValues:[],nodes:null,edges:null};return t.push(s),s}function lc(t){return typeof t=="string"?t.split("."):Qe(t)?t:null}var Sv=[];function Af(t){typeof t=="object"&&t!==null||(t={});const e=typeof t.data=="function"?t.data:Os;return{attributes:Array.isArray(t.attributes)?t.attributes:t.attributes||Sv,data:e}}function ol(t,e){for(const s of t){const i=e;Object.keys(i).forEach(n=>{const r=i[n];s.prototype[n]=function(o,a){return Mi(`Deprecated method "${n}"; please use "${r}" instead.`),this[r](o,a)}})}}function dc(t){const e=t.getFlexArray("removed"),s=t.getFlexArray("excluded"),i=t.getFlexArray("virtual");return{all:n=>e.get(n)===0,visible:n=>s.get(n)===0,excluded:n=>s.get(n)===1,raw:n=>i.get(n)===0&&e.get(n)===0,_all:n=>!0}}function hc(t,e,s){return{all:yo(s.all,t,e),visible:yo(s.visible,t,e),raw:yo(s.raw,t,e),_all:yo(s._all,t,e)}}function yo(t,e,s){let i=null;return{getList(){if(!i){const n=e(),r=s();r.reset();for(let o=1;o<=n;++o)t(o)&&r.push(o);i=r.sliceAndReset()}return i},invalidList(){i=null}}}function Sf(t){if(t===void 0)return Math.round(Math.random()*Number.MAX_SAFE_INTEGER);if(typeof t!="string"&&(typeof t!="number"||!isFinite(t)))throw new Error(`${t} is not a valid id, expected string or number`);return t}function La(t,e,s={},i={}){return qr(t,e,[s],i).get(0)}function wv(t,{nodes:e=[],edges:s=[]},i={}){if(t.fireEvent("preAddGraph",{name:"preAddGraph"}),!i.batchSize)return Promise.all([qr(t,!0,e,i),qr(t,!1,s,i)]).then(([r,o])=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{nodes:r,edges:o}),{nodes:r,edges:o}));let n;return Vn(t,!0,e,i).then(r=>(n=r,Vn(t,!1,s,i))).then(r=>({nodes:n,edges:r})).then(r=>(t.fireEvent("postAddGraph",{name:"postAddGraph"}),t.fireEvent("addGraph",{name:"addGraph"}),r))}function Vn(t,e,s,i={}){if(i.batchSize){const n=[];for(let a=0;a<s.length;a+=i.batchSize)n.push(s.slice(a,a+i.batchSize));const r=(a,l)=>{let d;return a.then(h=>(d=h,t.getDom().afterNextFrame())).then(()=>qr(t,e,l,i)).then(h=>d.concat(h))},o=e?t.nodeList():t.edgeList();return n.reduce(r,Promise.resolve(o))}return Promise.resolve(qr(t,e,s,i))}function qr(t,e,s,i){t.fireEvent("preAddElements",{name:"preAddElements",objects:s,isNode:e});const n=!!i.ignoreInvalid,r=t.storage.fetch(e),o=[],a=[],l=[],d=[],h=new Set,{virtual:u=!1}=i;for(const v of s){if(typeof v!="object"||v===null||Array.isArray(v)){if(n)continue;throw new Error(`${v} is not a valid ${e?"node":"edge"}`)}const E=Sf(v.id);if(!r.getIndex(E,!1)&&!h.has(E)){if(!e){const w=v,A=t.getExtremityIndex(E,w.source,0,n),I=t.getExtremityIndex(E,w.target,1,n);if(n&&(!A||!I))continue;l.push(A),d.push(I)}a.push(E),o.push(v),h.add(E)}}const c=r.addElements(a);e?t.topology.allocateNodes(c):t.topology.allocateEdges(c,l,d);const g=r.getFlexArray("object"),_=r.getFlexArray("excluded"),m=r.getFlexArray("removed"),f=r.getFlexArray("virtual"),p=e?t.node:t.edge,y=e?t.nodeList:t.edgeList,b=t.getCacheLists(e),x=y(c);for(let v=0;v<c.length;v++){const E=c[v];g.set(E,p(E))}return _.setMultiple(c,0),m.setMultiple(c,0),f.setMultiple(c,u?1:0),b.visible.invalidList(),b.all.invalidList(),b._all.invalidList(),u||b.raw.invalidList(),x.size!==0&&(e?t.fireEvent("addNodes",{virtual:u,objects:o,nodes:x}):t.fireEvent("addEdges",{virtual:u,objects:o,edges:x})),x}var Tv=1,Lv=2,Iv=3,Cv=4,Mv=5,Nv=6,Nd="_visible",Fd="_data",Fv="_compound",wr="_hovered",Pd="_hoverExtremityHighlighted",Ae="_selected",Dd="_selectionExtremityHighlighted",ua="_dragged",wf="_rewirable",Wi="_export",Fe="_faded",vi="_transparent",Pv="_visual_groups",ro=-1,xo="in",bo="out",Ml="both",uc=[Ae,ua,Dd,wr,Pd,wf,Wi,Fe,vi,Pv],Tf=2,Dv=-1,Lf=3,kv=3,Rv=4,If=-1,Ov=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"],xn=void 0,zv=class{constructor(t){this._neighborTable=new Id,this._parallelTable=new Id,this._parallelEdgesIndex=[],this._hasParallelEdges=new Set,this._fakeDeduper={get:()=>0,set:qt,reset(){return this}},this._fakeInvertedDeduper={get:()=>1,set:qt,reset(){return this}},this._graph=t,this.nodeDeduper=t.createNodeAttribute({storage:1},!1),this.edgeDeduper=t.createEdgeAttribute({storage:1},!1),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target")}getAdjacentDirections(t){return this._neighborTable.get(t)}getEdgeIndexesInDirection(t){return this._parallelTable.get(t)}allocateNodes(t){this._neighborTable.reserve(t.length);for(let e=0;e<t.length;++e)this._neighborTable.addEntry(t[e])}allocateEdges(t,e,s){this._parallelTable.reserve(Math.floor(t.length/2));for(let i=0;i<t.length;i++){const n=t[i],r=e[i],o=s[i];this._sourceList.set(n,r),this._targetList.set(n,o),this.addToAdjacencyList(n)}}getExtremity(t,e){const s=t?this._sourceList:this._targetList;if(e.isList){const i=this._graph.acquireIndexList(!0);for(let n=0;n<e._indexes.length;n++)i.push(s.get(e._indexes[n]));return this._graph.nodeList(i.sliceAndReset())}return this._graph.getObjectList(!0).get(s.get(e._index))}setExtremities(t,e,s){for(let i=0;i<t.length;++i)this.removeFromAdjacencyList(t[i]);e!==null&&this._sourceList.setMultiple(t,e),s!==null&&this._targetList.setMultiple(t,s);for(let i=0;i<t.length;++i)this.addToAdjacencyList(t[i])}addToAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Qn(e,s);let n=this._parallelEdgesIndex[i];if(n===xn)n=this._parallelTable.addEntry(),this._parallelEdgesIndex[i]=n,this._neighborTable.addTo(e,n),e!==s&&this._neighborTable.addTo(s,n);else{this._hasParallelEdges.add(t);const r=this._parallelTable.get(+n);if(r)for(const o of r)this._hasParallelEdges.add(o)}this._parallelTable.addTo(n,t)}hasParallelEdges(t){return this._hasParallelEdges.has(t)}removeFromAdjacencyList(t){const e=this._sourceList.get(t),s=this._targetList.get(t),i=Qn(e,s),n=this._parallelEdgesIndex[i];n!==xn&&this._parallelTable.removeFromAndGetSize(n,t)===0&&(this._neighborTable.removeFrom(e,n),e!==s&&this._neighborTable.removeFrom(s,n),this._parallelEdgesIndex[i]=xn,this._hasParallelEdges.delete(t))}getParallelEdges(t,e={}){const s=e.filter||"visible",i=this._graph.acquireIndexList(!1),n=this._graph.getFilter(!1,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r],a=Qn(this._sourceList.get(o),this._targetList.get(o)),l=this._parallelEdgesIndex[a];if(l!==xn){const d=this._parallelTable.get(+l);if(d)for(const h of d)n(h)&&i.push(h)}}return this._graph.edgeList(i.sliceAndReset())}fastGetNodesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=this._neighborTable.get(o);for(const l of a){const d=this._parallelTable.get(l),h=d[0],u=i.get(h),c=n.get(h);if(u!==0&&c!==0){e.push(u+c-o);for(const g of d)s.push(g)}}}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}fastGetEdgesAdjacentElements(t){const e=this._graph.acquireIndexList(!0),s=this._graph.acquireIndexList(!1),i=this._sourceList,n=this._targetList;for(let r=0;r<t.length;r++){const o=t[r],a=i.get(o),l=n.get(o),d=Qn(a,l),h=this._parallelEdgesIndex[d];if(h!==xn){const u=this._parallelTable.get(+h);if(u)for(const c of u)s.push(c)}e.push(a),e.push(l)}return{nodes:this._graph.nodeList(e.sliceAndReset()),edges:this._graph.edgeList(s.sliceAndReset())}}getDeduper(t){return(t?this.nodeDeduper:this.edgeDeduper).reset()}collectAdjacentEdges(t,e,s,i=!1,n=!1){const r=e===xo,o=!(e===bo||r||n),a=this._graph.acquireIndexList(!1),l=this._graph.getFilter(!1,s),d=i?this.getDeduper(!1):this._fakeDeduper;let h=this._fakeInvertedDeduper;const u=this._sourceList,c=this._targetList;if(n){h=this.getDeduper(!0);for(let g=0;g<t.length;g++)h.set(t[g],1)}for(let g=0;g<t.length;g++){const _=t[g],m=this._neighborTable.get(_);for(const f of m){const p=this._parallelTable.get(f);if(o)for(const y of p)l(y)&&d.get(y)===0&&(a.push(y),d.set(y,1));else for(const y of p){const b=u.get(y),x=c.get(y),v=b+x-_;r!==(x===_)&&b!==x||!l(y)||d.get(y)!==0||h.get(v)!==1||(a.push(y),d.set(y,1))}}}return a.sliceAndReset()}collectAdjacentNodes(t,e,s,i=!1,n,r){const o=e!==xo,a=e!==bo,l=this._graph.acquireIndexList(!0),d=this._graph.getFilter(!1,s),h=i?this.getDeduper(!0):this._fakeDeduper,u=this._sourceList,c=this._targetList;if(n)for(let g=0;g<n.length;g++){const _=n[g];l.push(_),h.set(_,1)}if(r)for(let g=0;g<r.length;g++){const _=r[g];h.set(_,1)}for(let g=0;g<t.length;g++){const _=t[g],m=this._neighborTable.get(_);for(const f of m){const p=this._parallelTable.get(f);for(const y of p)if(d(y)){const b=u.get(y),x=c.get(y),v=b+x-_;if((a&&_===x||o&&_===b)&&h.get(v)===0){l.push(v),h.set(v,1);break}}}}return l.sliceAndReset()}getAdjacentElements(t,e,s={}){const i=s.direction||Ml,n=s.filter||"visible",r=s.policy||"union",o=!!s.bothExtremities;if(t){const a=r==="include-sources"?e:null,l=r==="exclude-sources"?e:null;return this.collectAdjacentNodes(e,i,n,!0,a,l)}return this.collectAdjacentEdges(e,i,n,!0,o)}getEdgesBetweenTwoNodes(t,e){const s=Qn(t,e),i=this._parallelEdgesIndex[s];if(i===xn)return new Uint32Array;const n=this._parallelTable.get(+i);return new Uint32Array(n)}getConnectedComponents(t,{filter:e="visible",returnIds:s=!1,internalIndexes:i=!1}={}){const n=this._graph,r=[],o={},a=n.acquireIndexList(!0);let l;typeof e=="string"?l=n.getFilter(!0,e):(l=e,e="visible");for(let u=0;u<t.length;u++){const c=t[u];l(c)&&a.push(c)}const d=a.sliceAndReset(),h={filter:e};for(let u=0;u<d.length;u++){const c=d[u];if(!o[c]){const g=[c],_=[];for(;g.length!==0;){const m=g.pop();!o[m]&&l(m)&&(g.push.apply(g,this.getAdjacentElements(!0,new Uint32Array([m]),h)),o[m]=!0,_.push(m))}_.length>0&&r.push(_)}}if(s){const u=n.getNodeAttribute("id");for(let c=0;c<r.length;c++)r[c]=u.getMultiple(r[c])}else if(!i)for(let u=0;u<r.length;u++)r[u]=n.nodeList(new Uint32Array(r[u]));return r}getAdjacencyList({directed:t,ids:e,weight:s,nodes:i}){const n=t?bo:Ml,r=new Array(i.length),o=this._graph;for(let _=0;_<i.length;++_)r[_]=this.collectAdjacentEdges(new Uint32Array([i[_]]),n,"all");const a=o.getEdgeAttribute("source"),l=o.getEdgeAttribute("target"),d=o.getEdgeAttribute("width"),h=o.getNodeAttribute("id"),u=[],c=typeof s=="number",g=typeof s!="function"&&!c&&!!s;for(let _=0;_<r.length;_++){const m=r[_],f=i[_],p=m.length,y=e?new Array(p):new Uint32Array(p),b=new Array(p);for(let v=0;v<p;v++){const E=m[v],w=a.get(E),A=l.get(E);let I=t||f===w?A:w;if(e&&(I=h.get(I)),y[v]=I,s){if(c&&(b[v]=s),typeof s=="function"){const M=o.getNode(w),k=o.getNode(A);b[v]=s(M,k)}g&&(b[v]=d.get(E)||1)}}const x=ct({nodes:y,id:e?h.get(f):f},s&&{weights:b});u.push(x)}return u}degrees(t,e){if(e!==xo&&e!==bo)return this._neighborTable.sizes(t);const s=new Array(t.length),i=e===xo;for(let n=0,r=t.length;n<r;n++)s[n]=this._degree(t[n],i);return s}_degree(t,e){const s=this._neighborTable.get(t),i=this._sourceList,n=this._targetList;let r=0;for(let o=0;o<s.length;++o){const a=this._parallelTable.get(s[o]);for(let l=0;l<a.length;++l){const d=a[l],h=i.get(d),u=n.get(d);if(e&&u===t||!e&&h===t){r+=1;break}}}return r}getDegree(t,e){const{direction:s,filter:i}=this._getDegreeOptions(e),n=new Array(t.length),r=new Uint32Array(1);for(let o=0;o<t.length;++o)r[0]=t[o],n[o]=this.collectAdjacentNodes(r,s,i).length;return n}_getDegreeOptions(t){const e={direction:Ml,filter:"visible"};return typeof t=="string"?e.direction=t:t&&(typeof t.direction=="string"&&(e.direction=t.direction),typeof t.filter=="string"&&(e.filter=t.filter)),e}};function Cf(t,e,s){const i=t.getObjectList(e.isNode);for(let n=0;n<e._indexes.length;++n){const r=e._indexes[n];s(i.get(r),n)}}function Mf(t,e,s){const i=new Array(e.size),n=t.getObjectList(e.isNode);for(let r=0;r<e._indexes.length;++r){const o=e._indexes[r],a=n.get(o);i[r]=s(a,r)}return i}function Nf(t,e,s){s=s||Qa;const i=e.isNode,n=t.acquireIndexList(i),r=t.getObjectList(i),o=t.getListFactory(i);for(let a=0;a<e._indexes.length;++a){const l=e._indexes[a],d=r.get(l);d&&s(d,a)&&n.push(l)}return o(n.sliceAndReset())}function Ff(t,e,s,i){const n=t.getListFactory(e.isNode);if(!s)return{valid:e,invalid:n()};const r=t.acquireIndexList(e.isNode),o=t.acquireIndexList(e.isNode),a=t.getObjectList(e.isNode);for(let l=0;l<e._indexes.length;l++){const d=e._indexes[l],h=a.get(d);h!==void 0&&(s(h,i)?r:o).pushUnchecked(d)}return{valid:n(r.sliceAndReset()),invalid:n(o.sliceAndReset())}}function Pf(t,e,s,i){const n=t.getObjectList(e.isNode);let r=i;for(let o=0;o<e._indexes.length;++o){const a=e._indexes[o];r=s(r,n.get(a),o)}return r}function Df(t,e){const s=e.isNode,i=t.topology.getDeduper(s),n=t.acquireIndexList(s),r=t.getListFactory(s);for(let o=0;o<e._indexes.length;o++){const a=e._indexes[o];i.get(a)===0&&(i.set(a,1),n.push(a))}return r(n.sliceAndReset())}function kf(t,e,s){const i=e.isNode,n=s.topology.getDeduper(i),r=s.acquireIndexList(i),o=s.getListFactory(i);for(let a=0;a<e._indexes.length;a++){const l=e._indexes[a];n.set(l,1)}for(let a=0;a<t._indexes.length;a++){const l=t._indexes[a];n.get(l)===0&&r.push(l)}return o(r.sliceAndReset())}function Rf(t,e){const s=e.isNode,i=t.storage.fetch(s),n=i.getFlexArray("excluded"),r=i.getMaxIndex(),o=t.topology.getDeduper(s),a=t.acquireIndexList(s),l=t.getListFactory(s);for(let d=0;d<e._indexes.length;d++)o.set(e._indexes[d],1);for(let d=1;d<=r;++d)o.get(d)===0&&n.get(d)===0&&a.push(d);return l(a.sliceAndReset())}function Of(t,e,s){const i=t.getListFactory(e.isNode),n=new Uint32Array(e._indexes.length+s._indexes.length);return n.set(e._indexes),n.set(s._indexes,e._indexes.length),i(n)}function zf(t,e){return t.getObjectList(e.isNode).getMultiple(e._indexes)}function al(t,e){const s=t.getStorage(e.isNode);if(e.isList){const i=new Array(e.size);for(let n=0;n<e._indexes.length;++n)i[n]=s.getId(e._indexes[n]);return i}return s.getId(e._index)}function Bf(t,e){return t.topology.getExtremity(!0,e)}function Uf(t,e){return t.topology.getExtremity(!1,e)}function Gf(t,e,s){return t.getObjectList(e.isNode).get(e._indexes[s])}function Vf(t,e,s){const i=t.getListFactory(e.isNode),n=t.getObjectList(e.isNode),r=e._indexes.slice();return r.sort((o,a)=>{const l=n.get(o),d=n.get(a);return s(l,d)}),i(r)}var cc=new Uint32Array(1),Di=class{constructor(t,e){this.size=1,this.isNode=!1,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return cc[0]=this._index,cc}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}hasParallelEdges(){return this._ogma.modules.graph.hasParallelEdges(this)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.filter(s=>s!==this).dedupe()}}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.modules.graph.edgeList(new Uint32Array([this._index]))}getId(){return al(this._ogma.modules.graph,this)}getSource(){return Bf(this._ogma.modules.graph,this)}getTarget(){return Uf(this._ogma.modules.graph,this)}getExtremities(){return this._ogma.modules.graph.nodeList(new Uint32Array([this.getSource()._index,this.getTarget()._index]))}setSource(t){this._ogma.modules.graph.setSource(this,t)}setTarget(t){this._ogma.modules.graph.setTarget(this,t)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Af(t);return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(e),data:s(Ie(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaEdge(){return this._ogma.modules.grouping.getMetaElement(this)[0]}getSubEdges(){return this._ogma.modules.grouping.getSubElements(this)[0]}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};ol([Di],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var hn=class{constructor(t,e){this.isList=!0,this.isNode=!1,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getParallelEdges(t){return this._ogma.modules.graph.getParallelEdges(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetEdgesAdjacentElements(this)}getAdjacentElements(){const{nodes:t,edges:e}=this.fastGetAdjacentElements();return{nodes:t.dedupe(),edges:e.subtract(this).dedupe()}}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return zf(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.edgeList(this._indexes.slice())}getId(){return al(this._ogma.modules.graph,this)}getSource(){return Bf(this._ogma.modules.graph,this)}getTarget(){return Uf(this._ogma.modules.graph,this)}getExtremities(){return this.getSource().concat(this.getTarget())}get(t){return Gf(this._ogma.modules.graph,this,t)}forEach(t){Cf(this._ogma.modules.graph,this,t)}map(t){return Mf(this._ogma.modules.graph,this,t)}filter(t){return Nf(this._ogma.modules.graph,this,t)}reduce(t,e){return Pf(this._ogma.modules.graph,this,t,e)}concat(t){return Of(this._ogma.modules.graph,this,t)}dedupe(){return Df(this._ogma.modules.graph,this)}subtract(t){return kf(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.edgeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof Di?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}sort(t){return Vf(this._ogma.modules.graph,this,t)}inverse(){return Rf(this._ogma.modules.graph,this)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1,ignoreCurvature:e=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t,e)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!Qe(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaEdge(){return this._ogma.modules.grouping.getMetaElement(this)}getSubEdges(){return this._ogma.modules.grouping.getSubElements(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};ol([hn],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute"});var wi="geo.latitude",Ti="geo.longitude",gc="geo.prevLat",Nl="geo.prevLng",kd=85.0511287798,Ia=1,Bv='Map data &copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap contributors</a>',$i={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:22,minZoomLevel:0,wrapCoordinates:!0,tileUrlTemplate:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,attributionOptions:void 0,backgroundColor:"silver",opacity:1,duration:0,disableNodeDragging:!0,tileBuffer:1,sizeRatio:1,tiles:{url:"https://{s}.tile.osm.org/{z}/{x}/{y}.png",subdomains:"abc",tms:!1,wms:!1},crs:void 0},Uv={maxBoundsViscosity:1,worldCopyJump:!0,zoomControl:!1,attributionControl:!1};function _c(t,e){t&&e!==void 0&&isFinite(e)&&t.setOpacity&&t.setOpacity(e)}function mc(){return sn||typeof global<"u"&&!global.process}function Fl(t){return Math.log2(t)+Ia}function Gv(t){return 2**(t-Ia)}function fc(t){return t!=null&&!isNaN(t)}function jf(t,e){return Hf(t,e,"longitude")}function qf(t,e){return Hf(t,e,"latitude")}function Hf(t,e,s){if(isNaN(e))throw new TypeError(`node ${t}: ${e} is not a valid ${s}`)}function Vv(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function jv(t,e){return e==null&&t.url===$i.tiles.url?Bv:null}function qv(t={},e){const{tileUrlSubdomains:s,tileUrlTemplate:i,attribution:n,attributionOptions:r,latitudePath:o,longitudePath:a,sizeRatio:l,tiles:d}=t;if(i!=null&&typeof i!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a URL string");if(s!=null&&typeof s!="string")throw new TypeError("Geo mode: tileUrlTemplate must be a string");if(d!=null){if(!(ze(d)||d instanceof e.Layer))throw new TypeError("Geo mode: tiles must be a object or L.Layer instance");const h=d;if(h.url!=null&&typeof h.url!="string")throw new TypeError("Geo mode: tiles.url must be a string");if(h.subdomains!=null&&typeof h.subdomains!="string")throw new TypeError("Geo mode: tiles.subdomains must be a string");if(h.tms&&typeof h.tms!="boolean")throw new TypeError("Geo mode: tiles.tms must be a boolean");if(h.wms&&typeof h.wms!="boolean")throw new TypeError("Geo mode: tiles.wms must be a boolean")}if(n!=null&&typeof n!="string")throw new TypeError("Geo mode: Map attribution must be a string");if(r!=null&&!ze(r))throw new TypeError("Geo mode: attributionOptions must to be a BrandOptions object");if(o!=null&&typeof o!="string"&&!Array.isArray(o))throw new TypeError("Geo mode: Latitude path must be a valid property path: a string or an array of strings.");if(a!=null&&typeof a!="string"&&!Array.isArray(a))throw new TypeError("Geo mode: Longitude path must be a valid property path: a string or an array of strings.");if(l!=null&&(!isFinite(l)||l<=0))throw new TypeError("Geo mode: sizeRatio must be a positive number.")}function Hv(t,e={}){if(e.tiles===void 0||e.tileUrlTemplate||e.tileUrlSubdomains){const s=$i.tiles;return ct(ct(ct({},e.tiles||{}),$i.tiles),{url:e.tileUrlTemplate||s.url,subdomains:e.tileUrlSubdomains||s.subdomains})}return ze(e.tiles)?ct(ct({},t.tiles),e.tiles):e.tiles}function Xv(t,e){return t.attribution!==e.attribution||t.tiles!==e.tiles}var Wv=hi().createElement("div");function $v(t){const e=hi().createElement("div");e.className="ogma-geo-container",ln(e,"100%","100%");const s=t||Wv;return s.insertBefore(e,s.firstChild),e}function Yv(t){const e=[[1/0,1/0],[-1/0,-1/0]];return t.getGeoCoordinates().reduce((s,{latitude:i,longitude:n})=>{const[r,o]=s;return r[0]=Math.min(r[0],i),r[1]=Math.min(r[1],n),o[0]=Math.max(o[0],i),o[1]=Math.max(o[1],n),s},e)}function Zv(t,e,s,i){const n=e._indexes;t.getNodeAttribute(wi).setMultiple(n,s),t.getNodeAttribute(Ti).setMultiple(n,i)}function Kv(t,e,s){const{longitudePath:i,latitudePath:n,wrapCoordinates:r}=s,[o,a]=t.getAttributes(!0,[wi,Ti]),l=e._indexes,d=e.getId(),h=l.length,u=e.getData(n),c=e.getData(i);for(let g=0;g<h;g++){let _=c[g],m=u[g];const f=l[g],p=d[g];m!=null&&_!=null&&(jf(p,_),qf(p,m),r&&(_%=180,m=bs(+m,-kd,kd)),a.set(f,_),o.set(f,m))}}function Qv(t,{longitudePath:e,latitudePath:s,wrapCoordinates:i},n){const r=t.getData(e),o=t.getData(s);return r!=null&&o!=null&&(!(!i&&!n)||Math.abs(o)<=kd&&Math.abs(r)<=180)}function vo(t,e,s,i){Jv(t,!0,e,s,i)}function Jv(t,e,s,i,n){const r=t.getAttribute(e,i),o=t.getAttribute(e,n),a=s._indexes;o.setMultiple(a,r.getMultiple(a))}function tE(t){return t.reduce((e,{nodes:s,newValues:i})=>{if(!s)return e;const n=s.filter((r,o)=>i[o]!=null);return e?e.concat(n):n},null)}function eE(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","radius"]).forEach(({text:s,radius:i},n)=>{e[t.get(n).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:s.minVisibleSize,size:Math.max(1,Number(i))}}),e}function pc(t,e){return t.getAttributes(["text.minVisibleSize","text.size","text.scale","minVisibleSize","width"]).forEach(({text:s,minVisibleSize:i,width:n},r)=>{e[t.get(r).getId()]={"text.minVisibleSize":s.minVisibleSize,"text.size":s.size,"text.scale":s.scale,minVisibleSize:i,size:Math.max(1,Number(n))}}),e}function sE(t,e,s){if(!e||!Object.keys(e).length)return Promise.resolve();const i=t.getId().filter(n=>e[n]).map(n=>{if(!e[n])return 0;const r=Number(e[n]["text.minVisibleSize"]),o=Number(e[n].minVisibleSize),a=Number(e[n]["text.size"]),l=Number(e[n]["text.scale"]),d=Number(e[n].size)*l*s;return d<=o||d<=r?0:a});return t.setAttribute("text.size",i)}function iE(t,e){const s=t.getId().map(i=>{const n=e[i]||{};return Number(n["text.size"])});return t.setAttribute("text.size",s)}var yc=new Uint32Array(1),Ys=class{constructor(t,e){this.size=1,this.isNode=!0,this.isList=!1,this._index=t,this._ogma=e}get _indexes(){return yc[0]=this._index,yc}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)[0]}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)[0]}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this._ogma.modules.camera.graphToScreenCoordinates(this.getPosition())}isInScreen(){const t=this.getPositionOnScreen(),e=this._ogma.modules.camera;return t.x>=0&&t.x<=e.width&&t.y>=0&&t.y<=e.height}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)[0]}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}isInView(t){return this._ogma.modules.locate.isElementInView(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)[0]}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}getConnectedComponent(t){return this._ogma.modules.graph.getConnectedComponentByNode(this,t)[0]}isVisible(){return!this.isExcluded()}isExcluded(){return this._ogma.modules.graph.isExcluded(this)[0]}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this._ogma.nodeList(new Uint32Array([+this._index]))}getId(){return al(this._ogma.modules.graph,this)}slice(){return this.toList()}toJSON(t={}){const{attributes:e,data:s}=Af(t),i=this.getAttributes(e);return{id:this.getId(),attributes:i,data:s(Ie(this.getData()))}}get(t){return t===0?this:void 0}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)[0]}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this._ogma.modules.classes.hasSingleElementClass(t,this)}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)[0]}getGeoCoordinates(){const t=this._ogma.modules.graph,e=t.getNodeAttribute(wi).get(this._index),s=t.getNodeAttribute(Ti).get(this._index);return{latitude:fc(e)?e:void 0,longitude:fc(s)?s:void 0}}setGeoCoordinates(t){return this.toList().setGeoCoordinates([t]).then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)[0]}isVirtual(){return this._ogma.modules.transformations.isElementVirtual(this)}getTransformation(){return this._ogma.modules.transformations.getElementTransformation(this)}getMetaNode(){return this._ogma.modules.grouping.getMetaElement(this)[0]}getSubNodes(){return this._ogma.modules.grouping.getSubElements(this)[0]}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};ol([Ys],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var ui=class{constructor(t,e){this.isList=!0,this.isNode=!0,this._indexes=t,this._ogma=e}get size(){return this._indexes.length}setAttributes(t,e){return this._ogma.modules.individualAttributes.setMultipleAttributes(this,t,e)}setAttribute(t,e,s){return this._ogma.modules.individualAttributes.setSingleAttribute(this,t,e,s)}getAttributes(t){return this._ogma.modules.individualAttributes.getMultipleAttributes(this,t)}getAttribute(t){return this._ogma.modules.individualAttributes.getSingleAttribute(this,t)}resetAttributes(t,e){return this._ogma.modules.individualAttributes.resetMultipleAttributes(this,t,e)}getPosition(){return this.getAttributes(["x","y"])}getPositionOnScreen(){return this.getPosition().map(t=>this._ogma.modules.camera.graphToScreenCoordinates(t))}replaceOriginalAttributes(t,e){return this._ogma.modules.individualAttributes.replaceOriginalAttributes(this,t,e)}getPreviousAttributes(t){return this._ogma.modules.individualAttributes.getMultiplePreviousAttributes(this,t)}getPreviousAttribute(t){return this._ogma.modules.individualAttributes.getSinglePreviousAttribute(this,t)}getAdjacentNodes(t){return this._ogma.modules.graph.getAdjacentNodes(this,t)}getAdjacentEdges(t){return this._ogma.modules.graph.getAdjacentEdges(this,t)}getAdjacentElements(t){return{nodes:this._ogma.modules.graph.getAdjacentNodes(this,t).dedupe(),edges:this._ogma.modules.graph.getAdjacentEdges(this,t).dedupe()}}getDegree(t){return this._ogma.modules.graph.getDegree(this,t)}getConnectedComponents(t){return this._ogma.modules.graph.getConnectedComponents(this,t)}fastGetAdjacentElements(){return this._ogma.modules.graph.fastGetNodesAdjacentElements(this)}isVisible(){return this.isExcluded().map(t=>!t)}isExcluded(){return this._ogma.modules.graph.isExcluded(this)}setExcluded(t){return this._ogma.modules.graph.setExcluded(this,t)}setVisible(t){return this.setExcluded(!t)}toList(){return this}toArray(){return zf(this._ogma.modules.graph,this)}clone(){return this._ogma.modules.graph.nodeList(this._indexes.slice())}getId(){return al(this._ogma.modules.graph,this)}get(t){return Gf(this._ogma.modules.graph,this,t)}forEach(t){Cf(this._ogma.modules.graph,this,t)}map(t){return Mf(this._ogma.modules.graph,this,t)}filter(t){return Nf(this._ogma.modules.graph,this,t)}reduce(t,e){return Pf(this._ogma.modules.graph,this,t,e)}concat(t){return Of(this._ogma.modules.graph,this,t)}dedupe(){return Df(this._ogma.modules.graph,this)}subtract(t){return kf(this,t,this._ogma.modules.graph)}slice(t,e){return this._ogma.modules.graph.nodeList(this._indexes.slice(t,e))}indexOf(t){return t instanceof Ys?this._indexes.indexOf(t._index):-1}includes(t){return this.indexOf(t)!==-1}inverse(){return Rf(this._ogma.modules.graph,this)}sort(t){return Vf(this._ogma.modules.graph,this,t)}toJSON(t={}){return this.map(e=>e.toJSON(t))}setSelected(t){this._ogma.modules.selection.setActive(this,t)}isSelected(){return this._ogma.modules.selection.areActive(this)}locate(t){return this._ogma.modules.locate.locateElements(this,t)}getBoundingBox({includeTexts:t=!1}={}){return this._ogma.modules.locate.getBoundingBox(this,t,t)}setData(t,e){if(arguments.length<2&&(e=t,t=null),typeof e!="function"&&!Qe(e))throw new Error(`invalid argument ${e}; expected array or function`);return this._ogma.modules.data.setProperty(this,t,e,{dispatch:!0}),this}fillData(t,e){return arguments.length<2&&(e=t,t=null),this._ogma.modules.data.setProperty(this,t,e,{dispatch:!1}),this}getData(t){return this._ogma.modules.data.getProperty(this,t||null)}addClass(t,e){return this._ogma.modules.classes.addClassesToElements([t],this,e)}addClasses(t,e){return this._ogma.modules.classes.addClassesToElements(t,this,e)}removeClass(t,e){return this._ogma.modules.classes.removeClassesFromElements([t],this,e)}removeClasses(t,e){return this._ogma.modules.classes.removeClassesFromElements(t,this,e)}hasClass(t){return this.map(e=>this._ogma.modules.classes.hasSingleElementClass(t,e))}getClassList(){return this._ogma.modules.classes.getElementsClassList(this)}getGeoCoordinates(){const t=this._ogma.modules.graph,e=new Array(this._indexes.length),s=t.getNodeAttribute(wi).getMultiple(this._indexes),i=t.getNodeAttribute(Ti).getMultiple(this._indexes);for(let n=0,r=this._indexes.length;n<r;n++)e[n]={latitude:s[n],longitude:i[n]};return e}setGeoCoordinates(t){const e=this._ogma.modules.geo,s=this.getId(),i=this._indexes,n=new Array(i.length),r=new Array(i.length);if(t===null&&(t=new Array(i.length).fill(null)),t.length!==i.length)throw new RangeError("You must provide coordinates for each node in the NodeList");for(let l=0,d=i.length;l<d;l++){let{latitude:h,longitude:u}=t[l]||{latitude:void 0,longitude:void 0};const c=s[l];h==null&&u==null?h=u=void 0:(qf(c,h),jf(c,u)),n[l]=h,r[l]=u}this.setData(e.latitudePath,n),this.setData(e.longitudePath,r);const{dom:o,graph:a}=this._ogma.modules;return Zv(a,this,n,r),this._ogma.modules.geo.isEnabled()?o.afterNextFrame().then(()=>o.afterNextFrame()).then(()=>this):o.afterNextFrame().then(()=>this)}getAnimationInformation(){return this._ogma.modules.graphics.getAnimationInformation(this)}getMetaNode(){return this._ogma.modules.grouping.getMetaElement(this)}getSubNodes(){return this._ogma.modules.grouping.getSubElements(this)}pulse(t){return this._ogma.modules.pulses.pulse(this,t)}};function nE(t,e,s){return jn(t,!0,[e],s)}function rE(t,e,s){return jn(t,!1,[e],s)}function oE(t,e,s){return jn(t,!0,e,s)}function aE(t,e,s){return jn(t,!1,e,s)}function jn(t,e,s,i={},n=!1){Array.isArray(s)||s instanceof(e?ui:hn)||(s=[s]);const{virtual:r=!1}=i,o={elementsToRemove:t.getElements(e,s),virtual:r};t.fireEvent("requestElementsToDelete",o);let{elementsToRemove:a}=r?{elementsToRemove:s}:o;if(!a.size)return Promise.resolve();a=a.dedupe();const l=t.storage.fetch(e),d=l.getFlexArray("removed");if(a=a.filter(g=>d.get(g._index)===0),e){const g=a.getAdjacentEdges({filter:"all"}),_=g.filter(m=>m.isVirtual());jn(t,!1,g,i,!0),jn(t,!1,_,{virtual:!0},!0)}const h=a._indexes,u=t.getCacheLists(e);if(zm(l.getFlexArray("virtual").getMultiple(h))!==(r?h.length:0))throw new Error("Attempting to remove virtual elements; you should not do that");const c={virtual:r,[e?"nodes":"edges"]:a};if(t.fireEvent(e?"beforeRemoveNodes":"beforeRemoveEdges",c),u.visible.invalidList(),u.all.invalidList(),r||u.raw.invalidList(),t.setExcluded(a,!0),d.setMultiple(h,1),!e)for(let g=0;g<h.length;++g)t.topology.removeFromAdjacencyList(h[g]);return l.removeElements(h),t.fireEvent(e?"removeNodes":"removeEdges",c),Promise.resolve()}ol([ui],{setStyle:"setAttributes",resetStyle:"resetAttributes",getStyle:"getAttribute",setPosition:"setAttributes"});var lE=class{addNodes(t,e){return Vn(this.modules.graph,!0,t,e)}addEdges(t,e){return Vn(this.modules.graph,!1,t,e)}addNode(t,e){return La(this.modules.graph,!0,t,e)}addEdge(t,e){return La(this.modules.graph,!1,t,e)}removeNodes(t,e){return oE(this.modules.graph,t,e)}removeEdges(t,e){return aE(this.modules.graph,t,e)}removeNode(t,e){return nE(this.modules.graph,t,e)}removeEdge(t,e){return rE(this.modules.graph,t,e)}getNodes(t){return this.modules.graph.getNodes(t)}getEdges(t){return this.modules.graph.getEdges(t)}getNode(t){return this.modules.graph.getNode(t)}getEdge(t){return this.modules.graph.getEdge(t)}clearGraph(){this.modules.graph.clear()}setGraph(t,e){return this.modules.graph.clear(),this.addGraph(t,e)}addGraph(t,e){const s=this.modules.graph.getNodes().size===0,i=wv(this.modules.graph,t,e);return s?this.modules.locate.locateGraph({padding:30,ignoreZoomLimits:!0,duration:0}).then(()=>i):i}createNodeList(){return this.getNodes([])}createEdgeList(){return this.getEdges([])}getConnectedComponents(t={}){return this.modules.graph.getConnectedComponents(this.getNodes(t.filter),t)}getConnectedComponentByNode(t,e){const s=this.modules.graph.getNode(t);if(s===void 0)throw new Error(`getComponentByNode: cannot find node ${t}`);return this.modules.graph.getConnectedComponentByNode(s,e)[0]}},dE=class extends Bt{constructor(){super(...arguments),this.storage={nodes:new Hu(!0),edges:new Hu(!1),fetch(t){return t?this.nodes:this.edges}},this._promisesToResolve=[],this._nodeIndexLists=[],this._edgeIndexLists=[],this._onNewFrame=()=>{this.storage.nodes.freeIndexes(),this.storage.edges.freeIndexes()}}onMounted(){this._modules.events.register(["preAddElements","addNodes","addEdges","preAddGraph","postAddGraph","addGraph","excludedStateChange","clearGraph","beforeRemoveNodes","requestElementsToDelete","removeNodes","beforeRemoveEdges","removeEdges"]),[{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}].forEach(t=>{this.createNodeAttribute(t,!0),this.createEdgeAttribute(t,!0)}),this.node=this._ogma.node,this.edge=this._ogma.edge,this.nodeList=this._ogma.nodeList,this.edgeList=this._ogma.edgeList,this._nodes=this.createAttribute(!0,{name:"object",storage:"any"},!0),this._edges=this.createAttribute(!1,{name:"object",storage:"any"},!0),this.createAttribute(!1,{name:"source",storage:32},!0),this.createAttribute(!1,{name:"target",storage:32},!0),this._nodeFilters=dc(this.storage.nodes),this._edgeFilters=dc(this.storage.edges),this._initialize(),this._modules.events.on("frame",this._onNewFrame)}onReady(t){if(t.graph){const{nodes:e,edges:s}=t.graph;e&&this.addNodes(e),s&&this.addEdges(s)}}createIndexList(t){return this.storage.fetch(t).createIndexList()}getDom(){return this._modules.dom}acquireIndexList(t){const e=t?this._nodeIndexLists:this._edgeIndexLists;let s=e.find(i=>!i.isBusy());return s||(s=this.createIndexList(t),e.push(s)),s.markBusy(),s}getObjectList(t){return t?this._nodes:this._edges}getListFactory(t){return t?this.nodeList:this.edgeList}getStorage(t){return t?this.storage.nodes:this.storage.edges}getFilter(t,e){const s=t?this._nodeFilters:this._edgeFilters;return s[e]||s.visible}fireEvent(t,e){this._modules.events.fire(t,e)}getCacheLists(t){return t?this._nodeCacheLists:this._edgeCacheLists}_resolvePromises(){const t=this._promisesToResolve;this._promisesToResolve=[],t.forEach(e=>e())}_initialize(){this._nodeCacheLists=hc(()=>this.getNodeMaxIndex(),()=>this.acquireIndexList(!0),this._nodeFilters),this._edgeCacheLists=hc(()=>this.getEdgeMaxIndex(),()=>this.acquireIndexList(!1),this._edgeFilters),this.topology=new zv(this),this._resolvePromises()}getNodeMaxIndex(){return this.storage.nodes.getMaxIndex()}getEdgeMaxIndex(){return this.storage.edges.getMaxIndex()}isExcluded(t){return this.storage.fetch(t.isNode).getFlexArray("excluded").getMultiple(t._indexes)}setExcluded(t,e){const s=e?1:0,i=t.isNode,n=this.storage.fetch(i),r=n.getFlexArray("excluded"),o=n.getFlexArray("removed"),a=this.acquireIndexList(i),l=this.getListFactory(i);for(let h=0;h<t._indexes.length;h++){const u=t._indexes[h],c=r.get(u),g=o.get(u);s!==c&&g===0&&a.push(u)}const d=a.sliceAndReset();if(d.length){this.getCacheLists(t.isNode).visible.invalidList();const h=l(d);r.setMultiple(d,s),this._modules.events.fire("excludedStateChange",{elements:h,value:e})}}addNode(t,e){return La(this,!0,t,e)}addEdge(t,e){return La(this,!1,t,e)}addNodes(t,e){return Vn(this,!0,t,e)}addEdges(t,e){return Vn(this,!1,t,e)}getExtremityIndex(t,e,s,i){if(e instanceof Ys)return e._index;{const n=this.storage.nodes.getIndex(e);if(!n&&!i)throw new Error(`addEdge(s): invalid ${s===0?"source":"target"} for edge "${t}"; node "${e}" does not exist`);return n}}getNodes(t){return this.getElements(!0,t)}getEdges(t){return this.getElements(!1,t)}getElements(t,e){const s=t?this.nodeList:this.edgeList,i=t?ui:hn,n=t?Ys:Di;if(e&&typeof e!="string"){const r=this.acquireIndexList(t),o=this.storage.fetch(t);if(e instanceof n)r.push(e._index);else if(Qe(e)){const a=e;for(const l of a)if(l instanceof n)r.push(l._index);else{const d=o.getIndex(l);d&&r.push(d)}}else if(e instanceof i){const a=this.getFilter(t,"all"),l=e;for(let d=0;d<l._indexes.length;d++){const h=l._indexes[d];a(h)&&r.push(h)}}return s(r.sliceAndReset())}{const r=e||"visible",o=this.getCacheLists(t)[r];if(!o)throw new Error(`getNodes/getEdges: unexpected argument "${r}"`);return s(o.getList())}}getNode(t){return this._getElement(!0,t)}getEdge(t){return this._getElement(!1,t)}_getElement(t,e){if(e instanceof(t?Ys:Di))return e;const s=this.getStorage(t),i=this.getObjectList(t),n=s.getIndex(e);return n?i.get(n):void 0}clear(){this._modules.events.fire("clearGraph",{nodes:this.getNodes("all"),edges:this.getEdges("all")}),this.storage.nodes.clear(),this.storage.edges.clear(),this._initialize()}createAttribute(t,e,s=!1){return this.storage.fetch(t).createFlexArray(e,s)}createNodeAttribute(t,e){return this.createAttribute(!0,t,e)}createEdgeAttribute(t,e){return this.createAttribute(!1,t,e)}getAttribute(t,e){return this.storage.fetch(t).getFlexArray(e)}getAttributes(t,e){return e.map(s=>this.getAttribute(t,s))}getNodeAttribute(t){return this.storage.nodes.getFlexArray(t)}getNodeAttributes(t){return this.getAttributes(!0,t)}getEdgeAttribute(t){return this.storage.edges.getFlexArray(t)}getEdgeAttributes(t){return this.getAttributes(!1,t)}getAllNodeAttributes(){return this.storage.nodes.getAllFlexArrays()}getAllEdgeAttributes(){return this.storage.edges.getAllFlexArrays()}setSource(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,s._indexes,null)}setTarget(t,e){const s=this.getNode(e);s&&this.topology.setExtremities(t._indexes,null,s._indexes)}getParallelEdges(t,e={}){return this.topology.getParallelEdges(t,e)}hasParallelEdges(t){return this.topology.hasParallelEdges(t._index)}getEdgesBetweenTwoNodes(t,e){return this.edgeList(this.topology.getEdgesBetweenTwoNodes(t._index,e._index))}getAdjacentDirections(t){return this.topology.getAdjacentDirections(t)}getEdgeIndexesInDirection(t){return this.topology.getEdgeIndexesInDirection(t)}fastGetNodesAdjacentElements(t){const e=this._ogma.getNodes();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:e,edges:this._ogma.getEdges()}:this.topology.fastGetNodesAdjacentElements(t._indexes)}fastGetEdgesAdjacentElements(t){const e=this._ogma.getEdges();let s=!1;if(e.size===t.size){const i=new Set(t._indexes);for(let n=0;n<e.size;n++)i.delete(e._indexes[n]);s=i.size===0}return s?{nodes:this._ogma.getNodes(),edges:e}:this.topology.fastGetEdgesAdjacentElements(t._indexes)}getAdjacentNodes(t,e){return this.nodeList(this.topology.getAdjacentElements(!0,t._indexes,e))}getAdjacentEdges(t,e){return this.edgeList(this.topology.getAdjacentElements(!1,t._indexes,e))}getDegree(t,e){return this.topology.getDegree(t._indexes,e)}degrees(t,e){return this.topology.degrees(t,e)}getAdjacencyList({directed:t=!1,internalIndexes:e=!1,weight:s=1,nodes:i,indexes:n}={}){return this.topology.getAdjacencyList({directed:t,weight:s,ids:!e,nodes:n||this.getNodes(i)._indexes})}getConnectedComponents(t,e){return this.topology.getConnectedComponents(t._indexes,e)}getConnectedComponentByNode(t,e){return this.topology.getConnectedComponents(t._indexes,e)}},hE=Wa&&document.fonts,uE=200,Pl="/qwerty/ [HELLO] ",xc="serif",cE=16,gE=class{constructor(){this._fontFaceSet=hE?document.fonts:null,this._canvas=Je(),this._ctx=this._canvas.getContext("2d")}_measureText(t,e){return this._ctx.font=`12px ${e}`,this._ctx.measureText(t).width}check(t){if(t===xc)return!0;const e=this._measureText(Pl,xc);return this._measureText(Pl,t)!==e}load(t){return this._fontFaceSet&&this._fontFaceSet.load?this._fontFaceSet.load(`12px ${t}`):(this._ctx.font=`12px ${t}`,this._ctx.fillText(Pl,10,50),Promise.resolve())}},_E=class{constructor(t,e){this._fontLoaderCounter=0,this._loaded=!1,this._value=null,this._timeout=0,this._fontFaceSet=t,this._fontName=e,this._loaded=!1,this._value=null,this._timeout=0,Wa&&!this._fontFaceSet.check(this._fontName)||this._setLoaded()}_setLoaded(){this._loaded=!0,this._value=this._fontName}getValue(){return this._value}isLoaded(){return this._loaded}destroy(){clearTimeout(this._timeout)}load(){return this._tryLoad(uE).then(()=>{this._setLoaded()})}_tryLoad(t){return this._fontFaceSet.load(this._fontName).then(()=>{if(!this._fontFaceSet.check(this._fontName)&&this._fontLoaderCounter<cE)return new Promise(e=>{t<6e4&&(this._timeout=setTimeout(e,t))}).then(()=>(this._fontLoaderCounter++,this._tryLoad(1.5*t)))})}},mE=class{constructor(){this._fontFaceSet=new gE,this._fonts={},this._onFontLoaded=[],this._hideUntilFontsLoaded=!0}setHideUntilFontsLoaded(t){this._hideUntilFontsLoaded=t}getFont(t){let e=this._fonts[t];return e||(e=new _E(this._fontFaceSet,t),this._fonts[t]=e,e.isLoaded()||e.load().then(()=>this._triggerFontLoaded(t))),!this._hideUntilFontsLoaded&&t||e.getValue()}onFontLoaded(t){this._onFontLoaded.push(t)}destroy(){this._onFontLoaded=[],Object.keys(this._fonts).forEach(t=>this._fonts[t].destroy())}_triggerFontLoaded(t){this._onFontLoaded.forEach(e=>e(t))}},fE=0,pE=1,yE=2,xE=3,bE=4,vE=5,EE=6,AE=7,SE=8,wE=9,ll=10,TE=0,Xf=1,Wf=2,Wh=30,$f=0,LE=1,IE=2,$h=3,CE=4,ME=5,Yh=6,Yf=1e-6,Cs=Math.PI,Tr=2*Math.PI,Zf=Cs*(5/4),Kf=Cs*(7/4),Qf=Cs*(3/4),Jf=Cs*(1/4),bc=1.1,vc=.07,NE=1,Ec=1,Ac=.17,FE=1,PE=-Cs/2,DE=Cs/2,kE={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}},RE={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0},OE={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0};function zE(t,e,s,i){Zh(t,e,s,i),t.thicknessOrFontSizeScaled=e.widthScaled,t.thicknessOrFontSizeFixed=e.widthFixed,t.strokeWidthScaled=e.stroke.widthScaled,t.strokeWidthFixed=e.stroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.color,t.strokeColor=e.stroke.color,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=e.stroke.minVisibleSize,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}function Zh(t,e,s,i){t.pieceId=s,t.shape=i,t.x1=e.sourceX,t.y1=e.sourceY,t.x2=e.targetX,t.y2=e.targetY,t.rectWidthOrSourceRadiusScaled=e.sourceRadiusScaled,t.rectWidthOrSourceRadiusFixed=e.sourceRadiusFixed,t.rectHeightOrTargetRadiusScaled=e.targetRadiusScaled,t.rectHeightOrTargetRadiusFixed=e.targetRadiusFixed,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=0,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.widthScaled,t.curvature=e.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=e.isSelfLoop,t.isText=!1}function BE(t,e,s){const i=e.widthScaled+2*e.halo.widthScaled,n=e.widthFixed+2*e.halo.widthFixed;Zh(t,e,s,"line"),t.thicknessOrFontSizeScaled=i,t.thicknessOrFontSizeFixed=n,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=e.halo.color,t.strokeColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.symbolicSize=e.widthScaled,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1}function UE(t,e,s,i){Zh(t,e,s,i);const n=e.widthFixed*Ac+FE;t.thicknessOrFontSizeScaled=e.widthScaled*Ec,t.thicknessOrFontSizeFixed=e.widthFixed*Ec,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=e.widthScaled*Ac,t.offsetFixed=n,t.fillColor=e.outline.color,t.strokeColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,e.outline.minVisibleSize),t.strokeMinVisibleSize=0,t.offsetAngle=Math.PI/2,t.symbolicSize=e.widthScaled,t.dashLength=e.shape.dashLength,t.gapLength=e.shape.gapLength,t.hasHead=!!e.shape.head,t.hasTail=!!e.shape.tail,t.isBodyTriangle=e.shape.isBodyTriangle}var Rs=1,Qi=2,Ca=3,Rd=1,Ni=2,Yi=3,oo=4,Ji=5,tn=6,ki=7,Ns=1,dl=2,Kh=3,Qh=4,Cn=5,Rn=6,On=1,tp=2,ep=3;function GE(t,e,s){sp(t,e,s),t.pattern.type=ki,t.pattern.attributes.text=e.content,t.pattern.attributes.size=ro,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternColor=e.color,t.patternScale=1,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function VE(t,e,s){sp(t,e,s),t.pieceId+=Rn,t.fillColor=e.backgroundColor,t.shape="square"}function sp(t,e,s){const i=e.position==="centered"?0:(s.widthScaled+e.heightScaled)/2+s.stroke.widthScaled,n=e.position==="centered"?0:(s.widthFixed+e.heightFixed)/2+s.stroke.widthFixed+e.padding+e.margin;t.pieceId=Cn,t.shape="square",t.x1=s.sourceX,t.y1=s.sourceY,t.x2=s.targetX,t.y2=s.targetY,t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding+1,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=s.sourceRadiusScaled+s.targetRadiusScaled,t.strokeWidthFixed=s.sourceRadiusFixed+s.targetRadiusFixed,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=0,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=Math.max(e.minVisibleSize,s.minVisibleSize),t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.offsetAngle,t.patternScale=0,t.symbolicSize=s.widthScaled,t.curvature=s.curvature,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=s.isSelfLoop,t.isText=!1,t.adjustTextAngle=e.adjustAngle}var ao="shifted",jE="centered";function Jh(t,e){if(e<2)return t;const s=t.split(`
`),i=[];for(let n=0;n<s.length;++n){const r=s[n];if(r.length<e)i.push(r);else{const o=ip(s[n],e);for(let a=0;a<o.length;++a)i.push(o[a])}}return i.join(`
`)}function ip(t,e){const s=[""],i=t.split(" ");for(let n=0;n<i.length;n++){const r=s[s.length-1],o=i[n];r.length+1+o.length<=e&&r.length?s[s.length-1]+=(r.length>0?" ":"")+o:s.push(o)}return s}function np(t,e){if(t===null)return null;const s=(t=t.toString()).split(`
`),i=[];let n=0;for(let r=0;r<s.length;r++){let o=s[r];if(!e||e<=1||o.length<e)i.push(o),n=Math.max(n,o.length);else{const a=ip(s[r],e);for(let l=0;l<a.length;l++)o=a[l],i.push(o),n=Math.max(n,o.length)}}return{data:i,maxLength:n,lines:i.length}}function rp(){const t=Ms("@mapbox/mapbox-gl-rtl-text")||Ms("mapbox-gl-rtl-text"),e=t?t.processBidirectionalText:sn?window.processBidirectionalText:null,s=t?t.applyArabicShaping:sn?window.applyArabicShaping:null;return{processBidirectionalText:e?n=>{if(n===null||n==null)return"";const r=[];let o=0,a="";const l=n.split(`
`);for(let d=0;d<l.length;d++){const h=l[d],u=l[d].length+o;u>0&&d<l.length-1&&r.push(u),a+=d>0?""+h:h,o+=h.length}return e(a,r).join(`
`)}:n=>n,applyArabicShaping:s?n=>n==null?null:typeof n=="number"?n.toString():s(n):n=>n==null?null:n.toString()}}var qE=t=>!!t||t===0;function zs(t,e,s=0){return t==="inherit"?Array.isArray(e)?e[((s/(2*Math.PI)*e.length|0)+1)%e.length]:e:t}function HE(t,e,s){return t==="source"?Array.isArray(e)?e[0]:e:t==="target"?Array.isArray(s)?s[0]:s:t}function XE(t){const e=t.depth;return e===Wf||e===Xf||(e-Wh)%Yh>=$h}function op(t){const e=(t.depth-Wh)%Yh;return e>=0&&e!==$f&&e!==$h}function Sc(t,e,s,i,n,r){WE(t,e,s,i,n,r),wc(t,e,s,i.text,n.texts.primary,r.texts.primary,r),wc(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r)}function WE(t,e,s,i,n,r){if(i.width.get(s)!==0){if(Dl(n.body,r,zE),n.halo.body){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),Dl(n.halo,r,BE)}n.outline.body&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),Dl(n.outline,r,UE))}}function Dl(t,e,s){s(t.body,e,dl,e.shape.body),t.head&&s(t.head,e,Kh,e.shape.head),t.tail&&s(t.tail,e,Qh,e.shape.tail)}function wc(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=zs(a.color.get(s),o.color),r.position=a.position?a.position.get(s):ao,r.style=a.style.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=Jh(r.content,r.maxLineLength),r.adjustAngle=a.adjustAngle.get(s),r.align=a.align.get(s),l){const h=a.scale.get(s);r.sizeScaled=o.widthScaled*h,r.sizeFixed=o.widthFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.offsetAngle=r===o.texts.primary?PE:DE,GE(n.text,r,o),n.background&&VE(n.background,r,o)}}function Tc(t,e){kl(t.body,e,!0,!0),kl(t.outline,e,e.outline.enabled,!0),kl(t.halo,e,!!e.halo.color,!1),Lc(t.texts.primary,e.texts.primary),Lc(t.texts.secondary,e.texts.secondary)}function kl(t,e,s,i){t.body=s,t.head=s&&i&&!!e.shape.head,t.tail=s&&i&&!!e.shape.tail}function Lc(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor}var tu=512,eu=128,ap=Math.round(Math.log2(tu)),su=Math.round(Math.log2(eu)),$E=ap+su,Mn=255,YE=32767,lp=65535,Od=15,Nn=3,Ma=15,ca=32,Ei=128,zd=8,Bd=1/16,Ud=Math.round(Math.sqrt(Ma+1)),Gd=Ei*Ud,ns=16,Ri=1,Ps=256,ZE=128,KE=128,Na=1.5,dp=1,qn=56,QE=16,JE=2*qn+QE,ga=6,hp=3,hs=41,hl=5,Fa=5,up=.9721,Hr=24,tA=1.4142;function Eo(t,e,s,i,n){const r=1-n;return r*r*r*t+3*n*r*r*e+3*n*n*r*s+n*n*n*i}function Fn(t,e,s,i){const n=1-i;return n*n*t+2*n*i*e+i*i*s}var cp=(t,e)=>2/(1+Math.exp(-Math.abs(t*e)));function Bs(t,e,s,i,n,r){const o=r||{x:0,y:0},a=(t+s)/2,l=(e+i)/2,d=t-s,h=e-i,u=Math.sqrt(d*d+h*h);if(u===0)return o.x=a,o.y=l,o;const c=h/u,g=-d/u,_=-u*n/hl;return o.x=a+c*_,o.y=l+g*_,o}function un(t,e,s,i,n,r){const o=r||{x1:0,y1:0,x2:0,y2:0},a=(i+i/Fa*s)*Fa,l=-n+Cs,d=Cs/2-n;return o.x1=t+Math.cos(l)*a,o.y1=e+Math.sin(l)*a,o.x2=t+Math.cos(d)*a,o.y2=e+Math.sin(d)*a,o}function Ic(t,e,s,i,n,r){eA(t,e,s,i,n,r),Cc(t,e.texts.primary,s.text,i,e),Cc(t,e.texts.secondary,s.text.secondary,i,e)}function eA(t,e,s,i,n,r){const o=n.source,a=n.target,l=s.source.get(i),d=s.target.get(i),h=o.x.get(l),u=o.y.get(l),c=o.radius.get(l),g=o.color.get(l),_=+(o.scalingMethod.get(l)==="scaled"),m=a.x.get(d),f=a.y.get(d),p=a.radius.get(d),y=a.color.get(d),b=+(a.scalingMethod.get(d)==="scaled"),x=HE(s.color.get(i),g,y),v=s.width.get(i),E=s.scalingMethod.get(i)==="scaled"?1:0,w=s.stroke.width.get(i),A=s.stroke.scalingMethod.get(i)==="scaled"?1:0,I=kE[s.shape.style.get(i)],M=s.adjustAnchors.get(i);if(e.source=l,e.target=d,e.sourceX=h,e.sourceY=u,e.targetX=m,e.targetY=f,e.sourceRadiusScaled=c*_,e.sourceRadiusFixed=c*(1-_),e.targetRadiusScaled=p*b,e.targetRadiusFixed=p*(1-b),e.widthScaled=v*E,e.widthFixed=v*(1-E),e.curvature=s.curvature.get(i),e.isSelfLoop=l===d,e.color=x,e.opacity=s.opacity.get(i),e.minVisibleSize=s.minVisibleSize.get(i),e.shape.body=s.shape.body.get(i),e.shape.head=s.shape.head.get(i),e.shape.tail=s.shape.tail.get(i),e.shape.dashLength=I.dash,e.shape.gapLength=I.gap,e.shape.isBodyTriangle=e.shape.body==="triangle",e.stroke.color=zs(s.stroke.color.get(i),x),e.stroke.widthScaled=w*A,e.stroke.widthFixed=w*(1-A),e.stroke.minVisibleSize=s.stroke.minVisibleSize.get(i),e.halo.color=s.halo.color.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1,M&&(e.shape.head||e.shape.tail||e.shape.body==="triangle")){const k=e,W=k.curvature,H=k.sourceX,$=k.sourceY,P=k.targetX,S=k.targetY;let Y=1,st=1;if(W){if(!k.isSelfLoop){const at=Bs(H,$,P,S,W/2);Y=Ao(k,r,o,l,H,$,at.x,at.y),st=Ao(k,r,a,d,P,S,at.x,at.y)}}else Y=Ao(k,r,o,l,H,$,P,S),st=Ao(k,r,a,d,P,S,H,$);e.sourceRadiusScaled*=Y,e.sourceRadiusFixed*=Y,e.targetRadiusScaled*=st,e.targetRadiusFixed*=st}}function Cc(t,e,s,i,n){e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=zs(s.backgroundColor.get(i),n.color)}function Ao(t,e,s,i,n,r,o,a){const l=e.angle||0;let d,h=Math.atan2(a-r,o-n)-l,u=1,c=0;h<-Cs?h+=Tr:h>Cs&&(h-=Tr),h<-Cs/2?(c=Zf,d=s.badges.topLeft):h<0?(c=Kf,d=s.badges.topRight):h<Cs/2?(c=Jf,d=s.badges.bottomRight):(c=Qf,d=s.badges.bottomLeft),c+=l;const g=d.text.content&&d.text.content.get(i),_=d.image.url&&d.image.url.get(i);if(qE(g)||_){const m=d.positionScale.get(i),f=d.scale.get(i),p=ef(o,a,n,r,n+Math.cos(c)*m,r+Math.sin(c)*m,f);if(p){const y=p.x-n,b=p.y-r,x=Math.sqrt(y*y+b*b);u=Math.max(u,x)}}if(s.shape.get(i)==="square"){const m=Math.abs(Math.cos(h)),f=Math.abs(Math.sin(h)),p=1/Math.max(m,f);u=Math.max(u,p)}return u}function Mc(){return{source:0,target:0,sourceX:0,sourceY:0,targetX:0,targetY:0,sourceRadiusScaled:0,sourceRadiusFixed:0,targetRadiusScaled:0,targetRadiusFixed:0,widthScaled:0,widthFixed:0,curvature:0,isSelfLoop:!1,color:"",opacity:0,minVisibleSize:0,shape:{body:"line",head:null,tail:null,dashLength:0,gapLength:0,isBodyTriangle:!1},stroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,color:""},outline:{enabled:!1,color:"",minVisibleSize:0},textHidden:!1,texts:{primary:Nc(),secondary:Nc()}}}function Nc(){return{align:"left",hidden:!1,content:"",backgroundColor:"",font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",minVisibleSize:0,margin:0,padding:0,position:ao,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,adjustAngle:!1,offsetAngle:0}}function sA(t){return t===null?t:void 0}function Ke(t){return typeof t=="boolean"||t===0||t===1?t:void 0}function en(t){return typeof t=="number"&&isFinite(t)?t:void 0}function Se(t){return typeof t=="number"&&isFinite(t)&&t>=0?t:void 0}var gp=-100,iA=400,_p=t=>typeof t=="number"&&isFinite(t)&&t>=gp&&t<=iA?t:void 0;function ni(t){return t===null||typeof t=="string"||typeof t=="number"?t:void 0}function Li(t){return t==="fixed"||t==="scaled"?t:void 0}function Ii(t){return os(t)?t:void 0}function nA(t){return t===jE||t===ao?t:void 0}function is(t){return t==="inherit"||os(t)?t:void 0}function rA(t){return t==="source"||t==="target"||os(t)?t:void 0}function zn(t){return t===null?null:typeof t=="string"?t.split(",").map(e=>{const s=e.trim(),i=s.indexOf(" ")!==-1,n=s[0];return i&&n!=='"'&&n!=="'"?`"${s}"`:s}).join(","):void 0}function Bn(t){return t==="none"?"normal":t==="normal"||t==="italic"||t==="bold"||t==="italic bold"||t==="bold italic"?t:void 0}function Pa(t){return t==="left"||t==="center"?t:void 0}function oA(t){return t==="equilateral"?"pentagon":t==="circle"||t==="square"||t==="cross"||t==="diamond"||t==="pentagon"||t==="star"?t:void 0}function aA(t){return["line","tapered","arrow","dashed","dotted"].includes(t)?t:void 0}function lA(t){return t==="line"||t==="triangle"?t:void 0}function Fc(t){return[null,"arrow","circle-hole-arrow","triangle-hole-arrow","short-arrow","sharp-arrow","circle","square"].includes(t)?t:void 0}function dA(t){return t==="plain"||t==="dashed"||t==="dotted"?t:void 0}function hA(t){return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="center"?t:void 0}function uA(t){if(os(t))return t;if(Array.isArray(t)){if(t.length<1)return;for(let e=0;e<t.length;++e)if(!os(t[e]))return;return t}}function he(t){return function(e){if(typeof e=="number")return isFinite(e)&&e>=0?e:void 0;if(typeof e!="string"||e.charAt(e.length-1)!=="%")return;const s=parseFloat(e);return isNaN(s)?void 0:t*s/100}}function iu(){return{edgeHalo:0,nodeHaloStroke:0,nodeHalo:0,edgeBody:0,edgeTextBackground:0,edgeText:0,nodeBody:0,nodeTextBackground:0,nodeText:0}}function Xr(t,e=iu()){const s=(t-gp)*Yh+Wh;return e.edgeHalo=TE,e.nodeHaloStroke=Xf,e.nodeHalo=Wf,e.edgeBody=s+$f,e.edgeTextBackground=s+LE,e.edgeText=s+IE,e.nodeBody=s+$h,e.nodeTextBackground=s+CE,e.nodeText=s+ME,e}var cA=(t,e)=>{e.halo.body=e.halo.body||t.halo.body,e.halo.head=e.halo.head||t.halo.head,e.halo.tail=e.halo.tail||t.halo.tail,e.outline.body=e.outline.body||t.outline.body,e.outline.head=e.outline.head||t.outline.head,e.outline.tail=e.outline.tail||t.outline.tail,e.body.body=e.body.body||t.body.body,e.body.head=e.body.head||t.body.head,e.body.tail=e.body.tail||t.body.tail;const s=e.texts,i=t.texts;s.primary.text=s.primary.text||i.primary.text,s.primary.background=s.primary.background||i.primary.background,s.secondary.text=s.secondary.text||i.secondary.text,s.secondary.background=s.secondary.background||i.secondary.background},mp=t=>(e,s)=>{s.halo.body=e.halo.body[t],s.halo.head=e.halo.head[t],s.halo.tail=e.halo.tail[t],s.outline.body=e.outline.body[t],s.outline.head=e.outline.head[t],s.outline.tail=e.outline.tail[t],s.body.body=e.body.body[t],s.body.head=e.body.head[t],s.body.tail=e.body.tail[t],s.texts.primary.text=e.texts.primary.text[t],s.texts.primary.background=e.texts.primary.background[t],s.texts.secondary.text=e.texts.secondary.text[t],s.texts.secondary.background=e.texts.secondary.background[t]},gA=mp("start"),_A=mp("end"),mA=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,view:n,attributes:r,attributesPrev:o,nodeAttributes:a,nodeAttributesPrev:l}){this._fullComponents=nr(),this._startComponents=nr(),this._endComponents=nr(),this._startFlags=nr(),this._endFlags=nr(),this._startInput=Mc(),this._endInput=Mc(),this._depthInfo=iu(),this._nullElt={id:-1,valid:!0},this._engine=t,this._view=n,this._helper={imageManager:e,fontManager:s,formatText:i},this._attributes=r,this._attributesPrev=o,this._nodeAttributes=a,this._nodeAttributesPrev=l,this._layers=Pc(()=>t.createGroup()),this._blockIds=Pc(()=>0)}drawEdge(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=-t,n=this._attributes,r=Xr(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),o=n.source.get(t),a=n.target.get(t),l=n.curvature.get(t),d=this._attributesPrev.curvature.get(t),h=n.animationDuration.get(t),u=n.animationStart.get(t),c=n.animationEasing.get(t),g=h>0,_=l!==0||g&&d!==0;this._prepareBlocks(g,r,i,_);const m=this._extremitiesAttributes={source:this._nodeAttributes,target:this._nodeAttributes};if(Ic(s,this._endInput,n,t,m,this._view),Tc(this._endFlags,this._endInput),g){const f=this._nodeAttributes.animationDuration.get(o)>0,p=this._nodeAttributes.animationDuration.get(a)>0;m.source=f?this._nodeAttributesPrev:this._nodeAttributes,m.target=p?this._nodeAttributesPrev:this._nodeAttributes,Ic(s,this._startInput,this._attributesPrev,t,m,this._view),Tc(this._startFlags,this._startInput),cA(this._endFlags,this._startFlags)}this._initComponents(this._fullComponents,this._endFlags,this._layers),_A(this._fullComponents,this._endComponents),Sc(e,s,t,this._attributes,this._endComponents,this._endInput),g&&(gA(this._fullComponents,this._startComponents),Sc(e,s,t,this._attributesPrev,this._startComponents,this._startInput),this._setBlocksAnimation(h,u,c)),this._setupHaloMasking(o,a),this._storeBlocks()}_setupHaloMasking(t,e){const s=this._nodeAttributes.halo,i=this._layers,n=s.color.get(t)&&s.hideNonAdjacentEdges.get(t),r=s.color.get(e)&&s.hideNonAdjacentEdges.get(e),o=!n&&!r?ep:On;i.body.stencilUsage=i.text.stencilUsage=i.textBg.stencilUsage=o}_computeBlockIds(t){const e=t*ll,s=this._blockIds;s.body=e+vE,s.halo=e+SE,s.text=e+EE,s.textBg=e+AE}_prepareBlocks(t,e,s,i){const n=this._layers;n.body.reset(i?Ca:Rs,t,e.edgeBody,s),n.halo.reset(i?Ca:Rs,t,e.edgeHalo,s),n.text.reset(Qi,t,e.edgeText,s),n.textBg.reset(Rs,t,e.edgeTextBackground,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.halo,e.halo),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.halo),t.freeBlock(e.text),t.freeBlock(e.textBg)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._initEdgeComponents(t.halo,e.halo,s.halo),this._initEdgeComponents(t.outline,e.outline,s.body),this._initEdgeComponents(t.body,e.body,s.body),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initEdgeComponents(t,e,s){t.head=this._nextElement(e.head,s),t.tail=this._nextElement(e.tail,s),t.body=this._nextElement(e.body,s)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}};function Pc(t){return{body:t(),halo:t(),text:t(),textBg:t()}}function nr(){return{halo:{body:void 0,head:void 0,tail:void 0},outline:{body:void 0,head:void 0,tail:void 0},body:{body:void 0,head:void 0,tail:void 0},texts:{primary:{text:void 0,background:void 0},secondary:{text:void 0,background:void 0}}}}function fA(t,e,s){fp(t,e,s),e.imageContent!==null?(t.pattern.type=Ni,t.pattern.attributes.image=e.imageContent,t.pattern.attributes.scaled=!0,t.pattern.attributes.duplicated=!1,t.patternScale=e.imageScale,t.patternMinVisibleSize=0,t.patternColor=null):(t.fillColor=null,t.strokeColor=null)}function pA(t,e,s){fp(t,e,s),e.textContent&&(t.pattern.type=tn,t.pattern.attributes.text=e.textContent,t.pattern.attributes.font=e.textFont,t.pattern.attributes.style=e.textStyle,t.pattern.attributes.paddingLeft=e.scale*e.textPaddingLeft*2,t.pattern.attributes.paddingTop=e.scale*e.textPaddingTop*2,t.pattern.attributes.size=ro,t.patternMinVisibleSize=0,t.patternColor=e.textColor,t.patternScale=e.textScale,t.isBadge=!0),!e.imageUrl&&e.textContent||(t.fillColor=null,t.strokeColor=null)}function fp(t,e,s){const i=s.diameterScaled*e.scale,n=s.diameterFixed*e.scale,r=s.diameterScaled*e.positionScale/2,o=s.diameterFixed*e.positionScale/2;t.pieceId=Ns,t.shape="circle",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=i,t.rectWidthOrSourceRadiusFixed=n,t.rectHeightOrTargetRadiusScaled=i,t.rectHeightOrTargetRadiusFixed=n,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.strokeWidthScaled,t.strokeWidthFixed=e.strokeWidthFixed,t.offsetScaled=r,t.offsetFixed=o,t.pattern.type=0,t.opacity=s.opacity,t.fillColor=e.color,t.strokeColor=e.strokeColor,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.angle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function yA(t,e,s){ul(t,e),t.fillColor=Array.isArray(e.color)?null:e.color,t.strokeColor=e.innerStroke.color,t.strokeMinVisibleSize=e.innerStroke.minVisibleSize,t.strokeWidthScaled=e.innerStroke.widthScaled,t.strokeWidthFixed=e.innerStroke.widthFixed,s&&(t.pattern.type=0)}function ul(t,e){t.pieceId=Ns,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=e.diameterScaled,t.rectWidthOrSourceRadiusFixed=e.diameterFixed,t.rectHeightOrTargetRadiusScaled=e.diameterScaled,t.rectHeightOrTargetRadiusFixed=e.diameterFixed,t.shape=e.shape,t.opacity=e.opacity,t.symbolicSize=e.diameterScaled,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.fillColor=null,t.strokeColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.offsetAngle=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function xA(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=Ns,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=0,t.opacity=e.opacity,t.fillColor=e.halo.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function bA(t,e){const s=e.diameterScaled+2*e.halo.widthScaled,i=e.diameterFixed+2*e.halo.widthFixed;t.pieceId=Ns,t.shape="circle",t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.halo.strokeWidthScaled,t.strokeWidthFixed=e.halo.strokeWidthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=0,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.halo.strokeColor,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function vA(t,e){ul(t,e),t.pattern.type=Ji,t.pattern.attributes.text=e.icon.content,t.pattern.attributes.font=e.icon.font,t.pattern.attributes.style=e.icon.style,t.pattern.attributes.size=ro,t.patternMinVisibleSize=e.icon.minVisibleSize,t.patternColor=e.icon.color,t.patternScale=e.icon.scale}function EA(t,e){const s=e.image.fit&&!e.image.tile;ul(t,e),t.pattern.type=Ni,t.pattern.attributes.image=e.image.content,t.pattern.attributes.scaled=s,t.pattern.attributes.duplicated=e.image.tile,t.patternScale=s?e.image.scale:0,t.patternMinVisibleSize=e.image.minVisibleSize,t.patternColor=null}function AA(t,e){const s=e.diameterScaled+2*e.innerStroke.widthScaled,i=e.diameterFixed+2*e.innerStroke.widthFixed;t.pieceId=Ns,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=e.outerStroke.widthScaled,t.strokeWidthFixed=e.outerStroke.widthFixed,t.offsetScaled=0,t.offsetFixed=0,t.pattern.type=0,t.opacity=e.opacity,t.fillColor=null,t.strokeColor=e.outerStroke.color,t.patternColor=null,t.globalMinVisibleSize=e.outerStroke.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function SA(t,e){const s=e.diameterScaled*bc,i=e.diameterFixed*bc;let n=e.diameterScaled*vc,r=e.diameterFixed*vc+NE;e.outerStroke.color&&(n+=e.outerStroke.widthScaled/2,r+=e.outerStroke.widthFixed/2),t.pieceId=Ns,t.shape=e.shape,t.x1=e.x,t.y1=e.y,t.x2=e.x,t.y2=e.y,t.rectWidthOrSourceRadiusScaled=s,t.rectWidthOrSourceRadiusFixed=i,t.rectHeightOrTargetRadiusScaled=s,t.rectHeightOrTargetRadiusFixed=i,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=0,t.opacity=e.opacity,t.fillColor=e.outline.color,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.outline.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=1.5707963267948966,t.patternScale=0,t.symbolicSize=e.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function wA(t,e){ul(t,e),Array.isArray(e.color)&&(t.pattern.type=oo,t.pattern.attributes.colors=e.color.join(";"),t.patternScale=1,t.patternMinVisibleSize=0,t.patternColor=null)}function TA(t,e,s){pp(t,e,s),t.pattern.type=ki,t.pattern.attributes.text=e.content,t.pattern.attributes.font=e.font,t.pattern.attributes.style=e.style,t.pattern.attributes.align=e.align,t.patternMinVisibleSize=0,t.patternColor=e.color,t.thicknessOrFontSizeScaled=e.sizeScaled,t.thicknessOrFontSizeFixed=e.sizeFixed,t.isText=!0}function LA(t,e,s){pp(t,e,s),t.fillColor=e.backgroundColor,t.pieceId=Rn,t.shape="square"}function IA(t,e,s){const i=Math.ceil(e.margin/2),n=s.diameterScaled/2,r=s.diameterFixed/2+i,o=OE[e.position],a=Math.cos(o),l=Math.sin(o),d=e.margin<12?1:e.margin<30?1-(e.margin-12)/18*.7:.25;t.pieceId=Ns,t.shape="triangle",t.x1=s.x-a,t.y1=s.y-l,t.x2=s.x+a,t.y2=s.y+l,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=e.margin,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=e.margin*d,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=n,t.offsetFixed=r,t.pattern.type=0,t.opacity=s.opacity,t.fillColor=e.backgroundColor,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=0,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1}function pp(t,e,s){let i=0,n=0;if(e.isPositionCenter||(i+=s.diameterScaled/2,n+=s.diameterFixed/2+e.margin+e.padding),e.isPositionVertical){if(i+=e.heightScaled/2,n+=e.heightFixed/2,e===s.texts.secondary&&s.texts.primary.position==="bottom"){const o=s.texts.primary;i+=o.heightScaled,n+=o.heightFixed+o.margin+2*o.padding}}else e.isPositionHorizontal&&(i+=e.widthScaled/2,n+=e.widthFixed/2);const r=ro;t.pieceId=Ns,t.shape="square",t.x1=s.x,t.y1=s.y,t.x2=s.x,t.y2=s.y,t.rectWidthOrSourceRadiusScaled=e.widthScaled,t.rectWidthOrSourceRadiusFixed=e.widthFixed+2*e.padding,t.rectHeightOrTargetRadiusScaled=e.heightScaled,t.rectHeightOrTargetRadiusFixed=e.heightFixed+2*e.padding,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=i,t.offsetFixed=n,t.pattern.type=0,t.pattern.attributes.size=r,t.opacity=s.opacity,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=e.minVisibleSize,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=e.positionAngle,t.patternScale=1,t.symbolicSize=s.diameterScaled,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isSelfLoop=!1,t.isText=!1}function Dc(t,e,s,i,n,r){const o=n.badges,a=i.badges,l=r.badges;CA(t,e,s,i,n,r),kc(t,e,s,i.text,n.texts.primary,r.texts.primary,r),kc(t,e,s,i.text.secondary,n.texts.secondary,r.texts.secondary,r),So(t,e,s,a.topLeft,o.topLeft,l.topLeft,r),So(t,e,s,a.topRight,o.topRight,l.topRight,r),So(t,e,s,a.bottomLeft,o.bottomLeft,l.bottomLeft,r),So(t,e,s,a.bottomRight,o.bottomRight,l.bottomRight,r)}function CA(t,e,s,i,n,r){if(n.halo){const o=i.halo.width.get(s),a=+(i.halo.scalingMethod.get(s)==="scaled");r.halo.widthScaled=o*a,r.halo.widthFixed=o*(1-a),xA(n.halo,r),n.haloStroke&&(r.halo.strokeWidthScaled=0,r.halo.strokeWidthFixed=i.halo.strokeWidth.get(s),bA(n.haloStroke,r))}if(n.outline&&(r.outline.color=i.outline.color.get(s),r.outline.minVisibleSize=i.outline.minVisibleSize.get(s),SA(n.outline,r)),n.outerStroke&&(r.outerStroke.minVisibleSize=i.outerStroke.minVisibleSize.get(s),AA(n.outerStroke,r)),n.pieChart&&wA(n.pieChart,r),n.image&&(r.image.content=e.imageManager.getImage(r.image.url),r.image.fit=i.image.fit.get(s),r.image.tile=i.image.tile.get(s),r.image.scale=i.image.scale.get(s),r.image.minVisibleSize=i.image.minVisibleSize.get(s),EA(n.image,r)),n.icon&&(r.icon.font=e.fontManager.getFont(i.icon.font.get(s)),r.icon.style=i.icon.style.get(s),r.icon.color=i.icon.color.get(s),r.icon.scale=i.icon.scale.get(s),r.icon.minVisibleSize=i.icon.minVisibleSize.get(s),vA(n.icon,r)),n.body){const o=!n.pieChart&&!n.image&&!n.icon;yA(n.body,r,o)}}function So(t,e,s,i,n,r,o){if(n.image||n.text){const a=i.stroke.width.get(s),l=+(i.stroke.scalingMethod.get(s)==="scaled");r.color=zs(i.color.get(s),o.color,r.angle),r.strokeColor=i.stroke.color.get(s),r.strokeWidthScaled=a*l,r.strokeWidthFixed=a*(1-l),r.minVisibleSize=i.minVisibleSize.get(s),r.positionScale=i.positionScale.get(s),r.scale=i.scale.get(s)}if(n.image&&(r.imageContent=e.imageManager.getImage(r.imageUrl),r.imageScale=i.image.scale.get(s),fA(n.image,r,o)),n.text){if(r.textFont=e.fontManager.getFont(i.text.font.get(s)),r.textStyle=i.text.style.get(s),r.textColor=zs(i.text.color.get(s),o.color),r.textScale=i.text.scale.get(s),r.textPaddingTop=i.text.paddingTop.get(s),r.textPaddingLeft=i.text.paddingLeft.get(s),t.measureText(r.textContent,r.textFont,r.textStyle,r.textScale).width>1){let a=0,l=0;for(;l<r.textContent.length&&a<1;)a+=t.measureText(r.textContent[l],r.textFont,r.textStyle,r.textScale).width,l+=1;l!==r.textContent.length&&(r.textContent=r.textContent.substring(0,l-1)+"‥")}pA(n.text,r,o)}}function kc(t,e,s,i,n,r,o){if(n.text&&r.content){const a=i,l=a.scaling.get(s);if(r.font=e.fontManager.getFont(a.font.get(s)),r.color=zs(a.color.get(s),o.color),r.style=a.style.get(s),r.align=a.align.get(s),r.minVisibleSize=a.minVisibleSize.get(s),r.margin=a.margin.get(s),r.padding=a.padding.get(s),r.maxLineLength=a.maxLineLength.get(s),r.content=Jh(r.content,r.maxLineLength),l){const h=a.scale.get(s);r.sizeScaled=o.diameterScaled*h,r.sizeFixed=o.diameterFixed*h}else r.sizeFixed=a.size.get(s),r.sizeScaled=0;const d=t.measureText(r.content,r.font,r.style);r.widthScaled=d.width*r.sizeScaled,r.widthFixed=d.width*r.sizeFixed,r.heightScaled=d.height*r.sizeScaled,r.heightFixed=d.height*r.sizeFixed,r.positionAngle=RE[r.position],r.isPositionCenter=r.position==="center",r.isPositionVertical=r.position==="top"||r.position==="bottom",r.isPositionHorizontal=r.position==="left"||r.position==="right",TA(n.text,r,o),n.background&&(LA(n.background,r,o),n.tip&&IA(n.tip,r,o))}}function Rc(t,e){MA(t,e),Oc(t.texts.primary,e.texts.primary),Oc(t.texts.secondary,e.texts.secondary),wo(t.badges.topLeft,e.badges.topLeft),wo(t.badges.topRight,e.badges.topRight),wo(t.badges.bottomLeft,e.badges.bottomLeft),wo(t.badges.bottomRight,e.badges.bottomRight)}function MA(t,e){t.body=!0,t.icon=!!e.icon.content,t.image=!!e.image.url,t.pieChart=Array.isArray(e.color),t.outerStroke=!!e.outerStroke.color,t.outline=!!e.outline.enabled,t.halo=!!e.halo.color,t.haloStroke=t.halo&&!!e.halo.strokeColor}function Oc(t,e){t.text=!e.hidden&&!!e.content,t.background=t.text&&!!e.backgroundColor,t.tip=t.background&&e.tip&&e.position!=="center"}function wo(t,e){t.text=!!e.textContent,t.image=!!e.imageUrl}function zc(t,e,s,i){NA(t,e,s,i),Bc(t,e.texts.primary,s.text,i,e),Bc(t,e.texts.secondary,s.text.secondary,i,e),To(t,e.badges.topLeft,s.badges.topLeft,i),To(t,e.badges.topRight,s.badges.topRight,i),To(t,e.badges.bottomLeft,s.badges.bottomLeft,i),To(t,e.badges.bottomRight,s.badges.bottomRight,i)}function NA(t,e,s,i){const n=+(s.scalingMethod.get(i)==="scaled"),r=2*s.radius.get(i),o=s.innerStroke.width.get(i),a=+(s.innerStroke.scalingMethod.get(i)==="scaled"),l=s.outerStroke.width.get(i),d=+(s.outerStroke.scalingMethod.get(i)==="scaled");e.x=s.x.get(i),e.y=s.y.get(i),e.shape=s.shape.get(i),e.color=s.color.get(i),e.opacity=s.opacity.get(i),e.diameterScaled=r*n,e.diameterFixed=r*(1-n),e.innerStroke.color=zs(s.innerStroke.color.get(i),e.color),e.innerStroke.widthScaled=o*a,e.innerStroke.widthFixed=o*(1-a),e.innerStroke.minVisibleSize=s.innerStroke.minVisibleSize.get(i),e.outerStroke.color=zs(s.outerStroke.color.get(i),e.color),e.outerStroke.widthScaled=l*d,e.outerStroke.widthFixed=l*(1-d),e.halo.color=s.halo.color.get(i),e.halo.strokeColor=s.halo.strokeColor.get(i),e.icon.content=t.formatText(s.icon.content.get(i)),e.image.url=s.image.url.get(i),e.outline.enabled=s.outline.enabled.get(i),e.textHidden=s.textHidden.get(i)===1}function Bc(t,e,s,i,n){if(e.hidden=n.textHidden,e.content=t.formatText(s.content.get(i)),e.backgroundColor=zs(s.backgroundColor.get(i),n.color),e===n.texts.primary){const r=s;e.tip=r.tip.get(i),e.position=r.position.get(i)}else e.position="bottom"}function To(t,e,s,i){const n=s.text.content.get(i);e.textContent=t.formatText(n),e.imageUrl=s.image.url.get(i)}function Uc(){return{x:0,y:0,shape:"",color:"",opacity:0,diameterScaled:0,diameterFixed:0,innerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},outerStroke:{color:"",widthScaled:0,widthFixed:0,minVisibleSize:0},icon:{content:"",font:"",color:"",scale:0,size:0,style:"none",minVisibleSize:0},image:{url:"",content:null,scale:0,minVisibleSize:0},halo:{widthScaled:0,widthFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,color:"",strokeColor:""},outline:{enabled:!1,color:"",minVisibleSize:0},badges:{topLeft:Lo(Zf),topRight:Lo(Kf),bottomLeft:Lo(Qf),bottomRight:Lo(Jf)},textHidden:!1,texts:{primary:Gc(),secondary:Gc()}}}function Lo(t){return{angle:t,color:"",scale:0,positionScale:0,minVisibleSize:0,strokeColor:"",strokeWidthScaled:0,strokeWidthFixed:0,textContent:"",textFont:"",textColor:"",textScale:0,textStyle:"none",imageUrl:"",imageContent:null,imageScale:0,textPaddingLeft:0,textPaddingTop:0}}function Gc(){return{hidden:!1,content:"",position:"",backgroundColor:"",tip:!1,font:"",color:"",sizeScaled:0,sizeFixed:0,style:"none",align:"left",minVisibleSize:0,margin:0,padding:0,maxLineLength:0,widthScaled:0,widthFixed:0,heightScaled:0,heightFixed:0,positionAngle:0,isPositionCenter:!1,isPositionVertical:!1,isPositionHorizontal:!1}}var FA=(t,e)=>{e.haloStroke=e.haloStroke||t.haloStroke,e.halo=e.halo||t.halo,e.outline=e.outline||t.outline,e.outerStroke=e.outerStroke||t.outerStroke,e.body=e.body||t.body,e.pieChart=e.pieChart||t.pieChart,e.image=e.image||t.image,e.icon=e.icon||t.icon;const s=t.badges,i=e.badges;i.topLeft.text=i.topLeft.text||s.topLeft.text,i.topLeft.image=i.topLeft.image||s.topLeft.image,i.topRight.text=i.topRight.text||s.topRight.text,i.topRight.image=i.topRight.image||s.topRight.image,i.bottomLeft.text=i.bottomLeft.text||s.bottomLeft.text,i.bottomLeft.image=i.bottomLeft.image||s.bottomLeft.image,i.bottomRight.text=i.bottomRight.text||s.bottomRight.text,i.bottomRight.image=i.bottomRight.image||s.bottomRight.image;const n=t.texts,r=e.texts;r.primary.text=r.primary.text||n.primary.text,r.primary.background=r.primary.background||n.primary.background,r.primary.tip=r.primary.tip||n.primary.tip,r.secondary.text=r.secondary.text||n.secondary.text,r.secondary.background=r.secondary.background||n.secondary.background,r.secondary.tip=r.secondary.tip||n.secondary.tip},yp=t=>(e,s)=>{s.haloStroke=e.haloStroke[t],s.halo=e.halo[t],s.outline=e.outline[t],s.outerStroke=e.outerStroke[t],s.body=e.body[t],s.pieChart=e.pieChart[t],s.image=e.image[t],s.icon=e.icon[t];const i=e.badges,n=s.badges;n.topLeft.text=i.topLeft.text[t],n.topLeft.image=i.topLeft.image[t],n.topRight.text=i.topRight.text[t],n.topRight.image=i.topRight.image[t],n.bottomLeft.text=i.bottomLeft.text[t],n.bottomLeft.image=i.bottomLeft.image[t],n.bottomRight.text=i.bottomRight.text[t],n.bottomRight.image=i.bottomRight.image[t];const r=e.texts,o=s.texts;o.primary.text=r.primary.text[t],o.primary.background=r.primary.background[t],o.primary.tip=r.primary.tip[t],o.secondary.text=r.secondary.text[t],o.secondary.background=r.secondary.background[t],o.secondary.tip=r.secondary.tip[t]},PA=yp("start"),DA=yp("end"),kA=class{constructor({engine:t,imageManager:e,fontManager:s,formatText:i,attributes:n,attributesPrev:r}){this._fullComponents=rr(),this._startComponents=rr(),this._endComponents=rr(),this._startFlags=rr(),this._endFlags=rr(),this._startInput=Uc(),this._endInput=Uc(),this._depthInfo=iu(),this._nodePatternAssigned=!1,this._nullElt={id:-1,valid:!0},this._engine=t,this._attributes=n,this._attributesPrev=r,this._helper={imageManager:e,fontManager:s,formatText:i},this._layers=Vc(()=>t.createGroup()),this._blockIds=Vc(()=>0)}drawNode(t){if(this._computeBlockIds(t),this._attributes.excluded.get(t))return this._freeBlocks();const e=this._engine,s=this._helper,i=t,n=this._attributes,r=Xr(n.layer.get(t)-(n.detectable.get(t)?0:1),this._depthInfo),o=n.animationDuration.get(t),a=o>0;if(this._prepareBlocks(a,r,i),zc(s,this._endInput,n,t),Rc(this._endFlags,this._endInput),a&&(zc(s,this._startInput,this._attributesPrev,t),Rc(this._startFlags,this._startInput),FA(this._endFlags,this._startFlags)),this._initComponents(this._fullComponents,this._endFlags,this._layers),DA(this._fullComponents,this._endComponents),Dc(e,s,t,n,this._endComponents,this._endInput),a&&(PA(this._fullComponents,this._startComponents),Dc(e,s,t,this._attributesPrev,this._startComponents,this._startInput)),a){const l=this._attributes.animationStart.get(t),d=this._attributes.animationEasing.get(t);this._setBlocksAnimation(o,l,d)}this._endFlags.halo&&this._attributes.halo.hideNonAdjacentEdges.get(t)&&(this._layers.halo.stencilUsage=this._layers.haloStroke.stencilUsage=tp),this._storeBlocks()}_computeBlockIds(t){const e=t*ll,s=this._blockIds;s.body=e+fE,s.text=e+pE,s.textBg=e+yE,s.halo=e+xE,s.haloStroke=e+bE}_prepareBlocks(t,e,s){const i=this._layers;i.body.reset(Rs,t,e.nodeBody,s),i.text.reset(Qi,t,e.nodeText,s),i.textBg.reset(Rs,t,e.nodeTextBackground,s),i.halo.reset(Rs,t,e.nodeHalo,s),i.haloStroke.reset(Rs,t,e.nodeHaloStroke,s)}_storeBlocks(){const t=this._engine,e=this._layers,s=this._blockIds;t.storeGroup(s.body,e.body),t.storeGroup(s.text,e.text),t.storeGroup(s.textBg,e.textBg),t.storeGroup(s.halo,e.halo),t.storeGroup(s.haloStroke,e.haloStroke)}_freeBlocks(){const t=this._engine,e=this._blockIds;t.freeBlock(e.body),t.freeBlock(e.text),t.freeBlock(e.textBg),t.freeBlock(e.halo),t.freeBlock(e.haloStroke)}_setBlocksAnimation(t,e,s){const i=this._layers;i.body.setGlobalAnimation(t,e,s),i.text.setGlobalAnimation(t,e,s),i.textBg.setGlobalAnimation(t,e,s),i.halo.setGlobalAnimation(t,e,s),i.haloStroke.setGlobalAnimation(t,e,s)}_initComponents(t,e,s){this._nodePatternAssigned=!1,this._initBaseComponents(t,e,s),this._initBadgeComponents(t.badges.topLeft,e.badges.topLeft,s),this._initBadgeComponents(t.badges.topRight,e.badges.topRight,s),this._initBadgeComponents(t.badges.bottomLeft,e.badges.bottomLeft,s),this._initBadgeComponents(t.badges.bottomRight,e.badges.bottomRight,s),this._initTextComponents(t.texts.primary,e.texts.primary,s),this._initTextComponents(t.texts.secondary,e.texts.secondary,s)}_initBaseComponents(t,e,s){t.haloStroke=this._nextElement(e.haloStroke,s.haloStroke),t.halo=this._nextElement(e.halo,s.halo),t.outline=this._nextElement(e.outline,s.body),t.outerStroke=this._nextElement(e.outerStroke,s.body),t.body=this._nextElement(e.body,s.body),t.pieChart=this._getNodePatternElement(e.pieChart,s),t.image=this._getNodePatternElement(e.image,s),t.icon=this._getNodePatternElement(e.icon,s)}_initBadgeComponents(t,e,s){t.image=this._nextElement(e.image,s.body),t.text=this._nextElement(e.text,s.body)}_initTextComponents(t,e,s){t.background=this._nextElement(e.background,s.textBg),t.tip=this._nextElement(e.tip,s.textBg),t.text=this._nextElement(e.text,s.text)}_nextElement(t,e){return t?e.next():this._nullElt}_getNodePatternElement(t,e){return t?this._nodePatternAssigned?e.body.next():(this._nodePatternAssigned=!0,e.body.getCurrentElement()):this._nullElt}};function Vc(t){return{body:t(),text:t(),textBg:t(),halo:t(),haloStroke:t()}}function rr(){return{haloStroke:void 0,halo:void 0,outline:void 0,outerStroke:void 0,body:void 0,pieChart:void 0,image:void 0,icon:void 0,badges:{topLeft:{text:void 0,image:void 0},topRight:{text:void 0,image:void 0},bottomLeft:{text:void 0,image:void 0},bottomRight:{text:void 0,image:void 0}},texts:{primary:{text:void 0,background:void 0,tip:void 0},secondary:{text:void 0,background:void 0,tip:void 0}}}}function RA({graph:t,elements:e,engine:s,imageManager:i,fontManager:n,view:r,attributes:o,boundaries:a,formatText:l}){const{nodeAttributes:d,nodeAttributesPrev:h,edgeAttributes:u,edgeAttributesPrev:c}=OA(o),{nodes:g,edges:_}=e,{maxSize:m,maxMinVisibleSize:f}=a;if(!g.size&&!_.size)return;const p=(Math.max(t.getNodeMaxIndex(),t.getEdgeMaxIndex())+1)*ll,y=s.setGlobalBoundaries({maxBlockId:Si(p),maxScaledSize:Si(8*m),maxMinVisibleSize:Si(f),maxSymbolicSize:Si(m),maxDashLength:3,maxGapLength:1,maxPatternScale:2,maxCoord:-1/0}),b=(y?t.getNodes("_all"):g)._indexes,x=(y?t.getEdges("_all"):_)._indexes;if(b.length){const v=new kA({engine:s,imageManager:i,fontManager:n,formatText:l,attributes:d,attributesPrev:h});for(let E=0;E<b.length;++E)v.drawNode(b[E])}if(x.length){const v=new mA({engine:s,imageManager:i,fontManager:n,formatText:l,view:r,attributes:u,attributesPrev:c,nodeAttributes:d,nodeAttributesPrev:h});for(let E=0;E<x.length;++E)v.drawEdge(x[E])}}function OA(t){const e=xs(t.nodes.current,{text:{secondary:{scaling:t.nodes.current.text.scaling,maxLineLength:t.nodes.current.text.maxLineLength}}});return{nodeAttributes:e,nodeAttributesPrev:xs(t.nodes.previous,{textHidden:e.textHidden,text:{secondary:{scaling:t.nodes.previous.text.scaling,maxLineLength:t.nodes.previous.text.maxLineLength}}}),edgeAttributes:xs(t.edges.current,{text:{secondary:{scaling:t.edges.current.text.scaling,maxLineLength:t.edges.current.text.maxLineLength,adjustAngle:t.edges.current.text.adjustAngle}}}),edgeAttributesPrev:xs(t.edges.previous,{source:t.edges.current.source,target:t.edges.current.target,textHidden:t.edges.current.textHidden,text:{secondary:{scaling:t.edges.previous.text.scaling,maxLineLength:t.edges.previous.text.maxLineLength,adjustAngle:t.edges.previous.text.adjustAngle}}})}}function xp(t,e,s,i,n,r,o,a=0,l=!1){const d=Oe(s,i,n,r),h=(o/2*(l?Oe(t,e,n,r)/d:1)+a)/d,u=(n-s)*h,c=(r-i)*h,g=s+c,_=i-u,m=t-g,f=e-_,p=s-c-g,y=i+u-_,b=n+c-g,x=r-u-_,v=m*p+f*y,E=m*b+f*x;return v>0&&v<p*p+y*y&&E>0&&E<b*b+x*x}function zA(t,e,s,i,n=!1){if(n&&(Io(t,s)||Io(t,i)||Io(e,s)||Io(e,i)))return!1;let r=(t.y-s.y)*(i.x-s.x)-(t.x-s.x)*(i.y-s.y);const o=(e.x-t.x)*(i.y-s.y)-(e.y-t.y)*(i.x-s.x);if(o===0)return!1;const a=r/o;r=(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y);const l=r/o;return!(a<=0||a>=1||l<=0||l>=1)}function Io(t,e){return t.x===e.x&&t.y===e.y}function Hn(t,e,s,i){return Math.atan2(i-e,s-t)}function BA(t,e,s){const i=Hn(t.x,t.y,e.x,e.y)-Hn(s.x,s.y,e.x,e.y);return i<0?i+2*Math.PI:i}function UA(t,e,s,i,n,r,o,a){const l=(a-r)*(s-t)-(o-n)*(i-e);if(l===0)return null;let d=e-r;return d=((o-n)*d-(a-r)*(t-n))/l,{x:t+d*(s-t),y:e+d*(i-e)}}function mr(t,e,s,i,n,r,o,a){const l=t-s,d=e-i,h=n-o,u=r-a,c=l*u-h*d,g=(d*(t-n)-l*(e-r))/c;if(g<0||g>1)return null;const _=(h*(r-e)+u*(t-n))/c;return _>=0&&_<=1?{x:t-_*l,y:e-_*d}:null}function bp(t,e,s,i,n,r,o,a){let l;const d=[];return l=mr(t,e,s,i,n,r,n,a),l&&d.push(l),l=mr(t,e,s,i,n,a,o,a),l&&d.push(l),l=mr(t,e,s,i,o,a,o,r),l&&d.push(l),l=mr(t,e,s,i,o,r,n,r),l&&d.push(l),d}function Pn(t,e,s,i,n,r,o,a){const l=((o-n)*(e-r)-(a-r)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e)),d=((s-t)*(e-r)-(i-e)*(t-n))/((a-r)*(s-t)-(o-n)*(i-e));return l>=0&&l<=1&&d>=0&&d<=1}function nu(t,e,s,i,n,r,o,a){return t>=n&&e>=r&&t<=o&&e<=a||s>=n&&i>=r&&s<=o&&i<=a||!!Pn(t,e,s,i,n,r,n,a)||!!Pn(t,e,s,i,o,r,o,a)||!!Pn(t,e,s,i,n,r,o,r)||!!Pn(t,e,s,i,n,a,o,a)}function vp(t,e,s){return Math.sqrt(ru(t.x,t.y,e.x,e.y,s.x,s.y))}function ru(t,e,s,i,n,r){const o=da(s,i,n,r);if(o===0)return da(t,e,s,i);let a=((t-s)*(n-s)+(e-i)*(r-i))/o;return a=Math.max(0,Math.min(1,a)),da(t,e,s+a*(n-s),i+a*(r-i))}function Ep(t,e,s,i,n,r){const o=n-s,a=r-i;if(o===0&&a===0)return{x:s,y:i};const l=((t-s)*o+(e-i)*a)/(o*o+a*a);return l<0?{x:s,y:i}:l>1?{x:n,y:r}:{x:s+l*o,y:i+l*a}}function GA(t,e,s,i,n,r){const o=n-s,a=r-i,l=((t-s)*o+(e-i)*a)/(o*o+a*a);return{x:s+o*l,y:i+a*l}}function Wr(t,e,s){const i=s.length;let n=i-1,r=!1;for(let o=0;o<i;++o)(s[o].y<e&&s[n].y>=e||s[n].y<e&&s[o].y>=e)&&(s[o].x<=t||s[n].x<=t)&&(r=r!==s[o].x+(e-s[o].y)/(s[n].y-s[o].y)*(s[n].x-s[o].x)<t),n=o;return r}function Co(t){const e=t.x*t.x+t.y*t.y;return{x:t.x/e,y:t.y/e}}function jc(t,e){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=o.x*e.x+o.y*e.y;a<s&&(s=a),a>i&&(i=a)}return{x:s,y:i}}function VA(t,e){let s=t[1],i=t[0],n=Co({x:s.x-i.x,y:s.y-i.y}),r=n.x;n.x=-n.y,n.y=r;const o=n;s=t[2],i=t[1],n=Co({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const a=n;s=e[1],i=e[0],n=Co({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r;const l=n;return s=e[2],i=e[1],n=Co({x:s.x-i.x,y:s.y-i.y}),r=n.x,n.x=-n.y,n.y=r,[o,a,l,n]}function Ap(t,e){const s=VA(t,e);for(let i=0,n=s.length;i<n;i++){const r=s[i],o=jc(t,r),a=jc(e,r);if((o.x<=a.y&&o.y>=a.x?Math.min(o.y,a.y)-Math.max(o.x,a.x):0)===0)return!1}return!0}function ou(t){let e=0,s=0;const i=t.length;if(i===0)throw new Error("Compute centroid: at least one point is required");for(let n=0;n<i;++n){const r=t[n];e+=r.x,s+=r.y}return e/=i,s/=i,{x:e,y:s}}var jA=au(4),qA=au(5),HA=au(10,.4),Ci=1/3,XA=[{x:-1,y:-Ci},{x:0,y:-Ci},{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:0,y:Ci},{x:-1,y:Ci}],WA=[{x:-1,y:-Ci},{x:-.55,y:-Ci},{x:-1,y:-1},{x:1,y:0},{x:-1,y:1},{x:-.55,y:Ci},{x:-1,y:Ci}],qc=[{x:-.6,y:-.3},{x:.1,y:0},{x:-.6,y:.3}],$A={circle:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>1-Math.sqrt(t*t+e*e),points:[{x:0,y:0,r:1}],isSimple:!0},square:{getDistanceFromStrokeVertically:(t,e)=>1-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],isSimple:!0},line:{getDistanceFromStrokeVertically:(t,e)=>1-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:0},{x:1,y:0}],isSimple:!0},triangle:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},arrow:{getDistanceFromStrokeVertically:(t,e)=>(1-t)/2-Math.abs(e),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],isSimple:!0},"circle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>Math.min(Math.sqrt((t+.4)*(t+.4)+e*e)-.27,(1-t)/2-Math.abs(e)),getDistanceFromStrokeHorizontally:(t,e)=>1-Math.abs(t),points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:[{x:-.4,y:0,r:.3}],isSimple:!0},"triangle-hole-arrow":{getDistanceFromStrokeVertically:(t,e)=>{const s=Math.min((1-t)/2-Math.abs(e),1-Math.abs(t)),i=-Sp(t,e,qc);return Math.min(s,i)},getDistanceFromStrokeHorizontally:(t,e)=>1,points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}],hole:qc,isSimple:!0},"short-arrow":or(XA,!1),"sharp-arrow":or(WA,!1),cross:{getDistanceFromStrokeVertically:(t,e)=>1,getDistanceFromStrokeHorizontally:(t,e)=>{const s=Math.abs(t),i=Math.abs(e),n=.31-Math.min(s,i),r=1-Math.max(s,i);return Math.min(n,r)},points:[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}],isSimple:!1},diamond:or(jA),pentagon:or(qA),star:or(HA)},YA=["circle","square","triangle","line"],ZA=["cross","diamond","pentagon","star"],KA=["arrow","triangle-hole-arrow","circle-hole-arrow","short-arrow","sharp-arrow"];function Hc(t,e){for(const r of YA)Rl(t,r);const s=e.nodes.current.shape.getValues(),i=e.edges.current.shape.head.getValues(),n=e.edges.current.shape.tail.getValues();for(const r of ZA)s.includes(r)&&Rl(t,r);for(const r of KA)r&&(i.includes(r)||n.includes(r))&&Rl(t,r)}function Rl(t,e){t.registerShape(e,$A[e])}function Sp(t,e,s){let i=1/0;const n={x:t,y:e};for(let r=0;r<s.length;++r){const o=s[r],a=s[(r+1)%s.length];i=Math.min(i,vp(n,o,a))}return i*(Wr(t,e,s)?1:-1)}function au(t,e=1){const s=-Math.PI/2+Yf,i=[],n=2*Math.PI/t;let r=s;for(let o=0;o<t;++o){const a=o%2==1?e:1;i.push({x:Math.cos(r)*a,y:Math.sin(r)*a}),r+=n}return i}function or(t,e=!1){return{getDistanceFromStrokeVertically:()=>1,getDistanceFromStrokeHorizontally:(s,i)=>Sp(s,i,t),points:t,isSimple:e}}var QA=class extends io{constructor(t,e){super(),this.isDummy=!0,this.width=0,this.height=0}set src(t){t&&(this._src=t,setTimeout(()=>{this.onload&&this.onload.call(this),this.width=1,this.height=1,this.fire("load")},10))}get src(){return this._src}addEventListener(t,e){this.on(t,e)}};function JA(t,e){return new(typeof Image<"u"?Image:QA)(t,e)}var tS=class{constructor(){this._images={},this._crossOrigin="anonymous",this._whenReady=[],this._onFetch=[],this._nbLoaded=0,this._nbToLoad=0}setImgCrossOrigin(t){this._crossOrigin=t}clear(){this._images={},this._nbLoaded=0,this._nbToLoad=0}getImage(t){let e=this._images[t];return e===void 0&&(this._nbToLoad+=1,e=JA(),e.crossOrigin=this._crossOrigin,e.onload=()=>this._onImgLoad(t),e.onerror=()=>{this._onImgLoad(t),this._images[t]=null},e.src=t,this._images[t]=e),e}_onImgLoad(t){this._nbLoaded+=1,this._onFetch.forEach(e=>e(t)),this._nbLoaded===this._nbToLoad&&(this._whenReady.forEach(e=>e()),this._whenReady=[])}onFetch(t){this._onFetch.push(t)}whenReady(){return this._nbLoaded===this._nbToLoad?Promise.resolve():new Promise(t=>this._whenReady.push(t))}destroy(){this._whenReady=[],this._onFetch=[]}};function cl(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(1-t)*(1-t)*e+2*(1-t)*t*r+t*t*i,a.y=(1-t)*(1-t)*s+2*(1-t)*t*o+t*t*n,a}function lu(t,e,s,i,n,r,o,a={x:0,y:0}){return a.x=(2*t-2)*e+(2*i-4*r)*t+2*r,a.y=(2*t-2)*s+(2*n-4*o)*t+2*o,Jm(a)}function wp(t,e,s,i,n,r,o,a={x:0,y:0}){return lu(t,e,s,i,n,r,s,a),Sa(a.x,a.y,0,0,Math.PI/2,a),a}function Tp(t,e,s,i,n,r,o,a,l,d=0,h=!1){const u=s-2*o+n,c=i-2*a+r,g=-((s-t)*c-(i-e)*u)/((2*o-2*s)*c-(2*a-2*i)*u);if(g<0||g>1)return!1;let _=l/2;h&&(_*=1-g),_+=d;const m=Fn(s,o,n,g),f=Fn(i,a,r,g);return Oe(m,f,t,e)<=_}function eS(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Bs(i.x,i.y,n.x,n.y,s);return cl(e,i.x,i.y,n.x,n.y,r.x,r.y)}function sS(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Bs(i.x,i.y,n.x,n.y,s);return wp(e,i.x,i.y,n.x,n.y,r.x,r.y)}function iS(t,e){const s=t.getAttribute("curvature"),[i,n]=t.getExtremities().getAttributes(["x","y"]),r=Bs(i.x,i.y,n.x,n.y,s);return lu(e,i.x,i.y,n.x,n.y,r.x,r.y)}function $r(t,e,s,i,n,r,o,a,l,d={x:0,y:0}){const h=(1-t)*(1-t)*(1-t),u=3*t*(1-t)*(1-t),c=3*t*t*(1-t),g=t*t*t;return d.x=h*e+u*r+c*a+g*i,d.y=h*s+u*o+c*l+g*n,d}function Lp(t,e,s,i,n,r,o,a,l,d,h,u){const c=Oe(s,i,o,a);if(Math.abs(t-s)>c||Math.abs(e-i)>c)return!1;let g=.5,_=Oe(t,e,s,i)<Oe(t,e,n,r)?-.01:.01,m=100;const f=$r(g,s,i,n,r,o,a,l,d);let p,y=Oe(t,e,f.x,f.y);const b=h/2+u;for(;m-- >0&&g>=0&&g<=1&&y>b&&(_>.001||_<-.001);)p=y,$r(g,s,i,n,r,o,a,l,d,f),y=Oe(t,e,f.x,f.y),y>p?(_=-_/2,g+=_):g+_<0||g+_>1?(_/=2,y=p):g+=_;return y<b}function du(t,e,s,i,n,r,o=Uh()){const a=t+.6666666666666666*(s-t),l=e+2/3*(i-e);return gl(t,e,a,l,a+1/3*(n-t),l+1/3*(r-e),n,r,o)}function gl(t,e,s,i,n,r,o,a,l=Uh()){const{min:d,max:h,sqrt:u}=Math;let c,g,_,m,f;l.minX=d(t,o),l.maxX=h(t,o),l.minY=d(e,a),l.maxY=h(e,a);for(let p,y,b,x,v,E,w,A=0;A<2;++A)if(A===0?(g=t,_=s,m=n,f=o):(g=e,_=i,m=r,f=a),y=6*g-12*_+6*m,p=-3*g+9*_-9*m+3*f,b=3*_-3*g,y|=0,p|=0,b|=0,p!==0)v=y*y-4*b*p,v<0||(E=(-y+u(v))/(2*p),E>0&&E<1&&(c=Ol(E,g,_,m,f),A===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))),w=(-y-u(v))/(2*p),w>0&&w<1&&(c=Ol(w,g,_,m,f),A===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c))));else{if(y===0)continue;x=-b/y,x>0&&x<1&&(c=Ol(x,g,_,m,f),A===0?(l.minX=d(l.minX,c),l.maxX=h(l.maxX,c)):(l.minY=d(l.minY,c),l.maxY=h(l.maxY,c)))}return l}function Ol(t,e,s,i,n){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*s+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*n}function nS(t,e,s,i,n,r){const o=t-2*s+n,a=e-2*i+r,l=2*s-2*t,d=2*i-2*e,h=4*(o*o+a*a),u=4*(o*l+a*d),c=l*l+d*d,g=2*Math.sqrt(h+u+c),_=Math.sqrt(h),m=2*h*_,f=2*Math.sqrt(c),p=u/_;return(m*g+_*u*(g-f)+(4*c*h-u*u)*Math.log((2*_+p+g)/(p+f)))/(4*m)}var rS={linear:[0,1,0,0],quadraticIn:[0,0,1,0],quadraticOut:[0,2,-1,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]},oS=class{constructor(){this._linearEasing=[0,1,0,0,0,1,0,0],this._nameToPolygon={},this._polygonToName={},this.add(rS)}add(t){Object.keys(t).forEach(e=>{const s=t[e].slice();s.length<8&&(s[4]=s[0],s[5]=s[1],s[6]=s[2],s[7]=s[3]);const i=md(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]);this._nameToPolygon[e]=s,this._polygonToName[i]=e})}getCoefficients(t){return this._nameToPolygon[t]||this._linearEasing}getName(t,e,s,i,n,r,o,a){const l=md(t,e,s,i,n,r,o,a);return this._polygonToName[l]||"linear"}},hu=new oS,aS={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}},lS=[{name:"topLeft",dx:-1,dy:-1},{name:"topRight",dx:1,dy:-1},{name:"bottomLeft",dx:-1,dy:1},{name:"bottomRight",dx:1,dy:1}],ei={x:0,y:0};function dS(t,e,s,i,n,r,o,a,l,d,h,u){r=r||o.getNodes()._indexes;const c=l.getZoom(),g=o.getObjectList(!0),_=a.getFlexArrays().nodes.current;let m=1/0,f=0,p=!1,y=-1/0;a.update();for(let b=0;b<r.length;++b){const x=r[b];if(_.excluded.get(x)||!_.detectable.get(x)||h.has(x))continue;const v=_.x.get(x),E=_.y.get(x),w=_.layer.get(x);if(w<y)continue;ei.x=v,ei.y=E;const A=l.graphToScreenCoordinates(ei),I=A.x,M=A.y,k=_.shape.get(x),W=_.scalingMethod.get(x)==="scaled",H=_.radius.get(x)*(W?c:1),$=H+n,P=(t-I)/$,S=(e-M)/$;if(ei.x=t,ei.y=e,i&&Ip(ei,x,a,l,d)&&(p=!0),!p&&d.checkShapeHit(k,P,S)){const Y=o.getAttribute(!0,"virtual").get(x)!==0;if($>m&&Y)continue;m=$}else if(!p&&s){const Y=u(_.text.content.get(x)||null),st=_.textHidden.get(x),at=_.text.minVisibleSize.get(x);if(st||!Y||(W?2*H:1/0)<at)continue;const Tt=Jh(Y,_.text.maxLineLength.get(x)),ut=_.innerStroke.width.get(x),Mt=_.text.margin.get(x),Nt=_.text.padding.get(x),_t=_.text.size.get(x),St=_.text.scale.get(x),Zt=_.text.scaling.get(x),Qt=_.text.font.get(x),Kt=_.text.style.get(x),mt=_.text.position.get(x),pt=d.measureText(Tt,Qt,Kt,1),ue=Zt?St*H*2:_t,Jt=pt.width*ue/2+Nt,ce=pt.height*ue/2+Nt,oe=aS[mt],q=ut+Mt+H,et=I+(q+Jt)*oe.x,dt=M+(q+ce)*oe.y;if(t<=et-Jt||t>=et+Jt||e<=dt-ce||e>=dt+ce)continue}f=x,y=w}return g.get(f)||null}var Xc=Math.cos(Math.PI/4);function Ip(t,e,s,i,n){const r=s.getFlexArrays().nodes.current,o=i.getZoom(),a=r.scalingMethod.get(e)==="scaled",l=r.radius.get(e)*(a?o:1),d=r.x.get(e),h=r.y.get(e);for(let u=0;u<4;u++){const{name:c,dx:g,dy:_}=lS[u],m=r.badges[c].stroke.width.get(e),f=r.badges[c].stroke.scalingMethod.get(e)==="scaled",p=r.badges[c].scale.get(e)*l+(f?o:1)*m,y=r.badges[c].minVisibleSize.get(e)/2,b=r.badges[c].positionScale.get(e);if(!r.badges[c].text.content.get(e)&&!r.badges[c].image.url.get(e)||p<y)continue;const x=i.graphToScreenCoordinates({x:d+r.radius.get(e)*b*g*Xc,y:h+r.radius.get(e)*b*_*Xc}),{x:v,y:E}=x,w=(t.x-v)/p,A=(t.y-E)/p;if(n.checkShapeHit("circle",w,A))return c}}function hS(t,e,s,i,n,r,o,a,l){n=n||r.getEdges()._indexes;const d=r.getObjectList(!1),h=l.getFlexArrays(),u=h.edges.current,c=h.nodes.current,g=o.getZoom(),_=i/g;ei.x=t,ei.y=e;const m=o.screenToGraphCoordinates(ei),f=m.x,p=m.y;let y=0;l.update();for(let b=0;b<n.length;++b){const x=n[b],v=u.source.get(x),E=u.target.get(x),w=u.excluded.get(x),A=u.detectable.get(x),I=a.has(v),M=a.has(E);if(w||!A||I||M)continue;const k=v===E,W=u.curvature.get(x),H=u.shape.body.get(x)==="triangle",$=u.scalingMethod.get(x)==="scaled",P=u.width.get(x)/($?1:g),S=c.x.get(v),Y=c.y.get(v),st=c.x.get(E),at=c.y.get(E);if(k){const Tt=c.scalingMethod.get(v)==="scaled",ut=un(S,Y,W,c.radius.get(v)/(Tt?1:g),0);if(!Lp(f,p,S,Y,S,Y,ut.x1,ut.y1,ut.x2,ut.y2,P,_))continue}else if(W!==0){const Tt=Bs(S,Y,st,at,W);if(!Tp(f,p,S,Y,st,at,Tt.x,Tt.y,P,_,H))continue}else if(!xp(f,p,S,Y,st,at,P,_,H))continue;y=x}return d.get(y)||null}function uS(t){const e=t.getNodeAttribute("radius"),s=t.getEdgeAttribute("width"),i=t.getNodes(),n=t.getEdges();let r=0,o=0;for(let a=0;a<i._indexes.length;a++){const l=i._indexes[a],d=e.get(l);d>r&&(r=d)}for(let a=0;a<n._indexes.length;a++){const l=n._indexes[a],d=s.get(l);d>o&&(o=d)}return Math.max(2*r,o)}function cS(t){return t===null?"none":t==="webgl"?"WebGL":t==="svg"?"SVG":t==="canvas"?"Canvas":t}function Cp(t,e,s,i){const n=(t-e)/s,r=n*n,o=r*n,a=hu.getCoefficients(i),l=n<.5?0:4;return bs(a[l]+a[l+1]*n+a[l+2]*r+a[l+3]*o,0,1)}function fr(t,e,s,i){if(t===e)return t;const[n,r,o,a]=os(t),[l,d,h,u]=os(e);return`rgba(${Math.round(255*le(n,l,s))},${Math.round(255*le(r,d,s))},${Math.round(255*le(o,h,s))},${le(a,u,i)})`}function gS(t,e){const[s,i,n,r]=os(t);return`rgba(${255*s},${255*i},${255*n},${r*e})`}var _S=class{constructor({elementSize:t,sideElementSize:e,nbSideElementsPerMainElement:s,id:i,depth:n,elementType:r,animated:o,stencilUsage:a}){this._nbCellsAllocated=0,this._nbCellsFreed=0,this._isFullyAllocated=!1,this._isFullyFreed=!1,this._mustUpdate=!0,this._capacity=tu,this.version=0,this._id=i,this.depth=n,this.type=r,this.animated=o,this.stencilUsage=a,this.elementSize=t,this._nbSideElementsPerMainElement=s,this._totalSideElementsSize=s*e,this._byteCapacity=this._capacity*this.elementSize,this._byteArray=new Uint8Array(this._byteCapacity),this._dataView=new DataView(this._byteArray.buffer),this._sideByteCapacity=this._capacity*this._totalSideElementsSize,this._sideByteArray=new Uint8Array(this._sideByteCapacity),this._sideDataView=new DataView(this._sideByteArray.buffer)}update(){this._mustUpdate&&(this.version+=1,this._mustUpdate=!1,this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated&&(this._isFullyFreed=!0))}allocate(t){let e=-1;return!this._isFullyAllocated&&this._nbCellsAllocated+t<=this._capacity?(e=this._nbCellsAllocated,this._nbCellsAllocated+=t,this._mustUpdate=!0):this._isFullyAllocated=!0,e}free(t,e){for(let s=0;s<e;s++){const i=(t+s)*this.elementSize;this._dataView.setUint16(i,0)}this._mustUpdate=!0,this._nbCellsFreed+=e}triggerUpdate(){this._mustUpdate=!0}isEmpty(){return this._nbCellsFreed===this._nbCellsAllocated}isFullyFreed(){return this._isFullyFreed}getId(){return this._id}getDataView(){return this._dataView}getByteArray(){return this._byteArray}getSize(){return this._nbCellsAllocated}getNbSideElementsPerMainElement(){return this._nbSideElementsPerMainElement}hasSideData(){return this._nbSideElementsPerMainElement>0}getSideDataView(){return this._sideDataView}getSideByteArray(){return this._sideByteArray}getTotalSideElementsSize(){return this._totalSideElementsSize}},Wc=8,mS=class{constructor(){this.version=0,this.version=0,this._blockInfo={buffer:null,offset:0,size:0,address:0},this._init_()}reset(){this._init_()}_init_(){this._buffersByDepth=new Array(100),this._buffersById=[],this._buffersByAscendingDepth=[],this._buffersByDescendingDepth=[],this._mustUpdate=!0}_fillBlockInfo(t,e,s,i){return this._blockInfo.buffer=t,this._blockInfo.offset=e,this._blockInfo.size=s,this._blockInfo.address=i,this._blockInfo}_createBuffer(t,e,s,i,n){const r=e?JE:qn,o=this._buffersById.length,a=new _S({elementSize:r,sideElementSize:ga,nbSideElementsPerMainElement:i,id:o,depth:s,elementType:t,animated:e,stencilUsage:n});return this._buffersById.push(a),a}getBlockInfo(t){return this._fillBlockInfo(this._buffersById[t>>$E],(t>>su)%tu,t%eu,t)}allocateBlock(t,e,s,i,n,r,o){const a=pS(r,Wc);this._mustUpdate=!0;let l=null,d=-1;if(t){const u=this.getBlockInfo(t),c=u.buffer,g=u.offset,_=u.size,m=u.size===n,f=c.depth===i,p=c.type===e,y=c.animated===s,b=c.getNbSideElementsPerMainElement()===a,x=c.stencilUsage===o;m&&f&&p&&y&&b&&x?(c.triggerUpdate(),l=c,d=g):c.free(g,_)}if(d===-1){const u=+s,c=a/Wc,g=this._buffersByDepth[i]||Array(2);this._buffersByDepth[i]=g;const _=g[u]||[];g[u]=_;const m=_[e]||Array(16);_[e]=m;const f=m[c]||Array(4);m[c]=f;const p=f[o]||[];f[o]=p;const y=p[p.length-1];y&&(l=y,d=y.allocate(n)),d===-1&&(l=this._createBuffer(e,s,i,a,o),d=l.allocate(n),p.push(l))}const h=fS(l.getId(),d,n);return this._fillBlockInfo(l,d,n,h)}freeBlock(t){if(t){this._mustUpdate=!0;const e=this.getBlockInfo(t);e.buffer.free(e.offset,e.size)}return 0}_sortBuffersByDepth(){const t=[];for(let e=0;e<this._buffersByDepth.length;e++){const s=this._buffersByDepth[e];if(s)for(let i=0;i<s.length;i++){const n=s[i];if(n)for(let r=0;r<n.length;r++){const o=n[r];if(o)for(let a=0;a<o.length;a++){const l=o[a];if(l)for(let d=0;d<l.length;d++){const h=l[d];if(h)for(let u=0;u<h.length;u++){const c=h[u];c.update(),c.isFullyFreed()?(this._buffersById[c.getId()]=void 0,h.splice(u,1),u-=1):t.push(c)}}}}}}this._buffersByAscendingDepth=t,this._buffersByDescendingDepth=t.slice().reverse()}update(){this._mustUpdate&&(this._sortBuffersByDepth(),this.version+=1,this._mustUpdate=!1)}getBuffers(){return this._buffersById}getBuffersByAscendingDepth(){return this._buffersByAscendingDepth}getBuffersByDescendingDepth(){return this._buffersByDescendingDepth}};function fS(t,e,s){return((t<<ap)+e<<su)+s}function pS(t,e){let s=0;for(;s<t;)s+=e;return s}function $c(){return{pieceId:0,shape:"circle",x1:0,y1:0,x2:0,y2:0,rectWidthOrSourceRadiusScaled:0,rectWidthOrSourceRadiusFixed:0,rectHeightOrTargetRadiusScaled:0,rectHeightOrTargetRadiusFixed:0,thicknessOrFontSizeScaled:0,thicknessOrFontSizeFixed:0,strokeWidthScaled:0,strokeWidthFixed:0,offsetScaled:0,offsetFixed:0,pattern:{id:void 0,type:0,attributes:{}},opacity:1,fillColor:null,strokeColor:null,patternColor:null,globalMinVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,offsetAngle:0,patternScale:0,symbolicSize:-1,curvature:0,dashLength:0,gapLength:0,hasHead:!1,hasTail:!1,isBodyTriangle:!1,isSelfLoop:!1,isText:!1,adjustTextAngle:!1,isBadge:!1,unusedFlag2:!1,unusedFlag3:!1}}function Yc(t={}){return t.pieceId=0,t.shape="",t.x1=0,t.y1=0,t.x2=0,t.y2=0,t.rectWidthOrSourceRadiusScaled=0,t.rectWidthOrSourceRadiusFixed=0,t.rectHeightOrTargetRadiusScaled=0,t.rectHeightOrTargetRadiusFixed=0,t.thicknessOrFontSizeScaled=0,t.thicknessOrFontSizeFixed=0,t.strokeWidthScaled=0,t.strokeWidthFixed=0,t.offsetScaled=0,t.offsetFixed=0,t.pattern=t.pattern||{type:0,attributes:{}},t.pattern.type=0,t.opacity=1,t.fillColor=null,t.strokeColor=null,t.patternColor=null,t.globalMinVisibleSize=0,t.strokeMinVisibleSize=0,t.patternMinVisibleSize=0,t.offsetAngle=0,t.patternScale=0,t.symbolicSize=0,t.curvature=0,t.dashLength=0,t.gapLength=0,t.hasHead=!1,t.hasTail=!1,t.isBodyTriangle=!1,t.isSelfLoop=!1,t.isText=!1,t.adjustTextAngle=!1,t.isBadge=!1,t.unusedFlag2=!1,t.unusedFlag3=!1,t}function yS(t={}){return t.duration=0,t.beginTime=-1,t.easing="linear",t}function uu(){return{valid:!1,id:void 0,end:$c(),start:$c(),animation:{duration:0,beginTime:-1,easing:"linear"}}}function Mp(t,e,s,i){t.width=e*i,t.height=s*i,ln(t,`${e}px`,`${s}px`)}var xS=class{constructor(){this._capacity=eu,this._id=0,this.size=0,this.depth=0,this.animated=!1,this.stencilUsage=On,this.type=Rs,this._list=Array(this._capacity);for(let t=0;t<this._capacity;++t)this._list[t]=uu()}reset(t,e,s,i){return this.type=t,this.animated=e,this.depth=s,i!==void 0&&(this._id=i),this.stencilUsage=On,this.size=0,this}next(){if(this.size>=this._capacity)throw new Error("internal error: block.next() was called on a full block");return this._list[this.size++]}nextAndReset(){const t=this.next();return t.end=Yc(t.end),t.start=Yc(t.start),t.animation=yS(t.animation),t}forEach(t){this._list.forEach(t)}getElement(t){return this._list[t]}getCurrentElement(){return this._list[this.size-1]}getElements(){return this._list}getId(){return this._id}setGlobalAnimation(t,e,s){for(let i=0;i<this.size;++i){const n=this._list[i].animation;n.duration=t,n.beginTime=e,n.easing=s}}},bS=class{constructor(){this._version=0,this._initialize()}reset(){this._initialize()}_initialize(){this._mustUpdate=!0,this.maxCoord=0,this.maxScaledSize=0,this.maxMinVisibleSize=0,this.maxSymbolicSize=0,this.maxDashLength=0,this.maxGapLength=0,this.maxPatternScale=0}set({maxCoord:t,maxScaledSize:e,maxMinVisibleSize:s,maxSymbolicSize:i,maxDashLength:n,maxGapLength:r,maxPatternScale:o}){const a=this.maxCoord<t||this.maxScaledSize<e||this.maxMinVisibleSize<s||this.maxSymbolicSize<i||this.maxDashLength<n||this.maxGapLength<r||this.maxPatternScale<o;return a&&(this.maxCoord=t,this.maxScaledSize=e,this.maxMinVisibleSize=s,this.maxSymbolicSize=i,this.maxDashLength=n,this.maxGapLength=r,this.maxPatternScale=o,this._mustUpdate=!0),a}update(){return this._mustUpdate&&(this._version+=1,this._mustUpdate=!1),this}getVersion(){return this._version}},vS=class{constructor(t,e,s,i,n){this._littleEndian=Ya(),this._maxScaledSize=0,this._maxMinVisibleSize=0,this._maxSymbolicSize=0,this._maxDashLength=0,this._maxGapLength=0,this._maxPatternScale=0,this._actualScaledSizeToBytes=YE,this._actualMinVisibleSizeToBytes=Od,this._actualSymbolicSizeToBytes=Mn,this._actualDashLengthToBytes=Nn,this._actualGapLengthToBytes=Nn,this._actualPatternScaleToBytes=Mn,this._genericObject=uu(),this._shapeManager=e,this._patternManager=t,this._textManager=s,this._bufferOffsetToId=i,this._colorParser=n}resizeBoundaries(t,e,s,i,n,r){this._maxScaledSize=t,this._maxMinVisibleSize=e,this._maxSymbolicSize=s,this._maxDashLength=i,this._maxGapLength=n,this._maxPatternScale=r,this._actualScaledSizeToBytes=lp/t,this._actualMinVisibleSizeToBytes=Od/e,this._actualSymbolicSizeToBytes=Mn/s,this._actualDashLengthToBytes=Nn/i,this._actualGapLengthToBytes=Nn/n,this._actualPatternScaleToBytes=Mn/r}storeGenericObject(t,e,s){const i=this._shapeManager.getIdFromName(s.shape),n=s.pieceId,r=this._dashLengthToBytes(s.dashLength),o=this._gapLengthToBytes(s.gapLength),a=+s.hasHead,l=+s.hasTail,d=+s.isBodyTriangle,h=+s.isSelfLoop,u=this._patternScaleToBytes(s.patternScale),c=this._offsetAngleToBytes(s.offsetAngle),g=+s.isText,_=+s.adjustTextAngle,m=+s.isBadge,f=+s.unusedFlag2,p=+s.unusedFlag3,y=this._opacityToBytes(s.opacity),b=this._minVisibleSizeToBytes(s.globalMinVisibleSize),x=this._minVisibleSizeToBytes(s.strokeMinVisibleSize),v=this._minVisibleSizeToBytes(s.patternMinVisibleSize),E=this._symbolicSizeToBytes(s.symbolicSize),w=this._curvatureToBytes(s.curvature),A=s.pattern.attributes.colors;A&&(s.pattern.attributes.colors=A.split(";").map(ce=>Mo(this._colorToBytes(ce.trim()))).join(";"));const I=this._patternManager.getIdFromDefinition(s.pattern),M=this._colorToBytes(s.fillColor),k=this._colorToBytes(s.strokeColor),W=this._colorToBytes(s.patternColor),{x1:H,y1:$,x2:P,y2:S}=s,Y=this._scaledSizeToBytes(s.rectWidthOrSourceRadiusScaled),st=this._fixedSizeToBytes(s.rectWidthOrSourceRadiusFixed),at=this._scaledSizeToBytes(s.rectHeightOrTargetRadiusScaled),Tt=this._fixedSizeToBytes(s.rectHeightOrTargetRadiusFixed),ut=this._scaledSizeToBytes(s.thicknessOrFontSizeScaled),Mt=this._fixedSizeToBytes(s.thicknessOrFontSizeFixed),Nt=this._scaledSizeToBytes(s.strokeWidthScaled),_t=this._fixedSizeToBytes(s.strokeWidthFixed),St=this._scaledSizeToBytes(s.offsetScaled),Zt=this._fixedSizeToBytes(s.offsetFixed),Qt=this._fixedSizeToBytes(s.pattern.attributes.paddingTop||0),Kt=this._fixedSizeToBytes(s.pattern.attributes.paddingLeft||0),mt=i+(n<<4)+(r<<8)+(o<<10)+(a<<12)+(l<<13)+(d<<14)+(h<<15),pt=u+(c<<8)+(g<<11)+(_<<12)+(m<<13)+(f<<14)+(p<<15),ue=y+(b<<4)+(x<<8)+(v<<12),Jt=E+(w<<8);this._setUint16(t,e+0,mt),this._setUint16(t,e+2,pt),this._setUint16(t,e+4,ue),this._setUint16(t,e+6,Jt),this._setUint16(t,e+8,I),this._setUint16(t,e+10,M),this._setUint16(t,e+12,k),this._setUint16(t,e+14,W),this._setFloat32(t,e+16,H),this._setFloat32(t,e+20,$),this._setFloat32(t,e+24,P),this._setFloat32(t,e+28,S),this._setUint16(t,e+32,Y),this._setUint16(t,e+34,st),this._setUint16(t,e+36,at),this._setUint16(t,e+38,Tt),this._setUint16(t,e+40,ut),this._setUint16(t,e+42,Mt),this._setUint16(t,e+44,Nt),this._setUint16(t,e+46,_t),this._setUint16(t,e+48,St),this._setInt16(t,e+50,Zt),this._setInt16(t,e+52,Qt),this._setInt16(t,e+54,Kt)}_setUint16(t,e,s){t.setUint16(e,s,this._littleEndian)}_setInt16(t,e,s){t.setUint16(e,this._signedToUnsignedInt16(s),this._littleEndian)}_setFloat32(t,e,s){t.setFloat32(e,s,this._littleEndian)}_colorToBytes(t){const e=this._colorParser(t);return Math.round(15*e[0])+(Math.round(15*e[1])<<4)+(Math.round(15*e[2])<<8)+(Math.round(15*e[3])<<12)}_scaledSizeToBytes(t){return Math.ceil(Math.min(t,this._maxScaledSize)*this._actualScaledSizeToBytes)}_fixedSizeToBytes(t){return t}_minVisibleSizeToBytes(t){return Math.round(Math.min(t,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)}_symbolicSizeToBytes(t){return Math.round(Math.min(t,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)}_dashLengthToBytes(t){return Math.round(Math.min(t,this._maxDashLength)*this._actualDashLengthToBytes)}_gapLengthToBytes(t){return Math.round(Math.min(t,this._maxGapLength)*this._actualGapLengthToBytes)}_patternScaleToBytes(t){return Math.round(Math.min(t,this._maxPatternScale)*this._actualPatternScaleToBytes)}_offsetAngleToBytes(t){return Math.round((t+Tr)%Tr*(8/Tr))}_opacityToBytes(t){return Math.round(15*Math.min(t,1))}_curvatureToBytes(t){return this._signedToUnsignedByte(t)}_signedToUnsignedByte(t){return bs(t,-128,127)+128}_signedToUnsignedInt16(t){return bs(t,-32768,32767)+32768}storeAnimationInformation(t,e,{beginTime:s,duration:i},n){this._setAnimationBeginTime(t,e,s),this._setAnimationDuration(t,e,i),this._setAnimationEasing(t,e,n)}_setAnimationBeginTime(t,e,s){this._setFloat32(t,e,s)}_setAnimationDuration(t,e,s){this._setFloat32(t,e+4,s)}_setAnimationEasing(t,e,s){this._setUint16(t,e+8,(s[0]+128<<8)+(s[4]+128)),this._setUint16(t,e+10,(s[1]+128<<8)+(s[5]+128)),this._setUint16(t,e+12,(s[2]+128<<8)+(s[6]+128)),this._setUint16(t,e+14,(s[3]+128<<8)+(s[7]+128))}extractGenericElement(t,e,s){const i=t.type,n=t.animated,r=t.getDataView(),o=e*t.elementSize,a=this._genericObject;if(a.valid=!1,r.getUint16(o)&&(a.valid=!0,this._extractGenericObject(a.end,r,o,s),n&&(this._extractGenericObject(a.start,r,o+qn,s),this._extractAnimationInformation(a.animation,r,o+2*qn)),a.id=this._bufferOffsetToId.get(t.getId(),e),i===Qi)){const l=t.getSideDataView(),d=e*t.getTotalSideElementsSize(),h=d+t.getTotalSideElementsSize();a.end.pattern=this._textManager.extractTextFromDataView(l,d,h)}return a}_extractGenericObject(t,e,s,{bytesToActualCoord:i,bytesToActualScaledSize:n,bytesToActualMinVisibleSize:r,bytesToActualPatternScale:o,bytesToActualSymbolicSize:a,bytesToActualDashLength:l,bytesToActualGapLength:d}){const h=e,u=s,c=this._littleEndian,g=h.getUint16(u,c),_=Ee(g,0,4),m=Ee(g,4,8),f=Ee(g,8,10),p=Ee(g,10,12),y=Ee(g,12,13),b=Ee(g,13,14),x=Ee(g,14,15),v=Ee(g,15,16),E=h.getUint16(u+2,c),w=Ee(E,0,8),A=Ee(E,8,11),I=Ee(E,11,12),M=Ee(E,12,13),k=Ee(E,13,14),W=Ee(E,14,15),H=Ee(E,15,16),$=h.getUint16(u+4,c),P=Ee($,0,4),S=Ee($,4,8),Y=Ee($,8,12),st=Ee($,12,16),at=h.getUint16(u+6,c),Tt=Ee(at,0,8),ut=Ee(at,8,16),Mt=h.getUint16(u+8,c),Nt=h.getUint16(u+10,c),_t=h.getUint16(u+12,c),St=h.getUint16(u+14,c),Zt=h.getFloat32(u+16,c),Qt=h.getFloat32(u+20,c),Kt=h.getFloat32(u+24,c),mt=h.getFloat32(u+28,c),pt=h.getUint16(u+32,c),ue=h.getUint16(u+34,c),Jt=h.getUint16(u+36,c),ce=h.getUint16(u+38,c),oe=h.getUint16(u+40,c),q=h.getUint16(u+42,c),et=h.getUint16(u+44,c),dt=h.getUint16(u+46,c),ot=h.getUint16(u+48,c),nt=zl(h.getUint16(u+50,c)),it=zl(h.getUint16(u+52,c)),wt=zl(h.getUint16(u+54,c));t.pieceId=m,t.shape=this._shapeManager.getNameFromId(_),t.x1=As(Zt,i),t.y1=As(Qt,i),t.x2=As(Kt,i),t.y2=As(mt,i),t.rectWidthOrSourceRadiusScaled=As(pt,n),t.rectWidthOrSourceRadiusFixed=ue,t.rectHeightOrTargetRadiusScaled=As(Jt,n),t.rectHeightOrTargetRadiusFixed=ce,t.thicknessOrFontSizeScaled=As(oe,n),t.thicknessOrFontSizeFixed=q,t.strokeWidthScaled=As(et,n),t.strokeWidthFixed=dt,t.offsetScaled=As(ot,n),t.offsetFixed=nt,t.pattern=this._patternManager.getDefinitionFromId(Mt),t.pattern.attributes.paddingTop=it,t.pattern.attributes.paddingLeft=wt,t.opacity=P/15,t.fillColor=Mo(Nt),t.strokeColor=Mo(_t),t.patternColor=Mo(St),t.globalMinVisibleSize=As(S,r),t.strokeMinVisibleSize=As(Y,r),t.patternMinVisibleSize=As(st,r),t.offsetAngle=A*(2*Math.PI/8),t.patternScale=w*o,t.symbolicSize=Tt*a,t.curvature=ES(ut),t.dashLength=f*l,t.gapLength=p*d,t.hasHead=!!y,t.hasTail=!!b,t.isBodyTriangle=!!x,t.isSelfLoop=!!v,t.isText=!!I,t.adjustTextAngle=!!M,t.isBadge=!!k,t.unusedFlag2=!!W,t.unusedFlag3=!!H}_extractAnimationInformation(t,e,s){const i=this._littleEndian,n=e.getFloat32(s,i),r=e.getFloat32(s+4,i),o=e.getUint16(s+8,i),a=e.getUint16(s+10,i),l=e.getUint16(s+12,i),d=e.getUint16(s+14,i),h=(o>>8)-128,u=(a>>8)-128,c=(l>>8)-128,g=(d>>8)-128,_=o%256-128,m=a%256-128,f=l%256-128,p=d%256-128;t.beginTime=n,t.duration=r,t.easing=hu.getName(h,u,c,g,_,m,f,p)}};function Ee(t,e,s){return t%(1<<s)>>e}function ES(t){return t-128}function zl(t){return t-32768}function As(t,e){return t*e}var Zc=new Array(65535);function Mo(t){let e=Zc[t];if(!e){const s=Ee(t,0,4)/15,i=Ee(t,4,8)/15,n=Ee(t,8,12)/15,r=Ee(t,12,16)/15;e=`rgba(${255*s|0}, ${255*i|0}, ${255*n|0}, ${r})`,s+i+n+r===0&&(e=null),Zc[t]=e}return e}var AS={[Ni]:"image",[oo]:"piechart",[Yi]:"text",[Ji]:"icon",[tn]:"badge"},SS=class{constructor(){this._pixelRatio=1,this._nextPatternId=1,this._version=0,this._init_()}reset(){this._init_()}_init_(){this._mustUpdate=!0,this._nextPatternId=1,this._patterns=[null],this._patternsByHash={},this._pixelRatio=1,this._nullPattern={id:-1,type:Rd,attributes:{}}}_increaseNextId(){let t=this._nextPatternId++;for(t%256==255&&(t=this._nextPatternId++);this._patterns.length<=t;)this._patterns.push(void 0);return t}_createPattern({type:t,attributes:e}){const s={id:this._increaseNextId(),type:t,attributes:this._cloneAttributes(t,e)};return this._patterns[s.id]=s,this._mustUpdate=!0,s}_cloneAttributes(t,e){return t===Ni?{image:e.image,scaled:e.scaled,duplicated:e.duplicated}:t===Yi||t===Ji||t===tn?{font:e.font,size:e.size,style:e.style,text:e.text,paddingLeft:e.paddingLeft,paddingTop:e.paddingTop,align:e.align||"center",offset:e.offset||0}:t===oo&&e.colors?{colors:e.colors,colorArray:e.colors.split(";").map(s=>s.trim())}:{}}getPatternList(){return this._patterns.filter(t=>t)}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}setPixelRatio(t){t!==this._pixelRatio&&(this._pixelRatio=t,this._mustUpdate=!0)}getPixelRatio(){return this._pixelRatio}notifyUpdate(){this._mustUpdate=!0}getIdFromDefinition(t){const{type:e,attributes:s}=t,i=e===Yi||e===Ji||e===tn;let n=0;return e&&e!==Rd&&e!==ki&&(e!==Ni||s.image)&&(!i||s.text&&s.font)&&(n=this._addPattern(t),e===Yi&&s.style==="normal"&&(s.style="bold",this._addPattern(t))),n}_addPattern(t){const e=this._getPatternHash(t);let s=this._patternsByHash[e];return s||(this._nextPatternId>65500?Mi("maximum number of pattern exceeded"):(s=this._createPattern(t).id,this._patternsByHash[e]=s)),s}_getPatternHash({type:t,attributes:e}){const s=[AS[t]];return t===Ni?s.push(e.scaled?"scaled":"non-scaled",e.duplicated?"duplicated":"non-duplicated",e.image.src||e.image.toDataURL()):t===Yi?s.push(e.text,e.font,e.style,e.size,e.align||"center",e.offset||0):t===Ji||t===tn?s.push(e.text,e.font,e.style,e.size,e.paddingLeft,e.paddingTop):s.push(e.colors),s.join("+")}getDefinitionFromId(t){if(t&&this._patterns[t]){const e=this._patterns[t];if(e)return e}return this._nullPattern}getVersion(){return this._version}};function Kc(t){return t.map(({x:e,y:s,r:i=0})=>({x:e,y:s,r:i}))}var wS=class{constructor(){this._version=0,this._mustUpdate=!0,this._byName={},this._byId=new Array(Ma+1)}register(t,{getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:i,hole:n,isSimple:r}){if(this._byName[t])return;let o=r?1:zd;const a=r?zd-1:Ma;for(;this._byId[o];)o+=1;if(o>a)throw new Error("max number of shape exceeded");const l={id:o,name:t,getDistanceFromStrokeVertically:e,getDistanceFromStrokeHorizontally:s,points:Kc(i.slice()),hole:n?Kc(n.slice()):null,isSimple:!!r};return this._mustUpdate=!0,this._byId[o]=l,this._byName[t]=l,l}getIdFromName(t){return this._byName[t].id}getNameFromId(t){const e=this._byId[t];return e?e.name:""}getDefinitionFromName(t){return this._byName[t]}update(){this._mustUpdate&&(this._version+=1,this._mustUpdate=!1)}getVersion(){return this._version}getShapeList(){return this._byId.filter(t=>t)}},Bl=Ya(),No=10,TS=1<<17,LS=65536,IS=256,Qc=128,CS=25,Np=1e3,Vd=2,MS=class{constructor(t){this._patternManager=t,this._canvas=Je(),this._ctx=this._canvas.getContext("2d",{willReadFrequently:!0}),this._processBidirectionalText=rp().processBidirectionalText,this._cornerRadius=0,this._version=0,this._textPattern={id:0,type:ki,attributes:{text:"",font:"",size:0,style:"normal",align:"center"},dimensions:{width:0,height:0}},this._textDimensions={width:0,height:0},this._lineWidthList=new Array(64),this._init()}_init(){this._mustClear=!1,this._clear()}reset(){this._init()}clear(){this._mustClear=!0}_measureChar(t,e,s){return Fi(this._ctx,e,Hr,s),this._ctx.measureText(t).width/Hr}_getAtlas(t,e,s,i){const n=s===ro?0:s,r=this._byFont[t]||(this._byFont[t]={none:void 0,bold:void 0,italic:void 0,normal:void 0}),o=r[i]||(r[i]={}),a=o[e]||(o[e]=new Array(50));return a[n]||(a[n]=new Array(256))}_getMeasurementAtlas(t,e){const s=this._widthAtlases[e];return s[t]||(s[t]=new Array(256))}measureText(t,e,s,i=1){if(!e)return this._textDimensions.width=0,this._textDimensions.height=0,this._textDimensions;const n=this._getMeasurementAtlas(e,s);let r=0,o=0,a=1;for(let l=0;l<t.length;++l){const d=t.charCodeAt(l);if(d===No)o>r&&(r=o),o=0,a+=1;else{let h=n[d];h===void 0&&(h=this._measureChar(t[l],e,s),n[d]=h),o+=h}}return o>r&&(r=o),this._textDimensions.width=r*i,this._textDimensions.height=a*i,this._textDimensions}_getCharInfo(t,e,s,i,n,r){let o=t[e];if(!o){const a=String.fromCharCode(e);o={ratio:this._measureChar(a,s,i),patternId:0},o.patternId=this._patternManager.getIdFromDefinition({id:0,type:Yi,attributes:{text:a,font:s,style:i,size:n,align:r}}),t[e]=o}return o}storeTextInDataView(t,e,s,i){let n=e;if(i&&i.type===ki){const{font:r,style:o,size:a,align:l}=i.attributes,d=l==="center",h=this._getAtlas(r,o,a,l);let u=0,c=1,g=0,_=0;const m=this._lineWidthList,f=this._processBidirectionalText(i.attributes.text);for(let x=0;x<f.length;++x){const v=f.charCodeAt(x);v===No?(g>u&&(u=g),m[_]=g,_++,g=0,c++):g+=this._getCharInfo(h,v,r,o,a,l).ratio}m[_]=g,g>u&&(u=g),_=0;let p=-(d?m[_]:u)/2,y=(1-c)/2,b=0;for(let x=0;x<f.length;++x){const v=f.charCodeAt(x),E=h[v];if(v===No)_+=1,p=-(d?m[_]:u)/2,y+=x===0?.5:1,b=0;else{const w=E.ratio,A=E.patternId;p+=(w+b)/2,b=w;const I=(bs(p*Np+LS,0,TS-1)<<8)+bs(y*Vd+Qc,0,IS-1);t.setUint16(n,A,Bl),t.setUint32(n+2,I,Bl),n+=ga}}}this._fillWithZeros(t,n,s)}extractTextFromDataView(t,e,s){const i=t,n=Bl,r=i.getUint16(e,n),o=this._textPattern,a=this._patternManager.getDefinitionFromId(r),{font:l,style:d,size:h,align:u}=a.attributes,c=this._getAtlas(l,d,h,u),g=[];let _=0,m=0,f=0,p=null;for(let b=e;b<s;b+=ga){const x=i.getUint16(b,n);if(!x)break;const v=(i.getUint8(b+2)-Qc)/Vd,E=this._patternManager.getDefinitionFromId(x);if(!E||!E.attributes||!E.attributes.text)break;const w=E.attributes.text.charCodeAt(0),A=c[w];p===null?p=v:v>p&&(_>m&&(m=_),_=0,f+=1,g.push(No),p=v),g.push(w),A&&(_+=A.ratio)}_>m&&(m=_);const y=String.fromCharCode.apply(null,g);return o.attributes.style=d,o.attributes.font=l,o.attributes.size=h,o.attributes.align=u,o.attributes.text=this._processBidirectionalText(y),o.dimensions&&(o.dimensions.width=m,o.dimensions.height=f),o}_fillWithZeros(t,e,s){for(let i=e;i<s;i+=ga)t.setUint16(i,0)}_clear(){this._byFont={},this._widthAtlases={normal:{},bold:{},italic:{}}}update(){this._mustClear&&(this._clear(),this._mustClear=!1)}getVersion(){return this._version}getCornerRadius(){return this._cornerRadius}setCornerRadius(t){t!==this._cornerRadius&&(this._cornerRadius=t,this._version++)}},cu=class extends io{constructor({bufferList:t,patternManager:e,boundariesManager:s,shapeManager:i,textManager:n,memoryManager:r}){super(),this._firstFrame=!0,this._width=0,this._height=0,this._pixelRatio=0,this._viewX=0,this._viewY=0,this._viewZoom=0,this._viewAngle=0,this._viewAngleCos=0,this._viewAngleSin=0,this._currentTime=0,this._scales={bytesToActualCoord:0,bytesToActualScaledSize:0,bytesToActualMinVisibleSize:0,bytesToActualSymbolicSize:0,bytesToActualDashLength:0,bytesToActualGapLength:0,bytesToActualPatternScale:0},this._shapesVersion=0,this._patternsVersion=0,this._boundariesVersion=0,this._textsVersion=0,this._backgroundRgba=[1,1,1,0],this._renderBackground=!1,this._hideImages=!1,this._genericObject=uu(),this._littleEndian=Ya(),this._bufferList=t,this._shapeManager=i,this._patternManager=e,this._boundariesManager=s,this._textManager=n,this._memoryManager=r}static createInitData(){return null}static getName(){return null}static isAvailable(){return!0}getDomElement(){return null}_initCanvas(t){t.style.touchAction="none"}export(t){return Promise.resolve()}extractElement(t,e){return this._memoryManager.extractGenericElement(t,e,this._scales)}_compareDimensions(t,e,s){return(t!==this._width||e!==this._height||s!==this._pixelRatio)&&(this._width=t,this._height=e,this._pixelRatio=s,!0)}_compareView(t,e,s,i){return(t!==this._viewX||e!==this._viewY||s!==this._viewZoom||i!==this._viewAngle)&&(this._viewX=t,this._viewY=e,this._viewZoom=s,this._viewAngle=i,this._viewAngleCos=Math.cos(i),this._viewAngleSin=Math.sin(i),!0)}_compareCurrentTime(t){return t!==this._currentTime&&(this._currentTime=t,!0)}_compareBackgroundColor(t,e){return(t!==this._backgroundColor||e!==this._renderBackground)&&(this._renderBackground=e,this._backgroundColor=t,this._backgroundRgba=os(this._backgroundColor),!0)}_compareShapes(){return this._shapesVersion!==this._shapeManager.getVersion()&&(this._shapesVersion=this._shapeManager.getVersion(),!0)}_comparePatterns(){return this._patternsVersion!==this._patternManager.getVersion()&&(this._patternsVersion=this._patternManager.getVersion(),!0)}_compareBoundaries(){return this._boundariesVersion!==this._boundariesManager.getVersion()&&(this._boundariesVersion=this._boundariesManager.getVersion(),!0)}_compareTexts(){return this._textsVersion!==this._textManager.getVersion()&&(this._textsVersion=this._textManager.getVersion(),!0)}_compareIsDisplayableBuffer(t){return this._isBufferDisplayable!==t&&(this._isBufferDisplayable=t,!0)}_compareHideImages(t){return this._hideImages!==t&&(this._hideImages=t,!0)}renderFrame({x:t,y:e,zoom:s,angle:i,width:n,height:r,pixelRatio:o,backgroundColor:a,currentTime:l,isBufferDisplayable:d,hideImages:h,renderBackground:u}){const c=this._compareShapes(),g=this._comparePatterns(),_=this._compareBoundaries(),m=this._compareTexts(),f=this._compareDimensions(n,r,o),p=this._compareView(t,e,s,i),y=this._compareCurrentTime(l),b=this._compareBackgroundColor(a,u),x=this._compareIsDisplayableBuffer(d),v=this._compareHideImages(h);if(_){const E=this._boundariesManager,w=this._scales;w.bytesToActualCoord=1,w.bytesToActualScaledSize=E.maxScaledSize/lp,w.bytesToActualMinVisibleSize=E.maxMinVisibleSize/Od,w.bytesToActualSymbolicSize=E.maxSymbolicSize/Mn,w.bytesToActualDashLength=E.maxDashLength/Nn,w.bytesToActualGapLength=E.maxGapLength/Nn,w.bytesToActualPatternScale=E.maxPatternScale/Mn}this._firstFrame&&this._beforeFirstFrame(),this._render({shapesChanged:c,patternsChanged:g,boundariesChanged:_,textsChanged:m,dimensionsChanged:f,viewChanged:p,currentTimeChanged:y,backgroundColorChanged:b,isBufferDisplayableChanged:x,isHideImagesChanged:v}),this._firstFrame&&(this._afterFirstFrame(),this._firstFrame=!1)}_render(t){}_beforeFirstFrame(){}_afterFirstFrame(){}destroy(){}ensureAnimationsReady(){}getImageData(){return null}setViewportClipping(t){}},Fo=1/hs,Fp=class extends cu{constructor(t){super(t),this._cachePoints=[],this._nextCachePoint=0,this._tmp={x1:0,y1:0,x2:0,y2:0},this._pointCopies=Array(128),this._clipViewport=!0}_resetCachePoints(){this._nextCachePoint=0}_point(t,e){let s=this._cachePoints[this._nextCachePoint++];return s||(s={x:0,y:0},this._cachePoints.push(s)),s.x=t,s.y=e,s}setViewportClipping(t){this._clipViewport=t}_displayBuffer(t){const e=t.getSize(),s=t.animated;for(let i=0;i<e;++i){const n=this.extractElement(t,i);n.valid&&this._displayElement(n,s)}}_mixAttributes(t,e,s){const i=Cp(this._currentTime,s.beginTime,s.duration,s.easing);return t.dashLength=le(e.dashLength,t.dashLength,i),t.gapLength=le(e.gapLength,t.gapLength,i),t.offsetAngle=le(e.offsetAngle,t.offsetAngle,i),t.opacity=le(e.opacity,t.opacity,i),t.globalMinVisibleSize=le(e.globalMinVisibleSize,t.globalMinVisibleSize,i),t.strokeMinVisibleSize=le(e.strokeMinVisibleSize,t.strokeMinVisibleSize,i),t.patternMinVisibleSize=le(e.patternMinVisibleSize,t.patternMinVisibleSize,i),t.symbolicSize=le(e.symbolicSize,t.symbolicSize,i),t.curvature=le(e.curvature,t.curvature,i),t.fillColor=fr(e.fillColor,t.fillColor,i,i),t.strokeColor=fr(e.strokeColor,t.strokeColor,i,i),t.patternColor=fr(e.patternColor,t.patternColor,i,i),t.x1=le(e.x1,t.x1,i),t.y1=le(e.y1,t.y1,i),t.x2=le(e.x2,t.x2,i),t.y2=le(e.y2,t.y2,i),t.rectWidthOrSourceRadiusScaled=le(e.rectWidthOrSourceRadiusScaled,t.rectWidthOrSourceRadiusScaled,i),t.rectWidthOrSourceRadiusFixed=le(e.rectWidthOrSourceRadiusFixed,t.rectWidthOrSourceRadiusFixed,i),t.rectHeightOrTargetRadiusScaled=le(e.rectHeightOrTargetRadiusScaled,t.rectHeightOrTargetRadiusScaled,i),t.rectHeightOrTargetRadiusFixed=le(e.rectHeightOrTargetRadiusFixed,t.rectHeightOrTargetRadiusFixed,i),t.thicknessOrFontSizeScaled=le(e.thicknessOrFontSizeScaled,t.thicknessOrFontSizeScaled,i),t.thicknessOrFontSizeFixed=le(e.thicknessOrFontSizeFixed,t.thicknessOrFontSizeFixed,i),t.strokeWidthScaled=le(e.strokeWidthScaled,t.strokeWidthScaled,i),t.strokeWidthFixed=le(e.strokeWidthFixed,t.strokeWidthFixed,i),t.offsetScaled=le(e.offsetScaled,t.offsetScaled,i),t.offsetFixed=le(e.offsetFixed,t.offsetFixed,i),t}_computeRenderInfo(t){const e=this._viewZoom,s=this._point(t.x1,t.y1),i=this._point(t.x2,t.y2);return{shape:this._shapeManager.getDefinitionFromName(t.shape),pieceId:t.pieceId,dashLength:t.dashLength,gapLength:t.gapLength,hasHead:t.hasHead,hasTail:t.hasTail,isBodyTriangle:t.isBodyTriangle,isSelfLoop:t.isSelfLoop,patternScale:t.patternScale,offsetAngle:Ea(t.offsetAngle),isText:t.isText,adjustTextAngle:t.adjustTextAngle,isBadge:t.isBadge,unusedFlag2:t.unusedFlag2,unusedFlag3:t.unusedFlag3,opacity:t.opacity,globalMinVisibleSize:t.globalMinVisibleSize,strokeMinVisibleSize:t.strokeMinVisibleSize,patternMinVisibleSize:t.patternMinVisibleSize,symbolicSize:t.symbolicSize===0?1/0:t.symbolicSize*e,curvature:t.curvature,pattern:t.pattern,fillColor:t.fillColor,strokeColor:t.strokeColor,patternColor:t.patternColor,pos1OnGraph:s,pos2OnGraph:i,pos1:this._graphToScreenCoordinates(s),pos2:this._graphToScreenCoordinates(i),rectWidthOrSourceRadius:t.rectWidthOrSourceRadiusScaled*e+t.rectWidthOrSourceRadiusFixed,rectHeightOrTargetRadius:t.rectHeightOrTargetRadiusScaled*e+t.rectHeightOrTargetRadiusFixed,thicknessOrFontSize:t.thicknessOrFontSizeScaled*e+t.thicknessOrFontSizeFixed,strokeWidth:t.strokeWidthScaled*e+t.strokeWidthFixed,offset:t.offsetScaled*e+t.offsetFixed}}_applyBackgroundBlending(t){t.opacity!==1&&(t.fillColor=this._blendColor(t.fillColor,t.opacity),t.strokeColor=this._blendColor(t.strokeColor,t.opacity),t.textColor=this._blendColor(t.textColor,t.opacity))}_pointArray(t){let e=this._pointCopies[t];if(!e){e=new Array(t),this._pointCopies[t]=e;for(let s=0;s<t;++s)e[s]={x:0,y:0,r:0}}return e}_scalePoints(t,e,s,i){const n=t.shape.points.length,r=this._pointArray(n);for(let l=0;l<n;++l){const d=t.shape.points[l],h=r[l];h.x=e.x+d.x*s,h.y=e.y+d.y*i,h.r=d.r*s}const o=t.pos2OnGraph.x-t.pos1OnGraph.x,a=t.pos2OnGraph.y-t.pos1OnGraph.y;if(o!==0||a!==0){const l=Math.sqrt(o*o+a*a),d=o/l,h=a/l;for(const u of r){const c=u.x-e.x,g=u.y-e.y;u.x=e.x+d*c+h*g,u.y=e.y-h*c+d*g}}return r}_drawPoints(t,e=!1){t.length===1?this._drawCircle(t[0],t[0].r):this._drawPolygon(t,e)}_computeCenter(t){const e=Math.cos(t.offsetAngle),s=Math.sin(t.offsetAngle),i=(t.pos1.x+t.pos2.x)/2+e*t.offset,n=(t.pos1.y+t.pos2.y)/2+s*t.offset;return this._point(i,n)}_displayTextBox(t,e,s,i){const n=this._computeCenter(t),r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2;(e||i)&&this._drawRoundedRectangle(n,r,o,0,t.fillColor)}_displayNodeComponent(t,e,s,i){const n=this._computeCenter(t);if(t.pattern.type!==ki){const r=t.rectWidthOrSourceRadius/2,o=t.rectHeightOrTargetRadius/2,a=this._scalePoints(t,n,r,o);if((e||i)&&this._drawPoints(a,!0),e&&this._fill(t.fillColor),i){if(this._startClip(),t.pattern.type===oo){let l=t.pattern.attributes.colorArray;t.opacity!==1&&(l=l.map(d=>this._blendColor(d,t.opacity))),this._displayPieChart(n,r,l)}else if(t.pattern.type===Ji||t.pattern.type===tn){const d=Math.round(t.rectHeightOrTargetRadius*t.patternScale),h=t.pattern.attributes.text,u=t.patternColor,c=t.pattern.attributes.font,g=t.pattern.attributes.style,_=t.pattern.attributes.align,m=t.rectWidthOrSourceRadius,f=t.pattern.attributes.paddingTop,p=t.pattern.attributes.paddingLeft;this._displayText(n,0,h,u,c,d,g,_,m,p,f,!0)}else if(t.pattern.type===Ni){const l=t.pattern.attributes.image;if(l.isDummy||l.width&&l.height){const d=t.pattern.attributes.duplicated,h=d?1:t.patternScale,u=t.rectWidthOrSourceRadius*h,c=t.rectHeightOrTargetRadius*h,g=t.pattern.attributes.scaled,_=t.opacity;this._displayImage(n,u,c,l,g,d,_)}}this._endClip()}if(s){const l=t.strokeWidth/2,d=this._scalePoints(t,n,r+l,o+l);this._drawPoints(d),this._stroke(t.strokeColor,t.strokeWidth)}}else if(i){const o=t.thicknessOrFontSize,a=t.pattern.attributes.text,l=t.patternColor,d=t.pattern.attributes.font,h=t.pattern.attributes.style,u=t.pattern.attributes.align,c=t.rectWidthOrSourceRadius;this._displayText(n,0,a,l,d,o,h,u,c,0,0,!1)}}_displayElement(t,e){if(!t.end||!t.end.shape||!t.end.pieceId||e&&(!t.start||!t.animation))return;this._resetCachePoints();const s=e?this._mixAttributes(t.end,t.start,t.animation):t.end,i=this._computeRenderInfo(s);if(i.symbolicSize<i.globalMinVisibleSize||i.opacity===0)return;this._applyBackgroundBlending(i);const n=!!(i.strokeColor&&i.strokeWidth>0&&i.symbolicSize>=i.strokeMinVisibleSize),r=i.pattern.type!==Rd&&i.symbolicSize>=i.patternMinVisibleSize,o=!!i.fillColor;if(i.pieceId===Ns)return this._displayNodeComponent(i,o,n,r);if(i.pieceId===Rn)return this._displayTextBox(i,o,n,r);const a=i.pos2.x-i.pos1.x,l=i.pos2.y-i.pos1.y,d=Math.sqrt(a*a+l*l);let h,u=null,c=null;if(i.isSelfLoop){const g=i.pieceId===Cn||i.pieceId===Cn+Rn?i.strokeWidth/2:i.rectWidthOrSourceRadius,{x1:_,y1:m,x2:f,y2:p}=this._getSelfLoopControlPoints(i.pos1,i.curvature,g);u=this._point(_,m),c=this._point(f,p),h=FS(i.pos1,u,c,i.pos2,1)}else i.curvature?(u=this._getQuadraticCurveControlPoint(i),h=NS(i.curvature,d,1)):h=d;if(i.pieceId===Cn||i.pieceId===Cn+Rn){const g=i.strokeWidth,_=this._getPointOnLine(i.pos1,u,c,i.pos2,.5),m=this._getTangentOnLine(i.pos1,u,c,i.pos2,.5);if(i.rectWidthOrSourceRadius>=h-g&&!i.isSelfLoop){if(!i.adjustTextAngle)return;m.x=1,m.y=0}let f=-Math.atan2(m.y,m.x);const p=Ea(i.offsetAngle-f);(!i.isSelfLoop&&p<0||i.isSelfLoop&&i.offsetAngle<0)&&(m.x*=-1,m.y*=-1),(f>Math.PI/2||f<-Math.PI/2)&&(f+=Math.PI);const y=this._getOrthogonal(m),b=_.x+y.x*i.offset,x=_.y+y.y*i.offset;if(i.fillColor){const v=i.rectWidthOrSourceRadius/2,E=i.rectHeightOrTargetRadius/2;this._drawRoundedRectangle(this._point(b,x),v,E,p+Math.PI/2,i.fillColor)}else{const v=this._point(b,x),E=f,w=i.thicknessOrFontSize,A=i.pattern.attributes.text,I=i.patternColor,M=i.pattern.attributes.font,k=i.pattern.attributes.style,W=i.pattern.attributes.align,H=i.rectWidthOrSourceRadius;this._displayText(v,E,A,I,M,w,k,W,H,0,0,!1)}}else{const g=i.pieceId===Kh,_=i.pieceId===Qh,m=Math.cos(i.offsetAngle),f=Math.sin(i.offsetAngle);i.pos1.x+=m*i.offset,i.pos1.y+=f*i.offset,i.pos2.x+=m*i.offset,i.pos2.y+=f*i.offset;const p=i.shape.name==="line",y=i.thicknessOrFontSize,b=i.rectWidthOrSourceRadius,x=i.rectHeightOrTargetRadius,v=+i.hasHead,E=+i.hasTail,w=v+E,A=PS(y),I=v*A,M=E*A,k=i.isSelfLoop?1/0:d-b-x,W=Math.min(k/w,A),H=E*(A+Math.max(b+W-M,0))+(1-E)*b,$=v*(A+Math.max(x+W-I,0))+(1-v)*x;if(g||_){const P=_?-1:1,S=(g?h-$:H)-P;let Y=null,st=null;if(i.isSelfLoop&&u&&c){const at=this._getTFromLengthOnCubicCurve(i.pos1,u,c,i.pos2,S-i.strokeWidth/2*P);Y=this._getPointOnCubicCurve(i.pos1,u,c,i.pos2,at),st=this._getTangentOnCubicCurve(i.pos1,u,c,i.pos2,at)}else if(i.curvature&&u){const at=this._getTFromLengthOnQuadraticCurve(i.pos1,u,i.pos2,S-i.strokeWidth/2*P);Y=this._getPointOnQuadraticCurve(i.pos1,u,i.pos2,at),st=this._getTangentOnQuadraticCurve(i.pos1,u,i.pos2,at)}else{const at=S/h;Y=this._mixPoints(i.pos1,i.pos2,at),st=this._point(a/d,l/d)}if(st.x*=P,st.y*=P,o){if(i.shape.hole){const Tt=this._makeEdgeExtremityPoints(Y,st,A,i.shape.hole);this._drawPoints(Tt),this._startReverseClip()}const at=this._makeEdgeExtremityPoints(Y,st,A,i.shape.points);this._drawPoints(at),this._fill(i.fillColor),i.shape.hole&&this._endReverseClip()}if(n){if(i.shape.hole){const ut=this._makeEdgeExtremityPoints(Y,st,A,i.shape.hole);this._drawPoints(ut),this._stroke(i.strokeColor,i.strokeWidth)}const at=A+i.strokeWidth/2,Tt=this._makeEdgeExtremityPoints(Y,st,at,i.shape.points);this._drawPoints(Tt),this._stroke(i.strokeColor,i.strokeWidth)}}else{if(h-H-$<=0)return;if(p){const P=DS(h,y,H,$,i.dashLength,i.gapLength);n&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.strokeColor,y+2*i.strokeWidth,P)),o&&(this._drawLine(i.pos1,u,c,i.pos2),this._stroke(i.fillColor,y,P))}else{const P=H,S=h-$;if(n){const Y=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,P,S,y+i.strokeWidth/2,i.strokeWidth/2);this._drawPoints(Y),this._stroke(i.strokeColor,i.strokeWidth)}if(o){const Y=this._makeTriangleEdgeBody(i.pos1,u,c,i.pos2,P,S,y,0);this._drawPoints(Y),this._fill(i.fillColor)}}}}}_makeTriangleEdgeBody(t,e,s,i,n,r,o,a){return e?s?this._makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a):this._makeCurveTriangleEdge(t,e,i,n,r,o,a):this._makeStraightTriangleEdge(t,i,n,r,o,a)}_makeCurveTriangleEdge(t,e,s,i,n,r,o){const a=2*hs+2,l=this._pointArray(a),d=this._getTFromLengthOnQuadraticCurve(t,e,s,i),h=(this._getTFromLengthOnQuadraticCurve(t,e,s,n)-d)/hs,u=(o-r)/hs/2;let c=r/2,g=d;for(let _=0;_<=hs;++_){const m=this._getPointOnQuadraticCurve(t,e,s,g),f=this._getTangentOnQuadraticCurve(t,e,s,g),p=this._getOrthogonal(f),y=p.x*c,b=p.y*c,x=l[_],v=l[a-1-_];x.x=m.x+y,x.y=m.y+b,v.x=m.x-y,v.y=m.y-b,g+=h,c+=u}return l}_makeSelfLoopTriangleEdge(t,e,s,i,n,r,o,a){const l=2*hs+2,d=this._pointArray(l),h=this._getTFromLengthOnCubicCurve(t,e,s,i,n),u=(this._getTFromLengthOnCubicCurve(t,e,s,i,r)-h)/hs,c=(a-o)/hs/2;let g=o/2,_=h;for(let m=0;m<=hs;++m){const f=this._getPointOnCubicCurve(t,e,s,i,_),p=this._getTangentOnCubicCurve(t,e,s,i,_),y=this._getOrthogonal(p),b=y.x*g,x=y.y*g,v=d[m],E=d[l-1-m];v.x=f.x+b,v.y=f.y+x,E.x=f.x-b,E.y=f.y-x,_+=u,g+=c}return d}_makeStraightTriangleEdge(t,e,s,i,n,r){const o=e.x-t.x,a=e.y-t.y,l=Math.sqrt(o*o+a*a),d=this._point(o/l,a/l),h=this._getOrthogonal(d),u=n/2,c=r/2,g=this._pointArray(4),_=g[0],m=g[1],f=g[2],p=g[3],y=t.x+d.x*s,b=t.y+d.y*s,x=t.x+d.x*i,v=t.y+d.y*i,E=h.x*u,w=h.y*u,A=h.x*c,I=h.y*c;return _.x=y+E,_.y=b+w,m.x=y-E,m.y=b-w,f.x=x-A,f.y=v-I,p.x=x+A,p.y=v+I,g}_makeEdgeExtremityPoints(t,e,s,i){const n=this._pointArray(i.length),r=s/2,o=t.x+e.x*r,a=t.y+e.y*r,l=e.x,d=e.y;for(let h=0;h<i.length;++h){const u=i[h],c=n[h],g=(l*u.x-d*u.y)*r,_=(d*u.x+l*u.y)*r;c.x=o+g,c.y=a+_,c.r=u.r*r}return n}_drawLine(t,e,s,i){e?s?this._drawCubicCurve(t,e,s,i):this._drawQuadraticCurve(t,e,i):this._drawStraightLine(t,i)}_getSelfLoopControlPoints(t,e,s){return un(t.x,t.y,e,s,this._viewAngle,this._tmp)}_getQuadraticCurveControlPoint(t){return Bs(t.pos1.x,t.pos1.y,t.pos2.x,t.pos2.y,t.curvature,this._point(0,0))}_graphToScreenCoordinates(t){const e=this._width/2,s=this._height/2,i=(t.x-this._viewX)*this._viewZoom,n=(t.y-this._viewY)*this._viewZoom,r=this._viewAngleCos,o=this._viewAngleSin,a=r*i+o*n+e,l=-o*i+r*n+s;return this._point(a,l)}_blendColor(t,e){return t&&this._backgroundColor?fr(this._backgroundColor,t,e,1):t?gS(t,e):null}_getTangentOnLine(t,e,s,i,n){return e?s?this._getTangentOnCubicCurve(t,e,s,i,n):this._getTangentOnQuadraticCurve(t,e,i,n):this._getTangentOnStraightLine(t,i)}_getTangentOnStraightLine(t,e){const s=e.x-t.x,i=e.y-t.y,n=Math.sqrt(s*s+i*i);return this._point(s/n,i/n)}_getTangentOnQuadraticCurve(t,e,s,i){const n=1-i,r=n*e.x+i*s.x-(n*t.x+i*e.x),o=n*e.y+i*s.y-(n*t.y+i*e.y),a=Math.sqrt(r*r+o*o);return this._point(r/a,o/a)}_getTangentOnCubicCurve(t,e,s,i,n){const r=1-n,o=r*r,a=n*n,l=o*(e.x-t.x)+2*r*n*(s.x-e.x)+a*(i.x-s.x),d=o*(e.y-t.y)+2*r*n*(s.y-e.y)+a*(i.y-s.y),h=Math.sqrt(l*l+d*d);return this._point(l/h,d/h)}_mixPoints(t,e,s){const i=le(t.x,e.x,s),n=le(t.y,e.y,s);return this._point(i,n)}_getOrthogonal(t){return this._point(-t.y,t.x)}_getPointOnLine(t,e,s,i,n){return e?s?this._getPointOnCubicCurve(t,e,s,i,n):this._getPointOnQuadraticCurve(t,e,i,n):this._mixPoints(t,i,n)}_getPointOnQuadraticCurve(t,e,s,i){const n=Fn(t.x,e.x,s.x,i),r=Fn(t.y,e.y,s.y,i);return this._point(n,r)}_getPointOnCubicCurve(t,e,s,i,n){const r=Eo(t.x,e.x,s.x,i.x,n),o=Eo(t.y,e.y,s.y,i.y,n);return this._point(r,o)}_getTFromLengthOnCubicCurve(t,e,s,i,n){let r=t.x,o=t.y,a=0,l=0;for(let d=0;d<hs;++d){a+=Fo;const h=Eo(t.x,e.x,s.x,i.x,a),u=Eo(t.y,e.y,s.y,i.y,a),c=h-r,g=u-o,_=Math.sqrt(c*c+g*g),m=l+_;if(m>n)return a-Fo*((m-n)/_);l=m,r=h,o=u}return 1}_getTFromLengthOnQuadraticCurve(t,e,s,i){let n=t.x,r=t.y,o=0,a=0;for(let l=0;l<hs;++l){o+=Fo;const d=Fn(t.x,e.x,s.x,o),h=Fn(t.y,e.y,s.y,o),u=d-n,c=h-r,g=Math.sqrt(u*u+c*c),_=a+g;if(_>i)return o-Fo*((_-i)/g);a=_,n=d,r=h}return 1}};function NS(t,e,s){const i=Math.abs(t)/hl+Yf,n=i*i,r=s-.5,o=r*r,a=1/(16*n),l=Math.sqrt(o+a),d=.5/i*Math.sqrt(n+.25);return Math.abs(2*i)*(r*l+.5*d+a*Math.log(Math.abs((r+l)/(-.5+d))))*e}function FS(t,e,s,i,n){const r=(t.x+e.x+s.x)/3,o=(t.y+e.y+s.y)/3,a=r-e.x,l=o-e.y,d=e.x-s.x,h=e.y-s.y,u=a*a+l*l,c=(d*d+h*h)/4,g=Math.sqrt(u-c);return 2*up*g*3.14159265359*n}function PS(t){return t*hp}function DS(t,e,s,i,n,r){const o=[];if(s&&o.push(0,s),n&&r){const a=n*e,l=r*e,d=a+l,h=t-i-s-d;let u=0;for(;u<h;)o.push(a,l),u+=d;const c=t-i-s-u,g=Math.min(a,c),_=Math.max(c-g,0);o.push(g,_)}else o.push(t-i-s,0);return i&&o.push(0,i),o}var Dn=0,Lr=1,Ir=2,Hi=3,Jc=4,gu=0,jd=1,kS={[Dn]:{min:"NEAREST",mag:"NEAREST",mipmap:!1},[Lr]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[Ir]:{min:"LINEAR",mag:"LINEAR",mipmap:!1},[Hi]:{min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:!0}},RS={[gu]:"ALPHA",[jd]:"RGBA"};function Xn(t){return Math.ceil((t+2*Ri)/ns)*ns}function OS(t,e,s,i,n){for(let r=0,o=t.length;r<o;++r){const a=t[r],l=a.x,d=a.y,h=l+i,u=d+n;let c=h<s&&u<s;if(c){for(let g=l;g<h;++g)if(e[g+d*s]===1){c=!1;break}}if(c){for(let g=d;g<u;++g)if(e[l+g*s]===1){c=!1;break}}if(c){for(let g=l;g<h;++g)for(let _=d;_<u;++_)e[g+_*s]=1;return t.splice(r,1),t.push({x:l,y:u},{x:h,y:d}),a}}return null}function tg(t,e,s,i,n,r,o){const a=4*t,l=e>>1<<7,d=e%2<<7;o[a]=s/ns,o[a+1]=i/ns,o[a+2]=l+n/ns,o[a+3]=d+r/ns}function zS(t,e,s,i,n,r,o){i|=0,n|=0,r|=0,o|=0,e|=0;for(let a=0;a<r;++a)for(let l=0;l<o;++l){const d=4*(i+a+(n+l)*e),h=4*(a+l*r);t[d]=s[h],t[d+1]=s[h+1],t[d+2]=s[h+2],t[d+3]=s[h+3]}}function BS(t,e){let s=0,i=4;for(let r=0;r<t.length;++r){const{width:o,height:a}=t[r],l=Xn(o),d=Xn(a);s+=l*d,i=Math.max(i,Math.max(l,d))}const n=Si(Math.max(i,Math.sqrt(s)));return Math.min(n,e)}function eg(t,e){return Math.floor((e-t)/2)}function sg(t,e,s,i,n,r,o){const{min:a,mag:l,mipmap:d}=kS[r],h=t[RS[o]];if(o===gu){const u=new Uint8Array(n*n);for(let c=0;c<u.length;++c)u[c]=i[4*c+3];i=u}t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,h,n,n,0,h,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[l]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[a]),d&&t.generateMipmap(t.TEXTURE_2D)}function Pp(t,e,s,i,n){const r=new Uint8Array(s*s*4),o=Math.ceil(s/ns),a=new Uint8Array(o*o),l=[{x:0,y:0}];for(let d=0;d<e.length;++d){const h=e[d],u=h.id,c=Xn(h.width)/ns,g=Xn(h.height)/ns,_=OS(l,a,o,c,g);if(_){const m=h.width,f=h.height,p=h.pixels,y=c*ns,b=g*ns,x=_.x*ns+eg(m,y),v=_.y*ns+eg(f,b);zS(r,s,p,x,v,m,f),tg(u,t,x,v,y,b,n)}else{if(s<i)return Pp(t,e,2*s,i,n);Mi(`exceeded max WebGL texture size of ${i}; some texts/icons/images won't be displayed`),tg(u,t,0,0,0,0,n)}}return{texture:r,size:s}}function US(t,e,s,i){const{getDistanceFromStrokeVertically:n,getDistanceFromStrokeHorizontally:r}=t,o=e*(1-s)/2,a=(e-1)/2;for(let l=0;l<e;++l)for(let d=0;d<e;++d){const h=4*(d*e+l),u=(l-a)/o,c=(d-a)/o,g=bs(n(u,c),-1,1),_=bs(r(u,c),-1,1);GS(i,h,ig(g),ig(_))}}function ig(t){const e=(t+1)/2;return Math.floor(32768*e)}function GS(t,e,s,i){t[e]=s>>8,t[e+1]=s%256,t[e+2]=i>>8,t[e+3]=i%256}function Dp(t,e){let s=-Math.PI/2;const i=2*Math.PI/t.length;for(const n of t){const r=s+i;e(n,s,r),s=r}}function kp(t,e,s,i,n){Dp(e,(r,o,a)=>{t.beginPath(),t.moveTo(s,i),t.arc(s,i,n,o,a),t.fillStyle=r,t.fill()})}var VS=!Je().__dummy,jS=class extends Fp{constructor(t){super(t),this._canvas=Je(),this._imgCanvas=Je(),this._initCanvas(this._canvas),this._ctx=this._canvas.getContext("2d"),this._imgCtx=this._imgCanvas.getContext("2d")}static getName(){return"Canvas"}static isAvailable(){return VS}getDomElement(){return this._canvas}_render({dimensionsChanged:t}){t&&Mp(this._canvas,this._width,this._height,this._pixelRatio);const e=this._ctx,s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;e.clearRect(0,0,s,i),this._backgroundColor&&this._renderBackground&&(e.fillStyle=this._backgroundColor,e.fillRect(0,0,s,i));const n=this._bufferList.getBuffersByAscendingDepth();for(let r=0;r<n.length;++r){const o=n[r];this._isBufferDisplayable(o)&&this._displayBuffer(o)}}_drawRoundedRectangle(t,e,s,i,n){const r=this._ctx,o=this._pixelRatio,a=t.x*o,l=t.y*o;e*=o,s*=o;const d=this._textManager.getCornerRadius(),h=Math.min(d*o,s);e+=h/2,r.save(),r.translate(a,l),r.rotate(i),r.beginPath(),r.arc(e-h,s-h,h,0,Math.PI/2),r.arc(-e+h,s-h,h,Math.PI/2,Math.PI),r.arc(-e+h,-s+h,h,Math.PI,3*Math.PI/2),r.arc(e-h,-s+h,h,3*Math.PI/2,0),n&&(r.fillStyle=n,r.fill()),r.restore()}_drawCircle(t,e){const s=this._ctx,i=this._pixelRatio,n=t.x*i,r=t.y*i,o=e*i;s.beginPath(),s.arc(n,r,o,0,2*Math.PI)}_drawPolygon(t){const e=this._ctx,s=this._pixelRatio;e.beginPath();const i=t[0];e.moveTo(i.x*s,i.y*s);for(let n=1;n<t.length;++n){const r=t[n];e.lineTo(r.x*s,r.y*s)}e.closePath()}_drawStraightLine(t,e){const s=this._ctx,i=this._pixelRatio;s.beginPath(),s.moveTo(t.x*i,t.y*i),s.lineTo(e.x*i,e.y*i)}_drawQuadraticCurve(t,e,s){const i=this._ctx,n=this._pixelRatio;i.beginPath(),i.moveTo(t.x*n,t.y*n),i.quadraticCurveTo(e.x*n,e.y*n,s.x*n,s.y*n)}_drawCubicCurve(t,e,s,i){const n=this._ctx,r=this._pixelRatio;n.beginPath(),n.moveTo(t.x*r,t.y*r),n.bezierCurveTo(e.x*r,e.y*r,s.x*r,s.y*r,i.x*r,i.y*r)}_fill(t){const e=this._ctx;e.fillStyle=t,e.fill()}_stroke(t,e,s=[]){if(e===0)return;const i=this._ctx,n=this._pixelRatio;i.setLineDash(s.map(r=>r*this._pixelRatio)),i.lineWidth=e*n,i.strokeStyle=t,i.stroke()}_startClip(){this._ctx.save(),this._ctx.clip()}_endClip(){this._ctx.restore()}_startReverseClip(){this._ctx.save(),this._ctx.rect(0,0,this._canvas.width,this._canvas.height),this._ctx.clip("evenodd")}_endReverseClip(){this._ctx.restore()}_displayText(t,e,s,i,n,r,o,a,l,d,h){const u=this._ctx,c=this._pixelRatio,g=t.x*c,_=t.y*c,m=r*c,f=a==="center"?0:-l/2;if(h=h*this._viewZoom*c,d=d*this._viewZoom*c,u.save(),u.translate(g,_+c),u.rotate(-e),u.textBaseline="middle",u.textAlign=a,Fi(u,n,m,o),u.fillStyle=i,s.indexOf(`
`)!==-1){const p=s.split(`
`),y=p.length;let b=(1-y)/2*m;for(let x=0;x<y;++x)u.fillText(p[x],d+f,h+b),b+=m}else u.fillText(s,d+f,h);u.restore()}_displayImage(t,e,s,i,n,r,o){if(this._hideImages||"isDummy"in i)return;let a=i;o!==1&&(a=this._blendImageOnBackground(i,o));const l=this._ctx,d=this._pixelRatio,h=t.x*d,u=t.y*d,c=e*d,g=s*d,_=a.width*d,m=a.height*d;if(n)l.drawImage(a,h-c/2,u-g/2,c,g);else if(r){const f=h-c/2,p=u-g/2,y=h+c/2,b=u+g/2;let x=h-_/2,v=u-m/2;for(;x>f;)x-=_;for(;v>p;)v-=m;const E=v;for(;x<y;){for(;v<b;)l.drawImage(a,x,v,_,m),v+=m;x+=_,v=E}}else l.drawImage(a,h-_/2,u-m/2,_,m)}_displayPieChart(t,e,s){const i=this._ctx,n=this._pixelRatio,r=t.x*n,o=t.y*n,a=e*n*2,l=2*a;s.length===1&&(i.fillStyle=s[0],i.fillRect(r-a,o-a,l,l)),s.length>1&&kp(i,s,r,o,a)}_blendImageOnBackground(t,e){const s=this._backgroundRgba,i=`rgb(${Math.round(255*s[0])},${Math.round(255*s[1])},${Math.round(255*s[2])})`;return this._imgCanvas.width=t.width,this._imgCanvas.height=t.height,this._imgCtx.clearRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=1,this._imgCtx.fillStyle=i,this._imgCtx.fillRect(0,0,t.width,t.height),this._imgCtx.globalAlpha=e,this._imgCtx.drawImage(t,0,0),this._imgCanvas}getImageData(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)}},Rp=!1;try{Rp=!!de("svg")}catch{}var ar="none",qS={left:"start",center:"middle",right:"end"},Is="data-element-id",ng="data-text-component",HS="node-text",XS="edge-text",WS="badge-text";function Zi(t){return Math.round(1e3*t)/1e3}function rg(t,e,s,i,n,r){const o=de("image");return o.setAttribute("width",Zi(i)),o.setAttribute("height",Zi(n)),o.setAttribute("x",Zi(e)),o.setAttribute("y",Zi(s)),o.setAttribute("href",t),r&&r.appendChild(o),o}function $S(t,e,s,i,n,r=1,o){const a=de("rect");return a.setAttribute("x",t),a.setAttribute("y",e),a.setAttribute("width",s),a.setAttribute("height",i),a.setAttribute("fill",n),a.setAttribute("fill-opacity",r),o&&o.appendChild(a),a}var YS=class extends Fp{constructor(t){super(t),this._svg=de("svg"),this._defs=de("defs"),this._styles=de("g",{class:"styles"}),this._background=de("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"}),this._currentElementId="0",this._currentClipPathId=null,this._clipPathCounter=0,this._defs.appendChild(this._styles),this._svg.setAttribute("pointer-events","none"),this._svg.style.userSelect="none",this._svg.appendChild(this._defs),this._svg.appendChild(this._background),this._clear()}static getName(){return"SVG"}static isAvailable(){return Rp}getDomElement(){return this._svg}_render({dimensionsChanged:t}){if(t&&Nh(this._svg,{width:this._width,height:this._height}),this._backgroundColor&&this._renderBackground){const s=Sn(this._backgroundColor);this._background.setAttribute("fill",s.color),this._background.setAttribute("fill-opacity",s.opacity)}const e=this._bufferList.getBuffersByAscendingDepth();this._clear(),this._svg.removeChild(this._container);for(let s=0;s<e.length;++s){const i=e[s];this._isBufferDisplayable(i)&&this._displayBuffer(i)}this._svg.appendChild(this._container)}_clear(){this._container&&this._svg.removeChild(this._container),this._container=de("g"),this._svg.appendChild(this._container),this._clipPaths&&this._defs.removeChild(this._clipPaths),this._clipPaths=de("g"),this._defs.appendChild(this._clipPaths),this._clipPaths.setAttribute("class","clip-paths"),this._filters&&this._defs.removeChild(this._filters),this._filters=de("g"),this._defs.appendChild(this._filters)}_displayElement(t,e){this._currentElementId=t.id>=0?`n${t.id}`:"e"+-t.id,super._displayElement(t,e)}_addBackgroundBlendingFilter(t){const e=os(this._backgroundColor),s=t,i=1-t,n=[s,0,0,0,e[0]*i,0,s,0,0,e[1]*i,0,0,s,0,e[2]*i,0,0,0,1,0].join(" "),r=`filter-${this._currentElementId}`,o=de("filter",{id:r}),a=de("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:n});return o.appendChild(a),this._filters.appendChild(o),r}_drawRoundedRectangle(t,e,s,i,n){const r=t.x,o=t.y,a=Math.min(this._textManager.getCornerRadius(),s);e+=a/2;const l=de("path"),d=`M ${r+e-a} ${o+s}     A ${a} ${a} 0 0 0 ${r+e} ${o+s-a}     L ${r+e} ${o-s+a}     A ${a} ${a} 0 0 0 ${r+e-a} ${o-s}     L ${r-e+a} ${o-s}     A ${a} ${a} 0 0 0 ${r-e} ${o-s+a}     L ${r-e} ${o+s-a}     A ${a} ${a} 0 0 0 ${r-e+a} ${o+s}     L ${r+e-a} ${o+s}`;l.setAttribute("d",d),l.setAttribute("fill",ar),l.setAttribute("transform",`rotate(${Cd(i)} ${t.x} ${t.y})`),l.setAttribute(Is,this._currentElementId),this._container.appendChild(l),this._element=l,n&&this._fill(n)}_drawCircle(t,e){const{x:s,y:i}=t,n=`M ${s-e}, ${i} a ${e},${e} 0 1,0 ${2*e},0 a ${e},${e} 0 1,0 -${2*e},0`,r=de("path");r.setAttribute("d",n),r.setAttribute("fill",ar),r.setAttribute(Is,this._currentElementId),this._container.appendChild(r),this._element=r}_drawPolygon(t,e){const s=de("path");let i="";for(let n=0;n<t.length;n++){const{x:r,y:o}=t[n];i+=`${n===0?"M":"L"}${r},${o} `}i+="Z",s.setAttribute("d",i),s.setAttribute(Is,this._currentElementId),s.setAttribute("fill",ar),e&&s.setAttribute(ng,!0),this._container.appendChild(s),this._element=s}_drawStraightLine(t,e){const s=de("path"),i=`M ${t.x},${t.y} L${e.x},${e.y}`;s.setAttribute("d",i),s.setAttribute(Is,this._currentElementId),this._container.appendChild(s),this._element=s}_drawQuadraticCurve(t,e,s){const i=de("path"),n=`M ${t.x},${t.y} Q${e.x},${e.y} ${s.x},${s.y}`;i.setAttribute("d",n),i.setAttribute("fill",ar),i.setAttribute(Is,this._currentElementId),this._container.appendChild(i),this._element=i}_drawCubicCurve(t,e,s,i){const n=de("path"),r=`M ${t.x},${t.y} C${e.x},${e.y} ${s.x},${s.y} ${i.x},${i.y}`;n.setAttribute("d",r),n.setAttribute("fill",ar),n.setAttribute(Is,this._currentElementId),this._container.appendChild(n),this._element=n}_fill(t){const e=Sn(t);this._element.setAttribute("fill",e.color),this._element.setAttribute("fill-opacity",e.opacity),this._currentClipPathId&&this._element.setAttribute("clip-path",`url(#${this._currentClipPathId})`)}_stroke(t,e,s=[]){if(e===0)return;const i=this._element;i.setAttribute("stroke-width",e);const n=Sn(t);i.setAttribute("stroke",n.color),i.setAttribute("stroke-opacity",n.opacity),s.length>0&&i.setAttribute("stroke-dasharray",s.map(Zi).toString())}_startClip(){const t=de("clipPath"),e=this._element.cloneNode(!1);this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endClip(){this._currentClipPathId=null}_startReverseClip(){const t=de("clipPath"),e=this._element.cloneNode(!1),s=e.getAttribute("d");e.setAttribute("clip-rule","evenodd"),e.setAttribute("d",`${s} M 0 0 L ${this._width} 0 L ${this._width} ${this._height} L 0 ${this._height}`),this._currentClipPathId="clip-path-"+ ++this._clipPathCounter,t.appendChild(e),this._clipPaths.appendChild(t),t.setAttribute("id",this._currentClipPathId)}_endReverseClip(){this._currentClipPathId=null}_displayText(t,e,s,i,n,r,o="normal",a,l,d,h,u){const c=de("g");c.setAttribute(Is,this._currentElementId),c.setAttribute(ng,!0);let g=this._currentElementId[0]==="n"?HS:XS;u&&(g+=" "+WS),c.setAttribute("class",g);const _=Sn(i),m=_.opacity,f=Sn(_.color),p=t.x+d*this._viewZoom,y=t.y+1+h*this._viewZoom,b=Zi(p);c.setAttribute("font-family",n),c.setAttribute("font-size",r),o==="bold"?c.setAttribute("font-weight",o):c.setAttribute("font-style",o),c.setAttribute("fill",f.color),c.setAttribute("fill-opacity",m),e&&c.setAttribute("transform",`rotate(${Cd(-e)} ${p}, ${y})`),c.setAttribute("text-anchor",qS[a]||"middle"),c.setAttribute("dominant-baseline","middle");const x=s.split(`
`),v=x.length,E=Zi(y-(v+1)/2*r),w=a==="center"?0:-l/2;for(let A=0;A<v;A++){const I=de("text");I.appendChild(Ph(x[A])),I.setAttribute("x",b+w),I.setAttribute("y",E+(A+1)*r),c.appendChild(I)}this._currentClipPathId&&c.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(c)}_displayImage(t,e,s,i,n,r,o){const a=t.x,l=t.y;if(this._hideImages||!("isDummy"in i)&&(!i.width||!i.height))return;const d=e,h=s;let u,c=i.width,g=i.height;if(n&&(c=d,g=h),r){const _=a-d/2,m=l-h/2,f=a+d/2,p=l+h/2;let y=a-c/2,b=l-g/2;for(u=de("g"),u.setAttribute(Is,this._currentElementId);y>_;)y-=c;for(;b>m;)b-=g;const x=b;for(;y<f;){for(;b<p;)rg(i.src,y,b,c,g,u),b+=g;b=x,y+=c}}else u=rg(i.src,a-c/2,l-g/2,c,g),u.setAttribute(Is,this._currentElementId);if(this._currentClipPathId&&u.setAttribute("clip-path",`url(#${this._currentClipPathId})`),o!==1){const _=this._addBackgroundBlendingFilter(o);u.setAttribute("filter",`url(#${_})`)}this._container.appendChild(u)}_displayPieChart(t,e,s){const i=2*e,n=2*i,r=t.x,o=t.y;let a;const l=de("g");l.setAttribute(Is,this._currentElementId),s.length===1&&(a=$S(r-i,o-i,n,n,s[0],1,l)),s.length>1&&Dp(s,(d,h,u)=>{const c=r+e*Math.cos(u),g=o+e*Math.sin(u),_=r+e*Math.cos(h),m=o+e*Math.sin(h),f=u-h<=Math.PI?0:1,p=`M ${c},${g} A ${e},${e} 0 ${f} 0 ${_},${m} L ${r},${o} L ${c},${g}`;a=de("path"),a.setAttribute("d",p),a.setAttribute("fill",d),a.setAttribute("stroke-width",0),l.appendChild(a)}),this._currentClipPathId&&l.setAttribute("clip-path",`url(#${this._currentClipPathId})`),this._container.appendChild(l)}},ZS=6,KS=class{constructor({gl:t,ext:e,staticProgram:s,animationProgram:i}){this._version=0,this._used=!1,this._dataBufferChanged=!1,this._gl=t,this._ext=e,this._staticProgram=s,this._animationProgram=i,this._glBuffer=this._gl.createBuffer()}setDataBuffer(t){this._dataBuffer!==t&&(this._program=t.animated?this._animationProgram:this._staticProgram,this._dataBuffer=t,this._dataBufferChanged=!0,t.hasSideData()&&!this._sideGlBuffer?this._sideGlBuffer=this._gl.createBuffer():!t.hasSideData()&&this._sideGlBuffer&&(this._gl.deleteBuffer(this._sideGlBuffer),delete this._sideGlBuffer))}markAsUnused(){return this._used=!1,this}getProgram(){return this._program}markAsUsed(){return this._used=!0,this}isUsed(){return this._used}draw(){const t=this._gl,e=this._dataBuffer.type,s=e===Qi,i=s?this._dataBuffer.getNbSideElementsPerMainElement():1,n=e===Ca?hs:1,r=this._dataBuffer.getSize(),o=this._dataBuffer.stencilUsage,a=this._dataBuffer.version,l=this._version!==a||this._dataBufferChanged;this._program.setupBaseAttributes({glBuffer:this._glBuffer,dataBuffer:l?this._dataBuffer.getByteArray():null,divisor:i}),this._program.setupTextAttributes({glBuffer:this._sideGlBuffer,dataBuffer:l&&s?this._dataBuffer.getSideByteArray():null,divisor:1}),this._program.setupStencil(o),l&&(this._version=a,this._dataBufferChanged=!1),this._ext.drawArraysInstancedANGLE(t.TRIANGLES,0,ZS*n,r*i)}destroy(){this._gl.deleteBuffer(this._glBuffer),this._sideGlBuffer&&this._gl.deleteBuffer(this._sideGlBuffer)}},QS={byte:1,ubyte:1,short:2,ushort:2,ulong:4,float:4},JS={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",ulong:"UNSIGNED_LONG",float:"FLOAT"},og=class{constructor({gl:t,ext:e,specialGlBuffers:s,metaData:i,programWrapper:n}){this._stencilUsage=On,this._gl=t,this._ext=e,this._specialGlBuffers=s,this._metaData=Ie(i),this._programWrapper=n}_finishInit(){const t=this._gl,e=this._ext,s=this._programWrapper.getError();if(s)throw new Error(`WebGL compilation at step "${s.step}:
${s.message}"`);const i=this._programWrapper.getProgram();this._program=i,t.useProgram(i),this._metaData.attributes.forEach(o=>{o.location=t.getAttribLocation(this._program,o.name),o.byteSize=o.size*QS[o.type],o.glType=JS[o.type]}),this._specialAttributes=this._createSpecialAttributesFunctions();const n=[],r=[];for(const o of this._metaData.attributes)o.location!==-1&&(o.name.startsWith("a_text")?r.push(o):n.push(o));this._baseAttributes=Ul(n,t,e),this._textAttributes=Ul(r,t,e),this._setupUniforms=e1(this._metaData.uniforms,t,i)}_createSpecialAttributesFunctions(){return Ul([{location:this._gl.getAttribLocation(this._program,this._metaData.vertexInfoAttribute),size:3,glType:"BYTE",byteSize:3,type:"byte",name:"special"}],this._gl,this._ext)}startPass(t){this._program||this._finishInit(),this._gl.useProgram(this._program),this._resetStencil(),this._setupUniforms(this._gl,t),this._specialAttributes.enable(this._gl),this._specialAttributes.setup(this._specialGlBuffers.vertexInfo,null,0)}_setupAttributes(t,{glBuffer:e,dataBuffer:s,divisor:i}){t.enabled&&!e?t.disable(this._gl):!t.enabled&&e&&t.enable(this._gl),e&&t.setup(e,s,i)}setupBaseAttributes(t){this._setupAttributes(this._baseAttributes,t)}setupTextAttributes(t){this._setupAttributes(this._textAttributes,t)}_resetStencil(){const t=this._gl;this._stencilUsage=On,t.disable(t.STENCIL_TEST)}setupStencil(t){if(t!==this._stencilUsage){const e=this._gl;t!==On?(e.enable(e.STENCIL_TEST),t===tp?(e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),e.stencilFunc(e.ALWAYS,1,1)):t===ep&&(e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilFunc(e.EQUAL,0,1))):e.disable(e.STENCIL_TEST),this._stencilUsage=t}}endPass(){const t=this._gl;this._specialAttributes.disable(t),this._baseAttributes.disable(t),this._textAttributes.disable(t)}};function t1(t,e,s){return(i,n,r)=>{let o=0,a=0;for(let l=0;l<t.length;l++)a+=t[l].byteSize;e.bindBuffer(e.ARRAY_BUFFER,i),n&&e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);for(let l=0;l<t.length;l++){const{location:d,size:h,glType:u,byteSize:c}=t[l];e.vertexAttribPointer(d,h,e[u],!1,a,o),o+=c,s.vertexAttribDivisorANGLE(d,r)}}}function e1(t,e,s){const i={};for(let n=0;n<t.length;++n){const{id:r,name:o}=t[n],a=e.getUniformLocation(s,o);a&&(i[r]=a)}return(n,r)=>{for(let o=0;o<t.length;++o){const{id:a,type:l}=t[o],d=i[a],h=r[a];if(d)switch(l){case"int":case"sampler2D":n.uniform1i(d,h);break;case"float":n.uniform1f(d,h);break;case"vec2":n.uniform2f(d,h[0],h[1]);break;case"vec3":n.uniform3f(d,h[0],h[1],h[2]);break;case"vec4":n.uniform4f(d,h[0],h[1],h[2],h[3])}}}}function s1(t){return e=>{for(let s=0;s<t.length;s++){const i=t[s].location;e.enableVertexAttribArray(i)}}}function i1(t){return e=>{for(let s=0;s<t.length;++s){const i=t[s].location;e.disableVertexAttribArray(i)}}}function Ul(t,e,s){const i=s1(t),n=i1(t);return{enable(r){i(r),this.enabled=!0},disable(r){n(r),this.enabled=!1},setup:t1(t,e,s),enabled:!1}}var Gl=`#define D3D9_FIX 0
precision highp float;
precision mediump int;
uniform vec3 u_backgroundColor;
uniform sampler2D u_patternNearestTexture;
uniform sampler2D u_patternLinearTexture;
uniform sampler2D u_patternLinearSdfTexture;
uniform sampler2D u_patternMipmapTexture;
uniform sampler2D u_shapeTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying vec4 f;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SDF_GAMMA = 0.0;
const float EPSILON = 0.000000001;
const float SDF_BUFFER = (256.0 - 64.0) / 256.0; 
vec4 af(in vec4 ag, in vec4 ah) {
float ai = ah.a;
float aj = ag.a + EPSILON;
float ak = min(ai + aj, 1.0);
float r = ai / ak;
return vec4(mix(ag.rgb, ah.rgb, r), ak);
}
float al(in float am, in float an) {
float ao = (am * 256.0 + an) * 256.0;
float ap = ao / 32768.0;
return ap * 2.0 - 1.0;
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
float at(float au) {
float bh = 2.;
vec2 bi = abs(c.rg) - c.ba - vec2(bh) + vec2(au);
float bj = min(max(bi.x, bi.y), 0.0) + length(max(bi, 0.0)) - au;
return smoothstep(0.1, .5, (1. - bj) / 10.);
}
void main() {
#if D3D9_FIX
#else
float br = o.x;
float bs = o.y;
float bt = r.x;
float bu = r.y;
#endif
vec4 bx = texture2D(u_shapeTexture, d);
float by = al(bx.b, bx.a) * s.x;
float bz = al(bx.r, bx.g) * s.y;
float ch = float(f.z > EPSILON);
float ci = float(f.w > EPSILON);
float cj = 1. - smoothstep(
0.01,
0.25760,
distance(f.xy * f.z - vec2(0.0586), d * f.z)
);
cj = cj * 2.5 - 1.5;
cj *= 0.5;
cj *= s.x;
float ck = at(g) ;
vec4 cl = a;
vec4 cm = b;
if (u > -EPSILON) {
vec2 cq = e;
float dd =
step(m.x, cq.x) *
step(cq.x, n.x) *
step(m.y, cq.y) *
step(cq.y, n.y);
float de = dd;
vec4 dh;
if (aq(u, FILTER_NEAREST)) {
dh = texture2D(u_patternNearestTexture, cq);
} else if (aq(u, FILTER_LINEAR)) { 
dh = texture2D(u_patternLinearTexture, cq);
} else if (aq(u, FILTER_LINEAR_SDF)) { 
dh = texture2D(u_patternLinearSdfTexture, cq);
dh.a = smoothstep(SDF_BUFFER - t, SDF_BUFFER + t, dh.a);
} else if (aq(u, FILTER_MIPMAP)) { 
dh = texture2D(u_patternMipmapTexture, cq);
}
dh.rgb += c.rgb;
dh.a *= de;
cl = af(cl, dh);
}
float dw = (1. - ch) * min(by, bz)
+ ch * cj;
dw = (1. - ci) * dw + ci * ck;
float ek = clamp(dw, 0.0, 1.0);
float en = clamp(dw - l, 0.0, 1.0);
float eo = ek - en;
eo = 1.0 - clamp(dw - l, 0.0, 1.0);
cl.a *= en;
cm.a *= eo * step(EPSILON, l);
vec4 ew = af(cl, cm);
float ex = ek;
ew.rgb = mix(u_backgroundColor, ew.rgb, br);
if (q > EPSILON) {
float fk = fract(bu) * q;
float fl = clamp(min(fk, bt - fk), 0.0, 1.0);
ex *= fl;
}
if (p < 0.0 || p > 1.0 || ex < EPSILON) {
discard;
}
ew.a *= ex;
ew.rgb *= ew.a;
gl_FragColor = ew;
}
`,Vl=`#define D3D9_FIX 0
#define ANIMATED 0
precision highp float;
precision mediump int;
attribute /*ushort*/ vec4 a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_final_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_final_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*ushort*/ vec4 a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature;
attribute /*ushort*/ vec4 a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA;
attribute /*float*/ vec4 a_prev_x1_y1_x2_y2;
attribute /*ushort*/ vec4 a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed;
attribute /*ushort*/ vec4 a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed;
attribute /*ushort*/ vec4 a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft;
attribute /*float*/ vec2 a_animationBeginTime_animationDuration; 
attribute /*ushort*/ vec4 a_animationEasing; 
attribute /*ushort*/ vec3 a_text_charId_charOffsetXY; 
attribute vec3 a_vertexInfo;
uniform float u_viewWidth;
uniform float u_viewHeight;
uniform float u_viewX;
uniform float u_viewY;
uniform float u_viewAngle;
uniform float u_viewZoom;
uniform float u_currentTime;
uniform float u_pixelRatio;
uniform sampler2D u_patternInfoTexture;
varying vec4 a;
varying vec4 b;
varying vec4 c;
varying vec2 d;
varying vec2 e;
varying float g;
#if D3D9_FIX
#else
varying float l;
varying vec2 m;
varying vec2 n;
varying vec2 o;
varying float p;
varying float q;
varying vec2 r;
varying vec2 s;
varying float t;
varying float u;
#endif
varying vec4 f;
const float EPSILON = 0.000001;
const float INFINITY = 10000000.0;
const float PI = 3.14159265359;
const float P2_17 = 131072.0;
const float P2_16 = 65536.0;
const float P2_14 = 32768.0;
const float P2_12 = 4096.0;
const float P2_8 = 256.0;
const float P2_7 = 128.0;
const float P2_6 = 64.0;
const float P2_5 = 32.0;
const float P2_4 = 16.0;
const float P2_3 = 8.0;
const float P2_2 = 4.0;
const float P2_1 = 2.0;
const float MAX_PROGRESS = 1.0;
uniform float BYTES_TO_COORD;
uniform float BYTES_TO_SCALED_SIZE;
uniform float BYTES_TO_MIN_VISIBLE_SIZE;
uniform float BYTES_TO_SYMBOLIC_SIZE;
uniform float BYTES_TO_CURVATURE;
uniform float BYTES_TO_DASH_LENGTH;
uniform float BYTES_TO_GAP_LENGTH;
uniform float BYTES_TO_PATTERN_SCALE;
uniform float PATTERN_POSITION_UNIT_SIZE;
uniform float PATTERN_INFO_TEXTURE_SIZE;
uniform float PATTERN_NEAREST_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_TEXTURE_SIZE;
uniform float PATTERN_LINEAR_SDF_TEXTURE_SIZE;
uniform float PATTERN_MIPMAP_TEXTURE_SIZE;
uniform float ROUNDED_BOX_RADIUS;
const float BYTES_TO_OFFSET_ANGLE = 0.0;
const float BYTES_TO_COLOR = 0.0;
const float SDF_FONT_SIZE = 0.0;
const float SDF_GAMMA = 0.0;
const float CURVATURE_RATIO = 0.0;
const float PATTERN_PADDING = 0.0;
const float TEXT_WIDTH_MULTIPLIER = 0.0;
const float TEXT_HEIGHT_MULTIPLIER = 0.0;
const float SELF_LOOP_CURVATURE_RATIO = 0.0;
const float EDGE_ARROW_SIZE_RATIO = 0.0;
const float CURVE_SUBDIVISIONS = 0.0;
const float PIECE_NODE_COMPONENT = 0.0;
const float PIECE_TEXT_BOX = 0.0;
const float PIECE_EDGE_BODY = 0.0;
const float PIECE_EDGE_HEAD = 0.0;
const float PIECE_EDGE_TAIL = 0.0;
const float PIECE_EDGE_TEXT = 0.0;
const float MAX_TEXT_SIZE = 0.0;
const float BYTES_TO_TEXT_OFFSET_X = 0.0;
const float BYTES_TO_TEXT_OFFSET_Y = 0.0;
const float FILTER_NEAREST = 0.0;
const float FILTER_LINEAR = 0.0;
const float FILTER_LINEAR_SDF = 0.0;
const float FILTER_MIPMAP = 0.0;
const float SHAPE_TEXTURE_SIZE = 0.0;
const float SIMPLE_SHAPE_SAMPLING_SIZE = 0.0;
const float COMPLEX_SHAPE_SAMPLING_SIZE = 0.0;
const float SHAPE_SAMPLING_BUFFER_RATIO = 0.0;
const float MAX_SHAPES = 0.0;
const float FIRST_COMPLEX_SHAPE_ID = 0.0;
const float SELF_LOOP_TO_CIRCLE_APPROX = 0.0;
const float NB_SHAPES_BY_SIDE = SHAPE_TEXTURE_SIZE / COMPLEX_SHAPE_SAMPLING_SIZE;
const float SHAPE_FILL_PERCENT = 1.0 - SHAPE_SAMPLING_BUFFER_RATIO;
const float T_STEP_PER_CURVE_PIECE = 1.0 / CURVE_SUBDIVISIONS;
const float HEAD_TAIL_PX_ADJUST = 1.5;
const float SDF_SMOOTH_FACTOR = 2.0;
struct pv {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
};
struct qe {
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
};
struct qm {
float pw;
float px;
float py;
float pz;
float qa;
float qb;
float qc;
float qd;
float qf;
float qg;
float qh;
float qi;
float qj;
float qk;
float ql;
float dc;
float qn;
float qo;
float qp;
float qq;
float qr;
float qs;
vec4 cl;
vec4 cm;
vec4 dh;
float qt;
float qu;
float qv;
float qw;
float qx;
float qy;
float qz;
float ra;
float rb;
float rc;
float rd;
float re;
float rf;
float rg;
float rh;
float ri;
float rj;
float rk;
float rl;
};
struct rm {
float eu;
vec2 rn;
vec4 cl;
vec4 cm;
float dc;
float ro;
float rp;
float py;
float rq;
vec2 rr;
float rs;
vec2 cq;
vec2 rt;
vec2 ru;
float rv;
float rw;
vec4 dh;
vec2 bd;
float rx;
float or;
vec2 ry;
vec2 rz;
vec2 sa;
};
float sb(float nq, float sc, float sd) {
float se = mod(nq, pow(2.0, sd));
return floor(se / pow(2.0, sc));
}
pv sf(float nq) {
pv sg;
sg.pw = sb(nq, 0.0, 4.0);
sg.px = sb(nq, 4.0, 8.0);
sg.py = sb(nq, 8.0, 10.0);
sg.pz = sb(nq, 10.0, 12.0);
sg.qa = sb(nq, 12.0, 13.0);
sg.qb = sb(nq, 13.0, 14.0);
sg.qc = sb(nq, 14.0, 15.0);
sg.qd = sb(nq, 15.0, 16.0);
return sg;
}
qe sh(float nq) {
qe sg;
sg.qf = sb(nq, 0.0, 8.0);
sg.qg = sb(nq, 8.0, 11.0);
sg.qh = sb(nq, 11.0, 12.0);
sg.qi = sb(nq, 12.0, 13.0);
sg.qj = sb(nq, 13.0, 14.0);
sg.qk = sb(nq, 14.0, 15.0);
sg.ql = sb(nq, 15.0, 16.0);
return sg;
}
vec4 si(in float nq) {
return vec4(
sb(nq, 0.0, 4.0),
sb(nq, 4.0, 8.0),
sb(nq, 8.0, 12.0),
sb(nq, 12.0, 16.0)
);
}
vec2 sj(in float nq) {
return vec2(mod(nq, 256.0), floor(nq / 256.0));
}
vec2 sk(in float nq) {
float sl = floor(nq / P2_6);
float sm = nq - (sl * P2_6);
return vec2(sl, sm);
}
vec2 sn(in float nq) {
float so = floor(nq / P2_7);
float sp = nq - (so * P2_7);
return vec2(so, sp);
}
vec2 sq(in vec2 sr, in float ss) {
float st = cos(ss);
float su = sin(ss);
return vec2(st * sr.x + su * sr.y, -su * sr.x + st * sr.y);
}
vec4 sv(in vec4 sw) {
return floor(sw / 256.0) - 128.0;
}
vec4 sx(in vec4 sw) {
return mod(sw, 256.0) - 128.0;
}
float sy(float nq) {
return nq - 128.0;
}
vec2 sy(vec2 nq) {
return nq - 128.0;
}
vec2 sz(vec2 ta) {
return vec2(-ta.y, ta.x);
}
vec2 tb(vec2 tc, vec2 ih, vec2 td, float t) {
float te = 1.0 - t;
return (te * te * tc) + (2.0 * te * t * ih) + (t * t * td);
}
vec2 tf(vec2 tc, vec2 tg, vec2 th, vec2 td, float t) {
float te = 1.0 - t;
float ti = te * te;
float tj = ti * te;
float tk = t * t;
float tl = tk * t;
return (tj * tc) + (3.0 * ti * t * tg) + (3.0 * te * tk * th) + (tl * td);
}
vec2 tm(vec2 tc, vec2 ih, vec2 td, float t) {
float te = (1.0 - t);
vec2 sr = (te * ih + t * td) - (te * tc + t * ih);
return normalize(sr);
}
vec2 tn(vec2 tc, vec2 ih, vec2 td, float t) {
return sz(tm(tc, ih, td, t));
}
vec2 to(vec2 tc, vec2 tg, vec2 th, vec2 td, float t) {
float te = 1.0 - t;
float ti = te * te;
float tk = t * t;
vec2 sr = ti * (tg - tc) + 2.0 * te * t * (th - tg) + tk * (td - th);
return normalize(sr);
}
vec2 tp(vec2 tc, vec2 tg, vec2 th, vec2 td, float t) {
return sz(to(tc, tg, th, td, t));
}
float ua(float qr, float ub, float t) {
float y = abs(qr) / CURVATURE_RATIO + EPSILON;
float qw = y * y;
float te = t - 0.5;
float ti = te * te;
float uc = 1.0 / (16.0 * qw);
float ud = sqrt(ti + uc);
float ue = (0.5 / y) * sqrt(qw + 0.25);
float uf = (abs(2.0 * y)) * ((te * ud) + (0.5 * ue) + (uc * log(abs((te + ud) / (-0.5 + ue)))));
return uf * ub;
}
float ug(vec2 tc, vec2 uh, vec2 ui, vec2 td, float uj) {
vec2 bd = (tc + uh + ui) / 3.0;
vec2 uk = bd - uh;
vec2 ul = uh - ui;
float um = dot(uk, uk);
float un = dot(ul, ul) / 4.0;
float au = sqrt(um - un) * SELF_LOOP_TO_CIRCLE_APPROX * 1.55;
return 2.0 * PI * au * uj;
}
float uv(float nq) {
return nq - 32.0;
}
float uw(float nq) {
return nq - 512.0;
}
float ux(float nq) {
return nq - P2_14;
}
void uy() {
gl_Position = vec4(-10.0, -10.0, 1.0, 1.0);
}
vec4 uz(vec2 va) {
return vec4(((vec2(va.x, u_viewHeight - va.y) / vec2(u_viewWidth, u_viewHeight)) * 2.0 - 1.0), 0.5, 1.0);
}
float ve(float ar, float as) {
return step(ar - EPSILON, as) * step(as, ar + EPSILON);
}
bool aq(float ar, float as) {
return abs(ar - as) < EPSILON;
}
bool vf(float nq) {
return nq > 0.5;
}
vec2 vg(vec2 vh) {
return sq((vh - vec2(u_viewX, u_viewY)) * u_viewZoom, u_viewAngle) + vec2(u_viewWidth, u_viewHeight) / 2.0;
}
float vi(float or) {
return or * EDGE_ARROW_SIZE_RATIO;
}
float vj(float vk, float vl) {
return vk * BYTES_TO_SCALED_SIZE * u_viewZoom + vl;
}
float vr(float ro, float vp, float vq) {
float vs = vq - vp;
float a = 1.0 / vs;
float b = -vp / vs;
return ro * a + b;
}
struct vt {
vec2 vu;
vec2 vv;
};
vt vw(vec2 vx, float au, float qr) {
vt ns;
float vy = (au + au / SELF_LOOP_CURVATURE_RATIO * qr) * SELF_LOOP_CURVATURE_RATIO;
float vz = -u_viewAngle + PI;
float wa = -u_viewAngle + PI / 2.0;
ns.vu = vx + vec2(cos(vz), sin(vz)) * vy;
ns.vv = vx + vec2(cos(wa), sin(wa)) * vy;
return ns;
}
float we(vec2 wf, vec2 uh, vec2 ui, vec2 wg, float wh) {
vec2 wi = wf;
float t = 0.0;
float wj = 0.0;
float wk = ug(wf, uh, ui, wg, 1.0);
return wh / wk;
}
qm wl(
vec4 wm,
vec4 wn,
vec4 wo,
vec4 wp,
vec4 wq,
vec4 wr,
vec3 ws
) {
qm a;
pv bx = sf(wm.x);
qe wt = sh(wm.y);
vec4 wu = si(wm.z);
vec2 wv = sj(wm.w);
a.pw = bx.pw;
a.px = bx.px;
a.py = bx.py;
a.pz = bx.pz;
a.qa = bx.qa;
a.qb = bx.qb;
a.qc = bx.qc;
a.qd = bx.qd;
a.qf = wt.qf;
a.qg = wt.qg;
a.qh = wt.qh;
a.qi = wt.qi;
a.qj = wt.qj;
a.qk = wt.qk;
a.ql = wt.ql;
a.dc = wu.x;
a.qn = wu.y;
a.qo = wu.z;
a.qp = wu.w;
a.qq = wv.x;
a.qr = wv.y;
a.qs = wn.x;
a.cl = si(wn.y);
a.cm = si(wn.z);
a.dh = si(wn.w);
a.qt = wo.x;
a.qu = wo.y;
a.qv = wo.z;
a.qw = wo.w;
a.qx = wp.x;
a.qy = wp.y;
a.qz = wp.z;
a.ra = wp.w;
a.rb = wq.x;
a.rc = wq.y;
a.rd = wq.z;
a.re = wq.w;
a.rf = wr.x;
a.rg = ux(wr.y);
a.rk = ux(wr.z);
a.rl = ux(wr.w);
a.rh = ws.x;
float x = ws.y;
float y = mod(x, P2_8);
if (ws.z > 0.0) x += ws.z * P2_16;
a.ri = ((x - y) / P2_8) - P2_16;
a.rj = (y - P2_7) * BYTES_TO_TEXT_OFFSET_Y;
return a;
}
bool xy(const in qm a, out rm ns) {
float pw = a.pw;
float px = a.px;
float py = a.py * BYTES_TO_DASH_LENGTH;
float pz = a.pz * BYTES_TO_GAP_LENGTH;
float qa = a.qa;
float qb = a.qb;
float qc = a.qc;
float qd = a.qd;
float qf = a.qf * BYTES_TO_PATTERN_SCALE;
float qg = a.qg * BYTES_TO_OFFSET_ANGLE;
float qh = a.qh;
float qi = a.qi;
float qj = a.qj;
float qk = a.qk;
float ql = a.ql;
float dc = a.dc * BYTES_TO_COLOR;
float qn = a.qn * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qo = a.qo * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qp = a.qp * BYTES_TO_MIN_VISIBLE_SIZE - EPSILON;
float qq = a.qq * BYTES_TO_SYMBOLIC_SIZE * u_viewZoom + step(a.qq, EPSILON) * INFINITY;
float qr = sy(a.qr);
float qs = a.qs;
vec4 cl = a.cl * BYTES_TO_COLOR;
vec4 cm = a.cm * BYTES_TO_COLOR;
vec4 dh = a.dh * BYTES_TO_COLOR;
vec2 xz = vec2(a.qt, a.qu) * BYTES_TO_COORD;
vec2 ya = vec2(a.qv, a.qw) * BYTES_TO_COORD;
vec2 wf = vg(xz);
vec2 wg = vg(ya);
float yb = vj(a.qx, a.qy);
float yc = vj(a.qz, a.ra);
float yd = vj(a.rb, a.rc);
float eu = vj(a.rd, a.re);
float xa = vj(a.rf, a.rg);
vec2 ye = a_vertexInfo.xy;
vec2 yf = vec2(0.0, 0.0);
float yg = yb;
float yh = yc;
float yi = yc * qf;
if (qh > EPSILON) {
if (a.rh < EPSILON) return false;
yi = yd;
qs = a.rh;
yb = yi * TEXT_WIDTH_MULTIPLIER * u_pixelRatio;
yc = yi * TEXT_HEIGHT_MULTIPLIER * u_pixelRatio;
}
bool zb = abs(qr) > EPSILON && ve(px, PIECE_EDGE_BODY) < EPSILON;
bool zc = zb && a_vertexInfo.z > EPSILON;
if (pw < EPSILON || px < EPSILON || qq < qn || zc) {
return false;
}
eu *= step(qo, qq);
float zp = 0.0;
float zq = 1.0;
float zm = 0.0;
float zo = 1.0;
float zr = 0.0;
float aab = 1.0;
float aad = 1.0;
float aao = 0.0;
float aap = 0.0;
vec2 bd;
vec2 ry;
vec2 rz;
vec2 sa;
float or;
float rx;
float abh = 0.0;
float abi = 1.0;
bool ci = ve(px, PIECE_TEXT_BOX) > EPSILON;
if (ve(px, PIECE_NODE_COMPONENT) > EPSILON || ci) {
bd = ceil((wf + wg) / 2.0);
if(length(ya - xz) > EPSILON){
ry = normalize(ya - xz) * vec2(1.,-1.);
}else{
ry = vec2(1.0, 0.0);
}
rz = sz(ry);
sa = rz;
or = yb;
rx = yc;
} else {
aad = 0.0;
float abz = distance(wf, wg);
vec2 aca = normalize(wg - wf);
vec2 acb = (wf + wg) / 2.0;
vec2 acc = sz(aca);
vec2 acd = acb + (acc * abz * -qr / CURVATURE_RATIO);
if (ve(px, PIECE_EDGE_TEXT) > 0.0
|| ve(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0
) {
ci = ve(px, PIECE_EDGE_TEXT + PIECE_TEXT_BOX) > 0.0;
float ace;
float acf = eu;
eu = 0.0;
if (qd > EPSILON) {
vt ih = vw(wf, acf / 2.0, qr);
bd = tf(wf, ih.vu, ih.vv, wg, 0.5);
ry = to(wf, ih.vu, ih.vv, wg, 0.5);
rz = sz(ry);
sa = rz;
ace = ug(wf, ih.vu, ih.vv, wg, 0.5);
} else if (abs(qr) > EPSILON) {
bd = tb(wf, acd, wg, 0.5);
ry = tm(wf, acd, wg, 0.5);
rz = sz(ry);
sa = rz;
ace = ua(qr, abz, 1.0);
} else {
bd = acb;
ry = aca;
rz = acc;
sa = acc;
ace = abz;
}
or = yb;
rx = yc;
if(yg > ace - acf && qd < EPSILON){
if(qi > EPSILON){
ry = vec2(1.0, 0.0);
rz = vec2(0.0, 1.0);
sa = vec2(0.0, 1.0);
} else {
ry = vec2(0,0);
rz = vec2(0.0, 0.0);
sa = vec2(0.0, 0.0);
}
} else {
float ss = -atan(ry.y, ry.x);
abh = ss;
qg -= ss;
if ((ss > PI / 2.0 || ss < -PI / 2.0)) {
qg += (1.0 - qd) * PI;
abi = -1.0;
ry *= -1.0;
rz *= -1.0;
sa *= -1.0;
}
}
} else {
float aah = yd;
float acn = yb;
float aco = yc;
float acp = qa + qb;
float acq = vi(aah);
float acr = qa * acq;
float acs = qb * acq;
float act = ve(px, PIECE_EDGE_HEAD);
float acu = ve(px, PIECE_EDGE_TAIL);
float acv = INFINITY * qd + abz - acn - aco;
float acw = min(acv / acp, acq);
float ade =
qb * (acq + max(acn + acw - acs, 0.0))
+ (1.0 - qb) * (acn);
float adf =
qa * (acq + max(aco + acw - acr, 0.0))
+ (1.0 - qa) * (aco);
if (act > EPSILON || acu > EPSILON) {
vec2 adi = act * wg + acu * wf;
float xa = act * adf + acu * ade + (HEAD_TAIL_PX_ADJUST - 0.5);
float adj = act * acr + acu * acs;
vec2 adk;
if (qd > EPSILON) {
vt ih = vw(wf, acn, qr);
float ace = ug(wf, ih.vu, ih.vv, wg, 1.0);
float wh = act * (ace - adf) + acu * ade;
float t = we(wf, ih.vu, ih.vv, wg, wh);
adk = tf(wf, ih.vu, ih.vv, wg, t);
} else {
float ace = ua(qr, abz, 1.0);
float t = (act * (ace - adf) + acu * ade) / ace;
adk = tb(wf, acd, wg, t);
}
ry = normalize(adi - adk);
rz = sz(ry);
sa = rz;
bd = adi - ry * (xa - adj / 2.0);
or = adj;
rx = adj;
py = 0.0;
pz = 0.0;
} else {
float ado;
float adp;
float adq;
if (abs(qr) < EPSILON) {
bd = acb;
ry = aca;
rz = acc;
sa = rz;
or = abz;
ado = abz;
adp = 0.0;
adq = abz;
} else {
float ads = a_vertexInfo.z;
float adt = ads * T_STEP_PER_CURVE_PIECE;
float tk = adt + T_STEP_PER_CURVE_PIECE;
if (qd < EPSILON) {
vec2 adu = tb(wf, acd, wg, adt);
vec2 adv = tb(wf, acd, wg, tk);
bd = (adu + adv) / 2.0;
ry = normalize(adv - adu);
rz = tn(wf, acd, wg, adt);
sa = tn(wf, acd, wg, tk);
or = distance(adu, adv);
ado = ua(qr, abz, 1.0);
adp = ua(qr, abz, adt);
adq = ua(qr, abz, tk);
} else {
vt ih = vw(wf, acn, qr);
vec2 uh = ih.vu;
vec2 ui = ih.vv;
vec2 adu = tf(wf, uh, ui, wg, adt);
vec2 adv = tf(wf, uh, ui, wg, tk);
bd = (adu + adv) / 2.0;
ry = normalize(adv - adu);
rz = tp(wf, uh, ui, wg, adt);
sa = tp(wf, uh, ui, wg, tk);
or = distance(adu, adv);
ado = ug(wf, uh, ui, wg, 1.0);
adp = ug(wf, uh, ui, wg, adt);
adq = ug(wf, uh, ui, wg, tk);
}
}
rx = yd;
zm = (ade - 1.0) / ado - 0.015 * qd;
zo = MAX_PROGRESS + 0.015 * qd
- (adf - HEAD_TAIL_PX_ADJUST) / ado;
zp = adp / ado;
zq = adq / ado;
zr = ado;
if (qc > 0.0 && acv > 5.0) {
float aea = (ado * rx) / (ado - ade);
float wk = ado;
float qt = ade;
float qv = ado - adf;
float a = -aea / wk;
float b = aea;
float qu = a * qt + b;
float qw = a * qv + b;
float aeb = qu / (qt - qv);
float bi = -aeb * qv;
rx = min(min(bi, acn), aco);;
aap = aeb * wk + bi + 1.0;
}
}
}
}
vec2 cq = vec2(0.0, 0.0);
vec2 rt = vec2(EPSILON, EPSILON);
vec2 ru = vec2(-EPSILON, -EPSILON);
float rv = -1.0;
float rw = 0.0;
bool aed = false;
vec2 aee = vec2(0,0);
vec2 aef = vec2(0,0);
vec2 aeg = vec2(0,0);
if (qs > EPSILON && qq > qp) {
float aej = floor(qs / PATTERN_INFO_TEXTURE_SIZE);
float aek = qs - (aej * PATTERN_INFO_TEXTURE_SIZE);
vec4 ael = texture2D(u_patternInfoTexture, vec2(aek, aej) / 255.0) * 255.0;
vec2 aem = sn(ael.z);
vec2 aen = sn(ael.w);
rv = aem.x * 2.0 + aen.x;
float aeo = 0.0;
if (aq(rv, FILTER_NEAREST)) { 
aeo = PATTERN_NEAREST_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR)) { 
aeo = PATTERN_LINEAR_TEXTURE_SIZE;
} else if (aq(rv, FILTER_LINEAR_SDF)) { 
aeo = PATTERN_LINEAR_SDF_TEXTURE_SIZE;
aed = true;
} else if (aq(rv, FILTER_MIPMAP)) { 
aeo = PATTERN_MIPMAP_TEXTURE_SIZE;
}
float aer = 1.0 / aeo;
vec2 aes = (vec2(aem.y, aen.y) * PATTERN_POSITION_UNIT_SIZE) * aer / 2.0;
aef += (ael.xy * PATTERN_POSITION_UNIT_SIZE * aer) + aes;
aes -= PATTERN_PADDING * aer * 2.0;
vec2 aet = vec2(or / 2.0, rx / 2.0) * aer;
vec2 aeu = vec2(eu, eu) * aer;
float aew = 1.0 * u_pixelRatio;
float aex = SDF_SMOOTH_FACTOR;
if (qf > EPSILON) {
if (aed) { 
if (a.qj > EPSILON) {
aex = SDF_SMOOTH_FACTOR * u_pixelRatio / SDF_GAMMA;
aee = vec2(-a.rl,-a.rk);
}
rw = aex * SDF_GAMMA / yi / u_pixelRatio;
aew = SDF_FONT_SIZE / yi;
} else { 
aew = (aes.y / aet.y) / qf;
}
}
aeg = (aet + aeu) * aew;
aes += PATTERN_PADDING * aer;
rt = aef - aes;
ru = aef + aes;
}
if (qh > EPSILON) {
yf.y = (a.rj) * yi;
aab = 0.0;
aad = 0.0;
yf.x = a.ri * yi * BYTES_TO_TEXT_OFFSET_X;
yf += vec2(1.0, 1.0);
yf = sq(yf, abh);
yf *= abi;
}
vec2 afc = vec2(cos(qg), sin(qg)) * xa;
vec2 afd = bd + afc + yf;
float afe = eu * 2.0;
float aff = or + aad * (afe + 1.0);
float afg = rx + aab * (afe + 1.0);
vec2 afh = ry * aff / 2.0;
vec2 afi = rz * afg / 2.0;
vec2 afj = sa * afg / 2.0;
float afk = (zq - zp);
float afl = ye.x / 2.0 + 0.5;
float ro = zp + afk * afl;
float rs = aao + (aap - aao) * ro / 2.0;
float afm = step(pw, FIRST_COMPLEX_SHAPE_ID - EPSILON);
float afn = afm * SIMPLE_SHAPE_SAMPLING_SIZE + (1.0 - afm) * COMPLEX_SHAPE_SAMPLING_SIZE;
float afo = afn / COMPLEX_SHAPE_SAMPLING_SIZE;
float afp = afo * SHAPE_SAMPLING_BUFFER_RATIO / 2.0;
float afq = afo * (1.0 - SHAPE_SAMPLING_BUFFER_RATIO);
vec2 afx = vec2(
mod(pw, NB_SHAPES_BY_SIDE),
floor(pw / NB_SHAPES_BY_SIDE)
);
vec2 afy = afx + vec2(afp) +
vec2(zp * afq, 0.0);
vec2 agb = vec2(afk, 1.0) * afq;
vec2 rn = (afy + agb * (ye / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE;
vec2 rr = vec2(aff / afk, afg) / 2.0;
float agh = py * yd;
float agi = pz * yd;
float rp = agh + agi;
float rq = (ro * zr) / rp;
cq = aef
+ aeg
* (ye + aee / rr * u_viewZoom);
ns.rn = rn;
float ch = float(pw == 1.);
f = vec4(
(afy + agb * (vec2(0.5,0.5) / 2.0 + 0.5)) / NB_SHAPES_BY_SIDE,
NB_SHAPES_BY_SIDE * (1. - qh) * ch,
float(ci)
);
ns.rr = rr;
ns.eu = eu;
ns.cl = cl;
ns.cm = cm;
ns.dc = dc;
ns.ro = vr(ro, zm, zo);
ns.rp = rp;
ns.py = agh;
ns.rq = rq;
ns.rs = rs;
ns.cq = cq;
ns.rt = rt;
ns.ru = ru;
ns.rv = rv;
ns.rw = rw;
ns.dh = dh;
ns.bd = afd;
ns.or = aff + ch;
ns.rx = afg + ch;
ns.ry = ry;
ns.rz = rz;
ns.sa = sa;
return true;
}
float ago(float agp, float agq, vec4 agr) {
float ags = clamp(((u_currentTime - agp) / agq), 0.0, 1.0);
float r = ags;
float agt = r * r;
float agu = agt * r;
vec4 agv = ags < 0.5 ? sv(agr) : sx(agr);
float agw = agv.x;
float agx = agv.y;
float agy = agv.z;
float agz = agv.w;
float aha = agw + agx * r + agy * agt + agz * agu;
return aha;
}
void main() {
qm a_final = wl(
a_final_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_final_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_final_x1_y1_x2_y2,
a_final_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_final_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_final_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
#if ANIMATED
float agp = a_animationBeginTime_animationDuration.x;
float agq = a_animationBeginTime_animationDuration.y;
vec4 agr = a_animationEasing;
float xx = ago(agp, agq, agr);
qm a_prev = wl(
a_prev_shapeInfo_miscInfo_opacityAndAllMinVisibleSizes_symbolicSizeAndCurvature,
a_prev_patternId_fillRGBA_strokeRGBA_patternRGBA,
a_prev_x1_y1_x2_y2,
a_prev_rectWidthOrSourceRadiusScaled_rectWidthOrSourceRadiusFixed_rectHeightOrTargetRadiusScaled_rectHeightOrTargetRadiusFixed,
a_prev_thicknessOrFontSizeScaled_thicknessOrFontSizeFixed_strokeWidthScaled_strokeWidthFixed,
a_prev_offsetScaled_offsetFixed_paddingTop_paddingLeft,
a_text_charId_charOffsetXY
);
const float ONE = 1.0;
a_final.pw = mix(a_prev.pw, a_final.pw, ONE);
a_final.py = mix(a_prev.py, a_final.py, xx);
a_final.pz = mix(a_prev.pz, a_final.pz, xx);
a_final.qa = mix(a_prev.qa, a_final.qa, ONE);
a_final.qb = mix(a_prev.qb, a_final.qb, ONE);
a_final.px = mix(a_prev.px, a_final.px, ONE);
a_final.qf = mix(a_prev.qf, a_final.qf, ONE);
a_final.qh = mix(a_prev.qh, a_final.qh, ONE);
a_final.qi = mix(a_prev.qi, a_final.qi, ONE);
a_final.qj = mix(a_prev.qj, a_final.qj, ONE);
a_final.qk = mix(a_prev.qk, a_final.qk, ONE);
a_final.qd = mix(a_prev.qd, a_final.qd, ONE);
a_final.qg = mix(a_prev.qg, a_final.qg, xx);
a_final.dc = mix(a_prev.dc, a_final.dc, xx);
a_final.qn = mix(a_prev.qn, a_final.qn, xx);
a_final.qo = mix(a_prev.qo, a_final.qo, xx);
a_final.qp = mix(a_prev.qp, a_final.qp, xx);
a_final.qq =mix(a_prev.qq, a_final.qq, xx);
a_final.qr = mix(a_prev.qr, a_final.qr, xx);
a_final.qs = mix(a_prev.qs, a_final.qs, ONE);
a_final.cl = mix(a_prev.cl, a_final.cl, xx);
a_final.cm = mix(a_prev.cm, a_final.cm, xx);
a_final.dh = mix(a_prev.dh, a_final.dh, xx);
a_final.qt = mix(a_prev.qt, a_final.qt, xx);
a_final.qu = mix(a_prev.qu, a_final.qu, xx);
a_final.qv = mix(a_prev.qv, a_final.qv, xx);
a_final.qw = mix(a_prev.qw, a_final.qw, xx);
a_final.qx = mix(a_prev.qx, a_final.qx, xx);
a_final.qy = mix(a_prev.qy, a_final.qy, xx);
a_final.qz = mix(a_prev.qz, a_final.qz, xx);
a_final.ra = mix(a_prev.ra, a_final.ra, xx);
a_final.rb = mix(a_prev.rb, a_final.rb, xx);
a_final.rc = mix(a_prev.rc, a_final.rc, xx);
a_final.rd = mix(a_prev.rd, a_final.rd, xx);
a_final.re = mix(a_prev.re, a_final.re, xx);
a_final.rf = mix(a_prev.rf, a_final.rf, xx);
a_final.rg = mix(a_prev.rg, a_final.rg, xx);
a_final.rh = mix(a_prev.rh, a_final.rh, ONE);
a_final.ri = mix(a_prev.ri, a_final.ri, ONE);
a_final.rj = mix(a_prev.rj, a_final.rj, ONE);
#endif
rm ns;
bool ahe = xy(a_final, ns);
if (!ahe) {
uy();
return;
}
vec2 ye = a_vertexInfo.xy;
a = ns.cl;
b = ns.cm;
c = ns.dh;
d = ns.rn;
e = ns.cq;
#if D3D9_FIX
#else
l = ns.eu;
m = ns.rt;
n = ns.ru;
o = vec2(ns.dc, ns.rs);
p = ns.ro;
q = ns.rp;
r = vec2(ns.py, ns.rq);
s = ns.rr;
t = ns.rw;
u = ns.rv;
#endif
float ahh = step(ye.x, 0.0);
float ahi = 1.0 - ahh;
g = min(ns.rx, ROUNDED_BOX_RADIUS * 2.) * u_pixelRatio;
vec2 va = ns.bd
+ ns.ry * (ns.or / 2.0) * ye.x
+ (ahh * ns.rz + ahi * ns.sa) * ns.rx / 2.0 * ye.y;
c = c * (1. - f.w)
+ vec4(
ye.x * ns.or,
ye.y * ns.rx,
ns.or,
ns.rx
) * u_pixelRatio * f.w;
gl_Position = uz(va);
}
`,Cr=1e20,n1=class{constructor({fontSize:t=24,buffer:e=8,radius:s=6,cutoff:i=.25}={}){this._maxDimension=1,this._gridSize=1,this._fontSize=t,this._buffer=e,this._radius=s,this._cutoff=i,this._height=Math.ceil(this._fontSize+2*this._buffer*Na),this._canvas=Je(),this._canvas.height=this._height,this._canvas.width=1;const n=this._canvas.getContext("2d",{willReadFrequently:!0});this._ctx=n,n.textBaseline="middle",n.textAlign="center",n.fillStyle="black"}setOptions({fontSize:t=24,buffer:e=8,cutoff:s=.25,radius:i=6}){this._fontSize=t,this._buffer=e,this._cutoff=s,this._radius=i,this._height=Math.ceil(this._fontSize+2*this._buffer*Na)}draw(t,e,s){Fi(this._ctx,e,this._fontSize,s);const i=r1(this._ctx.measureText(t).width+2*this._buffer)-2*Ri,n=this._height,r=i*n,o=Math.max(i,n);this._canvas.width<i&&(this._canvas.width=i,Fi(this._ctx,e,this._fontSize,s),this._ctx.textAlign="center",this._ctx.textBaseline="middle",this._ctx.fillStyle="black"),r>this._gridSize&&(this._gridOuter=new Float64Array(r),this._gridInner=new Float64Array(r),this._gridSize=r),o>this._maxDimension&&(this._f=new Float64Array(o),this._d=new Float64Array(o),this._z=new Float64Array(o+1),this._v=new Int16Array(o),this._maxDimension=o),this._ctx.clearRect(0,0,i,n),this._ctx.fillText(t,i/2,n/2);const a=this._ctx.getImageData(0,0,i,n),l=new Uint8ClampedArray(r);for(let d=0;d<r;d++){const h=a.data[4*d+3]/255;this._gridOuter[d]=h===1?0:h===0?Cr:Math.pow(Math.max(0,.5-h),2),this._gridInner[d]=h===1?Cr:h===0?0:Math.pow(Math.max(0,h-.5),2)}ag(this._gridOuter,i,n,this._f,this._d,this._v,this._z),ag(this._gridInner,i,n,this._f,this._d,this._v,this._z);for(let d=0;d<r;d++){const h=this._gridOuter[d]-this._gridInner[d];l[d]=Math.max(0,Math.min(255,Math.round(255-255*(h/this._radius+this._cutoff))))}return{height:n,width:i,distance:l}}};function ag(t,e,s,i,n,r,o){for(let a=0;a<e;a++){for(let l=0;l<s;l++)i[l]=t[l*e+a];lg(i,n,r,o,s);for(let l=0;l<s;l++)t[l*e+a]=n[l]}for(let a=0;a<s;a++){for(let l=0;l<e;l++)i[l]=t[a*e+l];lg(i,n,r,o,e);for(let l=0;l<e;l++)t[a*e+l]=Math.sqrt(n[l])}}function lg(t,e,s,i,n){s[0]=0,i[0]=-Cr,i[1]=+Cr;for(let r=1,o=0;r<n;r++){let a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);for(;a<=i[o];)o--,a=(t[r]+r*r-(t[s[o]]+s[o]*s[o]))/(2*r-2*s[o]);o++,s[o]=r,i[o]=a,i[o+1]=+Cr}for(let r=0,o=0;r<n;r++){for(;i[o+1]<r;)o++;e[r]=(r-s[o])*(r-s[o])+t[s[o]]}}function r1(t){return Math.ceil((t+2*Ri)/ns)*ns}var Po=256,o1=.275,a1=.25,l1=6,d1=KE-2*Ri,h1=ZE-2*Ri,dg={fontSize:Hr,cutoff:o1,radius:l1},u1={fontSize:Hr,cutoff:a1,radius:8},c1=class{constructor(t,e){this._patternIdToInfoTexture=new Uint8Array(Po*Po*4),this._glTextures=[],this._textureSizes=[],this._pixelRatio=1,this._gl=t,this._glUnit=e;const s=Je(Ps,Ps),i=s.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("Pattern: could not get 2d context");this._imageCanvasContext=i,this._imageCanvas=s,this._canvasForDuplicatedImage,this._sdfGenerator=new n1(dg),this._maxTextureSize=Math.min(4096,t.getParameter(t.MAX_TEXTURE_SIZE))}refresh(t){this._pixelRatio=t.getPixelRatio();const e=this._gl,s=this._getPatternsByFilter(t.getPatternList());for(let r=0;r<s.length;++r){const o=r,a=s[r],l=BS(a,this._maxTextureSize),{texture:d,size:h}=Pp(o,a,l,this._maxTextureSize,this._patternIdToInfoTexture),u=this._glTextures[o]||(this._glTextures[o]=e.createTexture()),c=o===Dn?gu:jd;sg(e,u,this._glUnit+1+o,d,h,o,c),this._textureSizes[o]=h}const i=this._glTextureInfo||(this._glTextureInfo=e.createTexture()),n=this._patternIdToInfoTexture;sg(e,i,this._glUnit,n,Po,Dn,jd)}bindMetaDataTexture(){const t=this._gl;t.activeTexture(t.TEXTURE0+this._glUnit),t.bindTexture(t.TEXTURE_2D,this._glTextureInfo)}getInfoTextureUnit(){return this._glUnit}getNearestTextureUnit(){return this._glUnit+1+Dn}getLinearTextureUnit(){return this._glUnit+1+Lr}getLinearSdfTextureUnit(){return this._glUnit+1+Ir}getMipmapTextureUnit(){return this._glUnit+1+Hi}getInfoTextureSize(){return Po}getNearestTextureSize(){return this._textureSizes[Dn]}getLinearTextureSize(){return this._textureSizes[Lr]}getLinearSdfTextureSize(){return this._textureSizes[Ir]}getMipmapTextureSize(){return this._textureSizes[Hi]}_getPatternsByFilter(t){const e=new Array(Jc);for(let s=0;s<Jc;++s)e[s]=[];for(let s=0;s<t.length;++s){const i=this._getPatternPixels(t[s]);e[i.filter].push(i)}return e}_getPatternPixels({id:t,type:e,attributes:s}){let i;const{text:n,font:r,style:o,image:a,scaled:l,duplicated:d,colorArray:h}=s;switch(e){case Ni:i=d?this._getDuplicatedImagePixels(a):l?this._getScaledImagePixels(a):this._getNonScaledImagePixels(a);break;case Yi:i=this._getSdfTextPixels(n,r,o);break;case Ji:i=this._getIconPixels(n,r,o);break;case tn:i=this._getBadgeIconPixels(n,r,o);break;case oo:i=this._getPieChartPixels(h);break;default:throw new Error(`pattern type "${e}" does not exist`)}return i.id=t,i}_getScaledImagePixels(t){let e=t.width,s=t.height;if(e>0){const i=Ps/Math.max(t.width,t.height);e*=i,s*=i}return e&&s&&(e=Xn(e),s=Xn(s)),e-=2*Ri,s-=2*Ri,this._getImagePixels(t,e,s)}_getNonScaledImagePixels(t){return this._getImagePixels(t,t.width,t.height)}_getDuplicatedImagePixels(t){if(t.width===0||t.height===0)return this._getImagePixels(t,0,0);this._canvasForDuplicatedImage||(this._canvasForDuplicatedImage=Je(Ps,Ps));const e=this._canvasForDuplicatedImage,s=e.getContext("2d"),i=t.width,n=t.height;let r=(Ps-i)/2,o=(Ps-n)/2;for(;r>0;)r-=i;for(;o>0;)o-=n;for(let a=r;a<Ps;a+=i)for(let l=o;l<Ps;l+=n)s.drawImage(t,a,l);return this._getImagePixels(e,Ps,Ps)}_getImagePixels(t,e,s){let i;if(e===0||s===0)i=new Uint8Array(0);else{(this._imageCanvas.width<e||this._imageCanvas.height<s)&&(this._imageCanvas.width=e,this._imageCanvas.height=s);const n=this._imageCanvasContext;Ad(this._imageCanvas,n,e,s);try{n.drawImage(t,0,0,e,s)}catch{}i=n.getImageData(0,0,e,s).data}return{width:e,height:s,pixels:i,filter:Hi}}_getPieChartPixels(t){const e=h1,s=this._imageCanvasContext,i=e/2,n=e/2;return Ad(this._imageCanvas,s,e,e),s.save(),s.rect(0,0,e,e),s.clip(),kp(s,t,i,n,e),s.restore(),{width:e,height:e,pixels:s.getImageData(0,0,e,e).data,filter:Lr}}_getTextPixels(t,e,s,i,n,r){const o=this._imageCanvasContext,a=n*this._pixelRatio;Fi(o,s,a,i);let l=Math.ceil(o.measureText(e).width);l===0&&(l=a);let d=0,h=0;t===Hi||(d=2*Math.ceil(a*Na/2),h=2*Math.ceil(l*dp/2));const u=Math.ceil(l+h),c=Math.ceil(a+d),g=this._imageCanvas.height<c||this._imageCanvas.width<u;return this._imageCanvas.height<c&&(this._imageCanvas.height=c),this._imageCanvas.width<u&&(this._imageCanvas.width=u),g&&Fi(o,s,a,i),o.clearRect(0,0,u,c),o.fillStyle="black",o.textBaseline="middle",o.textAlign="left",o.fillText(e,r+h/2,c/2),{width:u,height:c,pixels:o.getImageData(0,0,u,c).data,filter:t}}_getIconPixels(t,e,s){return this._getTextPixels(Hi,t,e,s,d1,0)}_getBadgeIconPixels(t,e,s){return this._sdfGenerator.setOptions(u1),this._getSdfPixels(t,e,s)}_getSdfTextPixels(t,e,s){return this._sdfGenerator.setOptions(dg),this._getSdfPixels(t,e,s)}_getSdfPixels(t,e,s){const{width:i,height:n,distance:r}=this._sdfGenerator.draw(t,e,s),o=new Uint8Array(i*n*4);for(let a=0;a<r.length;++a)o[4*a+3]=r[a];return{width:i,height:n,pixels:o,filter:Ir}}},g1=class{constructor(t,e){this._gl=t,this._glTextureUnit=e,this._simpleShapePixels=new Uint8Array(ca*ca*4),this._complexShapePixels=new Uint8Array(Ei*Ei*4),this._shapesWritten=[]}refresh(t){const e=t.getShapeList();for(const s of e)if(!this._shapesWritten.includes(s.id)){const i=s.isSimple?ca:Ei,n=s.isSimple?this._simpleShapePixels:this._complexShapePixels;US(s,i,Bd,n),this._loadShapeInGpu(s.id,i,n),this._shapesWritten.push(s.id)}}_loadShapeInGpu(t,e,s){const i=this._gl,n=Gd,r=t%Ud*Ei,o=Math.floor(t/Ud)*Ei;if(this._texture)i.bindTexture(i.TEXTURE_2D,this._texture);else{const a=new Uint8Array(n*n*4);this._texture=i.createTexture(),i.activeTexture(i.TEXTURE0+this._glTextureUnit),i.bindTexture(i.TEXTURE_2D,this._texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,n,0,i.RGBA,i.UNSIGNED_BYTE,a)}i.texSubImage2D(i.TEXTURE_2D,0,r,o,e,e,i.RGBA,i.UNSIGNED_BYTE,s)}getTextureSize(){return Gd}getSamplingSize(){return Ei}getBufferRatio(){return Bd}getTextureUnit(){return this._glTextureUnit}},hg=class{constructor(t,{vertex:e,fragment:s,constants:i,macros:n}){this._state=0,this._gl=t,this._vertexSource=e,this._fragmentSource=s,this._constants=Ie(i||{}),this._macros=Ie(n||{})}setConstant(t,e){this._constants[t]=e}setMacro(t,e){this._macros[t]=e}getState(){return this._state}getProgram(){return this._program}compile(){const t=this._gl,e=ug(this._vertexSource,this._macros,this._constants),s=ug(this._fragmentSource,this._macros,this._constants);this._program&&(t.deleteProgram(this._program),t.deleteShader(this._vertexShader),t.deleteShader(this._fragmentShader));const i=t.createProgram(),n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);if(!(i&&n&&r))throw new Error("Error instantiating WebGL program");this._program=i,this._vertexShader=n,this._fragmentShader=r,t.shaderSource(this._vertexShader,e),t.compileShader(this._vertexShader),t.attachShader(this._program,this._vertexShader),t.shaderSource(this._fragmentShader,s),t.compileShader(this._fragmentShader),t.attachShader(this._program,this._fragmentShader),t.linkProgram(this._program),this._state=1}getError(){const t=this._gl;return t.getShaderParameter(this._vertexShader,t.COMPILE_STATUS)?t.getShaderParameter(this._fragmentShader,t.COMPILE_STATUS)?t.getProgramParameter(this._program,t.LINK_STATUS)?(this._state=2,null):{step:"link",message:t.getProgramInfoLog(this._program)||""}:{step:"fragment",message:t.getShaderInfoLog(this._fragmentShader)||""}:{step:"vertex",message:t.getShaderInfoLog(this._vertexShader)||""}}};function ug(t,e,s){const i=Object.keys(e),n=Object.keys(s);for(let r=0;r<i.length;++r){const o=i[r],a=e[o];t=t.replace(`#define ${o} 0`,`#define ${o} ${a}`)}for(let r=0;r<n.length;++r){const o=n[r],a=s[o],l=a+(a%1==0?".0":"");t=t.replace(`const float ${o} = 0.0;`,`const float ${o} = ${l};`)}return t}function _1(){return typeof window<"u"&&!!window.FORCE_WEBGL}/** @preserve instance id */var cg=Fm(),m1={stencil:!0,antialias:!1,alpha:!0,premultipliedAlpha:!0,failIfMajorPerformanceCaveat:!_1()},f1=0,p1=1,y1={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'},Op=class extends Error{};function jl(t,e){if(!t&&e){const s=new Op(y1[e]);throw s.code=e,s}}var zp=class extends cu{constructor(t){super(t),this._2dcanvas=Je(),this._ctx=this._2dcanvas.getContext("2d"),this._bufferDrawers=[],this._mustResize=!1,this._error=null,this._onContextLost=a=>{a.preventDefault(),this._error=new Op("WebGL context lost"),this.fire("error",this._error)};const e=t.initData||zp.createInitData(),{canvas:s,gl:i,ext:n,staticProgramWrapper:r,animationProgramWrapper:o}=e;jl(i,"NO_WEBGL"),jl(n,"NO_ANGLE_INSTANCED_ARRAYS"),this._glCanvas=s,this._gl=i,this._ext=n,this._staticProgramWrapper=r,this._animationProgramWrapper=o,this._shapeTexture=new g1(this._gl,f1),this._patternTexture=new c1(this._gl,p1),this._initCanvas(this._glCanvas),this._computeShaderInfo(),this._initSpecialGlBuffers(),this._initGlPrograms(),this._initGl()}_initCanvas(t){super._initCanvas(t),t.addEventListener("webglcontextlost",this._onContextLost,!1)}static isAvailable(){return cg||jl(null,"NO_WEBGL"),cg}static createInitData(){const t=Je(),e=kh(t,m1,"webgl"),s=e&&typeof e.getExtension=="function"?e.getExtension("ANGLE_instanced_arrays"):null,i=v1(),n=new hg(e,{vertex:Vl,fragment:Gl,constants:i,macros:{ANIMATED:0}}),r=new hg(e,{vertex:Vl,fragment:Gl,constants:i,macros:{ANIMATED:1}});return e&&s&&(n.compile(),e.flush()),{canvas:t,gl:e,ext:s,staticProgramWrapper:n,animationProgramWrapper:r}}static getName(){return"WebGL"}_afterFirstFrame(){this._animationProgramWrapper.getState()===0&&this._animationProgramWrapper.compile()}ensureAnimationsReady(){const t=this._animationProgramWrapper.getState();t!==2&&(t===0&&this._animationProgramWrapper.compile(),this._animationProgramWrapper.getError())}getDomElement(){return this._glCanvas}_initGl(){const t=this._gl;t.clearColor(0,0,0,0),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}_computeShaderInfo(){this._shaderMetadata=x1(Vl,Gl)}_initGlPrograms(){this._staticProgram=new og({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._staticProgramWrapper}),this._animationProgram=new og({gl:this._gl,ext:this._ext,specialGlBuffers:this._specialGlBuffers,metaData:this._shaderMetadata,programWrapper:this._animationProgramWrapper})}_initSpecialGlBuffers(){const t=this._gl,e=t.createBuffer(),s=new Int8Array(18*hs);for(let i=0;i<hs;++i){const n=[-1,-1,i,1,-1,i,1,1,i,-1,-1,i,-1,1,i,1,1,i],r=i*n.length;for(let o=0;o<n.length;o++)s[o+r]=n[o]}t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),this._specialGlBuffers={vertexInfo:e}}_computeUniforms(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternLinearSdfTexture:this._patternTexture.getLinearSdfTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._scales.bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._scales.bytesToActualScaledSize,BYTES_TO_MIN_VISIBLE_SIZE:this._scales.bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._scales.bytesToActualSymbolicSize,BYTES_TO_DASH_LENGTH:this._scales.bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._scales.bytesToActualGapLength,BYTES_TO_PATTERN_SCALE:this._scales.bytesToActualPatternScale,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_LINEAR_SDF_TEXTURE_SIZE:this._patternTexture.getLinearSdfTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_UNIT_SIZE:ns,ROUNDED_BOX_RADIUS:this._textManager.getCornerRadius(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}}_render({shapesChanged:t,patternsChanged:e,dimensionsChanged:s,backgroundColorChanged:i}){const n=this._gl;if(this._error)throw this._error;if(t&&(this._shapeTexture.refresh(this._shapeManager),this._patternTexture.bindMetaDataTexture()),e&&this._patternTexture.refresh(this._patternManager),s&&(this._mustResize=!0),i){const[a,l,d,h]=this._renderBackground?this._backgroundRgba:[0,0,0,0];n.clearColor(a*h,l*h,d*h,h)}const r=this._computeUniforms(),o=this._getSortedBufferList();this._mustResize&&o.length&&(ba(this._glCanvas,this._width,this._height,this._pixelRatio),n.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio),this._mustResize=!1),n.clear(n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT);for(let a=0;a<o.length;++a)this._displayBuffer(o[a],r);this._endFrame()}_displayBuffer(t,e){const s=t.getProgram();s!==this._currentProgram&&(this._currentProgram&&this._currentProgram.endPass(),this._currentProgram=s,this._currentProgram.startPass(e)),t.markAsUsed(),t.draw()}_getSortedBufferList(){const t=this._bufferList.getBuffersByAscendingDepth(),e=[];for(let s=0;s<this._bufferDrawers.length;++s){const i=this._bufferDrawers[s];i&&i.markAsUnused()}for(let s=0;s<t.length;++s){const i=t[s],n=this._getBufferDrawer(i);n.markAsUsed(),!i.isEmpty()&&this._isBufferDisplayable(i)&&e.push(n)}for(let s=0;s<this._bufferDrawers.length;++s){const i=this._bufferDrawers[s];i&&!i.isUsed()&&(i.destroy(),this._bufferDrawers[s]=void 0)}return e}_endFrame(){this._currentProgram&&(this._currentProgram.endPass(),this._currentProgram=null)}_getBufferDrawer(t){const e=t.getId();let s=this._bufferDrawers[e];if(!s){for(;this._bufferDrawers.length<=e;)this._bufferDrawers.push(void 0);s=new KS({gl:this._gl,ext:this._ext,staticProgram:this._staticProgram,animationProgram:this._animationProgram}),this._bufferDrawers[e]=s}return s.setDataBuffer(t),s}destroy(){this._glCanvas&&this._glCanvas.removeEventListener("webglcontextlost",this._onContextLost);const t=this._gl.getExtension("WEBGL_lose_context");t&&t.loseContext()}getImageData(){const t=this._glCanvas.width,e=this._glCanvas.height;return(this._2dcanvas.width<t||this._2dcanvas.height<e)&&(this._2dcanvas.width=t,this._2dcanvas.height=e),this._ctx.clearRect(0,0,t,e),this._ctx.drawImage(this._glCanvas,0,0),this._ctx.getImageData(0,0,t,e)}_getImageDataFlippedYAxis(){const t=this._gl,e=this._glCanvas.width,s=this._glCanvas.height,i=this._ctx.createImageData(e,s),n=new Uint8Array(i.data.buffer);return t.readPixels(0,0,e,s,t.RGBA,t.UNSIGNED_BYTE,n),i}};function x1(t,e){const s={vertexInfoAttribute:"a_vertexInfo",attributes:[],uniforms:[]};return gg(s,t),gg(s,e),s}var b1={float:1,vec2:2,vec3:3,vec4:4};function gg(t,e){const s=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g,i=/uniform\s+(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g,n=[];let r=s.exec(e);for(;r;){const o=r[0];o==="#endif"?n.pop():o.startsWith("#if")?n.push(r[4]):t.attributes.push({name:r[3],size:b1[r[2]],type:r[1],tags:n.slice(),location:null,byteSize:0,glType:null}),r=s.exec(e)}for(r=i.exec(e);r;){if(!t.uniforms.some(({id:o})=>o===r[1])){const o=r[1],a=r[2],l=a.replace("u_","");t.uniforms.push({id:l,name:a,type:o})}r=i.exec(e)}}function v1(){return{BYTES_TO_OFFSET_ANGLE:2*Math.PI/8,BYTES_TO_COLOR:1/15,SDF_FONT_SIZE:Hr,CURVATURE_RATIO:hl,PATTERN_PADDING:Ri,TEXT_WIDTH_MULTIPLIER:dp,TEXT_HEIGHT_MULTIPLIER:Na,SELF_LOOP_CURVATURE_RATIO:Fa,EDGE_ARROW_SIZE_RATIO:hp,CURVE_SUBDIVISIONS:hs,PIECE_NODE_COMPONENT:Ns,PIECE_TEXT_BOX:Rn,PIECE_EDGE_BODY:dl,PIECE_EDGE_HEAD:Kh,PIECE_EDGE_TAIL:Qh,PIECE_EDGE_TEXT:Cn,MAX_TEXT_SIZE:CS,BYTES_TO_TEXT_OFFSET_X:1/Np,BYTES_TO_TEXT_OFFSET_Y:1/Vd,FILTER_NEAREST:Dn,FILTER_LINEAR:Lr,FILTER_LINEAR_SDF:Ir,FILTER_MIPMAP:Hi,SHAPE_TEXTURE_SIZE:Gd,SIMPLE_SHAPE_SAMPLING_SIZE:ca,COMPLEX_SHAPE_SAMPLING_SIZE:Ei,SHAPE_SAMPLING_BUFFER_RATIO:Bd,MAX_SHAPES:Ma.toString(),FIRST_COMPLEX_SHAPE_ID:zd,SELF_LOOP_TO_CIRCLE_APPROX:up,SDF_GAMMA:tA}}var E1={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,isBufferDisplayable:Qa,hideImages:!1,renderBackground:!1},Do={webgl:zp,canvas:jS,svg:YS},_g=[0,0,0,0],ql={webgl:null,svg:null,canvas:null},Mr=class extends io{constructor(t){super(),this._view=Ie(E1),this._domWrapper=di?document.createElement("div"):xa(),this._domElement=this._domWrapper.appendChild(di?document.createElement("div"):xa()),this._currentElementSize=0,this._currentBlockOffset=0,this._currentByteOffset=0,this._blockIdToAddress=new Uint32Array(0),this._renderersByType={},this._switchMainRenderer=!0,this._refreshTexts=!1,this._backgroundColor=null,this._initData=t||{},this._patternManager=new SS,this._shapeManager=new wS,this._boundariesManager=new bS,this._textManager=new MS(this._patternManager),this._bufferOffsetToId=new Gm,this._memoryManager=new vS(this._patternManager,this._shapeManager,this._textManager,this._bufferOffsetToId,e=>this.parseColor(e)||_g),this._bufferList=new mS}static createInitData(){const t={};for(const e in Do)t[e]=Do[e].createInitData();return t}static cacheInitData(t){ql=t}static getCachedInitData(){return ql}static clearCachedInitData(){ql={webgl:null,svg:null,canvas:null}}freeBlock(t){this._checkBlockId(t);const e=this._blockIdToAddress[t],s=this._bufferList.freeBlock(e);return this._blockIdToAddress[t]=s,s}_ensureDomElementsFitParent(){const t=this._domElement.parentNode;!t||t.offsetWidth===this._view.width&&t.offsetHeight===this._view.height||ln(t,`${this._view.width}px`,`${this._view.height}px`)}_ensureCorrectBackgroundColor(){const t=this._domElement.parentNode;this._backgroundColor!==this._view.backgroundColor&&t&&(t.style.backgroundColor=this._view.backgroundColor||"",this._backgroundColor=this._view.backgroundColor)}createGroup(){return new xS}parseColor(t){return os(t)}clear(){this._blockIdToAddress.fill(0),this._patternManager.reset(),this._boundariesManager.reset(),this._textManager.reset(),this._bufferList.reset(),this._bufferOffsetToId.reset()}notifyFontsReloaded(){this._patternManager.notifyUpdate(),this._textManager.clear(),this._refreshTexts=!0}notifyPatternUpdate(){this._patternManager.notifyUpdate()}getShapePoints(t){return this._shapeManager.getDefinitionFromName(t).points}checkShapeHit(t,e,s){const{getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:n}=this._shapeManager.getDefinitionFromName(t);return Math.min(i(e,s),n(e,s))>=0}setGlobalBoundaries(t){const{maxBlockId:e=0,maxScaledSize:s,maxMinVisibleSize:i,maxSymbolicSize:n,maxDashLength:r,maxGapLength:o,maxPatternScale:a}=t;return e>this._blockIdToAddress.length&&this._resizeBlockArray(e),!!this._boundariesManager.set(t)&&(this._memoryManager.resizeBoundaries(s,i,n,r,o,a),!0)}_resizeBlockArray(t){const e=new Uint32Array(t);e.set(this._blockIdToAddress),this._blockIdToAddress=e}registerShape(t,e){this._shapeManager.register(t,e)}_bindBlock(t,e,s,i,n,r,o){this._checkBlockId(t);const a=this._blockIdToAddress[t],l=this._bufferList.allocateBlock(a,e,s,i,n,r,o);return this._blockIdToAddress[t]=l.address,this._currentDataView=l.buffer.getDataView(),this._currentElementSize=l.buffer.elementSize,this._currentBlockOffset=l.offset,this._currentByteOffset=this._currentBlockOffset*this._currentElementSize,this._currentSideDataView=l.buffer.getSideDataView(),this._currentSideElementSize=l.buffer.getTotalSideElementsSize(),this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize,l}_setItemIndex(t){const e=this._currentBlockOffset+t;this._currentByteOffset=e*this._currentElementSize,this._currentSideByteOffset=e*this._currentSideElementSize}_checkBlockId(t){t>=this._blockIdToAddress.length&&this._resizeBlockArray(Si(t+1))}_setTextCharacters(t){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,t)}_storeElement(t,e){this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset,t.end),e&&(this._memoryManager.storeGenericObject(this._currentDataView,this._currentByteOffset+qn,t.start),this._memoryManager.storeAnimationInformation(this._currentDataView,this._currentByteOffset+2*qn,t.animation,hu.getCoefficients(t.animation.easing)))}storeGroup(t,e){if(!e||e.size===0)return this.freeBlock(t);const s=e.type,i=e.depth,n=e.size,r=e.getElements(),o=e.animated,a=e.stencilUsage,l=e.getId();let d=0;if(s===Qi)for(let u=0;u<n;++u){const c=r[u],{start:g,end:_}=c;if(_.pattern.type===ki){const m=_.pattern.attributes.text;d=Math.max(d,m.length)}if(o&&g.pattern.type===ki){const m=g.pattern.attributes.text;d=Math.max(d,m.length)}}const h=this._bindBlock(t,s,o,i,n,d,a);for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._storeElement(c,o),this._bufferOffsetToId.set(h.buffer.getId(),h.offset+u,l)}if(s===Qi)for(let u=0;u<n;++u){const c=r[u];this._setItemIndex(u),this._setTextCharacters(c.end.pattern)}return h.address}_refreshTextElements(){const t=this._bufferList.getBuffers();for(const e of t)if(e&&e.type===Qi){const s=e.getSideDataView(),i=e.getTotalSideElementsSize(),n=e.getSize();let r=0,o=i;for(let a=0;a<n;++a){const l=this._textManager.extractTextFromDataView(s,r,o);this._textManager.storeTextInDataView(s,r,o,l),r=o,o+=i}e.triggerUpdate()}}extractElement(t,e=0){if(!t)return null;const s=this._bufferList.getBlockInfo(t);return this._renderer.extractElement(s.buffer,s.offset+e)}getDomElement(){return this._domElement}getDomWrapper(){return this._domWrapper}measureText(t,e,s,i=1){return this._textManager.measureText(t,e,s,i)}setRenderType(t){this._renderType!==t&&(this._renderType=t,this._switchMainRenderer=!0)}_ensureMainRendererReady(){if(this._switchMainRenderer){this._renderType===null&&(this._renderType="canvas");const t=Do[this._renderType];t&&t.isAvailable()||(this._renderType="canvas"),this._renderer=this._renderersByType[this._renderType],this._renderer||(this._renderer=this._instanciateRenderer(this._renderType),this._renderer.on("error",e=>this.fire("error",e)),this._renderersByType[this._renderType]=this._renderer),this._updateDomElement()}}_updateDomElement(){const t=this._renderer&&this._renderer.getDomElement(),e=this._domElement;for(;e&&e.firstChild;)e.removeChild(e.firstChild);t&&this._appendDomChild(t)}_appendDomChild(t){t.style.position="absolute",t.style.left="0",t.style.top="0",this._domElement.appendChild(t)}_instanciateRenderer(t){return new(t===null?cu:Do[t])({initData:t===null?null:this._initData[t],bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,memoryManager:this._memoryManager})}setView(t){this._view=ct(ct({},this._view),t)}getTextManager(){return this._textManager}_updateManagers(){this._patternManager.setPixelRatio(this._view.pixelRatio),this._shapeManager.update(),this._patternManager.update(),this._textManager.update(),this._boundariesManager.update(),this._bufferList.update(),this._refreshTexts&&(this._refreshTexts=!1,this._refreshTextElements())}_resizeCanvas(t){Mp(t,this._view.width,this._view.height,this._view.pixelRatio)}render(){this._ensureMainRendererReady(),this._ensureDomElementsFitParent(),this._ensureCorrectBackgroundColor(),this._updateManagers(),this._renderer.renderFrame(this._view)}ensureAnimationsReady(){this._ensureMainRendererReady(),this._renderer.ensureAnimationsReady()}export(t,e,s){const i=this._instanciateRenderer(t),n=ct(ct({},this._view),e);return"setViewportClipping"in i&&i.setViewportClipping(!1),this._updateManagers(),i.renderFrame(n),i.export(s).then(()=>i.getDomElement())}getCurrentTime(){return rs()}getImageData(){return this._renderer&&this._renderer.getImageData()}destroy(){for(const t of Object.keys(this._renderersByType)){const e=this._renderersByType[t];e&&e.destroy()}}transparentify(t){const e=this.parseColor(t)||_g;return`rgba(${Math.round(255*e[0])},${Math.round(255*e[1])},${Math.round(255*e[2])},0)`}initDebugRenderingLoop({triggerKey:t="r",start:e=!0}={}){let s=e;document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s)});const i=n=>{(s||n)&&(this.setView({currentTime:rs()}),this.render()),window.requestAnimationFrame(()=>{i()})};window.requestAnimationFrame(()=>{document.body.appendChild(this.getDomElement()),i(!0)})}},A1=class{constructor(t,e){this._attributesManager=t,this._id=e}getDefinition(){return this._attributesManager.getAttributeLayerDefinition(this._id)}update(t){this._attributesManager.updateAttributeLayer(this._id,t)}destroy(){this._attributesManager.destroyAttributeLayer(this._id)}updateElements(t){this._attributesManager.updateElementsForAttributeLayer(this._id,t)}updateAll(){this._attributesManager.updateAllForAttributeLayer(this._id)}setAttributeValues(t,e,s){this._attributesManager.setAttributeLayerValues(this._id,t,e,s)}getUsedAttributeNames(t){return this._attributesManager.getUsedAttributeLayerAttributes(this._id,t)}getFlexArrays(){return this._attributesManager.getAttributeLayerFlexArrays(this._id)}},S1={name:"animationStart",storage:32,default:0},w1={name:"animationDuration",storage:16,default:0},T1={name:"animationEasing",storage:"resource",default:"linear"},L1={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentNodes:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},adjacentEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},I1={self:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},extremities:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},parallelEdges:{attributes:"all",tags:[],selection:!0,hover:!1,data:!0},allNodes:void 0,allEdges:void 0},C1={x:1,y:1,radius:1,"halo.hideNonAdjacentEdges":1},us="Arial",Oi="black",Da="rgba(255,255,255,0)",Wn=12,Yr=3,_u=7,M1=!0,mu=10,N1=5,Bp=.08,Up="rgba(255,255,255,0)",Gp="normal",Vp="center",jp=!1,qp=0,qd="red",Hp="rgb(220, 220, 220)",Xp="red",Wp="rgb(220, 220, 220)",Hd=1,$p="scaled",Yp="grey",Zp=1,Kp=0,Qp=0,Jp=!0,ty=0,ey=!0,sy="line",iy=null,ny=null,ry="plain",oy="inherit",Xd=0,ay="fixed",ly=0,dy=null,Wd=10,hy="fixed",uy=1e3,cy=800,gy="rgba(0, 0, 0, 0.6)",_y="rgba(0, 0, 0, 0)",my=10,fy=1,py=2,yy="rgba(0, 0, 0, 0.36)",xy=0,F1=1,by="normal",vy="center",Ey=2,$d=2,Ay=ao,Sy=4,wy=!0,Ty=4,Yd=2,Zd=12,Ly=2;function P1(t,e,s){let i,n,r,o;s==="line"?(i="line",n="plain",r=null,o=null):s==="arrow"?(i="line",n="plain",r="arrow",o=null):s==="tapered"?(i="triangle",n="plain",r=null,o=null):s==="dashed"?(i="line",n="dashed",r=null,o=null):s==="dotted"&&(i="line",n="dotted",r=null,o=null),t.shape.body.set(e,i),t.shape.style.set(e,n),t.shape.head.set(e,r),t.shape.tail.set(e,o)}var Iy={width:{_flexArray:Hd,_check:he(Hd)},scalingMethod:{_flexArray:$p,_check:Li},color:{_flexArray:Yp,_check:rA},opacity:{_flexArray:Zp,_check:Se},minVisibleSize:{_flexArray:Kp,_check:Se},layer:{_flexArray:Qp,_check:_p},detectable:{_flexArray:Jp,_check:Ke},curvature:{_flexArray:ty,_check:en},adjustAnchors:{_flexArray:ey,_check:Ke},shape:{_check:aA,_set:P1,type:"shape.head",body:{_flexArray:sy,_check:lA},head:{_flexArray:iy,_check:Fc},tail:{_flexArray:ny,_check:Fc},style:{_flexArray:ry,_check:dA}},stroke:{color:{_flexArray:oy,_check:is},width:{_flexArray:Xd,_check:he(Xd)},scalingMethod:{_flexArray:ay,_check:Li},minVisibleSize:{_flexArray:ly,_check:Se}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:dy,_check:Ii},width:{_flexArray:Wd,_check:he(Wd)},scalingMethod:{_flexArray:hy,_check:Li},size:"halo.width"},pulse:{enabled:{_flexArray:!1,_check:Ke},duration:{_flexArray:uy,_check:Se},interval:{_flexArray:cy,_check:Se},startColor:{_flexArray:gy,_check:is},endColor:{_flexArray:_y,_check:is},width:{_flexArray:my,_check:Se},startRatio:{_flexArray:fy,_check:Se},endRatio:{_flexArray:py,_check:Se}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:Ke},color:{_flexArray:yy,_check:Ii},minVisibleSize:{_flexArray:xy,_check:Se}},text:{_alias:"text.content",content:{_flexArray:null,_check:ni},font:{_flexArray:us,_check:zn},color:{_flexArray:Oi,_check:Ii},size:{_flexArray:Wn,_check:he(Wn)},scale:{_flexArray:1,_check:Se},style:{_flexArray:by,_check:Bn},align:{_flexArray:vy,_check:Pa},margin:{_flexArray:Ey,_check:en},padding:{_flexArray:$d,_check:he($d)},backgroundColor:{_flexArray:Da,_check:is},minVisibleSize:{_flexArray:Sy,_check:Se},position:{_flexArray:Ay,_check:nA},adjustAngle:{_flexArray:wy,_check:Ke},scaling:{_flexArray:jp,_check:Ke},maxLineLength:{_flexArray:qp,_check:Se},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:ni},font:{_flexArray:us,_check:zn},color:{_flexArray:Oi,_check:Ii},size:{_flexArray:Zd,_check:he(Zd)},scale:{_flexArray:Bp,_check:Se},style:{_flexArray:Gp,_check:Bn},align:{_flexArray:Vp,_check:Pa},margin:{_flexArray:Ly,_check:en},padding:{_flexArray:Yd,_check:he(Yd)},backgroundColor:{_flexArray:Up,_check:is},minVisibleSize:{_flexArray:Ty,_check:Se}}}},Cy="grey",My="white",fu=2,Ny=null,pu=5,Kd=0,Fy="rgba(0, 0, 0, 0.36)",D1=1,k1="circle",Qd=12,pr="white",ko=12,yr="black",kn=2,xr="black",yu=40,Py=null,Dy=null,xu=1,ky="black",Ry=1e3,Oy=800,zy=1,By=2,Uy="rgba(0, 0, 0, 0.0)",Gy="rgba(0, 0, 0, 0.6)",Vy=50,R1=.1,Ai=12,Ro=24,Zr=1,mg=Zr/2,fg=.45,pg=.7,O1=10,jy=O1/2,qy=5,z1=he(qy),B1=he(Wn),U1=he(mu),G1=he(fu),V1=he(pu),j1=he(_u),yg=he(Yr),q1=he(jy),H1=he(yu),X1=he(xu);function Oo(t){return{_check:ni,_set:(e,s,i)=>{e.badges[t].text.content.set(s,i),i==null&&e.badges[t].image.url.set(s,i)},_get:(e,s)=>e.badges[t].text.content.get(s),color:{_flexArray:pr,_check:is},scale:{_flexArray:fg,_check:he(fg)},positionScale:{_flexArray:1,_check:Se},minVisibleSize:{_flexArray:Ai,_check:he(Ai)},image:{_alias:`badges.${t}.image.url`,url:{_flexArray:null,_check:ni},scale:{_flexArray:Zr,_check:he(Zr)}},stroke:{color:{_flexArray:yr,_check:is},width:{_flexArray:kn,_check:he(kn)},scalingMethod:{_flexArray:"fixed",_check:Li}},text:{_alias:`badges.${t}.text.content`,content:{_flexArray:null,_check:ni},color:{_flexArray:xr,_check:is},font:{_flexArray:us,_check:zn},style:{_flexArray:"normal",_check:Bn},scale:{_flexArray:mg,_check:he(mg)},paddingLeft:{_flexArray:0,_check:en},paddingTop:{_flexArray:0,_check:en}}}}var Hy={x:{_flexArray:0,_check:en,_disableMemoryOptimization:!0},y:{_flexArray:0,_check:en,_disableMemoryOptimization:!0},radius:{_flexArray:qy,_check:z1},scalingMethod:{_flexArray:"scaled",_check:Li},color:{_flexArray:Cy,_check:uA},opacity:{_flexArray:1,_check:Se},shape:{_flexArray:"circle",_check:oA},layer:{_flexArray:0,_check:_p},detectable:{_flexArray:!0,_check:Ke},draggable:{_flexArray:!0,_check:Ke},layoutable:{_flexArray:!0,_check:Ke},innerStroke:{_alias:"innerStroke.color",width:{_flexArray:fu,_check:G1},scalingMethod:{_flexArray:"fixed",_check:Li},color:{_flexArray:My,_check:is},minVisibleSize:{_flexArray:Qd,_check:he(Qd)}},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:pu,_check:V1},scalingMethod:{_flexArray:"fixed",_check:Li},color:{_flexArray:Ny,_check:is},minVisibleSize:{_flexArray:Kd,_check:he(Kd)}},badges:{_check:sA,_set(t,e,s){t.badges.topLeft.text.content.set(e,s),t.badges.topLeft.image.url.set(e,s),t.badges.topRight.text.content.set(e,s),t.badges.topRight.image.url.set(e,s),t.badges.bottomLeft.text.content.set(e,s),t.badges.bottomLeft.image.url.set(e,s),t.badges.bottomRight.text.content.set(e,s),t.badges.bottomRight.image.url.set(e,s)},topLeft:Oo("topLeft"),topRight:Oo("topRight"),bottomLeft:Oo("bottomLeft"),bottomRight:Oo("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:Py,_check:Ii},width:{_flexArray:yu,_check:H1},scalingMethod:{_flexArray:"fixed",_check:Li},strokeColor:{_flexArray:Dy,_check:Ii},strokeWidth:{_flexArray:xu,_check:X1},clustering:{_flexArray:!1,_check:Ke},hideNonAdjacentEdges:{_flexArray:!1,_check:Ke}},pulse:{enabled:{_flexArray:!1,_check:Ke},duration:{_flexArray:Ry,_check:Se},interval:{_flexArray:Oy,_check:Se},startColor:{_flexArray:Gy,_check:is},endColor:{_flexArray:Uy,_check:is},width:{_flexArray:Vy,_check:Se},startRatio:{_flexArray:zy,_check:Se},endRatio:{_flexArray:By,_check:Se}},icon:{_alias:"icon.content",content:{_flexArray:null,_check:ni},font:{_flexArray:us,_check:zn},color:{_flexArray:ky,_check:Ii},scale:{_flexArray:pg,_check:he(pg)},style:{_flexArray:"normal",_check:Bn},minVisibleSize:{_flexArray:Ai,_check:he(Ai)}},image:{_alias:"image.url",url:{_flexArray:null,_check:ni},scale:{_flexArray:Zr,_check:he(Zr)},fit:{_flexArray:!0,_check:Ke},tile:{_flexArray:!1,_check:Ke},minVisibleSize:{_flexArray:Ai,_check:he(Ai)}},outline:{_alias:"outline.enabled",enabled:{_flexArray:!1,_check:Ke},color:{_flexArray:Fy,_check:Ii},minVisibleSize:{_flexArray:Ai,_check:he(Ai)}},text:{_alias:"text.content",content:{_flexArray:null,_check:ni},font:{_flexArray:us,_check:zn},color:{_flexArray:Oi,_check:is},size:{_flexArray:Wn,_check:B1},scale:{_flexArray:R1,_check:Se},style:{_flexArray:"normal",_check:Bn},align:{_flexArray:"center",_check:Pa},margin:{_flexArray:_u,_check:j1},padding:{_flexArray:Yr,_check:yg},backgroundColor:{_flexArray:null,_check:is},tip:{_flexArray:!0,_check:Ke},minVisibleSize:{_flexArray:Ro,_check:he(Ro)},scaling:{_flexArray:!1,_check:Ke},position:{_flexArray:"bottom",_check:hA},maxLineLength:{_flexArray:0,_check:Se},truncateLength:{_flexArray:0,_check:Se},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:ni},font:{_flexArray:us,_check:zn},color:{_flexArray:Oi,_check:is},size:{_flexArray:mu,_check:U1},scale:{_flexArray:.08,_check:Se},style:{_flexArray:"normal",_check:Bn},align:{_flexArray:"center",_check:Pa},margin:{_flexArray:jy,_check:q1},padding:{_flexArray:Yr,_check:yg},backgroundColor:{_flexArray:null,_check:is},minVisibleSize:{_flexArray:Ro,_check:he(Ro)}}}};function Nr(t){return typeof t=="string"}var W1=t=>(e,s)=>e[t].get(s),$1=(t,e)=>(s,i)=>s[t][e].get(i),Y1=(t,e,s)=>(i,n)=>i[t][e][s].get(n),Z1=(t,e,s,i)=>(n,r)=>n[t][e][s][i].get(r),K1=t=>(e,s,i)=>e[t].set(s,i),Q1=(t,e)=>(s,i,n)=>s[t][e].set(i,n),J1=(t,e,s)=>(i,n,r)=>i[t][e][s].set(n,r),tw=(t,e,s,i)=>(n,r,o)=>n[t][e][s][i].set(r,o),ew=[W1,$1,Y1,Z1],sw=[K1,Q1,J1,tw];function xg(t,e){if(!t._check)throw new Error(`error somewhere for ${e}`);const s=e.split("."),i=s.length-1,n=ew[i].apply(null,s),r=sw[i].apply(null,s);return{check:t._check,set:r,get:n,nested:{}}}function ka(t,e){const s=e?Hy:Iy,i=typeof t=="string"?[t]:on(t,"",[]);let n=!1;const r=[];for(let o=0;o<i.length;o++){const a=i[o].split(".");let l=s[a[0]];for(let h=1;h<a.length;h++)l=l[a[h]];l.type&&(i[o]=l.type),l._alias&&(i[o]=l._alias),i[o]==="badges"&&(i[o]="badges.topLeft.text.content",n=!0);const d=a[a.length-1];d!=="topLeft"&&d!=="topRight"&&d!=="bottomLeft"&&d!=="bottomRight"||(i[o]=`badges.${d}.text.content`,r.push(`badges.${d}.image.url`)),i[o]==="strokeWidth"&&(i[o]="stroke.width")}return n&&(i.push("badges.topLeft.image.url"),i.push("badges.topRight.text.content"),i.push("badges.topRight.image.url"),i.push("badges.bottomLeft.text.content"),i.push("badges.bottomLeft.image.url"),i.push("badges.bottomRight.text.content"),i.push("badges.bottomRight.image.url")),i.push(...r),i}var zo=t=>(e,s)=>({url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)}),Bo=t=>(e,s)=>({color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)}),Uo=t=>(e,s)=>({content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}),Go=t=>(e,s)=>({color:e.badges[t].color.get(s),scale:e.badges[t].scale.get(s),positionScale:e.badges[t].positionScale.get(s),minVisibleSize:e.badges[t].minVisibleSize.get(s),image:{url:e.badges[t].image.url.get(s),scale:e.badges[t].image.scale.get(s)},stroke:{color:e.badges[t].stroke.color.get(s),width:e.badges[t].stroke.width.get(s),scalingMethod:e.badges[t].stroke.scalingMethod.get(s)},text:{content:e.badges[t].text.content.get(s),color:e.badges[t].text.color.get(s),font:e.badges[t].text.font.get(s),style:e.badges[t].text.style.get(s),scale:e.badges[t].text.scale.get(s),paddingLeft:e.badges[t].text.paddingLeft.get(s),paddingTop:e.badges[t].text.paddingTop.get(s)}}),xi={topLeft:Go("topLeft"),topRight:Go("topRight"),bottomLeft:Go("bottomLeft"),bottomRight:Go("bottomRight")},Ds={stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),innerStroke:(t,e)=>({width:t.innerStroke.width.get(e),scalingMethod:t.innerStroke.scalingMethod.get(e),color:t.innerStroke.color.get(e),minVisibleSize:t.innerStroke.minVisibleSize.get(e)}),outerStroke:(t,e)=>({width:t.outerStroke.width.get(e),scalingMethod:t.outerStroke.scalingMethod.get(e),color:t.outerStroke.color.get(e),minVisibleSize:t.outerStroke.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e),strokeColor:t.halo.strokeColor.get(e),strokeWidth:t.halo.strokeWidth.get(e),clustering:t.halo.clustering.get(e),hideNonAdjacentEdges:t.halo.hideNonAdjacentEdges.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),backgroundColor:t.text.backgroundColor.get(e),tip:t.text.tip.get(e),minVisibleSize:t.text.minVisibleSize.get(e),scaling:t.text.scaling.get(e),position:t.text.position.get(e),maxLineLength:t.text.maxLineLength.get(e),truncateLength:t.text.truncateLength.get(e),secondary:Ds["text.secondary"](t,e)}),image:(t,e)=>({url:t.image.url.get(e),scale:t.image.scale.get(e),fit:t.image.fit.get(e),tile:t.image.tile.get(e),minVisibleSize:t.image.minVisibleSize.get(e)}),icon:(t,e)=>({content:t.icon.content.get(e),font:t.icon.font.get(e),color:t.icon.color.get(e),scale:t.icon.scale.get(e),style:t.icon.style.get(e),minVisibleSize:t.icon.minVisibleSize.get(e)}),badges:(t,e)=>({topLeft:xi.topLeft(t,e),topRight:xi.topRight(t,e),bottomLeft:xi.bottomLeft(t,e),bottomRight:xi.bottomRight(t,e)}),"badges.topLeft":xi.topLeft,"badges.topRight":xi.topRight,"badges.bottomLeft":xi.bottomLeft,"badges.bottomRight":xi.bottomRight,"badges.topLeft.image":zo("topLeft"),"badges.topLeft.stroke":Bo("topLeft"),"badges.topLeft.text":Uo("topLeft"),"badges.topRight.image":zo("topRight"),"badges.topRight.stroke":Bo("topRight"),"badges.topRight.text":Uo("topRight"),"badges.bottomLeft.image":zo("bottomLeft"),"badges.bottomLeft.stroke":Bo("bottomLeft"),"badges.bottomLeft.text":Uo("bottomLeft"),"badges.bottomRight.image":zo("bottomRight"),"badges.bottomRight.stroke":Bo("bottomRight"),"badges.bottomRight.text":Uo("bottomRight"),all:(t,e)=>({x:t.x.get(e),y:t.y.get(e),radius:t.radius.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),shape:t.shape.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),draggable:t.draggable.get(e),layoutable:t.layoutable.get(e),innerStroke:Ds.innerStroke(t,e),outerStroke:Ds.outerStroke(t,e),badges:Ds.badges(t,e),halo:Ds.halo(t,e),pulse:Ds.pulse(t,e),icon:Ds.icon(t,e),image:Ds.image(t,e),outline:Ds.outline(t,e),text:Ds.text(t,e)})},bi={shape:(t,e)=>({body:t.shape.body.get(e),head:t.shape.head.get(e),tail:t.shape.tail.get(e),style:t.shape.style.get(e)}),"text.secondary":(t,e)=>({content:t.text.secondary.content.get(e),font:t.text.secondary.font.get(e),color:t.text.secondary.color.get(e),size:t.text.secondary.size.get(e),scale:t.text.secondary.scale.get(e),style:t.text.secondary.style.get(e),align:t.text.secondary.align.get(e),margin:t.text.secondary.margin.get(e),padding:t.text.secondary.padding.get(e),backgroundColor:t.text.secondary.backgroundColor.get(e),minVisibleSize:t.text.secondary.minVisibleSize.get(e)}),text:(t,e)=>({content:t.text.content.get(e),font:t.text.font.get(e),color:t.text.color.get(e),size:t.text.size.get(e),scale:t.text.scale.get(e),style:t.text.style.get(e),align:t.text.align.get(e),margin:t.text.margin.get(e),padding:t.text.padding.get(e),position:t.text.position.get(e),backgroundColor:t.text.backgroundColor.get(e),minVisibleSize:t.text.minVisibleSize.get(e),adjustAngle:t.text.adjustAngle.get(e),scaling:t.text.scaling.get(e),maxLineLength:t.text.maxLineLength.get(e),secondary:bi["text.secondary"](t,e)}),outline:(t,e)=>({enabled:t.outline.enabled.get(e),color:t.outline.color.get(e),minVisibleSize:t.outline.minVisibleSize.get(e)}),pulse:(t,e)=>({enabled:t.pulse.enabled.get(e),duration:t.pulse.duration.get(e),interval:t.pulse.interval.get(e),startColor:t.pulse.startColor.get(e),endColor:t.pulse.endColor.get(e),width:t.pulse.width.get(e),startRatio:t.pulse.startRatio.get(e),endRatio:t.pulse.endRatio.get(e)}),stroke:(t,e)=>({color:t.stroke.color.get(e),width:t.stroke.width.get(e),scalingMethod:t.stroke.scalingMethod.get(e),minVisibleSize:t.stroke.minVisibleSize.get(e)}),halo:(t,e)=>({color:t.halo.color.get(e),width:t.halo.width.get(e),scalingMethod:t.halo.scalingMethod.get(e)}),all:(t,e)=>({width:t.width.get(e),scalingMethod:t.scalingMethod.get(e),color:t.color.get(e),opacity:t.opacity.get(e),minVisibleSize:t.minVisibleSize.get(e),layer:t.layer.get(e),detectable:t.detectable.get(e),curvature:t.curvature.get(e),adjustAnchors:t.adjustAnchors.get(e),shape:bi.shape(t,e),stroke:bi.stroke(t,e),halo:bi.halo(t,e),pulse:bi.pulse(t,e),outline:bi.outline(t,e),text:bi.text(t,e)})};function bu(t,e,s,i=!0){if((e=e||t)._flexArray!==void 0)return xg(e,s);let n={check:Os,get:qt,set:qt,nested:{}};if(Nr(e)||e._alias){const r=Nr(e)?e:e._alias;n=xg(Le(t,r),r)}else{if(e._set?(n.set=e._set,n.check=e._check):(n.set=qt,n.check=qt),e._get)n.get=e._get;else{const r=i?Ds:bi;n.get=r[s||"all"]}n.nested={}}if(!Nr(e)){const r=Object.keys(e);for(const o of r){const a=e[o];o.startsWith("_")||(n.nested[o]=bu(t,a,s?s+"."+o:o,i))}}return n}var iw=bu(Hy,void 0,void 0,!0),nw=bu(Iy,void 0,void 0,!1),rw=[];function bg(t){let e=rw;return t.output===void 0?(typeof t.attributes=="function"&&(e="all"),ze(t.attributes)&&(e=on(t.attributes))):t.output&&(e=t.output.attributes),vu(e,t.allAttributePaths)}function ow(t,e,s,i){if(i>s){for(const n of e.attributes)for(const r of t.attributes)if(r===n)return!0}for(const n of e.tags)for(const r of t.tags)if(n===r)return!0;return!1}function js(t,e,s,i,n,r){ow(s,i,n,r)&&t.push(e)}function aw(t){let e=t.dependencies;e===void 0?e=L1:ze(e)||(e={});const s=Za(t.attributes).some(o=>typeof o=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);let r=e.adjacentEdges;return!r&&e.adjacentNodes&&(r=!0),{self:Xs(e.self,n,t.allAttributePaths),adjacentNodes:Xs(e.adjacentNodes,n,t.allAttributePaths),adjacentEdges:Xs(r,n,t.allAttributePaths),allNodes:Xs(e.allNodes,n,t.allAttributePaths),allEdges:Xs(e.allEdges,n,t.allAttributePaths)}}function lw(t){let e=t.dependencies;e===void 0?e=I1:ze(e)||(e={});const s=Za(t.attributes).some(r=>typeof r=="function"),i=t.selector&&!t.standaloneSelector,n=!(!s&&!i);return{self:Xs(e.self,n,t.allAttributePaths),extremities:Xs(e.extremities,n,t.allAttributePaths),parallelEdges:Xs(e.parallelEdges,n,t.allAttributePaths),allNodes:Xs(e.allNodes,n,t.allAttributePaths),allEdges:Xs(e.allEdges,n,t.allAttributePaths)}}function Xs(t,e,s){if(!e)return{attributes:[],tags:[]};if(t===!0)return{attributes:[],tags:[Nd]};const i={attributes:vu((t=t||{}).attributes,s),tags:uw(t.tags)};return t.data&&i.tags.push(Fd),t.selection&&i.tags.push(Ae),t.hover&&i.tags.push(wr),i}function dw(t){return Array.isArray(t)?t.join("."):t}function hw(t){return t.map(dw).filter(Nr)}function vu(t,e){if(t==="all")return e.slice();if(!Array.isArray(t))return[];const s=hw(t);return e?e.filter(i=>s.some(n=>i.startsWith(n))):s}function uw(t){return Array.isArray(t)?t.filter(Nr):[]}var Eu={};to(Eu,{cubicIn:()=>mw,cubicInOut:()=>pw,cubicOut:()=>fw,linear:()=>Ra,quadraticIn:()=>cw,quadraticInOut:()=>_w,quadraticOut:()=>gw});var Ra=t=>t,cw=t=>t*t,gw=t=>t*(2-t),_w=t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1),mw=t=>t*t*t,fw=t=>--t*t*t+1,pw=t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2),vg={storage:1,default:0},Oa=class{constructor({graph:t,isNode:e,includeRemovedElements:s}){this._all=!1,this._isNode=e,this._graph=t,this._includeRemovedElements=s,this._eltList=e?this._graph.nodeList:this._graph.edgeList,this._flexArray=e?t.createNodeAttribute(vg,!1):t.createEdgeAttribute(vg,!1),this._all=!1,this._indexList=t.createIndexList(e)}_getAllIndexes(){const t=this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex(),e=new Uint32Array(t);for(let s=1;s<=t;++s)e[s-1]=s;return e}addAll(){this._all=!0}add(t){if(!this._all)for(let e=0;e<t._indexes.length;e++){const s=t._indexes[e];this.addIndex(s)}}addIndex(t){this._flexArray.get(t)===0&&(this._flexArray.set(t,1),this._indexList.push(t))}isEmpty(){return!this._all&&this._indexList.isEmpty()}isFull(){return this._all}getListAndClear(){const t=this.getList();return this.clear(),t}getList(){let t;if(this._all&&!this._includeRemovedElements)t=this._isNode?this._graph.getNodes("all"):this._graph.getEdges("all");else{const e=this._all?this._getAllIndexes():this._indexList.slice();t=this._eltList(e)}return t}clear(){this._all=!1,this._indexList.isEmpty()||(this._indexList.reset(),this._flexArray.reset())}addSet(t){if(t._all)this.addAll();else{const e=t._indexList.getBuffer(),s=t._indexList.getLength();for(let i=0;i<s;++i)this.addIndex(e[i])}}};function Xy(t,e=[],s=""){return t.constructor===Aa?t.isInitialized()&&e.push(s):t.constructor===Object&&Object.keys(t).forEach(i=>{Xy(t[i],e,s?s+"."+i:i)}),e}var Eg=class{constructor(t,e,s){this._updatedAttributes=new Set,this._updatedAttributesTmp=new Set,this._allUsedAttributes=new Set,this._graph=t,this._eltName=e?"node":"edge",this._accessors=e?iw:nw,this._createFlexArrays=s;const i=this._createFlexArrays(t,{original:!0,useDefaultValues:!0});this._finalFlexArrays=i;const n=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._prevFlexArrays=n;const r=this._createFlexArrays(t,{original:!1,useDefaultValues:!0});this._defaultFlexArrays=r,this._currentFlexArrays=this._defaultFlexArrays,this.setLastFlexArrays(this._defaultFlexArrays),this._elementsToRedraw=new Oa({graph:t,isNode:e,includeRemovedElements:!0}),this._elementsUpdated=new Oa({graph:t,isNode:e,includeRemovedElements:!1}),this._finalFlexArraysWrapped=ct(Wt(ct({},this._finalFlexArrays),{excluded:t.getAttribute(e,"excluded"),textHidden:t.getAttribute(e,"textHidden"),animationStart:t.createAttribute(e,S1),animationDuration:t.createAttribute(e,w1),animationEasing:t.createAttribute(e,T1),id:this._graph.getAttribute(e,"id")}),!e&&{source:t.getEdgeAttribute("source"),target:t.getEdgeAttribute("target")})}clear(){this._elementsToRedraw.clear(),this._elementsUpdated.clear(),this._updatedAttributes.clear(),this._updatedAttributesTmp.clear()}getAttributeFlexArrays(){return this._finalFlexArraysWrapped}getPrevAttributeFlexArrays(){return this._prevFlexArrays}getAnimationInformation(t){const e=t._indexes,s=Array(e.length),i=this._finalFlexArraysWrapped;for(let n=0;n<e.length;n++){const r=e[n];s[n]={duration:i.animationDuration.get(r),start:i.animationStart.get(r),easing:i.animationEasing.get(r)}}return s}setDefaultAttributes(t){on(t).forEach(e=>{const s=Le(this._currentFlexArrays,e),i=Le(this._prevFlexArrays,e),n=Le(this._defaultFlexArrays,e),r=Le(this._finalFlexArrays,e);if(!s)return;const o=Le(t,e);s.setDefaultValue(o),n.setDefaultValue(o),i.setDefaultValue(o),r.setDefaultValue(o)}),this.redrawAll()}startUpdate(){}prepareFlexArraysUpdate(t){this._currentFlexArrays=t.inputFlexArrays}setLastFlexArrays(t){this._lastFlexArrays=t}updateFlexArrays(t){const{attributes:e,selector:s,context:i,outputFlexArrays:n,toUpdate:r,formattedOutput:o}=t;this._elementsUpdated.addSet(r),this._elementsToRedraw.addSet(r);const a=r.getListAndClear();if(e&&a.size){const{valid:l,invalid:d}=Ff(this._graph,a,s,i);for(const h of o.attributes){const u=Le(n,h);for(let c=0;c<d._indexes.length;c++){const g=d._indexes[c];u.set(g,void 0)}}this._assignAttributesToFlexArrays(this._accessors,n,l,e,i),this._addUpdatedAttributes(t)}}endUpdate(){const t=this._elementsUpdated.getList(),e=gr(this._updatedAttributesTmp);for(const s of e){const i=Le(this._lastFlexArrays,s),n=Le(this._finalFlexArrays,s);for(let r=0;r<t._indexes.length;r++){const o=t._indexes[r];n.set(o,i.get(o))}}this._updatedAttributesTmp.clear(),this._currentFlexArrays=this._finalFlexArrays}setAttributeValues(t,e,s,i,n){const r=t.outputFlexArrays,o=this._accessors;this._assignAttributesToFlexArrays(o,r,e,s,null),this._addUpdatedAttributes(t,i),this._elementsUpdated.add(e),this._elementsToRedraw.add(e)}notifyLayerDestroyed(t){this._addUpdatedAttributes(t)}_addUpdatedAttributes(t,e){const{outputFlexArrays:s,formattedOutput:i}=t,n=Array.isArray(e)?vu(e):i.attributes;for(const r of n)Le(s,r).isInitialized()&&(this._updatedAttributes.add(r),this._updatedAttributesTmp.add(r),this._allUsedAttributes.add(r))}addUpdatedAttribute(t){this._updatedAttributes.add(t),this._updatedAttributesTmp.add(t),this._allUsedAttributes.add(t)}getUsedAttributeNames(t){return Xy(t.outputFlexArrays)}redrawElements(t){this._elementsToRedraw.add(t)}redrawAll(){this._elementsToRedraw.addAll()}getAndResetElementsToRedraw(){return this._elementsToRedraw.getListAndClear()}getAndResetElementsUpdated(){return this._elementsUpdated.getListAndClear()}getAndResetAttributesUpdated(){const t=gr(this._updatedAttributes);return this._updatedAttributes.clear(),t}getUpdatedAttributes(){return this._updatedAttributes}getUpdatedElementsList(){return this._elementsUpdated.getList()}getUpdatedAttributesSet(){return new Set(this._updatedAttributes)}createFlexArrays(){return this._createFlexArrays(this._graph,{original:!1,useDefaultValues:!1})}getAttributeValues(t,e,s,i){const n=i?this._prevFlexArrays:this._currentFlexArrays;return s?this._getMultipleAttributeValues(t,e,n):this._getSingleAttributeValues(t,e,n)}_getAccessor(t=""){let e=this._accessors;const s=nn(t);for(const i of s)if(e=e.nested[i],!e)throw new Error(`${this._eltName} attribute "${s.join("")}" does not exist`);return e}_getSingleAttributeValues(t,e,s){const i=this._getAccessor(e),n=t._indexes,r=Array(n.length);for(let o=0;o<n.length;o++)r[o]=i.get(s,n[o]);return r}_getMultipleAttributeValues(t,e,s){if(!e||e==="all")return this._getSingleAttributeValues(t,"",s);const i=Array(t.size);for(let n=0;n<i.length;++n)i[n]={};for(let n=0;n<e.length;n++){const r=e[n],o=this._getSingleAttributeValues(t,r,s);for(let a=0;a<i.length;++a)$s(i[a],r,o[a])}return i}setAnimationAttributes(t,{duration:e,startTime:s,easing:i}){const n=t._indexes,r=this._finalFlexArraysWrapped,o=r.animationDuration,a=r.animationStart,l=r.animationEasing,d=gr(this._allUsedAttributes);if(e){let h=!1;for(const u of d){if(u==="x"||u==="y"){h=!0;continue}const c=Le(this._finalFlexArrays,u),g=Le(this._prevFlexArrays,u);for(let _=0;_<n.length;_++){const m=n[_];g.set(m,c.get(m))}}if(h){const u=rs(),c=this._finalFlexArrays.x,g=this._finalFlexArrays.y,_=this._prevFlexArrays.x,m=this._prevFlexArrays.y;for(let f=0;f<n.length;f++){const p=n[f],y=o.get(p);if(y){const b=a.get(p),x=l.get(p),v=(Eu[x]||Ra)(Math.min((u-b)/y,1)),E=Sd(_.get(p),c.get(p),v),w=Sd(m.get(p),g.get(p),v);_.set(p,E),m.set(p,w)}else _.set(p,c.get(p)),m.set(p,g.get(p))}}}o.fill(n,e),a.fill(n,s),l.fill(n,i)}resetAnimationAttributes(t){this._finalFlexArraysWrapped.animationDuration.fill(t._indexes,0)}getUsedAttributes(){return gr(this._allUsedAttributes)}getDefaultFlexArrays(){return this._defaultFlexArrays}_assignAttributesToFlexArrays(t,e,s,i,n,r=[]){if(typeof i=="function"){const o=r.join(".");for(let a=0;a<s.size;++a){const l=s.get(a);if(l){const d=i(l,n,o);this._assignSingleValueToFlexArray(e,l,t,d,r)}}}else if(ze(i)){const o=Object.keys(i);for(let a=0;a<o.length;++a){const l=o[a];r.push(l);const d=this._getNestedAccessor(t,l,r),h=i[l];this._assignAttributesToFlexArrays(d,e,s,h,n,r),r.pop()}}else if((Array.isArray(i)||ArrayBuffer.isView(i))&&r[0]!=="color")if(r.length===0)for(let o=0;o<s.size;++o)this._assignSingleValueToFlexArray(e,s.get(o),t,i[o],r);else for(let o=0;o<s.size;++o){const a=s._indexes[o],l=t.check(i[o]);t.set(e,a,l)}else{const o=t.check(i);for(let a=0;a<s.size;++a){const l=s.get(a);t.set(e,l._index,o)}}}_getNestedAccessor(t,e,s){const i=t.nested[e];if(!i)throw new Error(`${this._eltName} attribute "${s.join(".")}" does not exist`);return i}_assignSingleValueToFlexArray(t,e,s,i,n){if(ze(i)){const r=Object.keys(i);for(const o of r){n.push(o);const a=i[o],l=this._getNestedAccessor(s,o,n);this._assignSingleValueToFlexArray(t,e,l,a,n),n.pop()}}else{const r=s.check(i);s.set(t,e._index,r)}}};function yw(t,{original:e,useDefaultValues:s}){const i="resource";return{width:t.createAttribute(!1,{storage:i,default:s?Hd:void 0,name:"width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?$p:void 0,name:"scalingMethod"},e),color:t.createAttribute(!1,{storage:i,default:s?Yp:void 0,name:"color"},e),opacity:t.createAttribute(!1,{storage:i,default:s?Zp:void 0,name:"opacity"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Kp:void 0,name:"minVisibleSize"},e),layer:t.createAttribute(!1,{storage:i,default:s?Qp:void 0,name:"layer"},e),detectable:t.createAttribute(!1,{storage:i,default:s?Jp:void 0,name:"detectable"},e),curvature:t.createAttribute(!1,{storage:i,default:s?ty:void 0,name:"curvature"},e),adjustAnchors:t.createAttribute(!1,{storage:i,default:s?ey:void 0,name:"adjustAnchors"},e),shape:{body:t.createAttribute(!1,{storage:i,default:s?sy:void 0,name:"shape.body"},e),head:t.createAttribute(!1,{storage:i,default:s?iy:void 0,name:"shape.head"},e),tail:t.createAttribute(!1,{storage:i,default:s?ny:void 0,name:"shape.tail"},e),style:t.createAttribute(!1,{storage:i,default:s?ry:void 0,name:"shape.style"},e)},stroke:{color:t.createAttribute(!1,{storage:i,default:s?oy:void 0,name:"stroke.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Xd:void 0,name:"stroke.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?ay:void 0,name:"stroke.scalingMethod"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?ly:void 0,name:"stroke.minVisibleSize"},e)},halo:{color:t.createAttribute(!1,{storage:i,default:s?dy:void 0,name:"halo.color"},e),width:t.createAttribute(!1,{storage:i,default:s?Wd:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!1,{storage:i,default:s?hy:void 0,name:"halo.scalingMethod"},e)},pulse:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!1,{storage:i,default:s?uy:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!1,{storage:i,default:s?cy:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!1,{storage:i,default:s?gy:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!1,{storage:i,default:s?_y:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!1,{storage:i,default:s?my:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!1,{storage:i,default:s?fy:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!1,{storage:i,default:s?py:void 0,name:"pulse.endRatio"},e)},outline:{enabled:t.createAttribute(!1,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!1,{storage:i,default:s?yy:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?xy:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!1,{storage:i,default:s?us:void 0,name:"text.font"},e),color:t.createAttribute(!1,{storage:i,default:s?Oi:void 0,name:"text.color"},e),size:t.createAttribute(!1,{storage:i,default:s?Wn:void 0,name:"text.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?F1:void 0,name:"text.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?by:void 0,name:"text.style"},e),align:t.createAttribute(!1,{storage:i,default:s?vy:void 0,name:"text.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Ey:void 0,name:"text.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?$d:void 0,name:"text.padding"},e),position:t.createAttribute(!1,{storage:i,default:s?Ay:void 0,name:"text.position"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?Da:void 0,name:"text.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Sy:void 0,name:"text.minVisibleSize"},e),adjustAngle:t.createAttribute(!1,{storage:i,default:s?wy:void 0,name:"text.adjustAngle"},e),scaling:t.createAttribute(!1,{storage:i,default:s?jp:void 0,name:"text.scaling"},e),maxLineLength:t.createAttribute(!1,{storage:i,default:s?qp:void 0,name:"text.maxLineLength"},e),secondary:{content:t.createAttribute(!1,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!1,{storage:i,default:s?us:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!1,{storage:i,default:s?Oi:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!1,{storage:i,default:s?Zd:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!1,{storage:i,default:s?Bp:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!1,{storage:i,default:s?Gp:void 0,name:"text.secondary.style"},e),align:t.createAttribute(!1,{storage:i,default:s?Vp:void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!1,{storage:i,default:s?Ly:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!1,{storage:i,default:s?Yd:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!1,{storage:i,default:s?Up:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!1,{storage:i,default:s?Ty:void 0,name:"text.secondary.minVisibleSize"},e)}}}}function xw(t,{original:e,useDefaultValues:s}){const i="resource";return{x:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"x"},e),y:t.createAttribute(!0,{storage:"any",default:s?0:void 0,name:"y"},e),radius:t.createAttribute(!0,{storage:i,default:s?5:void 0,name:"radius"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"scaled":void 0,name:"scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?Cy:void 0,name:"color"},e),opacity:t.createAttribute(!0,{storage:i,default:s?D1:void 0,name:"opacity"},e),shape:t.createAttribute(!0,{storage:i,default:s?k1:void 0,name:"shape"},e),layer:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"layer"},e),detectable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"detectable"},e),draggable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"draggable"},e),layoutable:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"layoutable"},e),innerStroke:{width:t.createAttribute(!0,{storage:i,default:s?fu:void 0,name:"innerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"innerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?My:void 0,name:"innerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Qd:void 0,name:"innerStroke.minVisibleSize"},e)},outerStroke:{width:t.createAttribute(!0,{storage:i,default:s?pu:void 0,name:"outerStroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"outerStroke.scalingMethod"},e),color:t.createAttribute(!0,{storage:i,default:s?Ny:void 0,name:"outerStroke.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?Kd:void 0,name:"outerStroke.minVisibleSize"},e)},badges:{topLeft:{color:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.topLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ko:void 0,name:"badges.topLeft.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?yr:void 0,name:"badges.topLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?kn:void 0,name:"badges.topLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topLeft.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?xr:void 0,name:"badges.topLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?us:void 0,name:"badges.topLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topLeft.text.paddging.top"},e)}},topRight:{color:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.topRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.topRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ko:void 0,name:"badges.topRight.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.topRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?yr:void 0,name:"badges.topRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?kn:void 0,name:"badges.topRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"badges.topRight.stroke.scalingMethod"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.topRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?xr:void 0,name:"badges.topRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?us:void 0,name:"badges.topRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.topRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.topRight.text.scale"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.left"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.topRight.text.paddging.top"},e)}},bottomLeft:{color:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.bottomLeft.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomLeft.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ko:void 0,name:"badges.bottomLeft.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomLeft.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?yr:void 0,name:"badges.bottomLeft.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?kn:void 0,name:"badges.bottomLeft.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomLeft.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomLeft.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?xr:void 0,name:"badges.bottomLeft.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?us:void 0,name:"badges.bottomLeft.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomLeft.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomLeft.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomLeft.text.paddging.top"},e)}},bottomRight:{color:t.createAttribute(!0,{storage:i,default:s?pr:void 0,name:"badges.bottomRight.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.45:void 0,name:"badges.bottomRight.scale"},e),positionScale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.positionScale"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?ko:void 0,name:"badges.bottomRight.minVisibleSize"},e),image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"badges.bottomRight.image.scale"},e)},stroke:{color:t.createAttribute(!0,{storage:i,default:s?yr:void 0,name:"badges.bottomRight.stroke.color"},e),width:t.createAttribute(!0,{storage:i,default:s?kn:void 0,name:"badges.bottomRight.stroke.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:e?"badges.bottomRight.stroke.scalingMethod":void 0})},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"badges.bottomRight.text.content"},e),color:t.createAttribute(!0,{storage:i,default:s?xr:void 0,name:"badges.bottomRight.text.color"},e),font:t.createAttribute(!0,{storage:i,default:s?us:void 0,name:"badges.bottomRight.text.font"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"badges.bottomRight.text.style"},e),scale:t.createAttribute(!0,{storage:i,default:s?.5:void 0,name:"badges.bottomRight.text.scale"},e),paddingLeft:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.left"},e),paddingTop:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"badges.bottomRight.text.paddging.top"},e)}}},halo:{color:t.createAttribute(!0,{storage:i,default:s?Py:void 0,name:"halo.color"},e),width:t.createAttribute(!0,{storage:i,default:s?yu:void 0,name:"halo.width"},e),scalingMethod:t.createAttribute(!0,{storage:i,default:s?"fixed":void 0,name:"halo.scalingMethod"},e),strokeColor:t.createAttribute(!0,{storage:i,default:s?Dy:void 0,name:"halo.strokeColor"},e),strokeWidth:t.createAttribute(!0,{storage:i,default:s?xu:void 0,name:"halo.strokeWidth"},e),clustering:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.clustering"},e),hideNonAdjacentEdges:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"halo.hideNonAdjacentEdges"},e)},pulse:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"pulse.enabled"},e),duration:t.createAttribute(!0,{storage:i,default:s?Ry:void 0,name:"pulse.duration"},e),interval:t.createAttribute(!0,{storage:i,default:s?Oy:void 0,name:"pulse.interval"},e),startColor:t.createAttribute(!0,{storage:i,default:s?Gy:void 0,name:"pulse.startColor"},e),endColor:t.createAttribute(!0,{storage:i,default:s?Uy:void 0,name:"pulse.endColor"},e),width:t.createAttribute(!0,{storage:i,default:s?Vy:void 0,name:"pulse.width"},e),startRatio:t.createAttribute(!0,{storage:i,default:s?zy:void 0,name:"pulse.startRatio"},e),endRatio:t.createAttribute(!0,{storage:i,default:s?By:void 0,name:"pulse.endRatio"},e)},icon:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"icon.content"},e),font:t.createAttribute(!0,{storage:i,default:s?us:void 0,name:"icon.font"},e),color:t.createAttribute(!0,{storage:i,default:s?ky:void 0,name:"icon.color"},e),scale:t.createAttribute(!0,{storage:i,default:s?.7:void 0,name:"icon.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"icon.style"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"icon.minVisibleSize"},e)},image:{url:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"image.url"},e),scale:t.createAttribute(!0,{storage:i,default:s?1:void 0,name:"image.scale"},e),fit:t.createAttribute(!0,{storage:i,default:!!s||void 0,name:"image.fit"},e),tile:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"image.tile"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"image.minVisibleSize"},e)},outline:{enabled:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"outline.enabled"},e),color:t.createAttribute(!0,{storage:i,default:s?Fy:void 0,name:"outline.color"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?12:void 0,name:"outline.minVisibleSize"},e)},text:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.content"},e),font:t.createAttribute(!0,{storage:i,default:s?us:void 0,name:"text.font"},e),color:t.createAttribute(!0,{storage:i,default:s?Oi:void 0,name:"text.color"},e),size:t.createAttribute(!0,{storage:i,default:s?Wn:void 0,name:"text.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.1:void 0,name:"text.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?_u:void 0,name:"text.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?Yr:void 0,name:"text.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?Da:void 0,name:"text.backgroundColor"},e),tip:t.createAttribute(!0,{storage:i,default:s?M1:void 0,name:"text.tip"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.minVisibleSize"},e),scaling:t.createAttribute(!0,{storage:i,default:!s&&void 0,name:"text.scaling"},e),position:t.createAttribute(!0,{storage:i,default:s?"bottom":void 0,name:"text.position"},e),maxLineLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.maxLineLength"},e),truncateLength:t.createAttribute(!0,{storage:i,default:s?0:void 0,name:"text.truncateLength"},e),secondary:{content:t.createAttribute(!0,{storage:i,default:s?null:void 0,name:"text.secondary.content"},e),font:t.createAttribute(!0,{storage:i,default:s?us:void 0,name:"text.secondary.font"},e),color:t.createAttribute(!0,{storage:i,default:s?Oi:void 0,name:"text.secondary.color"},e),size:t.createAttribute(!0,{storage:i,default:s?mu:void 0,name:"text.secondary.size"},e),scale:t.createAttribute(!0,{storage:i,default:s?.08:void 0,name:"text.secondary.scale"},e),style:t.createAttribute(!0,{storage:i,default:s?"normal":void 0,name:"text.secondary.style"},e),align:t.createAttribute(!0,{storage:i,default:s?"center":void 0,name:"text.secondary.align"},e),margin:t.createAttribute(!0,{storage:i,default:s?N1:void 0,name:"text.secondary.margin"},e),padding:t.createAttribute(!0,{storage:i,default:s?Yr:void 0,name:"text.secondary.padding"},e),backgroundColor:t.createAttribute(!0,{storage:i,default:s?Da:void 0,name:"text.secondary.backgroundColor"},e),minVisibleSize:t.createAttribute(!0,{storage:i,default:s?24:void 0,name:"text.secondary.minVisibleSize"},e)}}}}var bw=class{constructor(t){this.nodes=new Eg(t,!0,xw),this.edges=new Eg(t,!1,yw)}setNodeDefaultAttributes(t){this.nodes.setDefaultAttributes(t)}setEdgeDefaultAttributes(t){this.edges.setDefaultAttributes(t)}getFlexArrays(){return{nodes:{current:this.nodes.getAttributeFlexArrays(),previous:this.nodes.getPrevAttributeFlexArrays()},edges:{current:this.edges.getAttributeFlexArrays(),previous:this.edges.getPrevAttributeFlexArrays()}}}redrawAll(){this.nodes.redrawAll(),this.edges.redrawAll()}clear(){this.nodes.clear(),this.edges.clear()}redrawElements(t){this._fetch(t).redrawElements(t)}getAnimationInformation(t){return this._fetch(t).getAnimationInformation(t)}redrawNodes(t){this.nodes.redrawElements(t)}getUsedAttributes(t,e){return this._fetch(e).getUsedAttributeNames(e.isNode?t.nodes:t.edges)}startUpdate(){this.nodes.startUpdate(),this.edges.startUpdate()}notifyDestroyed(t){this.nodes.notifyLayerDestroyed(t.nodes),this.edges.notifyLayerDestroyed(t.edges)}prepareUpdate(t){this.nodes.prepareFlexArraysUpdate(t.nodes),this.edges.prepareFlexArraysUpdate(t.edges)}onUpdate(t){this.nodes.updateFlexArrays(t.nodes),this.edges.updateFlexArrays(t.edges)}afterLayersUpdate(){this.nodes.endUpdate(),this.edges.endUpdate()}getAndResetElementsToRedraw(){return{nodes:this.nodes.getAndResetElementsToRedraw(),edges:this.edges.getAndResetElementsToRedraw()}}getAndResetElementsUpdated(){const t=this.nodes,e=this.edges;return{nodes:t.getAndResetElementsUpdated(),edges:e.getAndResetElementsUpdated(),nodeAttributesSet:t.getUpdatedAttributesSet(),nodeAttributes:t.getAndResetAttributesUpdated(),edgeAttributes:e.getAndResetAttributesUpdated()}}setAnimationAttributes({nodes:t,edges:e},s){this.nodes.setAnimationAttributes(t,s),this.edges.setAnimationAttributes(e,s)}resetAnimationAttributes({nodes:t,edges:e}){this.nodes.resetAnimationAttributes(t),this.edges.resetAnimationAttributes(e)}setLastOutput(t,e){this.nodes.setLastFlexArrays(t),this.edges.setLastFlexArrays(e)}getCurrentInput(){const t=Ie(this.nodes.getDefaultFlexArrays()),e=Ie(this.edges.getDefaultFlexArrays());return{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:on(t),allEdgeAttributePaths:on(e)}}initializeLayer(t,e,s){t.nodes.allAttributePaths=e,t.edges.allAttributePaths=s,t.nodes.formattedDependencies=aw(t.nodes),t.edges.formattedDependencies=lw(t.edges),t.nodes.formattedOutput={attributes:bg(t.nodes),tags:t.tag?[t.tag]:[]},t.edges.formattedOutput={attributes:bg(t.edges),tags:t.tag?[t.tag]:[]},t.nodes.redrawAdjacentEdges=t.nodes.formattedOutput.attributes.some(i=>C1[i]),t.initialized=!0}connectLayerInputOutput(t,e,s){const i=t.nodes.formattedOutput,n=t.edges.formattedOutput;for(const r of i.attributes){const o=Le(e,r),a=Le(t.nodes.outputFlexArrays,r);a.setFallback(o),$s(e,r,a)}for(const r of n.attributes){const o=Le(s,r),a=Le(t.edges.outputFlexArrays,r);a.setFallback(o),$s(s,r,a)}}setupLayerDependencies(t,e){if(t===e)return;const s=t.priority,i=e.priority,n=t.nodes.formattedOutput,r=t.edges.formattedOutput,o=e.nodes.formattedDependencies,a=e.edges.formattedDependencies;js(t.depsNodeSelf,e,n,o.self,s,i),js(t.depsNodeAdjacentNodes,e,n,o.adjacentNodes,s,i),js(t.depsNodeAdjacentEdges,e,r,a.extremities,s,i),js(t.depsNodeAllNodes,e,n,o.allNodes,s,i),js(t.depsNodeAllEdges,e,r,a.allNodes,s,i),js(t.depsEdgeSelf,e,r,a.self,s,i),js(t.depsEdgeExtremities,e,n,o.adjacentEdges,s,i),js(t.depsEdgeParallelEdges,e,r,a.parallelEdges,s,i),js(t.depsEdgeAllNodes,e,n,o.allEdges,s,i),js(t.depsEdgeAllEdges,e,r,a.allEdges,s,i)}createAttributeLayerData(t,e,s,{tag:i,onBeforeUpdate:n,standaloneSelectors:r}){const o=!!r;return{index:-1,id:e,name:t,tag:i||null,priority:0,depsNodeSelf:[],depsNodeAdjacentNodes:[],depsNodeAdjacentEdges:[],depsNodeAllNodes:[],depsNodeAllEdges:[],depsEdgeSelf:[],depsEdgeExtremities:[],depsEdgeParallelEdges:[],depsEdgeAllNodes:[],depsEdgeAllEdges:[],initialized:!1,onBeforeUpdate:n,nodes:{type:"node",name:t,standaloneSelector:o,toUpdate:new Oa({graph:s,isNode:!0,includeRemovedElements:!1}),outputFlexArrays:this.nodes.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null},edges:{type:"edge",name:t,standaloneSelector:o,toUpdate:new Oa({graph:s,isNode:!1,includeRemovedElements:!1}),outputFlexArrays:this.edges.createFlexArrays(),inputFlexArrays:null,formattedDependencies:null,formattedOutput:null}}}setAttributeValues(t,e,s,i,n){this._fetch(e).setAttributeValues(t,e,s,i,n)}getAttributeValues(t,e,s,i){return this._fetch(t).getAttributeValues(t,e,s,i)}_fetch(t){return t.isNode?this.nodes:this.edges}},vw=(t,e)=>new A1(t,e),Ew=class{constructor(t,{graph:e,dom:s}){this._layerIdCounter=0,this._layers=[],this._destroyedLayers=[],this._layersNeedUpdate=!1,this._updateOngoing=!1,this._needUpdate=!1,this._ogma=t,this._graph=e,this._dom=s,this._emptySubgraph={nodes:t.nodeList(),edges:t.edgeList()},this._textHiddenSet=new so(this._graph,"textHidden"),this._layerController=new bw(this._graph)}_getLayerById(t){for(let e=0;e<this._layers.length;++e){const s=this._layers[e];if(s.id===t)return s.index=e,s}throw new Error("usage of a destroyed style rule or class")}setDefaultAttributes(t,e){this._layerController.setNodeDefaultAttributes(t),this._layerController.setEdgeDefaultAttributes(e)}getFlexArrays(){return this._layerController.getFlexArrays()}clear(){this._updateOngoing=!1,this._needUpdate=!1,this._destroyedLayers=[],this._layerController.clear(),this.updateAllForAllAttributeLayers()}redrawElements(t){t.size&&(this._layerController.redrawElements(t),this._dom.refresh())}redrawAll(){this._layerController.redrawAll(),this._dom.refresh()}_triggerUpdate(){this._needUpdate=!0,this._dom.refresh()}_reconstructAttributeLayersIfNecessary(){return!!this._layersNeedUpdate&&(this._reconstructAttributeLayers(),this._layersNeedUpdate=!1,this._dom.refresh(),!0)}getAnimationInformation(t){return this._layerController.getAnimationInformation(t)}update(){if(!this._needUpdate||this._updateOngoing||!this._ogma._token)return!1;this._reconstructAttributeLayersIfNecessary(),this._updateOngoing=!0,this._layerController.startUpdate();for(const t of this._destroyedLayers)t.initialized&&this._layerController.notifyDestroyed(t);for(const t of this._layers)this._layerController.prepareUpdate(t),typeof t.onBeforeUpdate=="function"&&t.onBeforeUpdate(t,this,this._layerController),this._layerController.onUpdate(t);return this._layerController.afterLayersUpdate(),this._updateOngoing=!1,this._needUpdate=!1,!0}setAttributeLayerValues(t,e,s,i){const n=this._getLayerById(t),r=e.isNode?n.nodes:n.edges;this._reconstructAttributeLayersIfNecessary(),this._layerController.setAttributeValues(r,e,s,i,n),this._updateElementsForAttributeLayers([n],e)}getAttributeLayerFlexArrays(t){const e=this._getLayerById(t);return{nodes:e.nodes.outputFlexArrays,edges:e.edges.outputFlexArrays}}getUsedAttributeLayerAttributes(t,e){const s=this._getLayerById(t);return this._layerController.getUsedAttributes(s,e)}getUpdatedElements(){return{elementsToRedraw:this._layerController.getAndResetElementsToRedraw(),elementsUpdated:this._layerController.getAndResetElementsUpdated()}}addAttributeLayer(t){const{name:e,layerFactory:s=vw}=t;if(!e)throw new Error("Attribute layer must have a name");if(e&&this._layers.find(n=>n.name===e))throw new Error(`attribute layer with name "${t.name}" already exists`);const i=this._layerController.createAttributeLayerData(e,++this._layerIdCounter,this._graph,t);return this._layers.push(i),this._updateLayer(i,t),s(this,this._layerIdCounter)}_reconstructAttributeLayers(){this._layers.sort((n,r)=>n.priority-r.priority);const{currentNodeFlexArrays:t,currentEdgeFlexArrays:e,allNodeAttributePaths:s,allEdgeAttributePaths:i}=this._layerController.getCurrentInput();for(const n of this._layers)this._layerController.initializeLayer(n,s,i);for(const n of this._layers){n.nodes.inputFlexArrays=Ie(t),n.edges.inputFlexArrays=Ie(e),n.depsNodeSelf=[],n.depsNodeAdjacentNodes=[],n.depsNodeAdjacentEdges=[],n.depsNodeAllNodes=[],n.depsNodeAllEdges=[],n.depsEdgeSelf=[],n.depsEdgeExtremities=[],n.depsEdgeParallelEdges=[],n.depsEdgeAllNodes=[],n.depsEdgeAllEdges=[],n.nodes.toUpdate.addAll(),n.edges.toUpdate.addAll(),this._layerController.connectLayerInputOutput(n,t,e);for(const r of this._layers)this._layerController.setupLayerDependencies(n,r)}this._layerController.setLastOutput(t,e);for(const n of this._layers)n.nodes.needAdjacentElements=n.nodes.redrawAdjacentEdges||n.depsNodeAdjacentNodes.length>0||n.depsNodeAdjacentEdges.length>0,n.edges.needAdjacentElements=n.depsEdgeExtremities.length>0||n.depsEdgeParallelEdges.length>0}_updateLayer(t,{priority:e,fullOverwrite:s,nodeAttributes:i,nodeSelector:n,nodeContext:r,nodeDependencies:o,nodeOutput:a,edgeAttributes:l,edgeSelector:d,edgeContext:h,edgeDependencies:u,edgeOutput:c}={}){i!==void 0&&(t.nodes.attributes=s?i:pa(t.nodes.attributes,i)),n!==void 0&&(t.nodes.selector=n),r!==void 0&&(t.nodes.context=r),o!==void 0&&(t.nodes.dependencies=o),a!==void 0&&(t.nodes.output=a),l!==void 0&&(t.edges.attributes=s?l:pa(t.edges.attributes,l)),d!==void 0&&(t.edges.selector=d),h!==void 0&&(t.edges.context=h),u!==void 0&&(t.edges.dependencies=u),c!==void 0&&(t.edges.output=c),e!==void 0&&(t.priority=e),this._triggerLayerUpdate()}_triggerLayerUpdate(){this._layersNeedUpdate=!0,this._triggerUpdate()}updateAllForAttributeLayer(t){const e=this._getLayerById(t);this._updateAllForAttributeLayer(e)}updateAllForAllAttributeLayers(){for(const t of this._layers)this._updateAllForAttributeLayer(t)}_updateAllForAttributeLayer(t,e=!0,s=!0){if(e&&!t.nodes.toUpdate.isFull()){t.nodes.toUpdate.addAll();for(const i of t.depsNodeSelf)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAdjacentEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsNodeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsNodeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}if(s&&!t.edges.toUpdate.isFull()){t.edges.toUpdate.addAll();for(const i of t.depsEdgeSelf)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeExtremities)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeParallelEdges)this._updateAllForAttributeLayer(i,!1,!0);for(const i of t.depsEdgeAllNodes)this._updateAllForAttributeLayer(i,!0,!1);for(const i of t.depsEdgeAllEdges)this._updateAllForAttributeLayer(i,!1,!0)}this._triggerUpdate()}updateElementsForAttributeLayer(t,e){const s=this._getLayerById(t);this._updateElementsForAttributeLayers([s],e)}updateForAllAttributeLayers(t){this._updateElementsForAttributeLayers(this._layers,t)}_updateElementsForAttributeLayers(t,e){let s=this._emptySubgraph;if(e.isNode){for(const i of t)if(!i.nodes.toUpdate.isFull()){i.nodes.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.nodes.toUpdate.add(e);for(const n of i.depsNodeSelf)n.nodes.toUpdate.add(e);for(const n of i.depsNodeAdjacentNodes)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsNodeAdjacentEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsNodeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsNodeAllEdges)this._updateAllForAttributeLayer(n,!1,!0);i.nodes.redrawAdjacentEdges&&this._layerController.redrawElements(s.edges)}}else for(const i of t)if(!i.edges.toUpdate.isFull()){i.edges.needAdjacentElements&&(s=s===this._emptySubgraph?e.fastGetAdjacentElements():s),i.edges.toUpdate.add(e);for(const n of i.depsEdgeSelf)n.edges.toUpdate.add(e);for(const n of i.depsEdgeExtremities)n.nodes.toUpdate.add(s.nodes);for(const n of i.depsEdgeParallelEdges)n.edges.toUpdate.add(s.edges);for(const n of i.depsEdgeAllNodes)this._updateAllForAttributeLayer(n,!0,!1);for(const n of i.depsEdgeAllEdges)this._updateAllForAttributeLayer(n,!1,!0)}this._triggerUpdate()}destroyAttributeLayer(t){const e=this._getLayerById(t);this._destroyedLayers.push(e),this._layers.splice(e.index,1),this._triggerLayerUpdate()}updateAttributeLayer(t,e){const s=this._getLayerById(t);this._updateLayer(s,e)}getAttributeLayerDefinition(t){const e=this._getLayerById(t),{priority:s,nodes:i,edges:n}=e;return{priority:s,nodeAttributes:i.attributes,nodeSelector:i.selector,nodeContext:i.context,nodeDependencies:i.dependencies,nodeOutput:i.output,edgeAttributes:n.attributes,edgeSelector:n.selector,edgeContext:n.context,edgeDependencies:n.dependencies,edgeOutput:n.output}}getAttributeValues(t,e,s,i){return this.update(),this._layerController.getAttributeValues(t,e,s,i)}setAnimationAttributes(t,e){return this._layerController.setAnimationAttributes(t,e)}resetAnimationAttributes(t){return this._layerController.resetAnimationAttributes(t)}setTextHidden(t,e){const s=this._textHiddenSet.addOrRemoveElements(t,e);this.redrawElements(s)}resetTextHidden(){const{nodes:t,edges:e}=this._textHiddenSet.getElements();this._textHiddenSet.clear(),this._layerController.redrawElements(t),this._layerController.redrawElements(e)}getUsedNodeAttributes(){return this._layerController.nodes.getUsedAttributes()}getUsedEdgeAttributes(){return this._layerController.edges.getUsedAttributes()}interpolateAttributes(t){const e=rs(),s=this._ogma.modules.graphics.getAttributesManager(),i=this._layerController,n=t.isNode?s.getUsedNodeAttributes():s.getUsedEdgeAttributes(),{animationDuration:r,animationEasing:o,animationStart:a}=i.getFlexArrays().nodes.current,l=r.getMultiple(t._indexes),d=o.getMultiple(t._indexes),h=a.getMultiple(t._indexes),u=[];for(let c=0;c<t.size;c++){const g={};n.forEach(_=>{const m=typeof _=="string"?_:_.join("."),f=Le(i.getFlexArrays().nodes.previous,_),p=Le(i.getFlexArrays().nodes.current,_);if(!p)return;const y=Cp(e,h[c],l[c],d[c]);isNaN(y)?g[m]=p.get(t._indexes[c]):m.match(/color/gi)?g[m]=fr(f.get(t._indexes[c]),p.get(t._indexes[c]),y,y):g[m]=le(f.get(t._indexes[c]),p.get(t._indexes[c]),y)}),u.push(g)}return u}},Aw=1e-12;function Ag(t){return((t=Math.exp(t))+1/t)/2}function Sw(t){return((t=Math.exp(t))-1/t)/2}function ww(t){return((t=Math.exp(2*t))-1)/(t+1)}var Tw=function t(e,s,i){function n(r,o){var a,l,d=r[0],h=r[1],u=r[2],c=o[0],g=o[1],_=o[2],m=c-d,f=g-h,p=m*m+f*f;if(p<Aw)l=Math.log(_/u)/e,a=function(w){return[d+w*m,h+w*f,u*Math.exp(e*w*l)]};else{var y=Math.sqrt(p),b=(_*_-u*u+i*p)/(2*u*s*y),x=(_*_-u*u-i*p)/(2*_*s*y),v=Math.log(Math.sqrt(b*b+1)-b),E=Math.log(Math.sqrt(x*x+1)-x);l=(E-v)/e,a=function(w){var A=w*l,I=Ag(v),M=u/(s*y)*(I*ww(e*A+v)-Sw(v));return[d+M*m,h+M*f,u*I/Ag(e*A+v)]}}return a.duration=1e3*l*e/Math.SQRT2,a}return n.rho=function(r){var o=Math.max(.001,+r),a=o*o;return t(o,a,a*a)},n}(Math.SQRT2,2,4),Lw=({graphWidth:t,graphHeight:e,viewWidth:s,viewHeight:i})=>.2*Math.min(s/t,i/e),Iw=({smallestNodeSize:t,viewWidth:e,viewHeight:s})=>t===1/0?1/0:Math.min(e,s)/t*.5,Jd=Math.SQRT2,th=.15,Cw=class extends Bt{constructor(t,e){super(t),this._zooming=!1,this.debug=!1,this._smoothZoom=(s,i,n)=>{const r=this._modules.settings,o=r.get("interactions.zoom.duration"),a=r.get("interactions.zoom.easing"),l=this._modules.camera.getZoom(),d={duration:o,easing:a};this._zooming||(this._zooming=!0,this._updateVisibility("zoom",!0));const h=r.get("interactions.zoom.speed")||th;let u=cp(s,h);s<0&&u!==0&&(u=1/u);const c=l*u;this._modules.camera.setZoom(c,d,{x:i,y:n}).then(()=>{this._zooming&&(this._zooming=!1,this._updateVisibility("zoom",!1))})},this.debug=e}onMounted(){const t=this._modules.settings;t.register("interactions.zoom.enabled",!0),t.register("interactions.zoom.onDoubleClick",!1),t.register("interactions.zoom.duration",150),t.register("interactions.zoom.modifier",Jd),t.register("interactions.zoom.speed",th),t.register("interactions.zoom.easing","quadraticOut"),t.register("interactions.zoom.minValue",this.debug?null:Lw),t.register("interactions.zoom.maxValue",this.debug?null:Iw),t.register("interactions.zoom.hideNodes",!1),t.register("interactions.zoom.hideEdges",!1),t.register("interactions.zoom.hideNodeTexts",!1),t.register("interactions.zoom.hideEdgeTexts",!1),t.register("interactions.pan.enabled",!0),t.register("interactions.pan.hideNodes",!1),t.register("interactions.pan.hideEdges",!1),t.register("interactions.pan.hideNodeTexts",!1),t.register("interactions.pan.hideEdgeTexts",!1),t.register("interactions.rotation.enabled",!0),t.register("interactions.rotation.hideNodes",!1),t.register("interactions.rotation.hideEdges",!1),t.register("interactions.rotation.hideNodeTexts",!1),t.register("interactions.rotation.hideEdgeTexts",!1),t.register("interactions.gesture.enabled",!0),t.register("interactions.gesture.hideNodes",!1),t.register("interactions.gesture.hideEdges",!1),t.register("interactions.gesture.hideNodeTexts",!1),t.register("interactions.gesture.hideEdgeTexts",!1),this._setupInteractions()}_setupInteractions(){this._modules.interactions.onMouseWheel({priority:"zoom",check:()=>!!this._modules.settings.get("interactions.zoom.enabled"),handler:$a(({x:t,y:e,delta:s})=>this._smoothZoom(s,t,e),50)}),this._modules.interactions.onDoubleClick({priority:"zoom",check:()=>{const t=this._modules.settings.get("interactions.zoom.enabled"),e=this._modules.settings.get("interactions.zoom.onDoubleClick");return!(!t||!e)},handler:({x:t,y:e})=>this._smoothZoom(1,t,e)}),this._modules.interactions.onDrag({priority:"panning",disableDetection:!0,check:({button:t})=>{const e=!!this._modules.settings.get("interactions.pan.enabled");return t==="left"&&e},onStart:()=>this._updateVisibility("pan",!0),onProgress:({dx:t,dy:e})=>this._modules.camera.move({x:-t,y:-e}),onStop:()=>this._updateVisibility("pan",!1)}),this._modules.interactions.onDrag({priority:"rotation",disableDetection:!0,check:({button:t,domEvent:e})=>(t==="right"||e&&e.buttons===2)&&!!this._modules.settings.get("interactions.rotation.enabled"),onStart:({x:t,y:e})=>{this._rotationStart={x:t,y:e},this._updateVisibility("rotation",!0)},onProgress:({x:t,y:e})=>this._rotate({x:t,y:e}),onStop:()=>this._updateVisibility("rotation",!1)}),this._modules.interactions.onGesture({priority:"gesture",disableDetection:!0,check:()=>!!this._modules.settings.get("interactions.gesture.enabled"),onStart:()=>this._updateVisibility("gesture",!0),onProgress:({dx:t,dy:e,rotation:s,scale:i,x:n,y:r})=>{this._modules.settings.get("interactions.rotation.enabled")&&this._modules.camera.rotate(-s),this._modules.camera.zoomIn({modifier:i},{x:n,y:r}),this._modules.camera.move({x:-t,y:-e})},onStop:()=>this._updateVisibility("gesture",!0)})}_rotate({x:t,y:e}){const{width:s,height:i}=this._modules.camera.getSize(),n=s/2,r=i/2,o=this._rotationStart.x-n,a=this._rotationStart.y-r,l=t-n,d=e-r,h=Math.atan2(a,o)-Math.atan2(d,l);this._rotationStart.x=t,this._rotationStart.y=e,this._modules.camera.rotate(h)}_updateVisibility(t,e){const s=!e,i=this._modules.settings,n=i.get(`interactions.${t}.hideNodes`),r=i.get(`interactions.${t}.hideEdges`),o=i.get(`interactions.${t}.hideNodeTexts`),a=i.get(`interactions.${t}.hideEdgeTexts`);n&&this._modules.graphics.setNodesVisibility(s),o&&this._modules.graphics.setNodeTextsVisibility(s),r&&this._modules.graphics.setEdgesVisibility(s),a&&this._modules.graphics.setEdgeTextsVisibility(s)}},Sg=1e-8,wg=1e8,Hl={duration:0,startAfter:0,ignoreZoomLimits:!1,callback:qt,easing:"quadraticInOut"};function Vo(t){return Math.abs(t)<1e-9}var Mw=80,Wy=class extends Bt{constructor(){super(...arguments),this._minZoom=Sg,this._maxZoom=wg,this._timeout=0}onMounted(){this._reset(),this._modules.settings.register("minZoom",Sg,t=>{this._minZoom=t,this._zoom<t&&(this._zoom=t,this._modules.events.fire("move"))}),this._modules.settings.register("maxZoom",wg,t=>{this._maxZoom=t,this._zoom>t&&(this._zoom=t,this._modules.events.fire("move"))}),this._modules.events.on("setContainer",()=>{this._reset(),this._modules.events.fire("move")}).on("resize",()=>{this._reloadDimensions(),this._modules.events.fire("move")})}get x(){return this._x}get y(){return this._y}get zoom(){return this._zoom}get angle(){return this._angle}get width(){return this._dimensions.width}get height(){return this._dimensions.height}moveEnd(t){this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>this._modules.events.fire("viewChanged",{type:t}),Mw)}getSize(){return{width:this._dimensions.width,height:this._dimensions.height}}getCenter(){return{x:this._x,y:this._y}}setCenter({x:t,y:e},s){const i=this._x,n=this._y,r=t-this._x,o=e-this._y;return Vo(r)&&Vo(o)?Promise.resolve():new Promise(a=>{this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const l=this._modules.animations.play(d=>{this._x=i+r*d,this._y=n+o*d,this._modules.events.fire("move").fire("pan")},Wt(ct(ct({},Hl),s),{callback:()=>this.moveEnd("pan"),resolve:a}));l&&(this._moveAnimation=l)})}move({x:t,y:e},s){const i=Tg({x:t,y:e},this._zoom,this._sinAngle,this._cosAngle);return this.setCenter({x:this._x+i.x,y:this._y+i.y},s)}getZoom(){return this._zoom}setZoom(t,e,s={x:void 0,y:void 0}){const{x:i,y:n}=s;let r=bs(t,this._minZoom,this._maxZoom);return e&&e.ignoreZoomLimits||(r=this._applyZoomLimits(r)),Vo(this._zoom-r)?Promise.resolve():new Promise(o=>{const a=Wt(ct(ct({},Hl),e),{callback:()=>this.moveEnd("zoom"),resolve:o}),l=this._dimensions.width/2,d=this._dimensions.height/2,h=this._zoom,u=l/h-l/r;if(i!==void 0&&n!==void 0){const g=(i-l)/h-(i-l)/r,_=(n-d)/h-(n-d)/r,m=this._cosAngle,f=this._sinAngle,p=m*g-f*_,y=f*g+m*_;this.setCenter({x:this._x+p,y:this._y+y},e)}this._zoomAnimation&&this._modules.animations.cancel(this._zoomAnimation),this._modules.dom.afterNextFrame().then(()=>{this._modules.events.fire("zoomStart",{duration:a.duration,easing:a.easing,startZoom:h,endZoom:r})});const c=this._modules.animations.play(g=>{this._zoom=l/(l/h-u*g),this._modules.events.fire("move").fire("zoom")},a);c&&(this._zoomAnimation=c)})}_applyZoomLimits(t){const e=this._modules.settings.get("interactions.zoom.minValue"),s=this._modules.settings.get("interactions.zoom.maxValue"),{minScaledSize:i,maxScaledSize:n,width:r,height:o,cx:a}=this._modules.locate.getGraphBoundingBox(),l=this._zoom,d=this.getSize();let h=t;if(!isNaN(a)){const u={smallestNodeSize:i,biggestNodeSize:n,graphWidth:r+n,graphHeight:o+n,viewWidth:d.width,viewHeight:d.height},c=e&&e(u),g=s&&s(u);Lg(c)&&h<c?h<l&&(h=Math.min(l,c)):Lg(g)&&h>g&&h>l&&(h=Math.max(l,g))}return h}zoomIn(t,e={x:void 0,y:void 0}){let s=1;return t===void 0&&(t={}),typeof t=="number"&&(t={modifier:t}),s=typeof t.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||Jd:t.modifier,this.setZoom(this._zoom*s,t,e)}moveToBounds(t,e={}){const s=this._modules.locate.computeConfigForBounds(t,{ignoreZoomLimits:!0});return this.moveTo(s,e)}moveTo(t,e={}){const s=this.getZoom(),i=this.getCenter(),n=t.zoom||this._zoom;return e.duration===0?this.setView(t):new Promise(r=>{const o=Math.min(this.width,this.height),a=Tw([i.x,i.y,o/s],[t.x,t.y,o/n]),l=a.duration,d=e.duration||l;this._moveAnimation&&this._modules.animations.cancel(this._moveAnimation);const h=this._modules.animations.play(u=>{const[c,g,_]=a(u);this._x=c,this._y=g,this._zoom=o/_,this._modules.events.fire("move"),this._modules.events.fire("pan")},{duration:d,easing:e.easing,callback:()=>this.moveEnd("pan"),resolve:r});h&&(this._moveAnimation=h)})}zoomOut(t,e={x:void 0,y:void 0}){let s=1;return t===void 0&&(t={}),typeof t=="number"&&(t={modifier:t}),s=typeof t.modifier!="number"?this._modules.settings.get("interactions.zoom.modifier")||Jd:t.modifier,this.setZoom(this._zoom/s,t,e)}getAngle(){return this._angle}setAngle(t,e){const s=this._angle,i=t-s;return Vo(i)?Promise.resolve():new Promise(n=>{this._rotateAnimation&&this._modules.animations.cancel(this._rotateAnimation);const r=this._modules.animations.play(o=>{for(this._angle=s+i*o;this._angle>Math.PI;)this._angle-=2*Math.PI;for(;this._angle<-Math.PI;)this._angle+=2*Math.PI;this._sinAngle=Math.sin(this._angle),this._cosAngle=Math.cos(this._angle),this._modules.events.fire("move").fire("rotate")},Wt(ct(ct({},Hl),e),{callback:()=>this.moveEnd("rotate"),resolve:n}));r&&(this._rotateAnimation=r)})}rotate(t,e){return this.setAngle(this._angle+t,e)}getScreenCenter(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}}graphToScreenCoordinates({x:t,y:e},s={x:0,y:0}){const i=this._dimensions.width/2,n=this._dimensions.height/2;return Sa((t-this._x)*this._zoom+i,(e-this._y)*this._zoom+n,i,n,-this._angle,s)}screenToGraphCoordinates({x:t,y:e},s={x:0,y:0}){return Sa(this._x+(t-this._dimensions.width/2)/this._zoom,this._y+(e-this._dimensions.height/2)/this._zoom,this._x,this._y,this._angle,s)}projectBounds(t,e=t){const[s,i,n,r]=t,o=this._x,a=this._y,l=this._dimensions.width/2,d=this._dimensions.height/2,h=this._sinAngle,u=this._cosAngle,c=1/this._zoom;let g=1/0,_=1/0,m=-1/0,f=-1/0;const p=[s,i,s,r,n,r,n,i];for(let y=0;y<p.length;y+=2){let b=p[y],x=p[y+1];b=o+(b-l)*c,x=a+(x-d)*c;const v=b-o,E=x-a;b=u*v-h*E+o,x=h*v+u*E+a,b<g&&(g=b),b>m&&(m=b),x<_&&(_=x),x>f&&(f=x)}return e[0]=g,e[1]=_,e[2]=m,e[3]=f,e}screenToGraphVector({x:t,y:e}){return Tg({x:t,y:e},this._zoom,this._sinAngle,this._cosAngle)}getView(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}}setView(t,e){const{x:s,y:i,zoom:n,angle:r}=ct({x:this._x,y:this._y,zoom:this._zoom,angle:this._angle},t);return Promise.all([this.setCenter({x:s,y:i},e),this.setZoom(n,e),this.setAngle(r,e)]).then(qt)}_reloadDimensions(){this._dimensions=this._modules.dom.getDimensions()}animationInProgress(){const t=this._moveAnimation,e=this._zoomAnimation,s=this._rotateAnimation;return!!(t&&!t.done||e&&!e.done||s&&!s.done)}getProjectedScreenBounds(t=0){const{width:e,height:s}=this._dimensions,i=Math.max(e,s)*t;return this.projectBounds([0-i,0-i,e+i,s+i])}_reset(){this._zoom=1,this._x=0,this._y=0,this._angle=0,this._sinAngle=0,this._cosAngle=1,this._dimensions=this._modules.dom.getDimensions()}clone(t){const e=new Wy(this._ogma);return e._zoom=t.zoom||this._zoom,e._x=t.x||this._x,e._y=t.y||this._y,e._angle=t.angle||this._angle,e._dimensions={width:t.width||this._dimensions.width,height:t.height||this._dimensions.height},e}};function Tg({x:t,y:e},s,i,n){return{x:n*(t/=s)-i*(e/=s),y:i*t+n*e}}function Lg(t){return typeof t=="number"&&isFinite(t)}function Nw(t){const e=t.filter(s=>isFinite(s)&&s>0);return e.length?ii(e):1}var Fw="anonymous",Pw="white",Dw="default",kw={maxBlockId:1024,maxCoord:-1/0,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:64,maxDashOffset:4,maxDashLength:3,maxGapLength:1,maxSymbolicSize:0,maxPatternScale:0},$y=Xa?"webgl":null,Ig=5,Rw=class extends Bt{constructor(){super(...arguments),this._debug=!1,this._initDone=!1,this._boundaries={maxSize:10,maxMinVisibleSize:64},this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0},this._nextAnimationId=1,this._animations=[],this._rendererState={type:null,code:null,state:"ok",message:""},this._cursorStyle=[],this._fontsNewlyLoaded=[],this._nextGeIndex=1,this._availableGeIndexes=[],this._renderOnNewFrame=!0,this._isBufferDisplayable=t=>{const e=XE(t),s=op(t),i=e?this._visibility.nodes:this._visibility.edges,n=e?this._visibility.nodeTexts:this._visibility.edgeTexts;return i===0&&(!s||n===0)},this._onNewFrame=()=>{this._processAnimations(),this._loadGraphInGraphicsEngine(),this._renderOnNewFrame&&this._render()},this._applyCursorStyle=()=>{const t=this._cursorStyle[this._cursorStyle.length-1]||this._modules.settings.get("cursor.default");va(this._domWrapper,t)},this._updateImageCrossOrigin=()=>{this._imageManager.setImgCrossOrigin(this._modules.settings.get("imgCrossOrigin")||null)}}onMounted(){this._debug=this._ogma.isDebug(),this._renderOnNewFrame=!0,this._formatText=rp().applyArabicShaping,this._attributesManager=new Ew(this._ogma,this._modules),this._imageManager=new tS,this._fontManager=new mE,this._engine=new Mr(Mr.getCachedInitData()),this._domWrapper=this._engine.getDomWrapper(),this._engine.on("error",this._onNewFrame),this._nodeAnimationMap=new Map,this._edgeAnimationMap=new Map,this._movingNodes=new Set,this._movingEdges=new Set,this._modules.events.register(["reloadFonts","rendererStateChange","beforeUpdateAttributes","updateAttributes","animate","move","pan","zoom","rotate","viewExportStart","viewExportEnd","afterImageExport","viewChanged","zoomStart"]),this._modules.settings.register("renderer",$y,t=>{this._updateRendererState({type:t,state:"requested",code:null,message:void 0}),this._engine.setRenderType(t),this._modules.dom.refresh()}),this._modules.settings.register("backgroundColor",Pw,t=>{this._engine.parseColor(t)?this._modules.dom.refresh():(Mi(`Invalid background color "${t}" specified; will default to black.`),this._modules.settings.set("backgroundColor","black"))}),this._modules.settings.register("texts.hideUntilFontsLoaded",!0,t=>{this._fontManager.setHideUntilFontsLoaded(!!t)}),this._modules.settings.register("texts.cornerRadius",Ig,t=>{this._engine.getTextManager().setCornerRadius(typeof t=="number"?t:Ig),this._modules.dom.refresh()}),this._modules.settings.register("imgCrossOrigin",Fw,this._updateImageCrossOrigin),this._modules.settings.register("cursor.default",Dw,this._applyCursorStyle),this._modules.dom.setLayer("graphics",this._domWrapper),this._engine.setGlobalBoundaries(kw),this._modules.dom.beforeNextFrame().then(()=>{this._initDone=!0,this._fireRendererStateChangeEvent()}),this._imageManager.onFetch(()=>{this._engine.notifyPatternUpdate(),this._modules.dom.refresh()}),this._fontManager.onFontLoaded(t=>{this._fontsNewlyLoaded.push(t),this._engine.notifyPatternUpdate(),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}),this._modules.dom.addMediaListener("(min-resolution: 2dppx)",()=>this._modules.dom.refresh()),this._visibleAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${Nd})`,tag:Nd,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._dataAttributeLayer=this._attributesManager.addAttributeLayer({priority:0,name:`internal(${Fd})`,tag:Fd,nodeDependencies:void 0,edgeDependencies:void 0}),Hc(this._engine,this._attributesManager.getFlexArrays()),this._modules.events.on("move",()=>this._modules.dom.refresh()).on("frame",this._onNewFrame).on("viewExportStart",()=>{this._renderOnNewFrame=!1}).on("viewExportEnd",()=>{this._renderOnNewFrame=!0}).on("clearGraph",()=>{this._nextGeIndex=1,this._availableGeIndexes=[],this._engine.clear(),this._attributesManager.clear(),this._modules.dom.refresh(),this._animations=[],this._nodeAnimationMap.clear(),this._edgeAnimationMap.clear()}).on("viewChanged",({type:t})=>{if(t==="rotate"){const e=this._modules.graph.getEdges().filter(s=>s.getAttribute("adjustAnchors"));this._attributesManager.redrawElements(e)}}).on("addNodes",t=>{this._attributesManager.updateForAllAttributeLayers(t.nodes)}).on("addEdges",t=>{this._attributesManager.updateForAllAttributeLayers(t.edges)}).on("excludedStateChange",t=>{this._visibleAttributeLayer.updateElements(t.elements)}).on("setData",t=>{this._dataAttributeLayer.updateElements(t.elements)}),Mr.clearCachedInitData(),this._modules.dom.addWindowEventListener("unload",()=>this.destroy())}onReady(t){t.renderer!==void 0&&this._ogma.setOptions({renderer:t.renderer}),t.imgCrossOrigin!==void 0&&this._ogma.setOptions({imgCrossOrigin:t.imgCrossOrigin})}getTransparentBackgroundColor(){const t=this._modules.settings.get("backgroundColor");return t?this._engine.transparentify(t):null}_render(){const t=this._modules.dom.getDimensions(),e=this._modules.camera.getView(),s=fs(),i=rs(),n=this._modules.settings.get("backgroundColor"),r=this._isBufferDisplayable;this._engine.setView({x:e.x,y:e.y,zoom:e.zoom,angle:e.angle,width:t.width,height:t.height,pixelRatio:s,currentTime:i,backgroundColor:n,isBufferDisplayable:r});try{this._engine.render(),this._rendererState.state==="requested"&&this._updateRendererState({state:"ok"})}catch(o){if(this._debug)throw o;const{message:a,code:l="OTHER"}=o,d=this._rendererState.type,h=cS(d);let u=this._rendererState.state==="requested"?`Error while initializing the ${h} renderer`:`The ${h} renderer encountered an unexpected runtime error`,c=null;d==="webgl"&&(u+="; fallbacking on canvas renderer",c="canvas"),Mi(a||""),Mi(u),this._updateRendererState({state:"error",code:l,message:a}),this._modules.settings.set("renderer",c)}}_fireRendererStateChangeEvent(){const t=this._rendererState;this._modules.events.fire("rendererStateChange",{type:t.type,state:t.state,code:t.code,message:t.message})}_updateRendererState({type:t,state:e,code:s,message:i}){let n=!1;t!==void 0&&this._rendererState.type!==t&&(this._rendererState.type=t,n=!0),e!==void 0&&this._rendererState.state!==e&&(this._rendererState.state=e,n=!0),s!==void 0&&this._rendererState.code!==s&&(this._rendererState.code=s,n=!0),i!==void 0&&this._rendererState.message!==i&&(this._rendererState.message=i,n=!0),n&&this._initDone&&this._fireRendererStateChangeEvent()}getImageData(){return this._modules.dom.afterNextFrame().then(()=>this._engine.getImageData())}getNodeAttributes(){return this._attributesManager.getFlexArrays().nodes.current}getEdgeAttributes(){return this._attributesManager.getFlexArrays().edges.current}getGraphicsEngine(){return this._engine}getImageManager(){return this._imageManager}getFontManager(){return this._fontManager}allocateGraphicsEngineBlockId(){return this._availableGeIndexes.length?this._availableGeIndexes.pop():this._nextGeIndex++*ll+wE}releaseGraphicsEngineBlockId(t){this._engine.freeBlock(t),this._availableGeIndexes.push(t),this._modules.dom.refresh()}addCursorStyle(t){t&&(this._cursorStyle.push(t),this._applyCursorStyle())}removeCursorStyle(t){if(!t)return;const e=this._cursorStyle.lastIndexOf(t);e!==-1&&(this._cursorStyle.splice(e,1),this._applyCursorStyle())}reloadFonts(){this._modules.events.fire("reloadFonts"),this._engine.notifyFontsReloaded(),this._modules.dom.refresh()}getDomElement(){return this._domWrapper}setTextHidden(t,e){this._attributesManager.setTextHidden(t,e)}resetTextHidden(){this._attributesManager.resetTextHidden(),this._modules.dom.refresh()}getAttributesManager(){return this._attributesManager}_checkFontsNewlyLoaded(){return!!this._fontsNewlyLoaded.length&&(this._fontsNewlyLoaded=[],!0)}_loadGraphInGraphicsEngine(){this._attributesManager.update(),this._checkFontsNewlyLoaded()&&this._attributesManager.redrawAll(),this._modules.events.fire("beforeUpdateAttributes");const{elementsToRedraw:t,elementsUpdated:e}=this._attributesManager.getUpdatedElements(),s=e.nodes.size>0||e.edges.size>0;(e.nodeAttributesSet.has("radius")||e.edgeAttributes.includes("width"))&&(this._boundaries.maxSize=uS(this._modules.graph)),(e.nodeAttributesSet.has("shape")||e.edgeAttributes.includes("shape.head")||e.edgeAttributes.includes("shape.tail"))&&Hc(this._engine,this._attributesManager.getFlexArrays()),RA({graph:this._modules.graph,elements:t,engine:this._engine,imageManager:this._imageManager,fontManager:this._fontManager,view:this._modules.camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries,formatText:this._formatText}),s&&this._modules.events.fire("updateAttributes",e)}_forceCompleteGraphRefresh(){this._attributesManager.redrawAll(),this._loadGraphInGraphicsEngine()}export(t,e,s,i){let n;return Promise.all([this._modules.graph.getNodes().addClass(Wi),this._modules.graph.getEdges().addClass(Wi)]).then(()=>this.resolveAtNextFrame()).then(()=>this._imageManager.whenReady()).then(()=>{s==="all"?(n=Bw(this._modules.graph),this._forceCompleteGraphRefresh()):this._loadGraphInGraphicsEngine();const r=this._modules.camera.clone(ct({},e));return this._modules.events.fire("viewExportStart",{preventOverlap:i.preventOverlap,camera:r,view:r.getView()}),this._ogma.view.afterNextFrame().then(()=>this._engine.export(t,e,i))}).then(r=>Promise.all([this._modules.graph.getNodes().removeClass(Wi),this._modules.graph.getEdges().removeClass(Wi)]).then(()=>r)).then(r=>(s==="all"&&(Uw(n),this._forceCompleteGraphRefresh()),this._modules.events.fire("viewExportEnd"),r))}addAttributeLayer(t){return this._attributesManager.addAttributeLayer(t)}getAttributeValues(t,e,s,i){return this._attributesManager.getAttributeValues(t,e,s,i)}forceAttributesComputation(){this._attributesManager.update()}resolveAtNextFrame(t){return this._modules.dom.afterNextFrame().then(()=>t)}isMoving(t){return(t.isNode?this._movingNodes:this._movingEdges).has(t._index)}animate(t,e,s,i){const n=Ow(i);return n.duration&&this._engine.ensureAnimationsReady(),this._animate(t,e,s,n)}isAnimating(){return this._animations.length>0}getAnimationInformation(t){return this._attributesManager.getAnimationInformation(t)}_toSubGraph(t){if(t instanceof ui||t instanceof Ys)return{nodes:t.toList(),edges:t.getAdjacentEdges()};if(t instanceof hn||t instanceof Di)return{nodes:this._modules.graph.nodeList(),edges:t.toList()};const e=t,s={nodes:e.nodes||this._modules.graph.nodeList(),edges:e.edges||this._modules.graph.edgeList()};return s.nodes.size&&(s.edges.size?s.edges=s.edges.concat(s.nodes.getAdjacentEdges()).dedupe():s.edges=s.nodes.getAdjacentEdges()),s}_animate(t,e,s,{duration:i,easing:n}){if((!this._animations.length||s)&&!i)return e(t),Promise.resolve(t);const r=this._toSubGraph(t),o=r.nodes,a=r.edges;if(o.size===0&&a.size===0)return e(t),Promise.resolve(t);if(o.size){if(s)for(let c=0;c<o._indexes.length;c++)this._movingNodes.add(o._indexes[c]);this._modules.events.fire("animate",{elements:o,duration:i,updatesPositions:s,easing:n})}if(a.size){if(s)for(let c=0;c<a._indexes.length;c++)this._movingEdges.add(a._indexes[c]);this._modules.events.fire("animate",{elements:a,duration:i,updatesPositions:s,easing:n})}const l={id:this._nextAnimationId++,startTime:rs(),finished:!1,func:()=>e(t),duration:i,easing:n,nodes:o,edges:a,started:!1,updatesPositions:s,resolve:qt};let d=l;const h=new Set;if(d=this._getLongestAnimation(d,l.nodes,h),d=this._getLongestAnimation(d,l.edges,h),d.updatesPositions){for(let c=0;c<o._indexes.length;c++)this._nodeAnimationMap.set(o._indexes[c],d);for(let c=0;c<a._indexes.length;c++)this._edgeAnimationMap.set(a._indexes[c],d);l.duration=d.duration,l.startTime=d.startTime}if(l.duration===0&&d.id===l.id)return e(t),Promise.resolve(t);const u=new Promise(c=>l.resolve=()=>c(t));return this._animations.push(l),this._modules.dom.refresh(),i||this._processAnimations(),u}_removeFinishedAnimations(){this._animations=this._animations.filter(t=>!t.finished)}_getAnimationElements(t){return{nodes:t.nodes,edges:t.edges}}_resetAnimationAttributes({nodes:t,edges:e}){this._attributesManager.resetAnimationAttributes({nodes:t,edges:e});for(let s=0;s<t._indexes.length;s++)this._nodeAnimationMap.delete(t._indexes[s]),this._movingNodes.delete(t._indexes[s]);for(let s=0;s<e._indexes.length;s++)this._edgeAnimationMap.delete(e._indexes[s]),this._movingEdges.delete(t._indexes[s])}_getLongestAnimation(t,e,s){const i=e.isNode?this._nodeAnimationMap:this._edgeAnimationMap;for(let n=0;n<e._indexes.length;n++){const r=i.get(e._indexes[n]);r&&!s.has(r.id)&&(s.add(r.id),(t.updatesPositions||!r.updatesPositions)&&r.duration+r.startTime<t.duration+t.startTime||(t=r))}return t}_processAnimations(){if(!this._animations.length)return;const t=rs(),e=[];this._attributesManager.update();for(const s of this._animations)s.started||(s.started=!0,e.push(s.func),this._attributesManager.setAnimationAttributes(this._getAnimationElements(s),s));for(const s of e)s();for(const s of this._animations)t>=s.startTime+s.duration&&(this._resetAnimationAttributes(this._getAnimationElements(s)),s.resolve(s.elements),s.finished=!0);this._removeFinishedAnimations(),this._animations.length&&this._modules.dom.refresh()}hideTexts(){this.setNodeTextsVisibility(!1),this.setEdgeTextsVisibility(!1)}showTexts(){this.setNodeTextsVisibility(!0),this.setEdgeTextsVisibility(!0)}setNodesVisibility(t){return this._updateVisibilityCounter("nodes",t)}setNodeTextsVisibility(t){return this._updateVisibilityCounter("nodeTexts",t)}setEdgesVisibility(t){return this._updateVisibilityCounter("edges",t)}setEdgeTextsVisibility(t){return this._updateVisibilityCounter("edgeTexts",t)}_updateVisibilityCounter(t,e){this._visibility[t]+=e?-1:1,this._modules.dom.refresh()}detectNode(t,e,s,i,n,r){return dS(t,e,s,i,n,r,this._modules.graph,this._attributesManager,this._modules.camera,this._engine,this._movingNodes,this._formatText)}detectEdge(t,e,s,i,n){return hS(t,e,s,i,n,this._modules.graph,this._modules.camera,this._movingNodes,this._attributesManager)}getVisibilityCounters(){return this._visibility}destroy(){this.getGraphicsEngine().destroy(),this.getImageManager().destroy(),this.getFontManager().destroy()}};function Ow(t){return typeof t=="number"?t={duration:t}:typeof t=="object"&&t!==null||(t={duration:0}),{duration:zw(t.duration),easing:t.easing||"linear",chain:!!t.chain}}function zw(t){return typeof t!="number"||!isFinite(t)||t<0?0:t}function Cg(t,e){const s=e?t.getNodeAttribute("excluded"):t.getEdgeAttribute("excluded"),i=(e?t.getNodes("all"):t.getEdges("all"))._indexes,n=s.getMultiple(i);return s.fill(i,0),{excludedList:s,indexes:i,values:n}}function Mg({excludedList:t,indexes:e,values:s}){t.setMultiple(e,s)}function Bw(t){return{nodes:Cg(t,!0),edges:Cg(t,!1)}}function Uw({nodes:t,edges:e}){Mg(t),Mg(e)}var Gw=250,Vw=50,jw=class extends Bt{constructor(){super(...arguments),this._onAnyEvents=[],this._registeredEvents={},this.onIdle=$a(()=>this.fire("idle"),Vw)}onMounted(){this._registeredEvents={},this.register(["idle"]),this._ogma.onReady(()=>{this.on(["viewChanged","layoutEnd","addNodes","addEdges","removeNodes","removeEdges","animate","setMultipleAttributes","transformationRefresh"],()=>{this._modules.dom.clearTimeout(this._idleTimeout),this._idleTimeout=this._modules.dom.setTimeout(this.onIdle,Gw)})})}isRegistered(t){return!!this._registeredEvents[t]}register(t,e=[]){t.forEach(s=>{if(this._registeredEvents[s])throw new Error(`event "${s}" already exists`);this._registeredEvents[s]=new qw(!1,s)})}onAnyEvent(t){this._onAnyEvents.push(t)}on(t,e){return Array.isArray(t)&&t.forEach(s=>this.on(s,e)),this._registeredEvents[t]?(this._registeredEvents[t].on(e),this):this}off(t){return Object.values(this._registeredEvents).forEach(e=>{e.off(t)}),this}fire(t,e=null){const s=this._getEvent(t);return this._onAnyEvents.forEach(i=>i(e,t)),s.trigger(e),this}once(t,e){const s=this,i=function(){e.apply(null,arguments),s.off(i)};return this.on(t,i)}_getEvent(t){if(!(t in this._registeredEvents))throw new Error(`Event ${t} does not exist`);return this._registeredEvents[t]}destroy(){Object.values(this._registeredEvents).forEach(t=>{t.destroy()})}},qw=class{constructor(t,e){this._subscribers=[],this._handlers=[],this._reverseOrder=t,this._name=e}trigger(t){for(const e of this._handlers)e(t,this._name);return this}on(t){if(typeof t!="function")throw new Error("handler is not a function");const e=this._reverseOrder?0:this._subscribers.length;return this._handlers.splice(e,0,t),this._subscribers.splice(e,0,t),this}off(t){let e;for(;(e=this._subscribers.indexOf(t))!==-1;)this._subscribers.splice(e,1),this._handlers.splice(e,1);return this}destroy(){this._subscribers=[],this._handlers=[]}},Hw=class extends Bt{onMounted(){this._graphics=this._modules.graphics,this._modules.events.register(["setMultipleAttributes"]),this._modules.events.on(["addNodes","addEdges"],({nodes:t,edges:e,objects:s})=>{this._onAddElements(t||e,s)}),this._originalAttributesLayer=this._graphics.addAttributeLayer({name:"original-attributes",priority:Tv,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0}),this._individualAttributesLayer=this._graphics.addAttributeLayer({name:"individual-attributes",priority:Cv,nodeOutput:{attributes:"all"},edgeOutput:{attributes:"all"},nodeDependencies:void 0,edgeDependencies:void 0})}_onAddElements(t,e){const s=e.map(i=>i.attributes);this._originalAttributesLayer.setAttributeValues(t,s)}getOriginalAttributes(){return this._originalAttributesLayer.getFlexArrays()}getIndividualAttributes(){return this._individualAttributesLayer.getFlexArrays()}setMultipleAttributes(t,e,s){const i=Array.isArray(e)?e.length&&e[0]?ka(e[0],t.isNode):[]:ka(e,t.isNode),n=i.includes("x")||i.includes("y");return this._modules.events.fire("setMultipleAttributes",{elements:t,values:e,updatedAttributes:i}),this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,e)},n,s)}setSingleAttribute(t,e,s,i){const n={};return $s(n,e,s),this.setMultipleAttributes(t,n,i)}resetMultipleAttributes(t,e,s){const i=e||this._individualAttributesLayer.getUsedAttributeNames(t),n=i&&(i.includes("x")||i.includes("y")),r={};for(const o of i)$s(r,o,void 0);return this._graphics.animate(t,()=>{this._individualAttributesLayer.setAttributeValues(t,r)},n,s)}getMultipleAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!1)}getSingleAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!1)}replaceOriginalAttributes(t,e,s=[]){const i={},n=this._originalAttributesLayer.getUsedAttributeNames(t).filter(r=>!s.includes(r));for(let r=0;r<n.length;++r)$s(i,n[r],void 0);this._originalAttributesLayer.setAttributeValues(t,i),this._originalAttributesLayer.setAttributeValues(t,e)}getSinglePreviousAttribute(t,e){return this._graphics.getAttributeValues(t,e,!1,!0)}getMultiplePreviousAttributes(t,e){return this._graphics.getAttributeValues(t,e,!0,!0)}},Xw=class extends Bt{constructor(){super(...arguments),this._currentValue={},this._onChange={},this._defaultValues={},this._keys=[]}onReady(t){t.renderer&&this.update({renderer:t.renderer}),t.options&&this.update(t.options)}register(t,e,s,i){return i===void 0&&(i=!0),this._keys.push(t),this._currentValue[t]=e,this._defaultValues[t]=e,this._onChange[t]=s||qt,s&&i&&s(e),this}update(t){t=Or(t);const e=this._keys,s={},i=this._currentValue;for(let r=0;r<e.length;++r){const o=e[r];if(o in t){let a=t[o];a===void 0&&(a=this._defaultValues[o]),s[o]=i[o],i[o]=a}}const n=Object.keys(s);for(let r=0;r<n.length;++r){const o=n[r],a=this._currentValue[o],l=s[o];a!==l&&this._onChange[o](a,l)}return fd(s)}get(t){return arguments.length===0?fd(this._currentValue):this._currentValue[t]}set(t,e){const s=this._currentValue[t],i=this._onChange[t];this._currentValue[t]=e,i&&i(e,s)}},Ww=class{constructor(t,e){this._classes=t,this._name=e}getName(){return this._name}getIndex(){return this._classes.getIndex(this._name)}setIndex(t){return this._classes.setIndex(this._name,t)}update(t){return this._classes.update(this._name,t),this}getDefinition(){return this._classes.getDefinition(this._name)}getNodes(t){return this._classes.getElementsByClass(this._name,t).nodes}getEdges(t){return this._classes.getElementsByClass(this._name,t).edges}clearNodes(t){this.getNodes(t).removeClass(this._name)}clearEdges(t){this.getEdges(t).removeClass(this._name)}add(t){t.addClass(this._name)}remove(t){t.removeClass(this._name)}destroy(){const t=this._classes.getElementsByClass(this._name);return Promise.all([t.nodes.removeClass(this._name),t.edges.removeClass(this._name)]).then(()=>this._classes.removeClass(this._name))}},$w=1e3,Yw=.5/$w,Zw=class extends Bt{constructor(){super(...arguments),this._builtinClasses=[],this._userClasses=[],this._classesByName={},this._onExcludedStateChange=({elements:t,value:e})=>{if(e){const s=this._builtinClasses.map(i=>i.name);this._addOrRemoveClassesToElements(s,t,!1)}},this._onClearGraph=()=>{this._builtinClasses.concat(this._userClasses).forEach(t=>t.elementSet.clear())},this._onRemoveElements=({nodes:t,edges:e})=>{const s=t||e;this._builtinClasses.concat(this._userClasses).forEach(i=>i.elementSet.removeElements(s))}}onMounted(){this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on("clearGraph",this._onClearGraph).on("removeEdges",this._onRemoveElements).on("removeNodes",this._onRemoveElements)}_getClassList(t){return t?this._builtinClasses:this._userClasses}createClass({name:t,isBuiltin:e=!1,after:s,nodeAttributes:i,nodeDependencies:n,nodeOutput:r,edgeAttributes:o,edgeDependencies:a,edgeOutput:l}={}){if(typeof t!="string")throw new Error('the "name" argument should be a string');const d=this._getClassList(e),h=s?Kw(d,s)+1:d.length;if(h===-1)throw new Error(`createClass: class specified as \`after\` parameter "${s}" does not exist`);if(e&&!t.startsWith("_"))throw new Error(`invalid builtin class name "${t}": builtin classes should start with '_'`);const u=new so(this._modules.graph),c=new Ww(this,t),g={name:t,elementSet:u,attributeLayer:this._modules.graphics.addAttributeLayer({name:`class(${t})`,tag:t,standaloneSelectors:!0,nodeAttributes:i||void 0,edgeAttributes:o||void 0,nodeSelector:(_,m)=>m.hasElement(_),edgeSelector:(_,m)=>m.hasElement(_),nodeContext:u,edgeContext:u,nodeOutput:r,edgeOutput:l,nodeDependencies:n,edgeDependencies:a}),isBuiltin:e,wrapper:c};return d.splice(h,0,g),e&&d.sort((_,m)=>uc.indexOf(_.name)-uc.indexOf(m.name)),this._updatePriorities(e),this._classesByName[t]=g,this._modules.events.register([bn(t,!0,!0),bn(t,!0,!1),bn(t,!1,!0),bn(t,!1,!1)]),c}removeClass(t){const e=this._get(t),s=this._getClassList(e.isBuiltin),i=s.indexOf(e);if(i===-1)throw new Error(`class "${t}" does not exist`);return s.splice(i,1),e.attributeLayer.destroy(),delete this._classesByName[t],this._updatePriorities(e.isBuiltin),Promise.resolve(void 0)}_updatePriorities(t){const e=this._getClassList(t),s=Mv+(t?.5:0);for(let i=0;i<e.length;++i){const n=e[i],r=s+Yw*i;n.attributeLayer.update({priority:r})}}_get(t){const e=this._classesByName[t];if(!e)throw new Error(`class "${t}" does not exist`);return e}getIndex(t){const e=this._get(t);return this._getClassList(e.isBuiltin).indexOf(e)}setIndex(t,e){const s=this._get(t),i=this._getClassList(s.isBuiltin),n=i.indexOf(s),r=bs(e,0,i.length-1);i.splice(n,1),i.splice(r,0,s),this._updatePriorities(s.isBuiltin)}update(t,{nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a}={}){this._get(t).attributeLayer.update({nodeAttributes:e,edgeAttributes:s,nodeDependencies:i,edgeDependencies:n,nodeOutput:r,edgeOutput:o,fullOverwrite:a})}getDefinition(t){const e=this._get(t),{nodeAttributes:s,nodeDependencies:i,nodeOutput:n,edgeAttributes:r,edgeDependencies:o,edgeOutput:a}=e.attributeLayer.getDefinition();return{nodeAttributes:s||void 0,edgeAttributes:r||void 0,nodeDependencies:i,edgeDependencies:o,nodeOutput:n,edgeOutput:a}}_addOrRemoveClassesToElements(t,e,s){const i=e.isNode;for(let n=0;n<t.length;++n){const r=t[n],{elementSet:o,attributeLayer:a}=this._get(r),l=o.addOrRemoveElements(e,s),d=bn(r,i,s);l.size&&(a.updateElements(l),this._modules.events.fire(d,i?{nodes:l}:{edges:l}))}}_animatedAttributesUpdatePositions(t,e){for(let s=0;s<t.length;++s){const i=t[s],n=this.getDefinition(i);if(e.isNode&&n.nodeAttributes&&(n.nodeAttributes.x||n.nodeAttributes.y))return!0}return!1}_getAnimatedAtrributes(t,e){return t.reduce((s,i)=>{const n=this.getDefinition(i);return e.isNode&&n.nodeAttributes&&s.push(...ka(n.nodeAttributes,!0)),!e.isNode&&n.edgeAttributes&&s.push(...ka(n.edgeAttributes,!1)),s},[])}addClassesToElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!0)},n,s)}removeClassesFromElements(t,e,s){const i=e.toList(),n=this._animatedAttributesUpdatePositions(t,i);return this._modules.graphics.animate(e,()=>{this._addOrRemoveClassesToElements(t,i,!1)},n,s)}hasSingleElementClass(t,e){return this._get(t).elementSet.hasElement(e)}getElementsClassList(t,e={}){const{includeBuiltinClasses:s=!1}=e,i=new Array(t.size);for(let n=0;n<i.length;++n)i[n]=[];return this._addClassNamesToList(i,t,this._userClasses),s&&this._addClassNamesToList(i,t,this._builtinClasses),i}_addClassNamesToList(t,e,s){const i=e.toList();for(let n=0;n<s.length;++n){const{name:r,elementSet:o}=s[n];for(let a=0;a<i.size;++a){const l=i.get(a);o.hasElement(l)&&t[a].push(r)}}}getClassByName(t,e=!1){const s=this._classesByName[t]||null;if(e&&!s)throw new Error(`class "${t}" does not exist`);return s&&s.wrapper}getClassList(){return this._userClasses.map(t=>t.wrapper)}getElementsByClass(t,e="visible"){const{elementSet:s}=this._get(t),i=s.getElements();let n=i.nodes,r=i.edges;return e==="visible"?(n=n.filter(o=>o.isVisible()),r=r.filter(o=>o.isVisible())):e==="raw"&&(n=n.filter(o=>!o.isVirtual()),r=r.filter(o=>!o.isVirtual())),{nodes:n,edges:r}}_onClassEvent(t,e,s,i){const n=bn(t,s,i);this._modules.events.on(n,e)}onNodeClassAdded(t,e){this._onClassEvent(t,e,!0,!0)}onNodeClassRemoved(t,e){this._onClassEvent(t,e,!0,!1)}onEdgeClassAdded(t,e){this._onClassEvent(t,e,!1,!0)}onEdgeClassRemoved(t,e){this._onClassEvent(t,e,!1,!1)}};function bn(t,e,s){return`${e?"node":"edge"}Class${s?"Added":"Removed"}_${t}`}function Kw(t,e){for(let s=0;s<t.length;++s)if(t[s].name===e)return s;return-1}var Yy=()=>({x:0,y:0,x1:0,y1:0,x2:0,y2:0});function Ng(t,e,s,{cells:i=!0,boxes:n=!0,query:r=!0}={}){const o=e.keys().map(l=>e.keyToBBox(Number(l))),a=e.getBoxes();if(i&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#707070",o.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.stroke()),n&&(t.beginPath(),t.lineWidth=1,t.strokeStyle="#ff7070",a.forEach(l=>{t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1])}),t.closePath(),t.stroke()),r&&s){const l=s;t.beginPath(),t.lineWidth=2,t.strokeStyle="#3030ff",t.rect(l[0],l[1],l[2]-l[0],l[3]-l[1]),t.closePath(),t.stroke()}}function Qw(t){const[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o]=t.getEdgeAttributes(["source","target","curvature"]),a=Yy(),l=Uh();return d=>{if(d<0){d=-d;const h=n.get(d),u=r.get(d),c=o.get(d),g=e.get(h),_=s.get(h),m=e.get(u),f=s.get(u);h===u?(un(g,_,c,i.get(h),0,a),gl(g,_,a.x1,a.y1,a.x2,a.y2,m,f,l)):c===0?(l.minX=Math.min(g,m),l.minY=Math.min(_,f),l.maxX=Math.max(g,m),l.maxY=Math.max(_,f)):(Bs(g,_,m,f,c,a),du(g,_,a.x,a.y,m,f,l))}else{const h=e.get(d),u=s.get(d),c=i.get(d);l.minX=h-c,l.minY=u-c,l.maxX=h+c,l.maxY=u+c}return[l.minX,l.minY,l.maxX,l.maxY]}}var Jw=["x","y","radius"],tT=["width","curvature"],eT=.5,sT=class extends Bt{constructor(){super(...arguments),this._minCellSize=8,this._clear=()=>{this._index.clear(),this._elementsToUpdate.clear()},this._onGraphUpdate=t=>{if(t.nodes&&(!t.nodeAttributes||t.nodeAttributes.some(e=>Jw.includes(e)))){const e=t.nodes.fastGetAdjacentElements().edges;this._elementsToUpdate.addElements(t.nodes),this._elementsToUpdate.addElements(e)}t.edges&&(t.edgeAttributes&&!t.edgeAttributes.some(e=>tT.includes(e))||this._elementsToUpdate.addElements(t.edges))}}onMounted(){this._index=new Pb(this._getIntersector(),Qw(this._modules.graph),this._minCellSize,1e6),this._elementsToUpdate=new so(this._modules.graph),this._removedNodes=this._modules.graph.getNodeAttribute("removed"),this._removedEdges=this._modules.graph.getEdgeAttribute("removed"),this._excludedNodes=this._modules.graph.getNodeAttribute("excluded"),this._excludedEdges=this._modules.graph.getEdgeAttribute("excluded"),this._queryResult={edges:[],nodes:[]},this._queryBounds=[0,0,0,0],this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges","updateAttributes"],this._onGraphUpdate).on("excludedStateChange",({elements:t})=>{this._elementsToUpdate.addElements(t)}).on("clearGraph",this._clear)}_getIntersector(){const t=this._modules.graph,[e,s,i]=t.getNodeAttributes(["x","y","radius"]),[n,r,o,a]=t.getEdgeAttributes(["source","target","width","curvature"]),l=Yy();return(d,h,u,c,g)=>{if(d<0){d=-d;const _=n.get(d),m=r.get(d),f=a.get(d),p=o.get(d)/2,y=e.get(_),b=s.get(_),x=e.get(m),v=s.get(m);return _===m?(un(y,b,f,i.get(_),0,l),of(y,b,l.x1,l.y1,l.x2,l.y2,x,v,h-p,u-p,c+p,g+p)):f===0?nu(y,b,x,v,h-p,u-p,c+p,g+p):(Bs(y,b,x,v,f,l),rf(y,b,l.x,l.y,x,v,h-p,u-p,c+p,g+p))}return qh(e.get(d),s.get(d),i.get(d),h,u,c,g)}}reindex(){this._modules.graphics.forceAttributesComputation(),this._index.clear(),this._elementsToUpdate.clear(),this._updateItems(this._modules.graph.getNodes("all")._indexes,this._modules.graph.getEdges("all")._indexes)}getSize(){return this._index.size}_updateIndex(){if(!this._elementsToUpdate.isEmpty()){const{nodes:t,edges:e}=this._elementsToUpdate.getElements();if(t._indexes.length/this._modules.graph.getNodes("all").size>eT)return void this.reindex();this._updateItems(t._indexes,e._indexes),this._elementsToUpdate.clear()}}_updateItems(t,e){const s=this._index,i=this._removedNodes,n=this._removedEdges,r=this._excludedNodes,o=this._excludedEdges,a=[],l=[];if(i&&r)for(let d=0;d<t.length;d++){const h=t[d];i.get(h)!==0||r.get(h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}if(n&&o)for(let d=0;d<e.length;d++){const h=-e[d];n.get(-h)!==0||o.get(-h)!==0?a.push(h):(s.has(h)&&a.push(h),l.push(h))}for(const d of a)s.remove(d);for(const d of l)s.insert(d)}getNodesInScreenByDistance(t){const{x:e,y:s}=t.getPositionOnScreen();return this._modules.graph.getNodes().filter(i=>i.isInScreen()&&i!==t).sort((i,n)=>{const r=i.getPositionOnScreen(),o=n.getPositionOnScreen();return Oe(r.x,r.y,e,s)-Oe(o.x,o.y,e,s)})}getNearestNodesForNode(t,e=240,s){const{x:i,y:n}=t.getPosition();return this.getNearestNodes(i,n,e,s,t)}getNearestNodes(t,e,s,i,n){if(this._updateIndex(),i){const r=this._modules.camera.screenToGraphVector({x:s,y:s});s=Oe(0,0,r.x,r.y)}return this._getNearestNodes(t,e,s,n)}_getNearestNodes(t,e,s,i){const n=[],r=s*s,o=i?i._index:0,a=this._modules.graph.getNodes()._indexes,[l,d]=this._modules.graph.getNodeAttributes(["x","y"]);for(let h=0,u=a.length;h<u;h++){const c=a[h];if(c===o)continue;const g=t-l.get(c),_=e-d.get(c);g*g+_*_<=r&&n.push(c)}return this._modules.graph.nodeList(new Uint32Array(n))}queryRaw(t,e,s,i){this._updateIndex();const n=this._queryBounds;n[0]=t,n[1]=e,n[2]=s,n[3]=i;const r=this._index.query(t,e,s,i),{nodes:o,edges:a}=this._queryResult;o.length=a.length=0;for(let l=0;l<r.length;l++){const d=r[l];d<0?a.push(-d):o.push(d)}return this._queryResult}queryRawProjected(t,e,s,i){const n=this._queryBounds;return n[0]=t,n[1]=e,n[2]=s,n[3]=i,this._modules.camera.projectBounds(n),this.queryRaw(n[0],n[1],n[2],n[3])}query(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRaw(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r.slice())),edges:n.edgeList(new Uint32Array(o.slice()))}}queryProjected(t,e,s,i){const n=this._modules.graph,{nodes:r,edges:o}=this.queryRawProjected(t,e,s,i);return{nodes:n.nodeList(new Uint32Array(r.slice())),edges:n.edgeList(new Uint32Array(o.slice()))}}getNodesByBoundingBox(t,e,s,i,n){if(this._updateIndex(),n){let u;u=this._modules.camera.screenToGraphVector({x:t,y:e}),t=u.x,e=u.y,u=this._modules.camera.screenToGraphVector({x:s,y:i}),s=u.x,i=u.y}const r=this._modules.graph,o=r.getNodes()._indexes,a=[],l=r.getNodeAttribute("excluded"),[d,h]=r.getNodeAttributes(["x","y"]);for(let u=0,c=o.length;u<c;u++){const g=o[u];if(l&&l.get(g))continue;const _=d&&d.get(g),m=h&&h.get(g);_>=t&&_<=s&&m>=e&&m<=i&&a.push(g)}return r.nodeList(new Uint32Array(a))}toggleDebug(t){t?(this._layer=this._modules.layers.addCanvasLayer(e=>{Ng(e,this._index,this._queryBounds)},{isStatic:!1,noClear:!1}),this._layer.moveToTop()):this._layer&&(this._layer.destroy(),this._layer=null)}renderDebug(t){if(!this._layer)return this.toggleDebug(!0);this._layer.refresh(e=>{Ng(e,this._index,this._queryBounds,t)})}},Zy={};function _l(t,e,s,i,n=0,r=Math.sin(n),o=Math.cos(n),a=[0,0,0,0]){const l=s/2,d=i/2,h=t+l,u=e+d;if(n===0)return a[0]=t,a[1]=e,a[2]=t+s,a[3]=e+i,a;let c,g,_,m,f,p,y,b;return _=-l,m=-d,c=h+_*o-m*r,g=u+_*r+m*o,f=y=c,p=b=g,_=-l,m=d,c=h+_*o-m*r,g=u+_*r+m*o,c<f?f=c:c>y&&(y=c),g<p?p=g:g>b&&(b=g),_=l,m=d,c=h+_*o-m*r,g=u+_*r+m*o,c<f?f=c:c>y&&(y=c),g<p?p=g:g>b&&(b=g),_=l,m=-d,c=h+_*o-m*r,g=u+_*r+m*o,c<f?f=c:c>y&&(y=c),g<p?p=g:g>b&&(b=g),a[0]=f,a[1]=p,a[2]=y,a[3]=b,a}function lo(t,e,s,i,n=0){const r=s/2,o=i/2,a=t+r,l=e+o;if(n===0)return[{x:t,y:e},{x:t+s,y:e},{x:t+s,y:e+i},{x:t,y:e+i}];const d=Math.sin(n),h=Math.cos(n);let u,c,g,_;g=-r,_=-o,u=a+g*h-_*d,c=l+g*d+_*h;const m={x:u,y:c};g=-r,_=o,u=a+g*h-_*d,c=l+g*d+_*h;const f={x:u,y:c};g=r,_=o,u=a+g*h-_*d,c=l+g*d+_*h;const p={x:u,y:c};return g=r,_=-o,u=a+g*h-_*d,c=l+g*d+_*h,[m,f,p,{x:u,y:c}]}function eh(t,e=0,s=1,i=Qm.slice()){const n=s*Math.sin(e),r=s*Math.cos(e);return i[0]=t[0]+n,i[1]=t[1]+r,i[2]=t[2]+n,i[3]=t[3]+r,i}function iT(t,e){return tf(t,e)}function nT(t,e){return Ky(t[0],t[1],t[2],t[3],e[0],e[1],e[2],e[3])}function rT(t,e,s,i,n,r,o,a){return t>n&&t<o&&e>r&&e<a||s>n&&s<o&&i>r&&i<a}function Ky(t,e,s,i,n,r,o,a){return i>=r&&e<=a&&s>=n&&t<=o}to(Zy,{angle:()=>BA,circleCircleIntersection:()=>Vh,circleContainsCircle:()=>fb,circleContainsPoint:()=>mb,circleIntersectsBox:()=>qh,circleLineIntersection:()=>ef,circleSortCompare:()=>jh,computeCentroid:()=>ou,cubicBezierAABB:()=>of,defaultAABB:()=>Qm,degreesToRadians:()=>_b,distToSegmentSquared:()=>ru,distance:()=>Oe,distancePointSegment:()=>vp,extendBounds:()=>tf,getAABB:()=>_l,getBezierCurveBoundingBox:()=>gl,getClosestPointOnLine:()=>GA,getClosestPointOnSegment:()=>Ep,getNormalOnEdge:()=>sS,getNormalOnQuadraticCurve:()=>wp,getOBBPoints:()=>lo,getPointOnBezierCurve:()=>$r,getPointOnEdge:()=>eS,getPointOnQuadraticCurve:()=>cl,getQuadraticBezierCurveLength:()=>nS,getQuadraticCurveBoundingBox:()=>du,getQuadraticCurveControlPoint:()=>Bs,getSelfLoopControlPoints:()=>un,getTangentOnEdge:()=>iS,getTangentOnQuadraticCurve:()=>lu,intersects:()=>rT,isPointInLine:()=>xp,isPointInPolygon:()=>Wr,isPointOnBezierCurve:()=>Lp,isPointOnQuadraticCurve:()=>Tp,lineAABB:()=>nu,lineAngle:()=>Hn,lineIntersection:()=>UA,lineLine:()=>Pn,move:()=>gb,moveAABB:()=>eh,normalize:()=>Jm,overlaps:()=>Ky,overlapsAABB:()=>nT,padBounds:()=>iT,polygonsIntersect:()=>Ap,quadBezierAABB:()=>rf,radiansToDegrees:()=>Cd,rotate:()=>Sa,segmentIntersection:()=>mr,segmentRectangleIntersection:()=>bp,squaredDistance:()=>da,twoSegmentsIntersect:()=>zA});var jo=40;function Qy(t,e){const s=t.getAttribute("curvature"),i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen();if(i===n){const m=(s+i.getAttribute("radius"))*Fa*e,f=r.x,p=r.y,y=f-m,b=p,x=f,v=p+m;return[r,...[.2,.4,.6,.8].map(E=>$r(E,f,p,f,p,y,b,x,v)),r]}const o=n.getPositionOnScreen();if(s===0)return[r,o];const a=o.x-r.x,l=o.y-r.y,d=Math.sqrt(a*a+l*l),h=(r.x+o.x)/2,u=(r.y+o.y)/2,c=s*(d/hl)*2,g=h+l/d*c,_=u+-a/d*c;return[r,...[.25,.5,.75].map(m=>cl(m,r.x,r.y,o.x,o.y,g,_)),o]}function oT(t,e,s){const i=t.getSource(),n=t.getTarget(),r=i.getPositionOnScreen(),o=n.getPositionOnScreen();if(Wr(r.x,r.y,e)||Wr(o.x,o.y,e))return!0;const a=Qy(t,s);for(let l=0;l<a.length-1;++l){const d=a[l],h=a[l+1];for(let u=0;u<e.length-1;++u){const c=e[u],g=e[u+1];if(Pn(d.x,d.y,h.x,h.y,c.x,c.y,g.x,g.y))return!0}}return!1}function aT(t,e,s){const i=t.getPositionOnScreen(),n=Number(t.getAttribute("radius"))*s,r=i.x-n,o=i.y-n,a=i.x+n,l=i.y+n;return a>=e.minX&&r<=e.maxX&&l>=e.minY&&o<=e.maxY}function lT(t,e,s){const i=Qy(t,s);for(let n=0;n<i.length-1;++n){const r=i[n],o=i[n+1];if(nu(r.x,r.y,o.x,o.y,e.minX,e.minY,e.maxX,e.maxY))return!0}return!1}function Fg(t,e,s,i){typeof s=="number"&&(s={left:s,right:s,top:s,bottom:s});const n=s.left===void 0?jo:s.left,r=s.right===void 0?jo:s.right,o=s.top===void 0?jo:s.top,a=s.bottom===void 0?jo:s.bottom,l=n+r,d=o+a,h=t.width===0?t.maxFixedSize:t.width,u=t.height===0?t.maxFixedSize:t.height,c=Nw([(e.width-l)/(h+t.maxScaledSize),(e.height-d)/(u+t.maxScaledSize),(e.width-l-t.maxFixedSize)/h,(e.height-d-t.maxFixedSize)/u,i/t.maxScaledSize||NaN]);return{x:t.cx+(r-n)/(2*c),y:t.cy+(a-o)/(2*c),zoom:c}}var dT="quadraticInOut",Pg=200,hT=class extends Bt{constructor(){super(...arguments),this._isLocating=!1,this._cacheValid=!0,this._cachedGraphBoundingBox=new je,this._invalidCache=()=>{this._cacheValid=!1}}onMounted(){this._modules.events.on(["addNodes","removeNodes","addEdges","removeEdges","excludedStateChange","clearGraph","updateAttributes"],this._invalidCache)}onReady(){this.locateGraph({},!0)}locateGraph(t,e=!1){return this._onLocateStart(),e?this._locateGraph(t):this._modules.transformations.whenApplied().then(()=>this._locateGraph(t))}_locateGraph(t){return this._locateBoundingBox(this.getGraphBoundingBox(),t).then(()=>this._onLocated())}locateElements(t,e){return this._modules.transformations.whenApplied().then(()=>this._locateBoundingBox(this.getBoundingBox(t),e)).then(()=>this._onLocated())}locateRawGraph(t,e){return this._onLocateStart(),this._locateBoundingBox(this.getRawGraphBoundingBox(t),e).then(()=>this._onLocated())}_onLocateStart(){this._isLocating=!0}_onLocated(){this._isLocating=!1}isLocating(){return this._isLocating}getGraphBoundingBox(t=!1){return t?this.getBoundingBox(this._ogma.getNodes(),!0,t):(this._cacheValid||this._updateCache(),Object.assign({},this._cachedGraphBoundingBox))}forceInvalidCache(){this._invalidCache()}_updateCache(){this._cacheValid=!0,this._cachedGraphBoundingBox=this.getBoundingBox(this._modules.graph.getNodes())}getBoundingBox(t,e=!1,s=!1,i){let n;if(n=t.isNode?this._getNodesBoundingBox(t.toList(),e):this._getEdgesBoundingBox(t.toList(),i),s){const r=this._ogma.modules.labels.getTextsBoundingBox(t.isNode?t.toList():null,t.isNode?null:t.toList());n=n.extend(r)}return n}_getNodesBoundingBox(t,e=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getNodeAttributes(),i=[],n=[],r=[],o=[];for(let a=0;a<t.size;++a){const l=t._indexes[a];if(s.excluded.get(l)===0){const d=s.x.get(l),h=s.y.get(l),u=s.radius.get(l),c=2*u;s.scalingMethod.get(l)==="scaled"?r.push(c):o.push(c),e?(i.push(d-u,d+u),n.push(h-u,h+u)):(i.push(d),n.push(h))}}return new je({xValues:i,yValues:n,scaledSizeValues:r,fixedSizeValues:o})}_getEdgesBoundingBox(t,e=!1){this._modules.graphics.forceAttributesComputation();const s=this._modules.graphics.getEdgeAttributes(),i=this._modules.graphics.getNodeAttributes(),n={x1:0,y1:0,x2:0,y2:0},r={x:0,y:0},o={minX:0,minY:0,maxX:0,maxY:0},a=[],l=[],d=[],h=[];for(let u=0;u<t.size;++u){const c=t._indexes[u],g=s.source.get(c),_=s.target.get(c),m=s.curvature.get(c),f=i.x.get(g),p=i.y.get(g),y=i.scalingMethod.get(g)==="scaled",b=2*i.radius.get(g),x=i.x.get(_),v=i.y.get(_),E=i.scalingMethod.get(_)==="scaled",w=2*i.radius.get(_);y?d.push(b):h.push(b),E?d.push(w):h.push(w),e||m===0?(a.push(f,x),l.push(p,v)):g===_?(un(f,p,m,b/2,0,n),gl(f,p,n.x1,n.y1,n.x2,n.y2,x,v,o),a.push(o.minX,o.maxX),l.push(o.minY,o.maxY)):(Bs(f,p,x,v,m,r),du(f,p,r.x,r.y,x,v,o),a.push(o.minX,o.maxX),l.push(o.minY,o.maxY))}return new je({xValues:a,yValues:l,scaledSizeValues:d,fixedSizeValues:h})}getRawGraphBoundingBox(t){const e=t.nodes.length,s=new Array(e),i=new Array(e),n=new Array(e);for(let r=0;r<e;r++){const o=t.nodes[r].attributes||{};s[r]=o.x||0,i[r]=o.y||0,n[r]=o.radius||5}return new je({xValues:s,yValues:i,scaledSizeValues:n})}_locateBoundingBox(t,e={}){if(isNaN(t.cx))return Promise.resolve();const{padding:s={},easing:i=dT,duration:n=0,maxNodeSizeOnScreen:r=Pg,ignoreZoomLimits:o=!1}=e,a=Fg(t,this._modules.dom.getDimensions(),s,r),l=a.x,d=a.y,h=a.zoom,u=h/this._modules.camera.getZoom();return this._moveCamera(l,d,h,n,i,u,o)}_moveCamera(t,e,s,i,n,r,o){return r>1.01?(this._modules.camera.setCenter({x:t,y:e},{duration:i,easing:n,ignoreZoomLimits:o}),this._modules.camera.setZoom(s,{duration:i,easing:n,ignoreZoomLimits:o,startAfter:.5})):r<.99?(this._modules.camera.setCenter({x:t,y:e},{duration:i,easing:n,ignoreZoomLimits:o,startAfter:.5}),this._modules.camera.setZoom(s,{duration:i,easing:n,ignoreZoomLimits:o})):this._modules.camera.setCenter({x:t,y:e},{duration:i,easing:n,ignoreZoomLimits:o})}computeConfigForBounds(t,e={}){const{padding:s={},maxNodeSizeOnScreen:i=Pg}=e;return Fg(t,this._modules.dom.getDimensions(),s,i)}layoutDataBoundingBox({x:t,y:e,indexes:s}){const i=this._modules.graphics.getNodeAttributes(),n=[],r=[],o=[],a=[];for(let l=0;l<s.length;++l){const d=s[l],h=t[l],u=e[l],c=2*i.radius.get(d),g=i.scalingMethod.get(d)==="scaled";n.push(h),r.push(u),g?o.push(c):a.push(c)}return new je({xValues:n,yValues:r,scaledSizeValues:o,fixedSizeValues:a})}isEdgeInPolygon(t,e){return oT(t,e,this._modules.camera.getZoom())}isElementInView(t,{margin:e=0}={}){const{width:s,height:i}=this._modules.camera.getSize(),n={minX:-e,minY:-e,maxX:s+e,maxY:i+e};return t.isNode?this.isNodeInRectangle(t,n):this.isEdgeInRectangle(t,n)}isNodeInRectangle(t,e){return aT(t,e,this._modules.camera.getZoom())}isNodeInPolygon(t,e){const s=t.getPositionOnScreen();return Wr(s.x,s.y,e)}isEdgeInRectangle(t,e){return lT(t,e,this._modules.camera.getZoom())}},uT=sn&&typeof navigator<"u"&&"msLaunchUri"in navigator&&di&&!("documentMode"in document);function cT(t){return uT?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/fs():t.deltaY&&t.deltaMode===1?20*-t.deltaY:t.deltaY&&t.deltaMode===2?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}var gT=6,_T=class extends Bt{constructor(){super(...arguments),this._px=0,this._py=0,this._pressX=0,this._pressY=0,this._left=!1,this._middle=!1,this._right=!1,this._clickCounter={left:0,middle:0,right:0},this._buttons={left:!1,middle:!1,right:!1},this._skipNextMove=!1,this._onMouseWheel=t=>{this._isEnabled()&&this._isWheelEnabled()&&(!this._disableWheelUntilMouseDown()||this._modules.dom.hasFocus())&&(t.preventDefault(),t.stopPropagation(),this._applyMouseWheelZoom(t))},this._onMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=e-this._px,n=s-this._py;i===0&&n===0||(this._skipNextMove?this._skipNextMove=!1:Oe(e,s,this._pressX,this._pressY)>=gT&&(this._resetClickCounter(),this._modules.events.fire("mousemoveInternal",{x:e,y:s,dx:i,dy:n,domEvent:this._evt})))},this._onDocumentMouseMove=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._bounds,n=e-this._px,r=s-this._py;(e<0||e>i.width||s<0||s>i.height)&&this._modules.events.fire("documentMouseMove",{x:e,y:s,dx:n,dy:r,domEvent:this._evt})},this._onMouseUp=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._evt;this._buttons[i]=!1,this._clickCounter[this._button]===1?this._modules.events.fire("clickInternal",{button:i,x:e,y:s,domEvent:n}):this._clickCounter[i]>1&&(this._modules.events.fire("doubleclickInternal",{button:i,x:e,y:s,domEvent:n}),this._resetClickCounter(i)),this._modules.events.fire("mouseupInternal",{button:i,x:e,y:s,domEvent:n})},this._onDocumentMouseup=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button;this._buttons[i]=!1;const n=this._modules.dom;this._modules.events.fire("documentMouseUp",{button:i,x:e,y:s,domEvent:this._evt}),n.removeDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.removeDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onMouseDown=t=>{if(!this._isEnabled()||!this._setXY(t))return;const e=this._modules.position.x,s=this._modules.position.y,i=this._button,n=this._modules.dom;this._skipNextMove=!0,this._pressX=e,this._pressY=s,this._lastMouseDownTarget=t.target,n.focus(),this._buttons[i]=!0,this._clickCounter[i]+=1;const r=i;this._dbclickTimer=n.setTimeout(()=>{this._resetClickCounter(r,0)},this._getDoubleClickTimer()),this._modules.events.fire("mousedownInternal",{button:i,x:e,y:s,domEvent:this._evt}),n.addDirectWindowEventListener("mousemove",this._onDocumentMouseMove),n.addDirectWindowEventListener("mouseup",this._onDocumentMouseup)},this._onDrop=t=>{if(!this._isEnabled()||!this._setXY(t))return;t.preventDefault();const{x:e,y:s}=this._modules.camera.screenToGraphCoordinates(this._modules.position);this._modules.events.fire("drop",{domEvent:this._evt,x:e,y:s})}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("mouse.enabled",!0),this._modules.settings.register("mouse.wheelEnabled",!0),this._modules.settings.register("mouse.disableWheelUntilMouseDown",!1),this._modules.settings.register("mouse.doubleClickTimer",500),this._modules.events.register(["mousedownInternal","mouseupInternal","mousemoveInternal","mousewheelInternal","clickInternal","doubleclickInternal","mouseoverInternal","mouseoutInternal","documentMouseUp","documentMouseMove","drop"]),this._modules.dom.afterNextFrame().then(()=>this._initializeListeners())}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get left(){return this._left}get right(){return this._right}get middle(){return this._middle}_isEnabled(){return this._modules.settings.get("mouse.enabled")}_isWheelEnabled(){return this._modules.settings.get("mouse.wheelEnabled")}_disableWheelUntilMouseDown(){return this._modules.settings.get("mouse.disableWheelUntilMouseDown")}_getDoubleClickTimer(){return this._modules.settings.get("mouse.doubleClickTimer")}_resetClickCounter(t,e=0){t?this._clickCounter[t]=e:(this._clickCounter.left=e,this._clickCounter.middle=e,this._clickCounter.right=e),this._modules.dom.clearTimeout(this._dbclickTimer),this._lastMouseDownTarget=null}_setXY(t){const e=this._domElt.getBoundingClientRect();return this._bounds=e,!!e&&(this._evt=t,this._button=Dh[t.button],this._px=this._modules.position.x,this._py=this._modules.position.y,this._modules.position.x=t.clientX-e.left,this._modules.position.y=t.clientY-e.top,this._left=this._buttons.left,this._right=this._buttons.right,this._middle=this._buttons.middle,!0)}_applyMouseWheelZoom(t){this._setXY(t)&&this._modules.events.fire("mousewheelInternal",{delta:cT(t),x:this._modules.position.x,y:this._modules.position.y,domEvent:this._evt})}_initializeListeners(){const t=this._domElt,e=this._modules.dom;Wa&&this._modules.dom.addElementEventListener(document,"contextmenu",i=>{this._lastMouseDownTarget&&i.target!==this._lastMouseDownTarget&&i.preventDefault()}),e.addElementEventListener(t,"contextmenu",i=>{this._setXY(i),this._modules.dom.hasFocus()&&this._modules.settings.get("mouse.enabled")&&i.preventDefault()},!1);const s="onwheel"in t?"wheel":t.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";e.addElementEventListener(t,s,this._onMouseWheel),e.addElementEventListener(t,"mousemove",this._onMouseMove),e.addElementEventListener(t,"mouseleave",i=>{if(!this._isEnabled())return;this._modules.dom.blur();const n=t.getBoundingClientRect();i.clientX>=n.left+1&&i.clientX<=n.right-1&&i.clientY>=n.top+1&&i.clientY<=n.bottom-1||this._modules.events.fire("mouseout",{domEvent:this._evt})}),e.addElementEventListener(t,"mousedown",this._onMouseDown),e.addElementEventListener(t,"mouseup",this._onMouseUp),e.addElementEventListener(t,"dragover",i=>{i.preventDefault()}),e.addElementEventListener(t,"drop",this._onDrop)}},mT={doubleTapTimer:500,touchEventRate:15},fT=class extends Bt{constructor(){super(...arguments),this._pressed=!1,this._addEvent=(t,e,s,i)=>{this._modules.dom.addElementEventListener(t,e,s,i)},this._addWinEvent=(t,e,s,i)=>{this._modules.dom.addDirectWindowEventListener(e,s,i)},this._removeWinEvent=(t,e,s)=>{this._modules.dom.removeDirectWindowEventListener(e,s)}}onMounted(){this._domElt=this._modules.graphics.getDomElement(),this._modules.settings.register("touch.enabled",!0),this._modules.events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]),this._modules.dom.afterNextFrame().then(()=>{this._initialize(this)})}get x(){return this._modules.position.x}get y(){return this._modules.position.y}get pressed(){return this._pressed}_listen(t,e,s){if(yf){if(e==="touchstart")return gv(this._addEvent,t,s);if(e==="touchmove")return mv(this._addWinEvent,t,s);if(e==="touchend")return fv(this._addWinEvent,t,s);if(e==="touchcancel")return _v(this._addWinEvent,t,s)}return this._modules.dom.addElementEventListener(t,e,s)}_initialize(t){let e=0,s=0,i=0,n=0,r=!1,o="left",a=0,l=!1,d=!1,h=0,u=null,c=null;const g=()=>{this._modules.position.x=e,this._modules.position.y=s,this._pressed=r},_=(x,v)=>{const E=this._domElt.getBoundingClientRect();if(!E||x.touches==null)return null;const[w,A]=x.touches,I=w.clientX-E.left,M=w.clientY-E.top,k=A.clientX-E.left,W=A.clientY-E.top,H=(I+k)/2,$=(M+W)/2,P=H-e,S=$-s,Y=Oe(I,M,k,W),st=this._modules.settings.get("interactions.zoom.speed")||th,at=cp(Y,st),Tt=Hn(I,M,k,W),ut={dx:P,dy:S,rotation:Tt-h,scale:at};return((Mt,Nt,_t,St)=>{h=Nt,e=_t,s=St,g()})(0,Tt,H,$),ut},m=x=>{if(x.touches&&x.touches.length===2&&d){const v=_(x);if(v){const{dx:E,dy:w,rotation:A,scale:I}=v;this._modules.events.fire("touchProgressGesture",{dx:E,dy:w,rotation:A,scale:I,x:e,y:s,domEvent:u,button:o})}}},f=x=>{if(o=Dh[x.button],!x.touches)return!1;if(x.touches.length!==1)return r=!1,x.touches.length>1&&this._modules.events.fire("touchUp",{x:e,y:s,domEvent:u,button:o}),!1;const v=this._domElt.getBoundingClientRect();return v&&(i=e,n=s,e=x.touches[0].clientX-v.left|0,s=x.touches[0].clientY-v.top|0,r=!0,u=x,g()),!0},p=()=>{a=0,this._modules.dom.clearTimeout(c)},y=x=>{if(x.preventDefault(),!x.touches)return;if(x.touches.length!==2&&d&&(d=!1,this._modules.events.fire("touchEndGesture",{domEvent:u})),f(x),x.touches.length===0){const E={x:e,y:s,domEvent:u,button:o};a===1&&this._modules.events.fire("touchTap",E),a>1&&(this._modules.events.fire("touchDoubleTap",E),p()),this._modules.events.fire("touchUp",E)}const v=hi().documentElement;ac(this._removeWinEvent,v,"touchmove",this._onMove),ac(this._removeWinEvent,v,"touchend",this._onEnd)},b=x=>{m(x),l?l=!1:(p(),f(x)&&this._modules.events.fire("touchMove",{x:e,y:s,dx:e-i,dy:s-n,domEvent:u,button:o}))};this._listen(this._domElt,"touchstart",x=>{if(!x.touches)return;x.touches.length!==2||d||_(x)&&(d=!0,this._modules.events.fire("touchStartGesture",{domEvent:u})),f(x)&&(this._modules.dom.focus(),this._modules.events.fire("touchDown",{x:e,y:s,domEvent:u,button:o}),a+=1,c=this._modules.dom.setTimeout(p,mT.doubleTapTimer),l=!0);const v=hi().documentElement;this._onMove=this._listen(v,"touchmove",b),this._onEnd=this._listen(v,"touchend",y)})}},Dg=["x","y","radius"],qo=-1e7,pT=class extends Bt{constructor(){super(...arguments),this._visibleGroups=new Set,this._visualGroupsLayers=new Map,this._groupsToHide=[],this._paddingMap=new Map,this._shouldUpdateGroups=!1,this._onGroupingRun=({metaNodes:t,padding:e})=>{isNaN(+e)?t._indexes.forEach((s,i)=>this._paddingMap.set(s,e[i])):t._indexes.forEach(s=>this._paddingMap.set(s,e)),this._shouldUpdateGroups=!0},this._onRemoveNodes=({nodes:t})=>{t.forEach(e=>this.removeVisibleGroup(e))},this._onSetMultipleAttributes=({elements:t,values:e,options:s})=>{if(this._recursiveGuard||!this._visibleGroups.size)return;const i=t.toList().map((n,r)=>({group:n,translation:e.constructor===Array?{x:e[r]&&e[r].x||0,y:e[r]&&e[r].y||0}:{x:e.x||0,y:e.y||0},isGroup:n.isNode&&this._visibleGroups.has(n._index)})).filter(({isGroup:n})=>n);i.length&&(this._recursiveGuard=!0,i.forEach(({group:n,translation:r})=>this.animateChildren(n,s,r)),this._recursiveGuard=!1)},this._updateVisualGroups=(t,e,s)=>{const i=s.nodes.getUpdatedElementsList().filter(l=>l),n=t.nodes.outputFlexArrays,r=t.nodes.inputFlexArrays,o=this._visibleGroups;if(i.size===0||o.size===0&&!this._groupsToHide.length)return t.nodes.toUpdate.clear(),t.edges.toUpdate.clear(),n.radius.reset(),n.x.reset(),n.y.reset(),void(t.nodes.formattedOutput&&(t.nodes.formattedOutput.attributes=[]));const a=s.nodes.getUpdatedAttributes();for(;this._groupsToHide.length>0;){const l=this._groupsToHide.pop();n.radius.set(l,void 0),n.x.set(l,void 0),n.y.set(l,void 0)}if(a.has("x")||a.has("y")||a.has("radius")||this._shouldUpdateGroups){this._shouldUpdateGroups=!1;const l=this._getAllSubNodes(i);let d=this._getAllMetaNodes(i);const h=t.nodes.toUpdate,u=t.edges.toUpdate,c=this._subNodeOffsetX,g=this._subNodeOffsetY;t.nodes.formattedOutput&&t.nodes.output&&(t.nodes.formattedOutput.attributes=Dg,t.nodes.output.attributes=Dg);const _=new Set;i.forEach(m=>{const f=m._index;n.x.set(f,void 0),n.y.set(f,void 0),_.add(f)}),l.forEach(m=>{if(!r)return;const f=m.getMetaNode(),p=m._index;let y=r.x.get(p),b=r.y.get(p);if(f&&o.has(f._index)){const x=c.get(p),v=g.get(p),E=n.x.get(f._index),w=n.y.get(f._index),A=y-E,I=b-w;if(x===qo||v===qo)return c.set(p,A),g.set(p,I),void(d.includes(f)||(d=d.concat(f.toList())));h.addIndex(p),u.add(m.getAdjacentEdges()),_.has(p)||x===A&&v===I||(y=E+x,b=w+v,n.x.set(p,y),n.y.set(p,b)),c.set(p,y-E),g.set(p,b-w)}}),d.forEach(m=>{const f=m.getSubNodes();if(!f)return;const p=n.x.getMultiple(f._indexes),y=n.y.getMultiple(f._indexes),b=n.radius.getMultiple(f._indexes),x=je.fromValues(p,y,b),[v,E,w]=x.width===x.height&&x.width===x.maxScaledSize?[x.cx,x.cy,x.maxScaledSize]:el(p,y,b),A=this._paddingMap.get(m._index)||0;f.forEach((I,M)=>{c.set(I._index,p[M]-v),g.set(I._index,y[M]-E)}),n.x.set(m._index,v),n.y.set(m._index,E),n.radius.set(m._index,w+A),h.addIndex(m._index),u.add(m.getAdjacentEdges())}),s.nodes.addUpdatedAttribute("radius"),s.nodes.addUpdatedAttribute("x"),s.nodes.addUpdatedAttribute("y"),s.nodes.redrawElements(d)}}}onMounted(){this._subNodesList=this._modules.graph.createNodeAttribute({storage:"any",default:null},!1),this._subEdgesList=this._modules.graph.createEdgeAttribute({storage:"any",default:null},!1),this._metaNodeList=this._modules.graph.createNodeAttribute({storage:"any",default:null},!1),this._metaEdgeList=this._modules.graph.createEdgeAttribute({storage:"any",default:null},!1),this._subNodeOffsetX=this._modules.graph.createNodeAttribute({storage:"float",default:qo},!1),this._subNodeOffsetY=this._modules.graph.createNodeAttribute({storage:"float",default:qo},!1),this._recursiveGuard=!1,this._modules.events.register(["groupingRun"]),this._modules.events.on("setMultipleAttributes",this._onSetMultipleAttributes).on("groupingRun",this._onGroupingRun).on("removeNodes",this._onRemoveNodes),this._groupAttributeLayer=this._modules.graphics.addAttributeLayer({name:`internal(${Fv})`,priority:7,nodeSelector:t=>this._visibleGroups.has(t._index),edgeSelector:t=>t.isVirtual(),nodeAttributes:{layer:t=>this._visualGroupsLayers.get(t._index)},nodeOutput:{attributes:["layer"]},nodeDependencies:{self:{data:!1,attributes:["radius"],hover:!0},adjacentNodes:{attributes:"all"},adjacentEdges:{attributes:"all"}}}),this._topologyLayer=this._modules.graphics.addAttributeLayer({name:"internal(position-forcer)",priority:6.9,nodeDependencies:{self:{attributes:["x","y","radius"]},adjacentNodes:{attributes:"all"}},onBeforeUpdate:this._updateVisualGroups,nodeOutput:{attributes:["x","y","radius","layer"]}})}animateChildren(t,e,s){s.x===0&&s.y===0||t.getSubNodes().forEach(i=>{const n=this._subNodeOffsetX.get(i._index),r=this._subNodeOffsetY.get(i._index),o={x:s.x+n,y:s.y+r};i.setAttributes(o,e),i.getSubNodes()&&this.animateChildren(i,e,o)})}resetOffsets(){this._recursiveGuard=!0;const t=this._modules.graph.getNodes(),e=this._topologyLayer.getFlexArrays().nodes;t.setAttribute("x",e.x.getMultiple(t._indexes)),t.setAttribute("y",e.y.getMultiple(t._indexes)),e.x.reset(),e.y.reset(),this._recursiveGuard=!1}addVisibleGroup(t,e){this._visualGroupsLayers.set(t._index,e),this._visibleGroups.add(t._index)}getNodeDepth(t){return this._visualGroupsLayers.get(t._index)||0}removeVisibleGroup(t){const e=t._index;this._visibleGroups.delete(e)&&(this._groupsToHide.push(e),this._visualGroupsLayers.delete(e))}_getAllSubNodes(t){const e=Array.from(t._indexes),s=[],i=this._visibleGroups,n=this._subNodesList;for(;e.length!==0;){const r=e.pop();if(r!=null&&i.has(r)){const o=n.get(r),a=Array.from(o._indexes);s.push.apply(s,a),e.unshift.apply(e,a)}}return this._modules.graph.nodeList(new Uint32Array(s))}_getAllMetaNodes(t){const e=Array.from(t._indexes),s=this._visibleGroups,i=this._metaNodeList,n=[],r=new Set;for(;e.length!==0;){const o=e.pop();if(o!=null){const a=i.get(o);a!==null&&!r.has(a._index)&&s.has(a._index)&&(r.add(a._index),n.push(a._index),e.unshift(a._index))}}return this._modules.graph.nodeList(new Uint32Array(n))}isVisibleGroup(t){return this._visibleGroups.has(t._index)}getSubNodeOffset(t){return{x:this._subNodeOffsetX.get(t._index),y:this._subNodeOffsetY.get(t._index)}}_fetchSubEltsList(t){return t?this._subNodesList:this._subEdgesList}_fetchMetaEltList(t){return t?this._metaNodeList:this._metaEdgeList}setSubElements(t,e){this._fetchSubEltsList(t.isNode).setMultiple(t._indexes,e)}setMetaElement(t,e){this._fetchMetaEltList(t.isNode).setMultiple(t._indexes,e)}getSubElements(t){return this._fetchSubEltsList(t.isNode).getMultiple(t._indexes)}getMetaElement(t){return this._fetchMetaEltList(t.isNode).getMultiple(t._indexes)}},yT=class extends Bt{constructor(){super(...arguments),this._list=[],this._idCounter=0,this._mustRefresh=!1,this._safeGuard=!1,this._preventFiringEvents=!1,this._afterCurrentUpdate=Promise.resolve(),this._destroyed=!1,this._update=()=>{let t=Promise.resolve();this._modules.captor.setDetectionEnabled(!1);const e=this._list.filter(({shouldDo:o})=>o),s=this._list.filter(({enabled:o,shouldUndo:a})=>o||a);let i,n,r=!1;if(s.length===1&&e.length===0&&kg(s,e,e.length)){const o=s.pop();i=o?[o]:[],n=[],r=!0}else if(e.length===1&&s.length===0&&kg(s,e,s.length)){i=[];const o=e.pop();n=o?[o]:[],r=!0}else i=s,n=e,r=!1;return t=t.then(()=>this._resolveTransformations(i,n,r)).then(()=>this._modules.captor.setDetectionEnabled(!0)).then(()=>{i.filter(({shouldUndo:o})=>o).forEach(o=>{o.shouldUndo=!1,o.enabled=!1}),n.forEach(o=>{o.shouldDo=!0,o.enabled=!0})}),t}}onMounted(){this._modules.classes.createClass({name:Fe,isBuiltin:!0,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0}}),this._modules.classes.createClass({name:vi,isBuiltin:!0,nodeAttributes:{opacity:0},edgeAttributes:{opacity:0}}),this._nodeTransformationIdList=this._modules.graph.createNodeAttribute({storage:16,default:0},!1),this._edgeTransformationIdList=this._modules.graph.createEdgeAttribute({storage:16,default:0},!1),this._modules.settings.register("transformations.updateOnDataChange",!0),this._modules.events.register(["transformationEnabled","transformationDisabled","transformationSetIndex","transformationDestroyed","transformationRefresh"]),this._modules.events.on("clearGraph",()=>{this._list.forEach(t=>t.resetContext())}),this._modules.events.on(["addNodes","addEdges","removeNodes","removeEdges"],({virtual:t})=>{t||this._afterCurrentUpdate.then(()=>this.refresh(!0))}).on("requestElementsToDelete",t=>{t.virtual||(t.elementsToRemove=this._getSubElements(t.elementsToRemove),t.elementsToRemove.size&&this._resolveTransformations(this._list,[],!1))}).on(["updateNodeData","updateEdgeData"],()=>{this._modules.settings.get("transformations.updateOnDataChange")&&!this._safeGuard&&this.refresh(!0)})}refresh(t=!1){return this._list.length===0?Promise.resolve():(this._mustRefresh||this._safeGuard||(this._preventFiringEvents=!0,this._mustRefresh=!0,this._safeGuard=!0,this._afterCurrentUpdate=this._afterCurrentUpdate.then(()=>this._update()).then(()=>(this._modules.dom.refresh(),this._modules.dom.afterNextFrame())).then(()=>(this._modules.dom.refresh(),this._mustRefresh=!1,this._safeGuard=!1,this._list.forEach(e=>{if(e.getError())return e.cleanup(),e.resetContext(),e.reject();e.resolve(),this._preventFiringEvents=!t,this._fireEvent("transformationRefresh",{target:e}),this._preventFiringEvents=!1}),Promise.resolve()))),this._afterCurrentUpdate)}getById(t){return this._list.find(e=>e.getId()===t)}_fireEvent(t,e){this._preventFiringEvents||this._destroyed||this._modules.events.fire(t,e)}_getSubElements(t){return t.reduce((e,s)=>{if(s===void 0)return e;const i=this._modules.grouping.getSubElements(s)[0];return i?e.concat(this._getSubElements(i)):e.concat(s)},t.slice(0,0))}_assignTransformationIds(t,e,s){e!==null&&this._nodeTransformationIdList.setMultiple(e._indexes,t),s!==null&&this._edgeTransformationIdList.setMultiple(s._indexes,t)}_resolveTransformations(t,e,s){if(s||(t.forEach(o=>o.setDuration(0)),e.forEach(o=>o.setDuration(0))),this._destroyed)return Promise.resolve();const i=this._modules.selection.getSelectedNodes().getId(),n=this._modules.selection.getSelectedEdges().getId();let r=Promise.resolve();return t.slice().reverse().forEach(o=>{o.getContext()!==null&&(r=r.then(()=>o.undo()))}),e.forEach(o=>{r=r.then(()=>o.run()).catch(a=>(o.setError(a),!0)).then(a=>{if(a===!0)return Promise.resolve();const l=a;return this._assignTransformationIds(o.getId(),l.virtualNodes,l.virtualEdges),o.setContext(l),Promise.resolve()})}),r=r.then(()=>{this._destroyed||(this._modules.graph.getNodes(i).setSelected(!0),this._modules.graph.getEdges(n).setSelected(!0))}),r}getList(){return this._list}clear(){const t=this._list.slice();return t.forEach(e=>{e.shouldUndo=!0,e.shouldDo=!1,e.setRemovalDuration(0)}),this.refresh().then(()=>(this._list=this._list.filter(e=>!t.includes(e)),Promise.resolve())).then(()=>Promise.all(t.slice().reverse().map(e=>e.cleanup()))).then(()=>{t.forEach(e=>{this._fireEvent("transformationDestroyed",{target:e})})})}_get(t,e=!0){const s=this._list.find(i=>i.getId()===t);if(!s){if(e)throw new Error("calling a method on a destroyed transformation");return null}return s}enable(t,e){return this._afterCurrentUpdate.then(()=>(t.shouldDo=!0,t.shouldUndo=t.enabled,t.setDuration(e),this.refresh())).then(()=>{this._preventFiringEvents||this._fireEvent("transformationEnabled",{target:t})})}disable(t,e){return this._afterCurrentUpdate.then(()=>(t.shouldUndo=!0,t.shouldDo=!1,t.setRemovalDuration(e),this.refresh())).then(()=>{this._preventFiringEvents||this._fireEvent("transformationDisabled",{target:t})})}remove(t,e){return this._afterCurrentUpdate.then(()=>(t.setRemovalDuration(e),t.shouldUndo=!0,t.shouldDo=!1,this.refresh().then(()=>{t.cleanup(),this._list.splice(t.getIndex(),1)}))).then(()=>{this._fireEvent("transformationDestroyed",{target:t})})}setIndex(t,e){if(!t)return this._afterCurrentUpdate;let s,i;return this._preventFiringEvents=!0,this._afterCurrentUpdate.then(()=>{const n=t.getIndex(),r=Math.min(n,e);return s=this._list.slice(r).filter(o=>o.isEnabled()),i=s.map(o=>[o.getDuration(),o.getRemovalDuration()]),s.forEach(o=>o.disable(0)),this.refresh()}).then(()=>(this._list.splice(t.getIndex(),1),this._list.splice(bs(e,0,this._list.length),0,t),s.forEach((n,r)=>{n.enable(0)}),this.refresh())).then(()=>(s.forEach((n,r)=>{n.setDuration(i[r][0]),n.setRemovalDuration(i[r][1])}),this._afterCurrentUpdate)).then(()=>{this._preventFiringEvents=!1,this._fireEvent("transformationSetIndex",{target:t,index:e})})}setOptions(t,e){return t._setOptions(e),t.setDuration(e.duration),t.enabled===e.enabled&&t.enabled?this.refresh(!0):e.enabled?this.enable(t,e.duration):this.disable(t,e.duration)}getIndex(t){for(let e=0;e<this._list.length;e++)if(this._list[e]===t)return e;return-1}add(t){return this._list.push(t),t.initialize({ogma:this._ogma,id:++this._idCounter}),this.refresh().then(()=>t.isEnabled()?this._fireEvent("transformationEnabled",{target:t}):this._fireEvent("transformationDisabled",{target:t})),t}whenApplied(){return this._modules.dom.afterNextFrame().then(()=>this._afterCurrentUpdate)}isEnabled(t){const e=this._get(t);return e&&e.enabled||!1}_getElementTransformationId(t){return(t.isNode?this._nodeTransformationIdList:this._edgeTransformationIdList).get(t._index)}isElementVirtual(t){return this._modules.graph.getAttribute(t.isNode,"virtual").get(t._index)!==0}getElementTransformation(t){return this._get(this._getElementTransformationId(t),!1)}destroy(){this._destroyed=!0}};function kg(t,e,s){for(let i=0;i<s;++i)if(!t[i]||!e[i]||t[i].getId()!==e[i].getId())return!1;return!0}var Rg={layer:Tf,outline:!0,outerStroke:{color:qd,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:Hp,minVisibleSize:0}},xT={layer:Tf,color:qd,text:{backgroundColor:Hp,minVisibleSize:0},stroke:{color:qd,width:0}},bT=class extends Bt{onMounted(){this._modules.events.register(["nodesSelected","nodesUnselected","edgesSelected","edgesUnselected"]),this._selectionExtremityHighlightedClass=this._modules.classes.createClass({name:Dd,isBuiltin:!0,nodeAttributes:Rg}),this._selectedClass=this._modules.classes.createClass({name:Ae,isBuiltin:!0,nodeAttributes:Rg,edgeAttributes:xT}),this._modules.events.on(`nodeClassAdded_${Ae}`,e=>{this._modules.events.fire("nodesSelected",e)}),this._modules.events.on(`edgeClassAdded_${Ae}`,e=>{this._modules.events.fire("edgesSelected",e)}),this._modules.events.on(`nodeClassRemoved_${Ae}`,e=>{this._modules.events.fire("nodesUnselected",e)}),this._modules.events.on(`edgeClassRemoved_${Ae}`,e=>{this._modules.events.fire("edgesUnselected",e)}),this._modules.settings.register("interactions.selection.enabled",!0),this._modules.settings.register("interactions.selection.multiSelectionKey","ctrl"),this._modules.interactions.onClick({priority:"selection",check:({button:e})=>{const s=!!this._modules.settings.get("interactions.selection.enabled");return e==="left"&&s},handler:({target:e})=>{if(e){const s=this._modules.settings.get("interactions.selection.multiSelectionKey"),i=s&&this._modules.keyboard.isPressed(s);e.isNode?this._selectedClass.clearEdges():this._selectedClass.clearNodes(),i?e.hasClass(Ae)?e.removeClass(Ae):e.addClass(Ae):((e.isNode?this._selectedClass.getNodes():this._selectedClass.getEdges()).filter(n=>n!==e).removeClass(Ae),e.hasClass(Ae)||e.addClass(Ae))}else this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}});const t=()=>{this._selectionExtremityHighlightedClass.clearNodes(),this._selectedClass.getEdges().getExtremities().addClass(Dd)};this._modules.events.on("beforeRemoveEdges",({edges:e})=>e.setSelected(!1)).on("excludedStateChange",({elements:e,value:s})=>{s||e.setSelected(!1)}).on(`edgeClassAdded_${Ae}`,t).on(`edgeClassRemoved_${Ae}`,t)}setNodeAttributes(t,e){this._selectedClass.update({nodeAttributes:t,fullOverwrite:e}),this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}setEdgeAttributes(t,e){this._selectedClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}_updateExtremityHighlightLayer(){const t=this._selectedClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}setActive(t,e){if(Qe(e)){const s=[],i=[];t.toList().forEach((n,r)=>{(e[r]?s:i).push(n.getId())}),s.length!==0&&this._modules.graph.getElements(t.isNode,s).addClass(Ae),i.length!==0&&this._modules.graph.getElements(t.isNode,i).removeClass(Ae)}else t.size&&t[e?"addClass":"removeClass"](Ae)}areActive(t){return t.hasClass(Ae)}getSelectedNodes(){return this._selectedClass.getNodes()}getSelectedEdges(){return this._selectedClass.getEdges()}getNonSelectedNodes(){return this._modules.graph.getNodes().filter(t=>!t.hasClass(Ae))}getNonSelectedEdges(){return this._modules.graph.getEdges().filter(t=>!t.hasClass(Ae))}clear(){this._selectedClass.clearNodes(),this._selectedClass.clearEdges()}},vT=class extends Bt{onMounted(){this._delayedCalls=[],this._idIdle=()=>!this._modules.captor.isAnyButtonPressed()&&!this._modules.dom.isPlayingFrame(),this._modules.events.on(["mousedown","mouseup","beforeNewFrame","frame"],()=>{this._delayedCalls.forEach(t=>t.reset())})}_nextTimeIdle(t){const e=new ET(this._modules.dom,this._idIdle,t);return this._delayedCalls.push(e),e.whenDone().then(()=>{this._delayedCalls.splice(this._delayedCalls.indexOf(e),1)})}debounceIdle(t,e=0){let s=!1,i=[];const n=()=>{const r=i;s=!1,i=[],t(),r.forEach(o=>o())};return()=>new Promise(r=>{i.push(r),s||(s=!0,this._nextTimeIdle(e).then(n))})}},ET=class{constructor(t,e,s){this._timeout=null,this._done=!1,this._dom=t,this._promise=new Promise(i=>this._resolve=i),this._isIdle=e,this._delay=s,this._startTimeout()}_startTimeout(){this._timeout=this._dom.setTimeout(()=>{this._isIdle()?(this._done=!0,this._resolve()):this._startTimeout()},this._delay)}reset(){this._done||(this._dom.clearTimeout(this._timeout),this._startTimeout())}whenDone(){return this._promise}},Ho=-2,AT={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:50,startRatio:1,endRatio:2,enabled:!1},ST={number:1,duration:1e3,interval:800,startColor:"rgba(0,0,0,0.6)",endColor:"rgba(0,0,0,0.0)",width:10,startRatio:1,endRatio:2,enabled:!1},wT=class extends Bt{constructor(){super(...arguments),this._nodePromiseMap=new Map,this._edgePromiseMap=new Map,this._onAttributeChange=({nodes:t,edges:e,nodeAttributes:s,edgeAttributes:i})=>{this._onElementsAttributeChange(t,s),this._onElementsAttributeChange(e,i,!1)},this._refreshPulses=()=>{const{nodes:t,edges:e}=this._hasPulses.getElements();if(t.size!==0||e.size!==0){const s=this._engine.getCurrentTime();this._refreshElementsPulses(t,s),this._refreshElementsPulses(e,s),this._modules.dom.refresh()}}}onMounted(){this._modules.events.on("updateAttributes",this._onAttributeChange).on("frame",this._refreshPulses).on("beforeRemoveEdges",({edges:t})=>{this._removePulses(t)}).on("beforeRemoveNodes",({nodes:t})=>{this._removePulses(t)}).on("excludedStateChange",({elements:t,value:e})=>{e&&(this._hasPulses.removeElements(t),this._removePulses(t))}).on("clearGraph",()=>this._hasPulses.clear()),this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._nodePulses=this._modules.graph.createNodeAttribute({storage:"any"},!1),this._edgePulses=this._modules.graph.createEdgeAttribute({storage:"any"},!1),this._nodeNbPulsesRemaining=this._modules.graph.createNodeAttribute({storage:"int16",default:-1},!1),this._edgeNbPulsesRemaining=this._modules.graph.createEdgeAttribute({storage:"int16",default:-1},!1),this._nodeFlexArrays=this._modules.graphics.getNodeAttributes(),this._edgeFlexArrays=this._modules.graphics.getEdgeAttributes(),this._edgeSourceList=this._modules.graph.getEdgeAttribute("source"),this._edgeTargetList=this._modules.graph.getEdgeAttribute("target"),this._hasPulses=new so(this._modules.graph)}_onElementsAttributeChange(t,e,s=!0){if(!e.includes("pulse.enabled"))return;const{valid:i,invalid:n}=Ff(this._modules.graph,t,o=>o.getAttribute("pulse.enabled")&&o.isVisible());this._hasPulses.removeElements(n),this._hasPulses.addElements(i);const r=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let o=0;o<i.size;o++)r.get(i._indexes[o])>0||r.set(i._indexes[o],Ho);this._removePulses(n)}_removePulses(t){const e=t.isNode?this._nodePulses:this._edgePulses,s=t.isNode?this._nodePromiseMap:this._edgePromiseMap;for(let i=0;i<t._indexes.length;i++){const n=t._indexes[i],r=e.get(n);if(r){for(let a=0;a<r.length;a++){const l=r[a];this._modules.graphics.releaseGraphicsEngineBlockId(l.blockId)}e.set(n,null);const o=s.get(n);o&&(o.resolve(),s.delete(n))}}}_refreshElementsPulses(t,e){const s=t.isNode,i=s?this._nodePulses:this._edgePulses,n=s?this._nodeFlexArrays.pulse.duration:this._edgeFlexArrays.pulse.duration,r=s?"_createNodePulseBlock":"_createEdgePulseBlock",o=s?this._nodeFlexArrays.pulse.interval:this._edgeFlexArrays.pulse.interval,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining;for(let l=0;l<t._indexes.length;l++){const d=t._indexes[l];let h=i.get(d);h||(h=[],i.set(d,h));for(let m=0;m<h.length;m++){const{startTime:f,duration:p,blockId:y}=h[m];e>=f+p&&(this._modules.graphics.releaseGraphicsEngineBlockId(y),h.splice(m--,1))}const u=h[h.length-1];if(u&&e<u.startTime+o.get(d))continue;const c=n.get(d),g=a.get(d);if(g<1&&g!==Ho)continue;h.push({blockId:this[r](d,e,c),startTime:e,duration:c});const _=g===Ho?Ho:g-1;a.set(d,_)}}_createNodePulseBlock(t,e,s){const i=this._nodeFlexArrays,n=i.color.get(t),r=i.layer.get(t),o=i.x.get(t),a=i.y.get(t),l=i.radius.get(t),d=i.scalingMethod.get(t)==="scaled",h=i.pulse.startRatio.get(t),u=i.pulse.endRatio.get(t),c=i.pulse.width.get(t),g=2*l*h,_=2*l*u,m=Xr(r).nodeBody,f=i.pulse.startColor.get(t),p=i.pulse.endColor.get(t),y=this._modules.graphics.allocateGraphicsEngineBlockId(),b=this._group.reset(Rs,!0,m),x=b.nextAndReset(),v=zs(f,n),E=zs(p,n);return x.end.shape="circle",x.end.pieceId=Ns,x.end.x1=o,x.end.y1=a,x.end.x2=o,x.end.y2=a,x.end.rectWidthOrSourceRadiusScaled=d?_:0,x.end.rectHeightOrTargetRadiusScaled=d?_:0,x.end.rectWidthOrSourceRadiusFixed=d?0:_,x.end.rectHeightOrTargetRadiusFixed=d?0:_,x.end.strokeWidthFixed=c,x.end.strokeColor=E,x.start.shape="circle",x.start.pieceId=Ns,x.start.x1=o,x.start.y1=a,x.start.x2=o,x.start.y2=a,x.start.rectWidthOrSourceRadiusScaled=d?g:0,x.start.rectHeightOrTargetRadiusScaled=d?g:0,x.start.rectWidthOrSourceRadiusFixed=d?0:g,x.start.rectHeightOrTargetRadiusFixed=d?0:g,x.start.strokeWidthFixed=c,x.start.strokeColor=v,x.animation.duration=s,x.animation.beginTime=e,this._engine.storeGroup(y,b),y}_createEdgePulseBlock(t,e,s){const i=this._edgeFlexArrays,n=this._nodeFlexArrays,r=i.pulse.startRatio.get(t),o=i.pulse.endRatio.get(t),a=i.pulse.startColor.get(t),l=i.pulse.endColor.get(t),d=Xr(i.layer.get(t)).edgeBody,h=this._edgeSourceList.get(t),u=this._edgeTargetList.get(t),c=i.curvature.get(t),g=c!==0,_=this._modules.graphics.allocateGraphicsEngineBlockId(),m=this._group.reset(g?Ca:Rs,!0,d),f=m.nextAndReset(),p={isSelfLoop:h===u,curvature:c,sourceX:n.x.get(h),sourceY:n.y.get(h),targetX:n.x.get(u),targetY:n.y.get(u),sourceRadius:n.radius.get(h),targetRadius:n.radius.get(u),isSourceRadiusScaled:n.scalingMethod.get(h)==="scaled",isTargetRadiusScaled:n.scalingMethod.get(u)==="scaled",width:i.width.get(t),isWidthScaled:i.scalingMethod.get(t)==="scaled",strokeWidth:i.pulse.width.get(t)};return Og(f.start,p),Og(f.end,p),f.start.strokeColor=a,f.end.strokeColor=l,f.start.thicknessOrFontSizeScaled*=r,f.start.thicknessOrFontSizeFixed*=r,f.end.thicknessOrFontSizeScaled*=o,f.end.thicknessOrFontSizeFixed*=o,f.animation.duration=s,f.animation.beginTime=e,this._engine.storeGroup(_,m),_}pulse(t,e){const s=t.isNode,i=ct(ct(ct({},s?AT:ST),s?this._nodePulseTheme:this._edgePulseTheme),e),n=i.number,r=i.interval,o=i.duration,a=s?this._nodeNbPulsesRemaining:this._edgeNbPulsesRemaining,l=(n-1)*r+o;let d;i.enabled=!0,delete i.number,t.setAttributes({pulse:i}),a.setMultiple(t._indexes,n),this._modules.dom.setTimeout(()=>{t.isList?t.filter(Os).setAttribute("pulse.enabled",!1):t.setAttribute("pulse.enabled",!1),a.setMultiple(t._indexes,-1)},l);const h=new Promise(c=>{d=()=>c(t)}),u=t.isNode?this._nodePromiseMap:this._edgePromiseMap;return t.isList?t._indexes.forEach(c=>{this._setPromise(c,u,h,d)}):this._setPromise(t._index,u,h,d),h}_setPromise(t,e,s,i){e.has(t)&&e.get(t).resolve(),e.set(t,{promise:s,resolve:i})}setTheme(t,e){this._nodePulseTheme=t,this._edgePulseTheme=e}};function Og(t,{sourceX:e,sourceY:s,targetX:i,targetY:n,isSourceRadiusScaled:r,isTargetRadiusScaled:o,targetRadius:a,sourceRadius:l,isWidthScaled:d,width:h,strokeWidth:u,curvature:c,isSelfLoop:g}){t.pieceId=dl,t.shape="line",t.x1=e,t.y1=s,t.x2=i,t.y2=n,t.rectWidthOrSourceRadiusScaled=r?l:0,t.rectWidthOrSourceRadiusFixed=r?0:l,t.rectHeightOrTargetRadiusScaled=o?a:0,t.rectHeightOrTargetRadiusFixed=o?0:a,t.thicknessOrFontSizeScaled=d?h:0,t.thicknessOrFontSizeFixed=d?0:h,t.strokeWidthFixed=u,t.curvature=c,t.isSelfLoop=g}var TT={duration:0,easing:"linear",callback:qt,resolve:qt,startAfter:0},LT=0,IT=class extends Bt{constructor(){super(...arguments),this._animationList=[],this._update=()=>{if(this._animationList.length===0)return;const t=rs(),e=[];for(let s=0;s<this._animationList.length;++s){const i=this._animationList[s],n=(t-i.creationDate)/i.duration,r=i.startAfter;let o=i.easing(n);n>=1?(i.func(1),i.done=!0,i.resolve(void 0),this._animationList.splice(s,1),s-=1,e.push(i.callback)):o>=r&&(o=(o-r)*(1/(1-r)),i.func(o))}for(let s=0;s<e.length;s++)e[s](!1);this._modules.dom.refresh()}}onMounted(){this._modules.events.on("beforeNewFrame",this._update)}play(t,e){const{duration:s,easing:i,callback:n,startAfter:r,resolve:o}=vs(e,TT);if(s<=0)return t(1),n(),o(void 0),null;const a={func:t,easing:typeof i=="function"?i:Eu[i],duration:s,callback:n,resolve:o,startAfter:r,creationDate:rs(),done:!1,id:++LT};return this._animationList.push(a),this._modules.dom.refresh(),a}cancel(t){const e=this._animationList.indexOf(t);e!==-1&&(t.func(1),this._animationList.splice(e,1),t.done=!0,t.resolve(void 0))}},CT=(t,e,s,i)=>{const n=s._getMapPanePos(),r=t.getMapboxMap(),o=t.getCanvas(),a=t.getSize().round(),l=i.DomUtil.getPosition(t.getContainer()),d=l.x+n.x,h=l.y+n.y;return new Promise(u=>{function c(){e.drawImage(o,d,h,a.x,a.y),u()}if(r.loaded())return c();r.once("idle",c)})},MT=(t,e,s,i,n)=>{const r=s._getMapPanePos(),o=t.getContainer();if(!o)throw new Error(`Trying to access the container of ${t} but it does not exist.`);const a=i.DomUtil.getPosition(o);s.removeLayer(t),t.options.crossOrigin="anonymous";const l=[],d=[];return t.on("tileload",({tile:h})=>{const{x:u,y:c}=i.DomUtil.getPosition(h);l.push(h),d.push({x:u-a.x+r.x,y:c-a.y+r.y})}),s.addLayer(t),new Promise(h=>{t.once("load",()=>{const u=t.getTileSize();l.forEach((c,g)=>{const{x:_,y:m}=d[g];e.drawImage(c,_,m,u.x,u.y)}),h()})})},NT=(t,e,s,i,n,r)=>new Promise(o=>{const a=t.options.renderer;s.removeLayer(t),t.options.renderer=r,s.addLayer(t),r._updatePaths();const l=s._getMapPanePos(),d=r._container,h=i.DomUtil.getPosition(d);e.drawImage(r._container,h.x+l.x,h.y+l.y,d.width/n,d.height/n),s.removeLayer(t),t.options.renderer=a,s.addLayer(t),o()}),FT=(t,e,s,i,n)=>new Promise(r=>{const o=s.getPixelBounds().min,a=s.project(t.getLatLng(),s.getZoom()),l=/^data:/.test(t._icon.src),d=l?t._icon.src:Jy(t._icon.src),h=new Image,u=t.options.icon;if(u){const c=u.options;let g=c.iconSize||[24,24];const _=a.subtract(o);let m=c.iconAnchor||[0,0];Array.isArray(g)||(g=[g.x,g.y]),Array.isArray(m)||(m=[m.x,m.y]);const f=Math.round(_.x-(g[0]-m[0])*n),p=Math.round(_.y-m[1]*n);h.crossOrigin="";const y=()=>{e.drawImage(h,f,p,g[0]*n,g[1]*n),r()};h.onload=y,h.src=d,l&&y()}}),PT=(t,e,s,i,n)=>new Promise(r=>{s.removeLayer(t),t.setUrl(Jy(t.getUrl())),t.options.crossOrigin="anonymous",t.once("load",()=>{const o=t.getBounds(),a=s.latLngToContainerPoint(o.getNorthWest()),l=s.latLngToContainerPoint(o.getSouthEast()),d=l.x-a.x,h=l.y-a.y;e.drawImage(t._image,a.x,a.y,d,h),r()}),s.addLayer(t)});function Jy(t){return t+(t.indexOf("?")===-1?"?":"&")+"noCache="+Date.now()}var DT={tileLayers:MT,imageOverlays:PT,vectorLayers:NT,markers:FT,vectorMap:CT};function kT(t,e){return t instanceof e.TileLayer?"tileLayers":t instanceof e.ImageOverlay?"imageOverlays":t instanceof e.Path?"vectorLayers":t instanceof e.Marker?"markers":"MapboxGL"in e&&t instanceof e.MapboxGL?"vectorMap":void 0}function RT(t,e,s,i,n,r){const o={vectorMap:[],tileLayers:[],vectorLayers:[],imageOverlays:[],markers:[]};return e.eachLayer(a=>{if(a!==t){const l=kT(a,i);if(l&&l in o){const d=DT[l];o[l].push(()=>d(a,s,e,i,n,r))}}}),o}function OT(t){t.TileLayer.prototype.getUrl=function(){return this._url},t.ImageOverlay.prototype.getUrl=function(){return this._url};const e="leaflet-zoom-animated";t.OgmaOverlay||(t.OgmaOverlay=t.Layer.extend({options:{pane:"overlayPane",padding:0,onUpdate:()=>{}},initialize:function(s){const{container:i}=s;t.Util.setOptions(this,s),this._container=i},setLocked:function(s){return this._locked=s,this},onAdd:function(s){this._map=s,this.getPane().appendChild(this._container),this._wgsOrigin=t.latLng([0,0]),this._wgsInitialShift=s.project(this._wgsOrigin,this._initialZoom),t.DomUtil.addClass(this._container,"leaflet-layer"),this._zoomAnimated&&(t.DomUtil.addClass(this._container,e),this._container.style.position="absolute",this._container.style.zIndex=9999),this._initialZoom=(this._map.getMaxZoom()+this._map.getMinZoom())/2,this._mapInitialZoom=this._map.getZoom(),this._updateBounds(),this._update({})},_updateBounds(){const s=this.options.padding,i=this._map.getSize(),n=this._map.containerPointToLayerPoint(i.multiplyBy(-s));this._bounds=new t.Bounds(n,n.add(i.multiplyBy(1+2*s))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_update(s){this._updateBounds(),this._redraw(this._bounds.min,s),this._positionTimer=t.Util.requestAnimFrame(()=>{this._container&&t.DomUtil.setPosition(this._container,this._bounds.min)})},_redraw(s,i){this.options.onUpdate()},_updateTransform(s,i){if(this._locked)return;const n=this._map.getZoomScale(i,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),o=this._map.project(this._center,i),a=r.multiplyBy(-n).add(o).subtract(this._map._getNewPixelOrigin(s,i));t.Browser.any3d?t.DomUtil.setTransform(this._container,a,n):t.DomUtil.setPosition(this._container,a)},_onZoom(s){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onMoveEnd(s){this._update(s)},_onAnimZoom({center:s,zoom:i}){this._updateTransform(s,i)},bringToFront(){t.DomUtil.toFront(this._container)},getEvents(){return{zoom:this._onZoom,moveend:this._onMoveEnd,zoomanim:this._onAnimZoom,layeradd:this.bringToFront,zoomend:this.options.onUpdate}},onRemove:function(){t.DomUtil.removeClass(this._container,e);const s=this._container;["transform","webkitTransform","OTransform","MozTransform","msTransform","zIndex","position"].forEach(i=>s.style[i]=null),t.Util.cancelAnimFrame(this._positionTimer),this._container=null}}))}function zT(t,e,s,i){const n=t.filter(E=>E.isVisible()),r=n.size===0,{mapX:o,mapY:a}=n.reduce((E,w)=>{const{latitude:A,longitude:I}=w.getGeoCoordinates(),{x:M,y:k}=i(A,I);return E.mapX.push(M),E.mapY.push(k),E},{mapX:[],mapY:[]}),l=n.getAttribute("x"),d=n.getAttribute("y"),h=n.getAttribute("radius").map(Number),u=new je({xValues:l,yValues:d,scaledSizeValues:h}),c=new je({xValues:o,yValues:a});r&&(u.cx=u.cy=0,u.width=u.height=0),isFinite(c.width)&&isFinite(c.height)||(c.cx=c.cy=0,c.width=c.height=0);let g=c.cx-u.cx,_=c.cy-u.cy;const m=r?1:Math.max(c.width,c.height)/Math.max(u.width,u.height),[f,p]=h.reduce((E,w)=>(E[0]=Math.min(E[0],w*m),E[1]=Math.max(E[1],w*m),E),[1/0,0]);c.pad(p),c.minScaledSize=f,c.maxScaledSize=p;const y=s.computeConfigForBounds(c),b=e.zoom/Vv(y.zoom);g+=(u.cx-e.x)*b,_+=(u.cy-e.y)*b;const x=u.cx+g,v=u.cy+_;return{offsetChanges:{name:"graph-to-geo",nodeAttributes:{radius:E=>Number(E.getAttribute("radius"))*b,x:E=>(E.getAttribute("x")+g-x)*b+x,y:E=>(E.getAttribute("y")+_-v)*b+v},edgeAttributes:{width:E=>Number(E.getAttribute("width"))*b}},camera:ct({zoom:e.zoom/b,x:(e.x+g-x)*b+x,y:(e.y+_-v)*b+v,angle:0},e.getSize())}}function BT(t,e,s,i){const n=t.getAttributes(["x","y","radius"]),r=t.getBoundingBox(),o=t.size===0,a=t.reduce((x,{_index:v},E)=>(x[v]=E,x),{});i();const l=t.getAttribute("x"),d=t.getAttribute("y"),h=t.getAttribute("radius").map(Number),u=new je({xValues:l,yValues:d,scaledSizeValues:h.map(x=>2*x)});o&&(r.reset(),u.reset());let c=u.cx-r.cx,g=u.cy-r.cy,_=0,m=0;const f=s.computeConfigForBounds(u),p=e.zoom/f.zoom;let y,b;return isNaN(r.cx)||isNaN(r.cy)?(r.cx=e.x,r.cy=e.y,y=f.x,b=f.y):(c+=(r.cx-e.x)*p,g+=(r.cy-e.y)*p,_=r.cx+c,m=r.cy+g,y=(e.x+c-_)*p+_,b=(e.y+g-m)*p+m),{offsetChanges:{name:"geo-to-graph",nodeAttributes:{x:x=>(n[a[x._index]].x+c-_)*p+_,y:x=>(n[a[x._index]].y+g-m)*p+m}},camera:ct({zoom:f.zoom,x:y,y:b,angle:0},e.getSize())}}var tx={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"},UT={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"},zg={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:void 0},GT=class extends Bt{onMounted(){this._brand=null}set(t,e){let{position:s,horizontalMargin:i,verticalMargin:n,className:r}=ct(ct({},zg),e);tx[s]||(s=zg.position),this.remove();const o=document.createElement("div");return o.innerHTML=t,o.style.position="absolute",ex(o,s,i,n),o.style.padding="0px 0px 0px 0px",o.style.zIndex="10",r&&o.setAttribute("class",r),this._brand=o,this._modules.dom.setLayer("brand",this._brand),o}remove(){this._modules.dom.setLayer("brand",null),this._brand=null}};function ex(t,e,s,i){const n=s===void 0?"":s+"px",r=i===void 0?"":i+"px";t.style[tx[e]]=n,t.style[UT[e]]=r}var Bg={},VT=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._settings=ct({},$i),this._edgesOriginalTextStyle={},this._nodesOriginalTextStyle={},this._nodeDraggingSetting=!1,this._transition=!1,this._attribution=null,this._updating=!1,this._updateRate=50,this._x=0,this._y=0,this._onCameraUpdate=()=>{if(this.L&&this._enabled&&this._map&&this._map._loaded){const t=this._x-this._modules.camera.x,e=this._y-this._modules.camera.y;if(t||e){this._updating||(this._updating=!0,this._layer.setLocked(!0),this._map._moveStart(!0,!1));const s=this._fromPointToLatLng(this._modules.camera.x,this._modules.camera.y),i=Fl(this._modules.camera.zoom),n=this.L.latLng(s.latitude,s.longitude);this._map._move(n,i,{pinch:!0,round:!1}),clearTimeout(this._updateRequest),this._updateRequest=this._modules.dom.setTimeout(()=>{this._updating=!1,this._layer.setLocked(!1),this._map&&this._map._move(n,i,{pinch:!0})._moveEnd(!0)},this._updateRate)}}},this._onNodesDragStart=()=>{this._enabled&&(this._setMapDragging(!1),this._nodeDragOffsetX=this._nodeDragOffsetY=0)},this._onNodesDragged=({nodes:t,dx:e,dy:s})=>{if(this._enabled){const i=t.map(n=>{const{x:r,y:o}=n.getAttributes(["x","y"]);return this._fromPointToLatLng(r+e-this._nodeDragOffsetX,o+s-this._nodeDragOffsetY)});return this._nodeDragOffsetX=e,this._nodeDragOffsetY=s,t.setGeoCoordinates(i)}return Promise.resolve(this._modules.graph.nodeList())},this._onMapUpdate=()=>{if(!this._map)return Promise.resolve(void 0);const{lat:t,lng:e}=this._map.getCenter(),s=this._fromLatLngToPoint(t,e);this._x=s.x,this._y=s.y;const i=Gv(this._map.getZoom());return this._modules.events.fire("beforeGeoCameraMove",{zoom:this._map.getZoom()}),this._modules.camera.setView({zoom:i,x:s.x,y:s.y},{ignoreZoomLimits:!0}).then(()=>this._adjustMinvisibleSizes())}}onMounted(){this._filters=this._modules.filters,this._modules.events.register(["geoEnabled","geoDisabled","geoLoaded","geoReady"]),mc()&&(this.L=Ms("L")||Ms("leaflet"),this.L&&OT(this.L)),this._modules.graph.createNodeAttribute({name:"geo.prevLat",storage:"float"},!0),this._modules.graph.createNodeAttribute({name:Nl,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:wi,storage:"float"},!0),this._modules.graph.createNodeAttribute({name:Ti,storage:"float"},!0),this._modules.events.register(["beforeGeoCameraMove"]),this._modules.events.on("addNodes",t=>this._refreshOrAddNodes(t.nodes,!0)).on("updateNodeData",t=>{this._onDataChange(t.changes)}).on("nodesDragProgress",this._onNodesDragged).on(["nodesDragStart","lassoEnabled"],this._onNodesDragStart).on(["nodesDragEnd","lassoDisabled"],()=>this._setMapDragging(!0)).on("move",this._onCameraUpdate).on("viewChanged",this._onCameraUpdate)}_onDataChange(t){const e=_d(this.latitudePath),s=_d(this.longitudePath),i=t.filter(({property:n})=>n&&typeof n!="string"?n.find(r=>e.startsWith(r)||s.startsWith(r)):n===null||e.startsWith(n)||s.startsWith(n));if(i.length){const n=tE(i);n!==null&&this._refreshOrAddNodes(n,!1)}}_refreshOrAddNodes(t,e){e&&this._updatePrevNodesCoordinates(t),this._updateNodesCoordinates(t),this._enabled&&(this._cacheOriginalTextStyles(t,null),this._filter._refresh())}_updatePrevNodesCoordinates(t){vo(this._modules.graph,t,wi,gc),vo(this._modules.graph,t,Ti,Nl)}_restorePrevNodesCoordinates(t){vo(this._modules.graph,t,gc,wi),vo(this._modules.graph,t,Nl,Ti)}_updateNodesCoordinates(t){Kv(this._modules.graph,t,this._settings)}_createMapTileLayer(t,e){if(t&&!ze(t))return t;const s=t,i=s.wms?this.L.tileLayer.wms:this.L.tileLayer,n=jv(s,e)||"";return i(s.url,ct({attribution:n},t))}_setupTileLayer(t,e,s){const i=this._createMapTileLayer(t,e);return i.once("load",()=>{this._modules.events.fire("geoLoaded")}),i.addTo(this._map),_c(i,s),i}_onSettingsChanged(t,e){const s=t.wrapCoordinates!==e.wrapCoordinates,i=t.latitudePath!==e.latitudePath||t.longitudePath!==e.longitudePath;if(s||i){let n=Promise.resolve();this._enabled&&this._filter&&(n=n.then(()=>this._filter.refresh())),n.then(()=>this._updateNodesCoordinates(this._modules.graph.getNodes("all")))}this._enabled&&(Xv(t,e)&&this._map&&(this._map.removeLayer(this._tileLayer),this._tileLayer=this._setupTileLayer(e.tiles,e.attribution,e.opacity)),t.sizeRatio!==e.sizeRatio&&this._updateSizes(),t.maxZoomLevel!==e.maxZoomLevel&&this._modules.settings.update({minZoom:1,maxZoom:Math.pow(2,e.maxZoomLevel)}),t.disableNodeDragging!==e.disableNodeDragging&&this._setDragging(!e.disableNodeDragging),t.attributionOptions!==e.attributionOptions&&this._setAttributionOptions(e.attributionOptions,e.attribution),_c(this._tileLayer,e.opacity))}_setMapDragging(t){if(this._map){const e=t?"enable":"disable";this._map.dragging[e]()}}_fromLatLngToPoint(t,e){return this._map.options.crs.latLngToPoint(this.L.latLng(t,e),Ia)}_fromPointToLatLng(t,e){const{lat:s,lng:i}=this._map.options.crs.pointToLatLng(this.L.point({x:t,y:e}),Ia);return{latitude:s,longitude:i}}_updateSizes(){this._enabled&&this._projection&&this._projection.updateAll()}enable(t){return this.setEnabled(!0,t)}getMap(){return this._enabled?this._map:null}getOptions(){return this._enabled?Wt(ct({},this._settings),{tiles:ze(this._settings.tiles)?ct({},this._settings.tiles):this._settings.tiles}):ct({},$i)}setOptions(t){if(!this._enabled||this._transition)return;qv(t,this.L);const e=this._settings;this._settings=Wt(ct(ct(ct({},$i),e),t),{tiles:Hv($i,t)}),this._onSettingsChanged(e,this._settings)}disable(t){return this.setEnabled(!1,t)}isEnabled(){return this._enabled}toggle(t={}){return this.setEnabled(!this._enabled,t)}getContainerCoords(t){return t.getGeoCoordinates().map(({latitude:e,longitude:s})=>this._map.latLngToContainerPoint([e,s]))}getContainerCoord(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return this._map.latLngToContainerPoint([e||0,s||0])}setEnabled(t,e){if(!mc())throw new Error("Ogma Geo cannot be used outside a browser");if(!this.L)throw new Error("You are trying to use Geo mode but Leaflet has not been found. Please follow our migration guide: https://bit.ly/2SYkF8A");if(this._transition||t===this._enabled)return Promise.resolve();const s=this._modules.settings;this._enabled||(this._prevSettings=s.get(),this._nodeDraggingSetting=!!s.get("interactions.drag.enabled")),this._enabled=t,this.setOptions(e),this._transition=!0;const i=this._settings;return t?this._show().then(()=>(this._registerTextStyle(this._modules.graph.getNodes(),this._modules.graph.getEdges()),this._setDragging(!i.disableNodeDragging),this._transition=!1,this._updating=!1,this._modules.events.fire("geoEnabled").fire("geoReady"),this._adjustMinvisibleSizes())):this._restoreTextStyle().then(()=>this._hide()).then(()=>{this._transition=!1,this._modules.events.fire("geoDisabled"),this._setDragging(this._nodeDraggingSetting,!0)}).then(()=>this._ogma.view.afterNextFrame())}destroy(){return this._enabled&&this._destroyMapSync(),Promise.resolve()}_cacheOriginalTextStyles(t,e){e&&(this._edgesOriginalTextStyle=pc(e,this._edgesOriginalTextStyle)),t&&(this._nodesOriginalTextStyle=eE(t,this._nodesOriginalTextStyle))}_registerTextStyle(t,e){this._cacheOriginalTextStyles(t,e);const{nodeAttributes:s,edgeAttributes:i}=this._modules.hover.getHoverClassDefinition();this._hoverEdgesOriginalTextStyle=i||null,this._hoverNodesOriginalTextStyle=s||null,this._modules.hover.updateEdgeAttributes({text:{size:n=>(this._edgesOriginalTextStyle[n.getId()]||Bg)["text.size"]}}),this._modules.hover.updateNodeAttributes({text:{size:n=>(this._nodesOriginalTextStyle[n.getId()]||Bg)["text.size"]}})}_restoreTextStyle(){return this._modules.hover.updateEdgeAttributes(this._hoverEdgesOriginalTextStyle,!0),this._modules.hover.updateNodeAttributes(this._hoverNodesOriginalTextStyle,!0),Promise.all([iE(this._modules.graph.getEdges(),this._edgesOriginalTextStyle)]).then(()=>(this._edgesOriginalTextStyle=pc(this._modules.graph.edgeList(),{}),this._nodesOriginalTextStyle={},this._edgesOriginalTextStyle={},Promise.resolve()))}_setDragging(t,e=!1){this._modules.settings.update({interactions:{drag:{enabled:t,applyResult:e}}})}_setAttributionOptions(t,e){if(this._map){if(this._attribution&&(this._attribution.remove(),this._attribution=null),this._attribution=this.L.control.attribution({prefix:!1}).addTo(this._map),ze(t)){this._attribution.setPrefix(""),t.position=t.position||"bottom-right";const s=t.position.replace("-","");this._attribution.setPosition(s);const i=this._attribution.getContainer();i&&(t.className&&this.L.DomUtil.addClass(i,t.className),ex(i,t.position||"bottom-right",t.horizontalMargin,t.verticalMargin))}e!=null&&this._attribution.addAttribution(e)}}_nodeIsVisible(t){return Qv(t,this._settings,this._hasCustomProjection())}_updateSettingsForMap(){const t=this._modules.graphics.getGraphicsEngine().parseColor(this._settings.backgroundColor);t[3]=0,this._modules.settings.update({backgroundColor:Xm(t),minZoom:1e-6,interactions:{rotation:{enabled:!1},drag:{enabled:!1},pan:{enabled:!1},zoom:{enabled:!1,onDoubleClick:!1}},mouse:{wheelEnabled:!1}})}getGraphPosition(t){const e=this.L.latLngBounds(Yv(t));return{center:t.size>0?e.getCenter():this.L.latLng([0,0]),zoom:this._clampZoom(this._map.getBoundsZoom(e))}}_initMap(){this._updateSettingsForMap(),this._mapContainer=$v(this._modules.dom.getContainer());const t=Wt(ct({},Uv),{minZoom:this._settings.minZoomLevel,maxZoom:this._settings.maxZoomLevel});this._hasCustomProjection()&&(t.crs=this._settings.crs,t.worldCopyJump=!1,t.maxBoundsViscosity=0),this._map=new this.L.Map(this._mapContainer,t),this._setAttributionOptions(this._settings.attributionOptions,this._settings.attribution),this._setupLayers()}_clampZoom(t){let e=this._tileLayer.options.maxZoom;return e===void 0&&(e=1/0),Math.min(t,e)}_show(){let t;return this._filter?t=this.filter.enable(0):(this._filter=this._filters.addNodeFilter({criteria:e=>this._nodeIsVisible(e)}),t=this._filter.whenApplied()),t.then(()=>{this._initMap();const e=this._map,s=this._modules.graph.getNodes(),i=this._modules.graph.getEdges(),{center:n,zoom:r}=this.getGraphPosition(s),{offset:o,newCameraView:a}=this._transformToGeo();return this._modules.camera.setView(a,{ignoreZoomLimits:!0}).then(()=>(this._updatePrevNodesCoordinates(s),e.setView(n,r,{animate:!1}),this._modules.graphics.animate({nodes:s,edges:i},()=>{this._projection=this._createFinalPositionLayer()},!0,this._settings.duration))).then(()=>o.destroy())})}updateProjection(){var t;(t=this._projection)==null||t.update()}_hasCustomProjection(){return this._settings.crs!=null}_setupLayers(){this._settings.tiles&&(this._tileLayer=this._setupTileLayer(this._settings.tiles,this._settings.attribution,this._settings.opacity)),this._layer=new this.L.OgmaOverlay({container:this._modules.graphics.getDomElement(),mapContainer:this._mapContainer,onUpdate:()=>this._onMapUpdate()}),this._layer.addTo(this._map)}_adjustMinvisibleSizes(){return Promise.all([sE(this._modules.graph.getEdges(),this._edgesOriginalTextStyle,this._map.getZoom())])}_hide(){if(!this._map)return Promise.resolve();this._modules.settings.update(this._prevSettings);const t=this._map;t.removeLayer(this._layer);const e=this._modules.dom.getContainer(),s=this._modules.graphics.getDomElement();e&&e.appendChild(s),t.getContainer().style.zIndex="0";const i=this._modules.graph.getNodes("all"),n=this._modules.graph.getEdges("all"),{offset:r,newCameraView:o}=this._transformToGraph();return this._modules.camera.setView(o||{}).then(()=>Promise.all([Cm(t.getContainer(),1,0,this._settings.duration/2).then(()=>this._destroyMapSync()),this._modules.graphics.animate({nodes:i,edges:n},()=>r&&r.destroy(),!0,this._settings.duration)])).then(()=>(this._map=null,this._filter.disable(0)))}_destroyMapSync(){if(this._map){this._layer&&this._layer._map&&this._map.removeLayer(this._layer),this._map.remove(),this._map._animatingZoom=!1,this._map=null;const t=this._mapContainer.parentNode;t&&t.removeChild(this._mapContainer)}}_transformToGeo(){const t=this._modules.graph.getNodes(),{offsetChanges:e,camera:s}=zT(t,this._modules.camera,this._modules.locate,(i,n)=>this._fromLatLngToPoint(i,n));return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}_addGraphAttributesLayer(t){return this._modules.graphics.addAttributeLayer(ct({priority:Nv,nodeSelector:e=>e.isVisible(),edgeSelector:e=>e.isVisible()},t))}_transformToGraph(){const t=this._modules.graph.getNodes("all"),{offsetChanges:e,camera:s}=BT(t,this._modules.camera,this._modules.locate,()=>{this._projection&&(this._projection.destroy(),this._projection=null)});return{offset:this._addGraphAttributesLayer(e),newCameraView:s}}getPointFromLatLng(t){const{latitude:e,longitude:s}=t.getGeoCoordinates();return e==null?t.getAttributes(["x","y"]):this._fromLatLngToPoint(e,s)}_createFinalPositionLayer(){return this._addGraphAttributesLayer({name:"graph-2-geo-animation",nodeAttributes:{scalingMethod:"fixed",radius:t=>Number(t.getAttribute("radius"))*this._settings.sizeRatio,x:t=>this.getPointFromLatLng(t).x,y:t=>this.getPointFromLatLng(t).y},edgeAttributes:{scalingMethod:"fixed",width:t=>Number(t.getAttribute("width"))*this._settings.sizeRatio}})}setCenter(t,e){return this._enabled?this.setView(t,e,Fl(this._modules.camera.getZoom())):Promise.resolve()}setZoom(t){return this._enabled&&this._map?(t=this._clampZoom(t),this._map.setZoom(t),new Promise(e=>{const s=this._map;if(s.getZoom()===t)return e(void 0);s.once("moveend zoomend",e)}).then(this._onMapUpdate)):Promise.resolve()}zoomIn(){return this.setZoom(this.getZoom()+1)}zoomOut(){return this.setZoom(this.getZoom()-1)}setView(t,e,s){if(!this._enabled||!this._map)return Promise.resolve();const i=this._map;s=this._clampZoom(s);const n=this.L.latLng([t,e]);return i.setView(n,s,{animate:!1,reset:!0}),new Promise(r=>{if(i.getZoom()===s&&i.getCenter().equals(n))return r(void 0);i.once("moveend zoomend",r)}).then(this._onMapUpdate)}getView(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{zoom:this._map.getZoom(),latitude:t.lat,longitude:t.lng}}getCenter(){if(!this._enabled||!this._map)return;const t=this._map.getCenter();return{latitude:t.lat,longitude:t.lng}}getZoom(){if(this._enabled&&this._map)return this._map.getZoom()}resetCoordinates(){if(!this._enabled||!this._projection)return;const t=this._modules.graph.getNodes();this._restorePrevNodesCoordinates(this._modules.graph.getNodes());const e=this._modules.graph.getNodeAttribute(wi).getMultiple(t._indexes),s=this._modules.graph.getNodeAttribute(Ti).getMultiple(t._indexes);t.setData(this._settings.latitudePath,e),t.setData(this._settings.longitudePath,s),this._projection.update()}getUnprojectedCoordinates(t){this._projection&&this._projection.destroy();const e=t.getPosition();return this._projection=this._createFinalPositionLayer(),e}get latitudePath(){return this._settings.latitudePath}get longitudePath(){return this._settings.longitudePath}get filter(){return this._filter}exportBackground(t){if(!this._map)return Promise.reject("Map is not ready");const{pixelRatio:e,width:s,height:i,zoom:n,x:r,y:o}=t,a=s*e,l=i*e,d=Je(a,l),h=d.getContext("2d"),u=this._map;if(!h)throw new Error(`Unable to get 2d context from  ${d}`);const c=this.getView(),g=ct({zoom:Math.round(Fl(n*e))},this._fromPointToLatLng(r,o)),_=new this.L.Canvas;u.addLayer(_);const{vectorMap:m,tileLayers:f,vectorLayers:p,imageOverlays:y,markers:b}=RT(this._layer,u,h,this.L,e,_),x=u.options.zoomSnap;return Promise.resolve().then(()=>(ln(this._mapContainer,a+"px",l+"px"),u.invalidateSize({animate:!1}),this.setView(g.latitude,g.longitude,g.zoom))).then(()=>dm([...m,...f,...y,...p,...b])).then(()=>{ln(this._mapContainer,"100%","100%"),u.invalidateSize({animate:!1}),u.options.zoomSnap=x,this.setView(c.latitude,c.longitude,c.zoom)}).then(()=>new Promise(v=>this.L.Util.requestAnimFrame(v))).then(()=>u.removeLayer(_)).then(()=>d)}},jT=class extends Bt{constructor(){super(...arguments),this._context={edgesAlwaysCurvy:!1,directedEdges:!1}}onMounted(){this._attributeLayer=this._addAttributeLayer(),this._modules.settings.register("edgesAlwaysCurvy",!1,t=>{this._context.edgesAlwaysCurvy=t,this._attributeLayer.updateAll()}),this._modules.settings.register("directedEdges",!1,t=>{this._context.directedEdges=t,this._attributeLayer.updateAll()})}computeCurvature(t,e="visible",s){const{edgesAlwaysCurvy:i,directedEdges:n}=this._context,r=t.getSource()===t.getTarget();if(!i&&t.hasParallelEdges()===!1&&!r)return 0;let o=t.getParallelEdges({filter:e});s&&(o=o.filter(d=>s(d)));const a=o.indexOf(t);if(a===-1)return 0;let l;if(r)l=(a+1)*Math.max(+t.getAttribute("width")||0,1);else{const d=t.getSource(),h=o.size;if(h===1&&!i)return 0;if(n){let u=0;for(let c=0;c<a;++c)o.get(c).getSource()===d&&(u+=1);l=u+1}else{const u=d!==o.get(0).getSource();l=h%2!=1||i?(1+(a/2|0))*(a%2==0?1:-1)*(u?-1:1):a===0?0:((a+1)/2|0)*(a%2==0?1:-1)*(u?-1:1)}}return l}_addAttributeLayer(){return this._modules.graphics.addAttributeLayer({name:"curvature",priority:Lv,edgeDependencies:{parallelEdges:!0},edgeContext:this._context,edgeAttributes:{curvature:t=>this.computeCurvature(t)}})}},sx="worker_start",Au="worker_update",dn="worker_stop",ix=class extends io{constructor(t,e){super(),this._complete=!1,this._destroyed=!1,this._data=null,this._onStart=qt,this._onStop=qt,this._setIdle=qt,this._onPause=qt,this.timer={start:0,steps:0},this._modules=e,this.configure(t)}configure({configure:t=Os,update:e=qt,context:s=qt,stop:i=qt,isRunning:n=zr,onStart:r=qt,onStop:o=qt,onPause:a=qt,setIdle:l=qt}){this._configure=t,this._update=e,this._createContext=s,this._isRunning=n,this._stop=i,this._onStart=r,this._onStop=o,this._setIdle=l,this._onPause=a}setData(t){this._data=t}getData(){return this._data}start(t){return this._complete=!1,this._onStart(),this.fire(sx,{target:this}),this.send(this._configure(t,this._modules)),this}stop(t){return this._complete||(this._onStop(),this.send({type:dn}),this._complete=!0),this}pause(){this._onPause()}setIdle(t){this._setIdle(t)}isBusy(){return!this._complete}destroy(){this._destroyed||(this._destroyed=!0,this._modules&&(this.stop(),delete this._modules))}},nx=/^function\s*\(/,rx=/^\(|^\w+\s?=>/;function Xo(t){const e=t.toString();return e.indexOf("function")===0||rx.test(e)?e:`function ${e}`}var qT=class extends ix{constructor(t,e){super(t,e);const s=Xo(this._createContext),i=Xo(this._update),n=Xo(this._isRunning),r=Xo(this._stop),o=`
      ${HT(t.imports)}
      const __CONTEXT = (${s})();
      const __UPDATE_FUNC = ${i} ;
      const __IS_RUNNING_FUNC = ${n};
      const __STOP_FN = ${r};
      let result;

      self.addEventListener("message", function (evt) {
        if (evt.data && evt.data.type === '${dn}') {
          __STOP_FN(__CONTEXT);
          return self.postMessage({ result, isRunning: false });
        }
        result = __UPDATE_FUNC(evt.data, __CONTEXT);
        const isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);

        self.postMessage({ result, isRunning });
      });
    `;this._worker=Hm(o),this._worker.addEventListener("message",a=>{e.dom.isDestroyed()||this.onWorkerMessage(a)})}onWorkerMessage(t){const e=t.data.isRunning,s=t.data.result,i={data:void 0};return this.fire(Au,{worker:this,workerMessage:s,modules:this._modules,data:i,isRunning:e}),e?this.send(i.data):(this.fire(dn,{worker:this,result:s,modules:this._modules}),this.stop(s))}destroy(){super.destroy(),this._worker.terminate()}send(t){return this._complete||this._worker.postMessage(qm(t)),this}};function HT(t={}){const e=Object.keys(t),s=[];for(let i=0,n=e.length;i<n;i++){const r=e[i],o=t[r];if(typeof o!="function")throw new Error(`Asynchronous worker: dependency "${r}" is not found`);{const a=XT(o);a?(s.push(Ug(o,r)),a!==r&&s.push(`var ${r} = ${a};`)):s.push(`var ${r} = ${Ug(o,r)};`)}}return s.join(`
`)}function Ug(t,e){const s=t.toString();return nx.test(s)?`function ${t.name||e} ${s.substring(s.indexOf("("))}`:rx.test(s)?`const ${t.name||e} = ${s.toString()}`:s}function XT(t){const e=t.toString();return t.name?t.name:nx.test(e)?null:e.substring(9,e.indexOf("(")).trim()}var WT=class extends ix{constructor(t,e){super(t,e),this._context=this._createContext()}sync(t){if(t&&t.type===dn)return this._stop(this._context);const e=this._update(t,this._context),s=this._isRunning(this._context,t),i={data:void 0};return this.fire(Au,{worker:this,workerMessage:e,modules:this._modules,data:i,isRunning:s}),s?this.send(i.data):(this.fire(dn,{worker:this,result:e,modules:this._modules}),this.stop(e))}send(t){return this._complete||this._modules.dom.setTimeout(()=>this.sync(t),0),this}},$T=class extends Bt{constructor(){super(...arguments),this._pool={}}create(t,e){const s=e&&jm,i=this._modules,n=`${t.name||"worker"}-${s?"async":"sync"}`;let r=this._pool[n];r||(r=this._pool[n]=[]);let o=r.find(a=>!a.isBusy());return o?o.configure(t):(o=s?new qT(t,i):new WT(t,i),this._pool[n].push(o)),o.on(dn,()=>{o.clearEvents(),this._pool[n].length<2||(o.destroy(),this._pool[n]=this._pool[n].filter(a=>a!==o))}),o}start(t,e){return t.start(e)}run(t,e,s){const i=this.create(t,s);return this.start(i,e)}destroy(){for(const t in this._pool)this._pool[t].forEach(e=>e.destroy()),delete this._pool[t]}};function YT(t,e,s,i=t.getNodes()){if(!e)return s?t.nodeList():i.filter(n=>n.getMetaNode()===null);if(!(e instanceof ui)){if(Array.isArray(e)&&e.length>0)return t.getNodes(e);throw Error("[Layout]: 'nodes' must be a NodeList or an NodeId[]")}return e}function ZT(t,e,s=t.getEdges()){if(!e)return s;if(!(e instanceof hn)){if(Array.isArray(e)&&e.length>0)return t.getEdges(e);throw Error("[Layout]: 'edges' must be a EdgeList or a valid EdgeId[]")}return e}function KT(t){if(!t.size)return;const e=new Set(t.getId());return t.getAdjacentEdges().filter(s=>s.getExtremities().getId().every(i=>e.has(i)))}function ox(t,e={},s=!0){s||(e.edges=void 0);const i=YT(t,e.nodes,e.edges),n=ZT(t,e.edges,KT(i));return Wt(ct({},e),{nodes:i.concat(n.getExtremities()).dedupe(),edges:n})}var QT=16,Wo={duration:500,skipTextDrawing:!0,useWebWorker:!0,locate:!1},JT=class extends Bt{constructor(){super(...arguments),this._running=[],this._textsHidden=!1,this.onInteractionStart=()=>{this.setWorkersIdle(!0)},this.onViewChanged=()=>{this.setWorkersIdle(!1)},this.onVisibilityChange=()=>{hi().hidden?this.setWorkersIdle(!0):this.setWorkersIdle(!1)},this._onWorkerUpdate=(t,e,s,i,n,r)=>{const{duration:o,onSync:a,onUpdate:l,dryRun:d,locate:h}=r;if(a&&this._modules.dom.setTimeout(()=>a(s,this._modules,i),o),n){const u=n(s,this._modules,i);this._modules.events.fire("layoutComputed",{type:"layoutComputed",name:e,positions:u}),l&&l(s,u,i);const c=this._assignNodePositions(u,o,d);i||(h&&u&&this._animateCamera(u,h,r.duration),c.then(()=>t.fire("taskComplete",u)))}else i||t.fire("taskComplete",s)},this._onWorkerComplete=(t,e,s,i,n,r,o)=>{for(let u=0;u<this._running.length;u++)if(this._running[u]===t){this._running.splice(u,1);break}i.onStop&&e&&i.onStop(n,e,this._modules);const a=this._modules.graph.nodeList(new Uint32Array(o.indexes)),l=n.dryRun&&e?s:this.collectNodesData(a),d=a.getId(),h={before:Xl(o),current:Xl(l)};this._modules.events.fire("layoutEnd",{type:"layoutEnd",name:i.name,positions:h,ids:d}),this._modules.dom.setTimeout(()=>{n.onEnd&&n.onEnd(e),n.skipTextDrawing&&this._textsHidden&&(this._modules.graphics.showTexts(),this._textsHidden=!1),r({name:i.name,positions:h,ids:d})})},this._onWorkerStart=(t,e,s)=>{e.skipTextDrawing&&!this._textsHidden&&(this._modules.graphics.hideTexts(),this._textsHidden=!0);const i=this._modules.graph.getNodes(e.nodes),n=this.collectNodesData(i),r=n.ids;s.setData(n),this._modules.events.fire("layoutStart",{type:"layoutStart",name:t.name,ids:r,worker:s})}}onMounted(){this._layouts={},this.timers=new Map,this._modules.events.register(["layoutStart","layoutEnd","layoutComputed"]),this._modules.events.on("clearGraph",()=>this.stop()).on(["dragStart","zoomStart"],this.onInteractionStart).on(["dragEnd","viewChanged"],this.onViewChanged),this._modules.dom.addDocumentEventListener("visibilitychange",this.onVisibilityChange)}setWorkersIdle(t){this._running.forEach(e=>e.setIdle(t))}register(t){if(this._layouts[t.name])throw new Error(`Layout ${t.name} already exists`);this._layouts[t.name]=t}getAvailableLayouts(){return Object.keys(this._layouts)}start(t,e={}){const s=this._layouts[t],i=ox(this._modules.graph,e,["radial","grid"].indexOf(t)===-1);return new Promise(n=>{if(!s)throw new Error(`layout ${t} does not exist`);i.duration=typeof i.duration=="number"?i.duration:Wo.duration;const r=s.onSync;i.skipTextDrawing=i.skipTextDrawing===void 0?!!Wo.skipTextDrawing:!!i.skipTextDrawing;let o=i.locate||Wo.locate;o&&typeof o=="boolean"&&(o={}),i.locate=o;const a={name:t,update:s.update,isRunning:s.isRunning,configure:s.configure,context:s.context,imports:s.imports,stop:s.stop,setIdle:s.setIdle};this._modules.graphics.forceAttributesComputation();const l=i.useWebWorker===void 0?!!Wo.useWebWorker:!!i.useWebWorker,d=this._modules.workers.create(a,l);d.on(sx,()=>{s.onStart&&s.onStart(e),this._onWorkerStart(s,i,d)}).on(Au,({workerMessage:h,isRunning:u})=>{const c=h.lastUpdate||-1/0,g=rs();u&&(!i.continuous||g-c<QT)||(h.lastUpdate=g,this._onWorkerUpdate(d,t,h,u,r,i))}).on(dn,({result:h})=>{d.once("taskComplete",u=>{this._onWorkerComplete(d,h,u,s,i,n,d.getData())})}),this._modules.workers.start(d,i),this._running.push(d)})}_animateCamera(t,e,s){if(t.indexes.length===0)return Promise.resolve();const i=this._modules.locate.layoutDataBoundingBox(t),n=this._modules.locate.computeConfigForBounds(i,e);return this._modules.camera.setView(n,{duration:s,easing:e.easing,ignoreZoomLimits:!0})}stop(){for(;this._running.length!==0;){const t=this._running.pop();t.stop(),t.fire("taskComplete",null)}return Promise.resolve()}isRunning(){return this._running.length!==0}_assignNodePositions(t,e,s){if(!t||s){const l=t?new Uint32Array(t.indexes):void 0,d=this._modules.graph.nodeList(l);return Promise.resolve(d)}const{indexes:i,x:n,y:r}=t,o=this._modules.graph.nodeList(new Uint32Array(i)),a=Xl(t);for(let l=0;l<a.length;l++)a[l]={x:n[l],y:r[l]};return o.setAttributes(a,e)}collectNodesData(t){const e=t._indexes,s=this._modules.graph.getNodeAttribute("x").getMultiple(e),i=this._modules.graph.getNodeAttribute("y").getMultiple(e);return{ids:t.getId(),indexes:e,x:s,y:i}}};function Xl({x:t,y:e,indexes:s}){const i=s.length,n=new Array(i);for(let r=0;r<i;r++)n[r]={x:t[r],y:e[r]};return n}var tL=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s||[],this._filter=i,this._unwindArrays=n,this._onUpdateHandlers=[],this._triggerUpdate=r=>{for(let o=0;o<this._onUpdateHandlers.length;++o)this._onUpdateHandlers[o](r)},this._info=t.watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}onUpdate(t){this._onUpdateHandlers.push(t)}getPropertyInfo(){return this._info}getPath(){return this._path.slice()}destroy(){this._module.unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)}},eL=class{constructor(t,e,{path:s,filter:i,unwindArrays:n}){this._module=t,this._isNode=e,this._path=s,this._filter=i,this._unwindArrays=n,this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[]}get path(){return this._path}onPropertyAdded(t){return this._onAddHandlers.push(t),this}onPropertyRemoved(t){return this._onRemoveHandlers.push(t),this}onPropertyUpdated(t){return this._onUpdateHandlers.push(t),this}getPath(){return this._path.slice()}getProperties(){return this._propertyList.slice()}getPropertyInfo(t){const e=this._properties[t];return e?e.info:null}destroy(){Ws(this._properties,({handler:e},s)=>{const i=this._path.concat([s]);this._module.unwatchPropertyInformation(this._isNode,i,e,this._filter,this._unwindArrays)}),this._propertyList=[],this._properties={},this._onAddHandlers=[],this._onRemoveHandlers=[],this._onUpdateHandlers=[];const t=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(t,1)}updateSubPropertiesToWatch(t,e){if(t!==this._isNode)return;const s=e.getData(this._path);for(let i=0;i<s.length;i++){const n=s[i];if(rn(n)){const r=Object.keys(n);for(let o=0;o<r.length;o++)this._addSubPropertyToWatch(r[o])}}}_addSubPropertyToWatch(t){if(!this._properties[t]){const e=this._path.concat([t]),s=()=>this._triggerPropertyUpdate(t),i=this._unwindArrays,n=this._isNode,r=this._filter,o=this._module.watchPropertyInformation(n,e,s,r,i);this._properties[t]={handler:s,info:o},this._triggerPropertyUpdate(t)}}_triggerPropertyUpdate(t){const{info:e}=this._properties[t],s=this._propertyList.indexOf(t),i=s!==-1,n=e.getType()!=="undefined";!i&&n?(this._propertyList.push(t),this._triggerHandlers("_onAddHandlers",t,e),this._triggerHandlers("_onUpdateHandlers",t,e)):i&&!n?(this._propertyList.splice(s,1),this._triggerHandlers("_onUpdateHandlers",t,e),this._triggerHandlers("_onRemoveHandlers",t,e)):i&&n&&this._triggerHandlers("_onUpdateHandlers",t,e)}_triggerHandlers(t,e,s){const i=this[t];for(let n=0,r=i.length;n<r;n++)i[n](e,s)}},sL=class{constructor(){}setWatcher(t){this._watcher=t}isNode(){return this._watcher.isNode}getPath(){return this._watcher.property.slice()}getBoundaries(){const t=this._watcher.boundaries;return t?{min:t.min,max:t.max}:null}getValues(){return this._watcher.values.keys()}getValueCount(t){return this._watcher.values.get(t)||0}getCount(){return this._watcher.total}getType(){return this._watcher.any>0?"any":this._watcher.numbers>0?"number":"undefined"}};function Gg(t){return typeof t=="number"&&isNaN(t)}var Vg=class{constructor(){this._keys=[],this._values=[]}set(t,e){const s=this._getIndex(t);return s===-1?(this._keys.push(t.slice()),this._values.push(e),!0):(this._values[s]=e,!1)}get(t){const e=this._getIndex(t);return e===-1?void 0:this._values[e]}has(t){return this._getIndex(t)!==-1}delete(t){const e=this._getIndex(t);return e!==-1&&(this._keys.splice(e,1),this._values.splice(e,1),!0)}keys(){return this._keys.map(t=>t.slice())}values(){return this._values.slice()}_getIndex(t){for(let e=0;e<this._keys.length;e++){const s=this._keys[e];if(s.length===t.length){let i=!0;for(let n=0;n<t.length;n++){const r=s[n],o=t[n];if(!(r===o||Gg(r)&&Gg(o))){i=!1;break}}if(i)return e}}return-1}get size(){return this._keys.length}},iL=class{constructor(){this._map=new Map,this._arrays=new Vg}clear(){return this._arrays=new Vg,this._map.clear()}delete(t){return Qe(t)?this._arrays.delete(t):this._map.delete(t)}get(t){return Qe(t)?this._arrays.get(t):this._map.get(t)}set(t,e){return Qe(t)?this._arrays.set(t,e):this._map.set(t,e),this}keys(){return[...Ja(this._map),...this._arrays.keys()]}values(){return[...Pi(this._map),...this._arrays.values()]}get size(){return this._map.size+this._arrays.size}};function ml(t){return typeof t=="number"&&isFinite(t)}var nL=class extends Bt{constructor(){super(...arguments),this._onExcludedStateChange=({elements:t,value:e})=>{const s=!e;for(let i=0,n=this._propertyWatchers.length;i<n;i++){const r=this._propertyWatchers[i];r.isNode===t.isNode&&r.filter==="visible"&&(s?br(r,t.getData(r.property)):_a(r,t.getData(r.property)),$o(r))}},this._onDataChange=({isNode:t,changes:e})=>{for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.property,r=i.filter==="all";if(i.isNode===t)for(let o=0;o<e.length;++o){const a=e[o],l=aL(a.property||[],n);if(l){const d=a.nodes||a.edges,h=[],u=[];if(d)for(let c=0;c<d.size;++c){const g=d.get(c);(r||g.isVisible())&&(h.push(Le(a.newValues[c],l)),u.push(Le(a.previousValues[c],l)))}h.length&&(br(i,h),_a(i,u),$o(i))}}}for(let s=0,i=this._objectPropertyWatchers.length;s<i;s++){const n=this._objectPropertyWatchers[s],r=n.path;for(let o=0;o<e.length;++o){const{property:a,nodes:l,edges:d}=e[o],h=l||d;if(h){const u=h.isNode;(!a||a.length<=r.length+1&&r.every((c,g)=>c===a[g]))&&n.updateSubPropertiesToWatch(u,h)}}}},this._onElementsAdded=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s];if(i.isNode===e.isNode){const n=e.getData(i.property);n.length&&(br(i,n),$o(i))}}for(let s=0;s<this._objectPropertyWatchers.length;s++)this._objectPropertyWatchers[s].updateSubPropertiesToWatch(e.isNode,e)},this._onElementsRemoved=t=>{const e=t.nodes||t.edges;for(let s=0;s<this._propertyWatchers.length;++s){const i=this._propertyWatchers[s],n=i.filter==="all";if(i.isNode===e.isNode&&n){const r=e.getData(i.property);r.length&&(_a(i,r),$o(i))}}},this._onGraphClear=()=>{this._propertyWatchers.forEach(t=>{t.numbers=0,t.any=0,t.total=0,t.boundaries=null,t.values.clear()})}}onMounted(){this._propertyWatchers=[],this._objectPropertyWatchers=[],this._modules.events.on("excludedStateChange",this._onExcludedStateChange).on(["updateNodeData","updateEdgeData"],this._onDataChange).on(["addNodes","addEdges"],this._onElementsAdded).on(["removeNodes","removeEdges"],this._onElementsRemoved).on("clearGraph",this._onGraphClear)}watchNodeObjectProperty(t){return this._watchObjectProperty(!0,Yo(t))}watchEdgeObjectProperty(t){return this._watchObjectProperty(!1,Yo(t))}watchNodeNonObjectProperty(t){return this._watchNonObjectProperty(!0,Yo(t))}watchEdgeNonObjectProperty(t){return this._watchNonObjectProperty(!1,Yo(t))}watchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n)||this._createWatcher(t,e,i,n);return s&&r.onChange.push(s),r.info}unwatchPropertyInformation(t,e,s,i,n){const r=this._findWatcher(t,e,i,n);if(!r)return;const o=r.onChange,a=o.indexOf(s);if(a!==-1&&(o.splice(a,1),o.length===0)){const l=this._propertyWatchers.indexOf(r);this._propertyWatchers.splice(l,1)}}_watchObjectProperty(t,e){const s=new eL(this,t,e);return this._objectPropertyWatchers.push(s),s.updateSubPropertiesToWatch(t,this._modules.graph[t?"getNodes":"getEdges"](e.filter)),s}_watchNonObjectProperty(t,e){return new tL(this,t,e)}_findWatcher(t,e,s,i){for(let n=0;n<this._propertyWatchers.length;++n){const r=this._propertyWatchers[n];if(r.isNode===t&&r.filter===s&&r.unwindArrays===i&&oL(r.property,e))return r}return null}_createWatcher(t,e,s,i){const n={isNode:t,property:e,numbers:0,any:0,total:0,values:new iL,boundaries:null,onChange:[],filter:s,unwindArrays:i,info:new sL};return n.info.setWatcher(n),br(n,this._modules.graph[t?"getNodes":"getEdges"](s).getData(e)),this._propertyWatchers.push(n),n}};function jg(t){return t==null?[]:nn(t)}function rL(t){return t==="all"?"all":"visible"}function $o(t){for(let e=0;e<t.onChange.length;++e)t.onChange[e](t.info)}function oL(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(t[s]!==e[s])return!1;return!0}function aL(t,e){if(t.length>e.length)return null;let s=0;for(;s<t.length;++s)if(t[s]!==e[s])return null;return e.slice(s)}function br(t,e,s){const i=t.values,n=!s&&t.unwindArrays;for(let r=0;r<e.length;++r){const o=e[r];if(s||o===void 0||(t.total+=1),n&&Array.isArray(o))br(t,o,!0);else{const a=i.get(o);a?i.set(o,a+1):(i.set(o,1),ml(o)?(t.boundaries?o<t.boundaries.min?t.boundaries.min=o:o>t.boundaries.max&&(t.boundaries.max=o):t.boundaries={min:o,max:o},t.numbers+=1):o!==void 0&&(t.any+=1))}}}function _a(t,e,s){const i=t.values,n=!s&&t.unwindArrays,r=t.boundaries;let o=!1;for(let a=0;a<e.length;++a){const l=e[a];if(s||l===void 0||(t.total-=1),n&&Array.isArray(l))o=o||_a(t,l,!0);else{const d=i.get(l);d>1?i.set(l,d-1):(i.delete(l),ml(l)?(t.numbers-=1,!r||r.min!==l&&r.max!==l||(o=!0)):l!==void 0&&(t.any-=1))}}return!s&&o&&(t.boundaries=lL(i.keys())),o}function lL(t){let e=null,s=null;for(let i=0;i<t.length;++i){const n=t[i];ml(n)&&((e==null||n<e)&&(e=n),(s==null||n>s)&&(s=n))}return e==null||s==null?null:{min:e,max:s}}function Yo(t){return typeof t!="object"||t===null||Array.isArray(t)?{path:jg(t),filter:"visible",unwindArrays:!1}:{path:jg(t.path),filter:rL(t.filter||"visible"),unwindArrays:!!t.unwindArrays}}var dL=class extends Bt{onMounted(){this._modules.events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])}get x(){return this._modules.position.x||0}get y(){return this._modules.position.y||0}_later(){return this._modules.dom.afterNextFrame()}move({x:t,y:e}){if(t!==void 0&&e!==void 0){const s=t-this.x,i=e-this.y;this._modules.events.fire("virtualMove",{x:t,y:e,dx:s,dy:i})}return Promise.resolve()}down({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDown",{x:this.x,y:this.y,button:s}),this._modules.events.fire("virtualMove",{x:this.x,y:this.y,dx:0,dy:0,button:s})})}up({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualUp",{x:t,y:e,button:s})})}click({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}rightClick({x:t,y:e,button:s="right"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualClick",{x:t,y:e,button:s})})}doubleclick({x:t,y:e,button:s="left"}={}){return this.move({x:t,y:e}).then(()=>{this._modules.events.fire("virtualDoubleClick",{x:t,y:e,button:s})})}drag(t,e){return this.down(t).then(()=>this.move(e)).then(()=>this.up(e))}wheel({x:t,y:e,delta:s}){return this.move({x:t,y:e}).then(()=>(this._modules.events.fire("virtualWheel",{x:t,y:e,delta:s}),this._later()))}};function Ss(t,e,s,i,n,r){const o=fs(),a=r.graphToScreenCoordinates(t),l=r.graphToScreenCoordinates(e);n.beginPath(),n.moveTo(a.x*o,a.y*o),n.lineTo(l.x*o,l.y*o),n.strokeStyle=i,n.lineWidth=s,n.stroke()}function qg(t,e,s,i){let n,r,o,a=0,l=t.length-1;for(;a<l&&a>-1;)if(n=(a+l)/2|0,r=Math.abs(e[t[n]]-s),o=Math.abs(e[t[n+1]]-s),o<r)a=n+1;else if(o>r)l=n;else{const d=Math.abs(e[t[a]]-s),h=Math.abs(e[t[l]]-s);if(d<h)l=n;else{if(!(d>h))return l;a=n+1}}return i?l:t[l]}function Hg(t,e,s,i,n,r,o){let a,l,d,h,u,c;for(let g=0,_=t.length;g<_;g++)for(let m=0;m<_;m++){if(g===m)continue;let f=t[g],p=t[m];m<g&&(h=p,p=f,f=h);const y=e[f],b=e[p],x=r.get(f),v=r.get(p);if(y+x<i-n&&b-v>i+n&&Math.abs(Math.abs(y+x-(i-n))-Math.abs(b-v-(i+n)))<=o)return a=f,l=s,d=p,c=y+x+Math.abs(b-v-(y+x))/2,u=[y+x,c-n,c+n,b-v],{a,b:l,c:d,current:s,target:c,points:u};if(y+x<i-n&&b+v<i-n&&Math.abs(Math.abs(y+x-(b-v))-Math.abs(Math.max(y+x,b+v)-(i-n)))<=o)return a=f,l=p,d=s,c=b+x+Math.abs(Math.abs(y+x-(b-v)))+n,u=[y+x,b-v,b+v,c-n],{a,b:l,c:d,current:s,target:c,points:u};if(y-x>i+n&&b-v>i+n&&Math.abs(Math.abs(y+x-(b-v))-Math.abs(Math.min(y-x,b-v)-(i+n)))<=o)return a=s,l=f,d=p,c=y-x-Math.abs(Math.abs(y+x-(b-v)))-n,u=[c+n,y-x,y+x,b-v],{a,b:l,c:d,current:s,target:c,points:u}}return null}var Wl={enabled:!1,tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:!0,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:!0,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}},hL=class extends Bt{constructor(){super(...arguments),this._options=Ie(Wl),this._enabled=!1,this._ysnap=0,this._xsnap=0,this._node=null,this._nodes=null,this._r=0,this._vguideline={start:{x:0,y:0},end:{x:0,y:0}},this._hguideline={start:{x:0,y:0},end:{x:0,y:0}},this._gridResolution=0,this._onNodeDragStart=({nodes:t})=>{t.size===1&&(this._node=t.get(0),this._cacheViewportData(),this._r=Number(this._node.getAttribute("radius")))},this._onNodeDragEnd=()=>{this._node=null,this._layer.refresh()}}onMounted(){this._options=Ie(Wl),this._enabled=!1}enable(t){this._enabled||(this._options=vs(t,Wl),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(e=>{e.clearRect(0,0,e.canvas.width,e.canvas.height)},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._modules.events.on("nodesDragStart",this._onNodeDragStart).on("nodesDragEnd",this._onNodeDragEnd),this._modules.settings.update({"interactions.drag.onBeforeDrag":(e,s,i,n)=>this._onBeforeDrag(s,i,n)}))}disable(){this._enabled&&(this._modules.events.off(this._onNodeDragStart).off(this._onNodeDragEnd),this._layer.destroy(),this._modules.settings.update({"interactions.drag.onBeforeDrag":null}),this._enabled=!1)}enabled(){return this._enabled}_onBeforeDrag(t,e,s){if(this._node){const i=s[0];this._layer.refresh(n=>{this._scan(n,i)}),this._node.setAttributes(i)}}_cacheViewportData(){const t=this._modules.camera,e=t.screenToGraphCoordinates({x:0,y:0}),s=t.screenToGraphCoordinates({x:t.width,y:t.height});if(this._nodes=this._modules.spatial.getNodesByBoundingBox(e.x,e.y,s.x,s.y),this._node==null)return;const i=this._node._index,n=Array.from(this._nodes._indexes);n.splice(n.indexOf(i),1);const r=this._modules.graph.getNodeAttribute("radius"),o=this._modules.graph.getNodeAttribute("x"),a=this._modules.graph.getNodeAttribute("y"),l=o.buffer(),d=a.buffer(),h=hr(n.slice(),o),u=hr(n.slice(),a),c={},g={};this._gridResolution=Number(this._node.getAttribute("radius"));const _=this._gridResolution;for(let m=0,f=n.length;m<f;m++){const p=h[m],y=u[m],b=l[p]/_|0,x=d[y]/_|0;c[b]||(c[b]=[]),g[x]||(g[x]=[]),c[b].push(p),g[x].push(y)}this._nodesByX=h,this._nodesByY=u,this._xGrid=c,this._yGrid=g,this._xList=o,this._yList=a,this._X=l,this._Y=d,this._R=r}_scan(t,e){if(this._node==null)return;const s=this._node._index,i=e.x,n=e.y,r=this._r,o=this._options,a=this._xList,l=this._yList,d=this._R,h=this._X,u=this._Y,c=this._modules.camera.zoom,g=Math.min(r,this._options.tolerance/c),_=2*r*o.sideSnapDistanceFactor,m=o.guidelineWidth,f=o.guidelineColor;let p,y,b,x,v,E,w,A,I=s,M=s,k=null,W=!1,H=!1;if(I=qg(this._nodesByX,h,i),M=qg(this._nodesByY,u,n),Math.abs(h[I]-i)>o.centerSnapDistance&&(I=s),Math.abs(u[M]-n)>o.centerSnapDistance&&(M=s),this._xsnap=0,I!==s){p=this._vguideline.start,y=this._vguideline.end,A=I,b=h[A],x=u[A],k=d.get(A),w=Math.abs(i-b);const $=Math.abs(i-r-(b-k)),P=Math.abs(i+r-(b+k));if(w<Math.max(r,k)){x<n?(p.y=x-k,y.y=n+r):(p.y=x+k,y.y=n-r);const S=Math.min($,w,P);S===w?(p.x=y.x=b,y.y=n,p.y=x,this._xsnap=1):Math.abs(n-x)<k+r+_&&(S===$?(p.x=y.x=b-k,this._xsnap=2):(p.x=y.x=b+k,this._xsnap=3)),S<g&&(W=!0)}this._xsnap!==0&&Ss(p,y,m,f,t,this._modules.camera)}if(this._ysnap=0,M!==s){p=this._hguideline.start,y=this._hguideline.end,A=M,b=h[A],x=u[A],k=d.get(A),w=Math.abs(n-x);const $=Math.abs(n-r-(x-k)),P=Math.abs(n+r-(x+k));if(w<Math.max(r,k)){b<i?(p.x=b-k,y.x=i+r):(p.x=b+k,y.x=i-r);const S=Math.min($,w,P);S===w?(p.y=y.y=x,y.x=i,p.x=b,this._ysnap=1):Math.abs(i-b)<k+r+_&&(S===$?(p.y=y.y=x-k,this._ysnap=4):(p.y=y.y=x+k,this._ysnap=5)),S<g&&(H=!0)}this._ysnap!==0&&Ss(p,y,m,f,t,this._modules.camera)}if(k!=null&&o.preferredDistance.enabled){const $=o.preferredDistance.ratio,P=Math.min(o.preferredDistance.tolerance/c,r),S=Math.max(r,k);if(I===s||this._xsnap!==0&&W){if(M!==s&&(this._ysnap===0||!H)&&(A=M,b=h[A],x=u[A],k=d.get(A),E=Math.abs(n-x)-(r+k)*(1+$),E<=P&&E>=-P)){const Y=n<x?-1:1;p=this._hguideline.start,y=this._hguideline.end,p.x=b-S,y.x=b+S,p.y=y.y=x,Ss(p,y,m,f,t,this._modules.camera),p.x=i-S,y.x=i+S,p.y=y.y=x+Y*(1+$)*(r+k),Ss(p,y,m,f,t,this._modules.camera),this._ysnap=1,H=!0}}else if(A=I,b=h[A],x=u[A],k=d.get(A),v=Math.abs(i-b)-(r+k)*(1+$),v<=P&&v>=-P){const Y=i<b?-1:1;p=this._vguideline.start,y=this._vguideline.end,p.x=y.x=b+Y*(1+$)*(r+k),p.y=x-S,y.y=x+S,p.x=y.x=b,Ss(p,y,m,f,t,this._modules.camera),p.y=n-S,y.y=n+S,p.x=y.x=b+Y*(1+$)*(r+k),Ss(p,y,m,f,t,this._modules.camera),this._xsnap=1,W=!0}}if(o.neighbours.enabled){const $=this._gridResolution,P=i/$|0,S=n/$|0,Y=this._xGrid,st=this._yGrid,at=[],Tt=[].concat(st[S-1]||at,st[S]||at,st[S+1]||at),ut=[].concat(Y[P-1]||at,Y[P]||at,Y[P+1]||at);let Mt;Tt.length>1&&(hr(Tt,a),Mt=Hg(Tt,h,s,i,r,d,g),Mt&&(this._drawNeighbourGuidelines(t,Mt,e,!1),W=!1)),ut.length>1&&!Mt&&(hr(ut,l),Mt=Hg(ut,u,s,n,r,d,g),Mt&&(this._drawNeighbourGuidelines(t,Mt,e,!0),H=!1))}(W||H)&&this._snap(e,!W,!H)}_drawNeighbourGuidelines(t,{a:e,b:s,c:i,points:n,target:r},o,a){const l={x:0,y:0},d={x:0,y:0},h=this._R,u=this._X,c=this._Y;let[g,_,m]=h.getMultiple([e,s,i]);const{offset:f,lineWidth:p,lineColor:y}=this._options.neighbours;let b,x;a?(o.y=r,g=-g,_=-_,m=-m,b=d.x=l.x=Math.min(u[e]+g,u[s]+_,u[i]+m)-f,x=u):(o.x=r,b=d.y=l.y=Math.max(c[e]+g,c[s]+_,c[i]+m)+f,x=c);const v=a?"y":"x",E=a?"x":"y";l[v]=n[0],d[v]=n[1],Ss(l,d,p,y,t,this._modules.camera),l[v]=n[2],d[v]=n[3],Ss(l,d,p,y,t,this._modules.camera),l[v]=n[0],l[E]=b-f/2,d[v]=n[0],l[E]=x[e]+g,Ss(l,d,p,y,t,this._modules.camera),l[v]=n[1],l[E]=b-f/2,d[v]=n[1],l[E]=x[s]+_,Ss(l,d,p,y,t,this._modules.camera),l[v]=n[2],l[E]=b-f/2,d[v]=n[2],l[E]=x[s]+_,Ss(l,d,p,y,t,this._modules.camera),l[v]=n[3],l[E]=b-f/2,d[v]=n[3],l[E]=x[i]+m,Ss(l,d,p,y,t,this._modules.camera)}_snap(t,e,s){const i=this._xsnap,n=this._ysnap;let r;e||i===0||(r=this._vguideline.end,t.x=i===2?r.x+this._r:i===3?r.x-this._r:r.x),s||n===0||(r=this._hguideline.end,t.y=n===4?r.y+this._r:n===5?r.y-this._r:r.y)}},uL=class{constructor(t,e,s){this._module=t,this._id=e,this._whenApplied=s.then(()=>this)}getId(){return this._id}whenApplied(){return this._whenApplied}refresh(){return this._module.refreshRule(this._id)}getIndex(){return this._module.getRuleIndex(this._id)}setIndex(t){return this._module.setRuleIndex(this._id,t)}update(t){return this._module.updateRule(this._id,t)}getDefinition(){return this._module.getRuleDefinition(this._id)}destroy(){return this._module.destroyRule(this._id)}},cL=1e3,gL=1/cL,_L=class extends Bt{constructor(){super(...arguments),this._idCounter=1,this._rules=[]}onMounted(){this._rules=[],this._modules.events.register(["addStyleRule","removeStyleRule","updateStyleRule","refreshStyleRule"])}_get(t){for(let e=0;e<this._rules.length;++e){const s=this._rules[e];if(s.id===t)return s.index=e,s}throw new Error("calling a method on a destroyed style rule")}_updatePriorities(){for(let t=0;t<this._rules.length;++t){const e=this._rules[t],s=Iv+t*gL;e.attributeLayer.update({priority:s})}}addRule(t={}){const e=this._idCounter++,s=this._modules.graphics.addAttributeLayer(ct({name:`rule(${e})`},Xg(t))),i=this._modules.dom.afterNextFrame(),n=new uL(this,e,i),r={id:e,attributeLayer:s,wrapper:n};return this._rules.push(r),this._updatePriorities(),this._modules.events.fire("addStyleRule",{rule:r,options:t,id:r.id}),n}getRuleIndex(t){const e=this._get(t);return e.index==null?null:e.index}setRuleIndex(t,e){const s=this._get(t),i=bs(e,0,this._rules.length-1);return this._rules.splice(s.index,1),this._rules.splice(i,0,s),this._updatePriorities(),this._modules.dom.afterNextFrame()}updateRule(t,e){const s=this._get(t),i=Object.assign({fullOverwrite:e.fullOverwrite},e);return s.attributeLayer.update(i),this._modules.events.fire("updateStyleRule",{rule:s,options:e}),this._modules.dom.afterNextFrame()}getRuleDefinition(t){return Xg(this._get(t).attributeLayer.getDefinition())}destroyRule(t){const e=this._get(t);return this._modules.events.fire("removeStyleRule",{rule:e,id:e.id}),e.attributeLayer.destroy(),this._rules.splice(e.index,1),this._modules.dom.afterNextFrame()}refreshRule(t){const e=this._get(t);return e.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:e,id:t}),this._modules.dom.afterNextFrame()}refreshAllRules(){for(const t of this._rules)t.attributeLayer.updateAll(),this._modules.events.fire("refreshStyleRule",{rule:t,id:t.id});return this._modules.dom.afterNextFrame()}getRuleList(){return this._rules.map(t=>t.wrapper)}};function Xg(t){return{nodeAttributes:t.nodeAttributes,edgeAttributes:t.edgeAttributes,nodeSelector:t.nodeSelector,edgeSelector:t.edgeSelector,nodeDependencies:t.nodeDependencies,edgeDependencies:t.edgeDependencies,nodeOutput:t.nodeOutput,edgeOutput:t.edgeOutput}}var sh,Wg={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t})=>t.setSelected(!0),bothExtremities:!1},ax=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._points=[],this._bbox=new je,this._onStart=({x:t,y:e})=>{this._bbox.reset(),this.savePoint(t,e,!1)},this._onStop=()=>{const{minX:t,minY:e,maxX:s,maxY:i}=this._bbox,{nodes:n,edges:r}=this._modules.spatial.queryProjected(t,e,s,i),o={},a=n.filter(d=>{const h=d.isVisible(),u=d.getAttribute("detectable"),c=h&&u&&this._modules.locate.isNodeInPolygon(d,this._points);return o[d._index]=c,c});let l=r.filter(d=>{const h=d.isVisible(),u=d.getAttribute("detectable");return h&&u&&this._modules.locate.isEdgeInPolygon(d,this._points)});this._options.bothExtremities&&(l=this.filterByExtremities(l,o)),this._layer.clear(),this._points=[],this.disable(),this._options.callback({nodes:a,edges:l})}}onMounted(){this._options=Ie(Wg),this._cachedCursor="",this._modules.events.isRegistered("lassoEnabled")||this._modules.events.register(["lassoEnabled","lassoDisabled"]),this._interaction=this._modules.interactions.onDrag({priority:"lasso",check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this.savePoint(t,e,!0),onStop:this._onStop})}enable(t={}){var e;return this._enabled||(this._enabled=!0,this._modules.captor.setDetectionEnabled(!1),this._options=vs(t,Wg),this._layer=this._modules.layers.addCanvasLayer(qt,{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this._cachedCursor=((e=this._layer.element.parentElement)==null?void 0:e.style.cursor)||"",va(this._layer.element.parentElement,this._options.cursorStyle),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorPosition()),this._modules.events.fire("lassoEnabled")),this}disable(){return this._enabled?(this._enabled=!1,this._modules.captor.setDetectionEnabled(!0),va(this._layer.element.parentElement,this._cachedCursor),this._layer.destroy(),this._modules.events.fire("lassoDisabled"),this):this}enabled(){return this._enabled}savePoint(t,e,s){const i=fs(),n=this._options,r=this._points;if(this._bbox.addPoint(t,e),r.push({x:t,y:e}),s){const o=r[0];this._layer.refresh(a=>{a.lineWidth=n.strokeWidth,a.lineJoin="bevel",a.strokeStyle=n.strokeColor,a.fillStyle=n.fillColor,a.beginPath(),a.moveTo(o.x*i,o.y*i);for(let l=1;l<r.length;++l){const d=r[l];a.lineTo(d.x*i,d.y*i)}a.stroke(),n.fillColor&&a.fill()})}}filterByExtremities(t,e){const s=this._modules.graph.getEdgeAttribute("source"),i=this._modules.graph.getEdgeAttribute("target");return t.filter(n=>{const r=n._index,o=s.get(r),a=i.get(r);return e[o]&&e[a]})}},$g={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:({nodes:t,edges:e})=>{t.size?t.setSelected(!0):e.setSelected(!0)},bothExtremities:!1},mL=class extends ax{constructor(){super(...arguments),this._onStart=({x:t,y:e})=>{var s;this._rectangle.reset(),this._start={x:t,y:e},(s=this._layer)==null||s.refresh(i=>{i.fillStyle=this._options.fillColor,i.strokeStyle=this._options.strokeColor,i.lineWidth=this._options.strokeWidth})},this._onStop=()=>{var t;const e=this._modules.captor.getCursorPosition(),s=this._formatRectangle(e),{nodes:i,edges:n}=this._modules.spatial.queryProjected(s.minX,s.minY,s.maxX,s.maxY),r={},o=i.filter(l=>{const d=l.isVisible(),h=l.getAttribute("detectable"),u=d&&h&&this._modules.locate.isNodeInRectangle(l,s);return r[l._index]=u,u});let a=n.filter(l=>{const d=l.isVisible(),h=l.getAttribute("detectable");return d&&h&&this._modules.locate.isEdgeInRectangle(l,s)});this._options.bothExtremities&&(a=this.filterByExtremities(a,r)),(t=this._layer)==null||t.clear(),this.disable(),this._options.callback({nodes:o,edges:a})}}onMounted(){this._options=Ie($g),this._enabled=!1,this._rectangle=new je,this._interaction=this._modules.interactions.onDrag({priority:"lasso",disableDetection:!0,check:()=>this._enabled,onStart:this._onStart,onProgress:({x:t,y:e})=>this._refreshRectangle({x:t,y:e}),onStop:this._onStop})}enable(t){return super.enable(vs(t,$g))}_formatRectangle(t){const e=this._start.x,s=this._start.y,i=t.x,n=t.y,r=Math.abs(e-i),o=Math.abs(s-n),a=e<i?e:i,l=s<n?s:n;return this._rectangle.reset().addPoint(a,l).addPoint(a+r,l+o)}_refreshRectangle(t){var e;const{minX:s,minY:i,width:n,height:r}=this._formatRectangle(t),o=fs();(e=this._layer)==null||e.refresh(a=>{a.strokeRect(s*o,i*o,n*o,r*o),this._options.fillColor&&a.fillRect(s*o,i*o,n*o,r*o)})}},Hs=6,lx=5,Fr=1,dx=0,hx=0,ih=-1;function ux(t,e,s,i){dx=t,sh=s,hx=e?1:0,ih=i}var Yg=(t,e,s,i)=>n=>{const{rects:r,bboxes:o,intersects:a,indexToLayer:l,indexToRemoveNodeText:d,indexToRemoveEdgeText:h}=i;if(o[n*Hs+5]===dx&&o[n*Hs+4]===s)return!1;const u=n*lx,c=lo(r[u],r[u+1],r[u+2],r[u+3],r[u+4]);if(Ap(sh,c)){if(i.realIntersection=!0,ih<=0&&a.push(sh,c),!(e||l[o[n*Hs+5]]<ih))return!0;t.remove(n),i.realIntersection=!1,o[n*Hs+4]===hx?d[o[n*Hs+5]]=!0:h[o[n*Hs+5]]=!0}return!1};function Zg(t,e,s="#22ff00"){return nh([[t[0],t[1]],[t[2],t[1]],[t[2],t[3]],[t[0],t[3]]].map(i=>({x:i[0],y:i[1]})),e,s)}function nh(t,e,s="#ff0000"){e.strokeStyle=s,e.beginPath();for(let i=0,n=t.length;i<n;i++)i===0?e.moveTo(t[i].x,t[i].y):e.lineTo(t[i].x,t[i].y);e.closePath(),e.stroke()}function fL(t,e,s,i,n){for(let a=0,l=e.length;a<l;a+=Hs)Zg(e.slice(a,a+4),t,"#aaaaaa");for(let a=0;a<s.length;a+=lx)nh(lo(s[a],s[a+1],s[a+2],s[a+3],s[a+4]),t,"green");const r=[n.root];let o=n.root;for(;o=r.pop();)o.leaf||r.push.apply(r,o.children),Zg(n.getNodeBounds(o),t,"rgba(0,0,0,0.2)"),o=r.pop();i.forEach(a=>nh(a,t,"red"))}var lr={x1:0,y1:0,x2:0,y2:0},$l={x:0,y:0},vn={x:0,y:0},pL=Math.PI/2,yL=0;function xL(t,e,s,i,n,r,o,a,l,d,h){const u=a.remove.nodes,c=a.remove.edges,g=a.redraw.edges,_=s.angle,m=s.zoom,f=n.x,p=n.y,y=n.radius,b=Math.PI,{source:x,target:v,scalingMethod:E}=i,w=i.width,A=i.curvature,I=i.layer,M=i.text.content,k=i.text.scaling,W=i.text.size,H=i.text.font,$=i.text.style,P=i.text.scale,S=i.text.maxLineLength,Y=i.text.margin,st=i.text.minVisibleSize,at=i.text.padding,Tt=i.animationDuration,ut=i.text.adjustAngle,Mt=i.text.position;a.indexToLayer={},a.indexToQuadIndex={},a.indexToRemoveNodeText={},a.indexToRemoveEdgeText={},a.indexToRedrawEdgeText={},a.byLayer=[];const{byLayer:Nt,indexToLayer:_t,indexToQuadIndex:St,indexToRedrawEdgeText:Zt,indexToRemoveNodeText:Qt,indexToRemoveEdgeText:Kt}=a;for(let q=0;q<t.length;q++){const et=t[q],dt=I.get(et)-If;for(let ot=1;ot<=dt;ot++)(Nt[ot]=Nt[ot]||[]).push(et);_t[et]=dt}if(l!==null){const q=Nt.length;for(let et=_t[l]+1;et<=q;et++)(Nt[et]=Nt[et]||[]).unshift(l);_t[l]=q}const mt=[0,0,0,0],pt=[0,0,0,0,0],{bboxes:ue,rects:Jt}=a,ce=(q,et=-1)=>{const dt=Tt.get(q);let ot=M?M.get(q):"";if(ot===null||ot===""||dt)return!1;const nt=x.get(q),it=v.get(q);let wt=w.get(q);const At=A.get(q),Et=st.get(q);if(wt*m<Et)return Kt[q]=!0,!1;E.get(q)==="fixed"&&(wt/=m);let Ht=(f.get(nt)+f.get(it))/2,Gt=(p.get(nt)+p.get(it))/2;ot=ot?ot.toString():"";const pe=!k.get(q),ge=P.get(q)*(pe?1:m),_e=H.get(q),be=(pe?W.get(q):ge*wt)*Fr,Ce=$.get(q),$t=S.get(q),re=Mt.get(q)===ao;let ve=+re*Y.get(q)+i.text.padding.get(q);const fe=f.get(nt),ee=p.get(nt),we=f.get(it),ye=p.get(it),Pe=y.get(nt),ps=y.get(it);let te;const se=nt===it;if(se)te=b/4-_,un(fe,ee,At,Pe,0,lr),$r(.5,fe,ee,we,ye,lr.x1,lr.y1,lr.x2,lr.y2,vn),Ht=vn.x,Gt=vn.y,ve/=-m;else{if(fe===we&&ee===ye)return!1;te=Hn(fe,ee,we,ye)-_,At!==0&&(te=Hn(fe,ee,we,ye)-_,Bs(fe,ee,we,ye,At,$l),cl(.5,fe,ee,we,ye,$l.x,$l.y,vn),Ht=vn.x,Gt=vn.y)}const ie=ve+yL,Me=np(ot,$t);if(!Me)return!1;const{lines:Ne,data:$e}=Me;let as=r($e[0],_e,Ce,be).width*Fr;for(let He=1;He<Ne;He++)as=Math.max(as,r($e[He],_e,Ce,be).width*Fr);const De=Ne*be,qe=as/m/2,gs=De/m/2,Us=Math.abs(Ea(te))<pL?1:-1;let me=re?se?De/m+wt/2+ve:Us*(ie/m+wt/2+gs):0;if(!se&&At===0&&ut.get(q)){const He=at.get(q);Oe(fe,ee,we,ye)*m-(Pe+ps)*(h?1:m)<as+2*He+1&&(me*=Us,te=0)}if(pt[0]=Ht-qe,pt[1]=Gt-gs,pt[2]=Ht+qe,pt[3]=Gt+gs,pt[4]=te+_,eh(pt,-(te+_),-me,pt),pt[2]=pt[2]-pt[0],pt[3]=pt[3]-pt[1],te=b-te-_,_l(Ht-qe,Gt-gs,2*qe,2*gs,te,void 0,void 0,mt),eh(mt,te,me,mt),a.realIntersection=!1,ux(q,!1,lo(pt[0],pt[1],pt[2],pt[3],pt[4]),et),e.traverse(mt[0],mt[1],mt[2],mt[3],d),a.realIntersection&&!o)return Kt[q]=!0,!1;if(Zt[q]=!0,Qt[q]=!1,et<=0){const He=ue.length/Hs;St[q]=He,ue.push(mt[0],mt[1],mt[2],mt[3],0,q),e.insert(He,mt[0],mt[1],mt[2],mt[3]),Jt.push(pt[0],pt[1],pt[2],pt[3],pt[4])}else e.insert(St[q],mt[0],mt[1],mt[2],mt[3])};for(const q of t)ce(q);let oe=!0;for(let q=0;q<Nt.length;q++){const et=Nt[q];if(et)if(oe)oe=!1;else for(const dt of et)ce(dt,q)}for(let q=0;q<t.length;q++){const et=t[q];Qt[et]?u.push(et):Zt[et]&&g.push(et),Kt[et]&&c.push(et)}return a}var bL={left:-1,right:1,top:0,bottom:0,center:0},vL={left:0,right:0,top:-1,bottom:1,center:0},EL={left:-1,right:0,top:-.5,bottom:-.5,center:-.5},AL={left:-.5,right:-.5,top:-1,bottom:0,center:-.5},SL=(t,e,s)=>np(e,s.get(t))||{lines:0,data:[" "],maxLength:1},wL=(t,e,s,i,n,r,o)=>{const{lines:a,data:l}=SL(t,e,i);let d=s(l[0],n,r,o).width;for(let h=1;h<a;h++)d=Math.max(d,s(l[h],n,r,o).width);return[d,a*o*Fr]},TL=(t,e,s)=>{const i=e.text.content,n=e.radius,r=e.text.scaling,o=e.text.position,a=e.text.padding,l=e.text.scale,d=e.text.size,h=e.text.style,u=e.text.font,c=e.text.maxLineLength,g=e.text.margin,_=i.get(t),m=n.get(t),f=!r.get(t),p=o.get(t),y=a.get(t),b=l.get(t),x=(f?d.get(t):b*m*2)*Fr,v=h.get(t),E=u.get(t),w=y+g.get(t),A=bL[p],I=vL[p],[M,k]=wL(t,`${_}`,s,c,E,v,x),W=M/2,H=k/2;return[EL[p]*M,AL[p]*k,A*w,I*w,A*m,I*m,M,k,W,H]};function LL(t,e,s,i,n,r,o,a,l){const d=o.remove.nodes,h=o.remove.edges,u=o.redraw.nodes,c=s.angle,g=s.zoom,_=s.sin,m=s.cos,f=i.x,p=i.y,y=i.radius,b=i.layer,x=i.scalingMethod,v=i.text.content,E=i.text.scaling,w=i.text.minVisibleSize,A=i.animationDuration,I=i.textHidden,M=i.excluded;o.indexToLayer={},o.indexToQuadIndex={},o.indexToRemoveNodeText={},o.indexToRemoveEdgeText={},o.indexToRedrawNodeText={},o.byLayer=[];const{indexToLayer:k,indexToRedrawNodeText:W,indexToRemoveNodeText:H,indexToRemoveEdgeText:$,indexToQuadIndex:P,byLayer:S}=o;for(let _t=0;_t<t.length;_t++){const St=t[_t],Zt=b.get(St)-If;(S[Zt]=S[Zt]||[]).push(St),k[St]=Zt}if(a!==null){const _t=S.length;for(let St=k[a]+1;St<=_t;St++)(S[St]=S[St]||[]).unshift(a);k[a]=_t}let Y;const st=[0,0,0,0],at=[0,0,0,0,0],{bboxes:Tt,rects:ut}=o,Mt=(_t,St=-1)=>{const Zt=A.get(_t);let Qt=v.get(_t);if(Qt===null||Qt===""||Zt!==0)return!1;let Kt=y.get(_t);const mt=w.get(_t);if(M.get(_t)===1)return H[_t]=!0,!1;if(2*Kt*g<mt)return I.get(_t)===0&&(H[_t]=!0),!1;x.get(_t)==="fixed"&&(Kt/=g);const pt=f.get(_t),ue=p.get(_t);typeof Qt=="number"&&(Qt=Qt.toString());let[Jt,ce,oe,q,et,dt,ot,nt,it,wt]=n(_t);const At=!E.get(_t),Et=At?g:1,Ht=x.get(_t)==="fixed"?g:1;At?(oe+=it,q+=wt,it/=g,wt/=g,ot/=g,nt/=g):(oe+=it*g,q+=wt*g),Jt=Jt/Et+oe/g+et/Ht,ce=ce/Et+q/g+dt/Ht,_l(pt-it,ue-wt,ot,nt,-c,_,-m,st),at[0]=pt-it,at[1]=ue-wt,at[2]=ot,at[3]=nt,at[4]=c;const Gt=m*Jt-_*ce,pe=_*Jt+m*ce;if(st[0]+=Gt,st[1]+=pe,st[2]+=Gt,st[3]+=pe,at[0]+=Gt,at[1]+=pe,o.realIntersection=!1,ux(_t,!0,lo(at[0],at[1],at[2],at[3],at[4]),St),e.traverse(st[0],st[1],st[2],st[3],l),o.realIntersection&&!r)return H[_t]=!0,!1;W[_t]=!0,H[_t]=!1,St<=0?(Y=Tt.length/Hs,P[_t]=Y,Tt.push(st[0],st[1],st[2],st[3],1,_t),e.insert(Y,st[0],st[1],st[2],st[3]),ut.push(at[0],at[1],at[2],at[3],at[4])):e.insert(P[_t],st[0],st[1],st[2],st[3])};for(const _t of t)Mt(_t);let Nt=!0;for(let _t=0;_t<S.length;_t++){const St=S[_t];if(St)if(Nt)Nt=!1;else for(const Zt of St)Mt(Zt,_t)}for(let _t=0;_t<t.length;_t++){const St=t[_t];H[St]?d.push(St):W[St]&&u.push(St),$[St]&&h.push(St)}return o}var IL=1,CL="topDown",ML="bottomUp",NL=.15,FL=200,PL=80,DL=["x","y","radius","width","layer","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position","text.style"].reduce((t,e)=>(t.add(e),t),new Set),kL=class extends Bt{constructor(t,e){super(t),this._textBBoxes=[],this._rects=[],this._enabled=!1,this._geoEnabled=!1,this._intersects=[],this._textDisplacement={},this._textDisplacementUpdate={},this._output={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]},rects:this._rects,bboxes:this._textBBoxes,intersects:this._intersects,realIntersection:!1,indexToLayer:{},byLayer:[],indexToRedrawEdgeText:{},indexToRemoveEdgeText:{},indexToRedrawNodeText:{},indexToRemoveNodeText:{},indexToQuadIndex:{}},this._onZoomStart=$a(({startZoom:s,endZoom:i})=>{this._enabled&&i<s&&this._updateLabels(this._modules.camera.clone({zoom:i}))},PL),this._onAttributesChanged=s=>{if([...s.edgeAttributes,...s.nodeAttributes].some(i=>DL.has(i))){const i=s.nodes._indexes;for(let n=0;n<i.length;n++)this._textDisplacementUpdate[i[n]]=!0;this._update()}},this._onItemsAdded=s=>{const i=s.nodes||s.edges;(this._enabled||this._forceEnabled)&&this._modules.settings.get("texts.preventOverlap")&&this._modules.graphics.setTextHidden(i,!0)},this._onToggle=s=>(s?this._update():this._reset(),this),this._update=()=>{(this._enabled||this._forceEnabled)&&this._updateDebounced()},this._toggleDebug=s=>{s?this._modules.layers.whenReady(()=>{this._layer=this._modules.layers.addCanvasLayer(i=>{i.lineWidth=1/this._modules.camera.getZoom(),fL(i,this._textBBoxes,this._rects,this._intersects,this._quadtree)},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._canvas=this._layer.element,this._ctx=this._canvas.getContext("2d"),this._update()}):this._canvas&&(this._layer.destroy(),this._canvas=this._ctx=null)},this._measureText=(s,i,n,r)=>this._engine.measureText(s,i,n,r),this._textDisplacement={},this._textDisplacementUpdate={},this._quadtree=new df(s=>{const i=Hs,n=i*s;return this._textBBoxes.slice(n,n+i)},IL),e.forceEnableTextOverlapRemoval&&this.forceEnable()}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.events.register(["labelCollisionsRemoved"]),this.setRate(FL),this._modules.settings.register("texts.preventOverlap",!0,this._onToggle),this._modules.settings.register("texts.debug",!1,this._toggleDebug),this._modules.settings.register("texts.removalStrategy",CL);const t=this._output;this._nodeTraversal=Yg(this._quadtree,!1,1,t),this._edgeTraversal=Yg(this._quadtree,!1,0,t),this._modules.events.on(["addNodes","addEdges"],this._onItemsAdded).on("layoutEnd",()=>this._updateLabels()).on(["viewChanged","mouseover","mouseout"],this._update).on("updateAttributes",this._onAttributesChanged).on("setContainer",({element:e})=>{if(e)return this._enable();this._disable()}).on("zoomStart",this._onZoomStart).on("viewExportStart",({preventOverlap:e,camera:s})=>{e&&this.forceUpdate(s)}).on("viewExportEnd",()=>{this.forceUpdate()}).on("geoEnabled",()=>this._geoEnabled=!0).on("geoDisabled",()=>this._geoEnabled=!1)}getTextsBoundingBox(t,e){t||e?this._updateLabels(this._modules.camera,t?Array.from(t._indexes):[],e?Array.from(e._indexes):[]):this._updateLabels();const s=this._rects,i=new je;for(let n=0;n<s.length;n+=5){const r=s[n],o=s[n+1],a=s[n+2],l=s[n+3],d=s[n+4],[h,u,c,g]=_l(r,o,a,l,d);i.addPoint(h,u).addPoint(c,g)}return i}setRate(t){this._updateDebounced=this._modules.sync.debounceIdle(e=>this._updateLabels(e),t)}forceEnable(){this._forceEnabled=!0}update(){this._update()}forceUpdate(t=this._modules.camera){this._updateLabels(t)}_enable(){this._enabled=!0,this._update()}_disable(){this._textBBoxes=[],this._rects=[],this._intersects=[],this._enabled=!1}_onCameraMove(){this._update()}_updateLabels(t=this._modules.camera,e,s){if(!this._modules.settings.get("texts.preventOverlap"))return;const i=this._modules.graphics.getNodeAttributes(),n=this._modules.graphics.getEdgeAttributes();this._intersects=[],this._textBBoxes=[],this._rects=[];const r=t.getAngle(),o=t.getProjectedScreenBounds(NL),a=this._modules.settings.get("texts.removalStrategy")===ML,l={angle:r,zoom:t.zoom,screen:o,sin:Math.sin(r),cos:Math.cos(r)};this._resetOutput();const d=this._output;if(!e||!s){const _=this._modules.spatial.queryRaw(o[0],o[1],o[2],o[3]);e=_.nodes,s=_.edges}const h=this._quadtree.clear().cover(o[0],o[1],o[2],o[3]);if(e.length+s.length===0)return;const u=this._modules.captor.getPointedElement();let c=null,g=null;u!==null&&(u.isNode?c=u._index:g=u._index);for(const _ of e)!this._textDisplacementUpdate[_]&&this._textDisplacement[_]||(this._textDisplacement[_]=TL(_,i,this._measureText),this._textDisplacementUpdate[_]=!1);LL(e,h,l,i,_=>this._textDisplacement[_],a,d,c,this._nodeTraversal),xL(s,h,l,n,i,this._measureText,a,d,g,this._edgeTraversal,this._geoEnabled),this._clearOverlaps(d),this._modules.settings.get("texts.debug")&&this._layer.refresh()}_clearOverlaps(t){const e=this._modules.graph.nodeList,s=this._modules.graph.edgeList,i=this._modules.graphics,n=e(new Uint32Array(t.remove.nodes)),r=s(new Uint32Array(t.remove.edges)),o=e(new Uint32Array(t.redraw.nodes)),a=s(new Uint32Array(t.redraw.edges));i.setTextHidden(n,!0),i.setTextHidden(r,!0),i.setTextHidden(o,!1),i.setTextHidden(a,!1),this._modules.events.fire("labelCollisionsRemoved",t)}_resetOutput(){const t=this._output;t.remove.nodes=[],t.remove.edges=[],t.redraw.nodes=[],t.redraw.edges=[],t.rects=this._rects,t.bboxes=this._textBBoxes,t.intersects=this._intersects,t.realIntersection=!1,t.indexToLayer={},t.byLayer=[],t.indexToRedrawEdgeText={},t.indexToRemoveEdgeText={},t.indexToRedrawNodeText={},t.indexToRemoveNodeText={},t.indexToQuadIndex={}}_reset(){this._modules.graphics.resetTextHidden(),this._textDisplacement={},this._textDisplacementUpdate={}}},RL=class extends Bt{constructor(){super(...arguments),this._onStartInteractionEvent=(t,e)=>{if(this._current)return;const s=this._interactionsByStartEvent[e];let i;for(const n of s)n.check(t)&&(!i||n.priority>=i.priority)&&(i=n);i&&this._startInteraction(i,t)},this._onProgressInteractionEvent=(t,e)=>{this._current&&this._current.progressEventName===e&&this._current.onProgress&&this._current.onProgress(t)},this._onStopInteractionEvent=(t,e)=>{this._current&&this._current.stopEventName===e&&this._stopCurrentInteraction(null)}}onMounted(){this._interactionsByStartEvent={},this._boundProgressEvents={},this._boundStopEvents={}}_startInteraction(t,e){t.onStart&&t.onStart(e),t.onStop&&(this._current=t,t.disableDetection&&this._modules.captor.setDetectionEnabled(!1))}_stopCurrentInteraction(t){this._current&&this._current.disableDetection&&this._modules.captor.setDetectionEnabled(!0),this._current&&this._current.onStop&&this._current.onStop(t),this._current=void 0}_forceStartInteraction(t,e){this._current&&this._stopCurrentInteraction(e),this._startInteraction(t,e)}_createWrapper(t){return{start:e=>this._forceStartInteraction(t,e)}}_addInteraction(t,e){const s=this._interactionsByStartEvent[t];return s?s.push(e):(this._interactionsByStartEvent[t]=[e],this._modules.events.on(t,this._onStartInteractionEvent)),this._createWrapper(e)}_createProgressiveInteraction(t,e,s,i){const n={priority:Kg(i.priority),check:i.check||zr,onStart:i.onStart||qt,onProgress:i.onProgress||qt,onStop:i.onStop||qt,disableDetection:!!i.disableDetection,progressEventName:e,stopEventName:s};return this._boundProgressEvents[e]||(this._boundProgressEvents[e]=!0,this._modules.events.on(e,this._onProgressInteractionEvent)),this._boundStopEvents[s]||(this._boundStopEvents[s]=!0,this._modules.events.on(s,this._onStopInteractionEvent)),this._addInteraction(t,n)}_createNonProgressiveInteraction(t,e){return this._addInteraction(t,{priority:Kg(e.priority),check:e.check||zr,onStart:e.handler||qt,onProgress:void 0,onStop:void 0,disableDetection:!1,progressEventName:void 0,stopEventName:void 0})}onDrag(t){return this._createProgressiveInteraction("dragStart","dragProgress","dragEnd",t)}onGesture(t){return this._createProgressiveInteraction("gestureStart","gestureProgress","gestureEnd",t)}onClick(t){return this._createNonProgressiveInteraction("click",t)}onDoubleClick(t){return this._createNonProgressiveInteraction("doubleclick",t)}onHover(t){return this._createNonProgressiveInteraction("mouseover",t)}onUnhover(t){return this._createNonProgressiveInteraction("mouseout",t)}onMouseWheel(t){return this._createNonProgressiveInteraction("mousewheel",t)}onMouseDown(t){return this._createNonProgressiveInteraction("mousedown",t)}onMouseUp(t){return this._createNonProgressiveInteraction("mouseup",t)}onMouseMove(t){return this._createNonProgressiveInteraction("mousemove",t)}};function Kg(t){return typeof t=="string"?Ov.indexOf(t):typeof t!="number"||isNaN(t)?0:t}var OL=["virtualUp","mouseupInternal","touchUp"],zL=["virtualDown","mousedownInternal","touchDown"],BL=["virtualMove","mousemoveInternal","touchMove"],UL=["virtualClick","clickInternal","touchTap"],GL=["virtualDoubleClick","doubleclickInternal","touchDoubleTap"],VL=["virtualWheel","mousewheelInternal"],jL=100,qL=class extends Bt{constructor(){super(...arguments),this._elt=null,this._hoveredElt=null,this._draggedElt=null,this._hover=!1,this._disabledCounter=0,this._accDx=0,this._accDy=0,this._prevX=0,this._prevY=0,this._buttons={left:{isPressed:!1,isDragging:!1},middle:{isPressed:!1,isDragging:!1},right:{isPressed:!1,isDragging:!1}},this._onGraphChanged=()=>{this._resetCurrent(this._modules.position.x,this._modules.position.y),this._onMove({x:this._modules.position.x,y:this._modules.position.y,source:null,domEvent:null})}}onMounted(){this._modules.events.register(["mousemove","mousedown","mouseup","click","doubleclick","mousewheel","mouseout","mouseover","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]),this._modules.settings.register("detect.nodes",!0).register("detect.edges",!0).register("detect.nodeTexts",!0).register("detect.nodeBadges",!0).register("detect.edgeTexts",!0).register("detect.nodeErrorMargin",5).register("detect.edgeErrorMargin",2).register("detect.enableSpatialIndex",!0).register("detect.spatialIndexMarginRatio",20),this._modules.events.on(["removeNodes","removeEdges","clearGraph"],this._onGraphChanged).on(BL,(t,e)=>{this._onMove(Wt(ct({},t),{source:ji(e)}))}).on(zL,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDown({domEvent:t,x:e,y:s,button:i,source:ji(n)})}).on(OL,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onUp({domEvent:t,x:e,y:s,button:i,source:ji(n)})}).on(UL,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onClick({domEvent:t,x:e,y:s,button:i,source:ji(n)})}).on(GL,({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDoubleClick({domEvent:t,x:e,y:s,button:i,source:ji(n)})}).on(VL,({domEvent:t,x:e,y:s,delta:i})=>this._onWheel({domEvent:t,x:e,y:s,delta:i,source:"mouse"})).on("touchStartGesture",t=>this._modules.events.fire("gestureStart",t)).on("touchProgressGesture",t=>this._modules.events.fire("gestureProgress",t)).on("touchEndGesture",t=>this._modules.events.fire("gestureEnd",t)).on("documentMouseMove",({domEvent:t,x:e,y:s},i)=>{this._onDocumentMove({domEvent:t,x:e,y:s,source:ji(i)})}).on("documentMouseUp",({domEvent:t,x:e,y:s,button:i="left"},n)=>{this._onDocumentUp({domEvent:t,x:e,y:s,source:ji(n),button:i})})}triggerUnhover(){this._hover=!1,this._hoveredElt=null}triggerDetection(){this._detectElement(this._modules.position.x,this._modules.position.y,!1,!1),this._elt&&(this._hoveredElt=this._elt,this._hover=!0)}getPointedElement(){return this._hoveredElt}getDraggedElement(){return this._draggedElt}isAnyButtonPressed(){return this._buttons.left.isPressed||this._buttons.right.isPressed||this._buttons.middle.isPressed}isAnyButtonDragging(){return this._buttons.left.isDragging||this._buttons.right.isDragging||this._buttons.middle.isDragging}isButtonPressed(t){return this._buttons[t].isPressed}isLeftPressed(){return this.isButtonPressed("left")}getCursorPosition(){return{x:this._modules.position.x,y:this._modules.position.y}}getCursorInformation(){return{x:this._modules.position.x,y:this._modules.position.y,target:this._hoveredElt}}setDetectionEnabled(t){this._disabledCounter=Math.max(0,this._disabledCounter+(t?-1:1))}_resetCurrent(t,e){for(const s in this._buttons){const i=this._buttons[s];i.isDragging&&this._modules.events.fire("dragEnd",{domEvent:null,x:t,y:e,button:s,target:this._draggedElt}),i.isPressed=!1,i.isDragging=!1}this._hover&&this._hoveredElt&&this._modules.events.fire("mouseout",{domEvent:null,x:t,y:e,target:this._hoveredElt}),this._hover=!1,this._hoveredElt=null,this._draggedElt=null}_onMove({domEvent:t,x:e,y:s,source:i}){let{dx:n,dy:r}=this._setPointerPosition(e,s);this._modules.events.fire("mousemove",{domEvent:t,x:e,y:s,dx:n,dy:r,source:i});for(const o in this._buttons){const a=this._buttons[o];if(a.isPressed)if(a.isDragging){const l=this._getStoredDXY();n+=l.dx,r+=l.dy,this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:n,dy:r,button:o,source:i,target:this._draggedElt})}else a.isDragging=!0,this._hoveredElt&&this._hover&&(this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt}),this._hover=!1),this._draggedElt||(this._draggedElt=this._hoveredElt),this._storeDXY(n,r),this._modules.events.fire("dragStart",{domEvent:t,x:e,y:s,button:o,source:i,target:this._draggedElt})}t&&!this._modules.graphics.getDomElement().contains(t.target)||this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&(this._hoveredElt&&this._hover&&(this._hover=!0,this._modules.events.fire("mouseout",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})),this._hoveredElt=this._elt,this._elt&&(this._hover=!0,this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:i,target:this._hoveredElt})))}_onDocumentMove({domEvent:t,x:e,y:s,source:i}){for(const n in this._buttons){const{isDragging:r}=this._buttons[n];if(r){const{dx:o,dy:a}=this._setPointerPosition(e,s);this._modules.events.fire("dragProgress",{domEvent:t,x:e,y:s,dx:o,dy:a,button:n,source:i,target:this._draggedElt})}}}_onDocumentUp({domEvent:t,x:e,y:s,source:i,button:n}){if(n!=null&&this._buttons[n].isDragging){this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:n,source:i,target:this._draggedElt});const r=this._buttons[n];r.isDragging=!1,r.isPressed=!1,this.isAnyButtonDragging()||(this._draggedElt=null)}}_onDown({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;this._detectElement(e,s,!1,!1),this._elt!==this._hoveredElt&&this._resetCurrent(e,s);const r=this._buttons[i];this._hoveredElt=this._elt,r.isPressed=!0,this._elt&&t&&(t.stopPropagation(),t.preventDefault()),this._modules.events.fire("mousedown",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onDoubleClick({domEvent:t,x:e,y:s,button:i,source:n}){i!=null&&(Jg(t,"doubleclick")||this._modules.events.fire("doubleclick",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt}))}_onUp({domEvent:t,x:e,y:s,button:i,source:n}){if(i==null)return;const r=this._buttons[i];r.isPressed&&(r.isDragging&&(this._modules.events.fire("dragEnd",{domEvent:t,x:e,y:s,button:i,source:n,target:this._draggedElt}),r.isDragging=!1,this.isAnyButtonDragging()||(this._draggedElt=null)),r.isPressed=!1,this._detectElement(e,s,!1,!1),this._modules.events.fire("mouseup",{domEvent:t,x:e,y:s,button:i,source:n,target:this._elt}),this.isAnyButtonPressed()||this._hover||n==="touch"||(this._hoveredElt=this._elt,this._hoveredElt&&(this._modules.events.fire("mouseover",{domEvent:t,x:e,y:s,source:n,target:this._hoveredElt}),this._hover=!0)))}_onClick({domEvent:t,x:e,y:s,button:i,source:n}){Jg(t,"click")||this._modules.events.fire("click",{domEvent:t,x:e,y:s,button:i,source:n,target:this._hoveredElt})}_onWheel({domEvent:t,x:e,y:s,delta:i,source:n}){this._modules.position.x=e,this._modules.position.y=s,this._modules.events.fire("mousewheel",{domEvent:t,x:e,y:s,delta:i,source:n,target:this._hoveredElt})}_storeDXY(t,e){this._accDx=t,this._accDy=e}_getStoredDXY(){const t=this._accDx,e=this._accDy;return this._accDx=0,this._accDy=0,{dx:t,dy:e}}_setPointerPosition(t,e){const s=t-this._prevX,i=e-this._prevY;return this._modules.position.x=t,this._modules.position.y=e,this._prevX=t,this._prevY=e,this._accDx=0,this._accDy=0,{dx:s,dy:i}}_detectElement(t,e,s,i){this._elt=this.detectElementAt(t,e,s,i)}detectElementAt(t,e,s,i){if(this._disabledCounter!==0)return null;const n=this._modules.settings,r=n.get("detect.enableSpatialIndex"),o=n.get("detect.nodeErrorMargin")||0,a=n.get("detect.edgeErrorMargin")||0;let l=n.get("detect.nodes"),d=n.get("detect.edges");i&&(l=!0,d=!0);let h=null,u=[],c=[];if(!s&&r&&(l||d)){const m=n.get("detect.spatialIndexMarginRatio"),f=Math.max(o*m,a*m),p=this._modules.spatial.queryRawProjected(t-f,e-f,t+f,e+f);u=p.nodes,c=p.edges}let g=null,_=null;if(l&&(g=this._modules.graphics.detectNode(t,e,!!n.get("detect.nodeBadges"),!!n.get("detect.nodeTexts"),o,u)),d&&(c.length<jL||!g)&&(_=this._modules.graphics.detectEdge(t,e,!!n.get("detect.edgeTexts"),a,c)),g&&_){const m=this._modules.graphics.getAttributesManager().getFlexArrays();h=m.nodes.current.layer.get(g._index)>=m.edges.current.layer.get(_._index)?g:_}else g?h=g:_&&(h=_);return h}};function ji(t){return t.indexOf("touch")===0?"touch":"mouse"}var Yl=!1,Qg={down:{trigger:"pointerdown",duplicate:"mousedown"},click:{trigger:"pointerdown",duplicate:"mouseup"},doubleclick:{trigger:"pointerdown",duplicate:"mouseup"}};function Jg(t,e){if(t)return t.type===Qg[e].trigger&&(Yl=!0),t.type===Qg[e].duplicate&&Yl?(Yl=!1,!0):void 0}var HL=class extends Bt{constructor(){super(...arguments),this._dragged=null,this._start=[],this._end=[],this._shouldDrag=({target:t,button:e})=>{const s=e==="left",i=this._modules.settings.get("interactions.drag.enabled"),n=t!==null&&t.isNode&&t.getAttribute("draggable")===!0;return!!(s&&i&&n)},this._onDragStart=({x:t,y:e,target:s})=>{s&&(s.isSelected()?this._dragged=this._modules.selection.getSelectedNodes().filter(i=>i.getAttribute("draggable")):this._dragged=s.toList()),this._dragged&&(this._start=this._dragged.getPosition(),this._end=Ie(this._start),this._onBeforeDrag=this._modules.settings.get("interactions.drag.onBeforeDrag"),this._startDrag=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._dragged.addClass(ua),this._modules.events.fire("nodesDragStart",{nodes:this._dragged}),this._modules.graphics.addCursorStyle(this._modules.settings.get("interactions.drag.cursor")))},this._onDrag=()=>{if(!this._dragged||!this._startDrag)return;const{x:t,y:e}=this._modules.captor.getCursorInformation(),s=this._dragged._indexes,i=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),n=i.x-this._startDrag.x,r=i.y-this._startDrag.y;for(let o=0;o<s.length;++o){const a=this._start[o],l=this._end[o];l.x=a.x+n,l.y=a.y+r}this._onBeforeDrag&&this._onBeforeDrag(this._dragged,t,e,this._end),this._modules.settings.get("interactions.drag.applyResult")&&this._modules.individualAttributes.setMultipleAttributes(this._dragged,this._end),this._modules.events.fire("nodesDragProgress",{nodes:this._dragged,dx:n,dy:r})},this._onDragEnd=()=>{this._dragged&&(this._dragged.removeClass(ua),this._modules.graphics.removeCursorStyle(this._modules.settings.get("interactions.drag.cursor")),this._modules.events.fire("nodesDragEnd",{nodes:this._dragged,start:this._start,end:this._end}),this._dragged=null,this._start=[],this._end=[])}}onMounted(){this._modules.classes.createClass({name:ua,isBuiltin:!0,nodeAttributes:{layer:kv}}),this._modules.events.register(["nodesDragStart","nodesDragProgress","nodesDragEnd"]),this._modules.settings.register("interactions.drag.enabled",!0).register("interactions.drag.cursor","move").register("interactions.drag.onBeforeDrag",void 0),this._modules.settings.register("interactions.drag.applyResult",!0),this._modules.interactions.onDrag({priority:"drag",disableDetection:!0,check:this._shouldDrag,onStart:this._onDragStart,onProgress:this._onDrag,onStop:this._onDragEnd})}},XL={color:"#00C3FF",radius:4,cursorOnHover:"grab",cursorOnDrag:"grabbing"},WL=class extends Bt{constructor(){super(...arguments),this._hoverHandle=!1,this._grabHandle=!1,this._x=0,this._y=0,this._enabled=!1,this._onMouseUp=()=>this._grabHandle=!1,this._onMouseDown=()=>{this._hoverHandle&&(this._grabHandle=!0)},this._onDragProgress=()=>{this._grabHandle&&this._refreshCanvas()},this._onDragStart=()=>{if(!this._movedEdges)return;this._nodesToHighlight=this._nodesToHighlight.filter(e=>e!==this._startNode&&!e.isVirtual()),this._movedEdges.setExcluded(!0);const t=this._options.cursorOnDrag;this._prevSettings=this._modules.settings.update({edgeHover:!1,cursor:{default:t,node:t,edge:t}})},this._onDragEnd=()=>{if(!this._movedEdges)return;this._restoreSettings();const t=this._getPointedNode();t&&this._movedEdges.forEach(e=>{e.getTarget()===this._startNode?e.setTarget(t):e.setSource(t)}),this._movedEdges.setExcluded(!1),this._movedEdges.setSelected(!0),this._movedEdges=null,this._refreshHandles()},this._refreshHandles=()=>{if(!this._enabled||this._movedEdges)return;const t=this._modules.selection.getSelectedEdges();this._nodesToHighlight=t.getExtremities().dedupe().filter(e=>!e.isVirtual()),this._rewirableClass.clearEdges(),this._rewirableClass.add(t),this._refreshCanvas()},this._shouldInteractionStart=({target:t})=>{if(!this._enabled||!t||!t.isNode||!this._hoverHandle||t.isVirtual())return!1;const e=t.getAdjacentEdges().filter(s=>s.isSelected());return!!e.size&&(this._movedEdges=e,this._edgeColors=this._movedEdges.getAttribute("color"),this._startNode=t,!0)},this._refreshCanvas=()=>{this._enabled&&this._layer.refresh()},this._checkForHover=()=>{if(!this._enabled||!this._nodesToHighlight)return;const t=this._options.radius,e=this._nodesToHighlight.getPosition(),s=this._modules.camera.screenToGraphCoordinates(this._modules.captor.getCursorPosition());for(let i=0;i<e.length;i++){const{x:n,y:r}=e[i];if(Oe(n,r,s.x,s.y)<t)return void this._enableCursorOnHover()}this._disableCursorOnHover()}}onMounted(){this._rewirableClass=this._modules.classes.createClass({name:wf,isBuiltin:!0,edgeAttributes:{layer:Rv}})}enable(t){this._enabled||(this._modules.events.on("move",this._checkForHover).on("mousemove",this._checkForHover).on("dragProgress",this._onDragProgress).on("nodesDragProgress",this._refreshCanvas).on("mousedown",this._onMouseDown).on("mouseup",this._onMouseUp).on("edgesSelected",this._refreshHandles).on("edgesUnselected",this._refreshHandles),this._interaction=this._modules.interactions.onDrag({priority:"rewiring",check:this._shouldInteractionStart,onStart:this._onDragStart,onProgress:({x:e,y:s})=>{this._x=e,this._y=s},onStop:this._onDragEnd}),this._options=ct(ct({},XL),t),this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(e=>{if(!this._enabled||!this._nodesToHighlight)return;const s=this._modules.captor.getCursorPosition(),i=this._getPointedNode(),n=this._options.color,r=this._options.radius,o=2*r;if(this._displayMovedEdges(e),e.fillStyle=n,e.strokeStyle=n,this._nodesToHighlight.forEach(a=>{const{x:l,y:d}=a.getPosition();e.fillRect(l-r,d-r,o,o)}),this._movedEdges){const a=i?i.getPosition():s;e.fillRect(a.x-r,a.y-r,o,o)}},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._refreshHandles())}disable(){this._enabled&&(this._interaction&&this._interaction.stop&&this._interaction.stop(),this._interaction=void 0,this._modules.graphics.removeCursorStyle(this._options.cursorOnDrag),this._disableCursorOnHover(),this._restoreSettings(),this._layer.destroy(),this._rewirableClass.clearEdges(),this._enabled=!1,[this._checkForHover,this._onDragProgress,this._refreshCanvas,this._onMouseDown,this._onMouseUp,this._refreshHandles].forEach(t=>this._ogma.events.off(t)))}enabled(){return this._enabled}_restoreSettings(){this._prevSettings&&(this._modules.settings.update(this._prevSettings),this._prevSettings=void 0)}_disableCursorOnHover(){this._hoverHandle&&!this._grabHandle&&(this._hoverHandle=!1,this._modules.graphics.removeCursorStyle(this._options.cursorOnHover))}_enableCursorOnHover(){this._hoverHandle||(this._hoverHandle=!0,this._modules.graphics.addCursorStyle(this._options.cursorOnHover))}_displayMovedEdges(t){if(!this._movedEdges)return;const e=this._x,s=this._y,i=this._modules.camera.screenToGraphCoordinates({x:e,y:s});this._movedEdges.forEach((n,r)=>{const o=this._edgeColors[r],a=n.getSource(),l=n.getTarget(),d=this._getPointedNode(),h=l===this._startNode?a:l,u=Number(n.getAttribute("width")),c=h.getPosition(),g=d?d.getPosition():i;t.beginPath(),t.moveTo(c.x,c.y),t.lineTo(g.x,g.y),t.strokeStyle=o,t.lineWidth=u,t.stroke()})}_getPointedNode(){const t=this._modules.captor.getPointedElement();return t&&t.isNode&&!t.isVirtual()?t:null}},t_={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1},$L=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._nodesToHighlight=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[],this._onSelectionChange=()=>{this._enabled&&(this._nodesToHighlight=this._modules.selection.getSelectedNodes(),this._displayHandles())},this._displayHandlesHandler=()=>this._displayHandles(),this._moveHandler=({x:t,y:e})=>{this._modules.dom.setTimeout(()=>this._detectBoundingBoxes(t,e))}}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._modules.interactions.onDrag({priority:"resizing",disableDetection:!0,check:()=>!(!this._enabled||!this._pointedNode),onStart:({x:t,y:e})=>{this._x=t,this._y=e,this._nodeBeingResized=this._pointedNode},onProgress:({x:t,y:e})=>{this._x=t,this._y=e,this._displayHandles()},onStop:()=>{if(this._nodesToHighlight){const t=this._modules.camera.zoom,e=this._nodesToHighlight.getAttributes(["x","y","radius"]).map(({x:s,y:i,radius:n},r)=>{const o=this._additionalRadiuses[r]/t;return{radius:+n+o,x:s+o,y:i-o}});this._nodesToHighlight.setAttributes(e)}this._pointedNode=null,this._nodeBeingResized=null,this._displayHandles()}})}onReady(){this._modules.events.on(["nodesSelected","nodesUnselected"],this._onSelectionChange)}_enableCursor(){this._cursorEnabled||(this._modules.graphics.addCursorStyle(this._options.cursor),this._cursorEnabled=!0)}_disableCursor(){this._cursorEnabled&&(this._modules.graphics.removeCursorStyle(this._options.cursor),this._cursorEnabled=!1)}_detectBoundingBoxes(t,e){if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight)return;const s=this._options.handleSize/2,i=this._options.detectionMargin;return this._pointedNode=null,this._forEachNodeToHighlight((n,r,o)=>{const a=r.x+o-s-i,l=r.x+o+s+i,d=r.y-o-s-i,h=r.y-o+s+i;t>=a&&t<=l&&e>=d&&e<=h&&(this._pointedNode=n)}),this._pointedNode?this._enableCursor():this._disableCursor()}_forEachNodeToHighlight(t){this._nodesToHighlight&&this._nodesToHighlight.forEach(e=>{const s=e.getPositionOnScreen(),i=this._getTotalRadius(e);t(e,s,i)})}_displayHandles(){this._enabled&&this._nodesToHighlight&&this._layer.refresh()}_displayNodePreview(t,e,s,i,n,r){if(n*=1/this._modules.camera.getZoom(),t.beginPath(),r.length===1)t.arc(s,i,n,0,2*Math.PI);else for(let o=0;o<r.length;++o){const a=r[o],l=s+a.x*n,d=i+a.y*n;o===0?t.moveTo(l,d):t.lineTo(l,d)}t.fillStyle=this._options.previewColor,t.fill()}_getTotalRadius(t,e=!0){return Number(t.getAttribute("radius"))*(this._modules.camera.zoom*(e?1:0))+Number(t.getAttribute("innerStroke.width"))+Number(t.getAttribute("outerStroke.width"))+this._options.lineWidth/2}_snap(t,e,s){const i=this._modules.spatial.getNodesInScreenByDistance(e).filter(u=>!u.isSelected()).slice(0,this._options.nbNodesToSnapTo),n=this._getTotalRadius(e),r=n+s,o=this._options.snappingRatio,a=r/n,l=Math.round(Bm(a,o));let d=n*Math.pow(o,l),h=null;if(i.forEach(u=>{const c=this._getTotalRadius(u);Math.abs(c-r)<=Math.abs(d-r)&&(d=c,h=u)}),h){t.save(),t.strokeStyle=this._options.sizeIndicatorColor,t.lineWidth=this._options.sizeIndicatorThickness/this._modules.camera.getZoom();const u=h.getAttribute("radius");this._displaySizeIndicator(t,e,d),i.filter(c=>c.getAttribute("radius")===u).forEach(c=>this._displaySizeIndicator(t,c)),t.restore()}return d-n}_displaySizeIndicator(t,e,s){s=s||void 0;const i=this._modules.camera.getZoom(),n=e.getPosition(),r=this._getTotalRadius(e),o=(s||r)/i,a=(s?s-r:0)/i,l=a+(-this._options.sizeIndicatorOffset-(s?Number(e.getAttribute("innerStroke.width"))+Number(e.getAttribute("outerStroke.width")):0))/i,d=n.x-o+l|0,h=n.y-o-a|0,u=n.y+o-a|0,c=this._options.sizeIndicatorWidth/i;t.beginPath(),t.moveTo(d-c,h),t.lineTo(d+c,h),t.moveTo(d,h),t.lineTo(d,u),t.moveTo(d-c,u),t.lineTo(d+c,u),t.stroke()}enable(t={}){this._enabled||(this._options=ct(ct({},t_),t),this._layer=this._modules.layers.addCanvasLayer(e=>{const s=fs(),i=this._modules.camera.getZoom(),{color:n,lineWidth:r}=this._options;let o=this._options.handleSize,a=0;if(this._nodeBeingResized){const l=this._getTotalRadius(this._nodeBeingResized),d=this._nodeBeingResized.getPositionOnScreen();a=Math.max(this._x-(d.x+l),-(this._y-(d.y-l)))/2}this._additionalRadiuses=[],this._nodesToHighlight&&this._nodesToHighlight.forEach(l=>{const d=l.getPosition();let h=this._getTotalRadius(l),u=0;if(this._nodeBeingResized){u=a;const c=-h+Number(l.getAttribute("innerStroke.width"))+Number(l.getAttribute("outerStroke.width"))+r/2+1;u=u<c?c:this._snap(e,l,u),this._additionalRadiuses.push(u);const g=l.getAttribute("shape"),_=this._engine.getShapePoints(g),m=d.x+u/i,f=d.y-u/i,p=h+u;this._displayNodePreview(e,s,m,f,p,_)}e.strokeStyle=n,e.fillStyle=n,e.lineWidth=r/i,h/=i,u/=i,o/=i*s,e.strokeRect(d.x-h,d.y-h-2*u,2*(u+h),2*(u+h)),e.fillRect(d.x+h+2*u-o/2,d.y-h-2*u-o/2,o,o)})},{isStatic:!1,noClear:!1}),this._layer.moveToTop(),this._modules.events.on(["mousemove","mousedown"],this._moveHandler),this._enabled=!0)}disable(){this._enabled&&(this._modules.events.off(this._displayHandlesHandler),this._modules.events.off(this._moveHandler),this._layer.destroy(),this._disableCursor(),this._reset())}_reset(){this._enabled=!1,this._nodesToHighlight=null,this._options=ct({},t_),this._nodeBeingResized=null,this._pointedNode=null,this._cursorEnabled=!1,this._x=0,this._y=0,this._additionalRadiuses=[]}enabled(){return this._enabled}},YL={strokeColor:"black",strokeWidth:5,dashed:!0,cursorStyle:"cell",createNodes:!0,condition:Qa,onNodeCreated:qt,onEdgeCreated:qt,createNode:Os,createEdge:Os,onComplete:qt},ZL=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._blockId=0,this._cursorEnabled=!1}onMounted(){this._engine=this._modules.graphics.getGraphicsEngine(),this._group=this._engine.createGroup(),this._depth=Xr(0).edgeBody,this._modules.events.register(["connectNodes"]),this._interaction=this._modules.interactions.onDrag({priority:"connectNodes",check:({target:t,button:e="left"})=>this._enabled&&e==="left"&&t&&t.isNode&&!t.isVirtual(),onStart:({target:t})=>this._onStart(t),onProgress:({x:t,y:e})=>this._onMove(t,e),onStop:()=>this._onStop()}),this._modules.events.on("clearGraph",()=>this.disable())}_onStart(t){t&&(this._cursorEnabled=!0,this._startNode=t,this._startPos=t.getPosition(),this._modules.graphics.addCursorStyle(this._options.cursorStyle),this._blockId=this._modules.graphics.allocateGraphicsEngineBlockId())}_onMove(t,e){this._startNode!==null&&(this._endPos=this._modules.camera.screenToGraphCoordinates({x:t,y:e}),this._drawLine())}_onStop(){if(this._startNode===null)return;const{condition:t,onNodeCreated:e,onEdgeCreated:s,createEdge:i,createNode:n,onComplete:r,createNodes:o}=this._options;let a=this._modules.captor.getPointedElement(),l=null,d=null;if(this._modules.graphics.releaseGraphicsEngineBlockId(this._blockId),!a&&o){const h=n({attributes:{x:this._endPos.x,y:this._endPos.y}});a=this._modules.graph.addNode(h),d=a,e&&e(d)}if(a&&!a.isVirtual()&&(d||!t||t(this._startNode,a))){const h=i({source:this._startNode.getId(),target:a.getId()});l=this._modules.graph.addEdge(h),s&&s(l)}r&&(this._modules.events.fire("connectNodes",{source:this._startNode,target:a,edge:l}),r(this._startNode,a,l||void 0)),this.disable()}_drawLine(){this._group.reset(Rs,!1,this._depth);const t=this._group.nextAndReset().end;t.pieceId=dl,t.shape="line",t.x1=this._startPos.x,t.y1=this._startPos.y,t.x2=this._endPos.x,t.y2=this._endPos.y,t.fillColor=this._options.strokeColor,t.thicknessOrFontSizeFixed=this._options.strokeWidth,this._options.dashed&&(t.dashLength=3,t.gapLength=1),this._engine.storeGroup(this._blockId,this._group),this._modules.dom.refresh()}enable(t={}){return this._enabled||(this._options=ct(ct({},YL),t),this._enabled=!0,this._cursorEnabled=!1,this._startNode=null,this._prevSettings=this._modules.settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":!1}),this._modules.captor.isLeftPressed()&&this._interaction.start(this._modules.captor.getCursorInformation())),this}disable(){return this._enabled?(this._enabled=!1,this._modules.settings.update(this._prevSettings),this._cursorEnabled&&this._modules.graphics.removeCursorStyle(this._options.cursorStyle),this):this}enabled(){return this._enabled}},KL=["top","bottom","left","right","cssDefined"],QL=1e4,JL={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}},tI={position:"top",autoAdjust:!0,delay:100},eI={hover:{node:({target:t})=>t&&t.isNode,edge:({target:t})=>t&&!t.isNode},click:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}},doubleclick:{left:{node:({target:t,button:e})=>e==="left"&&t&&t.isNode,edge:({target:t,button:e})=>e==="left"&&t&&!t.isNode,background:({target:t,button:e})=>e==="left"&&!t},right:{node:({target:t,button:e})=>e==="right"&&t&&t.isNode,edge:({target:t,button:e})=>e==="right"&&t&&!t.isNode,background:({target:t,button:e})=>e==="right"&&!t}}},sI=class extends Bt{constructor(){super(...arguments),this._x=0,this._y=0}onMounted(){this._handlers={},this._currentHandlerName=null,this._tooltip=null,this._isHover=!1,this._modules.events.register(["tooltipShow","tooltipHide"]),this._modules.events.on(["mouseup","dragStart"],()=>{this._isHover||this._hideTooltip(!1)}).on("mouseout",()=>{this._isHover&&this._hideTooltip(!1)}).on("clearGraph",()=>this._hideTooltip(!1)),this._modules.interactions.onHover(this._createInteraction("hover",!0)),this._modules.interactions.onClick(this._createInteraction("click")),this._modules.interactions.onDoubleClick(this._createInteraction("doubleclick"))}hide(){this._hideTooltip(!0)}isShown(){return!!this._tooltip}refresh(){this._refreshTooltip()}show(t,{position:e="top",autoAdjust:s=!0,className:i,x:n=0,y:r=0}={}){this._showTooltip(t,{position:e,autoAdjust:s,className:i},{x:n,y:r})}setHandler(t,e,s){const i=ct(ct({},tI),s);i.position&&KL.indexOf(i.position)===-1&&(i.position="top"),this._handlers[t]={handler:e,condition:Le(eI,t),settings:i}}_hideTooltip(t){if(this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null),t&&(this._currentHandlerName=null),this._tooltip){const e=this._tooltip;this._tooltip.parentNode&&this._tooltip.parentNode.removeChild(this._tooltip),this._tooltip=null,this._modules.events.fire("tooltipHide",{tooltip:e})}}_createInteraction(t,e=!1){return{priority:"tooltip",check:s=>{const i=e_(t,s),n=this._handlers[i];return(!e||!this._modules.connectNodes.enabled())&&(!(!n||!n.condition(s))||!(e||!this._currentHandlerName||this._isHover)&&this._tooltip!==null)},handler:s=>{const{target:i,x:n,y:r}=s;this._hideTooltip(!1),this._isHover=e,this._elt=i,this._x=n,this._y=r,this._currentHandlerName=e_(t,s),this._refreshTooltip()}}}_refreshTooltip(){if(!this._currentHandlerName)return void this._hideTooltip(!1);const t=this._handlers[this._currentHandlerName];if(!t)return;const{settings:e,handler:s}=t,i=this._elt;if(i){const r=i.isNode?"node":"edge";if(this._currentHandlerName.indexOf(r)===-1)return}const n=s(i);Promise.resolve(n).then(r=>{this._schedule(()=>this._showTooltip(r,e),e.delay)})}_schedule(t,e){this._timeout&&this._modules.dom.clearTimeout(this._timeout),this._timeout=this._modules.dom.setTimeout(()=>{this._timeout=null,t()},e)}_showTooltip(t,e,s){this._hideTooltip(!1);const{position:i,className:n,autoAdjust:r}=e;let o=this._x,a=this._y,l=this._elt;const d=this._modules.dom.getDimensions();let h=0,u=0;if(s&&(o=s.x,a=s.y,l=null),typeof t=="string")this._tooltip=iI("div"),this._tooltip.innerHTML=t;else{if(!wm(t))throw new Error(`invalid tooltip ${t}, expected HTML string or HTML element`);this._tooltip=t}const c=this._tooltip;if(n&&this._tooltip.classList.add(n),i!=="cssDefined"&&(c.style.position="absolute"),c.style.zIndex=QL.toString(),this._modules.dom.appendElement(c),l&&l.isNode){const m=l,f=m.getPositionOnScreen(),p=Number(m.getAttribute("radius"))*(m.getAttribute("scalingMethod")==="fixed"?1:this._modules.camera.getZoom())+Number(m.getAttribute("innerStroke.width"))+Number(m.getAttribute("outerStroke.width"));o=f.x,a=f.y,h=p,u=p}const g=c.offsetWidth/2,_=c.offsetHeight/2;if(h+=g,u+=_,i&&i!=="cssDefined"){const m=JL[i];let f=m.x,p=m.y;if(r){const y=o+h*m.x,b=a+u*m.y;(y-g<0||y+g>=d.width)&&(i==="left"||i==="right"?f*=-1:f=y-g<0?(g-y+1)/h:(d.width-(y+g)-1)/h),(b-_<0||b+_>=d.height)&&(i==="top"||i==="bottom"?p*=-1:p=b-_<0?(_-b+1)/u:(d.height-(b+_)-1)/u)}c.style.left=o+h*f-g+"px",c.style.top=a+u*p-_+"px"}this._modules.events.fire("tooltipShow",{tooltip:c})}};function e_(t,{button:e,target:s}){return`${t}${e?`.${e}`:""}.${s!==null?s.isNode?"node":"edge":"background"}`}function iI(t){return di?document.createElement(t):xa()}var Pr={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"},s_=Object.keys(Pr).reduce((t,e)=>{const s=Pr[e];return t[s]||(t[s]=[]),t[s].push(e),t},{}),nI=class extends Bt{constructor(){super(...arguments),this._onBlur=()=>this.resetKeys(),this._onKeyUp=t=>{const e=t.keyCode||t.which;this._pressed[e]=!1,this._modules.events.fire("keyup",{domEvent:t,key:Pr[e],code:e})},this._onKeyDown=t=>{const e=t.keyCode||t.which,s=this._binds[e];if(!this._pressed[e]){if(this._pressed[e]=!0,s)for(const i of s)i.keys.every(n=>n.some(r=>this._pressed[r]))&&i.handler({domEvent:t});this._modules.events.fire("keydown",{domEvent:t,key:Pr[e],code:e})}}}onMounted(){this._modules.events.register(["keyup","keydown"]),this._binds=[],this._pressed=[],this._modules.dom.addWindowEventListener("keydown",this._onKeyDown).addWindowEventListener("keyup",this._onKeyUp).addWindowEventListener("visibilitychange",this._onBlur).addWindowEventListener("blur",this._onBlur,!1),this._idleTimeout=4e3,this._prevEventTimeStamp=rs(),this._modules.events.onAnyEvent(()=>{const t=rs();t-this._prevEventTimeStamp>this._idleTimeout&&this.resetKeys(),this._prevEventTimeStamp=t})}setIdleTimeout(t){if(!isFinite(t)||t<=1)throw new TypeError("Idle timeout must be a positive number > 1");this._idleTimeout=t}resetKeys(){for(let t=0;t<this._pressed.length;t++)this._pressed[t]&&(this._pressed[t]=!1,this._modules.events.fire("keyup",{key:Pr[t],code:t}))}onKeyPress(t,e){let s=[];if(typeof t=="number")s=[t];else if(typeof t=="string")s=t.split(" ");else{if(!Array.isArray(t))throw new TypeError(`${t} is not a number, string or array`);s=t}if(s.length===0)throw new Error("the array should contain at least one element");const i=s.map(o=>{if(typeof o=="number")return[o];if(typeof o=="string"){const a=s_[o];if(!a)throw new Error(`${o} is not a valid key identifier`);return a}throw new TypeError(`${o} is not a valid key identifier`)}),n=i.pop(),r={keys:i,handler:e};n&&n.forEach(o=>{this._binds[o]||(this._binds[o]=[]),this._binds[o].push(r)})}isPressed(t){if(typeof t=="number")return this._pressed[t];if(typeof t=="string"){const e=s_[t];if(e)return e.some(s=>this._pressed[s])}return!1}},rI=[{name:"color",isNode:!0},{name:"shape",isNode:!0},{name:"radius",isNode:!0},{name:"icon.content",isNode:!0},{name:"image.url",isNode:!0},{name:"image",isNode:!0},{name:"color",isNode:!1},{name:"shape",isNode:!1},{name:"width",isNode:!1}],ci=Math.PI,gi=2*Math.PI,cx=Math.cos(ci/2-gi/5),gx=Math.cos(ci/2-gi/5*2),_x=Math.cos(ci/2-gi/5*3),mx=Math.cos(ci/2-gi/5*4),fx=Math.sin(-ci/2+gi/5),px=Math.sin(-ci/2+gi/5*2),yx=Math.sin(-ci/2+gi/5*3),xx=Math.sin(-ci/2+gi/5*4),za=1.6,bx=3,oI=.9,Zo=.31,Zl=1/3,aI=[8,3],lI=[3,3],Ko={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:t=>t[t.length-1]},dI=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];function vx(t){return Array.isArray(t)?t.reduce((e,s)=>e&&vx(s),!0):t==="undefined"||!isNaN(Number(t))}function Ex(t){return Array.isArray(t)?t.reduce((e,s)=>Math.min(e,Ex(s)),1/0):typeof(t=Number(t))=="number"?isNaN(t)?1/0:+t:1/0}function Ax(t){return Array.isArray(t)?t.reduce((e,s)=>Math.max(e,Ax(s)),-1/0):typeof(t=Number(t))=="number"?isNaN(t)?-1/0:+t:-1/0}function ai(t){const e=["K","M","B","T","P","E","Z","Y"];if(t>9999){let s=0;for(;s<e.length&&t>999;)t/=1e3,s++;return(i_(t,3)+e[s-1]).toString()}return i_(t,4).toString()}function i_(t,e=3){const s=e===4?10:1;return t<10?Math.round(100*t*s)/(100*s):t<100?Math.round(10*t*s)/(10*s):t<1e3?Math.round(t*s)/s:Math.round(t)}function Sx(t){return t.innerMargin+(t.titleFontSize+t.fontSize)*za}var hI=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.title<=e.title?-1:1,uI=(t,e)=>t.height-e.height,cI=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:e.height-t.height,gI=(t,e)=>t.isNode!==e.isNode?t.isNode?-1:1:t.content[0].title<=e.content[0].title?-1:1;function _I(t,e,s){const i=e.getContext("2d"),{x:n,y:r,height:o,isNode:a,styleProperty:l,title:d,mapping:h,iconFont:u,iconFontStyle:c}=s;pI(i,t,n,r,o),yI(i,t,d,n,r);const g=t.fontSize*za,_=t.fontSize/2*za*oI,m=t.fontSize*bx,f=t.fontSize,p=fI(t,a);let y=r+Sx(t);const b=n+t.innerMargin+p/2,x=n+2*t.innerMargin+p,v=Ar(h),E=vx(v),w=t.fontColor,A=t.shapeColor,I=Object.keys(h);if(E&&(I.sort((M,k)=>ii(h[k])-ii(h[M])),l==="radius"||l==="width")){const M=Ex(v),k=Ax(v);return(a?PI:DI)(t,i,n,y,M,(M+k)/2,k,A)}I.forEach(M=>{const k=h[M];l==="color"&&(a?wx(i,b,y,_,M):bI(i,b,y,m,f,M)),l==="shape"&&(a?LI(i,b,y,_,M,A):NI(i,b,y,m,f,M,A)),l==="icon.content"&&vI(i,b,y,M,u,_,w,c),l!=="image"&&l!=="image.url"||EI(i,b,y,_,M),xI(i,t,x,y,k,E),y+=g})}function mI(t,e,s,i,n,r){t.beginPath(),t.arc(e,s,i,0,gi),t.strokeStyle=n,t.lineWidth=r,t.stroke()}function ho(t,e,s,i,n="left",r="normal"){t.textAlign=n,t.textBaseline="middle",t.fillStyle=i,t.font=`${r} ${s}px "${e}"`}function fI(t,e){const s=e?1:bx;return t.fontSize*s}function pI(t,e,s,i,n){return FI(t,s,i,e.widgetWidth,n,e.borderRadius,e.backgroundColor,e.borderColor,e.borderWidth)}function yI(t,e,s,i,n){ho(t,e.fontFamily,e.titleFontSize,e.titleFontColor,e.titleTextAlign);const r=e.titleTextAlign==="center",o=e.widgetWidth-2*e.innerMargin,a=t.measureText(s).width,l=i+(r?e.widgetWidth/2:e.innerMargin),d=n+e.titleFontSize/2+e.innerMargin;if(a>o){const h=o/a,u=(s.length*h|0)-2;s=s.substr(0,u)+"…"}t.fillText(s,l,d)}function xI(t,e,s,i,n,r){let o=n.join();if(r)if(n.length===1)o=ai(n[0]);else{const a=ii(n),l=In(n);o=`${ai(a)} - ${ai(l)}`}ho(t,e.fontFamily,e.fontSize,e.fontColor),t.fillText(o,s,i)}function wx(t,e,s,i,n){t.beginPath(),t.arc(e,s,i,0,2*ci),t.fillStyle=n,t.fill()}function bI(t,e,s,i,n,r){t.fillStyle=r,t.fillRect(e-i/2,s-n/2,i,n)}function vI(t,e,s,i,n,r,o,a){ho(t,n,2*r,o,"center",a),t.fillText(i,e,s)}function EI(t,e,s,i,n){if(typeof Image>"u")return;t._imgStore||(t._imgStore={});let r=t._imgStore[n];if(r)return t.drawImage(r,e-i,s-i,2*i,2*i);r=new Image,r.src=n,r.onload=()=>{t.drawImage(r,e-i,s-i,2*i,2*i)},t._imgStore[n]=r}function AI(t,e,s,i){t.fillRect(e-i,s-i*Zo,2*i,2*i*Zo),t.fillRect(e-i*Zo,s-i,2*i*Zo,2*i)}function SI(t,e,s,i){return t.beginPath(),t.moveTo(e-i,s),t.lineTo(e,s-i),t.lineTo(e+i,s),t.lineTo(e,s+i),t.fill()}function wI(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+cx*i,s+fx*i),t.lineTo(e+gx*i,s+px*i),t.lineTo(e+_x*i,s+yx*i),t.lineTo(e+mx*i,s+xx*i),t.fill()}function TI(t,e,s,i){t.beginPath(),t.moveTo(e,s-i),t.lineTo(e+gx*i,s+px*i),t.lineTo(e+mx*i,s+xx*i),t.lineTo(e+cx*i,s+fx*i),t.lineTo(e+_x*i,s+yx*i),t.fill()}function LI(t,e,s,i,n,r){switch(t.fillStyle=r,n){case"square":return t.fillRect(e-i,s-i,2*i,2*i);case"circle":return wx(t,e,s,i,r);case"cross":return AI(t,e,s,i);case"diamond":return SI(t,e,s,i);case"equilateral":return wI(t,e,s,i);case"star":return TI(t,e,s,i)}}function II(t,e,s,i,n){t.fillRect(e-i/2,s-n/4,i*(1-Zl),n/2),t.beginPath(),t.moveTo(e+i*(1-Zl-.5),s-n/2),t.lineTo(e+i*(1-Zl-.5),s+n/2),t.lineTo(e+i/2,s),t.fill()}function CI(t,e,s,i,n,r,o){t.beginPath(),t.moveTo(e-i/2,s),t.lineTo(e+i/2,s),t.strokeStyle=r,t.lineWidth=n/2,t.setLineDash(o==="dashed"?aI:lI),t.stroke()}function MI(t,e,s,i,n){t.beginPath(),t.moveTo(e-i/2,s-n/2),t.lineTo(e-i/2,s+n/2),t.lineTo(e+i/2,s),t.fill()}function NI(t,e,s,i,n,r,o){return t.fillStyle=o,r==="line"&&t.fillRect(e-i/2,s-n/4,i,n/2),r==="arrow"?II(t,e,s,i,n):r==="dashed"||r==="dotted"?CI(t,e,s,i,n,o,r):r==="tapered"?MI(t,e,s,i,n):void 0}function FI(t,e,s,i,n,r,o,a,l){t.setLineDash([]),t.beginPath(),t.moveTo(e+r,s),t.lineTo(e+i-r,s),t.quadraticCurveTo(e+i,s,e+i,s+r),t.lineTo(e+i,s+n-r),t.quadraticCurveTo(e+i,s+n,e+i-r,s+n),t.lineTo(e+r,s+n),t.quadraticCurveTo(e,s+n,e,s+n-r),t.lineTo(e,s+r),t.quadraticCurveTo(e,s,e+r,s),t.closePath(),t.fillStyle=o,t.fill(),t.strokeStyle=a,t.lineWidth=l,t.stroke()}function PI(t,e,s,i,n,r,o,a){const l=.7*t.fontSize,d=3*l,h=(l+d)/2,u=s+t.innerMargin+d,c=u+d+t.innerMargin,g=i+2*d-.5*t.innerMargin,_=t.circleStrokeWidth;for(const m of[l,h,d])mI(e,u,g-m,m,a,_);ho(e,t.fontFamily,t.fontSize,t.fontColor,"left"),e.fillText(ai(n),c,g+l-2*l),e.fillText(ai(r),c,g+l-2*h),e.fillText(ai(o),c,g+l-2*d)}function DI(t,e,s,i,n,r,o,a){const l=(t.widgetWidth-2*t.innerMargin)/3,d=t.fontSize,h=i-t.innerMargin/2,u=h+2*d,c=s+t.innerMargin;e.fillStyle=a,e.fillRect(c,h-d/2,l+1,d),e.fillRect(c+l,h-d/3,l+1,d/1.5),e.fillRect(c+2*l,h-d/6,l,d/3),ho(e,t.fontFamily,t.fontSize,t.fontColor,"center"),e.fillText(ai(o),c+.5*l,u),e.fillText(ai(r),c+1.5*l,u),e.fillText(ai(n),c+2.5*l,u)}function kI(t,e,s,i){const n=i.outerMargin+Sx(i),r=i.fontSize*za,o=n-.8*i.innerMargin;return e==="radius"||e==="width"?o+r*(s?3:2):o+Object.keys(t).length*r}function RI(t,e,s){const i={width:e.width,height:e.height};let n=!1;return!!(i.width&&i.height&&s)&&(n=t.position==="top"||t.position==="bottom"?UI(i,t,s,t.position==="bottom"):OI(i,t,s,t.position==="left"),n&&s.forEach(r=>_I(t,e,r)),n)}function OI(t,e,s,i){const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height;let a=e.outerMargin,l=i?e.outerMargin:t.width-n,d=1;s=s.slice().sort(hI);for(let h=0;h<s.length;++h){const u=s[h];if(a+u.height>o){if(a===e.outerMargin)return!1;a=e.outerMargin,d+=1,i?l+=n:l-=n}u.x=l,u.y=a,a+=u.height}return d<=r}function zI(t,e,s){let i=null;for(let n=0;n<e.length;++n){const r=e[n];r.isNode!==t.isNode&&e.length!==1||!(i===null||r.height<e[i].height)||(i=n)}if(i!=null){const n=e[i];n.content.push(t),n.height+=t.height+s.outerMargin}}function BI(t){let e=0;for(let s=1;s<t.length;++s)t[s].height>t[e].height&&(e=s);return e}function UI(t,e,s,i){s=s.slice();const n=e.widgetWidth+e.outerMargin,r=Math.floor((t.width-e.outerMargin)/n),o=t.height-e.outerMargin,a=new Array(Math.min(r,s.length)),l=s.length;let d=0,h=0,u=0,c=0;for(let b=0;b<l;++b){const x=s[b];x.isNode?(d+=1,h+=x.height):(u+=1,c+=x.height)}const g=h+c,_=h/g,m=c/g;let f=Math.round(_*r);const p=Math.round(m*r);if(f>d?f=d:p>u&&(f=r-u),r===0)return!1;for(let b=0;b<a.length;b++)a[b]={content:[],height:0,isNode:b<f};for(let b=0;b<l;++b){const x=BI(s);zI(s[x],a,e),s.splice(x,1)}a.every(({content:b})=>b.length===1)?a.sort(gI):a.sort(cI);let y=e.outerMargin;for(let b=0;b<a.length;++b){const x=a[b];if(x.height>o)return!1;x.content.sort(uI);let v=0;for(let E=0;E<x.content.length;++E){const w=x.content[E];w.x=y,w.y=i?t.height-v-w.height-e.outerMargin:v+e.outerMargin,v+=w.height+e.outerMargin}y+=n}return!0}var GI=class extends Bt{constructor(){super(...arguments),this._enabled=!1,this._mustRefresh=!1,this._promises=[]}onMounted(){this._modules.events.on("frame",()=>{this._enabled&&this._mustRefresh&&this._layer.refresh()}).on(["resize","reloadFonts"],()=>{this._mustRefresh=!0})}enable(t={}){const e=this._settings;return this._settings=ct(ct({},Ko),t),this._mustRefresh=!this._enabled||!this._sameOptions(e,this._settings),this._enabled?Promise.resolve():(this._enabled=!0,this._layer=this._modules.layers.addCanvasLayer(s=>{this._drawOnCanvas(this._settings,s.canvas,fs());const i=this._promises;this._promises=[],i.forEach(n=>n()),this._mustRefresh=!1},{isStatic:!0,noClear:!1}),this._layer.moveToTop(),this.refresh())}_afterNextUpdate(){return new Promise(t=>this._promises.push(t))}_formatSettings(t,e){const s=ct(ct({},Ko),t);return dI.forEach(i=>s[i]*=e),s}disable(){return this._enabled&&(this._enabled=!1,this._layer.destroy()),Promise.resolve()}enabled(){return this._enabled}refresh(){return this._mustRefresh=!0,this._modules.dom.refresh(),this._afterNextUpdate()}destroy(){this._enabled=!1,this._mustRefresh=!1,this._settings=ct({},Ko),this._promises=[]}getOptions(){return this._enabled?ct({},this._settings):ct({},Ko)}getCurrentOptions(){return this._settings}_sameOptions(t,e){return t===e||Object.keys(t).reduce((s,i)=>s&&t[i]===e[i],!0)}_drawOnCanvas(t,e,s){const i=this._formatSettings(t,s);RI(i,e,this._computeWidgetList(i))}exportOnCanvas(t,e,s){return this._drawOnCanvas(e,t,s)}export(t={}){const{width:e,height:s}=ct(ct({},this._modules.camera.getSize()),t),i=fs(),n=Je(e*i,s*i);return this._drawOnCanvas(t,n,i),Promise.resolve().then(()=>n)}_computeWidgetList(t){const e=[];return rI.forEach(({name:s,isNode:i})=>{const n=this._computeWidget(t,s,i);n&&e.push(n)}),e}_computeWidget(t,e,s){const i=this._computePropertyMapping(t,e,s);if(i){if(e!=="icon.content")return i;const n=this._getRulesForAttribute(s,"icon.font"),r=this._getRulesForAttribute(s,"icon.style");let o=null,a=null;if(n.length||(o="Arial",a="normal"),typeof n[0]=="string"&&(o=n[0],a=r[0]),o&&a)return i.iconFont=o,i.iconFontStyle=a,i}return null}_computePropertyMapping(t,e,s){const[i]=this._getRulesForAttribute(s,e),n=i&&i.mapping,r=n&&n.getValues(s);if(n&&r){const o=n.getField(),a={};return Ws(r,(l,d)=>{l!==void 0&&d!=="undefined"&&(a[l]=a[l]||[],a[l].push(d))}),Object.keys(a).length===0?null:{isNode:s,title:t.titleFunction(o,e),styleProperty:e,dataProperty:o,mapping:a,height:kI(a,e,s,t)}}return null}_getRulesForAttribute(t,e){return this._modules.styleRules.getRuleList().map(s=>{const i=s.getDefinition();return Le(t?i.nodeAttributes:i.edgeAttributes,e)}).filter(Os).sort((s,i)=>s.mapping&&i.mapping?0:s.mapping?-1:1)}},n_={layer:Lf,outerStroke:{color:Xp,width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:Wp,minVisibleSize:0}},VI={layer:Lf,color:Xp,text:{backgroundColor:Wp,minVisibleSize:0}},r_={duration:150,easing:"quadradicOut"},jI=class extends Bt{constructor(){super(...arguments),this._delay=16,this._manualTriggerDetection=!1,this._hovered=null,this._hoveredTextHidden=!1,this._onAnimate=({updatesPositions:t})=>{t&&this._hovered&&this._modules.graphics.isMoving(this._hovered)&&(this._manualTriggerDetection=!0,this._resetHover())},this._onBeforeNewFrame=()=>{if(this._manualTriggerDetection){this._manualTriggerDetection=!1,this._modules.captor.triggerDetection();const t=this._modules.captor.getPointedElement();t&&this._hover(t)}},this._onClear=()=>{this._hovered=null,this._timeout&&this._modules.dom.clearTimeout(this._timeout)},this._resetHover=()=>{this._hovered&&(this._unhover(this._hovered),this._modules.captor.triggerUnhover()),this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}}_setAnimationOptions(t){this._animationOptions={duration:(t==null?void 0:t.duration)!==void 0?t.duration:r_.duration,easing:(t==null?void 0:t.easing)!==void 0?t.easing:r_.easing},t==null||delete t.duration,t==null||delete t.easing}setRate(t){return this._delay=t,this}replaceNullColor(t,e){t&&Le(t,e)===null&&$s(t,e,this._modules.settings.get("backgroundColor"))}updateNodeAttributes(t,e){this._setAnimationOptions(t),this.replaceNullColor(t,"text.backgroundColor"),this._hoverClass.update({nodeAttributes:t,fullOverwrite:e}),this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}updateEdgeAttributes(t,e){this.replaceNullColor(t,"text.backgroundColor"),this.replaceNullColor(t,"text.secondary.backgroundColor"),this._setAnimationOptions(t),this._hoverClass.update({edgeAttributes:t,fullOverwrite:e}),this._updateExtremityHighlightLayer()}getHoverClassDefinition(){return this._hoverClass.getDefinition()}onMounted(){this._registerSettings(),this._setAnimationOptions(null),this._hoverExtremityHighlightedClass=this._modules.classes.createClass({name:Pd,isBuiltin:!0,nodeAttributes:n_}),this._hoverClass=this._modules.classes.createClass({name:wr,isBuiltin:!0,nodeAttributes:n_,edgeAttributes:VI}),this._modules.events.on("mouseover",({target:t})=>t&&this._hover(t)).on("mouseout",({target:t})=>t&&this._unhover(t)).on("animate",this._onAnimate).on("beforeNewFrame",this._onBeforeNewFrame).on("mouseout",this._resetHover).on("clearGraph",this._onClear)}_registerSettings(){this._modules.settings.register("cursor.node","pointer",(t,e)=>{this._hovered&&this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("cursor.edge","pointer",(t,e)=>{this._hovered&&!this._hovered.isNode&&(this._modules.graphics.removeCursorStyle(e),this._modules.graphics.addCursorStyle(t))}),this._modules.settings.register("nodeHover",!0,t=>{!t&&this._hovered&&this._hovered.isNode&&this._unhover(this._hovered)}),this._modules.settings.register("edgeHover",!0,t=>{t||!this._hovered||this._hovered.isNode||this._unhover(this._hovered)})}_updateExtremityHighlightLayer(){const t=this._hoverClass.getDefinition().edgeAttributes,e=t?t.layer:void 0;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:e},fullOverwrite:!1})}_removeTimeout(){this._timeout&&(this._modules.dom.clearTimeout(this._timeout),this._timeout=null)}_hover(t){const e=t.isNode?"nodeHover":"edgeHover";this._modules.settings.get(e)&&t&&(this._removeTimeout(),this._timeout=this._modules.dom.setTimeout(()=>{this._setElementHighlight(!0,t),this._timeout=null},this._delay))}_unhover(t){this._removeTimeout(),this._hovered===t&&(this._setElementHighlight(!1,t),this._hoverExtremityHighlightedClass.clearNodes(),this._hovered=null)}_setElementHighlight(t,e){const s=this._modules.settings.get(e.isNode?"cursor.node":"cursor.edge");if(t?(this._modules.graphics.addCursorStyle(s),e.addClass(wr,this._animationOptions),this._hovered=e):(this._modules.graphics.removeCursorStyle(s),e.removeClass(wr,this._animationOptions)),e.isNode){const i=this._modules.graph.getAttribute(e.isNode,"textHidden"),n=e._index;t&&(this._hoveredTextHidden=i.get(n)!==0);const r=!t&&this._hoveredTextHidden;i.set(n,r)}else this._hoverExtremityHighlightedClass.clearNodes(),t&&e.getExtremities().addClass(Pd,this._animationOptions)}},qI=class extends Bt{constructor(){super(...arguments),this.x=0,this.y=0}},HI=class{constructor(t,e){this._nodeMapping={valid:!1,values:{}},this._edgeMapping={valid:!1,values:{}},this._computeMapping=e,this._field=t,this._assignedRules=[]}getValue(t,e){const s=t.isNode,i=s?this._nodeMapping:this._edgeMapping;i.valid||(i.values=this._computeMapping(s),i.valid=!0);const n=t.getData(this._field);return Array.isArray(n)?e==="color"?n.map(r=>i.values[r]):i.values[n[0]]:i.values[n]}markAsInvalid(){this._nodeMapping.valid=!1,this._edgeMapping.valid=!1}getValues(t){return t?this._nodeMapping.values:this._edgeMapping.values}getField(){return this._field}isAssignedTo(t){return this._assignedRules.find(e=>e===t)}getAssignedRules(){return this._assignedRules.slice()}assignTo(t){this.isAssignedTo(t)||this._assignedRules.push(t)}unAssignTo(t){this._assignedRules=this._assignedRules.filter(e=>e!==t)}};function Tx(t,e,s){const i=(e?t.getNodes():t.getEdges()).getData(s),n={};return i.forEach(r=>{if(!Array.isArray(r))return n[r]=1;r.forEach(o=>n[o]=1)}),"undefined"in n&&delete n[void 0],Object.keys(n).sort()}function XI(t,e,s,i){const{values:n={},fallback:r}=s,o=Tx(t,i,e),a={};let l=0;for(let d=0;d<o.length;++d){const h=o[d];h in n?a[h]=n[h]:(a[h]=r[l],l=(l+1)%r.length)}return a}function WI(t,{nbSlices:e,minValue:s,maxValue:i}){if(Array.isArray(t))return t.slice();const{min:n=s,max:r=i}=t,o=(r-n)/e,a=[];for(let l=1;l<e;++l)a.push(n+o*l);return a}function $I(t,e){if(Array.isArray(t))return t;const{min:s,max:i}=t,n=e.length+1,r=(i-s)/e.length,o=[];for(let a=0;a<n;a++)o.push(s+a*r);return o}function YI(t,e,s,i){const{fallback:n,stops:r={},values:o,reverse:a}=s,l=Tx(t,i,e);let d=1/0,h=-1/0;for(let _=0;_<l.length;_++){const m=+l[_];ml(m)&&(d=Math.min(d,m),h=Math.max(h,m),l[_]=m)}const u={};if(!isFinite(d)){for(let _=0;_<l.length;_++)u[l[_]]=n;return u}const c=WI(r,{nbSlices:Array.isArray(o)?o.length:o.nbSlices,minValue:d,maxValue:h}),g=$I(o,c);a&&g.reverse();for(let _=0;_<l.length;++_){const m=l[_];if(isFinite(m)){let f=0;for(;f<c.length&&c[f]<=m;)f+=1;u[m]=g[f]}else u[m]=n}return u}var ZI=class extends Bt{constructor(){super(...arguments),this._mappingList=[]}onMounted(){this._modules.events.on(["addStyleRule","updateStyleRule"],({rule:t,options:e})=>{const s=e.nodeAttributes&&typeof e.nodeAttributes!="function"?e.nodeAttributes:{},i=e.edgeAttributes&&typeof e.edgeAttributes!="function"?e.edgeAttributes:{};[...Ar(s),...Ar(i)].forEach(n=>{n&&this._recursiveGetMapping(n).forEach(r=>r.assignTo(t.id))})}).on("removeStyleRule",({rule:t})=>{this._mappingList.forEach(e=>e.unAssignTo(t.id))}).on(["addNodes","addEdges","updateNodeData","updateEdgeData","removeNodes","beforeRemoveEdges","excludedStateChange","clearGraph"],()=>{this._mappingList.forEach(t=>{const e=t.getAssignedRules();t.markAsInvalid(),e.forEach(s=>this._modules.styleRules.refreshRule(s))}),this._modules.legend.refresh()})}_recursiveGetMapping(t,e=[]){if(!t)return e;if(t.mapping)return e.push(t.mapping),e;if(typeof t!="object")return e;const s=Ar(t).map(i=>this._recursiveGetMapping(i));return e.concat(...s)}createMapping({field:t,values:e={},fallback:s}={field:""}){if(t=nn(t),Array.isArray(s)?s.length===0&&(s=[void 0]):s=[s],!rn(e))throw new Error('"mapping" should be an object');return this._createMappingFunction(XI,t,{values:e,fallback:s})}createSlices({field:t,fallback:e,stops:s={},values:i,reverse:n=!1}={field:"",values:[]}){if(t=nn(t),Array.isArray(i)||i.nbSlices||(i.nbSlices=7),Array.isArray(s)&&Array.isArray(i)&&s.length!==i.length-1)throw new Error("there should be exactly one more value that stops");return this._createMappingFunction(YI,t,{fallback:e,stops:s,values:i,reverse:n})}_createMappingFunction(t,e,s){const i=new HI(e,r=>t(this._modules.graph,e,s,r));this._mappingList.push(i);const n=(r,o,a)=>i.getValue(r,a);return n.mapping=i,n}createTemplate(t){if(typeof t!="string")throw new TypeError('"template" should be a string');const e=[];let s=0,i=!1;for(;!i;){let n=-1;const r=t.indexOf("{{",s);r!==-1&&(n=t.indexOf("}}",r+2)),n!==-1?(e.push(t.substring(s,r)),e.push(t.substring(r+2,n)),s=n+2):(e.push(t.slice(s)),i=!0)}return function(n){let r=e[0];for(let o=1;o<e.length;o+=2)r+=n.getData(e[o]),r+=e[o+1];return r}}},cn=class{constructor({duration:t,enabled:e}){this._duration=t||0,this._removalDuration=t||0,this.enabled=!1,this.shouldUndo=!1,this.destroyed=!1,this.shouldDo=e!==!1,this.shouldAnimate=this.shouldDo,this._error=null,this._whenApplied=new Promise((s,i)=>{this._resolveFunction=s,this._rejectFunction=i})}getDuration(){return this._duration}getAnimationDuration(t=!0){return this.shouldAnimate?t?this._duration:this._removalDuration:0}setDuration(t){t!==void 0&&(this._duration=t)}getRemovalDuration(){return this._removalDuration}setRemovalDuration(t){t!==void 0&&(this._removalDuration=t)}getContext(){return this._context}setContext(t){this._context=t}getError(){return this._error}setError(t){this._error=t}getOgma(){return this._ogma}resolve(){this._resolveFunction(this)}reject(){const t=this._error;return this._error=null,this._rejectFunction(t)}getName(){throw new Error("type not set")}getId(){return this._id}whenApplied(){return this._whenApplied}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}initialize({id:t,ogma:e}){this._id=t,this._ogma=e,this.resetContext()}enable(t){return this._ogma.modules.transformations.enable(this,t||0)}disable(t){return this._ogma.modules.transformations.disable(this,t||0)}toggle(t){return this.enabled?this.disable(t):this.enable(t)}getIndex(){return this._ogma.modules.transformations.getIndex(this)}setIndex(t){return this._ogma.modules.transformations.setIndex(this,t).then(()=>this)}setOptions(t){return this._ogma.modules.transformations.setOptions(this,ct({duration:this._duration,enabled:this.enabled},t)).then(()=>this)}_setOptions(t){this._duration=t.duration===void 0?this._duration:t.duration}destroy(t){return this.destroyed=!0,this._ogma.modules.transformations.remove(this,t||0)}refresh(){return this._ogma.view.afterNextFrame().then(()=>this._refresh())}_refresh(){return this._ogma.modules.transformations.refresh(!0)}resetContext(){this._context={virtualNodes:this._ogma.nodeList(),virtualEdges:this._ogma.edgeList()}}run(){throw new Error("run function not implemented")}cleanup(){throw new Error("cleanup function not implemented")}undo(){throw new Error("undo function not implemented")}onClearGraph(){this.resetContext()}},Lx=class extends cn{constructor(t){super(t),this._getNodesToFilter=t.getNodesToFilter,this._getEdgesToFilter=t.getEdgesToFilter}run(){const t=this._ogma,e=this.getAnimationDuration(),s=this._getNodesToFilter(t),i=this._getEdgesToFilter(t,s);return Promise.all([s.addClass(vi,e),i.addClass(vi,e)]).then(()=>(s.setExcluded(!0),i.setExcluded(!0),Wt(ct({},this._context),{nodes:s,edges:i})))}undo(){const t=this.getAnimationDuration(),{nodes:e,edges:s}=this._context;return e.setExcluded(!1),s.setExcluded(!1),e.addClass(vi),s.addClass(vi),Promise.all([e.removeClass(vi,t),s.removeClass(vi,t)])}resetContext(){super.resetContext(),this._context=Wt(ct({},this._context),{nodes:this._ogma.nodeList(),edges:this._ogma.edgeList()})}cleanup(){return Promise.resolve()}get context(){return this._context}},KI=class extends Lx{constructor(t){super(Wt(ct({},t),{getNodesToFilter:e=>e.createNodeList(),getEdgesToFilter:e=>e.getEdges().filter(s=>!t.criteria||!t.criteria(s))}))}getName(){return"edge-filter"}_setOptions(t){super._setOptions(t),this._getEdgesToFilter=e=>e.getEdges().filter(s=>!t.criteria||!t.criteria(s))}},QI=class extends Lx{constructor(t){const e=t.criteria;super(Wt(ct({},t),{getNodesToFilter:s=>s.getNodes().filter(i=>!e||!e(i)),getEdgesToFilter:(s,i)=>i.getAdjacentEdges()}))}getName(){return"node-filter"}_setOptions(t){super._setOptions(t);const e=t.criteria;this._getNodesToFilter=s=>s.getNodes().filter(i=>!e||!e(i))}},JI=class extends Bt{addNodeFilter(t){return typeof t!="object"&&(t={criteria:t,enabled:!0,duration:0}),this._modules.transformations.add(new QI(t))}addEdgeFilter(t){return typeof t!="object"&&(t={criteria:t,enabled:!0,duration:0}),this._modules.transformations.add(new KI(t))}},o_=t=>t.stopPropagation(),tC=(t,e)=>{e.style.position="absolute",e.style.left="0",e.style.top="0",t.appendChild(e)},eC=t=>e=>{for(;t.firstChild;)t.removeChild(t.firstChild);for(let s=0;s<e.length;++s)tC(t,e[s])},sC=(t,e)=>{const s=document.createElement("img");return new Promise(i=>{s.addEventListener("load",()=>{e.drawImage(s,0,0,e.canvas.width,e.canvas.height),i(e)});const n=`data:image/svg+xml;base64,${btoa(new XMLSerializer().serializeToString(t))}`;s.src=n})},iC=class extends Bt{constructor(){super(...arguments),this._elements=[],this._layers=[],this.readyCallbacks=[],this.render=(t,e,s,i)=>{const n=i&&i.pixelRatio?i.pixelRatio:fs(),{zoom:r,x:o,y:a,width:l,height:d}=i||this._modules.camera.getView();if(r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=n*r;s.noClear||t.clearRect(0,0,l*n,d*n),s.isStatic||(t.save(),t.translate(l*n/2,d*n/2),t.rotate(i?-(i.angle||0):-this._modules.camera.getAngle()),t.translate(-o*h,-a*h),t.scale(h,h)),e(t),s.isStatic||t.restore()},this.createCanvas=(t,e)=>{const{width:s,height:i}=this._modules.camera.getSize(),n=e.canvas||Je(s,i),r=e.ctx||n.getContext("2d"),o=(h=t)=>{r&&this.render(r,h,e)},a=()=>{const{width:h,height:u}=this._modules.camera.getSize(),c=fs();n.width=h*c,n.height=u*c,n.style.width=`${h}px`,n.style.height=`${u}px`,o()};let l,d;if(e.isStatic)this._modules.dom.addDirectWindowEventListener("resize",a),l=()=>{this._modules.dom.removeDirectWindowEventListener("resize",a)};else{let h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom(),c=!1;const g=0;let _;const m=500,f=()=>{c||(o(),c=!0,h=this._modules.camera.getCenter(),u=this._modules.camera.getZoom())},p=()=>{c||f();const{x,y:v}=this._modules.camera.getCenter(),E=x-h.x,w=v-h.y,A=-E*u,I=-w*u,M=this._modules.camera.getZoom()/u,k=-this._modules.camera.getAngle();n.style.transform=`
          scale(${M})
          rotate(${-k}rad)
          translateX(${A}px)
          translateY(${I}px)
          rotate(${k}rad)
        `.replace(/\n/g,"")};d=()=>!c||(o(),c=!1,n.style.transform="scale(1) translateX(0px) translateY(0px)",!1);const y=x=>{_&&clearTimeout(_),f()},b=x=>{Date.now()<g&&_&&clearTimeout(_),_=setTimeout(d,x.duration+m),f()};this._modules.events.on("dragStart",y).on("zoomStart",b).on("dragEnd",d).on(["viewChanged","zoom","rotate","move","animate"],p),this._modules.dom.addDirectWindowEventListener("resize",d),this._modules.dom.addDirectWindowEventListener("resize",a),this._modules.events.on("resize",a),l=()=>{this._modules.events.off(a).off(y).off(b).off(d).off(p),this._modules.dom.removeDirectWindowEventListener("resize",d),this._modules.dom.removeDirectWindowEventListener("resize",a)}}return n.style.touchAction="none",n.style.pointerEvents="none",a(),{element:n,removeListeners:l,refresh:h=>{d&&!d()||o(h)},clear:()=>r==null?void 0:r.clearRect(0,0,n.width,n.height)}},this.createSVG=t=>{const{element:e}=t;e.style["pointer-events"]="none";const s=()=>{t.draw(t.element)},i=n=>{let{zoom:r,x:o,y:a,width:l,height:d}=n||this._modules.camera.getView();if(l=Math.floor(l),d=Math.floor(d),r===void 0||o===void 0||a===void 0||l===void 0||d===void 0)return null;const h=l/2/r,u=d/2/r,c=Math.cos(-this._modules.camera.getAngle()),g=Math.sin(-this._modules.camera.getAngle()),_=c*o-g*a-h,m=g*o+c*a-u,f=l/r,p=d/r;e.style.width=`${l}px`,e.style.height=`${d}px`,e.setAttribute("width",`${l}`),e.setAttribute("height",`${d}`),e.setAttribute("viewBox",`${_} ${m} ${f} ${p}`)};return this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],()=>i()),e.addEventListener("mousemove",o_),i(),s(),{element:e,removeListeners:()=>{this._modules.events.off(i)},updateTransformation:i,refresh:s}},this._createOverlay=t=>{const e=()=>{const{element:n,position:r}=t,{zoom:o,x:a,y:l,width:d,height:h}=this._modules.camera.getView();if(o===void 0||a===void 0||l===void 0||d===void 0||h===void 0)return null;const u=o,c=d/2,g=h/2,_=-this._modules.camera.getAngle(),m=(r.x-a)*u,f=(r.y-l)*u;n.style.transformOrigin="top left",n.style.transform=`translate(${c}px, ${g}px) rotate(${_}rad) translate(${m}px, ${f}px) ${t.scaled?`scale(${u}, ${u})`:""}`};this._modules.events.on(["viewChanged","zoom","rotate","move","animate","afterImageExport"],e);const{element:s,size:i}=t;return i&&(s.style.width=`${i.width}`,s.style.height=`${i.height}`),s.addEventListener("mousemove",o_),e(),{element:s,removeListeners:()=>{this._modules.events.off(e)},updateTransformation:e}},this.addLayer=(t,e="layer",s=this._elements.length)=>{const i=typeof t=="string"?bd(t):t;this._elements.push(i);const n={element:i};return n.type=e,n.getLevel=()=>this._elements.indexOf(i),n.moveTo=r=>(this._elements.splice(r,0,this._elements.splice(n.getLevel(),1)[0]),this._updateDom(this._elements),n),n.moveUp=()=>n.moveTo(n.getLevel()+1),n.moveDown=()=>n.moveTo(n.getLevel()-1),n.moveToTop=()=>n.moveTo(this._elements.length-1),n.moveToBottom=()=>n.moveTo(0),n.destroy=()=>this._removeLayer(n),n.hide=()=>(n.element&&(n.element.style.visibility="hidden"),n),n.show=()=>(n.element&&(n.element.style.visibility="visible"),n),n.isHidden=()=>n.element.style.visibility==="hidden",n.setOpacity=r=>(n.element&&(n.element.style.opacity=r.toString()),n),n.getOpacity=()=>parseFloat(n.element.style.opacity||"1"),n.setPosition=r=>{if(n.element){const o=n.element.style;o.left=`${r.x}px`,o.top=`${r.y}px`}return n},n.setSize=r=>{if(n.element&&r){const{width:o,height:a}=r,l=n.element.style;l.width=`${o}px`,l.height=`${a}px`}return n},n.moveTo(s),this._layers.push(n),n},this.addCanvasLayer=(t,e={isStatic:!1,noClear:!1},s=this._elements.length)=>{const i=this.createCanvas(t,e),{element:n,removeListeners:r,refresh:o,clear:a}=i,l=this.addLayer(n,"canvas",s);return n.classList.add("ogma-canvas-layer"),l.destroy=()=>this._removeLayer(l,r),l.refresh=o,l.clear=a,l.draw=t,l.options=e,l},this.addOverlay=(t,e=this._elements.length)=>{typeof t.element=="string"&&(t.element=bd(t.element)),t.scaled=t.scaled===void 0||t.scaled;const s=this._createOverlay(t),{element:i,removeListeners:n,updateTransformation:r}=s,o=this.addLayer(i,"overlay",e);return o._onViewChange=r,o._onDestroy=n,o.destroy=()=>this._removeLayer(o,n),o.setPosition=a=>(t.position=a,r(),o),t.size&&o.setSize(t.size),o},this.addSVGLayer=(t,e=this._elements.length)=>{const s=this.createSVG(t),{element:i,refresh:n,removeListeners:r,updateTransformation:o}=s,a=this.addLayer(i,"svg",e);return a._onViewChange=o,a._onDestroy=r,a.destroy=()=>this._removeLayer(a,r),a.refresh=n,a}}canvasToImage(t,e){const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");this.render(i,t.draw,Wt(ct({},t.options),{noClear:!0}),Wt(ct({},e),{pixelRatio:1}));const n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttribute("href",s.toDataURL("image/png")),n.setAttribute("width",s.width),n.setAttribute("height",s.height),n}exportPNG(t,e,s){const i=t.getContext("2d");let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?(this.render(i,r.draw,Wt(ct({},r.options),{noClear:!0}),s),Promise.resolve()):(r._onViewChange&&r._onViewChange(s),sC(r.element,i)))}),n}exportSVG(t,e,s,i){let n=Promise.resolve();return e.forEach(r=>{n=n.then(()=>r.type==="canvas"?Promise.resolve(this.canvasToImage(r,s)):(r._onViewChange&&r._onViewChange(s),r.element.cloneNode(!0))).then(o=>i?t.insertBefore(o,t.querySelector(".ogma-nodes").parentNode||t.firstChild):t.appendChild(o))}),n}export(t){const e=this._layers.sort((n,r)=>n.getLevel()-r.getLevel()).filter(n=>n.type==="canvas"||n.type==="svg"),s=this.ogmaLayer?this.ogmaLayer.getLevel():0,i=t.below?e.filter(n=>n.getLevel()<s):e.filter(n=>n.getLevel()>s);return t.canvas?this.exportPNG(t.canvas,i,t.view):this.exportSVG(t.svg,i,t.view,t.below)}onMounted(){const t=this._modules.graphics.getDomElement();this._updateDom=eC(t);const e=t.firstChild;e&&(this.ogmaLayer=this.addLayer(e)),this.runCallbacks()}runCallbacks(){this.ogmaLayer&&(this.readyCallbacks.forEach(t=>t()),this.readyCallbacks=[])}whenReady(t){this.readyCallbacks.push(t),this.ogmaLayer&&this.runCallbacks()}_removeLayer(t,e){return t.element&&t.element.parentNode&&(this._elements.splice(t.getLevel(),1),e&&e(),t.element=null,this._updateDom(this._elements)),this._layers=this._layers.filter(s=>s!==t),t}destroy(){this._elements=[]}},nC=class extends Bt{onMounted(){const t=this._modules.graph;this._nodeList=t.getNodeAttribute("object"),this._edgeList=t.getEdgeAttribute("object"),this._sourceList=t.getEdgeAttribute("source"),this._targetList=t.getEdgeAttribute("target"),this._excludedList=t.getEdgeAttribute("excluded"),this._virtualList=t.getEdgeAttribute("virtual")}shortestPath(t={source:void 0,target:void 0}){const{source:e,target:s,directed:i=!1,edges:n=this._ogma.getEdges(),nodes:r=this._ogma.getNodes(),edgeCostFunction:o=()=>1,heuristicFunction:a=()=>0}=t,l=n.reduce((m,f)=>(m[f._index]=!0,m),{}),d=r.reduce((m,f)=>(m[f._index]=!0,m),{}),h=this._modules.graph.getNode(e),u=this._modules.graph.getNode(s);if(!h)throw new Error("the source is not a node");if(!u)throw new Error("the target is not a node");const c=h._index,g=u._index;d[c]=!0,d[g]=!0;let _=null;if(c===g)_={nodes:h.toList(),edges:this._modules.graph.edgeList()};else{const m=this._modules.graph.getNodeMaxIndex()+1,f=new Int32Array(m),p=new Float32Array(m),y=new Float32Array(m),b=new Set,x=new Zm(y);for(p.fill(1/0),y.fill(1/0),f.fill(-1),x.add(c),p[c]=0,y[c]=a(h,u);!x.isEmpty();){const v=x.removeMin();if(v===g){_=this._constructPath(f,c,g);break}b.add(v);const E=this._modules.graph.getAdjacentDirections(v);if(E)for(let w=0;w<E.length;++w){const A=E[w],I=this._modules.graph.getEdgeIndexesInDirection(A);let M=-1,k=0,W=-1;for(let H=0;H<I.length;++H){const $=I[H],P=this._sourceList.get($),S=this._targetList.get($);if(P===S||!d[P]||!d[S]||i&&v!==P||!l[$])continue;const Y=o(this._edgeList.get($));(M===-1||Y<k)&&(M=$,k=Y,W=P===v?S:P)}if(W!==-1||b.has(W)){const H=p[v]+k;if(!x.has(W)||H<p[W]){const $=this._nodeList.get(v);f[W]=M,p[W]=H,y[W]=H+a($,u),x.add(W)}}}}}return Promise.resolve(_)}_constructPath(t,e,s){const i=[s],n=[];let r=s;for(;r!==e;){const o=t[r],a=this._sourceList.get(o),l=this._targetList.get(o);r=r===a?l:a,i.push(r),n.push(o)}return i.reverse(),n.reverse(),{nodes:this._modules.graph.nodeList(new Uint32Array(i)),edges:this._modules.graph.edgeList(new Uint32Array(n))}}detectCycle(t,e){const s=e.getSource(),i=e.getTarget(),n=gf(t._indexes,s._indexes,i._indexes);return n?this._modules.graph.nodeList(new Uint32Array(n)).dedupe():this._modules.graph.nodeList()}getAllSimpleCycles(t,e){const s=e.getSource(),i=e.getTarget();return new mf(t._indexes,s._indexes,i._indexes).getCycles().map(n=>this._modules.graph.nodeList(new Uint32Array(n)))}minimumSpanningTree(t,e,s){const i=this._modules.graph;t=i.getNodes(t),e=i.getEdges(e);const n=new Set;t.forEach(l=>n.add(l._index));const r=i.getConnectedComponents(t,{filter:l=>n.has(l),internalIndexes:!0}),o={};r.forEach((l,d)=>l.forEach(h=>o[h]=d));const a=[];return e.forEach(l=>{const d=o[l.getSource()._index];d!==void 0&&(a[d]===void 0&&(a[d]=[]),a[d].push(l._index))}),r.map((l,d)=>{const h=ff(l,a[d]||[],u=>i.edge(u).getSource()._index,u=>i.edge(u).getTarget()._index,s?u=>s(i.edge(u)):void 0);return{nodes:i.nodeList(new Uint32Array(l)),edges:i.edgeList(new Uint32Array(h))}})}bfs({root:t,onNode:e,onEdge:s=qt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.unshift(h)})}}}dfs({root:t,onNode:e,onEdge:s=qt,directed:i=!1}){const n=this._modules.graph,r=[t],o=new Set,a={direction:i?"out":"both"};for(;r.length;){const l=r.pop();if(!o.has(l._index)){if(e(l)===!0)return;o.add(l._index),n.getAdjacentEdges(l,a).forEach(d=>{if(s(d)===!1)return;const h=d.getSource()===l?d.getTarget():d.getSource();r.push(h)})}}}betweenness({nodes:t,edges:e,directed:s,normalized:i}){const n=this._ogma.getNodes().subtract(t),r=this._ogma.getEdges().subtract(e).concat(n.fastGetAdjacentElements().edges).dedupe();return pf({adjacency:t.map(o=>{const a=this._ogma.edgeList(this._ogma.modules.graph.topology.getAdjacentElements(!1,o.toList()._indexes,{direction:s?"out":"both"})).subtract(r).dedupe();return{id:o._index,adj:a.map(l=>l.getSource()._index===o._index?l.getTarget()._index:l.getSource()._index)}}),directed:s,normalized:i})}},a_=(t,e)=>{if(!t)throw new Error("Traversal options are required");if(typeof t.onNode!="function")throw new Error("onNode callback is required");if(t.root=e.getNode(t.root),!t.root)throw new Error(`Root node '${t.root}' does not exist`);return t},Qo=()=>({nodes:void 0,edges:void 0}),rC=class extends xe{constructor(){super(...arguments),this.shortestPath=t=>this._ogma.modules.algorithms.shortestPath(t),this.hasCycle=t=>{const{nodes:e,edges:s}=t||Qo();return this.detectCycle({nodes:e,edges:s})!==null},this.getAllSimpleCycles=t=>{let{nodes:e,edges:s}=t||Qo();return e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0})),this._ogma.modules.algorithms.getAllSimpleCycles(e,s)},this.detectCycle=t=>{let{nodes:e,edges:s}=t||Qo();e||(e=this._ogma.getNodes()),s||(s=e.getAdjacentEdges({bothExtremities:!0}));const i=this._ogma.modules.algorithms.detectCycle(e,s);return i.size?i:null},this.minimumSpanningTree=t=>{const{nodes:e,edges:s,edgeCostFunction:i}=t||Wt(ct({},Qo()),{edgeCostFunction:void 0});return this._ogma.modules.algorithms.minimumSpanningTree(e,s,i)},this.dfs=t=>this._ogma.modules.algorithms.dfs(a_(t,this._ogma.modules.graph)),this.bfs=t=>this._ogma.modules.algorithms.bfs(a_(t,this._ogma.modules.graph)),this.betweenness=(t={})=>(t={nodes:t.nodes||this._ogma.getNodes(),edges:t.edges||this._ogma.getEdges(),directed:t.directed!==void 0&&t.directed,normalized:t.normalized===void 0||t.normalized},this._ogma.modules.algorithms.betweenness(t)),this.getMinimumEnclosingCircle=t=>{if(!t||t.size===0)throw new Error("getMinimumEnclosingCircle: no nodes provided");const e=t.getAttribute("x"),s=t.getAttribute("y"),i=t.getAttribute("radius"),[n,r,o]=el(e,s,i);return{x:n,y:r,radius:o}},this.circlePack=({nodes:t,margin:e=0,origin:s={x:0,y:0},duration:i=0,easing:n="linear",sort:r})=>{if(!t||t.size===0)throw new Error("circlePack: no nodes provided");let o=t.map((l,d)=>({index:d,radius:+l.getAttribute("radius")+e,id:l.getId()}));if(r)if(r==="asc")o=o.sort((l,d)=>d.radius-l.radius);else if(r==="desc")o=o.sort((l,d)=>l.radius-d.radius);else{if(typeof r!="function")throw new Error("circlePack: invalid sort option");o=o.sort((l,d)=>r(t.get(l.index),t.get(d.index)))}if(s&&(!isFinite(s.x)||!isFinite(s.y)))throw new Error("circlePack: invalid origin");const a=sf(o,s.x,s.y).reduce((l,{index:d,x:h,y:u})=>(l[d]={x:h,y:u},l),new Array(t.size));return t.setAttributes(a,{duration:i,easing:n})}}},oC=class{getHoveredElement(){return this.modules.captor.getPointedElement()}getPointerInformation(){return this.modules.captor.getCursorInformation()}},aC=class extends xe{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.geo.enable(t),this.disable=t=>this._ogma.modules.geo.disable(t),this.setOptions=t=>this._ogma.modules.geo.setOptions(t),this.getOptions=()=>this._ogma.modules.geo.getOptions(),this.getMap=()=>this._ogma.modules.geo.getMap(),this.enabled=()=>this._ogma.modules.geo.isEnabled(),this.getCenter=()=>this._ogma.modules.geo.getCenter(),this.getView=()=>this._ogma.modules.geo.getView(),this.getZoom=()=>this._ogma.modules.geo.getZoom(),this.setZoom=t=>this._ogma.modules.geo.setZoom(t),this.setView=(t,e,s)=>this._ogma.modules.geo.setView(t,e,s),this.setCenter=(t,e)=>this._ogma.modules.geo.setCenter(t,e),this.toggle=t=>this._ogma.modules.geo.toggle(t),this.resetCoordinates=()=>this._ogma.modules.geo.resetCoordinates(),this.getUnprojectedCoordinates=t=>this._ogma.modules.geo.getUnprojectedCoordinates(this._ogma.getNodes(t))}},lC=class extends xe{constructor(){super(...arguments),this.isKeyPressed=t=>this._ogma.modules.keyboard.isPressed(t),this.resetKeys=()=>{this._ogma.modules.keyboard.resetKeys()}}},dC=class extends xe{addLayer(t,e){return this._ogma.modules.layers.addLayer(t,"layer",e)}addCanvasLayer(t,e,s){return this._ogma.modules.layers.addCanvasLayer(t,e,s)}addOverlay(t,e){if(!t.position)throw new Error("options.position argument is required");return this._ogma.modules.layers.addOverlay(t,e)}addSVGLayer(t,e){return t.element||(t.element=document.createElementNS("http://www.w3.org/2000/svg","svg")),t.draw||(t.draw=()=>{}),this._ogma.modules.layers.addSVGLayer(t,e)}},l_={name:"concentric",configure:function(t,{graph:e,data:s}){if(t.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');const i=Wt(ct({},t),{centralNode:function(x,v){return v instanceof Ys?v:x.getNode(v)}(e,t.centralNode)}),{centralNode:n,nodes:r}=i,o=e.getNode(n);if(o===void 0)throw new Error('concentric layout: "centralNode" parameter is not valid');const a=o._index,{x:l,y:d}=o.getPosition(),h=r.getAttribute("layoutable"),u=e.getNodes(r)._indexes,c=Array.from(u.filter((b,x)=>h[x]));c.indexOf(a)===-1&&c.push(a);const g=e.getNodeAttribute("radius").getMultiple(u),_=function(x,v,E,w){if(v)return v==="random"?"random":v==="radius"?w.slice():v==="degree"?E.getDegree():x.getProperty(E,v)}(s,i.sortBy,r,g),m=c.reduce((b,x,v)=>(b[x]=v,b),{}),f=c.map((b,x)=>x),p=new Set(t.edges.getExtremities()._indexes),y=c.map(b=>e.topology.getAdjacentElements(!0,new Uint32Array([b])).filter(x=>p.has(x)).map(x=>m[x]));return{sourceNodeIndex:c.indexOf(a),centerX:typeof i.centerX=="number"?i.centerX:l,centerY:typeof i.centerY=="number"?i.centerY:d,list:c,indexes:f,size:c.length,totalSize:c.length,attributes:{adjacentNodes:y,size:g},sortAttr:_,clockwise:i.clockwise===void 0||i.clockwise,circleHopRatio:i.circleHopRatio||5,allowOverlap:!!i.allowOverlap}},context:function(){return{dijkstra:function(t,e,s,i,n){const r=Math.pow(2,31)-1,o=new Int32Array(i),a=new Int32Array(i),l=new Int8Array(i);o.fill(r),a.fill(-1);for(let h=0;h<i;++h){const u=e[h];u!==void 0&&(o[u]=r,a[u]=-1)}o[n]=0;let d=0;for(;d!==-1;){let h=r;d=-1;for(let u=0;u<s;++u){const c=e[u],g=o[c];!l[c]&&g<h&&(h=g,d=c,l[c]=1)}if(d>-1){const u=t[d],c=h+1;u.forEach(g=>{const _=o[g];c<_&&(o[g]=c,a[g]=d)})}}return o},determinePropertyType:function(t,e,s){return e.some(i=>t[i]!=="number")?"string":"number"}}},update:function(t,e){const{attributes:s,indexes:i,size:n}=t,{sourceNodeIndex:r,centerX:o,centerY:a,sortAttr:l}=t,d=s.adjacentNodes,h=s.size,u=new Array(t.totalSize),c=new Array(t.totalSize),g=e.dijkstra(d,i,t.size,t.totalSize,r);let _=0;const m={};for(let E=0;E<n;E++){const w=h[i[E]];w>_&&(_=w)}const f=_*t.circleHopRatio;let p=0,y=0;const b=Math.PI/9;for(let E=0;E<n;E++){const w=i[E],A=g[w];let I=m[A];I||(I=[],m[A]=I),I.push(w)}const x=function(w,A,I){if(w==="random")return function(){return Math.random()-.5};if(w)return I.determinePropertyType(w,A,A.length)==="number"?function(M,k){return w[M]-w[k]}:function(M,k){return w[M]<w[k]?-1:1}}(l,i,e),v=l==="random"||l;return Object.keys(m).sort((E,w)=>parseInt(E)-parseInt(w)).forEach((E,w)=>{const A=m[E],I=A.length;let M=0,k=y;const W=2*Math.PI/I;if(w!==0&&!t.allowOverlap){const H=2*Math.PI*p;let $=0;M+=A.reduce((P,S)=>P+h[S],0),$=2*M*Math.SQRT2,$>H&&(p+=$/(2*Math.PI)-p)}v&&(A.sort(x),t.clockwise||A.reverse());for(let H=0;H<I;H++){const $=A[H];u[$]=Math.cos(k)*p+o,c[$]=Math.sin(k)*p+a;const P=h[$];k+=W*(t.allowOverlap?1:P/M*I)}p+=f,y+=b}),{x:u,y:c,indexes:t.list}},isRunning:function(){return!1},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}},hC=t=>(t.modules.layouts.register(l_),e=>t.modules.layouts.start(l_.name,e)),uC=Object.defineProperty,Dt=(t,e)=>uC(t,"name",{value:e,configurable:!0}),cC=Dt((t,e)=>t.map(s=>e*s),"Z"),gC=Dt((t,e)=>t.map(e),"g"),_C=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),mC=Dt(()=>({[WebGL2RenderingContext.FLOAT]:"uniform1f",[WebGL2RenderingContext.FLOAT_VEC2]:"uniform2fv",[WebGL2RenderingContext.FLOAT_VEC3]:"uniform3fv",[WebGL2RenderingContext.FLOAT_VEC4]:"uniform4fv",[WebGL2RenderingContext.INT]:"uniform1i",[WebGL2RenderingContext.INT_VEC2]:"uniform2iv",[WebGL2RenderingContext.INT_VEC3]:"uniform3iv",[WebGL2RenderingContext.INT_VEC4]:"uniform4iv",[WebGL2RenderingContext.UNSIGNED_INT]:"uniform1ui",[WebGL2RenderingContext.UNSIGNED_INT_VEC2]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC3]:"uniform2uiv",[WebGL2RenderingContext.UNSIGNED_INT_VEC4]:"uniform2uiv",[WebGL2RenderingContext.FLOAT_MAT2]:"uniformMatrix2fv",[WebGL2RenderingContext.FLOAT_MAT3]:"uniformMatrix3fv",[WebGL2RenderingContext.FLOAT_MAT4]:"uniformMatrix4fv",[WebGL2RenderingContext.SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.UNSIGNED_INT_SAMPLER_2D]:"uniform1i",[WebGL2RenderingContext.SAMPLER_CUBE]:"uniform1i"}),"te"),Ki=new Map,Kl=new Map,fC=Dt((t,e,s,i)=>{Ki.has(t)||Ki.set(t,Ki.size);const n=`${Ki.get(t)}:${e}:${s}`;return Kl.has(n)||Kl.set(n,i()),Kl.get(n)},"re"),Ql=new Map,pC=Dt((t,e)=>(Ki.has(t)||Ki.set(t,Ki.size),Ql.has(t)||Ql.set(t,e()),Ql.get(t)),"oe"),yC=Dt(t=>{const e=t.createBuffer();if(!e)throw new Error("Could not create buffer");return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,_C,t.STATIC_DRAW),e},"ne"),gn=Dt((t,e)=>pC(t,()=>{const s=t.getAttribLocation(e,"position");return t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),s}),"w"),d_=Dt((t,e,s)=>{const i=t.createShader(e);if(i===null)throw new Error("Cannot create WebGL shader.");return t.shaderSource(i,s),t.compileShader(i),i},"X"),_n=Dt((t,e,s)=>fC(t,e,s,()=>{const i=t.createProgram();if(i===null)throw new Error("Cannot create WebGL program.");if(t.attachShader(i,d_(t,t.VERTEX_SHADER,e)),t.attachShader(i,d_(t,t.FRAGMENT_SHADER,s)),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){const n=t.getProgramInfoLog(i);throw t.deleteProgram(i),new Error(`Could not link WebGL program: 
${n}`)}return i}),"R"),Ks=Dt((t,{size:e,data:s,type:i,internalFormat:n=t.RGBA32F,format:r=t.RGBA})=>{const o=t.createTexture();if(!o)throw new Error("Cannot create WebGL texture.");const[a,l]=gC(e,d=>Math.max(1,d));return s instanceof Float32Array&&s.byteLength===0?s=new Float32Array(a*l*4):s instanceof Uint32Array&&s.byteLength===0&&(s=new Uint32Array(a*l*4)),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,n,a,l,0,r,i,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{size:e,data:s,type:i,format:r,handle:o}},"F"),Zs=Dt((t,e)=>{const s=t.createFramebuffer();if(!s)throw new Error("Cannot create WebGL frame buffer.");t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i!==t.FRAMEBUFFER_COMPLETE)switch(i){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("Framebuffer: Attachment is NOT complete.");case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("Framebuffer: No valid attachment.");case t.FRAMEBUFFER_UNSUPPORTED:throw new Error("Framebuffer: Attachment types are not supported.");default:throw new Error(`Framebuffer: Unknown reason (status: ${i}).`)}return s},"l"),$n=Dt((t,e)=>()=>([t,e]=[e,t],t),"A"),mn=Dt((t,e,s)=>{t.useProgram(e);const i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const o=t.getActiveUniform(e,r);if(!o)throw new Error(`Cannot get GL active uniform ${r}.`);const{name:a,size:l,type:d}=o,h=t.getUniformLocation(e,a);if(!h)throw new Error(`Cannot get GL uniform location ${a}.`);i[a]={size:l,data:s[a],type:d,location:h}}return i},"M");function Gi(t,e,s={}){let i=0;const n=mC();return Object.entries(e).forEach(([r,{location:o,type:a,data:l}])=>{let d=s[r]!==void 0?s[r]:l;(a===t.SAMPLER_2D||a===t.INT_SAMPLER_2D||a===t.UNSIGNED_INT_SAMPLER_2D)&&(t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,d),d=i,i++),t[n[a]](o,d)})}Dt(Gi,"b");var fl=Dt(t=>Math.ceil(Math.sqrt(t)),"D"),Ix=Dt(t=>Math.ceil(Math.sqrt(2*t)),"Y"),xC=Dt((t,e,s,i)=>{const n=fl(e),r=new Float32Array(4*n**2);for(let o=0;o<e;o++){const a=4*o;r[a]=s[o],r[a+1]=i[o]}return Ks(t,{size:[n,n],data:r,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"ue"),bC=Dt((t,e,s,i)=>{const n=fl(e),r=Ix(s),o=new Uint32Array(3*n**2);let a=0;for(let l=0;l<e;l++){const d=3*l,h=a,u=Math.floor(h/r),c=h%r;o[d]=c,o[d+1]=u,o[d+2]=i[l],a+=i[l]}return Ks(t,{size:[n,n],data:o,type:t.UNSIGNED_INT,format:t.RGB_INTEGER,internalFormat:t.RGB32UI})},"ie"),vC=Dt((t,e,s,i,n)=>{const r=fl(e),o=Ix(s),a=new Uint32Array(2*o**2),l=Array.from({length:e},()=>[]);i.forEach((h,u)=>{l[h].push(n[u]),l[n[u]].push(h)});let d=0;for(let h=0;h<e;h++)for(const u of l[h]){const c=Math.floor(u/r),g=u%r;a[d]=g,a[d+1]=c,d+=2}return Ks(t,{size:[o,o],data:a,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})},"ae"),EC=Dt((t,e,s,i=new Float32Array(e),n=new Uint8Array(e))=>{const r=fl(e),o=new Float32Array(4*r**2);for(let a=0;a<e;a++){const l=4*a;o[l]=s[a],o[l+1]=i[a],o[l+2]=n[a],o[l+3]=0}return Ks(t,{size:[r,r],data:o,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"ce"),h_=Dt(t=>{const e=new Map,s={nodes:[],edges:[]};return t.nodes.forEach((i,n)=>{e.has(i.id)&&console.warn(`Duplicated ID ${i.id}@${n}`),s.nodes.push(Wt(ct({},i),{id:n})),e.set(i.id,n)}),t.edges.forEach(i=>{const n=e.get(i.source),r=e.get(i.target);return n===void 0||r===void 0?console.warn(`Missing source ${i.source}`):void s.edges.push({source:Math.min(n,r),target:Math.max(n,r)})}),s.edges.sort((i,n)=>i.source-n.source||i.target-n.target),s},"De"),u_=Dt(({nodes:t,edges:e},[s,i]=[0,0])=>{const n=Math.PI*(3-Math.sqrt(5)),r=t.map(a=>(a.x=(a.x||0)-s,a.y=(a.y||0)-i,a)).map(a=>({n:a,key:a.pinned?0:1+1e6*a.y+a.x})).sort((a,l)=>a.key-l.key);let o=0;return r.forEach(({n:a,key:l},d)=>{if(l*d==0||l!==r[d-1].key)return o=d;const h=Math.sqrt(d-o);a.x=r[o].n.x+h*Math.cos(n*(d-o)),a.y=r[o].n.y+h*Math.sin(n*(d-o))}),{nodes:t,edges:e}},"Be"),c_=Dt((t,e)=>{const{nodes:s,edges:i}=e,n=s.length,r=i.length,o=new Uint32Array(r),a=new Uint32Array(r),l=new Uint32Array(n);for(let _=0;_<r;_++){const{source:m,target:f}=i[_];o[_]=m,a[_]=f,l[m]++,l[f]++}const d=new Float32Array(s.map(({x:_})=>_||0)),h=new Float32Array(s.map(({y:_})=>_||0)),u=new Float32Array(s.map(({r:_})=>isNaN(_)?1:_)),c=new Float32Array(s.map((_,m)=>l[m]+1)),g=new Uint8Array(s.map(({pinned:_})=>_?1:0));return{N:n,E:r,bodyTexture:xC(t,n,d,h),nodeTexture:bC(t,n,r,l),topologyTexture:vC(t,n,r,o,a),propertyTexture:EC(t,n,c,u,g)}},"Oe"),g_=Dt((t,e)=>{t.deleteTexture(e.bodyTexture.handle),t.deleteTexture(e.nodeTexture.handle),t.deleteTexture(e.topologyTexture.handle),t.deleteTexture(e.propertyTexture.handle)},"We"),fn=`#version 300 es

in vec2 position;

void main() {
  gl_Position = vec4(position, 0.0f, 1.0f);
}`,AC=`#version 300 es
precision highp float;uniform int u_0;uniform lowp sampler2D u_1,u_2;uniform int u_3,u_4;out vec4 outColor;void main(){ivec2 o=ivec2(gl_FragCoord.xy);if((o&65535<<u_3)!=o)return;if(outColor=vec4(1e9,1e9,-1e9,-1e9),u_3>0)for(int e;e<4;e++){ivec2 i=o+(ivec2(e&1,e>>1)<<u_3-1);vec4 t=texelFetch(u_2,i,0);outColor=vec4(min(outColor.xy,t.xy),max(outColor.zw,t.zw));}else if(textureSize(u_1,0).x*o.y+o.x<u_0)outColor.xy=outColor.zw=texelFetch(u_1,o,0).xy;if(u_3==u_4){vec2 o=outColor.zw-outColor.xy;o=vec2(max(o.x,o.y),max(o.x,o.y)),outColor=vec4(outColor.xy-vec2(1),o+vec2(2));}}`,SC=Dt(t=>1<<Math.ceil(Math.log2(Math.sqrt(t))),"fe"),__=Dt((t,e,s)=>{const i=SC(e),n=new Float32Array(4*i**2);return s&&s.forEach((r,o)=>n[o]=r),Ks(t,{size:[i,i],data:n,type:t.FLOAT,format:t.RGBA,internalFormat:t.RGBA32F})},"j"),wC=Dt(t=>Math.ceil(Math.log2(Math.sqrt(t)))+1,"_e"),TC=Dt((t,e,s)=>{const i=_n(t,fn,AC);gn(t,i);const n=__(t,e),r=__(t,e),o=$n(n,r),a=Zs(t,r.handle),l=Zs(t,n.handle),d=$n(a,l),h=mn(t,i,{u_0:e,u_1:s().handle,u_2:n.handle,u_3:0,u_4:0});let u=n;return{step:(c=wC(e))=>{t.viewport(0,0,n.size[0],n.size[1]),t.useProgram(i);for(let g=0;g<c;g++){t.bindFramebuffer(t.FRAMEBUFFER,d());const _=o();u=_===n?r:n,Gi(t,h,{u_2:_.handle,u_1:s().handle,u_4:c-1,u_3:g}),t.drawArrays(t.TRIANGLES,0,6)}},texture:()=>u,destroy:()=>{t.deleteFramebuffer(a),t.deleteFramebuffer(l),t.deleteTexture(r.handle),t.deleteTexture(n.handle)}}},"xe"),LC=`#version 300 es
precision lowp float;vec2 r(vec2 r,vec2 e){return vec2(r.x*e.x-r.y*e.y,r.x*e.y+r.y*e.x);}vec2 r(vec2 r){return r.y=-r.y,r;}vec2 r(vec2 u[8],vec2 i,vec2 o){vec2 t,c=i-o,e=vec2(1,0);for(int i;i<8;++i)t+=r(u[i],e),e=r(e,c);return t;}vec2 r(vec2 e,vec4 r){return(e-r.xy)/r.zw;}uniform float u_c,u_d,u_e,u_f,u_g,u_h,u_9,u_a,u_b;uniform int u_0;uniform lowp sampler2D u_1;uniform lowp usampler2D u_i,u_j;uniform lowp sampler2D u_k;uniform int u_5,u_l;uniform lowp sampler2D u_2;uniform lowp usampler2D u_m,u_n;uniform lowp sampler2D u_o;out vec4 outColor;void main(){uint a=uint(textureSize(u_1,0).x);int d=textureSize(u_j,0).x;ivec2 o=ivec2(gl_FragCoord.xy);if(int(a)*o.y+o.x>=u_0)return;vec3 u=texelFetch(u_k,o,0).xyz;if(u.z>0.)return;vec4 x=texelFetch(u_1,o,0);vec2 i=x.xy,e=x.zw;ivec4 t=ivec4(texelFetch(u_i,o,0));float c=float(t.z)+1.;vec4 v=texelFetch(u_2,ivec2(0),0);uint y=uint(textureSize(u_m,0).x);float p=float(1<<u_l-1);ivec2 m=ivec2(u_5,1),n=ivec2(p*r(i,v));vec2 g=(vec2(n)+.5)/p;ivec2 s=n-ivec2(1);for(int r;r<9;++r){ivec2 t=s+ivec2(r%3,r/3);if(t>>u_l-1!=ivec2(0))continue;uvec2 o=texelFetch(u_n,t,0).xy;for(uint r=o.x;r<o.y;r++){uint n=texelFetch(u_m,ivec2(r%y,r/y),0).x;ivec2 l=ivec2(n%a,n/a);vec2 t=texelFetch(u_1,l,0).xy-i;float v=dot(t,t)+1e-4;if(u_g>0.&&u_9<.5){float i=texelFetch(u_k,l,0).y,r=max(u.y+i+u_h,.01);if(v<r*r){float u=sqrt(v);e-=(r-u)*u_g*i/r*t/u;}}float x=float(texelFetch(u_i,l,0).z)+1.;e-=u_9*u_c*x*c*t/v/u.x;}}vec2 f[8];for(int r;r<8;r++)f[r]=r<u_5?texelFetch(u_o,m*n+ivec2(r,0),0).xy:vec2(0);vec2 F=r(r(f,g,r(i,v))/v.z);e-=u_9*u_c*F*c/u.x;ivec2 l;for(int a;a<t.z;a++){l=ivec2(texelFetch(u_j,t.xy,0).xy);vec2 r=texelFetch(u_1,l,0).xy-i;r*=1.-(u_f+u.y+texelFetch(u_k,l,0).y)/(length(r)+1e-4);float o=float(texelFetch(u_i,l,0).z)+1.,v=u_9*u_e*c*o/(min(c,o)*(o+c));if(e+=v*r/u.x,t.x+=1,t.x>=d)t.x=0,t.y+=1;}e=u_a*(e-u_9*u_d*i);float h=dot(e,e);if(h>u_b)e*=sqrt(u_b/h);outColor=vec4(i+e,e);}`,IC=Dt((t,e,s,i,n,{handle:r},{handle:o},{N:a,bodyTexture:l,nodeTexture:d,topologyTexture:h,propertyTexture:u},{charge:c,gravity:g,inertia:_,edgeStrength:m,edgeLength:f,elasticity:p,margin:y,maxDisplacement:b})=>{const x=_n(t,fn,LC);gn(t,x);const v=Ks(t,{type:t.FLOAT,size:l.size,data:new Float32Array(l.data.buffer.slice(0)),format:t.RGBA,internalFormat:t.RGBA32F}),E=$n(l,v),w=Zs(t,v.handle),A=Zs(t,l.handle),I=$n(w,A),M=mn(t,x,{u_9:1,u_a:_,u_b:b**2,u_c:c,u_d:g,u_e:m,u_f:f,u_g:p,u_h:y,u_0:a,u_1:l.handle,u_i:d.handle,u_j:h.handle,u_k:u.handle,u_5:s,u_l:e,u_2:i().handle,u_m:n().handle,u_n:r,u_o:o});let k=l;return{step:W=>{t.viewport(0,0,l.size[0],l.size[1]),t.useProgram(x),t.bindFramebuffer(t.FRAMEBUFFER,I());const H=E();k=H===l?v:l,Gi(t,M,{u_9:W,u_1:H.handle,u_2:i().handle,u_m:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>k,destroy:()=>{t.deleteFramebuffer(w),t.deleteFramebuffer(A),t.deleteTexture(v.handle)}}},"me"),CC=Dt((t,e)=>cC([e,1],1<<t),"ve"),Cx=Dt((t,e,s,i)=>{const n=CC(e,s),r=new Float32Array(2*n[0]*n[1]);return i&&i.forEach((o,a)=>r[a]=o),Ks(t,{size:n,data:r,type:t.FLOAT,format:t.RG,internalFormat:t.RG32F})},"H"),MC=`#version 300 es
precision lowp float;vec2 v(vec2 v,vec2 t){return vec2(v.x*t.x-v.y*t.y,v.x*t.y+v.y*t.x);}vec2 t(vec2 t,vec2 v){return vec2(dot(t,v),t.y*v.x-t.x*v.y)/dot(v,v);}vec2 v(vec2 v){return t(vec2(1,0),v);}const float f[64]=float[64](1.,1.,1.,1.,1.,1.,1.,1.,1.,2.,3.,4.,5.,6.,7.,8.,1.,3.,6.,10.,15.,21.,28.,36.,1.,4.,10.,20.,35.,56.,84.,120.,1.,5.,15.,35.,70.,126.,210.,330.,1.,6.,21.,56.,126.,252.,462.,792.,1.,7.,28.,84.,210.,462.,924.,1716.,1.,8.,36.,120.,330.,792.,1716.,3432.);uniform int u_5,u_6;uniform lowp sampler2D u_7,u_8;out vec2 outColor;void main(){float i=float(1<<u_6);ivec2 l=ivec2(u_5,1),c=ivec2(gl_FragCoord.xy)/l;vec2 d=(vec2(c)+.5)/i;uint o=uint(gl_FragCoord.x)%uint(u_5);if(u_6>2){ivec2 y=c>>1;vec2 e=(vec2(c&65534)+1.)/i-d,t=vec2(1,0);for(uint c;c<uint(u_5-int(o));++c)outColor+=f[c+(o<<3)]*v(texelFetch(u_7,l*y+ivec2(c+o,0),0).xy,t),t=v(t,e);}ivec2 y=(c&65534)-2;for(int r;r<36;r++){ivec2 u=y+ivec2(r%6,r/6);vec2 x=vec2(u-c);if(dot(x,x)<=2.||u>>u_6!=ivec2(0))continue;vec2 n=(vec2(u)+.5)/i-d,e=vec2(1,0);for(uint t;t<o;++t)e=v(e,-n);vec2 m=v(n),a;for(uint c;c<uint(u_5);++c){if(dot(e,e)<1e-20)break;a+=f[c+(o<<3)]*t(texelFetch(u_8,l*u+ivec2(c,0),0).xy,e),e=v(e,n);}outColor+=v(a,m);}}`,NC=Dt((t,e,s,i)=>{const n=_n(t,fn,MC);gn(t,n);const r=Array.from({length:e},(l,d)=>Cx(t,d,s)),o=r.map(({handle:l})=>Zs(t,l)),a=mn(t,n,{u_5:s,u_6:e-1,u_7:r[0].handle,u_8:i(0).handle});return{step:()=>{t.useProgram(n);for(let l=2;l<e;l++){const{handle:d}=r[l-1],h=i(l);t.viewport(0,0,h.size[0],h.size[1]),t.bindFramebuffer(t.FRAMEBUFFER,o[l]),Gi(t,a,{u_6:l,u_7:d,u_8:h.handle}),t.drawArrays(t.TRIANGLES,0,6)}},texture:l=>r[l],destroy:()=>{o.forEach(l=>t.deleteFramebuffer(l)),r.forEach(({handle:l})=>t.deleteTexture(l))}}},"pe"),FC=`#version 300 es
precision lowp float;vec2 e(vec2 e,vec2 u){return vec2(e.x*u.x-e.y*u.y,e.x*u.y+e.y*u.x);}vec2 x(vec2 u,vec2 e){return vec2(dot(u,e),u.y*e.x-u.x*e.y)/dot(e,e);}const vec2 u[8]=vec2[8](vec2(1,0),vec2(-1,0),vec2(2,0),vec2(-6,0),vec2(24,0),vec2(-120,0),vec2(720,0),vec2(-5040,0));const float n[16]=float[16](1.,1.,2.,6.,24.,120.,720.,5040.,40320.,362880.,3628800.,39916800.,479001600.,6.227021e9,8.717829e1,1.3076744e12);vec2 e(vec2 u,vec4 e){return(u-e.xy)/e.zw;}uniform int u_5,u_l,u_6;uniform lowp sampler2D u_p,u_2;uniform lowp usampler2D u_m;uniform lowp sampler2D u_k,u_1;uniform lowp usampler2D u_n;out vec2 outColor;void main(){float i=float(1<<u_6);ivec2 o=ivec2(u_5,1),t=ivec2(gl_FragCoord.xy)/o;vec2 l=(vec2(t)+.5)/i;uint c=uint(gl_FragCoord.x)%uint(u_5);if(u_6==u_l-1){uint u=uint(textureSize(u_1,0).x),x=uint(textureSize(u_m,0).x);vec4 i=texelFetch(u_2,ivec2(0),0);uvec2 n=texelFetch(u_n,t,0).xy;for(uint t=n.x;t<n.y;t++){uint v=texelFetch(u_m,ivec2(t%x,t/x),0).x;ivec2 r=ivec2(v%u,v/u);vec2 d=l-e(texelFetch(u_1,r,0).xy,i),o=vec2(1,0);for(uint u;u<c;++u)o=e(o,d);outColor+=e(vec2(texelFetch(u_k,r,0).x,0),o);}}else for(int v;v<4;++v){ivec2 d=2*t+ivec2(v&1,v>>1);vec2 f=(vec2(d)+.5)/i/2.-l,r=vec2(1,0),y;for(uint t;t<=c;++t)y+=x(e(texelFetch(u_p,o*d+ivec2(c-t,0),0).xy,r),u[c-t]*n[t]),r=e(r,f);outColor+=e(y,u[c]);}}`,PC=Dt((t,e,s,i,n,{handle:r},o,{handle:a})=>{const l=_n(t,fn,FC);gn(t,l);const d=Array.from({length:e},(c,g)=>Cx(t,g,s)),h=d.map(({handle:c})=>Zs(t,c)),u=mn(t,l,{u_5:s,u_l:e,u_6:e-1,u_p:d[0].handle,u_2:i().handle,u_m:n().handle,u_k:r,u_1:o().handle,u_n:a});return{step:()=>{t.useProgram(l);for(let c=e-1;c>=2;c--){const{handle:g}=d[(c+1)%e],_=d[c];t.viewport(0,0,_.size[0],_.size[1]),t.bindFramebuffer(t.FRAMEBUFFER,h[c]),Gi(t,u,{u_2:i().handle,u_m:n().handle,u_1:o().handle,u_6:c,u_p:g}),t.drawArrays(t.TRIANGLES,0,6)}},texture:c=>d[c],destroy:()=>{h.forEach(c=>t.deleteFramebuffer(c)),d.forEach(({handle:c})=>t.deleteTexture(c))}}},"Fe"),DC=`#version 300 es
uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 n){return u(n.y)<<1|u(n.x);}uniform uint u_0;uniform lowp usampler2D u_q,u_m;out uvec2 outColor;uint u(uint o,uint e,uint i){uint u,n=u_0;for(;u<n;){uint t=u+n>>1,r=texelFetch(u_m,ivec2(t%i,t/i),0).x;texelFetch(u_q,ivec2(r%e,r/e),0).x<o?u=t+1u:n=t;}return u;}void main(){uint n=uint(textureSize(u_q,0).x),e=uint(textureSize(u_m,0).x),i=u(uvec2(gl_FragCoord.xy));outColor=uvec2(u(i,n,e),u(i+1u,n,e));}`,kC=Dt(t=>1<<t-1,"Ee"),RC=Dt((t,e,s)=>{const i=kC(e),n=new Uint32Array(2*i**2);return s&&s.forEach((r,o)=>n[o]=r),Ks(t,{size:[i,i],data:n,type:t.UNSIGNED_INT,format:t.RG_INTEGER,internalFormat:t.RG32UI})},"Te"),OC=Dt((t,e,s,{handle:i},n)=>{const r=_n(t,fn,DC);gn(t,r);const o=RC(t,s),a=Zs(t,o.handle),l=mn(t,r,{u_0:e,u_q:i,u_m:n()});return{step:()=>{t.viewport(0,0,o.size[0],o.size[1]),t.useProgram(r),t.bindFramebuffer(t.FRAMEBUFFER,a),Gi(t,l,{u_m:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>o,destroy:()=>{t.deleteFramebuffer(a),t.deleteTexture(o.handle)}}},"Ae"),zC=`#version 300 es
precision lowp float;uint u(uint u){return u&=65535u,u=(u|u<<8)&16711935u,u=(u|u<<4)&252645135u,u=(u|u<<2)&858993459u,u=(u|u<<1)&1431655765u,u;}uint u(uvec2 e){return u(e.y)<<1|u(e.x);}vec2 u(vec2 e,vec4 u){return(e-u.xy)/u.zw;}uniform int u_0,u_l;uniform lowp sampler2D u_2,u_1;out uint outColor;void main(){ivec2 e=ivec2(gl_FragCoord.xy);if(textureSize(u_1,0).x*e.y+e.x>=u_0)return;vec4 t=texelFetch(u_2,ivec2(0),0);vec2 o=u(texelFetch(u_1,e,0).xy,t);outColor=u(uvec2(float(1<<u_l-1)*o));}`,BC=Dt(t=>Math.ceil(Math.sqrt(t)),"Re"),UC=Dt((t,e,s)=>{const i=BC(e),n=new Uint32Array(i**2).fill(4294967295);return s&&s.forEach((r,o)=>n[o]=r),Ks(t,{size:[i,i],data:n,type:t.UNSIGNED_INT,format:t.RED_INTEGER,internalFormat:t.R32UI})},"Me"),GC=Dt((t,e,s,i,n)=>{const r=_n(t,fn,zC);gn(t,r);const o=UC(t,e),a=Zs(t,o.handle),l=mn(t,r,{u_0:e,u_l:s,u_2:i().handle,u_1:n().handle});return{step:()=>{t.viewport(0,0,o.size[0],o.size[1]),t.useProgram(r),t.bindFramebuffer(t.FRAMEBUFFER,a),Gi(t,l,{u_2:i().handle,u_1:n().handle}),t.drawArrays(t.TRIANGLES,0,6)},texture:()=>o,destroy:()=>{t.deleteFramebuffer(a),t.deleteTexture(o.handle)}}},"be"),VC=`#version 300 es
precision highp int;uniform uint u_r,u_s;uniform highp usampler2D u_u,u_t;out uint outColor;uint u(uint u,uint e,bool o,uint t){uint i=u<4294967295u?texelFetch(u_u,ivec2(u%t,u/t),0).x:u,n=e<4294967295u?texelFetch(u_u,ivec2(e%t,e/t),0).x:e;if(o)return i<n?u:e;return i>n?u:e;}void main(){uint e=uint(textureSize(u_t,0).x),s=uint(textureSize(u_u,0).x);uvec2 t=uvec2(gl_FragCoord.xy);uint c=texelFetch(u_t,ivec2(t),0).x,i=uint(t.x+e*t.y),o=i^1u<<u_r-u_s,x=texelFetch(u_t,ivec2(o%e,o/e),0).x;bool n=(i>>u_r-u_s&1u)==0u;(i>>u_r&2u)==2u&&(n=!n),outColor=u(c,x,n,s);}`,jC=Dt(t=>Math.ceil(Math.sqrt(1<<Math.ceil(Math.log2(t)))),"Ge"),m_=Dt((t,e)=>{const s=jC(e.length),i=new Uint32Array(s**2).fill(4294967295);return e&&e.forEach((n,r)=>i[r]=n),Ks(t,{size:[s,s],data:i,type:t.UNSIGNED_INT,format:t.RED_INTEGER,internalFormat:t.R32UI})},"V"),qC=Dt(t=>Math.max(0,Math.ceil(Math.log2(t))),"Le"),HC=Dt(t=>t*(t+1)/2,"Ie"),XC=Dt((t,e,s)=>{const i=_n(t,fn,VC);gn(t,i);const n=Array.from({length:e},(f,p)=>p),r=m_(t,n),o=m_(t,n),a=$n(r,o),l=Zs(t,o.handle),d=Zs(t,r.handle),h=$n(l,d),u=mn(t,i,{u_r:0,u_s:0,u_t:r.handle,u_u:s.handle}),c=qC(e);let g=0,_=0,m=r;return{step:(f=HC(c))=>{t.useProgram(i),t.viewport(0,0,r.size[0],r.size[1]);for(let p=0;p<f;p++){t.bindFramebuffer(t.FRAMEBUFFER,h());const y=a();m=y===r?o:r,Gi(t,u,{u_r:g,u_s:_,u_t:y.handle}),t.drawArrays(t.TRIANGLES,0,6),_=(_+1)%(g+1),_===0&&(g=(g+1)%c)}},texture:()=>m,destroy:()=>{t.deleteFramebuffer(l),t.deleteFramebuffer(d),t.deleteTexture(o.handle),t.deleteTexture(r.handle)}}},"Ue"),WC=Dt(t=>{let e;return()=>e||t().finally(()=>e=void 0)},"Ne"),$C=Dt((t,e)=>Math.max(.1,1-(t/Math.max(1,e-20))**7.39),"K"),YC=Dt((t,e=25,s=24e3)=>{const i=(s-e)/(e-1);return Math.ceil(e*i*4/(i+t))},"J"),f_={charge:10,edgeStrength:.5,edgeLength:30,elasticity:.9,margin:1,gravity:.002,inertia:.9,maxDisplacement:1e3,steps:300},ZC=Dt((t,e,s)=>{let[i,n]=[0,0];const r=yC(t),o=Dt(()=>{t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0);for(let l=0;l<e;l++,i++)if(!s(i))return!0},"i"),a=Dt(l=>{o()?l(i):n=requestAnimationFrame(()=>a(l))},"a");return{start:WC(()=>new Promise(l=>(i=0)||a(l))),step:o,stop:()=>cancelAnimationFrame(n)}},"Q"),Jl=Dt((t,e,s)=>{var i,n;let{bodyTexture:r}=e;const{N:o,propertyTexture:a}=e,{steps:l,batch:d}=s,h=(i=s.order)!=null?i:4;if(h<2||h>8)throw new Error("Order must be between 2 and 8");const u=Math.max(1,(n=s.depth)!=null?n:Math.ceil(Math.log2(o)/2)),{step:c,texture:g,destroy:_}=TC(t,o,()=>r),{step:m,texture:f,destroy:p}=GC(t,o,u,g,()=>r),{step:y,texture:b,destroy:x}=XC(t,o,f()),{step:v,texture:E,destroy:w}=OC(t,o,u,f(),b),{step:A,texture:I,destroy:M}=PC(t,u,h,g,b,a,()=>r,E()),{step:k,texture:W,destroy:H}=NC(t,u,h,I),{step:$,texture:P,destroy:S}=IC(t,u,h,g,b,E(),W(u-1),e,s);return Wt(ct({},ZC(t,d??YC(o),Y=>(r=P(),c(),m(),y(),v(),A(),k(),$($C(Y,l)),Y<l))),{destroy:()=>{_(),p(),x(),w(),M(),H(),S()}})},"qe"),p_=0,Mx=typeof window>"u",KC=typeof performance<"u"&&performance.now?performance:Date,QC=Mx?t=>{const e=KC.now(),s=Math.max(0,16-(e-p_)),i=setTimeout(()=>t(e+s),s);return p_=e+s,i}:window.requestAnimationFrame,JC=Mx?t=>clearTimeout(t):window.cancelAnimationFrame;function Nx(t,e,s){for(let i=0;i<t.length;i++){const n=t[i];n.x=e[i],n.y=s[i]}}Dt(Nx,"defaultUpdate");var t2=Dt(()=>{},"noop"),td={movementRatio:7e-8,surfaceRatio:.0025},rh=class{constructor(t={}){this.onUpdate=Dt(e=>{},"onUpdate"),this.update=Nx,this.nextTick=QC,this.cancelTick=JC,this.onEnd=t2,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=td,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in t?t.autoStop&&(typeof t.autoStop=="boolean"?t.autoStop=td:t.autoStop=ct(ct({},t.autoStop),td)):t.steps;for(const e in t)t[e]===void 0&&e!=="order"&&e!=="depth"||(this[e]=t[e])}};Dt(rh,"Settings");var y_=class{constructor(t){this.promise=new Promise(t)}then(t){return this.promise.then(t)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function ma(t,e,s={}){var i;let n,r;e.getExtension("OES_texture_float_linear")&&e.getExtension("EXT_color_buffer_float")||(i=e.getExtension("WEBGL_lose_context"))==null||i.loseContext();let o=new rh(ct(ct({},f_),s));const a=t.nodes.length,l=s.cx||t.nodes.reduce((m,f)=>m+(f.x||0),0)/a,d=s.cy||t.nodes.reduce((m,f)=>m+(f.y||0),0)/a,h=[l,d],u=Dt(m=>{if(!n)throw new Error("No graph has been set");const{size:f}=n.bodyTexture;if(f[0]*f[1]<=1)return{X:[0],Y:[0]};const p=new Float32Array(4*f[0]*f[1]);e.readPixels(0,0,f[0],f[1],e.RGBA,e.FLOAT,p),m&&(c(),g());const y=p.filter((x,v)=>v%4==0).map(x=>x+l),b=p.filter((x,v)=>v%4==1).map(x=>x+d);return{X:y,Y:b}},"readLayoutData"),c=Dt(()=>{r&&(r.stop(),r.destroy(),r=void 0)},"simulationCleanup"),g=Dt(()=>{n&&(g_(e,n),n=void 0)},"graphLayoutCleanup"),_={setOptions:(m={})=>(o=new rh(ct(ct({},f_),m)),n&&(c(),r=Jl(e,n,o)),_),setGraph:(m={nodes:[],edges:[]})=>(n&&g_(e,n),n=c_(e,u_(h_(m),h)),o&&(c(),r=Jl(e,n,o)),_),start:()=>{if(!r)throw new Error("No graph has been set");return r.start().finally(()=>{var m;return(m=s.onEnd)==null?void 0:m.call(s,1)}),_},stop:()=>(r&&r.stop(),_),step:()=>{if(!r)throw new Error("No graph has been set");return r.step(),_},data:m=>u(m),iterations:()=>1};return n=c_(e,u_(h_(t),h)),r=Jl(e,n,o),_}/**
* @preserve
* @linkurious/force-layout@0.7.0
* Ogma general-purpose force-directed layout
*/function x_(){var t=(()=>{var e=Object.defineProperty,s=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,r=(T,F)=>e(T,"name",{value:F,configurable:!0}),o={};((T,F)=>{for(var L in F)e(T,L,{get:F[L],enumerable:!0})})(o,{IntegratorType:()=>He,default:()=>Vt});var a=class{constructor(T){let F=l();this.c=1,this.s0=F(" "),this.s1=F(" "),this.s2=F(" "),this.s0-=F(String(T)),this.s0<0&&(this.s0+=1),this.s1-=F(String(T)),this.s1<0&&(this.s1+=1),this.s2-=F(T),this.s2<0&&(this.s2+=1),F=null}next(){return()=>{const T=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=T-(this.c=0|T)}}nextDouble(){const T=this.next();return()=>T()+11102230246251565e-32*(2097152*T()|0)}nextInt32(){const T=this.next();return()=>4294967296*T()|0}};function l(){let T=4022871197;return F=>{F=F.toString();for(let L=0;L<F.length;L++){T+=F.charCodeAt(L);let N=.02519603282416938*T;T=N>>>0,N-=T,N*=T,T=N>>>0,N-=T,T+=4294967296*N}return 23283064365386963e-26*(T>>>0)}}function d(T){return new a(T.toString()).next()}r(a,"Alea"),r(l,"Mash"),r(d,"impl");var h=d(42);function u(T){h=d(T)}function c(){return 1e-6*(h()-.5)}function g(T,F,{sources:L,targets:N,X:z,Y:V,R:B,fx:X,fy:j,degrees:O,weights:U},{edgeStrength:Z,edgeLength:J}){for(let rt=0;rt<F.length;rt++){const K=F[rt],tt=L[K],gt=N[K],bt=1,ft=O[tt]+bt,ht=O[gt]+bt,vt=Z*U[K];let lt=z[gt]+X[gt]-z[tt]-X[tt]||c(),yt=V[gt]+j[gt]-V[tt]-j[tt]||c();const Pt=lt*lt+yt*yt,kt=Math.sqrt(Pt),zt=J+B[tt]+B[gt];if(kt<=zt)continue;const Rt=zt-kt,Yt=1/Math.min(ft,ht),ne=Math.min(1,T*vt*(Rt*Rt/Pt)*Yt);lt*=ne,yt*=ne;const ae=ht/(ht+ft);X[tt]+=lt*ae,j[tt]+=yt*ae,X[gt]-=lt*(1-ae),j[gt]-=yt*(1-ae)}}r(u,"setSeed"),r(c,"randomize"),r(g,"attraction");var _=r((T,{edgeIds:F,sources:L,targets:N,degrees:z,weights:V})=>{for(let B=0;B<T.length;B++){const{source:X,target:j,weight:O=1}=T[B];L[B]=X,N[B]=j,V[B]=O,z[X]++,z[j]++,F[B]=B,V[B]=O===void 0?1:O}},"initialize");function m(T,F,{X:L,Y:N,fx:z,fy:V},{gravity:B,cx:X,cy:j}){const O=F.length;for(let U=0;U<O;U++){const Z=F[U],J=X-L[Z]||c(),rt=j-N[Z]||c(),K=B*T;z[Z]+=J*K,V[Z]+=rt*K}}g.initialize=_,r(m,"center");var f=r((T,F,L)=>{const{X:N,Y:z}=F;let V=L.cx,B=L.cy;const X=T.length;if(V===void 0||B===void 0){V=B=0;for(let j=0;j<X;j++)V+=N[j],B+=z[j];V/=X,B/=X}L.cx=V,L.cy=B},"initialize");m.initialize=f;var p=class{constructor(T,F,L,N){this.left=null,this.right=null,this.data=null,this.code=T,this.data=F,this.left=L,this.right=N}};function y(T,F,L,N,z){const V=new p(null,null,null,null),B=[V],X=[N,z];for(;B.length!==0;){const j=X.pop(),O=X.pop(),U=B.pop();if(j-O==0)U.code=L[O],U.data=T[F[O]];else{const Z=v(F,L,O,j);U.code=Z,O<=Z&&(U.left=new p(null,null,null,null),B.push(U.left),X.push(O,Z)),j>Z&&(U.right=new p(null,null,null,null),B.push(U.right),X.push(Z+1,j))}}return V}function b(T,F,L,N,z,V){const B=new p(null,null,null,null),X=[B],j=[N,z];for(;X.length!==0;){const O=j.pop(),U=j.pop(),Z=X.pop();if(O-U<V){const J=new Array(O-U+1);for(let rt=U,K=0;rt<=O;rt++,K++)J[K]=T[F[rt]];Z.code=L[U],Z.data=J}else{const J=v(F,L,U,O);Z.code=J,U<=J&&(Z.left=new p(null,null,null,null),X.push(Z.left),j.push(U,J)),O>J&&(Z.right=new p(null,null,null,null),X.push(Z.right),j.push(J+1,O))}}return B}r(p,"Node"),r(y,"buildIterative"),r(b,"buildIterativeBuckets");var x=Math.clz32||r(function(F){let L=-2147483648;for(let N=0;N<31;N+=1){if(L&F)return N;L>>>=1}return 32},"clz");function v(T,F,L,N){const z=F[T[L]],V=F[T[N]];if(z===V)return L;const B=x(z^V);let X,j,O,U=L,Z=N-L;do Z=Z+1>>1,X=U+Z,X<N&&(j=F[T[X]],O=x(z^j),O>B&&(U=X));while(Z>1);return U}function E(T,F){let L=T^F,N=65535^L,z=65535^(T|F),V=T&(65535^F),B=L|N>>1,X=L>>1^L,j=z>>1^N&V>>1^z,O=L&z>>1^V>>1^V;L=B,N=X,z=j,V=O,B=L&L>>2^N&N>>2,X=L&N>>2^N&(L^N)>>2,j^=L&z>>2^N&V>>2,O^=N&z>>2^(L^N)&V>>2,L=B,N=X,z=j,V=O,B=L&L>>4^N&N>>4,X=L&N>>4^N&(L^N)>>4,j^=L&z>>4^N&V>>4,O^=N&z>>4^(L^N)&V>>4,L=B,N=X,z=j,V=O,j^=L&z>>8^N&V>>8,O^=N&z>>8^(L^N)&V>>8,L=j^j>>1,N=O^O>>1;let U=T^F,Z=N|65535^(U|L);return U=16711935&(U|U<<8),U=252645135&(U|U<<4),U=858993459&(U|U<<2),U=1431655765&(U|U<<1),Z=16711935&(Z|Z<<8),Z=252645135&(Z|Z<<4),Z=858993459&(Z|Z<<2),Z=1431655765&(Z|Z<<1),(Z<<1|U)>>>0}r(v,"findSplit"),r(E,"hilbert");var w=[0,1],A=[0,2];for(let T=4;T<65535;T<<=2)for(let F=0,L=w.length;F<L;F++)w.push(w[F]|T),A.push((w[F]|T)<<1);function I(T,F){return(A[255&F]|w[255&T])+65536*(A[F>>8&255]|w[T>>8&255])+4294967296*(A[F>>16&255]|w[T>>16&255])}r(I,"morton");var M=new Uint32Array(1024);function k(T,F){const L=new Uint32Array(F.length);for(let z=0;z<1024;z++)M[z]=0;const N=255;for(let z=0;z<F.length;z++){const V=F[z];M[V&N]++,M[256+(V>>8&N)]++,M[512+(V>>16&N)]++,M[768+(V>>24&N)]++}for(let z=0;z<4;z++){let V=0,B=0;const X=256*z;for(let j=0;j<256;j++)V=M[j+X],M[j+X]=B,B+=V}for(let z=0;z<F.length;z++){const V=F[z];L[M[V&N]++]=z}for(let z=0;z<F.length;z++){const V=L[z],B=F[V];T[M[256+(B>>8&N)]++]=V}for(let z=0;z<F.length;z++){const V=T[z],B=F[V];L[M[512+(B>>16&N)]++]=V}for(let z=0;z<F.length;z++){const V=L[z],B=F[V];T[M[768+(B>>24&N)]++]=V}}r(k,"radixSort");var W=class{constructor(T,{getX:F,getY:L,bucketSize:N=0,sfc:z=1}={}){this.bucketSize=0,this._root=null;const V=T.length,B=new Uint32Array(V);let X=1/0,j=1/0,O=-1/0,U=-1/0;this._x=F,this._y=L;const Z=z===1?E:I;this._project=Z;const J=new Uint32Array(V);for(let tt=0;tt<V;tt++){const gt=T[tt],bt=F(gt),ft=L(gt);bt<X&&(X=bt),ft<j&&(j=ft),bt>O&&(O=bt),ft>U&&(U=ft),J[tt]=tt}this._minX=X,this._minY=j,this._maxX=O,this._maxY=U;const rt=65535/Math.max(O-X,1),K=65535/Math.max(U-j,1);this._hw=rt,this._hh=K;for(let tt=0;tt<V;tt++){const gt=T[tt];B[tt]=Z(rt*(F(gt)-X),K*(L(gt)-j))}k(J,B),this._root=N===0?y(T,J,B,0,V-1):b(T,J,B,0,V-1,N),this.bucketSize=N}get root(){return this._root}inOrder(T,F){let L=this._root;const N=[];let z=!1;for(;!z;)if(L)N.push(L),L=L.left;else if(N.length!==0){if(L=N.pop(),T.call(F,L))break;L=L.right}else z=!0;return this}preOrder(T,F){const L=[this._root];for(;L.length!==0;){const N=L.pop();T.call(F,N)||(N.right&&L.push(N.right),N.left&&L.push(N.left))}return this}postOrder(T,F){const L=[];let N,z=this._root;do{for(;z;)z.right&&L.push(z.right),L.push(z),z=z.left;z=L.pop(),N=L.length-1,z.right&&L[N]===z.right?(L[N]=z,z=z.right):(T.call(F,z),z=null)}while(L.length!==0);return this}map(T,F){const L=[];return this.inOrder(N=>{L.push(T.call(F,N))}),L}height(){return H(this._root)}toString(T=F=>F.code.toString()){const F=[];return $(this._root,"",!0,L=>F.push(L),T),F.join("")}size(){let T=0;return this.preOrder(()=>{T++}),T}destroy(){return this._root=null,this}};function H(T){return T?1+Math.max(H(T.left),H(T.right)):0}function $(T,F,L,N,z){if(T){N(F+(L?"^-- ":"|-- ")+z(T)+`
`);const V=F+(L?"    ":"|   ");T.left&&$(T.left,V,!1,N,z),T.right&&$(T.right,V,!0,N,z)}}function P(T){for(let F=T.length-1;F>=0;F--){let L=Math.floor(Math.random()*(F+1));L=Math.max(Math.min(L,F),0);const N=T[F];T[F]=T[L],T[L]=N}return T}r(W,"BVH"),r(H,"treeHeight"),r($,"row"),r(P,"shuffle");var S,Y,st,at,Tt,ut,Mt,Nt,_t,St=r(T=>T.x,"getX"),Zt=r(T=>T.y,"getY"),Qt=r(T=>T.r,"getR");function Kt(T,F=St,L=Zt,N=Qt){const z=P(T.slice()),V=z.length;let B,X=[],j=0;for(;j<V;){const O=z[j];B&&ue(B,F(O),L(O),N(O))?j++:(X=mt(X,O,F,L,N),B=ce(X,F,L,N),j=0)}return B}function mt(T,F,L,N,z){const V=L(F),B=N(F),X=z(F),j={x:V,y:B,r:X};if(Jt(j,T,L,N,z))return[F];for(let O=0;O<T.length;++O){const U=T[O],Z=L(U),J=N(U),rt=z(U);if(!pt(j,Z,J,rt)&&Jt(q(Z,J,rt,V,B,X),T,L,N,z))return[T[O],F]}for(let O=0;O<T.length-1;O++)for(let U=O+1;U<T.length;U++){const Z=T[O],J=T[U],rt=L(Z),K=N(Z),tt=z(Z),gt=L(J),bt=N(J),ft=z(J);if(!pt(q(rt,K,tt,gt,bt,ft),V,B,X)&&!pt(q(rt,K,tt,V,B,X),gt,bt,ft)&&!pt(q(gt,bt,ft,V,B,X),rt,K,tt)&&Jt(et(rt,K,tt,gt,bt,ft,V,B,X),T,L,N,z))return[T[O],T[U],F]}throw new Error}function pt(T,F,L,N){const z=T.r-N,V=F-T.x,B=L-T.y;return z>=0&&z*z>V*V+B*B}function ue(T,F,L,N){const z=T.r-N+1e-6,V=F-T.x,B=L-T.y;return z>0&&z*z>V*V+B*B}function Jt(T,F,L,N,z){for(let V=0;V<F.length;++V){const B=F[V];if(!ue(T,L(B),N(B),z(B)))return!1}return!0}function ce(T,F,L,N){return T.length===1?oe(F(T[0]),L(T[0]),N(T[0])):T.length===2?q(F(T[0]),L(T[0]),N(T[0]),F(T[1]),L(T[1]),N(T[1])):et(F(T[0]),L(T[0]),N(T[0]),F(T[1]),L(T[1]),N(T[1]),F(T[2]),L(T[2]),N(T[2]))}function oe(T,F,L){return{x:T,y:F,r:L}}function q(T,F,L,N,z,V){const B=N-T,X=z-F,j=V-L,O=Math.sqrt(B*B+X*X);return{x:(T+N+B/O*j)/2,y:(F+z+X/O*j)/2,r:(O+L+V)/2}}function et(T,F,L,N,z,V,B,X,j){const O=T-N,U=T-B,Z=F-z,J=F-X,rt=V-L,K=j-L,tt=T*T+F*F-L*L,gt=tt-N*N-z*z+V*V,bt=tt-B*B-X*X+j*j,ft=U*Z-O*J,ht=(Z*bt-J*gt)/(2*ft)-T,vt=(J*rt-Z*K)/ft,lt=(U*gt-O*bt)/(2*ft)-F,yt=(O*K-U*rt)/ft,Pt=vt*vt+yt*yt-1,kt=2*(L+ht*vt+lt*yt),zt=ht*ht+lt*lt-L*L,Rt=-(Pt?(kt+Math.sqrt(kt*kt-4*Pt*zt))/(2*Pt):zt/kt);return{x:T+ht+vt*Rt,y:F+lt+yt*Rt,r:Rt}}function dt(T,F,L,{X:N,Y:z,R:V,fx:B,fy:X,bucketSize:j},{elasticity:O}){if(O===0)return L;L||(L=new W(F,{getX:S,getY:Y,bucketSize:j})).postOrder(at);for(let U=0;U<F.length;U++)ut=F[U],Mt=N[ut]+B[ut],Nt=z[ut]+X[ut],_t=V[ut],L.preOrder(Tt);return L}r(Kt,"med"),r(mt,"extend"),r(pt,"contains"),r(ue,"containsWeak"),r(Jt,"containsWeakAll"),r(ce,"enclose"),r(oe,"from1"),r(q,"from2"),r(et,"from3"),r(dt,"collisionForce");var ot,nt,it,wt,At,Et,Ht,Gt,pe,ge=r(({X:T,Y:F,R:L,bucketSize:N})=>z=>{let V,B,X,j;const O=z.data;if(O!==null)if(N!==0){const U=Kt(O,S,Y,st);V=U.x,B=U.y,X=U.r}else{const U=O;V=T[U],B=F[U],X=L[U]}else if(z.left&&z.right){const U=z.left.cx,Z=z.left.cy,J=z.right.cx,rt=z.right.cy,K=z.left.r,tt=z.right.r,gt=J-U,bt=rt-Z,ft=tt-K,ht=Math.sqrt(gt*gt+bt*bt);V=(U+J+gt/ht*ft)/2,B=(Z+rt+bt/ht*ft)/2,X=(ht+K+tt)/2}else j=z.left||z.right,j&&(V=j.cx,B=j.cy,X=j.r);z.cx=V,z.cy=B,z.r=X},"getMeasureBodies"),_e=r(({X:T,Y:F,R:L,fx:N,fy:z,bucketSize:V},{elasticity:B,margin:X})=>j=>{const O=j.data;if(O===null){const U=j.cx-Mt,Z=j.cy-Nt,J=j.r+_t;return U*U+Z*Z>J*J}if(V!==0){const U=O;for(let Z=0;Z<U.length;Z++){const J=U[Z];if(J>ut){const rt=L[J];let K=Mt-T[J]-N[J],tt=Nt-F[J]-z[J];const gt=_t+rt+X;let bt=K*K+tt*tt;if(bt<gt*gt){K===0&&(K=c(),bt+=K*K),tt===0&&(tt=c(),bt+=tt*tt);const ft=Math.sqrt(bt),ht=(gt-ft)*B/ft,vt=rt/gt;N[ut]+=K*ht*vt,z[ut]+=tt*ht*vt,N[J]-=K*ht*(1-vt),z[J]-=tt*ht*(1-vt)}}}}else{const U=j.data;if(U>ut){const Z=L[U];let J=Mt-T[U],rt=Nt-F[U];const K=_t+Z+X;let tt=J*J+rt*rt;if(tt<K*K){J===0&&(J=c(),tt+=J*J),rt===0&&(rt=c(),tt+=rt*rt);const gt=Math.sqrt(tt),bt=(K-gt)*B/gt,ft=Z/K;N[ut]+=J*bt*ft,z[ut]+=rt*bt*ft,N[U]-=J*bt*(1-ft),z[U]-=rt*bt*(1-ft)}}}},"getApplyForce"),be=r((T,F,L)=>{const{X:N,Y:z,R:V}=F;S=r(B=>N[B],"getX"),Y=r(B=>z[B],"getY"),st=r(B=>V[B],"getR"),at=ge(F),Tt=_e(F,L)},"initialize");function Ce(T,F,{masses:L,X:N,Y:z,fx:V,fy:B},{charge:X}){const j=F.length;let O,U,Z,J,rt,K,tt,gt,bt;for(let ft=0;ft<j;ft++){O=F[ft];for(let ht=ft+1;ht<j;ht++)if(ft!==ht){if(U=F[ht],O===U)continue;Z=N[O]-N[U]||c(),J=z[O]-z[U]||c(),rt=Z*Z+J*J,rt<1&&(rt=Math.sqrt(1*rt)),K=X*L[U],tt=T*K/rt,gt=X*L[O],bt=T*gt/rt,V[O]+=Z*tt,B[O]+=J*tt,V[U]-=Z*bt,B[U]-=J*bt}}}dt.initialize=be,r(Ce,"repulsion"),Ce.initialize=()=>{};var $t=0;function re(T,F,L,{X:N,Y:z,R:V,bucketSize:B}){$t=T,L===null&&(L=new W(F,{getX:it,getY:wt,bucketSize:B})).postOrder(ot);const X=F.length;for(let j=0;j<X;j++)Et=F[j],Ht=N[Et],Gt=z[Et],pe=V[Et],L.preOrder(nt);return L}r(re,"repulsion");var ve=r(({fx:T,fy:F,X:L,Y:N,R:z,masses:V,bucketSize:B},{charge:X,theta:j})=>O=>{let U=0,Z=0,J=Ht-O.cx||c(),rt=Gt-O.cy||c(),K=J*J+rt*rt,tt=pe+O.r;const gt=O.data;if(gt!==null){if(gt===Et)return!1;if(B!==0){const bt=gt;for(let ft=0;ft<bt.length;ft++){const ht=bt[ft];ht!==Et&&(J=Ht-L[ht]||c(),rt=Gt-N[ht]||c(),K=J*J+rt*rt,tt=pe+z[ht],K<1&&(K=Math.sqrt(1*K)),U=X*V[ht],Z=$t*U/K,T[Et]+=J*Z,F[Et]+=rt*Z)}}else K<1&&(K=Math.sqrt(1*K)),U=X*O.mass,Z=$t*U/K,T[Et]+=J*Z,F[Et]+=rt*Z}else{const bt=tt/j;if(K>bt*bt)return K<1&&(K=Math.sqrt(1*K)),U=X*O.mass,Z=$t*U/K,T[Et]+=J*Z,F[Et]+=rt*Z,!0}},"getApplyForce"),fe=r(({X:T,Y:F,R:L,masses:N,bucketSize:z})=>V=>{let B,X,j=0,O=0,U=0,Z=0;const J=V.data;if(J!==null)if(z!==0){const rt=J,K=Kt(rt,it,wt,At);j=K.x,O=K.y,U=K.r;for(let tt=0;tt<rt.length;tt++)Z+=N[rt[tt]]}else X=J,j=T[X],O=F[X],U=L[X],Z=N[X];else if(V.left&&V.right){const rt=V.left.cx,K=V.left.cy,tt=V.right.cx,gt=V.right.cy,bt=V.left.r,ft=V.right.r,ht=tt-rt,vt=gt-K,lt=ft-bt,yt=Math.sqrt(ht*ht+vt*vt);j=(rt+tt+ht/yt*lt)/2,O=(K+gt+vt/yt*lt)/2,U=(yt+bt+ft)/2,Z=V.left.mass+V.right.mass}else B=V.left||V.right,j=B.cx,O=B.cy,U=B.r,Z=B.mass;V.cx=j,V.cy=O,V.r=U,V.mass=Z},"getAccumulateBodies"),ee=r((T,F,L)=>{const N=T.length,{X:z,Y:V,R:B,degrees:X,pinned:j,masses:O,nodeIds:U}=F,{scaling:Z,defaultRadius:J,bucketSize:rt}=L;F.bucketSize=rt===void 0?Math.floor(Math.log(N)):rt;let K=1/0,tt=1/0,gt=-1/0,bt=-1/0;const ft=Math.PI*(3-Math.sqrt(5));let ht=0;for(let vt=0;vt<T.length;vt++){const lt=T[vt];let{x:yt,y:Pt,r:kt}=lt;const{mass:zt}=lt;if(isNaN(yt)||isNaN(Pt)){const Rt=5*Math.sqrt(vt),Yt=vt*ft;yt=Rt*Math.cos(Yt),Pt=Rt*Math.sin(Yt)}kt=kt||J,z[vt]=yt,V[vt]=Pt,B[vt]=kt,j[vt]=lt.pinned?1:0,O[vt]=zt===void 0?(1+X[vt])*Z:zt,U[vt]=vt,kt>ht&&(ht=kt),yt<K&&(K=yt),Pt<tt&&(tt=Pt),yt>gt&&(gt=yt),Pt>bt&&(bt=Pt)}if(T.length>1&&(gt-K<2*ht||bt-tt<2*ht)){const vt=(K+gt)/2,lt=(tt+bt)/2;for(let yt=0;yt<N;yt++)if(!j[yt]){const Pt=5*Math.sqrt(yt),kt=yt*ft,zt=vt+Pt*Math.cos(kt),Rt=lt+Pt*Math.sin(kt);z[yt]=zt,V[yt]=Rt,zt<K&&(K=zt),Rt<tt&&(tt=Rt),zt>gt&&(gt=zt),Rt>bt&&(bt=Rt)}}it=r(vt=>z[vt],"getX"),wt=r(vt=>V[vt],"getY"),At=r(vt=>B[vt],"getR"),ot=fe(F),nt=ve(F,L)},"initialize");function we(T,F,{X:L,Y:N,fx:z,fy:V,vx:B,vy:X,masses:j,pinned:O},U){let Z=0,J=0;const rt=T.length,K=1/8;for(let tt=0;tt<rt;tt++){const gt=T[tt],bt=j[gt],ft=z[gt]/bt,ht=V[gt]/bt;B[gt]+=ft*K,X[gt]+=ht*K;const vt=.2*B[gt]*K+.5*ft*K*K,lt=.2*X[gt]*K+.5*ht*K*K;z[gt]=V[gt]=0,O[gt]||(L[gt]+=vt,N[gt]+=lt,Z+=Math.abs(vt)*bt,J+=Math.abs(lt)*bt)}return(Z*Z+J*J)/rt}function ye(T,F,{X:L,Y:N,fx:z,fy:V,vx:B,vy:X,pinned:j,masses:O},U){const Z=T.length;let J=0;for(let rt=0;rt<Z;rt++){const K=T[rt],tt=O[K],gt=z[K]/tt,bt=V[K]/tt,ft=B[K]+1*gt,ht=X[K]+1*bt;let vt=1*ft,lt=1*ht;vt>1e4&&(vt=.1),lt>1e4&&(lt=.1),B[K]=F*(ft+B[K])/2,X[K]=F*(ht+X[K])/2,z[K]=V[K]=0,j[K]||(L[K]+=vt,N[K]+=lt),J+=.5*(vt*vt+lt*lt)}return J}function Pe(T,F,{X:L,Y:N,fx:z,fy:V,pinned:B,layer:X,layers:j,surfaces:O,movements:U},{maxDisplacement:Z}){U.fill(0);let J=0;const rt=T.length;let K=1/0,tt=1/0,gt=-1/0,bt=-1/0;const ft=Z*Z;for(let lt=0;lt<rt;lt++){const yt=T[lt],Pt=z[yt]*=F,kt=V[yt]*=F,zt=X[yt];let Rt=Pt,Yt=kt;const ne=L[yt],ae=N[yt];if(Rt*Rt+Yt*Yt>ft){const Xe=Math.sqrt(Rt*Rt+Yt*Yt)/Z;Yt/=Xe,Rt/=Xe}B[yt]||(L[yt]+=Rt,N[yt]+=Yt);const Te=Math.sqrt(Rt*Rt+Yt*Yt);B[yt]||(ne<K&&(K=ne),ae<tt&&(tt=ae),ne>K&&(gt=ne),ae>tt&&(bt=ae),U[zt-1]+=Te),J+=zt*Te}const ht=Math.max(gt-K,0),vt=Math.max(bt-tt,0);for(let lt=0;lt<j.length;lt++){const yt=j[lt],Pt=yt.length;let kt=1/0,zt=1/0,Rt=-1/0,Yt=-1/0,ne=0;for(let We=0;We<Pt;We++){const Es=yt[We];if(B[Es])continue;const ke=L[Es],ms=N[Es];ke<kt&&(kt=ke),ms<zt&&(zt=ms),ke>Rt&&(Rt=ke),ms>Yt&&(Yt=ms),ne++}const ae=Rt-kt,Te=Yt-zt,Xe=Math.max(1,Math.sqrt(ae**2+Te**2));O[lt]=Xe;const _s=ne===0?0:U[lt]/ne,Ze=ht*vt||1;U[lt]=_s>ne?_s/Ze:0}return J}function ps(T,F,L){te(T,F,L),se(L)}function te(T,F,{sources:L,targets:N,degrees:z,nodeIds:V,edgeIds:B}){const X={};for(let j=0;j<T.length;j++)X[j]=V[j]=j;for(let j=0;j<F.length;j++){const{source:O,target:U}=F[j],Z=X[O],J=X[U];B[j]=j,L[j]=Z,N[j]=J,z[Z]++,z[J]++}}function se({nodeIds:T,edgeIds:F,sources:L,targets:N,degrees:z,layer:V,layers:B,component:X,components:j,cluster:O,parent:U}){let Z=0,J=1;const rt=new Uint32Array(T.length);for(let ht=0;ht<T.length;ht++)rt[ht]=z[ht];const K=new Array(T.length);for(let ht=0;ht<F.length;ht++){const vt=F[ht],lt=L[vt],yt=N[vt];K[lt]=K[lt]||[],K[yt]=K[yt]||[],K[lt].push(yt),K[yt].push(lt)}const tt=new Uint8Array(T.length),gt=new Uint8Array(T.length);U.fill(-1);let bt=0;for(let ht=0;ht<T.length;ht++)if(tt[ht]===0){const vt=[ht];for(;vt.length!==0;){const lt=vt.pop();if(tt[lt]===0&&K[lt]!==void 0){const yt=K[lt];for(let Pt=0;Pt<yt.length;Pt++)vt.push(yt[Pt])}tt[lt]=1,X[lt]=bt}bt++}const ft=new Array(T.length);for(let ht=0;ht<T.length;ht++)V[ht]=0,ft[ht]=ht;for(;ft.length!==0;){const ht=[],vt=[];for(let lt=0;lt<ft.length;lt++)rt[ft[lt]]<=Z&&(ht.push(lt),vt.push(ft[lt]));for(let lt=0;lt<vt.length;lt++){const yt=vt[lt];gt[yt]=Z,V[yt]=J;const Pt=K[yt];if(Pt)for(let kt=0;kt<Pt.length;kt++)rt[Pt[kt]]--}for(let lt=0;lt<vt.length;lt++){const yt=vt[lt],Pt=K[yt];if(Pt)for(let kt=0;kt<Pt.length;kt++){const zt=Pt[kt],Rt=V[zt];if(Rt===void 0||Rt>J){U[yt]=zt;break}}}ht.reverse();for(let lt=0;lt<ht.length;lt++)ft.splice(ht[lt],1);if(J+=1,ft.length>0){let lt=1/0;for(let yt=0;yt<ft.length;yt++){const Pt=rt[ft[yt]];Pt<lt&&(lt=Pt)}lt>=Z+1&&(Z=lt,J=1)}}tt.fill(0);for(let ht=0;ht<T.length;ht++){const vt=T[ht],lt=V[vt];if(U[vt]===-1||V[U[vt]]===lt){const yt=[vt];for(tt.fill(0);yt.length!==0;){const Pt=yt.pop();if(tt[Pt])continue;if(V[Pt]>lt){U[vt]=Pt;break}const kt=K[Pt];if(tt[Pt]=1,kt)for(let zt=0;zt<kt.length;zt++)yt.push(kt[zt])}}}for(let ht=0;ht<T.length;ht++){const vt=T[ht],lt=X[vt];j[lt]=j[lt]||[],j[lt].push(vt);const yt=V[vt]-1;B[yt]=B[yt]||[],B[yt].push(vt),O[vt]=U[vt]}}re.initialize=ee,r(we,"euler"),r(ye,"leapfrog"),r(Pe,"velocityVerlet"),r(ps,"default"),r(te,"initTopology"),r(se,"decomposition");var ie=class{constructor(T,F=!0){this.bucketSize=0;const L=T.nodes.length,N=T.edges.length;u(L+N),this.X=new Array(L),this.Y=new Array(L),this.R=new Array(L),this.fx=new Float32Array(L),this.fy=new Float32Array(L),this.vx=new Float32Array(L),this.vy=new Float32Array(L),this.pinned=new Uint8Array(L),this.masses=new Float32Array(L),this.weights=new Float32Array(N),this.lengths=new Float32Array(N),this.sources=new Uint32Array(N),this.targets=new Uint32Array(N),this.degrees=new Uint32Array(L),this.layer=new Uint32Array(L),this.parent=new Int32Array(L),this.cluster=new Int32Array(L),this.component=new Uint32Array(L),this.components=[],this.layers=[],this.nodeIds=new Array(L),this.edgeIds=new Array(N),F&&ps(T.nodes,T.edges,this),this.movements=new Array(this.layers.length).fill(0),this.surfaces=new Array(this.layers.length).fill(0),this.movementsPrev=new Array(this.layers.length).fill(0),this.surfacesPrev=new Array(this.layers.length).fill(0)}};function Me(T,F){return T<F?T*F+Math.pow(F-T-1,2)/4:T*F+Math.pow(T-F-1,2)/4}function Ne(T,F){return(T+F)*(T+F+1)/2+F}function $e({edgeIds:T,sources:F,targets:L,pinned:N,degrees:z,X:V,Y:B,R:X},j=0,O=.5){const U={},Z={};for(const J of T){const rt=F[J],K=L[J];rt!==K&&(U[rt]=U[rt]||{},U[K]=U[K]||{},U[rt][K]=!0,U[K][rt]=!0)}Object.keys(U).forEach(J=>{const rt=Number(J),K=Object.keys(U[Number(rt)]);if(K.length===2){const[tt,gt]=K,bt=Me(Number(tt),Number(gt));bt in Z||(Z[bt]=[Number(gt),Number(tt)]),N[rt]||Z[bt].push(rt)}}),Object.keys(Z).forEach(J=>{const[rt,K,...tt]=Z[Number(J)];if(tt.length<3)return;const gt=V[rt],bt=B[rt],ft=V[K],ht=B[K],vt=z[rt],lt=.25+.5*vt/(vt+z[K]);let yt=gt+(ft-gt)*lt,Pt=bt+(ht-bt)*lt,kt=-(ht-bt),zt=ft-gt;const Rt=Math.sqrt(Math.pow(gt-ft,2)+Math.pow(bt-ht,2));kt=-2*kt/Rt,zt=-2*zt/Rt;const Yt=Math.acos(kt/Math.sqrt(kt*kt+zt*zt));j>0&&(Yt<j||Yt>Math.PI-j&&Yt<=Math.PI?(kt=2*Math.cos(Math.PI-j),zt=2*Math.sin(Math.PI-j)):(Yt>2*Math.PI-j||Yt>=Math.PI&&Yt<Math.PI+j)&&(kt=2*Math.cos(j),zt=2*Math.sin(j)));let ne=0,ae=1;tt.sort((We,Es)=>X[Es]-X[We]);let Te=0,Xe=0;const _s=Math.max(X[tt[0]],X[tt[1]])/2;tt.length%2==1&&(ne=1,yt-=kt*_s,Pt-=zt*_s);const Ze=1+O;for(let We=0;We<tt.length;We++){const Es=(ne+We)%2,ke=tt[We],ms=We>=2?X[ke]:_s,ys=(Es?Te:Xe)+ms;V[ke]=yt+kt*ae*ys,B[ke]=Pt+zt*ae*ys,Es?Te+=ms*Ze:Xe+=ms*Ze,ae=-ae}})}function as(T){let F=0,L=0;for(const B of T)F+=B.w*B.h,L=Math.max(L,B.w);T.sort((B,X)=>X.h-B.h);const N=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(F/.95)),L),h:1/0}];let z=0,V=0;for(const B of T)for(let X=N.length-1;X>=0;X--){const j=N[X];if(!(B.w>j.w||B.h>j.h)){if(B.x=j.x,B.y=j.y,V=Math.max(V,B.y+B.h),z=Math.max(z,B.x+B.w),B.w===j.w&&B.h===j.h){const O=N.pop();X<N.length&&(N[X]=O)}else B.h===j.h?(j.x+=B.w,j.w-=B.w):B.w===j.w?(j.y+=B.h,j.h-=B.h):(N.push({x:j.x+B.w,y:j.y,w:j.w-B.w,h:B.h}),j.y+=B.h,j.h-=B.h);break}}}function De(T,F=1){return as(T.map(L=>(L.w+=L.maxr+F,L.h+=L.maxr+F,L)).sort((L,N)=>L.w*L.h-N.w*N.h))}r(ie,"LayoutData"),r(Me,"unorderedPair"),r(Ne,"orderedPair"),r($e,"alignSiblings"),r(as,"potpack"),r(De,"boxpack");var qe=class{constructor(){this.ids=[],this.xmin=1/0,this.ymin=1/0,this.xmax=-1/0,this.ymax=-1/0,this.x=0,this.y=0,this.w=0,this.h=0,this.cx=0,this.cy=0,this.radius=0,this.mx=0,this.my=0,this.m=0,this.maxr=0}add(T,F,L,N){this.ids.push(T),F-N<this.xmin&&(this.xmin=F-N),L-N<this.ymin&&(this.ymin=L-N),F+N>this.xmax&&(this.xmax=F+N),L+N>this.ymax&&(this.ymax=L+N),N>this.maxr&&(this.maxr=N),this.mx+=N*F,this.my+=N*L,this.m+=N}measure(T=0){return this.w=this.xmax-this.xmin+2*T,this.h=this.ymax-this.ymin+2*T,this.cx=this.mx/this.m,this.cy=this.my/this.m,this.x=this.xmin,this.y=this.ymin,this.radius=Math.sqrt(this.w*this.w+this.h*this.h)/2,this}};function gs(T,F=20,L,N,z){for(const K of T){const{x:tt,y:gt,r:bt}=Kt(K.ids,ft=>L[ft],ft=>N[ft],ft=>z[ft]);K.cx=tt,K.cy=gt,K.radius=bt+F}const V=T.slice().sort((K,tt)=>K.radius-tt.radius),B=V.map(K=>({x:K.cx,y:K.cy,r:K.radius})),X=V.pop();let j=3*Math.PI/2,O=X.radius;const U=2*Math.PI,{cx:Z,cy:J}=X,rt=[X];for(;V.length!==0;){const K=V[V.length-1],tt=O+K.radius,gt=Z+Math.cos(j)*tt,bt=J+Math.sin(j)*tt;rt.some(ft=>{const ht=ft.cx-gt,vt=ft.cy-bt;return Math.sqrt(ht*ht+vt*vt)<ft.radius+K.radius})?O+=1:(K.x=gt-K.w/2,K.y=bt-K.h/2,K.cx=gt,K.cy=bt,B[V.length-1].x=gt,B[V.length-1].y=bt,rt.push(V.pop()),j+=(2*K.radius+1)/tt*1%U)}}function Us(T,F,L,N){let z=0;const V=[];for(const B of N){const X=new qe;for(const j of B)X.add(j,T[j],F[j],L[j]);V.push(X.measure()),B.length>V[z].ids.length&&(z=V.length-1)}return{boxes:V,biggest:z}}function me(T,F,{X:L,Y:N,R:z,components:V,pinned:B,degrees:X,sources:j,targets:O,edgeIds:U},{update:Z,onUpdate:J,placement:rt,placementOffset:K,alignSiblings:tt,siblingsMinAngle:gt,siblingsOffset:bt}){if(tt&&($e({X:L,Y:N,R:z,degrees:X,pinned:B,sources:j,targets:O,edgeIds:U},gt,bt),Z(T,L,N)),rt){const{boxes:ft,biggest:ht}=Us(L,N,z,V);if(rt==="spiral")gs(ft,K,L,N,z);else{if(rt!=="box")return;De(ft,K)}const vt=ft[ht].xmin-ft[ht].x,lt=ft[ht].ymin-ft[ht].y;for(const yt of ft){const{xmin:Pt,ymin:kt,x:zt,y:Rt,ids:Yt}=yt,ne=Pt-zt-vt,ae=kt-Rt-lt;for(const Te of Yt)L[Te]-=ne,N[Te]-=ae}Z(T,L,N),J()}}r(qe,"Component"),r(gs,"spiralpack"),r(Us,"groupAndMeasure"),r(me,"postprocessing");var He=(T=>(T[T.verlet=0]="verlet",T[T.euler=1]="euler",T))(He||{}),Ye=0,C=typeof window>"u",D=typeof performance<"u"&&performance.now?performance:Date,G=C?T=>{const F=D.now(),L=Math.max(0,16-(F-Ye)),N=setTimeout(()=>T(F+L),L);return Ye=F+L,N}:window.requestAnimationFrame,R=C?T=>clearTimeout(T):window.cancelAnimationFrame;function Q(T,F,L){for(let N=0;N<T.length;N++){const z=T[N];z.x=F[N],z.y=L[N]}}r(Q,"defaultUpdate");var xt=r(()=>{},"noop"),Ft={movementRatio:7e-8,surfaceRatio:.0025},It=class{constructor(T={}){this.onUpdate=r(F=>{},"onUpdate"),this.update=Q,this.nextTick=G,this.cancelTick=R,this.onEnd=xt,this.charge=10,this.maxIterations=200,this.minMovement=.1,this.edgeLength=30,this.edgeStrength=3,this.friction=.1,this.elasticity=.9,this.margin=1,this.cx=void 0,this.cy=void 0,this.gravity=.01,this.theta=.34,this.batch=void 0,this.inertia=.9,this.integrator=0,this.multilevel=!1,this.placement="none",this.placementOffset=10,this.alignSiblings=!1,this.bucketSize=void 0,this.maxDisplacement=1e3,this.siblingsMinAngle=0,this.siblingsOffset=.15,this.steps=200,this.scaling=1,this.defaultRadius=1,this.autoStop=Ft,this.gpuAcceleration=!0,this.barnesHutOptimization=!0,"autoStop"in T?T.autoStop&&(typeof T.autoStop=="boolean"?T.autoStop=Ft:T.autoStop=ct(ct({},T.autoStop),Ft)):T.steps;for(const F in T)T[F]===void 0&&F!=="order"&&F!=="depth"||(this[F]=T[F])}};function Ct(T,F,{X:L,Y:N,R:z,degrees:V,nodeIds:B,edgeIds:X,layers:j,layer:O,cluster:U,masses:Z,weights:J,sources:rt,targets:K},{cx:tt,cy:gt,nextTick:bt,cancelTick:ft,update:ht,onUpdate:vt,batch:lt,maxIterations:yt,steps:Pt,minMovement:kt},zt,Rt){const Yt=j.slice();lt=lt??1;let ne,ae=0;function Te(){ft(ne),ht(T,L,N),vt(),Rt(ae)}r(Te,"stop");const Xe={};for(let ts=0;ts<F.length;ts++)Xe[Number(F[ts].id)||ts]=ts;const _s=new Map;for(let ts=0;ts<X.length;ts++){const Gs=X[ts];_s.set(Ne(rt[Gs],K[Gs]),Gs)}for(let ts=0;ts<j.length;ts++){const Gs=j[ts],_i=ts;for(let Fs=0;Fs<Gs.length;Fs++){const Ge=Gs[Fs],Be=U[Ge];Be!==-1&&(Z[Be]+=Z[Ge])}for(let Fs=0;Fs<F.length;Fs++){const Ge=F[Fs],Be=Number(Ge.id)||Fs,Vs=Ge.source,Vi=Ge.target,uo=J[Xe[Be]];if(O[Vs]===_i&&O[Vi]===_i){const Nu=U[Vs],Fu=U[Vi];if(Nu!==Fu){const Pu=_s.get(Ne(Nu,Fu));Pu!==void 0&&(J[Pu]+=uo)}}}}B.length=0,X.length=0,yt=1/0;let Ze=1;const We=1-Math.pow(.1,1/Pt/2),Es=(Ze-.1)/Pt;let ke,ms,ys=.5;function xl(){Ze+=(0-Ze)*We;const ts=zt(Ze,B,X);let Gs=Ze<=ys||ts<kt;if(ae===0||Gs){const _i=Yt.pop();if(_i){ke&&(ms=ke.reduce((Ge,Be)=>Math.max(Ge,tt-L[Be],gt-N[Be]),0)),B.push.apply(B,_i);for(let Ge=0;Ge<_i.length;Ge++){const Be=_i[Ge],Vs=U[Be];if(Vs!==-1){const Vi=V[Be]>1?2:1,uo=z[Vs]+z[Be];Z[Vs]-=Z[Be],L[Be]=L[Vs]+Vi*uo*(2*h()-1),N[Be]=N[Vs]+Vi*uo*(2*h()-1)}else ke&&(L[Be]=tt+2*ms*(1-2*h()),N[Be]=gt+2*ms*(1-2*h()))}ke=_i;const Fs=B.reduce((Ge,Be)=>(Ge[Be]=!0,Ge),{});X.length=0;for(let Ge=0;Ge<F.length;Ge++){const{source:Be,target:Vs,id:Vi}=F[Ge];Fs[Be]&&Fs[Vs]&&X.push(Xe[Number(Vi)])}Gs=!1,Yt.length===0?(Ze=.2,ys=.1):(Ze=.1+2*Es,ys=.1)}}ae%lt==0&&(ht(T,L,N),vt()),++ae>=yt||Gs?Te():ne=bt(xl)}return r(xl,"simulationStep"),{done:!1,start(){return ne=setTimeout(xl),this},stop(){return Te(),this},get iterations(){return ae}}}r(It,"Settings"),r(Ct,"multiLevel");var Ot=class{constructor(T){this.promise=new Promise(T)}then(T){return this.promise.then(T)}stop(){return this.simulation.stop(),this}get iterations(){return this.simulation.iterations()}};function jt(T,F,{X:L,Y:N,nodeIds:z,edgeIds:V,layers:B,movements:X,movementsPrev:j,surfaces:O,surfacesPrev:U},Z,J,rt){var K;const{nextTick:tt,cancelTick:gt,steps:bt,minMovement:ft,update:ht,onUpdate:vt,autoStop:lt}=Z,yt=(K=Z.batch)!=null?K:1;let Pt=0,kt=1,zt,Rt=1-Math.pow(.05,1/bt),Yt=!1;const ne=r(()=>{Yt=!0,gt(zt),vt(),rt(Pt)},"stop");let ae=!1;const Te=r(()=>{kt+=(.001-kt)*Rt;const Xe=J(kt,z,V),_s=B.length;let Ze=!1,We=!1;if(lt){Ze=We=!0;const{movementRatio:ke,surfaceRatio:ms}=lt;for(let ys=0;ys<_s;ys++)Ze&&Math.abs(1-O[ys]/U[ys])>ms&&(Ze=!1),We&&Math.abs(X[ys]-j[ys])>ke&&(We=!1)}Ze&&We&&!ae&&(Rt=1-Math.pow(.001,1/Math.max(10,Pt)),ae=!0);const Es=Yt||kt<.05||Xe!==0&&Xe<=ft;if(Pt%yt==0&&(ht(T,L,N),vt()),++Pt>=bt||Es)return ne();for(let ke=0;ke<_s;ke++)j[ke]=X[ke],U[ke]=O[ke];zt=tt(Te)},"simulationStep");return{done:!1,start(){return zt=setTimeout(Te),this},stop(){return ne(),this},get iterations(){return Pt}}}r(Ot,"SimulationPromise"),r(jt,"singleLevel");var Xt,Ut={euler:we,verlet:Pe,leapfrog:ye};function Vt(T,F={}){let L,N;const z=r((J={nodes:[],edges:[]})=>(L=J.nodes,N=J.edges,u(Ne(L.length,N.length)),new ie(J,!0)),"setGraph"),V=r((J={})=>new It(J),"setOptions");let B=z(T),X=V(F);_(N,B),ee(L,B,X),be(L,B,X),f(L,B,X);const j=Ut[X.integrator]||Pe;let O=null;const U=r((J,rt,K)=>(O&&(O.destroy(),O=null),rt.length<=1?0:(X.barnesHutOptimization?O=re(J,rt,O,B):Ce(J,rt,B,X),g(J,K,B,X),O&&X.elasticity!==0&&dt(0,rt,O,B,X),m(J,rt,B,X),j(rt,X.inertia,B,X))),"step");let Z;return{setOptions:(J={})=>(X=V(J),this),setGraph:({nodes:J,edges:rt})=>(B=z(T),_(rt,B),ee(J,B,X),be(J,B,X),f(J,B,X),this),start(){return Z=(X.multilevel?Ct:jt)(L,N,B,X,U,J=>{Z.done||me(L,0,B,X),X.onEnd(J),Z.done=!0}).start(),this},iterations:()=>Z.iterations,data:()=>B,stop(){return Z&&Z.stop(),this},step(J=1){return U(J,B.nodeIds,B.edgeIds),X.update(L,B.X,B.Y),this}}}return r(Vt,"force"),Vt.run=(T,F)=>{let L;const N=new Ot(z=>{F.onEnd=z,L=Vt(T,F).start()});return N.simulation=L,N.stop=()=>(L.stop(),N),N},Xt=o,((T,F,L,N)=>{if(F&&typeof F=="object"||typeof F=="function")for(let z of i(F))n.call(T,z)||z===L||e(T,z,{get:()=>F[z],enumerable:!(N=s(F,z))||N.enumerable});return T})(e({},"__esModule",{value:!0}),Xt)})();return t.default.apply(this,arguments)}Dt(y_,"SimulationPromise"),Dt(ma,"gpuLayout"),ma.run=(t,e,s)=>{let i;const n=new y_(r=>{s.onEnd=r,i=ma(t,e,s).start()});return n.simulation=i,n.stop=()=>(i.stop(),n),n};var e2=2,s2=1.25,b_={name:"force",imports:{force:x_},configure(t,{graph:e,events:s}){const i=t.nodes._indexes,n=e.getNodeAttribute("x").getMultiple(i),r=e.getNodeAttribute("y").getMultiple(i),o=e.getNodeAttribute("radius").getMultiple(i),a=e.getNodeAttribute("layoutable").getMultiple(i),l=t.edges,d=[],h=[],u={};t.edgeStrength===void 0&&(t.edgeStrength=.5),t.gpu&&(t.edgeStrength/=e2),t.gravity==null&&(t.gravity=.01),t.siblingsOffset==null&&(t.siblingsOffset=0),t.theta==null&&(t.theta=.62),t.autoStop=!!t.autoStop,t.alignSiblings=!!t.alignSiblings;const c=t.radiusRatio||s2;for(let _=0;_<t.nodes._indexes.length;_++){const m=t.nodes._indexes[_];u[m]=_,d.push({id:_,x:n[_],y:r[_],r:o[_]*c,pinned:!a[_]})}l.forEach(_=>{const m=u[_.getSource()._index],f=u[_.getTarget()._index];m!==f&&m!==void 0&&f!==void 0&&h.push({source:m,target:f})});const g=Ka(ct({},t));return delete g.nodes,delete g.edges,{graph:{nodes:d,edges:h},options:g,indexes:t.nodes._indexes,done:!1,x:n,y:r,chunkPeriod:250}},update:function(t,e){if(!e.simulation&&t){let s;e.done=!1,e.graph=t.graph,e.options=t.options,e.indexes=t.indexes;let i=!1;if(t.options.gpu){const l=Dm("webgl2",{},()=>{Mi("GPU layout: WebGL context not available. Falling back on CPU."),e.simulation=void 0,e.options.gpu=!1,e.cleanUp&&e.cleanUp(),this._update(t,e)});l&&(s=l.context,e.cleanUp=l.cleanUp),i=!!s}let n=Date.now();i||(t.options.nextTick=l=>Date.now()-n<=e.chunkPeriod?l():(n=Date.now(),setTimeout(l,0))),t.options.update=(l,d,h)=>{e.x=d,e.y=h},t.options.onEnd=()=>{if(i&&s){const{X:l,Y:d}=e.simulation.data(!0);e.x=l,e.y=d}e.done=!0,e.simulation=void 0,e.cleanUp&&e.cleanUp()},t.options.bucketSize=0;const r=i&&s?ma(t.graph,s,t.options).start():x_(t.graph,t.options).start();e.simulation=r;const{X:o,Y:a}=i&&s?{X:new Float32Array(t.graph.nodes.length),Y:new Float32Array(t.graph.nodes.length)}:r.data();e.x=o,e.y=a}return{graph:e.graph,indexes:e.indexes,x:e.x,y:e.y}},context:function(){return{done:!1,graph:{nodes:[],edges:[]},x:null,y:null,indexes:null,chunkPeriod:250}},stop:function(t){t.done=!0,t.simulation&&(t.simulation.stop(),delete t.simulation)},isRunning:function(t){return!t.done||(t.done=!1,!1)},onSync:function({indexes:t,x:e,y:s}){return{indexes:t,x:e,y:s}}};function i2(t,e,s,i,n){return{x:t+n*(s-t),y:e+n*(i-e)}}var n2=10;function r2(t,e,s){let i,n,r=1/0;for(let o=0,a=e.length;o<a;o++){const l=e[o],d=e[(o+1)%a],h=ru(t[0],t[1],l[0],l[1],d[0],d[1]);h<r&&(r=h,i=l,n=d)}return o2(t[0],t[1],i[0],i[1],n[0],n[1],s)}function o2(t,e,s,i,n,r,o){const a=Ep(t,e,s,i,n,r);let l=-(i-r),d=s-n;const h=Math.sqrt(l*l+d*d);return l/=h,d/=h,[a.x-o*l,a.y-o*d]}function a2(t,e,s,i){for(let n=0;n<t.length;n++){const[r,o]=t[n],a=Math.abs(r-e),l=Math.abs(o-s);if(a+l<=i||!(a>i||l>i)&&a*a+l*l<=i*i)return!0}return!1}function l2(t,e,s){const i=bp(s.cx,s.cy,t,e,s.minX,s.minY,s.maxX,s.maxY);let n,r=1/0,o={x:s.maxX,y:e};for(const a of i)n=Oe(t,e,a.x,a.y),n<r&&(r=n,o=a);return o}function d2(t){const e=t.bottomLeft(),s=t.topRight();return[[e.x,e.y],[e.x,s.y],[s.x,s.y],[s.x,e.y]]}function h2(t,e,s,i){const n=[],r=[],o=[];return t.forEach((a,l)=>{i[l]&&(n.push(a),r.push(e[l]),o.push(s[l]))}),{ids:n,subgraphPositions:r,radii:o}}function u2(t,e,s){const{duration:i=0,margin:n=5,referenceNodes:r,nodes:o}=e,{ids:a,subgraphPositions:l,radii:d}=h2(o.getId(),s,o.getAttribute("radius"),o.getAttribute("layoutable")),h=t.getNodes(a);let u=r;!u||u instanceof ui||(u=t.getNodes(u));const c=u||h.inverse(),g=c.getPosition().map(A=>[A.x,A.y]),_=h.getBoundingBox(),m=c.getBoundingBox();m.pad(m.maxScaledSize);const f={layoutName:"incremental",ids:h.getId(),positions:{before:l,current:l}};if(!h.size)return Promise.resolve(f);const p=el(l.map(A=>A.x),l.map(A=>A.y),d),[y,b]=p,x=p[2]+m.maxScaledSize+n;let v,E=0,w=0;if(a2(g,y,b,x))if(c.size<=3){if(qh(y,b,p[2],m.minX,m.minY,m.maxX,m.maxY)){const A=l2(y,b,m);v=Oe(m.cx,m.cy,A.x,A.y);const I=i2(m.cx,m.cy,A.x,A.y,(v+x)/v);E=I.x-y,w=I.y-b}}else{const A=Ih.from(g,H=>H[0],H=>H[1]),I=Rr(A.triangles,g),M=g.length>3?Rr(A.hull,g):d2(m),k=Km(c.getPosition(),n2,x,I,M);let W=r2([y,b],M,x);if(k.length>0){let H=Math.pow(y-W[0],2)+Math.pow(b-W[1],2);for(const $ of k)E=y-$[0],w=b-$[1],v=E*E+w*w,v<H&&(H=v,W=$.slice(0,2));E=W[0]-y,w=W[1]-b}else E=W[0]-_.cx,w=W[1]-_.cy}if(E||w){const A=l.map(I=>(I.x+=E,I.y+=w,I));if(e.locate){typeof e.locate=="boolean"&&(e.locate={});const I=t.modules.locate.layoutDataBoundingBox({x:[...g.map(k=>k[0]),...A.map(k=>k.x)],y:[...g.map(k=>k[1]),...A.map(k=>k.y)],indexes:t.getNodes()._indexes}),M=t.modules.locate.computeConfigForBounds(I,e.locate);t.modules.camera.setView(M,{duration:i,easing:e.locate.easing,ignoreZoomLimits:!0})}return f.positions.current=A,h.setAttributes(A,i).then(()=>f)}return h.setAttributes(l,i).then(()=>f)}function c2(t,e,s){const i=Ie(e);return i.duration=0,i.dryRun=!0,i.locate=!1,delete i.incremental,s(i).then(n=>u2(t,e,n.positions.current))}function g2(t,e,s){const{nodes:i,duration:n,centralNode:r}=e,o=i,a=o.reduce((d,h)=>(d[h._index]=!0,d),{}),l=t.getNodes();if(e.focusOnGroupShape)return s({nodes:o,duration:0}).then(()=>{const d=o.concat(r),h=d.getAttribute("layoutable");return d.setAttributes({layoutable:!1}),s({nodes:t.getNodes(),duration:n}).then(()=>d.setAttributes(h))});{const d=Ie(e);return delete d.centralNode,d.incremental=!1,d.nodes=l,d.nodeMass=(h,u)=>(u+1)*(a[h._index]?1:2),s(d)}}function Fx(t,e,s){const i=ox(e.modules.graph,t);if(typeof i.incremental!="boolean"&&"margin"in i.incremental&&!isFinite(i.incremental.margin))throw new Error("Incremental layout: margin has to be a positive number");const n=Ie(i);return typeof i.incremental!="boolean"&&(n.margin=i.incremental.margin,n.referenceNodes=i.incremental.referenceNodes),n.centralNode&&!n.centralNode.getAttribute("layoutable")?g2(e,n,s):c2(e,n,s)}var _2=t=>(t.modules.layouts.register(b_),(e={})=>{if(e.incremental)return Fx(e,t,t.layouts.force);if(e.edgeStrength!==void 0&&(!isFinite(e.edgeStrength)||e.edgeStrength<0))throw new Error("force layout: edgeStrength must be a positive number");if(e.steps!==void 0&&(!isFinite(e.steps)||e.steps<=0))throw new Error("force layout: 'steps' must be a positive integer");if(e.edgeLength!==void 0&&(!isFinite(e.edgeLength)||e.edgeLength<=0))throw new Error("force layout: 'edgeLength' must be positive");if(e.gravity!==void 0&&(!isFinite(e.gravity)||e.gravity<0||e.gravity>=1))throw new Error("force layout: 'gravity' must be between 0 and 1");if(e.charge!==void 0&&!isFinite(e.charge))throw new Error("force layout: 'charge' must be a number");if(e.radiusRatio!==void 0&&(!isFinite(e.radiusRatio)||e.radiusRatio<0))throw new Error("force layout: 'radiusRatio' must be a positive number");if(e.theta!==void 0&&(!isFinite(e.theta)||e.theta<0||e.theta>1))throw new Error("force layout: 'theta' must be between 0 and 1");if(!(e.cx===void 0&&e.cy===void 0||typeof e.cx=="number"&&typeof e.cy=="number"))throw new Error("force layout: both 'cx' and 'cy' must be numbers");if(e.siblingsOffset!==void 0&&!isFinite(e.siblingsOffset))throw new Error("force layout: 'siblingsOffset' must be a number");return e.gpu=!!e.gpu,e.gpu&&(e.useWebWorker=!1),t.modules.layouts.start(b_.name,e)}),v_={name:"forceLink",configure:function(t,{graph:e,camera:s,graphics:i}){const n=t.nodes._indexes,r=t.edges._indexes,o={},a={},l=n.length,d=r.length;let h;var u=e.getObjectList(!0),c=e.getObjectList(!1);(t.nodes||t.edges)&&(delete(t=Ie(t)).nodes,delete t.edges);const g=e.getNodeAttribute("innerStroke.width").getMultiple(n),_=e.getNodeAttribute("outerStroke.width").getMultiple(n),m=e.degrees(n),f=e.getNodeAttribute("x").getMultiple(n),p=e.getNodeAttribute("y").getMultiple(n),y=e.getNodeAttribute("radius").getMultiple(n),b=e.nodeList(n).getAttribute("layoutable"),x=typeof t.nodeMass=="function"?t.nodeMass:function(P,S,Y){return S+1};delete t.nodeMass;const v=typeof t.edgeWeight=="function"?t.edgeWeight:function(P){return 1};delete t.edgeWeight,isFinite(t.scalingRatio)||delete t.scalingRatio;const E=n.reduce((P,S,Y)=>(b[Y]||(P[S]=!0),P),{});let w=0,A=0,I=0;const M=s.getZoom();for(h=0;h<n.length;++h){const P=n[h],S=f[h],Y=p[h],st=y[h]+(g[h]+_[h])/M;o[P]={id:P,x:S,y:Y,degree:m[h],size:st,pinned:!!E[P],mass:x(u.get(P),m[h],h)},I=Math.max(st,I)}if(l>1)for(h=0;h<l;h++){const P=o[n[h]];w+=P.x,A+=P.y}w/=l,A/=l;const k={x:w,y:A},W=e.edgeList(r),H=W.getSource()._indexes,$=W.getTarget()._indexes;for(h=0;h<d;h++){const P=r[h],S=H[h],Y=$[h];o[S]&&o[Y]&&(a[P]={source:S,target:Y},a[P].weight=v(c.get(P)))}return{nodes:o,edges:a,maxSize:I,config:Ka(t),barycentre:k}},context:function(){return{chunkPeriod:250}},update:function(t,e){let s;!e.W&&t?(s={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:!1,settings:{linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:!0,gravity:1,slowDown:1,barnesHutOptimize:!1,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:!0,alignNodeSiblings:!0,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}},e.W=s,function(P,S){const Y=function(at,Tt){let ut,Mt,Nt,_t=at.nodes,St=at.edges,Zt=at.maxSize,Qt=Object.keys(at.nodes),Kt=Object.keys(at.edges),mt=Qt.length*s.ppn,pt=Kt.length*s.ppe,ue={};const Jt=Math.pow(10,Math.log(Math.max(Zt,1))-6),ce=Jt/2,oe=Math.random,q=Tt.randomizeFactor||1;let et;et=Tt.randomize==="locally"?nt=>nt+oe()*q:Tt.randomize==="globally"?nt=>oe()*q:nt=>nt+oe()*Jt-ce;const dt=new Float32Array(mt),ot=new Float32Array(pt);for(ut=Mt=0,Nt=Qt.length;ut<Nt;ut++){const nt=Qt[ut],it=_t[nt];let wt=it.x,At=it.y;it.pinned||(wt=et(wt),At=et(At)),ue[nt]=Mt,dt[Mt]=wt,dt[Mt+1]=At,dt[Mt+2]=0,dt[Mt+3]=0,dt[Mt+4]=0,dt[Mt+5]=0,dt[Mt+6]=it.mass,dt[Mt+7]=1,dt[Mt+8]=it.size,dt[Mt+9]=it.pinned||0,Mt+=s.ppn}for(ut=Mt=0,Nt=Kt.length;ut<Nt;ut++){const nt=St[Kt[ut]];ot[Mt]=ue[nt.source],ot[Mt+1]=ue[nt.target],ot[Mt+2]=nt.weight||0,Mt+=s.ppe}return{nodes:dt,edges:ot}}(P,S);e.NodeMatrix=Y.nodes,e.EdgeMatrix=Y.edges,s.nodesLength=e.NodeMatrix.length,s.edgesLength=e.EdgeMatrix.length}(t,t.config),s.settings=function(P,S){for(const Y in P)S[Y]=P[Y];return S}(t.config,s.settings),e.nodes=t.nodes,e.edges=t.edges,e.barycentre=t.barycentre):s=e.W;let i,n=e.NodeMatrix,r=e.EdgeMatrix;const o=0,a=1,l=2,d=3,h=4,u=5,c=6,g=7,_=8,m=9,f=0,p=1,y=2,b=0,x=1,v=2,E=3,w=4,A=5,I=6,M=7,k=8;function W(){let $,P,S,Y,st,at,Tt,ut,Mt,Nt,_t,St,Zt,Qt,Kt,mt,pt;for(S=0;S<s.nodesLength;S+=s.ppn)n[S+h]=n[S+l],n[S+u]=n[S+d],n[S+l]=0,n[S+d]=0;if(s.settings.outboundAttractionDistribution){for(Mt=0,S=0;S<s.nodesLength;S+=s.ppn)Mt+=n[S+c];Mt/=s.nodesLength}if(s.settings.barnesHutOptimize){let et,dt,ot,nt,it=1/0,wt=-1/0,At=1/0,Et=-1/0;for(i=[],S=0;S<s.nodesLength;S+=s.ppn)it=Math.min(it,n[S+o]),wt=Math.max(wt,n[S+o]),At=Math.min(At,n[S+a]),Et=Math.max(Et,n[S+a]);const Ht=wt-it,Gt=Et-At;for(Ht>Gt?(At-=(Ht-Gt)/2,Et=At+Ht):(it-=(Gt-Ht)/2,wt=it+Gt),i[0+b]=-1,i[0+x]=(it+wt)/2,i[0+v]=(At+Et)/2,i[0+E]=Math.max(wt-it,Et-At),i[0+w]=-1,i[0+A]=-1,i[0+I]=0,i[0+M]=0,i[0+k]=0,$=1,S=0;S<s.nodesLength;S+=s.ppn)for(P=0,ot=s.MAX_SUBDIVISION_RETRIES;;){if(!(i[P+A]>=0)){if(i[P+b]<0){i[P+b]=S;break}if(i[P+A]=$*s.ppr,Tt=i[P+E]/2,ut=i[P+A],i[ut+b]=-1,i[ut+x]=i[P+x]-Tt,i[ut+v]=i[P+v]-Tt,i[ut+E]=Tt,i[ut+w]=ut+s.ppr,i[ut+A]=-1,i[ut+I]=0,i[ut+M]=0,i[ut+k]=0,ut+=s.ppr,i[ut+b]=-1,i[ut+x]=i[P+x]-Tt,i[ut+v]=i[P+v]+Tt,i[ut+E]=Tt,i[ut+w]=ut+s.ppr,i[ut+A]=-1,i[ut+I]=0,i[ut+M]=0,i[ut+k]=0,ut+=s.ppr,i[ut+b]=-1,i[ut+x]=i[P+x]+Tt,i[ut+v]=i[P+v]-Tt,i[ut+E]=Tt,i[ut+w]=ut+s.ppr,i[ut+A]=-1,i[ut+I]=0,i[ut+M]=0,i[ut+k]=0,ut+=s.ppr,i[ut+b]=-1,i[ut+x]=i[P+x]+Tt,i[ut+v]=i[P+v]+Tt,i[ut+E]=Tt,i[ut+w]=i[P+w],i[ut+A]=-1,i[ut+I]=0,i[ut+M]=0,i[ut+k]=0,$+=4,nt=P+b,et=n[i[nt]+o]<i[P+x]?n[i[nt]+a]<i[P+v]?i[P+A]:i[P+A]+s.ppr:n[i[nt]+a]<i[P+v]?i[P+A]+2*s.ppr:i[P+A]+3*s.ppr,i[P+I]=n[i[nt]+c],i[P+M]=n[i[nt]+o],i[P+k]=n[i[nt]+a],i[et+b]=i[P+b],i[P+b]=-1,dt=n[S+o]<i[P+x]?n[S+a]<i[P+v]?i[P+A]:i[P+A]+s.ppr:n[S+a]<i[P+v]?i[P+A]+2*s.ppr:i[P+A]+3*s.ppr,et===dt){if(ot--){P=et;continue}ot=s.MAX_SUBDIVISION_RETRIES;break}i[dt+b]=S;break}et=n[S+o]<i[P+x]?n[S+a]<i[P+v]?i[P+A]:i[P+A]+s.ppr:n[S+a]<i[P+v]?i[P+A]+2*s.ppr:i[P+A]+3*s.ppr,i[P+M]=(i[P+M]*i[P+I]+n[S+o]*n[S+c])/(i[P+I]+n[S+c]),i[P+k]=(i[P+k]*i[P+I]+n[S+a]*n[S+c])/(i[P+I]+n[S+c]),i[P+I]+=n[S+c],P=et}}if(s.settings.barnesHutOptimize)for(Nt=s.settings.scalingRatio,S=0;S<s.nodesLength;S+=s.ppn)for(P=0;;)if(i[P+A]>=0){if(mt=Math.sqrt((n[S+o]-i[P+M])*(n[S+o]-i[P+M])+(n[S+a]-i[P+k])*(n[S+a]-i[P+k])),2*i[P+E]/mt<s.settings.barnesHutTheta){if(_t=n[S+o]-i[P+M],St=n[S+a]-i[P+k],s.settings.adjustSizes?mt>0?(pt=Nt*n[S+c]*i[P+I]/mt/mt,n[S+l]+=_t*pt,n[S+d]+=St*pt):mt<0&&(pt=-Nt*n[S+c]*i[P+I]/mt,n[S+l]+=_t*pt,n[S+d]+=St*pt):mt>0&&(pt=Nt*n[S+c]*i[P+I]/mt/mt,n[S+l]+=_t*pt,n[S+d]+=St*pt),i[P+w]<0)break;P=i[P+w];continue}P=i[P+A]}else{if(i[P+b]>=0&&i[P+b]!==S&&(_t=n[S+o]-n[i[P+0]+o],St=n[S+a]-n[i[P+0]+a],mt=Math.sqrt(_t*_t+St*St),s.settings.adjustSizes?mt>0?(pt=Nt*n[S+c]*n[i[P+0]+c]/mt/mt,n[S+l]+=_t*pt,n[S+d]+=St*pt):mt<0&&(pt=-Nt*n[S+c]*n[i[P+0]+c]/mt,n[S+l]+=_t*pt,n[S+d]+=St*pt):mt>0&&(pt=Nt*n[S+c]*n[i[P+0]+c]/mt/mt,n[S+l]+=_t*pt,n[S+d]+=St*pt)),i[P+w]<0)break;P=i[P+w]}else for(Nt=s.settings.scalingRatio,Y=0;Y<s.nodesLength;Y+=s.ppn)for(st=0;st<Y;st+=s.ppn)_t=n[Y+o]-n[st+o],St=n[Y+a]-n[st+a],s.settings.adjustSizes?(mt=Math.sqrt(_t*_t+St*St)-n[Y+_]-n[st+_],mt>0?(pt=Nt*n[Y+c]*n[st+c]/mt/mt,n[Y+l]+=_t*pt,n[Y+d]+=St*pt,n[st+l]+=_t*pt,n[st+d]+=St*pt):mt<0&&(pt=100*Nt*n[Y+c]*n[st+c],n[Y+l]+=_t*pt,n[Y+d]+=St*pt,n[st+l]-=_t*pt,n[st+d]-=St*pt)):(mt=Math.sqrt(_t*_t+St*St),mt>0&&(pt=Nt*n[Y+c]*n[st+c]/mt/mt,n[Y+l]+=_t*pt,n[Y+d]+=St*pt,n[st+l]-=_t*pt,n[st+d]-=St*pt));for(ut=s.settings.gravity/s.settings.scalingRatio,Nt=s.settings.scalingRatio,S=0;S<s.nodesLength;S+=s.ppn)pt=0,_t=n[S+o],St=n[S+a],mt=Math.sqrt(_t*_t+St*St),s.settings.strongGravityMode?mt>0&&(pt=Nt*n[S+c]*ut):mt>0&&(pt=Nt*n[S+c]*ut/mt),n[S+l]-=_t*pt,n[S+d]-=St*pt;for(Nt=1*(s.settings.outboundAttractionDistribution?Mt:1),at=0;at<s.edgesLength;at+=s.ppe)Y=r[at+f],st=r[at+p],Tt=r[at+y],Kt=Math.pow(Tt,s.settings.edgeWeightInfluence),_t=n[Y+o]-n[st+o],St=n[Y+a]-n[st+a],s.settings.adjustSizes?(mt=Math.sqrt(_t*_t+St*St)-n[Y+_]-n[st+_],s.settings.linLogMode?s.settings.outboundAttractionDistribution?mt>0&&(pt=-Nt*Kt*Math.log(1+mt)/mt/n[Y+c]):mt>0&&(pt=-Nt*Kt*Math.log(1+mt)/mt):s.settings.outboundAttractionDistribution?mt>0&&(pt=-Nt*Kt/n[Y+c]):mt>0&&(pt=-Nt*Kt)):(mt=Math.sqrt(_t*_t+St*St),s.settings.linLogMode?s.settings.outboundAttractionDistribution?mt>0&&(pt=-Nt*Kt*Math.log(1+mt)/mt/n[Y+c]):mt>0&&(pt=-Nt*Kt*Math.log(1+mt)/mt):s.settings.outboundAttractionDistribution?(mt=1,pt=-Nt*Kt/n[Y+c]):(mt=1,pt=-Nt*Kt)),mt>0&&(n[Y+l]+=_t*pt,n[Y+d]+=St*pt,n[st+l]-=_t*pt,n[st+d]-=St*pt);let ue,Jt,ce,oe,q=0;if(s.settings.adjustSizes)for(S=0;S<s.nodesLength;S+=s.ppn)n[S+m]||(ue=Math.sqrt(n[S+l]*n[S+l]+n[S+d]*n[S+d]),ue>s.maxForce&&(n[S+l]=n[S+l]*s.maxForce/ue,n[S+d]=n[S+d]*s.maxForce/ue),Jt=n[S+c]*Math.sqrt((n[S+h]-n[S+l])*(n[S+h]-n[S+l])+(n[S+u]-n[S+d])*(n[S+u]-n[S+d])),ce=Math.sqrt((n[S+h]+n[S+l])*(n[S+h]+n[S+l])+(n[S+u]+n[S+d])*(n[S+u]+n[S+d]))/2,oe=.1*Math.log(1+ce)/(1+Math.sqrt(Jt)),Zt=n[S+o],Qt=n[S+a],n[S+o]=n[S+o]+n[S+l]*(oe/s.settings.slowDown),n[S+a]=n[S+a]+n[S+d]*(oe/s.settings.slowDown),_t=n[S+o],St=n[S+a],mt=Math.sqrt((_t-Zt)*(_t-Zt)+(St-Qt)*(St-Qt)),q+=mt);else for(S=0;S<s.nodesLength;S+=s.ppn)n[S+m]||(Jt=n[S+c]*Math.sqrt((n[S+h]-n[S+l])*(n[S+h]-n[S+l])+(n[S+u]-n[S+d])*(n[S+u]-n[S+d])),ce=Math.sqrt((n[S+h]+n[S+l])*(n[S+h]+n[S+l])+(n[S+u]+n[S+d])*(n[S+u]+n[S+d]))/2,oe=n[S+g]*Math.log(1+ce)/(1+Math.sqrt(Jt)),n[S+g]=Math.min(1,Math.sqrt(oe*(n[S+l]*n[S+l]+n[S+d]*n[S+d])/(1+Math.sqrt(Jt)))),Zt=n[S+o],Qt=n[S+a],n[S+o]=n[S+o]+n[S+l]*(oe/s.settings.slowDown),n[S+a]=n[S+a]+n[S+d]*(oe/s.settings.slowDown),_t=n[S+o],St=n[S+a],mt=Math.sqrt((_t-Zt)*(_t-Zt)+(St-Qt)*(St-Qt)),q+=mt);if(s.iterations++,s.settings.autoStop&&(s.converged=s.iterations>s.settings.maxIterations||q/s.nodesLength<s.settings.avgDistanceThreshold,s.converged&&s.settings.alignNodeSiblings)){let et,dt,ot={},nt={};for(at=0;at<s.edgesLength;at+=s.ppe)Y=r[at+f],st=r[at+p],Y!==st&&(ot[Y]=ot[Y]||{},ot[st]=ot[st]||{},ot[Y][st]=!0,ot[st][Y]=!0);Object.keys(ot).forEach(we=>{var ye=~~we;dt=Object.keys(ot[ye]),dt.length==2&&(et=dt[0]+";"+dt[1],et in nt||(et=dt[1]+";"+dt[0],nt[et]||(nt[et]=[~~dt[1],~~dt[0]])),nt[et].push(ye))});let it,wt,At,Et,Ht,Gt,pe,ge,_e,be,Ce,$t,re,ve,fe,ee=s.settings.nodeSiblingsAngleMin;Object.keys(nt).forEach(we=>{if(wt=nt[we].shift(),At=nt[we].shift(),it=nt[we].filter(te=>!n[te+m]),it.length==1)return;if(Gt=n[wt+o],pe=n[wt+a],ge=n[At+o],_e=n[At+a],Et=Object.keys(ot[wt]).length,Ht=Object.keys(ot[At]).length,be=function(se,ie,Me,Ne,$e){return($e-Ne)*(se-ie)/(Me-ie)+Ne}(Et/(Et+Ht),0,1,1/4,3/4),$t=function(se,ie,Me,Ne,$e){return{x:se+(Me-se)*$e,y:ie+(Ne-ie)*$e}}(Gt,pe,ge,_e,be),re=function(se,ie,Me,Ne){return{xi:-(Ne-ie),yi:Me-se,xiPrime:Ne-ie,yiPrime:-(Me-se)}}(Gt,pe,ge,_e),Ce=function(se,ie,Me,Ne){const $e=Me-se,as=Ne-ie;return Math.sqrt($e*$e+as*as)}(Gt,pe,ge,_e),ve=function(se,ie){return{x:(se.xiPrime-se.xi)/ie,y:(se.yiPrime-se.yi)/ie}}(re,Ce),fe=function(se){return Math.acos(se.x/Math.sqrt(se.x*se.x+se.y*se.y))}(ve),2*ee>Math.PI)throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.");ee>0&&(fe<ee||fe>Math.PI-ee&&fe<=Math.PI?ve={x:2*Math.cos(Math.PI-ee),y:2*Math.sin(Math.PI-ee)}:(fe>2*Math.PI-ee||fe>=Math.PI&&fe<Math.PI+ee)&&(ve={x:2*Math.cos(ee),y:2*Math.sin(ee)}));let ye=0,Pe=1,ps=1;it.length%2==1&&(ps=0,ye=1);for(let te=0;te<it.length;te++)n[it[te]+o]=$t.x+Pe*ve.x*ps*(ye||te>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),n[it[te]+a]=$t.y+Pe*ve.y*ps*(ye||te>=2?s.settings.nodeSiblingsScale:2*s.settings.nodeSiblingsScale/3),Pe=-Pe,ps+=(te+ye)%2})}}function H($){const P=Object.keys($),S={};for(let Y=0;Y<n.length;Y+=s.ppn){const st=P[Y/s.ppn];S[st]={id:st,x:n[Y+o],y:n[Y+a],pinned:n[Y+m]}}return S}return function(){if(s.settings.autoStop){const P=Date.now();for(;!(s.converged||Date.now()-P>=e.chunkPeriod);)W()}else{const P=s.iterations===0?s.settings.startingIterations:s.iterations+s.settings.iterationsPerRender;for(;s.iterations!==P;)W()}return{nodes:H(e.nodes),barycentre:e.barycentre}}()},isRunning:function(t){return!t.W.settings.autoStop||!t.W.converged||(t.W=void 0,!1)},stop:function(t){t.W&&(t.W.converged=!0)},onSync:function({nodes:t,barycentre:e},{graph:s}){const i=Object.keys(t),n=i.length;let r,o,a,l,d,h,u,c,g=0,_=0;const m=new Array(n),f=new Array(n),p=new Array(n),y=new Array(n),[b,x]=s.getAttributes(!0,["x","y"]);for(r=0;r<n;r++)o=i[r],a=t[o],c=parseInt(o),m[r]=c,y[r]=a.pinned,a.pinned?(l=b.get(c),d=x.get(c)):(l=a.x,d=a.y),f[r]=l,p[r]=d,g+=l,_+=d;for(h=g/n-e.x,u=_/n-e.y,r=0;r<n;r++)y[r]||(f[r]-=h,p[r]-=u);return{indexes:m,x:f,y:p}}},m2=t=>(t.modules.layouts.register(v_),(e={})=>e.incremental?Fx(e,t,t.layouts.forceLink):t.modules.layouts.start(v_.name,e)),E_={name:"grid",configure:function(t,{graph:e,camera:s}){function i(E){return E===void 0||typeof E=="number"&&isFinite(E)&&E>0}const n=t.sortBy,r=t,o=r.nodes,a=Array.from(o._indexes),l=a.length,{rows:d,cols:h,rowDistance:u,colDistance:c}=function(w,A,I,M,k){if(!i(A))throw new TypeError('"rows" should be a positive integer');if(!i(I))throw new TypeError('"cols" should be a positive integer');if(!i(M))throw new TypeError('"rowDistance" should be a positive number');if(!i(k))throw new TypeError('"colDistance" should be a positive number');if(A)return{rows:A,cols:Math.ceil(w/A),rowDistance:M,colDistance:k};if(I)return{cols:I,rows:Math.ceil(w/I),rowDistance:M,colDistance:k};const W=Math.ceil(Math.sqrt(w));return{cols:W,rows:Math.ceil(w/W),rowDistance:M,colDistance:k}}(l,r.rows,r.cols,r.colDistance,r.rowDistance),g=function(w,A,I,M,k){return typeof w!="string"?M.map((W,H)=>H):w==="radius"?A.getAttribute(!0,"radius").getMultiple(M):w==="degree"?I.getDegree():w==="random"?M.map(()=>Math.random()):I.getData(w).map(W=>W||k)}(n,e,o,a,t.sortFallbackValue),_=o.getAttribute("layoutable"),m=a.reduce((E,w,A)=>(_[A]&&E.push({id:w,attr:g[A]}),E),[]),f=o.getBoundingBox(),p=.65*Math.max(f.maxScaledSize,f.maxFixedSize/s.getZoom());let y=f.minX+p,b=f.maxX-p,x=f.minY+p,v=f.maxY-p;return f.width<p*h*2&&(y=f.cx-p*h+p,b=f.cx+p*h-p),f.height<p*d*2&&(x=f.cy-p*d+p,v=f.cy+p*d-p),{sort:!!n,nodes:m,reverse:!!r.reverse,cols:h,rows:d,minX:y,maxX:b,minY:x,maxY:v,rowDistance:u,colDistance:c}},update:function({sort:t,nodes:e,maxX:s,minX:i,maxY:n,minY:r,reverse:o,rows:a,cols:l,rowDistance:d,colDistance:h}){t&&e.sort((p,y)=>{const b=p.attr,x=y.attr;return b<x?-1:b>x?1:0}),o&&e.reverse();let u=(s-i)/(l-1),c=(n-r)/(a-1);const g=i,_=r;isFinite(u)||(u=0),isFinite(c)||(c=0),d!==void 0&&isFinite(d)&&(u=d),h!==void 0&&isFinite(h)&&(c=h);let m=0,f=0;return e.forEach(p=>{p.x=g+m*u,p.y=_+f*c,m+=1,m===l&&(f+=1,m=0)}),e},onSync:function(t){return{indexes:t.map(({id:e})=>e),x:t.map(({x:e})=>e),y:t.map(({y:e})=>e)}}},f2=t=>(t.modules.layouts.register(E_),(e={})=>t.modules.layouts.start(E_.name,e)),Su={id:"__SENTINEL__",layer:-1,sink:!1,fixed:!1,siblingIndex:-1,parentIds:[],children:[],radius:0,ref:null},vr=t=>t.data===Su||!1,oh=t=>!vr(t),p2=[],y2=(t,e)=>({id:t,layer:e,data:Su,children:p2,ref:void 0,x:0,y:0}),x2=(t,e)=>({id:t,layer:-1,data:e,children:[],x:0,y:0}),A_=class{constructor(t,e,s){this.data=t,this.prev=e,this.next=s}toString(){return this.data}},Px=t=>t.reduce((e,s)=>(e[s]=!0,e),{});function b2(t,e){const s=[t],i=Px(s),n=[t];for(;s.length;){const r=s.shift();for(const o of e[r])i[o]||(i[o]=!0,n.push(o),s.push(o))}return n}function wu(t){return t.reduce((e,{source:s,target:i})=>(e[s]=e[s]||[],e[i]=e[i]||[],e[s].push(i),e[i].push(s),e),{})}function v2(t){return t.reduce((e,{source:s,target:i})=>(e[s]=e[s]||[],e[s].push(i),e),{})}function E2(t,e,s){const i=s||wu(e||[]);return t.filter(({id:n})=>!(n in i))}function A2(t,e){const s=Px(e);return t.filter(i=>!(i in s))}function ws(t,e){t.forEach((s,i)=>{s.forEach((n,r,o)=>{e(n,r,o,i)})})}var S_=t=>{let e=Math.floor(t.length/2);return(t=[...t].sort((s,i)=>s-i)).length%2!=0?t[e]:(t[e-1]+t[e])/2};function S2(t,e,s){const i=wu(e);let n=Object.keys(i);const r=[];for(;n.length;){const o=b2(n[0],i);r.push(o),n=A2(n,o)}return s.skipSingletons?r:r.concat(E2(t,e,i).map(({id:o})=>[o]))}function w2(t,e,s){const i=e.reduce((o,a)=>(o[a.source]=o[a.source]||[],o[a.source].push(a),o),{}),{result:n}=t.reduce(function o(a,l){const{visited:d,stack:h,result:u}=a;if(d[l.id])return a;d[l.id]=h[l.id]=1;const c=i[l.id]||[];for(const g of c)h[g.target]?u.push(g):o(a,s[g.target]);return delete h[l.id],a},{visited:{},stack:{},result:[]}),r=n.reduce((o,{source:a,target:l})=>(o[a]=o[a]||{},o[a][l]=1,o),{});return e.map(o=>{const{source:a,target:l,id:d}=o;return r[a]&&r[a][l]?{id:d,source:l,target:a}:o})}function T2(t){let e=0,s=0;for(const o of t)e+=o.w*o.h,s=Math.max(s,o.w);t.sort((o,a)=>a.h-o.h);const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let n=0,r=0;for(const o of t)for(let a=i.length-1;a>=0;a--){const l=i[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,r=Math.max(r,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===l.w&&o.h===l.h){const d=i.pop();a<i.length&&(i[a]=d)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(i.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:n,h:r,fill:e/(n*r)||0}}var L2={down:()=>{},up:t=>t.y=-t.y,left:t=>{const e=t.x;t.x=-t.y,t.y=e},right:t=>{const e=t.x;t.x=t.y,t.y=-e}},ed=(t,e)=>isFinite(t)&&t>0?t:e;function I2(t){return{nodesSeparation:ed(t.nodesSeparation,0),componentsSeparation:ed(t.componentsSeparation,25),layerSeparation:ed(t.layerSeparation,50)}}function C2(t,{componentsSeparation:e,layerSeparation:s,packing:i}){const n=s/2,r=[];for(const o of t){const a=o.nodes;if(o.isFake&&o.w!==void 0&&o.h!==void 0){r.push({w:o.w,h:o.h,x:void 0,y:void 0,dag:o});continue}if(o.nodes.length===1){const g=2*a[0].data.radius;r.push({w:g+e,h:g+n,x:void 0,y:void 0,dag:o});continue}const l=a.reduce((g,{x:_,data:m})=>Math.min(g,_-m.radius||1),1/0),d=a.reduce((g,{x:_,data:m})=>Math.max(g,_+m.radius||1),-1/0),h=a.reduce((g,{y:_,data:m})=>Math.min(g,_-m.radius||1),1/0),u=a.reduce((g,{y:_,data:m})=>Math.max(g,_+m.radius||1),-1/0),c=(d+l)/2;a.forEach(g=>{g.x-=c}),r.push({w:Math.abs(d-l)+e,h:Math.abs(u-h)+n,minX:l,x:void 0,y:void 0,dag:o})}if(i!=="singleline")T2(r);else{let o=0;for(const a of r)a.x=o,a.y=0,o+=a.w}return r}function M2(t,e={}){const{componentsSeparation:s,layerSeparation:i}=I2(e);e.direction===void 0&&(e.direction="down");const n=C2(t,{layerSeparation:i,componentsSeparation:s,packing:e.packing});for(const r of n){const{x:o=0,y:a=0,w:l,dag:d}=r;for(const h of d.nodes)h.x+=o+l/2,h.y+=a,L2[e.direction](h)}}var N2=t=>t.reduce((e,{radius:s})=>Math.max(e,2*s),0);function F2(t,e){return ct({nodes:t.map(s=>Wt(ct({},s),{data:s})),isFake:!0},e)}function P2(t,e,s){const i=wu(e||[]),n=t.filter(({id:g})=>!(g in i)).sort((g,_)=>_.radius-g.radius),r=Math.sqrt(n.length);let o=Math.floor(r),a=Math.ceil(r);o*a<n.length&&(o<a?o++:a++);const l=Math.max(1,N2(n)),d=Math.max(s.nodesGridSeparation||0,1),h=l*a+d*(a-1),u=l*o+d*Math.max(o-1,0),c=F2(n,{w:h,h:u});return c.nodes.forEach((g,_)=>{const m=_%a,f=Math.floor(_/a);g.x=h*m/a,g.y=u*f/o}),c}function D2(t){if(!t||!t.length)throw Error("Cannot stratify empty data");for(const n of t){if(!n)throw Error('Node data is "null"');if(n.id==null)throw Error('Node id contains a "null" value')}const e=t.map(n=>x2(n.id,n)),s=e.reduce((n,r)=>{if(n[r.id])throw Error(`The connected component contains id duplicates: ${r.id}`);return n[r.id]=r,n},{}),i=[];for(const n of e){for(const r of n.data.parentIds){const o=s[r];if(!o)throw Error(`The node ${n.id} has a missing parent id ${r}`);o.children.push(n)}n.data.parentIds.length||i.push(n)}return{isFake:!1,nodes:k2(i)}}function k2(t){const e={},s=[];for(;t.length;){const i=t.pop();e[i.id]||(s.push(i),e[i.id]=!0,t.push(...i.children))}return s}function R2(t){if(t.sort((i,n)=>i-n),t.length===0)return 0;const e=Math.floor(t.length/2),s=Math.floor(t.length/2);return(t[e]+t[s])/2}function ah(t,e,s){const i={};return e.forEach((n,r)=>i[n.id]=r),t.map(n=>(s[n.id]||[]).map(r=>i[r]).sort()).reduce((n,r,o,a)=>{const l=r.length?r[r.length-1]:-1;for(let d=o+1;d<a.length;d++)n+=a[d].filter(h=>h<l).length;return n},0)}function O2(t,e,s,i,n){const r={};for(let o=0;o<t.length;o++)r[t[o].id]=R2((e[t[o].id]||[]).map(a=>s[a]))||0;n?t.sort((o,a)=>{const l=r[o.id]-r[a.id],d=i[o.id]===i[a.id],h=o.data.siblingIndex,u=a.data.siblingIndex;return d&&h>-1&&u>-1?h-u:l===0?s[a.id]-s[o.id]:l}):t.sort((o,a)=>{const l=r[o.id]-r[a.id];return l===0?s[a.id]-s[o.id]:l})}function w_({layers:t,topDown:e,topDownAdj:s,bottomUpAdj:i,idToIndex:n,crossings:r,sortSiblings:o}){const a=e?s:i;for(let l=e?0:t.length-1;e?l<t.length:l>=0;e?l++:l--){O2(t[l],a[l]||{},n,i[l],o);const d=l>0?ah(t[l-1],t[l],s[l-1]):0,h=l<t.length-1?ah(t[l],t[l+1],s[l]):0;h+d<(r[l]||0)+(r[l-1]||0)?(r[l]=h,l>0&&(r[l-1]=d),t[l].forEach((u,c)=>n[u.id]=c)):t[l].sort((u,c)=>n[u.id]-n[c.id])}}var z2=(t,e,s)=>{if(!s&&!e)return;const i={},n=t.map(()=>({})),r=t.map(()=>({}));t.forEach((d,h)=>{d.forEach((u,c)=>{i[u.id]=s?u.data.siblingIndex:c,u.children.forEach(g=>{const _=g.layer;_>h?(n[h][u.id]=n[h][u.id]||[],n[h][u.id].push(g.id),r[_][g.id]=r[_][g.id]||[],r[_][g.id].push(u.id)):(n[_][g.id]=n[_][g.id]||[],n[_][g.id].push(u.id),r[h][u.id]=r[h][u.id]||[],r[h][u.id].push(g.id))})})}),i[-1]=-1,s&&t.forEach(d=>d.sort((h,u)=>i[h.id]-i[u.id]));const o=t.slice(1).map((d,h)=>ah(t[h],d,n[h])),a=Math.max(...t.map(d=>d.length)),l=[[50,100],[100,10],[1e3,1],[5e3,0]].find(([d])=>a<d)[1];for(let d=0;d<l;d++)w_({layers:t,topDown:!0,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s}),w_({layers:t,topDown:!1,topDownAdj:n,bottomUpAdj:r,idToIndex:i,crossings:o,sortSiblings:s})};function B2(t){const e=t.nodes.reduce((s,i)=>i.data.fixed&&(s===null||s.layer>i.layer)?i:s,null);return e&&t.nodes.forEach(s=>s.ref=e.id),t}function U2(t){const e={},s={},i={};t.nodes.forEach(o=>{i[o.id]=o});const n=o=>{if(e[o.id])return s[o.id];e[o.id]=!0;let a=1/0;for(const l of o.children)a=Math.min(a,n(i[l.id])-1);return a===1/0&&(a=0),s[o.id]=a,a};t.nodes.forEach(o=>{o.data.parentIds.length===0&&n(o)});let r=1/0;t.nodes.forEach(o=>{r=Math.min(r,s[o.id])}),t.nodes.forEach(o=>{s[o.id]-=r,o.layer=s[o.id]})}function G2(t){t.nodes.forEach(e=>{e.layer=e.data.layer!=null?e.data.layer:e.layer})}function V2(t){if(t.nodes.every(e=>e.layer)){let e=t.nodes.reduce((s,i)=>Math.min(s,i.layer),1/0);t.nodes.forEach(s=>s.layer-=e)}}function j2(t){const e={};t.nodes.forEach(r=>{e[r.id]=[...e[r.id]||[],...r.children],r.children.forEach(o=>{e[o.id]=[...e[o.id]||[],r]})});const s=[];t.nodes.forEach(r=>{r.layer===0&&s.push(r)});const i={},n={};for(t.nodes.forEach(r=>{r.layer!==-1&&(n[r.id]=r.layer)});s.length;){const r=s.shift().id;for(const o of e[r])if(!i[o.id]){if(n[o.id]===void 0){const a=n[r]+1;n[o.id]=a,o.layer=a}i[o.id]=!0,s.push(o)}}}function q2(t){if(t.nodes.some(e=>e.data.sink)){const e=t.nodes.reduce((s,i)=>Math.max(s,i.layer),-1/0);t.nodes.forEach(s=>{s.data.sink&&(s.layer=e+1)})}}function H2(t){const e=[];t.nodes.forEach(i=>e[i.layer]=0);const s=Array.from(e).reduce((i,n,r)=>{if(r===0)return i.push(0),i;const o=i[r-1];return n!==void 0?(i.push(o),i):(i.push(o-1),i)},[]);t.nodes.forEach(i=>i.layer+=s[i.layer])}function X2(t){if(t.nodes.some(e=>"layer"in e.data&&e.data.layer<0))throw new Error("Some nodes have negative layering information");return t.nodes.some(e=>e.data&&!isNaN(e.data.layer)&&e.data.layer!==null)||U2(t),G2(t),j2(t),q2(t),V2(t),H2(t),t.nodes.forEach(e=>{const{below:s,above:i}=e.children.reduce((n,r)=>(e.layer>r.layer?n.above.push(r):n.below.push(r),n),{above:[],below:[]});i.forEach(n=>n.children.push(e)),e.children=s}),B2(t)}var W2=class{constructor(){this.byId={},this.byIndex={},this.length=0}append(t,e){let s;return this.head?(s=new A_(t,this.tail),this.tail=this.tail.next=s):(s=new A_(t),this.tail=this.head=s),this.byId[e]=s,this.byIndex[this.length++]=s,s}find(t){let e=this.head;do{if(e.data===t)return e;e=e.next}while(e)}forEach(t){let e=this.head,s=0;do t(e,s),s++;while(e=e.next)}},Ts=-1,Re=1e-5,sd=[],$2=class{constructor(t,e,s){this.edges=[],this.nodeMap={},this.nodeIndexTopDown={},this.nodeToLayer={},this.longEdges={},this.virt={},this.height={},this.breadth={},this.first=[],this.totalW={},this.mDist={},this.X={},this.block={},this.nodeList=new W2,this.nodeDistance=e,this.layerDistance=s,this.layers=t;const{breadth:i,virt:n,height:r,nodeToLayer:o,nodeIndexTopDown:a,nodeMap:l,longEdges:d,edges:h}=this;let u=0;ws(this.layers,(m,f,p,y)=>{if(a[m.id]=u++,l[m.id]=m,o[m.id]=y,this.nodeList.append(m,m.id),m.children.forEach(x=>{const v=vr(x)||vr(m);h.push({source:m.id,target:x.id,virtual:v,id:h.length})}),d[m.id])return;const b=[m.id];if(d[m.id]=b,!oh(m))for(let x=0;x<m.children.length;x++){const v=m.children[x];if(oh(v))continue;let E=v;for(;vr(E);)b.push(E.id),d[E.id]=b,E=E.children[0]}});const c=this.adjacencyList=v2(h);this.N=t.reduce((m,f)=>m+f.length,0),this.Y=new Float32Array(t.length),this.first=t.map(m=>m[0]),t.forEach((m,f)=>r[f]=0),ws(this.layers,(m,f,p,y)=>{const b=c[m.id]?c[m.id].length:0;n[m.id]=vr(m)&&b===1,this.nodeToLayer[m.id]=y,n[m.id]?i[m.id]=0:(i[m.id]=2*m.data.radius,r[y]=Math.max(r[y]||0,2*m.data.radius))});const g={},_={};h.forEach(m=>{const f=m.source,p=m.target;g[p]=g[p]||[],g[p].push(f),_[f]=_[f]||[],_[f].push(p)}),Object.values(g).forEach(m=>{m.sort((f,p)=>this.nodeIndexTopDown[f]-this.nodeIndexTopDown[p])}),Object.values(_).forEach(m=>{m.sort((f,p)=>this.nodeIndexTopDown[f]-this.nodeIndexTopDown[p])}),this.neighbours={prev:g,next:_}}computeMinNodeDistances(){const{layers:t,totalW:e}=this;ws(t,s=>{e[s.id]=0}),ws(t,s=>e[s.data.id]=0),this.layers.forEach(s=>{e[s[0].id]=0,s.slice(1).forEach((i,n)=>{const r=s[n],o=i.id;e[o]=e[r.id]+r.data.radius+i.data.radius+this.nodeDistance})})}decrossVirtualEdges(){this.layers.forEach(t=>{let e=-1;t.forEach(s=>{if(!this.virt[s.id])return;const i=this.neighbours.next[s.id][0];if(this.virt[i])if(e!==-1&&e>this.nodeIndexTopDown[i]){const n=this.longEdges[s.id];let r=0;for(r=0;r<n.length&&n[r]!==i;r++);const o=n.slice(r);o.forEach(l=>this.longEdges[l]=o);const a=n.slice(0,r);a.forEach(l=>this.longEdges[l]=a)}else e=this.nodeIndexTopDown[i]})})}placeLongEdges(){const{X:t,layers:e}=this;ws(e,s=>t[s.id]=0);for(let s=1;s>=-1;s-=2){const i={};let n=0;const r={};ws(e,d=>r[d.id]=0),r[Su.id]=0;const o=s;e.forEach(d=>{let h=o===1?d[0]:d[d.length-1];r[h.id]||(this.longEdges[h.id].forEach(g=>{r[g]=n}),n++);let u=o===1?0:d.length-1,c=u+o;for(;c>=0&&c<d.length;)h=d[c],r[h.id]||this.longEdges[h.id].forEach(g=>{r[g]=r[d[u].id]}),u=c,c+=o});const a={};e.forEach(d=>{for(let h=o===1?0:d.length-1;o===1?h<d.length:h>=0;h+=o){const u=d[h],c=r[u.id];a[c]=a[c]||[],a[c].push(u.id)}});const l={};this.nodeList.forEach(d=>l[d.data.id]=0);for(let d=0;d<n;d++){const h={done:!1,dist:0},u=a[d];for(const c of u)this.sortLongEdges(c,s,l,h,r,i);if(!h.done){const c=this.layers[this.nodeToLayer[a[d][0]]],g=[];c.forEach(_=>{for(const m of this.neighbours.prev[_.id]||sd){const f=Math.abs(l[m]-l[_.id]);g.push(f)}}),g.length!==0&&(h.dist=S_(g))}for(const c of u)l[c]-=s*h.dist}ws(e,d=>t[d.id]+=l[d.id]/2)}}sortLongEdges(t,e,s,i,n,r){if(r[t])return!1;let o=!1,a=0;const{nodeToLayer:l,totalW:d}=this,h=this.longEdges[t];h.forEach(u=>r[u]=!0),h.forEach(u=>{const c=this.nodeList.byIndex[this.nodeIndexTopDown[u]-e];if(!c)return;const g=c.data.id,_=u,m=l[g]===l[_],f=n[g]===n[_];!m||!f||(this.sortLongEdges(g,e,s,i,n,r),(!o||e*(a-s[g])<e*(d[_]-d[g]))&&(o=!0,a=s[g]+d[_]-d[g]))}),h.forEach(u=>{s[u]=a;const c=this.nodeList.byId[u],g=e===1?c.next:c.prev;if(!g)return;const _=g.data.id,m=u,f=l[_]===l[m],p=n[_]!==n[m],y=e*(d[_]-d[m]-s[_]+s[m]);f&&p&&(!i.done||y>i.dist)&&(i.dist=y,i.done=!0)})}placeNonVirtualNodes(){const t={};ws(this.layers,l=>t[l.id]=-1);const{X:e,totalW:s,virt:i,nodeIndexTopDown:n,mDist:r,nodeList:o}=this,a={};ws(this.layers,(l,d,h,u)=>{if(!i[l.id])return void(a[l.id]=!1);let c=this.nodeList.byId[l.id].next;for(;c&&this.nodeToLayer[c.data.id]===u&&!i[c.data.id];)c=c.next;a[l.id]=this.nodeToLayer[c.data.id]===u&&e[c.data.id]-e[l.id]<s[c.data.id]-s[l.id]+Re}),ws(this.layers,({id:l})=>{a[l]&&t[l]===-1&&this.longEdges[l].forEach(d=>{d!==l&&(t[d]=n[d]<n[l]?1:0)})}),ws(this.layers,({id:l})=>r[l]=s[l]);for(let l=0;l<2;l++)for(let d=l?this.layers.length-1:0;d>=0&&d<this.layers.length;l?d--:d++){let h=Ts;const u=this.layers[d];if(u.forEach(({id:c},g,_)=>{if(i[c]){if(h===Ts){this.placeSequence(Ts,c,_[0].id,o.byId[c].prev.data.id,l);for(let m=0;m<g;m++){const f=_[m].id;r[f]=r[c]-e[c]+e[f]}}else if(t[h]!==1-l){a[h]||this.placeSequence(h,c,o.byId[h].next.data.id,o.byId[c].prev.data.id,l);const m=l===1?this.neighbours.prev:this.neighbours.next,f=m[h][0],p=m[c][0];if(i[f]&&i[p])for(let y=n[f]+1;y<n[p];y++)t[o.byIndex[y].data.id]=l}h=c}}),h===Ts)this.placeSequence(Ts,Ts,u[0].id,u[u.length-1].id,l),u.forEach(({id:c})=>r[c]=e[c]);else{this.placeSequence(h,Ts,o.byId[h].next.data.id,u[u.length-1].id,l);for(let c=u.length-1;c>=0;c--){const g=u[c].id;if(g===h)break;r[g]=r[h]-e[h]+e[g]}}}}placeSequence(t,e,s,i,n,r=0){const o=this.nodeIndexTopDown[s],a=this.nodeIndexTopDown[i],{X:l,nodeIndexTopDown:d,mDist:h}=this;if(o===a)l[s]=this.placeNode(s,t,e,l[s],n);else if(o<a){const u=Math.floor((d[s]+d[i])/2),c=this.nodeList.byIndex[u],g=c.next.data.id,_=h[g]-h[c.data.id];this.placeSequence(t,e,s,c.data.id,n,r+1),this.placeSequence(t,e,g,i,n,r+1),this.combineSequences(t,e,s,i,g,c.data.id,n,_)}}calculateBends(t,e,s,i,n,r,o,a){let l=0;const d=[],{X:h,mDist:u,neighbours:c}=this,g=this.nodeIndexTopDown[s],_=this.nodeIndexTopDown[i];for(let m=this.nodeList.byId[r],f=this.nodeIndexTopDown[m.data.id];f>=g&&f<=_&&m;m=t===-1?m.prev:m.next,f=m&&this.nodeIndexTopDown[m.data.id]){const p=m.data.id,y=(e===0?c.prev[p]:c.next[p])||sd;let b=0;for(const v of y)if(t*(h[v]-h[p])<Re)b++;else{b--;const E=h[v]+u[r]-u[p];t*(h[r]-E)>-Re?l++:(a===Ts||t*(E-h[a]+u[a]-u[r])<Re)&&t*(E-h[n])<o-Re&&d.push({value:2,key:E})}const x=h[p]+u[r]-u[p];t*(h[r]-x)>-Re?l+=b:(a===Ts||t*(x-h[a]+u[a]-u[r])<Re)&&t*(x-h[n])<o-Re&&d.push({value:b,key:x})}return a!==Ts&&d.push({value:this.edges.length,key:h[a]-u[a]+u[r]}),d.sort(({key:m},{key:f})=>m-f),{res:l,bends:d.reduce((m,f,p)=>{if(p<d.length-1){const y=d[p+1];Math.abs(f.key-y.key)>Re?f.value>0&&m.push(f):f.value+=y.value}else f.value>0&&m.push(f);return m},[])}}combineSequences(t,e,s,i,n,r,o,a){const{X:l,mDist:d,nodeIndexTopDown:h}=this;let{res:u,bends:c}=this.calculateBends(-1,o,s,i,n,r,a,t),{res:g,bends:_}=this.calculateBends(1,o,s,i,r,n,a,e);for(c.length>0&&c.reverse();l[n]-l[r]<a-Re;){let p=0,y=0;if(u<g){const b=c.length;if(b>0){const x=c.pop();p=x.value,l[r]=x.key}(b===0||l[n]-l[r]>a+Re)&&(l[r]=l[n]-a)}else if(u>g){const b=_.length;if(b>0){const x=_.pop();y=x.value,l[n]=x.key}(b===0||l[n]-l[r]>a+Re)&&(l[n]=l[r]+a)}else{let b=(a-l[n]+l[r])/2;const x=c.length===0?b+1:l[r]-c[c.length-1].key,v=_.length===0?b+1:_[_.length-1].key-l[n];x<b+Re&&x<v+Re&&(p=c.pop().value),v<b+Re&&v<x+Re&&(y=_.pop().value),b=Math.min(b,x,v),l[r]-=b,l[n]+=b}u+=p,g+=y}let m,f=this.nodeList.byId[r].prev;for(;f&&h[m=f.data.id]>=h[s]&&l[r]-l[m]<d[r]-d[m];)l[m]=l[r]-d[r]+d[m],f=f.prev;for(f=this.nodeList.byId[n].next;f&&h[m=f.data.id]<=h[i]&&l[n]-l[m]>d[n]-d[m];)l[m]=l[n]-d[n]+d[m],f=f.next}placeNode(t,e,s,i,n){const{X:r,neighbours:o,mDist:a}=this,l=((n===0?o.prev:o.next)[t]||sd).map(d=>r[d]);return l.length===0?r[t]:(i=S_(l),e!==Ts&&(i=Math.max(i,r[e]+a[t]-a[e])),s!==Ts&&(i=Math.min(i,r[s]+a[t]-a[s])),i)}moveLongEdge(t,e,s){const{X:i,virt:n,totalW:r,nodeList:o}=this,{id:a}=t.data;if(s[a]||!n[a])return;const l=this.longEdges[a];if(!l)return;l.forEach(m=>s[m]=!0);const d=l[0],h=l[l.length-1],u=[];e<0?u.push(i[d]<i[h]?i[d]:i[h],i[d]<i[h]?i[h]:i[d]):e>0?u.push(i[d]<i[h]?i[h]:i[d],i[d]<i[h]?i[d]:i[h]):u.push(i[d],i[h]);let c,g=u[0],_=!1;for(;!_&&u.length!==0;)c=u.pop(),_=!0,l.forEach(m=>{const f=this.layers[this.nodeToLayer[m]];if(m!==f[0].id){const p=o.byId[m].prev.data;c-i[p.data.id]<r[m]-r[p.data.id]&&this.moveLongEdge(p,-1,s),_=_&&c-i[p.data.id]>=r[m]-r[p.data.id]-Re}if(m!==f[f.length-1].id){const p=o.byId[m].next.data;c-i[p.data.id]>r[m]-r[p.data.id]&&this.moveLongEdge(p,1,s),_=_&&c-i[p.data.id]<=r[m]-r[p.data.id]+Re}});_||(c=g,l.forEach(m=>{const f=this.layers[this.nodeToLayer[m]];if(m!==f[0].id){const p=o.byId[m].prev.data;c=Math.max(c,i[p.data.id]+r[m]-r[p.data.id])}if(m!==f[f.length-1].id){const p=o.byId[m].next.data;c=Math.min(c,i[p.data.id]+r[m]-r[p.data.id])}})),l.forEach(m=>i[m]=c)}moveLongEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.moveLongEdge(e[i],0,t);for(let i=s-1;i>=0;i--)this.moveLongEdge(e[i],0,t)})}computeY(){const{Y:t,layers:e,height:s}=this;t[0]=0,e.slice(1).forEach((i,n)=>{t[n+1]=t[n]+s[n+1]+this.layerDistance})}straightenLongEdge(t,e){const{nodeList:s,longEdges:i,neighbours:n,X:r,Y:o,nodeToLayer:a,totalW:l}=this,d=i[t.id];if(e[t.id]||!n.prev[t.id]||n.prev[t.id].length!==1||!n.next[t.id]||n.next[t.id].length!==1||!(d&&d.length<2))return;e[t.id]=!0;const h=n.prev[t.id][0],u=n.next[t.id][0];if(a[u]===a[h])return;let c=r[h]+(r[u]-r[h])*(o[a[t.id]]-o[a[h]])/(o[a[u]]-o[a[h]]);if(t!==this.first[a[t.id]]){const _=s.byId[t.id].prev.data;if(c-r[_.id]<l[t.id]-l[_.id]-Re&&this.straightenLongEdge(_,e),c-r[_.id]<l[t.id]-l[_.id]-Re)return}const g=this.layers[a[t.id]];if(t!==g[g.length-1]){const _=s.byId[t.id].next.data;if(r[_.id]-c<l[_.id]-l[t.id]-Re&&this.straightenLongEdge(_,e),r[_.id]-c<l[_.id]-l[t.id]-Re)return}r[t.id]=c}straightenEdges(){const t={};this.layers.forEach(e=>{const s=Math.floor(e.length/2);for(let i=s;i<e.length;i++)this.straightenLongEdge(e[i],t);for(let i=s-1;i>=0;i--)this.straightenLongEdge(e[i],t)})}run(){this.computeMinNodeDistances(),this.decrossVirtualEdges(),this.placeLongEdges(),this.placeNonVirtualNodes(),this.moveLongEdges(),this.computeY(),this.straightenEdges(),ws(this.layers,(t,e,s,i)=>{t.x=this.X[t.id],t.y=this.Y[i]})}},Y2=(t,e=20,s=50)=>new $2(t,e,s).run(),Z2=(t,{nodeDistance:e,layerDistance:s,nodeLookup:i,customSort:n,sortSiblings:r,shouldDecross:o=!0})=>{X2(t);const a=K2(t);return t.nodes.length>1?(z2(a,o,r),n&&a.forEach(l=>{l.sort((d,h)=>n(i[d.id],i[h.id]))}),Y2(a,e,s)):(t.nodes[0].x=0,t.nodes[0].y=0),Q2(t),t};function K2(t){return t.nodes.reduce((e,s)=>(e[s.layer]=e[s.layer]||[],e[s.layer].push(s),s.children=s.children.map(i=>{if(i.layer===s.layer+1)return i;let n=i;for(let r=i.layer-1;r>s.layer;r--){const o=y2(`${s.id}->${i.id}@${r}`,r);o.children=[n],e[r]=e[r]||[],e[r].push(o),n=o}return n}),e),[])}function Q2(t){t.nodes.forEach(e=>{e.data&&(e.children=e.children.filter(oh))})}var id=({id:t,layer:e,sink:s,siblingIndex:i,radius:n,layoutable:r})=>({id:t,layer:e!==void 0?e:void 0,sink:s,siblingIndex:i||0,radius:n||0,fixed:r===!1,parentIds:[],children:[],ref:null});function J2(t){const e={x:0,y:0};let s=0;for(const i of t)for(const n of i.nodes)e.x+=n.x||0,e.y+=n.y||0,s++;return e.x/=s,e.y/=s,e}function tM(t){const e={x:0,y:0};let s=0;for(const i in t)e.x+=t[i].x||0,e.y+=t[i].y||0,s++;return e.x/=s,e.y/=s,e}function eM(t,e,s){const i=J2(s),n=t.x-i.x,r=t.y-i.y;for(const o of s)for(const a of o.nodes){const l=e[a.id];!l||a.data&&a.data.fixed||(l.x=a.x+n,l.y=a.y+r)}}var sM=(t,e={})=>{const s=(t.edges||[]).filter(({source:l,target:d})=>l!==d),i={},n=new Map;for(const l of t.nodes)i[l.id]=l;const r=w2(t.nodes,s,i).filter(l=>{const d=n.get(l.source);if(!d){const h=new Map;return h.set(l.target,!0),n.set(l.source,h),!0}return!d.get(l.target)&&(d.set(l.target,!0),!0)}),o=S2(t.nodes,r,{skipSingletons:e.packing==="grid"}),a=r.reduce((l,d)=>(l[d.source]||(l[d.source]=id(i[d.source])),l[d.target]||(l[d.target]=id(i[d.target])),l[d.target].children.push(d.source),l[d.target].parentIds.push(d.source),l),{});return{components:o.map(l=>l.map(d=>a[d]||id(i[d]))),lookup:i}};function iM(t,e,s){const i=[];for(const n of t){const r=D2(n);i.push(r),Z2(r,{nodeDistance:s.nodesSeparation,layerDistance:s.layerSeparation,shouldDecross:s.shouldDecross,customSort:s.customSort,sortSiblings:!!s.sortSiblings,nodeLookup:e})}return i}var T_=(t,e={})=>{if(!t||!t.nodes)return t;const s=Wt(ct({direction:"down",packing:"fit",nodesGridSeparation:1},e),{shouldDecross:e.shouldDecross!==!1}),{components:i,lookup:n}=sM(t,s),r=tM(n),o=iM(i,n,s);if(s.packing==="grid"){const a=P2(t.nodes,t.edges,s);o.push(a)}return M2(o,s),eM(r,n,o),t},nd={direction:"TB",nodeDistance:5,levelDistance:50,componentDistance:50,gapWidth:1,arrangeComponents:"fit",gridDistance:50,layer:"layer",siblingIndex:""},lh={name:"hierarchical",imports:{sequential:T_},configure:function(t,{graph:e,data:s}){function i(y,b,x=y.getNodes()){return b?b instanceof ui?b:y.getNodes(b):x}const n=Wt(ct(ct({},nd),t),{nodeList:t.nodes});n.direction=t.direction||nd.direction,n.layerSeparation=n.levelDistance,n.nodesSeparation=n.nodeDistance,n.componentsSeparation=n.componentDistance,n.gapDistance=n.gapWidth,n.packing=n.arrangeComponents;const r=ct({},n),o=n.edges,a=n.nodeList;if(["TB","BT","LR","RL"].indexOf(n.direction)===-1)throw new Error('direction should be one of the "TB", "BT", "LR", "RL"');if(["fit","grid","singleLine"].indexOf(n.packing)===-1)throw new Error('arrangeComponents should be one of the "fit", "grid", "singleLine"');n.nodesGridSeparation=t.gridDistance||nd.gridDistance;const l=a.getId(),d=a.getAttribute("layoutable").reduce((y,b,x)=>(y[l[x]]=b,y),{}),h=a.getAttributes(["x","y"]).reduce((y,b,x)=>(y[l[x]]=b,y),{}),u=a.getAttribute("radius");if(typeof r.layer!="string")throw new Error("'layer' should be the valid data field name");if(r.siblingIndex===void 0&&(r.siblingIndex=""),typeof r.siblingIndex!="string")throw new Error("'siblingIndex' should be the valid data field name");const c=i(e,n.roots,e.nodeList()),g=s.getProperty(n.nodeList,r.layer),_=r.siblingIndex.length?s.getProperty(n.nodeList,r.siblingIndex):[],m=c.map(y=>{let b=-1;return n.nodeList.forEach((x,v)=>{x===y&&(b=v)}),b});for(const y of m)g[y]=0;const f=i(e,n.sinks,e.nodeList()).toArray().reduce((y,b)=>(y[b.getId()]=!0,y),{}),p=l.map(y=>f[y]);return{nodes:l,edges:o.map(y=>({id:y.getId(),source:y.getSource().getId(),target:y.getTarget().getId()})),options:Ka(n),layoutable:d,radiuses:u,siblingIndexes:_,layers:g,sinks:p,coords:h}},context:qt,update:function({nodes:t,edges:e,options:s,layoutable:i,radiuses:n,layers:r,siblingIndexes:o,sinks:a,coords:l}){const d=e.filter(({source:c,target:g})=>c in i&&g in i),h={nodes:t.map((c,g)=>({id:c,radius:n[g],layer:r[g],siblingIndex:o[g],sink:a[g],layoutable:i[c],x:l[c].x,y:l[c].y})),edges:d},{nodes:u}=T_(h,{packing:{fit:"fit",singleLine:"singleline",grid:"grid"}[s.arrangeComponents],direction:{TB:"down",BT:"up",RL:"left",LR:"right"}[s.direction],layerSeparation:s.layerSeparation,nodesSeparation:s.nodesSeparation,sortSiblings:o.length>0,componentsSeparation:s.componentsSeparation,nodesGridSeparation:s.nodesGridSeparation,evenDistribution:s.evenDistribution});return{positions:u}},isRunning:function(){return!1},onSync:function({positions:t},{graph:e}){return{indexes:t.map(({id:s})=>(e.getNode(s)||{_index:-1})._index),x:t.map(({x:s})=>s),y:t.map(({y:s})=>s)}}},nM=t=>(t.modules.layouts.register(lh),(e={})=>(e.useWebWorker=!1,t.modules.layouts.start(lh.name,e))),dh=(t,e)=>t-e,L_={name:"radial",imports:{minHeap:wh,bellmanFord:Th,dijkstra:Lh,johnson:cd,distance:Oe,circleCircleIntersection:Vh,circleSortCompare:jh,weightedStress:im,distanceStress:nm,constrainedStress:hd,stressMinimizationStep:ud,removeRadialOverlap:Md,linear:Ra,calculateRadii:$u},configure(t,{graph:e}){let s=t.nodes;const i=s.size;function n(E,w){return E!=null&&isFinite(E)?E:w}if(t.centralNode===void 0)throw new Error('radial layout: missing parameter "centralNode"');const r=e.getNode(t.centralNode);if(r===void 0)throw new Error('radial layout: parameter "centralNode" is not valid');t.radiusRatio=n(t.radiusRatio,Math.SQRT2),t.radiusDelta=n(t.radiusDelta,0),t.nodeGap=n(t.nodeGap,10),t.repulsion=i*n(t.repulsion,1);const o=r.getPosition(),a=n(t.centerX,o.x),l=n(t.centerY,o.y),d=r._index;s.includes(r)||(s=s.concat(r.toList()));let h=s._indexes;const u=s.getAttribute("layoutable");h=h.filter((E,w)=>u[w]||E===d),h.sort(dh);const c=h.length,g=rM(h,e.getConnectedComponents(s,{internalIndexes:!0}),d),_=e.degrees(h),m=new Float32Array(e.getNodeAttribute("x").getMultiple(h)),f=new Float32Array(e.getNodeAttribute("y").getMultiple(h)),p=e.getNodeAttribute("radius").getMultiple(h),y=e.getEdges()._indexes,b=e.getEdgeAttribute("source").getMultiple(y),x=e.getEdgeAttribute("target").getMultiple(y),v=e.getAdjacencyList({internalIndexes:!0,weight:1,indexes:h});return{centerIndex:d,centerIndexPos:0,cx:a,cy:l,D:null,indexes:h,components:g,normIndexes:null,radii:null,rings:null,x:m,y:f,degree:_,size:c,attributes:{size:p,adjacency:v,weights:x.map(()=>1),sources:b,targets:x},sortAttr:null,allowOverlap:!!t.allowOverlap,nodeGap:t.nodeGap,radiusRatio:t.radiusRatio,radiusDelta:t.radiusDelta,repulsion:t.repulsion,randomize:!("randomize"in t)||!!t.randomize,renderSteps:!!t.renderSteps,epsilon:n(t.epsilon,.001),maxSteps:n(t.maxIterations,100),iterationsPerRender:n(t.iterationsPerRender,20),step:-1,stress:Number.POSITIVE_INFINITY,prevStress:0,converged:!1,overlapRemoved:!1,done:!1}},context:()=>({data:null,gridPlacement(t,e,s=8){const i=t.length,n=new Float32Array(i),r=new Float32Array(i);let o=0;for(let c=0,g=t.length;c<g;c++){const _=e[t[c]];_>o&&(o=_)}const a=o*s,l=Math.ceil(Math.sqrt(i)),d=Math.ceil(i/l),h=-Math.floor((d-1)*a/2),u=-Math.floor((l-1)*a/2);for(let c=0;c<l;c++)for(let g=0;g<d;g++)n[c*d+g]=h+g*a,r[c*d+g]=u+c*a;return{x:n,y:r}},connectComponents(t,e,s,i,n,r){let o;function a(l,d){const h=new Uint32Array(l.length+1);return h.set(l),h[l.length]=d,h}for(let l=1;l<t.length;l++){const d=t[l];let h=0,u=0;d.forEach((_,m)=>{const f=n.get(_);f!=null&&f>h&&(u=m,h=f)}),o=d[u];const c=e[r.get(o)];c.weights=c.weights||[],c.nodes=a(c.nodes,s),c.weights.push(i);const g=e[r.get(s)];g.weights=g.weights||[],g.nodes=a(g.nodes,o),g.weights.push(i)}},correctSubgraphsDistances(t,e,s,i,n){const r=Array.prototype.reduce.call(t[s],(a,l,d)=>(d!==s&&l<i&&l>a&&(a=l),a),0),o=i-r-1;for(let a=1;a<e.length;a++){const l=e[a];for(let d=0,h=l.length;d<h;d++){const u=n.get(l[d]);u!=null&&(t[s][u]-=o,t[u][s]-=o)}}},initialize(t,e){t.data=e,e.step=0;const s=new Map,i=new Map;e.normIndexes=e.indexes.reduce((d,h,u)=>(d[u]=u,s.set(h,u),i.set(h,e.degree[u]),t.data&&h===e.centerIndex&&(t.data.centerIndexPos=u),d),new Uint32Array(e.indexes.length));const n=e.centerIndexPos,r=e.components[0].length;t.connectComponents(e.components,e.attributes.adjacency,e.centerIndex,r,i,s);const o=cd({sources:e.attributes.sources,targets:e.attributes.targets,weights:e.attributes.weights,indexes:e.indexes,adjacency:e.attributes.adjacency,undirected:!0});t.correctSubgraphsDistances(o,e.components,n,r,s),e.D=o;const a=o[n],l={};for(let d=0,h=e.normIndexes.length;d<h;d++)if(d!==n){const u=a[d];l[u]=l[u]||[],l[u].push(e.normIndexes[d])}e.rings=l,e.radii=$u(n,e.rings,e.attributes.size,e.nodeGap,e.radiusRatio,e.radiusDelta)},removeOverlaps(t,e){if(!t.data)return;const s=t.data.centerIndexPos,i=e.attributes.size,{rings:n,radii:r}=e,o=e.x[s],a=e.y[s];for(const l in n){const d=n[l];for(let h=0;h<d.length;h++){const u=d[h],c=r[l];let g=e.x[u]-o,_=e.y[u]-a;g+_===0&&(g=Math.sin(u)*Math.random()*.001,_=Math.cos(u)*Math.random()*.001);const m=Math.sqrt(g*g+_*_);if(m-c<0){const f=c/m;e.x[u]=o+g*f,e.y[u]=a+_*f}}}for(const l in n){const d=n[l],h=Oe(o,a,e.x[d[0]],e.y[d[0]]);Md({X:e.x,Y:e.y,sizes:i,indexes:d,center:[o,a],R:h,gap:e.nodeGap,inPlace:!0})}}}),update(t,e){t||(t=e.data);const s=t.indexes,i=t.centerIndex;let n;t.x=t.x||new Float32Array(t.size),t.y=t.y||new Float32Array(t.size),t.step===-1&&e.initialize(e,t);const r=t.repulsion,o=a=>t.radii&&t.radii[a]||1;if(t.step===0&&t.randomize&&(n=e.gridPlacement(t.indexes,t.attributes.size),t.x=n.x,t.y=n.y),!t.converged){const a=t.maxSteps,l=t.iterationsPerRender;let d=t.step;const h=Math.min(d+l,a),{D:u,x:c,y:g,size:_,centerIndexPos:m,normIndexes:f}=t;for(;d<=h&&!t.converged;){const p=Ra(Math.min(d,a)/a);t.step=d++,n=ud(u,c,g,_,m,r,p,f,o),t.x=n.x,t.y=n.y,t.prevStress=t.stress,t.stress=hd(u,c,g,_,m,r,p,f),t.converged=t.converged||Math.abs(t.stress-t.prevStress)<=t.epsilon}}if(t.converged)if(t.overlapRemoved||t.allowOverlap){t.done=!0;const a=t.rings||{};t.rings=Object.keys(a).reduce((l,d)=>(l[d]=a[d].map(h=>s[h]),l),{})}else e.removeOverlaps(e,t,i),t.overlapRemoved=!0;return t},isRunning:({data:t})=>!(!t||t.converged&&(t.allowOverlap||t.done))||(t&&(t.step=-1),!1),onSync(t){if(t.renderSteps||t.done)return I_(t)},onEnd:t=>I_(t)};function I_(t){const e=t.x,s=t.y,i=t.indexes.length,n=e[t.centerIndexPos]-t.cx,r=s[t.centerIndexPos]-t.cy;for(let o=0;o<i;o++)e[o]-=n,s[o]-=r;return{indexes:t.indexes,x:e,y:s}}function rM(t,e,s){const i=t.slice().sort(dh),n=[];for(let r=0,o=e.length;r<o;r++){const a=[],l=e[r];let d=!1;for(let h=0,u=l.length;h<u;h++){const c=l[h];am(i,c)!==-1&&(c===s&&(d=!0),a.push(c))}a.length!==0&&n[d?"unshift":"push"](a.sort(dh))}return n}var oM=t=>(t.modules.layouts.register(L_),e=>{if(e.centralNode===void 0)throw new Error('concentric layout: missing parameter "centralNode"');if(e.maxIterations=e.maxIterations&&isFinite(e.maxIterations)?Math.floor(e.maxIterations):100,e.maxIterations<1)throw new RangeError("maxIterations must be a positive integer");if(e.iterationsPerRender=e.iterationsPerRender&&isFinite(e.iterationsPerRender)?Math.floor(e.iterationsPerRender):20,e.iterationsPerRender<1)throw new RangeError("iterationsPerRender must be a positive integer");if(e.epsilon=e.epsilon&&isFinite(e.epsilon)?e.epsilon:.001,e.epsilon<=0)throw new RangeError("epsilon has to be a positive number");return t.modules.layouts.start(L_.name,e)}),C_=Wt(ct({},lh),{name:"sequential"}),aM=t=>(t.modules.layouts.register(C_),(e={})=>{e.useWebWorker=!1;const s=Wt(ct({},e),{evenDistribution:!0});return t.modules.layouts.start(C_.name,s)}),lM=class extends xe{constructor(){super(...arguments),this.watchNodeObjectProperty=t=>this._ogma.modules.watcher.watchNodeObjectProperty(t),this.watchEdgeObjectProperty=t=>this._ogma.modules.watcher.watchEdgeObjectProperty(t),this.watchNodeNonObjectProperty=t=>this._ogma.modules.watcher.watchNodeNonObjectProperty(t),this.watchEdgeNonObjectProperty=t=>this._ogma.modules.watcher.watchEdgeNonObjectProperty(t)}},dM=class extends xe{constructor(){super(...arguments),this.set=(t,e)=>this._ogma.modules.brand.set(t,e),this.remove=()=>{this._ogma.modules.brand.remove()}}},hM=class extends xe{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.connectNodes.enable(t),this),this.disable=()=>(this._ogma.modules.connectNodes.disable(),this),this.enabled=()=>this._ogma.modules.connectNodes.enabled()}},uM=class extends xe{constructor(){super(...arguments),this.enable=t=>(this._ogma.modules.lasso.enable(t),this),this.disable=()=>(this._ogma.modules.lasso.disable(),this),this.enabled=()=>this._ogma.modules.lasso.enabled()}},cM=class extends xe{constructor(){super(...arguments),this.enable=t=>this._ogma.modules.legend.enable(t),this.disable=()=>this._ogma.modules.legend.disable(),this.enabled=()=>this._ogma.modules.legend.enabled(),this.getOptions=()=>this._ogma.modules.legend.getOptions(),this.export=t=>this._ogma.modules.legend.export(t)}},gM=class extends xe{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rectangleSelect.enable(t)},this.disable=()=>{this._ogma.modules.rectangleSelect.disable()},this.enabled=()=>this._ogma.modules.rectangleSelect.enabled()}},_M=class extends xe{constructor(){super(...arguments),this.enable=t=>{this._ogma.modules.resizing.enable(t)},this.disable=()=>{this._ogma.modules.resizing.disable()},this.enabled=()=>this._ogma.modules.resizing.enabled()}},mM=class extends xe{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.rewiring.enable(t)},this.disable=()=>{this._ogma.modules.rewiring.disable()},this.enabled=()=>this._ogma.modules.rewiring.enabled()}},fM=class extends xe{constructor(){super(...arguments),this.enable=(t={})=>{this._ogma.modules.snapping.enable(t)},this.disable=()=>{this._ogma.modules.snapping.disable()},this.enabled=()=>this._ogma.modules.snapping.enabled()}},pM=class extends xe{constructor(){super(...arguments),this.setZoom=(t,e)=>this._ogma.modules.camera.setZoom(t,e),this.zoomIn=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomIn():this._ogma.modules.camera.zoomIn(t),this.zoomOut=t=>this._ogma.geo.enabled()?this._ogma.modules.geo.zoomOut():this._ogma.modules.camera.zoomOut(t),this.getZoom=()=>this._ogma.modules.camera.getZoom(),this.setCenter=(t,e)=>this._ogma.modules.camera.setCenter(t,e),this.move=(t,e)=>this._ogma.modules.camera.move(t,e),this.moveToBounds=(t,e)=>{if(!(t&&t instanceof je)){if(!Qe(t)||t.length!==4)throw new Error("ogma.view.zoomToBounds requires a BoundingBox as a parameter");{const[s,i,n,r]=t;t=je.from({minX:s,minY:i,maxX:n,maxY:r})}}return this._ogma.modules.camera.moveToBounds(t,e)},this.moveTo=(t,e)=>this._ogma.modules.camera.moveTo(t,e),this.getCenter=()=>this._ogma.modules.camera.getCenter(),this.setAngle=(t,e)=>this._ogma.modules.camera.setAngle(t,e),this.rotate=(t,e)=>this._ogma.modules.camera.rotate(t,e),this.getAngle=()=>this._ogma.modules.camera.getAngle(),this.set=(t,e)=>this._ogma.modules.camera.setView(t,e),this.get=()=>this._ogma.modules.camera.getView(),this.graphToScreenCoordinates=t=>this._ogma.modules.camera.graphToScreenCoordinates(t),this.screenToGraphCoordinates=t=>this._ogma.modules.camera.screenToGraphCoordinates(t),this.getImageData=()=>this._ogma.modules.graphics.getImageData(),this.getElementAt=t=>this._ogma.modules.captor.detectElementAt(t.x,t.y,!1,!0),this.getElementsInView=()=>{const{width:t,height:e}=this.get(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return this._ogma.modules.spatial.query(s.x,s.y,i.x,i.y)},this.getBounds=()=>{const{width:t,height:e}=this.getSize(),s=this.screenToGraphCoordinates({x:0,y:0}),i=this.screenToGraphCoordinates({x:t,y:e});return{cx:(s.x+i.x)/2,cy:(s.y+i.y)/2,width:i.x-s.x,height:i.y-s.y,minX:s.x,minY:s.y,maxX:i.x,maxY:i.y}},this.getElementsInside=(t,e,s,i,n=!0)=>{const{spatial:r,camera:o}=this._ogma.modules;if(n){const a=o.graphToScreenCoordinates({x:t,y:e}),l=o.graphToScreenCoordinates({x:s,y:i});return r.queryProjected(a.x,a.y,l.x,l.y)}return r.queryProjected(t,e,s,i)},this.beforeNextFrame=()=>this._ogma.modules.dom.beforeNextFrame(),this.afterNextFrame=()=>this._ogma.modules.dom.afterNextFrame(),this.setFullScreen=t=>this._ogma.modules.dom.setFullScreen(t),this.isFullScreen=()=>this._ogma.modules.dom.isFullScreen(),this.forceResize=()=>this._ogma.modules.dom.forceResize(),this.getSize=()=>this._ogma.modules.dom.getDimensions(),this.setSize=t=>{if(!t||isNaN(t.width)||isNaN(t.height))throw new Error("Size must follow the format { width: number, height: number }");if(t.width<0)throw new Error("width must be positive");if(t.height<0)throw new Error("height must be positive");return this._ogma.modules.dom.setDimensions(t),Promise.resolve()},this.locateGraph=t=>this._ogma.modules.locate.locateGraph(t),this.locateRawGraph=(t,e)=>this._ogma.modules.locate.locateRawGraph(t,e),this.getGraphBoundingBox=({withTexts:t=!1}={})=>this._ogma.modules.locate.getGraphBoundingBox(t),this.animationInProgress=()=>this._ogma.modules.locate.isLocating()||this._ogma.modules.camera.animationInProgress(),this.getTextBoundingBox=t=>{if(!t)throw new Error("ogma.view.getTextBoundingBox: item must be a Node or an Edge");const e=t.getAttribute("text");return e==null||e===""?null:t.isNode?this._ogma.modules.labels.getTextsBoundingBox(t.toList()):this._ogma.modules.labels.getTextsBoundingBox(void 0,t.toList())},this.getNodeBadgeAt=(t,e)=>{if(!t)throw new Error("ogma.view.getNodeBadgeAt: node is not defined");return Ip(e,t._index,this._ogma.modules.graphics.getAttributesManager(),this._ogma.modules.camera,this._ogma.modules.graphics.getGraphicsEngine())}}};function Yn(t,e,s){if(t!=null){if(Array.isArray(t))return t[0];if(e&&s){if(t==="source")return Yn(s.color.get(e.getSource()._index));if(t==="target")return Yn(s.color.get(e.getTarget()._index))}return t}}function hh(t){return t==null?null:typeof t=="string"||typeof t=="number"?`${t}`:t&&hh(t.content)}function yM(t){if(t!=null)return typeof t=="string"?t:t.style||"line"}var xM=["color","radius","shape","text.content","x","y"],bM=["color","width","shape.body","text.content"];function vM(t){return t!=="all"?{nodes:["x","y"],edges:[]}:{nodes:xM,edges:bM}}function EM(t,{nodes:e,edges:s}){const i=t.getOriginalAttributes();return{nodes:e.reduce((n,r)=>(n[r.getId()]={x:i.nodes.x.get(r._index),y:i.nodes.y.get(r._index),color:Yn(i.nodes.color.get(r._index)),radius:i.nodes.radius.get(r._index),shape:i.nodes.shape.get(r._index),text:{content:i.nodes.text.content.get(r._index)}},n),{}),edges:s.reduce((n,r)=>(n[r.getId()]={color:Yn(i.edges.color.get(r._index)),width:i.edges.width.get(r._index),shape:{type:i.edges.shape.body.get(r._index)},text:{content:i.edges.text&&i.edges.text.content&&i.edges.text.content.get(r._index)}},n),{})}}function AM(t){return{nodes:t.nodes.map(({id:e,attributes:s={},data:i})=>{const{color:n,radius:r,shape:o,text:a,x:l,y:d}=s;return{id:e,x:l,y:d,color:Yn(n),size:r,shape:o,text:hh(a),data:i}}),edges:t.edges.map(({id:e,source:s,target:i,attributes:n={},data:r})=>{const{color:o,width:a,text:l,shape:d}=n;return{id:e,source:s,target:i,color:Yn(o),size:a,shape:yM(d),text:hh(l),data:r}})}}function M_(t){return t instanceof Ys?t.getId():t}function N_(t){return t instanceof Di?t.getId():t}function F_(t){return t instanceof ui?t.getId():t instanceof Ys?[t.getId()]:Qe(t)?t.map(M_):[M_(t)]}function P_(t){return t instanceof hn?t.getId():t instanceof Di?[t.getId()]:Qe(t)?t.map(N_):[N_(t)]}var Tu="visible";function SM(t,e){return t?F_(t):typeof e=="object"?F_(e.nodes):e||Tu}function wM(t,e){return t?P_(t):typeof e=="object"?P_(e.edges):e||Tu}function Dx(t,e,s,i){const n=SM(e,i),r=wM(s,i);return{nodes:t.getNodes(n),edges:t.getEdges(r)}}function kx(t,{nodeAttributes:e,edgeAttributes:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const l=Dx(t,i,n,r);return{nodes:l.nodes.toJSON({attributes:e,data:o}),edges:l.edges.toJSON({attributes:s,data:a})}}function pl(t,e,{styles:s,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a}){const{nodes:l,edges:d}=vM(s),h=kx(t,{nodeAttributes:l,edgeAttributes:d,nodes:i,edges:n,filter:r,nodeData:o,edgeData:a});if(s==="original"){const u=EM(e,Dx(t,i,n,r));for(const c of h.nodes)c.id!=null&&(c.attributes=u[c.id]);for(const c of h.edges)c.id!=null&&(c.attributes=u[c.id])}return s==="all"&&h.edges.forEach(({source:u,target:c,attributes:g})=>{if(g){const _=t.getNode(u);if(g.color==="source"&&_){const f=_.getAttribute("color");g.color=Array.isArray(f)?f[0]:f}const m=t.getNode(c);if(g.color==="target"&&m){const f=m.getAttribute("color");g.color=Array.isArray(f)?f[0]:f}}}),AM(h)}function TM(t,e){for(let s=0;s<e.length;++s){if(t==null)return;t=t[e[s]]}return t}function LM(t,e,s){for(let i=0;i<e.length-1;++i){const n=e[i];let r=t[n];r===void 0&&(r={},t[n]=r),t=r}t[e[e.length-1]]=s}function IM(t){const e=ct({},t[0]);for(const s of t)for(const i of Object.keys(s))i in e||(e[i]=void 0);return Object.keys(e)}function D_(t,e){return t==null||Array.isArray(t)&&!t.length?e:t}function CM(t){return typeof t=="string"}function MM(t,e,s,i,n){const r=e==="edges",o={};return t.forEach((a,l)=>{const d=n.get(l),h=fa(D_(s(d),e));if(!h.every(CM))throw Error(`The tab ${e} function returned an invalid value.`);const u=fa(i(a.data,h));h.forEach((c,g)=>{const _=D_(u[g],{}),m=tl(ct(ct({internal___id:a.id},r?{internal___source:a.source,internal___target:a.target}:{}),_)).reduce((f,{path:p,value:y})=>(f[p.join(".")]=y,f),{});o[c]=o[c]||[],o[c].push(m)})}),o}function NM(t){if(!t.length)return[];const e=IM(t),s=[e];for(const i of t)s.push(e.map(n=>i[n]));return s[0]=s[0].map(i=>i.replace("internal___","")),s}function FM(t,e,s){const i=new Vm;let n=e?1:3;const r=[];for(let a=0;a<t.length;++a){const l=t[a],d=new Array(n);let h=l.data;if(s){const c={};s.forEach(g=>{const _=nn(g),m=TM(h,_);LM(c,_,m)}),h=c}const u=tl(h);d[0]=l.id,e||(d[1]=l.source,d[2]=l.target);for(let c=0;c<u.length;++c){const{path:g,value:_}=u[c];g.length&&(i.has(g)?d[i.get(g)]=_:(i.set(g,n),d[n]=_,n++))}r.push(d)}const o=[];return o.push("id"),e||(o.push("source"),o.push("target")),i.keys().forEach(a=>o.push(a[a.length-1])),r.unshift(o),r.forEach(a=>a.length=n),r}var PM=/[=+\-@|%]/,DM=t=>t.length>0&&PM.test(t[0])?`'${t=t.replace("|","|")}`:t;function Rx(t){return t===void 0?"":t instanceof Date?t.toISOString():DM(""+t)}var kM={what:void 0,dataProperties:void 0,separator:",",textSeparator:'"',download:!0,filename:"graph.csv",filter:"visible",nodes:void 0,edges:void 0,nodeData:Os,edgeData:Os,styles:"none"};function RM(t,e){const{what:s,dataProperties:i,nodes:n,edges:r,separator:o,textSeparator:a,download:l,nodeData:d,edgeData:h,filename:u,filter:c}=vs(typeof e=="string"?{what:e}:e,kM),g=pl(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:n,edges:r,filter:c,nodeData:d,edgeData:h});try{const _=OM(g,{what:s,separator:o,textSeparator:a,dataProperties:i});return l&&Ui(_,u,"text"),Promise.resolve(_)}catch(_){return Promise.reject(_)}}function OM(t,{what:e,separator:s,textSeparator:i,dataProperties:n}){const r=new RegExp(i,"g");if(i&&i!=='"'&&i!=="'")throw new TypeError(`Invalid argument :"textSeparator" is not single-quote or double-quote, was ${i}`);if(e!=="nodes"&&e!=="edges")throw new TypeError('missing argument: "what": should have value "nodes" or "edges"');const o=e==="nodes";return FM(o?t.nodes:t.edges,o,n).map(a=>a.map(l=>function(h){return i+Rx(h).replace(r,`${i}${i}`).replace(/\n/g,"\\n").replace(/\r/g,"")+i}(l))).map(a=>a.join(s)).join(`
`)}var En=t=>Math.round(255*t);function k_(t,e){if(e==="integer"&&typeof t=="number"){if(t%1!=0)return"float"}else if(typeof t!="number")return typeof t=="boolean"?"boolean":"string";return e}var uh=t=>typeof t=="object"&&t!==null&&t.constructor===Object;function ch(t,e={}){return Ws(t,(s,i)=>{uh(s)?ch(s,e):e[i]=s}),e}var zM={creator:void 0,description:void 0,styles:"all",download:!0,filename:"graph.gexf",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function BM(t,e={}){const{styles:s,nodes:i,edges:n,download:r,filename:o,creator:a,description:l,filter:d,nodeData:h,edgeData:u}=vs(e,zM),c=UM(pl(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{creator:a,description:l});return r&&Ui(c,o,"text"),Promise.resolve(c)}function UM(t,e){const s=$m(),i={},n={};let r,o=0,a=0;const l=s.createElement("gexf");l.setAttribute("xmlns","http://www.gexf.net/1.2draft"),l.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz"),l.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"),l.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd"),l.setAttribute("version","1.2");const d=s.createElement("meta");if(d.setAttribute("lastmodifieddate",mm()),e.creator){const m=s.createElement("creator");r=s.createTextNode(""+e.creator),m.appendChild(r),d.appendChild(m)}if(e.description){const m=s.createElement("description");r=s.createTextNode(""+e.description),m.appendChild(r),d.appendChild(m)}const h=s.createElement("graph");h.setAttribute("mode","static");const u=s.createElement("nodes");t.nodes.forEach(m=>{const f=s.createElement("node");if(f.setAttribute("id",String(m.id)),m.text&&f.setAttribute("label",Ln(m.text)),uh(m.data)){const y=ch(m.data),b=s.createElement("attvalues");Object.keys(y).forEach(x=>{x in i||(i[x]={id:o,type:"integer"},o++);const v=y[x];i[x].type=k_(v,i[x].type);const E=s.createElement("attvalue");E.setAttribute("for",i[x].id),E.setAttribute("value",Ln(v)),b.appendChild(E)}),f.appendChild(b)}if(m.color){const y=os(m.color);if(y){const b=s.createElement("viz:color");b.setAttribute("r",En(y[0])),b.setAttribute("g",En(y[1])),b.setAttribute("b",En(y[2])),b.setAttribute("a",y[3]),f.appendChild(b)}}const p=s.createElement("viz:position");if(p.setAttribute("x",m.x),p.setAttribute("y",-m.y),f.appendChild(p),m.size){const y=s.createElement("viz:size");y.setAttribute("value",m.size),f.appendChild(y)}u.appendChild(f)});const c=s.createElement("attributes");c.setAttribute("class","node"),Object.keys(i).forEach(m=>{const f=s.createElement("attribute");f.setAttribute("id",i[m].id),f.setAttribute("title",m),f.setAttribute("type",i[m].type),c.appendChild(f)});const g=s.createElement("edges");t.edges.forEach(m=>{const f=s.createElement("edge");if(f.setAttribute("id",m.id.toString()),f.setAttribute("source",m.source),f.setAttribute("target",m.target),m.size&&f.setAttribute("weight",m.size),m.text&&f.setAttribute("label",Ln(m.text)),uh(m.data)){const p=ch(m.data),y=s.createElement("attvalues");Object.keys(p).forEach(b=>{b in n||(n[b]={id:a,type:"integer"},a++);const x=p[b];n[b].type=k_(x,n[b].type);const v=s.createElement("attvalue");v.setAttribute("for",n[b].id),v.setAttribute("value",Ln(x)),y.appendChild(v)}),f.appendChild(y)}if(m.color){const p=os(m.color);if(p){const y=s.createElement("viz:color");y.setAttribute("r",En(p[0])),y.setAttribute("g",En(p[1])),y.setAttribute("b",En(p[2])),y.setAttribute("a",p[3]),f.appendChild(y)}}if(m.size){const p=s.createElement("viz:size");p.setAttribute("value",m.size),f.appendChild(p)}g.appendChild(f)});const _=s.createElement("attributes");return _.setAttribute("class","edge"),Object.keys(n).forEach(m=>{const f=s.createElement("attribute");f.setAttribute("id",n[m].id),f.setAttribute("title",m),f.setAttribute("type",n[m].type),_.appendChild(f)}),h.appendChild(c),h.appendChild(_),h.appendChild(u),h.appendChild(g),l.appendChild(d),l.appendChild(h),s.appendChild(l),`<?xml version="1.0" encoding="UTF-8"?>${s.serialize()}`}var GM={graphId:"G",directedEdges:!0,styles:"all",download:!0,filename:"graph.graphml",nodes:void 0,edges:void 0,nodeData:t=>t,edgeData:t=>t,filter:"visible"};function VM(t,e){const{styles:s,nodes:i,edges:n,download:r,filename:o,graphId:a,directedEdges:l,filter:d,nodeData:h,edgeData:u}=vs(e,GM),c=jM(pl(t.modules.graph,t.modules.individualAttributes,{styles:s,nodes:i,edges:n,filter:d,nodeData:h,edgeData:u}),{graphId:a,directedEdges:l,noStyles:s==="none"});return r&&Ui(c,o,"text"),Promise.resolve(c)}function jM(t,e){const s=Ym();function i(c,g,_,m,f){_=_||{};const p=s.createElement(g);for(const y in _){if(!Object.prototype.hasOwnProperty.call(_,y))continue;const b=_[y];b!==void 0&&p.setAttribute(y,b)}return(m!==void 0||f)&&(Object.prototype.toString.call(m)==="[object Object]"&&(m=JSON.stringify(m)),p.appendChild(s.createTextNode(m))),c.appendChild(p),p}const n=["id","source","target"],r=["size","x","y","shape","text","color"],o={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}};e.noStyles&&(delete o.color,delete o.r,delete o.g,delete o.b,delete o.a,delete o.shape,r.pop());const a=[],l=[];function d(c,g){const _={id:c.id};r.forEach(m=>{let f=c[m];m==="y"&&f&&(f=-parseFloat(f)),f!==void 0&&(_[(g==="edge"?"edge_":"")+m]=f,m==="color"&&function(y,b){const x=os(b);x&&(y.r=x[0],y.g=x[1],y.b=x[2])}(_,f))}),Ws(c.data||{},(m,f)=>{r.indexOf(f)===-1&&n.indexOf(f)===-1&&(o[f]?o[f].for!==g&&(o[f].for="all"):o[f]={for:g,type:"string"},_[f]=m)}),g==="edge"?(_.source=c.source,_.target=c.target,l.push(_)):a.push(_)}t.nodes.forEach(c=>d(c,"node")),t.edges.forEach(c=>d(c,"edge"));const h=i(s,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});Ws(o,(c,g)=>{c.for!=="node"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"node",id:g}),c.for!=="edge"&&c.for!=="all"||i(h,"key",{"attr.name":g,"attr.type":c.type,for:"edge",id:"edge_"+g})}),i(h,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"}),i(h,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});const u=i(h,"graph",{edgedefault:e.directedEdges||e.directedEdges===void 0?"directed":"undirected",id:e.graphId?e.graphId:"G","parse.nodes":t.nodes.length,"parse.edges":t.edges.length,"parse.order":"nodesfirst"});return a.forEach(c=>{const g=i(u,"node",{id:c.id});(function(m,f){const p=i(m,"data",{key:"nodegraphics"}),y=i(p,"y:ShapeNode");i(y,"y:Geometry",{x:f.x,y:f.y,width:f.size,height:f.size}),e.noStyles||i(y,"y:Fill",{color:Ld(f.color),transparent:!1}),i(y,"y:NodeLabel",null,f.text||""),i(y,"y:Shape",{type:f.shape})})(g,c),Ws(c,(_,m)=>{n.indexOf(m)===-1&&i(g,"data",{key:m},_,!0)})}),l.forEach(c=>{const g=i(u,"edge",{id:c.id,source:c.source,target:c.target});(function(m,f){const p=i(m,"data",{key:"edgegraphics"}),y=i(p,"y:PolyLineEdge");i(y,"y:LineStyle",{type:f.edge_type,color:e.noStyles?void 0:Ld(f.edge_color),width:f.edge_size}),i(y,"y:EdgeLabel",null,f.edge_label)})(g,c),Ws(c,(_,m)=>{n.indexOf(m)===-1&&i(g,"data",{key:m},_,!0)})}),`<?xml version="1.0" encoding="UTF-8"?>
${Bh(s)}`}var qM={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:Os,edgeData:Os,filter:"visible",pretty:!1,download:!0,filename:"graph.json",anonymize:!1};function HM(t,e={}){e.anonymize&&(e={nodeAttributes:"all",edgeAttributes:"all",nodeData:Br,edgeData:Br,filter:e.filter||"all",download:e.download,pretty:e.pretty,filename:e.filename});const{nodeAttributes:s,edgeAttributes:i,nodeData:n,edgeData:r,filter:o,pretty:a,download:l,filename:d}=vs(e,qM),h=kx(t.modules.graph,{nodeAttributes:s,edgeAttributes:i,filter:o,nodeData:n,edgeData:r}),u=a?JSON.stringify(h,null," "):JSON.stringify(h);return l&&Ui(u,d,"text"),Promise.resolve(h)}function XM(t,e){return t.getBoundingBox().computeForZoom(e).extend(je.fromValues(t.getAttribute("x"),t.getAttribute("y"),t.map(s=>s.getAttribute("radius")+s.getAttribute("innerStroke.width")+s.getAttribute("outerStroke.width"))))}function WM(t,e,s){const i=e.view.graphToScreenCoordinates(s.bottomLeft()),n=e.view.graphToScreenCoordinates(s.topRight()),r=Math.abs(n.x-i.x),o=Math.abs(n.y-i.y),a=Math.min(t.width/r,t.height/o);t.width=r*a,t.height=o*a}function Ox(t,e={}){const s=t.view.get(),i=typeof e.margin=="number"?e.margin:0,n={pixelRatio:e.pixelRatio||fs(),angle:0,backgroundColor:null,zoom:0,x:0,y:0,width:0,height:0,hideImages:!1,renderBackground:!0,isBufferDisplayable:zr};if(e.width&&e.height?(n.width=e.width,n.height=e.height):(n.width=s.width,n.height=s.height),e.clip)n.zoom=s.zoom,n.x=s.x,n.y=s.y;else{const r=XM(t.getNodes(e.filter),s.zoom);if(e.texts){const o=t.modules.labels.getTextsBoundingBox();o.isValid()&&r.extend(o)}e.width!=null&&isFinite(e.width)&&e.height!=null&&isFinite(e.height)||WM(n,t,r),n.width=Math.max(n.width,2*i),n.height=Math.max(n.height,2*i),n.x=r.cx,n.y=r.cy,n.zoom=Math.min((n.width-2*i)/r.width,(n.height-2*i)/r.height)}return t.modules.geo.isEnabled()?n.backgroundColor=null:e.background!==void 0&&(n.backgroundColor=e.background),n}function gh(t,e,s,i,n=!1){const r=Wt(ct({},s),{hideImages:n,angle:s.angle||0,currentTime:rs(),isBufferDisplayable:l=>e.texts||!op(l)}),o={};if(e.badges===!1){const l={text:null,image:null};o.badges={topLeft:l,topRight:l,bottomRight:l,bottomLeft:l}}const a=t.styles.getClass(Wi);return a&&a.update({nodeAttributes:o}),t.modules.graphics.export(i,r,e.filter||Tu,e)}var Jo=t=>({download:!0,filter:"visible",filename:`graph.${t}`,clip:!1,margin:10,width:void 0,height:void 0,background:null,badges:!0,legend:void 0,texts:!0,preventOverlap:!0,images:!0,textWatermark:{content:"",fontFamily:"Arial",fontSize:48,fontStyle:void 0,fontColor:"red",repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageWatermark:{url:void 0,width:void 0,height:void 0,repeat:!1,angle:0,alpha:.65,space:50,x:void 0,y:void 0},imageCrossOrigin:void 0,layers:!0,pixelRatio:void 0}),$M={png:Jo("png"),jpg:Jo("jpg"),tiff:Jo("tiff"),gif:Jo("gif")};function YM(t){const{canvas:e,parameters:s}=t;return s.textWatermark.content&&R_(e,s.textWatermark,iN,nN),s.imageWatermark.url?Am(s.imageWatermark.url).then(i=>(i&&(s.imageWatermark.content=i,R_(e,s.imageWatermark,oN,rN)),t)):t}function ZM(t){const{ogma:e,canvas:s,parameters:i}=t,n=e.modules.legend;let r=null;return i.legend===void 0&&(r=!!n.enabled()&&n.getCurrentOptions()),i.legend===!0&&(r={}),r&&n.exportOnCanvas(s,r,t.parameters.pixelRatio),t}function KM(t){const{canvas:e,parameters:s,view:i}=t;if(!i.renderBackground)return t;i.renderBackground=!1;const n=e.getContext("2d");return n.fillStyle=s.background,n.fillRect(0,0,e.width,e.height),t}function QM(t){const{ogma:e,view:s}=t;return e.modules.geo.isEnabled()?e.modules.geo.exportBackground(s).then(i=>{const n=s.width*s.pixelRatio,r=s.height*s.pixelRatio,o=Je(n,r),a=o.getContext("2d");return a.drawImage(i,(n-i.width)/2,(r-i.height)/2),a.drawImage(t.canvas,0,0),t.canvas=o,t}):t}function JM(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,canvas:i,below:!0}).then(()=>t):t}function tN(t){const{ogma:e,view:s,canvas:i,parameters:n}=t;return n.layers?e.modules.layers.export({view:s,below:!1,canvas:i}).then(()=>t):t}function eN(t){const{ogma:e,parameters:s,canvas:i,view:n}=t,r=i.getContext("2d");return gh(e,s,n,"canvas",!s.images).then(o=>{try{const a=o.getContext("2d");if(!a)throw new Error("Failed to render graph");return a.getImageData(0,0,1,1),r.drawImage(o,0,0,i.width,i.height),t}catch(a){return Mi(a),gh(e,s,n,"canvas",!0).then(l=>(r.drawImage(l,0,0,i.width,i.height),t))}})}function sN({canvas:t,parameters:e,type:s}){const i=t.toDataURL("image/"+s);return e.download&&Ui(i,e.filename,"dataURL"),i}function ta(t,e,s){const i=vs(e,$M[s]);i.background===null&&(i.background=t.modules.graphics.getTransparentBackgroundColor());const n=Ox(t,i);i.pixelRatio=n.pixelRatio;const r=Je(n.width*n.pixelRatio,n.height*n.pixelRatio),o={ogma:t,parameters:i,canvas:r,view:n,type:s};return Promise.resolve().then(()=>o).then(KM).then(QM).then(JM).then(eN).then(tN).then(YM).then(ZM).then(sN).then(a=>(t.modules.events.fire("afterImageExport"),a))}function iN(t,e,s,i){t.textAlign="center",t.textBaseline="middle",t.fillText(e,s,i)}function nN(t,e,s){return{width:t.measureText(e).width,height:s}}function rN(t,e,s,i,n){return{width:i===void 0?e.width:i,height:n===void 0?e.height:n}}function oN(t,e,s,i,n,r){t.drawImage(e,s-n/2,i-r/2,n,r)}function R_(t,e,s,i){if(!e)return;if(typeof e!="object")e={content:e};else if(!e.content)return;const{fontFamily:n,fontSize:r,fontStyle:o,fontColor:a,repeat:l,alpha:d,space:h,content:u}=e;let c=e.angle;const g=t.getContext("2d"),_=t.width,m=t.height,f=e.x===void 0?_/2:e.x,p=e.y===void 0?m/2:e.y,y=e.height,b=e.width;c=c/180*Math.PI,Fi(g,n,r,o),g.fillStyle=a,g.globalAlpha=d;const x=i(g,u,r,b,y);if(l){const v=x.width+h,E=x.height+h,w=Math.sqrt(_*_+m*m);g.save(),g.translate(0,0),g.rotate(c);for(let A=0;A<w;A+=v)for(let I=0;I<w;I+=E)s(g,u,A,I,x.width,x.height),I!==0&&s(g,u,A,-I,x.width,x.height);g.restore()}else g.save(),g.translate(f,p),g.rotate(c),s(g,u,0,0,x.width,x.height),g.restore()}var aN={download:!0,filename:"graph.svg",width:void 0,height:void 0,background:null,texts:!0,preventOverlap:!0,groupSemantically:!0,images:!0,badges:!0,embedFonts:!1,layers:!0,clip:!1,margin:10,prefix:"ogma"};function lN(t,e){const s=vs(e,aN),{background:i,filename:n,download:r,layers:o}=s,a=t.modules.graphics;i===null&&(s.background=a.getTransparentBackgroundColor());const l=Ox(t,s);return gh(t,s,l,"svg",!s.images).then(d=>(d.removeAttribute("pointer-events"),d.setAttribute("version","1.1"),d.setAttributeNS(xd,"xmlns",Fh),d.setAttributeNS(xd,"xmlns:xlink",Em),d)).then(d=>s.groupSemantically?hN(t,d,s):d).then(d=>cN(d,s)).then(d=>dN(t,l,d)).then(d=>O_(t,l,d,o,!0)).then(d=>O_(t,l,d,o,!1)).then(d=>(t.modules.events.fire("afterImageExport"),d)).then(d=>{const h=`<?xml version="1.0" encoding="utf-8"?>${Bh(d)}`;return r&&Ui(h,n,"text/xml"),h})}function dN(t,e,s){return t.modules.geo.isEnabled()?t.modules.geo.exportBackground(Wt(ct({},e),{pixelRatio:1})).then(i=>{const n=de("image",{width:i.width,height:i.height,x:0,y:0,href:i.toDataURL()});return s.insertBefore(n,s.children[0]),s}):Promise.resolve(s)}function O_(t,e,s,i,n=!1){return i?t.modules.layers.export({view:e,svg:s,below:n}).then(()=>s):Promise.resolve(s)}function hN(t,e,s){const i=e.childNodes[2],n=i.childNodes,r={},o=s.prefix;for(let g=0;g<n.length;g++){const _=n[g],m=_.getAttribute(Is);m!=null&&(r[m]=r[m]||[],r[m].push(_))}const a=Object.keys(r),l=t.modules.graph,d=l.getNodeAttribute("id"),h=l.getEdgeAttribute("id"),u=de("g",{class:`${o}-edges`}),c=de("g",{class:`${o}-nodes`});for(let g=0;g<a.length;g++){const _=a[g],m=_.charAt(0)==="n",f=parseInt(_.substring(1)),p=r[_],y=Ln((m?d:h).get(f).toString()),b=de("g");b.setAttribute(`data-${m?"node":"edge"}-id`,y),b.setAttribute("class",`${o}-${m?"node":"edge"}`);for(let x=0;x<p.length;x++){const v=p[x];b.appendChild(v),v.removeAttribute(Is)}(m?c:u).appendChild(b)}return i.appendChild(u),i.appendChild(c),e}function uN(t){const e=[].concat(Array.prototype.slice.call(t.getElementsByTagName("text")||[])),s=[],i={};for(let n=0;n<e.length;n++){const r=e[n].parentNode.getAttribute("font-family");if(typeof r=="string"){const o=r.split(",");for(let a=0;a<o.length;a++){const l=o[a].replace(/['"]/g,"");l===""||i[l]||(i[l]=!0,s.push(l))}}}return{list:s,map:i}}function cN(t,e){const s=uN(t).map;return km().then(i=>i.filter(n=>s[n.name])).then(i=>Rm(i,!!e.embedFonts)).then(i=>{if(i.length!==0){const n=de("style");for(let r=0;r<i.length;r++)n.appendChild(Ph(i[r]));t.childNodes[0].appendChild(n)}return t})}var gN={what:void 0,dataProperties:void 0,filter:"visible",nodes:void 0,edges:void 0,download:!0,filename:"graph.xlsx",tab:void 0,nodeData:void 0,edgeData:void 0};function _N(t,e={}){typeof e=="string"&&(e={what:e});const{what:s,nodes:i,edges:n,tab:r={nodes:()=>"nodes",edges:()=>"edges"},download:o,filename:a,dataProperties:l,filter:d,nodeData:h,edgeData:u}=vs(e,gN);r.nodes||(r.nodes=()=>"nodes"),r.edges||(r.edges=()=>"edges");const c=pl(t.modules.graph,t.modules.individualAttributes,{styles:"none",nodes:i,edges:n,filter:d,nodeData:_=>_,edgeData:_=>_}),g=mN(c,{what:s,tabFunctions:r,tabContentFunctions:{nodes:h||(_=>pd(Or(_||{}),l)),edges:u||(_=>pd(Or(_||{}),l))}},{nodes:t.modules.graph.getNodes(c.nodes.map(({id:_})=>_)),edges:t.modules.graph.getEdges(c.edges.map(({id:_})=>_))});return o&&Ui(g,a,"blob"),Promise.resolve(g)}function mN(t,{what:e,tabFunctions:s,tabContentFunctions:i},n){const r=Ms("XLSX")||Ms("xlsx",{throwOnError:!0});if(!r)throw Error('The xlsx exports requires the "xlsx" peer dependency to be associated');const o=new pN;if(e){if(e!=="nodes"&&e!=="edges")throw new TypeError(`Invalid argument: "what" is not "nodes" or "edges", was ${e}`);e==="nodes"&&(t.edges=[]),e==="edges"&&(t.nodes=[])}const a={};for(const l of["nodes","edges"]){const d=MM(t[l],l,s[l],i[l],n[l]);for(const h of Object.keys(d))a[h]=[...a[h]||[],...d[h]]}for(const l of Object.keys(a))o.SheetNames.push(l),o.Sheets[l]=fN(r,NM(a[l]));return o.SheetNames.length===0&&(o.SheetNames=["nodes","edges"],o.Sheets.nodes={},o.Sheets.edges={}),Ur([yN(r.write(o,{bookType:"xlsx",bookSST:!1,type:"binary"}))])}function fN(t,e){const s={},i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let n=0;n!==e.length;++n){const r=e[n];for(let o=0;o!==r.length;++o){const a=r[o];i.s.r>n&&(i.s.r=n),i.s.c>o&&(i.s.c=o),i.e.r<n&&(i.e.r=n),i.e.c<o&&(i.e.c=o);const l={v:Rx(a)};s[t.utils.encode_cell({c:o,r:n})]=l}}return i.s.c<1e7&&(s["!ref"]=t.utils.encode_range(i)),s}var pN=class{constructor(){this.SheetNames=[],this.Sheets={}}};function yN(t){const e=new ArrayBuffer(t.length),s=new Uint8Array(e);for(let i=0;i!==t.length;++i)s[i]=255&t.charCodeAt(i);return e}var xN=class{getNodesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getNodes(e)}getEdgesByClassName(t,e){return this.modules.classes.getClassByName(t,!0).getEdges(e)}},_h={};to(_h,{gexf:()=>zx,gexfFromUrl:()=>Lu,graphml:()=>Vx,graphmlFromUrl:()=>jx,janus:()=>Bx,json:()=>Ux,jsonFromUrl:()=>Iu,mtx:()=>bN,mtxFromUrl:()=>vN,neo4j:()=>Gx});var Qs=Sh(sm()),zx=t=>Promise.resolve(Qs.gexf(t)),Lu=t=>Zn(t).then(e=>Qs.gexf(e)),Bx=t=>Promise.resolve(Qs.janus(t)),Ux=(t,e)=>Promise.resolve(Qs.json(t,e)),Iu=(t,e)=>Zn(t).then(s=>Qs.json(s,e)),Gx=t=>Promise.resolve(Qs.neo4j(t)),Vx=t=>Promise.resolve(Qs.graphml(t)),jx=t=>Zn(t).then(e=>Qs.graphml(e)),bN=t=>Promise.resolve(Qs.mtx(t)),vN=t=>Zn(t).then(e=>Qs.mtx(e)),EN=class extends xe{constructor(){super(...arguments),this.wait=t=>new Promise(e=>setTimeout(e,t)),this.initRandomGraph=t=>this._ogma.generate.random(t).then(this._ogma.setGraph).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.initGrid=t=>{const e=Math.ceil(Math.sqrt(t));return this._ogma.generate.grid({rows:e,columns:e}).then(s=>this._ogma.setGraph(s)).then(()=>this._ogma.view.locateGraph())},this.initLine=t=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:t?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]}),this._ogma.view.locateGraph()),this.initSingleNode=()=>(this._ogma.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}],edges:[]}),this._ogma.view.locateGraph()),this.initContinuousRenderLoop=({triggerKey:t="r",start:e=!0}={})=>{let s=e;const i=()=>{s&&this._ogma.modules.dom.beforeNextFrame().then(i)};document.addEventListener("keydown",({key:n})=>{n===t&&(s=!s,i())}),i()},this.appendToBody=()=>{const t=document.createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.bottom="0",t.style.right="0",document.body.appendChild(t),this._ogma.setContainer(t)},this.loadFile=t=>(t.endsWith(".gexf")?Lu(t):Iu(t)).then(e=>this._ogma.setGraph(e)).then(()=>this._ogma.view.locateGraph()).then(()=>this._ogma.view.afterNextFrame()),this.enableLasso=t=>{this._ogma.events.on("dragStart",()=>{this._ogma.keyboard.isKeyPressed("ctrl")&&this._ogma.tools.lasso.enable(t)})},this.randomizeGraph=({minX:t=0,minY:e=0,maxX:s=500,maxY:i=500}={})=>this._ogma.getNodes().setAttributes(this._ogma.getNodes().map(()=>({x:t+Math.random()*(s-t),y:e+Math.random()*(i-e)})))}},AN=class{setContainer(t){this.modules.dom.setContainer(t)}getContainer(){return this.modules.dom.getContainer()}},SN=class extends xe{constructor(){super(...arguments),this.once=(t,e)=>(this._ogma.modules.events.once(t,e),this),this.removeListener=t=>{this._ogma.modules.events.off(t)},this.onNodesAdded=t=>(this._ogma.events.on("addNodes",t),this._ogma),this.onBeforeNodesRemoved=t=>(this._ogma.events.on("beforeRemoveNodes",t),this._ogma),this.onNodesRemoved=t=>(this._ogma.events.on("removeNodes",t),this._ogma),this.onEdgesAdded=t=>(this._ogma.events.on("addEdges",t),this._ogma),this.onBeforeEdgesRemoved=t=>(this._ogma.events.on("beforeRemoveEdges",t),this._ogma),this.onEdgesRemoved=t=>(this._ogma.events.on("removeEdges",t),this._ogma),this.onGraphCleared=t=>(this._ogma.events.on("clearGraph",t),this._ogma),this.onNodesClassAdded=(t,e)=>(this._ogma.modules.classes.onNodeClassAdded(t,e),this._ogma),this.onNodesClassRemoved=(t,e)=>(this._ogma.modules.classes.onNodeClassRemoved(t,e),this._ogma),this.onEdgesClassAdded=(t,e)=>(this._ogma.modules.classes.onEdgeClassAdded(t,e),this._ogma),this.onEdgesClassRemoved=(t,e)=>(this._ogma.modules.classes.onEdgeClassRemoved(t,e),this._ogma),this.onNodeDragStart=t=>(this._ogma.events.on("nodesDragStart",t),this._ogma),this.onNodeDragProgress=t=>(this._ogma.events.on("nodesDragProgress",t),this._ogma),this.onNodeDragEnd=t=>(this._ogma.events.on("nodesDragEnd",t),this._ogma),this.onDrop=t=>(this._ogma.events.on("drop",t),this._ogma),this.onNodesSelected=t=>this.onNodesClassAdded(Ae,t),this.onNodesUnselected=t=>this.onNodesClassRemoved(Ae,t),this.onEdgesSelected=t=>this.onEdgesClassAdded(Ae,t),this.onEdgesUnselected=t=>this.onEdgesClassRemoved(Ae,t),this.onNodeDataChange=t=>(this._ogma.events.on("updateNodeData",t),this._ogma),this.onEdgeDataChange=t=>(this._ogma.events.on("updateEdgeData",t),this._ogma),this.onAnimate=t=>(this._ogma.events.on("animate",t),this._ogma),this.onMouseMove=t=>(this._ogma.events.on("mousemove",t),this._ogma),this.onMouseButtonDown=t=>(this._ogma.events.on("mousedown",t),this._ogma),this.onMouseButtonUp=t=>(this._ogma.events.on("mouseup",t),this._ogma),this.onClick=t=>(this._ogma.events.on("click",t),this._ogma),this.onDoubleClick=t=>(this._ogma.events.on("doubleclick",t),this._ogma),this.onMouseWheel=t=>(this._ogma.events.on("mousewheel",t),this._ogma),this.onHover=t=>(this._ogma.events.on("mouseover",t),this._ogma),this.onUnhover=t=>(this._ogma.events.on("mouseout",t),this._ogma),this.onDragStart=t=>(this._ogma.events.on("dragStart",t),this._ogma),this.onDragProgress=t=>(this._ogma.events.on("dragProgress",t),this._ogma),this.onDragEnd=t=>(this._ogma.events.on("dragEnd",t),this._ogma),this.onGestureStart=t=>(this._ogma.events.on("gestureStart",t),this._ogma),this.onGestureProgress=t=>(this._ogma.events.on("gestureProgress",t),this._ogma),this.onGestureEnd=t=>(this._ogma.events.on("gestureEnd",t),this._ogma),this.onRendererStateChange=t=>(this._ogma.events.on("rendererStateChange",t),this._ogma),this.onZoomProgress=t=>(this._ogma.events.on("zoom",t),this._ogma),this.onViewChanged=t=>(this._ogma.events.on("viewChanged",t),this._ogma),this.onNodesConnected=t=>(this._ogma.events.on("connectNodes",t),this._ogma),this.onGeoModeEnabled=t=>(this._ogma.events.on("geoEnabled",t),this._ogma),this.onGeoModeDisabled=t=>(this._ogma.events.on("geoDisabled",t),this._ogma),this.onGeoModeLoaded=t=>(this._ogma.events.on("geoLoaded",t),this._ogma),this.onLayoutStart=t=>(this._ogma.events.on("layoutStart",t),this._ogma),this.onLayoutComplete=t=>(this._ogma.events.on("layoutEnd",t),this._ogma),this.onLayoutComputed=t=>(this._ogma.events.on("layoutComputed",t),this._ogma),this.onTooltipShown=t=>(this._ogma.events.on("tooltipShow",t),this._ogma),this.onTooltipHidden=t=>(this._ogma.events.on("tooltipHide",t),this._ogma),this.onTransformationEnabled=t=>(this._ogma.events.on("transformationEnabled",t),this._ogma),this.onTransformationDisabled=t=>(this._ogma.events.on("transformationDisabled",t),this._ogma),this.onTransformationSetIndex=t=>(this._ogma.events.on("transformationSetIndex",t),this._ogma),this.onTransformationDestroyed=t=>(this._ogma.modules.events.on("transformationDestroyed",t),this._ogma),this.onTransformationRefreshed=t=>(this._ogma.events.on("transformationRefresh",t),this._ogma)}on(t,e){return this._ogma.modules.events.on(t,e),this}off(t){return this._ogma.modules.events.off(t),this}onKeyPress(t,e){return this._ogma.modules.keyboard.onKeyPress(t,e),this._ogma}},wN=class extends xe{constructor(t){super(t),this.csv=e=>RM(this._ogma,e),this.xlsx=e=>(e&&e.dataProperties&&void 0,_N(this._ogma,e)),this.gexf=e=>BM(this._ogma,e),this.graphml=(e={})=>VM(this._ogma,e),this.json=(e={})=>HM(this._ogma,e),this.svg=(e={})=>lN(this._ogma,e),this.png=(e={})=>ta(this._ogma,e,"png"),this.jpg=(e={})=>ta(this._ogma,e,"jpg"),this.tiff=(e={})=>ta(this._ogma,e,"tiff"),this.gif=(e={})=>ta(this._ogma,e,"gif"),t.styles.createClass({name:Wi,isBuiltin:!0})}},ss=Sh(m0()),TN=class extends xe{constructor(){super(...arguments),this.balancedTree=t=>Promise.resolve(ss.balancedTree.generate(ss.balancedTree.configure(t))),this.barabasiAlbert=t=>Promise.resolve(ss.barabasiAlbert.generate(ss.barabasiAlbert.configure(t))),this.erdosRenyi=t=>Promise.resolve(ss.erdosRenyi.generate(ss.erdosRenyi.configure(t))),this.flower=t=>Promise.resolve(ss.flower.generate(ss.flower.configure(t))),this.grid=t=>Promise.resolve(ss.grid.generate(ss.grid.configure(t))),this.path=t=>Promise.resolve(ss.path.generate(ss.path.configure(t))),this.random=t=>Promise.resolve(ss.random.generate(ss.random.configure(t))),this.randomTree=t=>Promise.resolve(ss.randomTree.generate(ss.randomTree.configure(t)))}},LN=class{reloadFonts(){this.modules.graphics.reloadFonts()}},IN=class extends xe{constructor(){super(...arguments),this.gexf=t=>zx(t),this.gexfFromUrl=t=>Lu(t),this.janus=t=>Bx(t),this.json=(t,e)=>Ux(t,e),this.jsonFromUrl=(t,e)=>Iu(t,e),this.neo4j=t=>Gx(t),this.graphml=t=>Vx(t),this.graphmlFromUrl=t=>jx(t)}},CN=class extends xe{constructor(t){super(t),this.stop=()=>this._ogma.modules.layouts.stop(),this.concentric=hC(t),this.radial=oM(t),this.force=_2(t),this.forceLink=m2(t),this.hierarchical=nM(t),this.sequential=aM(t),this.grid=f2(t)}},MN=class extends xe{constructor(){super(...arguments),this.move=t=>this._ogma.modules.virtualMouse.move(t),this.down=t=>this._ogma.modules.virtualMouse.down(t),this.up=t=>this._ogma.modules.virtualMouse.up(t),this.click=t=>this._ogma.modules.virtualMouse.click(t),this.rightClick=t=>this._ogma.modules.virtualMouse.rightClick(t),this.doubleclick=t=>this._ogma.modules.virtualMouse.doubleclick(t),this.drag=(t,e)=>this._ogma.modules.virtualMouse.drag(t,e),this.wheel=t=>this._ogma.modules.virtualMouse.wheel(t)}},NN=class extends xe{constructor(){super(...arguments),this.map=t=>this._ogma.modules.rules.createMapping(t),this.slices=t=>this._ogma.modules.rules.createSlices(t),this.template=t=>this._ogma.modules.rules.createTemplate(t)}},FN=class{clearSelection(){return this.modules.selection.clear()}getSelectedNodes(){return this.modules.selection.getSelectedNodes()}getNonSelectedNodes(){return this.modules.selection.getNonSelectedNodes()}getSelectedEdges(){return this.modules.selection.getSelectedEdges()}getNonSelectedEdges(){return this.modules.selection.getNonSelectedEdges()}},PN=class{setOptions(t){return this.modules.settings.update(t)}getOptions(){return this.modules.settings.get()}},DN=class extends xe{constructor(){super(...arguments),this.setNodesVisibility=t=>this._ogma.modules.graphics.setNodesVisibility(t),this.setEdgesVisibility=t=>this._ogma.modules.graphics.setEdgesVisibility(t),this.setNodeTextsVisibility=t=>this._ogma.modules.graphics.setNodeTextsVisibility(t),this.setEdgeTextsVisibility=t=>this._ogma.modules.graphics.setEdgeTextsVisibility(t),this.addRule=(t={})=>this._ogma.modules.styleRules.addRule(t),this.getRuleList=()=>this._ogma.modules.styleRules.getRuleList(),this.addNodeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({nodeAttributes:s,nodeSelector:i})},this.addEdgeRule=(t,e)=>{let s,i;return e===void 0?(s=t,i=void 0):(s=e,i=t),this.addRule({edgeAttributes:s,edgeSelector:i})},this.getNodeRules=()=>this.getRuleList().filter(t=>t.getDefinition().edgeAttributes===void 0),this.getEdgeRules=()=>this.getRuleList().filter(t=>t.getDefinition().nodeAttributes===void 0),this.createClass=t=>this._ogma.modules.classes.createClass(t),this.getClass=t=>this._ogma.modules.classes.getClassByName(t),this.getClassList=()=>this._ogma.modules.classes.getClassList(),this.setHoveredNodeAttributes=(t,e)=>{this._ogma.modules.hover.updateNodeAttributes(t,e)},this.setHoveredEdgeAttributes=(t,e)=>{this._ogma.modules.hover.updateEdgeAttributes(t,e)},this.setSelectedNodeAttributes=(t,e)=>this._ogma.modules.selection.setNodeAttributes(t,!!e),this.setSelectedEdgeAttributes=(t,e)=>this._ogma.modules.selection.setEdgeAttributes(t,!!e),this.setTheme=({nodeAttributes:t,edgeAttributes:e,selectedNodeAttributes:s,selectedEdgeAttributes:i,hoveredNodeAttributes:n,hoveredEdgeAttributes:r})=>{this._ogma.modules.pulses.setTheme(t&&t.pulse||{},e&&e.pulse||{}),this._ogma.modules.graphics.getAttributesManager().setDefaultAttributes(t||{},e||{}),this.setSelectedNodeAttributes(s||{}),this.setSelectedEdgeAttributes(i||{}),this.setHoveredNodeAttributes(n||{}),this.setHoveredEdgeAttributes(r||{})}}},kN=class extends xe{constructor(){super(...arguments),this.onNodeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.node",t,e)},this.onNodeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.node",t,e)},this.onNodeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.node",t,e)},this.onNodeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.node",t,e)},this.onEdgeHover=(t,e={})=>{this._ogma.modules.tooltip.setHandler("hover.edge",t,e)},this.onEdgeClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.edge",t,e)},this.onEdgeRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.edge",t,e)},this.onEdgeDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.edge",t,e)},this.onBackgroundClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.left.background",t,e)},this.onBackgroundRightClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("click.right.background",t,e)},this.onBackgroundDoubleClick=(t,e={})=>{this._ogma.modules.tooltip.setHandler("doubleclick.left.background",t,e)},this.refresh=()=>this._ogma.modules.tooltip.refresh(),this.isShown=()=>this._ogma.modules.tooltip.isShown(),this.hide=()=>{this._ogma.modules.tooltip.hide()},this.show=(t,e)=>this._ogma.modules.tooltip.show(t,e)}},RN=class extends xe{constructor(t){super(t),this.lasso=new uM(t),this.connectNodes=new hM(t),this.legend=new cM(t),this.rectangleSelect=new gM(t),this.resize=new _M(t),this.rewire=new mM(t),this.snapping=new fM(t),this.tooltip=new kN(t),this.brand=new dM(t)}};function ON(t,e,s){const i=t.getEdge(e.id||"");return!i||i.getTransformation()===s}var Ba=t=>!0,Kr=t=>"";function Qr(t,e,s){return{}}var qx=class extends cn{constructor(t){super(t),this._checkEdgeDataUpdate=!0,this._checkNodeDataUpdate=!0,this._nodeSelector=t.nodeSelector||Ba,this._nodeGroupIdFunction=t.nodeGroupIdFunction||Kr,this._nodeGenerator=t.nodeGenerator||Qr,this._edgeSelector=t.edgeSelector||Ba,this._edgeGroupIdFunction=t.edgeGroupIdFunction||Kr,this._edgeGenerator=t.edgeGenerator||Qr,this._edgeSource=t.edgeSource,this._edgeTarget=t.edgeTarget,this._separateEdgesByDirection=t.separateEdgesByDirection,this._groupSelfLoopEdges=!!t.groupSelfLoopEdges,this._groupEdges=t.groupEdges}_computeNodeGroupId(t){if(this._nodeGroupIdFunction)return this._nodeSelector(t)?this._nodeGroupIdFunction(t):void 0}_computeEdgeGroupId(t){if(this._edgeGroupIdFunction)return this._edgeSelector(t)?this._edgeGroupIdFunction(t):void 0}_addMetaNodes(){const t=this._id,e=this._ogma,s=e.getNodes().reduce((a,l)=>l.getTransformation()===this?a.concat(l.getSubNodes()):a.concat(l.toList()),this._ogma.nodeList()),i=new Map;for(let a=0;a<s.size;++a){const l=s.get(a),d=this._computeNodeGroupId(l);if(d!==void 0){let h=i.get(d);h||(h={id:d,nodes:[]},i.set(d,h)),h.nodes.push(l)}}const n=Pi(i),r=[];n.map(({nodes:a})=>e.getNodes(a));const o=[];for(let a=0;a<n.length;++a){const l=n[a],d=l.id,h=e.getNodes(l.nodes),u=this._nodeGenerator(h,d,this);u!==null&&(r.push(h),u.id===void 0&&(u.id=Ua(d,t)),u.position=ou(h.getPosition()),o.push(u))}return e.addNodes(o.map(a=>({id:a.id,attributes:a.position})),{virtual:!0}).then(()=>{const a=e.getNodes(o.map(d=>d.id));a.replaceOriginalAttributes(o.map(d=>d.attributes),["x","y","radius"]);const l=a.getData();for(let d=0;d<l.length;d++){const h=l[d],u=o[d];l[d]=xs(xs(h,u.data),this._context.nodeDataUpdates.get(a._indexes[d]))}return this._checkNodeDataUpdate=!1,a.setData(null,l),a.setVisible(!0),this._ogma.modules.grouping.setSubElements(a,r),r.forEach((d,h)=>{this._ogma.modules.grouping.setMetaElement(d,a.get(h))}),a})}_addMetaEdges(){const t=this._id,e=this._ogma,s=e.getEdges(),i=new Map,n=this._ogma.modules.graphics.getAttributesManager().getUsedEdgeAttributes().filter(l=>l!=="curvature");for(let l=0;l<s.size;++l){const d=s.get(l),h=this._computeEdgeGroupId(d);if(h!==void 0){const u=this._edgeSource(d),c=this._edgeTarget(d),g=this._groupEdges?BN(h,u.getId(),c.getId(),this._separateEdgesByDirection):String(d.getId());let _=i.get(g);_||(_={id:g,source:u,target:c,edges:[]},i.set(g,_)),_.edges.push(d)}}const r=Pi(i),o=[],a=[];for(let l=0;l<r.length;++l){const d=r[l],h=d.id,u=e.getEdges(d.edges),c=this._groupEdges?this._edgeGenerator(u,h,this):UN(u,n);if(c!==null){if(o.push(u),c.id!=null&&!ON(e,c,this))throw Error(`The id ${c.id} returned by the edgeGenerator function is not a unique id.`);c.id===void 0&&(c.id=Ua(h,t)),c.source=d.source.getId(),c.target=d.target.getId(),a.push(c)}}return e.addEdges(zN(a),{virtual:!0}).then(()=>{const l=e.getEdges(a.map(h=>h.id));l.setAttributes(a.map(h=>h.attributes));const d=l.getData();for(let h=0;h<d.length;h++){const u=a[h],c=d[h];d[h]=xs(c,u.data)}return this._checkEdgeDataUpdate=!1,l.setData(null,d),l.setVisible(!1),this._ogma.modules.grouping.setSubElements(l,o),o.forEach((h,u)=>{this._ogma.modules.grouping.setMetaElement(h,l.get(u))}),l})}_removeMetaEdge(t){t.forEach(e=>{const s=e.getSubEdges();if(!s)return;const i=e.getMetaEdge()||null;this._ogma.modules.grouping.setMetaElement(s,i),i&&this._ogma.modules.grouping.setSubElements(i.toList(),[s.concat((i.getSubEdges()||this._ogma.edgeList()).filter(n=>n!==e))]),s.filter(n=>n.getTarget().isVisible()&&n.getSource().isVisible()).setVisible(!0)})}_removeMetaNode(t){t.forEach(e=>{const s=e.getSubNodes();s&&(this._ogma.modules.grouping.setMetaElement(s,null),s.setVisible(!0))})}_checkChanges(t,e){const s=e?this._context.nodeDataUpdates:this._context.edgeDataUpdates;for(let i=0;i<t.length;i++){const n=e?t[i].nodes.filter(r=>r.getTransformation()===this):t[i].edges.filter(r=>r.getTransformation()===this);if(n.size)for(let r=0;r<n._indexes.length;r++){let o=s.get(n._indexes[r])||{};const a=t[i].property,l=t[i].newValues[r];a?$s(o,a,l):o=l,s.set(n._indexes[r],o)}}}_setOptions(t){this._nodeSelector=t.nodeSelector||this._nodeSelector,this._nodeGroupIdFunction=t.nodeGroupIdFunction||this._nodeGroupIdFunction,this._nodeGenerator=t.nodeGenerator||this._nodeGenerator,this._edgeSelector=t.edgeSelector||this._edgeSelector,this._edgeGroupIdFunction=t.edgeGroupIdFunction||this._edgeGroupIdFunction,this._edgeGenerator=t.edgeGenerator||this._edgeGenerator,this._edgeSource=t.edgeSource||this._edgeSource,this._edgeTarget=t.edgeTarget||this._edgeTarget,this._separateEdgesByDirection=t.separateEdgesByDirection!==void 0?!!t.separateEdgesByDirection:this._separateEdgesByDirection,this._groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this._groupSelfLoopEdges,this._groupEdges=t.groupEdges!==void 0?!!t.groupEdges:this._groupEdges}resetContext(){super.resetContext(),this._context=Wt(ct({},this._context),{nodeDataUpdates:new Map,edgeDataUpdates:new Map})}initialize(t){super.initialize(t),this._ogma.events.on("updateNodeData",({changes:e})=>{this._checkNodeDataUpdate?this._checkChanges(e,!0):this._checkNodeDataUpdate=!0}),this._ogma.events.on("updateEdgeData",({changes:e})=>{this._checkEdgeDataUpdate?this._checkChanges(e,!1):this._checkEdgeDataUpdate=!0})}};function zN(t){return t.map(({id:e,source:s,target:i})=>({id:e,source:s,target:i}))}function BN(t,e,s,i){let n=e,r=s;return!i&&n.toString()>r.toString()&&(n=s,r=e),`${t}[${n}-${r}]`}function UN(t,e){const s=t.get(0);return{data:s.getData(),attributes:s.getAttributes(e)}}function Ua(t,e){return`gen_grp_${e}_${t}`}var GN=()=>"",z_=()=>({}),VN=class extends cn{constructor(t){super(t),this._groupSelfLoopEdges=!1,this._isCleaningUp=!1,this._isRunning=!1,this._onPreAddGraph=qt,this._onBeforeAdd=e=>{if(this._isCleaningUp||!this.enabled)return;const{isNode:s,objects:i}=e;jN(e.objects,s?this._groupNodes(i):this._groupEdges(i)),this._shouldSetVirtual=!0},this._onAfterAdd=e=>{this._shouldSetVirtual&&(this._shouldSetVirtual=!1,this._setVirtual(e.nodes||e.edges,!!e.nodes))},this._onRequestElementsToDelete=e=>{if(e.virtual)return;const s=e.elementsToRemove.isNode,i=s?this._ogma.getNodes:this._ogma.getEdges,n=s?this._context.metaNodesSet:this._context.metaEdgesSet,r=s?this._context.nodeGroups:this._context.edgeGroups,o=s?this._ogma.removeNodes:this._ogma.removeEdges,a=e.elementsToRemove.size,l=i(Array.from(n)),d=e.elementsToRemove.slice();if(e.elementsToRemove=e.elementsToRemove.subtract(l),e.elementsToRemove.size===a)return;const h=d.subtract(e.elementsToRemove);if(h.forEach(u=>{r.delete(u.getId())}),s){const u=h.getAdjacentEdges().filter(c=>c.isVirtual());this._ogma.removeEdges(u)}o(h,{virtual:!0})},this._nodeToGroupId=t.groupIdFunction||GN,this._groupSelfLoopEdges=!!t.groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||z_,this._edgeGenerator=t.edgeGenerator||z_,this._shouldSetVirtual=!1,this._selector=t.selector,this.shouldDo=t.enabled===void 0||!!t.enabled}initialize(t){super.initialize(t),this._ogma.events.on("preAddElements",this._onBeforeAdd).on("requestElementsToDelete",this._onRequestElementsToDelete).on("preAddGraph",this._onPreAddGraph).on(["postAddGraph","addNodes","addEdges"],this._onAfterAdd),this.shouldDo&&(this.enable(),this.shouldDo=!1)}enable(){return this.enabled?Promise.resolve():(this.enabled=!0,this.shouldDo=!0,this.shouldUndo=!1,this._isRunning=!0,this._ogma.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(t=>Promise.all([t,this._ogma.clearGraph()])).then(([t])=>t).then(t=>this._ogma.setGraph(t)).then(()=>(this.resolve(),this._isRunning=!1,Promise.resolve())))}disable(){return this.enabled?(this.enabled=!1,this.shouldDo=!1,this.shouldUndo=!1,this.cleanup().then(()=>{Promise.resolve()})):Promise.resolve()}run(){return this.enabled||!this.shouldDo?Promise.resolve(this._context):this._ogma.export.json({download:!1,edgeAttributes:"all",nodeAttributes:"all"}).then(t=>Promise.all([t,this._ogma.clearGraph()])).then(([t])=>t).then(t=>this._ogma.setGraph(t)).then(()=>Promise.resolve(this._context))}undo(){return Promise.resolve(this._context)}getName(){return"node-clustering"}cleanup(){if(this._isRunning)return Promise.resolve();this._isCleaningUp=!0;const t=this._ogma.getNodes(Array.from(this._context.metaNodesSet)),e=this._ogma.getEdges(Array.from(this._context.metaEdgesSet)),s=this._getSubNodes(),i=this._getSubEdges();return this.resetContext(),this._ogma.removeNodes(t,{virtual:!0}).then(()=>this._ogma.removeEdges(e,{virtual:!0})).then(()=>this._ogma.addNodes(s)).then(()=>this._ogma.addEdges(i)).then(()=>{this._isCleaningUp=!1,Promise.resolve()})}resetContext(){this._isRunning||(super.resetContext(),this._context=Wt(ct({},this._context),{nodeGroups:new Map,edgeGroups:new Map,metaNodesSet:new Set,metaEdgesSet:new Set,nodeToGroupId:new Map}))}getSubNodes(t){const e=this._context.nodeGroups.get(t.getId());return e?e.nodes:[]}getSubEdges(t){const e=this._context.edgeGroups.get(t.getId());return e?e.edges:[]}_getSubNodes(){return Array.from(this._context.nodeGroups.values()).reduce((t,{nodes:e})=>(t.push(...e),t),[])}_getSubEdges(){return Array.from(this._context.edgeGroups.values()).reduce((t,{edges:e})=>(t.push(...e),t),[])}_setVirtual(t,e){if(!t)return;const s=e?this._context.metaNodesSet:this._context.metaEdgesSet,i=t.filter(n=>s.has(n.getId()));this._ogma.modules.graph.storage.fetch(e).getFlexArray("virtual").setMultiple(i._indexes,1),e?this._context.virtualNodes=this._context.virtualNodes.concat(i):this._context.virtualEdges=this._context.virtualEdges.concat(i)}setContext(t){}_computeEdgeGroupId(t,e){return t>e?`${e}:${t}`:`${t}:${e}`}_groupEdges(t){const e=this._id,s=new Map,i=this._context.nodeToGroupId;this._context.edgeGroups.forEach(a=>{a.newEdges=[],s.set(a.id,a)});const n=[];for(let a=0;a<t.length;++a){const l=t[a];let d=this._context.nodeToGroupId.get(l.source),h=this._context.nodeToGroupId.get(l.target);if(!d&&!h){n.push(l);continue}d=d||l.source,h=h||l.target;const u=this._computeEdgeGroupId(d,h);if(u!==void 0){const c=i.get(l.source)||l.source,g=i.get(l.target)||l.target;let _=s.get(u);_||(_={id:u,source:c,target:g,edges:[],newEdges:[]},s.set(u,_)),_.edges.push(l),_.newEdges.push(l)}}const r=Pi(s),o=r.map(({edges:a})=>a);for(let a=0;a<r.length;++a){const l=r[a];if(!l.newEdges.length)continue;const d=l.id,h=o[a],u=this._edgeGenerator(h,d,this);u.id===void 0&&(u.id=Ua(d,e)),u.source=l.source,u.target=l.target,l.metaEdge=u,this._context.metaEdgesSet.add(u.id),this._context.edgeGroups.get(u.id)||this._context.edgeGroups.set(u.id,l),(this._groupSelfLoopEdges||u.source!==u.target)&&n.push(u)}return this._ogma.view.afterNextFrame().then(()=>{this._context.edgeGroups.forEach(({newEdges:a,metaEdge:l})=>{if(!(a.length&&l&&l.id&&l.attributes))return;const d=this._ogma.getEdge(l.id);d==null||d.setAttributes(l.attributes)})}),n}_groupNodes(t){const e=this._id,s=new Map;this._context.nodeGroups.forEach(l=>{l.newNodes=[],s.set(l.id,l)});const i=[];for(let l=0;l<t.length;l++){const d=t[l];if(this._selector&&!this._selector(d)){i.push(d);continue}d.id=Sf(d.id);const h=this._nodeToGroupId(d);if(h!==void 0){let u=s.get(h);u||(u={id:h,nodes:[],newNodes:[]},s.set(h,u)),u.nodes.push(d),u.newNodes.push(d)}else this._context.nodeToGroupId.set(d.id,d.id)}const n=Pi(s),r=n.map(({nodes:l})=>l),o=n.map(({newNodes:l})=>l),a=[];for(let l=0;l<n.length;++l){if(!n[l].newNodes.length)continue;const d=n[l].id,h=r[l],u=this._nodeGenerator(h,d,this);n[l].metaNode=u,u.id===void 0&&(u.id=Ua(d,e));for(const c of o[l])this._context.nodeToGroupId.set(c.id,u.id);this._context.metaNodesSet.add(u.id),this._context.nodeGroups.get(u.id)||this._context.nodeGroups.set(u.id,n[l]),a.push(u)}return a.push(...i),this._ogma.view.afterNextFrame().then(()=>{this._context.nodeGroups.forEach(({newNodes:l,metaNode:d})=>{if(!(l.length&&d&&d.id&&d.attributes))return;const h=this._ogma.getNode(d.id);h==null||h.setAttributes(d.attributes)})}),a}_setOptions(t){this._nodeToGroupId=t.groupIdFunction||this._nodeToGroupId,this._groupSelfLoopEdges=t.groupSelfLoopEdges!==void 0?!!t.groupSelfLoopEdges:this._groupSelfLoopEdges,this._nodeGenerator=t.nodeGenerator||this._nodeGenerator,this._edgeGenerator=t.edgeGenerator||this._edgeGenerator,this._selector=t.selector||this._selector}};function jN(t,e){const s=e.length;return t.length=s,t.splice(0,s,...e),t}var qN=t=>({addNodeClustering:(e={})=>t.modules.transformations.add(new VN(e))}),HN=t=>({addNodeFilter:e=>t.modules.filters.addNodeFilter(e),addEdgeFilter:e=>t.modules.filters.addEdgeFilter(e),getNodeFilters:()=>t.modules.transformations.getList().filter(e=>e.getName()==="node-filter"),getEdgeFilters:()=>t.modules.transformations.getList().filter(e=>e.getName()==="edge-filter")}),XN=class extends qx{constructor({selector:t=Ba,duration:e,enabled:s,groupIdFunction:i=Kr,generator:n=Qr,separateEdgesByDirection:r=!1}={}){super({nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:t,edgeGroupIdFunction:i,edgeGenerator:n,edgeSource:o=>o.getSource(),edgeTarget:o=>o.getTarget(),separateEdgesByDirection:r,groupEdges:!0,duration:e,enabled:s})}getName(){return"edge-grouping"}get context(){return this._context}resetContext(){super.resetContext(),this._context=Wt(ct({},this._context),{metaEdges:this._ogma.edgeList(),subEdges:this._ogma.edgeList(),invalidMetaEdges:this._ogma.edgeList(),invalidSubEdges:this._ogma.edgeList()})}run(){let t,e;const s=this.getAnimationDuration();return this._addMetaEdges().then(i=>{t=i,e=t.getSubEdges().reduce((o,a)=>o.concat(a),this._ogma.createEdgeList());const n=this._context.invalidSubEdges.subtract(e),r=e.reduce((o,a)=>(o[a.getId()]=!0,o),{});return Promise.all([...t.map((o,a)=>{const l=o.getParallelEdges({filter:"visible"}),d=l.filter(h=>!r[h.getId()]).reduce((h,u)=>(h[u.getId()]=!0,h),{});return d[o.getId()]=!0,l.setAttribute("curvature",l.map(h=>this._ogma.modules.curvatureManager.computeCurvature(r[h.getId()]?o:h,"all",u=>d[u.getId()])),s)}),n.setAttribute("curvature",this._getCurvatures(n),s)])}).then(()=>(e.setVisible(!1),t.setVisible(!0),Wt(ct({},this._context),{metaEdges:t,subEdges:e,virtualEdges:t,invalidMetaEdges:this._context.metaEdges.subtract(t),invalidSubEdges:e})))}undo(){const{metaEdges:t,subEdges:e}=this._context,s=this.getAnimationDuration(!1);return this._removeMetaEdge(t),t.setVisible(!1),e.filter(i=>i.getSource().isVisible()&&i.getTarget().isVisible()).setVisible(!0),t.setVisible(!1),this._context.invalidSubEdges=this._context.subEdges,e.setAttribute("curvature",this._getCurvatures(e),s)}_getCurvatures(t){return t.map(e=>this._ogma.modules.curvatureManager.computeCurvature(e,"visible",s=>!0))}cleanup(){const{virtualEdges:t,invalidMetaEdges:e}=this._context;return this._ogma.removeEdges(t.concat(e),{virtual:!0}).then(()=>(this._context.metaEdges=this._ogma.edgeList(),this._context.virtualEdges=this._ogma.edgeList(),this._context.invalidMetaEdges=this._ogma.edgeList(),this._context.invalidSubEdges=this._ogma.edgeList(),Promise.resolve()))}_setOptions({selector:t,duration:e,enabled:s,groupIdFunction:i,generator:n,separateEdgesByDirection:r}){super._setOptions({nodeSelector:void 0,nodeGroupIdFunction:void 0,nodeGenerator:void 0,edgeSelector:t,edgeGroupIdFunction:i,edgeGenerator:n,edgeSource:o=>o.getSource(),edgeTarget:o=>o.getTarget(),separateEdgesByDirection:r,groupEdges:!0,duration:e,enabled:s})}};function mh(t,e,s,i,n,r){if(n-i<=s)return;const o=i+n>>1;Hx(t,e,o,i,n,r%2),mh(t,e,s,i,o-1,r+1),mh(t,e,s,o+1,n,r+1)}function Hx(t,e,s,i,n,r){for(;n>i;){if(n-i>600){const d=n-i+1,h=s-i+1,u=Math.log(d),c=.5*Math.exp(2*u/3),g=.5*Math.sqrt(u*c*(d-c)/d)*(h-d/2<0?-1:1);Hx(t,e,s,Math.max(i,Math.floor(s-h*c/d+g)),Math.min(n,Math.floor(s+(d-h)*c/d+g)),r)}const o=e[2*s+r];let a=i,l=n;for(dr(t,e,i,s),e[2*n+r]>o&&dr(t,e,i,n);a<l;){for(dr(t,e,a,l),a++,l--;e[2*a+r]<o;)a++;for(;e[2*l+r]>o;)l--}e[2*i+r]===o?dr(t,e,i,l):(l++,dr(t,e,l,n)),l<=s&&(i=l+1),s<=l&&(n=l-1)}}function dr(t,e,s,i){rd(t,s,i),rd(e,2*s,2*i),rd(e,2*s+1,2*i+1)}function rd(t,e,s){const i=t[e];t[e]=t[s],t[s]=i}function WN(t,e,s,i,n,r,o){const a=[0,t.length-1,0],l=[];let d,h;for(;a.length;){const u=a.pop(),c=a.pop(),g=a.pop();if(c-g<=o){for(let f=g;f<=c;f++)d=e[2*f],h=e[2*f+1],d>=s&&d<=n&&h>=i&&h<=r&&l.push(t[f]);continue}const _=Math.floor((g+c)/2);d=e[2*_],h=e[2*_+1],d>=s&&d<=n&&h>=i&&h<=r&&l.push(t[_]);const m=(u+1)%2;(u===0?s<=d:i<=h)&&(a.push(g),a.push(_-1),a.push(m)),(u===0?n>=d:r>=h)&&(a.push(_+1),a.push(c),a.push(m))}return l}function $N(t,e,s,i,n,r){const o=[0,t.length-1,0],a=[],l=n*n;for(;o.length;){const d=o.pop(),h=o.pop(),u=o.pop();if(h-u<=r){for(let f=u;f<=h;f++)B_(e[2*f],e[2*f+1],s,i)<=l&&a.push(t[f]);continue}const c=Math.floor((u+h)/2),g=e[2*c],_=e[2*c+1];B_(g,_,s,i)<=l&&a.push(t[c]);const m=(d+1)%2;(d===0?s-n<=g:i-n<=_)&&(o.push(u),o.push(c-1),o.push(m)),(d===0?s+n>=g:i+n>=_)&&(o.push(c+1),o.push(h),o.push(m))}return a}function B_(t,e,s,i){const n=t-s,r=e-i;return n*n+r*r}var YN=t=>t[0],ZN=t=>t[1],KN=class{constructor(t,e=YN,s=ZN,i=64,n=Float64Array){this.nodeSize=i,this.points=t;const r=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new r(t.length),a=this.coords=new n(2*t.length);for(let l=0;l<t.length;l++)o[l]=l,a[2*l]=e(t[l]),a[2*l+1]=s(t[l]);mh(o,a,i,0,o.length-1,0)}range(t,e,s,i){return WN(this.ids,this.coords,t,e,s,i,this.nodeSize)}within(t,e,s){return $N(this.ids,this.coords,t,e,s,this.nodeSize)}};function QN(t){return t&&t.then==="function"?t:Promise.resolve(t)}var Xx=class extends qx{constructor({duration:t,enabled:e,padding:s=0,selector:i=Ba,groupIdFunction:n=Kr,edgeGroupIdFunction:r=Kr,nodeGenerator:o=Qr,edgeGenerator:a=Qr,separateEdgesByDirection:l=!1,groupSelfLoopEdges:d=!1,groupEdges:h=!0,restorePositions:u=!0,showContents:c=!1,onCreated:g}={}){super({nodeSelector:i,nodeGroupIdFunction:n,edgeGroupIdFunction:r,nodeGenerator:o,edgeSelector:_=>!(!_.getSource().getMetaNode()&&!_.getTarget().getMetaNode()),edgeGenerator:a,edgeSource:_=>ea(_.getSource()),edgeTarget:_=>ea(_.getTarget()),separateEdgesByDirection:l,groupEdges:h,groupSelfLoopEdges:d,duration:t,enabled:e}),this._metaNodesIds=new Set,this._padding=s,this._showContents=typeof c!="function"?()=>c:c,this._restorePositions=u,this._onCreated=g||((_,m,f,p)=>{})}getName(){return"node-grouping"}get context(){return this._context}get padding(){return this._padding}set padding(t){this._padding=t,this._refresh()}resetContext(){super.resetContext(),this._context=Wt(ct({},this._context),{metaNodes:this._ogma.nodeList(),metaEdges:this._ogma.edgeList(),subNodes:this._ogma.nodeList(),collapsedSubNodes:this._ogma.nodeList(),subEdges:this._ogma.edgeList(),subnodesVisibility:[],offsets:[]})}run(){let t,e;const s=this._ogma,i=this.getAnimationDuration();let n=s.createNodeList(),r=s.createNodeList(),o=s.createEdgeList();const a=[],l=this._ogma.modules.grouping,d=[],h=new Set,u=new Set;let c=[];return this._addMetaNodes().then(g=>(t=g,c=t.reduce((_,m)=>{const f=m.getSubNodes();return _.concat(f?f.isVisible():[])},[]),t.setVisible(!1),this._addMetaEdges())).then(g=>(e=g,t.forEach(_=>{const m=_.getSubNodes(),f=_.getPosition(),p=this._showContents(_);if(!m||m.map(y=>!y.isVisible()).every(y=>y))_.setVisible(!1);else if(m){if(p){h.add(_._index);const y=m.getAdjacentEdges({bothExtremities:!0});m.setVisible(!0),y.forEach(b=>u.add(b._index))}else{h.delete(_._index),l.removeVisibleGroup(_),a.push(...m.getPosition().map(b=>(b.x=b.x-f.x,b.y=b.y-f.y,b))),n=n.concat(m);const y=m.toArray();for(;y.length!==0;){const b=y.pop(),x=b.getSubNodes();x&&l.isVisibleGroup(b)&&(x.setVisible(!1),x.getAdjacentEdges({bothExtremities:!0}).setVisible(!1),y.push.apply(y,x.toArray()))}}r=r.concat(m)}}),o=e.getSubEdges().reduce((_,m)=>{const f=m.filter(p=>{if(u.has(p._index))return!1;const y=p.getSource().getMetaNode(),b=p.getTarget().getMetaNode();return!(y&&b&&l.isVisibleGroup(y)&&l.isVisibleGroup(b)&&y===b)});return _.concat(f)},s.createEdgeList()),n.setAttributes(n.getPosition().map((_,m)=>{const f=a[m];return _.x-=f.x,_.y-=f.y,_}),i))).then(()=>{n.setVisible(!1),o.setVisible(!1),t.setVisible(!0),this._ogma.modules.events.fire("groupingRun",{metaNodes:t,padding:isNaN(+this._padding)?t.map(g=>(0,this._padding)(g)||0):this._padding}),e.filter(g=>this._groupSelfLoopEdges||g.getSource()!==g.getTarget()).setVisible(!0)}).then(()=>{const g=new Set;t.forEach(_=>{const m=h.has(_._index),f=_.getSubNodes();if(f){const p=f.getAdjacentEdges({filter:"all",bothExtremities:!0});if(m){const y=f.reduce((b,x)=>{const v=l.getNodeDepth(x);return g.add(x._index),v<b?v:b},0);p.forEach(b=>u.add(b._index)),l.addVisibleGroup(_,Dv+y),this._metaNodesIds.has(_.getId())||(this._metaNodesIds.add(_.getId()),d.push(QN(this._onCreated(_,m,f,p)).then(s.view.afterNextFrame)))}}}),e.forEach(_=>{const m=Math.min(l.getNodeDepth(_.getSource()),l.getNodeDepth(_.getTarget()));_.setAttribute("layer",m)}),o=o.filter(_=>!u.has(_._index)),n=n.filter(_=>!g.has(_._index)),s.removeNodes(this.context.metaNodes.subtract(t),{virtual:!0}),s.removeEdges(this.context.metaEdges.subtract(e),{virtual:!0}),this._ogma.modules.graphics.getAttributesManager().update()}).then(()=>Promise.all(d)).then(()=>({metaNodes:t,metaEdges:e,subnodesVisibility:c,collapsedSubNodes:n,virtualNodes:t,virtualEdges:e,subNodes:r,nodeDataUpdates:this._context.nodeDataUpdates,edgeDataUpdates:this._context.edgeDataUpdates,subEdges:o,offsets:a}))}undo(){const{metaNodes:t,metaEdges:e,subnodesVisibility:s,subNodes:i,offsets:n,collapsedSubNodes:r,subEdges:o}=this._context,a=this.getAnimationDuration(),l=this._ogma.modules.grouping,d=this._ogma.getNodes(r.getMetaNode()).getPosition(),h=d.map((u,c)=>JN(u,n[c]));return i.forEach((u,c)=>u.setVisible(s[c])),o.setVisible(!0),l.setMetaElement(i,null),l.setMetaElement(o,null),t.setVisible(!1),e.setVisible(!1),r.setAttributes(d).then(()=>this._restorePositions?r.setAttributes(h,a):Promise.resolve(r))}cleanup(){const t=this._ogma,e=this._context,{metaNodes:s,metaEdges:i}=e;return Promise.all([()=>this._ogma.modules.grouping.resetOffsets(),t.removeEdges(i,{virtual:!0}),t.removeNodes(s,{virtual:!0})]).then(()=>Promise.resolve())}_setOptions({duration:t,enabled:e,padding:s,selector:i,groupIdFunction:n,nodeGenerator:r,edgeGroupIdFunction:o,edgeGenerator:a,separateEdgesByDirection:l,groupSelfLoopEdges:d,groupEdges:h,restorePositions:u,showContents:c,onCreated:g}={}){super._setOptions({nodeSelector:i,nodeGroupIdFunction:n,nodeGenerator:r,edgeSelector:_=>!(!_.getSource().getMetaNode()&&!_.getTarget().getMetaNode()),edgeGroupIdFunction:o,edgeGenerator:a,edgeSource:_=>ea(_.getSource()),edgeTarget:_=>ea(_.getTarget()),separateEdgesByDirection:l,groupEdges:h,groupSelfLoopEdges:d,duration:t,enabled:e}),this._padding=s!==void 0?s:this.padding,this._showContents=c!==void 0?typeof c!="function"?()=>c:c:this._showContents,this._restorePositions=u===void 0?this._restorePositions:u,this._onCreated=g||this._onCreated}};function ea(t){return t.getMetaNode()||t}function JN(t,e){return{x:t.x+e.x,y:t.y+e.y}}var tF=t=>t/360+.5,eF=t=>{const e=Math.sin(t*Math.PI/180);return(t=.5-.25*Math.log((1+e)/(1-e))/Math.PI)<0?0:t>1?1:t},sF=256,iF=class extends Xx{constructor(t){super(Wt(ct({},t),{selector:e=>{const s=this.getPosition(e);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!t.selector||t.selector(e))},groupIdFunction:e=>{let s=t.groupIdFunction?t.groupIdFunction(e):"geo-cluster";return s||(s="geo-cluster"),`${s}-${this.getNodeId(e)}`},edgeGroupIdFunction:e=>{let s=t.edgeGroupIdFunction?t.edgeGroupIdFunction(e):"";return s||(s=""),`${s}-${this.getNodeId(e.getSource())}-${this.getNodeId(e.getTarget())}`},nodeGenerator:(e,s,i)=>{let n=t.nodeGenerator?t.nodeGenerator(e,s,i):{};n||(n={});const r=this.getCoords(e.get(0));return n.data?n.data=xs(n.data,r):n.data=r,n}})),this._zoomLevels=t.zoomLevels?t.zoomLevels:[0,22],this._groupingRadius=t.radius===void 0?60:t.radius,this._generateIdFunction=t.groupIdFunction||(()=>""),this._shouldEnable=t.enabled,this._shouldRefreshClusters=!0}initialize(t){super.initialize(t);const e=this._ogma;this._ogma.modules.events.on("beforeGeoCameraMove",({zoom:s})=>{this.enabled&&e.geo.enabled()&&this.getClosestZoomLevel(s).zoom!==this._currentClusters.zoom&&(this._shouldRefreshClusters=!1,this._refresh())}),e.events.on("geoDisabled",()=>{this.isEnabled()&&this.disable(0).then(()=>{this._shouldEnable=!0})}),e.events.on("geoEnabled",()=>{this._shouldEnable&&this.enable(0)})}getPosition(t){return{x:t.getData(this._ogma.modules.geo.latitudePath),y:t.getData(this._ogma.modules.geo.longitudePath)}}getMercatorPosition(t){return{x:tF(t.getData(this._ogma.modules.geo.longitudePath)),y:eF(t.getData(this._ogma.modules.geo.latitudePath))}}getNodeId(t){var e;return((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.id)||""}enable(t){return this._ogma&&!this._ogma.modules.geo.isEnabled()?(this._shouldEnable=!0,Promise.resolve()):super.enable(t)}disable(t){return this._shouldEnable=!1,super.disable(t)}getCoords(t){var e;const s=((e=this._currentClusters.idToCluster.get(t._index))==null?void 0:e.center)||{x:0,y:0},i={};return this.setToPropertyPath(i,this._ogma.modules.geo.latitudePath,s.x),this.setToPropertyPath(i,this._ogma.modules.geo.longitudePath,s.y),i}setToPropertyPath(t,e,s){if(typeof e=="string")return this.setToPropertyPath(t,e.split("."),s);{let i=t;e.forEach((n,r)=>{r===e.length-1?i[n]=s:i[n]||(i[n]={}),i=i[n]})}}nodeToElement(t){return{nodeId:t._index,generatedId:this._generateIdFunction(t),nodes:this._ogma.nodeList(new Uint32Array([t._index])),radius:t.getAttribute("radius"),center:this.getPosition(t),mercatorCenter:this.getMercatorPosition(t),zoom:1/0}}getCluster(t){const e=t.reduce((n,r)=>({x:n.x+r.center.x/t.length,y:n.y+r.center.y/t.length}),{x:0,y:0}),s=t.reduce((n,r)=>({x:n.x+r.mercatorCenter.x/t.length,y:n.y+r.mercatorCenter.y/t.length}),{x:0,y:0}),i=t.reduce((n,r)=>{const o=e.x-r.center.x,a=e.y-r.center.y,l=r.radius+Math.sqrt(o*o+a*a);return Math.max(l,n)},0);return{nodes:this._ogma.nodeList(new Uint32Array(t.map(({nodeId:n})=>n))),generatedId:t[0].generatedId,center:e,mercatorCenter:s,radius:i}}onePassCluster(t){const e=t.map(r=>this.nodeToElement(r)),[s,i]=this._zoomLevels,n=[];for(let r=i;Math.abs(r-s)>.01;r-=1*(i-s)/19){const o=[],a=new KN(e,({mercatorCenter:l})=>l.x,({mercatorCenter:l})=>l.y,16,Float32Array);e.forEach(l=>{if(l.zoom<=r)return;const d=this._groupingRadius/(sF*Math.pow(2,l.zoom-1));let h=a.within(l.mercatorCenter.x,l.mercatorCenter.y,d).map(u=>e[u]).filter(u=>u.zoom>r&&u&&u.generatedId===l.generatedId);h.length||(h=[l]),h.forEach(u=>u.zoom=r),o.push(Wt(ct({},this.getCluster(h)),{zoom:r,id:`${r.toFixed(2)}-${o.length}`}))}),n.push({zoom:r,clusters:o})}return n.map(({zoom:r,clusters:o})=>{const a=new Map;return o.forEach(l=>{l.nodes.forEach(({_index:d})=>a.set(d,l))}),{zoom:r,idToCluster:a}})}getClosestZoomLevel(t){return this._clustersByZoom.reduce((e,s)=>Math.abs(t-s.zoom)<Math.abs(t-e.zoom)?s:e)}run(){var t;this._shouldRefreshClusters&&(this._clustersByZoom=this.onePassCluster(this._ogma.getNodes().filter(s=>this._nodeSelector(s))));const e=((t=this._ogma.geo.getMap())==null?void 0:t.getZoom())||0;return this._currentClusters=this.getClosestZoomLevel(e),this.whenApplied().then(()=>{this._ogma.view.afterNextFrame().then(()=>{this._ogma.modules.geo.updateProjection()})}),this._shouldRefreshClusters=!0,super.run()}_setOptions(t){super._setOptions(Wt(ct({},t),{selector:e=>{const s=this.getPosition(e);return s&&!isNaN(s.x)&&!isNaN(s.y)&&(!t.selector||t.selector(e))},groupIdFunction:e=>{let s=t.groupIdFunction?t.groupIdFunction(e):"geo-cluster";return s||(s="geo-cluster"),`${s}-${this.getNodeId(e)}`},nodeGenerator:(e,s,i)=>{let n=t.nodeGenerator?t.nodeGenerator(e,s,i):{};n||(n={});const r=this.getCoords(e.get(0));return n.data?n.data=xs(n.data,r):n.data=r,n},edgeGroupIdFunction:e=>{let s=t.edgeGroupIdFunction?t.edgeGroupIdFunction(e):"";return s||(s=""),`${s}-${this.getNodeId(e.getSource())}-${this.getNodeId(e.getTarget())}`}})),this._groupingRadius=t.radius===void 0?this._groupingRadius:t.radius,this._generateIdFunction=t.groupIdFunction||this._generateIdFunction,this._shouldRefreshClusters=!0,this._shouldEnable=t.enabled,this._ogma.modules.geo.filter._refresh(),this._refresh()}},nF=t=>({addNodeGrouping:(e={})=>{const s=new Xx(e);return t.modules.transformations.add(s)},addEdgeGrouping:(e={})=>t.modules.transformations.add(new XN(e)),addGeoClustering:e=>{if(t.modules.transformations.getList().find(s=>s.getName()==="geo-clustering"))throw new Error("Trying to add more than one geo clustering. Please refer to the documentation about this issue.");return t.modules.transformations.add(new iF(e))}});function rF(t){return t!=null}function U_(t,e){return{source:t.getId(),target:e.getId()}}var oF=class extends cn{constructor(t){super(t);const{selector:e=Qa,neighborIdFunction:s=Br,nodeGenerator:i=()=>({}),edgeGenerator:n=U_}=t;this._generateIds=r=>e&&e(r)&&s(r)||null,this._nodeGenerator=i,this._edgeGenerator=n||U_}getName(){return"neighbor-generation"}run(){const t=this._id,e=this._ogma,s=this.getAnimationDuration(),i=e.getNodes(),n=new Map;for(let u=0;u<i.size;++u){const c=i.get(u),g=(aF(this._generateIds(c))||[]).filter(rF);if(g)for(let _=0;_<g.length;++_){const m=g[_];let f=n.get(m);f||(f=[],n.set(m,f)),f.push(c)}}const r=new Array(n.size),o=[],a=Ja(n),l=Pi(n).map(u=>e.getNodes(u));for(let u=0;u<r.length;++u){const c=a[u],g=l[u],_=this._nodeGenerator(c,g);_.id=`_gen_${t}_${c}`;const m=ou(g.getPosition());_.attributes=_.attributes||{},_.attributes.x=m.x,_.attributes.y=m.y,r[u]=_}let d,h;return e.addNodes(r.map(u=>({id:u.id,attributes:u.attributes})),{virtual:!0}).then(()=>{d=e.getNodes(r.map(u=>u.id)),d.replaceOriginalAttributes(r.map(u=>u.attributes),["x","y"]),d.setData(null,r.map(u=>u.data));for(let u=0;u<d.size;++u){const c=d.get(u),g=l[u];for(let _=0;_<g.size;++_){const m=g.get(_),f=this._edgeGenerator(m,c);f.source||f.target||(f.source=m.getId(),f.target=c.getId()),f.id||(f.id=`${f.source}-${f.target}`),o.push(f)}}return e.addEdges(o,{virtual:!0})}).then(()=>(h=e.getEdges(o.map(u=>u.id)),d.setVisible(!0),h.setVisible(!0),d.addClass(Fe),h.addClass(Fe),e.removeNodes(this._context.virtualNodes.subtract(d),{virtual:!0}),e.removeEdges(this._context.virtualEdges.subtract(h),{virtual:!0}),Promise.all([d.removeClass(Fe,s),h.removeClass(Fe,s)]))).then(()=>({virtualNodes:d,virtualEdges:h}))}undo(){const{virtualNodes:t,virtualEdges:e}=this._context;if(!e||!t)return Promise.resolve(this._context);const s=this.getAnimationDuration();return Promise.all([t.addClass(Fe,s),e.addClass(Fe,s)]).then(()=>{t.setVisible(!1),e.setVisible(!1)})}cleanup(){const{virtualEdges:t,virtualNodes:e}=this._context;if(t&&e){const s=e.filter(n=>!n.isVisible()),i=t.filter(n=>!n.isVisible());this._ogma.removeNodes(s,{virtual:!0}),this._ogma.removeEdges(i,{virtual:!0})}return Promise.resolve()}_setOptions(t){const{selector:e,neighborIdFunction:s,nodeGenerator:i,edgeGenerator:n}=t;this._generateIds=e?r=>e&&e(r)&&s(r)||null:this._generateIds,this._nodeGenerator=i||this._nodeGenerator,this._edgeGenerator=n||this._edgeGenerator,super._setOptions(t)}};function aF(t){return Array.isArray(t)?t:t?[t]:null}var lF=class extends cn{constructor(t){super(t),this._selector=t.selector||zr,this._dataFunction=t.dataFunction||qt}run(){const t=this.getAnimationDuration(),e=this._ogma,s=e.getNodes().filter(this._selector?this._selector:h=>!0),i=[],n=new Map;for(let h=0;h<s.size;++h){const u=s.get(h),c=u.getAdjacentEdges(),g=this._dataFunction(u);for(let _=0;_<c.size;++_){const m=c.get(_),f=m.getSource(),p=m.getTarget();if(f!==p&&g!==void 0){const y=f===u?p:f;let b=n.get(y);b||(b=[],n.set(y,b)),b.push(g)}i.push(m)}}const r=e.getEdges(i),o=e.getNodes(Ja(n)),a=Pi(n),l=o.getData(),d=new Array(o.size);for(let h=0;h<d.length;++h){const u=a[h];let c=l[h];for(let g=0;g<u.length;++g)c=xs(c,u[g]);d[h]=c}return Promise.all([s.addClass(Fe,t),r.addClass(Fe,t)]).then(()=>(s.setVisible(!1),r.setVisible(!1),o.setData(d),Wt(ct({},this._context),{hiddenNodes:s,hiddenEdges:r,nodesWithDataChange:o,oldDataList:l})))}getName(){return"neighbor-merging"}get context(){return this._context}resetContext(){super.resetContext(),this._context=Wt(ct({},this._context),{hiddenNodes:this._ogma.nodeList(),hiddenEdges:this._ogma.edgeList(),nodesWithDataChange:this._ogma.nodeList(),oldDataList:[]})}undo(){const{hiddenNodes:t,hiddenEdges:e,nodesWithDataChange:s,oldDataList:i}=this._context;t.setVisible(!0),e.setVisible(!0),t.addClass(Fe),e.addClass(Fe);const n=this.getAnimationDuration();return Promise.all([t.removeClass(Fe,n),e.removeClass(Fe,n)]).then(()=>{s.setData(i)})}cleanup(){return Promise.resolve()}_setOptions(t){this._selector=t.selector||this._selector,this._dataFunction=t.dataFunction||this._dataFunction,super._setOptions(t)}},dF=t=>({addNeighborGeneration:e=>t.modules.transformations.add(new oF(e)),addNeighborMerging:e=>t.modules.transformations.add(new lF(e))});function hF(t,e){return t.size===e.size&&t.filter(s=>e.includes(s)).size>0}var uF=class extends cn{constructor(t){super(t),this._selector=t.selector||(e=>!1),this._edgeGenerator=t.edgeGenerator||(()=>({}))}getName(){return"node-collapsing"}get context(){return this._context}resetContext(){super.resetContext(),this._context=Wt(ct({},this._context),{hiddenNodes:this._ogma.nodeList(),hiddenEdges:this._ogma.edgeList()})}run(){const t=this._ogma,e=this.getAnimationDuration(),s=t.getNodes().filter(this._selector),i=s.getAdjacentEdges(),n=[],r=s.map(o=>o.getAdjacentNodes().filter(a=>!this._selector(a)));for(let o=0;o<s.size;o++)for(let a=o;a<s.size;a++){const l=s.get(o),d=s.get(a);if(this._ogma.modules.graph.getEdgesBetweenTwoNodes(l,d).size>0&&(r[o].size||r[a].size)&&!hF(r[o],r[a]))throw Error(`addNodeCollapsing: invalid connected nodes [${l.getId()}] and [${d.getId()}] to be collapsed. The addNodeCollapsing function supports only disconnected nodes.`)}for(let o=0;o<s.size;++o){const a=s.get(o),l=r[o];for(let d=0;d<l.size-1;++d){const h=l.get(d),u=this._ogma.modules.graph.getEdgesBetweenTwoNodes(a,h);if(h!==a)for(let c=d+1;c<l.size;++c){const g=l.get(c),_=this._ogma.modules.graph.getEdgesBetweenTwoNodes(a,g),m=this._edgeGenerator(a,h,g,u,_);if(m){const f=fa(m);for(let p=0;p<f.length;++p)n.push(cF(t,f[p],p,a,h,g,u,_))}}}}return t.addEdges(n,{virtual:!0}).then(()=>this._ogma.getEdges(n.map(o=>o.id)).addClass(Fe)).then(o=>Promise.all([o.removeClass(Fe,e),s.addClass(Fe,e),i.addClass(Fe,e)])).then(([o])=>(s.setVisible(!1),i.setVisible(!1),o.setVisible(!0),t.removeEdges(this.context.virtualEdges.subtract(o),{virtual:!0}),this._ogma.modules.graphics.getAttributesManager().update(),Wt(ct({},this._context),{virtualEdges:o,hiddenNodes:s,hiddenEdges:i})))}undo(){const{hiddenNodes:t,hiddenEdges:e}=this._context,s=this._ogma,i=this.getAnimationDuration(),n=this._context.virtualEdges||s.createEdgeList();return t.setVisible(!0),e.setVisible(!0),Promise.all([t.addClass(Fe),e.addClass(Fe)]).then(()=>Promise.all([n.addClass(Fe,i),t.removeClass(Fe,i),e.removeClass(Fe,i)])).then(()=>{n.setVisible(!1)})}cleanup(){const t=this._context.virtualEdges||this._ogma.createEdgeList();return this._ogma.removeEdges(t,{virtual:!0})}_setOptions(t){this._selector=t.selector||this._selector,this._edgeGenerator=t.edgeGenerator||this._edgeGenerator,super._setOptions(t)}};function cF(t,e,s,i,n,r,o,a){let l,d;if(e.source!==void 0&&(l=t.getNode(e.source),l!==n&&l!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid source [${e.source}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(e.target!==void 0&&(d=t.getNode(e.target),d!==n&&d!==r))throw new Error([`addNodeCollapsing: edge generator produced RawEdge with invalid target [${e.target}]`,`expected to be [${n.getId()}] or [${r.getId()}]`].join("; "));if(l&&d&&l===d)throw new Error(`addNodeCollapsing: edge generator produced RawEdge with same source and target [${l.getId()}]`);if(l&&!d)d=l===n?r:n;else if(d&&!l)l=d===n?r:n;else if(!l&&!d){let h=!0;for(let u=0;u<o.size;++u)o.get(u).getSource()===n&&(h=!1);for(let u=0;u<a.size;++u)a.get(u).getTarget()===r&&(h=!1);h?(l=r,d=n):(l=n,d=r)}return l&&d?Wt(ct({},e),{id:`_gen_${i.getId()}_${l.getId()}_${d.getId()}_${s}`,source:l.getId(),target:d.getId()}):{}}var gF=t=>({addNodeCollapsing:(e={})=>t.modules.transformations.add(new uF(e))}),_F=class extends cn{constructor(t){super(t),this._nodeSelector=t.nodeSelector||(e=>!0),this._edgeSelector=t.edgeSelector||(e=>!0),this._nodeDataFunction=t.nodeDataFunction||null,this._edgeDataFunction=t.edgeDataFunction||null}getName(){return"virtual-properties"}get context(){return this._context}resetContext(){super.resetContext(),this._context=Wt(ct({},this._context),{nodes:this._ogma.nodeList(),oldNodesData:[],edges:this._ogma.edgeList(),oldEdgesData:[]})}run(){const t=this._ogma,e=this._context;return this._nodeDataFunction&&(e.nodes=t.getNodes().filter(this._nodeSelector),e.oldNodesData=G_(e.nodes,this._nodeDataFunction)),this._edgeDataFunction&&(e.edges=t.getEdges().filter(this._edgeSelector),e.oldEdgesData=G_(e.edges,this._edgeDataFunction)),Promise.resolve(e)}undo(){const{nodes:t,oldNodesData:e,edges:s,oldEdgesData:i}=this._context;return t&&t.setData(e),s&&s.setData(i),Promise.resolve()}cleanup(){return Promise.resolve()}_setOptions(t){this._nodeSelector=t.nodeSelector||this._nodeSelector,this._edgeSelector=t.edgeSelector||this._edgeSelector,this._nodeDataFunction=t.nodeDataFunction||this._nodeDataFunction,this._edgeDataFunction=t.edgeDataFunction||this._edgeDataFunction,super._setOptions(t)}};function G_(t,e){const s=[];for(let i=0;i<t.size;++i){const n=t.get(i),r=n.getData(),o=e(n),a=xs(r,o);s.push(r),n.setData(a)}return s}var mF=t=>({addVirtualProperties:e=>t.modules.transformations.add(new _F(e))}),fF=class extends xe{constructor(t){super(t),this.getList=()=>this._ogma.modules.transformations.getList(),this.clear=()=>this._ogma.modules.transformations.clear(),this.getById=g=>this._ogma.modules.transformations.getById(g),this.afterNextUpdate=()=>this._ogma.modules.transformations.whenApplied();const{addNodeGrouping:e,addEdgeGrouping:s,addGeoClustering:i}=nF(t);this.addNodeGrouping=e,this.addEdgeGrouping=s,this.addGeoClustering=i;const{addNodeClustering:n}=qN(t);this.addNodeClustering=n;const{addNodeFilter:r,addEdgeFilter:o,getNodeFilters:a,getEdgeFilters:l}=HN(t);this.addNodeFilter=r,this.addEdgeFilter=o,this.getNodeFilters=a,this.getEdgeFilters=l;const{addNeighborGeneration:d,addNeighborMerging:h}=dF(t);this.addNeighborGeneration=d,this.addNeighborMerging=h;const{addNodeCollapsing:u}=gF(t);this.addNodeCollapsing=u;const{addVirtualProperties:c}=mF(t);this.addVirtualProperties=c}},pF=class{constructor(t,e){this._ogma=t,$y==="webgl"&&Mr.cacheInitData(Mr.createInitData()),this.settings=new Xw(t),this.events=new jw(t),this.dom=new xv(t),this.animations=new IT(t),this.camera=new Wy(t),this.graph=new dE(t),this.data=new Ev(t),this.graphics=new Rw(t),this.layers=new iC(t),this.individualAttributes=new Hw(t),this.algorithms=new nC(t),this.position=new qI(t),this.touch=new fT(t),this.mouse=new _T(t),this.virtualMouse=new dL(t),this.spatial=new sT(t),this.captor=new qL(t),this.interactions=new RL(t),this.classes=new Zw(t),this.cameraInteractions=new Cw(t,!!e.debug),this.hover=new jI(t),this.keyboard=new nI(t),this.selection=new bT(t),this.styleRules=new _L(t),this.legend=new GI(t),this.sync=new vT(t),this.rules=new ZI(t),this.transformations=new yT(t),this.filters=new JI(t),this.locate=new hT(t),this.drag=new HL(t),this.grouping=new pT(t),this.pulses=new wT(t),this.curvatureManager=new jT(t),this.workers=new $T(t),this.layouts=new JT(t),this.watcher=new nL(t),this.rectangleSelect=new mL(t),this.labels=new kL(t,e),this.brand=new GT(t),this.lasso=new ax(t),this.rewiring=new WL(t),this.resizing=new $L(t),this.snapping=new hL(t),this.connectNodes=new ZL(t),this.tooltip=new sI(t),this.geo=new VT(t),Object.keys(this).forEach(s=>{const i=this[s];i instanceof Bt&&(i._setModules(this),i.onMounted())}),t.onReady(()=>{Object.keys(this).forEach(s=>{const i=this[s];i instanceof Bt&&i.onReady(e)})})}destroy(){Object.keys(this).forEach(t=>{const e=this[t];e instanceof Bt&&e.destroy(this._ogma)})}},yF=1,xF=[xN,oC,AN,lE,LN,FN,PN],fh={version:"5.0.6",commit:"b7ae0e7b6",buildTime:"Fri Apr 12 2024 17:01:18 GMT+0000 (Coordinated Universal Time)"},ph=class{constructor(t={}){this.node=e=>new Ys(e,this),this.edge=e=>new Di(e,this),this.nodeList=e=>new ui(e||new Uint32Array(0),this),this.edgeList=e=>new hn(e||new Uint32Array(0),this),this._onReady=[],this.build=fh,this._init(t)}_init(t){this._initParameters=t,this._debug=!!t.debug,this._token=yF++,this.modules=new pF(this,t),this.styles=new DN(this),this.algorithms=new rC(this),this.export=new wN(this),this.keyboard=new lC(this),this.generate=new TN(this),this.layouts=new CN(this),this.parse=new IN(this),this.transformations=new fF(this),this.tools=new RN(this),this.view=new pM(this),this.mouse=new MN(this),this.events=new SN(this),this.schema=new lM(this),this.rules=new NN(this),this.geo=new aC(this),this.layers=new dC(this),this.debug=new EN(this),this._onReady.forEach(e=>e(this)),this.safelyBindToInstance(),this.modules.events.register(["destroy"]),this.build={version:"5.0.6",commit:"b7ae0e7b6",buildTime:"Fri Apr 12 2024 17:01:18 GMT+0000 (Coordinated Universal Time)"}}safelyBindToInstance(){for(const t of Object.getOwnPropertyNames(ph.prototype))typeof ph.prototype[t]=="function"&&(this[t]=this[t].bind(this))}onReady(t){this._onReady.push(t)}_destroy(){if(!this._token)throw new Error('"destroy" called twice on the same instance of Ogma');this._onReady=[],this.modules.destroy(),this.modules=null}destroy(){this.modules.events.fire("destroy",{}),this._destroy()}isDestroyed(){return!this.modules}reset(){const t=this._initParameters;this._destroy(),this._init(t)}isDebug(){return this._debug}},Ls=ph;Ls.libraries=cm,Ls.geometry=Zy,Ls.parse=_h,Ls.build=fh,Ls.algorithms=dd,Ls.utils=gd,Ls.algorithms=dd,Ls.utils=gd,Ls.parse=_h,Ls.build=fh,j0(Ls,xF);var bF=Ls,Wx=Sh(sm()),vF=bF;Wx.Neo4JEdgeData;Wx.Neo4JNodeData;const Ue=-1,Ga="dragging",Va="dragstart",zi="dragend",yh="select",xh="unselect",EF="hover",AF="unhover",bh="remove",vh="add",SF="cancelDrawing",Eh="update",wF="link";var TF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Cu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $x={exports:{}};(function(t){(function(e,s){t.exports=s()})("Vector",function(){var e=function(){var s=Math.PI*2,i=180/Math.PI,n=Math.PI/180;function r(d){return Math.round(d*1e8)/1e8}function o(d,h){var u=h.x-d.x,c=h.y-d.y;return Math.sqrt(u*u+c*c)}function a(d,h,u){var c=h.y-d.y,g=h.x-d.x,_=Math.atan2(c,g);if(u)for(;_<0;)_+=s;return _}function l(d,h){this.x=d!==void 0?d:0,this.y=h!==void 0?h:0}return l.fromRadians=function(d){var h=Math.cos(d),u=Math.sin(d);return new l(h,u)},l.fromDegrees=function(d){var h=d*(Math.PI/180);return l.fromRadians(h)},l.fromString=function(d){var h=d.split(",");return new l(parseFloat(h[0]),parseFloat(h[1]))},l.fromArray=function(d){return new l(d[0],d[1])},l.prototype={version:"2.0.1",clone:function(){return new l(this.x,this.y)},equals:function(d){return this.prototype===d.prototype&&this.x===d.x&&this.y===d.y},copy:function(d){return this.x=d.x,this.y=d.y,this},copyX:function(d){return this.x=d.x,this},copyY:function(d){return this.y=d.y,this},toDict:function(){return{x:this.x,y:this.y}},toArray:function(){return[this.x,this.y]},set:function(d,h){return d!==void 0&&(this.x=d),h!==void 0&&(this.y=h),this},flipXY:function(){return new l(this.y,this.x)},flipXYSelf:function(){return this.y=[this.x,this.x=this.y][0],this},invert:function(){return this.mulScalar(-1)},invertSelf:function(){return this.mulScalarSelf(-1),this},distanceFrom:function(d){return o(this,d)},radiansTo:function(d){return a(this,d,!0)},degreesTo:function(d){return a(this,d,!0)*i},toRadians:function(d){return a(l.zero,this,!0)},toDegrees:function(d){return this.toRadians()*i},rotateDegreesSelf:function(d){return this.rotateRadiansSelf(d*n)},rotateDegrees:function(d){return this.clone().rotateDegreesSelf(d)},rotateRadiansSelf:function(d){var h=Math.cos(d),u=Math.sin(d),c=this.x*h-this.y*u,g=this.x*u+this.y*h;return this.x=r(c),this.y=r(g),this},rotateRadians:function(d){return this.clone().rotateRadiansSelf(d)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalizeSelf:function(){var d=Math.sqrt(this.x*this.x+this.y*this.y);return d===0?this:(this.x/=d,this.y/=d,this)},normalize:function(){return this.clone().normalizeSelf()},addSelf:function(d){return typeof d=="number"?this.addScalarSelf(d):(this.x+=d.x,this.y+=d.y,this)},subSelf:function(d){return typeof d=="number"?this.subScalarSelf(d):(this.x-=d.x,this.y-=d.y,this)},divSelf:function(d){return typeof d=="number"?this.divScalarSelf(d):(this.x/=d.x,this.y/=d.y,this)},mulSelf:function(d){return typeof d=="number"?this.mulScalarSelf(d):(this.x*=d.x,this.y*=d.y,this)},addScalarSelf:function(d){return this.x+=d,this.y+=d,this},subScalarSelf:function(d){return this.x-=d,this.y-=d,this},divScalarSelf:function(d){return this.x/=d,this.y/=d,this},mulScalarSelf:function(d){return this.x*=d,this.y*=d,this},add:function(d){return this.clone().addSelf(d)},sub:function(d){return this.clone().subSelf(d)},mul:function(d){return this.clone().mulSelf(d)},div:function(d){return this.clone().divSelf(d)},addScalar:function(d){return this.clone().addScalarSelf(d)},subScalar:function(d){return this.clone().subScalarSelf(d)},mulScalar:function(d){return this.clone().mulScalarSelf(d)},divScalar:function(d){return this.clone().divScalarSelf(d)},clampSelf:function(d,h){return this.x<d.x&&(this.x=d.x),this.y<d.y&&(this.y=d.y),this.x>h.x&&(this.x=h.x),this.y>h.y&&(this.y=h.y),this},clamp:function(d,h){return this.clone().clampSelf(d,h)},applySelf:function(d){return this.x=d(this.x),this.y=d(this.y),this},apply:function(d){return this.clone().applySelf(d)},absSelf:function(){return this.applySelf(Math.abs)},abs:function(){return this.clone().absSelf()},roundSelf:function(){return this.applySelf(Math.round)},round:function(){return this.clone().roundSelf()},dot:function(d){return this.x*d.x+this.y*d.y},cross:function(d){return this.x*d.y-this.y*d.x},repairSelf:function(d,h){return(typeof this.x!="number"||isNaN(this.x+1))&&(this.x=d||0),(typeof this.y!="number"||isNaN(this.y+1))&&(this.y=h||0),this},repair:function(d,h){return this.clone().repairSelf(d,h)},toString:function(){return this.x+","+this.y},format:function(d){return d=d||"%x,%y",d=d.replace(new RegExp("%x","g"),this.x),d=d.replace(new RegExp("%y","g"),this.y),d}},l}();return e.zero=new e(0,0),e.one=new e(1,1),e.up=new e(0,-1),e.down=new e(0,1),e.left=new e(-1,0),e.right=new e(1,0),e.upLeft=new e(-1,-1),e.downLeft=new e(-1,1),e.upRight=new e(1,-1),e.downRight=new e(1,1),e.prototype.magnitude=e.prototype.length,Object.freeze&&(Object.freeze(e.zero),Object.freeze(e.one),Object.freeze(e.up),Object.freeze(e.down),Object.freeze(e.left),Object.freeze(e.right),Object.freeze(e.upLeft),Object.freeze(e.downLeft),Object.freeze(e.upRight),Object.freeze(e.downRight)),e})})($x);var LF=$x.exports;const Ve=Cu(LF);let yl=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,s)=>(s&=63,s<36?e+=s.toString(36):s<62?e+=(s-26).toString(36).toUpperCase():s>62?e+="-":e+="_",e),"");const Jr={strokeType:"plain",strokeColor:"black",strokeWidth:1,head:"none",tail:"none"},V_={id:0,type:"Feature",properties:{type:"arrow",style:{...Jr}},geometry:{type:"LineString",coordinates:[[0,0],[100,100]]}},Mu=(t=0,e=0,s=0,i=0,n={...Jr})=>({id:yl(),type:"Feature",properties:{type:"arrow",style:{...Jr,...n}},geometry:{type:"LineString",coordinates:[[t,e],[s,i]]}}),IF="http://www.w3.org/2000/svg";function Dr(t){return document.createElementNS(IF,t)}function Yx(t){return t.geometry.bbox||CF(t),t.geometry.bbox}function ri(t){const e=Yx(t);return{width:e[2]-e[0],height:e[3]-e[1]}}function si(t){const e=Yx(t);return{x:e[0],y:e[1]}}function CF(t){const[e,s]=t.geometry.coordinates[0][0],[i,n]=t.geometry.coordinates[0][2];t.geometry.bbox=[e,s,i,n]}function MF(t,e,s,i,n){t.geometry.bbox=[e,s,e+i,s+n],t.geometry.coordinates=[[[e,s],[e+i,s],[e+i,s+n],[e,s+n],[e,s]]]}function kr(t){const[e,s]=t.geometry.coordinates[0];return{x:e,y:s}}function sa(t,e){const[s,i]=t.geometry.coordinates[e==="start"?0:1];return{x:s,y:i}}function ja(t){const[e,s]=t.geometry.coordinates[1];return{x:e,y:s}}function Zx(t,e,s){t.geometry.coordinates[0]=[e,s]}function Kx(t,e,s){t.geometry.coordinates[1]=[e,s]}function qa(t){return{start:kr(t),end:ja(t)}}function An(t,e,s,i){e==="start"?Zx(t,s,i):Kx(t,s,i)}const Qx=t=>parseInt(t.getAttribute("data-handle-id")||"-1");function ia(t,e,s){const i=Math.atan2(t.y-e.y,t.x-e.x);return{x:e.x+s*Math.cos(i),y:e.y+s*Math.sin(i)}}function Ah(t,e){if(!e)return{x:t.clientX,y:t.clientY};const s=e.getBoundingClientRect();return{x:t.clientX-s.left-e.clientLeft,y:t.clientY-s.top-e.clientTop}}function Jx(t,e=5,s=30){var d;const{start:i,end:n}=qa(t),r=new Ve(i.x,i.y),a=new Ve(n.x,n.y).sub(r),l=t.properties.style&&t.properties.style.strokeWidth?(d=t.properties.style)==null?void 0:d.strokeWidth:0;return Math.min(s,Math.max(3*l,a.length()*.1,e))}function j_(t,e,s,i){const n=e.clone().normalize().invert().mul(i);if(!s||s==="none")return"";const r=t.clone().add(n.rotateRadians(Math.PI/8)),o=t.clone().add(n.rotateRadians(-Math.PI/8)),a=`${t.x} ${t.y}`;return`M ${r.x} ${r.y} L ${a} ${o.x} ${o.y} ${s==="arrow"?"":`${r.x} ${r.y}`}`}function NF(t,e,s,i,n){const{start:r,end:o}=qa(t),{tail:a,head:l,strokeColor:d,strokeWidth:h}=t.properties.style||s,u=new Ve(r.x,r.y),c=new Ve(o.x,o.y),g=c.clone().sub(u),_=Jx(t,i,n),m=Dr("path");m.setAttribute("data-annotation",`${t.id}`),m.setAttribute("data-annotation-type","arrow");const f=l==="arrow-plain"||a==="arrow";m.setAttribute("stroke",d||"none"),m.setAttribute("stroke-width",`${h}`),m.setAttribute("fill",f?d||"":"none"),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round");const p=j_(u,g.clone().invert(),a,_),y=j_(c,g,l,_),b=p+`M ${u.x} ${u.y} ${c.x} ${c.y}`+y;m.setAttribute("d",b),e.appendChild(m)}var t0={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,s="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(s=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}function r(l,d,h,u,c){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new n(h,u||l,c),_=s?s+d:d;return l._events[_]?l._events[_].fn?l._events[_]=[l._events[_],g]:l._events[_].push(g):(l._events[_]=g,l._eventsCount++),l}function o(l,d){--l._eventsCount===0?l._events=new i:delete l._events[d]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(s?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},a.prototype.listeners=function(d){var h=s?s+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,g=u.length,_=new Array(g);c<g;c++)_[c]=u[c].fn;return _},a.prototype.listenerCount=function(d){var h=s?s+d:d,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(d,h,u,c,g,_){var m=s?s+d:d;if(!this._events[m])return!1;var f=this._events[m],p=arguments.length,y,b;if(f.fn){switch(f.once&&this.removeListener(d,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,h),!0;case 3:return f.fn.call(f.context,h,u),!0;case 4:return f.fn.call(f.context,h,u,c),!0;case 5:return f.fn.call(f.context,h,u,c,g),!0;case 6:return f.fn.call(f.context,h,u,c,g,_),!0}for(b=1,y=new Array(p-1);b<p;b++)y[b-1]=arguments[b];f.fn.apply(f.context,y)}else{var x=f.length,v;for(b=0;b<x;b++)switch(f[b].once&&this.removeListener(d,f[b].fn,void 0,!0),p){case 1:f[b].fn.call(f[b].context);break;case 2:f[b].fn.call(f[b].context,h);break;case 3:f[b].fn.call(f[b].context,h,u);break;case 4:f[b].fn.call(f[b].context,h,u,c);break;default:if(!y)for(v=1,y=new Array(p-1);v<p;v++)y[v-1]=arguments[v];f[b].fn.apply(f[b].context,y)}}return!0},a.prototype.on=function(d,h,u){return r(this,d,h,u,!1)},a.prototype.once=function(d,h,u){return r(this,d,h,u,!0)},a.prototype.removeListener=function(d,h,u,c){var g=s?s+d:d;if(!this._events[g])return this;if(!h)return o(this,g),this;var _=this._events[g];if(_.fn)_.fn===h&&(!c||_.once)&&(!u||_.context===u)&&o(this,g);else{for(var m=0,f=[],p=_.length;m<p;m++)(_[m].fn!==h||c&&!_[m].once||u&&_[m].context!==u)&&f.push(_[m]);f.length?this._events[g]=f.length===1?f[0]:f:o(this,g)}return this},a.prototype.removeAllListeners=function(d){var h;return d?(h=s?s+d:d,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=s,a.EventEmitter=a,t.exports=a})(t0);var FF=t0.exports;const e0=Cu(FF);class s0 extends e0{constructor(s,i){super();Lt(this,"ogma");Lt(this,"elements");Lt(this,"layer");Lt(this,"editor");Lt(this,"selectedId",Ue);Lt(this,"hoveredId",Ue);Lt(this,"ogmaOptions");Lt(this,"shouldDetect");Lt(this,"isDragging");Lt(this,"showeditorOnHover");Lt(this,"maxHandleScale",1.5);Lt(this,"_onKeyUp",s=>{s.code===27&&this.selectedId!==Ue?this.unselect():(s.code===46||s.code===8)&&this.selectedId!==Ue&&this._canRemove()&&this.remove(this.selectedId)});Lt(this,"_onClickMouseMove",s=>{if(!s.domEvent||this.isDragging||!this.shouldDetect||s.domEvent.type!=="mousemove"&&s.domEvent.target&&s.domEvent.target.tagName==="a")return;const i=this.ogma.view.screenToGraphCoordinates(s),n=this.shouldDetect||!this.shouldDetect&&+this.selectedId>-1?this.detect(i,0):void 0;s.domEvent.type==="mousemove"?n?this.hover(n.id):this.hoveredId!==Ue&&this.unhover():n?this.select(n.id):this.selectedId!==Ue&&this.unselect()});this.ogma=s,this.elements=[],this.shouldDetect=!0,this.isDragging=!1,this.showeditorOnHover=!0,this.ogmaOptions=s.getOptions(),s.events.on(["click","mousemove"],this._onClickMouseMove).on("keyup",this._onKeyUp).on("frame",()=>{this.refreshEditor(),this.refreshDrawing()}),this.layer=s.layers.addSVGLayer({draw:n=>this.draw(n)}),this.layer.moveToTop(),this.editor=s.layers.addLayer(i),this.editor.hide()}_canRemove(){return!0}add(s){const i=this.getDefaultOptions(),n=Object.assign(s,{id:s.id===void 0?yl():s.id,type:s.type,properties:{...i.properties,...s.properties||{},style:{...i.properties.style,...s.properties.style||{}}},geometry:{...i.geometry,...s.geometry}});return this.elements.push(n),this.layer.refresh(),this.emit(vh,n),n}updateStyle(s,i){this.updateAnnotation(s,{properties:{style:i}})}updateGeometry(s,i){this.updateAnnotation(s,{geometry:i})}update(s,i){const n=this.getById(s);this.updateAnnotation(n,i)}updateAnnotation(s,i){if(!s)return;const n=s.id;Object.keys(i).forEach(r=>{if(r!=="id")if(r==="properties"){const o=i.properties||{style:{}};s.properties={...s.properties||{},...o||{},style:{...s.properties.style||{},...o.style||{}}}}else r==="geometry"?s.geometry={...s.geometry,...i.geometry}:s[r]=i[r]}),n===this.selectedId&&this.refreshEditor(),this.layer.refresh()}getById(s){const i=Number(s);for(let n=0;n<this.elements.length;n++){const r=this.elements[n];if(!(r.id!==s&&r.id!==i))return r}}select(s){const i=this.getById(s);i&&(this.editor.show(),this.selectedId=s,this.refreshEditor(),this.layer.refresh(),this.emit(yh,i))}hover(s){const i=this.getById(s);i&&(this.showeditorOnHover&&this.editor.show(),this.hoveredId=s,this.refreshEditor(),this.layer.refresh(),this.emit(EF,i))}getSelectedFeature(){return this.selectedId===Ue?null:this.getById(this.selectedId)}unselect(){const s=this.getById(this.selectedId);return s&&this.emit(xh,s),this.selectedId=Ue,this.hoveredId===Ue&&this.editor.hide(),this.layer.refresh(),this}unhover(){const s=this.getById(this.hoveredId);return this.emit(AF,s),this.hoveredId=Ue,this.selectedId===Ue&&this.editor.hide(),this.layer.refresh(),this}remove(s){const i=this.getById(s);s===this.hoveredId&&this.unhover(),s===this.selectedId&&this.unselect(),this.elements=this.elements.filter(n=>n.id!==s),i&&this.emit(bh,i),this.layer.refresh()}disableDragging(){this.ogma.setOptions({interactions:{drag:{enabled:!1},pan:{enabled:!1}},detect:{nodes:!1,edges:!1,nodeTexts:!1,edgeTexts:!1}})}restoreDragging(){this.ogma.setOptions(this.ogmaOptions)}enableDetection(){this.shouldDetect=!0}disableDetection(){this.shouldDetect=!1}refreshLayer(){this.layer.refresh()}refreshDrawing(){}getElements(){return[...this.elements]}destroy(){this.ogma.events.off(this._onClickMouseMove).off(this._onKeyUp),this.layer.destroy()}}const q_="handle-line",H_="handle-start",X_="handle-end";class PF extends s0{constructor(s,i={}){super(s,`
    <div class="arrow-handle">
      <div id="${q_}" data-handle-id="0" class="handle line"></div>
      <div id="${H_}" data-handle-id="1" class="handle"></div>
      <div id="${X_}" data-handle-id="2" class="handle"></div>
    </div>
  `);Lt(this,"draggedHandle",Ue);Lt(this,"start",{x:0,y:0});Lt(this,"end",{x:0,y:0});Lt(this,"arrow",{...V_});Lt(this,"startX",0);Lt(this,"startY",0);Lt(this,"minArrowHeight",0);Lt(this,"maxArrowHeight",0);Lt(this,"handles",[]);Lt(this,"onHandleMouseDown",s=>{const i=this.getById(this.selectedId)||this.getById(this.hoveredId);if(!i)return;const{x:n,y:r}=Ah(s,this.ogma.getContainer());this.startDragging(i,n,r),this.draggedHandle=Qx(s.target)});Lt(this,"onMouseUp",()=>{this.draggedHandle!==-1&&(this.restoreDragging(),this.isDragging=!1,this.draggedHandle=Ue,this.emit(zi,this.arrow))});Lt(this,"onMouseMove",s=>{if(!this.isDragging||this.draggedHandle===Ue)return;const i=this.handles[this.draggedHandle],n=this.ogma.view.getAngle(),{x:r,y:o}=new Ve(s.clientX-this.startX,s.clientY-this.startY).divScalar(this.ogma.view.getZoom()).rotateRadians(n),a=i.id===q_,l=i.id===H_,d=i.id===X_;(a||l)&&Zx(this.arrow,this.start.x+r,this.start.y+o),(a||d)&&Kx(this.arrow,this.end.x+r,this.end.y+o),this.emit(Ga,this.arrow,a?"line":l?"start":"end"),this.refreshEditor(),this.layer.refresh()});this.minArrowHeight=i.minArrowHeight||0,this.maxArrowHeight=i.maxArrowHeight||1e6,this.handles=Array.prototype.slice.call(this.editor.element.querySelectorAll(".arrow-handle>.handle")),this.handles.forEach(n=>n.addEventListener("mousedown",this.onHandleMouseDown)),document.addEventListener("mousemove",this.onMouseMove,!0),document.addEventListener("mouseup",this.onMouseUp)}startDrawing(s,i,n=Mu(s,i,s,i,Jr)){var a;this.disableDragging(),this.add(n),this.hoveredId=n.id;const r=this.ogma.view.graphToScreenCoordinates({x:s,y:i}),o=((a=this.ogma.getContainer())==null?void 0:a.getBoundingClientRect())||{left:0,top:0};this.startDragging(this.getById(n.id),r.x+(o==null?void 0:o.left),r.y+o.top),this.draggedHandle=2}cancelDrawing(){this.isDragging&&(this.remove(this.arrow.id),this.emit(zi,this.arrow),this.restoreDragging(),this.isDragging=!1,this.draggedHandle=Ue)}startDragging(s,i,n){this.selectedId!==s.id&&this.select(this.hoveredId),this.arrow=s,this.startX=i,this.startY=n,this.start=kr(this.arrow),this.end=ja(this.arrow),this.disableDragging(),this.emit(Va,this.arrow),this.isDragging=!0}detect(s,i=0){return this.elements.find(n=>{const{start:r,end:o}=qa(n),a=new Ve(s.x,s.y).sub(new Ve((r.x+o.x)/2,(r.y+o.y)/2)),l=new Ve(o.x,o.y).sub(new Ve(r.x,r.y)),d=l.length(),h=l.normalize(),u=Jx(n);return Math.abs(h.dot(a))<d/2+i&&Math.abs(h.rotateRadians(Math.PI/2).dot(a))<u/2+i})}refreshEditor(){if(+this.selectedId<0&&+this.hoveredId<0)return;const s=this.selectedId!==Ue?this.getById(this.selectedId):this.getById(this.hoveredId),i=qa(s),n=this.ogma.view.graphToScreenCoordinates(i.start),r=this.ogma.view.graphToScreenCoordinates(i.end),o=Math.min(this.ogma.view.getZoom(),this.maxHandleScale),[a,l,d]=Array.prototype.slice.call(this.editor.element.querySelectorAll(".handle"));l.style.transform=`translate(${n.x}px, ${n.y}px) translate(-50%, -50%) scale(${o})`,d.style.transform=`translate(${r.x}px, ${r.y}px) translate(-50%, -50%) scale(${o}`;const h={x:(r.x+n.x)/2,y:(r.y+n.y)/2},u=new Ve(r.x-n.x,r.y-n.y),c=u.mul(1/u.length()),g=Math.atan2(c.y,c.x);a.style.width=`${u.length()}px`,a.style.left=`${h.x}px`,a.style.top=`${h.y}px`,a.style.transform=`translate(-50%, -50%) rotate(${g}rad)`}getDefaultOptions(){return V_}draw(s){s.innerHTML="";const i=Dr("g"),n=this.ogma.view.getAngle();i.setAttribute("transform",`rotate(${-n*(180/Math.PI)})`),this.elements.forEach(r=>NF(r,i,Jr,this.minArrowHeight,this.maxArrowHeight)),s.appendChild(i)}refreshDrawing(){const s=this.ogma.view.getAngle();this.layer.element.children[0].setAttribute("transform",`rotate(${-s*(180/Math.PI)})`)}destroy(){super.destroy(),document.removeEventListener("mousemove",this.onMouseMove,!0),document.removeEventListener("mouseup",this.onMouseUp)}}const Un={font:"sans-serif",fontSize:12,color:"black",background:"",strokeWidth:1,strokeColor:"#000",strokeType:"plain"},od={id:0,type:"Feature",properties:{type:"text",content:"",style:{...Un}},geometry:{type:"Polygon",coordinates:[[[0,0],[100,0],[100,50],[0,50],[0,0]]]}},W_={handleSize:3.5,placeholder:"Your text..."},i0=(t=0,e=0,s=100,i=50,n="",r={...Un})=>({id:yl(),type:"Feature",properties:{type:"text",content:n,style:{...Un,...r}},geometry:{type:"Polygon",coordinates:[[[t,e],[t+s,e],[t+s,e+i],[t,e+i],[t,e]]]}});var n0={exports:{}};(function(t,e){(function(s,i){t.exports=i()})(TF,()=>(()=>{var s={d:(C,D)=>{for(var G in D)s.o(D,G)&&!s.o(C,G)&&Object.defineProperty(C,G,{enumerable:!0,get:D[G]})},o:(C,D)=>Object.prototype.hasOwnProperty.call(C,D)},i={};function n(C){return n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},n(C)}s.d(i,{default:()=>Ye});var r=/^((?:[a-z\d-]+\s+)*)([\d.]+(%|em|px)|(?:x+-)?large|(?:x+-)?small|medium)(?:\s*\/\s*(normal|[\d.]+(%|px|em)?))?(\s.+)?$/,o=/\bsmall-caps\b/,a=/\b(?:italic|oblique)\b/,l=/\bbold(?:er)?\b/,d=13.3333333,h={"xx-small":9,"x-small":10,smaller:13.3333,small:13,medium:16,large:18,larger:19.2,"x-large":24,"xx-large":32};function u(C){var D="",G=this;return G.style&&G.style!=="normal"&&(D+=G.style),G.variant&&G.variant!=="normal"&&(D+=(D?" ":"")+G.variant),G.weight&&G.weight!=="normal"&&(D+=(D?" ":"")+G.weight),G.size&&(D+=(D?" ":"")+G.size+"px",G.height!==G.size&&(D+="/"+G.height+"px")),G.family&&(D+=(D?" ":"")+G.family),C&&(D+="::"+G.baseline),C&&(D+="::"+G.color),D}var c={id:"",family:"sans-serif",height:14,size:12,variant:"",style:"",weight:"",baseline:"",color:null,toString:u,valueOf:u};function g(C){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},G=r.exec(C);D.family=(G[6]||"").trim();var R=h[G[2]]||parseFloat(G[2]);G[3]==="%"?R*=.16:G[3]==="em"?R*=16:G[3]==="pt"&&(R*=d),D.size=R;var Q=parseFloat(G[4]);if(Q!=="normal"&&Q!=="inherit"&&Q?G[5]&&G[5]!=="em"?G[5]==="pt"?D.height=Q*d:G[5]==="%"?D.height=.01*R:D.height=Q:D.height=Q*R:D.height=Math.round(R*(7/6)),o.test(G[1])&&(D.variant="small-caps"),a.test(G[1])&&(D.style="italic"),l.test(G[1]))D.weight="bold";else{var xt=parseInt(/\b(\d+)\b/.exec(G[1]),10);xt>=100&&xt!==400&&(D.weight=xt)}return D}function _(){var C,D,G,R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"12px/14px sans-serif",Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},xt=14,Ft=12,It=null,Ct=null,Ot="";if(R&&R.nodeType){var jt=R&&(R.ownerDocument&&R.ownerDocument.defaultView||R.document&&R||R.defaultView),Xt=jt.getComputedStyle(R,null);C=Xt.getPropertyValue("font-family")||"",Ft=parseFloat(Xt.getPropertyValue("font-size")),xt=Xt.getPropertyValue("line-height"),It=Xt.getPropertyValue("font-weight"),Ct=Xt.getPropertyValue("font-style"),Ot=Xt.getPropertyValue("font-variant")||""}else if(typeof R=="string"){var Ut=g(R);C=Ut.family,Ft=Ut.size,xt=Ut.height,Ot=Ut.variant,Ct=Ut.style,It=Ut.weight}else n(R)==="object"&&(C=R.family,Ft=R.size,xt=R.height,Ot=R.variant,It=R.weight,Ct=R.style,D=R.baseline,G=R.color);Q.size&&Q.size<3&&(Ft*=Q.size),xt=xt!=="normal"&&xt?parseFloat(xt):Ft*(7/6),Q.height&&Q.height<3&&(xt*=Q.height);var Vt=Object.create(c);return Vt.family=Q.family||C||"sans-serif",Vt.height=xt??14,Vt.size=Ft??12,Vt.variant=Q.variant||Ot||"",Vt.style=Q.style||Ct||"",Vt.weight=Q.weight||It||"",Vt.baseline=D||0,Q.baseline!=null&&(Vt.baseline=Q.baseline),Vt.color=Q.color||G||"",Vt.id=u.call(Vt,!0),Vt}const m={"\n":.28,"\r":.28," ":.28," ":.28," ":.28,"᠎":0," ":.5," ":1," ":.5," ":1," ":.33," ":.25," ":.16," ":.56," ":.28," ":.2," ":.15,"​":0," ":.16," ":.22,"　":1,"\uFEFF":0};var f,p=function(C){var D=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(100,100)||C&&C.createElement("canvas");if(D&&D.getContext){var G=D.getContext("2d");if(G&&typeof G.measureText=="function")return function(R,Q){return G.font=String(Q),G.measureText(R).width}}}(typeof document<"u"?document:null)||(f={},function(C,D){if(!f[D]){var G=_(D);f[D]=G,/\bmonospace\b/.test(G.family)?G.size*=.6:(G.size*=.45,G.weight&&(G.size*=1.18))}return C.length*f[D].size}),y={},b={trim:!0,collapse:!0};function x(C,D,G){var R=Object.assign({},b,G),Q=String(C);if(!Q)return 0;if(Q in m){var xt=D.id+"/"+Q;return xt in y||(y[xt]=p("_".concat(Q,"_"),D)-p("__",D)),y[xt]}return R.trim&&R.collapse?R.trim?Q=Q.trim():R.collapse&&(Q=Q.replace(/\s+/g," ")):Q=Q.replace(/\n/g," "),p(Q,D)+D.size*(C.tracking||0)}function v(C){return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},v(C)}function E(C,D){if(typeof D!="function"&&D!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(D&&D.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),D&&w(C,D)}function w(C,D){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(G,R){return G.__proto__=R,G},w(C,D)}function A(C){var D=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var G,R=M(C);if(D){var Q=M(this).constructor;G=Reflect.construct(R,arguments,Q)}else G=R.apply(this,arguments);return I(this,G)}}function I(C,D){if(D&&(v(D)==="object"||typeof D=="function"))return D;if(D!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(G){if(G===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return G}(C)}function M(C){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(D){return D.__proto__||Object.getPrototypeOf(D)},M(C)}function k(C,D){if(!(C instanceof D))throw new TypeError("Cannot call a class as a function")}function W(C,D){for(var G=0;G<D.length;G++){var R=D[G];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(C,(Q=function(xt,Ft){if(v(xt)!=="object"||xt===null)return xt;var It=xt[Symbol.toPrimitive];if(It!==void 0){var Ct=It.call(xt,Ft);if(v(Ct)!=="object")return Ct;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(xt)}(R.key,"string"),v(Q)==="symbol"?Q:String(Q)),R)}var Q}function H(C,D,G){return D&&W(C.prototype,D),G&&W(C,G),Object.defineProperty(C,"prototype",{writable:!1}),C}var $=function(){function C(){var D=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";k(this,C),this.value=D,this.weight=null,this.style=null,this.font=null,this.href=null,this.sub=!1,this.sup=!1}return H(C,[{key:"clone",value:function(){var D=new C(this.value);return D.value=this.value,D.weight=this.weight,D.style=this.style,D.font=this.font,D.href=this.href,D.sub=this.sub,D.sup=this.sup,D}},{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}}]),C}(),P=function(C){E(G,C);var D=A(G);function G(){return k(this,G),D.apply(this,arguments)}return H(G)}($),S=function(C){E(G,C);var D=A(G);function G(){return k(this,G),D.apply(this,arguments)}return H(G)}($),Y=function(C){E(G,C);var D=A(G);function G(){return k(this,G),D.apply(this,arguments)}return H(G)}($),st=/^[\n\r\t\x20\xA0\u2000-\u200B\u205F\u3000]/,at=/^[^\n\r\t\u0020\u2000-\u200B\u205F\u3000]{2,}/,Tt=/^[\xA0\u2011\u202F\u2060\uFEFF]/,ut=/^(?:[;\xAD%?…]|,(?!\d))/,Mt=/^[´±°¢£¤$¥\u2212]/;function Nt(C,D){D!==!1&&(C=C.trim());for(var G,R,Q=[],xt=C.charAt(0),Ft=0,It=1,Ct=C.length;It<Ct;It++){G=C.charAt(It),R=C.charAt(It+1);var Ot=st.test(xt),jt=st.test(G),Xt=jt||Ot,Ut=void 0;if((Mt.test(G)&&!Tt.test(xt)||ut.test(xt+R)&&!Tt.test(G))&&(Xt=!0),xt!=="-"&&xt!=="‐"&&xt!=="–"&&xt!=="—"||((Ut=st.test(C.charAt(It-2)))&&!jt&&(Xt=!1),!Ut&&at.test(G+R)&&(Xt=!0)),Xt){var Vt=C.slice(Ft,It);/\u00AD$/.test(Vt)?(Q.push(new $(Vt.slice(0,-1))),Q.push(new Y)):(Q.push(new $(Vt)),Q.push(new P)),Ft=It}xt=G}return Q.push(new $(C.slice(Ft))),Q}const _t={nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",fnof:"ƒ",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",bull:"•",hellip:"…",prime:"′",Prime:"″",oline:"‾",frasl:"⁄",weierp:"℘",image:"ℑ",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"⊥",or:"⊦",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",lang:"〈",rang:"〉",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",quot:'"',amp:"&",lt:"<",gt:">",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",permil:"‰",lsaquo:"‹",rsaquo:"›"};var St=/^[\n\r\x20\u2000-\u200B\u205F\u3000]/,Zt=/^<\/([a-zA-Z0-9]+)([^>]*)>/,Qt=/^<([a-zA-Z0-9]+)((?:\s[^=\s/]+(?:\s*=\s*(?:"[^"]+"|'[^']+'|[^>\\s]+))?)+)?\s*(\/?)>(\n*)/,Kt=/^<!--(.+?)-->/,mt=/&(?:#(\d\d{2,})|#x([\da-fA-F]{2,})|([a-zA-Z][a-zA-Z1-4]{1,8}));/g,pt={b:function(C){C.weight="bold"},strong:function(C){C.weight="bold"},i:function(C){C.style="italic"},em:function(C){C.style="italic"},dfn:function(C){C.style="italic"},cite:function(C){C.style="italic"},code:function(C){C.family="monospace"},kbd:function(C){C.family="monospace"},samp:function(C){C.family="monospace"},var:function(C){C.family="monospace"},tt:function(C){C.family="monospace"},sub:function(C){C.sub=!0},sup:function(C){C.sup=!0}},ue={div:1,li:1,blockquote:2,h1:2,h2:2,h3:2,h4:2,h5:2,h6:2,ul:2,ol:2,hr:2,p:2};function Jt(C){return C.replace(mt,function(D,G,R,Q){if(G||R){var xt=G?10:16;return String.fromCharCode(parseInt(G||R,xt))}return Q in _t?_t[Q]:D})}function ce(C){return C&&C.length>1&&(C[0]==='"'&&C[C.length-1]==='"'||C[0]==="'"&&C[C.length-1]==="'")?C.slice(1,-1):C}var oe=/^\s*([^=\s&]+)(?:\s*=\s*("[^"]+"|'[^']+'|[^>\s]+))?/;function q(C){var D,G={};if(C){do if(D=oe.exec(C)){var R=Jt(ce(D[2]||"")).replace(/[ \r\n\t]+/g," ").trim();if(G[D[1]]=R,(C=C.slice(D[0].length)).length&&/^\S/.test(C[0]))throw new Error("Attribute error")}while(D&&C.length);if(/\S/.test(C))throw new Error("Attribute error")}return G}const et={copyright:"©",textcopyright:"©",dag:"†",textdagger:"†",ddag:"‡",textdaggerdbl:"‡",guillemotleft:"«",guillemotright:"»",guilsinglleft:"‹",guilsinglright:"›",ldots:"…",dots:"…",textellipsis:"…",lq:"‘",P:"¶",textparagraph:"¶",pounds:"£",textsterling:"£",quotedblbase:"„",quotesinglbase:"‚",rq:"’",S:"§",sim:"~",textasciicircum:"^",textasciitilde:"˜",texttildelow:"~",textasteriskcentered:"*",textbackslash:"'",textbar:"|",textbardbl:"╎",textbigcircle:"◯",textbraceleft:"{",textbraceright:"}",textbullet:"•",textdollar:"$",textemdash:"—",textendash:"—",texteuro:"€",eurosym:"€",euro:"€",textexclamdown:"¡",textgreater:">",textless:"<",textordfeminine:"ª",textordmasculine:"º",textperiodcentered:"·",cdot:"·",textquestiondown:"¿",textquotedblleft:"“",textquotedblright:"”",textquoteleft:"‘",textquoteright:"’",textquotestraightbase:"‚",textquotestraightdblbase:"„",textregistered:"®",textthreequartersemdash:"-",texttrademark:"™",texttwelveudash:"-",textunderscore:"_",textvisiblespace:"␣",gets:"←",textleftarrow:"←",to:"→",textrightarrow:"→",textdegree:"°",infty:"∞",triangle:"△",triangledown:"▽",blacktriangle:"▲",blacktriangledown:"▼",angle:"∠",sphericalangle:"∢",aleph:"ℵ",hbar:"ħ",imath:"𝚤",jmath:"𝚥",ell:"ℓ",wp:"℘",Re:"ℜ",Im:"ℑ",mho:"℧",prime:"′",emptyset:"∅",nabla:"∇",surd:"√",partial:"∂",top:"⟙",bot:"⟂",vdash:"⟝",dashv:"⟞",forall:"∀",exists:"∃",nexists:"∄",neg:"¬",lnot:"¬",flat:"♭",natural:"♮",sharp:"♯",backslash:"\\",Box:"□",Diamond:"♢",clubsuit:"♣",diamondsuit:"♦",heartsuit:"♥",spadesuit:"♠",Join:"⨝",blacksquare:"■",bigstar:"★",diagdown:"╲",diagup:"╱",blacklozenge:"⧫",rfloor:"⌋",lfloor:"⌊",rceil:"⌉",lceil:"⌈",rangle:"⟩",langle:"⟨",sum:"∑",int:"∫",oint:"∮",prod:"∏",coprod:"∏",bigcap:"∩",bigcup:"∪",bigsqcup:"⊔",bigvee:"∨",bigwedge:"∧",bigodot:"⊙",bigotimes:"⊗",bigoplus:"⊕",biguplus:"⊎",alpha:"α",beta:"β",chi:"χ",delta:"δ",epsilon:"ε",eta:"η",gamma:"γ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",omega:"ω",phi:"φ",pi:"π",psi:"ψ",rho:"ρ",sigma:"σ",tau:"τ",theta:"θ",upsilon:"υ",xi:"ξ",zeta:"ζ",Alpha:"Α",Beta:"Β",Chi:"Χ",Delta:"Δ",Epsilon:"Ε",Eta:"Η",Gamma:"Γ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Omega:"Ω",Phi:"Φ",Pi:"Π",Psi:"Ψ",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Theta:"Θ",Upsilon:"Υ",Xi:"Ξ",Zeta:"Ζ",aa:"å",AA:"Å",ae:"æ",AE:"Æ",dh:"ð",DH:"Ð",dj:"đ",DJ:"Đ",ij:"ĳ",IJ:"Ĳ",l:"ł",L:"Ł",ng:"ŋ",NG:"Ŋ",o:"ø",O:"Ø",oe:"œ",OE:"Œ",ss:"ß",SS:"SS",th:"þ",TH:"Þ"};var dt=/^(\^|_|\\[^#$%&~_^\\{}()\s]+)(\{)?/,ot=/^%[^\n]+(?:\n|$)/,nt=/^[^#$%&~_^\\{}]+/,it=/^\\([&{}$%#_])/,wt=/(?:\\[\\@,!:;-]|-{2,3}|[!?]`|``?|,,|''?|~|<<|>>)/g,At={"---":"—","--":"–","!`":"¡","?`":"¿","``":"“",",,":"„","''":"”","`":"‘","'":"’","<<":"«",">>":"»","~":" ","\\-":"­","\\,":" ","\\;":" ","\\:":" ","\\!":" ","\\@":"\uFEFF","\\\\":"\\newline{}"},Et={bf:function(C){C.weight="bold"},it:function(C){C.style="italic"},sl:function(C){C.style="italic"},color:function(C,D){C.color=D},href:function(C,D){C.href=D},"^":function(C){C.sup=!0},_:function(C){C.sub=!0},par:function(C){this.tokens.push(new S,new S)},newline:function(C){this.tokens.push(new S)},url:function(C,D){this.open_context().href=D,this.add_token(new $(D)),this.close_context()}};Et.textsuperscript=Et["^"],Et.textsubscript=Et._,Et.textsl=Et.sl,Et.mathbf=Et.bf,Et.mathit=Et.it,Et.textbf=Et.bf,Et.textit=Et.it,Et.textcolor=Et.color;var Ht=/[\r\n\xA0]+/g;function Gt(C,D){C.sup&&(C.baseline=.45,C.size=.7),C.sub&&(C.baseline=-.3,C.size=.7);var G=D;return(C.style||C.weight||C.baseline||C.color||C.size||C.family)&&(G=_(D,C)),G}function pe(C,D,G){for(var R,Q,xt=C.width;xt+G.width>D&&C.length;)Q=(R=C[C.length-1]).width,R.width>G.width?(R.value=R.value.slice(0,-1),R.width=x(R,R.font),xt+=R.width):C.pop(),xt-=Q;C[C.length-1]instanceof Y&&C.pop(),R=C[C.length-1]||R||{},G.font=_(G.font,R.bold,R.italic,""),G.href=C.length?R.href:null,G.rel=C.length?R.rel:null,G.target=C.length?R.target:null,C.push(G)}function ge(C){return Math.round(1e6*C)/1e6}function _e(C){return function(D){if(Array.isArray(D))return be(D)}(C)||function(D){if(typeof Symbol<"u"&&D[Symbol.iterator]!=null||D["@@iterator"]!=null)return Array.from(D)}(C)||function(D,G){if(D){if(typeof D=="string")return be(D,G);var R=Object.prototype.toString.call(D).slice(8,-1);return R==="Object"&&D.constructor&&(R=D.constructor.name),R==="Map"||R==="Set"?Array.from(D):R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R)?be(D,G):void 0}}(C)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function be(C,D){(D==null||D>C.length)&&(D=C.length);for(var G=0,R=new Array(D);G<D;G++)R[G]=C[G];return R}var Ce={center:"middle",right:"end"},$t={middle:.5,center:.5,bottom:1,end:1},re=function(C,D){return!C&&!D||C===D};function ve(C,D){var G=[],R=D.font(),Q=R.size,xt=R.family,Ft=D.align(),It=D.createElement();if(C.length){var Ct=R.height,Ot=D.valign(),jt=D.height()(),Xt=D.width()(0),Ut=!isFinite(Xt)&&C.length===1,Vt=Ut?null:D.x(),T=ge(Ct/Q),F=Ut?null:ge(Ct/(1.15*Q+(Ct-Q)/2));if($t[Ot]&&isFinite(jt)){var L=Ot==="bottom"?1:.5;F+=(jt*L-Ct*C.length*L)/Q}var N=Ft==="justify",z=0;Ft==="right"?z=Xt:Ft==="center"&&(z=Xt/2);for(var V=[],B="tspan",X=null,j="",O=function(){if(j){var zt=It(B,X,j);V.push(zt)}B="tspan",X=null,j=""},U=0,Z=C.length;U<Z;U++){var J="",rt="",K=0,tt=C[U];if(tt.length){V=[];for(var gt=0,bt=0,ft=void 0,ht=0,vt=tt.length;ht<vt;ht++){var lt=tt[ht],yt=lt.font;lt.whitespace&&gt++,bt+=lt.width,ht&&!lt.tracking&&!K&&re(yt.id,J)&&re(lt.class,rt)&&re(ft,lt.href)?j+=lt.value:(O(),j=lt.value,X={fontFamily:yt.family!==xt?yt.family:null,fontSize:yt.size!==Q?yt.size:null,fontWeight:yt.weight||null,fontStyle:yt.style||null,fontVariant:yt.variant!=="normal"&&yt.variant||null,fill:yt.color||null,baselineShift:yt.baseline?100*yt.baseline+"%":null,className:lt.class||null},K&&(X.dx=ge(K),K=0),lt.tracking&&(K=yt.size*lt.tracking),lt.href&&!ft?(ft=lt.href,B="a",X.href=ft,X.rel=lt.rel,X.target=lt.target):ft=null,J=yt.id,rt=lt.class)}if(O(),Ut)G.push.apply(G,_e(V));else{var Pt=null,kt=U===Z-1||tt[tt.length-1]instanceof S;N&&tt.length>1&&!kt&&(Pt=ge((Xt-bt)/gt)),G.push(It.apply(void 0,["tspan",{wordSpacing:Pt,x:Vt(U)+z,dy:ge(U?T:F)+"em"}].concat(_e(V))))}}else G.push(It("tspan",{x:Vt(U),dy:ge(U?T:F)+"em"}," "))}}return It.apply(void 0,["text",{fontFamily:xt,fontSize:Q,textAnchor:Ce[Ft]||"start"}].concat(G))}var fe={middle:.5,center:.5,bottom:1,end:1};function ee(C,D,G){if(C.length){G.textBaseline="middle";var R=D.font(),Q=R.height,xt=R.size,Ft=D.valign(),It=D.height()(),Ct=D.width()(0),Ot=D.align(),jt=Ot==="justify",Xt=.5*Q,Ut=fe[Ft];if(Ut&&isFinite(It)){var Vt=C.length*Q;Xt+=It*Ut-Vt*Ut}C.forEach(function(T,F){var L=D.x()(F),N=F*Q+Xt,z=0,V=0;T.forEach(function(j){j.whitespace&&z++,V+=j.width});var B=0,X=F===C.length-1||T[T.length-1]instanceof S;jt&&T.length>1&&!X&&(B=(Ct-V)/z),T.forEach(function(j){G.font=j.font;var O=j.font,U=O.baseline?xt*-O.baseline+.15*xt:0;G.fillStyle=function(rt,K){return rt.color?rt.color:K.href?"#00C":"#000"}(O,j);var Z=0;if(Ot==="right"?Z+=Ct-V:Ot==="center"?Z+=Ct/2-V/2:Ot==="justify"&&(j.whitespace||j instanceof S)&&(L+=B),G.fillText(j.value,L+Z,N+U),j.href){G.beginPath(),G.strokeStyle=G.fillStyle;var J=Math.floor(N+.45*xt)+.5;G.moveTo(L+Z,J),G.lineTo(L+Z+j.width,J),G.stroke()}L+=j.width})})}}function we(C){return we=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},we(C)}function ye(C){for(var D={},G=0;G<C.length;G++){var R=C[G];typeof R!="number"&&R!=null&&(typeof R=="string"?D.text=R:typeof R=="function"?D.fn=R:we(R)==="object"&&R._groups?D.d3=R:R&&R.nodeType&&R.getContext?D.ctx=R.getContext("2d"):R&&R.fillText&&R.beginPath?D.ctx=R:R&&(D.text=R))}return D}function Pe(C){return Pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},Pe(C)}function ps(C,D){for(var G=0;G<D.length;G++){var R=D[G];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(C,(Q=function(xt,Ft){if(Pe(xt)!=="object"||xt===null)return xt;var It=xt[Symbol.toPrimitive];if(It!==void 0){var Ct=It.call(xt,Ft);if(Pe(Ct)!=="object")return Ct;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(xt)}(R.key,"string"),Pe(Q)==="symbol"?Q:String(Q)),R)}var Q}var te=_(),se=function(C){return typeof C=="function"?C:function(){return C}},ie=function(){function C(R){if(function(xt,Ft){if(!(xt instanceof Ft))throw new TypeError("Cannot call a class as a function")}(this,C),this.props={overflow:"ellipsis",lineclamp:null,align:"left",wordBreak:null,valign:"top",width:function(){return 1/0},height:function(){return 1/0},x:function(){return 0},font:null,tAnchor:0,parser:C.defaultparser},R)for(var Q in R)typeof this[Q]=="function"&&this[Q](R[Q])}var D,G;return D=C,G=[{key:"linebreak",value:function(R){var Q=this,xt=this.props.parser(String(R)),Ft=this.font(),It=function(Ct,Ot,jt){if(!Ct.length)return[];var Xt=Ot.height(),Ut=Ot.width(),Vt=Ot.overflowLine(),T=Ot.overflowWrap(),F=_(jt,!0,!1),L=isFinite(Xt())?Math.floor(Xt()/jt.height):1/0;if(!Xt()&&!Ut(0)||!L)return[];for(var N=0,z=0,V=0,B=[],X=[],j=!1;N<Ct.length&&z<L;){var O=Ct[N],U=Gt(O,jt);if(O.width=x(O,U),O.font=U,O.line=z,O.whitespace=O.value in m,O.value&&(O.value=O.value.replace(Ht," ")),!(!V&&O.whitespace||j&&O.whitespace))if(O instanceof S)V=0,X=[],B.push(N+1),z++;else if(O instanceof P||O instanceof Y)X.push({index:N,width:V});else if(O.whitespace||V+O.width<Ut(z))V+=O.width;else if(X.length){var Z=void 0,J=void 0;do{J=!0,Z=X.pop();var rt=Ct[Z.index],K=void 0;rt instanceof Y&&(K=x("-",rt.font),Z.width+K>Ut(z)&&(J=!X.length))}while(!J);B.push(Z.index+1),V=0,z++,N=Z.index,X=[]}else if(T==="break-word"){var tt=Ut(z);if(V+O.width>tt){var gt=O.clone();do O.value=O.value.slice(0,-1),O.width=x(O,O.font),V+=O.width;while(O.value&&O.width>tt);gt.value=gt.value.slice(O.value.length),Ct.splice(N+1,0,new P,gt)}B.push(N+1),V=0,z++}else V+=O.width;N++,j=O.whitespace}N!==B[B.length-1]&&B.push(N);var bt=0,ft=0,ht=B.map(function(zt){for(var Rt,Yt=bt;(Rt=Ct[Yt])&&(Rt.whitespace||!Rt.value);)Yt++;for(var ne=zt,ae=null;ne>Yt&&(Rt=Ct[ne-1])&&(Rt.whitespace||!(Rt.value||Rt instanceof Y));)Rt instanceof S&&(ae=Rt),ne--;Rt instanceof Y&&(Rt.value="-",Rt.width=x("-",Rt.font)),bt=zt;var Te=Ct.slice(Yt,ne).filter(function(Xe){return Xe.value});return ae&&Te.push(ae),Te.width=Te.reduce(function(Xe,_s){return Xe+_s.width},0),Te.width>ft&&(ft=Te.width),Te});if(ht.hasLineOverflow=!1,Vt){var vt=Vt==="ellipsis"?"…":Vt;ht.forEach(function(zt,Rt){var Yt=Ut(Rt);if(zt.width>Yt){var ne=new $(vt);ne.font=jt,ne.width=x(vt,F),pe(zt,Yt,ne),ht.hasLineOverflow=!0}})}var lt=Ot.overflow()==="ellipsis"?"…":Ot.overflow();if(lt&&N!==Ct.length){var yt=Ut(ht.length-1),Pt=ht[ht.length-1],kt=new $(lt);kt.font=jt,kt.width=x(lt,F),pe(Pt,yt,kt),ht.hasOverflow=!0}else ht.hasOverflow=!1;return ht.font=jt,ht.width=ft,ht}(xt,this,Ft);return It.height=It.length*Ft.height,It.render=function(Ct){return Q.render(It,Ct)},It.svg=It.render,It.draw=It.render,It}},{key:"font",value:function(R){return arguments.length?(this.props.font=_(R),this):this.props.font||_(te)}},{key:"overflow",value:function(R){return arguments.length?(this.props.overflow=String(R),this):this.props.overflow}},{key:"overflowLine",value:function(R){return arguments.length?(this.props.lineclamp=String(R),this):this.props.lineclamp}},{key:"valign",value:function(R){return arguments.length?(this.props.valign=R,this):this.props.valign}},{key:"align",value:function(R){if(!arguments.length)return this.props.align;var Q=String(R).toLowerCase();return Q==="left"||Q==="start"?(this.props.align="left",this.props.tAnchor=0):Q==="center"||Q==="middle"?(this.props.align="center",this.props.tAnchor=-.5):Q==="end"||Q==="right"?(this.props.align="right",this.props.tAnchor=-1):Q==="justify"&&(this.props.align=R,this.props.tAnchor=0),this}},{key:"overflowWrap",value:function(R){if(!arguments.length)return this.props.overflowWrap||"normal";var Q=String(R).toLowerCase();return Q==="break-word"?this.props.overflowWrap="break-word":Q!=="normal"&&R!=null||(this.props.overflowWrap=null),this}},{key:"width",value:function(R){return arguments.length?(this.props.width=se(R),this):this.props.width}},{key:"height",value:function(R){return arguments.length?(this.props.height=se(R),this):this.props.height}},{key:"x",value:function(R){return arguments.length?(this.props.x=se(R),this):this.props.x}},{key:"parser",value:function(R){if(!arguments.length)return this.props.parser;if(typeof R=="string"){var Q=C[R]||C[R+"parser"];typeof Q=="function"&&(R=Q)}if(typeof R!="function")throw new Error("Unknown parser: "+R);return this.props.parser=R,this}},{key:"createElement",value:function(R){return arguments.length?(this.props.createElement=R,this):this.props.createElement||C.createElement}},{key:"render",value:function(){var R=ye(arguments);return typeof R.text=="string"&&(R.text=this.linebreak(R.text)),R.ctx?ee(R.text,this,R.ctx):ve(R.text,this)}}],G&&ps(D.prototype,G),Object.defineProperty(D,"prototype",{writable:!1}),C}();function Me(C){return Me=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},Me(C)}function Ne(C,D){(D==null||D>C.length)&&(D=C.length);for(var G=0,R=new Array(D);G<D;G++)R[G]=C[G];return R}function $e(C,D){for(var G=0;G<D.length;G++){var R=D[G];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(C,(Q=function(xt,Ft){if(Me(xt)!=="object"||xt===null)return xt;var It=xt[Symbol.toPrimitive];if(It!==void 0){var Ct=It.call(xt,Ft);if(Me(Ct)!=="object")return Ct;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(xt)}(R.key,"string"),Me(Q)==="symbol"?Q:String(Q)),R)}var Q}var as=function(C){return typeof C=="function"?C:function(){return C}},De=function(){function C(R){if(function(xt,Ft){if(!(xt instanceof Ft))throw new TypeError("Cannot call a class as a function")}(this,C),this.props={width:function(){return 1/0},height:function(){return 1/0},rotation:0,vAnchor:0,hAnchor:0},R)for(var Q in R)typeof this[Q]=="function"&&this[Q](R[Q]);this.render=this.render.bind(this)}var D,G;return D=C,G=[{key:"anchor",value:function(R){var Q=this.props,xt=Q.hAnchor,Ft=Q.vAnchor,It=Q.width,Ct=Q.height;if(!arguments.length)return[xt*It(0),Ft*Ct(0)];if(typeof R=="string"){var Ot=this.props;R.toLowerCase().trim().split(/\s+/).forEach(function(jt){jt==="top"&&(Ot.vAnchor=-0),jt==="middle"&&(Ot.vAnchor=-.5),jt==="bottom"&&(Ot.vAnchor=-1),jt==="left"&&(Ot.hAnchor=-0),jt==="center"&&(Ot.hAnchor=-.5),jt==="right"&&(Ot.hAnchor=-1)})}return this}},{key:"width",value:function(R){return arguments.length?(this.props.width=as(R),this):this.props.width}},{key:"height",value:function(R){return arguments.length?(this.props.height=as(R),this):this.props.height}},{key:"rotate",value:function(R){return arguments.length?(this.props.rotation=R,this):this.props.rotation}},{key:"createElement",value:function(R){return arguments.length?(this.props.createElement=R,this):this.props.createElement||C.createElement}},{key:"canvas",value:function(R,Q){var xt,Ft=R.getContext?R.getContext("2d"):R;return Ft.save(),Ft.rotate(this.rotate()*Math.PI/180),Ft.translate.apply(Ft,function(It){if(Array.isArray(It))return Ne(It)}(xt=this.anchor())||function(It){if(typeof Symbol<"u"&&It[Symbol.iterator]!=null||It["@@iterator"]!=null)return Array.from(It)}(xt)||function(It,Ct){if(It){if(typeof It=="string")return Ne(It,Ct);var Ot=Object.prototype.toString.call(It).slice(8,-1);return Ot==="Object"&&It.constructor&&(Ot=It.constructor.name),Ot==="Map"||Ot==="Set"?Array.from(It):Ot==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ot)?Ne(It,Ct):void 0}}(xt)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()),Q(Ft),Ft.restore(),Ft}},{key:"render",value:function(){var R=ye(arguments);if(R.d3)return R.d3.attr("transform","rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")"));if(R.ctx)return this.canvas(R.ctx,R.fn);if(R.text){var Q=typeof R.text.render=="function"?R.text.render():R.text;return this.createElement()("g",{transform:"rotate(".concat(this.rotate(),") translate(").concat(this.anchor(),")")},Q)}}}],G&&$e(D.prototype,G),Object.defineProperty(D,"prototype",{writable:!1}),C}(),qe=Object.prototype.hasOwnProperty,gs={};function Us(C){return gs[C]||(gs[C]=C.replace(/([a-z])([A-Z])/g,function(D,G,R){return G+"-"+R.toLowerCase()})),gs[C]}function me(C,D){if(Array.isArray(D))return D.forEach(function(G){return me(C,G)});typeof D=="string"&&(D=document.createTextNode(D)),C.appendChild(D)}function He(C,D){if(typeof document<"u"){var G=typeof C=="string"?document.createElementNS("http://www.w3.org/2000/svg",C):C;if(D&&G.setAttribute)for(var R in D)qe.call(D,R)&&D[R]!=null&&G.setAttribute(R==="className"?"class":Us(R),D[R]);for(var Q=arguments.length,xt=new Array(Q>2?Q-2:0),Ft=2;Ft<Q;Ft++)xt[Ft-2]=arguments[Ft];return xt!=null&&xt.length&&xt.forEach(function(It){me(G,It)}),G}}ie.createElement=He,ie.textparser=Nt,ie.defaultparser=Nt,ie.htmlparser=function(C){C=String(C||"").trim();for(var D,G,R={weight:null,style:null,sub:!1,sup:!1,href:null,color:null,rel:null,target:null},Q=[],xt=[],Ft=function(Xt){for(var Ut in R)R[Ut]&&(Xt[Ut]=R[Ut]);Q.push(Xt)},It=function(Xt){var Ut=Q.length,Vt=ue[Xt];if(Ut&&Vt){for(var T=Ut-1;Q[T]&&(Q[T]instanceof P||St.test(Q[T].value));)T--;for(;Vt&&Q[T]&&Q[T]instanceof S;)T--,Vt--;for(;Vt-- >0;)Q.push(new S)}};C.length;){if(D=/^[^<]+/.exec(C))Nt(Jt(D[0]),!1).forEach(Ft);else if(!(D=Kt.exec(C)))if(D=Zt.exec(C))xt.length&&(R=xt.pop()),It(D[1]);else if(D=Qt.exec(C)){var Ct=D[1];It(Ct),xt.push(R),R=Object.create(R),pt[Ct]&&pt[Ct](R,"");var Ot=q(D[2]);Ct==="a"&&(Ot.href&&(R.href=Ot.href),Ot.rel&&(R.rel=Ot.rel),Ot.target&&(R.target=Ot.target)),Ot.class&&(R.class=R.class?R.class+" "+Ot.class:Ot.class),Ot.style&&(G=/(?:^|\s|;)color\s*:\s*([^;\s"']+)/.exec(Ot.style))&&G[1]&&(R.color=G[1]),Ct==="br"&&Q.push(new S)}else D=[C.slice(0,1)],Ft(new $(D[0]));C=C.slice(D[0].length)}for(var jt=Q[Q.length-1];jt instanceof S;)Q.pop(),jt=Q[Q.length-1];return Q},ie.latexparser=function(C){C=String(C||"").trim();var D=[0];C=C.replace(/\\verb,(.*?),/,function(L,N){return D.push(N),"\\verb,"+(D.length-1)+","}).replace(/\\\\\n/g,function(){return"\\\\"}).replace(wt,function(L,N,z){return z.charAt(N-1)==="\\"?L:At[L]}).replace(/\n\s+/g,function(L){return/\n/.test(L.slice(1))?"\\par ":L}).replace(/\\symbol\{(\d+)\}/,function(L,N,z,V){return V.charAt(z-1)==="\\"?L:String.fromCharCode(1*N)}).replace(/(^|[^\\])(\^|_)(\d|[^{]\S*)/g,function(L,N,z,V){return N+z+"{"+V+"}"}).replace(/\\verb,(.*?),/,function(L,N){return"\\verb,".concat(D[+N],",")});for(var G,R={weight:null,italic:null,variant:null,sub:!1,sup:!1,href:null},Q=[],xt=[],Ft=function(L){for(var N in R)R[N]&&(L[N]=R[N]);return Q.push(L),L},It=function(){xt.push(R),R=Object.create(R)},Ct=function(){if(!xt.length)throw new Error("Unexpected }");R=xt.pop()},Ot={tokens:Q,open_context:It,close_context:Ct,add_token:Ft};C.length;){if(G=nt.exec(C))Nt(G[0],!1).forEach(Ft);else if(G=it.exec(C))Ft(new $(G[1]));else if(!(G=ot.exec(C))){if(G=/^\{/.exec(C))It();else if(G=/^\}/.exec(C))Ct();else if(!(G=/^\$/.exec(C)))if(G=/^\\verb,([^,]+),/.exec(C))Ft(new $(G[1]));else if(G=dt.exec(C)){var jt=G[1].slice(1)||G[1],Xt=!!G[2];if(/^(La)?TeX$/i.test(jt)){It(),R.family="serif";var Ut=void 0;jt==="LaTeX"&&((Ut=Ft(new $("L"))).tracking=-.25,(Ut=Ft(new $("A"))).size=.7,Ut.baseline=.3,Ut.tracking=-.1),(Ut=Ft(new $("T"))).tracking=-.17,(Ut=Ft(new $("E"))).baseline=-.22,Ut.tracking=-.13,Ut=Ft(new $("X")),Ct()}else if(jt in et)Ft(new $(et[jt])),Xt&&It();else if(jt in Et){var Vt=[],T=Et[jt].length-1,F=void 0;if(T){for(Xt=!1,C=C.slice(G[0].length-1);T--;){if(!(F=/^\{([^}]+)\}/.exec(C)))throw new Error(jt+" is missing an argument");Vt.push(F[1]),C=C.slice(F[0].length)}G[0]=/^\{/.exec(C)?"{":"",Xt=!!G[0]}Xt&&It(),Et[jt].apply(Ot,[R].concat(Vt))}else console.warn("unknown latex command",jt),Ft(new $(G[1])),Xt&&It()}else G=[C.slice(0,1)],Ft(new $(G[0]))}C=C.slice(G[0].length)}return Q},ie.measureText=function(C,D,G){return x(C,_(D),G)},ie.Token=$,ie.Break=P,ie.LineBreak=S,ie.SoftHyphen=Y,ie.Rotator=De,De.createElement=He;const Ye=ie;return i.default})())})(n0);var DF=n0.exports;const $_=Cu(DF);function ad(t){return t.replace(/…$/,"")}function ld(t){return t.children[0].innerHTML}function kF(t,e){const s=ri(t),{fontSize:i,font:n,padding:r=0}=t.properties.style||{};if(s.width===s.height&&s.width===0)return;const o=new $_({font:`${i}px/${i}px ${n}`.replace(/(px)+/g,"px"),width:s.width-r*2,height:s.height-r*2,align:"left",valign:"top",x:0,overflow:"ellipsis",parser:"html",createElement:$_.createElement});o.overflowWrap("break-word");const l=o.linebreak(t.properties.content.replaceAll(`
`,"<br>")).render(),d=[...l.children];let h=0;const u=[];t.properties.content.split(`
`).forEach(_=>{let m=_;for(;m.length&&h<d.length;){if(d[h].innerHTML==="&nbsp;"){m.startsWith(`
`)||u.push(h),h++;break}const f=ad(ld(d[h]));m.startsWith(f)&&(m=m.slice(f.length).trim()),h++}}),u.forEach(_=>l.removeChild(d[_]));const c=t.properties.content.match(/(https?:\/\/.*)/gm),g=c?c.map(_=>_.split(" ")[0]):[];l.setAttribute("transform",`translate(${r}, ${r})`),g.forEach(_=>{let m=_;const f=[];for(;m.length>0;){const p=d.find(b=>!!b.children[0]&&b.children[0].tagName==="tspan"&&m.startsWith(ad(ld(b))));if(!p)break;f.push(p);const y=ad(p.children[0].innerHTML).length;if(!y)break;m=m.slice(y)}f.forEach(p=>{const y=document.createElementNS("http://www.w3.org/2000/svg","a");y.setAttribute("href",_),y.setAttribute("target","_blank"),y.innerHTML=ld(p),p.children[0].innerHTML="",p.children[0].appendChild(y)})}),e.appendChild(l)}const Y_=20;class RF extends s0{constructor(s,i={}){super(s,`
    <div class="annotation-text-handle">
    <span class="handle line-handle top" data-handle-id="0"></span>
    <span class="handle line-handle bottom" data-handle-id="1"></span>
    <span class="handle line-handle left" data-handle-id="2"></span>
    <span class="handle line-handle right" data-handle-id="3"></span>
    <span class="handle top right point-handle top-right" data-handle-id="4"></span>
    <span class="handle left top point-handle top-left" data-handle-id="5"></span>
    <span class="handle bottom right point-handle bottom-right" data-handle-id="6"></span>
    <span class="handle left bottom left-handle point-handle bottom-left" data-handle-id="7"></span>
    <textarea wrap="on"></textarea>
    </div>
  `);Lt(this,"textArea");Lt(this,"handleSize");Lt(this,"rect",{x:0,y:0,width:0,height:0});Lt(this,"annotation",{...od});Lt(this,"startX",0);Lt(this,"startY",0);Lt(this,"handles",[]);Lt(this,"draggedHandle",Ue);Lt(this,"isFocused",!1);Lt(this,"placeholder","Type your text here...");Lt(this,"_onFocus",()=>{this.textArea.value===this.placeholder&&(this.textArea.value=""),this.isFocused=!0});Lt(this,"_onBlur",()=>{this.isFocused=!1});Lt(this,"startDrawing",(s,i,n=i0(s,i,0,0,"",Un))=>{this.add(n);const r=this.ogma.view.graphToScreenCoordinates({x:s,y:i});this.select(n.id),this.startDragging(this.getById(n.id),r.x,r.y),this.draggedHandle=6});Lt(this,"cancelDrawing",()=>{this.isDragging&&(this.remove(this.annotation.id),this.annotation={...od},this.draggedHandle=Ue,this.isDragging=!1,this.emit(zi,this.annotation))});Lt(this,"startDragging",(s,i,n)=>{this.annotation=s;const r=si(this.annotation),o=ri(this.annotation);this.rect.x=r.x,this.rect.y=r.y,this.rect.width=o.width,this.rect.height=o.height,this.startX=i,this.startY=n,this.disableDragging(),this.textArea.classList.add("noevents"),this.textArea.setAttribute("disabled","disabled"),this.emit(Va,this.annotation),this.isDragging=!0});Lt(this,"onHandleMouseDown",s=>{const i=this.getById(this.selectedId)||this.getById(this.hoveredId);if(!i)return;this.selectedId!==i.id&&this.select(this.hoveredId);const{x:n,y:r}=Ah(s,this.ogma.getContainer());this.startDragging(i,n,r),this.draggedHandle=Qx(s.target)});Lt(this,"onMouseMove",s=>{requestAnimationFrame(()=>this._onMouseMove(s))});Lt(this,"_onMouseMove",s=>{if(!this.isDragging)return;s.stopPropagation(),s.preventDefault();const i=this.handles[this.draggedHandle],n=i.classList.contains("top"),r=i.classList.contains("left"),o=i.classList.contains("right"),a=i.classList.contains("bottom"),l=i.classList.contains("line-handle"),{x:d,y:h}=Ah(s,this.ogma.getContainer()),u=this.ogma.view.getZoom(),c=(d-this.startX)/u,g=(h-this.startY)/u,_=this.ogma.view.getAngle(),m=new Ve(c,g).rotateRadians(_);(a&&r||n&&o)&&(m.y=0,m.x=0);const f=r||l?this.rect.x+m.x:this.rect.x,p=n||l?this.rect.y+m.y:this.rect.y,y=Math.max(this.rect.width+c*(l||r?0:1),Y_),b=Math.max(this.rect.height+g*(l||n?0:1),Y_);MF(this.annotation,f,p,y,b),this.emit(Ga,this.annotation,"text"),this.refreshEditor(),this.layer.refresh()});Lt(this,"onMouseUp",()=>{!this.isDragging||this.draggedHandle===Ue||(this.restoreDragging(),this.textArea.classList.remove("noevents"),this.textArea.removeAttribute("disabled"),this.emit(zi,this.annotation),this.isDragging=!1,this.draggedHandle=Ue)});Lt(this,"_onMousedown",s=>{s.stopPropagation()});Lt(this,"onViewChanged",()=>{const s=Math.max(2,this.handleSize/this.ogma.view.getZoom());document.documentElement.style.setProperty("--handle-scale",`${1/s}`)});Lt(this,"_onInput",()=>{const s=this.getById(this.selectedId);s&&(this.textArea.value=this.textArea.value.replace(/ +(?= )/g,""),this.textArea.focus(),s.properties.content=this.textArea.value,this.emit(Eh,s),this.layer.refresh())});this.showeditorOnHover=!1,this.handleSize=W_.handleSize,this.placeholder=W_.placeholder;const n=this.textArea=this.editor.element.querySelector("textarea");n.addEventListener("input",this._onInput),n.addEventListener("focus",this._onFocus),n.addEventListener("blur",this._onBlur),n.addEventListener("mousedown",this._onMousedown),n.spellcheck=!1,this.handles=Array.prototype.slice.call(this.editor.element.querySelectorAll(".annotation-text-handle > .handle")),this.handles.forEach(r=>r.addEventListener("mousedown",this.onHandleMouseDown)),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousemove",this.onMouseMove,!0),s.events.on(["viewChanged","zoom"],this.onViewChanged)}_canRemove(){return!this.isFocused}detect({x:s,y:i},n=0){const r=new Ve(s,i),o=this.ogma.view.getAngle();return this.elements.find(a=>{const{x:l,y:d}=si(a),{width:h,height:u}=ri(a),c=new Ve(l,d),{x:g,y:_}=r.sub(c).rotateRadians(-o);return g>-n&&g<h+n&&_>-n&&_<u+n})}draw(s){s.innerHTML="";const i="",n=this.ogma.view.getAngle();this.elements.forEach((o,a)=>{const l=`class${a}`,d=ri(o),h=si(o),u=o.id,{color:c,fontSize:g,font:_,strokeColor:m,strokeWidth:f,strokeType:p,background:y}=o.properties.style||Un;if(u===this.selectedId)return;const b=Dr("g");b.classList.add("annotation-text"),b.setAttribute("fill",`${c}`),b.setAttribute("font-size",`${g}px`),b.setAttribute("font-family",`${_}`);const x=Dr("rect");let v=!1;p&&p!=="none"&&(v=!0,x.setAttribute("stroke",m||"black"),x.setAttribute("stroke-width",`${f}`),p==="dashed"&&x.setAttribute("stroke-dasharray","5,5")),(y&&y.length||v)&&(v=!0,x.setAttribute("fill",y||"transparent")),v&&(x.setAttribute("width",`${d.width}`),x.setAttribute("height",`${d.height}`)),b.appendChild(x),kF(o,b);const{x:E,y:w}=new Ve(h.x,h.y).rotateRadians(-n);b.setAttribute("transform",`translate(${E},${w})`),b.classList.add(l),b.setAttribute("data-annotation",`${o.id}`),b.setAttribute("data-annotation-type","text"),s.appendChild(b)});const r=Dr("style");r.innerHTML=i,s.firstChild&&s.insertBefore(r,s.firstChild)}refreshDrawing(){const s=this.ogma.view.getAngle();[...this.layer.element.children].forEach(i=>{const n=i.getAttribute("data-annotation");if(!n)return;const r=si(this.getById(n)),{x:o,y:a}=new Ve(r.x,r.y).rotateRadians(-s);i.setAttribute("transform",`translate(${o},${a})`)})}getDefaultOptions(){return od}refreshEditor(){if(+this.selectedId<0&&+this.hoveredId<0)return;const s=this.getById(this.selectedId)||this.getById(this.hoveredId),i=ri(s),n=this.ogma.view.graphToScreenCoordinates(si(s)),r=this.ogma.view.getZoom(),{font:o,fontSize:a,color:l,background:d,padding:h=0}=s.properties.style||Un,u=(a||1)*r;this.textArea.value=s.properties.content,this.editor.element.style.transform=`translate(${n.x}px, ${n.y}px)translate(-50%, -50%)translate(${i.width/2*r}px, ${i.height/2*r}px)`,this.editor.element.style.width=`${i.width*r}px`,this.editor.element.style.height=`${i.height*r}px`,this.textArea.style.font=`${u} ${o}`,this.textArea.style.fontFamily=o||"sans-serif",this.textArea.style.fontSize=`${u}px`,this.textArea.style.padding=`${r*h}px`,this.textArea.style.lineHeight=`${u}px`,this.textArea.style.boxSizing="border-box",this.textArea.style.color=l||"black",this.textArea.style.background=d||"transparent",this.textArea.placeholder=this.placeholder,this.layer.refresh()}select(s){super.select(s),this.textArea.focus()}destroy(){super.destroy(),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove,!0),this.ogma.events.off(this.onViewChanged)}}class OF{constructor(){Lt(this,"links",{});Lt(this,"linksByTargetId",{});Lt(this,"linksByArrowId",{})}add(e,s,i,n,r){const o=yl(),a=e.id,l={id:o,arrow:a,target:i,targetType:n,connectionPoint:r,side:s};return this.links[o]=l,this.linksByTargetId[i]||(this.linksByTargetId[i]=[]),this.linksByTargetId[i].push(o),this.linksByArrowId[a]||(this.linksByArrowId[a]={}),this.linksByArrowId[a][s]=o,e.properties.link=e.properties.link||{},e.properties.link[s]={id:i,side:s,type:n,magnet:r},this}arrowIsLinked(e,s){var i;return!!((i=this.linksByArrowId[e])!=null&&i[s])}remove(e,s){var a,l;const i=e.id,n=(a=this.linksByArrowId[i])==null?void 0:a[s];if((l=e.properties.link)==null||delete l[s],!n)return this;const r=this.links[n];delete this.links[n];const o=this.linksByTargetId[r.target];for(let d=0;d<o.length;d++)if(o[d]===n){o.splice(d,1);break}return delete this.linksByArrowId[i][s],this}getArrowLink(e,s){var n;const i=(n=this.linksByArrowId[e])==null?void 0:n[s];return i?this.links[i]:null}getTargetLinks(e,s){var i;return((i=this.linksByTargetId[e])==null?void 0:i.map(n=>this.links[n]).filter(n=>n.targetType===s))??[]}forEach(e){Object.values(this.links).forEach(e)}}const qs=t=>t.properties.type==="arrow",qi=t=>t.properties.type==="text",Z_=t=>t.type==="FeatureCollection",zF={magnetColor:"#3e8",detectMargin:20,magnetHandleRadius:5,magnetRadius:10,textPlaceholder:"Type here",arrowHandleSize:3.5,textHandleSize:3.5,minArrowHeight:20,maxArrowHeight:30},K_=["start","end"],Q_=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:0,y:.5},{x:1,y:.5},{x:0,y:1},{x:.5,y:1},{x:1,y:1}];class BF extends e0{constructor(s,i={}){super();Lt(this,"arrows");Lt(this,"texts");Lt(this,"links",new OF);Lt(this,"layer");Lt(this,"annotations");Lt(this,"ogma");Lt(this,"options");Lt(this,"selected",null);Lt(this,"updateTimeout",0);Lt(this,"hoveredNode",null);Lt(this,"dragged",null);Lt(this,"textToMagnet");Lt(this,"activeLinks",[]);Lt(this,"_render",s=>{if(!this.dragged||this.textToMagnet===void 0)return;s.beginPath(),s.fillStyle="green";const i=this.ogma.view.getZoom();Q_.forEach(n=>{if(!this.textToMagnet)return;const r=ri(this.textToMagnet),o=si(this.textToMagnet),{x:a,y:l}=new Ve(n.x,n.y).mul({x:r.width,y:r.height}).rotateRadians(this.ogma.view.getAngle()).add(o);s.moveTo(a,l),s.arc(a,l,this.options.magnetHandleRadius/i,0,Math.PI*2)}),s.fill(),s.closePath()});Lt(this,"_onFeatureDrag",(s,i)=>{const n=i;if(qs(s)&&n==="line")["start","end"].find(r=>{const o=r==="start"?kr(s):ja(s);return this._snapToText(s,n,o)||this._findAndSnapToNode(s,r,o)});else if(qs(s)&&n!=="line"){const r=n==="start"?kr(s):ja(s);this._snapToText(s,n,r)||this._findAndSnapToNode(s,n,r)}else qi(s)&&(this.activeLinks.forEach(({arrow:r,side:o,connectionPoint:a})=>{const l=this.getAnnotation(r),d=ri(s),h=si(s),u=new Ve(a.x,a.y).mul({x:d.width,y:d.height}).rotateRadians(this.ogma.view.getAngle()).add(h);l.geometry.coordinates[o==="start"?0:1]=[u.x,u.y]}),this.activeLinks.length&&this.arrows.refreshLayer());this.layer.refresh(),this.emit(Ga,s,i)});Lt(this,"_onFeatureDragEnd",s=>{this.dragged!==null&&qs(s)&&kr(this.dragged)&&K_.forEach(i=>{this.links.getArrowLink(s.id,i)&&this.emit(wF,{arrow:s,link:this.links.getArrowLink(s.id,i)})}),(qi(s)||qs(s))&&this.onUpdate(s),this.dragged=null,this.activeLinks=[],this.textToMagnet=void 0,this.annotations.forEach(i=>i.enableDetection()),this.layer.refresh(),this.emit(zi,s)});Lt(this,"_onFeatureDragStart",s=>{this.textToMagnet=void 0,qs(s)?this.dragged=s:qi(s)&&this.activeLinks.push(...this.links.getTargetLinks(s.id,"text")),this.annotations.forEach(i=>{const n=i.getSelectedFeature();n&&n!==s&&i.unhover().unselect(),i.disableDetection()}),this.emit(Va,s)});Lt(this,"_onNodesDragStart",()=>{this.arrows.unhover().unselect(),this.texts.unhover().unselect()});Lt(this,"_onNodesDrag",s=>{const{dx:i,dy:n}=s;this._moveNodes(s.nodes,i,n)});Lt(this,"_onLayoutEnd",s=>{s.ids.forEach((i,n)=>{this.links.getTargetLinks(i,"node").forEach(o=>{const a=this.getAnnotation(o.arrow),l=o.side,d=sa(a,l==="start"?"end":"start"),h=s.positions.current[n],u=this.ogma.getNode(i).getAttribute("radius"),c=ia(d,h,+u);An(a,l,c.x,c.y)})}),this.arrows.refreshLayer(),this.texts.refreshLayer()});Lt(this,"_onAdded",s=>{this.emit(vh,s)});Lt(this,"_onRemoved",s=>{this.emit(bh,s)});Lt(this,"_onUnselect",s=>{this.selected=null,this.emit(xh,s)});Lt(this,"_onSelect",s=>{this.selected!==s&&(this.selected=s,this.emit(yh,this.selected))});Lt(this,"onUpdate",s=>{cancelAnimationFrame(this.updateTimeout),this.updateTimeout=requestAnimationFrame(()=>this._onUpdate(s))});Lt(this,"_onUpdate",s=>{this.emit(Eh,s)});this.options=this.setOptions({...zF,...i}),this.ogma=s,this.arrows=new PF(s,this.options),this.texts=new RF(s,this.options),this.annotations=[this.arrows,this.texts],this.annotations.forEach(n=>{n.on(Va,this._onFeatureDragStart).on(Ga,this._onFeatureDrag).on(zi,this._onFeatureDragEnd).on(Eh,this.onUpdate).on(xh,this._onUnselect).on(yh,this._onSelect).on(vh,this._onAdded).on(bh,this._onRemoved)}),this.ogma.events.on("nodesDragStart",this._onNodesDragStart).on("nodesDragProgress",this._onNodesDrag).on("layoutEnd",this._onLayoutEnd).on(["viewChanged","rotate"],()=>{this.refreshTextLinks()}),this.layer=s.layers.addCanvasLayer(this._render),this.layer.moveToBottom()}_moveNodes(s,i,n){s.forEach(r=>{const o=this.links.getTargetLinks(r.getId(),"node"),a=r.getPosition();o.forEach(l=>{const d=this.getAnnotation(l.arrow),h=l.side,u=sa(d,h==="start"?"end":"start");let c=a;const g=+r.getAttribute("radius"),_=1e-6;(l.connectionPoint.x-(a.x-i)>_||l.connectionPoint.y-(a.y-n)>_)&&(c=ia(u,a,g)),An(d,h,c.x,c.y)})}),this.arrows.refreshLayer()}_snapToText(s,i,n){const r=this.texts.detect(n,this.options.detectMargin);if(this.links.remove(s,i),!r)return!1;this.textToMagnet=r;const o=this.findMagnetPoint(Q_,r,n);return o?(An(s,i,o.point.x,o.point.y),this.links.add(s,i,r.id,"text",o.magnet),!0):!1}_findAndSnapToNode(s,i,n){const r=this.ogma.view.graphToScreenCoordinates(n),o=this.ogma.view.getElementAt(r);this.links.remove(s,i),o&&o.isNode?(this.hoveredNode=o,this.hoveredNode.setSelected(!0),this._snapToNode(s,i,o,r)):(this.hoveredNode&&this.hoveredNode.setSelected(!1),this.hoveredNode=null)}_snapToNode(s,i,n,r){const o=n.getPositionOnScreen(),a=+n.getAttribute("radius"),l=a*this.ogma.view.getZoom(),d=r.x-o.x,h=r.y-o.y,u=Math.sqrt(d*d+h*h),c=n.getPosition();if(u<l+this.options.detectMargin){let g=c;if(u>l/2){const _=sa(s,i==="end"?"start":"end");g=ia(_,g,a)}An(s,i,g.x,g.y),this.links.add(s,i,n.getId(),"node",g)}}refreshTextLinks(){let s=!1;this.links.forEach(({connectionPoint:i,targetType:n,target:r,arrow:o,side:a})=>{if(n!=="text")return;s=!0;const l=this.getAnnotation(r),d=this.getAnnotation(o),h=ri(l),u=si(l),c=new Ve(i.x,i.y).mul({x:h.width,y:h.height}).rotateRadians(this.ogma.view.getAngle()).add(u);An(d,a,c.x,c.y)}),s&&this.arrows.refreshLayer()}getSelected(){return this.selected}findMagnetPoint(s,i,n){let r;for(const o of s){const a=ri(i),l=si(i),d=new Ve(o.x,o.y).mul({x:a.width,y:a.height}).rotateRadians(this.ogma.view.getAngle()).add(l),h=d.sub(n).length(),u=Math.min(this.options.magnetRadius*this.ogma.view.getZoom(),a.width/2,a.height/2);if(h<Math.max(u,this.options.magnetHandleRadius)){r={point:d,magnet:o};break}}return r}setOptions(s={}){return this.options={...this.options||{},...s},this.options}select(s){const i=this.getAnnotations().features.find(n=>n.id===s);return i?(qs(i)?this.arrows.select(i.id):qi(i)&&this.texts.select(i.id),this):this}unselect(){return this.selected?(qs(this.selected)?this.arrows.unselect():qi(this.selected)&&this.texts.unselect(),this):this}add(s){if(Z_(s)){const[i,n]=s.features.reduce((r,o)=>(qs(o)?r[1].push(o):qi(o)&&r[0].push(o),r),[[],[]]);return i.forEach(r=>this.add(r)),n.forEach(r=>this.add(r)),this.arrows.refreshLayer(),this}switch(s.properties.type){case"text":this.texts.add(s);break;default:this.arrows.add(s),this.loadLink(s);break}return this}remove(s){return Z_(s)?(s.features.forEach(i=>this.remove(i)),this):(qs(s)?(this.links.remove(s,"start"),this.links.remove(s,"end"),this.arrows.remove(s.id)):this.texts.remove(s.id),this)}loadLink(s){if(s.properties.link)for(const i of K_){const n=s.properties.link[i];if(!n)continue;const r=this.getAnnotation(n.id);if(n.type==="text"&&r)this.links.add(s,i,n.id,n.type,n.magnet);else if(n.type==="node"){const o=this.ogma.getNode(n.id);if(!o)continue;this.links.add(s,i,n.id,n.type,n.magnet);const a=o.getPosition(),l=o.getAttribute("radius")||0,d=sa(s,i==="start"?"end":"start"),h=ia(d,a,+l);An(s,i,h.x,h.y)}}}startArrow(s,i,n){this.cancelDrawing(),this.arrows.startDrawing(s,i,n)}startText(s,i,n){this.cancelDrawing(),this.texts.startDrawing(s,i,n)}cancelDrawing(){this.annotations.forEach(s=>s.cancelDrawing()),this.emit(SF)}updateStyle(s,i){const n=this.getAnnotations().features.find(r=>r.id===s);return n?(qs(n)?this.arrows.updateStyle(n,i):qi(n)&&this.texts.updateStyle(n,i),this.onUpdate(n),this):this}getAnnotations(){const s={type:"FeatureCollection",features:[]};return this.annotations.forEach(i=>{s.features=[...s.features,...i.getElements()]}),s}getAnnotation(s){return this.getAnnotations().features.find(i=>i.id===s)}destroy(){this.annotations.forEach(s=>s.destroy()),this.layer.destroy()}}const li=new vF({container:"app"}),Bi=new BF(li);window.ogma=li;const UF={type:"FeatureCollection",features:[{type:"Feature",id:2,properties:{type:"arrow",style:{strokeType:"plain",strokeColor:"#3b3",strokeWidth:2,head:"arrow-plain",tail:"none"},link:{end:{id:"n0",side:"end",type:"node",magnet:{x:5.050129380397267,y:3.193041958648245}}}},geometry:{type:"LineString",coordinates:[[-200,200],[5.050129380397267,3.193041958648245]]}},{type:"Feature",id:0,properties:{type:"text",content:"Another annotation",style:{font:"Helvetica",fontSize:52,color:"black",background:"rgba(255, 255, 255, 0.5)",strokeWidth:1,strokeColor:"#000",strokeType:"plain",padding:12}},geometry:{type:"Polygon",coordinates:[[[-200,-200],[-200,-50],[200,-50],[200,-200],[-200,-200]]],bbox:[-200,-200,200,-50]}}]};li.generate.flower({depth:3}).then(t=>{const e=t.nodes.reduce((s,i,n)=>(s[i.id]=i,i.id=`n${n}`,s),{});return t.edges.forEach(s=>{s.source=e[s.source].id,s.target=e[s.target].id}),li.setGraph(t)}).then(()=>li.layouts.force({locate:!0})).then(()=>{Bi.add(UF)});window.control=Bi;window.createArrow=Mu;const na=document.getElementById("add-arrow");na.addEventListener("click",()=>{na.disabled||(na.disabled=!0,li.events.once("mousedown",t=>{const{x:e,y:s}=li.view.screenToGraphCoordinates(t),i=Mu(e,s,e,s,{strokeWidth:2,strokeColor:"#3b3",strokeType:"plain"});Bi.startArrow(e,s,i),Bi.once(zi,n=>{n.id===i.id&&(na.disabled=!1)})}))});const ra=document.getElementById("add-text");ra.addEventListener("click",()=>{ra.disabled||(ra.disabled=!0,li.events.once("mousedown",t=>{const{x:e,y:s}=li.view.screenToGraphCoordinates(t),i=i0(e,s,0,0);Bi.startText(e,s,i),Bi.once(zi,n=>{n.id===i.id&&(ra.disabled=!1)})}))});document.addEventListener("keydown",t=>{t.key==="Escape"&&Bi.cancelDrawing()});Bi.on("cancelDrawing",()=>{console.log("cancelDrawing")})});export default GF();
